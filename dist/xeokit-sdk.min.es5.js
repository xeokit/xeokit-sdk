/**
 * xeokit-sdk v2.6.98
 *  Commit: 30ac0fa9a4eaf6759fe306bb2e332cce49884787
 *  Built: 2025-12-08T14:34:05.193Z
 */

var e,t,n,r=A().mark(Th),i=A().mark(Ph),s=A().mark(gv);function a(e){var t="function"==typeof Map?new Map:void 0;return a=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return o(e,arguments,C(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),y(r,e)},a(e)}function o(e,t,n){return o=B()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&y(i,n.prototype),i},o.apply(null,arguments)}function A(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */A=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",s=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function o(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{o({},"")}catch(e){o=function(e,t,n){return e[t]=n}}function c(e,t,n,r){var i=t&&t.prototype instanceof h?t:h,s=Object.create(i.prototype),a=new C(r||[]);return s._invoke=function(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return E()}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=b(a,n);if(o){if(o===u)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var A=l(e,t,n);if("normal"===A.type){if(r=n.done?"completed":"suspendedYield",A.arg===u)continue;return{value:A.arg,done:n.done}}"throw"===A.type&&(r="completed",n.method="throw",n.arg=A.arg)}}}(e,n,a),s}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function h(){}function d(){}function f(){}var p={};o(p,i,(function(){return this}));var v=Object.getPrototypeOf,g=v&&v(v(k([])));g&&g!==t&&n.call(g,i)&&(p=g);var m=f.prototype=h.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){o(e,t,(function(e){return this._invoke(t,e)}))}))}function _(e,t){function r(i,s,a,o){var A=l(e[i],e,s);if("throw"!==A.type){var c=A.arg,u=c.value;return u&&"object"==M(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,a,o)}),(function(e){r("throw",e,a,o)})):t.resolve(u).then((function(e){c.value=e,a(c)}),(function(e){return r("throw",e,a,o)}))}o(A.arg)}var i;this._invoke=function(e,n){function s(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(s,s):s()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var r=l(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,u;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function B(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function k(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,s=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return s.next=s}}return{next:E}}function E(){return{value:void 0,done:!0}}return d.prototype=f,o(m,"constructor",f),o(f,"constructor",d),d.displayName=o(f,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===d||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,o(e,a,"GeneratorFunction")),e.prototype=Object.create(m),e},e.awrap=function(e){return{__await:e}},y(_.prototype),o(_.prototype,s,(function(){return this})),e.AsyncIterator=_,e.async=function(t,n,r,i,s){void 0===s&&(s=Promise);var a=new _(c(t,n,r,i),s);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},y(m),o(m,a,"Generator"),o(m,i,(function(){return this})),o(m,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=k,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(B),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return r("end");if(s.tryLoc<=this.prev){var o=n.call(s,"catchLoc"),A=n.call(s,"finallyLoc");if(o&&A){if(this.prev<s.catchLoc)return r(s.catchLoc,!0);if(this.prev<s.finallyLoc)return r(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return r(s.catchLoc,!0)}else{if(!A)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return r(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,u):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),B(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;B(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:k(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function c(e,t,n,r,i,s,a){try{var o=e[s](a),A=o.value}catch(e){return void n(e)}o.done?t(A):Promise.resolve(A).then(r,i)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var s=e.apply(t,n);function a(e){c(s,r,i,a,o,"next",e)}function o(e){c(s,r,i,a,o,"throw",e)}a(void 0)}))}}function u(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=E(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function p(e){return function(e){if(Array.isArray(e))return F(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||E(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(){return v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=g(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(arguments.length<3?e:n):i.value}},v.apply(this,arguments)}function g(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=C(e)););return e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function _(e){var t=B();return function(){var n,r=C(e);if(t){var i=C(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return b(this,n)}}function b(e,t){if(t&&("object"===M(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return w(e)}function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function B(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function C(e){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},C(e)}function M(e){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},M(e)}function k(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null==n)return;var r,i,s=[],a=!0,o=!1;try{for(n=n.call(e);!(a=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);a=!0);}catch(e){o=!0,i=e}finally{try{a||null==n.return||n.return()}finally{if(o)throw i}}return s}(e,t)||E(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,t){if(e){if("string"==typeof e)return F(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?F(e,t):void 0}}function F(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function x(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t&&U(e.prototype,t),n&&U(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e){return new D(e)}function P(e){return function(){return new S(e.apply(this,arguments))}}function S(e){var t,n;function r(t,n){try{var s=e[t](n),a=s.value,o=a instanceof D;Promise.resolve(o?a.wrapped:a).then((function(e){o?r("return"===t?"return":"next",e):i(s.done?"return":"normal",e)}),(function(e){r("throw",e)}))}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(e,i){return new Promise((function(s,a){var o={key:e,arg:i,resolve:s,reject:a,next:null};n?n=n.next=o:(t=n=o,r(e,i))}))},"function"!=typeof e.return&&(this.return=void 0)}function D(e){this.wrapped=e}function Q(e){var t,n,r,i=2;for("undefined"!=typeof Symbol&&(n=Symbol.asyncIterator,r=Symbol.iterator);i--;){if(n&&null!=(t=e[n]))return t.call(e);if(r&&null!=(t=e[r]))return new R(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function R(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then((function(e){return{value:e,done:t}}))}return R=function(e){this.s=e,this.n=e.next},R.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var n=this.s.return;return void 0===n?Promise.resolve({value:e,done:!0}):t(n.apply(this.s,arguments))},throw:function(e){var n=this.s.return;return void 0===n?Promise.reject(e):t(n.apply(this.s,arguments))}},new R(e)}S.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},S.prototype.next=function(e){return this._invoke("next",e)},S.prototype.throw=function(e){return this._invoke("throw",e)},S.prototype.return=function(e){return this._invoke("return",e)},"undefined"!=typeof window&&(window.__XEOKIT__={version:"2.6.98",commit:"30ac0fa9a4eaf6759fe306bb2e332cce49884787",built:"2025-12-08T14:34:05.193Z"});var O=function(){function e(t,n){x(this,e),this.items=t||[],this._lastUniqueId=(n||0)+1}return I(e,[{key:"addItem",value:function(){var e;if(2===arguments.length){var t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(e=arguments[0]||{};;){var n=this._lastUniqueId++;if(!this.items[n])return this.items[n]=e,n}}},{key:"removeItem",value:function(e){var t=this.items[e];return delete this.items[e],t}}]),e}(),V=new O,L=I((function e(t){x(this,e),this.id=t,this.parentItem=null,this.groups=[],this.menuElement=null,this.shown=!1,this.mouseOver=0})),H=I((function e(){x(this,e),this.items=[]})),N=I((function e(t,n,r,i,s){x(this,e),this.id=t,this.getTitle=n,this.doAction=r,this.getEnabled=i,this.getShown=s,this.itemElement=null,this.subMenu=null,this.enabled=!0})),G=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this._id=V.addItem(),this._context=null,this._enabled=!1,this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={},this._shown=!1,this._nextId=0,this._parentNode=n.parentNode||document.body,this._offsetParent=this._parentNode instanceof ShadowRoot?this._parentNode.host:this._parentNode,this._eventSubs={},!1!==n.hideOnMouseDown&&(this._parentNode.addEventListener("mousedown",(function(e){e.target.classList.contains("xeokit-context-menu-item")||t.hide()})),this._parentNode.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){e.target.classList.contains("xeokit-context-menu-item")||t.hide()})),n.items&&(this.items=n.items),this._hideOnAction=!1!==n.hideOnAction,this.context=n.context,this.enabled=!1!==n.enabled,this.hide()}return I(e,[{key:"on",value:function(e,t){var n=this._eventSubs[e];n||(n=[],this._eventSubs[e]=n),n.push(t)}},{key:"fire",value:function(e,t){var n=this._eventSubs[e];if(n)for(var r=0,i=n.length;r<i;r++)n[r](t)}},{key:"items",get:function(){return this._itemsCfg},set:function(e){this._clear(),this._itemsCfg=e||[],this._parseItems(e),this._createUI()}},{key:"enabled",get:function(){return this._enabled},set:function(e){(e=!!e)!==this._enabled&&(this._enabled=e,this._enabled||this.hide())}},{key:"context",get:function(){return this._context},set:function(e){this._context=e}},{key:"show",value:function(e,t){this._context?this._enabled&&(this._shown||(this._hideAllMenus(),this._updateItemsTitles(),this._updateItemsEnabledStatus(),this._showMenu(this._rootMenu.id,e,t),this._updateSubMenuInfo(),this._shown=!0,this.fire("shown",{}))):console.error("ContextMenu cannot be shown without a context - set context first")}},{key:"shown",get:function(){return this._shown}},{key:"hide",value:function(){this._enabled&&this._shown&&(this._hideAllMenus(),this._shown=!1,this.fire("hidden",{}))}},{key:"destroy",value:function(){this._context=null,this._clear(),null!==this._id&&(V.removeItem(this._id),this._id=null)}},{key:"_clear",value:function(){for(var e=0,t=this._menuList.length;e<t;e++){this._menuList[e].menuElement.remove()}this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={}}},{key:"_parseItems",value:function(e){var t=this;this._rootMenu=function e(n){for(var r=t._getNextId(),i=new L(r),s=0,a=n.length;s<a;s++){var o=n[s],A=new H;i.groups.push(A);for(var c=function(n,r){var s=o[n],a=s.items,c=a&&a.length>0,l=t._getNextId(),u=s.getTitle||function(){return s.title||""},h=s.doAction||s.callback||function(){},d=s.getEnabled||function(){return!0},f=s.getShown||function(){return!0},p=new N(l,u,h,d,f);if(p.parentMenu=i,A.items.push(p),c){var v=e(a);p.subMenu=v,v.parentItem=p}t._itemList.push(p),t._itemMap[p.id]=p},l=0,u=o.length;l<u;l++)c(l)}return t._menuList.push(i),t._menuMap[i.id]=i,i}(e)}},{key:"_getNextId",value:function(){return"ContextMenu_"+this._id+"_"+this._nextId++}},{key:"_createUI",value:function(){var e=this;!function t(n){e._createMenuUI(n);for(var r=n.groups,i=0,s=r.length;i<s;i++)for(var a=r[i].items,o=0,A=a.length;o<A;o++){var c=a[o].subMenu;c&&t(c)}}(this._rootMenu)}},{key:"_createMenuUI",value:function(e){var t=this,n=e.groups,r=[],i=document.createElement("div");if(i.classList.add("xeokit-context-menu",e.id),i.style.zIndex=3e5,i.style.position="absolute",r.push("<ul>"),n)for(var s=0,a=n.length;s<a;s++){var o=s,A=a,c=n[s].items;if(c)for(var l=0,u=c.length;l<u;l++){var h=c[l],d=h.subMenu,f=h.title||"";d?(r.push('<li id="'+h.id+'" class="xeokit-context-menu-item xeokit-context-menu-submenu">'+f+"</li>"),o===A-1||l<u-1||r.push('<li id="'+h.id+'" class="xeokit-context-menu-item-separator"></li>')):(r.push('<li id="'+h.id+'" class="xeokit-context-menu-item">'+f+"</li>"),o===A-1||l<u-1||r.push('<li id="'+h.id+'" class="xeokit-context-menu-item-separator"></li>'))}}r.push("</ul>");var p=r.join("");i.innerHTML=p,this._parentNode.appendChild(i),e.menuElement=i,i.style["border-radius"]="4px",i.style.display="none",i.style["z-index"]=3e5,i.style.background="white",i.style.border="1px solid black",i.style["box-shadow"]="0 4px 5px 0 gray",i.oncontextmenu=function(e){e.preventDefault()};var v=this,g=null;if(n)for(var m=0,y=n.length;m<y;m++){var _=n[m].items;if(_)for(var b=function(e,n){var r=_[e],i=r.subMenu;if(r.itemElement=t._parentNode.querySelector("#".concat(r.id)),!r.itemElement)return console.error("ContextMenu item element not found: "+r.id),"continue";r.itemElement.addEventListener("mouseenter",(function(e){e.preventDefault();var t=r.subMenu;if(t){if(g&&g.id!==t.id&&(v._hideMenu(g.id),g=null),!1!==r.enabled){var n=r.itemElement,i=t.menuElement,s=n.getBoundingClientRect();i.getBoundingClientRect();var a=v._offsetParent.getBoundingClientRect(),o=200,A=s.right+o<a.right,c=s.left-o>a.left;if(A)v._showMenu(t.id,s.right+window.scrollX-5,s.top+window.scrollY-1);else if(c)v._showMenu(t.id,s.left-o+window.scrollX,s.top+window.scrollY-1);else{var l=s.left-a.left,u=a.right-s.right;u>l?v._showMenu(t.id,s.right-5-(o-u),s.top+window.scrollY-1):v._showMenu(t.id,s.left-l,s.top+window.scrollY-1)}g=t}}else g&&(v._hideMenu(g.id),g=null)})),i||(r.itemElement.addEventListener("click",(function(e){e.preventDefault(),v._context&&!1!==r.enabled&&(r.doAction&&r.doAction(v._context),t._hideOnAction?v.hide():(v._updateItemsTitles(),v._updateItemsEnabledStatus()))})),r.itemElement.addEventListener("mouseup",(function(e){3===e.which&&(e.preventDefault(),v._context&&!1!==r.enabled&&(r.doAction&&r.doAction(v._context),t._hideOnAction?v.hide():(v._updateItemsTitles(),v._updateItemsEnabledStatus())))})),r.itemElement.addEventListener("mouseenter",(function(e){e.preventDefault(),!1!==r.enabled&&r.doHover&&r.doHover(v._context)})))},w=0,B=_.length;w<B;w++)b(w)}}},{key:"_updateItemsTitles",value:function(){if(this._context)for(var e=0,t=this._itemList.length;e<t;e++){var n=this._itemList[e],r=n.itemElement;if(r){var i=n.getShown;if(i&&i(this._context)){var s=n.getTitle(this._context);n.subMenu,r.innerText=s}}}}},{key:"_updateItemsEnabledStatus",value:function(){if(this._context)for(var e=0,t=this._itemList.length;e<t;e++){var n=this._itemList[e],r=n.itemElement;if(r){var i=n.getEnabled;if(i){var s=n.getShown;if(s){var a=s(this._context);if(n.shown=a,a){r.style.display="";var o=i(this._context);n.enabled=o,o?r.classList.remove("disabled"):r.classList.add("disabled")}else r.style.display="none"}}}}}},{key:"_updateSubMenuInfo",value:function(){var e,t,n,r,i,s;this._context&&this._itemList.forEach((function(a){a.subMenu&&(e=a.itemElement,t=e.getBoundingClientRect(),n=a.subMenu.menuElement,r={visibility:n.style.visibility,display:n.style.display},n.style.display="block",n.style.visibility="hidden",s=a.subMenu.menuElement.getBoundingClientRect().width,n.style.visibility=r.visibility,n.style.display=r.display,i=t.right+s>window.innerWidth,e.setAttribute("data-submenuposition",i?"left":"right"))}))}},{key:"_showMenu",value:function(e,t,n){var r=this._menuMap[e];if(r){if(!r.shown){var i=r.menuElement;i&&(this._showMenuElement(i,t,n),r.shown=!0)}}else console.error("Menu not found: "+e)}},{key:"_hideMenu",value:function(e){var t=this._menuMap[e];if(t){if(t.shown){var n=t.menuElement;n&&(this._hideMenuElement(n),t.shown=!1)}}else console.error("Menu not found: "+e)}},{key:"_hideAllMenus",value:function(){for(var e=0,t=this._menuList.length;e<t;e++){var n=this._menuList[e];this._hideMenu(n.id)}}},{key:"_showMenuElement",value:function(e,t,n){e.style.display="block";var r=e.offsetHeight,i=e.offsetWidth,s=this._offsetParent.getBoundingClientRect(),a=this._offsetParent===window.document.body&&0===s.bottom?window.innerHeight:s.bottom+window.scrollY,o=s.right+window.scrollX;n+r>a&&(n=a-r),t+i>o&&(t=o-i),e.style.left=t-s.left-window.scrollX+"px",e.style.top=n-s.top-window.scrollY+"px"}},{key:"_hideMenuElement",value:function(e){e.style.display="none"}}]),e}(),j=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this.viewer=t,this.scene=this.viewer.scene,this._lensCursorDiv=document.createElement("div"),this._lensParams={canvasSize:300,cursorBorder:2,cursorSize:10},this._lensCursorDiv.style.borderRadius="50%",this._lensCursorDiv.style.width=this._lensParams.cursorSize+"px",this._lensCursorDiv.style.height=this._lensParams.cursorSize+"px",this._lensCursorDiv.style.zIndex="100000",this._lensCursorDiv.style.position="absolute",this._lensCursorDiv.style.pointerEvents="none",this._lensContainer=document.createElement("div"),this._lensContainerId=r.containerId||"xeokit-lens",this._lensContainer.setAttribute("id",this._lensContainerId),this._lensContainer.style.border="1px solid black",this._lensContainer.style.background="white",this._lensContainer.style.borderRadius="50%",this._lensContainer.style.width=this._lensParams.canvasSize+"px",this._lensContainer.style.height=this._lensParams.canvasSize+"px",this._lensContainer.style.zIndex="15000",this._lensContainer.style.position="absolute",this._lensContainer.style.pointerEvents="none",this._lensContainer.style.visibility="hidden",this._lensCanvas=document.createElement("canvas"),this._lensCanvas.id="".concat(this._lensContainerId,"-canvas"),this._lensCanvas.style.borderRadius="50%",this._lensCanvas.style.width=this._lensParams.canvasSize+"px",this._lensCanvas.style.height=this._lensParams.canvasSize+"px",this._lensCanvas.style.zIndex="15000",this._lensCanvas.style.pointerEvents="none",document.body.appendChild(this._lensContainer),this._lensContainer.appendChild(this._lensCanvas),this._lensContainer.appendChild(this._lensCursorDiv),this._lensCanvasContext=this._lensCanvas.getContext("2d"),this._canvasElement=this.viewer.scene.canvas.canvas,this._canvasPos=null,this._snappedCanvasPos=null,this._lensPosToggle=r.lensPosToggle||!0,this._lensPosToggleAmount=r.lensPosToggleAmount||85,this._lensPosMarginLeft=r.lensPosMarginLeft||85,this._lensPosMarginTop=r.lensPosMarginTop||25,this._lensContainer.style.marginTop="".concat(this._lensPosMarginTop,"px"),this._lensContainer.style.marginLeft="".concat(this._lensPosMarginLeft,"px"),this._zoomLevel=r.zoomLevel||2,this._active=!1!==r.active,this._visible=!1,this.snapped=!1,this._onViewerRendering=this.viewer.scene.on("rendering",(function(){n._active&&n._visible&&n.update()}))}return I(e,[{key:"update",value:function(){if(this._active&&this._visible&&this._canvasPos){var e=this._lensContainer.getBoundingClientRect(),t=this._canvasElement.getBoundingClientRect(),n=this._canvasPos[0]<e.right&&this._canvasPos[0]>e.left&&this._canvasPos[1]<e.bottom&&this._canvasPos[1]>e.top;this._lensContainer.style.marginLeft="".concat(this._lensPosMarginLeft,"px"),n&&(this._lensPosToggle?this._lensContainer.style.marginTop="".concat(t.bottom-t.top-this._lensCanvas.height-this._lensPosToggleAmount,"px"):this._lensContainer.style.marginTop="".concat(this._lensPosMarginTop,"px"),this._lensPosToggle=!this._lensPosToggle),this._lensCanvasContext.clearRect(0,0,this._lensCanvas.width,this._lensCanvas.height);var r=Math.max(this._lensCanvas.width,this._lensCanvas.height)/this._zoomLevel;this._lensCanvasContext.drawImage(this._canvasElement,this._canvasPos[0]-r/2,this._canvasPos[1]-r/2,r,r,0,0,this._lensCanvas.width,this._lensCanvas.height);var i=this._lensParams.canvasSize/2-this._lensParams.cursorSize/2-this._lensParams.cursorBorder,s=this._snappedCanvasPos?this._snappedCanvasPos[0]-this._canvasPos[0]:0,a=this._snappedCanvasPos?this._snappedCanvasPos[1]-this._canvasPos[1]:0;this._lensCursorDiv.style.left="".concat(i+s*this._zoomLevel,"px"),this._lensCursorDiv.style.top="".concat(i+a*this._zoomLevel,"px")}}},{key:"zoomFactor",get:function(){return this._zoomFactor},set:function(e){this._zoomFactor=e,this.update()}},{key:"canvasPos",get:function(){return this._canvasPos},set:function(e){this._canvasPos=e,this.update()}},{key:"snappedCanvasPos",get:function(){return this._snappedCanvasPos},set:function(e){this._snappedCanvasPos=e,this.update()}},{key:"snapped",get:function(){return this._snapped},set:function(e){this._snapped=e;var t=k(e?["greenyellow","green"]:["pink","red"],2),n=t[0],r=t[1];this._lensCursorDiv.style.background=n,this._lensCursorDiv.style.border=this._lensParams.cursorBorder+"px solid "+r}},{key:"_updateActiveVisible",value:function(){this._lensContainer.style.visibility=this._active&&this._visible?"visible":"hidden",this.update()}},{key:"active",get:function(){return this._active},set:function(e){this._active=e,this._updateActiveVisible()}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=e,this._updateActiveVisible()}},{key:"destroy",value:function(){this._destroyed||(this.viewer.scene.off(this._onViewerRendering),this._lensContainer.removeChild(this._lensCanvas),document.body.removeChild(this._lensContainer),this._destroyed=!0)}}]),e}();function W(e,t){var n,r,i,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,a=t&&t.length,o=a?t[0]*s:e.length,A=z(e,0,o,s,!0),c=[];if(!A||A.next===A.prev)return c;if(a&&(A=$(e,t,A,s)),e.length>80*s){n=1/0,r=1/0;for(var l=-1/0,u=-1/0,h=s;h<o;h+=s){var d=e[h],f=e[h+1];d<n&&(n=d),f<r&&(r=f),d>l&&(l=d),f>u&&(u=f)}i=0!==(i=Math.max(l-n,u-r))?32767/i:0}return K(A,c,s,n,r,i,0),c}function z(e,t,n,r,i){var s;if(i===function(e,t,n,r){for(var i=0,s=t,a=n-r;s<n;s+=r)i+=(e[a]-e[s])*(e[s+1]+e[a+1]),a=s;return i}(e,t,n,r)>0)for(var a=t;a<n;a+=r)s=pe(a/r|0,e[a],e[a+1],s);else for(var o=n-r;o>=t;o-=r)s=pe(o/r|0,e[o],e[o+1],s);return s&&ce(s,s.next)&&(ve(s),s=s.next),s}function X(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!ce(r,r.next)&&0!==Ae(r.prev,r,r.next))r=r.next;else{if(ve(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function K(e,t,n,r,i,s,a){if(e){!a&&s&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=re(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n=1;do{var r=e,i=void 0;e=null;var s=null;for(t=0;r;){t++;for(var a=r,o=0,A=0;A<n&&(o++,a=a.nextZ);A++);for(var c=n;o>0||c>0&&a;)0!==o&&(0===c||!a||r.z<=a.z)?(i=r,r=r.nextZ,o--):(i=a,a=a.nextZ,c--),s?s.nextZ=i:e=i,i.prevZ=s,s=i;r=a}s.nextZ=null,n*=2}while(t>1)}(i)}(e,r,i,s);for(var o=e;e.prev!==e.next;){var A=e.prev,c=e.next;if(s?J(e,r,i,s):Z(e))t.push(A.i,e.i,c.i),ve(e),e=c.next,o=c.next;else if((e=c)===o){a?1===a?K(e=Y(X(e),t),t,n,r,i,s,2):2===a&&q(e,t,n,r,i,s):K(X(e),t,n,r,i,s,1);break}}}}function Z(e){var t=e.prev,n=e,r=e.next;if(Ae(t,n,r)>=0)return!1;for(var i=t.x,s=n.x,a=r.x,o=t.y,A=n.y,c=r.y,l=Math.min(i,s,a),u=Math.min(o,A,c),h=Math.max(i,s,a),d=Math.max(o,A,c),f=r.next;f!==t;){if(f.x>=l&&f.x<=h&&f.y>=u&&f.y<=d&&ae(i,o,s,A,a,c,f.x,f.y)&&Ae(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function J(e,t,n,r){var i=e.prev,s=e,a=e.next;if(Ae(i,s,a)>=0)return!1;for(var o=i.x,A=s.x,c=a.x,l=i.y,u=s.y,h=a.y,d=Math.min(o,A,c),f=Math.min(l,u,h),p=Math.max(o,A,c),v=Math.max(l,u,h),g=re(d,f,t,n,r),m=re(p,v,t,n,r),y=e.prevZ,_=e.nextZ;y&&y.z>=g&&_&&_.z<=m;){if(y.x>=d&&y.x<=p&&y.y>=f&&y.y<=v&&y!==i&&y!==a&&ae(o,l,A,u,c,h,y.x,y.y)&&Ae(y.prev,y,y.next)>=0)return!1;if(y=y.prevZ,_.x>=d&&_.x<=p&&_.y>=f&&_.y<=v&&_!==i&&_!==a&&ae(o,l,A,u,c,h,_.x,_.y)&&Ae(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;y&&y.z>=g;){if(y.x>=d&&y.x<=p&&y.y>=f&&y.y<=v&&y!==i&&y!==a&&ae(o,l,A,u,c,h,y.x,y.y)&&Ae(y.prev,y,y.next)>=0)return!1;y=y.prevZ}for(;_&&_.z<=m;){if(_.x>=d&&_.x<=p&&_.y>=f&&_.y<=v&&_!==i&&_!==a&&ae(o,l,A,u,c,h,_.x,_.y)&&Ae(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Y(e,t){var n=e;do{var r=n.prev,i=n.next.next;!ce(r,i)&&le(r,n,n.next,i)&&de(r,i)&&de(i,r)&&(t.push(r.i,n.i,i.i),ve(n),ve(n.next),n=e=i),n=n.next}while(n!==e);return X(n)}function q(e,t,n,r,i,s){var a=e;do{for(var o=a.next.next;o!==a.prev;){if(a.i!==o.i&&oe(a,o)){var A=fe(a,o);return a=X(a,a.next),A=X(A,A.next),K(a,t,n,r,i,s,0),void K(A,t,n,r,i,s,0)}o=o.next}a=a.next}while(a!==e)}function $(e,t,n,r){for(var i=[],s=0,a=t.length;s<a;s++){var o=z(e,t[s]*r,s<a-1?t[s+1]*r:e.length,r,!1);o===o.next&&(o.steiner=!0),i.push(ie(o))}i.sort(ee);for(var A=0;A<i.length;A++)n=te(i[A],n);return n}function ee(e,t){var n=e.x-t.x;0===n&&(0===(n=e.y-t.y)&&(n=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)));return n}function te(e,t){var n=function(e,t){var n,r=t,i=e.x,s=e.y,a=-1/0;if(ce(e,r))return r;do{if(ce(e,r.next))return r.next;if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var o=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(o<=i&&o>a&&(a=o,n=r.x<r.next.x?r:r.next,o===i))return n}r=r.next}while(r!==t);if(!n)return null;var A=n,c=n.x,l=n.y,u=1/0;r=n;do{if(i>=r.x&&r.x>=c&&i!==r.x&&se(s<l?i:a,s,c,l,s<l?a:i,s,r.x,r.y)){var h=Math.abs(s-r.y)/(i-r.x);de(r,e)&&(h<u||h===u&&(r.x>n.x||r.x===n.x&&ne(n,r)))&&(n=r,u=h)}r=r.next}while(r!==A);return n}(e,t);if(!n)return t;var r=fe(n,e);return X(r,r.next),X(n,n.next)}function ne(e,t){return Ae(e.prev,e,t.prev)<0&&Ae(t.next,e,e.next)<0}function re(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ie(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function se(e,t,n,r,i,s,a,o){return(i-a)*(t-o)>=(e-a)*(s-o)&&(e-a)*(r-o)>=(n-a)*(t-o)&&(n-a)*(s-o)>=(i-a)*(r-o)}function ae(e,t,n,r,i,s,a,o){return!(e===a&&t===o)&&se(e,t,n,r,i,s,a,o)}function oe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&le(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(de(e,t)&&de(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Ae(e.prev,e,t.prev)||Ae(e,t.prev,t))||ce(e,t)&&Ae(e.prev,e,e.next)>0&&Ae(t.prev,t,t.next)>0)}function Ae(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function ce(e,t){return e.x===t.x&&e.y===t.y}function le(e,t,n,r){var i=he(Ae(e,t,n)),s=he(Ae(e,t,r)),a=he(Ae(n,r,e)),o=he(Ae(n,r,t));return i!==s&&a!==o||(!(0!==i||!ue(e,n,t))||(!(0!==s||!ue(e,r,t))||(!(0!==a||!ue(n,e,r))||!(0!==o||!ue(n,t,r)))))}function ue(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function he(e){return e>0?1:e<0?-1:0}function de(e,t){return Ae(e.prev,e,e.next)<0?Ae(e,t,e.next)>=0&&Ae(e,e.prev,t)>=0:Ae(e,t,e.prev)<0||Ae(e,e.next,t)<0}function fe(e,t){var n=ge(e.i,e.x,e.y),r=ge(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function pe(e,t,n,r){var i=ge(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function ve(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ge(e,t,n){return{i:e,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}var me,ye,_e,be,we,Be,Ce,Me,ke,Ee,Fe,xe=!0,Ue=xe?Float64Array:Float32Array,Ie=new Ue(3),Te=new Ue(16),Pe=new Ue(16),Se=new Ue(4),De={setDoublePrecisionEnabled:function(e){Ue=(xe=e)?Float64Array:Float32Array},getDoublePrecisionEnabled:function(){return xe},MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,MAX_INT:1e7,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId:function(e,t){var n=t.indexOf("#");return n===e.length&&t.startsWith(e)?t.substring(n+1):t},globalizeObjectId:function(e,t){return e+"#"+t},safeInv:function(e){var t=1/e;return isNaN(t)||!isFinite(t)?1:t},vec2:function(e){return new Ue(e||2)},vec3:function(e){return new Ue(e||3)},vec4:function(e){return new Ue(e||4)},mat3:function(e){return new Ue(e||9)},mat3ToMat4:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ue(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},mat4:function(e){return new Ue(e||16)},mat4ToMat3:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Ue(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},doublesToFloats:function(e,t,n){for(var r=new Ue(2),i=0,s=e.length;i<s;i++)De.splitDouble(e[i],r),t[i]=r[0],n[i]=r[1]},splitDouble:function(e,t){var n=Ue.from([e])[0],r=e-n;t[0]=n,t[1]=r},createUUID:function(){for(var e=[],t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return function(){var t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return"".concat(e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255],"-").concat(e[255&n]).concat(e[n>>8&255],"-").concat(e[n>>16&15|64]).concat(e[n>>24&255],"-").concat(e[63&r|128]).concat(e[r>>8&255],"-").concat(e[r>>16&255]).concat(e[r>>24&255]).concat(e[255&i]).concat(e[i>>8&255]).concat(e[i>>16&255]).concat(e[i>>24&255])}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},fmod:function(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},compareVec3:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},compareVec4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},negateVec3:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},negateVec4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},addVec4:function(e,t,n){return n||(n=e),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n},addVec4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n[3]=e[3]+t,n},addVec3:function(e,t,n){return n||(n=e),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n},addVec3Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n},subVec4:function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n},subVec3:function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n},subVec2:function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n},geometricMeanVec2:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=new Ue(t[0]),i=1;i<t.length;i++)r[0]+=t[i][0],r[1]+=t[i][1];return r[0]/=t.length,r[1]/=t.length,r},subVec4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]-t,n[3]=e[3]-t,n},subScalarVec4:function(e,t,n){return n||(n=e),n[0]=t-e[0],n[1]=t-e[1],n[2]=t-e[2],n[3]=t-e[3],n},mulVec4:function(e,t,n){return n||(n=e),n[0]=e[0]*t[0],n[1]=e[1]*t[1],n[2]=e[2]*t[2],n[3]=e[3]*t[3],n},mulVec4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n},mulVec3Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n},mulVec2Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n},divVec3:function(e,t,n){return n||(n=e),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n},divVec4:function(e,t,n){return n||(n=e),n[0]=e[0]/t[0],n[1]=e[1]/t[1],n[2]=e[2]/t[2],n[3]=e[3]/t[3],n},divScalarVec3:function(e,t,n){return n||(n=t),n[0]=e/t[0],n[1]=e/t[1],n[2]=e/t[2],n},divVec3Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n},divVec4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]/t,n[1]=e[1]/t,n[2]=e[2]/t,n[3]=e[3]/t,n},divScalarVec4:function(e,t,n){return n||(n=t),n[0]=e/t[0],n[1]=e/t[1],n[2]=e/t[2],n[3]=e/t[3],n},dotVec4:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},cross3Vec4:function(e,t){var n=e[0],r=e[1],i=e[2],s=t[0],a=t[1],o=t[2];return[r*o-i*a,i*s-n*o,n*a-r*s,0]},cross3Vec3:function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],a=t[0],o=t[1],A=t[2];return n[0]=i*A-s*o,n[1]=s*a-r*A,n[2]=r*o-i*a,n},sqLenVec4:function(e){return De.dotVec4(e,e)},lenVec4:function(e){return Math.sqrt(De.sqLenVec4(e))},dotVec3:function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},dotVec2:function(e,t){return e[0]*t[0]+e[1]*t[1]},sqLenVec3:function(e){return De.dotVec3(e,e)},sqLenVec2:function(e){return De.dotVec2(e,e)},lenVec3:function(e){return Math.sqrt(De.sqLenVec3(e))},distVec3:(Fe=new Ue(3),function(e,t){return De.lenVec3(De.subVec3(e,t,Fe))}),lenVec2:function(e){return Math.sqrt(De.sqLenVec2(e))},distVec2:function(){var e=new Ue(2);return function(t,n){return De.lenVec2(De.subVec2(t,n,e))}}(),rcpVec3:function(e,t){return De.divScalarVec3(1,e,t)},normalizeVec4:function(e,t){var n=1/De.lenVec4(e);return De.mulVec4Scalar(e,n,t)},normalizeVec3:function(e,t){var n=1/De.lenVec3(e);return De.mulVec3Scalar(e,n,t)},normalizeVec2:function(e,t){var n=1/De.lenVec2(e);return De.mulVec2Scalar(e,n,t)},angleVec3:function(e,t){var n=De.dotVec3(e,t)/Math.sqrt(De.sqLenVec3(e)*De.sqLenVec3(t));return n=n<-1?-1:n>1?1:n,Math.acos(n)},vec3FromMat4Scale:function(){var e=new Ue(3);return function(t,n){return e[0]=t[0],e[1]=t[1],e[2]=t[2],n[0]=De.lenVec3(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],n[1]=De.lenVec3(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],n[2]=De.lenVec3(e),n}}(),vecToArray:function(){function e(e){return Math.round(1e5*e)/1e5}return function(t){for(var n=0,r=(t=Array.prototype.slice.call(t)).length;n<r;n++)t[n]=e(t[n]);return t}}(),xyzArrayToObject:function(e){return{x:e[0],y:e[1],z:e[2]}},xyzObjectToArray:function(e,t){return(t=t||De.vec3())[0]=e.x,t[1]=e.y,t[2]=e.z,t},dupMat4:function(e){return e.slice(0,16)},mat4To3:function(e){return[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]]},m4s:function(e){return[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]},setMat4ToZeroes:function(){return De.m4s(0)},setMat4ToOnes:function(){return De.m4s(1)},diagonalMat4v:function(e){return new Ue([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]])},diagonalMat4c:function(e,t,n,r){return De.diagonalMat4v([e,t,n,r])},diagonalMat4s:function(e){return De.diagonalMat4c(e,e,e,e)},identityMat4:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ue(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},identityMat3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Ue(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},isIdentityMat4:function(e){return 1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15]},negateMat4:function(e,t){return t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},addMat4:function(e,t,n){return n||(n=e),n[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n[3]=e[3]+t[3],n[4]=e[4]+t[4],n[5]=e[5]+t[5],n[6]=e[6]+t[6],n[7]=e[7]+t[7],n[8]=e[8]+t[8],n[9]=e[9]+t[9],n[10]=e[10]+t[10],n[11]=e[11]+t[11],n[12]=e[12]+t[12],n[13]=e[13]+t[13],n[14]=e[14]+t[14],n[15]=e[15]+t[15],n},addMat4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]+t,n[1]=e[1]+t,n[2]=e[2]+t,n[3]=e[3]+t,n[4]=e[4]+t,n[5]=e[5]+t,n[6]=e[6]+t,n[7]=e[7]+t,n[8]=e[8]+t,n[9]=e[9]+t,n[10]=e[10]+t,n[11]=e[11]+t,n[12]=e[12]+t,n[13]=e[13]+t,n[14]=e[14]+t,n[15]=e[15]+t,n},addScalarMat4:function(e,t,n){return De.addMat4Scalar(t,e,n)},subMat4:function(e,t,n){return n||(n=e),n[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n[3]=e[3]-t[3],n[4]=e[4]-t[4],n[5]=e[5]-t[5],n[6]=e[6]-t[6],n[7]=e[7]-t[7],n[8]=e[8]-t[8],n[9]=e[9]-t[9],n[10]=e[10]-t[10],n[11]=e[11]-t[11],n[12]=e[12]-t[12],n[13]=e[13]-t[13],n[14]=e[14]-t[14],n[15]=e[15]-t[15],n},subMat4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]-t,n[1]=e[1]-t,n[2]=e[2]-t,n[3]=e[3]-t,n[4]=e[4]-t,n[5]=e[5]-t,n[6]=e[6]-t,n[7]=e[7]-t,n[8]=e[8]-t,n[9]=e[9]-t,n[10]=e[10]-t,n[11]=e[11]-t,n[12]=e[12]-t,n[13]=e[13]-t,n[14]=e[14]-t,n[15]=e[15]-t,n},subScalarMat4:function(e,t,n){return n||(n=t),n[0]=e-t[0],n[1]=e-t[1],n[2]=e-t[2],n[3]=e-t[3],n[4]=e-t[4],n[5]=e-t[5],n[6]=e-t[6],n[7]=e-t[7],n[8]=e-t[8],n[9]=e-t[9],n[10]=e-t[10],n[11]=e-t[11],n[12]=e-t[12],n[13]=e-t[13],n[14]=e-t[14],n[15]=e-t[15],n},mulMat4:function(e,t,n){n||(n=e);var r=e[0],i=e[1],s=e[2],a=e[3],o=e[4],A=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],v=e[13],g=e[14],m=e[15],y=t[0],_=t[1],b=t[2],w=t[3],B=t[4],C=t[5],M=t[6],k=t[7],E=t[8],F=t[9],x=t[10],U=t[11],I=t[12],T=t[13],P=t[14],S=t[15];return n[0]=y*r+_*o+b*u+w*p,n[1]=y*i+_*A+b*h+w*v,n[2]=y*s+_*c+b*d+w*g,n[3]=y*a+_*l+b*f+w*m,n[4]=B*r+C*o+M*u+k*p,n[5]=B*i+C*A+M*h+k*v,n[6]=B*s+C*c+M*d+k*g,n[7]=B*a+C*l+M*f+k*m,n[8]=E*r+F*o+x*u+U*p,n[9]=E*i+F*A+x*h+U*v,n[10]=E*s+F*c+x*d+U*g,n[11]=E*a+F*l+x*f+U*m,n[12]=I*r+T*o+P*u+S*p,n[13]=I*i+T*A+P*h+S*v,n[14]=I*s+T*c+P*d+S*g,n[15]=I*a+T*l+P*f+S*m,n},mulMat3:function(e,t,n){n||(n=new Ue(9));var r=e[0],i=e[3],s=e[6],a=e[1],o=e[4],A=e[7],c=e[2],l=e[5],u=e[8],h=t[0],d=t[3],f=t[6],p=t[1],v=t[4],g=t[7],m=t[2],y=t[5],_=t[8];return n[0]=r*h+i*p+s*m,n[3]=r*d+i*v+s*y,n[6]=r*f+i*g+s*_,n[1]=a*h+o*p+A*m,n[4]=a*d+o*v+A*y,n[7]=a*f+o*g+A*_,n[2]=c*h+l*p+u*m,n[5]=c*d+l*v+u*y,n[8]=c*f+l*g+u*_,n},mulMat4Scalar:function(e,t,n){return n||(n=e),n[0]=e[0]*t,n[1]=e[1]*t,n[2]=e[2]*t,n[3]=e[3]*t,n[4]=e[4]*t,n[5]=e[5]*t,n[6]=e[6]*t,n[7]=e[7]*t,n[8]=e[8]*t,n[9]=e[9]*t,n[10]=e[10]*t,n[11]=e[11]*t,n[12]=e[12]*t,n[13]=e[13]*t,n[14]=e[14]*t,n[15]=e[15]*t,n},mulMat4v4:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec4(),r=t[0],i=t[1],s=t[2],a=t[3];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12]*a,n[1]=e[1]*r+e[5]*i+e[9]*s+e[13]*a,n[2]=e[2]*r+e[6]*i+e[10]*s+e[14]*a,n[3]=e[3]*r+e[7]*i+e[11]*s+e[15]*a,n},transposeMat4:function(e,t){var n=e[4],r=e[14],i=e[8],s=e[13],a=e[12],o=e[9];if(!t||e===t){var A=e[1],c=e[2],l=e[3],u=e[6],h=e[7],d=e[11];return e[1]=n,e[2]=i,e[3]=a,e[4]=A,e[6]=o,e[7]=s,e[8]=c,e[9]=u,e[11]=r,e[12]=l,e[13]=h,e[14]=d,e}return t[0]=e[0],t[1]=n,t[2]=i,t[3]=a,t[4]=e[1],t[5]=e[5],t[6]=o,t[7]=s,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=r,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3:function(e,t){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4:function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],A=e[7],c=e[8],l=e[9],u=e[10],h=e[11],d=e[12],f=e[13],p=e[14],v=e[15];return d*l*o*i-c*f*o*i-d*a*u*i+s*f*u*i+c*a*p*i-s*l*p*i-d*l*r*A+c*f*r*A+d*n*u*A-t*f*u*A-c*n*p*A+t*l*p*A+d*a*r*h-s*f*r*h-d*n*o*h+t*f*o*h+s*n*p*h-t*a*p*h-c*a*r*v+s*l*r*v+c*n*o*v-t*l*o*v-s*n*u*v+t*a*u*v},inverseMat4:function(e,t){t||(t=e);var n=e[0],r=e[1],i=e[2],s=e[3],a=e[4],o=e[5],A=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],v=e[14],g=e[15],m=n*o-r*a,y=n*A-i*a,_=n*c-s*a,b=r*A-i*o,w=r*c-s*o,B=i*c-s*A,C=l*p-u*f,M=l*v-h*f,k=l*g-d*f,E=u*v-h*p,F=u*g-d*p,x=h*g-d*v,U=1/(m*x-y*F+_*E+b*k-w*M+B*C);return t[0]=(o*x-A*F+c*E)*U,t[1]=(-r*x+i*F-s*E)*U,t[2]=(p*B-v*w+g*b)*U,t[3]=(-u*B+h*w-d*b)*U,t[4]=(-a*x+A*k-c*M)*U,t[5]=(n*x-i*k+s*M)*U,t[6]=(-f*B+v*_-g*y)*U,t[7]=(l*B-h*_+d*y)*U,t[8]=(a*F-o*k+c*C)*U,t[9]=(-n*F+r*k-s*C)*U,t[10]=(f*w-p*_+g*m)*U,t[11]=(-l*w+u*_-d*m)*U,t[12]=(-a*E+o*M-A*C)*U,t[13]=(n*E-r*M+i*C)*U,t[14]=(-f*b+p*y-v*m)*U,t[15]=(l*b-u*y+h*m)*U,t},traceMat4:function(e){return e[0]+e[5]+e[10]+e[15]},translationMat4v:function(e,t){var n=t||De.identityMat4();return n[12]=e[0],n[13]=e[1],n[14]=e[2],n},translationMat3v:function(e,t){var n=t||De.identityMat3();return n[6]=e[0],n[7]=e[1],n},translationMat4c:(Ee=new Ue(3),function(e,t,n,r){return Ee[0]=e,Ee[1]=t,Ee[2]=n,De.translationMat4v(Ee,r)}),translationMat4s:function(e,t){return De.translationMat4c(e,e,e,t)},translateMat4v:function(e,t){return De.translateMat4c(e[0],e[1],e[2],t)},translateMat4c:function(e,t,n,r){var i=r[3];r[0]+=i*e,r[1]+=i*t,r[2]+=i*n;var s=r[7];r[4]+=s*e,r[5]+=s*t,r[6]+=s*n;var a=r[11];r[8]+=a*e,r[9]+=a*t,r[10]+=a*n;var o=r[15];return r[12]+=o*e,r[13]+=o*t,r[14]+=o*n,r},setMat4Translation:function(e,t,n){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=e[15],n},rotationMat4v:function(e,t,n){var r,i,s,a,o,A,c=De.normalizeVec4([t[0],t[1],t[2],0],[]),l=Math.sin(e),u=Math.cos(e),h=1-u,d=c[0],f=c[1],p=c[2];return r=d*f,i=f*p,s=p*d,a=d*l,o=f*l,A=p*l,(n=n||De.mat4())[0]=h*d*d+u,n[1]=h*r+A,n[2]=h*s-o,n[3]=0,n[4]=h*r-A,n[5]=h*f*f+u,n[6]=h*i+a,n[7]=0,n[8]=h*s+o,n[9]=h*i-a,n[10]=h*p*p+u,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},rotationMat4c:function(e,t,n,r,i){return De.rotationMat4v(e,[t,n,r],i)},scalingMat4v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.identityMat4();return t[0]=e[0],t[5]=e[1],t[10]=e[2],t},scalingMat3v:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.identityMat3();return t[0]=e[0],t[4]=e[1],t},scalingMat4c:function(){var e=new Ue(3);return function(t,n,r,i){return e[0]=t,e[1]=n,e[2]=r,De.scalingMat4v(e,i)}}(),scaleMat4c:function(e,t,n,r){return r[0]*=e,r[4]*=t,r[8]*=n,r[1]*=e,r[5]*=t,r[9]*=n,r[2]*=e,r[6]*=t,r[10]*=n,r[3]*=e,r[7]*=t,r[11]*=n,r},scaleMat4v:function(e,t){var n=e[0],r=e[1],i=e[2];return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,t},scalingMat4s:function(e){return De.scalingMat4c(e,e,e)},rotationTranslationMat4:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.mat4(),r=e[0],i=e[1],s=e[2],a=e[3],o=r+r,A=i+i,c=s+s,l=r*o,u=r*A,h=r*c,d=i*A,f=i*c,p=s*c,v=a*o,g=a*A,m=a*c;return n[0]=1-(d+p),n[1]=u+m,n[2]=h-g,n[3]=0,n[4]=u-m,n[5]=1-(l+p),n[6]=f+v,n[7]=0,n[8]=h+g,n[9]=f-v,n[10]=1-(l+d),n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},mat4ToEuler:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec4(),r=De.clamp,i=e[0],s=e[4],a=e[8],o=e[1],A=e[5],c=e[9],l=e[2],u=e[6],h=e[10];return"XYZ"===t?(n[1]=Math.asin(r(a,-1,1)),Math.abs(a)<.99999?(n[0]=Math.atan2(-c,h),n[2]=Math.atan2(-s,i)):(n[0]=Math.atan2(u,A),n[2]=0)):"YXZ"===t?(n[0]=Math.asin(-r(c,-1,1)),Math.abs(c)<.99999?(n[1]=Math.atan2(a,h),n[2]=Math.atan2(o,A)):(n[1]=Math.atan2(-l,i),n[2]=0)):"ZXY"===t?(n[0]=Math.asin(r(u,-1,1)),Math.abs(u)<.99999?(n[1]=Math.atan2(-l,h),n[2]=Math.atan2(-s,A)):(n[1]=0,n[2]=Math.atan2(o,i))):"ZYX"===t?(n[1]=Math.asin(-r(l,-1,1)),Math.abs(l)<.99999?(n[0]=Math.atan2(u,h),n[2]=Math.atan2(o,i)):(n[0]=0,n[2]=Math.atan2(-s,A))):"YZX"===t?(n[2]=Math.asin(r(o,-1,1)),Math.abs(o)<.99999?(n[0]=Math.atan2(-c,A),n[1]=Math.atan2(-l,i)):(n[0]=0,n[1]=Math.atan2(a,h))):"XZY"===t&&(n[2]=Math.asin(-r(s,-1,1)),Math.abs(s)<.99999?(n[0]=Math.atan2(u,A),n[1]=Math.atan2(a,i)):(n[0]=Math.atan2(-c,h),n[1]=0)),n[0]*=De.RADTODEG,n[1]*=De.RADTODEG,n[2]*=De.RADTODEG,n},composeMat4:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:De.mat4();return De.quaternionToRotationMat4(t,r),De.scaleMat4v(n,r),De.translateMat4v(e,r),r},decomposeMat4:function(){var e=new Ue(3),t=new Ue(16);return function(n,r,i,s){e[0]=n[0],e[1]=n[1],e[2]=n[2];var a=De.lenVec3(e);e[0]=n[4],e[1]=n[5],e[2]=n[6];var o=De.lenVec3(e);e[0]=n[8],e[1]=n[9],e[2]=n[10];var A=De.lenVec3(e);De.determinantMat4(n)<0&&(a=-a),r[0]=n[12],r[1]=n[13],r[2]=n[14],t.set(n);var c=1/a,l=1/o,u=1/A;return t[0]*=c,t[1]*=c,t[2]*=c,t[4]*=l,t[5]*=l,t[6]*=l,t[8]*=u,t[9]*=u,t[10]*=u,De.mat4ToQuaternion(t,i),s[0]=a,s[1]=o,s[2]=A,this}}(),getColMat4:function(e,t){var n=4*t;return[e[n],e[n+1],e[n+2],e[n+3]]},setRowMat4:function(e,t,n){e[t]=n[0],e[t+4]=n[1],e[t+8]=n[2],e[t+12]=n[3]},lookAtMat4v:function(e,t,n,r){r||(r=De.mat4());var i,s,a,o,A,c,l,u,h,d,f=e[0],p=e[1],v=e[2],g=n[0],m=n[1],y=n[2],_=t[0],b=t[1],w=t[2];return f===_&&p===b&&v===w?De.identityMat4():(i=f-_,s=p-b,a=v-w,o=m*(a*=d=1/Math.sqrt(i*i+s*s+a*a))-y*(s*=d),A=y*(i*=d)-g*a,c=g*s-m*i,(d=Math.sqrt(o*o+A*A+c*c))?(o*=d=1/d,A*=d,c*=d):(o=0,A=0,c=0),l=s*c-a*A,u=a*o-i*c,h=i*A-s*o,(d=Math.sqrt(l*l+u*u+h*h))?(l*=d=1/d,u*=d,h*=d):(l=0,u=0,h=0),r[0]=o,r[1]=l,r[2]=i,r[3]=0,r[4]=A,r[5]=u,r[6]=s,r[7]=0,r[8]=c,r[9]=h,r[10]=a,r[11]=0,r[12]=-(o*f+A*p+c*v),r[13]=-(l*f+u*p+h*v),r[14]=-(i*f+s*p+a*v),r[15]=1,r)},lookAtMat4c:function(e,t,n,r,i,s,a,o,A){return De.lookAtMat4v([e,t,n],[r,i,s],[a,o,A],[])},orthoMat4c:function(e,t,n,r,i,s,a){a||(a=De.mat4());var o=t-e,A=r-n,c=s-i;return a[0]=2/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/A,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=-2/c,a[11]=0,a[12]=-(e+t)/o,a[13]=-(r+n)/A,a[14]=-(s+i)/c,a[15]=1,a},frustumMat4v:function(e,t,n){n||(n=De.mat4());var r=[e[0],e[1],e[2],0],i=[t[0],t[1],t[2],0];De.addVec4(i,r,Te),De.subVec4(i,r,Pe);var s=2*r[2],a=Pe[0],o=Pe[1],A=Pe[2];return n[0]=s/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=s/o,n[6]=0,n[7]=0,n[8]=Te[0]/a,n[9]=Te[1]/o,n[10]=-Te[2]/A,n[11]=-1,n[12]=0,n[13]=0,n[14]=-s*i[2]/A,n[15]=0,n},frustumMat4:function(e,t,n,r,i,s,a){a||(a=De.mat4());var o=t-e,A=r-n,c=s-i;return a[0]=2*i/o,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*i/A,a[6]=0,a[7]=0,a[8]=(t+e)/o,a[9]=(r+n)/A,a[10]=-(s+i)/c,a[11]=-1,a[12]=0,a[13]=0,a[14]=-s*i*2/c,a[15]=0,a},perspectiveMat4:function(e,t,n,r,i){var s=[],a=[];return s[2]=n,a[2]=r,a[1]=s[2]*Math.tan(e/2),s[1]=-a[1],a[0]=a[1]*t,s[0]=-a[0],De.frustumMat4v(s,a,i)},compareMat4:function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]},transformPoint3:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec3(),r=t[0],i=t[1],s=t[2];return n[0]=e[0]*r+e[4]*i+e[8]*s+e[12],n[1]=e[1]*r+e[5]*i+e[9]*s+e[13],n[2]=e[2]*r+e[6]*i+e[10]*s+e[14],n},transformPoint4:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec4();return n[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],n[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],n[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],n[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],n},transformPoints3:function(e,t,n){for(var r,i,s,a,o,A=n||[],c=t.length,l=e[0],u=e[1],h=e[2],d=e[3],f=e[4],p=e[5],v=e[6],g=e[7],m=e[8],y=e[9],_=e[10],b=e[11],w=e[12],B=e[13],C=e[14],M=e[15],k=0;k<c;++k)r=(a=t[k])[0],i=a[1],s=a[2],(o=A[k]||(A[k]=[0,0,0]))[0]=l*r+f*i+m*s+w,o[1]=u*r+p*i+y*s+B,o[2]=h*r+v*i+_*s+C,o[3]=d*r+g*i+b*s+M;return A.length=c,A},transformPositions3:function(e,t){var n,r,i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,o=t.length,A=e[0],c=e[1],l=e[2];e[3];var u=e[4],h=e[5],d=e[6];e[7];var f=e[8],p=e[9],v=e[10];e[11];var g=e[12],m=e[13],y=e[14];for(e[15],n=0;n<o;n+=3)r=t[n+0],i=t[n+1],s=t[n+2],a[n+0]=A*r+u*i+f*s+g,a[n+1]=c*r+h*i+p*s+m,a[n+2]=l*r+d*i+v*s+y;return a},transformPositions4:function(e,t){var n,r,i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,o=t.length,A=e[0],c=e[1],l=e[2],u=e[3],h=e[4],d=e[5],f=e[6],p=e[7],v=e[8],g=e[9],m=e[10],y=e[11],_=e[12],b=e[13],w=e[14],B=e[15];for(n=0;n<o;n+=4)r=t[n+0],i=t[n+1],s=t[n+2],a[n+0]=A*r+h*i+v*s+_,a[n+1]=c*r+d*i+g*s+b,a[n+2]=l*r+f*i+m*s+w,a[n+3]=u*r+p*i+y*s+B;return a},transformVec3:function(e,t,n){var r=t[0],i=t[1],s=t[2];return(n=n||this.vec3())[0]=e[0]*r+e[4]*i+e[8]*s,n[1]=e[1]*r+e[5]*i+e[9]*s,n[2]=e[2]*r+e[6]*i+e[10]*s,n},transformVec4:function(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3];return(n=n||De.vec4())[0]=e[0]*r+e[4]*i+e[8]*s+e[12]*a,n[1]=e[1]*r+e[5]*i+e[9]*s+e[13]*a,n[2]=e[2]*r+e[6]*i+e[10]*s+e[14]*a,n[3]=e[3]*r+e[7]*i+e[11]*s+e[15]*a,n},rotateVec2:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,i=Math.cos(n),s=Math.sin(n),a=e[0]-t[0],o=e[1]-t[1];return r[0]=a*i-o*s+t[0],r[1]=a*s+o*i+t[1],e},rotateVec3X:function(e,t,n,r){var i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0],s[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),s[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r},rotateVec3Y:function(e,t,n,r){var i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),s[1]=i[1],s[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r},rotateVec3Z:function(e,t,n,r){var i=[],s=[];return i[0]=e[0]-t[0],i[1]=e[1]-t[1],i[2]=e[2]-t[2],s[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),s[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),s[2]=i[2],r[0]=s[0]+t[0],r[1]=s[1]+t[1],r[2]=s[2]+t[2],r},projectVec4:function(e,t){var n=1/e[3];return(t=t||De.vec2())[0]=e[0]*n,t[1]=e[1]*n,t},unprojectVec3:(Ce=new Ue(16),Me=new Ue(16),ke=new Ue(16),function(e,t,n,r){return this.transformVec3(this.mulMat4(this.inverseMat4(t,Ce),this.inverseMat4(n,Me),ke),e,r)}),lerpVec3:function(e,t,n,r,i,s){var a=s||De.vec3(),o=(e-t)/(n-t);return a[0]=r[0]+o*(i[0]-r[0]),a[1]=r[1]+o*(i[1]-r[1]),a[2]=r[2]+o*(i[2]-r[2]),a},lerpMat4:function(e,t,n,r,i,s){var a=s||De.mat4(),o=(e-t)/(n-t);return a[0]=r[0]+o*(i[0]-r[0]),a[1]=r[1]+o*(i[1]-r[1]),a[2]=r[2]+o*(i[2]-r[2]),a[3]=r[3]+o*(i[3]-r[3]),a[4]=r[4]+o*(i[4]-r[4]),a[5]=r[5]+o*(i[5]-r[5]),a[6]=r[6]+o*(i[6]-r[6]),a[7]=r[7]+o*(i[7]-r[7]),a[8]=r[8]+o*(i[8]-r[8]),a[9]=r[9]+o*(i[9]-r[9]),a[10]=r[10]+o*(i[10]-r[10]),a[11]=r[11]+o*(i[11]-r[11]),a[12]=r[12]+o*(i[12]-r[12]),a[13]=r[13]+o*(i[13]-r[13]),a[14]=r[14]+o*(i[14]-r[14]),a[15]=r[15]+o*(i[15]-r[15]),a},flatten:function(e){var t,n,r,i,s,a=[];for(t=0,n=e.length;t<n;t++)for(r=0,i=(s=e[t]).length;r<i;r++)a.push(s[r]);return a},identityQuaternion:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:De.vec4();return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e},eulerToQuaternion:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec4(),r=e[0]*De.DEGTORAD/2,i=e[1]*De.DEGTORAD/2,s=e[2]*De.DEGTORAD/2,a=Math.cos(r),o=Math.cos(i),A=Math.cos(s),c=Math.sin(r),l=Math.sin(i),u=Math.sin(s);return"XYZ"===t?(n[0]=c*o*A+a*l*u,n[1]=a*l*A-c*o*u,n[2]=a*o*u+c*l*A,n[3]=a*o*A-c*l*u):"YXZ"===t?(n[0]=c*o*A+a*l*u,n[1]=a*l*A-c*o*u,n[2]=a*o*u-c*l*A,n[3]=a*o*A+c*l*u):"ZXY"===t?(n[0]=c*o*A-a*l*u,n[1]=a*l*A+c*o*u,n[2]=a*o*u+c*l*A,n[3]=a*o*A-c*l*u):"ZYX"===t?(n[0]=c*o*A-a*l*u,n[1]=a*l*A+c*o*u,n[2]=a*o*u-c*l*A,n[3]=a*o*A+c*l*u):"YZX"===t?(n[0]=c*o*A+a*l*u,n[1]=a*l*A+c*o*u,n[2]=a*o*u-c*l*A,n[3]=a*o*A-c*l*u):"XZY"===t&&(n[0]=c*o*A-a*l*u,n[1]=a*l*A-c*o*u,n[2]=a*o*u+c*l*A,n[3]=a*o*A+c*l*u),n},mat4ToQuaternion:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec4(),r=e[0],i=e[4],s=e[8],a=e[1],o=e[5],A=e[9],c=e[2],l=e[6],u=e[10],h=r+o+u;return h>0?(t=.5/Math.sqrt(h+1),n[3]=.25/t,n[0]=(l-A)*t,n[1]=(s-c)*t,n[2]=(a-i)*t):r>o&&r>u?(t=2*Math.sqrt(1+r-o-u),n[3]=(l-A)/t,n[0]=.25*t,n[1]=(i+a)/t,n[2]=(s+c)/t):o>u?(t=2*Math.sqrt(1+o-r-u),n[3]=(s-c)/t,n[0]=(i+a)/t,n[1]=.25*t,n[2]=(A+l)/t):(t=2*Math.sqrt(1+u-r-o),n[3]=(a-i)/t,n[0]=(s+c)/t,n[1]=(A+l)/t,n[2]=.25*t),n},vec3PairToQuaternion:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec4(),r=Math.sqrt(De.dotVec3(e,e)*De.dotVec3(t,t)),i=r+De.dotVec3(e,t);return i<1e-8*r?(i=0,Math.abs(e[0])>Math.abs(e[2])?(n[0]=-e[1],n[1]=e[0],n[2]=0):(n[0]=0,n[1]=-e[2],n[2]=e[1])):De.cross3Vec3(e,t,n),n[3]=i,De.normalizeQuaternion(n)},angleAxisToQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec4(),n=e[3]/2,r=Math.sin(n);return t[0]=r*e[0],t[1]=r*e[1],t[2]=r*e[2],t[3]=Math.cos(n),t},quaternionToEuler:function(){var e=new Ue(16);return function(t,n,r){return r=r||De.vec3(),De.quaternionToRotationMat4(t,e),De.mat4ToEuler(e,n,r),r}}(),mulQuaternions:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec4(),r=e[0],i=e[1],s=e[2],a=e[3],o=t[0],A=t[1],c=t[2],l=t[3];return n[0]=a*o+r*l+i*c-s*A,n[1]=a*A+i*l+s*o-r*c,n[2]=a*c+s*l+r*A-i*o,n[3]=a*l-r*o-i*A-s*c,n},vec3ApplyQuaternion:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:De.vec3(),r=t[0],i=t[1],s=t[2],a=e[0],o=e[1],A=e[2],c=e[3],l=c*r+o*s-A*i,u=c*i+A*r-a*s,h=c*s+a*i-o*r,d=-a*r-o*i-A*s;return n[0]=l*c+d*-a+u*-A-h*-o,n[1]=u*c+d*-o+h*-a-l*-A,n[2]=h*c+d*-A+l*-o-u*-a,n},quaternionToMat4:function(e,t){t=De.identityMat4(t);var n=e[0],r=e[1],i=e[2],s=e[3],a=2*n,o=2*r,A=2*i,c=a*s,l=o*s,u=A*s,h=a*n,d=o*n,f=A*n,p=o*r,v=A*r,g=A*i;return t[0]=1-(p+g),t[1]=d+u,t[2]=f-l,t[4]=d-u,t[5]=1-(h+g),t[6]=v+c,t[8]=f+l,t[9]=v-c,t[10]=1-(h+p),t},quaternionToRotationMat4:function(e,t){var n=e[0],r=e[1],i=e[2],s=e[3],a=n+n,o=r+r,A=i+i,c=n*a,l=n*o,u=n*A,h=r*o,d=r*A,f=i*A,p=s*a,v=s*o,g=s*A;return t[0]=1-(h+f),t[4]=l-g,t[8]=u+v,t[1]=l+g,t[5]=1-(c+f),t[9]=d-p,t[2]=u-v,t[6]=d+p,t[10]=1-(c+h),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e,n=De.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n,t[3]=e[3]/n,t},conjugateQuaternion:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},inverseQuaternion:function(e,t){return De.normalizeQuaternion(De.conjugateQuaternion(e,t))},quaternionToAngleAxis:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec4(),n=(e=De.normalizeQuaternion(e,Se))[3],r=2*Math.acos(n),i=Math.sqrt(1-n*n);return i<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i),t[3]=r,t},AABB3:function(e){return new Ue(e||6)},AABB2:function(e){return new Ue(e||4)},OBB3:function(e){return new Ue(e||32)},OBB2:function(e){return new Ue(e||16)},Sphere3:function(e,t,n,r){return new Ue([e,t,n,r])},transformOBB3:function(e,t){var n,r,i,s,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t,o=t.length,A=e[0],c=e[1],l=e[2],u=e[3],h=e[4],d=e[5],f=e[6],p=e[7],v=e[8],g=e[9],m=e[10],y=e[11],_=e[12],b=e[13],w=e[14],B=e[15];for(n=0;n<o;n+=4)r=t[n+0],i=t[n+1],s=t[n+2],a[n+0]=A*r+h*i+v*s+_,a[n+1]=c*r+d*i+g*s+b,a[n+2]=l*r+f*i+m*s+w,a[n+3]=u*r+p*i+y*s+B;return a},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3);return function(r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5],De.subVec3(t,e,n),Math.abs(De.lenVec3(n))}}(),getAABB3DiagPoint:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3);return function(r,i){e[0]=r[0],e[1]=r[1],e[2]=r[2],t[0]=r[3],t[1]=r[4],t[2]=r[5];var s=De.subVec3(t,e,n),a=i[0]-r[0],o=r[3]-i[0],A=i[1]-r[1],c=r[4]-i[1],l=i[2]-r[2],u=r[5]-i[2];return s[0]+=a>o?a:o,s[1]+=A>c?A:c,s[2]+=l>u?l:u,Math.abs(De.lenVec3(s))}}(),getAABB3Area:function(e){return(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2])},getAABB3Center:function(e,t){var n=t||De.vec3();return n[0]=(e[0]+e[3])/2,n[1]=(e[1]+e[4])/2,n[2]=(e[2]+e[5])/2,n},getAABB2Center:function(e,t){var n=t||De.vec2();return n[0]=(e[2]+e[0])/2,n[1]=(e[3]+e[1])/2,n},collapseAABB3:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:De.AABB3();return e[0]=De.MAX_DOUBLE,e[1]=De.MAX_DOUBLE,e[2]=De.MAX_DOUBLE,e[3]=De.MIN_DOUBLE,e[4]=De.MIN_DOUBLE,e[5]=De.MIN_DOUBLE,e},AABB3ToOBB3:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.OBB3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t},positions3ToAABB3:function(){var e=new Ue(3);return function(t,n,r){n=n||De.AABB3();for(var i,s,a,o=De.MAX_DOUBLE,A=De.MAX_DOUBLE,c=De.MAX_DOUBLE,l=De.MIN_DOUBLE,u=De.MIN_DOUBLE,h=De.MIN_DOUBLE,d=0,f=t.length;d<f;d+=3)r?(e[0]=t[d+0],e[1]=t[d+1],e[2]=t[d+2],De.decompressPosition(e,r,e),i=e[0],s=e[1],a=e[2]):(i=t[d+0],s=t[d+1],a=t[d+2]),i<o&&(o=i),s<A&&(A=s),a<c&&(c=a),i>l&&(l=i),s>u&&(u=s),a>h&&(h=a);return n[0]=o,n[1]=A,n[2]=c,n[3]=l,n[4]=u,n[5]=h,n}}(),OBB3ToAABB3:function(e){for(var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.AABB3(),s=De.MAX_DOUBLE,a=De.MAX_DOUBLE,o=De.MAX_DOUBLE,A=De.MIN_DOUBLE,c=De.MIN_DOUBLE,l=De.MIN_DOUBLE,u=0,h=e.length;u<h;u+=4)(t=e[u+0])<s&&(s=t),(n=e[u+1])<a&&(a=n),(r=e[u+2])<o&&(o=r),t>A&&(A=t),n>c&&(c=n),r>l&&(l=r);return i[0]=s,i[1]=a,i[2]=o,i[3]=A,i[4]=c,i[5]=l,i},points3ToAABB3:function(e){for(var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.AABB3(),s=De.MAX_DOUBLE,a=De.MAX_DOUBLE,o=De.MAX_DOUBLE,A=De.MIN_DOUBLE,c=De.MIN_DOUBLE,l=De.MIN_DOUBLE,u=0,h=e.length;u<h;u++)(t=e[u][0])<s&&(s=t),(n=e[u][1])<a&&(a=n),(r=e[u][2])<o&&(o=r),t>A&&(A=t),n>c&&(c=n),r>l&&(l=r);return i[0]=s,i[1]=a,i[2]=o,i[3]=A,i[4]=c,i[5]=l,i},points3ToSphere3:function(){var e=new Ue(3);return function(t,n){n=n||De.vec4();var r,i=0,s=0,a=0,o=t.length;for(r=0;r<o;r++)i+=t[r][0],s+=t[r][1],a+=t[r][2];n[0]=i/o,n[1]=s/o,n[2]=a/o;var A,c=0;for(r=0;r<o;r++)(A=Math.abs(De.lenVec3(De.subVec3(t[r],n,e))))>c&&(c=A);return n[3]=c,n}}(),positions3ToSphere3:function(){var e=new Ue(3),t=new Ue(3);return function(n,r){r=r||De.vec4();var i,s=0,a=0,o=0,A=n.length,c=0;for(i=0;i<A;i+=3)s+=n[i],a+=n[i+1],o+=n[i+2];var l,u=A/3;for(r[0]=s/u,r[1]=a/u,r[2]=o/u,i=0;i<A;i+=3)e[0]=n[i],e[1]=n[i+1],e[2]=n[i+2],(l=Math.abs(De.lenVec3(De.subVec3(e,r,t))))>c&&(c=l);return r[3]=c,r}}(),OBB3ToSphere3:function(){var e=new Ue(3),t=new Ue(3);return function(n,r){r=r||De.vec4();var i,s=0,a=0,o=0,A=n.length,c=A/4;for(i=0;i<A;i+=4)s+=n[i+0],a+=n[i+1],o+=n[i+2];r[0]=s/c,r[1]=a/c,r[2]=o/c;var l,u=0;for(i=0;i<A;i+=4)e[0]=n[i+0],e[1]=n[i+1],e[2]=n[i+2],(l=Math.abs(De.lenVec3(De.subVec3(e,r,t))))>u&&(u=l);return r[3]=u,r}}(),getSphere3Center:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec3();return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},getPositionsCenter:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec3(),n=0,r=0,i=0,s=0,a=e.length;s<a;s+=3)n+=e[s+0],r+=e[s+1],i+=e[s+2];var o=e.length/3;return t[0]=n/o,t[1]=r/o,t[2]=i/o,t},expandAABB3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e},expandAABB3Point3:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e},expandAABB3Points3:function(e,t){for(var n,r,i,s=0,a=t.length;s<a;s+=3)n=t[s],r=t[s+1],i=t[s+2],e[0]>n&&(e[0]=n),e[1]>r&&(e[1]=r),e[2]>i&&(e[2]=i),e[3]<n&&(e[3]=n),e[4]<r&&(e[4]=r),e[5]<i&&(e[5]=i);return e},collapseAABB2:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:De.AABB2();return e[0]=De.MAX_DOUBLE,e[1]=De.MAX_DOUBLE,e[2]=De.MIN_DOUBLE,e[3]=De.MIN_DOUBLE,e},point3AABB3Intersect:function(e,t){return e[0]>t[0]||e[3]<t[0]||e[1]>t[1]||e[4]<t[1]||e[2]>t[2]||e[5]<t[2]},point3AABB3AbsoluteIntersect:function(e,t){return e[0]<=t[0]&&e[3]>=t[0]&&e[1]<=t[1]&&e[4]>=t[1]&&e[2]<=t[2]&&e[5]>=t[2]},planeAABB3Intersect:function(e,t,n){var r,i;return e[0]>0?(r=e[0]*n[0],i=e[0]*n[3]):(r=e[0]*n[3],i=e[0]*n[0]),e[1]>0?(r+=e[1]*n[1],i+=e[1]*n[4]):(r+=e[1]*n[4],i+=e[1]*n[1]),e[2]>0?(r+=e[2]*n[2],i+=e[2]*n[5]):(r+=e[2]*n[5],i+=e[2]*n[2]),r<=-t&&i<=-t?-1:r>=-t&&i>=-t?1:0},OBB3ToAABB2:function(e){for(var t,n,r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.AABB2(),s=De.MAX_DOUBLE,a=De.MAX_DOUBLE,o=De.MIN_DOUBLE,A=De.MIN_DOUBLE,c=0,l=e.length;c<l;c+=4)t=e[c+0],n=e[c+1],(t*=r=1/(e[c+3]||1))<s&&(s=t),(n*=r)<a&&(a=n),t>o&&(o=t),n>A&&(A=n);return i[0]=s,i[1]=a,i[2]=o,i[3]=A,i},expandAABB2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e},expandAABB2Point2:function(e,t){return e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1]),e},AABB2ToCanvas:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,i=.5*(e[0]+1),s=.5*(e[1]+1),a=.5*(e[2]+1),o=.5*(e[3]+1);return r[0]=Math.floor(i*t),r[1]=n-Math.floor(o*n),r[2]=Math.floor(a*t),r[3]=n-Math.floor(s*n),r},tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentQuadraticBezier3:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},catmullRomInterpolate:function(e,t,n,r,i){var s=.5*(n-e),a=.5*(r-t),o=i*i;return(2*t-2*n+s+a)*(i*o)+(-3*t+3*n-2*s-a)*o+s*i+t},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)},triangleNormal:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:De.vec3(),i=t[0]-e[0],s=t[1]-e[1],a=t[2]-e[2],o=n[0]-e[0],A=n[1]-e[1],c=n[2]-e[2],l=s*c-a*A,u=a*o-i*c,h=i*A-s*o,d=Math.sqrt(l*l+u*u+h*h);return 0===d?(r[0]=0,r[1]=0,r[2]=0):(r[0]=l/d,r[1]=u/d,r[2]=h/d),r},rayTriangleIntersect:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3),r=new Ue(3),i=new Ue(3);return function(s,a,o,A,c,l){l=l||De.vec3();var u=De.subVec3(A,o,e),h=De.subVec3(c,o,t),d=De.cross3Vec3(a,h,n),f=De.dotVec3(u,d);if(f<1e-6)return null;var p=De.subVec3(s,o,r),v=De.dotVec3(p,d);if(v<0||v>f)return null;var g=De.cross3Vec3(p,u,i),m=De.dotVec3(a,g);if(m<0||v+m>f)return null;var y=De.dotVec3(h,g)/f;return l[0]=s[0]+y*a[0],l[1]=s[1]+y*a[1],l[2]=s[2]+y*a[2],l}}(),rayPlaneIntersect:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3),r=new Ue(3);return function(i,s,a,o,A,c){c=c||De.vec3(),s=De.normalizeVec3(s,e);var l=De.subVec3(o,a,t),u=De.subVec3(A,a,n),h=De.cross3Vec3(l,u,r);De.normalizeVec3(h,h);var d=-De.dotVec3(a,h),f=-(De.dotVec3(i,h)+d)/De.dotVec3(s,h);return c[0]=i[0]+f*s[0],c[1]=i[1]+f*s[1],c[2]=i[2]+f*s[2],c}}(),cartesianToBarycentric:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3);return function(r,i,s,a,o){var A=De.subVec3(a,i,e),c=De.subVec3(s,i,t),l=De.subVec3(r,i,n),u=De.dotVec3(A,A),h=De.dotVec3(A,c),d=De.dotVec3(A,l),f=De.dotVec3(c,c),p=De.dotVec3(c,l),v=u*f-h*h;if(0===v)return null;var g=1/v,m=(f*d-h*p)*g,y=(u*p-h*d)*g;return o[0]=1-m-y,o[1]=y,o[2]=m,o}}(),barycentricInsideTriangle:function(e){var t=e[1],n=e[2];return n>=0&&t>=0&&n+t<1},barycentricToCartesian:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:De.vec3(),s=e[0],a=e[1],o=e[2];return i[0]=t[0]*s+n[0]*a+r[0]*o,i[1]=t[1]*s+n[1]*a+r[1]*o,i[2]=t[2]*s+n[2]*a+r[2]*o,i},mergeVertices:function(e,t,n,r){var i,s,a,o,A,c,l={},u=[],h=[],d=t?[]:null,f=n?[]:null,p=[],v=Math.pow(10,4),g=0;for(A=0,c=e.length;A<c;A+=3)i=e[A],s=e[A+1],a=e[A+2],void 0===l[o="".concat(Math.round(i*v),"_").concat(Math.round(s*v),"_").concat(Math.round(a*v))]&&(l[o]=h.length/3,h.push(i),h.push(s),h.push(a),t&&(d.push(t[A]),d.push(t[A+1]),d.push(t[A+2])),n&&(f.push(n[g]),f.push(n[g+1]))),u[A/3]=l[o],g+=2;for(A=0,c=r.length;A<c;A++)p[A]=u[r[A]];var m={positions:h,indices:p};return d&&(m.normals=d),f&&(m.uv=f),m},buildNormals:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3),r=new Ue(3),i=new Ue(3),s=new Ue(3);return function(a,o,A){var c,l,u,h,d,f,p,v,g,m=new Array(a.length/3);for(c=0,l=o.length;c<l;c+=3){u=o[c],h=o[c+1],d=o[c+2],e[0]=a[3*u],e[1]=a[3*u+1],e[2]=a[3*u+2],t[0]=a[3*h],t[1]=a[3*h+1],t[2]=a[3*h+2],n[0]=a[3*d],n[1]=a[3*d+1],n[2]=a[3*d+2],De.subVec3(t,e,r),De.subVec3(n,e,i);var y=De.vec3();De.normalizeVec3(De.cross3Vec3(r,i,s),y),m[u]||(m[u]=[]),m[h]||(m[h]=[]),m[d]||(m[d]=[]),m[u].push(y),m[h].push(y),m[d].push(y)}for(A=A&&A.length===a.length?A:new Float32Array(a.length),c=0,l=m.length;c<l;c++){f=m[c].length,p=0,v=0,g=0;for(var _=0;_<f;_++)p+=m[c][_][0],v+=m[c][_][1],g+=m[c][_][2];A[3*c]=p/f,A[3*c+1]=v/f,A[3*c+2]=g/f}return A}}(),buildTangents:function(){var e=new Ue(3),t=new Ue(3),n=new Ue(3),r=new Ue(3),i=new Ue(3),s=new Ue(3),a=new Ue(3);return function(o,A,c){for(var l=new Float32Array(o.length),u=0;u<A.length;u+=3){var h=A[u],d=o.subarray(3*h,3*h+3),f=c.subarray(2*h,2*h+2);h=A[u+1];var p=o.subarray(3*h,3*h+3),v=c.subarray(2*h,2*h+2);h=A[u+2];for(var g=o.subarray(3*h,3*h+3),m=c.subarray(2*h,2*h+2),y=De.subVec3(p,d,e),_=De.subVec3(g,d,t),b=De.subVec2(v,f,n),w=De.subVec2(m,f,r),B=1/(b[0]*w[1]-b[1]*w[0]),C=De.mulVec3Scalar(De.subVec3(De.mulVec3Scalar(y,w[1],i),De.mulVec3Scalar(_,b[1],s),a),B,s),M=void 0,k=0;k<3;k++)l[M=3*A[u+k]]+=C[0],l[M+1]+=C[1],l[M+2]+=C[2]}return l}}(),buildPickTriangles:function(e,t,n){for(var r,i,s,a,o,A=t.length,c=n?new Uint16Array(9*A):new Float32Array(9*A),l=new Uint8Array(12*A),u=0,h=0,d=0,f=0;f<A;f+=3)o=u>>24&255,a=u>>16&255,s=u>>8&255,i=255&u,r=3*t[f],c[h++]=e[r],c[h++]=e[r+1],c[h++]=e[r+2],l[d++]=i,l[d++]=s,l[d++]=a,l[d++]=o,r=3*t[f+1],c[h++]=e[r],c[h++]=e[r+1],c[h++]=e[r+2],l[d++]=i,l[d++]=s,l[d++]=a,l[d++]=o,r=3*t[f+2],c[h++]=e[r],c[h++]=e[r+1],c[h++]=e[r+2],l[d++]=i,l[d++]=s,l[d++]=a,l[d++]=o,u++;return{positions:c,colors:l}},faceToVertexNormals:function(e,t){var n,r,i,s,a,o,A,c,l,u,h,d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=d.smoothNormalsAngleThreshold||20,p={},v=[],g={},m=4,y=Math.pow(10,m);for(A=0,l=e.length;A<l;A+=3){o=A/3,r=e[A],i=e[A+1],s=e[A+2],void 0===p[a="".concat(Math.round(r*y),"_").concat(Math.round(i*y),"_").concat(Math.round(s*y))]?p[a]=[o]:p[a].push(o);var _=De.normalizeVec3([t[A],t[A+1],t[A+2]]);v[o]=_,n=De.vec4([_[0],_[1],_[2],1]),g[o]=n}for(a in p)if(p.hasOwnProperty(a)){var b=p[a],w=b.length;for(A=0;A<w;A++){var B=b[A];for(n=g[B],c=0;c<w;c++)if(A!==c){var C=b[c];u=v[B],h=v[C];var M=Math.abs(De.angleVec3(u,h)/De.DEGTORAD);M<f&&(n[0]+=h[0],n[1]+=h[1],n[2]+=h[2],n[3]+=1)}}}for(A=0,l=t.length;A<l;A+=3)n=g[A/3],t[A+0]=n[0]/n[3],t[A+1]=n[1]/n[3],t[A+2]=n[2]/n[3]},transformRay:function(){var e=new Ue(4),t=new Ue(4);return function(n,r,i,s,a){e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=1,De.transformVec4(n,e,t),s[0]=t[0],s[1]=t[1],s[2]=t[2],e[0]=i[0],e[1]=i[1],e[2]=i[2],De.transformVec3(n,e,t),De.normalizeVec3(t),a[0]=t[0],a[1]=t[1],a[2]=t[2]}}(),canvasPosToWorldRay:(_e=new Ue(16),be=new Ue(4),we=new Ue(4),Be=function(e,t,n,r,i){i[0]=e,i[1]=t,i[2]=n,i[3]=1,De.transformVec4(_e,i,i),r||De.mulVec4Scalar(i,1/i[3])},function(e,t,n,r,i,s,a){var o="ortho"===r;De.mulMat4(n,t,_e),De.inverseMat4(_e,_e);var A=2*i[0]/e.clientWidth-1,c=1-2*i[1]/e.clientHeight;Be(A,c,-1,o,be),Be(A,c,1,o,we),s[0]=be[0],s[1]=be[1],s[2]=be[2],De.subVec3(we,be,a),De.normalizeVec3(a)}),canvasPosToLocalRay:(me=new Ue(3),ye=new Ue(3),function(e,t,n,r,i,s,a,o){De.canvasPosToWorldRay(e,t,n,r,s,me,ye),De.worldRayToLocalRay(i,me,ye,a,o)}),worldRayToLocalRay:function(){var e=new Ue(16),t=new Ue(4),n=new Ue(4);return function(r,i,s,a,o){var A=De.inverseMat4(r,e);t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=1,De.transformVec4(A,t,n),a[0]=n[0],a[1]=n[1],a[2]=n[2],De.transformVec3(A,s,o)}}(),buildKDTree:function(){var e=new Float32Array;function t(n,r,i,s){var a,o,A=new Ue(6),c={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:A};for(A[0]=A[1]=A[2]=Number.POSITIVE_INFINITY,A[3]=A[4]=A[5]=Number.NEGATIVE_INFINITY,a=0,o=n.length;a<o;++a)for(var l=3*n[a],u=0;u<3;++u){var h=3*r[l+u];i[h]<A[0]&&(A[0]=i[h]),i[h]>A[3]&&(A[3]=i[h]),i[h+1]<A[1]&&(A[1]=i[h+1]),i[h+1]>A[4]&&(A[4]=i[h+1]),i[h+2]<A[2]&&(A[2]=i[h+2]),i[h+2]>A[5]&&(A[5]=i[h+2])}if(n.length<20||s>10)return c.triangles=n,c.leaf=!0,c;e[0]=A[3]-A[0],e[1]=A[4]-A[1],e[2]=A[5]-A[2];var d=0;e[1]>e[d]&&(d=1),e[2]>e[d]&&(d=2),c.splitDim=d;var f=(A[d]+A[d+3])/2,p=new Array(n.length),v=0,g=new Array(n.length),m=0;for(a=0,o=n.length;a<o;++a){var y=r[l=3*n[a]],_=3*r[l+1],b=3*r[l+2];i[3*y+d]<=f||i[_+d]<=f||i[b+d]<=f?p[v++]=n[a]:g[m++]=n[a]}return p.length=v,g.length=m,c.left=t(p,r,i,s+1),c.right=t(g,r,i,s+1),c}return function(e,n){for(var r=e.length/3,i=new Array(r),s=0;s<r;++s)i[s]=s;return t(i,e,n,0)}}(),decompressPosition:function(e,t,n){(n=n||e)[0]=e[0]*t[0]+t[12],n[1]=e[1]*t[5]+t[13],n[2]=e[2]*t[10]+t[14]},decompressPositions:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),r=0,i=e.length;r<i;r+=3)n[r+0]=e[r+0]*t[0]+t[12],n[r+1]=e[r+1]*t[5]+t[13],n[r+2]=e[r+2]*t[10]+t[14];return n},decompressUV:function(e,t,n){n[0]=e[0]*t[0]+t[6],n[1]=e[1]*t[4]+t[7]},decompressUVs:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),r=0,i=e.length;r<i;r+=3)n[r+0]=e[r+0]*t[0]+t[6],n[r+1]=e[r+1]*t[4]+t[7];return n},octDecodeVec2:function(e,t){var n=e[0],r=e[1];n=(2*n+1)/255,r=(2*r+1)/255;var i=1-Math.abs(n)-Math.abs(r);i<0&&(n=(1-Math.abs(r))*(n>=0?1:-1),r=(1-Math.abs(n))*(r>=0?1:-1));var s=Math.sqrt(n*n+r*r+i*i);return t[0]=n/s,t[1]=r/s,t[2]=i/s,t},octDecodeVec2s:function(e,t){for(var n=0,r=0,i=e.length;n<i;n+=2){var s=e[n+0],a=e[n+1];s=(2*s+1)/255,a=(2*a+1)/255;var o=1-Math.abs(s)-Math.abs(a);o<0&&(s=(1-Math.abs(a))*(s>=0?1:-1),a=(1-Math.abs(s))*(a>=0?1:-1));var A=Math.sqrt(s*s+a*a+o*o);t[r+0]=s/A,t[r+1]=a/A,t[r+2]=o/A,r+=3}return t}};De.buildEdgeIndices=function(){var e=[],t=[],n=[],r=[],i=[],s=0,a=new Uint16Array(3),o=new Uint16Array(3),A=new Uint16Array(3),c=De.vec3(),l=De.vec3(),u=De.vec3(),h=De.vec3(),d=De.vec3(),f=De.vec3(),p=De.vec3();return function(v,g,m,y){!function(i,s){var a,o,A,c,l,u,h={},d=Math.pow(10,4),f=0;for(l=0,u=i.length;l<u;l+=3)a=i[l],o=i[l+1],A=i[l+2],void 0===h[c=Math.round(a*d)+"_"+Math.round(o*d)+"_"+Math.round(A*d)]&&(h[c]=f/3,e[f++]=a,e[f++]=o,e[f++]=A),t[l/3]=h[c];for(l=0,u=s.length;l<u;l++)r[l]=t[s[l]],n[r[l]]=s[l]}(v,g),function(t,n){s=0;for(var v=0,g=t;v<g;v+=3){var m=3*r[v],y=3*r[v+1],_=3*r[v+2];n?(a[0]=e[m],a[1]=e[m+1],a[2]=e[m+2],o[0]=e[y],o[1]=e[y+1],o[2]=e[y+2],A[0]=e[_],A[1]=e[_+1],A[2]=e[_+2],De.decompressPosition(a,n,c),De.decompressPosition(o,n,l),De.decompressPosition(A,n,u)):(c[0]=e[m],c[1]=e[m+1],c[2]=e[m+2],l[0]=e[y],l[1]=e[y+1],l[2]=e[y+2],u[0]=e[_],u[1]=e[_+1],u[2]=e[_+2]),De.subVec3(u,l,h),De.subVec3(c,l,d),De.cross3Vec3(h,d,f),De.normalizeVec3(f,p);var b=i[s]||(i[s]={normal:De.vec3()});b.normal[0]=p[0],b.normal[1]=p[1],b.normal[2]=p[2],s++}}(g.length,m);for(var _,b,w,B,C,M,k,E,F,x,U=[],I=Math.cos(De.DEGTORAD*y),T={},P=!1,S=0,D=g.length;S<D;S+=3)for(var Q=S/3,R=0;R<3;R++)_=r[S+R],b=r[S+(R+1)%3],void 0===T[C=(w=Math.min(_,b))+","+(B=Math.max(_,b))]?T[C]={index1:w,index2:B,face1:Q,face2:void 0}:T[C].face2=Q;for(C in T)void 0!==(M=T[C]).face2&&(k=i[M.face1].normal,E=i[M.face2].normal,De.dotVec3(k,E)>I)||(F=n[M.index1],x=n[M.index2],(!P&&F>65535||x>65535)&&(P=!0),U.push(F),U.push(x));return P?new Uint32Array(U):new Uint16Array(U)}}(),De.planeClipsPositions3=function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,i=0,s=n.length;i<s;i+=r){Ie[0]=n[i+0]-e[0],Ie[1]=n[i+1]-e[1],Ie[2]=n[i+2]-e[2];var a=Ie[0]*t[0]+Ie[1]*t[1]+Ie[2]*t[2];if(a<0)return!0}return!1},De.planeIntersectsAABB3=function(e,t){for(var n=[t[0],t[1],t[2]],r=[t[3],t[4],t[5]],i=!1,s=!1,a=0,o=[[n[0],n[1],n[2]],[r[0],n[1],n[2]],[n[0],r[1],n[2]],[r[0],r[1],n[2]],[n[0],n[1],r[2]],[r[0],n[1],r[2]],[n[0],r[1],r[2]],[r[0],r[1],r[2]]];a<o.length;a++){var A=o[a],c=e.dist+De.dotVec3(e.dir,A);if(c>0&&(i=!0),c<0&&(s=!0),i&&s)return!0}return!1},De.makeSectionPlaneSlicer=function(){var e=De.vec2(),t=De.vec2(),n=De.vec2(),r=De.vec2(),i=De.vec3(),s=De.vec3(),a=De.vec3();De.vec3();var o,A=[De.vec3(),De.vec3(),De.vec3()],c=[null,null,null],l=[null,null,null],u=[null,null,null],h=[1,0,0],d=[0,1,0],f=[0,0,1],p=(o=De.vec3(),function(e,t){return De.sqLenVec3(De.subVec3(e,t,o))}),v=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},g=function(e,t,n){return(n[1]-e[1])*(t[0]-e[0])>(t[1]-e[1])*(n[0]-e[0])};return function(o){var m=De.vec3ApplyQuaternion(o.quaternion,h,De.vec3()),y=De.vec3ApplyQuaternion(o.quaternion,d,De.vec3()),_=De.vec3ApplyQuaternion(o.quaternion,f,De.vec3());return function(h){for(var d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},f=De.subVec3(h.origin,o.pos,De.vec3()),b=De.dotVec3(_,f),w=[],B=[null],C=function(e,t){var n=B.length,r=new Float64Array(5);return r.set(e),t&&(De.addVec3(f,e,i),r[3]=-De.dotVec3(m,i),r[4]=De.dotVec3(y,i)),B.push(r),n},M=function(e,t){var n=B[e];return t[0]=n[3],t[1]=n[4],t},E=function(i,s){var a=i.boundingBox,o=s.boundingBox;if(a[0]<o[0]||a[1]<o[1]||a[2]>o[2]||a[3]>o[3])return!1;for(var A=i.endPoints,c=s.endPoints,l=0,u=A.length-1;l<A.length;u=l++){for(var h=M(A[l],e),d=k(h,2),f=d[0],p=d[1],v=M(A[u],t),m=!1,y=0,_=c.length-1;y<c.length;_=y++){var b=M(c[y],n),w=M(c[_],r);if(g(h,b,w)!==g(v,b,w)&&g(h,v,b)!==g(h,v,w))return!1;var B=k(b,2),C=B[0],E=B[1],F=k(w,2),x=F[0],U=F[1],I=f-C,T=p-E,P=x-C,S=U-E,D=(0!==P||0!==S)&&Math.abs(P*T-S*I)<1e-10?I*P+T*S:-1;if(D>=0&&D<=Math.pow(P,2)+Math.pow(S,2))return!1;E>p!=U>p&&I<T*P/S&&(m=!m)}if(!m)return!1}return!0},F={indices:[],normals:[]},x=!d.onlyPosSliceWithUV&&{indices:[],normals:[]},U=function(e,t,n){if(e){var r=B[t[0]];n||(n=De.normalizeVec3(De.cross3Vec3(De.subVec3(B[t[1]],r,i),De.subVec3(B[t[2]],r,s),i),i));for(var a=0;a<3;++a)e.indices.push(t[a]),e.normals.push(n[0],n[1],n[2])}},I=function(e,t){var n=3*h.indices[e];return t[0]=h.positions[n+0],t[1]=h.positions[n+1],t[2]=h.positions[n+2],t},T=0;T<h.indices.length;T+=3){var P=I(T+0,A[0]),S=I(T+1,A[1]),D=I(T+2,A[2]);if(!(De.compareVec3(P,S)||De.compareVec3(S,D)||De.compareVec3(D,P))){var Q=b+De.dotVec3(_,P),R=b+De.dotVec3(_,S),O=b+De.dotVec3(_,D);if(0!==Q||0!==R||0!==O){var V=Q*R<=0&&C(De.lerpVec3(Q/(Q-R),0,1,P,S,i),!0),L=R*O<=0&&C(De.lerpVec3(R/(R-O),0,1,S,D,i),!0),H=O*Q<=0&&C(De.lerpVec3(O/(O-Q),0,1,D,P,i),!0),N=!d.onlyPosSliceWithUV&&l;if(N&&(N[0]=C(P),N[1]=C(S),N[2]=C(D)),V?L||H:L&&H){if(w.push(V?[V,L||H]:[L,H]),N)if(0===Q&&0===R)U(O>0?F:x,N);else if(0===Q&&0===O)U(R>0?F:x,N);else if(0===R&&0===O)U(Q>0?F:x,N);else{var G=(V?Q:R)>0,j=G?F:x,z=G?x:F,X=c;X[0]=V,X[1]=L,X[2]=H;var K=u;V?(K[0]=0,K[1]=1,K[2]=2):(K[0]=1,K[1]=2,K[2]=0),X[K[1]]?(U(j,[N[K[0]],X[K[0]],N[K[2]]]),U(j,[X[K[0]],X[K[1]],N[K[2]]]),U(z,[X[K[0]],N[K[1]],X[K[1]]])):(U(j,[N[K[0]],X[K[0]],X[K[2]]]),U(z,[X[K[0]],N[K[1]],N[K[2]]]),U(z,[X[K[0]],N[K[2]],X[K[2]]]))}}else N&&(Q>=0&&R>=0&&O>=0?U(F,N):Q<=0&&R<=0&&O<=0&&U(x,N))}}}for(var Z=[];w.length>0;){Z.push([w[0][0],w[0][1]]);var J=Z[Z.length-1];w.splice(0,1);for(var Y=function(){var e=B[J[J.length-1]],t={distSq:p(B[J[0]],e),idx:-1,side:-1};if(w.forEach((function(n,r){var i=p(B[n[0]],e),s=p(B[n[1]],e),a=Math.min(i,s);t.distSq>a&&(t.distSq=a,t.idx=r,t.side=s<i?1:0)})),!(t.distSq<1e-20))return Z.pop(),"break";var n=t.idx>=0&&w[t.idx];if(B[n?n[t.side]:J[0]]=e,!n)return"break";w.splice(t.idx,1);var r=n[1-t.side];if(!(p(B[r],B[J[0]])>1e-20))return"break";J.push(r)};w.length>0;){var q=Y();if("break"===q)break}}for(var $=Z.filter((function(e){return e.length>2})).map((function(n,r){for(var i=0,s=De.collapseAABB2(De.AABB2()),a=0;a<n.length;a++)M(n[a],e),De.expandAABB2Point2(s,e),M(n[(a+1)%n.length],t),i+=e[0]*t[1]-t[0]*e[1];return{boundingBox:s,doubleArea:Math.abs(i),endPoints:n}})).sort((function(e,t){return t.doubleArea-e.doubleArea})),ee=function(){var t=[],n=[],r=function(r){return r.endPoints.forEach((function(r){M(r,e),t.push(e[0],e[1]),n.push(r)}))},i=$.shift();r(i);for(var o=[],A=0,l=function(){var e=$[A];E(e,i)&&o.every((function(t){return!E(e,t)}))?(e.index=t.length/2,r(e),o.push(e),$.splice(A,1)):++A};A<$.length;)l();for(var u=W(t,o.map((function(e){return e.index}))),h=0;h<u.length;h+=3){var d=c;d[0]=n[u[h+0]],d[1]=n[u[h+1]],d[2]=n[u[h+2]];var f=B[d[0]];De.subVec3(B[d[1]],f,s),De.subVec3(B[d[2]],f,a),De.normalizeVec3(De.cross3Vec3(s,a,a),a);var p=De.dotVec3(a,_)<=0;U(p?F:x,d,a);var v=d[0];d[0]=d[2],d[2]=v,U(p?x:F,d,De.negateVec3(a,a))}};$.length>0;)ee();var te=function(e){return e&&e.indices.length>0&&(t=[],n=d.onlyPosSliceWithUV&&[],e.indices.forEach((function(e){var r=B[e];t.push(r[0],r[1],r[2]),n&&n.push(r[3],r[4])})),{indices:v(e.indices.length),positions:t,normals:e.normals,uv:n});var t,n};return{pos:te(F),neg:te(x)}}}}();var Qe=new Float32Array(3),Re=function(){function e(t){var n=this;if(x(this,e),!t)throw"Parameter expected: cfg";if(!t.viewer)throw"Parameter expected: cfg.viewer";this.viewer=t.viewer,this._maxTreeDepth=t.maxTreeDepth||15,this._root=null,this._needsRebuild=!0,this._onModelLoaded=this.viewer.scene.on("modelLoaded",(function(e){n._needsRebuild=!0})),this._onModelUnloaded=this.viewer.scene.on("modelUnloaded",(function(e){n._needsRebuild=!0}))}return I(e,[{key:"root",get:function(){return this._needsRebuild&&this._rebuild(),this._root}},{key:"_rebuild",value:function(){var e=this.viewer.scene;for(var t in this._root={aabb:e.getAABB()},e.objects){var n=e.objects[t];this._insertEntity(this._root,n,1)}this._needsRebuild=!1}},{key:"_insertEntity",value:function(e,t,n){var r=t.aabb;if(n>=this._maxTreeDepth)return e.entities=e.entities||[],void e.entities.push(t);if(e.left&&De.containsAABB3(e.left.aabb,r))this._insertEntity(e.left,t,n+1);else if(e.right&&De.containsAABB3(e.right.aabb,r))this._insertEntity(e.right,t,n+1);else{var i=e.aabb;Qe[0]=i[3]-i[0],Qe[1]=i[4]-i[1],Qe[2]=i[5]-i[2];var s=0;if(Qe[1]>Qe[s]&&(s=1),Qe[2]>Qe[s]&&(s=2),!e.left){var a=i.slice();if(a[s+3]=(i[s]+i[s+3])/2,e.left={aabb:a},De.containsAABB3(a,r))return void this._insertEntity(e.left,t,n+1)}if(!e.right){var o=i.slice();if(o[s]=(i[s]+i[s+3])/2,e.right={aabb:o},De.containsAABB3(o,r))return void this._insertEntity(e.right,t,n+1)}e.entities=e.entities||[],e.entities.push(t)}}},{key:"destroy",value:function(){var e=this.viewer.scene;e.off(this._onModelLoaded),e.off(this._onModelUnloaded),this._root=null,this._needsRebuild=!0}}]),e}(),Oe=function(){function e(){x(this,e),this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}return I(e,[{key:"length",get:function(){return this._length}},{key:"shift",value:function(){if(this._index>=this._headLength){var e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}var t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t}},{key:"push",value:function(e){return this._length++,this._tail.push(e),this}},{key:"unshift",value:function(e){return this._head[--this._index]=e,this._length++,this}}]),e}(),Ve={build:{version:"0.8"},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};var Le=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],n=e[0].charCodeAt(0),r=n+e[1],i=n;i<r;++i)t.push(i);return String.fromCharCode.apply(null,t)})).join("");function He(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map((function(t){return Le.substr(parseInt(e/(1<<t))%64,1)})).reverse().join("")}var Ne=function(){for(var e={},t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var r=t[n].split("=");if(void 0===e[r[0]])e[r[0]]=decodeURIComponent(r[1]);else if("string"==typeof e[r[0]]){var i=[e[r[0]],decodeURIComponent(r[1])];e[r[0]]=i}else e[r[0]].push(decodeURIComponent(r[1]))}return e}();var Ge,je={xmlToJson:function e(t,n){if(t.nodeType===t.TEXT_NODE){var r=t.nodeValue;if(null===r.match(/^\s+$/))return r}else if(t.nodeType===t.ELEMENT_NODE||t.nodeType===t.DOCUMENT_NODE){var i={type:t.nodeName,children:[]};if(t.nodeType===t.ELEMENT_NODE)for(var s=0;s<t.attributes.length;s++){var a=t.attributes[s];i[n[a.nodeName]||a.nodeName]=a.nodeValue}for(var o=0;o<t.childNodes.length;o++){(s=e(t.childNodes[o],n))&&i.children.push(s)}return i}},clone:function(e){return JSON.parse(JSON.stringify(e))},compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return He(t[0],2)+[1,4,7,10,13].map((function(e){return He((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")},findNodeOfType:function(e,t){var n=[];return function e(r){r.type===t&&n.push(r),(r.children||[]).forEach((function(t){e(t)}))}(e),n},timeout:function(e){return new Promise((function(t,n){setTimeout(t,e)}))},httpRequest:function(e){return new Promise((function(t,n){var r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),r.onload=function(e){4===r.readyState&&(200===r.status?t(r.responseXML):n(r.statusText))},r.send(null)}))},loadJSON:function(e,t,n){var r=function(e){};t=t||r,n=n||r;var i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",e,!0),i.addEventListener("load",(function(e){var r=e.target.response;if(200===this.status){var i;try{i=JSON.parse(r)}catch(e){n("utils.loadJSON(): Failed to parse JSON response - ".concat(e))}t(i)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(r))}catch(e){n("utils.loadJSON(): Failed to parse JSON response - ".concat(e))}}else n(e)}),!1),i.addEventListener("error",(function(e){n(e)}),!1),i.send(null)},loadArraybuffer:function(e,t,n){var r=function(e){};t=t||r,n=n||r;var i=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var s=!!i[2],a=i[3];a=window.decodeURIComponent(a),s&&(a=window.atob(a));try{for(var o=new ArrayBuffer(a.length),A=new Uint8Array(o),c=0;c<a.length;c++)A[c]=a.charCodeAt(c);tt.scheduleTask((function(){t(o)}))}catch(e){tt.scheduleTask((function(){n(e)}))}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):n("loadArrayBuffer error : "+l.response))},l.send(null)}},queryString:Ne,isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"===M(e)&&"number"==typeof e.length},isString:function(e){return"string"==typeof e||e instanceof String},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isID:function(e){return je.isString(e)||je.isNumeric(e)},isSameComponent:function(e,t){return!(!e||!t)&&(je.isNumeric(e)||je.isString(e)?"".concat(e):e.id)===(je.isNumeric(t)||je.isString(t)?"".concat(t):t.id)},isFunction:function(e){return"function"==typeof e},isObject:function(e){var t={}.constructor;return!!e&&e.constructor===t},copy:function(e){return je.apply(e,{})},apply:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},apply2:function(e,t){for(var n in e)e.hasOwnProperty(n)&&void 0!==e[n]&&null!==e[n]&&(t[n]=e[n]);return t},applyIf:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(void 0!==t[n]&&null!==t[n]||(t[n]=e[n]));return t},isEmptyObject:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:function(e){return je.isNumeric(e)?"".concat(e):"'".concat(e,"'")},concat:function(e,t){var n=new e.constructor(e.length+t.length);return n.set(e),n.set(t,e.length),n},flattenParentChildHierarchy:function(e){var t=[];return function e(n){n.id=n.uuid,delete n.oid,t.push(n);var r=n.children;if(r)for(var i=0,s=r.length;i<s;i++){r[i].parent=n.id,e(r[i])}n.children=[]}(e),t}},We={},ze=new O,Xe=new Oe,Ke={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},Ze=[],Je=0,Ye=0;var qe,$e,et,tt=new function(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(e){if(e.id){if(tt.scenes[e.id])return void console.error("[ERROR] Scene ".concat(je.inQuotes(e.id)," already exists"))}else e.id=ze.addItem({});tt.scenes[e.id]=e;var t=e.ticksPerOcclusionTest,n=e.ticksPerRender;We[e.id]={ticksPerOcclusionTest:t,ticksPerRender:n,renderCountdown:n},Ve.components.scenes++,e.once("destroyed",(function(){ze.removeItem(e.id),delete tt.scenes[e.id],delete We[e.id],Ve.components.scenes--}))},this.clear=function(){var e;for(var t in tt.scenes)tt.scenes.hasOwnProperty(t)&&(e=tt.scenes[t],"default.scene"===t?e.clear():(e.destroy(),delete tt.scenes[e.id]))},this.scheduleTask=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Xe.push(e),Xe.push(t)},this.runTasks=function(){for(var e,t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,r=(new Date).getTime(),i=0;Xe.length>0&&(n<0||r<n);)e=Xe.shift(),(t=Xe.shift())?e.call(t):e(),r=(new Date).getTime(),i++;return i},this.getNumTasks=function(){return Xe.length}},nt=function(){var e=Date.now();if(Ge=e-Je,Je>0&&Ge>0){var t=1e3/Ge;Ye+=t,Ze.push(t),Ze.length>=30&&(Ye-=Ze.shift()),Ve.frame.fps=Math.round(Ye/Ze.length)}for(var n in tt.scenes)tt.scenes[n].compile();rt(e),Je=e};qe=function(){nt()},$e=100,et=Date.now()+$e,function e(){var t=Date.now()-et;qe(),et+=$e,setTimeout(e,Math.max(0,$e-t))}();function rt(e){var t=tt.runTasks(e+10),n=tt.getNumTasks();Ve.frame.tasksRun=t,Ve.frame.tasksScheduled=n,Ve.frame.tasksBudget=10}!function e(){var t=Date.now();if(Ge=t-Je,Je>0&&Ge>0){var n=1e3/Ge;Ye+=n,Ze.push(n),Ze.length>=30&&(Ye-=Ze.shift()),Ve.frame.fps=Math.round(Ye/Ze.length)}rt(t),function(e){for(var t in Ke.time=e,tt.scenes)if(tt.scenes.hasOwnProperty(t)){var n=tt.scenes[t];Ke.sceneId=t,Ke.startTime=n.startTime,Ke.deltaTime=null!=Ke.prevTime?Ke.time-Ke.prevTime:0,n.fire("tick",Ke,!0)}Ke.prevTime=e}(t),function(){var e,t,n,r,i,s=tt.scenes,a=!1;for(i in s)s.hasOwnProperty(i)&&(e=s[i],(t=We[i])||(t=We[i]={}),n=e.ticksPerOcclusionTest,t.ticksPerOcclusionTest!==n&&(t.ticksPerOcclusionTest=n,t.renderCountdown=n),--e.occlusionTestCountdown<=0&&(e.doOcclusionTest(),e.occlusionTestCountdown=n),r=e.ticksPerRender,t.ticksPerRender!==r&&(t.ticksPerRender=r,t.renderCountdown=r),0==--t.renderCountdown&&(e.render(a),t.renderCountdown=r))}(),void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(nt):requestAnimationFrame(e)}();var it=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,e),this.scene=null,"Scene"===this.type)this.scene=this,this.viewer=n.viewer;else{if("Scene"===t.type)this.scene=t;else{if(!(t instanceof e))throw"Invalid param: owner must be a Component";this.scene=t.scene}this._owner=t}this._dontClear=!!n.dontClear,this._renderer=this.scene._renderer,this.meta=n.meta||{},this.id=n.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this!==this.scene&&this.scene._addComponent(this),this._updateScheduled=!1,t&&t._own(this)}return I(e,[{key:"type",get:function(){return"Component"}},{key:"isComponent",get:function(){return!0}},{key:"glRedraw",value:function(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}},{key:"glResort",value:function(){this._renderer&&this._renderer.needStateSort()}},{key:"owner",get:function(){return this._owner}},{key:"isType",value:function(e){return this.type===e}},{key:"fire",value:function(e,t,n){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==n&&(this._events[e]=t||!0);var r,i=this._eventSubs[e];if(i)for(var s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}},{key:"on",value:function(e,t,n){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new O),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});var r=this._eventSubs[e];r?this._eventSubsNum[e]++:(r={},this._eventSubs[e]=r,this._eventSubsNum[e]=1);var i=this._subIdMap.addItem();r[i]={callback:t,scope:n||this},this._subIdEvents[i]=e;var s=this._events[e];return void 0!==s&&t.call(n||this,s),i}},{key:"off",value:function(e){if(null!=e&&this._subIdEvents){var t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];var n=this._eventSubs[t];n&&(delete n[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}}},{key:"once",value:function(e,t,n){var r=this,i=this.on(e,(function(e){r.off(i),t.call(n||this,e)}),n)}},{key:"hasSubs",value:function(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}},{key:"log",value:function(e){e="[LOG]"+this._message(e),window.console.log(e),this.scene.fire("log",e)}},{key:"_message",value:function(e){return" ["+this.type+" "+je.inQuotes(this.id)+"]: "+e}},{key:"warn",value:function(e){e="[WARN]"+this._message(e),window.console.warn(e),this.scene.fire("warn",e)}},{key:"error",value:function(e){e="[ERROR]"+this._message(e),window.console.error(e),this.scene.fire("error",e)}},{key:"_attach",value:function(e){var t=e.name;if(t){var n=e.component,r=e.sceneDefault,i=e.sceneSingleton,s=e.type,a=e.on,o=!1!==e.recompiles;if(n&&(je.isNumeric(n)||je.isString(n))){var A=n;if(!(n=this.scene.components[A]))return void this.error("Component not found: "+je.inQuotes(A))}if(!n)if(!0===i){var c=this.scene.types[s];for(var l in c)if(c.hasOwnProperty){n=c[l];break}if(!n)return this.error("Scene has no default component for '"+t+"'"),null}else if(!0===r&&!(n=this.scene[t]))return this.error("Scene has no default component for '"+t+"'"),null;if(n){if(n.scene.id!==this.scene.id)return void this.error("Not in same scene: "+n.type+" "+je.inQuotes(n.id));if(s&&!n.isType(s))return void this.error("Expected a "+s+" type or subtype: "+n.type+" "+je.inQuotes(n.id))}this._attachments||(this._attachments={});var u,h,d,f=this._attached[t];if(f){if(n&&f.id===n.id)return;var p=this._attachments[f.id];for(h=0,d=(u=p.subs).length;h<d;h++)f.off(u[h]);delete this._attached[t],delete this._attachments[f.id];var v=p.params.onDetached;v&&(je.isFunction(v)?v(f):v.scope?v.callback.call(v.scope,f):v.callback(f)),p.managingLifecycle&&f.destroy()}if(n){var g={params:e,component:n,subs:[],managingLifecycle:!1};g.subs.push(n.once("destroyed",(function(){g.params.component=null,this._attach(g.params)}),this)),o&&g.subs.push(n.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[t]=n,this._attachments[n.id]=g;var m,y,_,b,w=e.onAttached;if(w&&(je.isFunction(w)?w(n):w.scope?w.callback.call(w.scope,n):w.callback(n)),a)for(m in a)if(a.hasOwnProperty(m)){if(y=a[m],je.isFunction(y)?(_=y,b=null):(_=y.callback,b=y.scope),!_)continue;g.subs.push(n.on(m,_,b))}}return o&&this.fire("dirty",this),this.fire(t,n),n}this.error("Component 'name' expected")}},{key:"_checkComponent",value:function(e,t){if(!t.isComponent){if(!je.isID(t))return void this.error("Expected a Component or ID");var n=t;if(!(t=this.scene.components[n]))return void this.error("Component not found: "+n)}if(e===t.type){if(t.scene.id===this.scene.id)return t;this.error("Not in same scene: "+t.type)}else this.error("Expected a "+e+" Component")}},{key:"_checkComponent2",value:function(e,t){if(!t.isComponent){if(!je.isID(t))return void this.error("Expected a Component or ID");var n=t;if(!(t=this.scene.components[n]))return void this.error("Component not found: "+n)}if(t.scene.id===this.scene.id){for(var r=0,i=e.length;r<i;r++)if(e[r]===t.type)return t;return this.error("Expected component types: "+e),null}this.error("Not in same scene: "+t.type)}},{key:"_own",value:function(e){var t=this;this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[e.id]||(this._ownedComponents[e.id]=e),e.once("destroyed",(function(){delete t._ownedComponents[e.id]}),this)}},{key:"_needUpdate",value:function(e){this._updateScheduled||(this._updateScheduled=!0,0===e?this._doUpdate():tt.scheduleTask(this._doUpdate,this))}},{key:"_doUpdate",value:function(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}},{key:"scheduleTask",value:function(e){tt.scheduleTask(e,null)}},{key:"_update",value:function(){}},{key:"clear",value:function(){if(this._ownedComponents)for(var e in this._ownedComponents){if(this._ownedComponents.hasOwnProperty(e))this._ownedComponents[e].destroy(),delete this._ownedComponents[e]}}},{key:"destroy",value:function(){if(!this.destroyed){var e,t,n,r,i,s;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){for(n=(t=this._attachments[e]).component,i=0,s=(r=t.subs).length;i<s;i++)n.off(r[i]);t.managingLifecycle&&n.destroy()}if(this._ownedComponents)for(e in this._ownedComponents)this._ownedComponents.hasOwnProperty(e)&&((n=this._ownedComponents[e]).destroy(),delete this._ownedComponents[e]);this.scene._removeComponent(this),this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1,this._renderer=null}}}]),e}(),st=De.vec3(),at=De.vec3(),ot=De.mat4(),At=function(){function e(){x(this,e),this.normal=De.vec3(),this.offset=0,this.testVertex=De.vec3()}return I(e,[{key:"set",value:function(e,t,n,r){var i=1/Math.sqrt(e*e+t*t+n*n);this.normal[0]=e*i,this.normal[1]=t*i,this.normal[2]=n*i,this.offset=r*i,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0}}]),e}(),ct=I((function e(){x(this,e),this.planes=[new At,new At,new At,new At,new At,new At]}));function lt(e,t,n){var r=De.mulMat4(n,t,ot),i=r[0],s=r[1],a=r[2],o=r[3],A=r[4],c=r[5],l=r[6],u=r[7],h=r[8],d=r[9],f=r[10],p=r[11],v=r[12],g=r[13],m=r[14],y=r[15];e.planes[0].set(o-i,u-A,p-h,y-v),e.planes[1].set(o+i,u+A,p+h,y+v),e.planes[2].set(o-s,u-c,p-d,y-g),e.planes[3].set(o+s,u+c,p+d,y+g),e.planes[4].set(o-a,u-l,p-f,y-m),e.planes[5].set(o+a,u+l,p+f,y+m)}function ut(e,t){var n=ct.INSIDE,r=st,i=at;r[0]=t[0],r[1]=t[1],r[2]=t[2],i[0]=t[3],i[1]=t[4],i[2]=t[5];for(var s=[r,i],a=0;a<6;++a){var o=e.planes[a];if(o.normal[0]*s[o.testVertex[0]][0]+o.normal[1]*s[o.testVertex[1]][1]+o.normal[2]*s[o.testVertex[2]][2]+o.offset<0)return ct.OUTSIDE;o.normal[0]*s[1-o.testVertex[0]][0]+o.normal[1]*s[1-o.testVertex[1]][1]+o.normal[2]*s[1-o.testVertex[2]][2]+o.offset<0&&(n=ct.INTERSECT)}return n}ct.INSIDE=0,ct.INTERSECT=1,ct.OUTSIDE=2;var ht=function(e){m(n,it);var t=_(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(x(this,n),!r.viewer)throw"[MarqueePicker] Missing config: viewer";if(!r.objectsKdTree3)throw"[MarqueePicker] Missing config: objectsKdTree3";return(e=t.call(this,r.viewer.scene,r)).viewer=r.viewer,e._objectsKdTree3=r.objectsKdTree3,e._canvasMarqueeCorner1=De.vec2(),e._canvasMarqueeCorner2=De.vec2(),e._canvasMarquee=De.AABB2(),e._marqueeFrustum=new ct,e._marqueeFrustumProjMat=De.mat4(),e._pickMode=!1,e._marqueeElement=document.createElement("div"),document.body.appendChild(e._marqueeElement),e._marqueeElement.style.position="absolute",e._marqueeElement.style["z-index"]="40000005",e._marqueeElement.style.width="8px",e._marqueeElement.style.height="8px",e._marqueeElement.style.visibility="hidden",e._marqueeElement.style.top="0px",e._marqueeElement.style.left="0px",e._marqueeElement.style["box-shadow"]="0 2px 5px 0 #182A3D;",e._marqueeElement.style.opacity=1,e._marqueeElement.style["pointer-events"]="none",e}return I(n,[{key:"setMarqueeCorner1",value:function(e){this._canvasMarqueeCorner1.set(e),this._canvasMarqueeCorner2.set(e),this._updateMarquee()}},{key:"setMarqueeCorner2",value:function(e){this._canvasMarqueeCorner2.set(e),this._updateMarquee()}},{key:"setMarquee",value:function(e,t){this._canvasMarqueeCorner1.set(e),this._canvasMarqueeCorner2.set(t),this._updateMarquee()}},{key:"setMarqueeVisible",value:function(e){this._marqueVisible=e,this._marqueeElement.style.visibility=e?"visible":"hidden"}},{key:"getMarqueeVisible",value:function(){return this._marqueVisible}},{key:"setPickMode",value:function(e){if(e!==n.PICK_MODE_INSIDE&&e!==n.PICK_MODE_INTERSECTS)throw"Illegal MarqueePicker pickMode: must be MarqueePicker.PICK_MODE_INSIDE or MarqueePicker.PICK_MODE_INTERSECTS";e!==this._pickMode&&(this._marqueeElement.style["background-image"]=e===n.PICK_MODE_INSIDE?"url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='6' ry='6' stroke='%23333' stroke-width='4'/%3e%3c/svg%3e\")":"url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='6' ry='6' stroke='%23333' stroke-width='4' stroke-dasharray='6%2c 14' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e\")",this._pickMode=e)}},{key:"getPickMode",value:function(){return this._pickMode}},{key:"clear",value:function(){this.fire("clear",{})}},{key:"pick",value:function(){var e=this;this._updateMarquee(),this._buildMarqueeFrustum();var t=[];return(this._canvasMarquee[2]-this._canvasMarquee[0]>3||this._canvasMarquee[3]-this._canvasMarquee[1]>3)&&function r(i){var s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct.INTERSECT;if(s===ct.INTERSECT&&(s=ut(e._marqueeFrustum,i.aabb)),s!==ct.OUTSIDE){if(i.entities)for(var a=i.entities,o=0,A=a.length;o<A;o++){var c=a[o];if(c.visible){var l=c.aabb;if(e._pickMode===n.PICK_MODE_INSIDE)ut(e._marqueeFrustum,l)===ct.INSIDE&&t.push(c.id);else ut(e._marqueeFrustum,l)!==ct.OUTSIDE&&t.push(c.id)}}i.left&&r(i.left,s),i.right&&r(i.right,s)}}(this._objectsKdTree3.root),this.fire("picked",t),t}},{key:"_updateMarquee",value:function(){this._canvasMarquee[0]=Math.min(this._canvasMarqueeCorner1[0],this._canvasMarqueeCorner2[0]),this._canvasMarquee[1]=Math.min(this._canvasMarqueeCorner1[1],this._canvasMarqueeCorner2[1]),this._canvasMarquee[2]=Math.max(this._canvasMarqueeCorner1[0],this._canvasMarqueeCorner2[0]),this._canvasMarquee[3]=Math.max(this._canvasMarqueeCorner1[1],this._canvasMarqueeCorner2[1]),this._marqueeElement.style.width="".concat(this._canvasMarquee[2]-this._canvasMarquee[0],"px"),this._marqueeElement.style.height="".concat(this._canvasMarquee[3]-this._canvasMarquee[1],"px"),this._marqueeElement.style.left="".concat(this._canvasMarquee[0],"px"),this._marqueeElement.style.top="".concat(this._canvasMarquee[1],"px")}},{key:"_buildMarqueeFrustum",value:function(){var e=this.viewer.scene.canvas.canvas,t=e.clientWidth,n=e.clientHeight,r=e.clientLeft,i=e.clientTop,s=2/t,a=2/n,o=e.clientHeight/e.clientWidth,A=(this._canvasMarquee[0]-r)*s-1,c=(this._canvasMarquee[2]-r)*s-1,l=-(this._canvasMarquee[3]-i)*a+1,u=-(this._canvasMarquee[1]-i)*a+1,h=this.viewer.scene.camera.frustum.near*(17*o);De.frustumMat4(A,c,l*o,u*o,h,1e4,this._marqueeFrustumProjMat),lt(this._marqueeFrustum,this.viewer.scene.camera.viewMatrix,this._marqueeFrustumProjMat)}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._marqueeElement.parentElement&&(this._marqueeElement.parentElement.removeChild(this._marqueeElement),this._marqueeElement=null,this._objectsKdTree3=null)}}]),n}();ht.PICK_MODE_INTERSECTS=0,ht.PICK_MODE_INSIDE=1;var dt=function(e){m(n,it);var t=_(n);function n(e){var r;x(this,n),r=t.call(this,e.marqueePicker,e);var i,s,a,o,A,c,l,u=e.marqueePicker,h=u.viewer.scene.canvas.canvas,d=!1,f=!1,p=!1;return h.addEventListener("mousedown",(function(e){r.getActive()&&0===e.button&&(l=setTimeout((function(){var t=u.viewer.scene.input;t.keyDown[t.KEY_CTRL]||u.clear(),i=e.pageX,s=e.pageY,A=e.offsetX,u.setMarqueeCorner1([i,s]),d=!0,u.viewer.cameraControl.pointerEnabled=!1,u.setMarqueeVisible(!0),h.style.cursor="crosshair"}),400),f=!0)})),h.addEventListener("mouseup",(function(e){if(r.getActive()&&(d||p)&&0===e.button){clearTimeout(l),a=e.pageX,o=e.pageY;var t=Math.abs(a-i),n=Math.abs(o-s);d=!1,u.viewer.cameraControl.pointerEnabled=!0,p&&(p=!1),(t>3||n>3)&&u.pick()}})),document.addEventListener("mouseup",(function(e){r.getActive()&&0===e.button&&(clearTimeout(l),d&&(u.setMarqueeVisible(!1),d=!1,f=!1,p=!0,u.viewer.cameraControl.pointerEnabled=!0))}),!0),h.addEventListener("mousemove",(function(e){r.getActive()&&0===e.button&&f&&(clearTimeout(l),d&&(a=e.pageX,o=e.pageY,c=e.offsetX,u.setMarqueeVisible(!0),u.setMarqueeCorner2([a,o]),u.setPickMode(A<c?ht.PICK_MODE_INSIDE:ht.PICK_MODE_INTERSECTS)))})),r}return I(n,[{key:"setActive",value:function(e){this._active!==e&&(this._active=e,this.fire("active",this._active))}},{key:"getActive",value:function(){return this._active}},{key:"destroy",value:function(){}}]),n}(),ft=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this.viewer=t,this.scene=this.viewer.scene,this._circleDiv=document.createElement("div"),this.viewer.scene.canvas.canvas.parentNode.insertBefore(this._circleDiv,this.viewer.scene.canvas.canvas),this._circleDiv.style.backgroundColor="transparent",this._circleDiv.style.border="2px solid green",this._circleDiv.style.borderRadius="50px",this._circleDiv.style.width="50px",this._circleDiv.style.height="50px",this._circleDiv.style.margin="-200px -200px",this._circleDiv.style.zIndex="100000",this._circleDiv.style.position="absolute",this._circleDiv.style.pointerEvents="none",this._circlePos=null,this._circleMaxRadius=200,this._circleMinRadius=2,this._active=!1!==n.active,this._visible=!1,this._running=!1,this._destroyed=!1}return I(e,[{key:"start",value:function(e){var t=this;if(!this._destroyed){this._circlePos=e,this._running=!1,this._circleRadius=this._circleMaxRadius,this._circleDiv.style.borderRadius="".concat(this._circleRadius,"px"),this._circleDiv.style.marginLeft="".concat(this._circlePos[0]-this._circleRadius,"px"),this._circleDiv.style.marginTop="".concat(this._circlePos[1]-this._circleRadius,"px");var n,r=this._circleMaxRadius;this._running=!0,requestAnimationFrame((function e(i){if(t._running){n||(n=i);var s=i-n,a=Math.min(s/300,1),o=r+(2-r)*a;t._circleRadius=o,t._circleDiv.style.width="".concat(t._circleRadius,"px"),t._circleDiv.style.height="".concat(t._circleRadius,"px"),t._circleDiv.style.marginLeft="".concat(t._circlePos[0]-t._circleRadius/2,"px"),t._circleDiv.style.marginTop="".concat(t._circlePos[1]-t._circleRadius/2,"px"),a<1&&requestAnimationFrame(e)}})),this._circleDiv.style.visibility="visible"}}},{key:"stop",value:function(){this._destroyed||(this._running=!1,this._circleRadius=this._circleMaxRadius,this._circleDiv.style.borderRadius="".concat(this._circleRadius,"px"),this._circleDiv.style.visibility="hidden")}},{key:"durationMs",get:function(){return this._durationMs},set:function(e){this.stop(),this._durationMs=e}},{key:"destroy",value:function(){this._destroyed||(this.stop(),this._circleDiv.parentElement.removeChild(this._circleDiv),this._destroyed=!0)}}]),e}(),pt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this._eventSubIDMap=null,this._eventSubEvents=null,this._eventSubs=null,this._events=null,this._locale="en",this._messages={},this._locales=[],this._locale="en",this.messages=t.messages,this.locale=t.locale}return I(e,[{key:"messages",set:function(e){this._messages=e||{},this._locales=Object.keys(this._messages),this.fire("updated",this)}},{key:"loadMessages",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};for(var t in e)this._messages[t]=e[t];this.messages=this._messages}},{key:"clearMessages",value:function(){this.messages={}}},{key:"locales",get:function(){return this._locales}},{key:"locale",get:function(){return this._locale},set:function(e){e=e||"de",this._locale!==e&&(this._locale=e,this.fire("updated",e))}},{key:"translate",value:function(e,t){var n=this._messages[this._locale];if(!n)return null;var r=vt(e,n);return r?t?gt(r,t):r:null}},{key:"translatePlurals",value:function(e,t,n){var r=this._messages[this._locale];if(!r)return null;var i=vt(e,r);return(i=0===(t=parseInt(""+t,10))?i.zero:t>1?i.other:i.one)?(i=gt(i,[t]),n&&(i=gt(i,n)),i):null}},{key:"fire",value:function(e,t,n){this._events||(this._events={}),this._eventSubs||(this._eventSubs={}),!0!==n&&(this._events[e]=t||!0);var r=this._eventSubs[e];if(r)for(var i in r){if(r.hasOwnProperty(i))r[i].callback(t)}}},{key:"on",value:function(e,t){this._events||(this._events={}),this._eventSubIDMap||(this._eventSubIDMap=new O),this._eventSubEvents||(this._eventSubEvents={}),this._eventSubs||(this._eventSubs={});var n=this._eventSubs[e];n||(n={},this._eventSubs[e]=n);var r=this._eventSubIDMap.addItem();n[r]={callback:t},this._eventSubEvents[r]=e;var i=this._events[e];return void 0!==i&&t(i),r}},{key:"off",value:function(e){if(null!=e&&this._eventSubEvents){var t=this._eventSubEvents[e];if(t){delete this._eventSubEvents[e];var n=this._eventSubs[t];n&&delete n[e],this._eventSubIDMap.removeItem(e)}}}}]),e}();function vt(e,t){if(t[e])return t[e];for(var n=e.split("."),r=t,i=0,s=n.length;r&&i<s;i++){r=r[n[i]]}return r}function gt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(e,n){return"{{"===e?"{":"}}"===e?"}":t[n]}))}var mt=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).t=i.t,r}return I(n,[{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"tangent",get:function(){return this.getTangent(this._t)}},{key:"length",get:function(){var e=this._getLengths();return e[e.length-1]}},{key:"getTangent",value:function(e){var t=1e-4;void 0===e&&(e=this._t);var n=e-t,r=e+t;n<0&&(n=0),r>1&&(r=1);var i=this.getPoint(n),s=this.getPoint(r),a=De.subVec3(s,i,[]);return De.normalizeVec3(a,[])}},{key:"getPointAt",value:function(e){var t=this.getUToTMapping(e);return this.getPoint(t)}},{key:"getPoints",value:function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n}},{key:"_getLengths",value:function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,r=[],i=this.getPoint(0),s=0;for(r.push(0),n=1;n<=e;n++)t=this.getPoint(n/e),s+=De.lenVec3(De.subVec3(t,i,[])),r.push(s),i=t;return this.cacheArcLengths=r,r}},{key:"_updateArcLengths",value:function(){this.needsUpdate=!0,this._getLengths()}},{key:"getUToTMapping",value:function(e,t){var n,r=this._getLengths(),i=0,s=r.length;n=t||e*r[s-1];for(var a,o=0,A=s-1;o<=A;)if((a=r[i=Math.floor(o+(A-o)/2)]-n)<0)o=i+1;else{if(!(a>0)){A=i;break}A=i-1}if(r[i=A]===n)return i/(s-1);var c=r[i];return(i+(n-c)/(r[i+1]-c))/(s-1)}}]),n}(),yt=function(e){m(n,mt);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).points=i.points,r.t=i.t,r}return I(n,[{key:"points",get:function(){return this._points},set:function(e){this._points=e||[]}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"getPoint",value:function(e){var t=this.points;if(!(t.length<3)){var n=(t.length-1)*e,r=Math.floor(n),i=n-r,s=t[0===r?r:r-1],a=t[r],o=t[r>t.length-2?t.length-1:r+1],A=t[r>t.length-3?t.length-1:r+2],c=De.vec3();return c[0]=De.catmullRomInterpolate(s[0],a[0],o[0],A[0],i),c[1]=De.catmullRomInterpolate(s[1],a[1],o[1],A[1],i),c[2]=De.catmullRomInterpolate(s[2],a[2],o[2],A[2],i),c}this.error("Can't sample point from SplineCurve - not enough points on curve - returning [0,0,0].")}},{key:"getJSON",value:function(){return{points:points,t:this._t}}}]),n}(),_t=De.vec3(),bt=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._frames=[],r._eyeCurve=new yt(w(r)),r._lookCurve=new yt(w(r)),r._upCurve=new yt(w(r)),i.frames&&(r.addFrames(i.frames),r.smoothFrameTimes(1)),r}return I(n,[{key:"type",get:function(){return"CameraPath"}},{key:"frames",get:function(){return this._frames}},{key:"eyeCurve",get:function(){return this._eyeCurve}},{key:"lookCurve",get:function(){return this._lookCurve}},{key:"upCurve",get:function(){return this._upCurve}},{key:"saveFrame",value:function(e){var t=this.scene.camera;this.addFrame(e,t.eye,t.look,t.up)}},{key:"addFrame",value:function(e,t,n,r){var i={t:e,eye:t.slice(0),look:n.slice(0),up:r.slice(0)};this._frames.push(i),this._eyeCurve.points.push(i.eye),this._lookCurve.points.push(i.look),this._upCurve.points.push(i.up)}},{key:"addFrames",value:function(e){for(var t,n=0,r=e.length;n<r;n++)t=e[n],this.addFrame(t.t||0,t.eye,t.look,t.up)}},{key:"loadFrame",value:function(e){var t=this.scene.camera;e=(e/=this._frames[this._frames.length-1].t-this._frames[0].t)<0?0:e>1?1:e,t.eye=this._eyeCurve.getPoint(e,_t),t.look=this._lookCurve.getPoint(e,_t),t.up=this._upCurve.getPoint(e,_t)}},{key:"sampleFrame",value:function(e,t,n,r){e=e<0?0:e>1?1:e,this._eyeCurve.getPoint(e,t),this._lookCurve.getPoint(e,n),this._upCurve.getPoint(e,r)}},{key:"smoothFrameTimes",value:function(e){if(0!==this._frames.length){var t=De.vec3(),n=0;this._frames[0].t=0;for(var r=[],i=1,s=this._frames.length;i<s;i++){var a=De.lenVec3(De.subVec3(this._frames[i].eye,this._frames[i-1].eye,t));r[i]=a,n+=a}for(var o=1,A=this._frames.length;o<A;o++){var c=r[o]/n*e;this._frames[o].t=this._frames[o-1].t+c}}}},{key:"clearFrames",value:function(){this._frames=[],this._eyeCurve.points=[],this._lookCurve.points=[],this._upCurve.points=[]}}]),n}(),wt=De.vec3(),Bt=De.vec3(),Ct=De.vec3(),Mt=De.vec3(),kt=De.vec3(),Et=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._look1=De.vec3(),r._eye1=De.vec3(),r._up1=De.vec3(),r._look2=De.vec3(),r._eye2=De.vec3(),r._up2=De.vec3(),r._orthoScale1=1,r._orthoScale2=1,r._flying=!1,r._flyEyeLookUp=!1,r._flyingEye=!1,r._flyingLook=!1,r._callback=null,r._callbackScope=null,r._time1=null,r._time2=null,r.easing=!1!==i.easing,r.duration=i.duration,r.fit=i.fit,r.fitFOV=i.fitFOV,r.trail=i.trail,r}return I(n,[{key:"type",get:function(){return"CameraFlightAnimation"}},{key:"flyTo",value:function(e,t,n){e=e||this.scene,this._flying&&this.stop(),this._flying=!1,this._flyingEye=!1,this._flyingLook=!1,this._flyingEyeLookUp=!1,this._callback=t,this._callbackScope=n;var r,i,s,a,o,A=this.scene.camera,c=!!e.projection&&e.projection!==A.projection;if(this._eye1[0]=A.eye[0],this._eye1[1]=A.eye[1],this._eye1[2]=A.eye[2],this._look1[0]=A.look[0],this._look1[1]=A.look[1],this._look1[2]=A.look[2],this._up1[0]=A.up[0],this._up1[1]=A.up[1],this._up1[2]=A.up[2],this._orthoScale1=A.ortho.scale,this._orthoScale2=e.orthoScale||this._orthoScale1,e.aabb)r=e.aabb;else if(6===e.length)r=e;else if(e.eye&&e.look||e.up)i=e.eye,s=e.look,a=e.up;else if(e.eye)i=e.eye;else if(e.look)s=e.look;else{var l=e;if((je.isNumeric(l)||je.isString(l))&&(o=l,!(l=this.scene.components[o])))return this.error("Component not found: "+je.inQuotes(o)),void(t&&(n?t.call(n):t()));c||(r=l.aabb||this.scene.aabb)}var u=e.poi;if(r){if(r[3]<r[0]||r[4]<r[1]||r[5]<r[2])return;if(r[3]===r[0]&&r[4]===r[1]&&r[5]===r[2])return;r=r.slice();var h=De.getAABB3Center(r);this._look2=u||h;var d=De.subVec3(this._eye1,this._look1,wt),f=De.normalizeVec3(d),p=u?De.getAABB3DiagPoint(r,u):De.getAABB3Diag(r),v=e.fitFOV||this._fitFOV,g=Math.abs(p/Math.tan(v*De.DEGTORAD));this._orthoScale2=1.1*p,this._eye2[0]=this._look2[0]+f[0]*g,this._eye2[1]=this._look2[1]+f[1]*g,this._eye2[2]=this._look2[2]+f[2]*g,this._up2[0]=this._up1[0],this._up2[1]=this._up1[1],this._up2[2]=this._up1[2],this._flyingEyeLookUp=!0}else(i||s||a)&&(this._flyingEyeLookUp=!!i&&!!s&&!!a,this._flyingEye=!!i&&!s,this._flyingLook=!!s&&!i,i&&(this._eye2[0]=i[0],this._eye2[1]=i[1],this._eye2[2]=i[2]),s&&(this._look2[0]=s[0],this._look2[1]=s[1],this._look2[2]=s[2]),a&&(this._up2[0]=a[0],this._up2[1]=a[1],this._up2[2]=a[2]));c?("ortho"===e.projection&&"ortho"!==A.projection&&(this._projection2="ortho",this._projMatrix1=A.projMatrix.slice(),this._projMatrix2=A.ortho.matrix.slice(),A.projection="customProjection"),"perspective"===e.projection&&"perspective"!==A.projection&&(this._projection2="perspective",this._projMatrix1=A.projMatrix.slice(),this._projMatrix2=A.perspective.matrix.slice(),A.projection="customProjection")):this._projection2=null,this.fire("started",e,!0),this._time1=Date.now(),this._time2=this._time1+(Number.isFinite(e.duration)?1e3*e.duration:this._duration),this._flying=!0,tt.scheduleTask(this._update,this)}},{key:"jumpTo",value:function(e){this._jumpTo(e)}},{key:"_jumpTo",value:function(e){this._flying&&this.stop();var t,n,r,i,s,a=this.scene.camera;if(e.aabb)t=e.aabb;else if(6===e.length)t=e;else if(e.eye||e.look||e.up)r=e.eye,i=e.look,s=e.up;else{var o=e;if((je.isNumeric(o)||je.isString(o))&&(n=o,!(o=this.scene.components[n])))return void this.error("Component not found: "+je.inQuotes(n));t=o.aabb||this.scene.aabb}var A=e.poi;if(t){if(t[3]<=t[0]||t[4]<=t[1]||t[5]<=t[2])return;var c,l=A?De.getAABB3DiagPoint(t,A):De.getAABB3Diag(t);i=A||De.getAABB3Center(t,i),this._trail?De.subVec3(a.look,i,kt):De.subVec3(a.eye,a.look,kt),De.normalizeVec3(kt),c=(void 0!==e.fit?e.fit:this._fit)?Math.abs(l/Math.tan((e.fitFOV||this._fitFOV)*De.DEGTORAD)):De.lenVec3(De.subVec3(a.eye,a.look,wt)),De.mulVec3Scalar(kt,c),a.eye=De.addVec3(i,kt,wt),a.look=i,this.scene.camera.ortho.scale=1.1*l}else(r||i||s)&&(r&&(a.eye=r),i&&(a.look=i),s&&(a.up=s));e.projection&&(a.projection=e.projection)}},{key:"_update",value:function(){if(this._flying){var e=(Date.now()-this._time1)/(this._time2-this._time1),t=e>=1;e>1&&(e=1);var r=this.easing?n._ease(e,0,1,1):e,i=this.scene.camera;if(this._flyingEye||this._flyingLook?this._flyingEye?(De.subVec3(i.eye,i.look,kt),i.eye=De.lerpVec3(r,0,1,this._eye1,this._eye2,Ct),i.look=De.subVec3(Ct,kt,Bt)):this._flyingLook&&(i.look=De.lerpVec3(r,0,1,this._look1,this._look2,Bt),i.up=De.lerpVec3(r,0,1,this._up1,this._up2,Mt)):this._flyingEyeLookUp&&(i.eye=De.lerpVec3(r,0,1,this._eye1,this._eye2,Ct),i.look=De.lerpVec3(r,0,1,this._look1,this._look2,Bt),i.up=De.lerpVec3(r,0,1,this._up1,this._up2,Mt)),this._projection2){var s="ortho"===this._projection2?n._easeOutExpo(e,0,1,1):n._easeInCubic(e,0,1,1);i.customProjection.matrix=De.lerpMat4(s,0,1,this._projMatrix1,this._projMatrix2)}else i.ortho.scale=this._orthoScale1+e*(this._orthoScale2-this._orthoScale1);if(t)return i.ortho.scale=this._orthoScale2,void this.stop();tt.scheduleTask(this._update,this)}}},{key:"stop",value:function(){if(this._flying){this._flying=!1,this._time1=null,this._time2=null,this._projection2&&(this.scene.camera.projection=this._projection2);var e=this._callback;e&&(this._callback=null,this._callbackScope?e.call(this._callbackScope):e()),this.fire("stopped",!0,!0)}}},{key:"cancel",value:function(){this._flying&&(this._flying=!1,this._time1=null,this._time2=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}},{key:"duration",get:function(){return this._duration/1e3},set:function(e){this._duration=Number.isFinite(e)?1e3*e:500,this.stop()}},{key:"fit",get:function(){return this._fit},set:function(e){this._fit=!1!==e}},{key:"fitFOV",get:function(){return this._fitFOV},set:function(e){this._fitFOV=e||45}},{key:"trail",get:function(){return this._trail},set:function(e){this._trail=!!e}},{key:"destroy",value:function(){this.stop(),v(C(n.prototype),"destroy",this).call(this)}}],[{key:"_ease",value:function(e,t,n,r){return-n*(e/=r)*(e-2)+t}},{key:"_easeInCubic",value:function(e,t,n,r){return n*(e/=r)*e*e+t}},{key:"_easeOutExpo",value:function(e,t,n,r){return n*(1-Math.pow(2,-10*e/r))+t}}]),n}(),Ft=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._cameraFlightAnimation=new Et(w(r)),r._t=0,r.state=n.SCRUBBING,r._playingFromT=0,r._playingToT=0,r._playingRate=i.playingRate||1,r._playingDir=1,r._lastTime=null,r.cameraPath=i.cameraPath,r._tick=r.scene.on("tick",r._updateT,w(r)),r}return I(n,[{key:"type",get:function(){return"CameraPathAnimation"}},{key:"_updateT",value:function(){var e=this._cameraPath;if(e){var t,r,i=performance.now(),s=this._lastTime?.001*(i-this._lastTime):0;if(this._lastTime=i,0!==s)switch(this.state){case n.SCRUBBING:return;case n.PLAYING:if(this._t+=this._playingRate*s,0===(t=this._cameraPath.frames.length)||this._playingDir<0&&this._t<=0||this._playingDir>0&&this._t>=this._cameraPath.frames[t-1].t)return this.state=n.SCRUBBING,this._t=this._cameraPath.frames[t-1].t,void this.fire("stopped");e.loadFrame(this._t);break;case n.PLAYING_TO:r=this._t+this._playingRate*s*this._playingDir,(this._playingDir<0&&r<=this._playingToT||this._playingDir>0&&r>=this._playingToT)&&(r=this._playingToT,this.state=n.SCRUBBING,this.fire("stopped")),this._t=r,e.loadFrame(this._t)}}}},{key:"_ease",value:function(e,t,n,r){return-n*(e/=r)*(e-2)+t}},{key:"cameraPath",get:function(){return this._cameraPath},set:function(e){this._cameraPath=e}},{key:"rate",get:function(){return this._playingRate},set:function(e){this._playingRate=e}},{key:"play",value:function(){this._cameraPath&&(this._lastTime=null,this.state=n.PLAYING)}},{key:"playToT",value:function(e){this._cameraPath&&(this._playingFromT=this._t,this._playingToT=e,this._playingDir=this._playingToT-this._playingFromT<0?-1:1,this._lastTime=null,this.state=n.PLAYING_TO)}},{key:"playToFrame",value:function(e){var t=this._cameraPath;if(t){var n=t.frames[e];n?this.playToT(n.t):this.error("playToFrame - frame index out of range: "+e)}}},{key:"flyToFrame",value:function(e,t){var r=this._cameraPath;if(r){var i=r.frames[e];i?(this.state=n.SCRUBBING,this._cameraFlightAnimation.flyTo(i,t)):this.error("flyToFrame - frame index out of range: "+e)}}},{key:"scrubToT",value:function(e){var t=this._cameraPath;t&&(this.scene.camera&&(this._t=e,t.loadFrame(this._t),this.state=n.SCRUBBING))}},{key:"scrubToFrame",value:function(e){var t=this._cameraPath;t&&(this.scene.camera&&(t.frames[e]?(t.loadFrame(this._t),this.state=n.SCRUBBING):this.error("playToFrame - frame index out of range: "+e)))}},{key:"stop",value:function(){this.state=n.SCRUBBING,this.fire("stopped")}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this.scene.off(this._tick)}}]),n}();Ft.STOPPED=0,Ft.SCRUBBING=1,Ft.PLAYING=2,Ft.PLAYING_TO=3;var xt=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),r=t.call(this,e,i),Ve.memory.meshes++,r}return I(n,[{key:"type",get:function(){return"Geometry"}},{key:"isGeometry",get:function(){return!0}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),Ve.memory.meshes--}}]),n}(),Ut=new O({}),It=function(){function e(t){for(var n in x(this,e),this.id=Ut.addItem({}),t)t.hasOwnProperty(n)&&(this[n]=t[n])}return I(e,[{key:"destroy",value:function(){Ut.removeItem(this.id)}}]),e}(),Tt=function(){function e(t,n,r,i,s,a,o,A,c){switch(x(this,e),this._gl=t,this.type=n,this.allocated=!1,r.constructor){case Uint8Array:this.itemType=t.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=t.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=t.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=t.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=t.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=t.INT,this.itemByteSize=4;break;default:this.itemType=t.FLOAT,this.itemByteSize=4}this.usage=a,this.length=0,this.dataLength=i,this.numItems=0,this.itemSize=s,this.normalized=!!o,this.stride=A||0,this.offset=c||0,this._allocate(r)}return I(e,[{key:"_allocate",value:function(e){if(this.allocated=!1,this._handle=this._gl.createBuffer(),!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,this._handle),this._gl.bufferData(this.type,e.length>this.dataLength?e.slice(0,this.dataLength):e,this.usage),this._gl.bindBuffer(this.type,null),this.length=e.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}},{key:"setData",value:function(e,t){this.allocated&&(e.length+(t||0)>this.length?(this.destroy(),this._allocate(e)):(this._gl.bindBuffer(this.type,this._handle),t||0===t?this._gl.bufferSubData(this.type,t*this.itemByteSize,e):this._gl.bufferData(this.type,e,this.usage),this._gl.bindBuffer(this.type,null)))}},{key:"bind",value:function(){this.allocated&&this._gl.bindBuffer(this.type,this._handle)}},{key:"unbind",value:function(){this.allocated&&this._gl.bindBuffer(this.type,null)}},{key:"bindAtLocation",value:function(e){this.bind(),this._gl.vertexAttribPointer(e,this.itemSize,this.itemType,this.normalized,0,0)}},{key:"destroy",value:function(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}]),e}(),Pt=function(){var e=[],t=[],n=[],r=[],i=[],s=0,a=new Uint16Array(3),o=new Uint16Array(3),A=new Uint16Array(3),c=De.vec3(),l=De.vec3(),u=De.vec3(),h=De.vec3(),d=De.vec3(),f=De.vec3(),p=De.vec3();return function(v,g,m,y){!function(i,s){var a,o,A,c,l,u,h={},d=Math.pow(10,4),f=0;for(l=0,u=i.length;l<u;l+=3)a=i[l],o=i[l+1],A=i[l+2],void 0===h[c=Math.round(a*d)+"_"+Math.round(o*d)+"_"+Math.round(A*d)]&&(h[c]=f/3,e[f++]=a,e[f++]=o,e[f++]=A),t[l/3]=h[c];for(l=0,u=s.length;l<u;l++)r[l]=t[s[l]],n[r[l]]=s[l]}(v,g),function(t,n){s=0;for(var v=0,g=t;v<g;v+=3){var m=3*r[v],y=3*r[v+1],_=3*r[v+2];n?(a[0]=e[m],a[1]=e[m+1],a[2]=e[m+2],o[0]=e[y],o[1]=e[y+1],o[2]=e[y+2],A[0]=e[_],A[1]=e[_+1],A[2]=e[_+2],De.decompressPosition(a,n,c),De.decompressPosition(o,n,l),De.decompressPosition(A,n,u)):(c[0]=e[m],c[1]=e[m+1],c[2]=e[m+2],l[0]=e[y],l[1]=e[y+1],l[2]=e[y+2],u[0]=e[_],u[1]=e[_+1],u[2]=e[_+2]),De.subVec3(u,l,h),De.subVec3(c,l,d),De.cross3Vec3(h,d,f),De.normalizeVec3(f,p);var b=i[s]||(i[s]={normal:De.vec3()});b.normal[0]=p[0],b.normal[1]=p[1],b.normal[2]=p[2],s++}}(g.length,m);for(var _,b,w,B,C,M,k,E,F,x,U=[],I=Math.cos(De.DEGTORAD*y),T={},P=!1,S=0,D=g.length;S<D;S+=3)for(var Q=S/3,R=0;R<3;R++)_=r[S+R],b=r[S+(R+1)%3],void 0===T[C=(w=Math.min(_,b))+","+(B=Math.max(_,b))]?T[C]={index1:w,index2:B,face1:Q,face2:void 0}:T[C].face2=Q;for(C in T)void 0!==(M=T[C]).face2&&(k=i[M.face1].normal,E=i[M.face2].normal,De.dotVec3(k,E)>I)||(F=n[M.index1],x=n[M.index2],(!P&&F>65535||x>65535)&&(P=!0),U.push(F),U.push(x));return P?new Uint32Array(U):new Uint16Array(U)}}();var St,Dt,Qt=(St=De.mat4(),Dt=De.mat4(),function(e,t){t=t||De.mat4();var n=e[0],r=e[1],i=e[2],s=e[3]-n,a=e[4]-r,o=e[5]-i,A=65535;return De.identityMat4(St),De.translationMat4v(e,St),De.identityMat4(Dt),De.scalingMat4v([s/A,a/A,o/A],Dt),De.mulMat4(St,Dt,t),t}),Rt=function(){var e=De.mat4(),t=De.mat4();return function(n,r,i){var s,a=new Uint16Array(n.length),o=new Float32Array([i[0]!==r[0]?65535/(i[0]-r[0]):0,i[1]!==r[1]?65535/(i[1]-r[1]):0,i[2]!==r[2]?65535/(i[2]-r[2]):0]);for(s=0;s<n.length;s+=3)a[s+0]=Math.max(0,Math.min(65535,Math.floor((n[s+0]-r[0])*o[0]))),a[s+1]=Math.max(0,Math.min(65535,Math.floor((n[s+1]-r[1])*o[1]))),a[s+2]=Math.max(0,Math.min(65535,Math.floor((n[s+2]-r[2])*o[2])));return De.identityMat4(e),De.translationMat4v(r,e),De.identityMat4(t),De.scalingMat4v([(i[0]-r[0])/65535,(i[1]-r[1])/65535,(i[2]-r[2])/65535],t),{quantized:a,decodeMatrix:De.mulMat4(e,t,De.identityMat4())}}}();var Ot=function(){var e=De.mat3(),t=De.mat3();return function(n,r,i){var s,a=new Uint16Array(n.length),o=new Float32Array([65535/(i[0]-r[0]),65535/(i[1]-r[1])]);for(s=0;s<n.length;s+=2)a[s+0]=Math.max(0,Math.min(65535,Math.floor((n[s+0]-r[0])*o[0]))),a[s+1]=Math.max(0,Math.min(65535,Math.floor((n[s+1]-r[1])*o[1])));return De.identityMat3(e),De.translationMat3v(r,e),De.identityMat3(t),De.scalingMat3v([(i[0]-r[0])/65535,(i[1]-r[1])/65535],t),{quantized:a,decodeMatrix:De.mulMat3(e,t,De.identityMat3())}}}();function Vt(e,t,n,r){var i=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),s=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){var a=(1-Math.abs(s))*(i>=0?1:-1),o=(1-Math.abs(i))*(s>=0?1:-1);i=a,s=o}return new Int8Array([Math[n](127.5*i+(i<0?-1:0)),Math[r](127.5*s+(s<0?-1:0))])}function Lt(e){var t=e[0],n=e[1];t/=t<0?127:128,n/=n<0?127:128;var r=1-Math.abs(t)-Math.abs(n);r<0&&(t=(1-Math.abs(n))*(t>=0?1:-1),n=(1-Math.abs(t))*(n>=0?1:-1));var i=Math.sqrt(t*t+n*n+r*r);return[t/i,n/i,r/i]}function Ht(e,t,n){return e[t]*n[0]+e[t+1]*n[1]+e[t+2]*n[2]}var Nt={getPositionsBounds:function(e){var t,n,r=new Float32Array(3),i=new Float32Array(3);for(t=0;t<3;t++)r[t]=Number.MAX_VALUE,i[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=3)for(n=0;n<3;n++)r[n]=Math.min(r[n],e[t+n]),i[n]=Math.max(i[n],e[t+n]);return{min:r,max:i}},createPositionsDecodeMatrix:Qt,compressPositions:Rt,compressPosition:function(e,t,n){var r=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);n[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*r[0]))),n[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*r[1]))),n[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*r[2])))},decompressPositions:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),r=0,i=e.length;r<i;r+=3)n[r+0]=e[r+0]*t[0]+t[12],n[r+1]=e[r+1]*t[5]+t[13],n[r+2]=e[r+2]*t[10]+t[14];return n},decompressPosition:function(e,t,n){return n[0]=e[0]*t[0]+t[12],n[1]=e[1]*t[5]+t[13],n[2]=e[2]*t[10]+t[14],n},decompressAABB:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e;return n[0]=e[0]*t[0]+t[12],n[1]=e[1]*t[5]+t[13],n[2]=e[2]*t[10]+t[14],n[3]=e[3]*t[0]+t[12],n[4]=e[4]*t[5]+t[13],n[5]=e[5]*t[10]+t[14],n},getUVBounds:function(e){var t,n,r=new Float32Array(2),i=new Float32Array(2);for(t=0;t<2;t++)r[t]=Number.MAX_VALUE,i[t]=-Number.MAX_VALUE;for(t=0;t<e.length;t+=2)for(n=0;n<2;n++)r[n]=Math.min(r[n],e[t+n]),i[n]=Math.max(i[n],e[t+n]);return{min:r,max:i}},compressUVs:Ot,decompressUVs:function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Float32Array(e.length),r=0,i=e.length;r<i;r+=3)n[r+0]=e[r+0]*t[0]+t[6],n[r+1]=e[r+1]*t[4]+t[7];return n},decompressUV:function(e,t,n){n[0]=e[0]*t[0]+t[6],n[1]=e[1]*t[4]+t[7]},compressNormals:function(e){for(var t,n,r,i,s=new Int8Array(e.length),a=0;a<e.length;a+=3)n=t=Vt(e,a,"floor","floor"),r=i=Ht(e,a,Lt(t)),(r=Ht(e,a,Lt(t=Vt(e,a,"ceil","floor"))))>i&&(n=t,i=r),(r=Ht(e,a,Lt(t=Vt(e,a,"floor","ceil"))))>i&&(n=t,i=r),(r=Ht(e,a,Lt(t=Vt(e,a,"ceil","ceil"))))>i&&(n=t,i=r),s[a]=n[0],s[a+1]=n[1];return s},decompressNormals:function(e,t){for(var n=0,r=0,i=e.length;n<i;n+=2){var s=e[n+0],a=e[n+1];s=(2*s+1)/255,a=(2*a+1)/255;var o=1-Math.abs(s)-Math.abs(a);o<0&&(s=(1-Math.abs(a))*(s>=0?1:-1),a=(1-Math.abs(s))*(a>=0?1:-1));var A=Math.sqrt(s*s+a*a+o*o);t[r+0]=s/A,t[r+1]=a/A,t[r+2]=o/A,r+=3}return t},decompressNormal:function(e,t){var n=e[0],r=e[1];n=(2*n+1)/255,r=(2*r+1)/255;var i=1-Math.abs(n)-Math.abs(r);i<0&&(n=(1-Math.abs(r))*(n>=0?1:-1),r=(1-Math.abs(n))*(r>=0?1:-1));var s=Math.sqrt(n*n+r*r+i*i);return t[0]=n/s,t[1]=r/s,t[2]=i/s,t}},Gt=Ve.memory,jt=De.AABB3(),Wt=function(e){m(n,xt);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e,i))._state=new It({compressGeometry:!!i.compressGeometry,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),r._numTriangles=0,r._edgeThreshold=i.edgeThreshold||10,r._edgeIndicesBuf=null,r._pickTrianglePositionsBuf=null,r._pickTriangleColorsBuf=null,r._aabbDirty=!0,r._boundingSphere=!0,r._aabb=null,r._aabbDirty=!0,r._obb=null,r._obbDirty=!0;var s=r._state,a=r.scene.canvas.gl;switch(i.primitive=i.primitive||"triangles",i.primitive){case"points":s.primitive=a.POINTS,s.primitiveName=i.primitive;break;case"lines":s.primitive=a.LINES,s.primitiveName=i.primitive;break;case"line-loop":s.primitive=a.LINE_LOOP,s.primitiveName=i.primitive;break;case"line-strip":s.primitive=a.LINE_STRIP,s.primitiveName=i.primitive;break;case"triangles":s.primitive=a.TRIANGLES,s.primitiveName=i.primitive;break;case"triangle-strip":s.primitive=a.TRIANGLE_STRIP,s.primitiveName=i.primitive;break;case"triangle-fan":s.primitive=a.TRIANGLE_FAN,s.primitiveName=i.primitive;break;default:r.error("Unsupported value for 'primitive': '"+i.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=a.TRIANGLES,s.primitiveName=i.primitive}if(i.positions)if(r._state.compressGeometry){var o=Nt.getPositionsBounds(i.positions),A=Nt.compressPositions(i.positions,o.min,o.max);s.positions=A.quantized,s.positionsDecodeMatrix=A.decodeMatrix}else s.positions=i.positions.constructor===Float32Array?i.positions:new Float32Array(i.positions);if(i.colors&&(s.colors=i.colors.constructor===Float32Array?i.colors:new Float32Array(i.colors)),i.uv)if(r._state.compressGeometry){var c=Nt.getUVBounds(i.uv),l=Nt.compressUVs(i.uv,c.min,c.max);s.uv=l.quantized,s.uvDecodeMatrix=l.decodeMatrix}else s.uv=i.uv.constructor===Float32Array?i.uv:new Float32Array(i.uv);if(i.normals&&(r._state.compressGeometry?s.normals=Nt.compressNormals(i.normals):s.normals=i.normals.constructor===Float32Array?i.normals:new Float32Array(i.normals)),i.indices&&(s.indices=i.indices.constructor===Uint32Array||i.indices.constructor===Uint16Array?i.indices:new Uint32Array(i.indices),"triangles"===r._state.primitiveName&&(r._numTriangles=i.indices.length/3)),r._buildHash(),Gt.meshes++,s.indices&&(s.indicesBuf=new Tt(a,a.ELEMENT_ARRAY_BUFFER,s.indices,s.indices.length,1,a.STATIC_DRAW),Gt.indices+=s.indicesBuf.numItems),s.positions&&(s.positionsBuf=new Tt(a,a.ARRAY_BUFFER,s.positions,s.positions.length,3,a.STATIC_DRAW),Gt.positions+=s.positionsBuf.numItems),s.normals){var u=s.compressGeometry;s.normalsBuf=new Tt(a,a.ARRAY_BUFFER,s.normals,s.normals.length,3,a.STATIC_DRAW,u),Gt.normals+=s.normalsBuf.numItems}return s.colors&&(s.colorsBuf=new Tt(a,a.ARRAY_BUFFER,s.colors,s.colors.length,4,a.STATIC_DRAW),Gt.colors+=s.colorsBuf.numItems),s.uv&&(s.uvBuf=new Tt(a,a.ARRAY_BUFFER,s.uv,s.uv.length,2,a.STATIC_DRAW),Gt.uvs+=s.uvBuf.numItems),r}return I(n,[{key:"type",get:function(){return"ReadableGeometry"}},{key:"isReadableGeometry",get:function(){return!0}},{key:"_buildHash",value:function(){var e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positions&&t.push("p"),e.colors&&t.push("c"),(e.normals||e.autoVertexNormals)&&t.push("n"),e.uv&&t.push("u"),e.compressGeometry&&t.push("cp"),t.push(";"),e.hash=t.join("")}},{key:"_getEdgeIndices",value:function(){return this._edgeIndicesBuf||this._buildEdgeIndices(),this._edgeIndicesBuf}},{key:"_getPickTrianglePositions",value:function(){return this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs(),this._pickTrianglePositionsBuf}},{key:"_getPickTriangleColors",value:function(){return this._pickTriangleColorsBuf||this._buildPickTriangleVBOs(),this._pickTriangleColorsBuf}},{key:"_buildEdgeIndices",value:function(){var e=this._state;if(e.positions&&e.indices){var t=this.scene.canvas.gl,n=Pt(e.positions,e.indices,e.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new Tt(t,t.ELEMENT_ARRAY_BUFFER,n,n.length,1,t.STATIC_DRAW),Gt.indices+=this._edgeIndicesBuf.numItems}}},{key:"_buildPickTriangleVBOs",value:function(){var e=this._state;if(e.positions&&e.indices){var t=this.scene.canvas.gl,n=De.buildPickTriangles(e.positions,e.indices,e.compressGeometry),r=n.positions,i=n.colors;this._pickTrianglePositionsBuf=new Tt(t,t.ARRAY_BUFFER,r,r.length,3,t.STATIC_DRAW),this._pickTriangleColorsBuf=new Tt(t,t.ARRAY_BUFFER,i,i.length,4,t.STATIC_DRAW,!0),Gt.positions+=this._pickTrianglePositionsBuf.numItems,Gt.colors+=this._pickTriangleColorsBuf.numItems}}},{key:"_buildPickVertexVBOs",value:function(){}},{key:"primitive",get:function(){return this._state.primitiveName}},{key:"compressGeometry",get:function(){return this._state.compressGeometry}},{key:"positions",get:function(){return this._state.positions?this._state.compressGeometry?(this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),Nt.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions)),this._decompressedPositions):this._state.positions:null},set:function(e){var t=this._state,n=t.positions;if(n)if(n.length===e.length){if(this._state.compressGeometry){var r=Nt.getPositionsBounds(e),i=Nt.compressPositions(e,r.min,r.max);e=i.quantized,t.positionsDecodeMatrix=i.decodeMatrix}n.set(e),t.positionsBuf&&t.positionsBuf.setData(n),this._setAABBDirty(),this.glRedraw()}else this.error("can't update geometry positions - new positions are wrong length");else this.error("can't update geometry positions - geometry has no positions")}},{key:"normals",get:function(){if(this._state.normals){if(!this._state.compressGeometry)return this._state.normals;if(!this._decompressedNormals){var e=this._state.normals.length,t=e+e/2;this._decompressedNormals=new Float32Array(t),Nt.decompressNormals(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}},set:function(e){if(this._state.compressGeometry)this.error("can't update geometry normals - quantized geometry is immutable");else{var t=this._state,n=t.normals;n?n.length===e.length?(n.set(e),t.normalsBuf&&t.normalsBuf.setData(n),this.glRedraw()):this.error("can't update geometry normals - new normals are wrong length"):this.error("can't update geometry normals - geometry has no normals")}}},{key:"uv",get:function(){return this._state.uv?this._state.compressGeometry?(this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),Nt.decompressUVs(this._state.uv,this._state.uvDecodeMatrix,this._decompressedUV)),this._decompressedUV):this._state.uv:null},set:function(e){if(this._state.compressGeometry)this.error("can't update geometry UVs - quantized geometry is immutable");else{var t=this._state,n=t.uv;n?n.length===e.length?(n.set(e),t.uvBuf&&t.uvBuf.setData(n),this.glRedraw()):this.error("can't update geometry UVs - new UVs are wrong length"):this.error("can't update geometry UVs - geometry has no UVs")}}},{key:"colors",get:function(){return this._state.colors},set:function(e){if(this._state.compressGeometry)this.error("can't update geometry colors - quantized geometry is immutable");else{var t=this._state,n=t.colors;n?n.length===e.length?(n.set(e),t.colorsBuf&&t.colorsBuf.setData(n),this.glRedraw()):this.error("can't update geometry colors - new colors are wrong length"):this.error("can't update geometry colors - geometry has no colors")}}},{key:"indices",get:function(){return this._state.indices}},{key:"aabb",get:function(){return this._aabbDirty&&(this._aabb||(this._aabb=De.AABB3()),De.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),this._aabbDirty=!1),this._aabb}},{key:"obb",get:function(){return this._obbDirty&&(this._obb||(this._obb=De.OBB3()),De.positions3ToAABB3(this._state.positions,jt,this._state.positionsDecodeMatrix),De.AABB3ToOBB3(jt,this._obb),this._obbDirty=!1),this._obb}},{key:"_getMetrics",value:function(){if(!("_metrics"in this))switch(this._state.primitiveName){case"solid":case"surface":case"triangles":for(var e=this._state.indices,t=this._state.positions,n=function(n,r){for(var i=3*e[n],s=0;s<3;++s)r[s]=t[i+s];return r},r=[De.vec3(),De.vec3(),De.vec3(),De.vec3()],i=0,s=De.vec3([0,0,0]),a=0;a<e.length;a+=3){var o=n(a,r[0]),A=n(a+1,r[1]),c=n(a+2,r[2]);De.addVec3(o,A,r[3]),De.addVec3(c,r[3],r[3]);var l=De.lenVec3(De.cross3Vec3(De.subVec3(A,o,r[1]),De.subVec3(c,o,r[2]),r[0]))/2;i+=l,De.mulVec3Scalar(r[3],l,r[3]),De.addVec3(s,r[3],s)}this._metrics={surfaceArea:i,centroid:De.mulVec3Scalar(s,1/i/3,s)};break;default:this._metrics={surfaceArea:0}}return this._metrics}},{key:"surfaceArea",get:function(){return this._getMetrics().surfaceArea}},{key:"centroid",get:function(){return this._getMetrics().centroid}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"_setAABBDirty",value:function(){this._aabbDirty||(this._aabbDirty=!0,this._aabbDirty=!0,this._obbDirty=!0)}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this);var e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy(),this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy(),this._pickVertexPositionsBuf&&this._pickVertexPositionsBuf.destroy(),this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy(),e.destroy(),Gt.meshes--}}]),n}(),zt=Ve.memory,Xt=De.AABB3(),Kt=function(e){m(n,xt);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e,i))._state=new It({compressGeometry:!0,primitive:null,primitiveName:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),r._numTriangles=0,r._edgeThreshold=i.edgeThreshold||10,r._aabb=null,r._obb=De.OBB3();var s,a=r._state,o=r.scene.canvas.gl;switch(i.primitive=i.primitive||"triangles",i.primitive){case"points":a.primitive=o.POINTS,a.primitiveName=i.primitive;break;case"lines":a.primitive=o.LINES,a.primitiveName=i.primitive;break;case"line-loop":a.primitive=o.LINE_LOOP,a.primitiveName=i.primitive;break;case"line-strip":a.primitive=o.LINE_STRIP,a.primitiveName=i.primitive;break;case"triangles":a.primitive=o.TRIANGLES,a.primitiveName=i.primitive;break;case"triangle-strip":a.primitive=o.TRIANGLE_STRIP,a.primitiveName=i.primitive;break;case"triangle-fan":a.primitive=o.TRIANGLE_FAN,a.primitiveName=i.primitive;break;default:r.error("Unsupported value for 'primitive': '"+i.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),a.primitive=o.TRIANGLES,a.primitiveName=i.primitive}if(!i.positions)return r.error("Config expected: positions"),b(r);if(!i.indices)return r.error("Config expected: indices"),b(r);var A=i.positionsDecodeMatrix;if(A);else{var c=Nt.getPositionsBounds(i.positions),l=Nt.compressPositions(i.positions,c.min,c.max);s=l.quantized,a.positionsDecodeMatrix=l.decodeMatrix,a.positionsBuf=new Tt(o,o.ARRAY_BUFFER,s,s.length,3,o.STATIC_DRAW),zt.positions+=a.positionsBuf.numItems,De.positions3ToAABB3(i.positions,r._aabb),De.positions3ToAABB3(s,Xt,a.positionsDecodeMatrix),De.AABB3ToOBB3(Xt,r._obb)}if(i.colors){var u=i.colors.constructor===Float32Array?i.colors:new Float32Array(i.colors);a.colorsBuf=new Tt(o,o.ARRAY_BUFFER,u,u.length,4,o.STATIC_DRAW),zt.colors+=a.colorsBuf.numItems}if(i.uv){var h=Nt.getUVBounds(i.uv),d=Nt.compressUVs(i.uv,h.min,h.max),f=d.quantized;a.uvDecodeMatrix=d.decodeMatrix,a.uvBuf=new Tt(o,o.ARRAY_BUFFER,f,f.length,2,o.STATIC_DRAW),zt.uvs+=a.uvBuf.numItems}if(i.normals){var p=Nt.compressNormals(i.normals),v=a.compressGeometry;a.normalsBuf=new Tt(o,o.ARRAY_BUFFER,p,p.length,3,o.STATIC_DRAW,v),zt.normals+=a.normalsBuf.numItems}var g=i.indices.constructor===Uint32Array||i.indices.constructor===Uint16Array?i.indices:new Uint32Array(i.indices);a.indicesBuf=new Tt(o,o.ELEMENT_ARRAY_BUFFER,g,g.length,1,o.STATIC_DRAW),zt.indices+=a.indicesBuf.numItems;var m=Pt(s,g,a.positionsDecodeMatrix,r._edgeThreshold);return r._edgeIndicesBuf=new Tt(o,o.ELEMENT_ARRAY_BUFFER,m,m.length,1,o.STATIC_DRAW),"triangles"===r._state.primitiveName&&(r._numTriangles=i.indices.length/3),r._buildHash(),zt.meshes++,r}return I(n,[{key:"type",get:function(){return"VBOGeometry"}},{key:"isVBOGeometry",get:function(){return!0}},{key:"_buildHash",value:function(){var e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positionsBuf&&t.push("p"),e.colorsBuf&&t.push("c"),(e.normalsBuf||e.autoVertexNormals)&&t.push("n"),e.uvBuf&&t.push("u"),t.push("cp"),t.push(";"),e.hash=t.join("")}},{key:"_getEdgeIndices",value:function(){return this._edgeIndicesBuf}},{key:"primitive",get:function(){return this._state.primitiveName}},{key:"aabb",get:function(){return this._aabb}},{key:"obb",get:function(){return this._obb}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this);var e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),e.destroy(),zt.meshes--}}]),n}(),Zt={};function Jt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,r){t.src||(console.error("load3DSGeometry: Parameter expected: src"),r());var i=e.canvas.spinner;i.processes++,je.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("load3DSGeometry: no data loaded"),i.processes--,r());var s=Zt.parse.from3DS(e).edit.objects[0].mesh,a=s.vertices,o=s.uvt,A=s.indices;i.processes--,n(je.apply(t,{primitive:"triangles",positions:a,normals:null,uv:o,indices:A}))}),(function(e){console.error("load3DSGeometry: "+e),i.processes--,r()}))}))}function Yt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,r){t.src||(console.error("loadOBJGeometry: Parameter expected: src"),r());var i=e.canvas.spinner;i.processes++,je.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("loadOBJGeometry: no data loaded"),i.processes--,r());for(var s=Zt.parse.fromOBJ(e),a=Zt.edit.unwrap(s.i_verts,s.c_verts,3),o=Zt.edit.unwrap(s.i_norms,s.c_norms,3),A=Zt.edit.unwrap(s.i_uvt,s.c_uvt,2),c=new Int32Array(s.i_verts.length),l=0;l<s.i_verts.length;l++)c[l]=l;i.processes--,n(je.apply(t,{primitive:"triangles",positions:a,normals:o.length>0?o:null,autoNormals:0===o.length,uv:A,indices:c}))}),(function(e){console.error("loadOBJGeometry: "+e),i.processes--,r()}))}))}function qt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var n=e.ySize||1;n<0&&(console.error("negative ySize not allowed - will invert"),n*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var i=e.center,s=i?i[0]:0,a=i?i[1]:0,o=i?i[2]:0,A=-t+s,c=-n+a,l=-r+o,u=t+s,h=n+a,d=r+o;return je.apply(e,{positions:[u,h,d,A,h,d,A,c,d,u,c,d,u,h,d,u,c,d,u,c,l,u,h,l,u,h,d,u,h,l,A,h,l,A,h,d,A,h,d,A,h,l,A,c,l,A,c,d,A,c,l,u,c,l,u,c,d,A,c,d,u,c,l,A,c,l,A,h,l,u,h,l],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}function $t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var n=e.ySize||1;n<0&&(console.error("negative ySize not allowed - will invert"),n*=-1);var r=e.zSize||1;r<0&&(console.error("negative zSize not allowed - will invert"),r*=-1);var i=e.center,s=i?i[0]:0,a=i?i[1]:0,o=i?i[2]:0,A=-t+s,c=-n+a,l=-r+o,u=t+s,h=n+a,d=r+o;return je.apply(e,{primitive:"lines",positions:[A,c,l,A,c,d,A,h,l,A,h,d,u,c,l,u,c,d,u,h,l,u,h,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})}function en(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $t({id:e.id,center:[(e.aabb[0]+e.aabb[3])/2,(e.aabb[1]+e.aabb[4])/2,(e.aabb[2]+e.aabb[5])/2],xSize:Math.abs(e.aabb[3]-e.aabb[0])/2,ySize:Math.abs(e.aabb[4]-e.aabb[1])/2,zSize:Math.abs(e.aabb[5]-e.aabb[2])/2})}function tn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);var n=e.radiusBottom||1;n<0&&(console.error("negative radiusBottom not allowed - will invert"),n*=-1);var r=e.height||1;r<0&&(console.error("negative height not allowed - will invert"),r*=-1);var i=e.radialSegments||32;i<0&&(console.error("negative radialSegments not allowed - will invert"),i*=-1),i<3&&(i=3);var s=e.heightSegments||1;s<0&&(console.error("negative heightSegments not allowed - will invert"),s*=-1),s<1&&(s=1);var a,o,A,c,l,u,h,d,f,p,v,g=!!e.openEnded,m=e.center,y=m?m[0]:0,_=m?m[1]:0,b=m?m[2]:0,w=r/2,B=r/s,C=2*Math.PI/i,M=1/i,k=(t-n)/s,E=[],F=[],x=[],U=[],I=(90-180*Math.atan(r/(n-t))/Math.PI)/90;for(a=0;a<=s;a++)for(l=t-a*k,u=w-a*B,o=0;o<=i;o++)A=Math.sin(o*C),c=Math.cos(o*C),F.push(l*A),F.push(I),F.push(l*c),x.push(o*M),x.push(1*a/s),E.push(l*A+y),E.push(u+_),E.push(l*c+b);for(a=0;a<s;a++)for(o=0;o<=i;o++)d=(h=a*(i+1)+o)+i,U.push(h),U.push(d),U.push(d+1),U.push(h),U.push(d+1),U.push(h+1);if(!g&&t>0){for(f=E.length/3,F.push(0),F.push(1),F.push(0),x.push(.5),x.push(.5),E.push(0+y),E.push(w+_),E.push(0+b),o=0;o<=i;o++)A=Math.sin(o*C),c=Math.cos(o*C),p=.5*Math.sin(o*C)+.5,v=.5*Math.cos(o*C)+.5,F.push(t*A),F.push(1),F.push(t*c),x.push(p),x.push(v),E.push(t*A+y),E.push(w+_),E.push(t*c+b);for(o=0;o<i;o++)m=f,h=f+1+o,U.push(h),U.push(h+1),U.push(m)}if(!g&&n>0){for(f=E.length/3,F.push(0),F.push(-1),F.push(0),x.push(.5),x.push(.5),E.push(0+y),E.push(0-w+_),E.push(0+b),o=0;o<=i;o++)A=Math.sin(o*C),c=Math.cos(o*C),p=.5*Math.sin(o*C)+.5,v=.5*Math.cos(o*C)+.5,F.push(n*A),F.push(-1),F.push(n*c),x.push(p),x.push(v),E.push(n*A+y),E.push(0-w+_),E.push(n*c+b);for(o=0;o<i;o++)m=f,h=f+1+o,U.push(m),U.push(h+1),U.push(h)}return je.apply(e,{positions:E,normals:F,uv:x,indices:U})}function nn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);var n=e.divisions||1;n<0&&(console.error("negative divisions not allowed - will invert"),n*=-1),n<1&&(n=1);for(var r=(t=t||10)/(n=n||10),i=t/2,s=[],a=[],o=0,A=0,c=-i;A<=n;A++,c+=r)s.push(-i),s.push(0),s.push(c),s.push(i),s.push(0),s.push(c),s.push(c),s.push(0),s.push(-i),s.push(c),s.push(0),s.push(i),a.push(o++),a.push(o++),a.push(o++),a.push(o++);return je.apply(e,{primitive:"lines",positions:s,indices:a})}function rn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);var n=e.zSize||1;n<0&&(console.error("negative zSize not allowed - will invert"),n*=-1);var r=e.xSegments||1;r<0&&(console.error("negative xSegments not allowed - will invert"),r*=-1),r<1&&(r=1);var i=e.xSegments||1;i<0&&(console.error("negative zSegments not allowed - will invert"),i*=-1),i<1&&(i=1);var s,a,o,A,c,l,u,h=e.center,d=h?h[0]:0,f=h?h[1]:0,p=h?h[2]:0,v=t/2,g=n/2,m=Math.floor(r)||1,y=Math.floor(i)||1,_=m+1,b=y+1,w=t/m,B=n/y,C=new Float32Array(_*b*3),M=new Float32Array(_*b*3),k=new Float32Array(_*b*2),E=0,F=0;for(s=0;s<b;s++){var x=s*B-g;for(a=0;a<_;a++)o=a*w-v,C[E]=o+d,C[E+1]=f,C[E+2]=-x+p,M[E+1]=1,k[F]=a/m,k[F+1]=(y-s)/y,E+=3,F+=2}E=0;var U=new(C.length/3>65535?Uint32Array:Uint16Array)(m*y*6);for(s=0;s<y;s++)for(a=0;a<m;a++)A=a+_*s,c=a+_*(s+1),l=a+1+_*(s+1),u=a+1+_*s,U[E]=u,U[E+1]=c,U[E+2]=A,U[E+3]=u,U[E+4]=l,U[E+5]=c,E+=6;return je.apply(e,{positions:C,normals:M,uv:k,indices:U})}function sn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.lod||1,n=e.center?e.center[0]:0,r=e.center?e.center[1]:0,i=e.center?e.center[2]:0,s=e.radius||1;s<0&&(console.error("negative radius not allowed - will invert"),s*=-1);var a=e.heightSegments||18;a<0&&(console.error("negative heightSegments not allowed - will invert"),a*=-1),(a=Math.floor(t*a))<18&&(a=18);var o=e.widthSegments||18;o<0&&(console.error("negative widthSegments not allowed - will invert"),o*=-1),(o=Math.floor(t*o))<18&&(o=18);var A,c,l,u,h,d,f,p,v,g,m,y,_,b,w=[],B=[],C=[],M=[];for(A=0;A<=a;A++)for(l=A*Math.PI/a,u=Math.sin(l),h=Math.cos(l),c=0;c<=o;c++)d=2*c*Math.PI/o,f=Math.sin(d),p=Math.cos(d)*u,v=h,g=f*u,m=1-c/o,y=A/a,B.push(p),B.push(v),B.push(g),C.push(m),C.push(y),w.push(n+s*p),w.push(r+s*v),w.push(i+s*g);for(A=0;A<a;A++)for(c=0;c<o;c++)b=(_=A*(o+1)+c)+o+1,M.push(_+1),M.push(b+1),M.push(b),M.push(_+1),M.push(b),M.push(_);return je.apply(e,{positions:w,normals:B,uv:C,indices:M})}function an(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;var n=e.tube||.3;n<0&&(console.error("negative tube not allowed - will invert"),n*=-1);var r=e.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<4&&(r=4);var i=e.tubeSegments||24;i<0&&(console.error("negative tubeSegments not allowed - will invert"),i*=-1),i<4&&(i=4);var s=e.arc||2*Math.PI;s<0&&(console.warn("negative arc not allowed - will invert"),s*=-1),s>360&&(s=360);var a,o,A,c,l,u,h,d,f,p,v,g,m=e.center,y=m?m[0]:0,_=m?m[1]:0,b=m?m[2]:0,w=[],B=[],C=[],M=[];for(d=0;d<=i;d++)for(h=0;h<=r;h++)a=h/r*s,o=.785398+d/i*Math.PI*2,y=t*Math.cos(a),_=t*Math.sin(a),A=(t+n*Math.cos(o))*Math.cos(a),c=(t+n*Math.cos(o))*Math.sin(a),l=n*Math.sin(o),w.push(A+y),w.push(c+_),w.push(l+b),C.push(1-h/r),C.push(d/i),u=De.normalizeVec3(De.subVec3([A,c,l],[y,_,b],[]),[]),B.push(u[0]),B.push(u[1]),B.push(u[2]);for(d=1;d<=i;d++)for(h=1;h<=r;h++)f=(r+1)*d+h-1,p=(r+1)*(d-1)+h-1,v=(r+1)*(d-1)+h,g=(r+1)*d+h,M.push(f),M.push(p),M.push(v),M.push(v),M.push(g),M.push(f);return je.apply(e,{positions:w,normals:B,uv:C,indices:M})}Zt.load=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.responseType="arraybuffer",n.onload=function(e){t(e.target.response)},n.send()},Zt.save=function(e,t){var n="data:application/octet-stream;base64,"+btoa(Zt.parse._buffToStr(e));window.location.href=n},Zt.clone=function(e){return JSON.parse(JSON.stringify(e))},Zt.bin={},Zt.bin.f=new Float32Array(1),Zt.bin.fb=new Uint8Array(Zt.bin.f.buffer),Zt.bin.rf=function(e,t){for(var n=Zt.bin.f,r=Zt.bin.fb,i=0;i<4;i++)r[i]=e[t+i];return n[0]},Zt.bin.rsl=function(e,t){return e[t]|e[t+1]<<8},Zt.bin.ril=function(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},Zt.bin.rASCII0=function(e,t){for(var n="";0!=e[t];)n+=String.fromCharCode(e[t++]);return n},Zt.bin.wf=function(e,t,n){new Float32Array(e.buffer,t,1)[0]=n},Zt.bin.wsl=function(e,t,n){e[t]=n,e[t+1]=n>>8},Zt.bin.wil=function(e,t,n){e[t]=n,e[t+1]=n>>8,e[t+2]=n>>16,e[t+3]},Zt.parse={},Zt.parse._buffToStr=function(e){for(var t=new Uint8Array(e),n="",r=0;r<t.length;r++)n=n.concat(String.fromCharCode(t[r]));return n},Zt.parse._strToBuff=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return t},Zt.parse._readLine=function(e,t){for(var n="";10!=e[t];)n+=String.fromCharCode(e[t++]);return n},Zt.parse.fromJSON=function(e){return JSON.parse(Zt.parse._buffToStr(e))},Zt.parse.toJSON=function(e){var t=JSON.stringify(e);return Zt.parse._strToBuff(t)},Zt.parse.fromOBJ=function(e){for(var t={groups:{},c_verts:[],c_uvt:[],c_norms:[],i_verts:[],i_uvt:[],i_norms:[]},n={from:0,to:0},r=0,i=new Uint8Array(e);r<i.length;){var s=Zt.parse._readLine(i,r);r+=s.length+1;var a=(s=(s=s.replace(/ +(?= )/g,"")).replace(/(^\s+|\s+$)/g,"")).split(" ");if("g"==a[0]&&(n.to=t.i_verts.length,null==t.groups[a[1]]&&(t.groups[a[1]]={from:t.i_verts.length,to:0}),n=t.groups[a[1]]),"v"==a[0]){var o=parseFloat(a[1]),A=parseFloat(a[2]),c=parseFloat(a[3]);t.c_verts.push(o,A,c)}if("vt"==a[0]){o=parseFloat(a[1]),A=1-parseFloat(a[2]);t.c_uvt.push(o,A)}if("vn"==a[0]){o=parseFloat(a[1]),A=parseFloat(a[2]),c=parseFloat(a[3]);t.c_norms.push(o,A,c)}if("f"==a[0]){var l=a[1].split("/"),u=a[2].split("/"),h=a[3].split("/"),d=parseInt(l[0])-1,f=parseInt(u[0])-1,p=parseInt(h[0])-1,v=parseInt(l[1])-1,g=parseInt(u[1])-1,m=parseInt(h[1])-1,y=parseInt(l[2])-1,_=parseInt(u[2])-1,b=parseInt(h[2])-1,w=t.c_verts.length/3,B=t.c_uvt.length/2,C=t.c_norms.length/3;if(d<0&&(d=w+d+1),f<0&&(f=w+f+1),p<0&&(p=w+p+1),v<0&&(v=B+v+1),g<0&&(g=B+g+1),m<0&&(m=B+m+1),y<0&&(y=C+y+1),_<0&&(_=C+_+1),b<0&&(b=C+b+1),t.i_verts.push(d,f,p),t.i_uvt.push(v,g,m),t.i_norms.push(y,_,b),5==a.length){var M=a[4].split("/"),k=parseInt(M[0])-1,E=parseInt(M[1])-1,F=parseInt(M[2])-1;k<0&&(k=w+k+1),E<0&&(E=B+E+1),F<0&&(F=C+F+1),t.i_verts.push(d,p,k),t.i_uvt.push(v,m,E),t.i_norms.push(y,b,F)}}}return n.to=t.i_verts.length,t},Zt.parse.fromMD2=function(e){e=new Uint8Array(e);var t={},n={};n.ident=Zt.bin.ril(e,0),n.version=Zt.bin.ril(e,4),n.skinwidth=Zt.bin.ril(e,8),n.skinheight=Zt.bin.ril(e,12),n.framesize=Zt.bin.ril(e,16),n.num_skins=Zt.bin.ril(e,20),n.num_vertices=Zt.bin.ril(e,24),n.num_st=Zt.bin.ril(e,28),n.num_tris=Zt.bin.ril(e,32),n.num_glcmds=Zt.bin.ril(e,36),n.num_frames=Zt.bin.ril(e,40),n.offset_skins=Zt.bin.ril(e,44),n.offset_st=Zt.bin.ril(e,48),n.offset_tris=Zt.bin.ril(e,52),n.offset_frames=Zt.bin.ril(e,56),n.offset_glcmds=Zt.bin.ril(e,60),n.offset_end=Zt.bin.ril(e,64);var r=n.offset_st;t.c_uvt=[];for(var i=0;i<n.num_st;i++){var s=Zt.bin.rsl(e,r)/n.skinwidth,a=Zt.bin.rsl(e,r+2)/n.skinheight;t.c_uvt.push(s,a),r+=4}r=n.offset_tris;var o=[],A=[];t.i_verts=o,t.i_uvt=A;for(i=0;i<n.num_tris;i++)o.push(Zt.bin.rsl(e,r),Zt.bin.rsl(e,r+2),Zt.bin.rsl(e,r+4)),A.push(Zt.bin.rsl(e,r+6),Zt.bin.rsl(e,r+8),Zt.bin.rsl(e,r+10)),r+=12;r=n.offset_skins;t.skins=[];for(i=0;i<n.num_skins;i++)t.skins.push(Zt.bin.rASCII0(e,r)),r+=64;r=n.offset_frames;t.frames=[];var c=Zt.parse.fromMD2._normals;for(i=0;i<n.num_frames;i++){var l={},u=Zt.bin.rf(e,r),h=Zt.bin.rf(e,r+4),d=Zt.bin.rf(e,r+8);r+=12;var f=Zt.bin.rf(e,r),p=Zt.bin.rf(e,r+4),v=Zt.bin.rf(e,r+8);r+=12,l.name=Zt.bin.rASCII0(e,r),r+=16,l.verts=[],l.norms=[];for(var g=0;g<n.num_vertices;g++)l.verts.push(e[r]*u+f,e[r+1]*h+p,e[r+2]*d+v),l.norms.push(c[3*e[r+3]],c[3*e[r+3]+1],c[3*e[r+3]+2]),r+=4;t.frames.push(l)}return t},Zt.parse.fromMD2._normals=[-.525731,0,.850651,-.442863,.238856,.864188,-.295242,0,.955423,-.309017,.5,.809017,-.16246,.262866,.951056,0,0,1,0,.850651,.525731,-.147621,.716567,.681718,.147621,.716567,.681718,0,.525731,.850651,.309017,.5,.809017,.525731,0,.850651,.295242,0,.955423,.442863,.238856,.864188,.16246,.262866,.951056,-.681718,.147621,.716567,-.809017,.309017,.5,-.587785,.425325,.688191,-.850651,.525731,0,-.864188,.442863,.238856,-.716567,.681718,.147621,-.688191,.587785,.425325,-.5,.809017,.309017,-.238856,.864188,.442863,-.425325,.688191,.587785,-.716567,.681718,-.147621,-.5,.809017,-.309017,-.525731,.850651,0,0,.850651,-.525731,-.238856,.864188,-.442863,0,.955423,-.295242,-.262866,.951056,-.16246,0,1,0,0,.955423,.295242,-.262866,.951056,.16246,.238856,.864188,.442863,.262866,.951056,.16246,.5,.809017,.309017,.238856,.864188,-.442863,.262866,.951056,-.16246,.5,.809017,-.309017,.850651,.525731,0,.716567,.681718,.147621,.716567,.681718,-.147621,.525731,.850651,0,.425325,.688191,.587785,.864188,.442863,.238856,.688191,.587785,.425325,.809017,.309017,.5,.681718,.147621,.716567,.587785,.425325,.688191,.955423,.295242,0,1,0,0,.951056,.16246,.262866,.850651,-.525731,0,.955423,-.295242,0,.864188,-.442863,.238856,.951056,-.16246,.262866,.809017,-.309017,.5,.681718,-.147621,.716567,.850651,0,.525731,.864188,.442863,-.238856,.809017,.309017,-.5,.951056,.16246,-.262866,.525731,0,-.850651,.681718,.147621,-.716567,.681718,-.147621,-.716567,.850651,0,-.525731,.809017,-.309017,-.5,.864188,-.442863,-.238856,.951056,-.16246,-.262866,.147621,.716567,-.681718,.309017,.5,-.809017,.425325,.688191,-.587785,.442863,.238856,-.864188,.587785,.425325,-.688191,.688191,.587785,-.425325,-.147621,.716567,-.681718,-.309017,.5,-.809017,0,.525731,-.850651,-.525731,0,-.850651,-.442863,.238856,-.864188,-.295242,0,-.955423,-.16246,.262866,-.951056,0,0,-1,.295242,0,-.955423,.16246,.262866,-.951056,-.442863,-.238856,-.864188,-.309017,-.5,-.809017,-.16246,-.262866,-.951056,0,-.850651,-.525731,-.147621,-.716567,-.681718,.147621,-.716567,-.681718,0,-.525731,-.850651,.309017,-.5,-.809017,.442863,-.238856,-.864188,.16246,-.262866,-.951056,.238856,-.864188,-.442863,.5,-.809017,-.309017,.425325,-.688191,-.587785,.716567,-.681718,-.147621,.688191,-.587785,-.425325,.587785,-.425325,-.688191,0,-.955423,-.295242,0,-1,0,.262866,-.951056,-.16246,0,-.850651,.525731,0,-.955423,.295242,.238856,-.864188,.442863,.262866,-.951056,.16246,.5,-.809017,.309017,.716567,-.681718,.147621,.525731,-.850651,0,-.238856,-.864188,-.442863,-.5,-.809017,-.309017,-.262866,-.951056,-.16246,-.850651,-.525731,0,-.716567,-.681718,-.147621,-.716567,-.681718,.147621,-.525731,-.850651,0,-.5,-.809017,.309017,-.238856,-.864188,.442863,-.262866,-.951056,.16246,-.864188,-.442863,.238856,-.809017,-.309017,.5,-.688191,-.587785,.425325,-.681718,-.147621,.716567,-.442863,-.238856,.864188,-.587785,-.425325,.688191,-.309017,-.5,.809017,-.147621,-.716567,.681718,-.425325,-.688191,.587785,-.16246,-.262866,.951056,.442863,-.238856,.864188,.16246,-.262866,.951056,.309017,-.5,.809017,.147621,-.716567,.681718,0,-.525731,.850651,.425325,-.688191,.587785,.587785,-.425325,.688191,.688191,-.587785,.425325,-.955423,.295242,0,-.951056,.16246,.262866,-1,0,0,-.850651,0,.525731,-.955423,-.295242,0,-.951056,-.16246,.262866,-.864188,.442863,-.238856,-.951056,.16246,-.262866,-.809017,.309017,-.5,-.864188,-.442863,-.238856,-.951056,-.16246,-.262866,-.809017,-.309017,-.5,-.681718,.147621,-.716567,-.681718,-.147621,-.716567,-.850651,0,-.525731,-.688191,.587785,-.425325,-.587785,.425325,-.688191,-.425325,.688191,-.587785,-.425325,-.688191,-.587785,-.587785,-.425325,-.688191,-.688191,-.587785,-.425325],Zt.parse.fromCollada=function(e){var t=Zt.parse._buffToStr(e),n=(new DOMParser).parseFromString(t,"text/xml"),r={},i=(n=n.childNodes[0]).getElementsByTagName("asset")[0],s=n.getElementsByTagName("library_geometries")[0],a=n.getElementsByTagName("library_images")[0],o=n.getElementsByTagName("library_materials")[0],A=n.getElementsByTagName("library_effects")[0];return i&&(r.asset=Zt.parse.fromCollada._asset(i)),s&&(r.geometries=Zt.parse.fromCollada._libGeometries(s)),a&&(r.images=Zt.parse.fromCollada._libImages(a)),o&&(r.materials=Zt.parse.fromCollada._libMaterials(o)),A&&(r.effects=Zt.parse.fromCollada._libEffects(A)),r},Zt.parse.fromCollada._asset=function(e){return{created:e.getElementsByTagName("created")[0].textContent,modified:e.getElementsByTagName("modified")[0].textContent,up_axis:e.getElementsByTagName("up_axis")[0].textContent}},Zt.parse.fromCollada._libGeometries=function(e){e=e.getElementsByTagName("geometry");for(var t=[],n=0;n<e.length;n++){var r=e[n],i=Zt.parse.fromCollada._getMesh(r.getElementsByTagName("mesh")[0]);t.push(i)}return t},Zt.parse.fromCollada._getMesh=function(e){for(var t={},n=e.getElementsByTagName("source"),r=t.sources={},i=0;i<n.length;i++){for(var s=n[i].getElementsByTagName("float_array")[0].textContent.split(" "),a=s.length-(""==s[s.length-1]?1:0),o=new Array(a),A=0;A<a;A++)o[A]=parseFloat(s[A]);r[n[i].getAttribute("id")]=o}t.triangles=[];var c=e.getElementsByTagName("triangles");if(null==c)return t;for(i=0;i<c.length;i++){var l={},u=c[i];l.material=u.getAttribute("material");var h=u.getElementsByTagName("input"),d=[];for(A=0;A<h.length;A++){var f=h[A];o=[];d[parseInt(f.getAttribute("offset"))]=o;var p=f.getAttribute("semantic");l["s_"+p]="VERTEX"==p?e.getElementsByTagName("vertices")[0].getElementsByTagName("input")[0].getAttribute("source").substring(1):f.getAttribute("source").substring(1),l["i_"+p]=o,r[l["s_"+p]]}var v=u.getElementsByTagName("p")[0].textContent.split(" "),g=3*Math.floor(v.length/3);for(A=0;A<g;A++)d[A%h.length].push(parseInt(v[A]));t.triangles.push(l)}return t},Zt.parse.fromCollada._libImages=function(e){e=e.getElementsByTagName("image");for(var t={},n=0;n<e.length;n++)t[e[n].getAttribute("id")]=e[n].getElementsByTagName("init_from")[0].textContent;return t},Zt.parse.fromCollada._libMaterials=function(e){e=e.getElementsByTagName("material");for(var t={},n=0;n<e.length;n++)t[e[n].getAttribute("name")]=e[n].getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1);return t},Zt.parse.fromCollada._libEffects=function(e){e=e.getElementsByTagName("effect");for(var t={},n=0;n<e.length;n++){for(var r={},i=e[n].getElementsByTagName("newparam"),s=0;s<i.length;s++){var a=i[s].getElementsByTagName("surface")[0];a&&(r.surface=a.getElementsByTagName("init_from")[0].textContent)}t[e[n].getAttribute("id")]=r}return t},Zt.parse.from3DS=function(e){e=new Uint8Array(e);var t={};if(19789!=Zt.bin.rsl(e,0))return null;for(var n=Zt.bin.ril(e,2),r=6;r<n;){var i=Zt.bin.rsl(e,r),s=Zt.bin.ril(e,r+2);15677==i&&(t.edit=Zt.parse.from3DS._edit3ds(e,r,s)),45056==i&&(t.keyf=Zt.parse.from3DS._keyf3ds(e,r,s)),r+=s}return t},Zt.parse.from3DS._edit3ds=function(e,t,n){for(var r={},i=t+6;i<t+n;){var s=Zt.bin.rsl(e,i),a=Zt.bin.ril(e,i+2);16384==s&&(null==r.objects&&(r.objects=[]),r.objects.push(Zt.parse.from3DS._edit_object(e,i,a))),i+=a}return r},Zt.parse.from3DS._keyf3ds=function(e,t,n){for(var r={},i=t+6;i<t+n;){var s=Zt.bin.rsl(e,i),a=Zt.bin.ril(e,i+2);45058==s&&(null==r.desc&&(r.desc=[]),r.desc.push(Zt.parse.from3DS._keyf_objdes(e,i,a))),i+=a}return r},Zt.parse.from3DS._keyf_objdes=function(e,t,n){for(var r={},i=t+6;i<t+n;){var s=Zt.bin.rsl(e,i),a=Zt.bin.ril(e,i+2);45072==s&&(r.hierarchy=Zt.parse.from3DS._keyf_objhierarch(e,i,a)),45073==s&&(r.dummy_name=Zt.bin.rASCII0(e,i+6)),i+=a}return r},Zt.parse.from3DS._keyf_objhierarch=function(e,t,n){var r={},i=t+6;return r.name=Zt.bin.rASCII0(e,i),i+=r.name.length+1,r.hierarchy=Zt.bin.rsl(e,i+4),r},Zt.parse.from3DS._edit_object=function(e,t,n){var r={},i=t+6;for(r.name=Zt.bin.rASCII0(e,i),i+=r.name.length+1;i<t+n;){var s=Zt.bin.rsl(e,i),a=Zt.bin.ril(e,i+2);16640==s&&(r.mesh=Zt.parse.from3DS._obj_trimesh(e,i,a)),i+=a}return r},Zt.parse.from3DS._obj_trimesh=function(e,t,n){for(var r={},i=t+6;i<t+n;){var s=Zt.bin.rsl(e,i),a=Zt.bin.ril(e,i+2);16656==s&&(r.vertices=Zt.parse.from3DS._tri_vertexl(e,i,a)),16672==s&&(r.indices=Zt.parse.from3DS._tri_facel1(e,i,a)),16704==s&&(r.uvt=Zt.parse.from3DS._tri_mappingcoors(e,i,a)),16736==s&&(r.local=Zt.parse.from3DS._tri_local(e,i,a)),i+=a}return r},Zt.parse.from3DS._tri_vertexl=function(e,t,n){var r=[],i=t+6,s=Zt.bin.rsl(e,i);i+=2;for(var a=0;a<s;a++)r.push(Zt.bin.rf(e,i)),r.push(Zt.bin.rf(e,i+4)),r.push(Zt.bin.rf(e,i+8)),i+=12;return r},Zt.parse.from3DS._tri_facel1=function(e,t,n){var r=[],i=t+6,s=Zt.bin.rsl(e,i);i+=2;for(var a=0;a<s;a++)r.push(Zt.bin.rsl(e,i)),r.push(Zt.bin.rsl(e,i+2)),r.push(Zt.bin.rsl(e,i+4)),i+=8;return r},Zt.parse.from3DS._tri_mappingcoors=function(e,t,n){var r=[],i=t+6,s=Zt.bin.rsl(e,i);i+=2;for(var a=0;a<s;a++)r.push(Zt.bin.rf(e,i)),r.push(1-Zt.bin.rf(e,i+4)),i+=8;return r},Zt.parse.from3DS._tri_local=function(e,t,n){var r={},i=t+6;return r.X=[Zt.bin.rf(e,i),Zt.bin.rf(e,i+4),Zt.bin.rf(e,i+8)],i+=12,r.Y=[Zt.bin.rf(e,i),Zt.bin.rf(e,i+4),Zt.bin.rf(e,i+8)],i+=12,r.Z=[Zt.bin.rf(e,i),Zt.bin.rf(e,i+4),Zt.bin.rf(e,i+8)],i+=12,r.C=[Zt.bin.rf(e,i),Zt.bin.rf(e,i+4),Zt.bin.rf(e,i+8)],i+=12,r},Zt.parse.fromBIV=function(e){e=new Uint8Array(e);var t={},n={};return n.id=Zt.bin.ril(e,0),n.verS=Zt.bin.ril(e,4),n.texS=Zt.bin.ril(e,8),n.indS=Zt.bin.ril(e,12),n.verO=Zt.bin.ril(e,16),n.verL=Zt.bin.ril(e,20),n.texO=Zt.bin.ril(e,24),n.texL=Zt.bin.ril(e,28),n.indO=Zt.bin.ril(e,32),n.indL=Zt.bin.ril(e,36),0!=n.verO&&(t.vertices=Zt.parse.fromBIV._readFloats(e,n.verO,n.verL)),0!=n.texO&&(t.uvt=Zt.parse.fromBIV._readFloats(e,n.texO,n.texL)),0!=n.indO&&(t.indices=Zt.parse.fromBIV._readInts(e,n.indO,n.indL,n.indS)),t},Zt.parse.toBIV=function(e){for(var t=0,n=0;n<e.indices.length;n++)t=Math.max(t,e.indices[n]);var r=32;t<=65535&&(r=16);var i=40;e.vertices&&(i+=4*e.vertices.length),e.uvt&&(i+=4*e.uvt.length),e.indices&&(i+=e.indices.length*r/8);var s=new Uint8Array(i);Zt.bin.wil(s,0,1769365870),Zt.bin.wil(s,4,32),Zt.bin.wil(s,8,32),Zt.bin.wil(s,12,r);var a=40;return e.vertices&&(Zt.bin.wil(s,16,a),Zt.bin.wil(s,20,4*e.vertices.length),Zt.parse.fromBIV._writeFloats(s,a,e.vertices),a+=4*e.vertices.length),e.uvt&&(Zt.bin.wil(s,24,a),Zt.bin.wil(s,28,4*e.uvt.length),Zt.parse.fromBIV._writeFloats(s,a,e.uvt),a+=4*e.uvt.length),e.indices&&(Zt.bin.wil(s,32,a),Zt.bin.wil(s,36,4*e.indices.length),Zt.parse.fromBIV._writeInts(s,a,e.indices,r)),s.buffer},Zt.parse.fromBIV._readFloats=function(e,t,n){for(var r=[],i=0;i<n/4;i++)r.push(Zt.bin.rf(e,t+4*i));return r},Zt.parse.fromBIV._writeFloats=function(e,t,n){for(var r=0;r<n.length;r++)Zt.bin.wf(e,t+4*r,n[r])},Zt.parse.fromBIV._readInts=function(e,t,n,r){for(var i=[],s=0;s<n/4;s++)16==r&&i.push(Zt.bin.rsl(e,t+2*s)),32==r&&i.push(Zt.bin.ril(e,t+4*s));return i},Zt.parse.fromBIV._writeInts=function(e,t,n,r){for(var i=0;i<n.length;i++)16==r&&Zt.bin.wsl(e,t+2*i,n[i]),32==r&&Zt.bin.wil(e,t+4*i,n[i])},Zt.gen={},Zt.gen.Plane=function(e,t,n,r){n||(n=1),r||(r=1);for(var i={verts:[],inds:[],uvt:[]},s=e+1,a=t+1,o=0;o<a;o++)for(var A=0;A<s;A++){var c=A*(2/e)-1,l=o*(2/t)-1;i.verts.push(c,l,0),i.uvt.push(n*A/e,r*o/t),o<t&&A<e&&i.inds.push(o*s+A,o*s+A+1,(o+1)*s+A,o*s+A+1,(o+1)*s+A,(o+1)*s+A+1)}return i},Zt.gen.Cube=function(){return{verts:[-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],inds:[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11,12,13,14,13,14,15,16,17,18,17,18,19,20,21,22,21,22,23],uvt:[1/4,1/4,.5,1/4,1/4,.5,.5,.5,1,1/4,3/4,1/4,1,.5,3/4,.5,0,1/4,1/4,1/4,0,.5,1/4,.5,3/4,1/4,.5,1/4,3/4,.5,.5,.5,1/4,1/4,.5,1/4,1/4,0,.5,0,1/4,.5,.5,.5,1/4,3/4,.5,3/4]}},Zt.gen.Sphere=function(e,t){for(var n={verts:[],inds:[],uvt:[]},r=e+1,i=t+1,s=0;s<i;s++)for(var a=0;a<r;a++){var o=-Math.PI/2+s*Math.PI/t,A=2*a*Math.PI/e,c=Math.cos(o)*Math.cos(A),l=Math.sin(o),u=Math.cos(o)*Math.sin(A);n.verts.push(c,l,u),n.uvt.push(a/e,s/t),s<t&&a<e&&n.inds.push(r*s+a,r*s+a+1,r*(s+1)+a,r*s+a+1,r*(s+1)+a,r*(s+1)+a+1)}return n},Zt.mat={},Zt.mat.scale=function(e,t,n){return[e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1]},Zt.mat.translate=function(e,t,n){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,n,1]},Zt.mat.rotateDeg=function(e,t,n){var r=Math.PI/180;return Zt.mat.rotate(e*r,t*r,n*r)},Zt.mat.rotate=function(e,t,n){var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=e,s=t,a=n,o=Math.cos(i),A=Math.cos(s),c=Math.cos(a),l=Math.sin(i),u=Math.sin(s),h=Math.sin(a);return r[0]=A*c,r[1]=-A*h,r[2]=u,r[4]=o*h+l*u*c,r[5]=o*c-l*u*h,r[6]=-l*A,r[8]=l*h-o*u*c,r[9]=l*c+o*u*h,r[10]=o*A,r},Zt.edit={},Zt.edit.interpolate=function(e,t,n,r){for(var i=0;i<e.length;i++)n[i]=e[i]+r*(t[i]-e[i])},Zt.edit.transform=function(e,t){for(var n=0;n<e.length;n+=3){var r=e[n],i=e[n+1],s=e[n+2];e[n+0]=t[0]*r+t[4]*i+t[8]*s+t[12],e[n+1]=t[1]*r+t[5]*i+t[9]*s+t[13],e[n+2]=t[2]*r+t[6]*i+t[10]*s+t[14]}},Zt.edit.unwrap=function(e,t,n){for(var r=new Array(Math.floor(e.length/3)*n),i=0;i<e.length;i++)for(var s=0;s<n;s++)r[i*n+s]=t[e[i]*n+s];return r},Zt.edit.remap=function(e,t,n,r){for(var i=new Array(n.length),s=0;s<e.length;s++)for(var a=0;a<r;a++)i[t[s]*r+a]=n[e[s]*r+a];return i},Zt.utils={},Zt.utils.getAABB=function(e){var t,n,r,i,s,a;i=s=a=-(t=n=r=999999999);for(var o=0;o<e.length;o+=3){var A=e[o+0],c=e[o+1],l=e[o+2];A<t&&(t=A),A>i&&(i=A),c<n&&(n=c),c>s&&(s=c),l<r&&(r=l),c>a&&(a=l)}return{min:{x:t,y:n,z:r},max:{x:i,y:s,z:a}}};var on={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function An(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.origin||[0,0,0],n=t[0],r=t[1],i=t[2],s=e.size||1,a=[],o=[],A=e.text;je.isNumeric(A)&&(A=""+A);for(var c,l,u,h,d,f,p,v,g,m=(A||"").split("\n"),y=0,_=0,b=.04,w=0;w<m.length;w++){c=0,u=(l=m[w]).length;for(var B=0;B<u;B++)if(h=on[l.charAt(B)]){d=1,f=-1,p=-1,v=h.points.length;for(var C=0;C<v;C++)-1!==(g=h.points[C])[0]||-1!==g[1]?(a.push(c+g[0]*s*b+n),a.push(_+g[1]*s*b+r),a.push(0+i),-1===f?f=y:(-1===p||(f=p),p=y),y++,d?d=!1:(o.push(f),o.push(p))):d=1;c+=h.width*b*s}_-=35*b*s}return je.apply(e,{primitive:"lines",positions:a,indices:o})}function cn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(e.points.length%3!=0)throw"Size of points array for given polyline should be divisible by 3";var t=e.points.length/3;if(t<2)throw"There should be at least 2 points to create a polyline";for(var n=[],r=0;r<t-1;r++)n.push(r),n.push(r+1);return je.apply(e,{primitive:"lines",positions:e.points,indices:n})}function ln(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.curve.getPoints(e.divisions).map((function(e){return p(e)})).flat();return cn({id:e.id,points:t})}function un(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(3!==e.startPoint.length)throw"Start point should contain 3 elements in array: x, y and z";if(3!==e.endPoint.length)throw"End point should contain 3 elements in array: x, y and z";var t=[],n=[],r=e.startPoint[0],i=e.startPoint[1],s=e.startPoint[2],a=e.endPoint[0],o=e.endPoint[1],A=e.endPoint[2],c=Math.sqrt(Math.pow(a-r,2)+Math.pow(o-i,2)+Math.pow(A-s,2)),l=[(a-r)/c,(o-i)/c,(A-s)/c];if(e.pattern){var u=e.pattern.length,h=!1,d=0,f=0,p=0,v=[r,i,s],g=e.pattern[f];for(n.push(v[0],v[1],v[2]);g<=c-d;){var m=[l[0]*g,l[1]*g,l[2]*g],y=[v[0]+m[0],v[1]+m[1],v[2]+m[2]];n.push(y[0],y[1],y[2]),h||(t.push(p),t.push(p+1)),h=!h,p+=1,v=y,(f+=1)>=u&&(f=0),d+=g,g=e.pattern[f]}e.extendToEnd&&(n.push(a,o,A),t.push(t.length-2),t.push(t.length-1))}else t.push(0),t.push(1),n.push(r,i,s,a,o,A);return je.apply(e,{primitive:"lines",positions:n,indices:t})}var hn=De.vec4(4),dn=De.vec4(),fn=De.vec4(),pn=De.vec3([1,0,0]),vn=De.vec3([0,1,0]),gn=De.vec3([0,0,1]),mn=De.vec3(3),yn=De.vec3(3),_n=De.identityMat4(),bn=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,n),(r=t.call(this,e,i))._parentNode=null,r._children=[],r._aabb=null,r._aabbDirty=!0,r.scene._aabbDirty=!0,r._numTriangles=0,r._scale=De.vec3(),r._quaternion=De.identityQuaternion(),r._rotation=De.vec3(),r._position=De.vec3(),r._offset=De.vec3(),r._localMatrix=De.identityMat4(),r._worldMatrix=De.identityMat4(),r._localMatrixDirty=!0,r._worldMatrixDirty=!0,i.matrix?r.matrix=i.matrix:(r.scale=i.scale,r.position=i.position,i.quaternion||(r.rotation=i.rotation)),r._isModel=i.isModel,r._isModel&&r.scene._registerModel(w(r)),r._isObject=i.isObject,r._isObject&&r.scene._registerObject(w(r)),r.origin=i.origin,r.visible=i.visible,r.culled=i.culled,r.pickable=i.pickable,r.clippable=i.clippable,r.collidable=i.collidable,r.castsShadow=i.castsShadow,r.receivesShadow=i.receivesShadow,r.xrayed=i.xrayed,r.highlighted=i.highlighted,r.selected=i.selected,r.edges=i.edges,r.colorize=i.colorize,r.opacity=i.opacity,r.offset=i.offset,i.children)for(var s=i.children,a=0,o=s.length;a<o;a++)r.addChild(s[a],i.inheritStates);if(i.parentId){var A=r.scene.components[i.parentId];A?A.isNode?A.addChild(w(r)):r.error("Parent is not a Node: '"+i.parentId+"'"):r.error("Parent not found: '"+i.parentId+"'")}else i.parent&&(i.parent.isNode||r.error("Parent is not a Node"),i.parent.addChild(w(r)));return r}return I(n,[{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return this._isObject}},{key:"aabb",get:function(){return this._aabbDirty&&this._updateAABB(),this._aabb}},{key:"origin",get:function(){return this._origin},set:function(e){e?(this._origin||(this._origin=De.vec3()),this._origin.set(e)):this._origin&&(this._origin=null);for(var t=0,n=this._children.length;t<n;t++)this._children[t].origin=e;this.glRedraw()}},{key:"rtcCenter",get:function(){return this.origin},set:function(e){this.origin=e}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"visible",get:function(){return this._visible},set:function(e){e=!1!==e,this._visible=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].visible=e;this._isObject&&this.scene._objectVisibilityUpdated(this,e)}},{key:"xrayed",get:function(){return this._xrayed},set:function(e){e=!!e,this._xrayed=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].xrayed=e;this._isObject&&this.scene._objectXRayedUpdated(this,e)}},{key:"highlighted",get:function(){return this._highlighted},set:function(e){e=!!e,this._highlighted=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].highlighted=e;this._isObject&&this.scene._objectHighlightedUpdated(this,e)}},{key:"selected",get:function(){return this._selected},set:function(e){e=!!e,this._selected=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].selected=e;this._isObject&&this.scene._objectSelectedUpdated(this,e)}},{key:"edges",get:function(){return this._edges},set:function(e){e=!!e,this._edges=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].edges=e}},{key:"culled",get:function(){return this._culled},set:function(e){e=!!e,this._culled=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].culled=e}},{key:"clippable",get:function(){return this._clippable},set:function(e){e=!1!==e,this._clippable=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].clippable=e}},{key:"collidable",get:function(){return this._collidable},set:function(e){e=!1!==e,this._collidable=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].collidable=e}},{key:"pickable",get:function(){return this._pickable},set:function(e){e=!1!==e,this._pickable=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].pickable=e}},{key:"colorize",get:function(){return this._colorize.slice(0,3)},set:function(e){var t=this._colorize;t||((t=this._colorize=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);for(var n=0,r=this._children.length;n<r;n++)this._children[n].colorize=t;if(this._isObject){var i=!!e;this.scene._objectColorizeUpdated(this,i)}}},{key:"opacity",get:function(){return this._colorize[3]},set:function(e){var t=this._colorize;t||((t=this._colorize=new Float32Array(4))[0]=1,t[1]=1,t[2]=1),t[3]=null!=e?e:1;for(var n=0,r=this._children.length;n<r;n++)this._children[n].opacity=e;if(this._isObject){var i=null!=e;this.scene._objectOpacityUpdated(this,i)}}},{key:"castsShadow",get:function(){return this._castsShadow},set:function(e){e=!!e,this._castsShadow=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].castsShadow=e}},{key:"receivesShadow",get:function(){return this._receivesShadow},set:function(e){e=!!e,this._receivesShadow=e;for(var t=0,n=this._children.length;t<n;t++)this._children[t].receivesShadow=e}},{key:"saoEnabled",get:function(){return!1}},{key:"offset",get:function(){return this._offset},set:function(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(var t=0,n=this._children.length;t<n;t++)this._children[t].offset=this._offset;this._isObject&&this.scene._objectOffsetUpdated(this,e)}},{key:"isNode",get:function(){return!0}},{key:"_setLocalMatrixDirty",value:function(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}},{key:"_setWorldMatrixDirty",value:function(){this._worldMatrixDirty=!0;for(var e=0,t=this._children.length;e<t;e++)this._children[e]._setWorldMatrixDirty()}},{key:"_buildWorldMatrix",value:function(){var e=this.matrix;if(this._parentNode)De.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(var t=0,n=e.length;t<n;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}},{key:"_setSubtreeAABBsDirty",value:function(e){if(e._aabbDirty=!0,e._children)for(var t=0,n=e._children.length;t<n;t++)this._setSubtreeAABBsDirty(e._children[t])}},{key:"_setAABBDirty",value:function(){if(this._setSubtreeAABBsDirty(this),this.collidable)for(var e=this;e;e=e._parentNode)e._aabbDirty=!0}},{key:"_updateAABB",value:function(){if(this.scene._aabbDirty=!0,this._aabb||(this._aabb=De.AABB3()),this._buildAABB)this._buildAABB(this.worldMatrix,this._aabb);else{var e;De.collapseAABB3(this._aabb);for(var t=0,n=this._children.length;t<n;t++)(e=this._children[t]).collidable&&De.expandAABB3(this._aabb,e.aabb)}this._aabbDirty=!1}},{key:"addChild",value:function(e,t){if(je.isNumeric(e)||je.isString(e)){var n=e;if(!(e=this.scene.component[n]))return void this.warn("Component not found: "+je.inQuotes(n));if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+n)}else{if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+e.id);if(e._parentNode){if(e._parentNode.id===this.id)return void this.warn("Already a child: "+e.id);e._parentNode.removeChild(e)}}if(e.id,e.scene.id===this.scene.id)return this._children.push(e),e._parentNode=this,t&&(e.visible=this.visible,e.culled=this.culled,e.xrayed=this.xrayed,e.highlited=this.highlighted,e.selected=this.selected,e.edges=this.edges,e.clippable=this.clippable,e.pickable=this.pickable,e.collidable=this.collidable,e.castsShadow=this.castsShadow,e.receivesShadow=this.receivesShadow,e.colorize=this.colorize,e.opacity=this.opacity,e.offset=this.offset),e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles+=e.numTriangles,e;this.error("Child not in same Scene: "+e.id)}},{key:"removeChild",value:function(e){for(var t=0,n=this._children.length;t<n;t++)if(this._children[t].id===e.id)return e._parentNode=null,this._children=this._children.splice(t,1),e._setWorldMatrixDirty(),e._setAABBDirty(),this._setAABBDirty(),void(this._numTriangles-=e.numTriangles)}},{key:"removeChildren",value:function(){for(var e,t=0,n=this._children.length;t<n;t++)(e=this._children[t])._parentNode=null,e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles-=e.numTriangles;this._children=[],this._setAABBDirty()}},{key:"numChildren",get:function(){return this._children.length}},{key:"children",get:function(){return this._children}},{key:"parent",get:function(){return this._parentNode},set:function(e){if(je.isNumeric(e)||je.isString(e)){var t=e;if(!(e=this.scene.components[t]))return void this.warn("Node not found: "+je.inQuotes(t));if(!e.isNode)return void this.error("Not a Node: "+e.id)}e.scene.id===this.scene.id?this._parentNode&&this._parentNode.id===e.id?this.warn("Already a child of Node: "+e.id):e.addChild(this):this.error("Node not in same Scene: "+e.id)}},{key:"position",get:function(){return this._position},set:function(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation.set(e||[0,0,0]),De.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"quaternion",get:function(){return this._quaternion},set:function(e){this._quaternion.set(e||[0,0,0,1]),De.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"matrix",get:function(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=De.identityMat4()),De.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix},set:function(e){this._localMatrix||(this._localMatrix=De.identityMat4()),this._localMatrix.set(e||_n),De.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"worldMatrix",get:function(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}},{key:"rotate",value:function(e,t){return hn[0]=e[0],hn[1]=e[1],hn[2]=e[2],hn[3]=t*De.DEGTORAD,De.angleAxisToQuaternion(hn,dn),De.mulQuaternions(this.quaternion,dn,fn),this.quaternion=fn,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"rotateOnWorldAxis",value:function(e,t){return hn[0]=e[0],hn[1]=e[1],hn[2]=e[2],hn[3]=t*De.DEGTORAD,De.angleAxisToQuaternion(hn,dn),De.mulQuaternions(dn,this.quaternion,dn),this}},{key:"rotateX",value:function(e){return this.rotate(pn,e)}},{key:"rotateY",value:function(e){return this.rotate(vn,e)}},{key:"rotateZ",value:function(e){return this.rotate(gn,e)}},{key:"translate",value:function(e,t){return De.vec3ApplyQuaternion(this.quaternion,e,mn),De.mulVec3Scalar(mn,t,yn),De.addVec3(this.position,yn,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"translateX",value:function(e){return this.translate(pn,e)}},{key:"translateY",value:function(e){return this.translate(vn,e)}},{key:"translateZ",value:function(e){return this.translate(gn,e)}},{key:"type",get:function(){return"Node"}},{key:"destroy",value:function(){if(v(C(n.prototype),"destroy",this).call(this),this._parentNode&&this._parentNode.removeChild(this),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.offset.some((function(e){return 0!==e}))&&this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this._children.length)for(var e=this._children.splice(0),t=0,r=e.length;t<r;t++)e[t].destroy();this._children=[],this._setAABBDirty(),this.scene._aabbDirty=!0}}]),n}(),wn=De.vec3(),Bn=function(){var e=new Float64Array(16),t=new Float64Array(4),n=new Float64Array(4);return function(r,i,s){return s=s||e,t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=1,De.transformVec4(r,t,n),De.setMat4Translation(r,n,s),s.slice()}}();function Cn(e,t,n){var r=Float32Array.from([e[0]])[0],i=e[0]-r,s=Float32Array.from([e[1]])[0],a=e[1]-s,o=Float32Array.from([e[2]])[0],A=e[2]-o;t[0]=r,t[1]=s,t[2]=o,n[0]=i,n[1]=a,n[2]=A}function Mn(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e3,i=De.getPositionsCenter(e,wn),s=Math.round(i[0]/r)*r,a=Math.round(i[1]/r)*r,o=Math.round(i[2]/r)*r;n[0]=s,n[1]=a,n[2]=o;var A=0!==n[0]||0!==n[1]||0!==n[2];if(A)for(var c=0,l=e.length;c<l;c+=3)t[c+0]=e[c+0]-s,t[c+1]=e[c+1]-a,t[c+2]=e[c+2]-o;return A}var kn=1e3,En=1001,Fn=1002,xn=1003,Un=1004,In=1004,Tn=1005,Pn=1005,Sn=1006,Dn=1007,Qn=1007,Rn=1008,On=1008,Vn=1009,Ln=1010,Hn=1011,Nn=1012,Gn=1013,jn=1014,Wn=1015,zn=1016,Xn=1017,Kn=1018,Zn=1020,Jn=1021,Yn=1022,qn=1023,$n=1024,er=1025,tr=1026,nr=1027,rr=1028,ir=1029,sr=1030,ar=1031,or=1033,Ar=33776,cr=33777,lr=33778,ur=33779,hr=35840,dr=35841,fr=35842,pr=35843,vr=36196,gr=37492,mr=37496,yr=37808,_r=37809,br=37810,wr=37811,Br=37812,Cr=37813,Mr=37814,kr=37815,Er=37816,Fr=37817,xr=37818,Ur=37819,Ir=37820,Tr=37821,Pr=36492,Sr=3e3,Dr=3001,Qr=1e4,Rr=10001,Or=10002,Vr=10003,Lr=new O({}),Hr=De.vec3(),Nr=De.vec4(),Gr=f({},3001,"sRGBToLinear"),jr=function(){var e=this,t=[],n=[],r=[],i=[],s=[],a=[],o=[],A=function(e,n){var r=!1;return t.push((function(t){return r&&n(e,t)})),{toString:function(){return r=!0,e}}},c={createAttribute:function(e,n){var r=!1;t.push((function(t){return r&&t.push("in ".concat(e," ").concat(n,";"))}));var i={toString:function(){return r=!0,n}};return s.push((function(e){var t=r&&e(n);return t&&a.push(t.attributeHash),i.setInputValue=t,null})),i},createFragmentDefinition:function(e,t){var n=!1;return i.push((function(r){return n&&t(e,r)})),{toString:function(){return n=!0,e}}},createOutput:function(e,t,n){var i=!1;return r.push((function(r){return i&&r.push("layout(location = ".concat(n||0,") out ").concat(e," ").concat(t,";"))})),{toString:function(){return i=!0,t}}},createUniform:function(e,n,i){var s=!1,a=function(t){return s&&t.push("uniform ".concat(e," ").concat(n,";"))};t.push(a),r.push(a);var A={toString:function(){return s=!0,n}};return o.push((function(e){var t=s&&e(n);return i?t&&function(e){return i(t,e)}:(A.setInputValue=t,null)})),A},createUniformArray:function(e,n,i){var s=!1,a=function(t){return s&&t.push("uniform ".concat(e," ").concat(n,"[").concat(i,"];"))};t.push(a),r.push(a);var A={toString:function(){return s=!0,n}};return o.push((function(e){return A.setInputValue=s&&e(n),null})),A},createUniformBlock:function(e,n,i){var s=!1,a=Object.keys(n),A=function(t){s&&(t.push("uniform ".concat(e," {")),a.forEach((function(e){return t.push("    ".concat(n[e]," ").concat(e,";"))})),t.push("};"))};t.push(A),r.push(A);var c={};return a.forEach((function(e){return c[e]={toString:function(){return s=!0,e}}})),o.push((function(t){var n=s&&t(e);return i?n&&function(e){return i(n,e)}:(c.setInputValue=n,null)})),c},createVarying:function(e,i,s,a){var o=!1,A=a?a+" ":"";return t.push((function(t){return o&&t.push("".concat(A,"out ").concat(e," ").concat(i,";"))})),n.push((function(e){return o&&e.push("".concat(i," = ").concat(s(),";"))})),r.push((function(t){return o&&t.push("".concat(A,"in  ").concat(e," ").concat(i,";"))})),{toString:function(){return o=!0,i}}},createVertexDefinition:A,commonLibrary:{octDecode:A("octDecode",(function(e,t){t.push("vec3 ".concat(e,"(vec2 oct) {")),t.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),t.push("    if (v.z < 0.0) {"),t.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),t.push("    }"),t.push("    return normalize(v);"),t.push("}")}))}};return{programVariables:c,buildProgram:function(A,l,u){var h,d,f=u.getLogDepth,v=u.clipPos,g=u.usePickClipPos&&(h=c.createUniform("vec2","pickClipPos"),d=c.createUniform("vec2","pickClipPosInv"),{setClipPosInputValue:function(e){h.setInputValue(e.pickClipPos),d.setInputValue(e.pickClipPosInv)},transformedClipPos:function(){return"vec4((".concat(v,".xy / ").concat(v,".w - ").concat(h,") * ").concat(d," * ").concat(v,".w, ").concat(v,".zw)")}}),m=g?g.transformedClipPos():v,y=[],_=c.createVarying("float","isPerspective",(function(){return"(".concat(u.projMatrix,"[2][3] == -1.0) ? 1.0 : 0.0")})),b=c.createUniform("float","logDepthBufFC",(function(e,t){return e(2/(Math.log(t.view.far+1)/Math.LN2))})),w=c.createVarying("float","vFragDepth",(function(){return"1.0 + clipPos.w"}));f?y.push("gl_FragDepth = ".concat(u.testPerspectiveForGl_FragDepth?"".concat(_," == 0.0 ? gl_FragCoord.z : "):"","log2(").concat(f(w),") * ").concat(b," * 0.5;")):u.cleanerEdges&&y.push("gl_FragDepth = gl_FragCoord.z + length(vec2(dFdx(gl_FragCoord.z), dFdy(gl_FragCoord.z)));");var B,C,M=c.createFragmentDefinition("linearToGamma",(function(e,t){t.push("vec4 ".concat(e,"(in vec4 value, in float gammaFactor) {")),t.push("  return vec4(pow(value.xyz, vec3(1.0 / gammaFactor)), value.w);"),t.push("}")})),E=u.sectionPlanesState,F=E&&(B=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t}(E.getNumAllocatedSectionPlanes()).map((function(e){var t=function(t,n,r){return c.createUniform(t,"sectionPlane".concat(n).concat(e),(function(t,n){var i=E.sectionPlanes,s=i.length,a=(n.mesh.layerIndex||0)*s,o=e<s&&n.mesh.renderFlags.sectionPlanesActivePerLayer[a+e];return r(t,o,i[e],n.mesh.origin)}))};return{act:t("bool","Active",(function(e,t){return e(t?1:0)})),dir:t("vec3","Dir",(function(e,t,n){return t&&e(n.dir)})),pos:t("vec3","Pos",(function(e,t,n,r){return t&&e(r?De.mulVec3Scalar(De.normalizeVec3(n.dir,Hr),-(De.dotVec3(n.dir,r)+n.dist),Hr):n.pos)}))}})),B.length>0&&function(e){return B.map((function(t){return"(".concat(t.act," ? clamp(dot(-").concat(t.dir,", ").concat(e," - ").concat(t.pos,"), 0.0, 1000.0) : 0.0)")})).join(" + ")}),x=u.crossSections,U=F?(C=c.createUniform("vec4","sliceColor",(function(e){return e(x.sliceColor)})),function e(t){return e.needed=!0,"(sliced ? ".concat(C," : ").concat(t,")")}):function(e){return e},I=u.getGammaFactor,T=c.createUniform("float","gammaFactor",(function(e){return e(I())}));u.appendFragmentOutputs(y,I&&function(e){return"".concat(M,"(").concat(e,", ").concat(T,")")},"gl_FragCoord",U);var P,S=function(){var e=[],t=c.createUniform("float","sliceThickness",(function(e){return e(x.sliceThickness)}));if(F){U.needed&&e.push("  bool sliced = false;"),e.push("  if (".concat(u.clippableTest(),") {"));var n=c.createVarying("highp vec3","vHighpWorldPosition",(function(){return"".concat(u.worldPositionAttribute,".xyz")}));if(e.push("    float dist = ".concat(F(n),";")),u.clippingCaps){var r=c.createVarying("float","vClipPositionW",(function(){return"gl_Position.w"}));e.push("    if (dist > (0.002 * ".concat(r,")) { discard; }")),e.push("    if (dist > 0.0) { "),e.push("      ".concat(u.clippingCaps," = vec4(1.0, 0.0, 0.0, 1.0);")),f&&e.push("      gl_FragDepth = log2(".concat(f(w),") * ").concat(b," * 0.5;")),e.push("      return;"),e.push("    }")}else e.push("    if (dist > ".concat(U.needed?t:"0.0",") { discard; }"));U.needed&&e.push("    sliced = dist > 0.0;"),e.push("  }")}return e}(),D=(P=[],i.forEach((function(e){return e(P)})),P),Q=[].concat(p(function(){var e=[];return r.forEach((function(t){return t(e)})),e}()),p(D),["void main(void) {"],p(u.discardPoints?["  vec2 cxy = 2.0 * gl_PointCoord - 1.0;","  if (dot(cxy, cxy) > 1.0) { discard; }"]:[]),p(S),y,["}"]),R=["gl_Position = ".concat(m,";")].concat(p(u.getPointSize?["gl_PointSize = ".concat(u.getPointSize(),";")]:[]),p(function(){var e=[];return n.forEach((function(t){return t(e)})),e}())),O=u.getVertexData?u.getVertexData():[],V=[].concat(p(function(){var e=[];return t.forEach((function(t){return t(e)})),e}()),["void main(void) {"],p(O),p(R),["}"]),L=function(e){return["#version 300 es","// "+l+" "+e+" shader","#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","precision highp usampler2D;","precision highp isampler2D;","precision highp sampler2D;","#else","precision mediump float;","precision mediump int;","precision mediump usampler2D;","precision mediump isampler2D;","precision mediump sampler2D;","#endif"]},H=L("vertex").concat(V),N=L("fragment").concat(["vec4 sRGBToLinear(in vec4 value) {","  return vec4(mix(pow(value.rgb * 0.9478672986 + 0.0521327014, vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);","}"]).concat(Q),G=function(e,t){var n=t.join("\n"),r=A.createShader(e);return A.shaderSource(r,n),A.compileShader(r),A.getShaderParameter(r,A.COMPILE_STATUS)?[r]:[null,["Failed to compile",A.getShaderInfoLog(r),n.split("\n").map((function(e,t){return t+1+": "+e+"\n"})).join("")]]},j=k(G(A.VERTEX_SHADER,H),2),W=j[0],z=j[1],X=k(G(A.FRAGMENT_SHADER,N),2),K=X[0],Z=X[1],J=function(e){return console.error(e.join("\n")),[null,e]};if(z)return J(["Vertex shader error"].concat(z));if(Z)return J(["Fragment shader error"].concat(Z));var Y=A.createProgram();if(Y){if(A.attachShader(Y,W),A.attachShader(Y,K),A.linkProgram(Y),A.getProgramParameter(Y,A.LINK_STATUS)){var q=Xr(A,Y);s.forEach((function(e){return e(q)}));var $=o.map((function(e){return e(q)})).filter((function(e){return e})),ee=Lr.addItem({});return[{id:ee,bind:function(){return A.useProgram(Y)},inputSetters:{attributesHash:a.sort().join(", "),setUniforms:function(e,t){g&&g.setClipPosInputValue(e),$.forEach((function(e){return e(t)}))}},destroy:function(){Lr.removeItem(ee),A.deleteProgram(Y),A.deleteShader(W),A.deleteShader(K)}}]}return J(["",A.getProgramInfoLog(e.program),"","Vertex shader:",""].concat(p(H),["","Fragment shader:",""],p(N)))}return J(["Failed to allocate program"])}}},Wr=function(e,t){var n=e.createUniform("vec4","lightAmbient",(function(e){return e(t.getAmbientColorAndIntensity())})),r=t.lights,i=r.map((function(t,n){var i={color:e.createUniform("vec4","lightColor".concat(n),(function(e){var t=r[n];Nr[0]=t.color[0],Nr[1]=t.color[1],Nr[2]=t.color[2],Nr[3]=t.intensity,e(Nr)})),position:e.createUniform("vec3","lightPos".concat(n),(function(e){return e(r[n].pos)})),direction:e.createUniform("vec3","lightDir".concat(n),(function(e){return e(r[n].dir)})),shadowProjMatrix:e.createUniform("mat4","shadowProjMatrix".concat(n),(function(e){return e(r[n].getShadowViewMatrix())})),shadowViewMatrix:e.createUniform("mat4","shadowViewMatrix".concat(n),(function(e){return e(r[n].getShadowViewMatrix())})),shadowMap:e.createUniform("sampler2D","shadowMap".concat(n),(function(e){return e(r[n].getShadowRenderBuf().colorTextures[0])}))},s=function(e){return{glslLight:{isViewSpace:"view"===t.space,getColor:function(){return"".concat(i.color,".rgb * ").concat(i.color,".a")},getDirection:function(t,n){return"normalize(".concat(e(t,n),")")},shadowParameters:t.castsShadow&&{getShadowProjMatrix:function(){return i.shadowProjMatrix},getShadowViewMatrix:function(){return i.shadowViewMatrix},getShadowMap:function(){return i.shadowMap}}},setupLightsInputs:function(){var e=Object.values(i).map((function(e){return e.setupLightsInputs()})).filter((function(e){return e}));return function(){return e.forEach((function(e){return e()}))}}}};return"dir"===t.type?"view"===t.space?s((function(e,t){return"-".concat(i.direction)})):s((function(e,t){return"-(".concat(e," * vec4(").concat(i.direction,", 0.0)).xyz")})):"point"===t.type?"view"===t.space?s((function(e,t){return"".concat(i.position," - ").concat(t)})):s((function(e,t){return"(".concat(e," * vec4(").concat(i.position,", 1.0)).xyz - ").concat(t)})):null})).filter((function(e){return e})),s=function(t,n){var r=function(){var e=n();return e.length>0&&e[0]},i=r();return i&&zr(e,"samplerCube",t,i.encoding,(function(e){var t=r();t&&e(t.texture)}))},a=s("light",(function(){return t.lightMaps})),o=s("reflection",(function(){return t.reflectionMaps}));return{getHash:function(){return t.getHash()},getAmbientColor:function(){return"".concat(n,".rgb * ").concat(n,".a")},directionalLights:i.map((function(e){return e.glslLight})),getIrradiance:a&&function(e){return"".concat(a(e),".rgb")},getReflection:o&&function(e,t){return"".concat(o(e,t),".rgb")}}},zr=function(e,t,n,r,i){var s=e.createUniform(t,n+"Map",i);return function(e,t){var n=t?"texture(".concat(s,", ").concat(e,", ").concat(t,")"):"texture(".concat(s,", ").concat(e,")");return 3e3!==r?"".concat(Gr[r],"(").concat(n,")"):n}},Xr=function(e,t){for(var n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),i=function(i){var s=e.getActiveAttrib(t,i),a=e.getAttribLocation(t,s.name);n[s.name]=function(t){t.bindAtLocation(a),e.enableVertexAttribArray(a);var n=t.attributeDivisor;n&&e.vertexAttribDivisor(a,n)},n[s.name].attributeHash="".concat(a.toString().padStart(1+Math.floor(Math.log10(r)),"0"),":").concat(s.name)},s=0;s<r;++s)i(s);for(var a=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS),o=function(r){var i=e.getActiveUniformBlockName(t,r),s=e.getUniformBlockIndex(t,i),a=r;e.uniformBlockBinding(t,s,a);var o=e.createBuffer();n[i]=function(t){e.bindBuffer(e.UNIFORM_BUFFER,o),e.bufferData(e.UNIFORM_BUFFER,t,e.DYNAMIC_DRAW),e.bindBufferBase(e.UNIFORM_BUFFER,a,o)}},A=0;A<a;++A)o(A);for(var c=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),l=0,u=function(r){var i=e.getActiveUniform(t,r),s=i.name;s.endsWith("[0]")&&(s=s.substr(0,s.length-3)),"\0"===s[s.length-1]&&(s=s.substr(0,s.length-1));var a=e.getUniformLocation(t,s);if(function(){for(var t in e)if(i.type===e[t])return t}(),i.type===e.SAMPLER_2D||i.type===e.SAMPLER_CUBE||i.type===e.SAMPLER_2D_SHADOW||e instanceof window.WebGL2RenderingContext&&(i.type===e.UNSIGNED_INT_SAMPLER_2D||i.type===e.INT_SAMPLER_2D)){var o=l++;n[s]=function(t){var n=t.bind(o);return n&&e.uniform1i(a,o),n}}else n[s]=function(){if(1===i.size)switch(i.type){case e.BOOL:case e.INT:return function(t){return e.uniform1i(a,t)};case e.FLOAT:return function(t){return e.uniform1f(a,t)};case e.FLOAT_VEC2:return function(t){return e.uniform2fv(a,t)};case e.FLOAT_VEC3:return function(t){return e.uniform3fv(a,t)};case e.FLOAT_VEC4:return function(t){return e.uniform4fv(a,t)};case e.FLOAT_MAT3:return function(t){return e.uniformMatrix3fv(a,!1,t)};case e.FLOAT_MAT4:return function(t){return e.uniformMatrix4fv(a,!1,t)}}else if(i.size>1)switch(i.type){case e.FLOAT:return function(t){return e.uniform1fv(a,t)};case e.FLOAT_VEC2:return function(t){return e.uniform2fv(a,t)};case e.FLOAT_VEC3:return function(t){return e.uniform3fv(a,t)};case e.FLOAT_VEC4:return function(t){return e.uniform4fv(a,t)}}throw"Unhandled uniform ".concat(s)}()},h=0;h<c;++h)u(h);return function(e){var t=n[e];if(!t)throw'Missing input "'.concat(e,'"');return t}},Kr=De.vec4(),Zr=function(e,t,n,r,i){var s=r._state,a="PhongMaterial"===s.type,o="MetallicMaterial"===s.type,A="SpecularMaterial"===s.type,c=n.attributes,l=Wr(t,i._lightsState),u=t.createUniform("vec4","colorize",(function(e,t){return e(t.meshColorize)})),h=t.createFragmentDefinition("fresnel",(function(e,t){t.push("float ".concat(e,"(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {")),t.push("    float fr = abs(dot(eyeDir, normal));"),t.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),t.push("    return pow(finalFr, power);"),t.push("}")})),d=function(e,n,i){var s=function(n,r,s){return t.createUniform(n,e+"Fresnel"+r,(function(e,t){return e(s(i(t.material)))}))},a=s("float","EdgeBias",(function(e){return e.edgeBias})),o=s("float","CenterBias",(function(e){return e.centerBias})),A=s("float","Power",(function(e){return e.power})),c=s("vec3","EdgeColor",(function(e){return e.edgeColor})),l=s("vec3","CenterColor",(function(e){return e.centerColor}));return i(r)&&function(e,t){var r="".concat(h,"(").concat(e,", ").concat(t,", ").concat(a,", ").concat(o,", ").concat(A,")");return"mix(".concat(c+n,", ").concat(l+n,", ").concat(r,")")}},f=d("diffuse","",(function(e){return e._diffuseFresnel})),p=d("specular","",(function(e){return e._specularFresnel})),v=d("emissive","",(function(e){return e._emissiveFresnel})),g=d("alpha",".r",(function(e){return e._alphaFresnel})),m=function(e,n){var i=c.uv&&n(r),s=i&&zr(t,"sampler2D",e,i.encoding,(function(e,t){return e(n(t.material)._state.texture)}));return s&&function(){var r=i._state.matrix&&t.createUniform("mat4",e+"MapMatrix",(function(e,t){return e(n(t.material)._state.matrix)})),a=r?function(e){return"(".concat(r," * ").concat(e,").st")}:function(e){return"".concat(e,".st")},o=function(e,t){return s(a(e))};return o.getTexCoordExpression=a,o}()},y=m("ambient",(function(e){return e._ambientMap})),_=m("baseColor",(function(e){return e._baseColorMap})),b=m("diffuse",(function(e){return e._diffuseMap})),w=m("emissive",(function(e){return e._emissiveMap})),B=m("occlusion",(function(e){return e._occlusionMap})),C=m("alpha",(function(e){return e._alphaMap})),M=m("metallic",(function(e){return e._metallicMap})),k=m("roughness",(function(e){return e._roughnessMap})),E=m("metallicRoughness",(function(e){return e._metallicRoughnessMap})),F=m("specular",(function(e){return e._specularMap})),x=m("glossiness",(function(e){return e._glossinessMap})),U=m("specularGlossiness",(function(e){return e._specularGlossinessMap})),I=m("normal",(function(e){return e._normalMap})),T=function(e,n,i){var s=i(r);return("float"===n?null!=s:s)&&t.createUniform(n,e,(function(e,t){return e(i(t.material))}))},P=T("materialAmbient","vec3",(function(e){return e.ambient})),S=T("materialDiffuse","vec3",(function(e){return e.diffuse})),D=T("materialBaseColor","vec3",(function(e){return e.baseColor})),Q=T("materialEmissive","vec3",(function(e){return e.emissive})),R=T("materialSpecular","vec3",(function(e){return e.specular})),O=T("materialGlossiness","float",(function(e){return e.glossiness})),V=T("materialMetallic","float",(function(e){return e.metallic})),L=T("materialRoughness","float",(function(e){return e.roughness})),H=T("materialShininess","float",(function(e){return e.shininess})),N=T("materialSpecularF0","float",(function(e){return e.specularF0})),G=T("materialAlphaModeCutoff","vec4",(function(e){var t=e.alpha;return null!=t?(Kr[0]=t,Kr[1]=1===e.alphaMode?1:0,Kr[2]=e.alphaCutoff,Kr):null})),j=t.createVarying("vec3","vViewPosition",(function(){return"".concat(c.position.view,".xyz")})),W=t.createVarying("vec4","texturePos",(function(){return"vec4(".concat(c.uv,", 1.0, 1.0)")})),z=c.color&&t.createVarying("vec4","vColor",(function(){return c.color})),X=t.createVarying("vec3","vViewNormal",(function(){return c.normal.view})),K=l.directionalLights.map((function(e,r){return{vViewLightReverseDir:t.createVarying("vec3","vViewLightReverseDir".concat(r),(function(){return e.getDirection(n.viewMatrix,null)})),vShadowPosFromLight:t.createVarying("vec3","vShadowPosFromLight".concat(r),(function(){return"(".concat("mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0)"," * ").concat(e.shadowParameters.getShadowProjMatrix()," * (").concat(e.shadowParameters.getShadowViewMatrix()," * ").concat(c.position.world,")).xyz")}))}})),Z=t.createVarying("vec3","vWorldNormal",(function(){return c.normal.world})),J=t.createOutput("vec4","outColor"),Y=t.createFragmentDefinition("saturate",(function(e,t){return t.push("float ".concat(e,"(const in float a) { return clamp(a, 0.0, 1.0); }"))})),q=t.createFragmentDefinition("BRDF_Specular_GGX",(function(e,t){t.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),t.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),t.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),t.push("}"),t.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   return 1.0 / ( gl * gv );"),t.push("}"),t.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   return 0.5 / max( gv + gl, 1e-6 );"),t.push("}"),t.push("float D_GGX(const in float alpha, const in float dotNH) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),t.push("   return 0.31830988618 * a2 / ( denom * denom);"),t.push("}"),t.push("vec3 ".concat(e,"(const in vec3 incidentLightDirection, const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {")),t.push("   float alpha = ( roughness * roughness );"),t.push("   vec3 halfDir = normalize( incidentLightDirection + viewEyeDir );"),t.push("   float dotNL = ".concat(Y,"( dot( viewNormal, incidentLightDirection ) );")),t.push("   float dotNV = ".concat(Y,"( dot( viewNormal, viewEyeDir ) );")),t.push("   float dotNH = ".concat(Y,"( dot( viewNormal, halfDir ) );")),t.push("   float dotLH = ".concat(Y,"( dot( incidentLightDirection, halfDir ) );")),t.push("   vec3  F = F_Schlick( specularColor, dotLH );"),t.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),t.push("   float D = D_GGX( alpha, dotNH );"),t.push("   return F * (G * D);"),t.push("}")})),$=t.createFragmentDefinition("BRDF_Specular_GGX_Environment",(function(e,t){t.push("vec3 ".concat(e,"(const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {")),t.push("   float dotNV = ".concat(Y,"(dot(viewNormal, viewEyeDir));")),t.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),t.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),t.push("   vec4 r = roughness * c0 + c1;"),t.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),t.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),t.push("   return specularColor * AB.x + AB.y;"),t.push("}")})),ee=t.createFragmentDefinition("perturbNormal2Arb",(function(e,t){t.push("vec3 ".concat(e,"( vec3 eye_pos, vec3 surf_norm, vec2 uv, vec4 texel ) {")),t.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),t.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),t.push("      vec2 st0 = dFdx( uv.st );"),t.push("      vec2 st1 = dFdy( uv.st );"),t.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),t.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),t.push("      vec3 N = normalize( surf_norm );"),t.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),t.push("      mat3 tsn = mat3( S, T, N );"),t.push("      return normalize( tsn * mapN );"),t.push("}")}));return{getHash:function(){return[e,i.gammaOutput?"go":"",l.getHash(),r._state.hash]},programName:"Draw",canActAsBackground:!0,discardPoints:!0,setupPointSize:!0,setsLineWidth:!0,appendFragmentOutputs:function(e,t,r){var i,s,h,d,m=c.normal&&(l.directionalLights.length>0||l.getIrradiance||l.getReflection);if(e.push("vec3 diffuseColor = ".concat(m&&(a||A)&&S||o&&D||"vec3(1.0)",";")),e.push("vec4 alphaModeCutoff = ".concat((a||o||A)&&G||"vec4(1.0, 0.0, 0.0, 0.0)",";")),e.push("float alpha = alphaModeCutoff[0];"),(a||o||A)&&C&&e.push("alpha *= ".concat(C(W),".r;")),z&&(e.push("diffuseColor *= ".concat(z,".rgb;")),e.push("alpha *= ".concat(z,".a;"))),o&&_&&(e.push("vec4 baseColorTexel = "+_(W)+";"),e.push("diffuseColor *= baseColorTexel.rgb;"),e.push("alpha *= baseColorTexel.a;")),(a||A)&&b&&(e.push("vec4 diffuseTexel = "+b(W)+";"),e.push("diffuseColor *= diffuseTexel.rgb;"),e.push("alpha *= diffuseTexel.a;")),e.push("vec3 emissiveColor = ".concat((a||o||A)&&Q||"vec3(0.0)",";")),(a||o||A)&&w&&e.push("emissiveColor = ".concat(w(W),".rgb;")),m){e.push("vec3 specular    = ".concat((a||A)&&R||"vec3(1.0)",";")),e.push("float glossiness = ".concat(A&&O||"1.0",";")),e.push("float metallic   = ".concat(o&&V||"1.0",";")),e.push("float roughness  = ".concat((o||A)&&L||"1.0",";")),e.push("float shininess  = ".concat(a&&H||"1.0",";")),e.push("float specularF0 = ".concat(o&&N||"1.0",";")),e.push("float occlusion  = ".concat((a||o||A)&&B?"".concat(B(W),".r"):"1.0",";")),o&&M&&e.push("metallic  *= ".concat(M(W),".r;")),o&&k&&e.push("roughness *= ".concat(k(W),".r;")),o&&E&&(e.push("vec4 metalRoughTexel = "+E(W)+";"),e.push("metallic  *= metalRoughTexel.b;"),e.push("roughness *= metalRoughTexel.g;")),(a||A)&&F&&e.push("specular *= ".concat(F(W),".rgb;")),A&&x&&e.push("glossiness *= ".concat(x(W),".r;")),A&&U&&(e.push("vec4 specGlossTexel = "+U(W)+";"),e.push("specular   *= specGlossTexel.rgb;"),e.push("glossiness *= specGlossTexel.a;"));var T="normalize(".concat(X,")"),te=(a||o||A)&&I?"".concat(ee,"(").concat(j,", ").concat(T,", ").concat(I.getTexCoordExpression(W),", ").concat(I(W),")"):T;if(e.push("vec3 viewNormal = ".concat(te,";")),e.push("vec3 viewEyeDir = normalize(-".concat(j,");")),f&&e.push("diffuseColor  *= ".concat(f("viewEyeDir","viewNormal"),";")),p&&e.push("specular      *= ".concat(p("viewEyeDir","viewNormal"),";")),v&&e.push("emissiveColor *= ".concat(v("viewEyeDir","viewNormal"),";")),g&&e.push("alpha         *= ".concat(g("viewEyeDir","viewNormal"),";")),e.push("if (alphaModeCutoff[1] == 1.0 && alpha < alphaModeCutoff[2]) {"),e.push("   discard;"),e.push("}"),e.push("vec3 material_diffuseColor;"),a&&(e.push("material_diffuseColor = diffuseColor;"),e.push("roughness = 0.0;")),A&&(e.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),e.push("material_diffuseColor = diffuseColor * oneMinusSpecularStrength;"),e.push("roughness = clamp(1.0 - glossiness, 0.04, 1.0);")),o&&(e.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),e.push("material_diffuseColor = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),e.push("roughness = clamp(roughness, 0.04, 1.0);"),e.push("specular = mix(vec3(dielectricSpecular), diffuseColor, metallic);")),a||o||A){if(e.push("const float PI = 3.14159265359;"),e.push("vec3 reflDiff = vec3(0.0);"),e.push("vec3 reflSpec = vec3(0.0);"),l.getIrradiance&&e.push("reflDiff += ".concat(l.getIrradiance("normalize(".concat(Z,")")),";")),l.getReflection){var ne="reflect(-viewEyeDir, viewNormal)",re=a?"0.2 * PI * ".concat(l.getReflection(ne)):(i="".concat($,"(viewNormal, viewEyeDir, specular, roughness)"),s="normalize((vec4(".concat(ne,", 0.0) * ").concat(n.viewMatrix,").xyz)"),h="".concat("4.0"," - 0.39624 - 0.25 * log2(pow(").concat("2.0 / pow(roughness + 0.0001, 2.0) - 2.0",", 2.0) + 1.0)"),d="clamp(".concat(h,", 0.0, ").concat("4.0",")"),"".concat(i," * ").concat(l.getReflection(s,d)));e.push("reflSpec += ".concat(re,";"))}l.directionalLights.some((function(e){return e.shadowParameters}))&&(e.push("const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),e.push("const float texelSize = 1.0 / 1024.0;"),e.push("float shadow;"),e.push("float fragmentDepth;")),l.directionalLights.forEach((function(t,n){if(t.shadowParameters){e.push("fragmentDepth = ".concat(K[n].vShadowPosFromLight,".z - ").concat("0.007",";")),e.push("shadow = 0.0;"),e.push("for (int x = -3; x <= 3; x++) {"),e.push("  for (int y = -3; y <= 3; y++) {"),e.push("      float texelDepth = dot(texture(".concat(t.getShadowMap(),", ").concat(K[n].vShadowPosFromLight,".xy + vec2(x, y) * texelSize), bitShift);")),e.push("      if (fragmentDepth < texelDepth) {"),e.push("          shadow += 1.0;"),e.push("      }"),e.push("  }"),e.push("}"),e.push("shadow /= 9.0;")}e.push("vec3 lightColor".concat(n," = ").concat(t.getColor()).concat(t.shadowParameters?" * shadow":"",";")),e.push("vec3 lightDirection".concat(n," = ").concat(t.isViewSpace?t.getDirection(null,j):K[n].vViewLightReverseDir,";"));var r="".concat(Y,"(dot(viewNormal, lightDirection").concat(n,"))");e.push("vec3 irradiance".concat(n," = ").concat(r," * lightColor").concat(n,";")),e.push("reflDiff += irradiance".concat(n,";"));var i=a?"lightColor".concat(n," * specular * pow(max(dot(reflect(-lightDirection").concat(n,", -viewNormal), viewEyeDir), 0.0), shininess)"):"irradiance".concat(n," * PI * ").concat(q,"(lightDirection").concat(n,", viewNormal, viewEyeDir, specular, roughness)");e.push("reflSpec += ".concat(i,";"))}))}var ie=a&&"".concat(l.getAmbientColor()," * diffuseColor");e.push("vec3 outgoingLight = emissiveColor + occlusion * (reflDiff * material_diffuseColor + reflSpec)"+(ie?" + "+ie:"")+";")}else e.push("vec3 ambientColor = ".concat(a&&P||"vec3(1.0)",";")),a&&y&&e.push("ambientColor *= ".concat(y(W),".rgb;")),e.push("ambientColor *= ".concat(l.getAmbientColor(),";")),e.push("vec3 outgoingLight = emissiveColor + ambientColor;");e.push("vec4 fragColor = ".concat(u," * vec4(outgoingLight, alpha);")),e.push("".concat(J," = ").concat(t?t("fragColor"):"fragColor",";"))}}},Jr=function(e,t,n,r,i){var s=Wr(t,i._lightsState),a=t.createUniform("vec4","colorize",(function(e,t){return e(t.meshColorize)})),o=t.createUniform("float","materialAlpha",(function(e,t){return e(t.material.alpha)})),A=t.createUniform("vec3","materialColor",(function(e,t){return e(t.material.color)})),c=t.createUniform("vec3","materialEmissive",(function(e,t){return e(t.material.emissive)})),l=t.createVarying("vec4","vColor",(function(){var e=n.attributes,t=[s.getAmbientColor()].concat(e.normal?s.directionalLights.map((function(t){return"(max(dot(".concat(e.normal.view,", ").concat(t.getDirection(n.viewMatrix,e.position.view),"), 0.0) * ").concat(t.getColor(),")")})):[]);return"".concat(a," * vec4((").concat(t.join(" + "),") * ").concat(A," + ").concat(c,", ").concat(o,");")})),u=t.createOutput("vec4","outColor");return{getHash:function(){return[e,i.gammaOutput?"go":"",s.getHash(),r._state.hash]},programName:"Lambert",canActAsBackground:!0,discardPoints:!0,setupPointSize:!0,setsLineWidth:!0,appendFragmentOutputs:function(e,t){return e.push("".concat(u," = ").concat(t?t(l):l,";"))}}},Yr=function(e,t,n,r,i){var s=i&&Wr(t,r._lightsState),a=t.createUniform("vec3","uColor",(function(e,t){return e(i?t.material.fillColor:t.material.edgeColor)})),o=t.createUniform("float","uAlpha",(function(e,t){return e(i?t.material.fillAlpha:t.material.edgeAlpha)})),A=t.createVarying("vec4","vColor",(function(){var e=n.attributes,t=i&&[s.getAmbientColor()].concat(e.normal?s.directionalLights.map((function(t){return"(max(dot(".concat(e.normal.view,", ").concat(t.getDirection(n.viewMatrix,e.position.view),"), 0.0) * ").concat(t.getColor(),")")})):[]);return"vec4(".concat(a).concat(t?" * (".concat(t.join(" + "),")"):"",", ").concat(o,")")})),c=t.createOutput("vec4","outColor");return{getHash:function(){return[e,r.gammaOutput?"go":"",s&&s.getHash()]},programName:i?"EmphasisFill":"EmphasisEdges",dontSetFrontFace:!0,discardPoints:i,drawEdges:!i,appendFragmentOutputs:function(e,t){return e.push("".concat(c," = ").concat(t?t(A):A,";"))}}},qr=De.vec4(),$r=function(e,t){var n=t.createUniform("vec4","pickColor",(function(e,t){var n=t.meshPickID;qr[0]=255&n,qr[1]=n>>8&255,qr[2]=n>>16&255,qr[3]=n>>24&255,De.mulVec4Scalar(qr,1/255,qr),e(qr)})),r=t.createOutput("vec4","outColor");return{getHash:function(){return[e]},programName:"PickMesh",isPick:!0,dontBillboardAnything:!0,appendFragmentOutputs:function(e){return e.push("".concat(r," = ").concat(n,";"))}}},ei=function(e,t,n){var r=t.createVarying("vec4","vColor",(function(){return n.attributes.pickColor})),i=t.createOutput("vec4","outColor");return{getHash:function(){return[e]},programName:"PickTriangle",isPick:!0,trianglePick:!0,dontBillboardAnything:!0,appendFragmentOutputs:function(e){return e.push("".concat(i," = ").concat(r,";"))}}},ti=function(e,t){var n=t.createOutput("vec4","outColor");return{getHash:function(){return[e]},programName:"Occlusion",skipIfTransparent:!0,appendFragmentOutputs:function(e){return e.push("".concat(n," = vec4(0.0, 0.0, 1.0, 1.0);"))}}},ni=function(e,t){var n=t.createFragmentDefinition("encodeFloat",(function(e,t){t.push("vec4 ".concat(e,"( const in float depth ) {")),t.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),t.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),t.push("  vec4 comp = fract(depth * bitShift);"),t.push("  comp -= comp.xxyz * bitMask;"),t.push("  return comp;"),t.push("}")})),r=t.createOutput("vec4","outColor");return{getHash:function(){return[e]},programName:"Shadow",setsLineWidth:!0,useShadowView:!0,dontBillboardAnything:!0,dontGetLogDepth:!0,appendFragmentOutputs:function(e,t,i){return e.push("".concat(r," = ").concat(n,"(").concat(i,".z);"))}}},ri=function(){function e(){x(this,e),this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}return I(e,[{key:"reset",value:function(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}]),e}(),ii=De.OBB3(),si=De.vec4(),ai=De.vec4(),oi=De.vec4(),Ai=De.vec3([1,0,0]),ci=De.vec3([0,1,0]),li=De.vec3([0,0,1]),ui=De.vec3(3),hi=De.vec3(3),di=De.identityMat4(),fi=new O({}),pi={},vi=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e,i)).renderOrder=i.renderOrder||0,r.originalSystemId=i.originalSystemId||r.id,r.renderFlags=new ri,r._state=new It({visible:!0,culled:!1,pickable:null,clippable:null,collidable:null,occluder:!1!==i.occluder,castsShadow:null,receivesShadow:null,xrayed:!1,highlighted:!1,selected:!1,edges:!1,stationary:!!i.stationary,background:!!i.background,billboard:r._checkBillboard(i.billboard),layer:null,colorize:null,pickID:r.scene._renderer.getPickID(w(r)),drawHash:"",pickOcclusionHash:"",offset:De.vec3(),origin:null,originHash:null,isUI:i.isUI});var s=i.material?r._checkComponent2(["PhongMaterial","MetallicMaterial","SpecularMaterial","LambertMaterial"],i.material):r.scene.material,a=w(r),o=function(e){var t=null,n=function(){if(!t){var n=jr(),r=n.programVariables.createAttribute,i=a._geometry._state,s={position:r("vec3","position"),color:i.colorsBuf&&r("vec4","color"),pickColor:r("vec4","pickColor"),uv:i.uvBuf&&r("vec2","uv"),normal:(i.autoVertexNormals||i.normalsBuf)&&["triangles","triangle-strip","triangle-fan"].includes(i.primitiveName)&&r("vec3","normal")},o=function(e){var t={toString:function(){return t.needed=!0,e}};return t},A=s.normal&&o("worldNormal"),c=A&&o("viewNormal"),l=s.uv&&o("decodedUv"),u=e(n.programVariables,{attributes:{position:{world:"worldPosition",view:"viewPosition"},color:s.color,pickColor:s.pickColor,uv:l,normal:s.normal&&{world:A,view:c}},viewMatrix:"viewMatrix2"}),h=[u.programName,a.scene.canvas.canvas.id,a.scene._sectionPlanesState.getHash(),a._geometry._state.hash].concat(u.getHash()).join(";");if(!(h in pi)){var d=mi(a,s,{decodedUv:l,worldNormal:A,viewNormal:c},u,n);if(d.errors)return void console.log(d.errors.join("\n"));var f=fi.addItem({});pi[h]={drawMesh:d.drawMesh,id:f,useCount:0,delete:function(){fi.removeItem(f),d.destroy(),delete pi[h],Ve.memory.programs--}},Ve.memory.programs++}(t=pi[h]).useCount++}};return{get:n,getId:function(){return t.id},put:function(){t&&(0==--t.useCount&&t.delete(),t=null)},drawMesh:function(e,r,i){n(),t&&t.drawMesh(e,r,i)}}},A=a.scene,c=function(e){return function(t,n){return Yr(a._state.hash,t,n,A,e)}};r._renderers={_drawRenderer:o((function(e,t){return"LambertMaterial"===s.type?Jr(a._state.drawHash,e,t,s,A):Zr(a._state.drawHash,e,t,s,A)})),_shadowRenderer:o((function(e){return ni(a._state.hash,e)})),_emphasisEdgesRenderer:o(c(!1)),_emphasisFillRenderer:o(c(!0)),_pickMeshRenderer:o((function(e){return $r(a._state.hash,e)})),_pickTriangleRenderer:o((function(e,t){return ei(a._state.hash,e,t)})),_occlusionRenderer:o((function(e){return ti(a._state.pickOcclusionHash,e)}))},r._geometry=i.geometry?r._checkComponent2(["ReadableGeometry","VBOGeometry"],i.geometry):r.scene.geometry,r._material=s,r._xrayMaterial=i.xrayMaterial?r._checkComponent("EmphasisMaterial",i.xrayMaterial):r.scene.xrayMaterial,r._highlightMaterial=i.highlightMaterial?r._checkComponent("EmphasisMaterial",i.highlightMaterial):r.scene.highlightMaterial,r._selectedMaterial=i.selectedMaterial?r._checkComponent("EmphasisMaterial",i.selectedMaterial):r.scene.selectedMaterial,r._edgeMaterial=i.edgeMaterial?r._checkComponent("EdgeMaterial",i.edgeMaterial):r.scene.edgeMaterial,r._parentNode=null,r._aabb=null,r._aabbDirty=!0,r._numTriangles=r._geometry?r._geometry.numTriangles:0,r.scene._aabbDirty=!0,r._scale=De.vec3(),r._quaternion=De.identityQuaternion(),r._rotation=De.vec3(),r._position=De.vec3(),r._worldMatrix=De.identityMat4(),r._worldNormalMatrix=De.identityMat4(),r._localMatrixDirty=!0,r._worldMatrixDirty=!0,r._worldNormalMatrixDirty=!0;var l=i.origin||i.rtcCenter;if(l&&(r._state.origin=De.vec3(l),r._state.originHash=l.join()),i.matrix?r.matrix=i.matrix:(r.scale=i.scale,r.position=i.position,i.quaternion||(r.rotation=i.rotation)),r._isObject=i.isObject,r._isObject&&r.scene._registerObject(w(r)),r._isModel=i.isModel,r._isModel&&r.scene._registerModel(w(r)),r.visible=i.visible,r.culled=i.culled,r.pickable=i.pickable,r.clippable=i.clippable,r.collidable=i.collidable,r.castsShadow=i.castsShadow,r.receivesShadow=i.receivesShadow,r.xrayed=i.xrayed,r.highlighted=i.highlighted,r.selected=i.selected,r.edges=i.edges,r.layer=i.layer,r.colorize=i.colorize,r.opacity=i.opacity,r.offset=i.offset,i.parentId){var u=r.scene.components[i.parentId];u?u.isNode?u.addChild(w(r)):r.error("Parent is not a Node: '"+i.parentId+"'"):r.error("Parent not found: '"+i.parentId+"'"),r._parentNode=u}else i.parent&&(i.parent.isNode||r.error("Parent is not a Node"),i.parent.addChild(w(r)),r._parentNode=i.parent);return r.compile(),r}return I(n,[{key:"type",get:function(){return"Mesh"}},{key:"isMesh",get:function(){return!0}},{key:"parent",get:function(){return this._parentNode}},{key:"geometry",get:function(){return this._geometry}},{key:"material",get:function(){return this._material}},{key:"position",get:function(){return this._position},set:function(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation.set(e||[0,0,0]),De.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"quaternion",get:function(){return this._quaternion},set:function(e){this._quaternion.set(e||[0,0,0,1]),De.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"matrix",get:function(){return this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=De.identityMat4()),De.composeMat4(this._position,this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1),this.__localMatrix},set:function(e){this.__localMatrix||(this.__localMatrix=De.identityMat4()),this.__localMatrix.set(e||di),De.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}},{key:"worldMatrix",get:function(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}},{key:"worldNormalMatrix",get:function(){return this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix(),this._worldNormalMatrix}},{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return this._isObject}},{key:"isUI",get:function(){return this._state.isUI}},{key:"aabb",get:function(){return this._aabbDirty&&this._updateAABB(),this._aabb}},{key:"origin",get:function(){return this._state.origin},set:function(e){e?(this._state.origin||(this._state.origin=De.vec3()),this._state.origin.set(e),this._state.originHash=e.join(),this._setAABBDirty(),this.scene._aabbDirty=!0):this._state.origin&&(this._state.origin=null,this._state.originHash=null,this._setAABBDirty(),this.scene._aabbDirty=!0)}},{key:"rtcCenter",get:function(){return this.origin},set:function(e){this.origin=e}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"visible",get:function(){return this._state.visible},set:function(e){e=!1!==e,this._state.visible=e,this._isObject&&this.scene._objectVisibilityUpdated(this,e),this.glRedraw()}},{key:"xrayed",get:function(){return this._state.xrayed},set:function(e){e=!!e,this._state.xrayed!==e&&(this._state.xrayed=e,this._isObject&&this.scene._objectXRayedUpdated(this,e),this.glRedraw())}},{key:"highlighted",get:function(){return this._state.highlighted},set:function(e){(e=!!e)!==this._state.highlighted&&(this._state.highlighted=e,this._isObject&&this.scene._objectHighlightedUpdated(this,e),this.glRedraw())}},{key:"selected",get:function(){return this._state.selected},set:function(e){(e=!!e)!==this._state.selected&&(this._state.selected=e,this._isObject&&this.scene._objectSelectedUpdated(this,e),this.glRedraw())}},{key:"edges",get:function(){return this._state.edges},set:function(e){(e=!!e)!==this._state.edges&&(this._state.edges=e,this.glRedraw())}},{key:"culled",get:function(){return this._state.culled},set:function(e){this._state.culled=!!e,this.glRedraw()}},{key:"clippable",get:function(){return this._state.clippable},set:function(e){e=!1!==e,this._state.clippable!==e&&(this._state.clippable=e,this.glRedraw())}},{key:"collidable",get:function(){return this._state.collidable},set:function(e){(e=!1!==e)!==this._state.collidable&&(this._state.collidable=e,this._setAABBDirty(),this.scene._aabbDirty=!0)}},{key:"pickable",get:function(){return this._state.pickable},set:function(e){e=!1!==e,this._state.pickable!==e&&(this._state.pickable=e)}},{key:"castsShadow",get:function(){return this._state.castsShadow},set:function(e){(e=!1!==e)!==this._state.castsShadow&&(this._state.castsShadow=e,this.glRedraw())}},{key:"receivesShadow",get:function(){return this._state.receivesShadow},set:function(e){(e=!1!==e)!==this._state.receivesShadow&&(this._state.receivesShadow=e,this._state.hash=e?"/mod/rs;":"/mod;",this.fire("dirty",this))}},{key:"saoEnabled",get:function(){return!1}},{key:"colorize",get:function(){return this._state.colorize},set:function(e){var t=this._state.colorize;t||((t=this._state.colorize=new Float32Array(4))[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);var n=!!e;this.scene._objectColorizeUpdated(this,n),this.glRedraw()}},{key:"opacity",get:function(){return this._state.colorize[3]},set:function(e){var t=this._state.colorize;t||((t=this._state.colorize=new Float32Array(4))[0]=1,t[1]=1,t[2]=1);var n=null!=e;t[3]=n?e:1,this.scene._objectOpacityUpdated(this,n),this.glRedraw()}},{key:"transparent",get:function(){return 2===this._material.alphaMode||this._state.colorize[3]<1}},{key:"layer",get:function(){return this._state.layer},set:function(e){e=e||0,(e=Math.round(e))!==this._state.layer&&(this._state.layer=e,this._renderer.needStateSort())}},{key:"stationary",get:function(){return this._state.stationary}},{key:"billboard",get:function(){return this._state.billboard}},{key:"offset",get:function(){return this._state.offset},set:function(e){this._state.offset.set(e||[0,0,0]),this._setAABBDirty(),this.glRedraw()}},{key:"isDrawable",get:function(){return!0}},{key:"isStateSortable",get:function(){return!0}},{key:"xrayMaterial",get:function(){return this._xrayMaterial}},{key:"highlightMaterial",get:function(){return this._highlightMaterial}},{key:"selectedMaterial",get:function(){return this._selectedMaterial}},{key:"edgeMaterial",get:function(){return this._edgeMaterial}},{key:"_checkBillboard",value:function(e){return"spherical"!==(e=e||"none")&&"cylindrical"!==e&&"none"!==e&&(this.error("Unsupported value for 'billboard': "+e+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),e="none"),e}},{key:"compile",value:function(){var e=this.scene,t=this._state,n=[e.canvas.canvas.id,e._sectionPlanesState.getHash()];t.stationary&&n.push("/s"),"none"===t.billboard?n.push("/n"):"spherical"===t.billboard?n.push("/s"):"cylindrical"===t.billboard&&n.push("/c"),n.push(";");var r=n.concat([e.gammaOutput?"go":"",e._lightsState.getHash(),t.receivesShadow?"/rs":""]).join("");this._state.drawHash!==r&&(this._state.drawHash=r,this._renderers._drawRenderer.put(),this._renderers._shadowRenderer.put(),this._renderers._emphasisFillRenderer.put(),this._renderers._emphasisEdgesRenderer.put(),this._renderers._drawRenderer.get(),this._renderers._emphasisFillRenderer.get(),this._renderers._emphasisEdgesRenderer.get());var i=n.join("");this._state.pickOcclusionHash!==i&&(this._state.pickOcclusionHash=i,this._renderers._pickMeshRenderer.put(),this._renderers._pickTriangleRenderer.put(),this._renderers._pickMeshRenderer.get(),this._state.occluder&&(this._renderers._occlusionRenderer.put(),this._renderers._occlusionRenderer.get()))}},{key:"_setLocalMatrixDirty",value:function(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}},{key:"_setWorldMatrixDirty",value:function(){this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0}},{key:"_buildWorldMatrix",value:function(){var e=this.matrix;if(this._parentNode)De.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(var t=0,n=e.length;t<n;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}},{key:"_buildWorldNormalMatrix",value:function(){this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldNormalMatrix||(this._worldNormalMatrix=De.mat4()),De.transposeMat4(this._worldMatrix,this._worldNormalMatrix),De.inverseMat4(this._worldNormalMatrix),this._worldNormalMatrixDirty=!1}},{key:"_setAABBDirty",value:function(){if(this.collidable)for(var e=this;e;e=e._parentNode)e._aabbDirty=!0}},{key:"_updateAABB",value:function(){this.scene._aabbDirty=!0,this._aabb||(this._aabb=De.AABB3()),this._buildAABB(this.worldMatrix,this._aabb),this._aabbDirty=!1}},{key:"_buildAABB",value:function(e,t){De.transformOBB3(e,this._geometry.obb,ii),De.OBB3ToAABB3(ii,t);var n=this._state.offset;if(t[0]+=n[0],t[1]+=n[1],t[2]+=n[2],t[3]+=n[0],t[4]+=n[1],t[5]+=n[2],this._state.origin){var r=this._state.origin;t[0]+=r[0],t[1]+=r[1],t[2]+=r[2],t[3]+=r[0],t[4]+=r[1],t[5]+=r[2]}}},{key:"rotate",value:function(e,t){return si[0]=e[0],si[1]=e[1],si[2]=e[2],si[3]=t*De.DEGTORAD,De.angleAxisToQuaternion(si,ai),De.mulQuaternions(this.quaternion,ai,oi),this.quaternion=oi,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"rotateOnWorldAxis",value:function(e,t){return si[0]=e[0],si[1]=e[1],si[2]=e[2],si[3]=t*De.DEGTORAD,De.angleAxisToQuaternion(si,ai),De.mulQuaternions(ai,this.quaternion,ai),this}},{key:"rotateX",value:function(e){return this.rotate(Ai,e)}},{key:"rotateY",value:function(e){return this.rotate(ci,e)}},{key:"rotateZ",value:function(e){return this.rotate(li,e)}},{key:"translate",value:function(e,t){return De.vec3ApplyQuaternion(this.quaternion,e,ui),De.mulVec3Scalar(ui,t,hi),De.addVec3(this.position,hi,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}},{key:"translateX",value:function(e){return this.translate(Ai,e)}},{key:"translateY",value:function(e){return this.translate(ci,e)}},{key:"translateZ",value:function(e){return this.translate(li,e)}},{key:"stateSortCompare",value:function(e,t){return e._state.layer-t._state.layer||e._renderers._drawRenderer.getId()-t._renderers._drawRenderer.getId()||e._material._state.id-t._material._state.id||e._geometry._state.id-t._geometry._state.id}},{key:"rebuildRenderFlags",value:function(){this.renderFlags.reset(),this._getActiveSectionPlanes()?(this.renderFlags.numLayers=1,this.renderFlags.numVisibleLayers=1,this.renderFlags.visibleLayers[0]=0,this._updateRenderFlags()):this.renderFlags.culled=!0}},{key:"_updateRenderFlags",value:function(){var e=this.renderFlags,t=this._state;if(t.xrayed){var n=this._xrayMaterial._state;n.fill&&(n.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),n.edges&&(n.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}else{if(this._material._state.alpha<1||t.colorize[3]<1?e.colorTransparent=!0:e.colorOpaque=!0,t.edges)this._edgeMaterial._state.alpha<1?e.edgesTransparent=!0:e.edgesOpaque=!0;if(t.selected){var r=this._selectedMaterial._state;r.fill&&(r.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),r.edges&&(r.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}else if(t.highlighted){var i=this._highlightMaterial._state;i.fill&&(i.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),i.edges&&(i.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}},{key:"_getActiveSectionPlanes",value:function(){if(this._state.clippable){var e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(var n=0;n<t;n++){var r=e[n],i=this.renderFlags;if(r.active)if(this._state.origin){var s=De.planeAABB3Intersect(r.dir,r.dist,this.aabb);if(-1===s)return!1;var a=0===s;i.sectionPlanesActivePerLayer[n]=a}else i.sectionPlanesActivePerLayer[n]=!0;else i.sectionPlanesActivePerLayer[n]=!1}}return!0}},{key:"drawColorOpaque",value:function(e){this._renderers._drawRenderer.drawMesh(e,this,this._material)}},{key:"drawColorTransparent",value:function(e){this._renderers._drawRenderer.drawMesh(e,this,this._material)}},{key:"drawSilhouetteXRayed",value:function(e){this._renderers._emphasisFillRenderer.drawMesh(e,this,this._xrayMaterial)}},{key:"drawSilhouetteHighlighted",value:function(e){this._renderers._emphasisFillRenderer.drawMesh(e,this,this._highlightMaterial)}},{key:"drawSilhouetteSelected",value:function(e){this._renderers._emphasisFillRenderer.drawMesh(e,this,this._selectedMaterial)}},{key:"drawEdgesColorOpaque",value:function(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._edgeMaterial)}},{key:"drawEdgesColorTransparent",value:function(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._edgeMaterial)}},{key:"drawEdgesXRayed",value:function(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._xrayMaterial)}},{key:"drawEdgesHighlighted",value:function(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._highlightMaterial)}},{key:"drawEdgesSelected",value:function(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._selectedMaterial)}},{key:"drawOcclusion",value:function(e){this._renderers._occlusionRenderer.drawMesh(e,this,this._material)}},{key:"drawShadow",value:function(e){this._renderers._shadowRenderer.drawMesh(e,this,this._material)}},{key:"drawPickMesh",value:function(e){this._renderers._pickMeshRenderer.drawMesh(e,this,this._material)}},{key:"canPickTriangle",value:function(){return this._geometry.isReadableGeometry}},{key:"drawPickTriangles",value:function(e){this._renderers._pickTriangleRenderer.drawMesh(e,this,this._material)}},{key:"pickTriangleSurface",value:function(e,t,n,r){gi(this,e,t,n,r)}},{key:"drawPickVertices",value:function(e){}},{key:"delegatePickedEntity",value:function(){return this}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),Object.values(this._renderers).forEach((function(e){return e.put()})),this.scene._renderer.putPickID(this._state.pickID),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.offset.some((function(e){return 0!==e}))&&this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this.glRedraw()}}]),n}(),gi=function(){var e=De.vec3(),t=De.vec3(),n=De.vec3(),r=De.vec3(),i=De.vec3(),s=De.vec3(),a=De.vec4(),o=De.vec3(),A=De.vec3(),c=De.vec3(),l=De.vec3(),u=De.vec3(),h=De.vec3(),d=De.vec3(),f=De.vec3(),p=De.vec3(),v=De.vec4(),g=De.vec4(),m=De.vec4(),y=De.vec3(),_=De.vec3(),b=De.vec3(),w=De.vec3(),B=De.vec3(),C=De.vec3(),M=De.vec3(),k=De.vec3(),E=De.vec3(),F=De.vec3(),x=De.vec3();return function(U,I,T,P,S){var D=S.primIndex;if(null!=D&&D>-1){var Q=U.geometry._state,R=U.scene,O=R.camera,V=R.canvas;if("triangles"===Q.primitiveName){S.primitive="triangle";var L,H,N,G=D,j=Q.indices,W=Q.positions;if(j){var z=j[G+0],X=j[G+1],K=j[G+2];s[0]=z,s[1]=X,s[2]=K,S.indices=s,L=3*z,H=3*X,N=3*K}else N=(H=(L=3*G)+3)+3;if(n[0]=W[L+0],n[1]=W[L+1],n[2]=W[L+2],r[0]=W[H+0],r[1]=W[H+1],r[2]=W[H+2],i[0]=W[N+0],i[1]=W[N+1],i[2]=W[N+2],Q.compressGeometry){var Z=Q.positionsDecodeMatrix;Z&&(Nt.decompressPosition(n,Z,n),Nt.decompressPosition(r,Z,r),Nt.decompressPosition(i,Z,i))}S.canvasPos?De.canvasPosToLocalRay(V.canvas,U.origin?Bn(I,U.origin):I,T,P,U.worldMatrix,S.canvasPos,e,t):S.origin&&S.direction&&De.worldRayToLocalRay(U.worldMatrix,S.origin,S.direction,e,t),De.normalizeVec3(t),De.rayPlaneIntersect(e,t,n,r,i,a),S.localPos=a,S.position=a,v[0]=a[0],v[1]=a[1],v[2]=a[2],v[3]=1,De.transformVec4(U.worldMatrix,v,g),o[0]=g[0],o[1]=g[1],o[2]=g[2],S.canvasPos&&U.origin&&(o[0]+=U.origin[0],o[1]+=U.origin[1],o[2]+=U.origin[2]),S.worldPos=o,De.transformVec4(O.matrix,g,m),A[0]=m[0],A[1]=m[1],A[2]=m[2],S.viewPos=A,De.cartesianToBarycentric(a,n,r,i,c),S.bary=c;var J=Q.normals;if(J){if(Q.compressGeometry){var Y=3*z,q=3*X,$=3*K;Nt.decompressNormal(J.subarray(Y,Y+2),l),Nt.decompressNormal(J.subarray(q,q+2),u),Nt.decompressNormal(J.subarray($,$+2),h)}else l[0]=J[L],l[1]=J[L+1],l[2]=J[L+2],u[0]=J[H],u[1]=J[H+1],u[2]=J[H+2],h[0]=J[N],h[1]=J[N+1],h[2]=J[N+2];var ee=De.addVec3(De.addVec3(De.mulVec3Scalar(l,c[0],y),De.mulVec3Scalar(u,c[1],_),b),De.mulVec3Scalar(h,c[2],w),B);S.worldNormal=De.normalizeVec3(De.transformVec3(U.worldNormalMatrix,ee,C))}var te=Q.uv;if(te){if(d[0]=te[2*z],d[1]=te[2*z+1],f[0]=te[2*X],f[1]=te[2*X+1],p[0]=te[2*K],p[1]=te[2*K+1],Q.compressGeometry){var ne=Q.uvDecodeMatrix;ne&&(Nt.decompressUV(d,ne,d),Nt.decompressUV(f,ne,f),Nt.decompressUV(p,ne,p))}S.uv=De.addVec3(De.addVec3(De.mulVec2Scalar(d,c[0],M),De.mulVec2Scalar(f,c[1],k),E),De.mulVec2Scalar(p,c[2],F),x)}}}}}(),mi=function(e,t,n,r,i){var s,a,o=i.programVariables,A=n.decodedUv,c=n.worldNormal,l=n.viewNormal,u=e.scene,h=u.canvas.gl,d=e._state.background,f=e._geometry._state,v=f.compressGeometry,g="points"===f.primitiveName,m=o.createUniform("float","pointSize"),y=o.createUniform("mat4","modelMatrix"),_=o.createUniform("mat4","modelNormalMatrix"),b=o.createUniform("vec3","offset"),w=o.createUniform("vec3","scale"),B=o.createUniform("mat4","positionsDecodeMatrix"),C=o.createUniform("mat3","uvDecodeMatrix"),M=o.createUniform("mat4","viewMatrix"),E=o.createUniform("mat4","viewNormalMatrix"),F=o.createUniform("mat4","projMatrix"),x=e.billboard,U=!r.dontBillboardAnything&&("spherical"===x||"cylindrical"===x),I=e.stationary,T=U&&function(e,t){return["mat4 ".concat(e,"(in mat4 matIn) {"),"   mat4 mat = matIn;","   mat[0].xyz = vec3(".concat(w,"[0], 0.0, 0.0);")].concat(p("spherical"===x?["   mat[1].xyz = vec3(0.0, ".concat(w,"[1], 0.0);")]:[]),["   mat[2].xyz = vec3(0.0, 0.0, 1.0);","   return mat;","}"]).forEach((function(e){return t.push(e)}))},P=(s=T&&o.createVertexDefinition("billboard",T),function(e){return s?"".concat(s,"(").concat(e,")"):e}),S=(a=T&&o.createFragmentDefinition("billboard",T),function(e){return a?"".concat(a,"(").concat(e,")"):e}),D=[];r.dontBillboardAnything?D.push("mat4 viewMatrix2 = ".concat(M,";")):(D.push("mat4 viewMatrix1 = ".concat(M,";")),I?D.push("viewMatrix1[3].xyz = vec3(0.0, 0.0, 0.0);"):d&&D.push("viewMatrix1[3]     = vec4(0.0, 0.0, 0.0, 1.0);"),D.push("mat4 viewMatrix2 = ".concat(S("viewMatrix1"),";")));var Q="clipPos",R=o.createUniform("bool","clippable"),O=k(i.buildProgram(h,r.programName,{appendFragmentOutputs:function(e,t,n,i){D.forEach((function(t){return e.push(t)})),r.appendFragmentOutputs(e,t,n,i)},clippableTest:function(){return R},clippingCaps:r.clippingCaps,clipPos:d?"".concat(Q,".xyww"):Q,crossSections:u.crossSections,discardPoints:g&&r.discardPoints,getGammaFactor:u.gammaOutput&&function(){return u.gammaFactor},getLogDepth:!r.dontGetLogDepth&&u.logarithmicDepthBufferEnabled&&function(e){return e},getPointSize:r.setupPointSize&&g&&function(){return m},getVertexData:function(){var e=l&&l.needed&&"vec3 ".concat(l," = normalize((").concat(P(E)," * vec4(").concat(c,", 0.0)).xyz);"),n=[];if(n.push("vec4 localPosition = vec4(".concat(t.position,", 1.0);")),v&&n.push("localPosition = ".concat(B," * localPosition;")),n.push("vec4 worldPosition = ".concat(P(y)," * localPosition;")),n.push("worldPosition.xyz = worldPosition.xyz + ".concat(b,";")),r.dontBillboardAnything?n.push("vec4 viewPosition = ".concat(M," * worldPosition;")):(n.push("mat4 viewMatrix1 = ".concat(M,";")),I?n.push("viewMatrix1[3].xyz = vec3(0.0, 0.0, 0.0);"):d&&n.push("viewMatrix1[3]     = vec4(0.0, 0.0, 0.0, 1.0);"),n.push("mat4 viewMatrix2 = ".concat(P("viewMatrix1"),";")),n.push("vec4 viewPosition = ".concat(U?"".concat(P("viewMatrix1 * ".concat(y))," * localPosition"):"viewMatrix2 * worldPosition",";"))),A&&A.needed&&n.push("vec2 ".concat(A," = ").concat(v?"(".concat(C," * vec3(").concat(t.uv,", 1.0)).xy"):t.uv,";")),c&&c.needed){var i=v?"".concat(o.commonLibrary.octDecode,"(").concat(t.normal,".xy)"):t.normal;n.push("vec3 ".concat(c," = (").concat(P(_)," * vec4(").concat(i,", 0.0)).xyz;"))}return e&&n.push(e),n.push("vec4 ".concat(Q," = ").concat(F," * viewPosition;")),n},projMatrix:F,sectionPlanesState:u._sectionPlanesState,testPerspectiveForGl_FragDepth:!0,usePickClipPos:r.isPick,worldPositionAttribute:"worldPosition"}),2),V=O[0],L=O[1];if(L)return{errors:L};var H=V.inputSetters,N=null,G=null;return{destroy:function(){return V.destroy()},drawMesh:function(e,n,i){if(!(r.skipIfTransparent&&i.alpha<1)){var s=i._state,a=n._state,o=n._geometry,A=o._state,c=e.viewParams,l=r.canActAsBackground&&d;e.lastProgramId!==V.id&&(e.lastProgramId=V.id,V.bind(),e.useProgram++,N=null,G=null,l&&h.depthFunc(h.LEQUAL)),s.id!==N&&(e.backfaces!==s.backfaces&&(s.backfaces?h.disable(h.CULL_FACE):h.enable(h.CULL_FACE),e.backfaces=s.backfaces),r.dontSetFrontFace||e.frontface===s.frontface||(h.frontFace(s.frontface?h.CCW:h.CW),e.frontface=s.frontface),r.drawEdges&&e.lineWidth!==s.edgeWidth&&(h.lineWidth(s.edgeWidth),e.lineWidth=s.edgeWidth),r.setsLineWidth&&e.lineWidth!==s.lineWidth&&(h.lineWidth(s.lineWidth),e.lineWidth=s.lineWidth),N=s.id);var u,f,p,v=!r.useShadowView&&n.origin;u=c.projMatrix,f=v?e.getRTCViewMatrix(a.originHash,v):c.viewMatrix,p=function(e,t){return e.setInputValue&&e.setInputValue(t)},p(m,i.pointSize),p(y,n.worldMatrix),p(_,n.worldNormalMatrix),p(b,n.offset),p(w,n.scale),p(B,A.positionsDecodeMatrix),p(C,A.uvDecodeMatrix),p(M,f),p(E,c.viewNormalMatrix),p(F,u),p(R,n.clippable),H.setUniforms(e,{material:i,meshColorize:n.colorize,meshPickID:n._state.pickID,mesh:{origin:n.origin,renderFlags:{sectionPlanesActivePerLayer:n.renderFlags.sectionPlanesActivePerLayer}},view:{far:c.far}});var g=function(n){var r=function(t,n){t&&t.setInputValue&&n&&(t.setInputValue(n),e.bindArray++)};r(t.position,(n||A).positionsBuf),r(t.color,A.colorsBuf),r(t.pickColor,n&&n.pickColorsBuf),r(t.uv,A.uvBuf),r(t.normal,A.normalsBuf)};if(r.trianglePick){var k=o._getPickTrianglePositions();A.id!==G&&(g({positionsBuf:k,pickColorsBuf:o._getPickTriangleColors()}),G=A.id),h.drawArrays(A.primitive,0,k.numItems/3)}else if(r.drawEdges){var x=A.primitive===h.TRIANGLES?o._getEdgeIndices():A.primitive===h.LINES&&A.indicesBuf;x&&(A.id!==G&&(g(),x.bind(),e.bindArray++,G=A.id),h.drawElements(h.LINES,x.numItems,x.itemType,0),e.drawElements++)}else A.id!==G&&(g(),A.indicesBuf&&(A.indicesBuf.bind(),e.bindArray++),G=A.id),A.indicesBuf?(h.drawElements(A.primitive,A.indicesBuf.numItems,A.indicesBuf.itemType,0),e.drawElements++):A.positionsBuf&&(h.drawArrays(h.TRIANGLES,0,A.positionsBuf.numItems),e.drawArrays++);l&&h.depthFunc(h.LESS)}}}},yi=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),r=t.call(this,e,i),Ve.memory.materials++,r}return I(n,[{key:"type",get:function(){return"Material"}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),Ve.memory.materials--}}]),n}(),_i={opaque:0,mask:1,blend:2},bi=["opaque","mask","blend"],wi=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"PhongMaterial",ambient:De.vec3([1,1,1]),diffuse:De.vec3([1,1,1]),specular:De.vec3([1,1,1]),emissive:De.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),r.ambient=i.ambient,r.diffuse=i.diffuse,r.specular=i.specular,r.emissive=i.emissive,r.alpha=i.alpha,r.shininess=i.shininess,r.reflectivity=i.reflectivity,r.lineWidth=i.lineWidth,r.pointSize=i.pointSize,i.ambientMap&&(r._ambientMap=r._checkComponent("Texture",i.ambientMap)),i.diffuseMap&&(r._diffuseMap=r._checkComponent("Texture",i.diffuseMap)),i.specularMap&&(r._specularMap=r._checkComponent("Texture",i.specularMap)),i.emissiveMap&&(r._emissiveMap=r._checkComponent("Texture",i.emissiveMap)),i.alphaMap&&(r._alphaMap=r._checkComponent("Texture",i.alphaMap)),i.reflectivityMap&&(r._reflectivityMap=r._checkComponent("Texture",i.reflectivityMap)),i.normalMap&&(r._normalMap=r._checkComponent("Texture",i.normalMap)),i.occlusionMap&&(r._occlusionMap=r._checkComponent("Texture",i.occlusionMap)),i.diffuseFresnel&&(r._diffuseFresnel=r._checkComponent("Fresnel",i.diffuseFresnel)),i.specularFresnel&&(r._specularFresnel=r._checkComponent("Fresnel",i.specularFresnel)),i.emissiveFresnel&&(r._emissiveFresnel=r._checkComponent("Fresnel",i.emissiveFresnel)),i.alphaFresnel&&(r._alphaFresnel=r._checkComponent("Fresnel",i.alphaFresnel)),i.reflectivityFresnel&&(r._reflectivityFresnel=r._checkComponent("Fresnel",i.reflectivityFresnel)),r.alphaMode=i.alphaMode,r.alphaCutoff=i.alphaCutoff,r.backfaces=i.backfaces,r.frontface=i.frontface,r._makeHash(),r}return I(n,[{key:"type",get:function(){return"PhongMaterial"}},{key:"_makeHash",value:function(){var e=this._state,t=["/p"];this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._ambientMap&&(t.push("/am"),this._ambientMap.hasMatrix&&t.push("/mat"),t.push("/"+this._ambientMap.encoding)),this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat"),t.push("/"+this._emissiveMap.encoding)),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),this._reflectivityMap&&(t.push("/rm"),this._reflectivityMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._diffuseFresnel&&t.push("/df"),this._specularFresnel&&t.push("/sf"),this._emissiveFresnel&&t.push("/ef"),this._alphaFresnel&&t.push("/of"),this._reflectivityFresnel&&t.push("/rf"),t.push(";"),e.hash=t.join("")}},{key:"ambient",get:function(){return this._state.ambient},set:function(e){var t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"diffuse",get:function(){return this._state.diffuse},set:function(e){var t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"specular",get:function(){return this._state.specular},set:function(e){var t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}},{key:"shininess",get:function(){return this._state.shininess},set:function(e){this._state.shininess=void 0!==e?e:80,this.glRedraw()}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"reflectivity",get:function(){return this._state.reflectivity},set:function(e){this._state.reflectivity=void 0!==e?e:1,this.glRedraw()}},{key:"normalMap",get:function(){return this._normalMap}},{key:"ambientMap",get:function(){return this._ambientMap}},{key:"diffuseMap",get:function(){return this._diffuseMap}},{key:"specularMap",get:function(){return this._specularMap}},{key:"emissiveMap",get:function(){return this._emissiveMap}},{key:"alphaMap",get:function(){return this._alphaMap}},{key:"reflectivityMap",get:function(){return this._reflectivityMap}},{key:"occlusionMap",get:function(){return this._occlusionMap}},{key:"diffuseFresnel",get:function(){return this._diffuseFresnel}},{key:"specularFresnel",get:function(){return this._specularFresnel}},{key:"emissiveFresnel",get:function(){return this._emissiveFresnel}},{key:"alphaFresnel",get:function(){return this._alphaFresnel}},{key:"reflectivityFresnel",get:function(){return this._reflectivityFresnel}},{key:"alphaMode",get:function(){return bi[this._state.alphaMode]},set:function(e){var t=_i[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" - defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}},{key:"alphaCutoff",get:function(){return this._state.alphaCutoff},set:function(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}();function Bi(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];var n;switch(t){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(t)}return e._cachedExtensions[t]=n,n}function Ci(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=t;if(1009===i)return e.UNSIGNED_BYTE;if(1017===i)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===i)return e.BYTE;if(1011===i)return e.SHORT;if(1012===i)return e.UNSIGNED_SHORT;if(1013===i)return e.INT;if(1014===i)return e.UNSIGNED_INT;if(1015===i)return e.FLOAT;if(1016===i)return e.HALF_FLOAT;if(1021===i)return e.ALPHA;if(1023===i)return e.RGBA;if(1024===i)return e.LUMINANCE;if(1025===i)return e.LUMINANCE_ALPHA;if(1026===i)return e.DEPTH_COMPONENT;if(1027===i)return e.DEPTH_STENCIL;if(1028===i)return e.RED;if(1022===i)return e.RGBA;if(1029===i)return e.RED_INTEGER;if(1030===i)return e.RG;if(1031===i)return e.RG_INTEGER;if(1033===i)return e.RGBA_INTEGER;if(33776===i||33777===i||33778===i||33779===i)if(3001===r){var s=Bi(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===s)return null;if(33776===i)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===i)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===i)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===i)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(n=Bi(e,"WEBGL_compressed_texture_s3tc")))return null;if(33776===i)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===i)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===i)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===i)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===i||35841===i||35842===i||35843===i){var a=Bi(e,"WEBGL_compressed_texture_pvrtc");if(null===a)return null;if(35840===i)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===i)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===i){var o=Bi(e,"WEBGL_compressed_texture_etc1");return null!==o?o.COMPRESSED_RGB_ETC1_WEBGL:null}if(37492===i||37496===i){var A=Bi(e,"WEBGL_compressed_texture_etc");if(null===A)return null;if(37492===i)return 3001===r?A.COMPRESSED_SRGB8_ETC2:A.COMPRESSED_RGB8_ETC2;if(37496===i)return 3001===r?A.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:A.COMPRESSED_RGBA8_ETC2_EAC}if(37808===i||37809===i||37810===i||37811===i||37812===i||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){var c=Bi(e,"WEBGL_compressed_texture_astc");if(null===c)return null;if(37808===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:c.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:c.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:c.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:c.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:c.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:c.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:c.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:c.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:c.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:c.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:c.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:c.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:c.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return 3001===r?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:c.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===i){var l=Bi(e,"EXT_texture_compression_bptc");if(null===l)return null;if(36492===i)return 3001===r?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===i?e.UNSIGNED_INT_24_8:1e3===i?e.REPEAT:1001===i?e.CLAMP_TO_EDGE:1004===i||1005===i?e.NEAREST_MIPMAP_LINEAR:1007===i?e.LINEAR_MIPMAP_NEAREST:1008===i?e.LINEAR_MIPMAP_LINEAR:1003===i?e.NEAREST:1006===i?e.LINEAR:null}var Mi=new Uint8Array([0,0,0,1]),ki=function(){function e(t){var n=t.gl,r=t.target,i=t.format,s=t.type,a=t.wrapS,o=t.wrapT,A=t.wrapR,c=t.encoding,l=t.preloadColor,u=t.premultiplyAlpha,h=t.flipY;x(this,e),this.gl=n,this.target=r||n.TEXTURE_2D,this.format=i||1023,this.type=s||1009,this.internalFormat=null,this.premultiplyAlpha=!!u,this.flipY=!!h,this.unpackAlignment=4,this.wrapS=a||1e3,this.wrapT=o||1e3,this.wrapR=A||1e3,this.encoding=c||3001,this.texture=n.createTexture(),l&&this.setPreloadColor(l),this.allocated=!0}return I(e,[{key:"setPreloadColor",value:function(e){e?(Mi[0]=Math.floor(255*e[0]),Mi[1]=Math.floor(255*e[1]),Mi[2]=Math.floor(255*e[2]),Mi[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(Mi[0]=0,Mi[1]=0,Mi[2]=0,Mi[3]=255);var t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP)for(var n=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],r=0,i=n.length;r<i;r++)t.texImage2D(n[r],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Mi);else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,Mi);t.bindTexture(this.target,null)}},{key:"setTarget",value:function(e){this.target=e||this.gl.TEXTURE_2D}},{key:"setImage",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR);var r=!1;n.bindTexture(this.target,this.texture);var i=n.getParameter(n.UNPACK_FLIP_Y_WEBGL);n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,this.flipY);var s=n.getParameter(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL);n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);var a=n.getParameter(n.UNPACK_ALIGNMENT);n.pixelStorei(n.UNPACK_ALIGNMENT,this.unpackAlignment);var o=n.getParameter(n.UNPACK_COLORSPACE_CONVERSION_WEBGL);n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE);var A=Ci(n,this.minFilter);n.texParameteri(this.target,n.TEXTURE_MIN_FILTER,A),A!==n.NEAREST_MIPMAP_NEAREST&&A!==n.LINEAR_MIPMAP_NEAREST&&A!==n.NEAREST_MIPMAP_LINEAR&&A!==n.LINEAR_MIPMAP_LINEAR||(r=!0);var c=Ci(n,this.magFilter);c&&n.texParameteri(this.target,n.TEXTURE_MAG_FILTER,c);var l=Ci(n,this.wrapS);l&&n.texParameteri(this.target,n.TEXTURE_WRAP_S,l);var u=Ci(n,this.wrapT);u&&n.texParameteri(this.target,n.TEXTURE_WRAP_T,u);var h=Ci(n,this.format,this.encoding),d=Ci(n,this.type),f=Ei(n,this.internalFormat,h,d,this.encoding,!1);if(this.target===n.TEXTURE_CUBE_MAP){if(je.isArray(e))for(var p=e,v=[n.TEXTURE_CUBE_MAP_POSITIVE_X,n.TEXTURE_CUBE_MAP_NEGATIVE_X,n.TEXTURE_CUBE_MAP_POSITIVE_Y,n.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.TEXTURE_CUBE_MAP_POSITIVE_Z,n.TEXTURE_CUBE_MAP_NEGATIVE_Z],g=0,m=v.length;g<m;g++)n.texImage2D(v[g],0,f,h,d,p[g])}else n.texImage2D(n.TEXTURE_2D,0,f,h,d,e);r&&n.generateMipmap(this.target),n.bindTexture(this.target,null),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,i),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),n.pixelStorei(n.UNPACK_ALIGNMENT,a),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,o)}},{key:"setCompressedData",value:function(e){var t=e.mipmaps,n=e.props,r=void 0===n?{}:n,i=this.gl,s=t.length;void 0!==r.format&&(this.format=r.format),void 0!==r.internalFormat&&(this.internalFormat=r.internalFormat),void 0!==r.encoding&&(this.encoding=r.encoding),void 0!==r.type&&(this.type=r.type),void 0!==r.flipY&&(this.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(this.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(this.unpackAlignment=r.unpackAlignment),void 0!==r.minFilter&&(this.minFilter=r.minFilter),void 0!==r.magFilter&&(this.magFilter=r.magFilter),void 0!==r.wrapS&&(this.wrapS=r.wrapS),void 0!==r.wrapT&&(this.wrapT=r.wrapT),void 0!==r.wrapR&&(this.wrapR=r.wrapR),i.activeTexture(i.TEXTURE0+0),i.bindTexture(this.target,this.texture);var a=t.length>1;i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,this.flipY),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),i.pixelStorei(i.UNPACK_ALIGNMENT,this.unpackAlignment),i.pixelStorei(i.UNPACK_COLORSPACE_CONVERSION_WEBGL,i.NONE);var o=Ci(i,this.wrapS);o&&i.texParameteri(this.target,i.TEXTURE_WRAP_S,o);var A=Ci(i,this.wrapT);if(A&&i.texParameteri(this.target,i.TEXTURE_WRAP_T,A),this.type===i.TEXTURE_3D||this.type===i.TEXTURE_2D_ARRAY){var c=Ci(i,this.wrapR);c&&i.texParameteri(this.target,i.TEXTURE_WRAP_R,c),i.texParameteri(this.type,i.TEXTURE_WRAP_R,c)}a?(i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,Fi(i,this.minFilter)),i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,Fi(i,this.magFilter))):(i.texParameteri(this.target,i.TEXTURE_MIN_FILTER,Ci(i,this.minFilter)),i.texParameteri(this.target,i.TEXTURE_MAG_FILTER,Ci(i,this.magFilter)));var l=Ci(i,this.format,this.encoding),u=Ci(i,this.type),h=Ei(i,this.internalFormat,l,u,this.encoding,!1);i.texStorage2D(i.TEXTURE_2D,s,h,t[0].width,t[0].height);for(var d=0,f=t.length;d<f;d++){var p=t[d];1023!==this.format?null!==l?i.compressedTexSubImage2D(i.TEXTURE_2D,d,0,0,p.width,p.height,l,p.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):i.texSubImage2D(i.TEXTURE_2D,d,0,0,p.width,p.height,l,u,p.data)}i.bindTexture(this.target,null)}},{key:"setProps",value:function(e){var t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)}},{key:"_uploadProps",value:function(e){var t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){var n=Ci(t,e.minFilter);n&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,n),n!==t.NEAREST_MIPMAP_NEAREST&&n!==t.LINEAR_MIPMAP_NEAREST&&n!==t.NEAREST_MIPMAP_LINEAR&&n!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){var r=Ci(t,e.magFilter);r&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,r))}if(void 0!==e.wrapS){var i=Ci(t,e.wrapS);i&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,i))}if(void 0!==e.wrapT){var s=Ci(t,e.wrapT);s&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,s))}}},{key:"bind",value:function(e){if(this.allocated){if(this.texture){var t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1}}},{key:"unbind",value:function(e){if(this.allocated&&this.texture){var t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}}},{key:"destroy",value:function(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}]),e}();function Ei(e,t,n,r,i){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}var a=n;return n===e.RED&&(r===e.FLOAT&&(a=e.R32F),r===e.HALF_FLOAT&&(a=e.R16F),r===e.UNSIGNED_BYTE&&(a=e.R8)),n===e.RG&&(r===e.FLOAT&&(a=e.RG32F),r===e.HALF_FLOAT&&(a=e.RG16F),r===e.UNSIGNED_BYTE&&(a=e.RG8)),n===e.RGBA&&(r===e.FLOAT&&(a=e.RGBA32F),r===e.HALF_FLOAT&&(a=e.RGBA16F),r===e.UNSIGNED_BYTE&&(a=3001===i&&!1===s?e.SRGB8_ALPHA8:e.RGBA8),r===e.UNSIGNED_SHORT_4_4_4_4&&(a=e.RGBA4),r===e.UNSIGNED_SHORT_5_5_5_1&&(a=e.RGB5_A1)),a!==e.R16F&&a!==e.R32F&&a!==e.RG16F&&a!==e.RG32F&&a!==e.RGBA16F&&a!==e.RGBA32F||Bi(e,"EXT_color_buffer_float"),a}function Fi(e,t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function xi(e){if(!Ui(e.width)||!Ui(e.height)){var t=document.createElement("canvas");t.width=Ii(e.width),t.height=Ii(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function Ui(e){return 0==(e&e-1)}function Ii(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}var Ti=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({texture:new ki({gl:r.scene.canvas.gl}),matrix:De.identityMat4(),hasMatrix:i.translate&&(0!==i.translate[0]||0!==i.translate[1])||!!i.rotate||i.scale&&(0!==i.scale[0]||0!==i.scale[1]),minFilter:r._checkMinFilter(i.minFilter),magFilter:r._checkMagFilter(i.magFilter),wrapS:r._checkWrapS(i.wrapS),wrapT:r._checkWrapT(i.wrapT),flipY:r._checkFlipY(i.flipY),encoding:r._checkEncoding(i.encoding)}),r._src=null,r._image=null,r._translate=De.vec2([0,0]),r._scale=De.vec2([1,1]),r._rotate=De.vec2([0,0]),r._matrixDirty=!1,r.translate=i.translate,r.scale=i.scale,r.rotate=i.rotate,i.src?r.src=i.src:i.image&&(r.image=i.image),Ve.memory.textures++,r}return I(n,[{key:"type",get:function(){return"Texture"}},{key:"_checkMinFilter",value:function(e){return 1006!==(e=e||1008)&&1007!==e&&1008!==e&&1005!==e&&1004!==e&&(this.error("Unsupported value for 'minFilter' - supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, NearestMipMapLinearFilter and LinearMipMapLinearFilter. Defaulting to LinearMipMapLinearFilter."),e=1008),e}},{key:"_checkMagFilter",value:function(e){return 1006!==(e=e||1006)&&1003!==e&&(this.error("Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),e=1006),e}},{key:"_checkWrapS",value:function(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}},{key:"_checkWrapT",value:function(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}},{key:"_checkFlipY",value:function(e){return!!e}},{key:"_checkEncoding",value:function(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}},{key:"_update",value:function(){var e,t,n=this._state;this._matrixDirty&&(0===this._translate[0]&&0===this._translate[1]||(e=De.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix)),1===this._scale[0]&&1===this._scale[1]||(t=De.scalingMat4v([this._scale[0],this._scale[1],1]),e=e?De.mulMat4(e,t):t),0!==this._rotate&&(t=De.rotationMat4v(.0174532925*this._rotate,[0,0,1]),e=e?De.mulMat4(e,t):t),e&&(n.matrix=e),this._matrixDirty=!1);this.glRedraw()}},{key:"image",get:function(){return this._image},set:function(e){this._image=xi(e),this._image.crossOrigin="Anonymous",this._state.texture.setImage(this._image,this._state),this._src=null,this.glRedraw()}},{key:"src",get:function(){return this._src},set:function(e){this.scene.loading++,this.scene.canvas.spinner.processes++;var t=this,n=new Image;n.onload=function(){n=xi(n),t._state.texture.setImage(n,t._state),t.scene.loading--,t.glRedraw(),t.scene.canvas.spinner.processes--},n.src=e,this._src=e,this._image=null}},{key:"translate",get:function(){return this._translate},set:function(e){this._translate.set(e||[0,0]),this._matrixDirty=!0,this._needUpdate()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1]),this._matrixDirty=!0,this._needUpdate()}},{key:"rotate",get:function(){return this._rotate},set:function(e){e=e||0,this._rotate!==e&&(this._rotate=e,this._matrixDirty=!0,this._needUpdate())}},{key:"minFilter",get:function(){return this._state.minFilter}},{key:"magFilter",get:function(){return this._state.magFilter}},{key:"wrapS",get:function(){return this._state.wrapS}},{key:"wrapT",get:function(){return this._state.wrapT}},{key:"flipY",get:function(){return this._state.flipY}},{key:"encoding",get:function(){return this._state.encoding}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.texture&&this._state.texture.destroy(),this._state.destroy(),Ve.memory.textures--}}]),n}(),Pi=De.vec3(),Si=De.vec3();De.vec3();var Di,Qi=De.vec3([0,-1,0]),Ri=De.vec4([0,0,0,1]),Oi=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._src=null,r._image=null,r._pos=De.vec3(),r._origin=De.vec3(),r._rtcPos=De.vec3(),r._dir=De.vec3(),r._size=1,r._imageSize=De.vec2(),r._texture=new Ti(w(r)),r._plane=new vi(w(r),{geometry:new Wt(w(r),rn({center:[0,0,0],xSize:1,zSize:1,xSegments:10,zSegments:10})),material:new wi(w(r),{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:r._texture,emissiveMap:r._texture,backfaces:!0}),clippable:i.clippable}),r._grid=new vi(w(r),{geometry:new Wt(w(r),nn({size:1,divisions:10})),material:new wi(w(r),{diffuse:[0,0,0],ambient:[0,0,0],emissive:[.2,.8,.2]}),position:[0,.001,0],clippable:i.clippable}),r._node=new bn(w(r),{rotation:[0,0,0],position:[0,0,0],scale:[1,1,1],clippable:!1,children:[r._plane,r._grid]}),r._gridVisible=!1,r.visible=!0,r.gridVisible=i.gridVisible,r.position=i.position,r.rotation=i.rotation,r.dir=i.dir,r.size=i.size,r.collidable=i.collidable,r.clippable=i.clippable,r.pickable=i.pickable,r.opacity=i.opacity,i.image?r.image=i.image:r.src=i.src,r}return I(n,[{key:"visible",get:function(){return this._plane.visible},set:function(e){this._plane.visible=e,this._grid.visible=this._gridVisible&&e}},{key:"gridVisible",get:function(){return this._gridVisible},set:function(e){e=!1!==e,this._gridVisible=e,this._grid.visible=this._gridVisible&&this.visible}},{key:"image",get:function(){return this._image},set:function(e){this._image=e,this._image&&(this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}},{key:"src",get:function(){return this._src},set:function(e){var t=this;if(this._src=e,this._src){this._image=null;var n=new Image;n.onload=function(){t._texture.image=n,t._imageSize[0]=n.width,t._imageSize[1]=n.height,t._updatePlaneSizeFromImage()},n.src=this._src}}},{key:"position",get:function(){return this._pos},set:function(e){this._pos.set(e||[0,0,0]),Cn(this._pos,this._origin,this._rtcPos),this._node.origin=this._origin,this._node.position=this._rtcPos}},{key:"rotation",get:function(){return this._node.rotation},set:function(e){this._node.rotation=e}},{key:"size",get:function(){return this._size},set:function(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}},{key:"dir",get:function(){return this._dir},set:function(e){if(this._dir.set(e||[0,0,-1]),e){var t=this.scene.center,n=[-this._dir[0],-this._dir[1],-this._dir[2]];De.subVec3(t,this.position,Pi);var r=-De.dotVec3(n,Pi);De.normalizeVec3(n),De.mulVec3Scalar(n,r,Si),De.vec3PairToQuaternion(Qi,e,Ri),this._node.quaternion=Ri}}},{key:"collidable",get:function(){return this._node.collidable},set:function(e){this._node.collidable=!1!==e}},{key:"clippable",get:function(){return this._node.clippable},set:function(e){this._node.clippable=!1!==e}},{key:"pickable",get:function(){return this._node.pickable},set:function(e){this._node.pickable=!1!==e}},{key:"opacity",get:function(){return this._node.opacity},set:function(e){this._node.opacity=e}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}},{key:"_updatePlaneSizeFromImage",value:function(){var e=this._size,t=this._imageSize[0],n=this._imageSize[1];if(t>n){var r=n/t;this._node.scale=[e,1,e*r]}else{var i=t/n;this._node.scale=[e*i,1,e]}}}]),n}(),Vi=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"LambertMaterial",ambient:De.vec3([1,1,1]),color:De.vec3([1,1,1]),emissive:De.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"}),r.ambient=i.ambient,r.color=i.color,r.emissive=i.emissive,r.alpha=i.alpha,r.lineWidth=i.lineWidth,r.pointSize=i.pointSize,r.backfaces=i.backfaces,r.frontface=i.frontface,r}return I(n,[{key:"type",get:function(){return"LambertMaterial"}},{key:"ambient",get:function(){return this._state.ambient},set:function(e){var t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"color",get:function(){return this._state.color},set:function(e){var t=this._state.color;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.color=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this._state.alphaMode=e<1?2:0,this.glRedraw())}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),Li={opaque:0,mask:1,blend:2},Hi=["opaque","mask","blend"],Ni=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"MetallicMaterial",baseColor:De.vec4([1,1,1]),emissive:De.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),r.baseColor=i.baseColor,r.metallic=i.metallic,r.roughness=i.roughness,r.specularF0=i.specularF0,r.emissive=i.emissive,r.alpha=i.alpha,i.baseColorMap&&(r._baseColorMap=r._checkComponent("Texture",i.baseColorMap)),i.metallicMap&&(r._metallicMap=r._checkComponent("Texture",i.metallicMap)),i.roughnessMap&&(r._roughnessMap=r._checkComponent("Texture",i.roughnessMap)),i.metallicRoughnessMap&&(r._metallicRoughnessMap=r._checkComponent("Texture",i.metallicRoughnessMap)),i.emissiveMap&&(r._emissiveMap=r._checkComponent("Texture",i.emissiveMap)),i.occlusionMap&&(r._occlusionMap=r._checkComponent("Texture",i.occlusionMap)),i.alphaMap&&(r._alphaMap=r._checkComponent("Texture",i.alphaMap)),i.normalMap&&(r._normalMap=r._checkComponent("Texture",i.normalMap)),r.alphaMode=i.alphaMode,r.alphaCutoff=i.alphaCutoff,r.backfaces=i.backfaces,r.frontface=i.frontface,r.lineWidth=i.lineWidth,r.pointSize=i.pointSize,r._makeHash(),r}return I(n,[{key:"type",get:function(){return"MetallicMaterial"}},{key:"_makeHash",value:function(){var e=this._state,t=["/met"];this._baseColorMap&&(t.push("/bm"),this._baseColorMap._state.hasMatrix&&t.push("/mat"),t.push("/"+this._baseColorMap._state.encoding)),this._metallicMap&&(t.push("/mm"),this._metallicMap._state.hasMatrix&&t.push("/mat")),this._roughnessMap&&(t.push("/rm"),this._roughnessMap._state.hasMatrix&&t.push("/mat")),this._metallicRoughnessMap&&(t.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap._state.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap._state.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/am"),this._alphaMap._state.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap._state.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}},{key:"baseColor",get:function(){return this._state.baseColor},set:function(e){var t=this._state.baseColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.baseColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"baseColorMap",get:function(){return this._baseColorMap}},{key:"metallic",get:function(){return this._state.metallic},set:function(e){e=null!=e?e:1,this._state.metallic!==e&&(this._state.metallic=e,this.glRedraw())}},{key:"metallicMap",get:function(){return this._attached.metallicMap}},{key:"roughness",get:function(){return this._state.roughness},set:function(e){e=null!=e?e:1,this._state.roughness!==e&&(this._state.roughness=e,this.glRedraw())}},{key:"roughnessMap",get:function(){return this._attached.roughnessMap}},{key:"metallicRoughnessMap",get:function(){return this._attached.metallicRoughnessMap}},{key:"specularF0",get:function(){return this._state.specularF0},set:function(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"emissiveMap",get:function(){return this._attached.emissiveMap}},{key:"occlusionMap",get:function(){return this._attached.occlusionMap}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}},{key:"alphaMap",get:function(){return this._attached.alphaMap}},{key:"normalMap",get:function(){return this._attached.normalMap}},{key:"alphaMode",get:function(){return Hi[this._state.alphaMode]},set:function(e){var t=Li[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}},{key:"alphaCutoff",get:function(){return this._state.alphaCutoff},set:function(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),Gi={opaque:0,mask:1,blend:2},ji=["opaque","mask","blend"],Wi=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"SpecularMaterial",diffuse:De.vec3([1,1,1]),emissive:De.vec3([0,0,0]),specular:De.vec3([1,1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),r.diffuse=i.diffuse,r.specular=i.specular,r.glossiness=i.glossiness,r.specularF0=i.specularF0,r.emissive=i.emissive,r.alpha=i.alpha,i.diffuseMap&&(r._diffuseMap=r._checkComponent("Texture",i.diffuseMap)),i.emissiveMap&&(r._emissiveMap=r._checkComponent("Texture",i.emissiveMap)),i.specularMap&&(r._specularMap=r._checkComponent("Texture",i.specularMap)),i.glossinessMap&&(r._glossinessMap=r._checkComponent("Texture",i.glossinessMap)),i.specularGlossinessMap&&(r._specularGlossinessMap=r._checkComponent("Texture",i.specularGlossinessMap)),i.occlusionMap&&(r._occlusionMap=r._checkComponent("Texture",i.occlusionMap)),i.alphaMap&&(r._alphaMap=r._checkComponent("Texture",i.alphaMap)),i.normalMap&&(r._normalMap=r._checkComponent("Texture",i.normalMap)),r.alphaMode=i.alphaMode,r.alphaCutoff=i.alphaCutoff,r.backfaces=i.backfaces,r.frontface=i.frontface,r.lineWidth=i.lineWidth,r.pointSize=i.pointSize,r._makeHash(),r}return I(n,[{key:"type",get:function(){return"SpecularMaterial"}},{key:"_makeHash",value:function(){var e=this._state,t=["/spe"];this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat")),this._glossinessMap&&(t.push("/gm"),this._glossinessMap.hasMatrix&&t.push("/mat")),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._specularGlossinessMap&&(t.push("/sgm"),this._specularGlossinessMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}},{key:"diffuse",get:function(){return this._state.diffuse},set:function(e){var t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"diffuseMap",get:function(){return this._diffuseMap}},{key:"specular",get:function(){return this._state.specular},set:function(e){var t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}},{key:"specularMap",get:function(){return this._specularMap}},{key:"specularGlossinessMap",get:function(){return this._specularGlossinessMap}},{key:"glossiness",get:function(){return this._state.glossiness},set:function(e){e=null!=e?e:1,this._state.glossiness!==e&&(this._state.glossiness=e,this.glRedraw())}},{key:"glossinessMap",get:function(){return this._glossinessMap}},{key:"specularF0",get:function(){return this._state.specularF0},set:function(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}},{key:"emissive",get:function(){return this._state.emissive},set:function(e){var t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}},{key:"emissiveMap",get:function(){return this._emissiveMap}},{key:"alpha",get:function(){return this._state.alpha},set:function(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}},{key:"alphaMap",get:function(){return this._alphaMap}},{key:"normalMap",get:function(){return this._normalMap}},{key:"occlusionMap",get:function(){return this._occlusionMap}},{key:"alphaMode",get:function(){return ji[this._state.alphaMode]},set:function(e){var t=Gi[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}},{key:"alphaCutoff",get:function(){return this._state.alphaCutoff},set:function(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"frontface",get:function(){return this._state.frontface?"ccw":"cw"},set:function(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||1,this.glRedraw()}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),zi={default:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultWhiteBG:{fill:!0,fillColor:[1,1,1],fillAlpha:.6,edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultDarkBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1},phosphorous:{fill:!0,fillColor:[0,0,0],fillAlpha:.4,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2},sunset:{fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1},vectorscope:{fill:!0,fillColor:[0,0,0],fillAlpha:.7,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2},battlezone:{fill:!0,fillColor:[0,0,0],fillAlpha:1,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3},sepia:{fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},yellowHighlight:{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1},greenSelected:{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1},gamegrid:{fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9,edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3}},Xi=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"EmphasisMaterial",fill:null,fillColor:null,fillAlpha:null,edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,backfaces:!0,glowThrough:!0}),r._preset="default",i.preset?(r.preset=i.preset,void 0!==i.fill&&(r.fill=i.fill),i.fillColor&&(r.fillColor=i.fillColor),void 0!==i.fillAlpha&&(r.fillAlpha=i.fillAlpha),void 0!==i.edges&&(r.edges=i.edges),i.edgeColor&&(r.edgeColor=i.edgeColor),void 0!==i.edgeAlpha&&(r.edgeAlpha=i.edgeAlpha),void 0!==i.edgeWidth&&(r.edgeWidth=i.edgeWidth),void 0!==i.backfaces&&(r.backfaces=i.backfaces),void 0!==i.glowThrough&&(r.glowThrough=i.glowThrough)):(r.fill=i.fill,r.fillColor=i.fillColor,r.fillAlpha=i.fillAlpha,r.edges=i.edges,r.edgeColor=i.edgeColor,r.edgeAlpha=i.edgeAlpha,r.edgeWidth=i.edgeWidth,r.backfaces=i.backfaces,r.glowThrough=i.glowThrough),r}return I(n,[{key:"type",get:function(){return"EmphasisMaterial"}},{key:"presets",get:function(){return zi}},{key:"fill",get:function(){return this._state.fill},set:function(e){e=!1!==e,this._state.fill!==e&&(this._state.fill=e,this.glRedraw())}},{key:"fillColor",get:function(){return this._state.fillColor},set:function(e){var t=this._state.fillColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.fillColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.4,t[1]=.4,t[2]=.4),this.glRedraw()}},{key:"fillAlpha",get:function(){return this._state.fillAlpha},set:function(e){e=null!=e?e:.2,this._state.fillAlpha!==e&&(this._state.fillAlpha=e,this.glRedraw())}},{key:"edges",get:function(){return this._state.edges},set:function(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}},{key:"edgeColor",get:function(){return this._state.edgeColor},set:function(e){var t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"edgeAlpha",get:function(){return this._state.edgeAlpha},set:function(e){e=null!=e?e:.5,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}},{key:"edgeWidth",get:function(){return this._state.edgeWidth},set:function(e){this._state.edgeWidth=e||1,this.glRedraw()}},{key:"backfaces",get:function(){return this._state.backfaces},set:function(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}},{key:"glowThrough",get:function(){return this._state.glowThrough},set:function(e){e=!1!==e,this._state.glowThrough!==e&&(this._state.glowThrough=e,this.glRedraw())}},{key:"preset",get:function(){return console.warn("EmphasisMaterial.preset is deprecated and will be removed in future versions."),this._preset},set:function(e){if(console.warn("EmphasisMaterial.preset is deprecated and will be removed in future versions."),e=e||"default",this._preset!==e){var t=zi[e];t?(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.glowThrough=t.glowThrough,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(zi).join(", "))}}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),Ki={default:{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}},Zi=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"EdgeMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null}),r._preset="default",i.preset?(r.preset=i.preset,i.edgeColor&&(r.edgeColor=i.edgeColor),void 0!==i.edgeAlpha&&(r.edgeAlpha=i.edgeAlpha),void 0!==i.edgeWidth&&(r.edgeWidth=i.edgeWidth)):(r.edgeColor=i.edgeColor,r.edgeAlpha=i.edgeAlpha,r.edgeWidth=i.edgeWidth),r.edges=!1!==i.edges,r}return I(n,[{key:"type",get:function(){return"EdgeMaterial"}},{key:"presets",get:function(){return Ki}},{key:"edges",get:function(){return this._state.edges},set:function(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}},{key:"edgeColor",get:function(){return this._state.edgeColor},set:function(e){var t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}},{key:"edgeAlpha",get:function(){return this._state.edgeAlpha},set:function(e){e=null!=e?e:1,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}},{key:"edgeWidth",get:function(){return this._state.edgeWidth},set:function(e){this._state.edgeWidth=e||1,this.glRedraw()}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=Ki[e];t?(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Ki).join(", "))}}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),Ji=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({edgeColor:De.vec3([0,0,0]),centerColor:De.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1}),r.edgeColor=i.edgeColor,r.centerColor=i.centerColor,r.edgeBias=i.edgeBias,r.centerBias=i.centerBias,r.power=i.power,r}return I(n,[{key:"type",get:function(){return"Fresnel"}},{key:"edgeColor",get:function(){return this._state.edgeColor},set:function(e){this._state.edgeColor.set(e||[0,0,0]),this.glRedraw()}},{key:"centerColor",get:function(){return this._state.centerColor},set:function(e){this._state.centerColor.set(e||[1,1,1]),this.glRedraw()}},{key:"edgeBias",get:function(){return this._state.edgeBias},set:function(e){this._state.edgeBias=e||0,this.glRedraw()}},{key:"centerBias",get:function(){return this._state.centerBias},set:function(e){this._state.centerBias=null!=e?e:1,this.glRedraw()}},{key:"power",get:function(){return this._state.power},set:function(e){this._state.power=null!=e?e:1,this.glRedraw()}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),Yi=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._type=i.type||(i.src?i.src.split(".").pop():null)||"jpg",r._pos=De.vec3(i.pos||[0,0,0]),r._up=De.vec3(i.up||[0,1,0]),r._normal=De.vec3(i.normal||[0,0,1]),r._height=i.height||1,r._origin=De.vec3(),r._rtcPos=De.vec3(),r._imageSize=De.vec2(),r._texture=new Ti(w(r),{flipY:!0}),r._image=new Image,"jpg"!==r._type&&"png"!==r._type&&(r.error('Unsupported type - defaulting to "jpg"'),r._type="jpg"),r._node=new bn(w(r),{matrix:De.inverseMat4(De.lookAtMat4v(r._pos,De.subVec3(r._pos,r._normal,De.mat4()),r._up,De.mat4())),children:[r._bitmapMesh=new vi(w(r),{scale:[1,1,1],rotation:[-90,0,0],collidable:i.collidable,pickable:i.pickable,opacity:i.opacity,clippable:i.clippable,geometry:new Wt(w(r),rn({center:[0,0,0],xSize:1,zSize:1,xSegments:2,zSegments:2})),material:new wi(w(r),{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:r._texture,emissiveMap:r._texture,backfaces:!0})})]}),i.image?r.image=i.image:i.src?r.src=i.src:i.imageData&&(r.imageData=i.imageData),r.scene._bitmapCreated(w(r)),r}return I(n,[{key:"visible",get:function(){return this._bitmapMesh.visible},set:function(e){this._bitmapMesh.visible=e}},{key:"image",get:function(){return this._image},set:function(e){this._image=e,this._image&&(this._texture.image=this._image,this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updateBitmapMeshScale())}},{key:"src",get:function(){return this._image.src},set:function(e){var t=this;if(e)switch(this._image.onload=function(){t._texture.image=t._image,t._imageSize[0]=t._image.width,t._imageSize[1]=t._image.height,t._updateBitmapMeshScale()},this._image.src=e,e.split(".").pop()){case"jpeg":case"jpg":this._type="jpg";break;case"png":this._type="png"}}},{key:"imageData",get:function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this._image.width,e.height=this._image.height,t.drawImage(this._image,0,0),e.toDataURL("jpg"===this._type?"image/jpeg":"image/png")},set:function(e){var t=this;this._image.onload=function(){t._texture.image=image,t._imageSize[0]=image.width,t._imageSize[1]=image.height,t._updateBitmapMeshScale()},this._image.src=e}},{key:"type",get:function(){return this._type},set:function(e){"png"===(e=e||"jpg")&&"jpg"===e||(this.error("Unsupported value for `type` - supported types are `jpg` and `png` - defaulting to `jpg`"),e="jpg"),this._type=e}},{key:"pos",get:function(){return this._pos}},{key:"normal",get:function(){return this._normal}},{key:"up",get:function(){return this._up}},{key:"height",get:function(){return this._height},set:function(e){this._height=null==e?1:e,this._image&&this._updateBitmapMeshScale()}},{key:"collidable",get:function(){return this._bitmapMesh.collidable},set:function(e){this._bitmapMesh.collidable=!1!==e}},{key:"clippable",get:function(){return this._bitmapMesh.clippable},set:function(e){this._bitmapMesh.clippable=!1!==e}},{key:"pickable",get:function(){return this._bitmapMesh.pickable},set:function(e){this._bitmapMesh.pickable=!1!==e}},{key:"opacity",get:function(){return this._bitmapMesh.opacity},set:function(e){this._bitmapMesh.opacity=e}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this.scene._bitmapDestroyed(this)}},{key:"_updateBitmapMeshScale",value:function(){var e=this._imageSize[1]/this._imageSize[0];this._bitmapMesh.scale=[this._height/e,1,this._height]}}]),n}(),qi=function(e,t){var n=[],r=[];function i(e,n){for(var r,i,s=0;s<3;s++)if((r=t[3*e+s])!==(i=t[3*n+s]))return i-r;return 0}for(var s=e.slice().sort(i),a=null,o=0,A=s.length;o<A;o++)0!==o&&0===i(s[o],s[o-1])||(a=s[o]),n[s[o]]=a;for(var c=0,l=e.length;c<l;c+=3){var u=n[e[c]],h=n[e[c+1]],d=n[e[c+2]],f=u,p=h,v=d;if(u>h&&u>d?h>d?(f=u,p=h,v=d):(f=u,p=d,v=h):h>u&&h>d?u>d?(f=h,p=u,v=d):(f=h,p=d,v=u):d>u&&d>h&&(u>h?(f=d,p=u,v=h):(f=d,p=h,v=u)),r[c+0]=[f,p],r[c+1]=[p,v],f>v){var g=v;v=f,f=g}r[c+2]=[v,f]}function m(e,t){for(var n,r,i=0;i<2;i++)if(n=e[i],(r=t[i])!==n)return r-n;return 0}(r=r.slice(0,e.length)).sort(m);for(var y=0,_=0;_<r.length;_++)if(0===_||0!==m(r[_],r[_-1])){if(0!==_&&2!==y)return!1;y=1}else y++;return!(r.length>0&&2!==y)},$i=De.vec3(),es=De.vec3(),ts=De.vec3(),ns=function(){function e(){x(this,e),this.vertices=[],this.indices=[],this.reset()}return I(e,[{key:"reset",value:function(){this.lenVertices=0,this.lenIndices=0,this.primitive=null}},{key:"setPrimitive",value:function(e){this.primitive=e}},{key:"addVertex",value:function(e){this.vertices[this.lenVertices++]=e[0],this.vertices[this.lenVertices++]=e[1],this.vertices[this.lenVertices++]=e[2]}},{key:"addIndex",value:function(e){this.indices[this.lenIndices++]=e}},{key:"volume",get:function(){var e=this.vertices,t=this.indices;if("solid"!==this.primitive&&"surface"!==this.primitive&&"triangles"!==this.primitive)return-1;if("solid"!==this.primitive&&!qi(t,e))return-1;for(var n=0,r=0;r<this.lenIndices;r+=3){var i=3*t[r],s=3*t[r+1],a=3*t[r+2];$i[0]=e[i],$i[1]=e[i+1],$i[2]=e[i+2],es[0]=e[s],es[1]=e[s+1],es[2]=e[s+2],ts[0]=e[a],ts[1]=e[a+1],ts[2]=e[a+2],De.cross3Vec3($i,es,$i),n+=De.dotVec3($i,ts)}return n/6}}]),e}(),rs=new ns,is=De.vec3(),ss=De.vec3(),as=De.vec3(),os=De.vec3(),As=De.vec3(),cs=De.vec3(),ls=function(){function e(){x(this,e),this.vertices=[],this.indices=[],this.reset()}return I(e,[{key:"reset",value:function(){this.lenVertices=0,this.lenIndices=0}},{key:"addVertex",value:function(e){this.vertices[this.lenVertices++]=e[0],this.vertices[this.lenVertices++]=e[1],this.vertices[this.lenVertices++]=e[2]}},{key:"addIndex",value:function(e){this.indices[this.lenIndices++]=e}},{key:"surfaceArea",get:function(){for(var e=this.vertices,t=this.indices,n=0,r=0;r<this.lenIndices;r+=3){var i=3*t[r],s=3*t[r+1],a=3*t[r+2];is[0]=e[i],is[1]=e[i+1],is[2]=e[i+2],ss[0]=e[s],ss[1]=e[s+1],ss[2]=e[s+2],as[0]=e[a],as[1]=e[a+1],as[2]=e[a+2],De.subVec3(is,ss,os),De.subVec3(as,ss,As),n+=.5*De.lenVec3(De.cross3Vec3(os,As,cs))}return n}}]),e}(),us=new ls,hs=De.OBB3(),ds=De.OBB3(),fs=De.OBB3(),ps=function(){function e(t,n,r,i,s,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,A=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;x(this,e),this.model=t,this.object=null,this.parent=null,this.transform=s,this.textureSet=a,this._matrixDirty=!1,this._matrixUpdateScheduled=!1,this.id=n,this.obb=null,this._aabbLocal=null,this._aabbWorld=De.AABB3(),this._aabbWorldDirty=!1,this.layer=o,this.portionId=A,this._color=new Uint8Array([r[0],r[1],r[2],i]),this._colorize=new Uint8Array([r[0],r[1],r[2],i]),this._colorizing=!1,this._transparent=i<255,this.numTriangles=0,this.origin=null,this.entity=null,s&&s._addMesh(this),this._volume=null,this._surfaceArea=null}return I(e,[{key:"_sceneModelDirty",value:function(){this._aabbWorldDirty=!0,this.layer.aabbChanged()}},{key:"_transformDirty",value:function(){this._matrixDirty||this._matrixUpdateScheduled||(this.model._meshMatrixDirty(this),this._matrixDirty=!0,this._matrixUpdateScheduled=!0),this._aabbWorldDirty=!0,this.layer.aabbChanged(),this.entity&&this.entity._transformDirty()}},{key:"_updateMatrix",value:function(){this.transform&&this._matrixDirty&&this.layer.setMatrix(this.portionId,this.transform.worldMatrix),this._matrixDirty=!1,this._matrixUpdateScheduled=!1}},{key:"_finalize",value:function(e){this.layer.initFlags(this.portionId,e,this._transparent)}},{key:"_finalize2",value:function(){this.layer.flushInitFlags&&this.layer.flushInitFlags()}},{key:"_setVisible",value:function(e){this.layer.setVisible(this.portionId,e,this._transparent)}},{key:"_setColor",value:function(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this.layer.setColor(this.portionId,this._color,!1)}},{key:"_setColorize",value:function(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this.layer.setColor(this.portionId,this._colorize,false),this._colorizing=!0):(this.layer.setColor(this.portionId,this._color,false),this._colorizing=!1)}},{key:"_setOpacity",value:function(e,t){var n=e<255,r=this._transparent!==n;this._color[3]=e,this._colorize[3]=e,this._transparent=n,this._colorizing?this.layer.setColor(this.portionId,this._colorize):this.layer.setColor(this.portionId,this._color),r&&this.layer.setTransparent(this.portionId,t,n)}},{key:"_setOffset",value:function(e){this.layer.setOffset(this.portionId,e)}},{key:"_setHighlighted",value:function(e){this.layer.setHighlighted(this.portionId,e,this._transparent)}},{key:"_setXRayed",value:function(e){this.layer.setXRayed(this.portionId,e,this._transparent)}},{key:"_setSelected",value:function(e){this.layer.setSelected(this.portionId,e,this._transparent)}},{key:"_setEdges",value:function(e){this.layer.setEdges(this.portionId,e,this._transparent)}},{key:"_setClippable",value:function(e){this.layer.setClippable(this.portionId,e,this._transparent)}},{key:"_setCollidable",value:function(e){this.layer.setCollidable(this.portionId,e)}},{key:"_setPickable",value:function(e){this.layer.setPickable(this.portionId,e,this._transparent)}},{key:"_setCulled",value:function(e){this.layer.setCulled(this.portionId,e,this._transparent)}},{key:"canPickTriangle",value:function(){return!1}},{key:"drawPickTriangles",value:function(e,t){}},{key:"pickTriangleSurface",value:function(e){}},{key:"precisionRayPickSurface",value:function(e,t,n,r){return this.layer.precisionRayPickSurface(this.portionId,e,t,n,r)}},{key:"canPickWorldPos",value:function(){return!0}},{key:"drawPickDepths",value:function(e){this.model.drawPickDepths(e)}},{key:"drawPickNormals",value:function(e){this.model.drawPickNormals(e)}},{key:"delegatePickedEntity",value:function(){return this.parent}},{key:"getEachVertex",value:function(e){this.layer.getEachVertex&&this.layer.getEachVertex(this.portionId,e)}},{key:"getEachIndex",value:function(e){this.layer.getEachIndex&&this.layer.getEachIndex(this.portionId,e)}},{key:"isSolid",value:function(){return this.layer.solid}},{key:"volume",get:function(){if(null!==this._volume)return this._volume;switch(this.layer.primitive){case"solid":case"surface":case"triangles":rs.reset(),rs.setPrimitive(this.layer.primitive),this.getEachVertex((function(e){rs.addVertex(e)})),this.getEachIndex((function(e){rs.addIndex(e)})),this._volume=rs.volume;break;default:this._volume=0}return this._volume}},{key:"surfaceArea",get:function(){if(null!==this._surfaceArea)return this._surfaceArea;switch(this.layer.primitive){case"solid":case"surface":case"triangles":us.reset(),this.getEachVertex((function(e){us.addVertex(e)})),this.getEachIndex((function(e){us.addIndex(e)})),this._surfaceArea=us.surfaceArea;break;default:this._surfaceArea=0}return this._surfaceArea}},{key:"aabb",get:function(){return this._aabbWorldDirty&&(De.AABB3ToOBB3(this._aabbLocal,hs),this.transform?(De.transformOBB3(this.transform.worldMatrix,hs,ds),De.transformOBB3(this.model.worldMatrix,ds,fs),De.OBB3ToAABB3(fs,this._aabbWorld)):(De.transformOBB3(this.model.worldMatrix,hs,ds),De.OBB3ToAABB3(ds,this._aabbWorld)),this._aabbWorldDirty=!1),this._aabbWorld},set:function(e){if(this._aabbLocal=e,this.origin){this._aabbLocal=e.slice(0);var t=this.origin;this._aabbLocal[0]+=t[0],this._aabbLocal[1]+=t[1],this._aabbLocal[2]+=t[2],this._aabbLocal[3]+=t[0],this._aabbLocal[4]+=t[1],this._aabbLocal[5]+=t[2]}}},{key:"_destroy",value:function(){this.model.scene._renderer.putPickID(this.pickId),this.layer=null}}]),e}(),vs=1,gs=4,ms=8,ys=16,_s=32,bs=256,ws=512,Bs=1024,Cs=2048,Ms=function(e,t,n,r){var i=r&&e.createUniform("vec4","edgeColor",(function(e,t){return e(t.legacyFrameCtx.programColor)})),s=t.attributes.color,a=!r&&e.createVarying("vec4","vColor",(function(){return"vec4(".concat(s,".rgb * 0.5, ").concat(s,".a)")})),o=e.createOutput("vec4","outColor");return{programName:r?"Edges":"EdgesColor",getLogDepth:n&&function(e){return e},renderPassFlag:2,appendFragmentOutputs:function(e){return e.push("".concat(o," = ").concat(i||a,";"))}}},ks=function(e,t){var n=e.createOutput("vec4","outColor");return{programName:"Occlusion",getLogDepth:!1,renderPassFlag:0,appendFragmentOutputs:function(e){return e.push("".concat(n," = vec4(0.0, 0.0, 1.0, 1.0);"))}}},Es=function(e,t,n,r){var i=e.createUniform("vec4","silhouetteColor",(function(e,t){return e(t.legacyFrameCtx.programColor)})),s=e.createVarying("float","vAlpha",(function(){return"".concat(t.attributes.color,".a")})),a=e.createOutput("vec4","outColor");return{programName:"Silhouette",getLogDepth:n&&function(e){return e},renderPassFlag:1,appendFragmentOutputs:function(e,t,n,o){e.push("".concat(a," = ").concat(r?i:o("vec4(".concat(i,".rgb, min(").concat(i,".a, ").concat(s,"))")),";"))}}},Fs=De.vec2(),xs=De.vec3(),Us=De.vec4(),Is=De.mat4(),Ts=De.vec3([0,0,0]),Ps=0,Ss=1,Ds=2,Qs=3,Rs=4,Os=5,Vs=6,Ls=7,Hs=8,Ns=9,Gs=10,js=11,Ws=function(e){return[De.safeInv(e[0]),De.safeInv(e[1]),De.safeInv(e[2])]},zs=function(e,t,n,r,i){var s,a,o=!!(e&vs),A=!!(e&bs),c=!!(e&ws),l=!!(e&Bs),u=!!(e&Cs),h=!!(e&ms),d=!!(e&gs);s=!o||d||A||c&&!r.highlightMaterial.glowThrough||l&&!r.selectedMaterial.glowThrough?Ps:t?Ds:Ss,a=!o||d?Ps:l?Rs:c?Qs:A?Os:Ps;var f=0;f=n&&o&&!d?l?Ns:c?Hs:A?Gs:u?t?Ls:Vs:Ps:Ps;var p=o&&!d&&h?js:Ps;i[0]=s,i[1]=a,i[2]=f,i[3]=p},Xs=(Di={},function(e,t,n,r,i,s,a,o){var A=[t,"points"===n||"lines"===n?n:"triangles",!!r,!!i,!!s,!!a].join(":");A in Di||(Di[A]={});var c,l,u,h=Di[A],d=e.id;if(!(d in h)){var f=e.canvas.gl,p=function(r,i,s){var a=function(){var s=jr(),a=s.programVariables,A=o(a,i);return r(a,A.geometryParameters,(function(r,o){var c=e.pointsMaterial,l="points"===n&&!i,u=function(){return[e._sectionPlanesState.getHash()].concat(l?[c.hash]:[]).concat(r.getHash?r.getHash():[]).join(";")},h=u(),d=function(){return h===u()},p=A.geometryParameters,v=r.incrementDrawState,g=r.isShadowProgram,m=p.attributes,y=m.position.world,_="clipPos",b=k(s.buildProgram(f,t+" "+n+" "+r.programName,{appendFragmentOutputs:r.appendFragmentOutputs,cleanerEdges:r.cleanerEdges,clipPos:_,clippableTest:A.clippableTest,clippingCaps:r.clippingCaps,crossSections:e.crossSections,discardPoints:l&&c.roundPoints,getGammaFactor:e.gammaOutput&&function(){return e.gammaFactor},getLogDepth:r.getLogDepth,getPointSize:function(){var e=[];if(l){var t=a.createUniform("float","pointSize",(function(e){return e(c.pointSize)}));if(c.perspectivePoints){var s=a.createUniform("float","nearPlaneHeight",(function(e,t){return e(t.legacyFrameCtx.nearPlaneHeight)})),o="".concat(Math.floor(c.minPerspectivePointSize),".0"),A="".concat(Math.floor(c.maxPerspectivePointSize),".0");e.push("clamp((".concat(s," * ").concat(t,") / gl_Position.w, ").concat(o,", ").concat(A,")"))}else e.push(t)}else i&&i.vertices&&e.push("1.0");return r.incPointSizeBy10&&"points"===n&&e.push("10.0"),e.length>0&&function(){return e.join(" + ")}}(),getVertexData:function(){var e,t=m.color,i=m.flags[r.renderPassFlag],s=a.createUniform("int","renderPass",(function(e,t){return e(t.renderPass)})),o=g?"(".concat(i," <= 0) || (").concat(t,".a < 1.0)"):"".concat(i," != ").concat(s),l=["if (".concat(o,") {"),"   gl_Position = vec4(".concat(r.vertexCullX||0,", 0.0, 0.0, 0.0);"),"   return;","}"].concat(A.dontCullOnAlphaZero||r.dontCullOnAlphaZero?[]:["if (".concat(t,".a == 0.0) {"),"   gl_Position = vec4(3.0, 3.0, 3.0, 1.0);","   return;","}"]).concat(r.filterIntensityRange&&"points"===n&&c.filterIntensity?(e=a.createUniform("vec2","intensityRange",(function(e){Fs[0]=c.minIntensity,Fs[1]=c.maxIntensity,e(Fs)})),["if ((".concat(t,".a < ").concat(e,"[0]) || (").concat(t,".a > ").concat(e,"[1])) {"),"   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);","   return;","}"]):[]),u=[];A.ensureColorAndFlagAvailable&&A.ensureColorAndFlagAvailable(u),l.forEach((function(e){return u.push(e)})),A.appendVertexData(u);var h=p.attributes.position.view;return u.push("vec4 ".concat(h," = ").concat(p.viewMatrix," * ").concat(y,";")),u.push("vec4 ".concat(_," = ").concat(p.projMatrix," * ").concat(h,";")),u},projMatrix:p.projMatrix,sectionPlanesState:e._sectionPlanesState,testPerspectiveForGl_FragDepth:"points"!==n&&"lines"!==n||i,usePickClipPos:o,worldPositionAttribute:y}),2),w=b[0],B=b[1];return B?(console.error(B),{getValid:d,destroy:function(){},drawLayer:function(e,t,n){}}):{getValid:d,destroy:function(){return w.destroy()},drawLayer:function(e,t,n){e.lastProgramId!==w.id&&(e.lastProgramId=w.id,w.bind());var r=t.origin,s=t.model,a=e.viewParams,o=xs;De.transformPoint3(s.matrix,r,o);var c=a.viewMatrix,l=a.projMatrix;e.snapPickOrigin&&(e.snapPickOrigin[0]=o[0],e.snapPickOrigin[1]=o[1],e.snapPickOrigin[2]=o[2]);var u={legacyFrameCtx:e,layerTextureSet:t.layerTextureSet,mesh:{layerIndex:t.layerIndex,origin:o,renderFlags:{sectionPlanesActivePerLayer:s.renderFlags.sectionPlanesActivePerLayer}},renderPass:n,view:{eye:a.eye,far:a.far,projMatrix:l,viewMatrix:De.compareVec3(o,Ts)?c:Bn(c,o,Is),viewNormalMatrix:a.viewNormalMatrix}};w.inputSetters.setUniforms(e,u),t.drawCalls[i?i.vertices?"drawVertices":"drawEdges":"drawSurface"](w.inputSetters.attributesHash,A.layerTypeInputs,{projMatrix:l,viewMatrix:De.compareVec3(o,Ts)?c:Bn(c,o,Is),viewNormalMatrix:a.viewNormalMatrix,eye:a.eye}),v&&e.drawElements++}}}))},A=s&&a();return{drawLayer:function(e,t,n){A||(A=a()),A.drawLayer(e,t,n)},revalidate:function(e){!A||!e&&A.getValid()||(A.destroy(),A=s&&a())}}},v=function(e,t){return p(e,t,!0)},g=function(e,t){return p(e,t,!1)},m=function(t,r,i,s){return function(e,t,n,r,i,s){var a=e.createVarying("vec4","vColor",(function(){var e=t.attributes,n="points"===s?"vec4(".concat(e.color,".rgb, 1.0)"):"".concat(e.color);if(r){var i=[r.getAmbientColor()].concat(r.directionalLights.map((function(n){return"max(dot(".concat(e.normal.view,", ").concat(n.getDirection(t.viewMatrix,e.position.view),"), 0.0) * ").concat(n.getColor())})));return"vec4(".concat(i.join(" + "),", 1) * ").concat(n)}return n})),o=e.createOutput("vec4","outColor");return{programName:"Color",getHash:function(){return[r?r.getHash():"-",i?"sao":"nosao"]},cleanerEdges:!0,getLogDepth:n&&function(e){return"points"!==s&&"lines"!==s?"".concat(e," + length(vec2(dFdx(").concat(e,"), dFdy(").concat(e,")))"):e},renderPassFlag:0,appendFragmentOutputs:function(e,t,n,r){"points"===s||"lines"===s?e.push("".concat(o," = ").concat(a,";")):(e.push("vec4 fragColor = ".concat(r(a),";")),e.push("".concat(o," = ").concat(i?"vec4(fragColor.rgb * ".concat(i.getAmbient(n),", fragColor.a)"):"fragColor",";")))},filterIntensityRange:!0,incrementDrawState:!0}}(t,r,e.logarithmicDepthBufferEnabled,i,s,n)},y=function(t,n,r){return r((i=t,s=n,a=e.logarithmicDepthBufferEnabled,o=i.createUniform("float","far",(function(e,t){return e(t.legacyFrameCtx.viewParams.far)})),A=i.createUniform("float","near",(function(e,t){return e(t.legacyFrameCtx.viewParams.near)})),c=i.createVarying("vec3","vViewPosition",(function(){return"".concat(s.attributes.position.view,".xyz")})),l=i.createOutput("vec4","outPackedDepth"),u=i.createFragmentDefinition("packDepth",(function(e,t){t.push("vec4 ".concat(e,"(const in float depth) {")),t.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),t.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),t.push("  vec4 res = fract(depth * bitShift);"),t.push("  res -= res.xxyz * bitMask;"),t.push("  return res;"),t.push("}")})),{programName:"PickDepth",getLogDepth:a&&function(e){return e},renderPassFlag:3,incPointSizeBy10:!0,appendFragmentOutputs:function(e){e.push("float zNormalizedDepth = abs((".concat(A," + ").concat(c,".z) / (").concat(o," - ").concat(A,"));")),e.push("".concat(l," = ").concat(u,"(zNormalizedDepth);"))}}),!0);var i,s,a,o,A,c,l,u},_=function(t,n,r){return r((i=t,s=n,a=e.logarithmicDepthBufferEnabled,o=i.createVarying("vec4","vPickColor",(function(){return"".concat(s.attributes.pickColor," / 255.0")})),A=i.createOutput("vec4","outPickColor"),{programName:"PickMesh",getLogDepth:a&&function(e){return e},renderPassFlag:3,incPointSizeBy10:!0,dontCullOnAlphaZero:!0,appendFragmentOutputs:function(e){return e.push("".concat(A," = ").concat(o,";"))}}),!0);var i,s,a,o,A},b=function(t,n,r,i){return r(function(e,t,n,r){var i=e.createVarying("vec3","vWorldPosition",(function(){return"".concat(t.attributes.position.world,".xyz")})),s=e.createVarying("vec3","vWorldNormal",(function(){return t.attributes.normal.world})),a=e.createOutput("highp ivec4","outNormal");return{programName:r?"PickNormalsFlat":"PickNormals",getLogDepth:n&&function(e){return e},renderPassFlag:3,appendFragmentOutputs:function(e){var t=r?"normalize(cross(dFdx(".concat(i,"), dFdy(").concat(i,")))"):s;e.push("".concat(a," = ivec4(").concat(t," * float(").concat(De.MAX_INT,"), 1.0);"))}}}(t,n,e.logarithmicDepthBufferEnabled,i),!0)},w=function(e,t,n,r,i){return n(function(e,t,n,r){var i=e.createUniform("int","layerNumber",(function(e,t){return e(t.legacyFrameCtx.snapPickLayerParams.length)})),s=e.createUniform("vec3","coordinateScaler",(function(e,t){return e(t.legacyFrameCtx.snapPickCoordinateScale)})),a=e.createVarying("vec3","vWorldPosition",(function(){return"".concat(t.attributes.position.world,".xyz")})),o=e.createVarying("vec4","vPickColor",(function(){return t.attributes.pickColor})),A=e.createOutput("highp ivec4","outCoords",0),c=e.createOutput("highp ivec4","outNormal",1),l=e.createOutput("lowp uvec4","outPickColor",2);return{programName:n?"SnapInit":"Snap",getLogDepth:function(e){return n?"".concat(e," + length(vec2(dFdx(").concat(e,"), dFdy(").concat(e,")))"):e},renderPassFlag:3,vertexCullX:!n&&"2.0",dontCullOnAlphaZero:!n,appendFragmentOutputs:function(e){e.push("".concat(A," = ivec4(").concat(a," * ").concat(s,".xyz, ").concat(n?"-":"").concat(i,");")),n&&(e.push("".concat(c," = ").concat(r?"ivec4(1.0)":"ivec4(normalize(cross(dFdx(".concat(a,"), dFdy(").concat(a,"))) * float(").concat(De.MAX_INT,"), 1.0)"),";")),e.push("".concat(l," = uvec4(").concat(o,");")))}}}(e,t,r,i),!0)};h[d]="points"===n?{colorRenderers:{"sao-":{vertex:g((function(e,t,n){return n(m(e,t,null,null))}))}},occlusionRenderer:g((function(t,n,r){return r(ks(t,e.logarithmicDepthBufferEnabled))})),pickDepthRenderer:g(y),pickMeshRenderer:g(_),silhouetteRenderer:g((function(t,n,r){return r(Es(t,n,e.logarithmicDepthBufferEnabled,!0))})),snapInitRenderer:g((function(e,t,n){return w(e,t,n,!0,!0)})),snapVertexRenderer:g((function(e,t,n){return w(e,t,n,!1,!0)}),{vertices:!0})}:"lines"===n?{colorRenderers:{"sao-":{vertex:g((function(e,t,n){return n(m(e,t,null,null))}))}},silhouetteRenderer:g((function(t,n,r){return r(Es(t,n,e.logarithmicDepthBufferEnabled,!0))})),snapInitRenderer:g((function(e,t,n){return w(e,t,n,!0,!1)})),snapEdgeRenderer:g((function(e,t,n){return w(e,t,n,!1,!1)}),{vertices:!1}),snapVertexRenderer:g((function(e,t,n){return w(e,t,n,!1,!1)}),{vertices:!0})}:{colorRenderers:(c=function(t){return Wr(t,e._lightsState)},l=function(e){var t=e.createUniform("vec4","uSAOParams",(function(e,t){return e(t.legacyFrameCtx.saoParams)})),n=zr(e,"sampler2D","uOcclusionTexture",3e3,(function(e,t){return e(t.legacyFrameCtx.occlusionTexture)}));return{getAmbient:function(e){var r="".concat(e,".xy / ").concat(t,".xy"),i="".concat(t,".z"),s="".concat(t,".w");return"(smoothstep(".concat(i,", 1.0, dot(").concat(n(r),", ").concat("(255. / 256.) / vec4(256. * 256. * 256., 256. * 256., 256., 1.)",")) * ").concat(s,")")}}},u=function(t){var n=function(n,r,i){return function(e,t,n,r,i,s,a){var o=zr(e,"sampler2D","uColorMap",3001,(function(e,t){var n=t.layerTextureSet.colorTexture;n&&e(n.texture)})),A=s&&e.createUniform("float","materialAlphaCutoff",(function(e,t){return e(t.layerTextureSet.alphaCutoff)})),c=t.attributes,l=e.createVarying("vec3","vViewPosition",(function(){return"".concat(c.position.view,".xyz")})),u=e.createVarying("vec2","vUV",(function(){return c.uv})),h=e.createVarying("vec4","vColor",(function(){return c.color})),d=e.createOutput("vec4","outColor");return{programName:"ColorTexture",getHash:function(){return[r.getHash(),i?"sao":"nosao",!!a,s?"alphaCutoffYes":"alphaCutoffNo"]},getLogDepth:n.logarithmicDepthBufferEnabled&&function(e){return e},renderPassFlag:0,appendFragmentOutputs:function(e,n,s,a){e.push("vec3 viewNormal = normalize(cross(dFdx(".concat(l,"), dFdy(").concat(l,")));")),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),r.directionalLights.forEach((function(n){e.push("reflectedColor += max(dot(viewNormal, ".concat(n.getDirection(t.viewMatrix,l),"), 0.0) * ").concat(n.getColor(),";"))})),e.push("vec4 color = vec4(".concat(r.getAmbientColor()," + reflectedColor, 1) * ").concat(a(h),";")),e.push("vec4 sampleColor = ".concat(o(u),";")),A&&e.push("if (sampleColor.a < ".concat(A,") { discard; }")),e.push("vec4 colorTexel = color * sampleColor;"),e.push("".concat(d," = vec4(colorTexel.rgb").concat(i?" * "+i.getAmbient(s):"",", color.a);")),n&&e.push("".concat(d," = ").concat(n(d),";"))},incrementDrawState:!0}}(n,r,e,c(n),t&&l(n),i,e.gammaOutput)};return{PBR:i&&g((function(n,r,i){return i(function(e,t,n,r,i){var s=function(t,n,r){return zr(e,"sampler2D",t,n?3001:3e3,(function(e,t){var n=r(t.layerTextureSet);n&&e(n.texture)}))},a=t.attributes,o=r.getIrradiance,A=s("uColorMap",!0,(function(e){return e.colorTexture})),c=s("uMetallicRoughMap",!1,(function(e){return e.metallicRoughnessTexture})),l=s("uEmissiveMap",!0,(function(e){return e.emissiveTexture})),u=s("uNormalMap",!1,(function(e){return e.normalsTexture})),h=s("uAOMap",!1,(function(e){return e.occlusionTexture})),d=e.createVarying("vec3","vViewPosition",(function(){return"".concat(a.position.view,".xyz")})),f=e.createVarying("vec3","vViewNormal",(function(){return a.normal.view})),p=e.createVarying("vec4","vColor",(function(){return a.color})),v=e.createVarying("vec2","vUV",(function(){return a.uv})),g=e.createVarying("vec2","vMetallicRoughness",(function(){return a.metallicRoughness})),m=e.createVarying("vec3","vWorldNormal",(function(){return"".concat(a.normal.world,".xyz")})),y=e.createOutput("vec4","outColor"),_=e.createFragmentDefinition("saturate",(function(e,t){return t.push("float ".concat(e,"(const in float a) { return clamp(a, 0.0, 1.0); }"))})),b=e.createFragmentDefinition("BRDF_Specular_GGX",(function(e,t){t.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),t.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),t.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),t.push("}"),t.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   return 1.0 / ( gl * gv );"),t.push("}"),t.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   return 0.5 / max( gv + gl, 1e-6 );"),t.push("}"),t.push("float D_GGX(const in float alpha, const in float dotNH) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),t.push("   return 0.31830988618 * a2 / ( denom * denom);"),t.push("}"),t.push("vec3 ".concat(e,"(const in vec3 incidentLightDirection, const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {")),t.push("   float alpha = ( roughness * roughness );"),t.push("   vec3 halfDir = normalize( incidentLightDirection + viewEyeDir );"),t.push("   float dotNL = ".concat(_,"( dot( viewNormal, incidentLightDirection ) );")),t.push("   float dotNV = ".concat(_,"( dot( viewNormal, viewEyeDir ) );")),t.push("   float dotNH = ".concat(_,"( dot( viewNormal, halfDir ) );")),t.push("   float dotLH = ".concat(_,"( dot( incidentLightDirection, halfDir ) );")),t.push("   vec3  F = F_Schlick( specularColor, dotLH );"),t.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),t.push("   float D = D_GGX( alpha, dotNH );"),t.push("   return F * (G * D);"),t.push("}")})),w=e.createFragmentDefinition("BRDF_Specular_GGX_Environment",(function(e,t){t.push("vec3 ".concat(e,"(const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {")),t.push("   float dotNV = ".concat(_,"(dot(viewNormal, viewEyeDir));")),t.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),t.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),t.push("   vec4 r = roughness * c0 + c1;"),t.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),t.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),t.push("   return specularColor * AB.x + AB.y;"),t.push("}")})),B=e.createFragmentDefinition("perturbNormal2Arb",(function(e,t){t.push("vec3 ".concat(e,"( vec3 eye_pos, vec3 surf_norm, vec2 uv, vec4 texel ) {")),t.push("      if (texel.r == 0.0 && texel.g == 0.0 && texel.b == 0.0) {"),t.push("             return surf_norm;"),t.push("      }"),t.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),t.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),t.push("      vec2 st0 = dFdx( uv.st );"),t.push("      vec2 st1 = dFdy( uv.st );"),t.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),t.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),t.push("      vec3 N = normalize( surf_norm );"),t.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),t.push("      mat3 tsn = mat3( S, T, N );"),t.push("      return normalize( tsn * mapN );"),t.push("}")}));return{programName:"PBR",getHash:function(){return[r.getHash(),i?"sao":"nosao",!!n.gammaOutput]},getLogDepth:n.logarithmicDepthBufferEnabled&&function(e){return e},renderPassFlag:0,clippingCaps:n._sectionPlanesState.clippingCaps&&y,incrementDrawState:!0,appendFragmentOutputs:function(e,n,s){if(e.push("const float PI = 3.14159265359;"),e.push("vec3 reflDiff = vec3(0.0);"),e.push("vec3 reflSpec = vec3(0.0);"),e.push("vec3 rgb = ".concat(p,".rgb;")),e.push("float opacity = ".concat(p,".a;")),e.push("vec3  baseColor  = rgb;"),e.push("float specularF0 = 1.0;"),e.push("float metallic   = float(".concat(g,".r) / 255.0;")),e.push("float roughness  = float(".concat(g,".g) / 255.0;")),e.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),e.push("vec4 colorTexel = ".concat(A(v),";")),e.push("baseColor *= colorTexel.rgb;"),e.push("vec3 metalRoughTexel = ".concat(c(v),".rgb;")),e.push("metallic *= metalRoughTexel.b;"),e.push("roughness *= metalRoughTexel.g;"),e.push("vec3 diffuseColor       = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),e.push("float specularRoughness = clamp(roughness, 0.04, 1.0);"),e.push("vec3 specularColor      = mix(vec3(dielectricSpecular), baseColor, metallic);"),e.push("vec3 viewNormal = -".concat(B,"(").concat(d,", normalize(").concat(f,"), ").concat(v,", ").concat(u(v),");")),e.push("vec3 viewEyeDir = normalize(".concat(d,");")),o&&e.push("reflDiff += ".concat(o("normalize(".concat(m,")")),";")),r.getReflection){var a="normalize((vec4(".concat("reflect(viewEyeDir, viewNormal)",", 0.0) * ").concat(t.viewMatrix,").xyz)"),C="".concat("8.0"," - 0.79248 - 0.5 * log2(pow(").concat("(2.0 / pow(specularRoughness + 0.0001, 2.0) - 2.0)",", 2.0) + 1.0)"),M="0.5 * clamp(".concat(C,", 0.0, ").concat("8.0",")"),k=r.getReflection(a,M),E="".concat(w,"(viewNormal, viewEyeDir, specularColor, specularRoughness)");e.push("reflSpec += ".concat(k," * ").concat(E,";"))}r.directionalLights.forEach((function(n,r){e.push("vec3 lightDirection".concat(r," = -").concat(n.getDirection(t.viewMatrix,d),";"));var i="".concat(_,"(dot(viewNormal, lightDirection").concat(r,"))");e.push("vec3 irradiance".concat(r," = ").concat(i," * ").concat(n.getColor(),";")),e.push("reflDiff += irradiance".concat(r,";")),e.push("reflSpec += irradiance".concat(r," * PI * ").concat(b,"(lightDirection").concat(r,", viewNormal, viewEyeDir, specularColor, specularRoughness);"))})),e.push("vec3 emissiveColor = ".concat(l(v),".rgb;")),e.push("float aoFactor = ".concat(h(v),".r;"));var F="".concat(r.getAmbientColor()," * baseColor * opacity * rgb");e.push("vec3 outgoingLight = emissiveColor + reflDiff * diffuseColor + reflSpec + ".concat(F,";")),e.push("".concat(y," = vec4(outgoingLight * aoFactor").concat(i?" * ".concat(i.getAmbient(s)):"",", opacity);")),n&&e.push("".concat(y," = ").concat(n(y),";"))}}}(n,r,e,c(n),t&&l(n)))})),texture:s&&{"alphaCutoff-":g((function(e,t,r){return r(n(e,t,!1))})),"alphaCutoff+":g((function(e,t,r){return r(n(e,t,!0))}))},vertex:g(a?function(e,n,r){return r(m(e,n,c(e),t&&l(e)))}:function(n,r,i){return i((s=n,a=r,o=e.logarithmicDepthBufferEnabled,A=c(n),u=t&&l(n),h=a.attributes,d=s.createVarying("vec3","vViewPosition",(function(){return"".concat(h.position.view,".xyz")})),f=s.createVarying("vec4","vColor",(function(){return h.color})),p=s.createOutput("vec4","outColor"),{programName:"FlatColor",getHash:function(){return[A.getHash(),u?"sao":"nosao"]},cleanerEdges:!0,getLogDepth:o&&function(e){return e},renderPassFlag:0,appendFragmentOutputs:function(e,t,n,r){e.push("vec3 viewNormal = normalize(cross(dFdx(".concat(d,"), dFdy(").concat(d,")));"));var i=[A.getAmbientColor()].concat(A.directionalLights.map((function(e){return"max(dot(viewNormal, ".concat(e.getDirection(a.viewMatrix,d),"), 0.0) * ").concat(e.getColor())})));e.push("vec4 fragColor = vec4(".concat(i.join(" + "),", 1) * ").concat(r(f),";")),e.push("".concat(p," = ").concat(u?"vec4(fragColor.rgb * ".concat(u.getAmbient(n),", fragColor.a)"):"fragColor",";"))}}));var s,a,o,A,u,h,d,f,p})}},{"sao-":u(!1),"sao+":r&&u(!0)}),depthRenderer:g((function(t,n,r){return r((i=t,s=n,a=e.logarithmicDepthBufferEnabled,o=i.createVarying("highp vec2","vHighPrecisionZW",(function(){return"".concat(s.attributes.position.clip,".zw")})),A=i.createOutput("vec4","outColor"),{programName:"Depth",getLogDepth:a&&function(e){return e},renderPassFlag:0,appendFragmentOutputs:function(e){return e.push("".concat(A," = vec4(vec3((1.0 - ").concat(o,"[0] / ").concat(o,"[1]) / 2.0), 1.0);"))}}));var i,s,a,o,A})),edgesRenderers:{uniform:g((function(t,n,r){return r(Ms(t,n,e.logarithmicDepthBufferEnabled,!0))}),{vertices:!1}),vertex:g((function(t,n,r){return r(Ms(t,n,e.logarithmicDepthBufferEnabled,!1))}),{vertices:!1})},occlusionRenderer:g((function(t,n,r){return r(ks(t,e.logarithmicDepthBufferEnabled))})),pickDepthRenderer:v(y),pickMeshRenderer:v(_),pickNormalsFlatRenderer:v((function(e,t,n){return b(e,t,n,!0)})),pickNormalsRenderer:v((function(e,t,n){return b(e,t,n,!1)})),shadowRenderer:g((function(t,n,r){return r((s=e,a=(i=t).createOutput("vec4","outColor"),o=i.createFragmentDefinition("encodeFloat",(function(e,t){t.push("vec4 ".concat(e,"(const in float v) {")),t.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),t.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),t.push("  vec4 comp = fract(v * bitShift);"),t.push("  comp -= comp.xxyz * bitMask;"),t.push("  return comp;"),t.push("}")})),{programName:"Shadow",getLogDepth:s&&function(e){return e},renderPassFlag:0,isShadowProgram:!0,appendFragmentOutputs:function(e,t,n){return e.push("".concat(a," = ").concat(o,"(").concat(n,".z);"))}}));var i,s,a,o})),silhouetteRenderer:v((function(t,n,r){return r(Es(t,n,e.logarithmicDepthBufferEnabled,!1))})),snapInitRenderer:v((function(e,t,n){return w(e,t,n,!0,!1)})),snapEdgeRenderer:v((function(e,t,n){return w(e,t,n,!1,!1)}),{vertices:!1}),snapVertexRenderer:v((function(e,t,n){return w(e,t,n,!1,!1)}),{vertices:!0})};var B=function(){return e=!1,void function t(n){n.revalidate?n.revalidate(e):Object.values(n).forEach((function(e){return e&&t(e)}))}(h[d]);var e};B(),e.on("compile",B),e.on("destroyed",(function(){delete h[d]}))}return h[d]}),Ks=function(){function e(t,n,r){x(this,e),this.model=t,this.primitive=n,this.origin=r,this._meshes=[],this._aabb=De.collapseAABB3(),this._aabbDirty=!0}return I(e,[{key:"finalize",value:function(){var e=this;if(!this._compiledPortions){this._compiledPortions=this.compilePortions(),this.solid=this._compiledPortions.solid,this.sortId=this._compiledPortions.sortId,this.layerTextureSet=this._compiledPortions.layerTextureSet,this.drawCalls=this._compiledPortions.drawCalls,this._renderers=this._compiledPortions.renderers,this._setFlags=this._compiledPortions.setFlags,this.setColor=this._compiledPortions.setColor,this.setMatrix=this._compiledPortions.setMatrix,this.setOffset=this._compiledPortions.setOffset,this.getEachIndex=this._compiledPortions.getEachIndex,this.getEachVertex=this._compiledPortions.getEachVertex,this.readGeometryData=this._compiledPortions.readGeometryData,this.precisionRayPickSurface=this._compiledPortions.precisionRayPickSurface,this._countsByFlag={};var t=function(t,n){var r={count:0,fromFlags:function(i,s){i&t?(r.count++,e.model[n]++):s||(r.count--,e.model[n]--)}};e._countsByFlag[t]=r};t(vs,"numVisibleLayerPortions"),t(gs,"numCulledLayerPortions"),t(ms,"numPickableLayerPortions"),t(ys,"numClippableLayerPortions"),t(bs,"numXRayedLayerPortions"),t(ws,"numHighlightedLayerPortions"),t(Bs,"numSelectedLayerPortions"),this._renderers.edgesRenderers&&t(Cs,"numEdgesLayerPortions"),this._countsByFlagArr=Object.values(this._countsByFlag),this._numTransparentLayerPortions=0}}},{key:"aabbChanged",value:function(){this._aabbDirty=!0}},{key:"getAABB",value:function(){var e=this;return this._aabbDirty&&(De.collapseAABB3(this._aabb),this._meshes.forEach((function(t){return De.expandAABB3(e._aabb,t.aabb)})),this._aabbDirty=!1),this._aabb}},{key:"__drawLayer",value:function(e,t,n,r){if(this._countsByFlag[gs].count<this._portions.length&&this._countsByFlag[vs].count>0){var i="points"!==this.primitive&&"lines"!==this.primitive&&[Ss,Ds,js,Qs,Rs,Os];if(i&&i.includes(r)){if(true!==t.backfaces){var s=this.model.scene.canvas.gl;s.disable(s.CULL_FACE),t.backfaces=true}}t.textureUnit=0,n.drawLayer(t,this,r)}}},{key:"__setVec4FromMaterialColorAlpha",value:function(e,t,n){return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=t,n}},{key:"__drawColor",value:function(e,t,n){if((n?this._numTransparentLayerPortions<this._portions.length:this._numTransparentLayerPortions>0)&&this._countsByFlag[bs].count<this._portions.length){var r=n&&t.withSAO&&this._renderers.colorRenderers["sao+"]||this._renderers.colorRenderers["sao-"],i=t.pbrEnabled&&r.PBR?r.PBR:t.colorTextureEnabled&&r.texture?r.texture[this.layerTextureSet&&"number"==typeof this.layerTextureSet.alphaCutoff?"alphaCutoff+":"alphaCutoff-"]:r.vertex,s=n?Ss:Ds;this.__drawLayer(e,t,i,s)}}},{key:"drawColorOpaque",value:function(e,t){this.__drawColor(e,t,!0)}},{key:"drawColorTransparent",value:function(e,t){this.__drawColor(e,t,!1)}},{key:"drawDepth",value:function(e,t){var n=this._renderers.depthRenderer;n&&this._numTransparentLayerPortions<this._portions.length&&this._countsByFlag[bs].count<this._portions.length&&this.__drawLayer(e,t,n,Ss)}},{key:"__drawSilhouette",value:function(e,t,n,r){t.programColor=this.__setVec4FromMaterialColorAlpha(n.fillColor,n.fillAlpha,Us),this.__drawLayer(e,t,this._renderers.silhouetteRenderer,r)}},{key:"drawSilhouetteXRayed",value:function(e,t){this._countsByFlag[bs].count>0&&this.__drawSilhouette(e,t,this.model.scene.xrayMaterial,Os)}},{key:"drawSilhouetteHighlighted",value:function(e,t){this._countsByFlag[ws].count>0&&this.__drawSilhouette(e,t,this.model.scene.highlightMaterial,Qs)}},{key:"drawSilhouetteSelected",value:function(e,t){this._countsByFlag[Bs].count>0&&this.__drawSilhouette(e,t,this.model.scene.selectedMaterial,Rs)}},{key:"__drawVertexEdges",value:function(e,t,n){var r=this._renderers.edgesRenderers&&this._renderers.edgesRenderers.vertex;r&&this._countsByFlag[Cs].count>0&&this.__drawLayer(e,t,r,n)}},{key:"drawEdgesColorOpaque",value:function(e,t){this._compiledPortions.edgesColorOpaqueAllowed()&&this.__drawVertexEdges(e,t,Vs)}},{key:"drawEdgesColorTransparent",value:function(e,t){this._numTransparentLayerPortions>0&&this.__drawVertexEdges(e,t,Ls)}},{key:"__drawUniformEdges",value:function(e,t,n,r){var i=this._renderers.edgesRenderers&&this._renderers.edgesRenderers.uniform;i&&(t.programColor=this.__setVec4FromMaterialColorAlpha(n.edgeColor,n.edgeAlpha,Us),this.__drawLayer(e,t,i,r))}},{key:"drawEdgesHighlighted",value:function(e,t){this._countsByFlag[ws].count>0&&this.__drawUniformEdges(e,t,this.model.scene.highlightMaterial,Hs)}},{key:"drawEdgesSelected",value:function(e,t){this._countsByFlag[Bs].count>0&&this.__drawUniformEdges(e,t,this.model.scene.selectedMaterial,Ns)}},{key:"drawEdgesXRayed",value:function(e,t){this._countsByFlag[bs].count>0&&this.__drawUniformEdges(e,t,this.model.scene.xrayMaterial,Gs)}},{key:"__drawPick",value:function(e,t,n){n&&this.__drawLayer(e,t,n,js)}},{key:"drawPickMesh",value:function(e,t){this.__drawPick(e,t,this._renderers.pickMeshRenderer)}},{key:"drawPickDepths",value:function(e,t){this.__drawPick(e,t,this._renderers.pickDepthRenderer)}},{key:"drawPickNormals",value:function(e,t){var n=this._renderers.pickNormalsFlatRenderer;this.__drawPick(e,t,n)}},{key:"drawSnap",value:function(e,t,n){t.snapPickOrigin=[0,0,0];var r=this.getAABB();t.snapPickCoordinateScale=De.mulVec3Scalar(Ws([r[3]-r[0],r[4]-r[1],r[5]-r[2]]),De.MAX_INT);var i=n?this._renderers.snapInitRenderer:"edge"===t.snapMode?this._renderers.snapEdgeRenderer:this._renderers.snapVertexRenderer;this.__drawPick(e,t,i),t.snapPickLayerParams.push({origin:t.snapPickOrigin.slice(),coordinateScale:Ws(t.snapPickCoordinateScale)})}},{key:"drawOcclusion",value:function(e,t){var n=this._renderers.occlusionRenderer;n&&this.__drawLayer(e,t,n,Ss)}},{key:"drawShadow",value:function(e,t){var n=this._renderers.shadowRenderer;n&&this.__drawLayer(e,t,n,Ss)}},{key:"initFlags",value:function(e,t,n){this._countsByFlagArr.forEach((function(e){return e.fromFlags(t,!0)})),n&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);var r="points"!==this.primitive;this._setFlags(e,t,n,r),this._compiledPortions.setFlags2(e,t,r)}},{key:"flushInitFlags",value:function(){this._compiledPortions.setDeferredFlags()}},{key:"setVisible",value:function(e,t,n){this._countsByFlag[vs].fromFlags(t),this._setFlags(e,t,n)}},{key:"setCulled",value:function(e,t,n){this._countsByFlag[gs].fromFlags(t),this._setFlags(e,t,n)}},{key:"setPickable",value:function(e,t,n){this._countsByFlag[ms].fromFlags(t),this._setFlags(e,t,n)}},{key:"setClippable",value:function(e,t){this._countsByFlag[ys].fromFlags(t),this._compiledPortions.setClippableFlags(e,t)}},{key:"setCollidable",value:function(e,t){}},{key:"setXRayed",value:function(e,t,n){this._countsByFlag[bs].fromFlags(t),this._setFlags(e,t,n)}},{key:"setHighlighted",value:function(e,t,n){this._countsByFlag[ws].fromFlags(t),this._setFlags(e,t,n)}},{key:"setSelected",value:function(e,t,n){this._countsByFlag[Bs].fromFlags(t),this._setFlags(e,t,n)}},{key:"setEdges",value:function(e,t,n){this._countsByFlag[Cs]&&(this._countsByFlag[Cs].fromFlags(t),this._setFlags(e,t,n))}},{key:"setTransparent",value:function(e,t,n){n?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,n)}},{key:"destroy",value:function(){this._compiledPortions&&this._compiledPortions.destroy()}}]),e}(),Zs=65536,Js=5e6,Ys=function(){function e(){x(this,e)}return I(e,[{key:"doublePrecisionEnabled",get:function(){return De.getDoublePrecisionEnabled()},set:function(e){De.setDoublePrecisionEnabled(e)}},{key:"maxDataTextureHeight",get:function(){return Zs},set:function(e){(e=1024*Math.ceil(e/1024))>4096?e=4096:e<1024&&(e=1024),Zs=e}},{key:"maxGeometryBatchSize",get:function(){return Js},set:function(e){e<1e5?e=1e5:e>5e6&&(e=5e6),Js=e}}]),e}(),qs=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},$s={sizeDataColorsAndFlags:0,sizeDataInstancesMatrices:0,sizeDataPositionDecodeMatrices:0,sizeDataTextureOffsets:0,sizeDataTexturePositions:0,sizeDataTextureIndices:0,sizeDataTextureEdgeIndices:0,sizeDataTexturePortionIds:0,numberOfGeometries:0,numberOfPortions:0,numberOfLayers:0,numberOfTextures:0,totalPolygons:0,totalPolygons8Bits:0,totalPolygons16Bits:0,totalPolygons32Bits:0,totalEdges:0,totalEdges8Bits:0,totalEdges16Bits:0,totalEdges32Bits:0,cannotCreatePortion:{because10BitsObjectId:0,becauseTextureSize:0},overheadSizeAlignementIndices:0,overheadSizeAlignementEdgeIndices:0};window.printDataTextureRamStats=function(){console.log(JSON.stringify($s,null,4));var e=0;Object.keys($s).forEach((function(t){t.startsWith("size")&&(e+=$s[t])})),console.log("Total size ".concat(e," bytes (").concat((e/1e3/1e3).toFixed(2)," MB)")),console.log("Avg bytes / triangle: ".concat((e/$s.totalPolygons).toFixed(2)));var t={};Object.keys($s).forEach((function(n){n.startsWith("size")&&(t[n]="".concat(($s[n]/e*100).toFixed(2)," % of total"))})),console.log(JSON.stringify({percentualRamUsage:t},null,4))};var ea=new Ys,ta=ea.maxDataTextureHeight,na=De.vec3(),ra=De.vec3(),ia=De.vec4();De.vec4();var sa=new Float32Array(16),aa=new Uint8Array(4),oa=De.identityMat4(),Aa=function(e){m(n,Ks);var t=_(n);function n(e,r,i){var s;x(this,n),s=t.call(this,e,r,i),$s.numberOfLayers++,s._sortId="TriDTX-".concat($s.numberOfLayers);var a=e.scene.canvas.gl,o=function(e,t){var n=[],r=0,i=[],s=0,o=[],c=0,l=[],u=0;return{len:function(){return s},accumulateIndices:function(a,h){var d=a&&a.length>0&&function(){var t=r/3;r+=a.length,n.push(a);var o=a.length/3;return function(n){var r=s;s+=3*o,A.perObjectIndexBaseOffsets.push(r/3-t);for(var a=0;a<o;a+=8)i.push(n);$s[e]+=o,$s.totalPolygons+=o}}(),f=h&&function(){var e=c/2;c+=h.length,o.push(h);var n=h.length/2;return function(r){var i=u;u+=2*n,A.perObjectEdgeIndexBaseOffsets.push(i/2-e);for(var s=0;s<n;s+=8)l.push(r);$s[t]+=n,$s.totalEdges+=n}}();return $s.numberOfGeometries++,{numTriangles:a?a.length/3:0,accumulateSubPortionId:function(e){d&&d(e),f&&f(e)}}},createDrawers:function(e,t){var A=function(t,n){return t.length>0?e([t],t.length,1,a.UNSIGNED_SHORT,"sizeDataTexturePortionIds"):n},h=A(i,{texture:null}),d=r>0&&e(n,r,3,t,"sizeDataTextureIndices"),f=A(l),p=c>0&&e(o,c,2,t,"sizeDataTextureEdgeIndices");return{indices:function(e,t){s>0&&(e.perPrimIndices.setInputValue(d),e.perPrimIdPorIds.setInputValue(h),a.drawArrays(t,0,s))},edges:function(e,t){u>0&&(e.perPrimIndices.setInputValue(p),e.perPrimIdPorIds.setInputValue(f),a.drawArrays(t,0,u))}}}}},A=s._buffer={positionsCompressed:[],lenPositionsCompressed:0,geometry8Bits:o("totalPolygons8Bits","totalEdges8Bits"),geometry16Bits:o("totalPolygons16Bits","totalEdges16Bits"),geometry32Bits:o("totalPolygons32Bits","totalEdges32Bits"),perObjectColors:[],perObjectPickColors:[],perObjectSolid:[],perObjectPositionsDecodeMatrices:[],perObjectInstancePositioningMatrices:[],perObjectVertexBases:[],perObjectIndexBaseOffsets:[],perObjectEdgeIndexBaseOffsets:[]};return s._numVertices=0,s._portions=[],s._subPortionReadableGeometries=s.model.scene.readableGeometryEnabled&&{},s._portionToSubPortionsMap=[],s._bucketGeometries={},s._primitive=r,s}return I(n,[{key:"canCreatePortion",value:function(e){var t=e.buckets.length;this._portions.length+t>65536&&$s.cannotCreatePortion.because10BitsObjectId++;var n=this._portions.length+t<=65536,r=void 0!==e.geometryId&&null!==e.geometryId?"".concat(e.geometryId,"#").concat(0):"".concat(e.id,"#").concat(0);if(!this._bucketGeometries[r]){var i=this._buffer,s=Math.max(i.geometry8Bits.len(),i.geometry16Bits.len(),i.geometry32Bits.len()),a=0,o=0;e.buckets.forEach((function(e){a+=e.positionsCompressed.length/3,o+=e.indices.length/3})),(this._numVertices+a>4096*ta||s+o>4096*ta)&&$s.cannotCreatePortion.becauseTextureSize++,n&&(n=this._numVertices+a<=4096*ta&&s+o<=4096*ta)}return n}},{key:"createPortion",value:function(e,t){var n=this,r=this._buffer,i=t.buckets.map((function(e,i){var s,a,o,A=(null!==(s=t.geometryId)&&void 0!==s?s:t.id)+"#"+i;if(!(A in n._bucketGeometries)){var c=function(e,t,n){if(e){var r=8*Math.ceil(e.length/t/8)*t,i=new Uint32Array(r);return i.set(e),$s[n]+=2*(i.length-e.length),i}return e};e.indices=c(e.indices,3,"overheadSizeAlignementIndices"),e.edgeIndices=c(e.edgeIndices,2,"overheadSizeAlignementEdgeIndices");var l=e.positionsCompressed;r.positionsCompressed.push(l);var u=l.length/3;n._numVertices+=u;var h=r.lenPositionsCompressed/3;r.lenPositionsCompressed+=l.length,n._bucketGeometries[A]={vertexBase:h,geometryData:(a=e.indices,o=e.edgeIndices,u<=256?r.geometry8Bits.accumulateIndices(a,o):u<=65536?r.geometry16Bits.accumulateIndices(a,o):r.geometry32Bits.accumulateIndices(a,o))}}var d=n._bucketGeometries[A];r.perObjectPositionsDecodeMatrices.push(t.positionsDecodeMatrix),r.perObjectInstancePositioningMatrices.push(t.meshMatrix||oa),r.perObjectSolid.push(!!t.solid),r.perObjectPickColors.push(t.pickColor),r.perObjectVertexBases.push(d.vertexBase);var f=t.colors,p=t.color;r.perObjectColors.push(f?[255*f[0],255*f[1],255*f[2],255]:[p[0],p[1],p[2],t.opacity]);var v=n._portions.length;return n._portions.push({}),d.geometryData.accumulateSubPortionId(v),n._subPortionReadableGeometries&&(n._subPortionReadableGeometries[v]={indices:e.indices,positionsCompressed:e.positionsCompressed,positionsDecodeMatrix:t.positionsDecodeMatrix}),$s.numberOfPortions++,v})),s=this._portionToSubPortionsMap.length;return this._portionToSubPortionsMap.push(i),this.model.numPortions++,this._meshes.push(e),s}},{key:"compilePortions",value:function(){var e=this._buffer,t=this.model,n=this._portions.length,r=this.origin,i=this._portionToSubPortionsMap,s=this._primitive,a=this._sortId,o=this._subPortionReadableGeometries,A=t.scene,c=A.canvas.gl,l=ca(c,n,32,c.UNSIGNED_BYTE,512,(function(t){for(var r=function(e){return[e>>24&255,e>>16&255,e>>8&255,255&e]},i=0;i<n;i++)t.set(e.perObjectColors[i],32*i+0),t.set(e.perObjectPickColors[i],32*i+4),t.set([0,0,0,0],32*i+8),t.set([0,0,0,0],32*i+12),t.set(r(e.perObjectVertexBases[i]),32*i+16),t.set(r(e.perObjectIndexBaseOffsets[i]),32*i+20),t.set(r(e.perObjectEdgeIndexBaseOffsets[i]),32*i+24),t.set([e.perObjectSolid[i]?1:0,0,0,0],32*i+28)}),"sizeDataColorsAndFlags",!0),u=l.textureData,h=function(e,t,n,r,i,s,a){return ca(c,t,n,r,i,(function(t){for(var n=0,r=0,i=e.length;n<i;n++){var s=e[n];t.set(s,r),r+=s.length}}),s,a)},d=function(e,t,n){var r=e.length;if(0===r)throw"num "+t+" matrices===0";return h(e,r,16,c.FLOAT,512,t,n)},f=d(e.perObjectInstancePositioningMatrices,"sizeDataInstancesMatrices",!0),p=f.textureData,v=d(e.perObjectPositionsDecodeMatrices,"sizeDataPositionDecodeMatrices",!1),g=function(e,t,n,r,i){return h(e,t/n,n,r,4096,i,!1)},m=g(e.positionsCompressed,e.lenPositionsCompressed,3,c.UNSIGNED_SHORT,"sizeDataTexturePositions"),y=e.geometry8Bits.createDrawers(g,c.UNSIGNED_BYTE),_=e.geometry16Bits.createDrawers(g,c.UNSIGNED_SHORT),b=e.geometry32Bits.createDrawers(g,c.UNSIGNED_INT);this._buffer=null;var w,B,C=!1,M=!1,k=!1,E=0,F=function(){C=!0},x=A.on("rendering",(function(){M&&(C=!1,M=!1,u.reloadData()),E=0})),U=function(e,n){var r=i[e];if(r)for(var s=0,a=r.length;s<a;s++)n(r[s]);else t.error("portion not found: "+e)},I=function(e,t,n,r){var i=C||r;i?M=!0:++E>=10&&F(),u.setData(n,e,t,!i)},T=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];aa.set([t&ys?255:0,0,1,2]),U(e,(function(e){return I(e,3,aa,n)}))};return{edgesColorOpaqueAllowed:function(){return!A.logarithmicDepthBufferEnabled||(A._loggedWarning||(console.log("Edge enhancement for SceneModel data texture layers currently disabled with logarithmic depth buffer"),A._loggedWarning=!0),!1)},sortId:a,setClippableFlags:T,setFlags:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];zs(t,n,!0,A,aa),U(e,(function(e){return I(e,2,aa,r)}))},setFlags2:T,setDeferredFlags:function(){},setColor:function(e,t){aa.set(t),U(e,(function(e){return I(e,0,aa,!1)}))},setMatrix:function(e,t){U(e,(function(e){var n=C;n?M=!0:++E>=10&&F(),sa.set(t),p.setData(sa,e,0,!n)}))},setOffset:function(e,t){},getEachIndex:function(e,t){o&&U(e,(function(e){return o[e].indices.forEach((function(e){return t(e)}))}))},getEachVertex:function(e,n){o&&U(e,(function(e){for(var i=o[e],s=i.positionsCompressed,a=i.positionsDecodeMatrix,A=ia,c=0,l=s.length;c<l;c+=3)A[0]=s[c],A[1]=s[c+1],A[2]=s[c+2],A[3]=1,De.decompressPosition(A,a),De.mulMat4v4(t.worldMatrix,A,A),De.addVec3(r,A,A),n(A)}))},precisionRayPickSurface:function(e,t,n,r,i){return!1},renderers:Xs(A,"dtx",s,t.saoEnabled,!1,!1,!0,(function(e,t){return la(e,!t)})),drawCalls:(w=function(e){var n=function(e,t){return e.setInputValue&&e.setInputValue(t)};return function(i,s,a){n(s.worldMatrix,t.rotationMatrix),n(s.viewMatrix,a.viewMatrix),n(s.projMatrix,a.projMatrix);var o=De.transformPoint3(t.matrix,r,na);n(s.uCameraEyeRtc,De.subVec3(a.eye,o,ra)),n(s.perObjPosDecode,v),n(s.perVertIdCoords,m),n(s.perObjColsFlags,l),n(s.perObjectMatrix,f),e(s)}},B=function(e){return w((function(t){y.edges(t,e),_.edges(t,e),b.edges(t,e)}))},{drawVertices:B(c.POINTS),drawEdges:B(c.LINES),drawSurface:w((function(e){var t=c.TRIANGLES;y.indices(e,t),_.indices(e,t),b.indices(e,t)}))}),destroy:function(){k||(A.off(x),k=!0)}}}}]),n}(),ca=function(e,t,n,r,i,s,a,o){if(n>4&&n%4>0)throw"Unhandled data size "+n;var A=Math.ceil(n/4),c=n/A,l=k(function(){switch(r){case e.UNSIGNED_BYTE:return[Uint8Array].concat(p(1===c?[e.R8UI,e.RED_INTEGER]:2===c?[e.RG8UI,e.RG_INTEGER]:3===c?[e.RGB8UI,e.RGB_INTEGER]:[e.RGBA8UI,e.RGBA_INTEGER]));case e.UNSIGNED_SHORT:return[Uint16Array].concat(p(1===c?[e.R16UI,e.RED_INTEGER]:2===c?[e.RG16UI,e.RG_INTEGER]:3===c?[e.RGB16UI,e.RGB_INTEGER]:[e.RGBA16UI,e.RGBA_INTEGER]));case e.UNSIGNED_INT:return[Uint32Array].concat(p(1===c?[e.R32UI,e.RED_INTEGER]:2===c?[e.RG32UI,e.RG_INTEGER]:3===c?[e.RGB32UI,e.RGB_INTEGER]:[e.RGBA32UI,e.RGBA_INTEGER]));case e.FLOAT:return[Float32Array].concat(p(1===c?[e.R32F,e.RED]:2===c?[e.RG32F,e.RG]:3===c?[e.RGB32F,e.RGB]:[e.RGBA32F,e.RGBA]));default:throw"Unhandled data type "+r}}(),3),u=l[0],h=l[1],d=l[2],f=i*A,v=Math.ceil(t/i);if(0===v)throw"texture height===0";var g=new u(f*v*c);$s[a]+=g.byteLength,$s.numberOfTextures++,s(g);var m=e.createTexture();return e.bindTexture(e.TEXTURE_2D,m),e.texStorage2D(e.TEXTURE_2D,1,h,f,v),e.texSubImage2D(e.TEXTURE_2D,0,0,0,f,v,d,r,g),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),{bind:function(t){return e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_2D,m),!0},unbind:function(e){},textureData:o&&{setData:function(t,s){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(g.set(t,s*n+a*c),o){e.bindTexture(e.TEXTURE_2D,m);var l=s%i*A+a,u=Math.floor(s/i),h=t.length/c;e.texSubImage2D(e.TEXTURE_2D,0,l,u,h,1,d,r,t)}},reloadData:function(){e.bindTexture(e.TEXTURE_2D,m),e.texSubImage2D(e.TEXTURE_2D,0,0,0,f,v,d,r,g)}}}},la=function(e,t){var n,r=function(t,n){var r=e.createUniform(t,n),i=function(e){return"texelFetch(".concat(r,", ").concat(e,", 0)")};return i.map=r,i},i=r("highp   usampler2D","perPrimIndices"),s=r("mediump usampler2D","perPrimIdPorIds"),a=r("highp    sampler2D","perObjPosDecode"),o=r("mediump usampler2D","perVertIdCoords"),A=r("lowp    usampler2D","perObjColsFlags"),c=r("highp    sampler2D","perObjectMatrix"),l=e.createUniform("mat4","worldMatrix"),u=e.createUniform("mat4","viewMatrix"),h=e.createUniform("mat4","projMatrix"),d=e.createUniform("vec3","uCameraEyeRtc"),f=function(e){var t={toString:function(){return t.needed=!0,e}};return t},p=f("colorA"),v=f("pickColor"),g=f("worldNormal"),m=f("viewNormal"),y=function(e){return A("ivec2(objectIndexCoords.x*8+".concat(e,", objectIndexCoords.y)"))};return{clippableTest:(n=e.createVarying("uint","vClippable",(function(){return"flags2.r"}),"flat"),function(){return"".concat(n," > 0u")}),geometryParameters:{attributes:{color:p,flags:qs(4).map((function(e){return"int(flags[".concat(e,"])")})),metallicRoughness:null,normal:{view:m,world:g},pickColor:v,position:{clip:"gl_Position",view:"viewPosition",world:"worldPosition"},uv:null},projMatrix:h,viewMatrix:u},ensureColorAndFlagAvailable:function(e){e.push("int primitiveIndex = gl_VertexID / "+(t?3:2)+";"),e.push("int h_packed_object_id_index = (primitiveIndex >> 3) & 4095;"),e.push("int v_packed_object_id_index = (primitiveIndex >> 3) >> 12;"),e.push("int objectIndex = int(".concat(s("ivec2(h_packed_object_id_index, v_packed_object_id_index)"),".r);")),e.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),e.push("uvec4 flags  = ".concat(y(2),";")),e.push("uvec4 flags2 = ".concat(y(3),";")),p.needed&&e.push("vec4 ".concat(p," = vec4(").concat(y(0),") / 255.0;"))},appendVertexData:function(e){var n=function(e){return c("ivec2(objectIndexCoords.x*4+".concat(e,", objectIndexCoords.y)"))};e.push("mat4 objectInstanceMatrix = mat4(".concat(n(0),", ").concat(n(1),", ").concat(n(2),", ").concat(n(3),");"));var r=function(e){return a("ivec2(objectIndexCoords.x*4+".concat(e,", objectIndexCoords.y)"))};if(e.push("mat4 objectDecodeAndInstanceMatrix = objectInstanceMatrix * mat4(".concat(r(0),", ").concat(r(1),", ").concat(r(2),", ").concat(r(3),");")),e.push("ivec4 packedVertexBase = ivec4(".concat(y(4),");")),e.push("ivec4 packedIndexBaseOffset = ivec4(".concat(y(t?5:6),");")),e.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),e.push("int h_index = (primitiveIndex - indexBaseOffset) & 4095;"),e.push("int v_index = (primitiveIndex - indexBaseOffset) >> 12;"),e.push("ivec3 vertexIndices = ivec3(".concat(i("ivec2(h_index, v_index)"),");")),e.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),t){e.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),e.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),e.push("uint solid = ".concat(y(7),".r;"));var s=function(e){return"vec3(".concat(o("ivec2(indexPositionH[".concat(e,"], indexPositionV[").concat(e,"])")),")")};e.push("vec3 positions[] = vec3[](".concat(s(0),", ").concat(s(1),", ").concat(s(2),");")),e.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),e.push("vec3 position = positions[gl_VertexID % 3];"),g.needed&&e.push("vec3 worldNormal = -normalize((transpose(inverse(".concat(l," * objectDecodeAndInstanceMatrix)) * vec4(normal,1)).xyz);")),m.needed&&e.push("vec3 viewNormal = -normalize((transpose(inverse(".concat(u," * objectDecodeAndInstanceMatrix)) * vec4(normal,1)).xyz);")),e.push("if (solid != 1u) {"),e.push("  if (".concat("(".concat(h,"[2][3] == - 1.0)"),") {")),e.push("      vec3 uCameraEyeRtcInQuantizedSpace = (inverse(".concat(l," * objectDecodeAndInstanceMatrix) * vec4(").concat(d,", 1)).xyz;")),e.push("      if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),e.push("          position = positions[2 - (gl_VertexID % 3)];"),g.needed&&e.push("          worldNormal = -worldNormal;"),m.needed&&e.push("          viewNormal = -viewNormal;"),e.push("      }"),e.push("  } else {"),m.needed||e.push("      vec3 viewNormal = -normalize((transpose(inverse(".concat(u," * objectDecodeAndInstanceMatrix)) * vec4(normal,1)).xyz);")),e.push("      if (viewNormal.z < 0.0) {"),e.push("          position = positions[2 - (gl_VertexID % 3)];"),g.needed&&e.push("          worldNormal = -worldNormal;"),m.needed&&e.push("          viewNormal = -viewNormal;"),e.push("      }"),e.push("  }"),e.push("}")}else e.push("int indexPositionH = uniqueVertexIndexes[gl_VertexID % 2] & 4095;"),e.push("int indexPositionV = uniqueVertexIndexes[gl_VertexID % 2] >> 12;"),e.push("vec3 position = vec3(".concat(o("ivec2(indexPositionH, indexPositionV)"),");"));v.needed&&e.push("vec4 pickColor = vec4(".concat(y(1),");")),e.push("vec4 worldPosition = ".concat(l," * (objectDecodeAndInstanceMatrix * vec4(position, 1.0));"))},layerTypeInputs:{perPrimIndices:i.map,perPrimIdPorIds:s.map,perObjPosDecode:a.map,perVertIdCoords:o.map,perObjColsFlags:A.map,perObjectMatrix:c.map,worldMatrix:l,viewMatrix:u,projMatrix:h,uCameraEyeRtc:d}}},ua=De.mat4(),ha=De.mat4();function da(e,t,n){for(var r=e.length,i=new Uint16Array(r),s=t[0],a=t[1],o=t[2],A=t[3]-s||1,c=t[4]-a||1,l=t[5]-o||1,u=65525,h=u/A,d=u/c,f=u/l,p=function(e){return e>=0?e:0},v=0;v<r;v+=3)i[v+0]=Math.floor(p(e[v+0]-s)*h),i[v+1]=Math.floor(p(e[v+1]-a)*d),i[v+2]=Math.floor(p(e[v+2]-o)*f);return De.identityMat4(ua),De.translationMat4v(t,ua),De.identityMat4(ha),De.scalingMat4v([A/u,c/u,l/u],ha),De.mulMat4(ua,ha,n),i}function fa(e,t){var n=e[0],r=e[1],i=e[2],s=e[3]-n||1,a=e[4]-r||1,o=e[5]-i||1,A=65525;return De.identityMat4(ua),De.translationMat4v(e,ua),De.identityMat4(ha),De.scalingMat4v([s/A,a/A,o/A],ha),De.mulMat4(ua,ha,t),t}function pa(e,t,n){var r=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),i=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));if(e[2]<0){var s,a;s=(1-Math.abs(i))*(r>=0?1:-1),a=(1-Math.abs(r))*(i>=0?1:-1),r=s,i=a}return new Int8Array([Math[t](127.5*r+(r<0?-1:0)),Math[n](127.5*i+(i<0?-1:0))])}function va(e){var t=e[0],n=e[1];t/=t<0?127:128,n/=n<0?127:128;var r=1-Math.abs(t)-Math.abs(n);r<0&&(t=(1-Math.abs(n))*(t>=0?1:-1),n=(1-Math.abs(t))*(n>=0?1:-1));var i=Math.sqrt(t*t+n*n+r*r);return[t/i,n/i,r/i]}var ga,ma,ya=new Float32Array(1),_a=new Float32Array(4),ba=new Float32Array(3),wa=De.mat4(),Ba=De.vec4([0,0,0,1]),Ca=De.vec4(),Ma=De.vec3(),ka=De.vec3(),Ea=De.vec3(),Fa=De.vec3(),xa=De.vec3(),Ua=De.vec3(),Ia=De.vec3(),Ta=new Uint8Array(4),Pa=new Float32Array(96),Sa=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},Da=function(e,t){e.set(t);for(var n=t.length,r=e.length;n<r;){var i=Math.min(n,r-n);e.set(e.subarray(0,i),n),n+=i}},Qa=(ga=0,ma=new Map,{acquire:function(){return ga++},release:function(){0==--ga&&ma.clear()},getTypeArray:function(e,t){ma.has(e)||ma.set(e,{});var n=ma.get(e);return t in n||(n[t]=new e(t)),n[t]}}),Ra=function(e){m(n,Ks);var t=_(n);function n(e,r,i,s){var a;x(this,n),a=t.call(this,e,r,i);var o=!!s.geometry;a._maxVerts=s.maxGeometryBatchSize;var A=o?s.geometry.positionsDecodeMatrix:s.positionsDecodeMatrix;a._positionsDecodeMatrix=A&&De.mat4(A),a._cfgUvDecodeMatrix=s.uvDecodeMatrix&&De.mat3(s.uvDecodeMatrix),a._instancedGeometry=s.geometry,a._textureSet=s.textureSet,a._modelAABB=!o&&De.collapseAABB3(),a._portions=[];var c=function(){var e=0,t=[];return{length:function(){return e},append:function(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;e+=r*n.length,t.push({data:n,times:r,denormalizeScale:i,increment:s})},compileBuffer:function(e){var n=0;t.forEach((function(e){n+=e.times*e.data.length}));var r=new e(n),i=0;return t.forEach((function(e){var t=e.data,n=e.denormalizeScale,s=e.increment,a=r.subarray(i);if(1===n&&0===s)a.set(t);else for(var o=0;o<t.length;++o)a[o]=s+t[o]*n;for(var A=t.length,c=e.times*t.length;A<c;){var l=Math.min(A,c-A);a.set(a.subarray(0,l),A),A+=l}i+=A})),r}}};return a._buffer=d({colors:c(),metallicRoughness:c(),pickColors:c()},o?{modelMatrixCol:[c(),c(),c()],modelNormalMatrixCol:[c(),c(),c()]}:{positions:c(),indices:c(),uv:c(),normals:c(),edgeIndices:c()}),a}return I(n,[{key:"canCreatePortion",value:function(e,t){return this._instancedGeometry||this._buffer.positions.length()+e<=3*this._maxVerts&&this._buffer.indices.length()+t<=3*this._maxVerts}},{key:"createPortion",value:function(e,t){var n=this,r=this._buffer,i=this._instancedGeometry,s=this.model,a=this._portions.length,o=this.primitive,A=!!this._positionsDecodeMatrix,c=s.scene,l=t.meshMatrix,u=function(i,A,l,u,h){var d,f,p=n._portions.length>0&&n._portions[n._portions.length-1],v={indicesBaseIndex:p?p.indicesBaseIndex+p.numIndices:0,numIndices:l?l.length:0,portionBase:i,portionSize:A,retainedGeometry:c.readableGeometryEnabled&&"points"!==o&&"lines"!==o&&{indices:l,quantizedPositions:u,offset:c.entityOffsetsEnabled&&De.vec3(),matrix:h&&h.slice(),inverseMatrix:null,normalMatrix:null}};"points"!==o&&"lines"!==o&&r.metallicRoughness.append([null!==(d=t.metallic)&&void 0!==d?d:0,null!==(f=t.roughness)&&void 0!==f?f:255],A);return"lines"!==o&&r.pickColors.append(t.pickColor.slice(0,4),A),n._portions.push(v),s.numPortions++,n._meshes.push(e),a};if(i){if(r.modelMatrixCol.forEach((function(e,t){return e.append([l[t+0],l[t+4],l[t+8],l[t+12]])})),"points"!==o){var h,d=t.color;r.colors.append([d[0],d[1],d[2],null!==(h=t.opacity)&&void 0!==h?h:255])}if("points"!==o&&"lines"!==o&&i.normals){var f=De.inverseMat4(De.transposeMat4(l,De.mat4()));r.modelNormalMatrixCol.forEach((function(e,t){return e.append([f[t+0],f[t+4],f[t+8],f[t+12]])}))}return u(a,1,i.indices,i.positionsCompressed,l)}var p=r.positions.length()/3,v=A?t.positionsCompressed:t.positions;if(!v)throw(A?"positionsCompressed":"positions")+" expected";r.positions.append(v);var g=v.length/3,m=t.indices;m&&r.indices.append(m,1,1,p);var y=t.normalsCompressed,_=t.normals;if(y&&y.length>0)r.normals.append(y);else if(_&&_.length>0){var b=wa;l?(De.transposeMat4(l,b),De.inverseMat4(b,b)):De.identityMat4(b);var w=[];!function(e,t,n,r,i){function s(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}var a,o,A,c,l,u=new Float32Array([0,0,0,0]),h=new Float32Array([0,0,0,0]);for(l=0;l<n;l+=3)u[0]=t[l],u[1]=t[l+1],u[2]=t[l+2],De.transformVec3(e,u,h),De.normalizeVec3(h,h),o=a=pa(h,"floor","floor"),A=c=s(h,va(a)),(A=s(h,va(a=pa(h,"ceil","floor"))))>c&&(o=a,c=A),(A=s(h,va(a=pa(h,"floor","ceil"))))>c&&(o=a,c=A),(A=s(h,va(a=pa(h,"ceil","ceil"))))>c&&(o=a,c=A),r[i+l+0]=o[0],r[i+l+1]=o[1],r[i+l+2]=0}(b,_,_.length,w,0),r.normals.append(w)}var B=t.colors,C=t.colorsCompressed,M=t.color;if(B)if("points"===o)r.colors.append(B,1,255);else{for(var k=[],E=0,F=B.length;E<F;E+=3)k.push(255*B[E]),k.push(255*B[E+1]),k.push(255*B[E+2]),k.push(255);r.colors.append(k)}else if(C)if("points"===o)r.colors.append(C);else{for(var x=[],U=0,I=C.length;U<I;U+=3)x.push(C[U]),x.push(C[U+1]),x.push(C[U+2]),x.push(255);r.colors.append(x)}else M&&r.colors.append([M[0],M[1],M[2],"points"===o?1:t.opacity],g);var T=function(e){return e&&e.length>0&&e},P=T(t.uv)||T(t.uvCompressed);P&&r.uv.append(P);var S=t.edgeIndices;return S&&r.edgeIndices.append(S,1,1,p),De.expandAABB3(this._modelAABB,t.aabb),u(p,g,m)}},{key:"compilePortions",value:function(){var e=this._buffer,t=this._instancedGeometry,n=this.model,r=this._modelAABB,i=this.origin,s=this._portions,a=this.primitive,o=this._textureSet,A=this._positionsDecodeMatrix,c=this._cfgUvDecodeMatrix,l=n.scene,u=l.canvas.gl,h=!!t,d=[],p=function(e,t,n,r){if(t.length>0){var i,s=t.constructor,a=k((i={},f(i,Uint8Array,[1,u.UNSIGNED_BYTE]),f(i,Int8Array,[1,u.BYTE]),f(i,Uint16Array,[2,u.UNSIGNED_SHORT]),f(i,Int16Array,[2,u.SHORT]),f(i,Uint32Array,[4,u.UNSIGNED_INT]),f(i,Int32Array,[4,u.INT]),f(i,Float32Array,[4,u.FLOAT]),i)[s],2),o=a[0],A=a[1],c=u.createBuffer();d.push((function(){return u.deleteBuffer(c)}));var l=function(){return u.bindBuffer(e,c)},h=function(t){l(),u.bufferData(e,t,r)};h(t);var p=t.BYTES_PER_ELEMENT,v=t.length/n;return{bindBuffer:l,getData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v-t;l();var i=new s(r*n);return u.getBufferSubData(e,t*o*n,i,0,r*n),i},numItems:v,setData:h,setSubData:function(t,n){l(),u.bufferSubData(e,n*p,t)},type:A}}return null},v=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=p(u.ARRAY_BUFFER,e,t,n);return s&&{getData:s.getData,numItems:s.numItems,setData:s.setData,setSubData:s.setSubData,attributeDivisor:r&&1,bindAtLocation:function(e){s.bindBuffer(),u.vertexAttribPointer(e,t,s.type,!!i,0,0)}}},g=function(e){var t=p(u.ELEMENT_ARRAY_BUFFER,e,1,u.STATIC_DRAW);return t&&{getData:t.getData,bindIndicesBuffer:t.bindBuffer,indicesCount:e.length,indicesType:t.type}},m=s.reduce((function(e,t){return e+t.portionSize}),0),y=v(new Float32Array(m),1,u.DYNAMIC_DRAW,h),_=function(e,t){return v(e,4,t,h&&"points"!==a,!0)},b=h&&t.colorsCompressed?_(new Uint8Array(t.colorsCompressed),u.STATIC_DRAW):_(e.colors.compileBuffer(Uint8Array),u.DYNAMIC_DRAW),w=l.entityOffsetsEnabled&&v(new Float32Array(3*m),3,u.DYNAMIC_DRAW,h),B=v(e.metallicRoughness.compileBuffer(Uint8Array),2,u.STATIC_DRAW,h),C=v(e.pickColors.compileBuffer(Uint8Array),4,u.STATIC_DRAW,h),M=g(h?new Uint32Array(t.edgeIndices):e.edgeIndices.compileBuffer(Uint32Array)),E=h?"points"!==a&&t.indices&&new Uint32Array(t.indices):e.indices.compileBuffer(Uint32Array),F=E&&g(E),x=h?t.positionsCompressed:A?e.positions.compileBuffer(Uint16Array):da(e.positions.compileBuffer(Float64Array),r,A=De.mat4()),U=x&&v(x,3,u.STATIC_DRAW);h||s.forEach((function(e){if(e.retainedGeometry){var t=3*e.portionBase;e.retainedGeometry.quantizedPositions=x.subarray(t,t+3*e.portionSize)}}));var I=h&&e.modelMatrixCol.map((function(e){return v(e.compileBuffer(Float32Array),4,u.STATIC_DRAW,!0)})),T=!h&&e.normals.compileBuffer(Int8Array),P=T&&v(T,3,u.STATIC_DRAW,!1,!0),S=I&&P&&e.modelNormalMatrixCol.map((function(e){return v(e.compileBuffer(Float32Array),4,u.STATIC_DRAW,!0)})),D=h?"points"!==a&&"lines"!==a&&t.uvCompressed&&{buf:v(t.uvCompressed,2,u.STATIC_DRAW),mat:t.uvDecodeMatrix}:function(){var t=e.uv.compileBuffer(Float32Array);if(0===t.length)return null;if(c)return{buf:v(t,2,u.STATIC_DRAW),mat:c};var n=Nt.getUVBounds(t),r=Nt.compressUVs(t,n.min,n.max);return{buf:v(r.quantized,2,u.STATIC_DRAW),mat:De.mat3(r.decodeMatrix)}}();this._buffer=null,Qa.acquire(),d.push((function(){return Qa.release()}));var Q,R,O=null,V=function(e,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];zs(n,r,"points"!==a&&"lines"!==a,l,Ta);var o=n&ys?1:0,A=0;A|=Ta[0],A|=Ta[1]<<4,A|=Ta[2]<<8,A|=Ta[3]<<12,A|=o<<16,ya[0]=A;var c=s[e],u=c.portionBase,h=c.portionSize;if(i&&!t)O||(O=new Float32Array(m)),Da(O.subarray(u,u+h),ya);else if(y){var d=Qa.getTypeArray(Float32Array,h);Da(d,ya),y.setSubData(d,u)}},L="solid"===a;return{edgesColorOpaqueAllowed:function(){return!0},solid:L,sortId:("points"===a?"Points":"lines"===a?"Lines":"Triangles")+(h?"Instancing":"Batching")+"Layer"+("points"!==a&&"lines"!==a?(L?"-solid":"-surface")+"-autoNormals"+(h?"":(o&&o.colorTexture?"-colorTexture":"")+(o&&o.metallicRoughnessTexture?"-metallicRoughnessTexture":"")):""),setClippableFlags:V,setFlags:V,setFlags2:function(e,t,n){},setDeferredFlags:function(){O&&(y.setData(O),O=null)},setColor:function(e,t){if(b){var n=s[e],r=Qa.getTypeArray(Uint8Array,4*n.portionSize);Da(r,t.slice(0,4)),b.setSubData(r,4*n.portionBase)}},setMatrix:function(e,t){I&&I.forEach((function(n,r){_a[0]=t[r+0],_a[1]=t[r+4],_a[2]=t[r+8],_a[3]=t[r+12],n.setSubData(_a,4*e)}))},setOffset:function(e,t){if(l.entityOffsetsEnabled){var r=s[e];if(w){ba.set(t);var i=Qa.getTypeArray(Float32Array,3*r.portionSize);Da(i,ba),w.setSubData(i,3*r.portionBase)}r.retainedGeometry&&r.retainedGeometry.offset.set(t)}else n.error("Entity#offset not enabled for this Viewer")},getEachIndex:function(e,t){var n=s[e].retainedGeometry;n&&n.indices.forEach((function(e){return t(e)}))},getEachVertex:function(e,t){var r=s[e].retainedGeometry;if(r){var a=Ca;i?a.set(i,0):a[0]=a[1]=a[2]=0,a[3]=1;var o=n.matrix;De.mulMat4v4(o,a,a);for(var c=r.quantizedPositions,l=Ba,u=0,h=c.length;u<h;u+=3)l[0]=c[u],l[1]=c[u+1],l[2]=c[u+2],De.decompressPosition(l,A),r.matrix&&De.transformPoint3(r.matrix,l,l),l[3]=1,De.mulMat4v4(o,l,l),De.addVec3(a,l,l),t(l)}},readGeometryData:"points"!==a&&"lines"!==a&&function(e){var t=!h&&s[e],r=t?F.getData(t.indicesBaseIndex,t.numIndices).map((function(e){return e-t.portionBase})):F.getData(),a=n.matrix,o=De.vec4();o.set(i,0),o[3]=1,De.mulMat4v4(a,o,o);var c=I&&De.mat4();if(c){var l=I[0].getData(e,1),u=I[1].getData(e,1),d=I[2].getData(e,1);c.set([l[0],u[0],d[0],0,l[1],u[1],d[1],0,l[2],u[2],d[2],0,l[3],u[3],d[3],1])}var f=De.mat4();De.mulMat4(a,c?De.mulMat4(c,A,f):A,f),f[12]+=o[0],f[13]+=o[1],f[14]+=o[2];var p=t?U.getData(t.portionBase,t.portionSize):U.getData();return{indices:r,positions:De.transformPositions3(f,p,new Float64Array(p.length))}},precisionRayPickSurface:function(e,t,r,a,o){var c=s[e].retainedGeometry;if(c){c.matrix&&!c.inverseMatrix&&(c.inverseMatrix=De.inverseMat4(c.matrix,De.mat4())),o&&c.inverseMatrix&&!c.normalMatrix&&(c.normalMatrix=De.transposeMat4(c.inverseMatrix,De.mat4()));var l=c.quantizedPositions,u=c.indices,h=c.offset,d=Ma,f=ka;d.set(i?De.subVec3(t,i,Ea):t),f.set(r),h&&De.subVec3(d,h),De.transformRay(n.worldNormalMatrix,d,f,d,f),c.inverseMatrix&&De.transformRay(c.inverseMatrix,d,f,d,f);for(var p=Fa,v=xa,g=Ua,m=!1,y=0,_=Ia,b=0,w=u.length;b<w;b+=3){var B=3*u[b],C=3*u[b+1],M=3*u[b+2];if(p[0]=l[B],p[1]=l[B+1],p[2]=l[B+2],v[0]=l[C],v[1]=l[C+1],v[2]=l[C+2],g[0]=l[M],g[1]=l[M+1],g[2]=l[M+2],De.decompressPosition(p,A),De.decompressPosition(v,A),De.decompressPosition(g,A),De.rayTriangleIntersect(d,f,p,v,g,_)){c.matrix&&De.transformPoint3(c.matrix,_,_),De.transformPoint3(n.worldMatrix,_,_),h&&De.addVec3(_,h),i&&De.addVec3(_,i);var k=Math.abs(De.lenVec3(De.subVec3(_,t,[])));(!m||k>y)&&(y=k,a.set(_),o&&De.triangleNormal(p,v,g,o),m=!0)}}return m&&o&&(c.normalMatrix&&De.transformVec3(c.normalMatrix,o,o),De.transformVec3(n.worldNormalMatrix,o,o),De.normalizeVec3(o)),m}return!1},layerTextureSet:o,renderers:Xs(l,h?"instancing":"batching",a,n.saoEnabled,n.pbrEnabled&&D&&o&&o.colorTexture&&P&&B&&o.metallicRoughnessTexture,n.colorTextureEnabled&&D&&o&&o.colorTexture,!!P,(function(e){return Va(e,h&&{hasModelNormalMat:!!S},l.entityOffsetsEnabled)})),drawCalls:(Q={},R=function(e){return function(t,r,i){var o=0;Pa.set(n.rotationMatrix,0),Pa.set(i.viewMatrix,o+=16),Pa.set(i.projMatrix,o+=16),Pa.set(A,o+=16),r.needNormal()&&(Pa.set(n.worldNormalMatrix,o+=16),Pa.set(i.viewNormalMatrix,o+=16)),r.matrices.setInputValue(Pa),r.uvDecodeMatrix.setInputValue&&r.uvDecodeMatrix.setInputValue(D.mat),t in Q||(Q[t]=[null,null,null]);var c,l,f=Q[t],p=e?e.vertices?0:1:2;if(!f[p]){var v=u.createVertexArray();u.bindVertexArray(v);var g=function(e,t){e&&e.setInputValue&&t&&e.setInputValue(t)},m=r.attributes;g(m.position,U),g(m.normal,P),g(m.color,b),g(m.pickColor,C),g(m.uV,D&&D.buf),g(m.metallicRoughness,B),g(m.flags,y),g(m.offset,w),m.modelMatrixCol&&m.modelMatrixCol.forEach((function(e,t){return g(e,I[t])})),m.modelNormalMatrixCol&&m.modelNormalMatrixCol.forEach((function(e,t){return g(e,S[t])}));var _=(c=function(){h?u.drawArraysInstanced(u.POINTS,0,U.numItems,s.length):u.drawArrays(u.POINTS,0,U.numItems)},l=function(e,t){t.bindIndicesBuffer();var n=t.indicesCount,r=t.indicesType;return function(){h?u.drawElementsInstanced(e,n,r,0,s.length):u.drawElements(e,n,r,0)}},"points"===a?c:"lines"===a?e&&e.vertices?c:l(u.LINES,F):e&&e.vertices?c:e?M?l(u.LINES,M):function(){}:l(u.TRIANGLES,F));u.bindVertexArray(null),d.push((function(){return u.deleteVertexArray(v)})),f[p]=function(){u.bindVertexArray(v),_(),u.bindVertexArray(null)}}f[p]()}},{drawVertices:R({vertices:!0}),drawEdges:R({}),drawSurface:R(null)}),destroy:function(){d.forEach((function(e){return e()})),d.length=0}}}}]),n}(),Oa=function(e){var t={toString:function(){return t.needed=!0,e}};return t},Va=function(e,t,n){var r,i=e.createAttribute,s={position:i("vec3","positionA"),normal:i("vec3","normalA"),color:i("vec4","colorA"),pickColor:i("vec4","pickColor"),uV:i("vec2","uvApremul"),metallicRoughness:i("vec2","metallicRoughness"),flags:i("float","flagsA"),offset:n&&i("vec3","offset"),modelMatrixCol:t&&Sa(3).map((function(e){return i("vec4","modelMatrixCol"+e)})),modelNormalMatrixCol:t&&t.hasModelNormalMat&&Sa(3).map((function(e){return i("vec4","modelNormalMatrixCol"+e)}))},a=Oa("aUv"),o=Oa("viewNormal"),A=Oa("worldNormal"),c=e.createUniform("mat3","uvDecodeMatrix"),l=function(){return o.needed||A.needed},u=e.createUniformBlock("Matrices",{worldMatrix:"mat4",viewMatrix:"mat4",projMatrix:"mat4",positionsDecodeMatrix:"mat4",worldNormalMatrix:"mat4",viewNormalMatrix:"mat4"});return{dontCullOnAlphaZero:!0,clippableTest:(r=e.createVarying("float","vClippable",(function(){return"".concat("((int(".concat(s.flags,") >> 16 & 0xF) == 1)")," ? 1.0 : 0.0")})),function(){return"".concat(r," != 0.0")}),geometryParameters:{attributes:{color:s.color,flags:Sa(4).map((function(e){return{toString:function(){return"(int(".concat(s.flags,") >> ").concat(4*e," & 0xF)")}}})),metallicRoughness:s.metallicRoughness,normal:{view:o,world:A},pickColor:s.pickColor,position:{clip:"gl_Position",view:"viewPosition",world:"worldPosition"},uv:a},projMatrix:u.projMatrix,viewMatrix:u.viewMatrix},appendVertexData:function(t){a.needed&&t.push("vec2 ".concat(a," = (").concat(c," * vec3(").concat(s.uV,", 1.0)).xy;"));var n=s.modelMatrixCol&&"mat4(".concat(s.modelMatrixCol[0],", ").concat(s.modelMatrixCol[1],", ").concat(s.modelMatrixCol[2],", vec4(0.0,0.0,0.0,1.0))");if(t.push("vec4 worldPosition = ".concat(u.worldMatrix," * (").concat(u.positionsDecodeMatrix," * vec4(").concat(s.position,", 1.0)").concat(n?" * "+n:"",");")),s.offset&&t.push("worldPosition.xyz = worldPosition.xyz + ".concat(s.offset,";")),l()){var r=s.modelNormalMatrixCol&&"* mat4(".concat(s.modelNormalMatrixCol[0],", ").concat(s.modelNormalMatrixCol[1],", ").concat(s.modelNormalMatrixCol[2],", vec4(0.0,0.0,0.0,1.0))");t.push("vec4 modelNormal = vec4(".concat(e.commonLibrary.octDecode,"(").concat(s.normal,".xy), 0.0)").concat(r||"",";")),t.push("vec3 ".concat(A," = (").concat(u.worldNormalMatrix," * modelNormal).xyz;")),o.needed&&t.push("vec3 ".concat(o," = normalize((").concat(u.viewNormalMatrix," * vec4(").concat(A,", 0.0)).xyz);"))}},layerTypeInputs:{attributes:s,matrices:u,uvDecodeMatrix:c,needNormal:l}}},La=function(){function e(t){x(this,e),this.id=t.id,this.colorTexture=t.colorTexture,this.alphaCutoff=t.alphaCutoff,this.metallicRoughnessTexture=t.metallicRoughnessTexture,this.normalsTexture=t.normalsTexture,this.emissiveTexture=t.emissiveTexture,this.occlusionTexture=t.occlusionTexture}return I(e,[{key:"destroy",value:function(){}}]),e}(),Ha=function(){function e(t){x(this,e),this.id=t.id,this.texture=t.texture}return I(e,[{key:"destroy",value:function(){this.texture&&(this.texture.destroy(),this.texture=null)}}]),e}(),Na={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Ga=function(){function e(t,n,r){x(this,e),this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=r}return I(e,[{key:"itemStart",value:function(e){this.itemsTotal++,!1===this.isLoading&&void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}},{key:"itemEnd",value:function(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())}},{key:"itemError",value:function(e){void 0!==this.onError&&this.onError(e)}},{key:"resolveURL",value:function(e){return this.urlModifier?this.urlModifier(e):e}},{key:"setURLModifier",value:function(e){return this.urlModifier=e,this}},{key:"addHandler",value:function(e,t){return this.handlers.push(e,t),this}},{key:"removeHandler",value:function(e){var t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this}},{key:"getHandler",value:function(e){for(var t=0,n=this.handlers.length;t<n;t+=2){var r=this.handlers[t],i=this.handlers[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}]),e}(),ja=new Ga,Wa=function(){function e(t){x(this,e),this.manager=void 0!==t?t:ja,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return I(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),za={},Xa=function(e){m(n,Wa);var t=_(n);function n(e){return x(this,n),t.call(this,e)}return I(n,[{key:"load",value:function(e,t,n,r){var i=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var s=Na.get(e);if(void 0!==s)return this.manager.itemStart(e),tt.scheduleTask((function(){t&&t(s),i.manager.itemEnd(e)}),0),s;if(void 0===za[e]){za[e]=[],za[e].push({onLoad:t,onProgress:n,onError:r});var a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,A=this.responseType;fetch(a).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;var n=za[e],r=t.body.getReader(),i=t.headers.get("Content-Length"),s=i?parseInt(i):0,a=0!==s,o=0,A=new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var i=r.done,A=r.value;if(i)e.close();else{o+=A.byteLength;for(var c=new ProgressEvent("progress",{lengthComputable:a,loaded:o,total:s}),l=0,u=n.length;l<u;l++){var h=n[l];h.onProgress&&h.onProgress(c)}e.enqueue(A),t()}}))}()}});return new Response(A)}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){switch(A){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,o)}));case"json":return e.json();default:if(void 0===o)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(o),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((function(e){return r.decode(e)}))}})).then((function(t){Na.add(e,t);var n=za[e];delete za[e];for(var r=0,i=n.length;r<i;r++){var s=n[r];s.onLoad&&s.onLoad(t)}})).catch((function(t){var n=za[e];if(void 0===n)throw i.manager.itemError(e),t;delete za[e];for(var r=0,s=n.length;r<s;r++){var a=n[r];a.onError&&a.onError(t)}i.manager.itemError(e)})).finally((function(){i.manager.itemEnd(e)})),this.manager.itemStart(e)}else za[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(),Ka=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4;x(this,e),this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}return I(e,[{key:"_initWorker",value:function(e){if(!this.workers[e]){var t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}},{key:"_getIdleWorker",value:function(){for(var e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}},{key:"_onMessage",value:function(e,t){var n=this.workersResolve[e];if(n&&n(t),this.queue.length){var r=this.queue.shift(),i=r.resolve,s=r.msg,a=r.transfer;this.workersResolve[e]=i,this.workers[e].postMessage(s,a)}else this.workerStatus^=1<<e}},{key:"setWorkerCreator",value:function(e){this.workerCreator=e}},{key:"setWorkerLimit",value:function(e){this.pool=e}},{key:"postMessage",value:function(e,t){var n=this;return new Promise((function(r){var i=n._getIdleWorker();-1!==i?(n._initWorker(i),n.workerStatus|=1<<i,n.workersResolve[i]=r,n.workers[i].postMessage(e,t)):n.queue.push({resolve:r,msg:e,transfer:t})}))}},{key:"destroy",value:function(){this.workers.forEach((function(e){return e.terminate()})),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}]),e}(),Za=0,Ja=function(){function e(t){var n=t.viewer,r=t.transcoderPath,i=t.workerLimit;x(this,e),this._transcoderPath=r||"https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/basis/",this._transcoderBinary=null,this._transcoderPending=null,this._workerPool=new Ka,this._workerSourceURL="",i&&this._workerPool.setWorkerLimit(i);var s=n.capabilities;this._workerConfig={astcSupported:s.astcSupported,etc1Supported:s.etc1Supported,etc2Supported:s.etc2Supported,dxtSupported:s.dxtSupported,bptcSupported:s.bptcSupported,pvrtcSupported:s.pvrtcSupported},this._supportedFileTypes=["xkt2"]}return I(e,[{key:"_init",value:function(){var t=this;if(!this._transcoderPending){var n=new Xa;n.setPath(this._transcoderPath),n.setWithCredentials(this.withCredentials);var r=n.loadAsync("basis_transcoder.js"),i=new Xa;i.setPath(this._transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);var s=i.loadAsync("basis_transcoder.wasm");this._transcoderPending=Promise.all([r,s]).then((function(n){var r=k(n,2),i=r[0],s=r[1],a=e.BasisWorker.toString(),o=["/* constants */","let _EngineFormat = "+JSON.stringify(e.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(e.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(e.BasisFormat),"/* basis_transcoder.js */",i,"/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join("\n");t._workerSourceURL=URL.createObjectURL(new Blob([o])),t._transcoderBinary=s,t._workerPool.setWorkerCreator((function(){var e=new Worker(t._workerSourceURL),n=t._transcoderBinary.slice(0);return e.postMessage({type:"init",config:t._workerConfig,transcoderBinary:n},[n]),e}))})),Za>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),Za++}return this._transcoderPending}},{key:"transcode",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new Promise((function(i,s){var a=r;n._init().then((function(){return n._workerPool.postMessage({type:"transcode",buffers:e,taskConfig:a},e)})).then((function(e){var n=e.data,r=n.mipmaps,a=(n.width,n.height,n.format),o=n.type,A=n.error,c=n.dfdTransferFn,l=n.dfdFlags;if("error"===o)return s(A);t.setCompressedData({mipmaps:r,props:{format:a,minFilter:1===r.length?1006:1008,magFilter:1===r.length?1006:1008,encoding:2===c?3001:3e3,premultiplyAlpha:!!(1&l)}}),i()}))}))}},{key:"destroy",value:function(){URL.revokeObjectURL(this._workerSourceURL),this._workerPool.destroy(),Za--}}]),e}();Ja.BasisFormat={ETC1S:0,UASTC_4x4:1},Ja.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ja.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Ja.BasisWorker=function(){var e,t,n,r=_EngineFormat,i=_TranscoderFormat,s=_BasisFormat;self.addEventListener("message",(function(a){var l,u=a.data;switch(u.type){case"init":e=u.config,l=u.transcoderBinary,t=new Promise((function(e){n={wasmBinary:l,onRuntimeInitialized:e},BASIS(n)})).then((function(){n.initializeBasis(),void 0===n.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((function(){try{for(var t=function(t){var a=new n.KTX2File(new Uint8Array(t));function l(){a.close(),a.delete()}if(!a.isValid())throw l(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");var u=a.isUASTC()?s.UASTC_4x4:s.ETC1S,h=a.getWidth(),d=a.getHeight(),f=a.getLevels(),p=a.getHasAlpha(),v=a.getDFDTransferFunc(),g=a.getDFDFlags(),m=function(t,n,a,l){for(var u,h,d=t===s.ETC1S?o:A,f=0;f<d.length;f++){var p=d[f];if(e[p.if]&&(p.basisFormat.includes(t)&&!(l&&p.transcoderFormat.length<2)&&(!p.needsPowerOfTwo||c(n)&&c(a))))return{transcoderFormat:u=p.transcoderFormat[l?1:0],engineFormat:h=p.engineFormat[l?1:0]}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),u=i.RGBA32,h=r.RGBAFormat,{transcoderFormat:u,engineFormat:h}}(u,h,d,p),y=m.transcoderFormat,_=m.engineFormat;if(!h||!d||!f)throw l(),new Error("KTX2TextureTranscoder: Invalid texture");if(!a.startTranscoding())throw l(),new Error("KTX2TextureTranscoder: .startTranscoding failed");for(var b=[],w=0;w<f;w++){var B=a.getImageLevelInfo(w,0,0),C=B.origWidth,M=B.origHeight,k=new Uint8Array(a.getImageTranscodedSizeInBytes(w,0,0,y));if(!a.transcodeImage(k,w,0,0,y,0,-1,-1))throw l(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");b.push({data:k,width:C,height:M})}return l(),{width:h,height:d,hasAlpha:p,mipmaps:b,format:_,dfdTransferFn:v,dfdFlags:g}}(u.buffers[0]),a=t.width,l=t.height,h=t.hasAlpha,d=t.mipmaps,f=t.format,p=t.dfdTransferFn,v=t.dfdFlags,g=[],m=0;m<d.length;++m)g.push(d[m].data.buffer);self.postMessage({type:"transcode",id:u.id,width:a,height:l,hasAlpha:h,mipmaps:d,format:f,dfdTransferFn:p,dfdFlags:v},g)}catch(e){console.error("[KTX2TextureTranscoder.BasisWorker]: ".concat(e)),self.postMessage({type:"error",id:u.id,error:e.message})}}))}}));var a=[{if:"astcSupported",basisFormat:[s.UASTC_4x4],transcoderFormat:[i.ASTC_4x4,i.ASTC_4x4],engineFormat:[r.RGBA_ASTC_4x4_Format,r.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC7_M5,i.BC7_M5],engineFormat:[r.RGBA_BPTC_Format,r.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.BC1,i.BC3],engineFormat:[r.RGB_S3TC_DXT1_Format,r.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1,i.ETC2],engineFormat:[r.RGB_ETC2_Format,r.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.ETC1],engineFormat:[r.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[s.ETC1S,s.UASTC_4x4],transcoderFormat:[i.PVRTC1_4_RGB,i.PVRTC1_4_RGBA],engineFormat:[r.RGB_PVRTC_4BPPV1_Format,r.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=a.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),A=a.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function c(e){return e<=2||0==(e&e-1)&&0!==e}};var Ya={};function qa(e){var t=e.scene.id,n=Ya[t];return n||(n=new Ja({viewer:e}),Ya[t]=n,e.scene.on("destroyed",(function(){delete Ya[t],n.destroy()}))),n}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 *
 * This file takes a geometry given by { positionsCompressed, indices }, and returns
 * equivalent { positionsCompressed, indices } arrays but which only contain unique
 * positionsCompressed.
 *
 * The time is O(N logN) with the number of positionsCompressed due to a pre-sorting
 * step, but is much more GC-friendly and actually faster than the classic O(N)
 * approach based in keeping a hash-based LUT to identify unique positionsCompressed.
 */var $a=null;function eo(e,t){for(var n,r=0;r<3;r++)if(0!=(n=$a[3*e+r]-$a[3*t+r]))return n;return 0}var to=null;function no(e){var t=e.positionsCompressed,n=e.indices,r=e.edgeIndices;!function(e){if(!(null!==to&&to.length>=e)){to=new Uint32Array(e);for(var t=0;t<e;t++)to[t]=t}}(t.length/3);var i=to.slice(0,t.length/3),s=to.slice(0,t.length/3);$a=t,i.sort(eo);var a=0;s[i[0]]=0;for(var o=1,A=i.length;o<A;o++)0!==eo(i[o],i[o-1])&&a++,s[i[o]]=a;var c=new Uint16Array(3*(a+1));c[3*(a=0)+0]=t[3*i[0]+0],c[3*a+1]=t[3*i[0]+1],c[3*a+2]=t[3*i[0]+2];for(var l=1,u=i.length;l<u;l++)0!==eo(i[l],i[l-1])&&(c[3*++a+0]=t[3*i[l]+0],c[3*a+1]=t[3*i[l]+1],c[3*a+2]=t[3*i[l]+2]),s[i[l]]=a;$a=null;for(var h=new Uint32Array(n.length),d=0,f=n.length;d<f;d++)h[d]=s[n[d]];for(var p=new Uint32Array(r.length),v=0,g=r.length;v<g;v++)p[v]=s[r[v]];return[c,h,p]}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 **/var ro=null;function io(e,t){var n,r,i,s,a,o,A=3*e,c=3*t,l=Math.min(n=ro[A],r=ro[A+1],i=ro[A+2]),u=Math.min(s=ro[c],a=ro[c+1],o=ro[c+2]);if(l!==u)return l-u;var h=Math.max(n,r,i),d=Math.max(s,a,o);return h!==d?h-d:0}function so(e,t){for(var n=new Int32Array(e.length/3),r=0,i=n.length;r<i;r++)n[r]=r;ro=new Int32Array(e.length);for(var s=0,a=e.length;s<a;s++)ro[s]=e[s]>>t;n.sort(io);for(var o=new Int32Array(e.length),A=0,c=n.length;A<c;A++)o[3*A+0]=e[3*n[A]+0],o[3*A+1]=e[3*n[A]+1],o[3*A+2]=e[3*n[A]+2];return o}var ao=null;function oo(e,t){var n=ao[2*e]-ao[2*t];return 0!==n?n:ao[2*e+1]-ao[2*t+1]}function Ao(e){if(0===(e||[]).length)return[];for(var t=new Int32Array(e.length/2),n=0,r=t.length;n<r;n++)t[n]=n;for(var i=0,s=e.length;i<s;i+=2)if(e[i]>e[i+1]){var a=e[i];e[i]=e[i+1],e[i+1]=a}ao=new Int32Array(e),t.sort(oo);for(var o=new Int32Array(e.length),A=0,c=t.length;A<c;A++)o[2*A+0]=e[2*t[A]+0],o[2*A+1]=e[2*t[A]+1];return o}function co(e,t){var n={},r={};e.forEach((function(e){for(var t=e.indices,i=e.edgeIndices,s=e.positionsCompressed,a=0,o=t.length;a<o;a+=3){var A=s[3*t[a]]+"_"+s[3*t[a]+1]+"_"+s[3*t[a]+2]+"/"+s[3*t[a+1]]+"_"+s[3*t[a+1]+1]+"_"+s[3*t[a+1]+2]+"/"+s[3*t[a+2]]+"_"+s[3*t[a+2]+1]+"_"+s[3*t[a+2]+2];n[A]=!0}e.edgeIndices.length/2;for(var c=0,l=i.length;c<l;c+=2){var u=s[3*i[c]]+"_"+s[3*i[c]+1]+"_"+s[3*i[c]+2]+"/"+s[3*i[c+1]]+"_"+s[3*i[c+1]+1]+"_"+s[3*i[c+1]+2]+"/";r[u]=!0}}));var i=t.indices;t.edgeIndices;for(var s=t.positionsCompressed,a=0,o=i.length;a<o;a+=3){var A=s[3*i[a]]+"_"+s[3*i[a]+1]+"_"+s[3*i[a]+2]+"/"+s[3*i[a+1]]+"_"+s[3*i[a+1]+1]+"_"+s[3*i[a+1]+2]+"/"+s[3*i[a+2]]+"_"+s[3*i[a+2]+1]+"_"+s[3*i[a+2]+2];if(!(A in n))throw console.log("Not found "+A),"Ohhhh!"}}var lo=new Float32Array([0,0,0]),uo=new Uint16Array([0,0,0]);De.OBB3();var ho=function(){function e(t,n,r,i,s,a){x(this,e),this._isObject=n,this.scene=t.scene,this.model=t,this.isSceneModelEntity=!0,this.meshes=i,this._numPrimitives=0,this._capMaterial=null;for(var o=0,A=this.meshes.length;o<A;o++){var c=this.meshes[o];c.parent=this,c.entity=this,this._numPrimitives+=c.numPrimitives}this.id=r,this.originalSystemId=De.unglobalizeObjectId(t.id,r),this._flags=s,this._aabb=De.AABB3(),this._aabbDirty=!0,this._offset=De.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._lodCullable=!!a,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1,this._isObject&&t.scene._registerObject(this)}return I(e,[{key:"_transformDirty",value:function(){this._aabbDirty=!0,this.model._transformDirty()}},{key:"_sceneModelDirty",value:function(){this._aabbDirty=!0;for(var e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._sceneModelDirty()}},{key:"aabb",get:function(){if(this._aabbDirty){De.collapseAABB3(this._aabb);for(var e=0,t=this.meshes.length;e<t;e++)De.expandAABB3(this._aabb,this.meshes[e].aabb);this._aabbDirty=!1}return this._aabb}},{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return!1}},{key:"isObject",get:function(){return this._isObject}},{key:"numPrimitives",get:function(){return this._numPrimitives}},{key:"numTriangles",get:function(){return this._numPrimitives}},{key:"visible",get:function(){return this._getFlag(vs)},set:function(e){if(!!(this._flags&vs)!==e){this._flags=e?this._flags|vs:this._flags&~vs;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}},{key:"highlighted",get:function(){return this._getFlag(ws)},set:function(e){if(!!(this._flags&ws)!==e){this._flags=e?this._flags|ws:this._flags&~ws;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}},{key:"xrayed",get:function(){return this._getFlag(bs)},set:function(e){if(!!(this._flags&bs)!==e){this._flags=e?this._flags|bs:this._flags&~bs;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}},{key:"selected",get:function(){return this._getFlag(Bs)},set:function(e){if(!!(this._flags&Bs)!==e){this._flags=e?this._flags|Bs:this._flags&~Bs;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}},{key:"edges",get:function(){return this._getFlag(Cs)},set:function(e){if(!!(this._flags&Cs)!==e){this._flags=e?this._flags|Cs:this._flags&~Cs;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}},{key:"culledVFC",get:function(){return!!this._culledVFC},set:function(e){this._culledVFC=e,this._setCulled()}},{key:"culledLOD",get:function(){return!!this._culledLOD},set:function(e){this._culledLOD=e,this._setCulled()}},{key:"culled",get:function(){return!!this._culled},set:function(e){this._culled=e,this._setCulled()}},{key:"_setCulled",value:function(){var e=!!this._culled||!(!this._culledLOD||!this._lodCullable)||!!this._culledVFC;if(!!(this._flags&gs)!==e){this._flags=e?this._flags|gs:this._flags&~gs;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}},{key:"clippable",get:function(){return this._getFlag(ys)},set:function(e){if(!!(this._flags&ys)!==e){this._flags=e?this._flags|ys:this._flags&~ys;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}},{key:"collidable",get:function(){return this._getFlag(_s)},set:function(e){if(!!(this._flags&_s)!==e){this._flags=e?this._flags|_s:this._flags&~_s;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setCollidable(this._flags)}}},{key:"pickable",get:function(){return this._getFlag(ms)},set:function(e){if(!!(this._flags&ms)!==e){this._flags=e?this._flags|ms:this._flags&~ms;for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setPickable(this._flags)}}},{key:"colorize",get:function(){if(0===this.meshes.length)return null;var e=this.meshes[0]._colorize;return lo[0]=e[0]/255,lo[1]=e[1]/255,lo[2]=e[2]/255,lo},set:function(e){if(e){uo[0]=Math.floor(255*e[0]),uo[1]=Math.floor(255*e[1]),uo[2]=Math.floor(255*e[2]);for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setColorize(uo)}else for(var r=0,i=this.meshes.length;r<i;r++)this.meshes[r]._setColorize(null);if(this._isObject){var s=!!e;this.scene._objectColorizeUpdated(this,s),this._colorizeUpdated=s}this.model.glRedraw()}},{key:"opacity",get:function(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1},set:function(e){if(0!==this.meshes.length){var t=null!=e,n=this.meshes[0]._colorize[3],r=255;if(t){if(e<0?e=0:e>1&&(e=1),n===(r=Math.floor(255*e)))return}else if(n===(r=255))return;for(var i=0,s=this.meshes.length;i<s;i++)this.meshes[i]._setOpacity(r,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}}},{key:"offset",get:function(){return this._offset},set:function(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._setOffset(this._offset);this._aabbDirty=!0,this.model._aabbDirty=!0,this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model.glRedraw()}},{key:"saoEnabled",get:function(){return this.model.saoEnabled}},{key:"capMaterial",get:function(){return this._capMaterial},set:function(e){if(!this.scene.readableGeometryEnabled)throw"The `capMaterial` assignment requires `Viewer::readableGeometryEnabled` to be `true`";this._capMaterial=e,this.scene._sectionCaps._onCapMaterialUpdated(this)}},{key:"getEachVertex",value:function(e){for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t].getEachVertex(e)}},{key:"getEachIndex",value:function(e){for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t].getEachIndex(e)}},{key:"getGeometryData",value:function(){for(var e=0,t=[],n=[],r=0,i=this.meshes.length;r<i;r++){var s=this.meshes[r];if(s.layer.readGeometryData){for(var a=s.layer.readGeometryData(s.portionId),o=0,A=a.indices.length;o<A;o++)n.push(a.indices[o]+e);for(var c=0,l=a.positions.length;c<l;c++)t.push(a.positions[c]);e+=a.positions.length/3}}return{indices:n,positions:t}}},{key:"volume",get:function(){for(var e=0,t=0,n=this.meshes.length;t<n;t++){var r=this.meshes[t].volume;if(r<0)return-1;e+=r}return e}},{key:"surfaceArea",get:function(){for(var e=0,t=0,n=this.meshes.length;t<n;t++){var r=this.meshes[t].surfaceArea;r>=0&&(e+=r)}return e>0?e:-1}},{key:"_getFlag",value:function(e){return!!(this._flags&e)}},{key:"_finalize",value:function(){var e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._finalize(this._flags)}},{key:"_finalize2",value:function(){for(var e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}},{key:"_destroy",value:function(){var e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._deRegisterVisibleObject(this),this.xrayed&&e._deRegisterXRayedObject(this),this.selected&&e._deRegisterSelectedObject(this),this.highlighted&&e._deRegisterHighlightedObject(this),this._colorizeUpdated&&this.scene._deRegisterColorizedObject(this),this._opacityUpdated&&this.scene._deRegisterOpacityObject(this),!this._offset||0===this._offset[0]&&0===this._offset[1]&&0===this._offset[2]||this.scene._deRegisterOffsetObject(this));for(var t=0,n=this.meshes.length;t<n;t++)this.meshes[t]._destroy();e._aabbDirty=!0}}]),e}(),fo=De.vec4(4),po=De.vec4(),vo=De.vec4(),go=De.vec3([1,0,0]),mo=De.vec3([0,1,0]),yo=De.vec3([0,0,1]);De.vec3(3),De.vec3(3);var _o=De.identityMat4(),bo=function(){function e(t){x(this,e),this._model=t.model,this.id=t.id,this._parentTransform=t.parent,this._childTransforms=[],this._meshes=[],this._scale=new Float32Array([1,1,1]),this._quaternion=De.identityQuaternion(new Float32Array(4)),this._rotation=new Float32Array(3),this._position=new Float32Array(3),this._localMatrix=De.identityMat4(new Float32Array(16)),this._worldMatrix=De.identityMat4(new Float32Array(16)),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),t.parent&&t.parent._addChildTransform(this)}return I(e,[{key:"_addChildTransform",value:function(e){this._childTransforms.push(e),e._parentTransform=this,e._transformDirty(),e._setSubtreeAABBsDirty(this)}},{key:"_addMesh",value:function(e){this._meshes.push(e),e.transform=this}},{key:"parentTransform",get:function(){return this._parentTransform}},{key:"meshes",get:function(){return this._meshes}},{key:"position",get:function(){return this._position},set:function(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._model.glRedraw()}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation.set(e||[0,0,0]),De.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._model.glRedraw()}},{key:"quaternion",get:function(){return this._quaternion},set:function(e){this._quaternion.set(e||[0,0,0,1]),De.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._model.glRedraw()}},{key:"scale",get:function(){return this._scale},set:function(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._model.glRedraw()}},{key:"matrix",get:function(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=De.identityMat4()),De.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix},set:function(e){this._localMatrix||(this._localMatrix=De.identityMat4()),this._localMatrix.set(e||_o),De.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._transformDirty(),this._model.glRedraw()}},{key:"worldMatrix",get:function(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}},{key:"rotate",value:function(e,t){return fo[0]=e[0],fo[1]=e[1],fo[2]=e[2],fo[3]=t*De.DEGTORAD,De.angleAxisToQuaternion(fo,po),De.mulQuaternions(this.quaternion,po,vo),this.quaternion=vo,this._setLocalMatrixDirty(),this._model.glRedraw(),this}},{key:"rotateOnWorldAxis",value:function(e,t){return fo[0]=e[0],fo[1]=e[1],fo[2]=e[2],fo[3]=t*De.DEGTORAD,De.angleAxisToQuaternion(fo,po),De.mulQuaternions(po,this.quaternion,po),this}},{key:"rotateX",value:function(e){return this.rotate(go,e)}},{key:"rotateY",value:function(e){return this.rotate(mo,e)}},{key:"rotateZ",value:function(e){return this.rotate(yo,e)}},{key:"translate",value:function(e){return this._position[0]+=e[0],this._position[1]+=e[1],this._position[2]+=e[2],this._setLocalMatrixDirty(),this._model.glRedraw(),this}},{key:"translateX",value:function(e){return this._position[0]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}},{key:"translateY",value:function(e){return this._position[1]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}},{key:"translateZ",value:function(e){return this._position[2]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}},{key:"_setLocalMatrixDirty",value:function(){this._localMatrixDirty=!0,this._transformDirty()}},{key:"_transformDirty",value:function(){this._worldMatrixDirty=!0;for(var e=0,t=this._childTransforms.length;e<t;e++){var n=this._childTransforms[e];if(n._transformDirty(),n._meshes&&n._meshes.length>0)for(var r=n._meshes,i=0,s=r.length;i<s;i++)r[i]._transformDirty()}if(this._meshes&&this._meshes.length>0)for(var a=this._meshes,o=0,A=a.length;o<A;o++)a[o]._transformDirty()}},{key:"_buildWorldMatrix",value:function(){var e=this.matrix;if(this._parentTransform)De.mulMat4(this._parentTransform.worldMatrix,e,this._worldMatrix);else for(var t=0,n=e.length;t<n;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}},{key:"_setSubtreeAABBsDirty",value:function(e){if(e._aabbDirty=!0,e._childTransforms)for(var t=0,n=e._childTransforms.length;t<n;t++)this._setSubtreeAABBsDirty(e._childTransforms[t])}}]),e}(),wo=De.vec3(),Bo=De.OBB3(),Co=De.vec4(),Mo=De.vec3([1,1,1]),ko=De.vec3([0,0,0]);De.vec3([0,0,0]);var Eo=De.identityQuaternion(),Fo=De.identityMat4(),xo=new Uint8Array([255,255,255]),Uo=function(e){m(n,it);var t=_(n);function n(e){var r,i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(i=t.call(this,e,s)).renderOrder=s.renderOrder||0,i._dtxEnabled=i.scene.dtxEnabled&&!1!==s.dtxEnabled,i._enableVertexWelding=!1,i._enableIndexBucketing=!1,i._textureTranscoder=s.textureTranscoder||qa(i.scene.viewer),i._maxGeometryBatchSize=null!==(r=s.maxGeometryBatchSize)&&void 0!==r?r:5e6,i._aabb=De.collapseAABB3(),i._aabbDirty=!0,i._quantizationRanges={},i._vboLayers={},i._dtxLayers={},i._meshList=[],i.layerList=[],i._layersToFinalize=[],i._entityList=[],i._entitiesToFinalize=[],i._geometries={},i._dtxBuckets={},i._textures={},i._textureSets={},i._transforms={},i._meshes={},i._unusedMeshes={},i._entities={},i.renderFlags=new ri,i.numGeometries=0,i.numPortions=0,i.numVisibleLayerPortions=0,i.numTransparentLayerPortions=0,i.numXRayedLayerPortions=0,i.numHighlightedLayerPortions=0,i.numSelectedLayerPortions=0,i.numEdgesLayerPortions=0,i.numPickableLayerPortions=0,i.numClippableLayerPortions=0,i.numCulledLayerPortions=0,i.numEntities=0,i._numTriangles=0,i._numLines=0,i._numPoints=0,i._layersFinalized=!1,i._edgeThreshold=s.edgeThreshold||10,i._origin=De.vec3(s.origin||[0,0,0]),i._position=De.vec3(s.position||[0,0,0]),i._rotation=De.vec3(s.rotation||[0,0,0]),i._quaternion=De.vec4(s.quaternion||[0,0,0,1]),i._conjugateQuaternion=De.vec4(s.quaternion||[0,0,0,1]),s.rotation&&De.eulerToQuaternion(i._rotation,"XYZ",i._quaternion),i._scale=De.vec3(s.scale||[1,1,1]),i._worldRotationMatrix=De.mat4(),i._worldRotationMatrixConjugate=De.mat4(),i._matrix=De.mat4(),i._matrixDirty=!0,i._rebuildMatrices(),i._worldNormalMatrix=De.mat4(),De.inverseMat4(i._matrix,i._worldNormalMatrix),De.transposeMat4(i._worldNormalMatrix),(s.matrix||s.position||s.rotation||s.scale||s.quaternion)&&(i._viewMatrix=De.mat4(),i._viewNormalMatrix=De.mat4(),i._viewMatrixDirty=!0,i._matrixNonIdentity=!0),i._opacity=1,i._colorize=[1,1,1],i._saoEnabled=!1!==s.saoEnabled,i._pbrEnabled=!1!==s.pbrEnabled,i._colorTextureEnabled=!1!==s.colorTextureEnabled,i._isModel=s.isModel,i._isModel&&i.scene._registerModel(w(i)),i._onCameraViewMatrix=i.scene.camera.on("matrix",(function(){i._viewMatrixDirty=!0})),i._meshesWithDirtyMatrices=[],i._numMeshesWithDirtyMatrices=0,i._onTick=i.scene.on("tick",(function(){for(;i._numMeshesWithDirtyMatrices>0;)i._meshesWithDirtyMatrices[--i._numMeshesWithDirtyMatrices]._updateMatrix()}));var a=function(e,t){return i._textures[e]=new Ha({id:e,texture:new ki({gl:i.scene.canvas.gl,preloadColor:t})})};return i._textureSets.defaultTextureSet=new La({id:"defaultTextureSet",colorTexture:a("defaultColorTexture",[1,1,1,1]),metallicRoughnessTexture:a("defaultMetalRoughTexture",[0,1,1,1]),normalsTexture:a("defaultNormalsTexture",[0,0,0,0]),emissiveTexture:a("defaultEmissiveTexture",[0,0,0,1]),occlusionTexture:a("defaultOcclusionTexture",[1,1,1,1])}),i.visible=s.visible,i.culled=s.culled,i.pickable=s.pickable,i.clippable=s.clippable,i.collidable=s.collidable,i.castsShadow=s.castsShadow,i.receivesShadow=s.receivesShadow,i.xrayed=s.xrayed,i.highlighted=s.highlighted,i.selected=s.selected,i.edges=s.edges,i.colorize=s.colorize,i.opacity=s.opacity,i.backfaces=s.backfaces,i}return I(n,[{key:"_meshMatrixDirty",value:function(e){this._meshesWithDirtyMatrices[this._numMeshesWithDirtyMatrices++]=e}},{key:"isPerformanceModel",get:function(){return!0}},{key:"transforms",get:function(){return this._transforms}},{key:"textures",get:function(){return this._textures}},{key:"textureSets",get:function(){return this._textureSets}},{key:"meshes",get:function(){return this._meshes}},{key:"objects",get:function(){return this._entities}},{key:"origin",get:function(){return this._origin}},{key:"position",get:function(){return this._position},set:function(e){this._position.set(e||[0,0,0]),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}},{key:"rotation",get:function(){return this._rotation},set:function(e){this._rotation.set(e||[0,0,0]),De.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}},{key:"quaternion",get:function(){return this._quaternion},set:function(e){this._quaternion.set(e||[0,0,0,1]),De.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}},{key:"scale",get:function(){return this._scale},set:function(e){}},{key:"matrix",get:function(){return this._rebuildMatrices(),this._matrix},set:function(e){this._matrix.set(e||Fo),De.decomposeMat4(this._matrix,this._position,this._quaternion,this._scale),De.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._matrixDirty=!1,this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}},{key:"rotationMatrix",get:function(){return this._rebuildMatrices(),this._worldRotationMatrix}},{key:"_rebuildMatrices",value:function(){this._matrixDirty&&(De.quaternionToRotationMat4(this._quaternion,this._worldRotationMatrix),De.conjugateQuaternion(this._quaternion,this._conjugateQuaternion),De.quaternionToRotationMat4(this._conjugateQuaternion,this._worldRotationMatrixConjugate),De.scaleMat4v(this._scale,this._worldRotationMatrix),De.scaleMat4v(this._scale,this._worldRotationMatrixConjugate),this._matrix.set(this._worldRotationMatrix),De.translateMat4v(this._position,this._matrix),this._matrixDirty=!1,this._viewMatrixDirty=!0)}},{key:"rotationMatrixConjugate",get:function(){return this._rebuildMatrices(),this._worldRotationMatrixConjugate}},{key:"_setWorldMatrixDirty",value:function(){this._matrixDirty=!0,this._aabbDirty=!0}},{key:"_transformDirty",value:function(){this._matrixDirty=!0,this._aabbDirty=!0,this.scene._aabbDirty=!0}},{key:"_sceneModelDirty",value:function(){this.scene._aabbDirty=!0,this._aabbDirty=!0,this.scene._aabbDirty=!0,this._matrixDirty=!0;for(var e=0,t=this._entityList.length;e<t;e++)this._entityList[e]._sceneModelDirty()}},{key:"worldMatrix",get:function(){return this.matrix}},{key:"worldNormalMatrix",get:function(){return this._worldNormalMatrix}},{key:"_rebuildViewMatrices",value:function(){this._rebuildMatrices(),this._viewMatrixDirty&&(De.mulMat4(this.scene.camera.viewMatrix,this._matrix,this._viewMatrix),De.inverseMat4(this._viewMatrix,this._viewNormalMatrix),De.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1)}},{key:"viewMatrix",get:function(){return this._viewMatrix?(this._rebuildViewMatrices(),this._viewMatrix):this.scene.camera.viewMatrix}},{key:"viewNormalMatrix",get:function(){return this._viewNormalMatrix?(this._rebuildViewMatrices(),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}},{key:"backfaces",get:function(){return this._backfaces},set:function(e){e=!!e,this._backfaces=e,this.glRedraw()}},{key:"entityList",get:function(){return this._entityList}},{key:"isEntity",get:function(){return!0}},{key:"isModel",get:function(){return this._isModel}},{key:"isObject",get:function(){return!1}},{key:"aabb",get:function(){if(this._aabbDirty){De.collapseAABB3(this._aabb);for(var e=0,t=this._entityList.length;e<t;e++)De.expandAABB3(this._aabb,this._entityList[e].aabb);this._aabbDirty=!1}return this._aabb}},{key:"numTriangles",get:function(){return this._numTriangles}},{key:"numLines",get:function(){return this._numLines}},{key:"numPoints",get:function(){return this._numPoints}},{key:"visible",get:function(){return this.numVisibleLayerPortions>0},set:function(e){e=!1!==e,this._visible=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].visible=e;this.glRedraw()}},{key:"xrayed",get:function(){return this.numXRayedLayerPortions>0},set:function(e){e=!!e,this._xrayed=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].xrayed=e;this.glRedraw()}},{key:"highlighted",get:function(){return this.numHighlightedLayerPortions>0},set:function(e){e=!!e,this._highlighted=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].highlighted=e;this.glRedraw()}},{key:"selected",get:function(){return this.numSelectedLayerPortions>0},set:function(e){e=!!e,this._selected=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].selected=e;this.glRedraw()}},{key:"edges",get:function(){return this.numEdgesLayerPortions>0},set:function(e){e=!!e,this._edges=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].edges=e;this.glRedraw()}},{key:"culled",get:function(){return this._culled},set:function(e){e=!!e,this._culled=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].culled=e;this.glRedraw()}},{key:"clippable",get:function(){return this._clippable},set:function(e){e=!1!==e,this._clippable=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].clippable=e;this.glRedraw()}},{key:"collidable",get:function(){return this._collidable},set:function(e){e=!1!==e,this._collidable=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].collidable=e}},{key:"pickable",get:function(){return this.numPickableLayerPortions>0},set:function(e){e=!1!==e,this._pickable=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].pickable=e}},{key:"colorize",get:function(){return this._colorize},set:function(e){this._colorize=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].colorize=e}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity=e;for(var t=0,n=this._entityList.length;t<n;t++)this._entityList[t].opacity=e}},{key:"castsShadow",get:function(){return this._castsShadow},set:function(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}},{key:"receivesShadow",get:function(){return this._receivesShadow},set:function(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}},{key:"saoEnabled",get:function(){return this._saoEnabled}},{key:"pbrEnabled",get:function(){return this._pbrEnabled}},{key:"colorTextureEnabled",get:function(){return this._colorTextureEnabled}},{key:"isDrawable",get:function(){return!0}},{key:"isStateSortable",get:function(){return!1}},{key:"xrayMaterial",get:function(){return this.scene.xrayMaterial}},{key:"highlightMaterial",get:function(){return this.scene.highlightMaterial}},{key:"selectedMaterial",get:function(){return this.scene.selectedMaterial}},{key:"edgeMaterial",get:function(){return this.scene.edgeMaterial}},{key:"getPickViewMatrix",value:function(e){return this._viewMatrix?this._viewMatrix:e}},{key:"createQuantizationRange",value:function(e){void 0!==e.id&&null!==e.id?e.aabb?this.error("[createQuantizationRange] Config missing: aabb"):this._quantizationRanges[e.id]?this.error("[createQuantizationRange] QuantizationRange already created: "+e.id):this._quantizationRanges[e.id]={id:e.id,aabb:e.aabb,matrix:fa(e.aabb,De.mat4())}:this.error("[createQuantizationRange] Config missing: id")}},{key:"_createDefaultIndices",value:function(e){for(var t=[],n=0;n<e;n++)t.push(n);return t}},{key:"createGeometry",value:function(e){if(void 0!==e.id&&null!==e.id)if(this._geometries[e.id])this.error("[createGeometry] Geometry already created: "+e.id);else if(void 0!==e.primitive&&null!==e.primitive||(e.primitive="triangles"),"points"===e.primitive||"lines"===e.primitive||"triangles"===e.primitive||"solid"===e.primitive||"surface"===e.primitive){if(!e.positions&&!e.positionsCompressed&&!e.buckets)return this.error("[createGeometry] Param expected: `positions`,  `positionsCompressed' or 'buckets"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix&&!e.positionsDecodeBoundary)return this.error("[createGeometry] Param expected: `positionsDecodeMatrix` or 'positionsDecodeBoundary' (required for `positionsCompressed')"),null;if(e.positionsDecodeMatrix&&e.positionsDecodeBoundary)return this.error("[createGeometry] Only one of these params expected: `positionsDecodeMatrix` or 'positionsDecodeBoundary' (required for `positionsCompressed')"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("[createGeometry] Param expected: `uvDecodeMatrix` (required for `uvCompressed')"),null;if(e.buckets||e.indices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.indices=this._createDefaultIndices((e.positions||e.positionsCompressed).length/3)),!e.buckets&&!e.indices&&"points"!==e.primitive)return this.error("[createGeometry] Param expected: indices (required for '".concat(e.primitive,"' primitive type)")),null;if(e.positionsDecodeBoundary&&(e.positionsDecodeMatrix=fa(e.positionsDecodeBoundary,De.mat4())),e.positions){var t=De.collapseAABB3();e.positionsDecodeMatrix=De.mat4(),De.expandAABB3Points3(t,e.positions),e.positionsCompressed=da(e.positions,t,e.positionsDecodeMatrix),e.aabb=t}else if(e.positionsCompressed){var n=De.collapseAABB3();e.positionsDecodeMatrix=new Float64Array(e.positionsDecodeMatrix),e.positionsCompressed=new Uint16Array(e.positionsCompressed),De.expandAABB3Points3(n,e.positionsCompressed),Nt.decompressAABB(n,e.positionsDecodeMatrix),e.aabb=n}else if(e.buckets){var r=De.collapseAABB3();this._dtxBuckets[e.id]=e.buckets;for(var i=0,s=e.buckets.length;i<s;i++){var a=e.buckets[i];a.positions?De.expandAABB3Points3(r,a.positions):a.positionsCompressed&&De.expandAABB3Points3(r,a.positionsCompressed)}e.positionsDecodeMatrix&&Nt.decompressAABB(r,e.positionsDecodeMatrix),e.aabb=r}if(e.colorsCompressed&&e.colorsCompressed.length>0)e.colorsCompressed=new Uint8Array(e.colorsCompressed);else if(e.colors&&e.colors.length>0){for(var o=e.colors,A=new Uint8Array(o.length),c=0,l=o.length;c<l;c++)A[c]=255*o[c];e.colorsCompressed=A}if(e.buckets||e.edgeIndices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.positions?e.edgeIndices=Pt(e.positions,e.indices,null,5):e.edgeIndices=Pt(e.positionsCompressed,e.indices,e.positionsDecodeMatrix,2)),e.uv){var u=Nt.getUVBounds(e.uv),h=Nt.compressUVs(e.uv,u.min,u.max);e.uvCompressed=h.quantized,e.uvDecodeMatrix=h.decodeMatrix}else e.uvCompressed&&(e.uvCompressed=new Uint16Array(e.uvCompressed),e.uvDecodeMatrix=new Float64Array(e.uvDecodeMatrix));e.normals&&(e.normals=null),this._geometries[e.id]=e,this._numTriangles+=e.indices?Math.round(e.indices.length/3):0,this.numGeometries++}else this.error("[createGeometry] Unsupported value for 'primitive': '".concat(e.primitive,"' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'."));else this.error("[createGeometry] Config missing: id")}},{key:"createTexture",value:function(e){var t=this,n=e.id;if(null!=n)if(this._textures[n])this.error("[createTexture] Texture already created: "+n);else{if(!e.src&&!e.image&&!e.buffers)return this.error("[createTexture] Param expected: `src`, `image' or 'buffers'"),null;var r=e.minFilter||1008;1006!==r&&1007!==r&&1008!==r&&1005!==r&&1004!==r&&(this.error("[createTexture] Unsupported value for 'minFilter' - \n            supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, \n            NearestMipMapLinearFilter and LinearMipmapLinearFilter. Defaulting to LinearMipmapLinearFilter."),r=1008);var i=e.magFilter||1006;1006!==i&&1003!==i&&(this.error("[createTexture] Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),i=1006);var s=e.wrapS||1e3;1001!==s&&1002!==s&&1e3!==s&&(this.error("[createTexture] Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),s=1e3);var a=e.wrapT||1e3;1001!==a&&1002!==a&&1e3!==a&&(this.error("[createTexture] Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),a=1e3);var o=e.wrapR||1e3;1001!==o&&1002!==o&&1e3!==o&&(this.error("[createTexture] Unsupported value for 'wrapR' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),o=1e3);var A=e.encoding||3e3;3e3!==A&&3001!==A&&(this.error("[createTexture] Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),A=3e3);var c=new ki({gl:this.scene.canvas.gl,minFilter:r,magFilter:i,wrapS:s,wrapT:a,wrapR:o,encoding:A});if(e.preloadColor&&c.setPreloadColor(e.preloadColor),e.image){var l=e.image;if(l.crossOrigin="Anonymous",l.compressed){var u=l.data;c.setCompressedData({mipmaps:u,props:{format:u[0].format,minFilter:r,magFilter:i}})}else c.setImage(l,{minFilter:r,magFilter:i,wrapS:s,wrapT:a,wrapR:o,flipY:e.flipY,encoding:A})}else if(e.src){var h=e.src.split(".").pop();switch(h){case"jpeg":case"jpg":case"png":case"gif":var d=new Image;d.onload=function(){c.setImage(d,{minFilter:r,magFilter:i,wrapS:s,wrapT:a,wrapR:o,flipY:e.flipY,encoding:A}),t.glRedraw()},d.src=e.src;break;default:this._textureTranscoder?je.loadArraybuffer(e.src,(function(e){e.byteLength?t._textureTranscoder.transcode([e],c).then((function(){t.glRedraw()})):t.error("[createTexture] Can't create texture from 'src': file data is zero length")}),(function(e){this.error("[createTexture] Can't create texture from 'src': ".concat(e))})):this.error("[createTexture] Can't create texture from 'src' - SceneModel needs to be configured with a TextureTranscoder for this file type ('".concat(h,"')"))}}else e.buffers&&(this._textureTranscoder?this._textureTranscoder.transcode(e.buffers,c).then((function(){t.glRedraw()})):this.error("[createTexture] Can't create texture from 'buffers' - SceneModel needs to be configured with a TextureTranscoder for this option"));this._textures[n]=new Ha({id:n,texture:c})}else this.error("[createTexture] Config missing: id")}},{key:"createTextureSet",value:function(e){var t=this,n=e.id;if(null==n)return this.error("[createTextureSet] Config missing: id"),!1;if(this._textureSets[n])return this.error("[createTextureSet] Texture set already created: ".concat(n)),!1;var r=function(e,n){var r=null!=e?e:n;if(r in t._textures)return t._textures[r];throw e};try{var i=new La({id:n,model:this,alphaCutoff:e.alphaCutoff,colorTexture:r(e.colorTextureId,"defaultColorTexture"),metallicRoughnessTexture:r(e.metallicRoughnessTextureId,"defaultMetalRoughTexture"),normalsTexture:r(e.normalsTextureId,"defaultNormalsTexture"),emissiveTexture:r(e.emissiveTextureId,"defaultEmissiveTexture"),occlusionTexture:r(e.occlusionTextureId,"defaultOcclusionTexture")});return this._textureSets[n]=i,i}catch(e){return this.error("[createTextureSet] Texture not found: ".concat(e," - ensure that you create it first with createTexture()")),!1}}},{key:"createTransform",value:function(e){if(void 0!==e.id&&null!==e.id)if(this._transforms[e.id])this.error("[createTransform] SceneModel already has a transform with this ID: ".concat(e.id));else{var t;if(!e.parentTransformId||(t=this._transforms[e.parentTransformId])){var n=new bo({id:e.id,model:this,parent:t,matrix:e.matrix,position:e.position,scale:e.scale,rotation:e.rotation,quaternion:e.quaternion});return this._transforms[n.id]=n,n}this.error("[createTransform] SceneModel.createTransform() config missing: id")}else this.error("[createTransform] SceneModel.createTransform() config missing: id")}},{key:"createMesh",value:function(e){var t;if(void 0===e.id||null===e.id)return this.error("[createMesh] SceneModel.createMesh() config missing: id"),!1;if(this._meshes[e.id])return this.error("[createMesh] SceneModel already has a mesh with this ID: ".concat(e.id)),!1;var n=e.geometryId,r=void 0!==n;if(r){if(e.positions||e.positionsCompressed||e.indices||e.edgeIndices||e.normals||e.normalsCompressed||e.uv||e.uvCompressed||e.positionsDecodeMatrix)return this.error("Mesh geometry parameters not expected when instancing a geometry (not expected: positions, positionsCompressed, indices, edgeIndices, normals, normalsCompressed, uv, uvCompressed, positionsDecodeMatrix)"),!1;if(e.geometry=this._geometries[n],!e.geometry)return this.error("[createMesh] Geometry not found: ".concat(n," - ensure that you create it first with createGeometry()")),!1}else{var i;null!==(i=e.primitive)&&void 0!==i||(e.primitive="triangles")}var s,a,o=r?e.geometry.primitive:e.primitive,A="triangles"===o||"solid"===o||"surface"===o,c=e.textureSetId,l=this._dtxEnabled&&A&&!c;if(e.origin=e.origin?De.addVec3(this._origin,e.origin,De.vec3()):this._origin,r){e.positionsDecodeMatrix=e.geometry.positionsDecodeMatrix,e.aabb=De.AABB3(e.geometry.aabb);var u=e.transformId;if(u){if(e.transform=this._transforms[u],!e.transform)return this.error("[createMesh] Transform not found: ".concat(u," - ensure that you create it first with createTransform()")),!1}else if(e.matrix)e.meshMatrix=e.matrix;else if(e.scale||e.rotation||e.position||e.quaternion){var h=e.scale||Mo,d=e.position||ko,f=e.rotation?De.eulerToQuaternion(e.rotation,"XYZ",Co):e.quaternion||Eo;e.meshMatrix=De.composeMat4(d,f,h,De.mat4())}}else{if("points"!==o&&"lines"!==o&&"triangles"!==o&&"solid"!==o&&"surface"!==o)return this.error("Unsupported value for 'primitive': '".concat(o,"'  ('geometryId' is absent) - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'.")),!1;if(!e.positions&&!e.positionsCompressed&&!e.buckets)return this.error("Param expected: 'positions',  'positionsCompressed' or `buckets`  ('geometryId' is absent)"),!1;if(e.positions&&(e.positionsDecodeMatrix||e.positionsDecodeBoundary))return this.error("Illegal params: 'positions' not expected with 'positionsDecodeMatrix'/'positionsDecodeBoundary' ('geometryId' is absent)"),!1;if(e.positionsCompressed&&!e.positionsDecodeMatrix&&!e.positionsDecodeBoundary)return this.error("Param expected: 'positionsCompressed' should be accompanied by 'positionsDecodeMatrix'/'positionsDecodeBoundary' ('geometryId' is absent)"),!1;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: 'uvCompressed' should be accompanied by `uvDecodeMatrix` ('geometryId' is absent)"),!1;if(!e.buckets&&!e.indices)if(A)e.indices=this._createDefaultIndices((e.positions||e.positionsCompressed).length/3);else if("lines"===o)return this.error("Param expected: indices (required for '".concat(o,"' primitive type)")),!1;if((e.matrix||e.position||e.rotation||e.scale)&&(e.positionsCompressed||e.positionsDecodeBoundary))return this.error("Unexpected params: 'matrix', 'rotation', 'scale', 'position' not allowed with 'positionsCompressed'"),!1;if(e.matrix)e.meshMatrix=e.matrix;else if(e.scale||e.rotation||e.position||e.quaternion){var p=e.scale||Mo,v=e.position||ko,g=e.rotation?De.eulerToQuaternion(e.rotation,"XYZ",Co):e.quaternion||Eo;e.meshMatrix=De.composeMat4(v,g,p,De.mat4())}if(e.positionsDecodeBoundary&&(e.positionsDecodeMatrix=fa(e.positionsDecodeBoundary,De.mat4())),e.positions){var m=[];Mn(e.positions,m,wo)&&(e.positions=m,e.origin=De.addVec3(e.origin,wo,De.vec3()));var y=De.collapseAABB3();l?(e.positionsDecodeMatrix=De.mat4(),De.expandAABB3Points3(y,e.positions),e.positionsCompressed=da(e.positions,y,e.positionsDecodeMatrix)):(e.meshMatrix&&(De.transformPositions3(e.meshMatrix,e.positions,e.positions),e.meshMatrix=null),De.expandAABB3Points3(y,e.positions)),e.aabb=y}else if(e.positionsCompressed){var _=De.collapseAABB3();De.expandAABB3Points3(_,e.positionsCompressed),Nt.decompressAABB(_,e.positionsDecodeMatrix),e.aabb=_}if(l&&e.buckets){var b=De.collapseAABB3();e.buckets.forEach((function(e){var t=e.positions||e.positionsCompressed;t&&De.expandAABB3Points3(b,t)})),e.positionsDecodeMatrix&&Nt.decompressAABB(b,e.positionsDecodeMatrix),e.aabb=b}A&&!e.buckets&&(e.edgeIndices||(e.edgeIndices=Pt(e.positions||e.positionsCompressed,e.indices,e.positions?null:e.positionsDecodeMatrix,2)))}if(e.meshMatrix&&(De.AABB3ToOBB3(e.aabb,Bo),De.transformOBB3(e.meshMatrix,Bo,Bo),De.OBB3ToAABB3(Bo,e.aabb)),e.color=e.color?new Uint8Array(e.color.slice(0,3).map((function(e){return Math.floor(255*e)}))):xo,e.opacity=Math.floor(255*(null!==(t=e.opacity)&&void 0!==t?t:1)),l)e.type=2,r&&(e.buckets=this._dtxBuckets[n]),e.buckets||(e.buckets=function(e,t,n){var r,i,s,a;if(t||n){var o=k(no({positionsCompressed:e.positionsCompressed,indices:e.indices,edgeIndices:e.edgeIndices}),3);r=o[0],i=o[1],s=o[2]}else r=e.positionsCompressed,i=e.indices,s=e.edgeIndices;if(n){a=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.positionsCompressed||[],i=so(e.indices||[],t),s=Ao(e.edgeIndices||[]);function a(e,t){if(e>t){var n=e;e=t,t=n}function r(n,r){return n!==e?e-n:r!==t?t-r:0}for(var i=0,a=(s.length>>1)-1;i<=a;){var o=a+i>>1,A=r(s[2*o],s[2*o+1]);if(A>0)i=o+1;else{if(!(A<0))return o;a=o-1}}return-i-1}var o=new Int32Array(s.length/2);o.fill(0);var A=r.length/3;if(A>8*(1<<t))return[e];var c=new Int32Array(A);c.fill(-1);var l=[];function u(){c.fill(-1);var e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:l.length};return l.push(e),e}for(var h=u(),d=0,f=i.length;d<f;d+=3){var p=0,v=i[d],g=i[d+1],m=i[d+2];if(-1===c[v]&&p++,-1===c[g]&&p++,-1===c[m]&&p++,p+h.numPositions>h.maxNumPositions&&(h=u()),h.bucketNumber>8)return[e];-1===c[v]&&(c[v]=h.numPositions++,h.positionsCompressed.push(r[3*v]),h.positionsCompressed.push(r[3*v+1]),h.positionsCompressed.push(r[3*v+2])),-1===c[g]&&(c[g]=h.numPositions++,h.positionsCompressed.push(r[3*g]),h.positionsCompressed.push(r[3*g+1]),h.positionsCompressed.push(r[3*g+2])),-1===c[m]&&(c[m]=h.numPositions++,h.positionsCompressed.push(r[3*m]),h.positionsCompressed.push(r[3*m+1]),h.positionsCompressed.push(r[3*m+2])),h.indices.push(c[v]),h.indices.push(c[g]),h.indices.push(c[m]);var y=void 0;(y=a(v,g))>=0&&0===o[y]&&(o[y]=1,h.edgeIndices.push(c[s[2*y]]),h.edgeIndices.push(c[s[2*y+1]])),(y=a(v,m))>=0&&0===o[y]&&(o[y]=1,h.edgeIndices.push(c[s[2*y]]),h.edgeIndices.push(c[s[2*y+1]])),(y=a(g,m))>=0&&0===o[y]&&(o[y]=1,h.edgeIndices.push(c[s[2*y]]),h.edgeIndices.push(c[s[2*y+1]]))}var _=t/8*2,b=t/8,w=2*r.length+(i.length+s.length)*_,B=0;return r.length,l.forEach((function(e){B+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*b,e.positionsCompressed.length})),B>w?[e]:(n&&co(l,e),l)}({positionsCompressed:r,indices:i,edgeIndices:s},r.length/3>65536?16:8)}else a=[{positionsCompressed:r,indices:i,edgeIndices:s}];return a}(r?e.geometry:e,this._enableVertexWelding,this._enableIndexBucketing),r&&(this._dtxBuckets[n]=e.buckets));else if(e.type=r?0:1,e.metallic=Math.floor(255*(null!==(s=e.metallic)&&void 0!==s?s:0)),e.roughness=Math.floor(255*(null!==(a=e.roughness)&&void 0!==a?a:1)),c&&(e.textureSet=this._textureSets[c],!r&&!e.textureSet))return this.error("[createMesh] Texture set not found: ".concat(c," - ensure that you create it first with createTextureSet()")),!1;e.numPrimitives=this._getNumPrimitives(e);var w=new ps(this,e.id,e.color,e.opacity,e.transform,e.textureSet),B=this.scene._renderer.getPickID(w);return w.pickId=B,w.origin=De.vec3(e.origin),w.layer=2===e.type?this._getDTXLayer(e):this._getVBOLayer(0===e.type,e),w.aabb=e.aabb,e.pickColor=new Uint8Array([255&B,B>>8&255,B>>16&255,B>>24&255]),e.solid="solid"===e.primitive,e.meshMatrix=e.transform?e.transform.worldMatrix:e.meshMatrix,w.portionId=w.layer.createPortion(w,e),w.numPrimitives=e.numPrimitives,this._meshes[e.id]=w,this._unusedMeshes[e.id]=w,this._meshList.push(w),w}},{key:"_getNumPrimitives",value:function(e){var t=0;switch(e.geometry?e.geometry.primitive:e.primitive){case"triangles":case"solid":case"surface":switch(e.type){case 2:for(var n=0,r=e.buckets.length;n<r;n++)t+=e.buckets[n].indices.length;break;case 1:t+=e.indices.length;break;case 0:t+=e.geometry.indices.length}return Math.round(t/3);case"points":switch(e.type){case 2:for(var i=0,s=e.buckets.length;i<s;i++)t+=e.buckets[i].positionsCompressed.length;break;case 1:t+=e.positions?e.positions.length:e.positionsCompressed.length;break;case 0:var a=e.geometry;t+=a.positions?a.positions.length:a.positionsCompressed.length}return Math.round(t);case"lines":case"line-strip":switch(e.type){case 2:for(var o=0,A=e.buckets.length;o<A;o++)t+=e.buckets[o].indices.length;break;case 1:t+=e.indices.length;break;case 0:t+=e.geometry.indices.length}return Math.round(t/2)}return 0}},{key:"_getDTXLayer",value:function(e){var t=e.origin,n=e.geometry?e.geometry.primitive:e.primitive,r=".".concat(n,".").concat(Math.round(t[0]),".").concat(Math.round(t[1]),".").concat(Math.round(t[2])),i=this._dtxLayers[r];if(i){if(i.canCreatePortion(e))return i;delete this._dtxLayers[r],i=null}switch(n){case"triangles":case"solid":case"surface":i=new Aa(this,n,t);break;default:return}return this._dtxLayers[r]=i,this.layerList.push(i),this._layersToFinalize.push(i),i}},{key:"_getVBOLayer",value:function(e,t){var n=e&&t.geometry,r=e?n.primitive:t.primitive,i=t.origin,s=!e&&(t.positionsDecodeMatrix||t.positionsDecodeBoundary),a=s?this._createHashStringFromMatrix(s):"-",o=t.textureSetId||"-",A=e?t.geometryId:"-",c=(e?"instancing":"batching")+".".concat(Math.round(i[0]),".").concat(Math.round(i[1]),".").concat(Math.round(i[2]),".").concat(r,".").concat(a,".").concat(o,".").concat(A);if(!e&&c in this._vboLayers){var l=this._vboLayers[c],u=t.positionsCompressed?t.positionsCompressed.length:t.positions.length;l.canCreatePortion(u,"points"===r?0:t.indices.length)||(l.finalize(),delete this._vboLayers[c])}if(!(c in this._vboLayers)){var h=new Ra(this,r,i,d({textureSet:t.textureSet},e?{geometry:n}:{maxGeometryBatchSize:this._maxGeometryBatchSize,positionsDecodeMatrix:t.positionsDecodeMatrix,uvDecodeMatrix:t.uvDecodeMatrix}));this.layerList.push(h),this._layersToFinalize.push(h),this._vboLayers[c]=h}return this._vboLayers[c]}},{key:"_createHashStringFromMatrix",value:function(e){for(var t=e.join(";"),n=0,r=0;r<t.length;r++){n=(n<<5)-n+t.charCodeAt(r),n|=0}return(n>>>0).toString(16)}},{key:"createEntity",value:function(e){if(void 0===e.id?e.id=De.createUUID():this.scene.components[e.id]&&(this.error("Scene already has a Component with this ID: ".concat(e.id," - will assign random ID")),e.id=De.createUUID()),void 0===e.meshIds)return this.error("Config missing: meshIds"),null;var t=function(e){return!1!==e},n=0;n|=this._visible&&t(e.visible)&&vs,n|=this._pickable&&t(e.pickable)&&ms,n|=this._culled&&t(e.culled)&&gs,n|=this._clippable&&t(e.clippable)&&ys,n|=this._collidable&&t(e.collidable)&&_s,n|=this._xrayed&&t(e.xrayed)&&bs,n|=this._highlighted&&t(e.highlighted)&&ws,n|=this._selected&&t(e.selected)&&Bs,n|=this._edges&&t(e.edges)&&Cs,e.flags=n;for(var r=[],i=0,s=e.meshIds.length;i<s;i++){var a=e.meshIds[i],o=this._meshes[a];o?o.parent?this.error('Mesh with ID "'.concat(a,'" already belongs to object with ID "').concat(o.parent.id,'" - ignoring this mesh')):(r.push(o),delete this._unusedMeshes[a]):this.error('Mesh with this ID not found: "'.concat(a,'" - ignoring this mesh'))}var A=new ho(this,e.isObject,e.id,r,e.flags,!0);return this._entityList.push(A),this._entities[e.id]=A,this._entitiesToFinalize.push(A),this.numEntities++,A}},{key:"preFinalize",value:function(){if(this.destroyed)return!1;if(0===this._layersToFinalize.length)return!1;this._createDummyEntityForUnusedMeshes();for(var e=0,t=this._layersToFinalize.length;e<t;e++){this._layersToFinalize[e].finalize()}this._vboLayers={},this._dtxLayers={},this._layersToFinalize=[];for(var n=0,r=this._entitiesToFinalize.length;n<r;n++){this._entitiesToFinalize[n]._finalize()}for(var i=0,s=this._entitiesToFinalize.length;i<s;i++){this._entitiesToFinalize[i]._finalize2()}this._entitiesToFinalize=[],this.scene._aabbDirty=!0,this._viewMatrixDirty=!0,this._matrixDirty=!0,this._aabbDirty=!0,this._setWorldMatrixDirty(),this._sceneModelDirty(),this.position=this._position,this.layerList.sort((function(e,t){return e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0}));for(var a=0,o=this.layerList.length;a<o;a++){this.layerList[a].layerIndex=a}this.glRedraw(),this._layersFinalized=!0}},{key:"finalize",value:function(){this.destroyed||(this.preFinalize(),this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={})}},{key:"stateSortCompare",value:function(e,t){}},{key:"rebuildRenderFlags",value:function(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}},{key:"_updateRenderFlagsVisibleLayers",value:function(){var e=this.renderFlags;e.numLayers=this.layerList.length,e.numVisibleLayers=0;for(var t=0,n=this.layerList.length;t<n;t++){var r=this.layerList[t];this._getActiveSectionPlanesForLayer(r)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}},{key:"_createDummyEntityForUnusedMeshes",value:function(){var e=Object.keys(this._unusedMeshes);if(e.length>0){var t="".concat(this.id,"-").concat(De.createUUID());this.warn('Creating dummy SceneModelEntity "'.concat(t,'" for unused SceneMeshes: [').concat(e.join(","),"]")),this.createEntity({id:t,meshIds:e,isObject:!0})}this._unusedMeshes={}}},{key:"_getActiveSectionPlanesForLayer",value:function(e){var t=this.renderFlags,n=this.scene._sectionPlanesState.sectionPlanes,r=n.length,i=e.layerIndex*r;if(r>0)for(var s=0;s<r;s++){n[s].active?(t.sectionPlanesActivePerLayer[i+s]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[i+s]=!1}return!0}},{key:"_updateRenderFlags",value:function(){if(0!==this.numVisibleLayerPortions&&this.numCulledLayerPortions!==this.numPortions){var e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){var t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0)this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0));if(this.numSelectedLayerPortions>0){var n=this.scene.selectedMaterial._state;n.fill&&(n.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),n.edges&&(n.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){var r=this.scene.highlightMaterial._state;r.fill&&(r.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),r.edges&&(r.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}},{key:"_withEachVisibleLayer",value:function(e,t,n){if(!t||0!==this.numVisibleLayerPortions)for(var r=e.testAABB,i=this.renderFlags,s=0,a=i.visibleLayers.length;s<a;s++){var o=this.layerList[i.visibleLayers[s]];r&&!r(o.getAABB())||n(o)}}},{key:"drawColorOpaque",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawColorOpaque(t.renderFlags,e)}))}},{key:"drawColorTransparent",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawColorTransparent(t.renderFlags,e)}))}},{key:"drawDepth",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawDepth(t.renderFlags,e)}))}},{key:"drawSilhouetteXRayed",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawSilhouetteXRayed(t.renderFlags,e)}))}},{key:"drawSilhouetteHighlighted",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawSilhouetteHighlighted(t.renderFlags,e)}))}},{key:"drawSilhouetteSelected",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawSilhouetteSelected(t.renderFlags,e)}))}},{key:"drawEdgesColorOpaque",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawEdgesColorOpaque(t.renderFlags,e)}))}},{key:"drawEdgesColorTransparent",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawEdgesColorTransparent(t.renderFlags,e)}))}},{key:"drawEdgesXRayed",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawEdgesXRayed(t.renderFlags,e)}))}},{key:"drawEdgesHighlighted",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawEdgesHighlighted(t.renderFlags,e)}))}},{key:"drawEdgesSelected",value:function(e){var t=this;this._withEachVisibleLayer(e,!1,(function(n){return n.drawEdgesSelected(t.renderFlags,e)}))}},{key:"drawOcclusion",value:function(e){var t=this;this._withEachVisibleLayer(e,!0,(function(n){return n.drawOcclusion(t.renderFlags,e)}))}},{key:"drawShadow",value:function(e){var t=this;this._withEachVisibleLayer(e,!0,(function(n){return n.drawShadow(t.renderFlags,e)}))}},{key:"drawPickMesh",value:function(e){var t=this;this._withEachVisibleLayer(e,!0,(function(n){return n.drawPickMesh(t.renderFlags,e)}))}},{key:"drawPickDepths",value:function(e){var t=this;this._withEachVisibleLayer(e,!0,(function(n){return n.drawPickDepths(t.renderFlags,e)}))}},{key:"drawPickNormals",value:function(e){var t=this;this._withEachVisibleLayer(e,!0,(function(n){return n.drawPickNormals(t.renderFlags,e)}))}},{key:"_drawSnap",value:function(e,t){var n=this;this._withEachVisibleLayer(e,!0,(function(r){return r.drawSnap(n.renderFlags,e,t)}))}},{key:"drawSnapInit",value:function(e){this._drawSnap(e,!0)}},{key:"drawSnap",value:function(e){this._drawSnap(e,!1)}},{key:"destroy",value:function(){Object.values(this._vboLayers).forEach((function(e){return e.destroy()})),this._vboLayers={},this.scene.camera.off(this._onCameraViewMatrix),this.scene.off(this._onTick);for(var e=0,t=this.layerList.length;e<t;e++)this.layerList[e].destroy();this.layerList=[];for(var r=0,i=this._entityList.length;r<i;r++)this._entityList[r]._destroy();this._layersToFinalize=[],this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={},this._meshes={},this._entities={},this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),v(C(n.prototype),"destroy",this).call(this)}}]),n}();var Io=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,n),(r=t.call(this,e,i))._positions=i.positions||[],i.indices)r._indices=i.indices;else{r._indices=[];for(var s=0,a=r._positions.length/3-1;s<a;s+=2)r._indices.push(s),r._indices.push(s+1)}return r._color=i.color||[1,1,1],r._opacity=i.opacity||1,r._sceneModel=new Uo(w(r),{isModel:!1}),r._sceneModel.createMesh({id:"linesMesh",primitive:"lines",positions:r._positions,indices:r._indices,color:r._color,opacity:r._opacity}),r._sceneModel.createEntity({meshIds:["linesMesh"],visible:i.visible,clippable:i.clippable,collidable:i.collidable}),r._sceneModel.finalize(),r.scene._lineSetCreated(w(r)),r}return I(n,[{key:"visible",get:function(){return this._sceneModel.visible},set:function(e){this._sceneModel.visible=e}},{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this.scene._lineSetDestroyed(this)}}]),n}(),To=function(e){m(n,it);var t=_(n);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),t.call(this,e,r)}return I(n,[{key:"type",get:function(){return"Light"}},{key:"isLight",get:function(){return!0}}]),n}(),Po=function(e){m(n,To);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state={type:"ambient",color:De.vec3([.7,.7,.7]),intensity:1},r.color=i.color,r.intensity=i.intensity,r.scene._lightCreated(w(r)),r}return I(n,[{key:"type",get:function(){return"AmbientLight"}},{key:"color",get:function(){return this._state.color},set:function(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}},{key:"intensity",get:function(){return this._state.intensity},set:function(e){this._state.intensity=void 0!==e?e:1,this.glRedraw()}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this.scene._lightDestroyed(this)}}]),n}(),So=function(){function e(t,n,r){x(this,e),this.gl=t,this.allocated=!1,this.buffer=null,this.bound=!1,this._colorFormats=n,this._hasDepthTexture=r}return I(e,[{key:"setSize",value:function(e){this.size=e}},{key:"bind",value:function(){var e=this.size[0],t=this.size[1];if(!this.buffer||this.buffer.width===e&&this.buffer.height===t||(this.buffer.cleanup(),this.buffer=null),this.buffer||(this._allocateBuffer(e,t),this.bound=!1),!this.bound){var n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,this.buffer.framebuf),this.bound=!0}}},{key:"_allocateBuffer",value:function(e,t){var n=this._colorFormats||[],r=this.gl,i=function(){var e=r.createTexture();return r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e},s=(n.length>0?n:[null]).map((function(n){var s=i();return n?r.texStorage2D(r.TEXTURE_2D,1,n,e,t):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,e,t,0,r.RGBA,r.UNSIGNED_BYTE,null),s})),a=r.createRenderbuffer();r.bindRenderbuffer(r.RENDERBUFFER,a),r.renderbufferStorage(r.RENDERBUFFER,r.DEPTH_COMPONENT32F,e,t);var o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);for(var A=0;A<s.length;A++)r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+A,r.TEXTURE_2D,s[A],0);n.length>0&&r.drawBuffers(s.map((function(e,t){return r.COLOR_ATTACHMENT0+t})));var c=this._hasDepthTexture&&i();if(c?(r.texImage2D(r.TEXTURE_2D,0,r.DEPTH_COMPONENT32F,e,t,0,r.DEPTH_COMPONENT,r.FLOAT,null),r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,c,0)):r.framebufferRenderbuffer(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.RENDERBUFFER,a),r.bindTexture(r.TEXTURE_2D,null),r.bindRenderbuffer(r.RENDERBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.FRAMEBUFFER,o),!r.isFramebuffer(o))throw"Invalid framebuffer";r.bindFramebuffer(r.FRAMEBUFFER,null);var l=r.checkFramebufferStatus(r.FRAMEBUFFER);switch(l){case r.FRAMEBUFFER_COMPLETE:break;case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+l}this.buffer={cleanup:function(){s.forEach((function(e){return r.deleteTexture(e)})),c&&r.deleteTexture(c),r.deleteFramebuffer(o),r.deleteRenderbuffer(a)},framebuf:o,width:e,height:t},this.colorTextures=s.map((function(e){return{bind:function(t){return r.activeTexture(r["TEXTURE"+t]),r.bindTexture(r.TEXTURE_2D,e),!0}}})),this.depthTexture=c&&{bind:function(e){return r.activeTexture(r["TEXTURE"+e]),r.bindTexture(r.TEXTURE_2D,c),!0}}}},{key:"read",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Uint8Array,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:4,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,o=new i(s),A=this.gl;return A.readBuffer(A.COLOR_ATTACHMENT0+a),A.readPixels(e,this.buffer.height-t-1,1,1,n||A.RGBA,r||A.UNSIGNED_BYTE,o,0),o}},{key:"unbind",value:function(){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.bound=!1}},{key:"destroy",value:function(){this.allocated&&(this.buffer.cleanup(),this.allocated=!1,this.buffer=null,this.bound=!1),this.colorTextures=null,this.depthTexture=null}}]),e}(),Do=function(e){m(n,To);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e,i))._shadowRenderBuf=null,r._shadowViewMatrix=null,r._shadowProjMatrix=null,r._shadowViewMatrixDirty=!0,r._shadowProjMatrixDirty=!0;var s=r.scene.camera,a=r.scene.canvas;return r._onCameraViewMatrix=s.on("viewMatrix",(function(){r._shadowViewMatrixDirty=!0})),r._onCameraProjMatrix=s.on("projMatrix",(function(){r._shadowProjMatrixDirty=!0})),r._onCanvasBoundary=a.on("boundary",(function(){r._shadowProjMatrixDirty=!0})),r._state=new It({type:"dir",dir:De.vec3([1,1,1]),color:De.vec3([.7,.7,.8]),intensity:1,space:i.space||"view",castsShadow:!1,getShadowViewMatrix:function(){if(r._shadowViewMatrixDirty){r._shadowViewMatrix||(r._shadowViewMatrix=De.identityMat4());var e=r.scene.camera,t=r._state.dir,n=e.look,i=[n[0]-t[0],n[1]-t[1],n[2]-t[2]];De.lookAtMat4v(i,n,[0,1,0],r._shadowViewMatrix),r._shadowViewMatrixDirty=!1}return r._shadowViewMatrix},getShadowProjMatrix:function(){return r._shadowProjMatrixDirty&&(r._shadowProjMatrix||(r._shadowProjMatrix=De.identityMat4()),De.orthoMat4c(-40,40,-40,40,-40,80,r._shadowProjMatrix),r._shadowProjMatrixDirty=!1),r._shadowProjMatrix},getShadowRenderBuf:function(){return r._shadowRenderBuf||(r._shadowRenderBuf=new So(r.scene.canvas.gl),r._shadowRenderBuf.setSize([1024,1024])),r._shadowRenderBuf}}),r.dir=i.dir,r.color=i.color,r.intensity=i.intensity,r.castsShadow=i.castsShadow,r.scene._lightCreated(w(r)),r}return I(n,[{key:"type",get:function(){return"DirLight"}},{key:"dir",get:function(){return this._state.dir},set:function(e){this._state.dir.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}},{key:"color",get:function(){return this._state.color},set:function(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}},{key:"intensity",get:function(){return this._state.intensity},set:function(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}},{key:"castsShadow",get:function(){return this._state.castsShadow},set:function(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}},{key:"destroy",value:function(){var e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),v(C(n.prototype),"destroy",this).call(this),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}]),n}(),Qo=function(e){m(n,To);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n);var s=w(r=t.call(this,e,i));r._shadowRenderBuf=null,r._shadowViewMatrix=null,r._shadowProjMatrix=null,r._shadowViewMatrixDirty=!0,r._shadowProjMatrixDirty=!0;var a=r.scene.camera,o=r.scene.canvas;return r._onCameraViewMatrix=a.on("viewMatrix",(function(){r._shadowViewMatrixDirty=!0})),r._onCameraProjMatrix=a.on("projMatrix",(function(){r._shadowProjMatrixDirty=!0})),r._onCanvasBoundary=o.on("boundary",(function(){r._shadowProjMatrixDirty=!0})),r._state=new It({type:"point",pos:De.vec3([1,1,1]),color:De.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:i.space||"view",castsShadow:!1,getShadowViewMatrix:function(){if(s._shadowViewMatrixDirty){s._shadowViewMatrix||(s._shadowViewMatrix=De.identityMat4());var e=s._state.pos,t=a.look,n=a.up;De.lookAtMat4v(e,t,n,s._shadowViewMatrix),s._shadowViewMatrixDirty=!1}return s._shadowViewMatrix},getShadowProjMatrix:function(){if(s._shadowProjMatrixDirty){s._shadowProjMatrix||(s._shadowProjMatrix=De.identityMat4());var e=s.scene.canvas.canvas;De.perspectiveMat4(Math.PI/180*70,e.clientWidth/e.clientHeight,.1,500,s._shadowProjMatrix),s._shadowProjMatrixDirty=!1}return s._shadowProjMatrix},getShadowRenderBuf:function(){return s._shadowRenderBuf||(s._shadowRenderBuf=new So(s.scene.canvas.gl),s._shadowRenderBuf.setSize([1024,1024])),s._shadowRenderBuf}}),r.pos=i.pos,r.color=i.color,r.intensity=i.intensity,r.constantAttenuation=i.constantAttenuation,r.linearAttenuation=i.linearAttenuation,r.quadraticAttenuation=i.quadraticAttenuation,r.castsShadow=i.castsShadow,r.scene._lightCreated(w(r)),r}return I(n,[{key:"type",get:function(){return"PointLight"}},{key:"pos",get:function(){return this._state.pos},set:function(e){this._state.pos.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}},{key:"color",get:function(){return this._state.color},set:function(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}},{key:"intensity",get:function(){return this._state.intensity},set:function(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}},{key:"constantAttenuation",get:function(){return this._state.attenuation[0]},set:function(e){this._state.attenuation[0]=e||0,this.glRedraw()}},{key:"linearAttenuation",get:function(){return this._state.attenuation[1]},set:function(e){this._state.attenuation[1]=e||0,this.glRedraw()}},{key:"quadraticAttenuation",get:function(){return this._state.attenuation[2]},set:function(e){this._state.attenuation[2]=e||0,this.glRedraw()}},{key:"castsShadow",get:function(){return this._state.castsShadow},set:function(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}},{key:"destroy",value:function(){var e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),v(C(n.prototype),"destroy",this).call(this),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}]),n}();function Ro(e){return 0==(e&e-1)}function Oo(e){--e;for(var t=1;t<32;t<<=1)e|=e>>t;return e+1}var Vo=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n);var s=(r=t.call(this,e,i)).scene.canvas.gl;return r._state=new It({texture:new ki({gl:s,target:s.TEXTURE_CUBE_MAP}),flipY:r._checkFlipY(i.minFilter),encoding:r._checkEncoding(i.encoding),minFilter:1008,magFilter:1006,wrapS:1001,wrapT:1001,mipmaps:!0}),r._src=i.src,r._images=[],r._loadSrc(i.src),Ve.memory.textures++,r}return I(n,[{key:"type",get:function(){return"CubeTexture"}},{key:"_checkFlipY",value:function(e){return!!e}},{key:"_checkEncoding",value:function(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}},{key:"_loadSrc",value:function(e){var t=this,n=this.scene.canvas.gl;this._images=[];for(var r=!1,i=0,s=function(s){var a,o,A=new Image;A.onload=(a=A,o=s,function(){if(!r&&(a=function(e){if(!Ro(e.width)||!Ro(e.height)){var t=document.createElement("canvas");t.width=Oo(e.width),t.height=Oo(e.height),t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}(a),t._images[o]=a,6==++i)){var e=t._state.texture;e||(e=new ki({gl:n,target:n.TEXTURE_CUBE_MAP}),t._state.texture=e),e.setImage(t._images,t._state),t.fire("loaded",t._src,!1),t.glRedraw()}}),A.onerror=function(){r=!0},A.src=e[s]},a=0;a<e.length;a++)s(a)}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.texture&&this._state.texture.destroy(),Ve.memory.textures--,this._state.destroy()}}]),n}(),Lo=function(e){m(n,Vo);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).scene._lightsState.addReflectionMap(r._state),r.scene._reflectionMapCreated(w(r)),r}return I(n,[{key:"type",get:function(){return"ReflectionMap"}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this.scene._reflectionMapDestroyed(this)}}]),n}(),Ho=function(e){m(n,Vo);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).scene._lightMapCreated(w(r)),r}return I(n,[{key:"type",get:function(){return"LightMap"}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this.scene._lightMapDestroyed(this)}}]),n}(),No=De.vec4(),Go=De.vec4(),jo=function(e){m(n,it);var t=_(n);function n(e,r){var i;return x(this,n),(i=t.call(this,e,r))._entity=null,i._visible=null,i._worldPos=De.vec3(),i._origin=De.vec3(),i._rtcPos=De.vec3(),i._viewPos=De.vec3(),i._canvasPos=De.vec2(),i._occludable=!1,i._onCameraViewMatrix=i.scene.camera.on("matrix",(function(){i._viewPosDirty=!0,i._needUpdate()})),i._onCameraProjMatrix=i.scene.camera.on("projMatrix",(function(){i._canvasPosDirty=!0,i._needUpdate()})),i._onEntityDestroyed=null,i._onEntityModelDestroyed=null,i._renderer.addMarker(w(i)),i.entity=r.entity,i.worldPos=r.worldPos,i.occludable=r.occludable,i}return I(n,[{key:"_update",value:function(){if(this._viewPosDirty&&(De.transformPoint3(this.scene.camera.viewMatrix,this._worldPos,this._viewPos),this._viewPosDirty=!1,this._canvasPosDirty=!0,this.fire("viewPos",this._viewPos)),this._canvasPosDirty){No.set(this._viewPos),No[3]=1,De.transformPoint4(this.scene.camera.projMatrix,No,Go);var e=this.scene.canvas.boundary;this._canvasPos[0]=Math.floor((1+Go[0]/Go[3])*e[2]/2),this._canvasPos[1]=Math.floor((1-Go[1]/Go[3])*e[3]/2),this._canvasPosDirty=!1,this.fire("canvasPos",this._canvasPos)}}},{key:"_setVisible",value:function(e){this._visible,this._visible=e,this.fire("visible",this._visible)}},{key:"entity",get:function(){return this._entity},set:function(e){var t=this;this._entity!==e&&(this._cleanupDestroyedHandlers(),this._entity=e,this._entity&&(this._entity.isSceneModelEntity?this._onEntityModelDestroyed=this._entity.model.on("destroyed",(function(){t._entity=null,t._onEntityModelDestroyed=null})):this._onEntityDestroyed=this._entity.on("destroyed",(function(){t._entity=null,t._onEntityDestroyed=null}))),this.fire("entity",this._entity,!0))}},{key:"occludable",get:function(){return this._occludable},set:function(e){(e=!!e)!==this._occludable&&(this._occludable=e,this._occludable&&this._renderer.markerWorldPosUpdated(this))}},{key:"worldPos",get:function(){return this._worldPos},set:function(e){this._worldPos.set(e||[0,0,0]),Cn(this._worldPos,this._origin,this._rtcPos),this._occludable&&this._renderer.markerWorldPosUpdated(this),this._viewPosDirty=!0,this.fire("worldPos",this._worldPos),this._needUpdate()}},{key:"origin",get:function(){return this._origin}},{key:"rtcPos",get:function(){return this._rtcPos}},{key:"viewPos",get:function(){return this._update(),this._viewPos}},{key:"canvasPos",get:function(){return this._update(),this._canvasPos}},{key:"visible",get:function(){return!!this._visible}},{key:"destroy",value:function(){this.fire("destroyed",!0),this.scene.camera.off(this._onCameraViewMatrix),this.scene.camera.off(this._onCameraProjMatrix),this._cleanupDestroyedHandlers(),this._renderer.removeMarker(this),v(C(n.prototype),"destroy",this).call(this)}},{key:"_cleanupDestroyedHandlers",value:function(){this._entity&&(null!==this._onEntityDestroyed&&(this._entity.model?this._entity.model.off(this._onEntityDestroyed):this._entity.off(this._onEntityDestroyed),this._onEntityDestroyed=null),null!==this._onEntityModelDestroyed&&(this._entity.model&&this._entity.model.off(this._onEntityModelDestroyed),this._onEntityModelDestroyed=null))}}]),n}(),Wo=function(e){m(n,jo);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,{entity:i.entity,occludable:i.occludable,worldPos:i.worldPos}))._occluded=!1,r._visible=!0,r._src=null,r._image=null,r._pos=De.vec3(),r._origin=De.vec3(),r._rtcPos=De.vec3(),r._dir=De.vec3(),r._size=1,r._imageSize=De.vec2(),r._texture=new Ti(w(r),{src:i.src}),r._geometry=new Wt(w(r),{primitive:"triangles",positions:[3,3,0,-3,3,0,-3,-3,0,3,-3,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,-1,0,-1,0,0,1,0],indices:[0,1,2,0,2,3]}),r._mesh=new vi(w(r),{geometry:r._geometry,material:new wi(w(r),{ambient:[.9,.3,.9],shininess:30,diffuseMap:r._texture,backfaces:!0}),scale:[1,1,1],position:i.worldPos,rotation:[90,0,0],billboard:"spherical",occluder:!1}),r.visible=!0,r.collidable=i.collidable,r.clippable=i.clippable,r.pickable=i.pickable,r.opacity=i.opacity,r.size=i.size,i.image?r.image=i.image:r.src=i.src,r}return I(n,[{key:"_setVisible",value:function(e){this._occluded=!e,this._mesh.visible=this._visible&&!this._occluded,v(C(n.prototype),"_setVisible",this).call(this,e)}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=null==e||e,this._mesh.visible=this._visible&&!this._occluded}},{key:"image",get:function(){return this._image},set:function(e){this._image=e,this._image&&(this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}},{key:"src",get:function(){return this._src},set:function(e){var t=this;if(this._src=e,this._src){this._image=null;var n=new Image;n.onload=function(){t._texture.image=n,t._imageSize[0]=n.width,t._imageSize[1]=n.height,t._updatePlaneSizeFromImage()},n.src=this._src}}},{key:"size",get:function(){return this._size},set:function(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}},{key:"collidable",get:function(){return this._mesh.collidable},set:function(e){this._mesh.collidable=!1!==e}},{key:"clippable",get:function(){return this._mesh.clippable},set:function(e){this._mesh.clippable=!1!==e}},{key:"pickable",get:function(){return this._mesh.pickable},set:function(e){this._mesh.pickable=!1!==e}},{key:"opacity",get:function(){return this._mesh.opacity},set:function(e){this._mesh.opacity=e}},{key:"_updatePlaneSizeFromImage",value:function(){var e=.5*this._size,t=this._imageSize[0],n=this._imageSize[1],r=n/t;this._geometry.positions=t>n?[e,e*r,0,-e,e*r,0,-e,-e*r,0,e,-e*r,0]:[e/r,e,0,-e/r,e,0,-e/r,-e,0,e/r,-e,0]}}]),n}(),zo=function(){function e(t){x(this,e),this._eye=De.vec3(),this._look=De.vec3(),this._up=De.vec3(),this._projection={},t&&this.saveCamera(t)}return I(e,[{key:"saveCamera",value:function(e){var t=e.camera,n=t.project;switch(this._eye.set(t.eye),this._look.set(t.look),this._up.set(t.up),t.projection){case"perspective":this._projection={projection:"perspective",fov:n.fov,fovAxis:n.fovAxis,near:n.near,far:n.far};break;case"ortho":this._projection={projection:"ortho",scale:n.scale,near:n.near,far:n.far};break;case"frustum":this._projection={projection:"frustum",left:n.left,right:n.right,top:n.top,bottom:n.bottom,near:n.near,far:n.far};break;case"custom":this._projection={projection:"custom",matrix:n.matrix.slice()}}}},{key:"restoreCamera",value:function(e,t){var n=e.camera,r=this._projection;function i(){switch(r.type){case"perspective":n.perspective.fov=r.fov,n.perspective.fovAxis=r.fovAxis,n.perspective.near=r.near,n.perspective.far=r.far;break;case"ortho":n.ortho.scale=r.scale,n.ortho.near=r.near,n.ortho.far=r.far;break;case"frustum":n.frustum.left=r.left,n.frustum.right=r.right,n.frustum.top=r.top,n.frustum.bottom=r.bottom,n.frustum.near=r.near,n.frustum.far=r.far;break;case"custom":n.customProjection.matrix=r.matrix}}t?e.viewer.cameraFlight.flyTo({eye:this._eye,look:this._look,up:this._up,orthoScale:r.scale,projection:r.projection},(function(){i(),t()})):(n.eye=this._eye,n.look=this._look,n.up=this._up,i(),n.projection=r.projection)}}]),e}(),Xo=De.vec3(),Ko=function(){function e(t){if(x(this,e),this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsOpacity=[],this.numObjects=0,t){var n=t.metaScene.scene;this.saveObjects(n,t)}}return I(e,[{key:"saveObjects",value:function(e,t,n){this.numObjects=0,this._mask=n?je.apply(n,{}):null;for(var r=!n||n.visible,i=!n||n.edges,s=!n||n.xrayed,a=!n||n.highlighted,o=!n||n.selected,A=!n||n.clippable,c=!n||n.pickable,l=!n||n.colorize,u=!n||n.opacity,h=t.metaObjects,d=e.objects,f=0,p=h.length;f<p;f++){var v=d[h[f].id];if(v){if(r&&(this.objectsVisible[f]=v.visible),i&&(this.objectsEdges[f]=v.edges),s&&(this.objectsXrayed[f]=v.xrayed),a&&(this.objectsHighlighted[f]=v.highlighted),o&&(this.objectsSelected[f]=v.selected),A&&(this.objectsClippable[f]=v.clippable),c&&(this.objectsPickable[f]=v.pickable),l){var g=v.colorize;this.objectsColorize[3*f+0]=g[0],this.objectsColorize[3*f+1]=g[1],this.objectsColorize[3*f+2]=g[2]}u&&(this.objectsOpacity[f]=v.opacity),this.numObjects++}}}},{key:"restoreObjects",value:function(e,t){for(var n=this._mask,r=!n||n.visible,i=!n||n.edges,s=!n||n.xrayed,a=!n||n.highlighted,o=!n||n.selected,A=!n||n.clippable,c=!n||n.pickable,l=!n||n.colorize,u=!n||n.opacity,h=t.metaObjects,d=e.objects,f=0,p=h.length;f<p;f++){var v=d[h[f].id];v&&(r&&(v.visible=this.objectsVisible[f]),i&&(v.edges=this.objectsEdges[f]),s&&(v.xrayed=this.objectsXrayed[f]),a&&(v.highlighted=this.objectsHighlighted[f]),o&&(v.selected=this.objectsSelected[f]),A&&(v.clippable=this.objectsClippable[f]),c&&(v.pickable=this.objectsPickable[f]),l&&(Xo[0]=this.objectsColorize[3*f+0],Xo[1]=this.objectsColorize[3*f+1],Xo[2]=this.objectsColorize[3*f+2],v.colorize=Xo),u&&(v.opacity=this.objectsOpacity[f]))}}}]),e}(),Zo=De.vec3(),Jo=function(){function e(){x(this,e),this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsHasColorize=[],this.objectsOpacity=[],this.numObjects=0}return I(e,[{key:"saveObjects",value:function(e,t){this.numObjects=0,this._mask=t?je.apply(t,{}):null;var n=e.objects,r=!t||t.visible,i=!t||t.edges,s=!t||t.xrayed,a=!t||t.highlighted,o=!t||t.selected,A=!t||t.clippable,c=!t||t.pickable,l=!t||t.colorize,u=!t||t.opacity;for(var h in n)if(n.hasOwnProperty(h)){var d=n[h],f=this.numObjects;if(r&&(this.objectsVisible[f]=d.visible),i&&(this.objectsEdges[f]=d.edges),s&&(this.objectsXrayed[f]=d.xrayed),a&&(this.objectsHighlighted[f]=d.highlighted),o&&(this.objectsSelected[f]=d.selected),A&&(this.objectsClippable[f]=d.clippable),c&&(this.objectsPickable[f]=d.pickable),l){var p=d.colorize;p?(this.objectsColorize[3*f+0]=p[0],this.objectsColorize[3*f+1]=p[1],this.objectsColorize[3*f+2]=p[2],this.objectsHasColorize[f]=!0):this.objectsHasColorize[f]=!1}u&&(this.objectsOpacity[f]=d.opacity),this.numObjects++}}},{key:"restoreObjects",value:function(e){var t=this._mask,n=!t||t.visible,r=!t||t.edges,i=!t||t.xrayed,s=!t||t.highlighted,a=!t||t.selected,o=!t||t.clippable,A=!t||t.pickable,c=!t||t.colorize,l=!t||t.opacity,u=0,h=e.objects;for(var d in h)if(h.hasOwnProperty(d)){var f=h[d];n&&(f.visible=this.objectsVisible[u]),r&&(f.edges=this.objectsEdges[u]),i&&(f.xrayed=this.objectsXrayed[u]),s&&(f.highlighted=this.objectsHighlighted[u]),a&&(f.selected=this.objectsSelected[u]),o&&(f.clippable=this.objectsClippable[u]),A&&(f.pickable=this.objectsPickable[u]),c&&(this.objectsHasColorize[u]?(Zo[0]=this.objectsColorize[3*u+0],Zo[1]=this.objectsColorize[3*u+1],Zo[2]=this.objectsColorize[3*u+2],f.colorize=Zo):f.colorize=null),l&&(f.opacity=this.objectsOpacity[u]),u++}}}]),e}(),Yo=function(e){m(n,mt);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).v0=i.v0,r.v1=i.v1,r.v2=i.v2,r.v3=i.v3,r.t=i.t,r}return I(n,[{key:"v0",get:function(){return this._v0},set:function(e){this._v0=e||De.vec3([0,0,0])}},{key:"v1",get:function(){return this._v1},set:function(e){this._v1=e||De.vec3([0,0,0])}},{key:"v2",get:function(){return this._v2},set:function(e){this._v2=e||De.vec3([0,0,0])}},{key:"v3",get:function(){return this._v3},set:function(e){this.fire("v3",this._v3=e||De.vec3([0,0,0]))}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"getPoint",value:function(e){var t=De.vec3();return t[0]=De.b3(e,this._v0[0],this._v1[0],this._v2[0],this._v3[0]),t[1]=De.b3(e,this._v0[1],this._v1[1],this._v2[1],this._v3[1]),t[2]=De.b3(e,this._v0[2],this._v1[2],this._v2[2],this._v3[2]),t}},{key:"getJSON",value:function(){return{v0:this._v0,v1:this._v1,v2:this._v2,v3:this._v3,t:this._t}}}]),n}(),qo=function(e){m(n,mt);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._cachedLengths=[],r._dirty=!0,r._curves=[],r._t=0,r._dirtySubs=[],r._destroyedSubs=[],r.curves=i.curves||[],r.t=i.t,r}return I(n,[{key:"addCurve",value:function(e){this._curves.push(e),this._dirty=!0}},{key:"curves",get:function(){return this._curves},set:function(e){var t,n,r;for(e=e||[],n=0,r=this._curves.length;n<r;n++)(t=this._curves[n]).off(this._dirtySubs[n]),t.off(this._destroyedSubs[n]);this._curves=[],this._dirtySubs=[],this._destroyedSubs=[];var i=this;function s(){i._dirty=!0}function a(){var e=this.id;for(n=0,r=i._curves.length;n<r;n++)if(i._curves[n].id===e)return i._curves=i._curves.slice(n,n+1),i._dirtySubs=i._dirtySubs.slice(n,n+1),i._destroyedSubs=i._destroyedSubs.slice(n,n+1),void(i._dirty=!0)}for(n=0,r=e.length;n<r;n++){if(t=e[n],je.isNumeric(t)||je.isString(t)){var o=t;if(!(t=this.scene.components[o])){this.error("Component not found: "+_inQuotes(o));continue}}var A=t.type;"xeokit.SplineCurve"===A||"xeokit.Path"===A||"xeokit.CubicBezierCurve"===A||"xeokit.QuadraticBezierCurve"===A?(this._curves.push(t),this._dirtySubs.push(t.on("dirty",s)),this._destroyedSubs.push(t.once("destroyed",a))):this.error("Component "+_inQuotes(t.id)+" is not a xeokit.SplineCurve, xeokit.Path or xeokit.QuadraticBezierCurve")}this._dirty=!0}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"length",get:function(){var e=this._getCurveLengths();return e[e.length-1]}},{key:"getPoint",value:function(e){for(var t,n=e*this.length,r=this._getCurveLengths(),i=0;i<r.length;){if(r[i]>=n){var s=1-(r[i]-n)/(t=this._curves[i]).length;return t.getPointAt(s)}i++}return null}},{key:"_getCurveLengths",value:function(){if(!this._dirty)return this._cachedLengths;var e,t=[],n=0,r=this._curves.length;for(e=0;e<r;e++)n+=this._curves[e].length,t.push(n);return this._cachedLengths=t,this._dirty=!1,t}},{key:"_getJSON",value:function(){for(var e=[],t=0,n=this._curves.length;t<n;t++)e.push(this._curves[t].id);return{curves:e,t:this._t}}},{key:"destroy",value:function(){var e,t,r;for(v(C(n.prototype),"destroy",this).call(this),e=0,t=this._curves.length;e<t;e++)(r=this._curves[e]).off(this._dirtySubs[e]),r.off(this._destroyedSubs[e])}}]),n}(),$o=function(e){m(n,mt);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).v0=i.v0,r.v1=i.v1,r.v2=i.v2,r.t=i.t,r}return I(n,[{key:"v0",get:function(){return this._v0},set:function(e){this._v0=e||De.vec3([0,0,0])}},{key:"v1",get:function(){return this._v1},set:function(e){this._v1=e||De.vec3([0,0,0])}},{key:"v2",get:function(){return this._v2},set:function(e){this._v2=e||De.vec3([0,0,0])}},{key:"t",get:function(){return this._t},set:function(e){e=e||0,this._t=e<0?0:e>1?1:e}},{key:"point",get:function(){return this.getPoint(this._t)}},{key:"getPoint",value:function(e){var t=De.vec3();return t[0]=De.b2(e,this._v0[0],this._v1[0],this._v2[0]),t[1]=De.b2(e,this._v0[1],this._v1[1],this._v2[1]),t[2]=De.b2(e,this._v0[2],this._v1[2],this._v2[2]),t}},{key:"getJSON",value:function(){return{v0:this._v0,v1:this._v1,v2:this._v2,t:this._t}}}]),n}(),eA=function(e){m(n,Uo);var t=_(n);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),t.call(this,e,r)}return I(n)}(),tA=De.vec3(),nA=De.vec3(),rA=De.vec4(),iA=De.vec3([0,0,-1]),sA=De.vec3([0,0,1]),aA=De.vec3([0,1,0]),oA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({active:!0,pos:De.vec3(),quaternion:De.vec4(),roll:0,dir:De.vec3(),dist:0}),r.active=i.active,r.pos=i.pos,r.dir=i.dir,r.scene._sectionPlaneCreated(w(r)),r}return I(n,[{key:"type",get:function(){return"SectionPlane"}},{key:"active",get:function(){return this._state.active},set:function(e){this._state.active=!1!==e,this.glRedraw(),this.fire("active",this._state.active),this.scene.fire("sectionPlaneUpdated",this)}},{key:"pos",get:function(){return this._state.pos},set:function(e){this._state.pos.set(e||[0,0,0]),this._state.dist=-De.dotVec3(this._state.pos,this._state.dir),this.fire("pos",this._state.pos),this.scene.fire("sectionPlaneUpdated",this)}},{key:"quaternion",get:function(){return this._state.quaternion},set:function(e){this._state.quaternion.set(e||[0,0,0,-1]),De.vec3ApplyQuaternion(this._state.quaternion,sA,this._state.dir);var t=De.vec3ApplyQuaternion(this._state.quaternion,aA,tA),n=De.vec3PairToQuaternion(sA,this._state.dir,rA),r=De.vec3ApplyQuaternion(n,aA,nA),i=Math.acos(Math.min(1,De.dotVec3(t,r))),s=Math.sign(De.dotVec3(this._state.dir,De.cross3Vec3(t,r,nA)));this._state.roll=s*i,this._onDirUpdated()}},{key:"roll",get:function(){return this._state.roll},set:function(e){this._state.roll=e||0,this._onDirRollUpdated()}},{key:"dir",get:function(){return this._state.dir},set:function(e){this._state.dir.set(e||iA),this._onDirRollUpdated()}},{key:"_onDirRollUpdated",value:function(){De.vec3PairToQuaternion(sA,this._state.dir,this._state.quaternion),rA[0]=0,rA[1]=0,rA[2]=-1,rA[3]=this._state.roll,De.angleAxisToQuaternion(rA,rA),De.mulQuaternions(this._state.quaternion,rA,this._state.quaternion),this._onDirUpdated()}},{key:"_onDirUpdated",value:function(){this._state.dist=-De.dotVec3(this._state.pos,this._state.dir),this.glRedraw(),this.fire("dir",this._state.dir),this.scene.fire("sectionPlaneUpdated",this)}},{key:"dist",get:function(){return this._state.dist}},{key:"flipDir",value:function(){De.mulVec3Scalar(this._state.dir,-1,this._state.dir),this.dir=this._state.dir}},{key:"destroy",value:function(){this._state.destroy(),this.scene._sectionPlaneDestroyed(this),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),AA=function(){function e(){x(this,e)}return I(e,[{key:"transcode",value:function(e,t){}},{key:"destroy",value:function(){}}]),e}(),cA=function(){function e(){x(this,e),this.entity=null,this.primitive=null,this.primIndex=-1,this.pickSurfacePrecision=!1,this.touchInput=!1,this.snappedToEdge=!1,this.snappedToVertex=!1,this._origin=new Float64Array([0,0,0]),this._direction=new Float64Array([0,0,0]),this._indices=new Int32Array(3),this._localPos=new Float64Array([0,0,0]),this._worldPos=new Float64Array([0,0,0]),this._viewPos=new Float64Array([0,0,0]),this._canvasPos=new Int16Array([0,0]),this._snappedCanvasPos=new Int16Array([0,0]),this._bary=new Float64Array([0,0,0]),this._worldNormal=new Float64Array([0,0,0]),this._uv=new Float64Array([0,0]),this.reset()}return I(e,[{key:"canvasPos",get:function(){return this._gotCanvasPos?this._canvasPos:null},set:function(e){e?(this._canvasPos[0]=e[0],this._canvasPos[1]=e[1],this._gotCanvasPos=!0):this._gotCanvasPos=!1}},{key:"origin",get:function(){return this._gotOrigin?this._origin:null},set:function(e){e?(this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this._gotOrigin=!0):this._gotOrigin=!1}},{key:"direction",get:function(){return this._gotDirection?this._direction:null},set:function(e){e?(this._direction[0]=e[0],this._direction[1]=e[1],this._direction[2]=e[2],this._gotDirection=!0):this._gotDirection=!1}},{key:"indices",get:function(){return this.entity&&this._gotIndices?this._indices:null},set:function(e){e?(this._indices[0]=e[0],this._indices[1]=e[1],this._indices[2]=e[2],this._gotIndices=!0):this._gotIndices=!1}},{key:"localPos",get:function(){return this.entity&&this._gotLocalPos?this._localPos:null},set:function(e){e?(this._localPos[0]=e[0],this._localPos[1]=e[1],this._localPos[2]=e[2],this._gotLocalPos=!0):this._gotLocalPos=!1}},{key:"snappedCanvasPos",get:function(){return this._gotSnappedCanvasPos?this._snappedCanvasPos:null},set:function(e){e?(this._snappedCanvasPos[0]=e[0],this._snappedCanvasPos[1]=e[1],this._gotSnappedCanvasPos=!0):this._gotSnappedCanvasPos=!1}},{key:"worldPos",get:function(){return this._gotWorldPos?this._worldPos:null},set:function(e){e?(this._worldPos[0]=e[0],this._worldPos[1]=e[1],this._worldPos[2]=e[2],this._gotWorldPos=!0):this._gotWorldPos=!1}},{key:"viewPos",get:function(){return this.entity&&this._gotViewPos?this._viewPos:null},set:function(e){e?(this._viewPos[0]=e[0],this._viewPos[1]=e[1],this._viewPos[2]=e[2],this._gotViewPos=!0):this._gotViewPos=!1}},{key:"bary",get:function(){return this.entity&&this._gotBary?this._bary:null},set:function(e){e?(this._bary[0]=e[0],this._bary[1]=e[1],this._bary[2]=e[2],this._gotBary=!0):this._gotBary=!1}},{key:"worldNormal",get:function(){return this.entity&&this._gotWorldNormal?this._worldNormal:null},set:function(e){e?(this._worldNormal[0]=e[0],this._worldNormal[1]=e[1],this._worldNormal[2]=e[2],this._gotWorldNormal=!0):this._gotWorldNormal=!1}},{key:"uv",get:function(){return this.entity&&this._gotUV?this._uv:null},set:function(e){e?(this._uv[0]=e[0],this._uv[1]=e[1],this._gotUV=!0):this._gotUV=!1}},{key:"snapped",get:function(){return this.snappedToEdge||this.snappedToVertex}},{key:"reset",value:function(){this.entity=null,this.primIndex=-1,this.primitive=null,this.pickSurfacePrecision=!1,this._gotCanvasPos=!1,this._gotSnappedCanvasPos=!1,this._gotOrigin=!1,this._gotDirection=!1,this._gotIndices=!1,this._gotLocalPos=!1,this._gotWorldPos=!1,this._gotViewPos=!1,this._gotBary=!1,this._gotWorldNormal=!1,this._gotUV=!1,this.touchInput=!1,this.snappedToEdge=!1,this.snappedToVertex=!1}}]),e}(),lA={isIphoneSafari:function(){var e=window.navigator.userAgent,t=/iPhone/i.test(e),n=/Safari/i.test(e)&&!/Chrome/i.test(e);return t&&n},isIphoneOrIpadSafari:function(){var e=window.navigator.userAgent,t=/iPhone|iPad/i.test(e)||/Macintosh/i.test(e)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,n=/Safari/i.test(e)&&!/Chrome/i.test(e);return t&&n},isTouchDevice:function(){return"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.mxMaxTouchPoints>0}},uA=function(){function e(t,n,r){x(this,e),this.id=r&&r.id?r.id:t,this.viewer=n,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,n.addPlugin(this)}return I(e,[{key:"scheduleTask",value:function(e){tt.scheduleTask(e,null)}},{key:"fire",value:function(e,t,n){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==n&&(this._events[e]=t||!0);var r,i=this._eventSubs[e];if(i)for(var s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}},{key:"on",value:function(e,t,n){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new O),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});var r=this._eventSubs[e];r?this._eventSubsNum[e]++:(r={},this._eventSubs[e]=r,this._eventSubsNum[e]=1);var i=this._subIdMap.addItem();r[i]={callback:t,scope:n||this},this._subIdEvents[i]=e;var s=this._events[e];return void 0!==s&&t.call(n||this,s),i}},{key:"off",value:function(e){if(null!=e&&this._subIdEvents){var t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];var n=this._eventSubs[t];n&&(delete n[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}}},{key:"once",value:function(e,t,n){var r=this,i=this.on(e,(function(e){r.off(i),t.call(n||this,e)}),n)}},{key:"hasSubs",value:function(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}},{key:"log",value:function(e){console.log("[xeokit plugin ".concat(this.id,"]: ").concat(e))}},{key:"warn",value:function(e){console.warn("[xeokit plugin ".concat(this.id,"]: ").concat(e))}},{key:"error",value:function(e){console.error("[xeokit plugin ".concat(this.id,"]: ").concat(e))}},{key:"send",value:function(e,t){}},{key:"destroy",value:function(){this.viewer.removePlugin(this)}}]),e}(),hA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._canvas=i.canvas,r._element=null,r._isCustom=!1,i.elementId&&(r._element=document.getElementById(i.elementId),r._element?r._adjustPosition():r.error("Can't find given Spinner HTML element: '"+i.elementId+"' - will automatically create default element")),r._element||r._createDefaultSpinner(),r.processes=0,r}return I(n,[{key:"type",get:function(){return"Spinner"}},{key:"_createDefaultSpinner",value:function(){this._injectDefaultCSS();var e=document.createElement("div"),t=e.style;t["z-index"]="9000",t.position="absolute",e.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>',this._canvas.parentElement.appendChild(e),this._element=e,this._isCustom=!1,this._adjustPosition()}},{key:"_injectDefaultCSS",value:function(){var e="xeokit-spinner-css";if(!document.getElementById(e)){var t=document.createElement("style");t.innerHTML=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }",t.id=e,document.body.appendChild(t)}}},{key:"_adjustPosition",value:function(){if(!this._isCustom){var e=this._canvas,t=this._element,n=t.style;n.left=e.offsetLeft+.5*e.clientWidth-.5*t.clientWidth+"px",n.top=e.offsetTop+.5*e.clientHeight-.5*t.clientHeight+"px"}}},{key:"processes",get:function(){return this._processes},set:function(e){if(e=e||0,this._processes!==e&&!(e<0)){var t=this._processes;this._processes=e;var n=this._element;n&&(n.style.visibility=this._processes>0?"visible":"hidden"),this.fire("processes",this._processes),0===this._processes&&this._processes!==t&&this.fire("zeroProcesses",this._processes)}}},{key:"_destroy",value:function(){this._element&&!this._isCustom&&(this._element.parentNode.removeChild(this._element),this._element=null);var e=document.getElementById("xeokit-spinner-css");e&&e.parentNode.removeChild(e)}}]),n}(),dA=["webgl2","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"],fA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e,i))._backgroundColor=De.vec3([i.backgroundColor?i.backgroundColor[0]:1,i.backgroundColor?i.backgroundColor[1]:1,i.backgroundColor?i.backgroundColor[2]:1]),r._backgroundColorFromAmbientLight=!!i.backgroundColorFromAmbientLight,r.canvas=i.canvas,r.gl=null,r.webgl2=!1,r.transparent=!!i.transparent,r.contextAttr=i.contextAttr||{},r.contextAttr.alpha=r.transparent,r.contextAttr.preserveDrawingBuffer=!!r.contextAttr.preserveDrawingBuffer,r.contextAttr.stencil=!1,r.contextAttr.premultipliedAlpha=!!r.contextAttr.premultipliedAlpha,r.contextAttr.antialias=!1!==r.contextAttr.antialias,r.resolutionScale=i.resolutionScale,r.canvas.width=Math.round(r.canvas.clientWidth*r._resolutionScale),r.canvas.height=Math.round(r.canvas.clientHeight*r._resolutionScale),r.boundary=[r.canvas.offsetLeft,r.canvas.offsetTop,r.canvas.clientWidth,r.canvas.clientHeight],r._initWebGL(i);var s=w(r),a=!0,o=new ResizeObserver((function(e){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){t.value.contentBoxSize&&(a=!0)}}catch(e){n.e(e)}finally{n.f()}}));return o.observe(r.canvas),r._tick=r.scene.on("tick",(function(){a&&(a=!1,s.canvas.width=Math.round(s.canvas.clientWidth*s._resolutionScale),s.canvas.height=Math.round(s.canvas.clientHeight*s._resolutionScale),s.boundary[0]=s.canvas.offsetLeft,s.boundary[1]=s.canvas.offsetTop,s.boundary[2]=s.canvas.clientWidth,s.boundary[3]=s.canvas.clientHeight,s.fire("boundary",s.boundary))})),r._spinner=new hA(r.scene,{canvas:r.canvas,elementId:i.spinnerElementId}),r}return I(n,[{key:"type",get:function(){return"Canvas"}},{key:"backgroundColorFromAmbientLight",get:function(){return this._backgroundColorFromAmbientLight},set:function(e){this._backgroundColorFromAmbientLight=!1!==e,this.glRedraw()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){e?(this._backgroundColor[0]=e[0],this._backgroundColor[1]=e[1],this._backgroundColor[2]=e[2]):(this._backgroundColor[0]=1,this._backgroundColor[1]=1,this._backgroundColor[2]=1),this.glRedraw()}},{key:"resolutionScale",get:function(){return this._resolutionScale},set:function(e){if((e=e||1)!==this._resolutionScale){this._resolutionScale=e;var t=this.canvas;t.width=Math.round(t.clientWidth*this._resolutionScale),t.height=Math.round(t.clientHeight*this._resolutionScale),this.glRedraw()}}},{key:"spinner",get:function(){return this._spinner}},{key:"_createCanvas",value:function(){var e="xeokit-canvas-"+De.createUUID(),t=document.getElementsByTagName("body")[0],n=document.createElement("div"),r=n.style;r.height="100%",r.width="100%",r.padding="0",r.margin="0",r.background="rgba(0,0,0,0);",r.float="left",r.left="0",r.top="0",r.position="absolute",r.opacity="1.0",r["z-index"]="-10000",n.innerHTML+='<canvas id="'+e+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>',t.appendChild(n),this.canvas=document.getElementById(e)}},{key:"_getElementXY",value:function(e){for(var t=0,n=0;e;)t+=e.offsetLeft-e.scrollLeft,n+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:n}}},{key:"_initWebGL",value:function(){if(!this.gl)for(var e=0;!this.gl&&e<dA.length;e++)try{this.gl=this.canvas.getContext(dA[e],this.contextAttr)}catch(e){}this.gl||(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0));var t=this.gl,n="__",r=t.activeTexture;t.activeTexture=function(e){n!==e&&(n=e,r.call(this,e))};var i={},s=t.bindTexture;t.bindTexture=function(e,t){i[n]!==t&&(i[n]=t,s.call(this,e,t))},this.gl&&this.webgl2&&(this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST),this.gl,WebGL2RenderingContext)}},{key:"getSnapshot",value:function(e){throw"Canvas#getSnapshot() has been replaced by Viewer#getSnapshot() - use that method instead."}},{key:"readPixels",value:function(e,t,n){return this.scene._renderer.snapshot.readPixels(e,t,n)}},{key:"loseWebGLContext",value:function(){this.canvas.loseContext&&this.canvas.loseContext()}},{key:"destroy",value:function(){this.scene.off(this._tick),this._spinner._destroy(),this.gl=null,v(C(n.prototype),"destroy",this).call(this)}}]),n}(),pA=function(){function e(t){x(this,e),this._matPool=[],this.reset()}return I(e,[{key:"reset",value:function(){this._matPoolNextFreeIndex=0,this._rtcViewMats={},this.lastProgramId=null,this.pbrEnabled=!1,this.colorTextureEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.drawElements=0,this.drawArrays=0,this.useProgram=0,this.bindTexture=0,this.bindArray=0,this.pass=0,this.viewParams={},this.viewParams.viewMatrix=null,this.viewParams.projMatrix=null,this.viewParams.near=.01,this.viewParams.far=5e3,this.pickInvisible=!1,this.lineWidth=1,this.snapPickLayerParams=[],this.snapPickCoordinateScale=De.vec3(),this.snapPickOrigin=De.vec3()}},{key:"getRTCViewMatrix",value:function(e,t){var n=this._rtcViewMats[e];return n||(n=this._getNewMat(),Bn(this.viewParams.viewMatrix,t,n),this._rtcViewMats[e]=n),n}},{key:"_getNewMat",value:function(){var e=this._matPool[this._matPoolNextFreeIndex];return e||(e=De.mat4(),this._matPool[this._matPoolNextFreeIndex]=e),this._matPoolNextFreeIndex++,e}}]),e}(),vA={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},gA=document.createElement("canvas");if(gA){var mA=gA.getContext("webgl",{antialias:!0})||gA.getContext("experimental-webgl",{antialias:!0});vA.WEBGL=!!mA,vA.WEBGL&&(vA.ANTIALIAS=mA.getContextAttributes().antialias,mA.getShaderPrecisionFormat?mA.getShaderPrecisionFormat(mA.FRAGMENT_SHADER,mA.HIGH_FLOAT).precision>0?vA.FS_MAX_FLOAT_PRECISION="highp":mA.getShaderPrecisionFormat(mA.FRAGMENT_SHADER,mA.MEDIUM_FLOAT).precision>0?vA.FS_MAX_FLOAT_PRECISION="mediump":vA.FS_MAX_FLOAT_PRECISION="lowp":vA.FS_MAX_FLOAT_PRECISION="mediump",vA.DEPTH_BUFFER_BITS=mA.getParameter(mA.DEPTH_BITS),vA.MAX_TEXTURE_SIZE=mA.getParameter(mA.MAX_TEXTURE_SIZE),vA.MAX_CUBE_MAP_SIZE=mA.getParameter(mA.MAX_CUBE_MAP_TEXTURE_SIZE),vA.MAX_RENDERBUFFER_SIZE=mA.getParameter(mA.MAX_RENDERBUFFER_SIZE),vA.MAX_TEXTURE_UNITS=mA.getParameter(mA.MAX_COMBINED_TEXTURE_IMAGE_UNITS),vA.MAX_TEXTURE_IMAGE_UNITS=mA.getParameter(mA.MAX_TEXTURE_IMAGE_UNITS),vA.MAX_VERTEX_ATTRIBS=mA.getParameter(mA.MAX_VERTEX_ATTRIBS),vA.MAX_VERTEX_UNIFORM_VECTORS=mA.getParameter(mA.MAX_VERTEX_UNIFORM_VECTORS),vA.MAX_FRAGMENT_UNIFORM_VECTORS=mA.getParameter(mA.MAX_FRAGMENT_UNIFORM_VECTORS),vA.MAX_VARYING_VECTORS=mA.getParameter(mA.MAX_VARYING_VECTORS),mA.getSupportedExtensions().forEach((function(e){vA.SUPPORTED_EXTENSIONS[e]=!0})))}var yA=function(){function e(t){x(this,e),this.aabb=De.AABB3(),this.origin=De.vec3(t),this.originHash=this.origin.join(),this.numMarkers=0,this.markers={},this.markerList=[],this.markerIndices={},this.positions=[],this.indices=[],this.positionsBuf=null,this.lenPositionsBuf=0,this.indicesBuf=null,this.sectionPlanesActive=[],this.occlusionTestList=[],this.lenOcclusionTestList=0,this.pixels=[],this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!1}return I(e,[{key:"addMarker",value:function(e){this.markers[e.id]=e,this.markerListDirty=!0,this.numMarkers++}},{key:"markerWorldPosUpdated",value:function(e){if(this.markers[e.id]){var t=this.markerIndices[e.id];this.positions[3*t+0]=e.worldPos[0],this.positions[3*t+1]=e.worldPos[1],this.positions[3*t+2]=e.worldPos[2],this.positionsDirty=!0}}},{key:"removeMarker",value:function(e){delete this.markers[e.id],this.markerListDirty=!0,this.numMarkers--}},{key:"update",value:function(e,t){if(this.markerListDirty){for(var n in this.numMarkers=0,this.markers)this.markers.hasOwnProperty(n)&&(this.markerList[this.numMarkers]=this.markers[n],this.markerIndices[n]=this.numMarkers,this.numMarkers++);this.markerList.length=this.numMarkers,this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!0}if(this.positionsDirty){for(var r=0,i=0;i<this.numMarkers;i++)if(this.markerList[i]){var s=this.markerList[i].rtcPos;this.positions[r++]=s[0],this.positions[r++]=s[1],this.positions[r++]=s[2],this.indices[i]=i}this.positions.length=3*this.numMarkers,this.indices.length=this.numMarkers,this.positionsDirty=!1;var a=this.aabb;De.collapseAABB3(a),De.expandAABB3Points3(a,this.positions);var o=this.origin;a[0]+=o[0],a[1]+=o[1],a[2]+=o[2],a[3]+=o[0],a[4]+=o[1],a[5]+=o[2],this.positionsBuf&&this.lenPositionsBuf!==this.positions.length&&(this.positionsBuf.destroy(),this.positionsBuf=null,this.indicesBuf.destroy(),this.indicesBuf=null);var A=new Float32Array(this.positions);this.positionsBuf?this.positionsBuf.setData(A):(this.positionsBuf=new Tt(e,e.ARRAY_BUFFER,A,A.length,3,e.STATIC_DRAW),this.indicesBuf=new Tt(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.indices.length,1,e.STATIC_DRAW),this.lenPositionsBuf=this.positions.length)}if(this.occlusionTestListDirty){var c=0;this.lenOcclusionTestList=0;for(var l=0;l<this.numMarkers;l++){var u=this.markerList[l];u.entity&&!u.entity.visible||!t(u)?u._setVisible(!1):u.occludable?(this.occlusionTestList[this.lenOcclusionTestList++]=u,this.pixels[c++]=u.canvasPos[0],this.pixels[c++]=u.canvasPos[1]):u._setVisible(!0)}}}},{key:"destroy",value:function(){this.markers={},this.markerList.length=0,this.positionsBuf&&this.positionsBuf.destroy(),this.indicesBuf&&this.indicesBuf.destroy()}}]),e}(),_A=De.vec3([255,0,0]);De.vec3();var bA=function(){function e(t){var n=this;x(this,e),this._scene=t,this._occlusionLayers={},this._occlusionLayersList=[],this._occlusionLayersListDirty=!1,this._drawable=null,this._markersToOcclusionLayersMap={};var r=t.camera,i=function(){n._occlusionTestListDirty=!0};this._onCameraViewMatrix=r.on("viewMatrix",i),this._onCameraProjMatrix=r.on("projMatrix",i),this._onCanvasBoundary=t.canvas.on("boundary",i)}return I(e,[{key:"_addMarker",value:function(e,t){this._occlusionLayers[t]||(this._occlusionLayers[t]=new yA(e.origin),this._occlusionLayersListDirty=!0);var n=this._occlusionLayers[t];n.addMarker(e),this._markersToOcclusionLayersMap[e.id]=n}},{key:"_removeMarker",value:function(e,t){1===e.numMarkers?(e.destroy(),delete this._occlusionLayers[e.originHash],this._occlusionLayersListDirty=!0):e.removeMarker(t),delete this._markersToOcclusionLayersMap[t.id]}},{key:"addMarker",value:function(e){var t=e.origin.join();this._addMarker(e,t),this._occlusionTestListDirty=!0}},{key:"markerWorldPosUpdated",value:function(e){var t=this._markersToOcclusionLayersMap[e.id];if(t){var n=e.origin.join();n!==t.originHash?(this._removeMarker(t,e),this._addMarker(e,n)):t.markerWorldPosUpdated(e)}}},{key:"removeMarker",value:function(e){var t=e.origin.join(),n=this._occlusionLayers[t];n&&this._removeMarker(n,e)}},{key:"needOcclusionTest",get:function(){return this._occlusionTestListDirty}},{key:"drawMarkers",value:function(){var e=this,t=this._scene,n=t.canvas,r=n.gl,i=t._sectionPlanesState,s=[n.canvas.id,i.getHash()].join(";");if(!this._drawable||s!==this._drawable.shaderSourceHash){this._drawable&&this._drawable.destroy();var a=jr(),o=a.programVariables,A=o.createUniform("mat4","viewMatrix"),c=o.createUniform("mat4","projMatrix"),l=o.createAttribute("vec3","position"),u=o.createOutput("vec4","outColor"),h="clipPos",d=k(a.buildProgram(r,"OcclusionTester",{sectionPlanesState:i,getLogDepth:t.logarithmicDepthBufferEnabled&&function(e){return e},clippableTest:function(){return"true"},getVertexData:function(){var e=[];return e.push("vec4 worldPosition = vec4(".concat(l,", 1.0);")),e.push("vec4 ".concat(h," = ").concat(c," * ").concat(A," * worldPosition;")),!t.logarithmicDepthBufferEnabled&&t.markerZOffset<0&&e.push("".concat(h,".z += ").concat(t.markerZOffset,";")),e},worldPositionAttribute:"worldPosition",getPointSize:function(){return"20.0"},clipPos:h,appendFragmentOutputs:function(e){return e.push("".concat(u," = vec4(1.0, 0.0, 0.0, 1.0);"))}}),2),f=d[0],p=d[1];if(p)throw console.error(p.join("\n")),p.join("\n");this._occlusionTestListDirty=!0,this._drawable={shaderSourceHash:s,destroy:function(){return f.destroy()},drawCall:function(){var s=t.camera,a=s.project;f.bind(),c.setInputValue(a.matrix);var o=n.boundary,u=o[2],h=o[3],d=s.perspective.near,p=function(e){var t=e.viewPos,n=e.canvasPos,r=n[0],i=n[1];return t[2]<=-d&&r>=-10&&i>=-10&&r<=u+10&&i<=h+10};e._occlusionLayersList.forEach((function(e){e.update(r,p);var t=i.sectionPlanes.some((function(t,n){var r=t.active?De.planeAABB3Intersect(t.dir,t.dist,e.aabb):1,i=-1===r;return e.sectionPlanesActive[n]=0===r,i}));if(!t){var n=e.origin;A.setInputValue(Bn(s.viewMatrix,n)),f.inputSetters.setUniforms(null,{view:{far:a.far},mesh:{origin:n,renderFlags:{sectionPlanesActivePerLayer:e.sectionPlanesActive}}}),l.setInputValue(e.positionsBuf);var o=e.indicesBuf;o.bind(),r.drawElements(r.POINTS,o.numItems,o.itemType,0)}}))}}}if(this._occlusionLayersListDirty){var v=0;for(var g in this._occlusionLayers)this._occlusionLayers.hasOwnProperty(g)&&(this._occlusionLayersList[v++]=this._occlusionLayers[g]);this._occlusionLayersList.length=v,this._occlusionLayersListDirty=!1}if(this._occlusionTestListDirty){for(var m=0,y=this._occlusionLayersList.length;m<y;m++){this._occlusionLayersList[m].occlusionTestListDirty=!0}this._occlusionTestListDirty=!1}this._drawable.drawCall()}},{key:"doOcclusionTest",value:function(e){this._occlusionLayersList.forEach((function(t){for(var n=0;n<t.lenOcclusionTestList;n++){var r=2*n,i=e(t.pixels[r],t.pixels[r+1]);t.occlusionTestList[n]._setVisible(De.compareVec3(_A,i))}}))}},{key:"destroy",value:function(){this.destroyed||(this._occlusionLayersList.forEach((function(e){return e.destroy()})),this._drawable&&this._drawable.destroy(),this._scene.camera.off(this._onCameraViewMatrix),this._scene.camera.off(this._onCameraProjMatrix),this._scene.canvas.off(this._onCanvasBoundary),this.destroyed=!0)}}]),e}(),wA=De.vec3([0,0,0]),BA=function(e){for(var t=[],n=0;n<e;++n)t.push(n);return t},CA=BA(6).map((function(){return De.vec4()})),MA=De.vec4(),kA=De.vec4([1/4294967296,1/16777216,1/65536,1/256]),EA=function(e){return e[0]+(e[1]<<8)+(e[2]<<16)+(e[3]<<24)},FA=function(e){return De.normalizeVec3(De.divVec3Scalar(e,De.MAX_INT,De.vec3()))},xA=function(e,t,n){return De.vec3([e[0]*n[0]+t[0],e[1]*n[1]+t[1],e[2]*n[2]+t[2]])},UA=function(e,t){return function(n){for(var r=-1/0,i=1/0,s=0;s<3;s++){var a=e[s],o=t[s],A=n[s],c=n[s+3];if(Math.abs(o)<1e-8){if(a<A||a>c)return!1}else{var l=(A-a)/o,u=(c-a)/o;if((r=Math.max(r,Math.min(l,u)))>(i=Math.min(i,Math.max(l,u))))return!1}}return i>=0}},IA=function(e,t){var n=this;t=t||{};var r,i,s,a,o,A,c,l,u,h,d,f,p,v,g,m,y=new pA,_=e.canvas.canvas,b=e.canvas.gl,w=!!t.transparent,B=t.alphaDepthMask,C=new O({}),M={},E={},F=[],x=[],U=[],I=!0,T=!0,P=!0,S=!0,D=!0,Q=!0,R=!0,V=!0,L=(r={},i={},{getRenderBuffer:function(t,n,s){var a=1===e.canvas.resolutionScale?r:i;return a[t]||(a[t]=new So(b,n,s)),a[t]},destroy:function(){Object.values(r).forEach((function(e){return e.destroy()})),Object.values(i).forEach((function(e){return e.destroy()}))}}),H=function(e,t,n,r){var i=n.programVariables,s=i.createUniform("vec2","uViewportInv"),a=i.createUniform("float","uCameraNear"),o=i.createUniform("float","uCameraFar"),A=i.createUniform("sampler2D","uDepthTexture"),c=i.createAttribute("vec2","uv"),l=i.createVarying("vec2","vUV",(function(){return c})),u=i.createOutput("vec4","outColor"),h=i.createFragmentDefinition("getOutColor",(function(e,t){var n="getDepth";t.push("\n                float ".concat(n,"(const in vec2 uv) {\n                    return texture(").concat(A,", uv).r;\n                }\n            ")),t.push(r(e,l,s,a,o,n))})),d=k(n.buildProgram(e,t,{clipPos:"vec4(2.0 * ".concat(c," - 1.0, 0.0, 1.0)"),appendFragmentOutputs:function(e){return e.push("".concat(u," = ").concat(h,"();"))}}),2),f=d[0],p=d[1];if(p)throw console.error(p.join("\n")),p;var v=new Float32Array([1,1,0,1,0,0,1,0]),g=new Tt(e,e.ARRAY_BUFFER,v,v.length,2,e.STATIC_DRAW),m=new Uint32Array([0,1,2,0,2,3]),y=new Tt(e,e.ELEMENT_ARRAY_BUFFER,m,m.length,1,e.STATIC_DRAW);return{destroy:f.destroy,bind:function(e,t,n){f.bind(),s.setInputValue([1/e[0],1/e[1]]),a.setInputValue(t.near),o.setInputValue(t.far),A.setInputValue(n),c.setInputValue(g)},draw:function(){y.bind(),e.drawElements(e.TRIANGLES,y.numItems,y.itemType,0)}}},N=(s=null,a=null,{destroy:function(){return s&&s.destroy()},render:function(e,t,n,r){var i=Math.floor(n.numSamples);if(a!==i){s&&s.destroy();var o=jr(),A=o.programVariables,c=A.createUniform("mat4","uProjectMatrix"),l=A.createUniform("mat4","uInvProjMatrix"),u=A.createUniform("bool","uPerspective"),h=A.createUniform("float","uScale"),d=A.createUniform("float","uIntensity"),f=A.createUniform("float","uBias"),p=A.createUniform("float","uKernelRadius"),v=A.createUniform("float","uMinResolution"),g=A.createUniform("float","uRandomSeed"),m=H(b,"SAOOcclusionRenderer",o,(function(e,t,n,r,s,a){return"\n                                #define EPSILON 1e-6\n                                #define PI 3.14159265359\n                                #define PI2 6.28318530718\n                                #define NUM_SAMPLES ".concat(i,"\n                                #define NUM_RINGS 4\n\n                                const vec3 packFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\n                                vec4 packFloatToRGBA(const in float v) {\n                                    vec4 r = vec4(fract(v * packFactors), v);\n                                    r.yzw -= r.xyz / 256.;\n                                    return r * 256. / 255.;\n                                }\n\n                                highp float rand(const in vec2 uv) {\n                                    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n                                    return fract(sin(mod(dot(uv, vec2(a, b)), PI)) * c);\n                                }\n\n                                vec3 getViewPos(const in vec2 screenPos, const in float depth) {\n                                    float near = ").concat(r,";\n                                    float far  = ").concat(s,";\n                                    float viewZ = (").concat(u,"\n                                                   ? ((near * far) / ((far - near) * depth - far))\n                                                   : (depth * (near - far) - near));\n                                    float clipW = ").concat(c,"[2][3] * viewZ + ").concat(c,"[3][3];\n                                    return (").concat(l," * (clipW * vec4((vec3(screenPos, depth) - 0.5) * 2.0, 1.0))).xyz;\n                                }\n\n                                vec4 ").concat(e,"() {\n                                    float centerDepth = ").concat(a,"(").concat(t,");\n                                    if (centerDepth >= (1.0 - EPSILON)) {\n                                        discard;\n                                    }\n\n                                    vec3 centerViewPosition = getViewPos(").concat(t,", centerDepth);\n                                    float scaleDividedByCameraFar = ").concat(h," / ").concat(s,";\n                                    float minResolutionMultipliedByCameraFar = ").concat(v," * ").concat(s,";\n                                    vec3 centerViewNormal = normalize(cross(dFdx(centerViewPosition), dFdy(centerViewPosition)));\n\n                                    vec2 radiusStep = ").concat(p," * ").concat(n," / float(NUM_SAMPLES);\n                                    vec2 radius = radiusStep;\n                                    const float angleStep = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n                                    float angle = PI2 * rand(").concat(t," + ").concat(g,");\n\n                                    float occlusionSum = 0.0;\n                                    float weightSum = 0.0;\n\n                                    for (int i = 0; i < NUM_SAMPLES; i++) {\n                                        vec2 sampleUv = ").concat(t," + vec2(cos(angle), sin(angle)) * radius;\n                                        radius += radiusStep;\n                                        angle += angleStep;\n\n                                        float sampleDepth = ").concat(a,"(sampleUv);\n                                        if (sampleDepth >= (1.0 - EPSILON)) {\n                                            continue;\n                                        }\n\n                                        vec3 sampleViewPosition = getViewPos(sampleUv, sampleDepth);\n                                        vec3 viewDelta = sampleViewPosition - centerViewPosition;\n                                        float scaledScreenDistance = scaleDividedByCameraFar * length(viewDelta);\n                                        occlusionSum += max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - ").concat(f,") / (1.0 + scaledScreenDistance * scaledScreenDistance );\n                                        weightSum += 1.0;\n                                    }\n\n                                    return packFloatToRGBA(1.0 - occlusionSum * ").concat(d," / weightSum);\n                                }")}));s={destroy:m.destroy,render:function(e,t,n,r){m.bind(e,t,r),c.setInputValue(t.matrix),l.setInputValue(t.inverseMatrix),u.setInputValue("Perspective"===t.type),h.setInputValue(n.scale*t.far/5),d.setInputValue(n.intensity),f.setInputValue(n.bias),p.setInputValue(n.kernelRadius),v.setInputValue(n.minResolution),g.setInputValue(Math.random()),m.draw()}},a=i}s.render(e,t,n,r)}}),G=(A=(o=function(e){for(var t=[],n=0;n<=17;n++)t.push(e[0]*n),t.push(e[1]*n);return new Float32Array(t)})([0,1]),c=o([1,0]),l=new Float32Array(BA(17).map((function(e){return function(e,t){return Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t)}(e,4)}))),u=jr(),h=u.programVariables,d=h.createUniform("float","uDepthCutoff"),f=h.createUniformArray("vec2","uSampleOffsets",17),p=h.createUniformArray("float","uSampleWeights",17),v=h.createUniform("sampler2D","uOcclusionTex"),g=H(b,"SAODepthLimitedBlurRenderer",u,(function(e,t,n,r,i,s){return"\n                    #define EPSILON 1e-6\n\n                    const vec3 packFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\n                    vec4 packFloatToRGBA(const in float v) {\n                        vec4 r = vec4(fract(v * packFactors), v);\n                        r.yzw -= r.xyz / 256.;\n                        return r * 256. / 255.;\n                    }\n\n                    float getOcclusion(const in vec2 uv) {\n                        vec4 v = texture(".concat(v,", uv);\n                        return dot(floor(v * 255.0 + 0.5) / 255.0, 255. / 256. / vec4(packFactors, 1.)); // unpackRGBAToFloat\n                    }\n\n                    float getViewZ(const in float depth) {\n                        return (").concat(r," * ").concat(i,") / ((").concat(i," - ").concat(r,") * depth - ").concat(i,");\n                    }\n\n                    vec4 ").concat(e,"() {\n                        float centerDepth = ").concat(s,"(").concat(t,");\n                        if (centerDepth >= (1.0 - EPSILON)) {\n                            discard;\n                        }\n\n                        float centerViewZ = getViewZ(centerDepth);\n                        bool rBreak = false;\n                        bool lBreak = false;\n\n                        float weightSum = ").concat(p,"[0];\n                        float occlusionSum = getOcclusion(").concat(t,") * weightSum;\n\n                        for (int i = 1; i <= ").concat(16,"; i++) {\n                            float sampleWeight = ").concat(p,"[i];\n                            vec2 sampleUVOffset = ").concat(f,"[i] * ").concat(n,";\n\n                            if (! rBreak) {\n                                vec2 rSampleUV = ").concat(t," + sampleUVOffset;\n                                if (abs(centerViewZ - getViewZ(").concat(s,"(rSampleUV))) > ").concat(d,") {\n                                    rBreak = true;\n                                } else {\n                                    occlusionSum += getOcclusion(rSampleUV) * sampleWeight;\n                                    weightSum += sampleWeight;\n                                }\n                            }\n\n                            if (! lBreak) {\n                                vec2 lSampleUV = ").concat(t," - sampleUVOffset;\n                                if (abs(centerViewZ - getViewZ(").concat(s,"(lSampleUV))) > ").concat(d,") {\n                                    lBreak = true;\n                                } else {\n                                    occlusionSum += getOcclusion(lSampleUV) * sampleWeight;\n                                    weightSum += sampleWeight;\n                                }\n                            }\n                        }\n\n                        return packFloatToRGBA(occlusionSum / weightSum);\n                    }")})),{destroy:g.destroy,render:function(e,t,n,r,i){g.bind(e,t,r),d.setInputValue(.01),f.setInputValue(0===n?c:A),p.setInputValue(l),v.setInputValue(i),g.draw()}}),j=(m=null,function(){if(!m){var t=e.camera;m={get eye(){return t.eye},get far(){return t.project.far},get projMatrix(){return t.projMatrix},get viewMatrix(){return t.viewMatrix},get viewNormalMatrix(){return t.viewNormalMatrix}}}return m}),W=function(e,t){return"ortho"===e.projection?1:t/(2*Math.tan(.5*e.perspective.fov*Math.PI/180))};function z(){if(I&&(Object.values(M).forEach((function(e){var t=e.drawableListPreCull,n=0;Object.values(e.drawableMap).forEach((function(e){t[n++]=e})),t.length=n})),I=!1,T=!0),T){var e=0;Object.values(M).forEach((function(t){t.drawableListPreCull.forEach((function(t){F[e++]=t}))})),F.length=e,F.sort((function(e,t){return e.renderOrder-t.renderOrder})),T=!1,P=!0}if(P){var t=0,n=0;F.forEach((function(e){e.rebuildRenderFlags(),e.renderFlags.culled||(e.isUI?U[n++]=e:x[t++]=e)})),x.length=t,U.length=n}}this.scene=e,this._occlusionTester=null,this.capabilities={astcSupported:!!Bi(b,"WEBGL_compressed_texture_astc"),etc1Supported:!0,etc2Supported:!!Bi(b,"WEBGL_compressed_texture_etc"),dxtSupported:!!Bi(b,"WEBGL_compressed_texture_s3tc"),bptcSupported:!!Bi(b,"EXT_texture_compression_bptc"),pvrtcSupported:!(!Bi(b,"WEBGL_compressed_texture_pvrtc")&&!Bi(b,"WEBKIT_WEBGL_compressed_texture_pvrtc"))},this.setTransparentEnabled=function(e){S=e,P=!0},this.setEdgesEnabled=function(e){D=e,P=!0},this.setSAOEnabled=function(e){Q=e,P=!0},this.setPBREnabled=function(e){R=e,P=!0},this.setColorTextureEnabled=function(e){V=e,P=!0},this.needStateSort=function(){T=!0},this.shadowsDirty=function(){},this.imageDirty=function(){P=!0},this.addDrawable=function(e,t){var n=t.type;if(n){var r=M[n];r||(r={type:t.type,count:0,isStateSortable:t.isStateSortable,stateSortCompare:t.stateSortCompare,drawableMap:{},drawableListPreCull:[],drawableList:[]},M[n]=r),r.count++,r.drawableMap[e]=t,E[e]=t,I=!0}else console.error("Renderer#addDrawable() : drawable with ID "+e+" has no 'type' - ignoring")},this.removeDrawable=function(e){var t=E[e];if(t){var n=t.type,r=M[n];--r.count<=0?delete M[n]:delete r.drawableMap[e],delete E[e],I=!0}else console.error("Renderer#removeDrawable() : drawable not found with ID "+e+" - ignoring")},this.getPickID=function(e){return C.addItem(e)},this.putPickID=function(e){C.removeItem(e)},this.clear=function(t){if(b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),w)b.clearColor(1,1,1,1);else{var n=e.canvas.backgroundColorFromAmbientLight?this.lights.getAmbientColorAndIntensity():e.canvas.backgroundColor;b.clearColor(n[0],n[1],n[2],1)}b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)},this.needsRender=function(){return P||I||T},this.render=function(t,n){z(),P&&(!function(t,n){var r=e.sao,i=Q&&r.possible&&r.numSamples>=1&&function(t){var n=e.sao,r=[b.drawingBufferWidth,b.drawingBufferHeight],i=L.getRenderBuffer("saoDepth",[],!0);i.setSize(r),i.bind(),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),y.reset(),y.pass=t,y.viewParams=j(),y.nearPlaneHeight=W(e.camera,b.drawingBufferHeight),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),b.clearColor(0,0,0,0),b.enable(b.DEPTH_TEST),b.frontFace(b.CCW),b.enable(b.CULL_FACE),b.depthMask(!0),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),x.forEach((function(e){!e.culled&&e.visible&&e.drawDepth&&e.saoEnabled&&e.renderFlags.colorOpaque&&e.drawDepth(y)})),i.unbind();var s=i.depthTexture,a=L.getRenderBuffer("saoOcclusion");if(a.setSize(r),a.bind(),b.viewport(0,0,r[0],r[1]),b.clearColor(0,0,0,1),b.disable(b.DEPTH_TEST),b.disable(b.BLEND),b.frontFace(b.CCW),b.clear(b.COLOR_BUFFER_BIT),N.render(r,e.camera.project,n,s),a.unbind(),n.blur){var o=L.getRenderBuffer("saoOcclusion2");o.setSize(r);var A=function(t,n,i){n.bind(),b.viewport(0,0,r[0],r[1]),b.clearColor(0,0,0,1),b.enable(b.DEPTH_TEST),b.disable(b.BLEND),b.frontFace(b.CCW),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var a=e.camera.project;G.render(r,a,i,s,t.colorTextures[0]),n.unbind()};A(a,o,0),A(o,a,1)}return a.colorTextures[0]}(t);e._lightsState.lights.forEach((function(t){if(t.castsShadow){var n=t.getShadowRenderBuf();n.bind(),y.reset(),y.backfaces=!0,y.frontface=!0,y.viewParams.viewMatrix=t.getShadowViewMatrix(),y.viewParams.projMatrix=t.getShadowProjMatrix(),y.nearPlaneHeight=W(e.camera,b.drawingBufferHeight),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),b.clearColor(0,0,0,1),b.enable(b.DEPTH_TEST),b.disable(b.BLEND),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),Object.values(M).forEach((function(e){e.drawableList.forEach((function(e){!1!==e.visible&&e.castsShadow&&e.drawShadow&&e.renderFlags.colorOpaque&&e.drawShadow(y)}))})),n.unbind()}})),function(t,n,r){var i,s,a=[],o=[],A=[],c=[],l=[],u=[],h=[],d=[],f=[],p=[],v=[],g=[],m=[],_=[],C=[],M=[],k=e._lightsState.getAmbientColorAndIntensity();if(y.reset(),y.pass=t,y.withSAO=!1,y.pbrEnabled=R&&!!e.pbrEnabled,y.colorTextureEnabled=V&&!!e.colorTextureEnabled,y.viewParams=j(),y.nearPlaneHeight=W(e.camera,b.drawingBufferHeight),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),w)b.clearColor(0,0,0,0);else{var E=e.canvas.backgroundColorFromAmbientLight?k:e.canvas.backgroundColor;b.clearColor(E[0],E[1],E[2],1)}b.enable(b.DEPTH_TEST),b.frontFace(b.CCW),b.enable(b.CULL_FACE),b.depthMask(!0),b.lineWidth(1),y.lineWidth=1,e.sao,y.saoParams=[b.drawingBufferWidth,b.drawingBufferHeight,e.sao.blendCutoff,e.sao.blendFactor],y.occlusionTexture=r;var F=Date.now();n&&b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);y.testAABB=function(e){var t=De.mat4();De.mulMat4(e.projMatrix,e.viewMatrix,t);for(var n=0;n<3;++n)CA[2*n+0][0]=t[3]+t[n],CA[2*n+0][1]=t[7]+t[n+4],CA[2*n+0][2]=t[11]+t[n+8],CA[2*n+0][3]=t[15]+t[n+12],CA[2*n+1][0]=t[3]-t[n],CA[2*n+1][1]=t[7]-t[n+4],CA[2*n+1][2]=t[11]-t[n+8],CA[2*n+1][3]=t[15]-t[n+12];return CA.forEach((function(e){return De.divVec4Scalar(e,De.lenVec3(e),e)})),function(e){return CA.every((function(t){return MA[0]=e[t[0]>=0?3:0],MA[1]=e[t[1]>=0?4:1],MA[2]=e[t[2]>=0?5:2],MA[3]=1,De.dotVec4(t,MA)>=0}))}}(e.camera);var I=function(t){for(var n=0,k=0,E=0,F=0,x=0,U=0,I=0,T=0,P=0,Q=0,R=0,O=0,V=0,L=0,H=0,N=0,G=0,j=t.length;G<j;G++)if(!0!==(s=t[G]).culled&&!1!==s.visible){var W=s.renderFlags;W.colorOpaque&&(s.saoEnabled&&r?a[n++]=s:s.drawColorOpaque(y)),S&&W.colorTransparent&&(A[E++]=s),W.xrayedSilhouetteTransparent&&(h[I++]=s),W.xrayedSilhouetteOpaque&&(l[x++]=s),W.highlightedSilhouetteTransparent&&(v[R++]=s),W.highlightedSilhouetteOpaque&&(f[P++]=s),W.selectedSilhouetteTransparent&&(C[H++]=s),W.selectedSilhouetteOpaque&&(m[V++]=s),s.edges&&D&&(W.edgesOpaque&&(o[k++]=s),W.edgesTransparent&&(c[F++]=s),W.selectedEdgesTransparent&&(M[N++]=s),W.selectedEdgesOpaque&&(_[L++]=s),W.xrayedEdgesTransparent&&(d[T++]=s),W.xrayedEdgesOpaque&&(u[U++]=s),W.highlightedEdgesTransparent&&(g[O++]=s),W.highlightedEdgesOpaque&&(p[Q++]=s))}if(n>0)for(y.withSAO=!0,i=0;i<n;i++)a[i].drawColorOpaque(y);if(k>0)for(i=0;i<k;i++)o[i].drawEdgesColorOpaque(y);if(x>0)for(i=0;i<x;i++)l[i].drawSilhouetteXRayed(y);if(U>0)for(i=0;i<U;i++)u[i].drawEdgesXRayed(y);if(I>0||T>0||E>0||F>0){if(b.enable(b.CULL_FACE),b.enable(b.BLEND),w?(b.blendEquation(b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)):(b.blendEquation(b.FUNC_ADD),b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA)),y.backfaces=!1,B||b.depthMask(!1),(E>0||F>0)&&b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),F>0)for(i=0;i<F;i++)(s=c[i]).drawEdgesColorTransparent(y);if(E>0){var z=y.viewParams.eye;A.length=E;var X=A.map((function(e){return{drawable:e,distSq:De.distVec3(e.origin||wA,z)}}));for(X.sort((function(e,t){return t.distSq-e.distSq})),i=0;i<E;i++)X[i].drawable.drawColorTransparent(y)}if(T>0)for(i=0;i<T;i++)d[i].drawEdgesXRayed(y);if(I>0)for(i=0;i<I;i++)h[i].drawSilhouetteXRayed(y);b.disable(b.BLEND),B||b.depthMask(!0)}if(P>0||Q>0){if(y.lastProgramId=null,e.highlightMaterial.glowThrough&&b.clear(b.DEPTH_BUFFER_BIT),Q>0)for(i=0;i<Q;i++)p[i].drawEdgesHighlighted(y);if(P>0)for(i=0;i<P;i++)f[i].drawSilhouetteHighlighted(y)}if(R>0||O>0||P>0){if(y.lastProgramId=null,e.selectedMaterial.glowThrough&&b.clear(b.DEPTH_BUFFER_BIT),b.enable(b.BLEND),w?(b.blendEquation(b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),b.enable(b.CULL_FACE),O>0)for(i=0;i<O;i++)g[i].drawEdgesHighlighted(y);if(R>0)for(i=0;i<R;i++)v[i].drawSilhouetteHighlighted(y);b.disable(b.BLEND)}if(V>0||L>0){if(y.lastProgramId=null,e.selectedMaterial.glowThrough&&b.clear(b.DEPTH_BUFFER_BIT),L>0)for(i=0;i<L;i++)_[i].drawEdgesSelected(y);if(V>0)for(i=0;i<V;i++)m[i].drawSilhouetteSelected(y)}if(H>0||N>0){if(y.lastProgramId=null,e.selectedMaterial.glowThrough&&b.clear(b.DEPTH_BUFFER_BIT),b.enable(b.CULL_FACE),b.enable(b.BLEND),w?(b.blendEquation(b.FUNC_ADD),b.blendFuncSeparate(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA,b.ONE,b.ONE_MINUS_SRC_ALPHA)):b.blendFunc(b.SRC_ALPHA,b.ONE_MINUS_SRC_ALPHA),N>0)for(i=0;i<N;i++)M[i].drawEdgesSelected(y);if(H>0)for(i=0;i<H;i++)C[i].drawSilhouetteSelected(y);b.disable(b.BLEND)}};I(x),U.length>0&&(b.clear(b.DEPTH_BUFFER_BIT),I(U));y.testAABB=null;var T=Date.now(),P=Ve.frame;P.renderTime=(T-F)/1e3,P.drawElements=y.drawElements,P.drawArrays=y.drawArrays,P.useProgram=y.useProgram,P.bindTexture=y.bindTexture,P.bindArray=y.bindArray;for(var Q=vA.MAX_TEXTURE_IMAGE_UNITS,O=0;O<Q;O++)b.activeTexture(b.TEXTURE0+O);b.bindTexture(b.TEXTURE_CUBE_MAP,null),b.bindTexture(b.TEXTURE_2D,null);for(var L=vA.MAX_VERTEX_ATTRIBS,H=0;H<L;H++)b.disableVertexAttribArray(H)}(t,n,i)}(t,n),Ve.frame.frameCount++,P=!1)};var X,K,Z,J,Y,q=function(t,n,r,i,s,a,o){o.reset(),o.backfaces=!0,o.frontface=!0,o.viewParams.eye=i,o.viewParams.projMatrix=s,o.viewParams.viewMatrix=a,o.nearPlaneHeight=W(r,b.drawingBufferHeight);var A=e.canvas.resolutionScale;o.pickClipPos=[t?2*t[0]*A/b.drawingBufferWidth-1:0,t?1-2*t[1]*A/b.drawingBufferHeight:0],o.pickClipPosInv=[b.drawingBufferWidth/n,b.drawingBufferHeight/n]};this.pick=function(){var t=De.vec3(),n=De.vec3(),r=De.vec4(),i=De.vec4(),s=De.vec4(),a=De.vec4(),o=De.vec4(),A=De.mat4(),c=De.mat4(),l=De.mat4(),u=De.mat4(),h=De.vec3([0,1,0]),d=new cA,f=De.vec2(),p=De.vec3(),v=De.vec3(),g=De.vec3();De.vec3(),De.vec3();var m=new So(b);m.setSize([1,1]);var w=new So(b,[b.RGBA32I]);return w.setSize([3,3]),function(B){var M=arguments.length>1&&void 0!==arguments[1]?arguments[1]:d;M.reset(),z();var k=null,E=null,F=null,I=e.camera;if(M.pickSurface=B.pickSurface,B.canvasPos)p[0]=B.canvasPos[0],p[1]=B.canvasPos[1],k=I.viewMatrix,E=I.projMatrix,F=I.projection,f[0]=I.project.near,f[1]=I.project.far,M.canvasPos=B.canvasPos,De.canvasPosToWorldRay(_,k,E,F,p,t,n),y.testAABB=UA(t,n);else if(p[0]=.5*_.clientWidth,p[1]=.5*_.clientHeight,B.matrix)k=B.matrix,E=I.projMatrix,F=I.projection,f[0]=I.project.near,f[1]=I.project.far,De.canvasPosToWorldRay(_,k,E,F,p,t,n),y.testAABB=UA(t,n);else{v.set(B.origin||[0,0,0]),g.set(B.direction||[0,0,1]);var T=De.addVec3(v,g,t),P=n;Math.abs(De.dotVec3(g,h))>.999999?(P[0]=0,P[1]=0,P[2]=Math.sign(g[1])):(De.cross3Vec3(g,h,P),De.cross3Vec3(P,g,P),De.normalizeVec3(P,P)),k=De.lookAtMat4v(v,T,P,c),E=I.ortho.matrix,F="ortho",f[0]=I.ortho.near,f[1]=I.ortho.far,M.origin=v,M.direction=g,y.testAABB=UA(M.origin,M.direction)}m.bind();var S=function(e){return q(p,e,I,M.origin||I.eye,E||I.projMatrix,k||I.viewMatrix,y)};S(1),y.pickInvisible=!!B.pickInvisible,b.viewport(0,0,1,1),b.depthMask(!0),b.enable(b.DEPTH_TEST),b.disable(b.CULL_FACE),b.disable(b.BLEND),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);var D=B.includeEntityIds,Q=B.excludeEntityIds,R=function(e){e.forEach((function(e){e.culled||!e.visible||!e.pickable||!e.drawPickMesh||D&&!D[e.id]||Q&&Q[e.id]||e.drawPickMesh(y)}))};R(x),U.length>0&&(b.clear(b.DEPTH_BUFFER_BIT),R(U)),y.testAABB=null;var O=EA(m.read(0,0)),V=O>=0&&C.items[O];if(!V)return m.unbind(),null;var L=V.delegatePickedEntity?V.delegatePickedEntity():V;if(!L)return m.unbind(),null;if(B.pickSurface)if(V.canPickTriangle&&V.canPickTriangle())V.drawPickTriangles&&(S(1),b.viewport(0,0,1,1),b.clearColor(0,0,0,0),b.enable(b.DEPTH_TEST),b.disable(b.CULL_FACE),b.disable(b.BLEND),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),V.drawPickTriangles(y),M.primIndex=3*EA(m.read(0,0))),V.pickTriangleSurface(k,E,F,M),M.pickSurfacePrecision=!1;else if(V.canPickWorldPos&&V.canPickWorldPos()){S(1),y.viewParams.near=f[0],y.viewParams.far=f[1],b.viewport(0,0,1,1),b.clearColor(0,0,0,0),b.depthMask(!0),b.enable(b.DEPTH_TEST),b.disable(b.CULL_FACE),b.disable(b.BLEND),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),V.drawPickDepths(y);var H=De.dotVec4(m.read(0,0),kA),N=(p[0]-_.clientWidth/2)/(_.clientWidth/2),G=-(p[1]-_.clientHeight/2)/(_.clientHeight/2),j=V.origin,W=De.inverseMat4(De.mulMat4(E,j?Bn(k,j,A):k,l),u),X=function(e,t){return t[0]=N,t[1]=G,t[2]=e,t[3]=1,De.transformVec4(W,t,t),De.mulVec4Scalar(t,1/t[3])},K=X(-1,r),Z=X(1,i),J=De.subVec3(Z,K,s),Y=De.addVec3(K,De.mulVec4Scalar(J,H,a),o);if(j&&De.addVec3(Y,j),M.worldPos=Y,!1!==B.pickSurfaceNormal){S(3),w.bind(),b.viewport(0,0,w.size[0],w.size[1]),b.enable(b.DEPTH_TEST),b.disable(b.CULL_FACE),b.disable(b.BLEND),b.clear(b.DEPTH_BUFFER_BIT),b.clearBufferiv(b.COLOR,0,new Int32Array([0,0,0,0])),V.drawPickNormals(y);var $=w.read(1,1,b.RGBA_INTEGER,b.INT,Int32Array,4);w.unbind(),M.worldNormal=FA($)}M.pickSurfacePrecision=!1}return m.unbind(),M.entity=L,M}}(),this.snapPick=(X=new cA,K=function(){var e={};return function(t){if(!(t in e)){var n=new So(b,[b.RGBA32I,b.RGBA32I,b.RGBA8UI],!0);n.setSize([2*t+1,2*t+1]),e[t]=n}return e[t]}}(),function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:X,r=t.canvasPos,i=t.origin,s=t.direction,a=t.snapRadius,o=t.snapToVertex,A=t.snapToEdge;if(!o&&!A)return this.pick({canvasPos:r,pickSurface:!0});var c=e.camera,l=a||30,u=r?c.viewMatrix:De.lookAtMat4v(i,De.addVec3(i,s,De.vec3()),De.vec3([0,1,0]),De.mat4());q(r,2*l,c,c.eye,c.projMatrix,u,y);var h=K(l);h.bind(),b.viewport(0,0,h.size[0],h.size[1]),b.enable(b.DEPTH_TEST),b.frontFace(b.CCW),b.disable(b.CULL_FACE),b.depthMask(!0),b.disable(b.BLEND),b.depthFunc(b.LEQUAL),b.clear(b.DEPTH_BUFFER_BIT),b.clearBufferiv(b.COLOR,0,new Int32Array([0,0,0,0])),b.clearBufferiv(b.COLOR,1,new Int32Array([0,0,0,0])),b.clearBufferuiv(b.COLOR,2,new Uint32Array([0,0,0,0])),b.drawBuffers([b.COLOR_ATTACHMENT0,b.COLOR_ATTACHMENT1,b.COLOR_ATTACHMENT2]),y.snapPickLayerParams=[],y.snapPickLayerParams.push(null),x.forEach((function(e){!e.culled&&e.visible&&e.pickable&&e.drawSnapInit&&e.drawSnapInit(y)}));var d=y.snapPickLayerParams;y.snapPickLayerParams=[],b.depthMask(!1),b.drawBuffers([b.COLOR_ATTACHMENT0]);var f=function(e){y.snapMode=e,y.snapPickLayerParams.push(null),x.forEach((function(e){!e.culled&&e.visible&&e.pickable&&e.drawSnap&&e.drawSnap(y)}))};A&&f("edge"),o&&f("vertex"),b.depthMask(!0);var p=y.snapPickLayerParams,v=function(e,t,n){var r=h.buffer.width,i=h.buffer.height,s=new t(4*r*i);return b.readBuffer(e),b.readPixels(0,0,r,i,b.RGBA_INTEGER,n,s,0),s},g=v(b.COLOR_ATTACHMENT0,Int32Array,b.INT),m=v(b.COLOR_ATTACHMENT1,Int32Array,b.INT),_=v(b.COLOR_ATTACHMENT2,Uint32Array,b.UNSIGNED_INT);h.unbind();var w=null,B=null,M=null,k=l,E=l,F=4*k+E*h.size[0]*4,U=g.slice(F,F+4),I=m.slice(F,F+4),T=_.slice(F,F+4);if(0!==U[3]){var P=d[Math.abs(U[3])%d.length];w=xA(U,P.origin,P.coordinateScale),B=FA(I),M=C.items[EA(T)]}for(var S=[],D=0;D<g.length;D+=4){var Q=g[D+3];if(Q>0){var R=Math.floor(D/4),O=h.size[0],V=R%O-Math.floor(O/2),L=Math.floor(R/O)-Math.floor(O/2);S.push({dist:De.lenVec2([V,L]),isVertex:o&&A?Q>p.length/2:o,result:g.subarray(D,D+4),normal:m.subarray(D,D+4),id:_.subarray(D,D+4)})}}var H=function(e){return e&&e.delegatePickedEntity?e.delegatePickedEntity():e};if(S.length>0){var N=S.reduce((function(e,t){return(e.isVertex-t.isVertex||t.dist-e.dist)>0?e:t})),G=N.result,j=p[G[3]],W=xA(G,j.origin,j.coordinateScale),z=c.projectWorldPos(W);return n.reset(),n.snappedToEdge=!N.isVertex,n.snappedToVertex=N.isVertex,n.worldPos=W,n.worldNormal=FA(N.normal),n.entity=H(C.items[EA(N.id)]),n.canvasPos=r||w&&c.projectWorldPos(w)||z,n.snappedCanvasPos=z,n}return w?(n.reset(),n.snappedToEdge=!1,n.snappedToVertex=!1,n.worldPos=w,n.worldNormal=B,n.entity=H(M),n.canvasPos=r||c.projectWorldPos(w),n.snappedCanvasPos=r,n):null}),this.addMarker=function(t){this._occlusionTester=this._occlusionTester||new bA(e),this._occlusionTester.addMarker(t),e.occlusionTestCountdown=0},this.markerWorldPosUpdated=function(e){this._occlusionTester.markerWorldPosUpdated(e)},this.removeMarker=function(e){this._occlusionTester.removeMarker(e)},this.doOcclusionTest=function(){if(this._occlusionTester&&this._occlusionTester.needOcclusionTest){z();var t=L.getRenderBuffer("occlusionReadPix");if(t&&(t.setSize([b.drawingBufferWidth,b.drawingBufferHeight]),t.bind()),y.reset(),y.backfaces=!0,y.frontface=!0,y.viewParams=j(),y.nearPlaneHeight=W(e.camera,b.drawingBufferHeight),b.viewport(0,0,b.drawingBufferWidth,b.drawingBufferHeight),b.clearColor(0,0,0,0),b.enable(b.DEPTH_TEST),b.disable(b.CULL_FACE),b.disable(b.BLEND),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),x.forEach((function(e){!e.culled&&e.visible&&e.pickable&&e.drawOcclusion&&e.drawOcclusion(y)})),this._occlusionTester.drawMarkers(),t){var n=e.canvas.resolutionScale;this._occlusionTester.doOcclusionTest((function(e,r){return t.read(Math.round(n*e),Math.round(n*r))})),t.unbind()}}},this.snapshot=(Z=!1,J=new So(b),Y=null,{readPixels:function(e,t,r){J.bind(),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),P=!0,n.render();for(var i=0;i<r;i++){var s=2*i,a=4*i,o=J.read(e[s],e[s+1]);t[a]=o[0],t[a+1]=o[1],t[a+2]=o[2],t[a+3]=o[3]}J.unbind(),P=!0},beginSnapshot:function(){J.setSize([b.drawingBufferWidth,b.drawingBufferHeight]),J.bind(),b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),Z=!0},renderSnapshotToCanvas:function(){var e=J.buffer.width,t=J.buffer.height;return Y&&Y.width===e&&Y.height===t||(Y=function(){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=e,n.height=t;var i=new Uint8Array(e*t*4),s=r.createImageData(e,t);return{width:e,height:t,getUpdatedCanvas:function(){b.readPixels(0,0,e,t,b.RGBA,b.UNSIGNED_BYTE,i);for(var a=Math.floor(t/2),o=4*e,A=new Uint8Array(o),c=0;c<a;++c){var l=c*o,u=(t-c-1)*o;A.set(i.subarray(l,l+o)),i.copyWithin(l,u,u+o),i.set(A,u)}return s.data.set(i),r.resetTransform(),r.putImageData(s,0,0),n}}}()),Z&&(b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT),P=!0,n.render(),P=!0),Y.getUpdatedCanvas()},endSnapshot:function(){Z&&(J.unbind(),Z=!1),P=!0,n.render()}}),this.destroy=function(){M={},E={},L.destroy(),N.destroy(),G.destroy(),this._occlusionTester&&this._occlusionTester.destroy()}},TA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).KEY_BACKSPACE=8,r.KEY_TAB=9,r.KEY_ENTER=13,r.KEY_SHIFT=16,r.KEY_CTRL=17,r.KEY_ALT=18,r.KEY_PAUSE_BREAK=19,r.KEY_CAPS_LOCK=20,r.KEY_ESCAPE=27,r.KEY_PAGE_UP=33,r.KEY_PAGE_DOWN=34,r.KEY_END=35,r.KEY_HOME=36,r.KEY_LEFT_ARROW=37,r.KEY_UP_ARROW=38,r.KEY_RIGHT_ARROW=39,r.KEY_DOWN_ARROW=40,r.KEY_INSERT=45,r.KEY_DELETE=46,r.KEY_NUM_0=48,r.KEY_NUM_1=49,r.KEY_NUM_2=50,r.KEY_NUM_3=51,r.KEY_NUM_4=52,r.KEY_NUM_5=53,r.KEY_NUM_6=54,r.KEY_NUM_7=55,r.KEY_NUM_8=56,r.KEY_NUM_9=57,r.KEY_A=65,r.KEY_B=66,r.KEY_C=67,r.KEY_D=68,r.KEY_E=69,r.KEY_F=70,r.KEY_G=71,r.KEY_H=72,r.KEY_I=73,r.KEY_J=74,r.KEY_K=75,r.KEY_L=76,r.KEY_M=77,r.KEY_N=78,r.KEY_O=79,r.KEY_P=80,r.KEY_Q=81,r.KEY_R=82,r.KEY_S=83,r.KEY_T=84,r.KEY_U=85,r.KEY_V=86,r.KEY_W=87,r.KEY_X=88,r.KEY_Y=89,r.KEY_Z=90,r.KEY_LEFT_WINDOW=91,r.KEY_RIGHT_WINDOW=92,r.KEY_SELECT_KEY=93,r.KEY_NUMPAD_0=96,r.KEY_NUMPAD_1=97,r.KEY_NUMPAD_2=98,r.KEY_NUMPAD_3=99,r.KEY_NUMPAD_4=100,r.KEY_NUMPAD_5=101,r.KEY_NUMPAD_6=102,r.KEY_NUMPAD_7=103,r.KEY_NUMPAD_8=104,r.KEY_NUMPAD_9=105,r.KEY_MULTIPLY=106,r.KEY_ADD=107,r.KEY_SUBTRACT=109,r.KEY_DECIMAL_POINT=110,r.KEY_DIVIDE=111,r.KEY_F1=112,r.KEY_F2=113,r.KEY_F3=114,r.KEY_F4=115,r.KEY_F5=116,r.KEY_F6=117,r.KEY_F7=118,r.KEY_F8=119,r.KEY_F9=120,r.KEY_F10=121,r.KEY_F11=122,r.KEY_F12=123,r.KEY_NUM_LOCK=144,r.KEY_SCROLL_LOCK=145,r.KEY_SEMI_COLON=186,r.KEY_EQUAL_SIGN=187,r.KEY_COMMA=188,r.KEY_DASH=189,r.KEY_PERIOD=190,r.KEY_FORWARD_SLASH=191,r.KEY_GRAVE_ACCENT=192,r.KEY_OPEN_BRACKET=219,r.KEY_BACK_SLASH=220,r.KEY_CLOSE_BRACKET=221,r.KEY_SINGLE_QUOTE=222,r.KEY_SPACE=32,r.MOUSE_LEFT_BUTTON=260,r.MOUSE_MIDDLE_BUTTON=261,r.MOUSE_RIGHT_BUTTON=262,r.element=i.element,r.altDown=!1,r.ctrlDown=!1,r.mouseDownLeft=!1,r.mouseDownMiddle=!1,r.mouseDownRight=!1,r.keyDown=[],r.enabled=!0,r.keyboardEnabled=!0,r.mouseover=!1,r.mouseCanvasPos=De.vec2(),r._keyboardEventsElement=i.keyboardEventsElement||document,r._bindEvents(),r}return I(n,[{key:"_bindEvents",value:function(){var e=this;if(!this._eventsBound){this._keyboardEventsElement.addEventListener("keydown",this._keyDownListener=function(t){e.enabled&&e.keyboardEnabled&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.keyCode===e.KEY_CTRL?e.ctrlDown=!0:t.keyCode===e.KEY_ALT?e.altDown=!0:t.keyCode===e.KEY_SHIFT&&(e.shiftDown=!0),e.keyDown[t.keyCode]=!0,e.fire("keydown",t.keyCode,!0))},!1),this._keyboardEventsElement.addEventListener("keyup",this._keyUpListener=function(t){e.enabled&&e.keyboardEnabled&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.keyCode===e.KEY_CTRL?e.ctrlDown=!1:t.keyCode===e.KEY_ALT?e.altDown=!1:t.keyCode===e.KEY_SHIFT&&(e.shiftDown=!1),e.keyDown[t.keyCode]=!1,e.fire("keyup",t.keyCode,!0))}),this.element.addEventListener("mouseenter",this._mouseEnterListener=function(t){e.enabled&&(e.mouseover=!0,e._getMouseCanvasPos(t),e.fire("mouseenter",e.mouseCanvasPos,!0))}),this.element.addEventListener("mouseleave",this._mouseLeaveListener=function(t){e.enabled&&(e.mouseover=!1,e._getMouseCanvasPos(t),e.fire("mouseleave",e.mouseCanvasPos,!0))}),this.element.addEventListener("mousedown",this._mouseDownListener=function(t){if(e.enabled){switch(t.which){case 1:e.mouseDownLeft=!0;break;case 2:e.mouseDownMiddle=!0;break;case 3:e.mouseDownRight=!0}e._getMouseCanvasPos(t),e.element.focus(),e.fire("mousedown",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault()}}),document.addEventListener("mouseup",this._mouseUpListener=function(t){if(e.enabled){switch(t.which){case 1:e.mouseDownLeft=!1;break;case 2:e.mouseDownMiddle=!1;break;case 3:e.mouseDownRight=!1}e.fire("mouseup",e.mouseCanvasPos,!0)}},!0),document.addEventListener("click",this._clickListener=function(t){if(e.enabled){switch(t.which){case 1:case 3:e.mouseDownLeft=!1,e.mouseDownRight=!1;break;case 2:e.mouseDownMiddle=!1}e._getMouseCanvasPos(t),e.fire("click",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault()}}),document.addEventListener("dblclick",this._dblClickListener=function(t){if(e.enabled){switch(t.which){case 1:case 3:e.mouseDownLeft=!1,e.mouseDownRight=!1;break;case 2:e.mouseDownMiddle=!1}e._getMouseCanvasPos(t),e.fire("dblclick",e.mouseCanvasPos,!0),e.mouseover&&t.preventDefault()}});var t=this.scene.tickify((function(){return e.fire("mousemove",e.mouseCanvasPos,!0)}));this.element.addEventListener("mousemove",this._mouseMoveListener=function(n){e.enabled&&(e._getMouseCanvasPos(n),t(),e.mouseover&&n.preventDefault())}),this.element.addEventListener("contextmenu",this._contextmenuListener=function(t){e.enabled&&(e._getMouseCanvasPos(t),e.fire("contextmenu",e.mouseCanvasPos,!0))});var n=this.scene.tickify((function(t){e.fire("mousewheel",t,!0)}));this.element.addEventListener("wheel",this._mouseWheelListener=function(t,r){if(e.enabled){var i=Math.max(-1,Math.min(1,40*-t.deltaY));n(i)}},{passive:!0});var r,i;this.on("mousedown",(function(e){r=e[0],i=e[1]})),this.on("mouseup",(function(t){r>=t[0]-2&&r<=t[0]+2&&i>=t[1]-2&&i<=t[1]+2&&e.fire("mouseclicked",t,!0)})),this.element.addEventListener("touchstart",this._touchstartListener=function(t){e.enabled&&p(t.changedTouches).forEach((function(t){e.fire("touchstart",[t.identifier,e._getTouchCanvasPos(t)],!0)}))}),this.element.addEventListener("touchend",this._touchendListener=function(t){e.enabled&&p(t.changedTouches).forEach((function(t){e.fire("touchend",[t.identifier,e._getTouchCanvasPos(t)],!0)}))}),this._eventsBound=!0}}},{key:"_unbindEvents",value:function(){this._eventsBound&&(this._keyboardEventsElement.removeEventListener("keydown",this._keyDownListener),this._keyboardEventsElement.removeEventListener("keyup",this._keyUpListener),this.element.removeEventListener("mouseenter",this._mouseEnterListener),this.element.removeEventListener("mouseleave",this._mouseLeaveListener),this.element.removeEventListener("mousedown",this._mouseDownListener),document.removeEventListener("mouseup",this._mouseDownListener),document.removeEventListener("click",this._clickListener),document.removeEventListener("dblclick",this._dblClickListener),this.element.removeEventListener("mousemove",this._mouseMoveListener),this.element.removeEventListener("contextmenu",this._contextmenuListener),this.element.removeEventListener("wheel",this._mouseWheelListener),this.element.removeEventListener("touchstart",this._touchstartListener),this.element.removeEventListener("touchend",this._touchendListener),window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientListener),this._eventsBound=!1)}},{key:"_getTouchCanvasPos",value:function(e){for(var t=e.target,n=0,r=0;t.offsetParent;)n+=t.offsetLeft,r+=t.offsetTop,t=t.offsetParent;return[e.pageX-n,e.pageY-r]}},{key:"_getMouseCanvasPos",value:function(e){if(e){var t=e.target.getBoundingClientRect();this.mouseCanvasPos[0]=e.clientX-t.left,this.mouseCanvasPos[1]=e.clientY-t.top}else e=window.event,this.mouseCanvasPos[0]=e.x,this.mouseCanvasPos[1]=e.y}},{key:"setEnabled",value:function(e){this.enabled!==e&&this.fire("enabled",this.enabled=e)}},{key:"getEnabled",value:function(){return this.enabled}},{key:"setKeyboardEnabled",value:function(e){this.keyboardEnabled=e}},{key:"getKeyboardEnabled",value:function(){return this.keyboardEnabled}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._unbindEvents()}}]),n}(),PA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({boundary:[0,0,100,100]}),r.boundary=i.boundary,r.autoBoundary=i.autoBoundary,r}return I(n,[{key:"type",get:function(){return"Viewport"}},{key:"boundary",get:function(){return this._state.boundary},set:function(e){if(!this._autoBoundary){if(!e){var t=this.scene.canvas.boundary;e=[0,0,t[2],t[3]]}this._state.boundary=e,this.glRedraw(),this.fire("boundary",this._state.boundary)}}},{key:"autoBoundary",get:function(){return this._autoBoundary},set:function(e){(e=!!e)!==this._autoBoundary&&(this._autoBoundary=e,this._autoBoundary?this._onCanvasSize=this.scene.canvas.on("boundary",(function(e){var t=e[2],n=e[3];this._state.boundary=[0,0,t,n],this.glRedraw(),this.fire("boundary",this._state.boundary)}),this):this._onCanvasSize&&(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}},{key:"_getState",value:function(){return this._state}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),SA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).camera=e,r._state=new It({matrix:De.mat4(),inverseMatrix:De.mat4(),transposedMatrix:De.mat4(),near:.1,far:1e4}),r._inverseMatrixDirty=!0,r._transposedMatrixDirty=!0,r._fov=60,r._canvasResized=r.scene.canvas.on("boundary",r._needUpdate,w(r)),r.fov=i.fov,r.fovAxis=i.fovAxis,r.near=i.near,r.far=i.far,r}return I(n,[{key:"type",get:function(){return"Perspective"}},{key:"_update",value:function(){var e=this.scene.canvas.boundary,t=e[2]/e[3],n=this._fovAxis,r=this._fov;("x"===n||"min"===n&&t<1||"max"===n&&t>1)&&(r/=t),r=Math.min(r,120),De.perspectiveMat4(r*(Math.PI/180),t,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.camera._updateScheduled=!0,this.fire("matrix",this._state.matrix)}},{key:"fov",get:function(){return this._fov},set:function(e){(e=null!=e?e:60)!==this._fov&&(this._fov=e,this._needUpdate(0),this.fire("fov",this._fov))}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(e){e=e||"min",this._fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),this._fovAxis=e,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}},{key:"near",get:function(){return this._state.near},set:function(e){var t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}},{key:"far",get:function(){return this._state.far},set:function(e){var t=null!=e?e:1e4;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(De.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(De.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,n,r,i){var s=this.scene.canvas.canvas,a=s.offsetWidth/2,o=s.offsetHeight/2;return n[0]=(e[0]-a)/a,n[1]=(e[1]-o)/o,n[2]=t,n[3]=1,De.mulMat4v4(this.inverseMatrix,n,r),De.mulVec3Scalar(r,1/r[3]),r[3]=1,r[1]*=-1,De.mulMat4v4(this.camera.inverseViewMatrix,r,i),i}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy(),this.scene.canvas.off(this._canvasResized)}}]),n}(),DA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).camera=e,r._state=new It({matrix:De.mat4(),inverseMatrix:De.mat4(),transposedMatrix:De.mat4(),near:.1,far:1e4}),r._inverseMatrixDirty=!0,r._transposedMatrixDirty=!0,r.scale=i.scale,r.near=i.near,r.far=i.far,r._onCanvasBoundary=r.scene.canvas.on("boundary",r._needUpdate,w(r)),r}return I(n,[{key:"type",get:function(){return"Ortho"}},{key:"_update",value:function(){var e,t,n,r,i=this.scene,s=.5*this._scale,a=i.canvas.boundary,o=a[2],A=a[3],c=o/A;o>A?(e=-s,t=s,n=s/c,r=-s/c):(e=-s*c,t=s*c,n=s,r=-s),De.orthoMat4c(e,t,r,n,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"scale",get:function(){return this._scale},set:function(e){null==e&&(e=1),e<=0&&(e=.01),this._scale=e,this._needUpdate(0),this.fire("scale",this._scale)}},{key:"near",get:function(){return this._state.near},set:function(e){var t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}},{key:"far",get:function(){return this._state.far},set:function(e){var t=null!=e?e:1e4;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(De.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(De.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,n,r,i){var s=this.scene.canvas.canvas,a=s.offsetWidth/2,o=s.offsetHeight/2;return n[0]=(e[0]-a)/a,n[1]=(e[1]-o)/o,n[2]=t,n[3]=1,De.mulMat4v4(this.inverseMatrix,n,r),De.mulVec3Scalar(r,1/r[3]),r[3]=1,r[1]*=-1,De.mulMat4v4(this.camera.inverseViewMatrix,r,i),i}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy(),this.scene.canvas.off(this._onCanvasBoundary)}}]),n}(),QA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).camera=e,r._state=new It({matrix:De.mat4(),inverseMatrix:De.mat4(),transposedMatrix:De.mat4(),near:.1,far:1e4}),r._left=-1,r._right=1,r._bottom=-1,r._top=1,r._inverseMatrixDirty=!0,r._transposedMatrixDirty=!0,r.left=i.left,r.right=i.right,r.bottom=i.bottom,r.top=i.top,r.near=i.near,r.far=i.far,r}return I(n,[{key:"type",get:function(){return"Frustum"}},{key:"_update",value:function(){De.frustumMat4(this._left,this._right,this._bottom,this._top,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"left",get:function(){return this._left},set:function(e){this._left=null!=e?e:-1,this._needUpdate(0),this.fire("left",this._left)}},{key:"right",get:function(){return this._right},set:function(e){this._right=null!=e?e:1,this._needUpdate(0),this.fire("right",this._right)}},{key:"top",get:function(){return this._top},set:function(e){this._top=null!=e?e:1,this._needUpdate(0),this.fire("top",this._top)}},{key:"bottom",get:function(){return this._bottom},set:function(e){this._bottom=null!=e?e:-1,this._needUpdate(0),this.fire("bottom",this._bottom)}},{key:"near",get:function(){return this._state.near},set:function(e){this._state.near=null!=e?e:.1,this._needUpdate(0),this.fire("near",this._state.near)}},{key:"far",get:function(){return this._state.far},set:function(e){this._state.far=null!=e?e:1e4,this._needUpdate(0),this.fire("far",this._state.far)}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(De.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(De.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,n,r,i){var s=this.scene.canvas.canvas,a=s.offsetWidth/2,o=s.offsetHeight/2;return n[0]=(e[0]-a)/a,n[1]=(e[1]-o)/o,n[2]=t,n[3]=1,De.mulMat4v4(this.inverseMatrix,n,r),De.mulVec3Scalar(r,1/r[3]),r[3]=1,r[1]*=-1,De.mulMat4v4(this.camera.inverseViewMatrix,r,i),i}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),RA=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).camera=e,r._state=new It({matrix:De.mat4(),inverseMatrix:De.mat4(),transposedMatrix:De.mat4()}),r._inverseMatrixDirty=!0,r._transposedMatrixDirty=!1,r.matrix=i.matrix,r}return I(n,[{key:"type",get:function(){return"CustomProjection"}},{key:"matrix",get:function(){return this._state.matrix},set:function(e){this._state.matrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}},{key:"inverseMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(De.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}},{key:"transposedMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(De.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}},{key:"unproject",value:function(e,t,n,r,i){var s=this.scene.canvas.canvas,a=s.offsetWidth/2,o=s.offsetHeight/2;return n[0]=(e[0]-a)/a,n[1]=(e[1]-o)/o,n[2]=t,n[3]=1,De.mulMat4v4(this.inverseMatrix,n,r),De.mulVec3Scalar(r,1/r[3]),r[3]=1,r[1]*=-1,De.mulMat4v4(this.camera.inverseViewMatrix,r,i),i}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),OA=De.vec3(),VA=De.vec3(),LA=De.vec3(),HA=De.vec3(),NA=De.vec3(),GA=De.vec3(),jA=De.vec4(),WA=De.vec4(),zA=De.vec4(),XA=De.mat4(),KA=De.mat4(),ZA=De.vec3(),JA=De.vec3(),YA=De.vec3(),qA=De.vec3(),$A=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({offsetEyeFromLook:!0,deviceMatrix:De.mat4(),hasDeviceMatrix:!1,matrix:De.mat4(),normalMatrix:De.mat4(),inverseMatrix:De.mat4()}),r._perspective=new SA(w(r)),r._ortho=new DA(w(r)),r._frustum=new QA(w(r)),r._customProjection=new RA(w(r)),r._project=r._perspective,r._eye=De.vec3([0,0,10]),r._look=De.vec3([0,0,0]),r._up=De.vec3([0,1,0]),r._worldUp=De.vec3([0,1,0]),r._worldRight=De.vec3([1,0,0]),r._worldForward=De.vec3([0,0,-1]),r.deviceMatrix=i.deviceMatrix,r.eye=i.eye,r.look=i.look,r.up=i.up,r.worldAxis=i.worldAxis,r.gimbalLock=i.gimbalLock,r.constrainPitch=i.constrainPitch,r.projection=i.projection,r._perspective.on("matrix",(function(){"perspective"===r._projectionType&&r.fire("projMatrix",r._perspective.matrix)})),r._ortho.on("matrix",(function(){"ortho"===r._projectionType&&r.fire("projMatrix",r._ortho.matrix)})),r._frustum.on("matrix",(function(){"frustum"===r._projectionType&&r.fire("projMatrix",r._frustum.matrix)})),r._customProjection.on("matrix",(function(){"customProjection"===r._projectionType&&r.fire("projMatrix",r._customProjection.matrix)})),r}return I(n,[{key:"type",get:function(){return"Camera"}},{key:"_update",value:function(){var e,t=this._state;"ortho"===this.projection&&this._state.offsetEyeFromLook?(De.subVec3(this._eye,this._look,ZA),De.normalizeVec3(ZA,JA),De.mulVec3Scalar(JA,1e3,YA),De.addVec3(this._look,YA,qA),e=qA):e=this._eye,t.hasDeviceMatrix?(De.lookAtMat4v(e,this._look,this._up,KA),De.mulMat4(t.deviceMatrix,KA,t.matrix)):De.lookAtMat4v(e,this._look,this._up,t.matrix),De.inverseMat4(this._state.matrix,this._state.inverseMatrix),De.transposeMat4(this._state.inverseMatrix,this._state.normalMatrix),this.glRedraw(),this.fire("matrix",this._state.matrix),this.fire("viewMatrix",this._state.matrix)}},{key:"orbitYaw",value:function(e){var t=De.subVec3(this._eye,this._look,OA);De.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,XA),t=De.transformPoint3(XA,t,VA),this.eye=De.addVec3(this._look,t,LA),this.up=De.transformPoint3(XA,this._up,HA)}},{key:"orbitPitch",value:function(e){if(!(this._constrainPitch&&(e=De.dotVec3(this._up,this._worldUp)/De.DEGTORAD)<1)){var t=De.subVec3(this._eye,this._look,OA),n=De.cross3Vec3(De.normalizeVec3(t,VA),De.normalizeVec3(this._up,LA));De.rotationMat4v(.0174532925*e,n,XA),t=De.transformPoint3(XA,t,HA),this.up=De.transformPoint3(XA,this._up,NA),this.eye=De.addVec3(t,this._look,GA)}}},{key:"yaw",value:function(e){var t=De.subVec3(this._look,this._eye,OA);De.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,XA),t=De.transformPoint3(XA,t,VA),this.look=De.addVec3(t,this._eye,LA),this._gimbalLock&&(this.up=De.transformPoint3(XA,this._up,HA))}},{key:"pitch",value:function(e){if(!(this._constrainPitch&&(e=De.dotVec3(this._up,this._worldUp)/De.DEGTORAD)<1)){var t=De.subVec3(this._look,this._eye,OA),n=De.cross3Vec3(De.normalizeVec3(t,VA),De.normalizeVec3(this._up,LA));De.rotationMat4v(.0174532925*e,n,XA),this.up=De.transformPoint3(XA,this._up,GA),t=De.transformPoint3(XA,t,HA),this.look=De.addVec3(t,this._eye,NA)}}},{key:"pan",value:function(e){var t,n=De.subVec3(this._eye,this._look,OA),r=[0,0,0];if(0!==e[0]){var i=De.cross3Vec3(De.normalizeVec3(n,[]),De.normalizeVec3(this._up,VA));t=De.mulVec3Scalar(i,e[0]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]}0!==e[1]&&(t=De.mulVec3Scalar(De.normalizeVec3(this._up,LA),e[1]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),0!==e[2]&&(t=De.mulVec3Scalar(De.normalizeVec3(n,HA),e[2]),r[0]+=t[0],r[1]+=t[1],r[2]+=t[2]),this.eye=De.addVec3(this._eye,r,NA),this.look=De.addVec3(this._look,r,GA)}},{key:"zoom",value:function(e){var t=De.subVec3(this._eye,this._look,OA),n=Math.abs(De.lenVec3(t,VA)),r=Math.abs(n+e);if(!(r<.5)){var i=De.normalizeVec3(t,LA);this.eye=De.addVec3(this._look,De.mulVec3Scalar(i,r),HA)}}},{key:"eye",get:function(){return this._eye},set:function(e){this._eye.set(e||[0,0,10]),this._needUpdate(0),this.fire("eye",this._eye)}},{key:"look",get:function(){return this._look},set:function(e){this._look.set(e||[0,0,0]),this._needUpdate(0),this.fire("look",this._look)}},{key:"up",get:function(){return this._up},set:function(e){this._up.set(e||[0,1,0]),this._needUpdate(0),this.fire("up",this._up)}},{key:"deviceMatrix",get:function(){return this._state.deviceMatrix},set:function(e){this._state.deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._state.hasDeviceMatrix=!!e,this._needUpdate(0),this.fire("deviceMatrix",this._state.deviceMatrix)}},{key:"worldAxis",get:function(){return this._worldAxis},set:function(e){e=e||[1,0,0,0,1,0,0,0,1],this._worldAxis?this._worldAxis.set(e):this._worldAxis=De.vec3(e),this._worldRight[0]=this._worldAxis[0],this._worldRight[1]=this._worldAxis[1],this._worldRight[2]=this._worldAxis[2],this._worldUp[0]=this._worldAxis[3],this._worldUp[1]=this._worldAxis[4],this._worldUp[2]=this._worldAxis[5],this._worldForward[0]=this._worldAxis[6],this._worldForward[1]=this._worldAxis[7],this._worldForward[2]=this._worldAxis[8],this.fire("worldAxis",this._worldAxis)}},{key:"worldUp",get:function(){return this._worldUp}},{key:"xUp",get:function(){return this._worldUp[0]>this._worldUp[1]&&this._worldUp[0]>this._worldUp[2]}},{key:"yUp",get:function(){return this._worldUp[1]>this._worldUp[0]&&this._worldUp[1]>this._worldUp[2]}},{key:"zUp",get:function(){return this._worldUp[2]>this._worldUp[0]&&this._worldUp[2]>this._worldUp[1]}},{key:"worldRight",get:function(){return this._worldRight}},{key:"worldForward",get:function(){return this._worldForward}},{key:"gimbalLock",get:function(){return this._gimbalLock},set:function(e){this._gimbalLock=!1!==e,this.fire("gimbalLock",this._gimbalLock)}},{key:"constrainPitch",set:function(e){this._constrainPitch=!!e,this.fire("constrainPitch",this._constrainPitch)}},{key:"eyeLookDist",get:function(){return De.lenVec3(De.subVec3(this._look,this._eye,OA))}},{key:"matrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"viewMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}},{key:"normalMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}},{key:"viewNormalMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}},{key:"inverseViewMatrix",get:function(){return this._updateScheduled&&this._doUpdate(),this._state.inverseMatrix}},{key:"projMatrix",get:function(){return this[this.projection].matrix}},{key:"perspective",get:function(){return this._perspective}},{key:"ortho",get:function(){return this._ortho}},{key:"frustum",get:function(){return this._frustum}},{key:"customProjection",get:function(){return this._customProjection}},{key:"projection",get:function(){return this._projectionType},set:function(e){e=e||"perspective",this._projectionType!==e&&("perspective"===e?this._project=this._perspective:"ortho"===e?this._project=this._ortho:"frustum"===e?this._project=this._frustum:"customProjection"===e?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to 'perspective'"),this._project=this._perspective,e="perspective"),this._project._update(),this._projectionType=e,this.glRedraw(),this._update(),this.fire("dirty"),this.fire("projection",this._projectionType),this.fire("projMatrix",this._project.matrix))}},{key:"project",get:function(){return this._project}},{key:"offsetEyeFromLook",get:function(){return this._state.offsetEyeFromLook},set:function(e){this._state.offsetEyeFromLook=e,this._needUpdate(0)}},{key:"projectWorldPos",value:function(e){var t=jA,n=WA,r=zA;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,De.mulMat4v4(this.viewMatrix,t,n),De.mulMat4v4(this.projMatrix,n,r),De.mulVec3Scalar(r,1/r[3]),r[3]=1,r[1]*=-1;var i=this.scene.canvas.canvas,s=i.offsetWidth/2,a=i.offsetHeight/2;return[r[0]*s+s,r[1]*a+a]}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),ec={meters:{abbrev:"m"},metres:{abbrev:"m"},centimeters:{abbrev:"cm"},centimetres:{abbrev:"cm"},millimeters:{abbrev:"mm"},millimetres:{abbrev:"mm"},yards:{abbrev:"yd"},feet:{abbrev:"ft"},inches:{abbrev:"in"}},tc=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._units="meters",r._scale=1,r._origin=De.vec3([0,0,0]),r.units=i.units,r.scale=i.scale,r.origin=i.origin,r}return I(n,[{key:"unitsInfo",get:function(){return ec}},{key:"units",get:function(){return this._units},set:function(e){e||(e="meters"),ec[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to 'meters'"),e="meters"),this._units=e,this.fire("units",this._units)}},{key:"scale",get:function(){return this._scale},set:function(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(this._scale=e,this.fire("scale",this._scale))}},{key:"origin",get:function(){return this._origin},set:function(e){if(!e)return this._origin[0]=0,this._origin[1]=0,void(this._origin[2]=0);this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this.fire("origin",this._origin)}},{key:"worldToRealPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec3(3);t[0]=this._origin[0]+this._scale*e[0],t[1]=this._origin[1]+this._scale*e[1],t[2]=this._origin[2]+this._scale*e[2]}},{key:"realToWorldPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:De.vec3(3);return t[0]=(e[0]-this._origin[0])/this._scale,t[1]=(e[1]-this._origin[1])/this._scale,t[2]=(e[2]-this._origin[2])/this._scale,t}}]),n}(),nc=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._supported=vA.SUPPORTED_EXTENSIONS.OES_standard_derivatives,r.enabled=i.enabled,r.kernelRadius=i.kernelRadius,r.intensity=i.intensity,r.bias=i.bias,r.scale=i.scale,r.minResolution=i.minResolution,r.numSamples=i.numSamples,r.blur=i.blur,r.blendCutoff=i.blendCutoff,r.blendFactor=i.blendFactor,r}return I(n,[{key:"supported",get:function(){return this._supported}},{key:"enabled",get:function(){return this._enabled},set:function(e){e=!!e,this._enabled!==e&&(this._enabled=e,this.glRedraw())}},{key:"possible",get:function(){if(!this._supported)return!1;if(!this._enabled)return!1;var e=this.scene.camera.projection;return"customProjection"!==e&&"frustum"!==e}},{key:"active",get:function(){return this._active}},{key:"kernelRadius",get:function(){return this._kernelRadius},set:function(e){null==e&&(e=100),this._kernelRadius!==e&&(this._kernelRadius=e,this.glRedraw())}},{key:"intensity",get:function(){return this._intensity},set:function(e){null==e&&(e=.15),this._intensity!==e&&(this._intensity=e,this.glRedraw())}},{key:"bias",get:function(){return this._bias},set:function(e){null==e&&(e=.5),this._bias!==e&&(this._bias=e,this.glRedraw())}},{key:"scale",get:function(){return this._scale},set:function(e){null==e&&(e=1),this._scale!==e&&(this._scale=e,this.glRedraw())}},{key:"minResolution",get:function(){return this._minResolution},set:function(e){null==e&&(e=0),this._minResolution!==e&&(this._minResolution=e,this.glRedraw())}},{key:"numSamples",get:function(){return this._numSamples},set:function(e){null==e&&(e=10),this._numSamples!==e&&(this._numSamples=e,this.glRedraw())}},{key:"blur",get:function(){return this._blur},set:function(e){e=!1!==e,this._blur!==e&&(this._blur=e,this.glRedraw())}},{key:"blendCutoff",get:function(){return this._blendCutoff},set:function(e){null==e&&(e=.3),this._blendCutoff!==e&&(this._blendCutoff=e,this.glRedraw())}},{key:"blendFactor",get:function(){return this._blendFactor},set:function(e){null==e&&(e=1),this._blendFactor!==e&&(this._blendFactor=e,this.glRedraw())}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}(),rc=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i)).sliceColor=i.sliceColor,r.sliceThickness=i.sliceThickness,r}return I(n,[{key:"sliceThickness",get:function(){return this._sliceThickness},set:function(e){null==e&&(e=0),this._sliceThickness!==e&&(this._sliceThickness=e,this.glRedraw())}},{key:"sliceColor",get:function(){return this._sliceColor},set:function(e){null==e&&(e=[0,0,0,1]),this._sliceColor!==e&&(this._sliceColor=e,this.glRedraw())}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}(),ic={default:{pointSize:4,roundPoints:!0,perspectivePoints:!0},square:{pointSize:4,roundPoints:!1,perspectivePoints:!0},round:{pointSize:4,roundPoints:!0,perspectivePoints:!0}},sc=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"PointsMaterial",pointSize:null,roundPoints:null,perspectivePoints:null,minPerspectivePointSize:null,maxPerspectivePointSize:null,filterIntensity:null,minIntensity:null,maxIntensity:null}),i.preset?(r.preset=i.preset,void 0!==i.pointSize&&(r.pointSize=i.pointSize),void 0!==i.roundPoints&&(r.roundPoints=i.roundPoints),void 0!==i.perspectivePoints&&(r.perspectivePoints=i.perspectivePoints),void 0!==i.minPerspectivePointSize&&(r.minPerspectivePointSize=i.minPerspectivePointSize),void 0!==i.maxPerspectivePointSize&&(r.maxPerspectivePointSize=i.minPerspectivePointSize)):(r._preset="default",r.pointSize=i.pointSize,r.roundPoints=i.roundPoints,r.perspectivePoints=i.perspectivePoints,r.minPerspectivePointSize=i.minPerspectivePointSize,r.maxPerspectivePointSize=i.maxPerspectivePointSize),r.filterIntensity=i.filterIntensity,r.minIntensity=i.minIntensity,r.maxIntensity=i.maxIntensity,r}return I(n,[{key:"type",get:function(){return"PointsMaterial"}},{key:"presets",get:function(){return ic}},{key:"pointSize",get:function(){return this._state.pointSize},set:function(e){this._state.pointSize=e||2,this.glRedraw()}},{key:"roundPoints",get:function(){return this._state.roundPoints},set:function(e){e=!1!==e,this._state.roundPoints!==e&&(this._state.roundPoints=e,this.scene._needRecompile=!0,this.glRedraw())}},{key:"perspectivePoints",get:function(){return this._state.perspectivePoints},set:function(e){e=!1!==e,this._state.perspectivePoints!==e&&(this._state.perspectivePoints=e,this.scene._needRecompile=!0,this.glRedraw())}},{key:"minPerspectivePointSize",get:function(){return this._state.minPerspectivePointSize},set:function(e){this._state.minPerspectivePointSize=e||1,this.scene._needRecompile=!0,this.glRedraw()}},{key:"maxPerspectivePointSize",get:function(){return this._state.maxPerspectivePointSize},set:function(e){this._state.maxPerspectivePointSize=e||6,this.scene._needRecompile=!0,this.glRedraw()}},{key:"filterIntensity",get:function(){return this._state.filterIntensity},set:function(e){e=!1!==e,this._state.filterIntensity!==e&&(this._state.filterIntensity=e,this.scene._needRecompile=!0,this.glRedraw())}},{key:"minIntensity",get:function(){return this._state.minIntensity},set:function(e){this._state.minIntensity=null!=e?e:0,this.glRedraw()}},{key:"maxIntensity",get:function(){return this._state.maxIntensity},set:function(e){this._state.maxIntensity=null!=e?e:1,this.glRedraw()}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=ic[e];t?(this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(ic).join(", "))}}},{key:"hash",get:function(){return[this.pointSize,this.roundPoints,this.perspectivePoints,this.minPerspectivePointSize,this.maxPerspectivePointSize,this.filterIntensity].join(";")}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),ac={default:{lineWidth:1},thick:{lineWidth:2},thicker:{lineWidth:4}},oc=function(e){m(n,yi);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e,i))._state=new It({type:"LinesMaterial",lineWidth:null}),i.preset?(r.preset=i.preset,void 0!==i.lineWidth&&(r.lineWidth=i.lineWidth)):(r._preset="default",r.lineWidth=i.lineWidth),r}return I(n,[{key:"type",get:function(){return"LinesMaterial"}},{key:"presets",get:function(){return ac}},{key:"lineWidth",get:function(){return this._state.lineWidth},set:function(e){this._state.lineWidth=e||1,this.glRedraw()}},{key:"preset",get:function(){return this._preset},set:function(e){if(e=e||"default",this._preset!==e){var t=ac[e];t?(this.lineWidth=t.lineWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(ac).join(", "))}}},{key:"hash",get:function(){return[""+this.lineWidth].join(";")}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._state.destroy()}}]),n}(),Ac=De.vec3(),cc=I((function e(t){x(this,e);var n=null,r={},i=[];this.destroy=function(){return n&&n()};var s=null,a=function(){clearTimeout(s),s=setTimeout((function(){var e=Object.values(t.models).filter((function(e){return e.id in r&&e.visible}));i.forEach((function(n){if(n.active){var i=De.makeSectionPlaneSlicer(n);e.forEach((function(e){var s=e.aabb;if(De.planeIntersectsAABB3(n,s)){var a=De.getAABB3Center(s,De.vec3());r[e.id].entityCaches.forEach((function(r,s){var o=e.objects[s];r.generateCaps&&o.capMaterial&&De.planeIntersectsAABB3(n,o.aabb)&&(r.meshCaches||(r.meshCaches=o.meshes.filter((function(e){return e.isSolid()})).map((function(e){var t=[],n=[];return e.getEachIndex((function(e){return t.push(e)})),e.getEachVertex((function(e){return n.push.apply(n,p(De.subVec3(e,a,Ac)))})),{mesh:e,meshIndices:t,meshVertices:n}}))),r.meshCaches.filter((function(e){return De.planeIntersectsAABB3(n,e.mesh.aabb)})).forEach((function(e,A){var c=i({origin:a,indices:e.meshIndices,positions:e.meshVertices},{onlyPosSliceWithUV:!0}).pos;c&&r.capMeshes.push(new vi(t,{isObject:!0,id:"".concat(n.id,"-").concat(s,"-").concat(A),material:o.capMaterial,origin:De.addVec3(a,De.mulVec3Scalar(n.dir,.001,Ac),Ac),geometry:new Wt(t,{primitive:"triangles",indices:c.indices,positions:c.positions,normals:c.normals,uv:c.uv})}))})))}))}}))}})),e.forEach((function(e){return r[e.id].entityCaches.forEach((function(e){return e.generateCaps=!1}))}))}),100)};this._onCapMaterialUpdated=function(e){if(!n){s=null;var o=function(e){var t=function(){Object.values(r).forEach((function(e){return e.entityCaches.forEach((function(e){e.destroyCaps(),e.generateCaps=!0}))})),a()};i.push(e),e.on("pos",t),e.on("dir",t),e.on("active",t),e.once("destroyed",(function(){var n=i.indexOf(e);n>=0&&(i.splice(n,1),t())}))};for(var A in t.sectionPlanes)o(t.sectionPlanes[A]);var c=t.on("sectionPlaneCreated",o),l=t.on("tick",(function(){var e=!1;for(var n in r){var i=t.models[n];if(i){if(r[n].modelVisible!=i.visible){var s=r[n];s.modelVisible=!!i.visible,s.entityCaches.forEach((function(e){e.destroyCaps(),e.generateCaps=!0})),e=!0}}else r[n].entityCaches.forEach((function(e){return e.destroyCaps()})),delete r[n],e=!0}e&&a()}));n=function(){for(var e in r)r[e].entityCaches.forEach((function(e){return e.destroyCaps()}));t.off(c),t.off(l)}}var u=e.model,h=u.id;r[h]||(r[h]={modelVisible:u.visible,entityCaches:new Map});var d=r[h].entityCaches,f=e.id;if(!d.has(f)){var p={capMeshes:[],meshCaches:null,generateCaps:!1,destroyCaps:function(){p.capMeshes.forEach((function(e){return e.destroy()})),p.capMeshes.length=0}};d.set(f,p)}var v=d.get(f);v.destroyCaps(),v.generateCaps=!0,a()}}));function lc(e,t){for(var n,r,i={},s=0,a=t.length;s<a;s++)n=t[s],(r=e.components[n])?r.isEntity?i[n]=!0:e.warn("pick(): Component is not an Entity: "+n):e.warn("pick(): Component not found: "+n);return i}var uc=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),r=t.call(this,null,i);var s=i.canvasElement||document.querySelector("#".concat(i.canvasId));if(!(s instanceof HTMLCanvasElement))throw"Mandatory config expected: valid canvasId or canvasElement";r._tickifiedFunctions={};var a=!!i.transparent,o=!!i.alphaDepthMask;r._aabbDirty=!0,r._readableGeometry=!!i.readableGeometryEnabled,r.viewer=e,r.occlusionTestCountdown=0,r.loading=0,r.startTime=(new Date).getTime(),r.models={},r.objects={},r._numObjects=0,r.visibleObjects={},r._numVisibleObjects=0,r.xrayedObjects={},r._numXRayedObjects=0,r.highlightedObjects={},r._numHighlightedObjects=0,r.selectedObjects={},r._numSelectedObjects=0,r.colorizedObjects={},r._numColorizedObjects=0,r.opacityObjects={},r._numOpacityObjects=0,r.offsetObjects={},r._numOffsetObjects=0,r._modelIds=null,r._objectIds=null,r._visibleObjectIds=null,r._xrayedObjectIds=null,r._highlightedObjectIds=null,r._selectedObjectIds=null,r._colorizedObjectIds=null,r._opacityObjectIds=null,r._offsetObjectIds=null,r._collidables={},r._compilables={},r._needRecompile=!1,r.types={},r.components={},r.sectionPlanes={},r.lights={},r.lightMaps={},r.reflectionMaps={},r.bitmaps={},r.lineSets={},r.realWorldOffset=i.realWorldOffset||new Float64Array([0,0,0]),r.canvas=new fA(w(r),{dontClear:!0,canvas:s,spinnerElementId:i.spinnerElementId,transparent:a,webgl2:!1!==i.webgl2,contextAttr:i.contextAttr||{},backgroundColor:i.backgroundColor,backgroundColorFromAmbientLight:i.backgroundColorFromAmbientLight,premultipliedAlpha:i.premultipliedAlpha});var A=function(e){return r.viewer.destroy()};return s.addEventListener("webglcontextlost",A,!1),r._removeWebglcontextlostListener=function(){return s.removeEventListener("webglcontextlost",A,!1)},r.canvas.on("boundary",(function(){r.glRedraw()})),r.canvas.on("webglContextFailed",(function(){alert("xeokit failed to find WebGL!")})),r._renderer=new IA(w(r),{transparent:a,alphaDepthMask:o}),r._sectionPlanesState=new function(){this.sectionPlanes=[],this.clippingCaps=!1,this._numCachedSectionPlanes=0;var e=null;this.getHash=function(){if(e)return e;var t=this.getNumAllocatedSectionPlanes();if(this.sectionPlanes,0===t)return this.hash=";";for(var n=[],r=0,i=t;r<i;r++)n.push("cp");return n.push(";"),e=n.join("")},this.addSectionPlane=function(t){this.sectionPlanes.push(t),e=null},this.removeSectionPlane=function(t){for(var n=0,r=this.sectionPlanes.length;n<r;n++)if(this.sectionPlanes[n].id===t.id)return this.sectionPlanes.splice(n,1),void(e=null)},this.setNumCachedSectionPlanes=function(t){this._numCachedSectionPlanes=t,e=null},this.getNumCachedSectionPlanes=function(){return this._numCachedSectionPlanes},this.getNumAllocatedSectionPlanes=function(){var e=this.sectionPlanes.length;return e>this._numCachedSectionPlanes?e:this._numCachedSectionPlanes}},r._sectionPlanesState.setNumCachedSectionPlanes(i.numCachedSectionPlanes||0),r._lightsState=new function(){var e=De.vec4([0,0,0,0]),t=De.vec4();this.lights=[],this.reflectionMaps=[],this.lightMaps=[];var n=null,r=null;this.getHash=function(){if(n)return n;for(var e,t=[],r=this.lights,i=0,s=r.length;i<s;i++)e=r[i],t.push("/"),t.push(e.type),t.push("world"===e.space?"w":"v"),e.castsShadow&&t.push("sh");return this.lightMaps.length>0&&t.push("/lm"),this.reflectionMaps.length>0&&t.push("/rm"),t.push(";"),n=t.join("")},this.addLight=function(e){this.lights.push(e),r=null,n=null},this.removeLight=function(e){for(var t=0,i=this.lights.length;t<i;t++){if(this.lights[t].id===e.id)return this.lights.splice(t,1),r&&r.id===e.id&&(r=null),void(n=null)}},this.addReflectionMap=function(e){this.reflectionMaps.push(e),n=null},this.removeReflectionMap=function(e){for(var t=0,r=this.reflectionMaps.length;t<r;t++)if(this.reflectionMaps[t].id===e.id)return this.reflectionMaps.splice(t,1),void(n=null)},this.addLightMap=function(e){this.lightMaps.push(e),n=null},this.removeLightMap=function(e){for(var t=0,r=this.lightMaps.length;t<r;t++)if(this.lightMaps[t].id===e.id)return this.lightMaps.splice(t,1),void(n=null)},this.getAmbientColorAndIntensity=function(){if(!r)for(var n=0,i=this.lights.length;n<i;n++){var s=this.lights[n];if("ambient"===s.type){r=s;break}}if(r){var a=r.color,o=r.intensity;return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=o,t}return e}},r.input=new TA(w(r),{dontClear:!0,element:r.canvas.canvas,keyboardEventsElement:i.keyboardEventsElement}),r.metrics=new tc(w(r),{units:i.units,scale:i.scale,origin:i.origin}),r.sao=new nc(w(r),{enabled:i.saoEnabled}),r.crossSections=new rc(w(r),{}),r.ticksPerRender=i.ticksPerRender,r.ticksPerOcclusionTest=i.ticksPerOcclusionTest,r.passes=i.passes,r.clearEachPass=i.clearEachPass,r.gammaInput=i.gammaInput,r.gammaOutput=i.gammaOutput,r.gammaFactor=i.gammaFactor,r._entityOffsetsEnabled=!!i.entityOffsetsEnabled,r._logarithmicDepthBufferEnabled=!!i.logarithmicDepthBufferEnabled,r._dtxEnabled=!1!==i.dtxEnabled,r._pbrEnabled=!!i.pbrEnabled,r._colorTextureEnabled=!1!==i.colorTextureEnabled,r._dtxEnabled=!!i.dtxEnabled,r._markerZOffset=i.markerZOffset,tt._addScene(w(r)),r._initDefaults(),r._viewport=new PA(w(r),{id:"default.viewport",autoBoundary:!0,dontClear:!0}),r._camera=new $A(w(r),{id:"default.camera",dontClear:!0}),r._sectionCaps=new cc(w(r)),new Po(w(r),{color:[1,1,1],intensity:.7}),new Do(w(r),{dir:[.8,-.5,-.5],color:[.67,.67,1],intensity:.7,space:"world"}),new Do(w(r),{dir:[-.8,-1,.5],color:[1,1,.9],intensity:.9,space:"world"}),r._camera.on("dirty",(function(){r._renderer.imageDirty()})),r}return I(n,[{key:"type",get:function(){return"Scene"}},{key:"_initDefaults",value:function(){}},{key:"_addComponent",value:function(e){if(e.id&&this.components[e.id]&&(this.error("Component "+je.inQuotes(e.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),e.id=null),!e.id)for(void 0===window.nextID&&(window.nextID=0),e.id="__"+window.nextID++;this.components[e.id];)e.id=De.createUUID();this.components[e.id]=e;var t=e.type,n=this.types[e.type];n||(n=this.types[t]={}),n[e.id]=e,e.compile&&(this._compilables[e.id]=e),e.isDrawable&&(this._renderer.addDrawable(e.id,e),this._collidables[e.id]=e)}},{key:"_removeComponent",value:function(e){var t=e.id,n=e.type;delete this.components[t];var r=this.types[n];r&&(delete r[t],je.isEmptyObject(r)&&delete this.types[n]),e.compile&&delete this._compilables[e.id],e.isDrawable&&(this._renderer.removeDrawable(e.id),delete this._collidables[e.id])}},{key:"_sectionPlaneCreated",value:function(e){this.sectionPlanes[e.id]=e,this.scene._sectionPlanesState.addSectionPlane(e._state),this.scene.fire("sectionPlaneCreated",e,!0),this._needRecompile=!0}},{key:"_bitmapCreated",value:function(e){this.bitmaps[e.id]=e,this.scene.fire("bitmapCreated",e,!0)}},{key:"_lineSetCreated",value:function(e){this.lineSets[e.id]=e,this.scene.fire("lineSetCreated",e,!0)}},{key:"_lightCreated",value:function(e){this.lights[e.id]=e,this.scene._lightsState.addLight(e._state),this._needRecompile=!0}},{key:"_lightMapCreated",value:function(e){this.lightMaps[e.id]=e,this.scene._lightsState.addLightMap(e._state),this._needRecompile=!0}},{key:"_reflectionMapCreated",value:function(e){this.reflectionMaps[e.id]=e,this.scene._lightsState.addReflectionMap(e._state),this._needRecompile=!0}},{key:"_sectionPlaneDestroyed",value:function(e){delete this.sectionPlanes[e.id],this.scene._sectionPlanesState.removeSectionPlane(e._state),this.scene.fire("sectionPlaneDestroyed",e,!0),this._needRecompile=!0}},{key:"_bitmapDestroyed",value:function(e){delete this.bitmaps[e.id],this.scene.fire("bitmapDestroyed",e,!0)}},{key:"_lineSetDestroyed",value:function(e){delete this.lineSets[e.id],this.scene.fire("lineSetDestroyed",e,!0)}},{key:"_lightDestroyed",value:function(e){delete this.lights[e.id],this.scene._lightsState.removeLight(e._state),this._needRecompile=!0}},{key:"_lightMapDestroyed",value:function(e){delete this.lightMaps[e.id],this.scene._lightsState.removeLightMap(e._state),this._needRecompile=!0}},{key:"_reflectionMapDestroyed",value:function(e){delete this.reflectionMaps[e.id],this.scene._lightsState.removeReflectionMap(e._state),this._needRecompile=!0}},{key:"_registerModel",value:function(e){this.models[e.id]=e,this._modelIds=null}},{key:"_deregisterModel",value:function(e){var t=e.id;delete this.models[t],this._modelIds=null,this.fire("modelUnloaded",t)}},{key:"_registerObject",value:function(e){this.objects[e.id]=e,this._numObjects++,this._objectIds=null}},{key:"_deregisterObject",value:function(e){delete this.objects[e.id],this._numObjects--,this._objectIds=null}},{key:"_objectVisibilityUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.visible?(this.visibleObjects[e.id]=e,this._numVisibleObjects++):(delete this.visibleObjects[e.id],this._numVisibleObjects--),this._visibleObjectIds=null,t&&this.fire("objectVisibility",e,!0)}},{key:"_deRegisterVisibleObject",value:function(e){delete this.visibleObjects[e.id],this._numVisibleObjects--,this._visibleObjectIds=null}},{key:"_objectXRayedUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.xrayed?(this.xrayedObjects[e.id]=e,this._numXRayedObjects++):(delete this.xrayedObjects[e.id],this._numXRayedObjects--),this._xrayedObjectIds=null,t&&this.fire("objectXRayed",e,!0)}},{key:"_deRegisterXRayedObject",value:function(e){delete this.xrayedObjects[e.id],this._numXRayedObjects--,this._xrayedObjectIds=null}},{key:"_objectHighlightedUpdated",value:function(e){e.highlighted?(this.highlightedObjects[e.id]=e,this._numHighlightedObjects++):(delete this.highlightedObjects[e.id],this._numHighlightedObjects--),this._highlightedObjectIds=null}},{key:"_deRegisterHighlightedObject",value:function(e){delete this.highlightedObjects[e.id],this._numHighlightedObjects--,this._highlightedObjectIds=null}},{key:"_objectSelectedUpdated",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.selected?(this.selectedObjects[e.id]=e,this._numSelectedObjects++):(delete this.selectedObjects[e.id],this._numSelectedObjects--),this._selectedObjectIds=null,t&&this.fire("objectSelected",e,!0)}},{key:"_deRegisterSelectedObject",value:function(e){delete this.selectedObjects[e.id],this._numSelectedObjects--,this._selectedObjectIds=null}},{key:"_objectColorizeUpdated",value:function(e,t){t?(this.colorizedObjects[e.id]=e,this._numColorizedObjects++):(delete this.colorizedObjects[e.id],this._numColorizedObjects--),this._colorizedObjectIds=null}},{key:"_deRegisterColorizedObject",value:function(e){delete this.colorizedObjects[e.id],this._numColorizedObjects--,this._colorizedObjectIds=null}},{key:"_objectOpacityUpdated",value:function(e,t){t?(this.opacityObjects[e.id]=e,this._numOpacityObjects++):(delete this.opacityObjects[e.id],this._numOpacityObjects--),this._opacityObjectIds=null}},{key:"_deRegisterOpacityObject",value:function(e){delete this.opacityObjects[e.id],this._numOpacityObjects--,this._opacityObjectIds=null}},{key:"_objectOffsetUpdated",value:function(e,t){!t||0===t[0]&&0===t[1]&&0===t[2]?(this.offsetObjects[e.id]=e,this._numOffsetObjects++):(delete this.offsetObjects[e.id],this._numOffsetObjects--),this._offsetObjectIds=null}},{key:"_deRegisterOffsetObject",value:function(e){delete this.offsetObjects[e.id],this._numOffsetObjects--,this._offsetObjectIds=null}},{key:"capabilities",get:function(){return this._renderer.capabilities}},{key:"entityOffsetsEnabled",get:function(){return this._entityOffsetsEnabled}},{key:"readableGeometryEnabled",get:function(){return this._readableGeometry}},{key:"pickSurfacePrecisionEnabled",get:function(){return this._readableGeometry}},{key:"logarithmicDepthBufferEnabled",get:function(){return this._logarithmicDepthBufferEnabled}},{key:"numCachedSectionPlanes",get:function(){return this._sectionPlanesState.getNumCachedSectionPlanes()},set:function(e){e=e||0,this._sectionPlanesState.getNumCachedSectionPlanes()!==e&&(this._sectionPlanesState.setNumCachedSectionPlanes(e),this._needRecompile=!0,this.glRedraw())}},{key:"pbrEnabled",get:function(){return this._pbrEnabled},set:function(e){this._pbrEnabled=!!e,this.glRedraw()}},{key:"dtxEnabled",get:function(){return this._dtxEnabled},set:function(e){e=!!e,this._dtxEnabled!==e&&(this._dtxEnabled=e)}},{key:"colorTextureEnabled",get:function(){return this._colorTextureEnabled},set:function(e){this._colorTextureEnabled=!!e,this.glRedraw()}},{key:"markerZOffset",get:function(){return null==this._markerZOffset?-.001:this._markerZOffset}},{key:"doOcclusionTest",value:function(){this._needRecompile&&(this._recompile(),this._needRecompile=!1),this._renderer.doOcclusionTest()}},{key:"render",value:function(e){e&&tt.runTasks();var t={sceneId:null,pass:0};if(this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),e||this._renderer.needsRender()){t.sceneId=this.id;for(var n=0;n<this._passes;n++)t.pass=n,this.fire("rendering",t,!0),e&&this._renderer.imageDirty(),this._renderer.render(n,this._clearEachPass||0===n),this.fire("rendered",t,!0);this._saveAmbientColor()}}},{key:"compile",value:function(){this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1)}},{key:"_recompile",value:function(){for(var e in this._compilables)this._compilables.hasOwnProperty(e)&&this._compilables[e].compile();this._renderer.shadowsDirty(),this.fire("compile",this,!0)}},{key:"_saveAmbientColor",value:function(){var e=this.canvas;if(e.transparent||e.backgroundImage||e.backgroundColor)this._lastAmbientColor=null;else{var t=this._lightsState.getAmbientColorAndIntensity();this._lastAmbientColor&&this._lastAmbientColor[0]===t[0]&&this._lastAmbientColor[1]===t[1]&&this._lastAmbientColor[2]===t[2]&&this._lastAmbientColor[3]===t[3]||(e.backgroundColor=t,this._lastAmbientColor||(this._lastAmbientColor=De.vec4([0,0,0,1])),this._lastAmbientColor.set(t))}}},{key:"modelIds",get:function(){return this._modelIds||(this._modelIds=Object.keys(this.models)),this._modelIds}},{key:"numObjects",get:function(){return this._numObjects}},{key:"objectIds",get:function(){return this._objectIds||(this._objectIds=Object.keys(this.objects)),this._objectIds}},{key:"numVisibleObjects",get:function(){return this._numVisibleObjects}},{key:"visibleObjectIds",get:function(){return this._visibleObjectIds||(this._visibleObjectIds=Object.keys(this.visibleObjects)),this._visibleObjectIds}},{key:"numXRayedObjects",get:function(){return this._numXRayedObjects}},{key:"xrayedObjectIds",get:function(){return this._xrayedObjectIds||(this._xrayedObjectIds=Object.keys(this.xrayedObjects)),this._xrayedObjectIds}},{key:"numHighlightedObjects",get:function(){return this._numHighlightedObjects}},{key:"highlightedObjectIds",get:function(){return this._highlightedObjectIds||(this._highlightedObjectIds=Object.keys(this.highlightedObjects)),this._highlightedObjectIds}},{key:"numSelectedObjects",get:function(){return this._numSelectedObjects}},{key:"selectedObjectIds",get:function(){return this._selectedObjectIds||(this._selectedObjectIds=Object.keys(this.selectedObjects)),this._selectedObjectIds}},{key:"numColorizedObjects",get:function(){return this._numColorizedObjects}},{key:"colorizedObjectIds",get:function(){return this._colorizedObjectIds||(this._colorizedObjectIds=Object.keys(this.colorizedObjects)),this._colorizedObjectIds}},{key:"opacityObjectIds",get:function(){return this._opacityObjectIds||(this._opacityObjectIds=Object.keys(this.opacityObjects)),this._opacityObjectIds}},{key:"offsetObjectIds",get:function(){return this._offsetObjectIds||(this._offsetObjectIds=Object.keys(this.offsetObjects)),this._offsetObjectIds}},{key:"ticksPerRender",get:function(){return this._ticksPerRender},set:function(e){null==e?e=1:(!je.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerRender': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._ticksPerRender&&(this._ticksPerRender=e)}},{key:"ticksPerOcclusionTest",get:function(){return this._ticksPerOcclusionTest},set:function(e){null==e?e=20:(!je.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerOcclusionTest': '"+e+"' - should be an integer greater than zero."),e=20),e!==this._ticksPerOcclusionTest&&(this._ticksPerOcclusionTest=e)}},{key:"passes",get:function(){return this._passes},set:function(e){null==e?e=1:(!je.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'passes': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._passes&&(this._passes=e,this.glRedraw())}},{key:"clearEachPass",get:function(){return this._clearEachPass},set:function(e){(e=!!e)!==this._clearEachPass&&(this._clearEachPass=e,this.glRedraw())}},{key:"gammaInput",get:function(){return this._renderer.gammaInput},set:function(e){(e=!1!==e)!==this._renderer.gammaInput&&(this._renderer.gammaInput=e,this._needRecompile=!0,this.glRedraw())}},{key:"gammaOutput",get:function(){return this._renderer.gammaOutput},set:function(e){(e=!!e)!==this._renderer.gammaOutput&&(this._renderer.gammaOutput=e,this._needRecompile=!0,this.glRedraw())}},{key:"gammaFactor",get:function(){return this._renderer.gammaFactor},set:function(e){(e=null==e?2.2:e)!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=e,this.glRedraw())}},{key:"geometry",get:function(){return this.components["default.geometry"]||qt(Wt)}},{key:"material",get:function(){return this.components["default.material"]||new wi(this,{id:"default.material",emissive:[.4,.4,.4],dontClear:!0})}},{key:"xrayMaterial",get:function(){return this.components["default.xrayMaterial"]||new Xi(this,{id:"default.xrayMaterial",fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1,dontClear:!0})}},{key:"highlightMaterial",get:function(){return this.components["default.highlightMaterial"]||new Xi(this,{id:"default.highlightMaterial",fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1,dontClear:!0})}},{key:"selectedMaterial",get:function(){return this.components["default.selectedMaterial"]||new Xi(this,{id:"default.selectedMaterial",fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1,dontClear:!0})}},{key:"edgeMaterial",get:function(){return this.components["default.edgeMaterial"]||new Zi(this,{id:"default.edgeMaterial",fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}},{key:"pointsMaterial",get:function(){return this.components["default.pointsMaterial"]||new sc(this,{id:"default.pointsMaterial",fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1,dontClear:!0})}},{key:"linesMaterial",get:function(){return this.components["default.linesMaterial"]||new oc(this,{id:"default.linesMaterial",fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1,dontClear:!0})}},{key:"viewport",get:function(){return this._viewport}},{key:"camera",get:function(){return this._camera}},{key:"center",get:function(){if(this._aabbDirty||!this._center){var e=this.aabb;this._center||(this._center=De.vec3()),this._center[0]=(e[0]+e[3])/2,this._center[1]=(e[1]+e[4])/2,this._center[2]=(e[2]+e[5])/2}return this._center}},{key:"aabb",get:function(){if(this._aabbDirty){this._aabb||(this._aabb=De.AABB3());var e,t,n=De.MAX_DOUBLE,r=De.MAX_DOUBLE,i=De.MAX_DOUBLE,s=De.MIN_DOUBLE,a=De.MIN_DOUBLE,o=De.MIN_DOUBLE,A=this._collidables,c=!1;for(var l in A)if(A.hasOwnProperty(l)){if(!1===(t=A[l]).collidable)continue;(e=t.aabb)[0]<n&&(n=e[0]),e[1]<r&&(r=e[1]),e[2]<i&&(i=e[2]),e[3]>s&&(s=e[3]),e[4]>a&&(a=e[4]),e[5]>o&&(o=e[5]),c=!0}c||(n=-100,r=-100,i=-100,s=100,a=100,o=100),this._aabb[0]=n,this._aabb[1]=r,this._aabb[2]=i,this._aabb[3]=s,this._aabb[4]=a,this._aabb[5]=o,this._aabbDirty=!1,this._center=null}return this._aabb}},{key:"_setAABBDirty",value:function(){this._aabbDirty=!0,this.fire("boundary")}},{key:"pick",value:function(e,t){if(!this.canvas)return this.error("Picking not allowed on a destroyed Scene"),null;if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;(e=e||{}).pickSurface=e.pickSurface||e.rayPick,e.canvasPos||e.matrix||e.origin&&e.direction||this.warn("picking without canvasPos, matrix, or ray origin and direction");var n=e.includeEntities||e.include;n&&(e.includeEntityIds=lc(this,n));var r=e.excludeEntities||e.exclude;return r&&(e.excludeEntityIds=lc(this,r)),this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),(t=e.snapToEdge||e.snapToVertex?this._renderer.snapPick(e,t):this._renderer.pick(e,t))&&t.entity&&t.entity.fire&&t.entity.fire("picked",t),t}},{key:"snapPick",value:function(e){return this.canvas?(void 0===this._warnSnapPickDeprecated&&(this._warnSnapPickDeprecated=!0,this.warn("Scene.snapPick() is deprecated since v2.4.2 - use Scene.pick() instead")),e.canvasPos?this._renderer.snapPick(e):void this.error("Scene.snapPick() canvasPos parameter expected")):(this.error("Picking not allowed on a destroyed Scene"),null)}},{key:"clear",value:function(){var e;for(var t in this.components)this.components.hasOwnProperty(t)&&((e=this.components[t])._dontClear||e.destroy())}},{key:"clearLights",value:function(){for(var e=Object.keys(this.lights),t=0,n=e.length;t<n;t++)this.lights[e[t]].destroy()}},{key:"clearSectionPlanes",value:function(){for(var e=Object.keys(this.sectionPlanes),t=0,n=e.length;t<n;t++)this.sectionPlanes[e[t]].destroy()}},{key:"clearBitmaps",value:function(){for(var e=Object.keys(this.bitmaps),t=0,n=e.length;t<n;t++)this.bitmaps[e[t]].destroy()}},{key:"clearLines",value:function(){for(var e=Object.keys(this.lineSets),t=0,n=e.length;t<n;t++)this.lineSets[e[t]].destroy()}},{key:"getAABB",value:function(e){if(void 0===e)return this.aabb;if(je.isString(e)){var t=this.objects[e];if(t&&t.aabb)return t.aabb;e=[e]}if(0===e.length)return this.aabb;var n,r=De.MAX_DOUBLE,i=De.MAX_DOUBLE,s=De.MAX_DOUBLE,a=De.MIN_DOUBLE,o=De.MIN_DOUBLE,A=De.MIN_DOUBLE;if(this.withObjects(e,(function(e){if(e.collidable){var t=e.aabb;t[0]<r&&(r=t[0]),t[1]<i&&(i=t[1]),t[2]<s&&(s=t[2]),t[3]>a&&(a=t[3]),t[4]>o&&(o=t[4]),t[5]>A&&(A=t[5]),n=!0}})),n){var c=De.AABB3();return c[0]=r,c[1]=i,c[2]=s,c[3]=a,c[4]=o,c[5]=A,c}return this.aabb}},{key:"setObjectsVisible",value:function(e,t){return this.withObjects(e,(function(e){var n=e.visible!==t;return e.visible=t,n}))}},{key:"setObjectsCollidable",value:function(e,t){return this.withObjects(e,(function(e){var n=e.collidable!==t;return e.collidable=t,n}))}},{key:"setObjectsCulled",value:function(e,t){return this.withObjects(e,(function(e){var n=e.culled!==t;return e.culled=t,n}))}},{key:"setObjectsSelected",value:function(e,t){return this.withObjects(e,(function(e){var n=e.selected!==t;return e.selected=t,n}))}},{key:"setObjectsHighlighted",value:function(e,t){return this.withObjects(e,(function(e){var n=e.highlighted!==t;return e.highlighted=t,n}))}},{key:"setObjectsXRayed",value:function(e,t){return this.withObjects(e,(function(e){var n=e.xrayed!==t;return e.xrayed=t,n}))}},{key:"setObjectsEdges",value:function(e,t){return this.withObjects(e,(function(e){var n=e.edges!==t;return e.edges=t,n}))}},{key:"setObjectsColorized",value:function(e,t){return this.withObjects(e,(function(e){e.colorize=t}))}},{key:"setObjectsOpacity",value:function(e,t){return this.withObjects(e,(function(e){var n=e.opacity!==t;return e.opacity=t,n}))}},{key:"setObjectsPickable",value:function(e,t){return this.withObjects(e,(function(e){var n=e.pickable!==t;return e.pickable=t,n}))}},{key:"setObjectsOffset",value:function(e,t){this.withObjects(e,(function(e){e.offset=t}))}},{key:"withObjects",value:function(e,t){je.isString(e)&&(e=[e]);for(var n=!1,r=0,i=e.length;r<i;r++){var s=e[r],a=this.objects[s];if(a)n=t(a)||n;else for(var o=this.modelIds,A=0,c=o.length;A<c;A++){var l=o[A],u=De.globalizeObjectId(l,s);(a=this.objects[u])&&(n=t(a)||n)}}return n}},{key:"tickify",value:function(e){var t=e.toString();if(t in this._tickifiedFunctions)return this._tickifiedFunctions[t].wrapperFunc;var n,r=0,i=0,s=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];n=t,i++},a=this.on("tick",(function(){i>r&&(r=i,e.apply(void 0,p(n)))}));return this._tickifiedFunctions[t]={tickSubId:a,wrapperFunc:s},s}},{key:"destroy",value:function(){for(var e in v(C(n.prototype),"destroy",this).call(this),this._removeWebglcontextlostListener(),this.components)this.components.hasOwnProperty(e)&&this.components[e].destroy();this._sectionCaps.destroy(),this.canvas.gl=null,this.components=null,this.models=null,this.objects=null,this.visibleObjects=null,this.xrayedObjects=null,this.highlightedObjects=null,this.selectedObjects=null,this.colorizedObjects=null,this.opacityObjects=null,this.sectionPlanes=null,this.lights=null,this.lightMaps=null,this.reflectionMaps=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this._sectionCaps=null,this.types=null,this.components=null,this.canvas=null,this._renderer=null,this.input=null,this._viewport=null,this._camera=null}}]),n}(),hc=De.vec4(),dc=De.vec4(),fc=De.vec3(),pc=De.vec3(),vc=De.vec3(),gc=De.vec4(),mc=De.vec4(),yc=De.vec4(),_c=function(){function e(t){x(this,e),this._scene=t}return I(e,[{key:"dollyToCanvasPos",value:function(e,t,n){var r=!1,i=this._scene.camera;if(e){var s=De.subVec3(e,i.eye,fc);r=De.lenVec3(s)<n}if("perspective"===i.projection){i.ortho.scale=i.ortho.scale-n;var a=this._unproject(t,gc),o=De.subVec3(a,i.eye,yc),A=De.mulVec3Scalar(De.normalizeVec3(o),-n,[]);if(i.eye=[i.eye[0]-A[0],i.eye[1]-A[1],i.eye[2]-A[2]],i.look=[i.look[0]-A[0],i.look[1]-A[1],i.look[2]-A[2]],e){var c=De.subVec3(e,i.eye,fc),l=De.lenVec3(c),u=De.mulVec3Scalar(De.normalizeVec3(De.subVec3(i.look,i.eye,pc)),l);i.look=[i.eye[0]+u[0],i.eye[1]+u[1],i.eye[2]+u[2]]}}else if("ortho"===i.projection){var h=this._unproject(t,gc);i.ortho.scale=i.ortho.scale-n,i.ortho._update();var d=this._unproject(t,mc),f=De.subVec3(d,h,yc),p=De.mulVec3Scalar(De.normalizeVec3(De.subVec3(i.look,i.eye,fc)),-n,pc),v=De.addVec3(f,p,vc);i.eye=[i.eye[0]-v[0],i.eye[1]-v[1],i.eye[2]-v[2]],i.look=[i.look[0]-v[0],i.look[1]-v[1],i.look[2]-v[2]]}return r}},{key:"_unproject",value:function(e,t){var n=this._scene.camera,r=n.project.transposedMatrix,i=r.subarray(8,12),s=r.subarray(12),a=[0,0,-1,1],o=De.dotVec4(a,i)/De.dotVec4(a,s);return n.project.unproject(e,o,hc,dc,t),t}},{key:"destroy",value:function(){}}]),e}(),bc=De.vec3(),wc=De.vec3(),Bc=De.vec3(),Cc=De.vec4(),Mc=De.vec4(),kc=De.vec4(),Ec=Math.PI-.001,Fc=function(){function e(t,n){var r=this;x(this,e),this._scene=t,this._configs=n,this._pivotWorldPos=De.vec3(),this._cameraOffset=De.vec3(),this._azimuth=0,this._polar=0,this._radius=0,this._pivotPosSet=!1,this._pivoting=!1,this._shown=!1,this._pivotSphereEnabled=!1,this._pivotSphere=null,this._pivotSphereSize=1,this._pivotSphereGeometry=null,this._pivotSphereMaterial=null,this._rtcCenter=De.vec3(),this._rtcPos=De.vec3(),this._pivotViewPos=De.vec4(),this._pivotProjPos=De.vec4(),this._pivotCanvasPos=De.vec2(),this._cameraDirty=!0,this._onViewMatrix=this._scene.camera.on("viewMatrix",(function(){r._cameraDirty=!0})),this._onProjMatrix=this._scene.camera.on("projMatrix",(function(){r._cameraDirty=!0})),this._onTick=this._scene.on("tick",(function(){r.updatePivotElement(),r.updatePivotSphere()}))}return I(e,[{key:"createPivotSphere",value:function(){var e=this.getPivotPos(),t=De.vec3();De.decomposeMat4(De.inverseMat4(this._scene.viewer.camera.viewMatrix,De.mat4()),t,De.vec4(),De.vec3());var n=De.distVec3(t,e),r=Math.tan(Math.PI/500)*n*this._pivotSphereSize;"ortho"==this._scene.camera.projection&&(r/=this._scene.camera.ortho.scale/2),Cn(e,this._rtcCenter,this._rtcPos),this._pivotSphereGeometry=new Kt(this._scene,sn({radius:r})),this._pivotSphere=new vi(this._scene,{geometry:this._pivotSphereGeometry,material:this._pivotSphereMaterial,pickable:!1,position:this._rtcPos,rtcCenter:this._rtcCenter})}},{key:"destroyPivotSphere",value:function(){this._pivotSphere&&(this._pivotSphere.destroy(),this._pivotSphere=null),this._pivotSphereGeometry&&(this._pivotSphereGeometry.destroy(),this._pivotSphereGeometry=null)}},{key:"updatePivotElement",value:function(){var e=this._scene.camera,t=this._scene.canvas;if(this._pivoting&&this._cameraDirty){De.transformPoint3(e.viewMatrix,this.getPivotPos(),this._pivotViewPos),this._pivotViewPos[3]=1,De.transformPoint4(e.projMatrix,this._pivotViewPos,this._pivotProjPos);var n=t.boundary,r=n[2],i=n[3];this._pivotCanvasPos[0]=Math.floor((1+this._pivotProjPos[0]/this._pivotProjPos[3])*r/2),this._pivotCanvasPos[1]=Math.floor((1-this._pivotProjPos[1]/this._pivotProjPos[3])*i/2);var s=t._lastBoundingClientRect;if(!s||t._canvasSizeChanged){var a=t.canvas;s=t._lastBoundingClientRect=a.getBoundingClientRect()}this._pivotElement&&(this._pivotElement.style.left=Math.floor(s.left+this._pivotCanvasPos[0])-this._pivotElement.clientWidth/2+window.scrollX+"px",this._pivotElement.style.top=Math.floor(s.top+this._pivotCanvasPos[1])-this._pivotElement.clientHeight/2+window.scrollY+"px"),this._cameraDirty=!1}}},{key:"updatePivotSphere",value:function(){this._pivoting&&this._pivotSphere&&(Cn(this.getPivotPos(),this._rtcCenter,this._rtcPos),De.compareVec3(this._rtcPos,this._pivotSphere.position)||(this.destroyPivotSphere(),this.createPivotSphere()))}},{key:"setPivotElement",value:function(e){this._pivotElement=e}},{key:"enablePivotSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.destroyPivotSphere(),this._pivotSphereEnabled=!0,e.size&&(this._pivotSphereSize=e.size);var t=e.color||[1,0,0];this._pivotSphereMaterial=new wi(this._scene,{emissive:t,ambient:t,specular:[0,0,0],diffuse:[0,0,0]})}},{key:"disablePivotSphere",value:function(){this.destroyPivotSphere(),this._pivotSphereEnabled=!1}},{key:"startPivot",value:function(){var e=this._scene.camera,t=De.lookAtMat4v(e.eye,e.look,e.up);De.transformPoint3(t,this.getPivotPos(),this._cameraOffset);var n=this.getPivotPos();this._cameraOffset[2]+=De.distVec3(e.eye,n),t=De.inverseMat4(t);var r=De.transformVec3(t,this._cameraOffset),i=De.vec3();if(De.subVec3(e.eye,n,i),De.addVec3(i,r),e.zUp){var s=i[1];i[1]=i[2],i[2]=s}this._radius=De.lenVec3(i),this._polar=Math.acos(i[1]/this._radius),this._azimuth=Math.atan2(i[0],i[2]),this._pivoting=!0}},{key:"_cameraLookingDownwards",value:function(){var e=this._scene.camera,t=De.normalizeVec3(De.subVec3(e.look,e.eye,bc)),n=De.cross3Vec3(t,e.worldUp,wc);return De.sqLenVec3(n)<=1e-4}},{key:"getPivoting",value:function(){return this._pivoting}},{key:"setPivotPos",value:function(e){this._pivotWorldPos.set(e),this._pivotPosSet=!0}},{key:"setCanvasPivotPos",value:function(e){var t=this._scene.camera,n=Math.abs(De.distVec3(this._scene.center,t.eye)),r=t.project.transposedMatrix,i=r.subarray(8,12),s=r.subarray(12),a=[0,0,-1,1],o=De.dotVec4(a,i)/De.dotVec4(a,s),A=Cc;t.project.unproject(e,o,Mc,kc,A);var c=De.normalizeVec3(De.subVec3(A,t.eye,bc)),l=De.addVec3(t.eye,De.mulVec3Scalar(c,n,wc),Bc);this.setPivotPos(l)}},{key:"getPivotPos",value:function(){return this._pivotPosSet?this._pivotWorldPos:this._scene.camera.look}},{key:"continuePivot",value:function(e,t){if(this._pivoting&&(0!==e||0!==t)){var n=this._scene.camera,r=-e,i=-t;1===n.worldUp[2]&&(r=-r),this._azimuth+=.01*-r;var s=i<0,a=i>0,o=Math.abs(this._polar-.001)<.005,A=Math.abs(this._polar-Ec)<.005,c=this._polar+.01*i;c=o&&s?.001:A&&a?Ec:De.clamp(c,.001,Ec),this._polar=c;var l=[this._radius*Math.sin(this._polar)*Math.sin(this._azimuth),this._radius*Math.cos(this._polar),this._radius*Math.sin(this._polar)*Math.cos(this._azimuth)];if(1===n.worldUp[2]){var u=l[1];l[1]=l[2],l[2]=u}var h=De.lenVec3(De.subVec3(n.look,n.eye,De.vec3())),d=this.getPivotPos();De.addVec3(l,d);var f=De.lookAtMat4v(l,d,n.worldUp);f=De.inverseMat4(f);var p=De.transformVec3(f,this._cameraOffset);f[12]-=p[0],f[13]-=p[1],f[14]-=p[2];var v=[f[8],f[9],f[10]];n.eye=[f[12],f[13],f[14]],De.subVec3(n.eye,De.mulVec3Scalar(v,h),n.look),n.up=[f[4],f[5],f[6]],this.showPivot()}}},{key:"showPivot",value:function(){this._shown||(this._pivotElement&&(this.updatePivotElement(),this._pivotElement.style.visibility="visible"),this._pivotSphereEnabled&&(this.destroyPivotSphere(),this.createPivotSphere()),this._shown=!0)}},{key:"hidePivot",value:function(){this._shown&&(this._pivotElement&&(this._pivotElement.style.visibility="hidden"),this._pivotSphereEnabled&&this.destroyPivotSphere(),this._shown=!1)}},{key:"endPivot",value:function(){this._pivoting=!1}},{key:"destroy",value:function(){this.destroyPivotSphere(),this._scene.camera.off(this._onViewMatrix),this._scene.camera.off(this._onProjMatrix),this._scene.off(this._onTick)}}]),e}(),xc=function(){function e(t,n){x(this,e),this._scene=t.scene,this._cameraControl=t,this._scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},this._configs=n,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.scheduleSnapOrPick=!1,this.pickCursorPos=De.vec2(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,this._lastPickedEntityId=null,this._lastHash=null,this._needFireEvents=0}return I(e,[{key:"update",value:function(){if(this._configs.pointerEnabled&&(this.schedulePickEntity||this.schedulePickSurface)){var e="".concat(~~this.pickCursorPos[0],"-").concat(~~this.pickCursorPos[1],"-").concat(this.scheduleSnapOrPick,"-").concat(this.schedulePickSurface,"-").concat(this.schedulePickEntity);if(this._lastHash!==e){this.picked=!1,this.pickedSurface=!1,this.snappedOrPicked=!1,this.hoveredSnappedOrSurfaceOff=!1;var t=this._cameraControl.hasSubs("hoverSurface");if(this.scheduleSnapOrPick){var n=this._scene.pick({canvasPos:this.pickCursorPos,snapRadius:this._configs.snapRadius,snapToVertex:this._configs.snapToVertex,snapToEdge:this._configs.snapToEdge});n&&(n.snappedToEdge||n.snappedToVertex)?(this.snapPickResult=n,this.snappedOrPicked=!0,this._needFireEvents++):(this.schedulePickSurface=!0,this.snapPickResult=null)}if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){var r=this.pickResult.canvasPos;if(r[0]===this.pickCursorPos[0]&&r[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,this._needFireEvents+=t?1:0,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.scheduleSnapOrPick?this.snappedOrPicked=!0:this.hoveredSnappedOrSurfaceOff=!0,void(this.scheduleSnapOrPick=!1)}if(this.schedulePickEntity&&this.pickResult&&(this.pickResult.canvasPos||this.pickResult.snappedCanvasPos)){var i=this.pickResult.canvasPos||this.pickResult.snappedCanvasPos;if(i[0]===this.pickCursorPos[0]&&i[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickSurface||this.scheduleSnapOrPick&&!this.snapPickResult?(this.pickResult=this._scene.pick({pickSurface:!0,pickSurfaceNormal:!1,canvasPos:this.pickCursorPos}),this.pickResult?(this.picked=!0,this.scheduleSnapOrPick?this.snappedOrPicked=!0:this.pickedSurface=!0,this._needFireEvents++):this.scheduleSnapOrPick&&(this.hoveredSnappedOrSurfaceOff=!0,this._needFireEvents++)):(this.pickResult=this._scene.pick({canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!1,this._needFireEvents++)),this.scheduleSnapOrPick=!1,this.schedulePickEntity=!1,this.schedulePickSurface=!1}}}},{key:"fireEvents",value:function(){if(0!==this._needFireEvents){if(this.hoveredSnappedOrSurfaceOff&&this._cameraControl.fire("hoverSnapOrSurfaceOff",{canvasPos:this.pickCursorPos,pointerPos:this.pickCursorPos},!0),this.snappedOrPicked)if(this.snapPickResult){var e=new cA;e.entity=this.snapPickResult.entity,e.snappedToVertex=this.snapPickResult.snappedToVertex,e.snappedToEdge=this.snapPickResult.snappedToEdge,e.worldPos=this.snapPickResult.worldPos,e.canvasPos=this.pickCursorPos,e.snappedCanvasPos=this.snapPickResult.snappedCanvasPos,this._cameraControl.fire("hoverSnapOrSurface",e,!0),this.snapPickResult=null}else this._cameraControl.fire("hoverSnapOrSurface",this.pickResult,!0);if(this.picked&&this.pickResult&&(this.pickResult.entity||this.pickResult.worldPos)){if(this.pickResult.entity){var t=this.pickResult.entity.id;this._lastPickedEntityId!==t&&(void 0!==this._lastPickedEntityId&&this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._cameraControl.fire("hoverEnter",this.pickResult,!0),this._lastPickedEntityId=t)}this._cameraControl.fire("hover",this.pickResult,!0),this.pickResult.worldPos&&(this.pickedSurface=!0,this._cameraControl.fire("hoverSurface",this.pickResult,!0))}else void 0!==this._lastPickedEntityId&&(this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),this._cameraControl.fire("hoverOff",{canvasPos:this.pickCursorPos},!0);this.pickResult=null,this._needFireEvents=0}}}]),e}(),Uc=De.vec2(),Ic=function(e,t,n){if(e){var r=t.getBoundingClientRect();n[0]=e.clientX-r.left,n[1]=e.clientY-r.top}else e=window.event,n[0]=e.x,n[1]=e.y;return n},Tc=function(){function e(t,n,r,i,s){x(this,e),this._scene=t;var a,o,A,c=n.pickController,l=n.cameraControl,u=0,h=0,d=0,f=0,p=!1,v=De.vec3(),g=!0,m=this._scene.canvas.canvas,y=[];function _(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];b(),e&&w()}function b(){u=i.pointerCanvasPos[0],h=i.pointerCanvasPos[1],d=i.pointerCanvasPos[0],f=i.pointerCanvasPos[1]}function w(){c.pickCursorPos=i.pointerCanvasPos,c.schedulePickSurface=!0,c.update(),c.picked&&c.pickedSurface&&c.pickResult&&c.pickResult.worldPos?(p=!0,v.set(c.pickResult.worldPos)):p=!1}document.addEventListener("keydown",this._documentKeyDownHandler=function(e){if(r.active&&r.pointerEnabled&&t.input.keyboardEnabled){var n=e.keyCode;y[n]=!0}}),document.addEventListener("keyup",this._documentKeyUpHandler=function(e){if(r.active&&r.pointerEnabled&&t.input.keyboardEnabled){var n=e.keyCode;y[n]=!1}}),document.addEventListener("visibilitychange",this._onVisibilityChange=function(){y.splice(0)}),window.addEventListener("blur",this._onBlur=function(){y.splice(0)}),m.addEventListener("mousedown",this._mouseDownHandler=function(e){if(r.active&&r.pointerEnabled)switch(e.which){case 1:y[t.input.KEY_SHIFT]||r.planView?(a=!0,y[t.input.MOUSE_LEFT_BUTTON]=!0,_()):(a=!0,y[t.input.MOUSE_LEFT_BUTTON]=!0,_(!1));break;case 2:o=!0,y[t.input.MOUSE_MIDDLE_BUTTON]=!0,_();break;case 3:A=!0,y[t.input.MOUSE_RIGHT_BUTTON]=!0,r.panRightClick&&_()}}),document.addEventListener("mousemove",this._documentMouseMoveHandler=function(e){if(r.active&&r.pointerEnabled&&(a||o||A)){var n=t.canvas.boundary,c=n[2],d=n[3],f=i.pointerCanvasPos[0],g=i.pointerCanvasPos[1],m=r.planView||l._isKeyDownForAction(l.MOUSE_PAN,y),_=l._isKeyDownForAction(l.MOUSE_ROTATE,y),b=document.pointerLockElement?e.movementX:f-u,w=document.pointerLockElement?e.movementY:g-h;if(m){var B=t.camera;if("perspective"===B.projection){var C=Math.abs(p?De.lenVec3(De.subVec3(v,t.camera.eye,[])):t.camera.eyeLookDist)*Math.tan(B.perspective.fov/2*Math.PI/180);s.panDeltaX+=1.5*b*C/d,s.panDeltaY+=1.5*w*C/d}else s.panDeltaX+=.5*B.ortho.scale*(b/d),s.panDeltaY+=.5*B.ortho.scale*(w/d)}else _&&(r.planView||(r.firstPerson?(s.rotateDeltaY-=b/c*r.dragRotationRate/2,s.rotateDeltaX+=w/d*(r.dragRotationRate/4)):(s.rotateDeltaY-=b/c*(1.5*r.dragRotationRate),s.rotateDeltaX+=w/d*(1.5*r.dragRotationRate))));u=f,h=g}}),m.addEventListener("mousemove",this._canvasMouseMoveHandler=function(e){r.active&&r.pointerEnabled&&i.mouseover&&(g=!0)}),document.addEventListener("mouseup",this._documentMouseUpHandler=function(e){if(r.active&&r.pointerEnabled)switch(e.which){case 1:case 2:case 3:a=!1,o=!1,A=!1,y[t.input.MOUSE_LEFT_BUTTON]=!1,y[t.input.MOUSE_MIDDLE_BUTTON]=!1,y[t.input.MOUSE_RIGHT_BUTTON]=!1}}),m.addEventListener("mouseup",this._mouseUpHandler=function(e){if(r.active&&r.pointerEnabled){if(3===e.which){Ic(e,m,Uc);var t=Uc[0],i=Uc[1];Math.abs(t-d)<3&&Math.abs(i-f)<3&&n.cameraControl.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:Uc,event:e},!0)}m.style.removeProperty("cursor")}}),m.addEventListener("mouseenter",this._mouseEnterHandler=function(){r.active&&r.pointerEnabled});var B=1/60,C=null;m.addEventListener("wheel",this._mouseWheelHandler=function(e){if(r.active&&r.pointerEnabled&&r.zoomOnMouseWheel&&l._isKeyDownForAction(l.MOUSE_DOLLY,y)){var t=performance.now()/1e3,n=null!==C?t-C:0;C=t,n>.05&&(n=.05),n<B&&(n=B);var a=Math.max(-1,Math.min(1,40*-e.deltaY));if(0!==a){var o=a/Math.abs(a);s.dollyDelta+=-o*n*r.mouseWheelDollyRate,g&&(0===i.pointerCanvasPos[0]&&0===i.pointerCanvasPos[1]&&Ic(e,m,i.pointerCanvasPos),i.followPointerDirty=!0,g=!1)}}},{passive:!0})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;document.removeEventListener("keydown",this._documentKeyDownHandler),document.removeEventListener("keyup",this._documentKeyUpHandler),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("blur",this._onBlur),e.removeEventListener("mousedown",this._mouseDownHandler),document.removeEventListener("mousemove",this._documentMouseMoveHandler),e.removeEventListener("mousemove",this._canvasMouseMoveHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("wheel",this._mouseWheelHandler)}}]),e}(),Pc=De.vec3(),Sc=De.vec3(),Dc=De.vec3(),Qc=De.vec3(),Rc=De.vec3(),Oc={eye:De.vec3(),look:De.vec3(),up:De.vec3()},Vc=function(){function e(t,n,r,i){x(this,e),this._scene=t;var s=n.cameraControl,a=t.camera;this._onSceneKeyDown=t.input.on("keydown",(function(){if(r.active&&r.pointerEnabled&&t.input.keyboardEnabled&&(!r.keyboardEnabledOnlyIfMouseover||i.mouseover)){var e=s._isKeyDownForAction(s.AXIS_VIEW_RIGHT),o=s._isKeyDownForAction(s.AXIS_VIEW_BACK),A=s._isKeyDownForAction(s.AXIS_VIEW_LEFT),c=s._isKeyDownForAction(s.AXIS_VIEW_FRONT),l=s._isKeyDownForAction(s.AXIS_VIEW_TOP),u=s._isKeyDownForAction(s.AXIS_VIEW_BOTTOM);if(e||o||A||c||l||u){var h=t.aabb,d=De.getAABB3Diag(h);De.getAABB3Center(h,Pc);var f=Math.abs(d/Math.tan(n.cameraFlight.fitFOV*De.DEGTORAD)),p=1.1*d;Oc.orthoScale=p,e?(Oc.eye.set(De.addVec3(Pc,De.mulVec3Scalar(a.worldRight,f,Sc),Rc)),Oc.look.set(Pc),Oc.up.set(a.worldUp)):o?(Oc.eye.set(De.addVec3(Pc,De.mulVec3Scalar(a.worldForward,f,Sc),Rc)),Oc.look.set(Pc),Oc.up.set(a.worldUp)):A?(Oc.eye.set(De.addVec3(Pc,De.mulVec3Scalar(a.worldRight,-f,Sc),Rc)),Oc.look.set(Pc),Oc.up.set(a.worldUp)):c?(Oc.eye.set(De.addVec3(Pc,De.mulVec3Scalar(a.worldForward,-f,Sc),Rc)),Oc.look.set(Pc),Oc.up.set(a.worldUp)):l?(Oc.eye.set(De.addVec3(Pc,De.mulVec3Scalar(a.worldUp,f,Sc),Rc)),Oc.look.set(Pc),Oc.up.set(De.normalizeVec3(De.mulVec3Scalar(a.worldForward,1,Dc),Qc))):u&&(Oc.eye.set(De.addVec3(Pc,De.mulVec3Scalar(a.worldUp,-f,Sc),Rc)),Oc.look.set(Pc),Oc.up.set(De.normalizeVec3(De.mulVec3Scalar(a.worldForward,-1,Dc)))),!r.firstPerson&&r.followPointer&&n.pivotController.setPivotPos(Pc),n.cameraFlight.duration>0?n.cameraFlight.flyTo(Oc,(function(){n.pivotController.getPivoting()&&r.followPointer&&n.pivotController.showPivot()})):(n.cameraFlight.jumpTo(Oc),n.pivotController.getPivoting()&&r.followPointer&&n.pivotController.showPivot())}}}))}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){this._scene.input.off(this._onSceneKeyDown)}}]),e}(),Lc=function(){function e(t,n,r,i,s){var a=this;x(this,e),this._scene=t;var o=n.pickController,A=n.pivotController,c=n.cameraControl;this._clicks=0,this._timeout=null,this._lastPickedEntityId=null,this._lastClickedWorldPos=null;var l=!1,u=!1,h=this._scene.canvas.canvas,d=function(e){var r;e&&e.worldPos&&(r=e.worldPos);var i=e&&e.entity?e.entity.aabb:t.aabb;if(r){var s=t.camera;De.subVec3(s.eye,s.look,[]),n.cameraFlight.flyTo({aabb:i})}else n.cameraFlight.flyTo({aabb:i})},f=t.tickify(this._canvasMouseMoveHandler=function(e){if(r.active&&r.pointerEnabled&&!l&&!u){if(c.hasSubs("rayMove")){var n=De.vec3(),s=De.vec3();De.canvasPosToWorldRay(t.canvas.canvas,t.camera.viewMatrix,t.camera.projMatrix,t.camera.projection,i.pointerCanvasPos,n,s),c.fire("rayMove",{canvasPos:i.pointerCanvasPos,ray:{origin:n,direction:s,canvasPos:i.pointerCanvasPos}},!0)}var A=c.hasSubs("hover"),h=c.hasSubs("hoverEnter"),d=c.hasSubs("hoverOut"),f=c.hasSubs("hoverOff"),p=c.hasSubs("hoverSurface"),v=c.hasSubs("hoverSnapOrSurface");if(A||h||d||f||p||v)if(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=p,o.scheduleSnapOrPick=v,o.update(),o.pickResult){if(o.pickResult.entity){var g=o.pickResult.entity.id;a._lastPickedEntityId!==g&&(void 0!==a._lastPickedEntityId&&c.fire("hoverOut",{entity:t.objects[a._lastPickedEntityId]},!0),c.fire("hoverEnter",o.pickResult,!0),a._lastPickedEntityId=g)}c.fire("hover",o.pickResult,!0),(o.pickResult.worldPos||o.pickResult.snappedWorldPos)&&c.fire("hoverSurface",o.pickResult,!0)}else void 0!==a._lastPickedEntityId&&(c.fire("hoverOut",{entity:t.objects[a._lastPickedEntityId]},!0),a._lastPickedEntityId=void 0),c.fire("hoverOff",{canvasPos:o.pickCursorPos},!0)}});h.addEventListener("mousemove",f),h.addEventListener("mousedown",this._canvasMouseDownHandler=function(e){if(1===e.which&&(l=!0),3===e.which&&(u=!0),1===e.which&&r.active&&r.pointerEnabled&&(i.mouseDownClientX=e.clientX,i.mouseDownClientY=e.clientY,i.mouseDownCursorX=i.pointerCanvasPos[0],i.mouseDownCursorY=i.pointerCanvasPos[1],!r.firstPerson&&r.followPointer&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),1===e.which))){var n=o.pickResult;n&&n.worldPos?(A.setPivotPos(n.worldPos),A.startPivot(),a._lastClickedWorldPos=n.worldPos.slice()):(r.smartPivot?A.setCanvasPivotPos(i.pointerCanvasPos):a._lastClickedWorldPos?A.setPivotPos(a._lastClickedWorldPos):A.setPivotPos(t.camera.look),A.startPivot())}}),document.addEventListener("mouseup",this._documentMouseUpHandler=function(e){1===e.which&&(l=!1),3===e.which&&(u=!1),A.getPivoting()&&A.endPivot()}),h.addEventListener("mouseup",this._canvasMouseUpHandler=function(e){if(r.active&&r.pointerEnabled&&(1===e.which&&(A.hidePivot(),!(Math.abs(e.clientX-i.mouseDownClientX)>3||Math.abs(e.clientY-i.mouseDownClientY)>3)))){var s=c.hasSubs("picked"),l=c.hasSubs("pickedNothing"),u=c.hasSubs("pickedSurface"),h=c.hasSubs("doublePicked"),f=c.hasSubs("doublePickedSurface"),p=c.hasSubs("doublePickedNothing");if(!(r.doublePickFlyTo||h||f||p))return(s||l||u)&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=u,o.update(),o.pickResult?(c.fire("picked",o.pickResult,!0),o.pickedSurface&&c.fire("pickedSurface",o.pickResult,!0)):c.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0)),void(a._clicks=0);if(a._clicks++,1===a._clicks){o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=r.doublePickFlyTo,o.schedulePickSurface=u,o.update();var v=o.pickResult,g=o.pickedSurface;a._timeout=setTimeout((function(){v?(c.fire("picked",v,!0),g&&(c.fire("pickedSurface",v,!0),!r.firstPerson&&r.followPointer&&(n.pivotController.setPivotPos(v.worldPos),n.pivotController.startPivot()&&n.pivotController.showPivot()))):c.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0),a._clicks=0}),r.doubleClickTimeFrame)}else{if(null!==a._timeout&&(window.clearTimeout(a._timeout),a._timeout=null),o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=r.doublePickFlyTo||h||f,o.schedulePickSurface=o.schedulePickEntity&&f,o.update(),o.pickResult){if(c.fire("doublePicked",o.pickResult,!0),o.pickedSurface&&c.fire("doublePickedSurface",o.pickResult,!0),r.doublePickFlyTo&&(d(o.pickResult),!r.firstPerson&&r.followPointer)){var m=o.pickResult.entity.aabb,y=De.getAABB3Center(m);n.pivotController.setPivotPos(y),n.pivotController.startPivot()&&n.pivotController.showPivot()}}else if(c.fire("doublePickedNothing",{canvasPos:i.pointerCanvasPos},!0),r.doublePickFlyTo&&(d(),!r.firstPerson&&r.followPointer)){var _=t.aabb,b=De.getAABB3Center(_);n.pivotController.setPivotPos(b),n.pivotController.startPivot()&&n.pivotController.showPivot()}a._clicks=0}}},!1)}return I(e,[{key:"reset",value:function(){this._clicks=0,this._lastPickedEntityId=null,this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;e.removeEventListener("mousemove",this._canvasMouseMoveHandler),e.removeEventListener("mousedown",this._canvasMouseDownHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._canvasMouseUpHandler),this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}}]),e}(),Hc=function(){function e(t,n,r,i,s){x(this,e),this._scene=t;var a=t.input,o=[];t.canvas.canvas;var A=!0;this._onSceneMouseMove=a.on("mousemove",(function(){A=!0})),this._onSceneKeyDown=a.on("keydown",(function(e){r.active&&r.pointerEnabled&&t.input.keyboardEnabled&&(r.keyboardEnabledOnlyIfMouseover&&!i.mouseover||(o[e]=!0))})),this._onSceneKeyUp=a.on("keyup",(function(e){r.active&&r.pointerEnabled&&t.input.keyboardEnabled&&(o[e]=!1,n.pivotController.getPivoting()&&n.pivotController.endPivot())})),document.addEventListener("visibilitychange",this._onVisibilityChange=function(){o.splice(0)}),window.addEventListener("blur",this._onBlur=function(){o.splice(0)}),this._onTick=t.on("tick",(function(e){if(r.active&&r.pointerEnabled&&t.input.keyboardEnabled&&(!r.keyboardEnabledOnlyIfMouseover||i.mouseover)){var c=n.cameraControl,l=e.deltaTime/1e3;if(!r.planView){var u=c._isKeyDownForAction(c.ROTATE_Y_POS,o),h=c._isKeyDownForAction(c.ROTATE_Y_NEG,o),d=c._isKeyDownForAction(c.ROTATE_X_POS,o),f=c._isKeyDownForAction(c.ROTATE_X_NEG,o),p=l*r.keyboardRotationRate;(u||h||d||f)&&(!r.firstPerson&&r.followPointer&&n.pivotController.startPivot(),u?s.rotateDeltaY+=p:h&&(s.rotateDeltaY-=p),d?s.rotateDeltaX+=p:f&&(s.rotateDeltaX-=p),!r.firstPerson&&r.followPointer&&n.pivotController.startPivot())}if(!o[a.KEY_CTRL]&&!o[a.KEY_ALT]){var v=c._isKeyDownForAction(c.DOLLY_BACKWARDS,o),g=c._isKeyDownForAction(c.DOLLY_FORWARDS,o);if(v||g){var m=l*r.keyboardDollyRate;!r.firstPerson&&r.followPointer&&n.pivotController.startPivot(),g?s.dollyDelta-=m:v&&(s.dollyDelta+=m),A&&(i.followPointerDirty=!0,A=!1)}}var y=c._isKeyDownForAction(c.PAN_FORWARDS,o),_=c._isKeyDownForAction(c.PAN_BACKWARDS,o),b=c._isKeyDownForAction(c.PAN_LEFT,o),w=c._isKeyDownForAction(c.PAN_RIGHT,o),B=c._isKeyDownForAction(c.PAN_UP,o),C=c._isKeyDownForAction(c.PAN_DOWN,o),M=(o[a.KEY_ALT]?.3:1)*l*r.keyboardPanRate;(y||_||b||w||B||C)&&(!r.firstPerson&&r.followPointer&&n.pivotController.startPivot(),C?s.panDeltaY+=M:B&&(s.panDeltaY+=-M),w?s.panDeltaX+=-M:b&&(s.panDeltaX+=M),_?s.panDeltaZ+=M:y&&(s.panDeltaZ+=-M))}}))}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){this._scene.off(this._onTick),this._scene.input.off(this._onSceneMouseMove),this._scene.input.off(this._onSceneKeyDown),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("blur",this._onBlur),this._scene.input.off(this._onSceneKeyUp)}}]),e}(),Nc=De.vec3(),Gc=function(){function e(t,n,r,i,s){x(this,e),this._scene=t;var a=t.camera,o=n.pickController,A=n.pivotController,c=n.panController,l=n.cameraControl,u=1,h=1,d=null;this._onTick=t.on("tick",(function(){if(r.active&&r.pointerEnabled){var e="default";if(Math.abs(s.dollyDelta)<.001&&(s.dollyDelta=0),Math.abs(s.rotateDeltaX)<.001&&(s.rotateDeltaX=0),Math.abs(s.rotateDeltaY)<.001&&(s.rotateDeltaY=0),0===s.rotateDeltaX&&0===s.rotateDeltaY||(s.dollyDelta=0),r.followPointer){if(--u<=0&&(u=1,0!==s.dollyDelta)){if(0===s.rotateDeltaY&&0===s.rotateDeltaX&&r.followPointer&&i.followPointerDirty&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),o.pickResult&&o.pickResult.worldPos?d=o.pickResult.worldPos:(h=1,d=null),i.followPointerDirty=!1),d){var n=Math.abs(De.lenVec3(De.subVec3(d,t.camera.eye,Nc)));h=n/r.dollyProximityThreshold}h<r.dollyMinSpeed&&(h=r.dollyMinSpeed)}}else h=1,d=null;var f=s.dollyDelta*h;if(0===s.rotateDeltaY&&0===s.rotateDeltaX||(!r.firstPerson&&r.followPointer&&A.getPivoting()?(A.continuePivot(s.rotateDeltaY,s.rotateDeltaX),A.showPivot()):(0!==s.rotateDeltaX&&(r.firstPerson?a.pitch(-s.rotateDeltaX):a.orbitPitch(s.rotateDeltaX)),0!==s.rotateDeltaY&&(r.firstPerson?a.yaw(s.rotateDeltaY):a.orbitYaw(s.rotateDeltaY))),s.rotateDeltaX*=r.rotationInertia,s.rotateDeltaY*=r.rotationInertia,e=l._cursors.rotate),Math.abs(s.panDeltaX)<.001&&(s.panDeltaX=0),Math.abs(s.panDeltaY)<.001&&(s.panDeltaY=0),Math.abs(s.panDeltaZ)<.001&&(s.panDeltaZ=0),0!==s.panDeltaX||0!==s.panDeltaY||0!==s.panDeltaZ){var p,v,g=De.vec3();if(g[0]=s.panDeltaX,g[1]=s.panDeltaY,g[2]=s.panDeltaZ,r.constrainVertical){a.xUp?(p=a.eye[0],v=a.look[0]):a.yUp?(p=a.eye[1],v=a.look[1]):a.zUp&&(p=a.eye[2],v=a.look[2]),a.pan(g);var m=a.eye,y=a.look;a.xUp?(m[0]=p,y[0]=v):a.yUp?(m[1]=p,y[1]=v):a.zUp&&(m[2]=p,y[2]=v),a.eye=m,a.look=y}else a.pan(g);e=l._cursors.pan}if(s.panDeltaX*=r.panInertia,s.panDeltaY*=r.panInertia,s.panDeltaZ*=r.panInertia,0!==f){if(e=f<0?l._cursors.dollyForward:l._cursors.dollyBackward,r.firstPerson){var _,b;if(r.constrainVertical&&(a.xUp?(_=a.eye[0],b=a.look[0]):a.yUp?(_=a.eye[1],b=a.look[1]):a.zUp&&(_=a.eye[2],b=a.look[2])),r.followPointer)c.dollyToCanvasPos(d,i.pointerCanvasPos,-f)&&(i.followPointerDirty=!0);else a.pan([0,0,f]),a.ortho.scale=a.ortho.scale-f;if(r.constrainVertical){var w=a.eye,B=a.look;a.xUp?(w[0]=_,B[0]=b):a.yUp?(w[1]=_,B[1]=b):a.zUp&&(w[2]=_,B[2]=b),a.eye=w,a.look=B}}else if(r.planView){if(r.followPointer)c.dollyToCanvasPos(d,i.pointerCanvasPos,-f)&&(i.followPointerDirty=!0);else a.ortho.scale=a.ortho.scale+f,a.zoom(f)}else{if(r.followPointer)c.dollyToCanvasPos(d,i.pointerCanvasPos,-f)&&(i.followPointerDirty=!0);else a.ortho.scale=a.ortho.scale+f,a.zoom(f)}s.dollyDelta*=r.dollyInertia}o.fireEvents(),document.body.style.cursor=e}}))}return I(e,[{key:"destroy",value:function(){this._scene.off(this._onTick)}}]),e}(),jc=function(){function e(t,n,r,i,s){x(this,e),this._scene=t;var a=this._scene.canvas.canvas;a.addEventListener("mouseenter",this._mouseEnterHandler=function(){i.mouseover=!0}),a.addEventListener("mouseleave",this._mouseLeaveHandler=function(){i.mouseover=!1,a.style.cursor=null}),document.addEventListener("mousemove",this._mouseMoveHandler=function(e){Wc(e,a,i.pointerCanvasPos),i.mouseover=!0}),a.addEventListener("mousedown",this._mouseDownHandler=function(e){r.active&&r.pointerEnabled&&(Wc(e,a,i.pointerCanvasPos),i.mouseover=!0)}),a.addEventListener("mouseup",this._mouseUpHandler=function(e){r.active&&r.pointerEnabled})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;document.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("mouseleave",this._mouseLeaveHandler),e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler)}}]),e}();function Wc(e,t,n){if(e){var r=t.getBoundingClientRect(),i=r.left,s=r.top;n[0]=e.clientX-i,n[1]=e.clientY-s}else e=window.event,n[0]=e.x,n[1]=e.y;return n}var zc=function(e,t,n){if(e){var r=t.getBoundingClientRect();n[0]=e.clientX-r.left,n[1]=e.clientY-r.top}else e=window.event,n[0]=e.x,n[1]=e.y;return n},Xc=function(){function e(t,n,r,i,s){x(this,e),this._scene=t;var a=n.pickController,o=n.pivotController,A=De.vec2(),c=De.vec2(),l=De.vec2(),u=De.vec2(),h=[],d=this._scene.canvas.canvas,f=0,p=!1;this._onTick=t.on("tick",(function(){p=!1})),d.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(r.active&&r.pointerEnabled){e.preventDefault();var n=e.touches,s=e.changedTouches;for(i.touchStartTime=Date.now(),1===n.length&&1===s.length&&(zc(n[0],d,A),r.followPointer&&(a.pickCursorPos=A,a.schedulePickSurface=!0,a.update(),r.planView||(a.picked&&a.pickedSurface&&a.pickResult&&a.pickResult.worldPos?(o.setPivotPos(a.pickResult.worldPos),!r.firstPerson&&o.startPivot()&&o.showPivot()):(r.smartPivot?o.setCanvasPivotPos(i.pointerCanvasPos):o.setPivotPos(t.camera.look),!r.firstPerson&&o.startPivot()&&o.showPivot()))));h.length<n.length;)h.push(De.vec2());for(var c=0,l=n.length;c<l;++c)zc(n[c],d,h[c]);f=n.length}}),d.addEventListener("touchend",this._canvasTouchEndHandler=function(){o.getPivoting()&&(o.endPivot(),o.hidePivot())}),d.addEventListener("touchmove",this._canvasTouchMoveHandler=function(e){if(r.active&&r.pointerEnabled&&(e.stopPropagation(),e.preventDefault(),!p)){p=!0;var n=t.canvas.boundary,o=n[2],A=n[3],v=e.touches;if(e.touches.length===f){if(1===f){zc(v[0],d,c),De.subVec2(c,h[0],u);var g=u[0],m=u[1];if(null!==i.longTouchTimeout&&(Math.abs(g)>r.longTapRadius||Math.abs(m)>r.longTapRadius)&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),r.planView){var y=t.camera;if("perspective"===y.projection){var _=Math.abs(t.camera.eyeLookDist)*Math.tan(y.perspective.fov/2*Math.PI/180);s.panDeltaX+=g*_/A*r.touchPanRate,s.panDeltaY+=m*_/A*r.touchPanRate}else s.panDeltaX+=.5*y.ortho.scale*(g/A)*r.touchPanRate,s.panDeltaY+=.5*y.ortho.scale*(m/A)*r.touchPanRate}else s.rotateDeltaY-=g/o*(1*r.dragRotationRate),s.rotateDeltaX+=m/A*(1.5*r.dragRotationRate)}else if(2===f){var b=v[0],w=v[1];zc(b,d,c),zc(w,d,l);var B=De.geometricMeanVec2(h[0],h[1]),C=De.geometricMeanVec2(c,l),M=De.vec2();De.subVec2(B,C,M);var k=M[0],E=M[1],F=t.camera,x=De.distVec2([b.pageX,b.pageY],[w.pageX,w.pageY]),U=(De.distVec2(h[0],h[1])-x)*r.touchDollyRate;if(s.dollyDelta=U,i.followPointerDirty=!0,Math.abs(U)<1)if("perspective"===F.projection){var I=a.pickResult?a.pickResult.worldPos:t.center,T=Math.abs(De.lenVec3(De.subVec3(I,t.camera.eye,[])))*Math.tan(F.perspective.fov/2*Math.PI/180);s.panDeltaX-=k*T/A*r.touchPanRate,s.panDeltaY-=E*T/A*r.touchPanRate}else s.panDeltaX-=.5*F.ortho.scale*(k/A)*r.touchPanRate,s.panDeltaY-=.5*F.ortho.scale*(E/A)*r.touchPanRate;i.pointerCanvasPos=C}for(var P=0;P<f;++P)zc(v[P],d,h[P])}}})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler),e.removeEventListener("touchmove",this._canvasTouchMoveHandler),this._scene.off(this._onTick)}}]),e}(),Kc=function(e,t){if(e){for(var n=e.target,r=0,i=0;n.offsetParent;)r+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;t[0]=e.pageX-r,t[1]=e.pageY-i}else e=window.event,t[0]=e.x,t[1]=e.y;return t},Zc=function(){function e(t,n,r,i,s){x(this,e),this._scene=t;var a,o=n.pickController,A=n.cameraControl,c=[],l=new Float32Array(2),u=-1,h=-1,d=this._scene.canvas.canvas,f=function(e){var r;e&&e.worldPos&&(r=e.worldPos);var i=e?e.entity.aabb:t.aabb;if(r){var s=t.camera;De.subVec3(s.eye,s.look,[]),n.cameraFlight.flyTo({aabb:i})}else n.cameraFlight.flyTo({aabb:i})};d.addEventListener("touchstart",this._canvasTouchStartHandler=function(e){if(r.active&&r.pointerEnabled){null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null);var t=e.touches,s=e.changedTouches;if(a=Date.now(),1===t.length&&1===s.length){u=a,Kc(t[0],l);var o=l[0],A=l[1],h=t[0].pageX,d=t[0].pageY;i.longTouchTimeout=setTimeout((function(){r.active&&r.pointerEnabled&&n.cameraControl.fire("rightClick",{pagePos:[Math.round(h),Math.round(d)],canvasPos:[Math.round(o),Math.round(A)],event:e},!0),i.longTouchTimeout=null}),r.longTapTimeout)}else u=-1;for(;c.length<t.length;)c.push(new Float32Array(2));for(var f=0,p=t.length;f<p;++f)Kc(t[f],c[f]);c.length=t.length}},{passive:!0}),d.addEventListener("touchend",this._canvasTouchEndHandler=function(e){if(r.active&&r.pointerEnabled){var t=Date.now(),n=e.touches,s=e.changedTouches,a=A.hasSubs("pickedSurface");null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),0===n.length&&1===s.length&&u>-1&&t-u<150&&(h>-1&&u-h<325?(Kc(s[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=a,o.update(),o.pickResult?(o.pickResult.touchInput=!0,A.fire("doublePicked",o.pickResult),o.pickedSurface&&A.fire("doublePickedSurface",o.pickResult),r.doublePickFlyTo&&f(o.pickResult)):(A.fire("doublePickedNothing"),r.doublePickFlyTo&&f()),h=-1):De.distVec2(c[0],l)<4&&(Kc(s[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=a,o.update(),o.pickResult?(o.pickResult.touchInput=!0,A.fire("picked",o.pickResult),o.pickedSurface&&A.fire("pickedSurface",o.pickResult)):A.fire("pickedNothing"),h=t),u=-1),c.length=n.length;for(var d=0,p=n.length;d<p;++d)c[d][0]=n[d].pageX,c[d][1]=n[d].pageY}},{passive:!0})}return I(e,[{key:"reset",value:function(){}},{key:"destroy",value:function(){var e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)}}]),e}(),Jc=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e,i)).PAN_LEFT=0,r.PAN_RIGHT=1,r.PAN_UP=2,r.PAN_DOWN=3,r.PAN_FORWARDS=4,r.PAN_BACKWARDS=5,r.ROTATE_X_POS=6,r.ROTATE_X_NEG=7,r.ROTATE_Y_POS=8,r.ROTATE_Y_NEG=9,r.DOLLY_FORWARDS=10,r.DOLLY_BACKWARDS=11,r.AXIS_VIEW_RIGHT=12,r.AXIS_VIEW_BACK=13,r.AXIS_VIEW_LEFT=14,r.AXIS_VIEW_FRONT=15,r.AXIS_VIEW_TOP=16,r.AXIS_VIEW_BOTTOM=17,r.MOUSE_PAN=18,r.MOUSE_ROTATE=19,r.MOUSE_DOLLY=20,r._keyMap={},r.scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},r._configs={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,doubleClickTimeFrame:250,zoomOnMouseWheel:!0,snapToVertex:true,snapToEdge:true,snapRadius:30,keyboardEnabledOnlyIfMouseover:!0,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04},r._states={pointerCanvasPos:De.vec2(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:De.vec2(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null},r._updates={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0};var s=r.scene;return r._controllers={cameraControl:w(r),pickController:new xc(w(r),r._configs),pivotController:new Fc(s,r._configs),panController:new _c(s),cameraFlight:new Et(w(r),{duration:.5})},r._handlers=[new jc(r.scene,r._controllers,r._configs,r._states,r._updates),new Xc(r.scene,r._controllers,r._configs,r._states,r._updates),new Tc(r.scene,r._controllers,r._configs,r._states,r._updates),new Vc(r.scene,r._controllers,r._configs,r._states,r._updates),new Lc(r.scene,r._controllers,r._configs,r._states,r._updates),new Zc(r.scene,r._controllers,r._configs,r._states,r._updates),new Hc(r.scene,r._controllers,r._configs,r._states,r._updates)],r._cursors={dollyForward:"zoom-in",dollyBackward:"zoom-out",rotate:"grabbing",pan:"move"},r._cameraUpdater=new Gc(r.scene,r._controllers,r._configs,r._states,r._updates),r.navMode=i.navMode,i.planView&&(r.planView=i.planView),r.constrainVertical=i.constrainVertical,i.keyboardLayout?r.keyboardLayout=i.keyboardLayout:r.keyMap=i.keyMap,r.doublePickFlyTo=i.doublePickFlyTo,r.panRightClick=i.panRightClick,r.active=i.active,r.followPointer=i.followPointer,r.rotationInertia=i.rotationInertia,r.keyboardPanRate=i.keyboardPanRate,r.touchPanRate=i.touchPanRate,r.keyboardRotationRate=i.keyboardRotationRate,r.dragRotationRate=i.dragRotationRate,r.touchDollyRate=i.touchDollyRate,r.dollyInertia=i.dollyInertia,r.dollyProximityThreshold=i.dollyProximityThreshold,r.dollyMinSpeed=i.dollyMinSpeed,r.panInertia=i.panInertia,r.pointerEnabled=!0,r.keyboardDollyRate=i.keyboardDollyRate,r.mouseWheelDollyRate=i.mouseWheelDollyRate,r}return I(n,[{key:"keyMap",get:function(){return this._keyMap},set:function(e){if(e=e||"qwerty",je.isString(e)){var t=this.scene.input,n={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":n[this.PAN_LEFT]=[t.KEY_A],n[this.PAN_RIGHT]=[t.KEY_D],n[this.PAN_UP]=[t.KEY_Z],n[this.PAN_DOWN]=[t.KEY_X],n[this.PAN_BACKWARDS]=[],n[this.PAN_FORWARDS]=[],n[this.DOLLY_FORWARDS]=[t.KEY_W,t.KEY_ADD],n[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],n[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],n[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],n[this.ROTATE_Y_POS]=[t.KEY_Q,t.KEY_LEFT_ARROW],n[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],n[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],n[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],n[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],n[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],n[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],n[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6],n[this.MOUSE_PAN]=[[t.MOUSE_LEFT_BUTTON,t.KEY_SHIFT],this._configs.panRightClick?t.MOUSE_RIGHT_BUTTON:t.MOUSE_MIDDLE_BUTTON],n[this.MOUSE_ROTATE]=[t.MOUSE_LEFT_BUTTON],n[this.MOUSE_DOLLY]=[];break;case"azerty":n[this.PAN_LEFT]=[t.KEY_Q],n[this.PAN_RIGHT]=[t.KEY_D],n[this.PAN_UP]=[t.KEY_W],n[this.PAN_DOWN]=[t.KEY_X],n[this.PAN_BACKWARDS]=[],n[this.PAN_FORWARDS]=[],n[this.DOLLY_FORWARDS]=[t.KEY_Z,t.KEY_ADD],n[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],n[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],n[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],n[this.ROTATE_Y_POS]=[t.KEY_A,t.KEY_LEFT_ARROW],n[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],n[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],n[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],n[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],n[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],n[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],n[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6],n[this.MOUSE_PAN]=[[t.MOUSE_LEFT_BUTTON,t.KEY_SHIFT],this._configs.panRightClick?t.MOUSE_RIGHT_BUTTON:t.MOUSE_MIDDLE_BUTTON],n[this.MOUSE_ROTATE]=[t.MOUSE_LEFT_BUTTON],n[this.MOUSE_DOLLY]=[]}this._keyMap=n}else{var r=e;this._keyMap=r}}},{key:"_areAllKeysDown",value:function(e,t){if(!t||t.length<=0)return!0;if(!e)return!1;for(var n=0,r=t.length;n<r;n++){if(!e[t[n]])return!1}return!0}},{key:"_isAnyOtherKeyDown",value:function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n])if(Array.isArray(t)){if(t.indexOf(n)<0)return!0}else if(n!==t)return!0;return!1}},{key:"_isMouseAction",value:function(e){switch(e){case this.MOUSE_ROTATE:case this.MOUSE_DOLLY:case this.MOUSE_PAN:return!0;default:return!1}}},{key:"_isKeyDownForAction",value:function(e,t){var n=this._keyMap[e];if(!n)return!1;if(0===n.length&&this._isMouseAction(e))return!0;t||(t=this.scene.input.keyDown);for(var r=0,i=n.length;r<i;r++){var s=n[r];if(Array.isArray(s)){if(this._areAllKeysDown(t,s)&&!this._isAnyOtherKeyDown(t,s))return!0}else if(t[s]&&!this._isAnyOtherKeyDown(t,s))return!0}return!1}},{key:"pivotElement",set:function(e){this._controllers.pivotController.setPivotElement(e)}},{key:"active",get:function(){return this._configs.active},set:function(e){e=!1!==e,this._configs.active=e,this._handlers[1]._active=e,this._handlers[5]._active=e}},{key:"snapToVertex",get:function(){return this._configs.snapToVertex},set:function(e){this._configs.snapToVertex=!!e}},{key:"snapToEdge",get:function(){return this._configs.snapToEdge},set:function(e){this._configs.snapToEdge=!!e}},{key:"snapRadius",get:function(){return this._configs.snapRadius},set:function(e){e=e||30,this._configs.snapRadius=e}},{key:"keyboardEnabledOnlyIfMouseover",get:function(){return this._configs.keyboardEnabledOnlyIfMouseover},set:function(e){this._configs.keyboardEnabledOnlyIfMouseover=!!e}},{key:"navMode",get:function(){return this._configs.navMode},set:function(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),this._configs.firstPerson="firstPerson"===e,this._configs.planView="planView"===e,(this._configs.firstPerson||this._configs.planView)&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this._configs.navMode=e}},{key:"pointerEnabled",get:function(){return this._configs.pointerEnabled},set:function(e){this._reset(),this._configs.pointerEnabled=!!e}},{key:"setCursorStyle",value:function(e,t){Object.prototype.hasOwnProperty.call(this._cursors,e)?this._cursors=d(d({},this._cursors),{},f({},e,t)):console.warn("Action '".concat(e,"' is not valid for cursor styles."))}},{key:"getCursorStyle",value:function(e){return this._cursors[e]||null}},{key:"_reset",value:function(){for(var e=0,t=this._handlers.length;e<t;e++){var n=this._handlers[e];n.reset&&n.reset()}this._updates.panDeltaX=0,this._updates.panDeltaY=0,this._updates.rotateDeltaX=0,this._updates.rotateDeltaY=0,this._updates.dolyDelta=0}},{key:"followPointer",get:function(){return this._configs.followPointer},set:function(e){this._configs.followPointer=!1!==e}},{key:"pivotPos",get:function(){return this._controllers.pivotController.getPivotPos()},set:function(e){this._controllers.pivotController.setPivotPos(e)}},{key:"dollyToPointer",get:function(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer},set:function(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}},{key:"panToPointer",get:function(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1},set:function(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}},{key:"planView",get:function(){return this.warn("planView property is deprecated - replaced with navMode"),this._configs.planView},set:function(e){this._configs.planView=!!e,this._configs.firstPerson=!1,this._configs.planView&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}},{key:"firstPerson",get:function(){return this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson},set:function(e){this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson=!!e,this._configs.planView=!1,this._configs.firstPerson&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot())}},{key:"constrainVertical",get:function(){return this._configs.constrainVertical},set:function(e){this._configs.constrainVertical=!!e}},{key:"doublePickFlyTo",get:function(){return this._configs.doublePickFlyTo},set:function(e){this._configs.doublePickFlyTo=!1!==e}},{key:"panRightClick",get:function(){return this._configs.panRightClick},set:function(e){this._configs.panRightClick=!1!==e;var t=this._keyMap[this.MOUSE_PAN];if(t&&t.length>0)for(var n=this.scene.input,r=0,i=t.length;r<i;r++)this._configs.panRightClick&&t[r]===n.MOUSE_MIDDLE_BUTTON?this._keyMap[this.MOUSE_PAN][r]=n.MOUSE_RIGHT_BUTTON:this._configs.panRightClick||t[r]!==n.MOUSE_RIGHT_BUTTON||(this._keyMap[this.MOUSE_PAN][r]=n.MOUSE_MIDDLE_BUTTON)}},{key:"rotationInertia",get:function(){return this._configs.rotationInertia},set:function(e){this._configs.rotationInertia=null!=e?e:0}},{key:"keyboardPanRate",get:function(){return this._configs.keyboardPanRate},set:function(e){this._configs.keyboardPanRate=null!=e?e:5}},{key:"touchPanRate",get:function(){return this._configs.touchPanRate},set:function(e){this._configs.touchPanRate=null!=e?e:1}},{key:"keyboardRotationRate",get:function(){return this._configs.keyboardRotationRate},set:function(e){this._configs.keyboardRotationRate=null!=e?e:90}},{key:"dragRotationRate",get:function(){return this._configs.dragRotationRate},set:function(e){this._configs.dragRotationRate=null!=e?e:360}},{key:"keyboardDollyRate",get:function(){return this._configs.keyboardDollyRate},set:function(e){this._configs.keyboardDollyRate=null!=e?e:15}},{key:"touchDollyRate",get:function(){return this._configs.touchDollyRate},set:function(e){this._configs.touchDollyRate=null!=e?e:.2}},{key:"mouseWheelDollyRate",get:function(){return this._configs.mouseWheelDollyRate},set:function(e){this._configs.mouseWheelDollyRate=null!=e?e:100}},{key:"dollyInertia",get:function(){return this._configs.dollyInertia},set:function(e){this._configs.dollyInertia=null!=e?e:0}},{key:"dollyProximityThreshold",get:function(){return this._configs.dollyProximityThreshold},set:function(e){this._configs.dollyProximityThreshold=null!=e?e:35}},{key:"dollyMinSpeed",get:function(){return this._configs.dollyMinSpeed},set:function(e){this._configs.dollyMinSpeed=null!=e?e:.04}},{key:"panInertia",get:function(){return this._configs.panInertia},set:function(e){this._configs.panInertia=null!=e?e:.5}},{key:"keyboardLayout",get:function(){return this._configs.keyboardLayout},set:function(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),this._configs.keyboardLayout=e,this.keyMap=this._configs.keyboardLayout}},{key:"enablePivotSphere",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._controllers.pivotController.enablePivotSphere(e)}},{key:"disablePivotSphere",value:function(){this._controllers.pivotController.disablePivotSphere()}},{key:"smartPivot",get:function(){return this._configs.smartPivot},set:function(e){this._configs.smartPivot=!1!==e}},{key:"doubleClickTimeFrame",get:function(){return this._configs.doubleClickTimeFrame},set:function(e){this._configs.doubleClickTimeFrame=null!=e?e:250}},{key:"zoomOnMouseWheel",get:function(){return this._configs.zoomOnMouseWheel},set:function(e){this._configs.zoomOnMouseWheel=!!e}},{key:"destroy",value:function(){this._destroyHandlers(),this._destroyControllers(),this._cameraUpdater.destroy(),v(C(n.prototype),"destroy",this).call(this)}},{key:"_destroyHandlers",value:function(){for(var e=0,t=this._handlers.length;e<t;e++){var n=this._handlers[e];n.destroy&&n.destroy()}}},{key:"_destroyControllers",value:function(){for(var e=0,t=this._controllers.length;e<t;e++){var n=this._controllers[e];n.destroy&&n.destroy()}}}]),n}(),Yc=I((function e(t,n,r,i,s){x(this,e),this.name=t,this.type=r,this.value=n,this.valueType=i,this.description=s})),qc=I((function e(t){if(x(this,e),this.id=t.id,this.originalSystemId=t.originalSystemId,this.metaModels=[],this.name=t.name,this.type=t.type,this.properties=[],t.properties)for(var n=t.properties,r=0,i=n.length;r<i;r++){var s=n[r];Number.isInteger(s)?this.properties.push(s):this.properties.push(new Yc(s.name,s.value,s.type,s.valueType,s.description))}})),$c=function(){function e(t){x(this,e),this.metaModels=[],this.id=t.id,this.parentId=t.parentId,this.parent=null,this.originalSystemId=t.originalSystemId,this.name=t.name,this.type=t.type,this.propertySetIds=t.propertySetIds,this.propertySets=[],this.attributes=t.attributes||{},void 0!==t.external&&null!==t.external&&(this.external=t.external)}return I(e,[{key:"metaModel",get:function(){return 1==this.metaModels.length?this.metaModels[0]:null}},{key:"getObjectIDsInSubtree",value:function(){var e=[];return function t(n){if(n){e.push(n.id);var r=n.children;if(r)for(var i=0,s=r.length;i<s;i++)t(r[i])}}(this),e}},{key:"withMetaObjectsInSubtree",value:function(e){!function t(n){if(n){e(n);var r=n.children;if(r)for(var i=0,s=r.length;i<s;i++)t(r[i])}}(this)}},{key:"getObjectIDsInSubtreeByType",value:function(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n]]=e[n];var i=[];return function e(n){if(n){t[n.type]&&i.push(n.id);var r=n.children;if(r)for(var s=0,a=r.length;s<a;s++)e(r[s])}}(this),i}},{key:"getJSON",value:function(){var e={id:this.id,type:this.type,name:this.name};return this.parent&&(e.parent=this.parent.id),e}}]),e}(),el=function(){function e(t){x(this,e),this.id=t.id,this.projectId=t.projectId,this.revisionId=t.revisionId,this.author=t.author,this.createdAt=t.createdAt,this.creatingApplication=t.creatingApplication,this.schema=t.schema,this.metaScene=t.metaScene,this.propertySets=[],this.rootMetaObjects=[],this.metaObjects={},this.graph=t.graph||{},this.metaScene.metaModels[this.id]=this,this._propertyLookup=[],this.finalized=!1}return I(e,[{key:"rootMetaObject",get:function(){return 1===this.rootMetaObjects.length?this.rootMetaObjects[0]:null}},{key:"loadData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.finalized)throw"MetaScene already finalized - can't add more data";this._globalizeIDs(e,t);var n=this.metaScene,r=e.properties;if(r)for(var i=0,s=r.length;i<s;i++)this._propertyLookup.push(r[i]);if(e.propertySets)for(var a=0,o=e.propertySets.length;a<o;a++){var A=e.propertySets[a];A.properties||(A.properties=[]);var c=n.propertySets[A.id];c||(c=new qc({id:A.id,originalSystemId:A.originalSystemId||A.id,type:A.type,name:A.name,properties:A.properties}),n.propertySets[c.id]=c),c.metaModels.push(this),this.propertySets.push(c)}if(e.metaObjects)for(var l=0,u=e.metaObjects.length;l<u;l++){var h=e.metaObjects[l],d=h.id,f=n.metaObjects[d];if(!f){var p=h.type,v=h.originalSystemId,g=h.propertySets||h.propertySetIds;f=new $c({id:d,originalSystemId:v,parentId:h.parent,type:p,name:h.name,attributes:h.attributes,propertySetIds:g,external:h.external}),this.metaScene.metaObjects[d]=f,f.metaModels=[]}this.metaObjects[d]=f,h.parent||(this.rootMetaObjects.push(f),n.rootMetaObjects[d]=f),f.metaModels.push(this)}}},{key:"_decompressProperties",value:function(e,t){for(var n=[],r=0,i=t.length;r<i;r++){var s=t[r];if(Number.isInteger(s)){var a=e[s];a?t[r]=a:n.push(s)}}n.length>0&&console.error("[MetaModel._decompressProperties] Properties not found: ".concat(n))}},{key:"finalize",value:function(){if(this.finalized)throw"MetaScene already finalized - can't re-finalize";var e=this.metaScene;for(var t in e.metaObjects){var n=e.metaObjects[t];if(n.children&&(n.children=[]),n.propertySets&&(n.propertySets=[]),n.propertySetIds)for(var r=0,i=n.propertySetIds.length;r<i;r++){var s=n.propertySetIds[r],a=e.propertySets[s];n.propertySets.push(a)}}for(var o in e.metaObjects){var A=e.metaObjects[o];if(A.parentId){var c=e.metaObjects[A.parentId];c&&(A.parent=c,(c.children||(c.children=[])).push(A))}}for(var l in e.metaObjects){e.metaObjects[l].metaModels=[]}for(var u in e.metaModels){var h=e.metaModels[u];for(var d in h.metaObjects){h.metaObjects[d].metaModels.push(h)}}for(var f in e.metaObjectsByType={},e.metaObjects){var p=e.metaObjects[f],v=p.type;(e.metaObjectsByType[v]||(e.metaObjectsByType[v]={}))[f]=p}if(this.propertySets)for(var g=0,m=this.propertySets.length;g<m;g++){var y=this.propertySets[g];this._decompressProperties(this._propertyLookup,y.properties)}this._propertyLookup=[],this.finalized=!0,this.metaScene.fire("metaModelCreated",this.id)}},{key:"getJSON",value:function(){for(var e={id:this.id,projectId:this.projectId,author:this.author,createdAt:this.createdAt,schema:this.schema,creatingApplication:this.creatingApplication,metaObjects:[],propertySets:[]},t=Object.values(this.metaObjects),n=0,r=t.length;n<r;n++){var i=t[n],s={id:i.id,originalSystemId:i.originalSystemId,extId:i.extId,type:i.type,name:i.name};i.parent&&(s.parent=i.parent.id),i.attributes&&(s.attributes=i.attributes),i.propertySetIds&&(s.propertySetIds=i.propertySetIds),e.metaObjects.push(s)}for(var a=0,o=this.propertySets.length;a<o;a++){for(var A=this.propertySets[a],c={id:A.id,originalSystemId:A.originalSystemId,extId:A.extId,type:A.type,name:A.name,propertyies:[]},l=0,u=A.properties.length;l<u;l++){var h=A.properties[l],d={id:h.id,description:h.description,type:h.type,name:h.name,value:h.value,valueType:h.valueType};c.properties.push(d)}e.propertySets.push(c)}return e}},{key:"_globalizeIDs",value:function(e,t){var n=!!t.globalizeObjectIds;if(e.metaObjects)for(var r=0,i=e.metaObjects.length;r<i;r++){var s=e.metaObjects[r];if(s.originalSystemId=s.id,s.parent&&(s.originalParentSystemId=s.parent),n&&(s.id=De.globalizeObjectId(this.id,s.id),s.parent&&(s.parent=De.globalizeObjectId(this.id,s.parent))),n){var a=s.propertySetIds;if(a){for(var o=[],A=0,c=a.length;A<c;A++)o.push(De.globalizeObjectId(this.id,a[A]));s.propertySetIds=o,s.originalSystemPropertySetIds=a}}else s.originalSystemPropertySetIds=s.propertySetIds}if(e.propertySets)for(var l=0,u=e.propertySets.length;l<u;l++){var h=e.propertySets[l];h.originalSystemId=h.id,n&&(h.id=De.globalizeObjectId(this.id,h.id))}}}]),e}(),tl=function(){function e(t,n){x(this,e),this.viewer=t,this.scene=n,this.metaModels={},this.propertySets={},this.metaObjects={},this.metaObjectsByType={},this.rootMetaObjects={},this._eventSubs={}}return I(e,[{key:"on",value:function(e,t){var n=this._eventSubs[e];n||(n=[],this._eventSubs[e]=n),n.push(t)}},{key:"fire",value:function(e,t){var n=this._eventSubs[e];if(n)for(var r=0,i=n.length;r<i;r++)n[r](t)}},{key:"off",value:function(e){}},{key:"createMetaModel",value:function(e,t){var n=new el({metaScene:this,id:e,projectId:t.projectId||"none",revisionId:t.revisionId||"none",author:t.author||"none",createdAt:t.createdAt||"none",creatingApplication:t.creatingApplication||"none",schema:t.schema||"none",propertySets:[]});return n.loadData(t),n.finalize(),n}},{key:"destroyMetaModel",value:function(e){var t=this.metaModels[e];if(t){if(t.propertySets)for(var n=0,r=t.propertySets.length;n<r;n++){var i=t.propertySets[n];if(1===i.metaModels.length&&i.metaModels[0].id===e)delete this.propertySets[i.id];else{for(var s=[],a=0,o=i.metaModels.length;a<o;a++)i.metaModels[a].id!==e&&s.push(i.metaModels[a]);i.metaModels=s}}if(t.metaObjects)for(var A in t.metaObjects){var c=t.metaObjects[A];1===c.metaModels.length&&c.metaModels[0].id===e?(delete this.metaObjects[A],c.parent||delete this.rootMetaObjects[A]):c.metaModels=c.metaModels.filter((function(t){return t.id!==e}))}for(var l in this.metaObjects){var u=this.metaObjects[l];if(u.children&&(u.children=[]),u.propertySets&&(u.propertySets=[]),u.propertySetIds)for(var h=0,d=u.propertySetIds.length;h<d;h++){var f=u.propertySetIds[h],p=this.propertySets[f];u.propertySets.push(p)}}for(var v in this.metaObjectsByType={},this.metaObjects){var g=this.metaObjects[v],m=g.type;g.children&&(g.children=null),(this.metaObjectsByType[m]||(this.metaObjectsByType[m]={}))[v]=g}for(var y in this.metaObjects){var _=this.metaObjects[y];if(_.parentId){var b=this.metaObjects[_.parentId];b&&(_.parent=b,(b.children||(b.children=[])).push(_))}}for(var w in delete this.metaModels[e],this.metaObjects){this.metaObjects[w].metaModels=[]}for(var B in this.metaModels){var C=this.metaModels[B];for(var M in C.metaObjects){C.metaObjects[M].metaModels.push(C)}}this.fire("metaModelDestroyed",e)}}},{key:"getObjectIDsByType",value:function(e){var t=this.metaObjectsByType[e];return t?Object.keys(t):[]}},{key:"getObjectIDsInSubtree",value:function(e,t,n){var r=[],i=this.metaObjects[e],s=t&&t.length>0?nl(t):null,a=n&&n.length>0?nl(n):null;return function e(t){if(t){var n=!0;(a&&a[t.type]||s&&!s[t.type])&&(n=!1),n&&r.push(t.id);var i=t.children;if(i)for(var o=0,A=i.length;o<A;o++)e(i[o])}}(i),r}},{key:"withMetaObjectsInSubtree",value:function(e,t){var n=this.metaObjects[e];n&&n.withMetaObjectsInSubtree(t)}}]),e}();function nl(e){for(var t={},n=0,r=e.length;n<r;n++)t[e[n]]=!0;return t}function rl(e,t,n,r){return il.apply(this,arguments)}function il(){return(il=l(A().mark((function e(t,n,r,i){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",i._parse(t,n,r,i));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sl(e,t){if(!e)throw new Error(t||"loader assertion failed.")}var al=Boolean("object"!==("undefined"==typeof process?"undefined":M(process))||"[object process]"!==String(process)||process.browser),ol="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);ol&&parseFloat(ol[1]);var Al=globalThis,cl=globalThis.process||{};function ll(){var e;return!("object"===("undefined"==typeof process?"undefined":M(process))&&"[object process]"===String(process)&&!(null!==(e=process)&&void 0!==e&&e.browser))||function(e){var t,n;if("undefined"!=typeof window&&"renderer"===(null===(t=window.process)||void 0===t?void 0:t.type))return!0;if("undefined"!=typeof process&&Boolean(null===(n=process.versions)||void 0===n?void 0:n.electron))return!0;var r="undefined"!=typeof navigator&&navigator.userAgent,i=e||r;return Boolean(i&&i.indexOf("Electron")>=0)}()}function ul(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),t}catch(e){return null}}var hl,dl=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage";x(this,e),this.storage=ul(r),this.id=t,this.config=n,this._loadConfiguration()}return I(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(e){if(Object.assign(this.config,e),this.storage){var t=JSON.stringify(this.config);this.storage.setItem(this.id,t)}}},{key:"_loadConfiguration",value:function(){var e={};if(this.storage){var t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}]),e}();!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(hl||(hl={}));function fl(e){return"string"!=typeof e?e:(e=e.toUpperCase(),hl[e]||hl.WHITE)}function pl(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["constructor"],r=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(r),s=e,a=u(i);try{var o=function(){var r=t.value,i=s[r];"function"==typeof i&&(n.find((function(e){return r===e}))||(s[r]=i.bind(e)))};for(a.s();!(t=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}function vl(e,t){if(!e)throw new Error(t||"Assertion failed")}function gl(){var e,t,n;if(ll()&&Al.performance)e=null==Al||null===(t=Al.performance)||void 0===t||null===(n=t.now)||void 0===n?void 0:n.call(t);else if("hrtime"in cl){var r,i=null==cl||null===(r=cl.hrtime)||void 0===r?void 0:r.call(cl);e=1e3*i[0]+i[1]/1e6}else e=Date.now();return e}var ml={debug:ll()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},yl={enabled:!0,level:0};function _l(){}var bl={},wl={once:!0},Bl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{id:""},n=t.id;x(this,e),this.VERSION="4.1.0",this._startTs=gl(),this._deltaTs=gl(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=n,this.userData={},this._storage=new dl("__probe-".concat(this.id,"__"),yl),this.timeStamp("".concat(this.id," started")),pl(this),Object.seal(this)}return I(e,[{key:"level",get:function(){return this.getLevel()},set:function(e){this.setLevel(e)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((gl()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((gl()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(e){this.level=e}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this._storage.setConfiguration({enabled:e}),this}},{key:"setLevel",value:function(e){return this._storage.setConfiguration({level:e}),this}},{key:"get",value:function(e){return this._storage.config[e]}},{key:"set",value:function(e,t){this._storage.setConfiguration(f({},e,t))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(e,t){if(!e)throw new Error(t||"Assertion failed")}},{key:"warn",value:function(e){return this._getLogFunction(0,e,ml.warn,arguments,wl)}},{key:"error",value:function(e){return this._getLogFunction(0,e,ml.error,arguments)}},{key:"deprecated",value:function(e,t){return this.warn("`".concat(e,"` is deprecated and will be removed in a later version. Use `").concat(t,"` instead"))}},{key:"removed",value:function(e,t){return this.error("`".concat(e,"` has been removed. Use `").concat(t,"` instead"))}},{key:"probe",value:function(e,t){return this._getLogFunction(e,t,ml.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(e,t){return this._getLogFunction(e,t,ml.debug,arguments)}},{key:"info",value:function(e,t){return this._getLogFunction(e,t,console.info,arguments)}},{key:"once",value:function(e,t){return this._getLogFunction(e,t,ml.debug||ml.info,arguments,wl)}},{key:"table",value:function(e,t,n){return t?this._getLogFunction(e,t,console.table||_l,n&&[n],{tag:kl(t)}):_l}},{key:"time",value:function(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}},{key:"timeEnd",value:function(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(e,t){return this._getLogFunction(e,t,console.timeStamp||_l)}},{key:"group",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{collapsed:!1},r=Ml({logLevel:e,message:t,opts:n}),i=n.collapsed;return r.method=(i?console.groupCollapsed:console.group)||console.info,this._getLogFunction(r)}},{key:"groupCollapsed",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.group(e,t,Object.assign({},n,{collapsed:!0}))}},{key:"groupEnd",value:function(e){return this._getLogFunction(e,"",console.groupEnd||_l)}},{key:"withGroup",value:function(e,t,n){this.group(e,t)();try{n()}finally{this.groupEnd(e)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(e){return this.isEnabled()&&this.getLevel()>=Cl(e)}},{key:"_getLogFunction",value:function(e,t,n,r,i){if(this._shouldLog(e)){var s;i=Ml({logLevel:e,message:t,args:r,opts:i}),vl(n=n||i.method),i.total=this.getTotal(),i.delta=this.getDelta(),this._deltaTs=gl();var a=i.tag||i.message;if(i.once&&a){if(bl[a])return _l;bl[a]=gl()}return t=function(e,t,n){if("string"==typeof t){var r=n.time?function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,n=Math.max(t-e.length,0);return"".concat(" ".repeat(n)).concat(e)}((i=n.total)<10?"".concat(i.toFixed(2),"ms"):i<100?"".concat(i.toFixed(1),"ms"):i<1e3?"".concat(i.toFixed(0),"ms"):"".concat((i/1e3).toFixed(2),"s")):"";t=function(e,t,n){if(!ll&&"string"==typeof e){if(t){var r=fl(t);e="[".concat(r,"m").concat(e,"[39m")}if(n){var i=fl(n);e="[".concat(i+10,"m").concat(e,"[49m")}}return e}(t=n.time?"".concat(e,": ").concat(r,"  ").concat(t):"".concat(e,": ").concat(t),n.color,n.background)}var i;return t}(this.id,i.message,i),(s=n).bind.apply(s,[console,t].concat(p(i.args)))}return _l}}]),e}();function Cl(e){if(!e)return 0;var t;switch(M(e)){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return vl(Number.isFinite(t)&&t>=0),t}function Ml(e){var t=e.logLevel,n=e.message;e.logLevel=Cl(t);for(var r=e.args?Array.from(e.args):[];r.length&&r.shift()!==n;);switch(M(t)){case"string":case"function":void 0!==n&&r.unshift(n),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());var i=M(e.message);return vl("string"===i||"object"===i),Object.assign(e,{args:r},e.opts)}function kl(e){for(var t in e)for(var n in e[t])return n||"untitled";return"empty"}Bl.VERSION="4.1.0";var El="4.3.3"[0]>="0"&&"4.3.3"[0]<="9"?"v".concat("4.3.3"):"";var Fl=function(){var e=new Bl({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=El,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();function xl(e,t){return Ul(e||{},t)}function Ul(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n>3)return t;for(var r=d({},e),i=0,s=Object.entries(t);i<s.length;i++){var a=k(s[i],2),o=a[0],A=a[1];A&&"object"===M(A)&&!Array.isArray(A)?r[o]=Ul(r[o]||{},t[o],n+1):r[o]=t[o]}return r}function Il(e){var t;globalThis.loaders||(globalThis.loaders={}),(t=globalThis.loaders).modules||(t.modules={}),Object.assign(globalThis.loaders.modules,e)}function Tl(e){var t,n;return(null===(t=globalThis.loaders)||void 0===t||null===(n=t.modules)||void 0===n?void 0:n[e])||null}var Pl,Sl=(null!==(Pl=globalThis._loadersgl_)&&void 0!==Pl&&Pl.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);function Dl(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}var Ql="object"!==("undefined"==typeof process?"undefined":M(process))||"[object process]"!==String(process)||process.browser,Rl="function"==typeof importScripts,Ol="undefined"!=typeof window&&void 0!==window.orientation,Vl="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Vl&&parseFloat(Vl[1]);var Ll=function(){function e(t,n){var r=this;x(this,e),f(this,"name",void 0),f(this,"workerThread",void 0),f(this,"isRunning",!0),f(this,"result",void 0),f(this,"_resolve",(function(){})),f(this,"_reject",(function(){})),this.name=t,this.workerThread=n,this.result=new Promise((function(e,t){r._resolve=e,r._reject=t}))}return I(e,[{key:"postMessage",value:function(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}},{key:"done",value:function(e){Dl(this.isRunning),this.isRunning=!1,this._resolve(e)}},{key:"error",value:function(e){Dl(this.isRunning),this.isRunning=!1,this._reject(e)}}]),e}(),Hl=function(){function e(){x(this,e)}return I(e,[{key:"terminate",value:function(){}}]),e}(),Nl=new Map;function Gl(e){Dl(e.source&&!e.url||!e.source&&e.url);var t=Nl.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return jl((t=e,"try {\n  importScripts('".concat(t,"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}")));var t}(e.url),Nl.set(e.url,t)),e.source&&(t=jl(e.source),Nl.set(e.source,t))),Dl(t),t}function jl(e){var t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Wl(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=n||new Set;if(e){if(zl(e))r.add(e);else if(zl(e.buffer))r.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"===M(e))for(var i in e)Wl(e[i],t,r)}else;return void 0===n?Array.from(r):[]}function zl(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}var Xl=function(){},Kl=function(){function e(t){x(this,e),f(this,"name",void 0),f(this,"source",void 0),f(this,"url",void 0),f(this,"terminated",!1),f(this,"worker",void 0),f(this,"onMessage",void 0),f(this,"onError",void 0),f(this,"_loadableURL","");var n=t.name,r=t.source,i=t.url;Dl(r||i),this.name=n,this.source=r,this.url=i,this.onMessage=Xl,this.onError=function(e){return console.log(e)},this.worker=Ql?this._createBrowserWorker():this._createNodeWorker()}return I(e,[{key:"destroy",value:function(){this.onMessage=Xl,this.onError=Xl,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(e,t){t=t||Wl(e),this.worker.postMessage(e,t)}},{key:"_getErrorFromErrorEvent",value:function(e){var t="Failed to load ";return t+="worker ".concat(this.name," from ").concat(this.url,". "),e.message&&(t+="".concat(e.message," in ")),e.lineno&&(t+=":".concat(e.lineno,":").concat(e.colno)),new Error(t)}},{key:"_createBrowserWorker",value:function(){var e=this;this._loadableURL=Gl({source:this.source,url:this.url});var t=new Worker(this._loadableURL,{name:this.name});return t.onmessage=function(t){t.data?e.onMessage(t.data):e.onError(new Error("No data received"))},t.onerror=function(t){e.onError(e._getErrorFromErrorEvent(t)),e.terminated=!0},t.onmessageerror=function(e){return console.error(e)},t}},{key:"_createNodeWorker",value:function(){var e,t=this;if(this.url){var n=this.url.includes(":/")||this.url.startsWith("/")?this.url:"./".concat(this.url);e=new Hl(n,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Hl(this.source,{eval:!0})}return e.on("message",(function(e){t.onMessage(e)})),e.on("error",(function(e){t.onError(e)})),e.on("exit",(function(e){})),e}}],[{key:"isSupported",value:function(){return"undefined"!=typeof Worker&&Ql||void 0!==Hl&&!Ql}}]),e}(),Zl=function(){function e(t){x(this,e),f(this,"name","unnamed"),f(this,"source",void 0),f(this,"url",void 0),f(this,"maxConcurrency",1),f(this,"maxMobileConcurrency",1),f(this,"onDebug",(function(){})),f(this,"reuseWorkers",!0),f(this,"props",{}),f(this,"jobQueue",[]),f(this,"idleQueue",[]),f(this,"count",0),f(this,"isDestroyed",!1),this.source=t.source,this.url=t.url,this.setProps(t)}var t,n;return I(e,[{key:"destroy",value:function(){this.idleQueue.forEach((function(e){return e.destroy()})),this.isDestroyed=!0}},{key:"setProps",value:function(e){this.props=d(d({},this.props),e),void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}},{key:"startJob",value:(n=l(A().mark((function e(t){var n,r,i,s=this,a=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:function(e,t,n){return e.done(n)},r=a.length>2&&void 0!==a[2]?a[2]:function(e,t){return e.error(t)},i=new Promise((function(e){return s.jobQueue.push({name:t,onMessage:n,onError:r,onStart:e}),s})),this._startQueuedJob(),e.next=6,i;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"_startQueuedJob",value:(t=l(A().mark((function e(){var t,n,r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.jobQueue.length){e.next=2;break}return e.abrupt("return");case 2:if(t=this._getAvailableWorker()){e.next=5;break}return e.abrupt("return");case 5:if(!(n=this.jobQueue.shift())){e.next=23;break}return this.onDebug({message:"Starting job",name:n.name,workerThread:t,backlog:this.jobQueue.length}),r=new Ll(n.name,t),t.onMessage=function(e){return n.onMessage(r,e.type,e.payload)},t.onError=function(e){return n.onError(r,e)},n.onStart(r),e.prev=12,e.next=15,r.result;case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(12),console.error("Worker exception: ".concat(e.t0));case 20:return e.prev=20,this.returnWorkerToQueue(t),e.finish(20);case 23:case"end":return e.stop()}}),e,this,[[12,17,20,23]])}))),function(){return t.apply(this,arguments)})},{key:"returnWorkerToQueue",value:function(e){!Ql||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var e="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Kl({name:e,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return Ol?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return Kl.isSupported()}}]),e}(),Jl={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},Yl=function(){function e(t){x(this,e),f(this,"props",void 0),f(this,"workerPools",new Map),this.props=d({},Jl),this.setProps(t),this.workerPools=new Map}return I(e,[{key:"destroy",value:function(){var e,t=u(this.workerPools.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}this.workerPools=new Map}},{key:"setProps",value:function(e){this.props=d(d({},this.props),e);var t,n=u(this.workerPools.values());try{for(n.s();!(t=n.n()).done;){t.value.setProps(this._getWorkerPoolProps())}}catch(e){n.e(e)}finally{n.f()}}},{key:"getWorkerPool",value:function(e){var t=e.name,n=e.source,r=e.url,i=this.workerPools.get(t);return i||((i=new Zl({name:t,source:n,url:r})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,i)),i}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return Kl.isSupported()}},{key:"getWorkerFarm",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}}]),e}();function ql(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t[e.id]||{},r="".concat(e.id,Ql?"-worker.js":"-worker-node.js"),i=n.workerUrl;if(i||"compression"!==e.id||(i=t.workerUrl),"test"===t._workerType&&(i=Ql?"modules/".concat(e.module,"/dist/").concat(r):"modules/".concat(e.module,"/src/workers/").concat(e.id,"-worker-node.ts")),!i){var s=e.version;"latest"===s&&(s="latest");var a=s?"@".concat(s):"";i="https://unpkg.com/@loaders.gl/".concat(e.module).concat(a,"/dist/").concat(r)}return Dl(i),i}function $l(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sl;Dl(e,"no worker provided");var n=e.version;return!(!t||!n)}f(Yl,"_workerFarm",void 0);var eu={};function tu(e){return nu.apply(this,arguments)}function nu(){return nu=l(A().mark((function e(t){var n,r,i,s=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:null,r=s.length>2&&void 0!==s[2]?s[2]:{},i=s.length>3&&void 0!==s[3]?s[3]:null,n&&(t=ru(t,n,r,i)),eu[t]=eu[t]||iu(t),e.next=7,eu[t];case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)}))),nu.apply(this,arguments)}function ru(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!n.useLocalLibraries&&e.startsWith("http"))return e;r=r||e;var i=n.modules||{};return i[r]?i[r]:Ql?n.CDN?(Dl(n.CDN.startsWith("http")),"".concat(n.CDN,"/").concat(t,"@").concat(Sl,"/dist/libs/").concat(r)):Rl?"../src/libs/".concat(r):"modules/".concat(t,"/src/libs/").concat(r):"modules/".concat(t,"/dist/libs/").concat(r)}function iu(e){return su.apply(this,arguments)}function su(){return(su=l(A().mark((function e(t){var n,r,i;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.endsWith("wasm")){e.next=4;break}return e.next=3,ou(t);case 3:case 9:return e.abrupt("return",e.sent);case 4:if(Ql){e.next=16;break}return e.prev=5,n=globalThis.loaders||{},r=n.requireFromFile,e.next=9,null==r?void 0:r(t);case 12:return e.prev=12,e.t0=e.catch(5),console.error(e.t0),e.abrupt("return",null);case 16:if(!Rl){e.next=18;break}return e.abrupt("return",importScripts(t));case 18:return e.next=20,cu(t);case 20:return i=e.sent,e.abrupt("return",au(i,t));case 22:case"end":return e.stop()}}),e,null,[[5,12]])})))).apply(this,arguments)}function au(e,t){if(!Ql){var n=(globalThis.loaders||{}).requireFromString;return null==n?void 0:n(e,t)}if(Rl)return eval.call(globalThis,e),null;var r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}function ou(e){return Au.apply(this,arguments)}function Au(){return(Au=l(A().mark((function e(t){var n,r,i;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=globalThis.loaders||{},r=n.readFileAsArrayBuffer,!Ql&&r&&!t.startsWith("http")){e.next=8;break}return e.next=4,fetch(t);case 4:return i=e.sent,e.next=7,i.arrayBuffer();case 7:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,r(t);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cu(e){return lu.apply(this,arguments)}function lu(){return(lu=l(A().mark((function e(t){var n,r,i;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=globalThis.loaders||{},r=n.readFileAsText,!Ql&&r&&!t.startsWith("http")){e.next=8;break}return e.next=4,fetch(t);case 4:return i=e.sent,e.next=7,i.text();case 7:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,r(t);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function uu(e,t){return!!Yl.isSupported()&&(!!(Ql||null!=t&&t._nodeWorkers)&&(e.worker&&(null==t?void 0:t.worker)))}function hu(e,t,n,r,i){return du.apply(this,arguments)}function du(){return du=l(A().mark((function e(t,n,r,i,s){var a,o,c,l,u,h;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.id,o=ql(t,r),c=Yl.getWorkerFarm(r),l=c.getWorkerPool({name:a,url:o}),r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{})),e.next=8,l.startJob("process-on-worker",fu.bind(null,s));case 8:return(u=e.sent).postMessage("process",{input:n,options:r,context:i}),e.next=12,u.result;case 12:return h=e.sent,e.next=15,h.result;case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e)}))),du.apply(this,arguments)}function fu(e,t,n,r){return pu.apply(this,arguments)}function pu(){return(pu=l(A().mark((function e(t,n,r,i){var s,a,o,c,l;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=r,e.next="done"===e.t0?3:"error"===e.t0?5:"process"===e.t0?7:20;break;case 3:return n.done(i),e.abrupt("break",21);case 5:return n.error(new Error(i.error)),e.abrupt("break",21);case 7:return s=i.id,a=i.input,o=i.options,e.prev=8,e.next=11,t(a,o);case 11:c=e.sent,n.postMessage("done",{id:s,result:c}),e.next=19;break;case 15:e.prev=15,e.t1=e.catch(8),l=e.t1 instanceof Error?e.t1.message:"unknown error",n.postMessage("error",{id:s,error:l});case 19:return e.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(r));case 21:case"end":return e.stop()}}),e,null,[[8,15]])})))).apply(this,arguments)}function vu(e,t,n){if(e.byteLength<=t+n)return"";for(var r=new DataView(e),i="",s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(t+s));return i}function gu(e){try{return JSON.parse(e)}catch(t){throw new Error('Failed to parse JSON from data starting with "'.concat(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return vu(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return vu(e,0,t)}return""}(e),'"'))}}function mu(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return yu(t)}function yu(e){var t,n=e.map((function(e){return e instanceof ArrayBuffer?new Uint8Array(e):e})),r=n.reduce((function(e,t){return e+t.byteLength}),0),i=new Uint8Array(r),s=0,a=u(n);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.set(o,s),s+=o.byteLength}}catch(e){a.e(e)}finally{a.f()}return i.buffer}function _u(e,t,n){var r=void 0!==n?new Uint8Array(e).subarray(t,t+n):new Uint8Array(e).subarray(t);return new Uint8Array(r).buffer}function bu(e,t){return sl(e>=0),sl(t>0),e+(t-1)&~(t-1)}function wu(e,t,n){var r;if(e instanceof ArrayBuffer)r=new Uint8Array(e);else{var i=e.byteOffset,s=e.byteLength;r=new Uint8Array(e.buffer||e.arrayBuffer,i,s)}return t.set(r,n),n+bu(r.byteLength,4)}function Bu(e){return Cu.apply(this,arguments)}function Cu(){return(Cu=l(A().mark((function e(t){var n,r,i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=[],r=!1,i=!1,e.prev=3,a=Q(t);case 5:return e.next=7,a.next();case 7:if(!(r=!(o=e.sent).done)){e.next=13;break}c=o.value,n.push(c);case 10:r=!1,e.next=5;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(3),i=!0,s=e.t0;case 19:if(e.prev=19,e.prev=20,!r||null==a.return){e.next=24;break}return e.next=24,a.return();case 24:if(e.prev=24,!i){e.next=27;break}throw s;case 27:return e.finish(24);case 28:return e.finish(19);case 29:return e.abrupt("return",mu.apply(void 0,n));case 30:case"end":return e.stop()}}),e,null,[[3,15,19,29],[20,,24,28]])})))).apply(this,arguments)}var Mu={};function ku(e){for(var t in Mu)if(e.startsWith(t)){var n=Mu[t];e=e.replace(t,n)}return e.startsWith("http://")||e.startsWith("https://")||(e="".concat("").concat(e)),e}function Eu(e){if((t=e)&&"object"===M(t)&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){var n=e;return(new TextEncoder).encode(n).buffer}if(e&&"object"===M(e)&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function Fu(e){var t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}var xu=function(e){return"function"==typeof e},Uu=function(e){return null!==e&&"object"===M(e)},Iu=function(e){return Uu(e)&&e.constructor==={}.constructor},Tu=function(e){return Boolean(e)&&"function"==typeof e[Symbol.iterator]},Pu=function(e){return e&&"function"==typeof e[Symbol.asyncIterator]},Su=function(e){return"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json},Du=function(e){return"undefined"!=typeof Blob&&e instanceof Blob},Qu=function(e){return function(e){return"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||Uu(e)&&xu(e.tee)&&xu(e.cancel)&&xu(e.getReader)}(e)||function(e){return Uu(e)&&xu(e.read)&&xu(e.pipe)&&function(e){return"boolean"==typeof e}(e.readable)}(e)},Ru=function(e){m(n,a(Error));var t=_(n);function n(e,r){var i;return x(this,n),f(w(i=t.call(this,e)),"reason",void 0),f(w(i),"url",void 0),f(w(i),"response",void 0),i.reason=r.reason,i.url=r.url,i.response=r.response,i}return I(n)}(),Ou=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Vu=/^([-\w.]+\/[-\w.+]+)/;function Lu(e,t){return e.toLowerCase()===t.toLowerCase()}function Hu(e){var t=Ou.exec(e);return t?t[1]:""}var Nu=/\?.*/;function Gu(e){return e.replace(Nu,"")}function ju(e){if(e.length<50)return e;var t=e.slice(e.length-15),n=e.substr(0,32);return"".concat(n,"...").concat(t)}function Wu(e){return Su(e)?e.url:Du(e)?e.name||"":"string"==typeof e?e:""}function zu(e){if(Su(e)){var t=e,n=t.headers.get("content-type")||"",r=Gu(t.url);return function(e){var t=Vu.exec(e);return t?t[1]:e}(n)||Hu(r)}return Du(e)?e.type||"":"string"==typeof e?Hu(e):""}function Xu(e){return Su(e)?e.headers["content-length"]||-1:Du(e)?e.size:"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function Ku(e){return Zu.apply(this,arguments)}function Zu(){return(Zu=l(A().mark((function e(t){var n,r,i,s,a,o;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Su(t)){e.next=2;break}return e.abrupt("return",t);case 2:return n={},(r=Xu(t))>=0&&(n["content-length"]=String(r)),i=Wu(t),(s=zu(t))&&(n["content-type"]=s),e.next=10,eh(t);case 10:return(a=e.sent)&&(n["x-first-bytes"]=a),"string"==typeof t&&(t=(new TextEncoder).encode(t)),o=new Response(t,{headers:n}),Object.defineProperty(o,"url",{value:i}),e.abrupt("return",o);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ju(e){return Yu.apply(this,arguments)}function Yu(){return(Yu=l(A().mark((function e(t){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.ok){e.next=5;break}return e.next=3,qu(t);case 3:throw e.sent;case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qu(e){return $u.apply(this,arguments)}function $u(){return($u=l(A().mark((function e(t){var n,r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=ju(t.url),r=(r="Failed to fetch resource (".concat(t.status,") ").concat(t.statusText,": ").concat(n)).length>100?"".concat(r.slice(0,100),"..."):r,i={reason:t.statusText,url:t.url,response:t},e.prev=4,s=t.headers.get("Content-Type"),t.bodyUsed||null==s||!s.includes("application/json")){e.next=12;break}return e.next=9,t.json();case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,t.text();case 14:e.t0=e.sent;case 15:i.reason=e.t0,e.next=20;break;case 18:e.prev=18,e.t1=e.catch(4);case 20:return e.abrupt("return",new Ru(r,i));case 21:case"end":return e.stop()}}),e,null,[[4,18]])})))).apply(this,arguments)}function eh(e){return th.apply(this,arguments)}function th(){return(th=l(A().mark((function e(t){var n,r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=5,"string"!=typeof t){e.next=3;break}return e.abrupt("return","data:,".concat(t.slice(0,n)));case 3:if(!(t instanceof Blob)){e.next=8;break}return r=t.slice(0,5),e.next=7,new Promise((function(e){var t=new FileReader;t.onload=function(t){var n;return e(null==t||null===(n=t.target)||void 0===n?void 0:n.result)},t.readAsDataURL(r)}));case 7:return e.abrupt("return",e.sent);case 8:if(!(t instanceof ArrayBuffer)){e.next=12;break}return i=t.slice(0,n),s=nh(i),e.abrupt("return","data:base64,".concat(s));case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nh(e){for(var t="",n=new Uint8Array(e),r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return btoa(t)}function rh(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}function ih(e,t){return sh.apply(this,arguments)}function sh(){return(sh=l(A().mark((function e(t,n){var r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!=typeof t){e.next=8;break}if(!rh(r=ku(t))){e.next=5;break}if(null===(i=globalThis.loaders)||void 0===i||!i.fetchNode){e.next=5;break}return e.abrupt("return",null===(s=globalThis.loaders)||void 0===s?void 0:s.fetchNode(r,n));case 5:return e.next=7,fetch(r,n);case 7:case 10:return e.abrupt("return",e.sent);case 8:return e.next=10,Ku(t);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ah=new Bl({id:"loaders.gl"}),oh=function(){function e(){x(this,e)}return I(e,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),e}(),Ah={fetch:null,mimeType:void 0,nothrow:!1,log:new(function(){function e(){x(this,e),f(this,"console",void 0),this.console=console}return I(e,[{key:"log",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.log).bind.apply(e,[this.console].concat(n))}},{key:"info",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.info).bind.apply(e,[this.console].concat(n))}},{key:"warn",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.warn).bind.apply(e,[this.console].concat(n))}},{key:"error",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(e=this.console.error).bind.apply(e,[this.console].concat(n))}}]),e}()),useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:al,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},ch={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function lh(){globalThis.loaders=globalThis.loaders||{};var e=globalThis.loaders;return e._state||(e._state={}),e._state}function uh(){var e=lh();return e.globalOptions=e.globalOptions||d({},Ah),e.globalOptions}function hh(e,t,n,r){return n=n||[],function(e,t){dh(e,null,Ah,ch,t);var n,r=u(t);try{for(r.s();!(n=r.n()).done;){var i=n.value,s=e&&e[i.id]||{},a=i.options&&i.options[i.id]||{},o=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};dh(s,i.id,a,o,t)}}catch(e){r.e(e)}finally{r.f()}}(e,n=Array.isArray(n)?n:[n]),function(e,t,n){var r=d({},e.options||{});(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(r,n),null===r.log&&(r.log=new oh);return ph(r,uh()),ph(r,t),r}(t,e,r)}function dh(e,t,n,r,i){var s=t||"Top level",a=t?"".concat(t,"."):"";for(var o in e){var A=!t&&Uu(e[o]);if(!(o in n)&&!("baseUri"===o&&!t)&&!("workerUrl"===o&&t))if(o in r)ah.warn("".concat(s," loader option '").concat(a).concat(o,"' no longer supported, use '").concat(r[o],"'"))();else if(!A){var c=fh(o,i);ah.warn("".concat(s," loader option '").concat(a).concat(o,"' not recognized. ").concat(c))()}}}function fh(e,t){var n,r=e.toLowerCase(),i="",s=u(t);try{for(s.s();!(n=s.n()).done;){var a=n.value;for(var o in a.options){if(e===o)return"Did you mean '".concat(a.id,".").concat(o,"'?");var A=o.toLowerCase();(r.startsWith(A)||A.startsWith(r))&&(i=i||"Did you mean '".concat(a.id,".").concat(o,"'?"))}}}catch(e){s.e(e)}finally{s.f()}return i}function ph(e,t){for(var n in t)if(n in t){var r=t[n];Iu(r)&&Iu(e[n])?e[n]=d(d({},e[n]),t[n]):e[n]=t[n]}}function vh(e){var t;return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(null===(t=e)||void 0===t?void 0:t.extensions))}function gh(e){var t,n,r;return sl(e,"null loader"),sl(vh(e),"invalid loader"),Array.isArray(e)&&(r=e[1],e=d(d({},e=e[0]),{},{options:d(d({},e.options),r)})),(null!==(t=e)&&void 0!==t&&t.parseTextSync||null!==(n=e)&&void 0!==n&&n.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}function mh(){return(e=lh()).loaderRegistry=e.loaderRegistry||[],e.loaderRegistry;var e}var yh=/\.([^.]+)$/;function _h(e){return bh.apply(this,arguments)}function bh(){return bh=l(A().mark((function e(t){var n,r,i,s,a=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.length>1&&void 0!==a[1]?a[1]:[],r=a.length>2?a[2]:void 0,i=a.length>3?a[3]:void 0,Ch(t)){e.next=5;break}return e.abrupt("return",null);case 5:if(!(s=wh(t,n,d(d({},r),{},{nothrow:!0}),i))){e.next=8;break}return e.abrupt("return",s);case 8:if(!Du(t)){e.next=13;break}return e.next=11,t.slice(0,10).arrayBuffer();case 11:t=e.sent,s=wh(t,n,r,i);case 13:if(s||null!=r&&r.nothrow){e.next=15;break}throw new Error(Mh(t));case 15:return e.abrupt("return",s);case 16:case"end":return e.stop()}}),e)}))),bh.apply(this,arguments)}function wh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;if(!Ch(e))return null;if(t&&!Array.isArray(t))return gh(t);var i,s=[];(t&&(s=s.concat(t)),null!=n&&n.ignoreRegisteredLoaders)||(i=s).push.apply(i,p(mh()));kh(s);var a=Bh(e,s,n,r);if(!(a||null!=n&&n.nothrow))throw new Error(Mh(e));return a}function Bh(e,t,n,r){var i,s=Wu(e),a=zu(e),o=Gu(s)||(null==r?void 0:r.url),A=null,c="";(null!=n&&n.mimeType&&(A=Eh(t,null==n?void 0:n.mimeType),c="match forced by supplied MIME type ".concat(null==n?void 0:n.mimeType)),A=A||function(e,t){var n=t&&yh.exec(t),r=n&&n[1];return r?function(e,t){t=t.toLowerCase();var n,r=u(e);try{for(r.s();!(n=r.n()).done;){var i,s=n.value,a=u(s.extensions);try{for(a.s();!(i=a.n()).done;){if(i.value.toLowerCase()===t)return s}}catch(e){a.e(e)}finally{a.f()}}}catch(e){r.e(e)}finally{r.f()}return null}(e,r):null}(t,o),c=c||(A?"matched url ".concat(o):""),A=A||Eh(t,a),c=c||(A?"matched MIME type ".concat(a):""),A=A||function(e,t){if(!t)return null;var n,r=u(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if("string"==typeof t){if(Fh(t,i))return i}else if(ArrayBuffer.isView(t)){if(xh(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer){if(xh(t,0,i))return i}}}catch(e){r.e(e)}finally{r.f()}return null}(t,e),c=c||(A?"matched initial data ".concat(Uh(e)):""),null!=n&&n.fallbackMimeType&&(A=A||Eh(t,null==n?void 0:n.fallbackMimeType),c=c||(A?"matched fallback MIME type ".concat(a):"")),c)&&Fl.log(1,"selectLoader selected ".concat(null===(i=A)||void 0===i?void 0:i.name,": ").concat(c,"."));return A}function Ch(e){return!(e instanceof Response&&204===e.status)}function Mh(e){var t=Wu(e),n=zu(e),r="No valid loader found (";r+=t?"".concat(Fu(t),", "):"no url provided, ",r+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");var i=e?Uh(e):"";return r+=i?' first bytes: "'.concat(i,'"'):"first bytes: not available",r+=")"}function kh(e){var t,n=u(e);try{for(n.s();!(t=n.n()).done;){gh(t.value)}}catch(e){n.e(e)}finally{n.f()}}function Eh(e,t){var n,r=u(e);try{for(r.s();!(n=r.n()).done;){var i,s=n.value;if(null!==(i=s.mimeTypes)&&void 0!==i&&i.some((function(e){return Lu(t,e)})))return s;if(Lu(t,"application/x.".concat(s.id)))return s}}catch(e){r.e(e)}finally{r.f()}return null}function Fh(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some((function(t){return e.startsWith(t)}))}function xh(e,t,n){return(Array.isArray(n.tests)?n.tests:[n.tests]).some((function(n){return function(e,t,n,r){if(r instanceof ArrayBuffer)return function(e,t,n){if(n=n||e.byteLength,e.byteLength<n||t.byteLength<n)return!1;for(var r=new Uint8Array(e),i=new Uint8Array(t),s=0;s<r.length;++s)if(r[s]!==i[s])return!1;return!0}(r,e,r.byteLength);switch(M(r)){case"function":return r(e);case"string":return r===Ih(e,t,r.length);default:return!1}}(e,t,0,n)}))}function Uh(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return Ih(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){var n=0;return Ih(e,n,t)}return""}function Ih(e,t,n){if(e.byteLength<t+n)return"";for(var r=new DataView(e),i="",s=0;s<n;s++)i+=String.fromCharCode(r.getUint8(t+s));return i}function Th(e,t){var n,i,s,a,o;return A().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=(null==t?void 0:t.chunkSize)||262144,i=0,s=new TextEncoder;case 3:if(!(i<e.length)){r.next=11;break}return a=Math.min(e.length-i,n),o=e.slice(i,i+a),i+=a,r.next=9,s.encode(o);case 9:r.next=3;break;case 11:case"end":return r.stop()}}),r)}function Ph(e){var t,n,r,s,a,o,c,l=arguments;return A().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:t=l.length>1&&void 0!==l[1]?l[1]:{},n=t.chunkSize,r=void 0===n?262144:n,s=0;case 3:if(!(s<e.byteLength)){i.next=14;break}return a=Math.min(e.byteLength-s,r),o=new ArrayBuffer(a),c=new Uint8Array(e,s,a),new Uint8Array(o).set(c),s+=a,i.next=12,o;case 12:i.next=3;break;case 14:case"end":return i.stop()}}),i)}function Sh(){return(Sh=P(A().mark((function e(t,n){var r,i,s,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=(null==n?void 0:n.chunkSize)||1048576,i=0;case 2:if(!(i<t.size)){e.next=12;break}return s=i+r,e.next=6,T(t.slice(i,s).arrayBuffer());case 6:return a=e.sent,i=s,e.next=10,a;case 10:e.next=2;break;case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dh(e,t){return al?function(e,t){return Qh.apply(this,arguments)}(e,t):function(e,t){return Rh.apply(this,arguments)}(e)}function Qh(){return(Qh=P(A().mark((function e(t,n){var r,i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.getReader(),e.prev=1;case 2:return s=i||r.read(),null!=n&&n._streamReadAhead&&(i=r.read()),e.next=7,T(s);case 7:if(a=e.sent,o=a.done,c=a.value,!o){e.next=12;break}return e.abrupt("return");case 12:return e.next=14,Eu(c);case 14:e.next=2;break;case 16:e.next=21;break;case 18:e.prev=18,e.t0=e.catch(1),r.releaseLock();case 21:case"end":return e.stop()}}),e,null,[[1,18]])})))).apply(this,arguments)}function Rh(){return(Rh=P(A().mark((function e(t,n){var r,i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=!1,i=!1,e.prev=2,a=Q(t);case 4:return e.next=6,T(a.next());case 6:if(!(r=!(o=e.sent).done)){e.next=13;break}return c=o.value,e.next=10,Eu(c);case 10:r=!1,e.next=4;break;case 13:e.next=19;break;case 15:e.prev=15,e.t0=e.catch(2),i=!0,s=e.t0;case 19:if(e.prev=19,e.prev=20,!r||null==a.return){e.next=24;break}return e.next=24,T(a.return());case 24:if(e.prev=24,!i){e.next=27;break}throw s;case 27:return e.finish(24);case 28:return e.finish(19);case 29:case"end":return e.stop()}}),e,null,[[2,15,19,29],[20,,24,28]])})))).apply(this,arguments)}function Oh(e,t){if("string"==typeof e)return Th(e,t);if(e instanceof ArrayBuffer)return Ph(e,t);if(Du(e))return function(e,t){return Sh.apply(this,arguments)}(e,t);if(Qu(e))return Dh(e,t);if(Su(e))return Dh(e.body,t);throw new Error("makeIterator")}var Vh="Cannot convert supplied data type";function Lh(e,t,n){if(t.text&&"string"==typeof e)return e;var r;if((r=e)&&"object"===M(r)&&r.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){var i=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(i):i}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);var s=e.buffer,a=e.byteLength||e.length;return 0===e.byteOffset&&a===s.byteLength||(s=s.slice(e.byteOffset,e.byteOffset+a)),s}throw new Error(Vh)}function Hh(e,t,n){return Nh.apply(this,arguments)}function Nh(){return(Nh=l(A().mark((function e(t,n,r){var i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t instanceof ArrayBuffer||ArrayBuffer.isView(t),"string"!=typeof t&&!i){e.next=3;break}return e.abrupt("return",Lh(t,n));case 3:if(!Du(t)){e.next=7;break}return e.next=6,Ku(t);case 6:t=e.sent;case 7:if(!Su(t)){e.next=21;break}return s=t,e.next=11,Ju(s);case 11:if(!n.binary){e.next=17;break}return e.next=14,s.arrayBuffer();case 14:e.t0=e.sent,e.next=20;break;case 17:return e.next=19,s.text();case 19:e.t0=e.sent;case 20:return e.abrupt("return",e.t0);case 21:if(Qu(t)&&(t=Oh(t,r)),!Tu(t)&&!Pu(t)){e.next=24;break}return e.abrupt("return",Bu(t));case 24:throw new Error(Vh);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gh(e,t){var n=uh(),r=e||n;return"function"==typeof r.fetch?r.fetch:Uu(r.fetch)?function(e){return ih(e,r.fetch)}:null!=t&&t.fetch?null==t?void 0:t.fetch:ih}function jh(e,t,n){if(n)return n;var r,i,s=d({fetch:Gh(t,e)},e);if(s.url){var a=Gu(s.url);s.baseUrl=a,s.queryString=function(e){var t=e.match(Nu);return t&&t[0]}(s.url),s.filename=Fu(a),s.baseUrl=(i=(r=a)?r.lastIndexOf("/"):-1)>=0?r.substr(0,i):""}return Array.isArray(s.loaders)||(s.loaders=null),s}function Wh(e,t){if(e&&!Array.isArray(e))return e;var n;if(e&&(n=Array.isArray(e)?e:[e]),t&&t.loaders){var r=Array.isArray(t.loaders)?t.loaders:[t.loaders];n=n?[].concat(p(n),p(r)):r}return n&&n.length?n:void 0}function zh(e,t,n,r){return Xh.apply(this,arguments)}function Xh(){return(Xh=l(A().mark((function e(t,n,r,i){var s,a,o;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!n||Array.isArray(n)||vh(n)||(i=void 0,r=n,n=void 0),e.next=3,t;case 3:return t=e.sent,r=r||{},s=Wu(t),a=Wh(n,i),e.next=10,_h(t,a,r);case 10:if(o=e.sent){e.next=13;break}return e.abrupt("return",null);case 13:return r=hh(r,o,a,s),i=jh({url:s,_parse:zh,loaders:a},r,i||null),e.next=17,Kh(o,t,r,i);case 17:return e.abrupt("return",e.sent);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kh(e,t,n,r){return Zh.apply(this,arguments)}function Zh(){return(Zh=l(A().mark((function e(t,n,r,i){var s,a,o,c,l,u,h,d,f;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $l(t),r=xl(t.options,r),Su(n)&&(a=(s=n).ok,o=s.redirected,c=s.status,l=s.statusText,u=s.type,h=s.url,d=Object.fromEntries(s.headers.entries()),i.response={headers:d,ok:a,redirected:o,status:c,statusText:l,type:u,url:h}),e.next=5,Hh(n,t,r);case 5:if(n=e.sent,!(f=t).parseTextSync||"string"!=typeof n){e.next=9;break}return e.abrupt("return",f.parseTextSync(n,r,i));case 9:if(!uu(t,r)){e.next=13;break}return e.next=12,hu(t,n,r,i,zh);case 12:case 16:case 20:return e.abrupt("return",e.sent);case 13:if(!f.parseText||"string"!=typeof n){e.next=17;break}return e.next=16,f.parseText(n,r,i);case 17:if(!f.parse){e.next=21;break}return e.next=20,f.parse(n,r,i);case 21:throw Dl(!f.parseSync),new Error("".concat(t.id," loader - no parser found and worker is disabled"));case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jh(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,s=-1/0,a=-1/0,o=e.POSITION?e.POSITION.value:[],A=o&&o.length,c=0;c<A;c+=3){var l=o[c],u=o[c+1],h=o[c+2];t=l<t?l:t,n=u<n?u:n,r=h<r?h:r,i=l>i?l:i,s=u>s?u:s,a=h>a?h:a}return[[t,n,r],[i,s,a]]}function Yh(e,t,n){var r=function(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(t.value),i=n||function(e){var t={};"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10));"byteStride"in e&&(t.byteStride=e.byteStride.toString(10));"normalized"in e&&(t.normalized=e.normalized.toString());return t}(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:r}]},nullable:!1,metadata:i}}function qh(e){var t=[];for(var n in e){var r=e[n];t.push(Yh(n,r))}return t}var $h=null===(e=globalThis.loaders)||void 0===e?void 0:e.parseImageNode,ed="undefined"!=typeof Image,td="undefined"!=typeof ImageBitmap,nd=Boolean($h),rd=!!al||nd;function id(e){var t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"===M(e)&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}function sd(e){switch(id(e)){case"data":return e;case"image":case"imagebitmap":var t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("getImageData");return t.width=e.width,t.height=e.height,n.drawImage(e,0,0),n.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}var ad=/^data:image\/svg\+xml/,od=/\.svg((\?|#).*)?$/;function Ad(e){return e&&(ad.test(e)||od.test(e))}function cd(e,t){if(Ad(t)){var n=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(n=unescape(encodeURIComponent(n)))}catch(e){throw new Error(e.message)}return"data:image/svg+xml;base64,".concat(btoa(n))}return ld(e,t)}function ld(e,t){if(Ad(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}function ud(e,t,n){return hd.apply(this,arguments)}function hd(){return(hd=l(A().mark((function e(t,n,r){var i,s,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=cd(t,r),s=self.URL||self.webkitURL,a="string"!=typeof i&&s.createObjectURL(i),e.prev=3,e.next=6,dd(a||i,n);case 6:return e.abrupt("return",e.sent);case 7:return e.prev=7,a&&s.revokeObjectURL(a),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[3,,7,10]])})))).apply(this,arguments)}function dd(e,t){return fd.apply(this,arguments)}function fd(){return fd=l(A().mark((function e(t,n){var r;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=new Image).src=t,!(n.image&&n.image.decode&&r.decode)){e.next=6;break}return e.next=5,r.decode();case 5:return e.abrupt("return",r);case 6:return e.next=8,new Promise((function(e,t){try{r.onload=function(){return e(r)},r.onerror=function(e){var n=e instanceof Error?e.message:"error";t(new Error(n))}}catch(e){t(e)}}));case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),fd.apply(this,arguments)}var pd={},vd=!0;function gd(e,t,n){return md.apply(this,arguments)}function md(){return(md=l(A().mark((function e(t,n,r){var i,s,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ad(r)){e.next=7;break}return e.next=3,ud(t,n,r);case 3:s=e.sent,i=s,e.next=8;break;case 7:i=ld(t,r);case 8:return a=n&&n.imagebitmap,e.next=11,yd(i,a);case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yd(e){return _d.apply(this,arguments)}function _d(){return _d=l(A().mark((function e(t){var n,r=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!bd(n=r.length>1&&void 0!==r[1]?r[1]:null)&&vd||(n=null),!n){e.next=13;break}return e.prev=3,e.next=6,createImageBitmap(t,n);case 6:return e.abrupt("return",e.sent);case 9:e.prev=9,e.t0=e.catch(3),console.warn(e.t0),vd=!1;case 13:return e.next=15,createImageBitmap(t);case 15:return e.abrupt("return",e.sent);case 16:case"end":return e.stop()}}),e,null,[[3,9]])}))),_d.apply(this,arguments)}function bd(e){for(var t in e||pd)return!1;return!0}function wd(e){return function(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Bd(t),i=0;i<r.length;++i)if(r[i]!==e[i+n])return!1;return!0}(e,"ftyp",4)?0==(96&e[8])?null:function(e){switch((t=e,n=8,r=12,String.fromCharCode.apply(String,p(t.slice(n,r)))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,n,r}(e):null}function Bd(e){return p(e).map((function(e){return e.charCodeAt(0)}))}function Cd(e){var t=Md(e);return function(e){var t=Md(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,false)))return null;return{mimeType:"image/png",width:t.getUint32(16,false),height:t.getUint32(20,false)}}(t)||function(e){var t=Md(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,false)&&255===t.getUint8(2)))return null;var n=function(){for(var e=new Set([65499,65476,65484,65501,65534]),t=65504;t<65520;++t)e.add(t);var n=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:n}}(),r=n.tableMarkers,i=n.sofMarkers,s=2;for(;s+9<t.byteLength;){var a=t.getUint16(s,false);if(i.has(a))return{mimeType:"image/jpeg",height:t.getUint16(s+5,false),width:t.getUint16(s+7,false)};if(!r.has(a))return null;s+=2,s+=t.getUint16(s,false)}return null}(t)||function(e){var t=Md(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,false)))return null;return{mimeType:"image/gif",width:t.getUint16(6,true),height:t.getUint16(8,true)}}(t)||function(e){var t=Md(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,false)&&t.getUint32(2,true)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,true),height:t.getUint32(22,true)}}(t)||function(e){var t=wd(new Uint8Array(e instanceof DataView?e.buffer:e));if(!t)return null;return{mimeType:t.mimeType,width:0,height:0}}(t)}function Md(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}function kd(e,t){return Ed.apply(this,arguments)}function Ed(){return Ed=l(A().mark((function e(t,n){var r,i,s,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Cd(t)||{},s=i.mimeType,sl(a=null===(r=globalThis.loaders)||void 0===r?void 0:r.parseImageNode),e.next=5,a(t,s);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),Ed.apply(this,arguments)}function Fd(){return(Fd=l(A().mark((function e(t,n,r){var i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=(n=n||{}).image||{},s=i.type||"auto",a=(r||{}).url,o=xd(s),e.t0=o,e.next="imagebitmap"===e.t0?8:"image"===e.t0?12:"data"===e.t0?16:20;break;case 8:return e.next=10,gd(t,n,a);case 10:return c=e.sent,e.abrupt("break",21);case 12:return e.next=14,ud(t,n,a);case 14:return c=e.sent,e.abrupt("break",21);case 16:return e.next=18,kd(t);case 18:return c=e.sent,e.abrupt("break",21);case 20:sl(!1);case 21:return"data"===s&&(c=sd(c)),e.abrupt("return",c);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xd(e){switch(e){case"auto":case"data":return function(){if(td)return"imagebitmap";if(ed)return"image";if(rd)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return td||ed||rd;case"imagebitmap":return td;case"image":return ed;case"data":return rd;default:throw new Error("@loaders.gl/images: image ".concat(e," not supported in this environment"))}}(e),e}}var Ud={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:function(e,t,n){return Fd.apply(this,arguments)},tests:[function(e){return Boolean(Cd(new DataView(e)))}],options:{image:{type:"auto",decode:!0}}},Id={};function Td(e){if(void 0===Id[e]){var t=al?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{return 0===document.createElement("canvas").toDataURL(e).indexOf("data:".concat(e))}catch(e){return!1}}(e);default:return!0}}(e):function(e){var t,n,r=["image/png","image/jpeg","image/gif"],i=(null===(t=globalThis.loaders)||void 0===t?void 0:t.imageFormatsNode)||r,s=null===(n=globalThis.loaders)||void 0===n?void 0:n.parseImageNode;return Boolean(s)&&i.includes(e)}(e);Id[e]=t}return Id[e]}function Pd(e,t){if(!e)throw new Error(t||"assert failed: gltf")}var Sd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Dd={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Qd=["SCALAR","VEC2","VEC3","VEC4"],Rd=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Od=new Map(Rd),Vd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Ld={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Hd={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Nd(e){return Qd[e-1]||Qd[0]}function Gd(e){var t=Od.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function jd(e,t){var n=Hd[e.componentType],r=Vd[e.type],i=Ld[e.componentType],s=e.count*r,a=e.count*r*i;return Pd(a>=0&&a<=t.byteLength),{ArrayType:n,length:s,byteLength:a,componentByteSize:Dd[e.componentType],numberOfComponentsInElement:Sd[e.type]}}function Wd(e,t,n){var r=e.bufferViews[n];Pd(r);var i=t[r.buffer];Pd(i);var s=(r.byteOffset||0)+i.byteOffset;return new Uint8Array(i.arrayBuffer,s,r.byteLength)}var zd=function(){function e(t){x(this,e),f(this,"gltf",void 0),f(this,"sourceBuffers",void 0),f(this,"byteLength",void 0),this.gltf={json:(null==t?void 0:t.json)||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:(null==t?void 0:t.buffers)||[],images:(null==t?void 0:t.images)||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}return I(e,[{key:"json",get:function(){return this.gltf.json}},{key:"getApplicationData",value:function(e){return this.json[e]}},{key:"getExtraData",value:function(e){return(this.json.extras||{})[e]}},{key:"hasExtension",value:function(e){var t=this.getUsedExtensions().find((function(t){return t===e})),n=this.getRequiredExtensions().find((function(t){return t===e}));return"string"==typeof t||"string"==typeof n}},{key:"getExtension",value:function(e){var t=this.getUsedExtensions().find((function(t){return t===e})),n=this.json.extensions||{};return t?n[e]:null}},{key:"getRequiredExtension",value:function(e){var t=this.getRequiredExtensions().find((function(t){return t===e}));return t?this.getExtension(e):null}},{key:"getRequiredExtensions",value:function(){return this.json.extensionsRequired||[]}},{key:"getUsedExtensions",value:function(){return this.json.extensionsUsed||[]}},{key:"getRemovedExtensions",value:function(){return this.json.extensionsRemoved||[]}},{key:"getObjectExtension",value:function(e,t){return(e.extensions||{})[t]}},{key:"getScene",value:function(e){return this.getObject("scenes",e)}},{key:"getNode",value:function(e){return this.getObject("nodes",e)}},{key:"getSkin",value:function(e){return this.getObject("skins",e)}},{key:"getMesh",value:function(e){return this.getObject("meshes",e)}},{key:"getMaterial",value:function(e){return this.getObject("materials",e)}},{key:"getAccessor",value:function(e){return this.getObject("accessors",e)}},{key:"getTexture",value:function(e){return this.getObject("textures",e)}},{key:"getSampler",value:function(e){return this.getObject("samplers",e)}},{key:"getImage",value:function(e){return this.getObject("images",e)}},{key:"getBufferView",value:function(e){return this.getObject("bufferViews",e)}},{key:"getBuffer",value:function(e){return this.getObject("buffers",e)}},{key:"getObject",value:function(e,t){if("object"===M(t))return t;var n=this.json[e]&&this.json[e][t];if(!n)throw new Error("glTF file error: Could not find ".concat(e,"[").concat(t,"]"));return n}},{key:"getTypedArrayForBufferView",value:function(e){var t=(e=this.getBufferView(e)).buffer,n=this.gltf.buffers[t];Pd(n);var r=(e.byteOffset||0)+n.byteOffset;return new Uint8Array(n.arrayBuffer,r,e.byteLength)}},{key:"getTypedArrayForAccessor",value:function(e){var t=this.getAccessor(e);return function(e,t,n){var r,i,s="number"==typeof n?null===(r=e.accessors)||void 0===r?void 0:r[n]:n;if(!s)throw new Error("No gltf accessor ".concat(JSON.stringify(n)));var a=null===(i=e.bufferViews)||void 0===i?void 0:i[s.bufferView||0];if(!a)throw new Error("No gltf buffer view for accessor ".concat(a));var o=t[a.buffer],A=o.arrayBuffer,c=(o.byteOffset||0)+(s.byteOffset||0)+(a.byteOffset||0),l=jd(s,a),u=l.ArrayType,h=l.length,d=l.componentByteSize,f=l.numberOfComponentsInElement,p=d*f,v=a.byteStride||p;if(void 0===a.byteStride||a.byteStride===p)return new u(A,c,h);for(var g=new u(h),m=0;m<s.count;m++){var y=new u(A,c+m*v,f);g.set(y,m*f)}return g}(this.gltf.json,this.gltf.buffers,t)}},{key:"getTypedArrayForImageData",value:function(e){e=this.getAccessor(e);var t=this.getBufferView(e.bufferView),n=this.getBuffer(t.buffer).data,r=t.byteOffset||0;return new Uint8Array(n,r,t.byteLength)}},{key:"addApplicationData",value:function(e,t){return this.json[e]=t,this}},{key:"addExtraData",value:function(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}},{key:"addObjectExtension",value:function(e,t,n){return e.extensions=e.extensions||{},e.extensions[t]=n,this.registerUsedExtension(t),this}},{key:"setObjectExtension",value:function(e,t,n){(e.extensions||{})[t]=n}},{key:"removeObjectExtension",value:function(e,t){var n=(null==e?void 0:e.extensions)||{};if(n[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];var r=this.json.extensionsRemoved;r.includes(t)||r.push(t)}delete n[t]}},{key:"addExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Pd(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}},{key:"addRequiredExtension",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Pd(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}},{key:"registerUsedExtension",value:function(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((function(t){return t===e}))||this.json.extensionsUsed.push(e)}},{key:"registerRequiredExtension",value:function(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((function(t){return t===e}))||this.json.extensionsRequired.push(e)}},{key:"removeExtension",value:function(e){var t;if(null!==(t=this.json.extensions)&&void 0!==t&&t[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];var n=this.json.extensionsRemoved;n.includes(e)||n.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}},{key:"setDefaultScene",value:function(e){this.json.scene=e}},{key:"addScene",value:function(e){var t=e.nodeIndices;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}},{key:"addNode",value:function(e){var t=e.meshIndex,n=e.matrix;this.json.nodes=this.json.nodes||[];var r={mesh:t};return n&&(r.matrix=n),this.json.nodes.push(r),this.json.nodes.length-1}},{key:"addMesh",value:function(e){var t=e.attributes,n=e.indices,r=e.material,i=e.mode,s=void 0===i?4:i,a={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(n){var o=this._addIndices(n);a.primitives[0].indices=o}return Number.isFinite(r)&&(a.primitives[0].material=r),this.json.meshes=this.json.meshes||[],this.json.meshes.push(a),this.json.meshes.length-1}},{key:"addPointCloud",value:function(e){var t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}},{key:"addImage",value:function(e,t){var n=Cd(e),r=t||(null==n?void 0:n.mimeType),i={bufferView:this.addBufferView(e),mimeType:r};return this.json.images=this.json.images||[],this.json.images.push(i),this.json.images.length-1}},{key:"addBufferView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.byteLength,r=e.byteLength;Pd(Number.isFinite(r)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);var i={buffer:t,byteOffset:n,byteLength:r};return this.byteLength+=bu(r,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(i),this.json.bufferViews.length-1}},{key:"addAccessor",value:function(e,t){var n={bufferView:e,type:Nd(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(n),this.json.accessors.length-1}},{key:"addBinaryBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{size:3},n=this.addBufferView(e),r={min:t.min,max:t.max};r.min&&r.max||(r=this._getAccessorMinMax(e,t.size));var i={size:t.size,componentType:Gd(e),count:Math.round(e.length/t.size),min:r.min,max:r.max};return this.addAccessor(n,Object.assign(i,t))}},{key:"addTexture",value:function(e){var t={source:e.imageIndex};return this.json.textures=this.json.textures||[],this.json.textures.push(t),this.json.textures.length-1}},{key:"addMaterial",value:function(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}},{key:"createBinaryChunk",value:function(){var e,t,n,r=this.byteLength,i=new ArrayBuffer(r),s=new Uint8Array(i),a=0,o=u(this.sourceBuffers||[]);try{for(o.s();!(n=o.n()).done;){a=wu(n.value,s,a)}}catch(e){o.e(e)}finally{o.f()}null!==(e=this.json)&&void 0!==e&&null!==(t=e.buffers)&&void 0!==t&&t[0]?this.json.buffers[0].byteLength=r:this.json.buffers=[{byteLength:r}],this.gltf.binary=i,this.sourceBuffers=[i],this.gltf.buffers=[{arrayBuffer:i,byteOffset:0,byteLength:i.byteLength}]}},{key:"_removeStringFromArray",value:function(e,t){for(var n=!0;n;){var r=e.indexOf(t);r>-1?e.splice(r,1):n=!1}}},{key:"_addAttributes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={};for(var n in e){var r=e[n],i=this._getGltfAttributeName(n),s=this.addBinaryBuffer(r.value,r);t[i]=s}return t}},{key:"_addIndices",value:function(e){return this.addBinaryBuffer(e,{size:1})}},{key:"_getGltfAttributeName",value:function(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}},{key:"_getAccessorMinMax",value:function(e,t){var n={min:null,max:null};if(e.length<t)return n;n.min=[],n.max=[];var r,i=u(e.subarray(0,t));try{for(i.s();!(r=i.n()).done;){var s=r.value;n.min.push(s),n.max.push(s)}}catch(e){i.e(e)}finally{i.f()}for(var a=t;a<e.length;a+=t)for(var o=0;o<t;o++)n.min[0+o]=Math.min(n.min[0+o],e[a+o]),n.max[0+o]=Math.max(n.max[0+o],e[a+o]);return n}}]),e}();function Xd(e){return(e%1+1)%1}var Kd={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Zd={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Jd={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function Yd(e,t){return Jd[t]*Kd[e]}function qd(e,t,n,r){if("UINT8"!==n&&"UINT16"!==n&&"UINT32"!==n&&"UINT64"!==n)return null;var i=$d(e.getTypedArrayForBufferView(t),"SCALAR",n,r+1);return i instanceof BigInt64Array||i instanceof BigUint64Array?null:i}function $d(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=Kd[t],s=Zd[n],a=Jd[n],o=r*i,A=o*a,c=e.buffer,l=e.byteOffset;if(l%a!=0){var u=new Uint8Array(c);c=u.slice(l,l+A).buffer,l=0}return new s(c,l,o)}function ef(e,t,n){var r,i,s="TEXCOORD_".concat(t.texCoord||0),a=n.attributes[s],o=e.getTypedArrayForAccessor(a),A=e.gltf.json,c=t.index,l=null===(r=A.textures)||void 0===r||null===(i=r[c])||void 0===i?void 0:i.source;if(void 0!==l){var u,h,d,f=null===(u=A.images)||void 0===u||null===(h=u[l])||void 0===h?void 0:h.mimeType,p=null===(d=e.gltf.images)||void 0===d?void 0:d[l];if(p&&void 0!==p.width){for(var v=[],g=0;g<o.length;g+=2){var m=nf(p,f,o,g,t.channels);v.push(m)}return v}}return[]}function tf(e,t,n,r,i){if(null!=n&&n.length){var s,a=[],o=u(n);try{var A=function(){var e=s.value,t=r.findIndex((function(t){return t===e}));-1===t&&(t=r.push(e)-1),a.push(t)};for(o.s();!(s=o.n()).done;)A()}catch(e){o.e(e)}finally{o.f()}var c=new Uint32Array(a),l=e.gltf.buffers.push({arrayBuffer:c.buffer,byteOffset:c.byteOffset,byteLength:c.byteLength})-1,h=e.addBufferView(c,l,0),d=e.addAccessor(h,{size:1,componentType:Gd(c),count:c.length});i.attributes[t]=d}}function nf(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[0],s={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},a=n[r],o=n[r+1],A=1;!t||-1===t.indexOf("image/jpeg")&&-1===t.indexOf("image/png")||(A=4);var c,l=rf(a,o,e,A),h=0,d=u(i);try{for(d.s();!(c=d.n()).done;){var f=c.value,p="number"==typeof f?Object.values(s)[f]:s[f],v=l+p.offset,g=sd(e);if(g.data.length<=v)throw new Error("".concat(g.data.length," <= ").concat(v));var m=g.data[v];h|=m<<p.shift}}catch(e){d.e(e)}finally{d.f()}return h}function rf(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=n.width,s=Xd(e)*(i-1),a=Math.round(s),o=n.height,A=Xd(t)*(o-1),c=Math.round(A),l=n.components?n.components:r,u=(c*i+a)*l;return u}function sf(e,t,n,r,i){for(var s=[],a=0;a<t;a++){var o=n[a],A=n[a+1]-n[a];if(A+o>r)break;var c=o/i,l=A/i;s.push(e.slice(c,c+l))}return s}function af(e,t,n){for(var r=[],i=0;i<t;i++){var s=i*n;r.push(e.slice(s,s+n))}return r}function of(e,t,n,r){if(n)throw new Error("Not implemented - arrayOffsets for strings is specified");if(r){for(var i=[],s=new TextDecoder("utf8"),a=0,o=0;o<e;o++){var A=r[o+1]-r[o];if(A+a<=t.length){var c=t.subarray(a,A+a),l=s.decode(c);i.push(l),a+=A}}return i}return[]}function Af(){return(Af=l(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:cf(new zd(t),n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cf(e,t){var n=e.gltf.json;if(n.meshes){var r,i=u(n.meshes);try{for(i.s();!(r=i.n()).done;){var s,a=u(r.value.primitives);try{for(a.s();!(s=a.n()).done;){lf(e,s.value,t)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){i.e(e)}finally{i.f()}}}function lf(e,t,n){var r,i;if(null!=n&&null!==(r=n.gltf)&&void 0!==r&&r.loadBuffers){var s=null===(i=t.extensions)||void 0===i?void 0:i.EXT_mesh_features,a=null==s?void 0:s.featureIds;if(a){var o,A=u(a);try{for(A.s();!(o=A.n()).done;){var c,l=o.value,h=void 0;if(void 0!==l.attribute){var d="_FEATURE_ID_".concat(l.attribute),f=t.attributes[d];h=e.getTypedArrayForAccessor(f)}else h=void 0!==l.texture&&null!=n&&null!==(c=n.gltf)&&void 0!==c&&c.loadImages?ef(e,l.texture,t):[];l.data=h}}catch(e){A.e(e)}finally{A.f()}}}}function uf(e,t){var n,r=null===(n=t.extensions)||void 0===n?void 0:n.EXT_mesh_features;if(r){var i=r.featureIds;i.forEach((function(n,r){if(n.data){var s=function(e){var t,n="_FEATURE_ID_",r=Object.keys(e).filter((function(e){return 0===e.indexOf(n)})),i=-1,s=u(r);try{for(s.s();!(t=s.n()).done;){var a=t.value,o=Number(a.substring(n.length));o>i&&(i=o)}}catch(e){s.e(e)}finally{s.f()}return i++,{accessorKey:"".concat(n).concat(i),index:i}}(t.attributes),a=s.accessorKey,o=s.index,A=new Uint32Array(n.data);i[r]={featureCount:A.length,propertyTable:n.propertyTable,attribute:o},e.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength});var c=e.addBufferView(A),l=e.addAccessor(c,{size:1,componentType:Gd(A),count:A.length});t.attributes[a]=l}}))}}var hf=Object.freeze({__proto__:null,name:"EXT_mesh_features",decode:function(e,t){return Af.apply(this,arguments)},encode:function(e,t){var n=new zd(e);return function(e,t){var n=e.gltf.json.meshes;if(!n)return;var r,i=u(n);try{for(i.s();!(r=i.n()).done;){var s,a=u(r.value.primitives);try{for(a.s();!(s=a.n()).done;){uf(e,s.value)}}catch(e){a.e(e)}finally{a.f()}}}catch(e){i.e(e)}finally{i.f()}}(n),n.createBinaryChunk(),n.gltf},createExtMeshFeatures:function(e,t,n,r){t.extensions||(t.extensions={});var i=t.extensions.EXT_mesh_features;i||(i={featureIds:[]},t.extensions.EXT_mesh_features=i);var s=i.featureIds,a={featureCount:n.length,propertyTable:r,data:n};s.push(a),e.addObjectExtension(t,"EXT_mesh_features",i)}});function df(){return(df=l(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ff(new zd(t),n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ff(e,t){var n,r;if(null!==(n=t.gltf)&&void 0!==n&&n.loadBuffers){var i=e.getExtension("EXT_structural_metadata");i&&(null!==(r=t.gltf)&&void 0!==r&&r.loadImages&&function(e,t){var n=t.propertyTextures,r=e.gltf.json;if(n&&r.meshes){var i,s=u(r.meshes);try{for(s.s();!(i=s.n()).done;){var a,o=u(i.value.primitives);try{for(o.s();!(a=o.n()).done;){vf(e,n,a.value,t)}}catch(e){o.e(e)}finally{o.f()}}}catch(e){s.e(e)}finally{s.f()}}}(e,i),function(e,t){var n=t.schema;if(!n)return;var r=n.classes,i=t.propertyTables;if(r&&i)for(var s in r){var a=pf(i,s);a&&mf(e,n,a)}}(e,i))}}function pf(e,t){var n,r=u(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.class===t)return i}}catch(e){r.e(e)}finally{r.f()}return null}function vf(e,t,n,r){var i;if(t){var s=null===(i=n.extensions)||void 0===i?void 0:i.EXT_structural_metadata,a=null==s?void 0:s.propertyTextures;if(a){var o,A=u(a);try{for(A.s();!(o=A.n()).done;){gf(e,t[o.value],n,r)}}catch(e){A.e(e)}finally{A.f()}}}}function gf(e,t,n,r){if(t.properties){r.dataAttributeNames||(r.dataAttributeNames=[]);var i=t.class;for(var s in t.properties){var a,o="".concat(i,"_").concat(s),A=null===(a=t.properties)||void 0===a?void 0:a[s];if(A){A.data||(A.data=[]);var c=A.data,l=ef(e,A,n);null!==l&&(tf(e,o,l,c,n),A.data=c,r.dataAttributeNames.push(o))}}}}function mf(e,t,n){var r,i=null===(r=t.classes)||void 0===r?void 0:r[n.class];if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: no schema class with name ".concat(n.class));var s=n.count;for(var a in i.properties){var o,A=i.properties[a],c=null===(o=n.properties)||void 0===o?void 0:o[a];if(c){var l=yf(e,t,A,s,c);c.data=l}}}function yf(e,t,n,r,i){var s=[],a=i.values,o=e.getTypedArrayForBufferView(a),A=function(e,t,n,r){if(t.array&&void 0===t.count&&void 0!==n.arrayOffsets)return qd(e,n.arrayOffsets,n.arrayOffsetType||"UINT32",r);return null}(e,n,i,r),c=function(e,t,n){if(void 0!==t.stringOffsets)return qd(e,t.stringOffsets,t.stringOffsetType||"UINT32",n);return null}(e,i,r);switch(n.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":s=function(e,t,n,r){var i,s=e.array,a=e.count,o=Yd(e.type,e.componentType),A=n.byteLength/o;i=e.componentType?$d(n,e.type,e.componentType,A):n;if(s)return r?sf(i,t,r,n.length,o):a?af(i,t,a):[];return i}(n,r,o,A);break;case"BOOLEAN":throw new Error("Not implemented - classProperty.type=".concat(n.type));case"STRING":s=of(r,o,A,c);break;case"ENUM":s=function(e,t,n,r,i){var s,a=t.enumType;if(!a)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");var o=null===(s=e.enums)||void 0===s?void 0:s[a];if(!o)throw new Error("Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ".concat(a));var A=o.valueType||"UINT16",c=Yd(t.type,A),l=r.byteLength/c,u=$d(r,t.type,A,l);u||(u=r);if(t.array){if(i)return function(e){for(var t=e.valuesData,n=e.numberOfElements,r=e.arrayOffsets,i=e.valuesDataBytesLength,s=e.elementSize,a=e.enumEntry,o=[],A=0;A<n;A++){var c=r[A],l=r[A+1]-r[A];if(l+c>i)break;var u=_f(t,c/s,l/s,a);o.push(u)}return o}({valuesData:u,numberOfElements:n,arrayOffsets:i,valuesDataBytesLength:r.length,elementSize:c,enumEntry:o});var h=t.count;return h?function(e,t,n,r){for(var i=[],s=0;s<t;s++){var a=_f(e,n*s,n,r);i.push(a)}return i}(u,n,h,o):[]}return _f(u,0,n,o)}(t,n,r,o,A);break;default:throw new Error("Unknown classProperty type ".concat(n.type))}return s}function _f(e,t,n,r){for(var i=[],s=0;s<n;s++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)i.push("");else{var a=bf(r,e[t+s]);a?i.push(a.name):i.push("")}return i}function bf(e,t){var n,r=u(e.values);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.value===t)return i}}catch(e){r.e(e)}finally{r.f()}return null}function wf(e,t,n){for(var r in e.properties){var i=e.properties[r].data;if(i){var s=t.properties[r];if(s){var a=Mf(i,s,n);e.properties[r]=a}}}}function Bf(e,t,n){var r,i=null!=n?n:{id:"schema_id"},s={properties:{}},a=u(e);try{for(a.s();!(r=a.n()).done;){var o=r.value,A={type:o.elementType,componentType:o.componentType};s.properties[o.name]=A}}catch(e){a.e(e)}finally{a.f()}return i.classes={},i.classes[t]=s,i}function Cf(e,t,n){var r,i,s={class:t,count:0},a=0,o=null===(r=n.classes)||void 0===r?void 0:r[t],A=u(e);try{for(A.s();!(i=A.n()).done;){var c=i.value;if(0===a&&(a=c.values.length),a!==c.values.length&&c.values.length)throw new Error("Illegal values in attributes");(null==o?void 0:o.properties[c.name])&&(s.properties||(s.properties={}),s.properties[c.name]={values:0,data:c.values})}}catch(e){A.e(e)}finally{A.f()}return s.count=a,s}function Mf(e,t,n){var r={values:0};if("STRING"===t.type){var i=function(e){var t,n=new TextEncoder,r=[],i=0,s=u(e);try{for(s.s();!(t=s.n()).done;){var a=t.value,o=n.encode(a);i+=o.length,r.push(o)}}catch(e){s.e(e)}finally{s.f()}for(var A=new Uint8Array(i),c=[],l=0,h=0,d=r;h<d.length;h++){var f=d[h];A.set(f,l),c.push(l),l+=f.length}c.push(l);var p=new Uint32Array(c);return{stringData:A,stringOffsets:p}}(e),s=i.stringData,a=i.stringOffsets;r.stringOffsets=Ef(a,n),r.values=Ef(s,n)}else if("SCALAR"===t.type&&t.componentType){var o=function(e,t){var n,r=[],i=u(e);try{for(i.s();!(n=i.n()).done;){var s=n.value;r.push(Number(s))}}catch(e){i.e(e)}finally{i.f()}var a=kf[t];if(!a)throw new Error("Illegal component type");return new a(r)}(e,t.componentType);r.values=Ef(o,n)}return r}var kf={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function Ef(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}var Ff=Object.freeze({__proto__:null,name:"EXT_structural_metadata",decode:function(e,t){return df.apply(this,arguments)},encode:function(e,t){var n=new zd(e);return function(e,t){var n=e.getExtension("EXT_structural_metadata");if(!n)return;if(n.propertyTables){var r,i=u(n.propertyTables);try{for(i.s();!(r=i.n()).done;){var s,a,o=r.value,A=o.class,c=null===(s=n.schema)||void 0===s||null===(a=s.classes)||void 0===a?void 0:a[A];o.properties&&c&&wf(o,c,e)}}catch(e){i.e(e)}finally{i.f()}}}(n),n.createBinaryChunk(),n.gltf},createExtStructuralMetadata:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"schemaClassId",r=e.getExtension("EXT_structural_metadata");r||(r=e.addExtension("EXT_structural_metadata")),r.schema=Bf(t,n,r.schema);var i=Cf(t,n,r.schema);return r.propertyTables||(r.propertyTables=[]),r.propertyTables.push(i)-1}});function xf(){return(xf=l(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Uf(new zd(t),n);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Uf(e,t){var n,r;if(null!==(n=t.gltf)&&void 0!==n&&n.loadBuffers){var i=e.getExtension("EXT_feature_metadata");i&&(null!==(r=t.gltf)&&void 0!==r&&r.loadImages&&function(e,t){var n=t.schema;if(!n)return;var r=n.classes,i=t.featureTextures;if(r&&i)for(var s in r){var a=r[s],o=Tf(i,s);o&&Sf(e,o,a)}}(e,i),function(e,t){var n=t.schema;if(!n)return;var r=n.classes,i=t.featureTables;if(r&&i)for(var s in r){var a=If(i,s);a&&Pf(e,n,a)}}(e,i))}}function If(e,t){for(var n in e){var r=e[n];if(r.class===t)return r}return null}function Tf(e,t){for(var n in e){var r=e[n];if(r.class===t)return r}return null}function Pf(e,t,n){var r;if(n.class){var i=null===(r=t.classes)||void 0===r?void 0:r[n.class];if(!i)throw new Error("Incorrect data in the EXT_structural_metadata extension: no schema class with name ".concat(n.class));var s=n.count;for(var a in i.properties){var o,A=i.properties[a],c=null===(o=n.properties)||void 0===o?void 0:o[a];if(c){var l=Df(e,t,A,s,c);c.data=l}}}}function Sf(e,t,n){var r=t.class;for(var i in n.properties){var s,a=null==t||null===(s=t.properties)||void 0===s?void 0:s[i];if(a){var o=Qf(e,a,r);a.data=o}}}function Df(e,t,n,r,i){var s,a,o=[],A=i.bufferView,c=e.getTypedArrayForBufferView(A),l=function(e,t,n,r){if("ARRAY"===t.type&&void 0===t.componentCount&&void 0!==n.arrayOffsetBufferView)return qd(e,n.arrayOffsetBufferView,n.offsetType||"UINT32",r);return null}(e,n,i,r),u=function(e,t,n,r){if(void 0!==n.stringOffsetBufferView)return qd(e,n.stringOffsetBufferView,n.offsetType||"UINT32",r);return null}(e,0,i,r);return"STRING"===n.type||"STRING"===n.componentType?o=of(r,c,l,u):((a=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"]).includes((s=n).type)||void 0!==s.componentType&&a.includes(s.componentType))&&(o=function(e,t,n,r){var i="ARRAY"===e.type,s=e.componentCount,a="SCALAR",o=e.componentType||e.type,A=Yd(a,o),c=n.byteLength/A,l=$d(n,a,o,c);if(i)return r?sf(l,t,r,n.length,A):s?af(l,t,s):[];return l}(n,r,c,l)),o}function Qf(e,t,n){var r=e.gltf.json;if(!r.meshes)return[];var i,s=[],a=u(r.meshes);try{for(a.s();!(i=a.n()).done;){var o,A=u(i.value.primitives);try{for(A.s();!(o=A.n()).done;){Rf(e,n,t,s,o.value)}}catch(e){A.e(e)}finally{A.f()}}}catch(e){a.e(e)}finally{a.f()}return s}function Rf(e,t,n,r,i){var s=ef(e,d({channels:n.channels},n.texture),i);s&&tf(e,t,s,r,i)}var Of,Vf,Lf=Object.freeze({__proto__:null,name:"EXT_feature_metadata",decode:function(e,t){return xf.apply(this,arguments)}}),Hf="basis_transcoder.js",Nf="basis_transcoder.wasm",Gf="basis_encoder.js",jf="basis_encoder.wasm";function Wf(e){return zf.apply(this,arguments)}function zf(){return(zf=l(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Il(t.modules),!(n=Tl("basis"))){e.next=4;break}return e.abrupt("return",n);case 4:return Of||(Of=Xf(t)),e.next=7,Of;case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xf(e){return Kf.apply(this,arguments)}function Kf(){return(Kf=l(A().mark((function e(t){var n,r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,r=null,e.t0=Promise,e.next=5,tu(Hf,"textures",t);case 5:return e.t1=e.sent,e.next=8,tu(Nf,"textures",t);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:return i=e.sent,s=k(i,2),n=s[0],r=s[1],n=n||globalThis.BASIS,e.next=19,Zf(n,r);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zf(e,t){var n={};return t&&(n.wasmBinary=t),new Promise((function(t){e(n).then((function(e){var n=e.BasisFile;(0,e.initializeBasis)(),t({BasisFile:n})}))}))}function Jf(e){return Yf.apply(this,arguments)}function Yf(){return(Yf=l(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.modules||{}).basisEncoder){e.next=3;break}return e.abrupt("return",n.basisEncoder);case 3:return Vf=Vf||qf(t),e.next=6,Vf;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qf(e){return $f.apply(this,arguments)}function $f(){return($f=l(A().mark((function e(t){var n,r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,r=null,e.t0=Promise,e.next=5,tu(Gf,"textures",t);case 5:return e.t1=e.sent,e.next=8,tu(jf,"textures",t);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:return i=e.sent,s=k(i,2),n=s[0],r=s[1],n=n||globalThis.BASIS,e.next=19,ep(n,r);case 19:return e.abrupt("return",e.sent);case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ep(e,t){var n={};return t&&(n.wasmBinary=t),new Promise((function(t){e(n).then((function(e){var n=e.BasisFile,r=e.KTX2File,i=e.initializeBasis,s=e.BasisEncoder;i(),t({BasisFile:n,KTX2File:r,BasisEncoder:s})}))}))}var tp=["","WEBKIT_","MOZ_"],np={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},rp=null;function ip(e){if(!rp){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,rp=new Set;var t,n=u(tp);try{for(n.s();!(t=n.n()).done;){var r=t.value;for(var i in np)if(e&&e.getExtension("".concat(r).concat(i))){var s=np[i];rp.add(s)}}}catch(e){n.e(e)}finally{n.f()}}return rp}var sp=[171,75,84,88,32,50,48,187,13,10,26,10];function ap(e){var t=new Uint8Array(e);return!(t.byteLength<sp.length||t[0]!==sp[0]||t[1]!==sp[1]||t[2]!==sp[2]||t[3]!==sp[3]||t[4]!==sp[4]||t[5]!==sp[5]||t[6]!==sp[6]||t[7]!==sp[7]||t[8]!==sp[8]||t[9]!==sp[9]||t[10]!==sp[10]||t[11]!==sp[11])}var op={etc1:{basisFormat:0,compressed:!0,format:36196},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:33776},bc3:{basisFormat:3,compressed:!0,format:33779},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:35840},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:35842},"astc-4x4":{basisFormat:10,compressed:!0,format:37808},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function Ap(){return(Ap=l(A().mark((function e(t,n){var r,i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("auto"!==n.basis.containerFormat){e.next=11;break}if(!ap(t)){e.next=6;break}return e.next=4,Jf(n);case 4:return r=e.sent,e.abrupt("return",up(r.KTX2File,t,n));case 6:return e.next=8,Wf(n);case 8:return i=e.sent,s=i.BasisFile,e.abrupt("return",cp(s,t,n));case 11:e.t0=n.basis.module,e.next="encoder"===e.t0?14:(e.t0,22);break;case 14:return e.next=16,Jf(n);case 16:a=e.sent,e.t1=n.basis.containerFormat,e.next="ktx2"===e.t1?20:(e.t1,21);break;case 20:return e.abrupt("return",up(a.KTX2File,t,n));case 21:return e.abrupt("return",cp(a.BasisFile,t,n));case 22:return e.next=24,Wf(n);case 24:return o=e.sent,c=o.BasisFile,e.abrupt("return",cp(c,t,n));case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cp(e,t,n){var r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("Failed to start basis transcoding");for(var i=r.getNumImages(),s=[],a=0;a<i;a++){for(var o=r.getNumLevels(a),A=[],c=0;c<o;c++)A.push(lp(r,a,c,n));s.push(A)}return s}finally{r.close(),r.delete()}}function lp(e,t,n,r){var i=e.getImageWidth(t,n),s=e.getImageHeight(t,n),a=e.getHasAlpha(),o=dp(r,a),A=o.compressed,c=o.format,l=o.basisFormat,u=e.getImageTranscodedSizeInBytes(t,n,l),h=new Uint8Array(u);if(!e.transcodeImage(h,t,n,l,0,0))throw new Error("failed to start Basis transcoding");return{width:i,height:s,data:h,compressed:A,format:c,hasAlpha:a}}function up(e,t,n){var r=new e(new Uint8Array(t));try{if(!r.startTranscoding())throw new Error("failed to start KTX2 transcoding");for(var i=r.getLevels(),s=[],a=0;a<i;a++)s.push(hp(r,a,n));return[s]}finally{r.close(),r.delete()}}function hp(e,t,n){var r=e.getImageLevelInfo(t,0,0),i=r.alphaFlag,s=r.height,a=r.width,o=dp(n,i),A=o.compressed,c=o.format,l=o.basisFormat,u=e.getImageTranscodedSizeInBytes(t,0,0,l),h=new Uint8Array(u);if(!e.transcodeImage(h,t,0,0,l,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:a,height:s,data:h,compressed:A,levelSize:u,hasAlpha:i,format:c}}function dp(e,t){var n=e&&e.basis&&e.basis.format;return"auto"===n&&(n=fp()),"object"===M(n)&&(n=t?n.alpha:n.noAlpha),n=n.toLowerCase(),op[n]}function fp(){var e=ip();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}var pp=d(d({},{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:"4.3.3",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}}),{},{parse:function(e,t){return Ap.apply(this,arguments)}});function vp(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return"".concat(String.fromCharCode(e.getUint8(t+0))).concat(String.fromCharCode(e.getUint8(t+1))).concat(String.fromCharCode(e.getUint8(t+2))).concat(String.fromCharCode(e.getUint8(t+3)))}function gp(e,t,n){sl(e.header.byteLength>20);var r=t.getUint32(n+0,true),i=t.getUint32(n+4,true);return n+=8,sl(0===i),yp(e,t,n,r),n+=r,n+=_p(e,t,n,e.header.byteLength)}function mp(e,t,n,r){return sl(e.header.byteLength>20),function(e,t,n,r){for(;n+8<=e.header.byteLength;){var i=t.getUint32(n+0,true),s=t.getUint32(n+4,true);switch(n+=8,s){case 1313821514:yp(e,t,n,i);break;case 5130562:_p(e,t,n,i);break;case 0:r.strict||yp(e,t,n,i);break;case 1:r.strict||_p(e,t,n,i)}n+=bu(i,4)}}(e,t,n,r),n+e.header.byteLength}function yp(e,t,n,r){var i=new Uint8Array(t.buffer,n,r),s=new TextDecoder("utf8").decode(i);return e.json=JSON.parse(s),bu(r,4)}function _p(e,t,n,r){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:n,byteLength:r,arrayBuffer:t.buffer}),bu(r,4)}function bp(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;var n=t.baseUri||t.uri;if(!n)throw new Error("'baseUri' must be provided to resolve relative url ".concat(e));return n.substr(0,n.lastIndexOf("/")+1)+e}var wp,Bp="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",Cp="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",Mp=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),kp=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ep={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Fp={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};function xp(e,t,n,r,i){return Up.apply(this,arguments)}function Up(){return Up=l(A().mark((function e(t,n,r,i,s){var a,o,c=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=c.length>5&&void 0!==c[5]?c[5]:"NONE",e.next=3,Ip();case 3:Qp(o=e.sent,o.exports[Fp[s]],t,n,r,i,o.exports[Ep[a||"NONE"]]);case 5:case"end":return e.stop()}}),e)}))),Up.apply(this,arguments)}function Ip(){return Tp.apply(this,arguments)}function Tp(){return(Tp=l(A().mark((function e(){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return wp||(wp=Pp()),e.abrupt("return",wp);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pp(){return Sp.apply(this,arguments)}function Sp(){return(Sp=l(A().mark((function e(){var t,n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Bp,WebAssembly.validate(Mp)&&(t=Cp,console.log("Warning: meshopt_decoder is using experimental SIMD support")),e.next=4,WebAssembly.instantiate(Dp(t),{});case 4:return n=e.sent,e.next=7,n.instance.exports.__wasm_call_ctors();case 7:return e.abrupt("return",n.instance);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dp(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;++n){var r=e.charCodeAt(n);t[n]=r>96?r-71:r>64?r-65:r>47?r+4:r>46?63:62}for(var i=0,s=0;s<e.length;++s)t[i++]=t[s]<60?kp[t[s]]:64*(t[s]-60)+t[++s];return t.buffer.slice(0,i)}function Qp(e,t,n,r,i,s,a){var o=e.exports.sbrk,A=r+3&-4,c=o(A*i),l=o(s.length),u=new Uint8Array(e.exports.memory.buffer);u.set(s,l);var h=t(c,r,i,l,s.length);if(0===h&&a&&a(c,A,i),n.set(u.subarray(c,c+r*i)),o(c-o(0)),0!==h)throw new Error("Malformed buffer data: ".concat(h))}function Rp(){return(Rp=l(A().mark((function e(t,n){var r,i,s,a,o,c,l;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new zd(t),null!=n&&null!==(r=n.gltf)&&void 0!==r&&r.decompressMeshes&&null!==(i=n.gltf)&&void 0!==i&&i.loadBuffers){e.next=3;break}return e.abrupt("return");case 3:a=[],o=u(t.json.bufferViews||[]);try{for(o.s();!(c=o.n()).done;)l=c.value,a.push(Op(s,l))}catch(e){o.e(e)}finally{o.f()}return e.next=8,Promise.all(a);case 8:s.removeExtension("EXT_meshopt_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Op(e,t){return Vp.apply(this,arguments)}function Vp(){return(Vp=l(A().mark((function e(t,n){var r,i,s,a,o,c,l,u,h,d,f,p,v,g;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=t.getObjectExtension(n,"EXT_meshopt_compression"))){e.next=9;break}return i=r.byteOffset,s=void 0===i?0:i,a=r.byteLength,o=void 0===a?0:a,c=r.byteStride,l=r.count,u=r.mode,h=r.filter,d=void 0===h?"NONE":h,f=r.buffer,p=t.gltf.buffers[f],v=new Uint8Array(p.arrayBuffer,p.byteOffset+s,o),g=new Uint8Array(t.gltf.buffers[n.buffer].arrayBuffer,n.byteOffset,n.byteLength),e.next=8,xp(g,l,c,v,u,d);case 8:t.removeObjectExtension(n,"EXT_meshopt_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Lp=Object.freeze({__proto__:null,name:"EXT_meshopt_compression",decode:function(e,t){return Rp.apply(this,arguments)}});var Hp=Object.freeze({__proto__:null,name:"EXT_texture_webp",preprocess:function(e,t){var n=new zd(e);if(Td("image/webp")){var r,i=u(n.json.textures||[]);try{for(i.s();!(r=i.n()).done;){var s=r.value,a=n.getObjectExtension(s,"EXT_texture_webp");a&&(s.source=a.source),n.removeObjectExtension(s,"EXT_texture_webp")}}catch(e){i.e(e)}finally{i.f()}n.removeExtension("EXT_texture_webp")}else if(n.getRequiredExtensions().includes("EXT_texture_webp"))throw new Error("gltf: Required extension ".concat("EXT_texture_webp"," not supported by browser"))}});var Np=Object.freeze({__proto__:null,name:"KHR_texture_basisu",preprocess:function(e,t){var n,r=new zd(e),i=u(r.json.textures||[]);try{for(i.s();!(n=i.n()).done;){var s=n.value,a=r.getObjectExtension(s,"KHR_texture_basisu");a&&(s.source=a.source,r.removeObjectExtension(s,"KHR_texture_basisu"))}}catch(e){i.e(e)}finally{i.f()}r.removeExtension("KHR_texture_basisu")}}),Gp={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.3",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"===("undefined"==typeof WebAssembly?"undefined":M(WebAssembly))?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function jp(e,t,n){var r=zp(t.metadata),i=[],s=function(e){var t={};for(var n in e){var r=e[n];t[r.name||"undefined"]=r}return t}(t.attributes);for(var a in e){var o=Wp(a,e[a],s[a]);i.push(o)}if(n){var A=Wp("indices",n);i.push(A)}return{fields:i,metadata:r}}function Wp(e,t,n){return Yh(e,t,n?zp(n.metadata):void 0)}function zp(e){var t={};for(var n in e)t["".concat(n,".string")]=JSON.stringify(e[n]);return t}var Xp={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},Kp={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array},Zp=function(){function e(t){x(this,e),f(this,"draco",void 0),f(this,"decoder",void 0),f(this,"metadataQuerier",void 0),this.draco=t,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}return I(e,[{key:"destroy",value:function(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}},{key:"parseSync",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new this.draco.DecoderBuffer;n.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);var r=this.decoder.GetEncodedGeometryType(n),i=r===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{var s;switch(r){case this.draco.TRIANGULAR_MESH:s=this.decoder.DecodeBufferToMesh(n,i);break;case this.draco.POINT_CLOUD:s=this.decoder.DecodeBufferToPointCloud(n,i);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!s.ok()||!i.ptr){var a="DRACO decompression failed: ".concat(s.error_msg());throw new Error(a)}var o=this._getDracoLoaderData(i,r,t),A=this._getMeshData(i,o,t),c=Jh(A.attributes),l=jp(A.attributes,o,A.indices),u=d(d({loader:"draco",loaderData:o,header:{vertexCount:i.num_points(),boundingBox:c}},A),{},{schema:l});return u}finally{this.draco.destroy(n),i&&this.draco.destroy(i)}}},{key:"_getDracoLoaderData",value:function(e,t,n){var r=this._getTopLevelMetadata(e),i=this._getDracoAttributes(e,n);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:r,attributes:i}}},{key:"_getDracoAttributes",value:function(e,t){for(var n={},r=0;r<e.num_attributes();r++){var i=this.decoder.GetAttribute(e,r),s=this._getAttributeMetadata(e,r);n[i.unique_id()]={unique_id:i.unique_id(),attribute_type:i.attribute_type(),data_type:i.data_type(),num_components:i.num_components(),byte_offset:i.byte_offset(),byte_stride:i.byte_stride(),normalized:i.normalized(),attribute_index:r,metadata:s};var a=this._getQuantizationTransform(i,t);a&&(n[i.unique_id()].quantization_transform=a);var o=this._getOctahedronTransform(i,t);o&&(n[i.unique_id()].octahedron_transform=o)}return n}},{key:"_getMeshData",value:function(e,t,n){var r=this._getMeshAttributes(t,e,n);if(!r.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===n.topology?{topology:"triangle-strip",mode:4,attributes:r,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:r,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:r}}},{key:"_getMeshAttributes",value:function(e,t,n){for(var r={},i=0,s=Object.values(e.attributes);i<s.length;i++){var a=s[i],o=this._deduceAttributeName(a,n);a.name=o;var A=this._getAttributeValues(t,a);if(A){var c=A.value,l=A.size;r[o]={value:c,size:l,byteOffset:a.byte_offset,byteStride:a.byte_stride,normalized:a.normalized}}}return r}},{key:"_getTriangleListIndices",value:function(e){var t=3*e.num_faces(),n=4*t,r=this.draco._malloc(n);try{return this.decoder.GetTrianglesUInt32Array(e,n,r),new Uint32Array(this.draco.HEAPF32.buffer,r,t).slice()}finally{this.draco._free(r)}}},{key:"_getTriangleStripIndices",value:function(e){var t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){for(var t=e.size(),n=new Int32Array(t),r=0;r<t;r++)n[r]=e.GetValue(r);return n}(t)}finally{this.draco.destroy(t)}}},{key:"_getAttributeValues",value:function(e,t){var n=Kp[t.data_type];if(!n)return console.warn("DRACO: Unsupported attribute type ".concat(t.data_type)),null;var r,i=t.num_components,s=e.num_points()*i,a=s*n.BYTES_PER_ELEMENT,o=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,n),A=this.draco._malloc(a);try{var c=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,c,o,a,A),r=new n(this.draco.HEAPF32.buffer,A,s).slice()}finally{this.draco._free(A)}return{value:r,size:i}}},{key:"_deduceAttributeName",value:function(e,t){for(var n=e.unique_id,r=0,i=Object.entries(t.extraAttributes||{});r<i.length;r++){var s=k(i[r],2),a=s[0];if(s[1]===n)return a}var o=e.attribute_type;for(var A in Xp){if(this.draco[A]===o)return Xp[A]}var c=t.attributeNameEntry||"name";return e.metadata[c]?e.metadata[c].string:"CUSTOM_ATTRIBUTE_".concat(n)}},{key:"_getTopLevelMetadata",value:function(e){var t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}},{key:"_getAttributeMetadata",value:function(e,t){var n=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(n)}},{key:"_getDracoMetadata",value:function(e){if(!e||!e.ptr)return{};for(var t={},n=this.metadataQuerier.NumEntries(e),r=0;r<n;r++){var i=this.metadataQuerier.GetEntryName(e,r);t[i]=this._getDracoMetadataField(e,i)}return t}},{key:"_getDracoMetadataField",value:function(e,t){var n=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,n);var r=function(e){for(var t=e.size(),n=new Int32Array(t),r=0;r<t;r++)n[r]=e.GetValue(r);return n}(n);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:r}}finally{this.draco.destroy(n)}}},{key:"_disableAttributeTransforms",value:function(e){var t,n=e.quantizedAttributes,r=void 0===n?[]:n,i=e.octahedronAttributes,s=void 0===i?[]:i,a=u([].concat(p(r),p(s)));try{for(a.s();!(t=a.n()).done;){var o=t.value;this.decoder.SkipAttributeTransform(this.draco[o])}}catch(e){a.e(e)}finally{a.f()}}},{key:"_getQuantizationTransform",value:function(e,t){var n=this,r=t.quantizedAttributes,i=void 0===r?[]:r,s=e.attribute_type();if(i.map((function(e){return n.decoder[e]})).includes(s)){var a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits(),range:a.range(),min_values:new Float32Array([1,2,3]).map((function(e){return a.min_value(e)}))}}finally{this.draco.destroy(a)}}return null}},{key:"_getOctahedronTransform",value:function(e,t){var n=this,r=t.octahedronAttributes,i=void 0===r?[]:r,s=e.attribute_type();if(i.map((function(e){return n.decoder[e]})).includes(s)){var a=new this.draco.AttributeQuantizationTransform;try{if(a.InitFromAttribute(e))return{quantization_bits:a.quantization_bits()}}finally{this.draco.destroy(a)}}return null}}]),e}();var Jp,Yp="https://www.gstatic.com/draco/versioned/decoders/".concat("1.5.6"),qp="draco_wasm_wrapper.js",$p="draco_decoder.wasm",ev="draco_decoder.js",tv="draco_encoder.js",nv=(f(t={},qp,"".concat(Yp,"/").concat(qp)),f(t,$p,"".concat(Yp,"/").concat($p)),f(t,ev,"".concat(Yp,"/").concat(ev)),f(t,tv,"https://raw.githubusercontent.com/google/draco/".concat("1.4.1","/javascript/").concat(tv)),t);function rv(e){return iv.apply(this,arguments)}function iv(){return(iv=l(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=t.modules||{}).draco3d?Jp||(Jp=n.draco3d.createDecoderModule({}).then((function(e){return{draco:e}}))):Jp||(Jp=sv(t)),e.next=4,Jp;case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sv(e){return av.apply(this,arguments)}function av(){return(av=l(A().mark((function e(t){var n,r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.draco&&t.draco.decoderType,e.next="js"===e.t0?3:(e.t0,7);break;case 3:return e.next=5,tu(nv[ev],"draco",t,ev);case 5:return n=e.sent,e.abrupt("break",21);case 7:return e.t1=Promise,e.next=10,tu(nv[qp],"draco",t,qp);case 10:return e.t2=e.sent,e.next=13,tu(nv[$p],"draco",t,$p);case 13:return e.t3=e.sent,e.t4=[e.t2,e.t3],e.next=17,e.t1.all.call(e.t1,e.t4);case 17:i=e.sent,s=k(i,2),n=s[0],r=s[1];case 21:return n=n||globalThis.DracoDecoderModule,e.next=24,ov(n,r);case 24:return e.abrupt("return",e.sent);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ov(e,t){var n={};return t&&(n.wasmBinary=t),new Promise((function(t){e(d(d({},n),{},{onModuleLoaded:function(e){return t({draco:e})}}))}))}var Av=d(d({},Gp),{},{parse:function(e,t){return cv.apply(this,arguments)}});function cv(){return(cv=l(A().mark((function e(t,n){var r,i,s;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,rv(n);case 2:return r=e.sent,i=r.draco,s=new Zp(i),e.prev=5,e.abrupt("return",s.parseSync(t,null==n?void 0:n.draco));case 7:return e.prev=7,s.destroy(),e.finish(7);case 10:case"end":return e.stop()}}),e,null,[[5,,7,10]])})))).apply(this,arguments)}function lv(e){var t={};for(var n in e){var r=e[n];if("indices"!==n){var i=uv(r);t[n]=i}}return t}function uv(e){var t=function(e){var t=e,n=1,r=0;e&&e.value&&(t=e.value,n=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e)return null;if(Array.isArray(e))return new t(e);if(n&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),r=t.length/n);return{buffer:t,size:n,count:r}}(e),n=t.buffer,r=t.size;return{value:n,size:r,byteOffset:0,count:t.count,type:Nd(r),componentType:Gd(n)}}function hv(){return(hv=l(A().mark((function e(t,n,r){var i,s,a,o,c,l;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=n&&null!==(i=n.gltf)&&void 0!==i&&i.decompressMeshes){e.next=2;break}return e.abrupt("return");case 2:s=new zd(t),a=[],o=u(gv(s));try{for(o.s();!(c=o.n()).done;)l=c.value,s.getObjectExtension(l,"KHR_draco_mesh_compression")&&a.push(dv(s,l,n,r))}catch(e){o.e(e)}finally{o.f()}return e.next=8,Promise.all(a);case 8:s.removeExtension("KHR_draco_mesh_compression");case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dv(e,t,n,r){return fv.apply(this,arguments)}function fv(){return(fv=l(A().mark((function e(t,n,r,i){var s,a,o,c,l,u,h,f,p,v,g,m,y;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=t.getObjectExtension(n,"KHR_draco_mesh_compression")){e.next=3;break}return e.abrupt("return");case 3:return a=t.getTypedArrayForBufferView(s.bufferView),o=_u(a.buffer,a.byteOffset),delete(c=d({},r))["3d-tiles"],e.next=9,rl(o,Av,c,i);case 9:for(l=e.sent,u=lv(l.attributes),h=0,f=Object.entries(u);h<f.length;h++)p=k(f[h],2),v=p[0],g=p[1],v in n.attributes&&(m=n.attributes[v],null!=(y=t.getAccessor(m))&&y.min&&null!=y&&y.max&&(g.min=y.min,g.max=y.max));n.attributes=u,l.indices&&(n.indices=uv(l.indices)),t.removeObjectExtension(n,"KHR_draco_mesh_compression"),vv(n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pv(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0;if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");var a=i.DracoWriter.encodeSync({attributes:e}),o=null==s||null===(n=s.parseSync)||void 0===n?void 0:n.call(s,{attributes:e}),A=i._addFauxAttributes(o.attributes),c=i.addBufferView(a),l={primitives:[{attributes:A,mode:r,extensions:f({},"KHR_draco_mesh_compression",{bufferView:c,attributes:A})}]};return l}function vv(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}function gv(e){var t,n,r,i,a,o;return A().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:t=u(e.json.meshes||[]),s.prev=1,t.s();case 3:if((n=t.n()).done){s.next=24;break}r=n.value,i=u(r.primitives),s.prev=6,i.s();case 8:if((a=i.n()).done){s.next=14;break}return o=a.value,s.next=12,o;case 12:s.next=8;break;case 14:s.next=19;break;case 16:s.prev=16,s.t0=s.catch(6),i.e(s.t0);case 19:return s.prev=19,i.f(),s.finish(19);case 22:s.next=3;break;case 24:s.next=29;break;case 26:s.prev=26,s.t1=s.catch(1),t.e(s.t1);case 29:return s.prev=29,t.f(),s.finish(29);case 32:case"end":return s.stop()}}),s,null,[[1,26,29,32],[6,16,19,22]])}var mv=Object.freeze({__proto__:null,name:"KHR_draco_mesh_compression",preprocess:function(e,t,n){var r,i=new zd(e),s=u(gv(i));try{for(s.s();!(r=s.n()).done;){var a=r.value;i.getObjectExtension(a,"KHR_draco_mesh_compression")}}catch(e){s.e(e)}finally{s.f()}},decode:function(e,t,n){return hv.apply(this,arguments)},encode:function(e){var t,n=new zd(e),r=u(n.json.meshes||[]);try{for(r.s();!(t=r.n()).done;){var i=t.value;pv(i),n.addRequiredExtension("KHR_draco_mesh_compression")}}catch(e){r.e(e)}finally{r.f()}}});globalThis.mathgl=globalThis.mathgl||{config:d({},{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1})};var yv=globalThis.mathgl.config;function _v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.precision,r=void 0===n?yv.precision:n;return e=Bv(e),"".concat(parseFloat(e.toPrecision(r)))}function bv(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function wv(e,t,n){var r=yv.EPSILON;n&&(yv.EPSILON=n);try{if(e===t)return!0;if(bv(e)&&bv(t)){if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!wv(e[i],t[i]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=yv.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{yv.EPSILON=r}}function Bv(e){return Math.round(e/yv.EPSILON)*yv.EPSILON}var Cv=function(e){m(n,a(Array));var t=_(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)this[n]=e[n+t];return this.check()}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<this.ELEMENTS;++n)e[t+n]=this[n];return e}},{key:"toObject",value:function(e){return e}},{key:"from",value:function(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}},{key:"to",value:function(e){return e===this?this:bv(e)?this.toArray(e):this.toObject(e)}},{key:"toTarget",value:function(e){return e?this.to(e):this}},{key:"toFloat32Array",value:function(){return new Float32Array(this)}},{key:"toString",value:function(){return this.formatString(yv)}},{key:"formatString",value:function(e){for(var t="",n=0;n<this.ELEMENTS;++n)t+=(n>0?", ":"")+_v(this[n],e);return"".concat(e.printTypes?this.constructor.name:"","[").concat(t,"]")}},{key:"equals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(!wv(this[t],e[t]))return!1;return!0}},{key:"exactEquals",value:function(e){if(!e||this.length!==e.length)return!1;for(var t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}},{key:"negate",value:function(){for(var e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}},{key:"lerp",value:function(e,t,n){if(void 0===n)return this.lerp(this,e,t);for(var r=0;r<this.ELEMENTS;++r){var i=e[r],s="number"==typeof t?t:t[r];this[r]=i+n*(s-i)}return this.check()}},{key:"min",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}},{key:"max",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}},{key:"clamp",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e[n]),t[n]);return this.check()}},{key:"add",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]+=s[a];return this.check()}},{key:"subtract",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]-=s[a];return this.check()}},{key:"scale",value:function(e){if("number"==typeof e)for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(var n=0;n<this.ELEMENTS&&n<e.length;++n)this[n]*=e[n];return this.check()}},{key:"multiplyByScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"check",value:function(){if(yv.debug&&!this.validate())throw new Error("math.gl: ".concat(this.constructor.name," some fields set to invalid numbers'"));return this}},{key:"validate",value:function(){for(var e=this.length===this.ELEMENTS,t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}},{key:"sub",value:function(e){return this.subtract(e)}},{key:"setScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}},{key:"addScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}},{key:"subScalar",value:function(e){return this.addScalar(-e)}},{key:"multiplyScalar",value:function(e){for(var t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}},{key:"divideScalar",value:function(e){return this.multiplyByScalar(1/e)}},{key:"clampScalar",value:function(e,t){for(var n=0;n<this.ELEMENTS;++n)this[n]=Math.min(Math.max(this[n],e),t);return this.check()}},{key:"elements",get:function(){return this}}]),n}();function Mv(e,t){if(e.length!==t)return!1;for(var n=0;n<e.length;++n)if(!Number.isFinite(e[n]))return!1;return!0}function kv(e){if(!Number.isFinite(e))throw new Error("Invalid number ".concat(JSON.stringify(e)));return e}function Ev(e,t){if(!e)throw new Error("math.gl assertion ".concat(t))}var Fv=function(e){m(n,Cv);var t=_(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"x",get:function(){return this[0]},set:function(e){this[0]=kv(e)}},{key:"y",get:function(){return this[1]},set:function(e){this[1]=kv(e)}},{key:"len",value:function(){return Math.sqrt(this.lengthSquared())}},{key:"magnitude",value:function(){return this.len()}},{key:"lengthSquared",value:function(){for(var e=0,t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}},{key:"magnitudeSquared",value:function(){return this.lengthSquared()}},{key:"distance",value:function(e){return Math.sqrt(this.distanceSquared(e))}},{key:"distanceSquared",value:function(e){for(var t=0,n=0;n<this.ELEMENTS;++n){var r=this[n]-e[n];t+=r*r}return kv(t)}},{key:"dot",value:function(e){for(var t=0,n=0;n<this.ELEMENTS;++n)t+=this[n]*e[n];return kv(t)}},{key:"normalize",value:function(){var e=this.magnitude();if(0!==e)for(var t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}},{key:"multiply",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]*=s[a];return this.check()}},{key:"divide",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0,i=t;r<i.length;r++)for(var s=i[r],a=0;a<this.ELEMENTS;++a)this[a]/=s[a];return this.check()}},{key:"lengthSq",value:function(){return this.lengthSquared()}},{key:"distanceTo",value:function(e){return this.distance(e)}},{key:"distanceToSquared",value:function(e){return this.distanceSquared(e)}},{key:"getComponent",value:function(e){return Ev(e>=0&&e<this.ELEMENTS,"index is out of range"),kv(this[e])}},{key:"setComponent",value:function(e,t){return Ev(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}},{key:"addVectors",value:function(e,t){return this.copy(e).add(t)}},{key:"subVectors",value:function(e,t){return this.copy(e).subtract(t)}},{key:"multiplyVectors",value:function(e,t){return this.copy(e).multiply(t)}},{key:"addScaledVector",value:function(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}]),n}(),xv="undefined"!=typeof Float32Array?Float32Array:Array;function Uv(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=r*n[0]+i*n[3]+s*n[6],e[1]=r*n[1]+i*n[4]+s*n[7],e[2]=r*n[2]+i*n[5]+s*n[8],e}!function(){var e,t=(e=new xv(2),xv!=Float32Array&&(e[0]=0,e[1]=0),e)}(),function(){var e,t=(e=new xv(3),xv!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e)}();var Iv,Tv,Pv=[0,0,0],Sv=function(e){m(n,Fv);var t=_(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return x(this,n),e=t.call(this,-0,-0,-0),1===arguments.length&&bv(r)?e.copy(r):(yv.debug&&(kv(r),kv(i),kv(s)),e[0]=r,e[1]=i,e[2]=s),e}return I(n,[{key:"set",value:function(e,t,n){return this[0]=e,this[1]=t,this[2]=n,this.check()}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}},{key:"fromObject",value:function(e){return yv.debug&&(kv(e.x),kv(e.y),kv(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}},{key:"toObject",value:function(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}},{key:"ELEMENTS",get:function(){return 3}},{key:"z",get:function(){return this[2]},set:function(e){this[2]=kv(e)}},{key:"angle",value:function(e){return function(e,t){var n=e[0],r=e[1],i=e[2],s=t[0],a=t[1],o=t[2],A=Math.sqrt((n*n+r*r+i*i)*(s*s+a*a+o*o)),c=A&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/A;return Math.acos(Math.min(Math.max(c,-1),1))}(this,e)}},{key:"cross",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[0],o=n[1],A=n[2];e[0]=i*A-s*o,e[1]=s*a-r*A,e[2]=r*o-i*a}(this,this,e),this.check()}},{key:"rotateX",value:function(e){var t=e.radians,n=e.origin;return function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0],s[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),s[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,void 0===n?Pv:n,t),this.check()}},{key:"rotateY",value:function(e){var t=e.radians,n=e.origin;return function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),s[1]=i[1],s[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,void 0===n?Pv:n,t),this.check()}},{key:"rotateZ",value:function(e){var t=e.radians,n=e.origin;return function(e,t,n,r){var i=[],s=[];i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],s[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),s[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),s[2]=i[2],e[0]=s[0]+n[0],e[1]=s[1]+n[1],e[2]=s[2]+n[2]}(this,this,void 0===n?Pv:n,t),this.check()}},{key:"transform",value:function(e){return this.transformAsPoint(e)}},{key:"transformAsPoint",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[3]*r+n[7]*i+n[11]*s+n[15];a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/a}(this,this,e),this.check()}},{key:"transformAsVector",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2],a=n[3]*r+n[7]*i+n[11]*s||1;e[0]=(n[0]*r+n[4]*i+n[8]*s)/a,e[1]=(n[1]*r+n[5]*i+n[9]*s)/a,e[2]=(n[2]*r+n[6]*i+n[10]*s)/a}(this,this,e),this.check()}},{key:"transformByMatrix3",value:function(e){return Uv(this,this,e),this.check()}},{key:"transformByMatrix2",value:function(e){return function(e,t,n){var r=t[0],i=t[1];e[0]=n[0]*r+n[2]*i,e[1]=n[1]*r+n[3]*i,e[2]=t[2]}(this,this,e),this.check()}},{key:"transformByQuaternion",value:function(e){return function(e,t,n){var r=n[0],i=n[1],s=n[2],a=n[3],o=t[0],A=t[1],c=t[2],l=i*c-s*A,u=s*o-r*c,h=r*A-i*o,d=i*h-s*u,f=s*l-r*h,p=r*u-i*l,v=2*a;l*=v,u*=v,h*=v,d*=2,f*=2,p*=2,e[0]=o+l+d,e[1]=A+u+f,e[2]=c+h+p}(this,this,e),this.check()}}],[{key:"ZERO",get:function(){return Iv||(Iv=new n(0,0,0),Object.freeze(Iv)),Iv}}]),n}(),Dv=function(e){m(n,Cv);var t=_(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"toString",value:function(){var e="[";if(yv.printRowMajor){e+="row-major:";for(var t=0;t<this.RANK;++t)for(var n=0;n<this.RANK;++n)e+=" ".concat(this[n*this.RANK+t])}else{e+="column-major:";for(var r=0;r<this.ELEMENTS;++r)e+=" ".concat(this[r])}return e+="]"}},{key:"getElementIndex",value:function(e,t){return t*this.RANK+e}},{key:"getElement",value:function(e,t){return this[t*this.RANK+e]}},{key:"setElement",value:function(e,t,n){return this[t*this.RANK+e]=kv(n),this}},{key:"getColumn",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Array(this.RANK).fill(-0),n=e*this.RANK,r=0;r<this.RANK;++r)t[r]=this[n+r];return t}},{key:"setColumn",value:function(e,t){for(var n=e*this.RANK,r=0;r<this.RANK;++r)this[n+r]=t[r];return this}}]),n}();function Qv(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],c=t[6],l=t[7],u=t[8],h=n[0],d=n[1],f=n[2],p=n[3],v=n[4],g=n[5],m=n[6],y=n[7],_=n[8];return e[0]=h*r+d*a+f*c,e[1]=h*i+d*o+f*l,e[2]=h*s+d*A+f*u,e[3]=p*r+v*a+g*c,e[4]=p*i+v*o+g*l,e[5]=p*s+v*A+g*u,e[6]=m*r+y*a+_*c,e[7]=m*i+y*o+_*l,e[8]=m*s+y*A+_*u,e}function Rv(e,t,n){var r=n[0],i=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=i*t[3],e[4]=i*t[4],e[5]=i*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(Tv||(Tv={}));var Ov,Vv=Object.freeze([1,0,0,0,1,0,0,0,1]),Lv=function(e){m(n,Dv);var t=_(n);function n(e){for(var r,i=arguments.length,s=new Array(i>1?i-1:0),a=1;a<i;a++)s[a-1]=arguments[a];return x(this,n),r=t.call(this,-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?r.copy(e):s.length>0?r.copy([e].concat(s)):r.identity(),r}return I(n,[{key:"ELEMENTS",get:function(){return 9}},{key:"RANK",get:function(){return 3}},{key:"INDICES",get:function(){return Tv}},{key:"copy",value:function(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}},{key:"identity",value:function(){return this.copy(Vv)}},{key:"fromObject",value:function(e){return this.check()}},{key:"fromQuaternion",value:function(e){return function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=n+n,o=r+r,A=i+i,c=n*a,l=r*a,u=r*o,h=i*a,d=i*o,f=i*A,p=s*a,v=s*o,g=s*A;e[0]=1-u-f,e[3]=l-g,e[6]=h+v,e[1]=l+g,e[4]=1-c-f,e[7]=d-p,e[2]=h-v,e[5]=d+p,e[8]=1-c-u}(this,e),this.check()}},{key:"set",value:function(e,t,n,r,i,s,a,o,A){return this[0]=e,this[1]=t,this[2]=n,this[3]=r,this[4]=i,this[5]=s,this[6]=a,this[7]=o,this[8]=A,this.check()}},{key:"setRowMajor",value:function(e,t,n,r,i,s,a,o,A){return this[0]=e,this[1]=r,this[2]=a,this[3]=t,this[4]=i,this[5]=o,this[6]=n,this[7]=s,this[8]=A,this.check()}},{key:"determinant",value:function(){return function(e){var t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],a=e[5],o=e[6],A=e[7],c=e[8];return t*(c*s-a*A)+n*(-c*i+a*o)+r*(A*i-s*o)}(this)}},{key:"transpose",value:function(){return function(e,t){if(e===t){var n=t[1],r=t[2],i=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=i}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}},{key:"invert",value:function(){return function(e,t){var n=t[0],r=t[1],i=t[2],s=t[3],a=t[4],o=t[5],A=t[6],c=t[7],l=t[8],u=l*a-o*c,h=-l*s+o*A,d=c*s-a*A,f=n*u+r*h+i*d;f&&(f=1/f,e[0]=u*f,e[1]=(-l*r+i*c)*f,e[2]=(o*r-i*a)*f,e[3]=h*f,e[4]=(l*n-i*A)*f,e[5]=(-o*n+i*s)*f,e[6]=d*f,e[7]=(-c*n+r*A)*f,e[8]=(a*n-r*s)*f)}(this,this),this.check()}},{key:"multiplyLeft",value:function(e){return Qv(this,e,this),this.check()}},{key:"multiplyRight",value:function(e){return Qv(this,this,e),this.check()}},{key:"rotate",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],c=t[6],l=t[7],u=t[8],h=Math.sin(n),d=Math.cos(n);e[0]=d*r+h*a,e[1]=d*i+h*o,e[2]=d*s+h*A,e[3]=d*a-h*r,e[4]=d*o-h*i,e[5]=d*A-h*s,e[6]=c,e[7]=l,e[8]=u}(this,this,e),this.check()}},{key:"scale",value:function(e){return Array.isArray(e)?Rv(this,this,e):Rv(this,this,[e,e]),this.check()}},{key:"translate",value:function(e){return function(e,t,n){var r=t[0],i=t[1],s=t[2],a=t[3],o=t[4],A=t[5],c=t[6],l=t[7],u=t[8],h=n[0],d=n[1];e[0]=r,e[1]=i,e[2]=s,e[3]=a,e[4]=o,e[5]=A,e[6]=h*r+d*a+c,e[7]=h*i+d*o+l,e[8]=h*s+d*A+u}(this,this,e),this.check()}},{key:"transform",value:function(e,t){var n;switch(e.length){case 2:n=function(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[3]*i+n[6],e[1]=n[1]*r+n[4]*i+n[7],e}(t||[-0,-0],e,this);break;case 3:n=Uv(t||[-0,-0,-0],e,this);break;case 4:n=function(e,t,n){var r=t[0],i=t[1],s=t[2];return e[0]=n[0]*r+n[3]*i+n[6]*s,e[1]=n[1]*r+n[4]*i+n[7]*s,e[2]=n[2]*r+n[5]*i+n[8]*s,e[3]=t[3],e}(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(yv.debug&&!Mv(e,t))throw new Error("math.gl: ".concat(n," some fields set to invalid numbers'"))}(n,e.length),n}},{key:"transformVector",value:function(e,t){return this.transform(e,t)}},{key:"transformVector2",value:function(e,t){return this.transform(e,t)}},{key:"transformVector3",value:function(e,t){return this.transform(e,t)}}],[{key:"IDENTITY",get:function(){return Gv()}},{key:"ZERO",get:function(){return Nv()}}]),n}(),Hv=null;function Nv(){return Ov||(Ov=new Lv([0,0,0,0,0,0,0,0,0]),Object.freeze(Ov)),Ov}function Gv(){return Hv||(Hv=new Lv,Object.freeze(Hv)),Hv}var jv=new Sv,Wv=new Lv,zv=new Lv;function Xv(){return(Xv=l(A().mark((function e(t,n){var r,i,s,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=new zd(t),i.hasExtension("KHR_texture_transform")&&null!==(r=n.gltf)&&void 0!==r&&r.loadBuffers){e.next=4;break}return e.abrupt("return");case 4:for(s=t.json.materials||[],a=0;a<s.length;a++)Kv(a,t);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kv(e,t){for(var n,r,i,s=null===(n=t.json.materials)||void 0===n?void 0:n[e],a=[],o=0,A=[null==s||null===(r=s.pbrMetallicRoughness)||void 0===r?void 0:r.baseColorTexture,null==s?void 0:s.emissiveTexture,null==s?void 0:s.normalTexture,null==s?void 0:s.occlusionTexture,null==s||null===(i=s.pbrMetallicRoughness)||void 0===i?void 0:i.metallicRoughnessTexture];o<A.length;o++){var c,l=A[o];l&&null!=l&&null!==(c=l.extensions)&&void 0!==c&&c.KHR_texture_transform&&Zv(t,e,l,a)}}function Zv(e,t,n,r){var i=function(e,t){var n,r=null===(n=e.extensions)||void 0===n?void 0:n.KHR_texture_transform,i=e.texCoord,s=void 0===i?0:i,a=r.texCoord,o=void 0===a?s:a;if(-1===t.findIndex((function(e){var t=k(e,2),n=t[0],r=t[1];return n===s&&r===o}))){var A=function(e){var t=e.offset,n=void 0===t?[0,0]:t,r=e.rotation,i=void 0===r?0:r,s=e.scale,a=void 0===s?[1,1]:s,o=(new Lv).set(1,0,0,0,1,0,n[0],n[1],1),A=Wv.set(Math.cos(i),Math.sin(i),0,-Math.sin(i),Math.cos(i),0,0,0,1),c=zv.set(a[0],0,0,0,a[1],0,0,0,1);return o.multiplyRight(A).multiplyRight(c)}(r);return s!==o&&(e.texCoord=o),t.push([s,o]),{originalTexCoord:s,texCoord:o,matrix:A}}return null}(n,r);if(i){var s,a=u(e.json.meshes||[]);try{for(a.s();!(s=a.n()).done;){var o,A=u(s.value.primitives);try{for(A.s();!(o=A.n()).done;){var c=o.value,l=c.material;Number.isFinite(l)&&t===l&&Jv(e,c,i)}}catch(e){A.e(e)}finally{A.f()}}}catch(e){a.e(e)}finally{a.f()}}}function Jv(e,t,n){var r=n.originalTexCoord,i=n.texCoord,s=n.matrix,a=t.attributes["TEXCOORD_".concat(r)];if(Number.isFinite(a)){var o,A=null===(o=e.json.accessors)||void 0===o?void 0:o[a];if(A&&A.bufferView){var c,l=null===(c=e.json.bufferViews)||void 0===c?void 0:c[A.bufferView];if(l){for(var u=e.buffers[l.buffer],h=u.arrayBuffer,d=(u.byteOffset||0)+(A.byteOffset||0)+(l.byteOffset||0),f=jd(A,l),p=f.ArrayType,v=f.length,g=Dd[A.componentType],m=Sd[A.type],y=l.byteStride||g*m,_=new Float32Array(v),b=0;b<A.count;b++){var w=new p(h,d+b*y,2);jv.set(w[0],w[1],1),jv.transformByMatrix3(s),_.set([jv[0],jv[1]],b*m)}r===i?function(e,t,n,r){e.componentType=5126,n.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength}),t.buffer=n.length-1,t.byteLength=r.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(A,l,e.buffers,_):function(e,t,n,r,i){r.buffers.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength});var s=r.json.bufferViews;if(!s)return;s.push({buffer:r.buffers.length-1,byteLength:i.buffer.byteLength,byteOffset:0});var a=r.json.accessors;if(!a)return;a.push({bufferView:(null==s?void 0:s.length)-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),n.attributes["TEXCOORD_".concat(e)]=a.length-1}(i,A,t,e,_)}}}}var Yv=Object.freeze({__proto__:null,name:"KHR_texture_transform",decode:function(e,t){return Xv.apply(this,arguments)}});function qv(){return(qv=l(A().mark((function e(t){var n,r,i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new zd(t),r=n.json,(i=n.getExtension("KHR_lights_punctual"))&&(n.json.lights=i.lights,n.removeExtension("KHR_lights_punctual")),s=u(r.nodes||[]);try{for(s.s();!(a=s.n()).done;)o=a.value,(c=n.getObjectExtension(o,"KHR_lights_punctual"))&&(o.light=c.light),n.removeObjectExtension(o,"KHR_lights_punctual")}catch(e){s.e(e)}finally{s.f()}case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $v(){return($v=l(A().mark((function e(t){var n,r,i,s,a,o,c;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new zd(t),(r=n.json).lights&&(Pd(!(i=n.addExtension("KHR_lights_punctual")).lights),i.lights=r.lights,delete r.lights),n.json.lights){s=u(n.json.lights);try{for(s.s();!(a=s.n()).done;)o=a.value,c=o.node,n.addObjectExtension(c,"KHR_lights_punctual",o)}catch(e){s.e(e)}finally{s.f()}delete n.json.lights}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function eg(){return(eg=l(A().mark((function e(t){var n,r,i,s,a;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=new zd(t),r=n.json,i=u(r.materials||[]);try{for(i.s();!(s=i.n()).done;)a=s.value,a.extensions&&a.extensions.KHR_materials_unlit&&(a.unlit=!0),n.removeObjectExtension(a,"KHR_materials_unlit")}catch(e){i.e(e)}finally{i.f()}n.removeExtension("KHR_materials_unlit");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tg(){return(tg=l(A().mark((function e(t){var n,r,i,s,a,o,c,l;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=new zd(t),r=n.json,i=n.getExtension("KHR_techniques_webgl")){s=rg(i,n),a=u(r.materials||[]);try{for(a.s();!(o=a.n()).done;)c=o.value,(l=n.getObjectExtension(c,"KHR_techniques_webgl"))&&(c.technique=Object.assign({},l,s[l.technique]),c.technique.values=ig(c.technique,n)),n.removeObjectExtension(c,"KHR_techniques_webgl")}catch(e){a.e(e)}finally{a.f()}n.removeExtension("KHR_techniques_webgl")}case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ng(){return(ng=l(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rg(e,t){var n=e.programs,r=void 0===n?[]:n,i=e.shaders,s=void 0===i?[]:i,a=e.techniques,o=void 0===a?[]:a,A=new TextDecoder;return s.forEach((function(e){if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=A.decode(t.getTypedArrayForBufferView(e.bufferView))})),r.forEach((function(e){e.fragmentShader=s[e.fragmentShader],e.vertexShader=s[e.vertexShader]})),o.forEach((function(e){e.program=r[e.program]})),o}function ig(e,t){var n=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((function(t){e.uniforms[t].value&&!(t in n)&&(n[t]=e.uniforms[t].value)})),Object.keys(n).forEach((function(e){"object"===M(n[e])&&void 0!==n[e].index&&(n[e].texture=t.getTexture(n[e].index))})),n}var sg=[Ff,hf,Lp,Hp,Np,mv,Object.freeze({__proto__:null,name:"KHR_lights_punctual",decode:function(e){return qv.apply(this,arguments)},encode:function(e){return $v.apply(this,arguments)}}),Object.freeze({__proto__:null,name:"KHR_materials_unlit",decode:function(e){return eg.apply(this,arguments)},encode:function(e){var t=new zd(e),n=t.json;if(t.materials){var r,i=u(n.materials||[]);try{for(i.s();!(r=i.n()).done;){var s=r.value;s.unlit&&(delete s.unlit,t.addObjectExtension(s,"KHR_materials_unlit",{}),t.addExtension("KHR_materials_unlit"))}}catch(e){i.e(e)}finally{i.f()}}}}),Object.freeze({__proto__:null,name:"KHR_techniques_webgl",decode:function(e){return tg.apply(this,arguments)},encode:function(e,t){return ng.apply(this,arguments)}}),Yv,Lf];function ag(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,i=sg.filter((function(e){return cg(e.name,n)})),s=u(i);try{for(s.s();!(t=s.n()).done;){var a,o=t.value;null===(a=o.preprocess)||void 0===a||a.call(o,e,n,r)}}catch(e){s.e(e)}finally{s.f()}}function og(e){return Ag.apply(this,arguments)}function Ag(){return Ag=l(A().mark((function e(t){var n,r,i,s,a,o,c,l=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=l.length>1&&void 0!==l[1]?l[1]:{},r=l.length>2?l[2]:void 0,i=sg.filter((function(e){return cg(e.name,n)})),s=u(i),e.prev=4,s.s();case 6:if((a=s.n()).done){e.next=12;break}return c=a.value,e.next=10,null===(o=c.decode)||void 0===o?void 0:o.call(c,t,n,r);case 10:e.next=6;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(4),s.e(e.t0);case 17:return e.prev=17,s.f(),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,14,17,20]])}))),Ag.apply(this,arguments)}function cg(e,t){var n,r=(null==t||null===(n=t.gltf)||void 0===n?void 0:n.excludeExtensions)||{};return!(e in r&&!r[e])}var lg={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},ug={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"},hg=function(){function e(){x(this,e),f(this,"idToIndexMap",{animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}}),f(this,"json",void 0)}return I(e,[{key:"normalize",value:function(e,t){this.json=e.json;var n=e.json;switch(n.asset&&n.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn("glTF: Unknown version ".concat(n.asset.version))}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(n),this._convertTopLevelObjectsToArrays(n),function(e){var t,n=new zd(e),r=n.json,i=u(r.images||[]);try{for(i.s();!(t=i.n()).done;){var s=t.value,a=n.getObjectExtension(s,"KHR_binary_glTF");a&&Object.assign(s,a),n.removeObjectExtension(s,"KHR_binary_glTF")}}catch(e){i.e(e)}finally{i.f()}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,n.removeExtension("KHR_binary_glTF")}(e),this._convertObjectIdsToArrayIndices(n),this._updateObjects(n),this._updateMaterial(n)}},{key:"_addAsset",value:function(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}},{key:"_convertTopLevelObjectsToArrays",value:function(e){for(var t in lg)this._convertTopLevelObjectToArray(e,t)}},{key:"_convertTopLevelObjectToArray",value:function(e,t){var n=e[t];if(n&&!Array.isArray(n))for(var r in e[t]=[],n){var i=n[r];i.id=i.id||r;var s=e[t].length;e[t].push(i),this.idToIndexMap[t][r]=s}}},{key:"_convertObjectIdsToArrayIndices",value:function(e){for(var t in lg)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));var n,r=u(e.textures);try{for(r.s();!(n=r.n()).done;){var i=n.value;this._convertTextureIds(i)}}catch(e){r.e(e)}finally{r.f()}var s,a=u(e.meshes);try{for(a.s();!(s=a.n()).done;){var o=s.value;this._convertMeshIds(o)}}catch(e){a.e(e)}finally{a.f()}var A,c=u(e.nodes);try{for(c.s();!(A=c.n()).done;){var l=A.value;this._convertNodeIds(l)}}catch(e){c.e(e)}finally{c.f()}var h,d=u(e.scenes);try{for(d.s();!(h=d.n()).done;){var f=h.value;this._convertSceneIds(f)}}catch(e){d.e(e)}finally{d.f()}}},{key:"_convertTextureIds",value:function(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}},{key:"_convertMeshIds",value:function(e){var t,n=u(e.primitives);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.attributes,s=r.indices,a=r.material;for(var o in i)i[o]=this._convertIdToIndex(i[o],"accessor");s&&(r.indices=this._convertIdToIndex(s,"accessor")),a&&(r.material=this._convertIdToIndex(a,"material"))}}catch(e){n.e(e)}finally{n.f()}}},{key:"_convertNodeIds",value:function(e){var t=this;e.children&&(e.children=e.children.map((function(e){return t._convertIdToIndex(e,"node")}))),e.meshes&&(e.meshes=e.meshes.map((function(e){return t._convertIdToIndex(e,"mesh")})))}},{key:"_convertSceneIds",value:function(e){var t=this;e.nodes&&(e.nodes=e.nodes.map((function(e){return t._convertIdToIndex(e,"node")})))}},{key:"_convertIdsToIndices",value:function(e,t){e[t]||(console.warn("gltf v1: json doesn't contain attribute ".concat(t)),e[t]=[]);var n,r=u(e[t]);try{for(r.s();!(n=r.n()).done;){var i=n.value;for(var s in i){var a=i[s],o=this._convertIdToIndex(a,s);i[s]=o}}}catch(e){r.e(e)}finally{r.f()}}},{key:"_convertIdToIndex",value:function(e,t){var n=ug[t];if(n in this.idToIndexMap){var r=this.idToIndexMap[n][e];if(!Number.isFinite(r))throw new Error("gltf v1: failed to resolve ".concat(t," with id ").concat(e));return r}return e}},{key:"_updateObjects",value:function(e){var t,n=u(this.json.buffers);try{for(n.s();!(t=n.n()).done;){delete t.value.type}}catch(e){n.e(e)}finally{n.f()}}},{key:"_updateMaterial",value:function(e){var t,n=u(e.materials);try{var r=function(){var n,r,i,s=t.value;s.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};var a=(null===(n=s.values)||void 0===n?void 0:n.tex)||(null===(r=s.values)||void 0===r?void 0:r.texture2d_0)||(null===(i=s.values)||void 0===i?void 0:i.diffuseTex),o=e.textures.findIndex((function(e){return e.id===a}));-1!==o&&(s.pbrMetallicRoughness.baseColorTexture={index:o})};for(n.s();!(t=n.n()).done;)r()}catch(e){n.e(e)}finally{n.f()}}}]),e}();function dg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new hg).normalize(e,t)}function fg(e,t){return pg.apply(this,arguments)}function pg(){return pg=l(A().mark((function e(t,n){var r,i,s,a,o,c,l=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>2&&void 0!==l[2]?l[2]:0,o=l.length>3?l[3]:void 0,c=l.length>4?l[4]:void 0,vg(t,n,a,o),dg(t,{normalize:null==o||null===(r=o.gltf)||void 0===r?void 0:r.normalize}),ag(t,o,c),null==o||null===(i=o.gltf)||void 0===i||!i.loadBuffers||!t.json.buffers){e.next=9;break}return e.next=9,gg(t,o,c);case 9:if(null==o||null===(s=o.gltf)||void 0===s||!s.loadImages){e.next=12;break}return e.next=12,yg(t,o,c);case 12:return e.next=14,og(t,o,c);case 14:return e.abrupt("return",t);case 15:case"end":return e.stop()}}),e)}))),pg.apply(this,arguments)}function vg(e,t,n,r){(r.uri&&(e.baseUri=r.uri),t instanceof ArrayBuffer&&!function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new DataView(e),i=n.magic,s=void 0===i?1735152710:i,a=r.getUint32(t,!1);return a===s||1735152710===a}(t,n,r))&&(t=(new TextDecoder).decode(t));if("string"==typeof t)e.json=gu(t);else if(t instanceof ArrayBuffer){var i={};n=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=new DataView(t),i=vp(r,n+0),s=r.getUint32(n+4,!0),a=r.getUint32(n+8,!0);switch(Object.assign(e,{header:{byteOffset:n,byteLength:a,hasBinChunk:!1},type:i,version:s,json:{},binChunks:[]}),n+=12,e.version){case 1:return gp(e,r,n);case 2:return mp(e,r,n,{});default:throw new Error("Invalid GLB version ".concat(e.version,". Only supports version 1 and 2."))}}(i,t,n,r.glb),Pd("glTF"===i.type,"Invalid GLB magic string ".concat(i.type)),e._glb=i,e.json=i.json}else Pd(!1,"GLTF: must be ArrayBuffer or string");var s=e.json.buffers||[];if(e.buffers=new Array(s.length).fill(null),e._glb&&e._glb.header.hasBinChunk){var a=e._glb.binChunks;e.buffers[0]={arrayBuffer:a[0].arrayBuffer,byteOffset:a[0].byteOffset,byteLength:a[0].byteLength}}var o=e.json.images||[];e.images=new Array(o.length).fill({})}function gg(e,t,n){return mg.apply(this,arguments)}function mg(){return(mg=l(A().mark((function e(t,n,r){var i,s,a,o,c,l,u,h;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=t.json.buffers||[],s=0;case 2:if(!(s<i.length)){e.next=22;break}if(!(a=i[s]).uri){e.next=18;break}return Pd(r.fetch),l=bp(a.uri,n),e.next=10,null==r||null===(o=r.fetch)||void 0===o?void 0:o.call(r,l);case 10:return u=e.sent,e.next=13,null==u||null===(c=u.arrayBuffer)||void 0===c?void 0:c.call(u);case 13:h=e.sent,t.buffers[s]={arrayBuffer:h,byteOffset:0,byteLength:h.byteLength},delete a.uri,e.next=19;break;case 18:null===t.buffers[s]&&(t.buffers[s]={arrayBuffer:new ArrayBuffer(a.byteLength),byteOffset:0,byteLength:a.byteLength});case 19:++s,e.next=2;break;case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yg(e,t,n){return _g.apply(this,arguments)}function _g(){return(_g=l(A().mark((function e(t,n,r){var i,s,a,o,c,l;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=bg(t),s=t.json.images||[],a=[],o=u(i);try{for(o.s();!(c=o.n()).done;)l=c.value,a.push(wg(t,s[l],l,n,r))}catch(e){o.e(e)}finally{o.f()}return e.next=7,Promise.all(a);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bg(e){var t,n=new Set,r=u(e.json.textures||[]);try{for(r.s();!(t=r.n()).done;){var i=t.value;void 0!==i.source&&n.add(i.source)}}catch(e){r.e(e)}finally{r.f()}return Array.from(n).sort()}function wg(e,t,n,r,i){return Bg.apply(this,arguments)}function Bg(){return(Bg=l(A().mark((function e(t,n,r,i,s){var a,o,c,l,u,h;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.uri||n.hasOwnProperty("bufferView")){e.next=10;break}return o=bp(n.uri,i),c=s.fetch,e.next=5,c(o);case 5:return l=e.sent,e.next=8,l.arrayBuffer();case 8:a=e.sent,n.bufferView={data:a};case 10:return Number.isFinite(n.bufferView)&&(u=Wd(t.json,t.buffers,n.bufferView),a=_u(u.buffer,u.byteOffset,u.byteLength)),Pd(a,"glTF image has no data"),e.next=14,rl(a,[Ud,pp],d(d({},i),{},{mimeType:n.mimeType,basis:i.basis||{format:fp()}}),s);case 14:(h=e.sent)&&h[0]&&(h={compressed:!0,mipmaps:!1,width:h[0].width,height:h[0].height,data:h[0]}),t.images=t.images||[],t.images[r]=h;case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Cg={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:"4.3.3",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:function(e){return Mg.apply(this,arguments)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};function Mg(){return Mg=l(A().mark((function e(t){var n,r,i,s,a,o=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:{},r=o.length>2?o[2]:void 0,(n=d(d({},Cg.options),n)).gltf=d(d({},Cg.options.gltf),n.gltf),i=n.byteOffset,s=void 0===i?0:i,a={},e.next=8,fg(a,t,s,n,r);case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}}),e)}))),Mg.apply(this,arguments)}var kg={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Eg={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Fg=10240,xg=10241,Ug=10242,Ig=10243,Tg=10497,Pg=9986,Sg={magFilter:Fg,minFilter:xg,wrapS:Ug,wrapT:Ig},Dg=(f(n={},Fg,9729),f(n,xg,Pg),f(n,Ug,Tg),f(n,Ig,Tg),n);var Qg=function(){function e(){x(this,e),f(this,"baseUri",""),f(this,"jsonUnprocessed",void 0),f(this,"json",void 0),f(this,"buffers",[]),f(this,"images",[])}return I(e,[{key:"postProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.json,r=e.buffers,i=void 0===r?[]:r,s=e.images,a=void 0===s?[]:s,o=e.baseUri,A=void 0===o?"":o;return Pd(n),this.baseUri=A,this.buffers=i,this.images=a,this.jsonUnprocessed=n,this.json=this._resolveTree(e.json,t),this.json}},{key:"_resolveTree",value:function(e){var t=this,n=d({},e);return this.json=n,e.bufferViews&&(n.bufferViews=e.bufferViews.map((function(e,n){return t._resolveBufferView(e,n)}))),e.images&&(n.images=e.images.map((function(e,n){return t._resolveImage(e,n)}))),e.samplers&&(n.samplers=e.samplers.map((function(e,n){return t._resolveSampler(e,n)}))),e.textures&&(n.textures=e.textures.map((function(e,n){return t._resolveTexture(e,n)}))),e.accessors&&(n.accessors=e.accessors.map((function(e,n){return t._resolveAccessor(e,n)}))),e.materials&&(n.materials=e.materials.map((function(e,n){return t._resolveMaterial(e,n)}))),e.meshes&&(n.meshes=e.meshes.map((function(e,n){return t._resolveMesh(e,n)}))),e.nodes&&(n.nodes=e.nodes.map((function(e,n){return t._resolveNode(e,n)})),n.nodes=n.nodes.map((function(e,n){return t._resolveNodeChildren(e)}))),e.skins&&(n.skins=e.skins.map((function(e,n){return t._resolveSkin(e,n)}))),e.scenes&&(n.scenes=e.scenes.map((function(e,n){return t._resolveScene(e,n)}))),"number"==typeof this.json.scene&&n.scenes&&(n.scene=n.scenes[this.json.scene]),n}},{key:"getScene",value:function(e){return this._get(this.json.scenes,e)}},{key:"getNode",value:function(e){return this._get(this.json.nodes,e)}},{key:"getSkin",value:function(e){return this._get(this.json.skins,e)}},{key:"getMesh",value:function(e){return this._get(this.json.meshes,e)}},{key:"getMaterial",value:function(e){return this._get(this.json.materials,e)}},{key:"getAccessor",value:function(e){return this._get(this.json.accessors,e)}},{key:"getCamera",value:function(e){return this._get(this.json.cameras,e)}},{key:"getTexture",value:function(e){return this._get(this.json.textures,e)}},{key:"getSampler",value:function(e){return this._get(this.json.samplers,e)}},{key:"getImage",value:function(e){return this._get(this.json.images,e)}},{key:"getBufferView",value:function(e){return this._get(this.json.bufferViews,e)}},{key:"getBuffer",value:function(e){return this._get(this.json.buffers,e)}},{key:"_get",value:function(e,t){if("object"===M(t))return t;var n=e&&e[t];return n||console.warn("glTF file error: Could not find ".concat(e,"[").concat(t,"]")),n}},{key:"_resolveScene",value:function(e,t){var n=this;return d(d({},e),{},{id:e.id||"scene-".concat(t),nodes:(e.nodes||[]).map((function(e){return n.getNode(e)}))})}},{key:"_resolveNode",value:function(e,t){var n=this,r=d(d({},e),{},{id:(null==e?void 0:e.id)||"node-".concat(t)});return void 0!==e.mesh&&(r.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(r.camera=this.getCamera(e.camera)),void 0!==e.skin&&(r.skin=this.getSkin(e.skin)),void 0!==e.meshes&&e.meshes.length&&(r.mesh=e.meshes.reduce((function(e,t){var r=n.getMesh(t);return e.id=r.id,e.primitives=e.primitives.concat(r.primitives),e}),{primitives:[]})),r}},{key:"_resolveNodeChildren",value:function(e){var t=this;return e.children&&(e.children=e.children.map((function(e){return t.getNode(e)}))),e}},{key:"_resolveSkin",value:function(e,t){var n="number"==typeof e.inverseBindMatrices?this.getAccessor(e.inverseBindMatrices):void 0;return d(d({},e),{},{id:e.id||"skin-".concat(t),inverseBindMatrices:n})}},{key:"_resolveMesh",value:function(e,t){var n=this,r=d(d({},e),{},{id:e.id||"mesh-".concat(t),primitives:[]});return e.primitives&&(r.primitives=e.primitives.map((function(e){var t=d(d({},e),{},{attributes:{},indices:void 0,material:void 0}),r=e.attributes;for(var i in r)t.attributes[i]=n.getAccessor(r[i]);return void 0!==e.indices&&(t.indices=n.getAccessor(e.indices)),void 0!==e.material&&(t.material=n.getMaterial(e.material)),t}))),r}},{key:"_resolveMaterial",value:function(e,t){var n=d(d({},e),{},{id:e.id||"material-".concat(t)});if(n.normalTexture&&(n.normalTexture=d({},n.normalTexture),n.normalTexture.texture=this.getTexture(n.normalTexture.index)),n.occlusionTexture&&(n.occlusionTexture=d({},n.occlusionTexture),n.occlusionTexture.texture=this.getTexture(n.occlusionTexture.index)),n.emissiveTexture&&(n.emissiveTexture=d({},n.emissiveTexture),n.emissiveTexture.texture=this.getTexture(n.emissiveTexture.index)),n.emissiveFactor||(n.emissiveFactor=n.emissiveTexture?[1,1,1]:[0,0,0]),n.pbrMetallicRoughness){n.pbrMetallicRoughness=d({},n.pbrMetallicRoughness);var r=n.pbrMetallicRoughness;r.baseColorTexture&&(r.baseColorTexture=d({},r.baseColorTexture),r.baseColorTexture.texture=this.getTexture(r.baseColorTexture.index)),r.metallicRoughnessTexture&&(r.metallicRoughnessTexture=d({},r.metallicRoughnessTexture),r.metallicRoughnessTexture.texture=this.getTexture(r.metallicRoughnessTexture.index))}return n}},{key:"_resolveAccessor",value:function(e,t){var n,r,i=(n=e.componentType,Eg[n]),s=(r=e.type,kg[r]),a=i*s,o=d(d({},e),{},{id:e.id||"accessor-".concat(t),bytesPerComponent:i,components:s,bytesPerElement:a,value:void 0,bufferView:void 0,sparse:void 0});if(void 0!==e.bufferView&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){var A=o.bufferView.buffer,c=jd(o,o.bufferView),l=c.ArrayType,u=c.byteLength,h=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+A.byteOffset,f=A.arrayBuffer.slice(h,h+u);o.bufferView.byteStride&&(f=this._getValueFromInterleavedBuffer(A,h,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new l(f)}return o}},{key:"_getValueFromInterleavedBuffer",value:function(e,t,n,r,i){for(var s=new Uint8Array(i*r),a=0;a<i;a++){var o=t+a*n;s.set(new Uint8Array(e.arrayBuffer.slice(o,o+r)),a*r)}return s.buffer}},{key:"_resolveTexture",value:function(e,t){return d(d({},e),{},{id:e.id||"texture-".concat(t),sampler:"number"==typeof e.sampler?this.getSampler(e.sampler):{id:"default-sampler",parameters:Dg},source:"number"==typeof e.source?this.getImage(e.source):void 0})}},{key:"_resolveSampler",value:function(e,t){var n=d(d({id:e.id||"sampler-".concat(t)},e),{},{parameters:{}});for(var r in n){var i=this._enumSamplerParameter(r);void 0!==i&&(n.parameters[i]=n[r])}return n}},{key:"_enumSamplerParameter",value:function(e){return Sg[e]}},{key:"_resolveImage",value:function(e,t){var n=d(d({},e),{},{id:e.id||"image-".concat(t),image:null,bufferView:void 0!==e.bufferView?this.getBufferView(e.bufferView):void 0}),r=this.images[t];return r&&(n.image=r),n}},{key:"_resolveBufferView",value:function(e,t){var n=e.buffer,r=this.buffers[n].arrayBuffer,i=this.buffers[n].byteOffset||0;return e.byteOffset&&(i+=e.byteOffset),d(d({id:"bufferView-".concat(t)},e),{},{buffer:this.buffers[n],data:new Uint8Array(r,i,e.byteLength)})}},{key:"_resolveCamera",value:function(e,t){return d(d({},e),{},{id:e.id||"camera-".concat(t)})}}]),e}();var Rg={dataType:null,batchType:null,name:"LAS",id:"las",module:"las",version:"4.3.3",worker:!0,extensions:["las","laz"],mimeTypes:["application/octet-stream"],text:!0,binary:!0,tests:["LAS"],options:{las:{shape:"mesh",fp64:!1,skip:1,colorDepth:8}}};function Og(){var e,t=void 0!==t?t:{},n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);var r,i,s,a;r="object"===("undefined"==typeof window?"undefined":M(window)),i="function"==typeof importScripts,s="object"===("undefined"==typeof process?"undefined":M(process))&&"object"===M(process.versions)&&"string"==typeof process.versions.node,a=!r&&!s&&!i;var o,A,c,l,u,h="";if(s){if(i)h=require("path").dirname(h)+"/";else{var d="undefined"!=typeof __dirname?__dirname:"";h=d+"/"}o=function(e,t){var n=dt(e);return n?t?n:n.toString():(l||(l=require("fs")),u||(u=require("path")),e=u.normalize(e),l.readFileSync(e,t?null:"utf8"))},c=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),m(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),"undefined"!=typeof module&&(module.exports=t),process.on("uncaughtException",(function(e){if(!(e instanceof Ft))throw e})),process.on("unhandledRejection",X),t.inspect=function(){return"[Emscripten Module object]"}}else a?("undefined"!=typeof read&&(o=function(e){var t=dt(e);return t?ut(t):read(e)}),c=function(e){var t;return(t=dt(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(m("object"===M(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(r||i)&&(i?h=self.location.href:document.currentScript&&(h=document.currentScript.src),h=0!==h.indexOf("blob:")?h.substr(0,h.lastIndexOf("/")+1):"",o=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(t){var n=dt(e);if(n)return ut(n);throw t}},i&&(c=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(t){var n=dt(e);if(n)return n;throw t}}),A=function(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.responseType="arraybuffer",r.onload=function(){if(200==r.status||0==r.status&&r.response)t(r.response);else{var i=dt(e);i?t(i.buffer):n()}},r.onerror=n,r.send(null)});var f=t.print||console.log.bind(console),p=t.printErr||console.warn.bind(console);for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);n=null,t.arguments,t.thisProgram,t.quit,new Array(0);var v=0;t.wasmBinary,t.noExitRuntime;var g=!1;function m(e,t){e||X("Assertion failed: "+t)}var y="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function _(e,t){return e?function(e,t,n){for(var r=t+n,i=t;e[i]&&!(i>=r);)++i;if(i-t>16&&e.subarray&&y)return y.decode(e.subarray(t,i));for(var s="";t<i;){var a=e[t++];if(128&a){var o=63&e[t++];if(192!=(224&a)){var A=63&e[t++];if((a=224==(240&a)?(15&a)<<12|o<<6|A:(7&a)<<18|o<<12|A<<6|63&e[t++])<65536)s+=String.fromCharCode(a);else{var c=a-65536;s+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else s+=String.fromCharCode((31&a)<<6|o)}else s+=String.fromCharCode(a)}return s}(B,e,t):""}var b,w,B,C,k,E,F,x,U,I="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function T(e,t){for(var n=e,r=n>>1,i=r+t/2;!(r>=i)&&k[r];)++r;if((n=r<<1)-e>32&&I)return I.decode(B.subarray(e,n));for(var s=0,a="";;){var o=C[e+2*s>>1];if(0==o||s==t/2)return a;++s,a+=String.fromCharCode(o)}}function P(e,t,n){if(void 0===n&&(n=2147483647),n<2)return 0;for(var r=t,i=(n-=2)<2*e.length?n/2:e.length,s=0;s<i;++s){var a=e.charCodeAt(s);C[t>>1]=a,t+=2}return C[t>>1]=0,t-r}function S(e){return 2*e.length}function D(e,t){for(var n=0,r="";!(n>=t/4);){var i=E[e+4*n>>2];if(0==i)break;if(++n,i>=65536){var s=i-65536;r+=String.fromCharCode(55296|s>>10,56320|1023&s)}else r+=String.fromCharCode(i)}return r}function Q(e,t,n){if(void 0===n&&(n=2147483647),n<4)return 0;for(var r=t,i=r+n-4,s=0;s<e.length;++s){var a=e.charCodeAt(s);if(a>=55296&&a<=57343)a=65536+((1023&a)<<10)|1023&e.charCodeAt(++s);if(E[t>>2]=a,(t+=4)+4>i)break}return E[t>>2]=0,t-r}function R(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&++n,t+=4}return t}var O,V=t.INITIAL_MEMORY||167772160;function L(e){for(;e.length>0;){var n=e.shift();if("function"!=typeof n){var r=n.func;"number"==typeof r?void 0===n.arg?t.dynCall_v(r):t.dynCall_vi(r,n.arg):r(void 0===n.arg?null:n.arg)}else n(t)}}V=(b=t.buffer?t.buffer:new ArrayBuffer(V)).byteLength,b=O=b,t.HEAP8=w=new Int8Array(O),t.HEAP16=C=new Int16Array(O),t.HEAP32=E=new Int32Array(O),t.HEAPU8=B=new Uint8Array(O),t.HEAPU16=k=new Uint16Array(O),t.HEAPU32=F=new Uint32Array(O),t.HEAPF32=x=new Float32Array(O),t.HEAPF64=U=new Float64Array(O),E[5544]=5265264;var H=[],N=[],G=[],j=[];var W=0,z=null;function X(e){throw t.onAbort&&t.onAbort(e),f(e+=""),p(e),g=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info."}t.preloadedImages={},t.preloadedAudios={};var K=null;var Z="data:application/octet-stream;base64,";function J(e){return t=e,n=Z,String.prototype.startsWith?t.startsWith(n):0===t.indexOf(n);var t,n}N.push({func:function(){wt()}}),K="data:application/octet-stream;base64,AAAAAAAAAAAPDg0MCwoJCA4AAQMGCgoJDQECBAcLCwoMAwQFCAwMCwsGBwgJDQ0MCgoLDA0ODg0JCgsMDQ4PDggJCgsMDQ4PAAECAwQFBgcBAAECAwQFBgIBAAECAwQFAwIBAAECAwQEAwIBAAECAwUEAwIBAAECBgUEAwIBAAEHBgUEAwIBAMgPAAAoDQAAEBAAACAQAADIDwAAUA0AABAQAAAgEAAAEQAKABEREQAAAAAFAAAAAAAACQAAAAALAAAAAAAAAAARAA8KERERAwoHAAEACQsLAAAJBgsAAAsABhEAAAAREREAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAEQAKChEREQAKAAACAAkLAAAACQALAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAADAAAAAAJDAAAAAAADAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAANAAAABA0AAAAACQ4AAAAAAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAADwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAASEhIAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAKAAAAAAoAAAAACQsAAAAAAAsAAAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAwMTIzNDU2Nzg5QUJDREVGGRJEOwI/LEcUPTMwChsGRktFNw9JDo4XA0AdPGkrNh9KLRwBICUpIQgMFRYiLhA4Pgs0MRhkdHV2L0EJfzkRI0MyQomKiwUEJignDSoeNYwHGkiTE5SVAAAAAAAAAAAASWxsZWdhbCBieXRlIHNlcXVlbmNlAERvbWFpbiBlcnJvcgBSZXN1bHQgbm90IHJlcHJlc2VudGFibGUATm90IGEgdHR5AFBlcm1pc3Npb24gZGVuaWVkAE9wZXJhdGlvbiBub3QgcGVybWl0dGVkAE5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnkATm8gc3VjaCBwcm9jZXNzAEZpbGUgZXhpc3RzAFZhbHVlIHRvbyBsYXJnZSBmb3IgZGF0YSB0eXBlAE5vIHNwYWNlIGxlZnQgb24gZGV2aWNlAE91dCBvZiBtZW1vcnkAUmVzb3VyY2UgYnVzeQBJbnRlcnJ1cHRlZCBzeXN0ZW0gY2FsbABSZXNvdXJjZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZQBJbnZhbGlkIHNlZWsAQ3Jvc3MtZGV2aWNlIGxpbmsAUmVhZC1vbmx5IGZpbGUgc3lzdGVtAERpcmVjdG9yeSBub3QgZW1wdHkAQ29ubmVjdGlvbiByZXNldCBieSBwZWVyAE9wZXJhdGlvbiB0aW1lZCBvdXQAQ29ubmVjdGlvbiByZWZ1c2VkAEhvc3QgaXMgZG93bgBIb3N0IGlzIHVucmVhY2hhYmxlAEFkZHJlc3MgaW4gdXNlAEJyb2tlbiBwaXBlAEkvTyBlcnJvcgBObyBzdWNoIGRldmljZSBvciBhZGRyZXNzAEJsb2NrIGRldmljZSByZXF1aXJlZABObyBzdWNoIGRldmljZQBOb3QgYSBkaXJlY3RvcnkASXMgYSBkaXJlY3RvcnkAVGV4dCBmaWxlIGJ1c3kARXhlYyBmb3JtYXQgZXJyb3IASW52YWxpZCBhcmd1bWVudABBcmd1bWVudCBsaXN0IHRvbyBsb25nAFN5bWJvbGljIGxpbmsgbG9vcABGaWxlbmFtZSB0b28gbG9uZwBUb28gbWFueSBvcGVuIGZpbGVzIGluIHN5c3RlbQBObyBmaWxlIGRlc2NyaXB0b3JzIGF2YWlsYWJsZQBCYWQgZmlsZSBkZXNjcmlwdG9yAE5vIGNoaWxkIHByb2Nlc3MAQmFkIGFkZHJlc3MARmlsZSB0b28gbGFyZ2UAVG9vIG1hbnkgbGlua3MATm8gbG9ja3MgYXZhaWxhYmxlAFJlc291cmNlIGRlYWRsb2NrIHdvdWxkIG9jY3VyAFN0YXRlIG5vdCByZWNvdmVyYWJsZQBQcmV2aW91cyBvd25lciBkaWVkAE9wZXJhdGlvbiBjYW5jZWxlZABGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQATm8gbWVzc2FnZSBvZiBkZXNpcmVkIHR5cGUASWRlbnRpZmllciByZW1vdmVkAERldmljZSBub3QgYSBzdHJlYW0ATm8gZGF0YSBhdmFpbGFibGUARGV2aWNlIHRpbWVvdXQAT3V0IG9mIHN0cmVhbXMgcmVzb3VyY2VzAExpbmsgaGFzIGJlZW4gc2V2ZXJlZABQcm90b2NvbCBlcnJvcgBCYWQgbWVzc2FnZQBGaWxlIGRlc2NyaXB0b3IgaW4gYmFkIHN0YXRlAE5vdCBhIHNvY2tldABEZXN0aW5hdGlvbiBhZGRyZXNzIHJlcXVpcmVkAE1lc3NhZ2UgdG9vIGxhcmdlAFByb3RvY29sIHdyb25nIHR5cGUgZm9yIHNvY2tldABQcm90b2NvbCBub3QgYXZhaWxhYmxlAFByb3RvY29sIG5vdCBzdXBwb3J0ZWQAU29ja2V0IHR5cGUgbm90IHN1cHBvcnRlZABOb3Qgc3VwcG9ydGVkAFByb3RvY29sIGZhbWlseSBub3Qgc3VwcG9ydGVkAEFkZHJlc3MgZmFtaWx5IG5vdCBzdXBwb3J0ZWQgYnkgcHJvdG9jb2wAQWRkcmVzcyBub3QgYXZhaWxhYmxlAE5ldHdvcmsgaXMgZG93bgBOZXR3b3JrIHVucmVhY2hhYmxlAENvbm5lY3Rpb24gcmVzZXQgYnkgbmV0d29yawBDb25uZWN0aW9uIGFib3J0ZWQATm8gYnVmZmVyIHNwYWNlIGF2YWlsYWJsZQBTb2NrZXQgaXMgY29ubmVjdGVkAFNvY2tldCBub3QgY29ubmVjdGVkAENhbm5vdCBzZW5kIGFmdGVyIHNvY2tldCBzaHV0ZG93bgBPcGVyYXRpb24gYWxyZWFkeSBpbiBwcm9ncmVzcwBPcGVyYXRpb24gaW4gcHJvZ3Jlc3MAU3RhbGUgZmlsZSBoYW5kbGUAUmVtb3RlIEkvTyBlcnJvcgBRdW90YSBleGNlZWRlZABObyBtZWRpdW0gZm91bmQAV3JvbmcgbWVkaXVtIHR5cGUATm8gZXJyb3IgaW5mb3JtYXRpb24AAAAAAADgFgAAmRgAAGAQAAAAAAAA4BYAAEIZAABgEAAAAAAAAOAWAAAqGgAASA8AAAAAAAC4FgAANBsAAOAWAACfGgAAMAoAAAAAAADgFgAAaRsAAEgPAAAAAAAA4BYAAIobAABIDwAAAAAAALgWAAAPHAAA4BYAAHwcAABIDwAAAAAAAOAWAACVHAAASA8AAAAAAADgFgAAHh0AAEgPAAAAAAAA4BYAAHcdAABIDwAAAAAAAOAWAACQHQAASA8AAAAAAADgFgAAQh4AAEgPAAAAAAAA4BYAAIceAABgEAAAAAAAAOAWAACkHwAASA8AAAAAAAC4FgAAZyAAAOAWAADkHwAA8AoAAAAAAADgFgAAjyAAAGAQAAAAAAAAuBYAAMMiAADgFgAAAiIAABgLAAAAAAAA4BYAAOEiAABgEAAAAAAAAOAWAADQJAAAGAsAAAAAAADgFgAAkSUAAGAQAAAAAAAA4BYAAIAnAAAYCwAAAAAAAOAWAAA9KAAAYBAAAAAAAADgFgAAJCoAABgLAAAAAAAA4BYAAOkqAABgEAAAAAAAAOAWAADgLAAA8AoAAAAAAADgFgAAui0AAGAQAAAAAAAA4BYAANsvAADwCgAAAAAAAOAWAADTMAAAYBAAAAAAAADgFgAAMDMAAPAKAAAAAAAA4BYAACQ0AABgEAAAAAAAAOAWAAB5NgAA8AoAAAAAAADgFgAAizcAAGAQAAAAAAAA4BYAABw6AABgEAAAAAAAAOAWAACdOgAAYBAAAAAAAADgFgAAXjsAAPAKAAAAAAAA4BYAALU7AABgEAAAAAAAAOAWAADMPAAAGAsAAAAAAADgFgAATz0AAGAQAAAAAAAA4BYAAL4+AAAYCwAAAAAAAOAWAABBPwAAYBAAAAAAAADgFgAAsEAAABgLAAAAAAAA4BYAADNBAABgEAAAAAAAAOAWAACiQgAAGAsAAAAAAADgFgAAJUMAAGAQAAAAAAAA4BYAAJREAAAYCwAAAAAAAOAWAAAXRQAAYBAAAAAAAADgFgAAhkYAABgLAAAAAAAA4BYAAAlHAABgEAAAAAAAALgWAAB4SAAAiBcAAIBIAAAAAAAAIA0AAIgXAACJSAAAAQAAACANAAC4FgAAqkgAAIgXAAC6SAAAAAAAAEgNAACIFwAAy0gAAAEAAABIDQAAuBYAABhMAAC4FgAAN0wAALgWAABWTAAAuBYAAHVMAAC4FgAAlEwAALgWAACzTAAAuBYAANJMAAC4FgAA8UwAALgWAAAQTQAAuBYAAC9NAAC4FgAATk0AALgWAABtTQAAuBYAAIxNAACkFwAAn00AAAAAAAABAAAA8A0AAAAAAAC4FgAA4U0AAKQXAAAHTgAAAAAAAAEAAADwDQAAAAAAAKQXAABJTgAAAAAAAAEAAADwDQAAAAAAAKQXAACITgAAAAAAAAEAAADwDQAAAAAAAKQXAADHTgAAAAAAAAEAAADwDQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALgWAADNTwAA4BYAAC1QAAAADwAAAAAAAOAWAADaTwAAEA8AAAAAAAC4FgAA+08AAOAWAAAIUAAA8A4AAAAAAADgFgAAhlAAAOgOAAAAAAAA4BYAAJNQAADoDgAAAAAAAOAWAACjUAAA6A4AAAAAAADgFgAAtVAAADgPAAAAAAAA4BYAAMZQAAA4DwAAAAAAAOAWAADXUAAAAA8AAAAAAADgFgAA+VAAAHgPAAAAAAAA4BYAAB1RAAAADwAAAAAAAOAWAABCUQAAeA8AAAAAAADgFgAAjlEAAAAPAAAAAAAAbBcAALZRAABsFwAAuFEAAGwXAAC7UQAAbBcAAL1RAABsFwAAv1EAAGwXAADBUQAAbBcAAMNRAABsFwAAxVEAAGwXAADHUQAAbBcAAMlRAABsFwAAy1EAAGwXAADNUQAAbBcAAM9RAABsFwAA0VEAAOAWAADTUQAA8A4AAAAAAADgFgAARlIAAOgOAAAAAAAAuBYAAGJSAACkFwAAe1IAAAAAAAABAAAAWBAAAAAAAADgFgAA9FIAAIgQAAAAAAAA4BYAABdTAACYEAAAAAAAALgWAAAuUwAA4BYAAHBTAACIEAAAAAAAAOAWAACSUwAASA8AAAAAAAAAAAAAAAoAAAEAAAACAAAAAwAAAAEAAAAEAAAAAAAAABAKAAABAAAABQAAAAYAAAACAAAABwAAAAAAAAAgCgAACAAAAAkAAAABAAAAAAAAADgKAAAKAAAACwAAAAIAAAABAAAADAAAAA0AAAACAAAAAwAAAAMAAAAAAAAASAoAAAgAAAAOAAAAAQAAAAAAAABYCgAACAAAAA8AAAABAAAAAAAAAIAKAAAIAAAAEAAAAAEAAAAAAAAAcAoAAAgAAAARAAAAAQAAAAAAAACQCgAACAAAABIAAAABAAAAAAAAAKAKAAAIAAAAEwAAAAEAAAAAAAAAsAoAAAgAAAAUAAAAAQAAAAAAAADACgAACAAAABUAAAABAAAAAAAAANAKAAABAAAAFgAAABcAAAAEAAAAGAAAAAAAAADgCgAACAAAABkAAAABAAAAAAAAAPgKAAAFAAAAGgAAABsAAAAAAAAA8AoAAAEAAAAcAAAAHQAAAAAAAAAICwAAAQAAAB4AAAAfAAAABgAAACAAAAAAAAAAIAsAACEAAAAiAAAABwAAAAgAAAAAAAAAGAsAACMAAAAkAAAABwAAAAkAAAAAAAAAMAsAAAEAAAAlAAAAJgAAAAoAAAAnAAAAAAAAAEALAAAoAAAAKQAAAAcAAAALAAAAAAAAAFALAAABAAAAKgAAACsAAAAMAAAALAAAAAAAAABgCwAALQAAAC4AAAAHAAAADQAAAAAAAABwCwAAAQAAAC8AAAAwAAAADgAAADEAAAAAAAAAgAsAADIAAAAzAAAABwAAAA8AAAAAAAAAkAsAAAEAAAA0AAAANQAAABAAAAA2AAAAAAAAAKALAAARAAAANwAAADgAAAAAAAAAsAsAAAEAAAA5AAAAOgAAABIAAAA7AAAAAAAAAMALAAATAAAAPAAAAD0AAAAAAAAA0AsAAAEAAAA+AAAAPwAAABQAAABAAAAAAAAAAOALAAAVAAAAQQAAAEIAAAAAAAAA8AsAAAEAAABDAAAARAAAABYAAABFAAAAAAAAAAAMAAAXAAAARgAAAEcAAAAAAAAAEAwAAAEAAABIAAAASQAAABgAAABKAAAAAAAAACAMAAABAAAASwAAAEwAAAAZAAAATQAAAAAAAAAwDAAAAQAAAE4AAABPAAAAGgAAAFAAAAAAAAAAQAwAABsAAABRAAAAUgAAAAAAAABQDAAAAQAAAFMAAABUAAAAHAAAAFUAAAAAAAAAYAwAAFYAAABXAAAABwAAAB0AAAAAAAAAcAwAAAEAAABYAAAAWQAAAB4AAABaAAAAAAAAAIAMAABbAAAAXAAAAAcAAAAfAAAAAAAAAJAMAAABAAAAXQAAAF4AAAAgAAAAXwAAAAAAAACgDAAAYAAAAGEAAAAHAAAAIQAAAAAAAACwDAAAAQAAAGIAAABjAAAAIgAAAGQAAAAAAAAAwAwAAGUAAABmAAAABwAAACMAAAAAAAAA0AwAAAEAAABnAAAAaAAAACQAAABpAAAAAAAAAOAMAABqAAAAawAAAAcAAAAlAAAAAAAAAPAMAAABAAAAbAAAAG0AAAAmAAAAbgAAAAAAAAAADQAAbwAAAHAAAAAHAAAAJwAAAAAAAAAQDQAAAQAAAHEAAAByAAAAKAAAAHMAAAAoDQAAyA8AACgNAAAIEAAAEBAAACgNAABQDQAAyA8AAFANAAAgEAAAyA8AAFANAAAIEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDgAAdAAAAHUAAAB2AAAAdwAAAAIAAAABAAAAAQAAAAEAAAAAAAAAGA8AAHQAAAB4AAAAdgAAAHcAAAACAAAAAgAAAAIAAAACAAAAAAAAACgPAAB5AAAAegAAAAQAAAAAAAAAOA8AAHsAAAB8AAAABQAAAAAAAABIDwAACAAAAH0AAAABAAAAAAAAAFgPAAB7AAAAfgAAAAUAAAAAAAAAaA8AAHsAAAB/AAAABQAAAAAAAAC4DwAAdAAAAIAAAAB2AAAAdwAAAAMAAAAAAAAAiA8AAHQAAACBAAAAdgAAAHcAAAAEAAAAAAAAADgQAAB0AAAAggAAAHYAAAB3AAAAAgAAAAMAAAADAAAAAwAAAAAAAABIEAAAgwAAAIQAAAAGAAAAAAAAAHgQAACFAAAAhgAAAAcAAAABAAAABQAAAAYAAAACAAAAAAAAAKAQAACFAAAAhwAAAAgAAAADAAAABQAAAAYAAAAEAAAA4BcAAAQYAAAAAAAAsBAAAIgAAACJAAAAAQAAAExBU1ppcABvcGVuAGdldFBvaW50AGdldENvdW50AER5bmFtaWNMQVNaaXAAYWRkRmllbGRGbG9hdGluZwBhZGRGaWVsZFNpZ25lZABhZGRGaWVsZFVuc2lnbmVkAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRU5TXzE0ZGVmYXVsdF9kZWxldGVJUzNfRUVOU185YWxsb2NhdG9ySVMzX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJUzdfRUVOU185YWxsb2NhdG9ySVM3X0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFAExBU0YATjZsYXN6aXAxM2ludmFsaWRfbWFnaWNFAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUARmlsZSBtYWdpYyBpcyBub3QgdmFsaWQATlN0M19fMjEwX19mdW5jdGlvbjZfX2Z1bmNJWk42bGFzemlwMmlvNnJlYWRlcjEwYmFzaWNfZmlsZUlOUzJfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRTExX3ZhbGlkYXRvcnNFdkVVbFJOUzNfNmhlYWRlckVFX05TXzlhbGxvY2F0b3JJU0JfRUVGdlNBX0VFRQBOU3QzX18yMTBfX2Z1bmN0aW9uNl9fYmFzZUlGdlJONmxhc3ppcDJpbzZoZWFkZXJFRUVFAE42bGFzemlwMjFvbGRfc3R5bGVfY29tcHJlc3Npb25FAE42bGFzemlwMTRub3RfY29tcHJlc3NlZEUAVGhlIGZpbGUgc2VlbXMgdG8gaGF2ZSBvbGQgc3R5bGUgY29tcHJlc3Npb24gd2hpY2ggaXMgbm90IHN1cHBvcnRlZABUaGUgZmlsZSBkb2Vzbid0IHNlZW0gdG8gYmUgY29tcHJlc3NlZABaTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUUxMV92YWxpZGF0b3JzRXZFVWxSTlMwXzZoZWFkZXJFRV8AbGFzemlwIGVuY29kZWQATjZsYXN6aXAxM25vX2xhc3ppcF92bHJFAE42bGFzemlwMjVsYXN6aXBfZm9ybWF0X3Vuc3VwcG9ydGVkRQBPbmx5IExBU3ppcCBQT0lOVFdJU0UgQ0hVTktFRCBkZWNvbXByZXNzb3IgaXMgc3VwcG9ydGVkAE5vIExBU3ppcCBWTFIgd2FzIGZvdW5kIGluIHRoZSBWTFJzIHNlY3Rpb24ATjZsYXN6aXAyMmNodW5rX3RhYmxlX3JlYWRfZXJyb3JFAENodW5rIHRhYmxlIG9mZnNldCA9PSAtMSBpcyBub3Qgc3VwcG9ydGVkIGF0IHRoaXMgdGltZQBONmxhc3ppcDEzbm90X3N1cHBvcnRlZEUATjZsYXN6aXAyNnVua25vd25fY2h1bmtfdGFibGVfZm9ybWF0RQBjaHVua19zaXplID09IHVpbnQubWF4IGlzIG5vdCBzdXBwb3J0ZWQgYXQgdGhpcyB0aW1lLgBUaGVyZSB3YXMgYSBwcm9ibGVtIHJlYWRpbmcgdGhlIGNodW5rIHRhYmxlAFRoZSBjaHVuayB0YWJsZSB2ZXJzaW9uIG51bWJlciBpcyB1bmtub3duAE42bGFzemlwMTFlbmRfb2ZfZmlsZUUAUmVhY2hlZCBFbmQgb2YgZmlsZQBJbnZhbGlkIG51bWJlciBvZiBzeW1ib2xzAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVM5X0VFTlNfOWFsbG9jYXRvcklTOV9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRUVFAE42bGFzemlwMTl1bmtub3duX3NjaGVtYV90eXBlRQBUaGUgTEFaIHNjaGVtYSBpcyBub3QgcmVjb2duaXplZABONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2ZpZWxkX2RlY29tcHJlc3NvcklOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyMGR5bmFtaWNfZGVjb21wcmVzc29yRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19maWVsZF9kZWNvbXByZXNzb3JJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU0NfRUVOU185YWxsb2NhdG9ySVNDX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19maWVsZF9kZWNvbXByZXNzb3JJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzVmaWVsZElOUzBfM2xhczdwb2ludDEwRU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNDX0VFRUVFRQBONmxhc3ppcDdmb3JtYXRzMTBiYXNlX2ZpZWxkRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTSV9FRU5TXzlhbGxvY2F0b3JJU0lfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl81ZmllbGRJTlMyXzNsYXM3cG9pbnQxMEVOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMF81ZmllbGRJTlMwXzNsYXM3Z3BzdGltZUVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczdncHN0aW1lRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNFX0VFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU0lfRUVOU185YWxsb2NhdG9ySVNJX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfNWZpZWxkSU5TMl8zbGFzN2dwc3RpbWVFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFRUUATjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfNWZpZWxkSU5TMF8zbGFzM3JnYkVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczNyZ2JFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTSV9FRU5TXzlhbGxvY2F0b3JJU0lfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl81ZmllbGRJTlMyXzNsYXMzcmdiRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNFX0VFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzVmaWVsZElOUzBfM2xhczEwZXh0cmFieXRlc0VOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczEwZXh0cmFieXRlc0VOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVNJX0VFTlNfOWFsbG9jYXRvcklTSV9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczEwZXh0cmFieXRlc0VOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzBfNWZpZWxkSU5TMF8zbGFzN3BvaW50MTBFTlMwXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0RfRUVFRUVFRUVFAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTS19FRU5TXzlhbGxvY2F0b3JJU0tfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRUVFRUVFRUUATjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMwXzVmaWVsZElOUzBfM2xhczdwb2ludDEwRU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNEX0VFRUVOU0JfSU5TQ183Z3BzdGltZUVOU0VfSVNIX0VFRUVFRUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU05fRUVOU185YWxsb2NhdG9ySVNOX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyMWR5bmFtaWNfZGVjb21wcmVzc29yMUlOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMF8xOXJlY29yZF9kZWNvbXByZXNzb3JJSk5TMF81ZmllbGRJTlMwXzNsYXM3cG9pbnQxMEVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRF9FRUVFTlNCX0lOU0NfM3JnYkVOU0VfSVNIX0VFRUVFRUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV8zcmdiRU5TR19JU0pfRUVFRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTTl9FRU5TXzlhbGxvY2F0b3JJU05fRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRU5TRF9JTlNFXzNyZ2JFTlNHX0lTSl9FRUVFRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzBfNWZpZWxkSU5TMF8zbGFzN3BvaW50MTBFTlMwXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0RfRUVFRU5TQl9JTlNDXzdncHN0aW1lRU5TRV9JU0hfRUVFRU5TQl9JTlNDXzNyZ2JFTlNFX0lTS19FRUVFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyMWR5bmFtaWNfZGVjb21wcmVzc29yMUlOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl8xOXJlY29yZF9kZWNvbXByZXNzb3JJSk5TMl81ZmllbGRJTlMyXzNsYXM3cG9pbnQxMEVOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRl9FRUVFTlNEX0lOU0VfN2dwc3RpbWVFTlNHX0lTSl9FRUVFTlNEX0lOU0VfM3JnYkVOU0dfSVNNX0VFRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU1FfRUVOU185YWxsb2NhdG9ySVNRX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVOU0RfSU5TRV8zcmdiRU5TR19JU01fRUVFRUVFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUDEwYnVmX3N0cmVhbU5TXzE0ZGVmYXVsdF9kZWxldGVJUzFfRUVOU185YWxsb2NhdG9ySVMxX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJMTBidWZfc3RyZWFtRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTNV9FRU5TXzlhbGxvY2F0b3JJUzVfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZmllbGRfZGVjb21wcmVzc29ySU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRUVFAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2ZpZWxkX2RlY29tcHJlc3NvcklOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVM4X0VFTlNfOWFsbG9jYXRvcklTOF9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZmllbGRfZGVjb21wcmVzc29ySU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJaU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWlFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWlOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElpRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElpTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJaUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJak5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWpFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWpOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElqRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElqTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJakVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJYU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWFFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWFOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElhRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElhTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJYUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJc05TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSXNFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSXNOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElzRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElzTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJc0VFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJaE5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWhFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWhOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZEloRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZEloTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJaEVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJdE5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSXRFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSXROUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZEl0RUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZEl0TlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJdEVFRUVFRUVFADZMQVNaaXAAUDZMQVNaaXAAUEs2TEFTWmlwAGlpAHYAdmkAdmlpaWkAdmlpaQBpaWkAMTNEeW5hbWljTEFTWmlwAFAxM0R5bmFtaWNMQVNaaXAAUEsxM0R5bmFtaWNMQVNaaXAAdm9pZABib29sAGNoYXIAc2lnbmVkIGNoYXIAdW5zaWduZWQgY2hhcgBzaG9ydAB1bnNpZ25lZCBzaG9ydABpbnQAdW5zaWduZWQgaW50AGxvbmcAdW5zaWduZWQgbG9uZwBmbG9hdABkb3VibGUAc3RkOjpzdHJpbmcAc3RkOjpiYXNpY19zdHJpbmc8dW5zaWduZWQgY2hhcj4Ac3RkOjp3c3RyaW5nAHN0ZDo6dTE2c3RyaW5nAHN0ZDo6dTMyc3RyaW5nAGVtc2NyaXB0ZW46OnZhbABlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxjaGFyPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8c2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIHNob3J0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZz4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgbG9uZz4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MTZfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dWludDMyX3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGZsb2F0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxkb3VibGU+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGxvbmcgZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0llRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJZEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWZFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0ltRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJbEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWpFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lpRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJdEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SXNFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0loRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJYUVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWNFRQBOMTBlbXNjcmlwdGVuM3ZhbEUATlN0M19fMjEyYmFzaWNfc3RyaW5nSURpTlNfMTFjaGFyX3RyYWl0c0lEaUVFTlNfOWFsbG9jYXRvcklEaUVFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJRHNOU18xMWNoYXJfdHJhaXRzSURzRUVOU185YWxsb2NhdG9ySURzRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJd05TXzExY2hhcl90cmFpdHNJd0VFTlNfOWFsbG9jYXRvckl3RUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJY05TXzExY2hhcl90cmFpdHNJY0VFTlNfOWFsbG9jYXRvckljRUVFRQAtKyAgIDBYMHgAKG51bGwpAC0wWCswWCAwWC0weCsweCAweABpbmYASU5GAG5hbgBOQU4ALgB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzOiAlcwB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzAHRlcm1pbmF0aW5nIHdpdGggJXMgZm9yZWlnbiBleGNlcHRpb24AdGVybWluYXRpbmcAdW5jYXVnaHQAU3Q5ZXhjZXB0aW9uAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAHRlcm1pbmF0ZV9oYW5kbGVyIHVuZXhwZWN0ZWRseSByZXR1cm5lZABzdGQ6OmJhZF9hbGxvYwBTdDliYWRfYWxsb2MAU3QxMWxvZ2ljX2Vycm9yAFN0MTNydW50aW1lX2Vycm9yAFN0MTJsZW5ndGhfZXJyb3IAU3QxMm91dF9vZl9yYW5nZQBOMTBfX2N4eGFiaXYxMTdfX3BiYXNlX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE5X19wb2ludGVyX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTIwX19mdW5jdGlvbl90eXBlX2luZm9FAE4xMF9fY3h4YWJpdjEyOV9fcG9pbnRlcl90b19tZW1iZXJfdHlwZV9pbmZvRQBQdXJlIHZpcnR1YWwgZnVuY3Rpb24gY2FsbGVkIQBOMTBfX2N4eGFiaXYxMjNfX2Z1bmRhbWVudGFsX3R5cGVfaW5mb0UAdgBEbgBiAGMAaABhAHMAdABpAGoAbABtAGYAZABOMTBfX2N4eGFiaXYxMjFfX3ZtaV9jbGFzc190eXBlX2luZm9FAF9fY3hhX2d1YXJkX2FjcXVpcmUgZGV0ZWN0ZWQgcmVjdXJzaXZlIGluaXRpYWxpemF0aW9uAHN0ZDo6YmFkX2Z1bmN0aW9uX2NhbGwATlN0M19fMjE3YmFkX2Z1bmN0aW9uX2NhbGxFAE5TdDNfXzIxNF9fc2hhcmVkX2NvdW50RQBOU3QzX18yMTlfX3NoYXJlZF93ZWFrX2NvdW50RQBtdXRleCBsb2NrIGZhaWxlZABiYXNpY19zdHJpbmcAdW5zcGVjaWZpZWQgZ2VuZXJpY19jYXRlZ29yeSBlcnJvcgBVbmtub3duIGVycm9yICVkAGdlbmVyaWMATlN0M19fMjI0X19nZW5lcmljX2Vycm9yX2NhdGVnb3J5RQBOU3QzX18yMTJfX2RvX21lc3NhZ2VFAE5TdDNfXzIxNGVycm9yX2NhdGVnb3J5RQB1bnNwZWNpZmllZCBzeXN0ZW1fY2F0ZWdvcnkgZXJyb3IAc3lzdGVtAE5TdDNfXzIyM19fc3lzdGVtX2Vycm9yX2NhdGVnb3J5RQBOU3QzX18yMTJzeXN0ZW1fZXJyb3JFADogAHZlY3Rvcg==";var Y={};function q(e){e&&Y[e].refcount++}function $(e){if(!e||Y[e])return e;for(var t in Y)for(var n=+t,r=Y[n].adjusted,i=r.length,s=0;s<i;s++)if(r[s]===e)return n;return e}function ee(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var te=void 0;function ne(e){for(var t="",n=e;B[n];)t+=te[B[n++]];return t}var re={},ie={},se={};function ae(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function oe(e,t){return e=ae(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function Ae(e,t){var n=oe(t,(function(e){this.name=t,this.message=e;var n=new Error(e).stack;void 0!==n&&(this.stack=this.toString()+"\n"+n.replace(/^Error(:[^\n]*)?\n/,""))}));return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},n}var ce=void 0;function le(e){throw new ce(e)}var ue=void 0;function he(e){throw new ue(e)}function de(e,t,n){function r(t){var r=n(t);r.length!==e.length&&he("Mismatched type converter count");for(var i=0;i<e.length;++i)fe(e[i],r[i])}e.forEach((function(e){se[e]=t}));var i=new Array(t.length),s=[],a=0;t.forEach((function(e,t){ie.hasOwnProperty(e)?i[t]=ie[e]:(s.push(e),re.hasOwnProperty(e)||(re[e]=[]),re[e].push((function(){i[t]=ie[e],++a===s.length&&r(i)})))})),0===s.length&&r(i)}function fe(e,t,n){if(n=n||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var r=t.name;if(e||le('type "'+r+'" must have a positive integer typeid pointer'),ie.hasOwnProperty(e)){if(n.ignoreDuplicateRegistrations)return;le("Cannot register type '"+r+"' twice")}if(ie[e]=t,delete se[e],re.hasOwnProperty(e)){var i=re[e];delete re[e],i.forEach((function(e){e()}))}}function pe(e){if(!(this instanceof Fe))return!1;if(!(e instanceof Fe))return!1;for(var t=this.$$.ptrType.registeredClass,n=this.$$.ptr,r=e.$$.ptrType.registeredClass,i=e.$$.ptr;t.baseClass;)n=t.upcast(n),t=t.baseClass;for(;r.baseClass;)i=r.upcast(i),r=r.baseClass;return t===r&&n===i}function ve(e){le(e.$$.ptrType.registeredClass.name+" instance already deleted")}var ge=!1;function me(e){}function ye(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function _e(e){return"undefined"==typeof FinalizationGroup?(_e=function(e){return e},e):(ge=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var n=t.value;n.ptr?ye(n):console.warn("object already deleted: "+n.ptr)}})),_e=function(e){return ge.register(e,e.$$,e.$$),e},me=function(e){ge.unregister(e.$$)},_e(e))}function be(){if(this.$$.ptr||ve(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=_e(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function we(){this.$$.ptr||ve(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&le("Object already scheduled for deletion"),me(this),ye(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function Be(){return!this.$$.ptr}var Ce=void 0,Me=[];function ke(){for(;Me.length;){var e=Me.pop();e.$$.deleteScheduled=!1,e.delete()}}function Ee(){return this.$$.ptr||ve(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&le("Object already scheduled for deletion"),Me.push(this),1===Me.length&&Ce&&Ce(ke),this.$$.deleteScheduled=!0,this}function Fe(){}var xe={};function Ue(e,t,n){if(void 0===e[t].overloadTable){var r=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||le("Function '"+n+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[r.argCount]=r}}function Ie(e,t,n,r,i,s,a,o){this.name=e,this.constructor=t,this.instancePrototype=n,this.rawDestructor=r,this.baseClass=i,this.getActualType=s,this.upcast=a,this.downcast=o,this.pureVirtualFunctions=[]}function Te(e,t,n){for(;t!==n;)t.upcast||le("Expected null or instance of "+n.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Pe(e,t){if(null===t)return this.isReference&&le("null is not a valid "+this.name),0;t.$$||le('Cannot pass "'+At(t)+'" as a '+this.name),t.$$.ptr||le("Cannot pass deleted object as a pointer of type "+this.name);var n=t.$$.ptrType.registeredClass;return Te(t.$$.ptr,n,this.registeredClass)}function Se(e,t){var n;if(null===t)return this.isReference&&le("null is not a valid "+this.name),this.isSmartPointer?(n=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,n),n):0;t.$$||le('Cannot pass "'+At(t)+'" as a '+this.name),t.$$.ptr||le("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&le("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var r=t.$$.ptrType.registeredClass;if(n=Te(t.$$.ptr,r,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&le("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?n=t.$$.smartPtr:le("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:n=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)n=t.$$.smartPtr;else{var i=t.clone();n=this.rawShare(n,ot((function(){i.delete()}))),null!==e&&e.push(this.rawDestructor,n)}break;default:le("Unsupporting sharing policy")}return n}function De(e,t){if(null===t)return this.isReference&&le("null is not a valid "+this.name),0;t.$$||le('Cannot pass "'+At(t)+'" as a '+this.name),t.$$.ptr||le("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&le("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var n=t.$$.ptrType.registeredClass;return Te(t.$$.ptr,n,this.registeredClass)}function Qe(e){return this.fromWireType(F[e>>2])}function Re(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Oe(e){this.rawDestructor&&this.rawDestructor(e)}function Ve(e){null!==e&&e.delete()}function Le(e,t,n){if(t===n)return e;if(void 0===n.baseClass)return null;var r=Le(e,t,n.baseClass);return null===r?null:n.downcast(r)}function He(){return Object.keys(je).length}function Ne(){var e=[];for(var t in je)je.hasOwnProperty(t)&&e.push(je[t]);return e}function Ge(e){Ce=e,Me.length&&Ce&&Ce(ke)}var je={};function We(e,t){return t=function(e,t){for(void 0===t&&le("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),je[t]}function ze(e,t){return t.ptrType&&t.ptr||he("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!==!!t.smartPtr&&he("Both smartPtrType and smartPtr must be specified"),t.count={value:1},_e(Object.create(e,{$$:{value:t}}))}function Xe(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var n=We(this.registeredClass,t);if(void 0!==n){if(0===n.$$.count.value)return n.$$.ptr=t,n.$$.smartPtr=e,n.clone();var r=n.clone();return this.destructor(e),r}function i(){return this.isSmartPointer?ze(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):ze(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var s,a=this.registeredClass.getActualType(t),o=xe[a];if(!o)return i.call(this);s=this.isConst?o.constPointerType:o.pointerType;var A=Le(t,this.registeredClass,s.registeredClass);return null===A?i.call(this):this.isSmartPointer?ze(s.registeredClass.instancePrototype,{ptrType:s,ptr:A,smartPtrType:this,smartPtr:e}):ze(s.registeredClass.instancePrototype,{ptrType:s,ptr:A})}function Ke(e,t,n,r,i,s,a,o,A,c,l){this.name=e,this.registeredClass=t,this.isReference=n,this.isConst=r,this.isSmartPointer=i,this.pointeeType=s,this.sharingPolicy=a,this.rawGetPointee=o,this.rawConstructor=A,this.rawShare=c,this.rawDestructor=l,i||void 0!==t.baseClass?this.toWireType=Se:r?(this.toWireType=Pe,this.destructorFunction=null):(this.toWireType=De,this.destructorFunction=null)}function Ze(e,n){e=ne(e);var r=function(t){for(var r=[],i=1;i<e.length;++i)r.push("a"+i);var s="return function "+("dynCall_"+e+"_"+n)+"("+r.join(", ")+") {\n";return s+="    return dynCall(rawFunction"+(r.length?", ":"")+r.join(", ")+");\n",s+="};\n",new Function("dynCall","rawFunction",s)(t,n)}(t["dynCall_"+e]);return"function"!=typeof r&&le("unknown function pointer with signature "+e+": "+n),r}var Je=void 0;function Ye(e){var t=gt(e),n=ne(t);return mt(t),n}function qe(e,t){var n=[],r={};throw t.forEach((function e(t){r[t]||ie[t]||(se[t]?se[t].forEach(e):(n.push(t),r[t]=!0))})),new Je(e+": "+n.map(Ye).join([", "]))}function $e(e,t){for(var n=[],r=0;r<e;r++)n.push(E[(t>>2)+r]);return n}function et(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function tt(e,t,n,r,i){var s=t.length;s<2&&le("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var a=null!==t[1]&&null!==n,o=!1,A=1;A<t.length;++A)if(null!==t[A]&&void 0===t[A].destructorFunction){o=!0;break}var c="void"!==t[0].name,l="",u="";for(A=0;A<s-2;++A)l+=(0!==A?", ":"")+"arg"+A,u+=(0!==A?", ":"")+"arg"+A+"Wired";var h="return function "+ae(e)+"("+l+") {\nif (arguments.length !== "+(s-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(s-2)+" args!');\n}\n";o&&(h+="var destructors = [];\n");var d=o?"destructors":"null",f=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],p=[le,r,i,et,t[0],t[1]];a&&(h+="var thisWired = classParam.toWireType("+d+", this);\n");for(A=0;A<s-2;++A)h+="var arg"+A+"Wired = argType"+A+".toWireType("+d+", arg"+A+"); // "+t[A+2].name+"\n",f.push("argType"+A),p.push(t[A+2]);if(a&&(u="thisWired"+(u.length>0?", ":"")+u),h+=(c?"var rv = ":"")+"invoker(fn"+(u.length>0?", ":"")+u+");\n",o)h+="runDestructors(destructors);\n";else for(A=a?1:2;A<t.length;++A){var v=1===A?"thisWired":"arg"+(A-2)+"Wired";null!==t[A].destructorFunction&&(h+=v+"_dtor("+v+"); // "+t[A].name+"\n",f.push(v+"_dtor"),p.push(t[A].destructorFunction))}return c&&(h+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),h+="}\n",f.push(h),function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+M(e)+" which is not a function");var n=oe(e.name||"unknownFunctionName",(function(){}));n.prototype=e.prototype;var r=new n,i=e.apply(r,t);return i instanceof Object?i:r}(Function,f).apply(null,p)}var nt=[],rt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function it(e){e>4&&0==--rt[e].refcount&&(rt[e]=void 0,nt.push(e))}function st(){for(var e=0,t=5;t<rt.length;++t)void 0!==rt[t]&&++e;return e}function at(){for(var e=5;e<rt.length;++e)if(void 0!==rt[e])return rt[e];return null}function ot(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=nt.length?nt.pop():rt.length;return rt[t]={refcount:1,value:e},t}}function At(e){if(null===e)return"null";var t=M(e);return"object"===t||"array"===t||"function"===t?e.toString():""+e}function ct(e,t){switch(t){case 2:return function(e){return this.fromWireType(x[e>>2])};case 3:return function(e){return this.fromWireType(U[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function lt(e,t,n){switch(t){case 0:return n?function(e){return w[e]}:function(e){return B[e]};case 1:return n?function(e){return C[e>>1]}:function(e){return k[e>>1]};case 2:return n?function(e){return E[e>>2]}:function(e){return F[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function ut(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r>255&&(r&=255),t.push(String.fromCharCode(r))}return t.join("")}!function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);te=e}(),ce=t.BindingError=Ae(Error,"BindingError"),ue=t.InternalError=Ae(Error,"InternalError"),Fe.prototype.isAliasOf=pe,Fe.prototype.clone=be,Fe.prototype.delete=we,Fe.prototype.isDeleted=Be,Fe.prototype.deleteLater=Ee,Ke.prototype.getPointee=Re,Ke.prototype.destructor=Oe,Ke.prototype.argPackAdvance=8,Ke.prototype.readValueFromPointer=Qe,Ke.prototype.deleteObject=Ve,Ke.prototype.fromWireType=Xe,t.getInheritedInstanceCount=He,t.getLiveInheritedInstances=Ne,t.flushPendingDeletes=ke,t.setDelayFunction=Ge,Je=t.UnboundTypeError=Ae(Error,"UnboundTypeError"),t.count_emval_handles=st,t.get_first_emval=at;var ht="function"==typeof atob?atob:function(e){var t,n,r,i,s,a,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",A="",c=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=o.indexOf(e.charAt(c++))<<2|(i=o.indexOf(e.charAt(c++)))>>4,n=(15&i)<<4|(s=o.indexOf(e.charAt(c++)))>>2,r=(3&s)<<6|(a=o.indexOf(e.charAt(c++))),A+=String.fromCharCode(t),64!==s&&(A+=String.fromCharCode(n)),64!==a&&(A+=String.fromCharCode(r))}while(c<e.length);return A};function dt(e){if(J(e))return function(e){if("boolean"==typeof s&&s){var t;try{t=Buffer.from(e,"base64")}catch(n){t=new Buffer(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var n=ht(e),r=new Uint8Array(n.length),i=0;i<n.length;++i)r[i]=n.charCodeAt(i);return r}catch(e){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(Z.length))}var ft={A:function(e,t,n){B.copyWithin(e,t,t+n)},B:function(e){X("OOM")},C:function(){X("trap!")},D:22368,a:X,b:function(e){v=e},c:function(){return v},d:function(e){return yt(e)},e:function(e){var t=Y[e];return t&&!t.caught&&(t.caught=!0,vt.uncaught_exceptions--),t&&(t.rethrown=!1),q($(e)),e},f:function(e,t,n){throw Y[e]={ptr:e,adjusted:[e],type:t,destructor:n,refcount:0,caught:!1,rethrown:!1},"uncaught_exception"in vt?vt.uncaught_exceptions++:vt.uncaught_exceptions=1,e},g:function(){return vt.uncaught_exceptions},h:q,i:$,j:function(){},k:function(e,t,n,r,i){var s=ee(n);fe(e,{name:t=ne(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?r:i},argPackAdvance:8,readValueFromPointer:function(e){var r;if(1===n)r=w;else if(2===n)r=C;else{if(4!==n)throw new TypeError("Unknown boolean type size: "+t);r=E}return this.fromWireType(r[e>>s])},destructorFunction:null})},l:function(e,n,r,i,s,a,o,A,c,l,u,h,d){u=ne(u),a=Ze(s,a),A&&(A=Ze(o,A)),l&&(l=Ze(c,l)),d=Ze(h,d);var f=ae(u);!function(e,n,r){t.hasOwnProperty(e)?((void 0===r||void 0!==t[e].overloadTable&&void 0!==t[e].overloadTable[r])&&le("Cannot register public name '"+e+"' twice"),Ue(t,e,e),t.hasOwnProperty(r)&&le("Cannot register multiple overloads of a function with the same number of arguments ("+r+")!"),t[e].overloadTable[r]=n):(t[e]=n,void 0!==r&&(t[e].numArguments=r))}(f,(function(){qe("Cannot construct "+u+" due to unbound types",[i])})),de([e,n,r],i?[i]:[],(function(n){var r,s;n=n[0],s=i?(r=n.registeredClass).instancePrototype:Fe.prototype;var o=oe(f,(function(){if(Object.getPrototypeOf(this)!==c)throw new ce("Use 'new' to construct "+u);if(void 0===h.constructor_body)throw new ce(u+" has no accessible constructor");var e=h.constructor_body[arguments.length];if(void 0===e)throw new ce("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(h.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),c=Object.create(s,{constructor:{value:o}});o.prototype=c;var h=new Ie(u,o,c,d,r,a,A,l),p=new Ke(u,h,!0,!1,!1),v=new Ke(u+"*",h,!1,!1,!1),g=new Ke(u+" const*",h,!1,!0,!1);return xe[e]={pointerType:v,constPointerType:g},function(e,n,r){t.hasOwnProperty(e)||he("Replacing nonexistant public symbol"),void 0!==t[e].overloadTable&&void 0!==r?t[e].overloadTable[r]=n:(t[e]=n,t[e].argCount=r)}(f,o),[p,v,g]}))},m:function(e,t,n,r,i,s){m(t>0);var a=$e(t,n);i=Ze(r,i);var o=[s],A=[];de([],[e],(function(e){var n="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new ce("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){qe("Cannot construct "+e.name+" due to unbound types",a)},de([],a,(function(r){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&le(n+" called with "+arguments.length+" arguments, expected "+(t-1)),A.length=0,o.length=t;for(var e=1;e<t;++e)o[e]=r[e].toWireType(A,arguments[e-1]);var s=i.apply(null,o);return et(A),r[0].fromWireType(s)},[]})),[]}))},n:function(e,t,n,r,i,s,a,o){var A=$e(n,r);t=ne(t),s=Ze(i,s),de([],[e],(function(e){var r=(e=e[0]).name+"."+t;function i(){qe("Cannot call "+r+" due to unbound types",A)}o&&e.registeredClass.pureVirtualFunctions.push(t);var c=e.registeredClass.instancePrototype,l=c[t];return void 0===l||void 0===l.overloadTable&&l.className!==e.name&&l.argCount===n-2?(i.argCount=n-2,i.className=e.name,c[t]=i):(Ue(c,t,r),c[t].overloadTable[n-2]=i),de([],A,(function(i){var o=tt(r,i,e,s,a);return void 0===c[t].overloadTable?(o.argCount=n-2,c[t]=o):c[t].overloadTable[n-2]=o,[]})),[]}))},o:function(e,t){fe(e,{name:t=ne(t),fromWireType:function(e){var t=rt[e].value;return it(e),t},toWireType:function(e,t){return ot(t)},argPackAdvance:8,readValueFromPointer:Qe,destructorFunction:null})},p:function(e,t,n){var r=ee(n);fe(e,{name:t=ne(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+At(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:ct(t,r),destructorFunction:null})},q:function(e,t,n,r,i){t=ne(t),-1===i&&(i=4294967295);var s=ee(n),a=function(e){return e};if(0===r){var o=32-8*n;a=function(e){return e<<o>>>o}}var A=-1!=t.indexOf("unsigned");fe(e,{name:t,fromWireType:a,toWireType:function(e,n){if("number"!=typeof n&&"boolean"!=typeof n)throw new TypeError('Cannot convert "'+At(n)+'" to '+this.name);if(n<r||n>i)throw new TypeError('Passing a number "'+At(n)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+r+", "+i+"]!");return A?n>>>0:0|n},argPackAdvance:8,readValueFromPointer:lt(t,s,0!==r),destructorFunction:null})},r:function(e,t,n){var r=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function i(e){var t=F,n=t[e>>=2],i=t[e+1];return new r(b,i,n)}fe(e,{name:n=ne(n),fromWireType:i,argPackAdvance:8,readValueFromPointer:i},{ignoreDuplicateRegistrations:!0})},s:function(e,t){var n="std::string"===(t=ne(t));fe(e,{name:t,fromWireType:function(e){var t,r=F[e>>2];if(n)for(var i=e+4,s=0;s<=r;++s){var a=e+4+s;if(0==B[a]||s==r){var o=_(i,a-i);void 0===t?t=o:(t+=String.fromCharCode(0),t+=o),i=a+1}}else{var A=new Array(r);for(s=0;s<r;++s)A[s]=String.fromCharCode(B[e+4+s]);t=A.join("")}return mt(e),t},toWireType:function(e,t){var r;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var i="string"==typeof t;i||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||le("Cannot pass non-string to std::string"),r=n&&i?function(){return function(e){for(var t=0,n=0;n<e.length;++n){var r=e.charCodeAt(n);r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&e.charCodeAt(++n)),r<=127?++t:t+=r<=2047?2:r<=65535?3:4}return t}(t)}:function(){return t.length};var s=r(),a=yt(4+s+1);if(F[a>>2]=s,n&&i)(function(e,t,n,r){if(!(r>0))return 0;for(var i=n,s=n+r-1,a=0;a<e.length;++a){var o=e.charCodeAt(a);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++a)),o<=127){if(n>=s)break;t[n++]=o}else if(o<=2047){if(n+1>=s)break;t[n++]=192|o>>6,t[n++]=128|63&o}else if(o<=65535){if(n+2>=s)break;t[n++]=224|o>>12,t[n++]=128|o>>6&63,t[n++]=128|63&o}else{if(n+3>=s)break;t[n++]=240|o>>18,t[n++]=128|o>>12&63,t[n++]=128|o>>6&63,t[n++]=128|63&o}}t[n]=0})(t,B,a+4,s+1);else if(i)for(var o=0;o<s;++o){var A=t.charCodeAt(o);A>255&&(mt(a),le("String has UTF-16 code units that do not fit in 8 bits")),B[a+4+o]=A}else for(o=0;o<s;++o)B[a+4+o]=t[o];return null!==e&&e.push(mt,a),a},argPackAdvance:8,readValueFromPointer:Qe,destructorFunction:function(e){mt(e)}})},t:function(e,t,n){var r,i,s,a,o;n=ne(n),2===t?(r=T,i=P,a=S,s=function(){return k},o=1):4===t&&(r=D,i=Q,a=R,s=function(){return F},o=2),fe(e,{name:n,fromWireType:function(e){for(var n,i=F[e>>2],a=s(),A=e+4,c=0;c<=i;++c){var l=e+4+c*t;if(0==a[l>>o]||c==i){var u=r(A,l-A);void 0===n?n=u:(n+=String.fromCharCode(0),n+=u),A=l+t}}return mt(e),n},toWireType:function(e,r){"string"!=typeof r&&le("Cannot pass non-string to C++ string type "+n);var s=a(r),A=yt(4+s+t);return F[A>>2]=s>>o,i(r,A+4,s+t),null!==e&&e.push(mt,A),A},argPackAdvance:8,readValueFromPointer:Qe,destructorFunction:function(e){mt(e)}})},u:function(e,t){fe(e,{isVoid:!0,name:t=ne(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},v:it,w:ot,x:function(){X()},y:At,z:function(){return B.length}},pt=function(e,t,n){"use asm";var r=new e.Int8Array(n),i=new e.Int16Array(n),s=new e.Int32Array(n),a=new e.Uint8Array(n),o=new e.Uint16Array(n),A=new e.Float32Array(n),c=new e.Float64Array(n),l=t.D|0,u=0,h=0,d=0,f=0,p=0,v=0,g=0,m=0.0,y=e.Math.imul,_=e.Math.clz32,b=t.a,w=t.b,B=t.c,C=t.d,M=t.e,k=t.f,E=t.g,F=t.h,x=t.i,U=t.j,I=t.k,T=t.l,P=t.m,S=t.n,D=t.o,Q=t.p,R=t.q,O=t.r,V=t.s,L=t.t,H=t.u,N=t.v,G=t.w,j=t.x,W=t.y,z=t.z,X=t.A,K=t.B,Z=t.C,J=22384,Y=5265264,q=0.0;function $(){Ju();Yu()}function ee(){te(0);return}function te(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0;e=J;J=J+16|0;t=e+8|0;n=e;dl();h=pl()|0;a=vl()|0;i=ml()|0;o=yl()|0;A=_l()|0;c=bl()|0;l=El()|0;u=Fl()|0;r=Fl()|0;T(i|0,o|0,A|0,c|0,l|0,9,u|0,h|0,r|0,a|0,6204,xl()|0,138);Il(1);s[n>>2]=5;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];Ol(6211,t);s[n>>2]=3;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];Kl(6216,t);s[n>>2]=10;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];nu(6225,t);lu();a=hu()|0;r=du()|0;h=pu()|0;u=vu()|0;l=gu()|0;c=bl()|0;A=El()|0;o=Fl()|0;i=Fl()|0;T(h|0,u|0,l|0,c|0,A|0,11,o|0,a|0,i|0,r|0,6234,xl()|0,139);Cu(2);s[n>>2]=6;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];Iu(6211,t);s[n>>2]=4;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];Ou(6248,t);s[n>>2]=5;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];Ou(6265,t);s[n>>2]=6;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];Ou(6280,t);s[n>>2]=7;s[n+4>>2]=0;s[t>>2]=s[n>>2];s[t+4>>2]=s[n+4>>2];ju(6216,t);J=e;return}function ne(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,A=0;r=J;J=J+32|0;o=r+16|0;i=r+8|0;A=r;a=Zp(20)|0;le(a,t,n);s[A>>2]=0;s[o>>2]=s[A>>2];he(i,a,o);t=s[i>>2]|0;s[i>>2]=s[e>>2];s[e>>2]=t;t=i+4|0;n=e+4|0;a=s[t>>2]|0;s[t>>2]=s[n>>2];s[n>>2]=a;de(i);n=Zp(352)|0;ue(n,s[e>>2]|0);a=e+8|0;s[A>>2]=0;s[o>>2]=s[A>>2];we(i,n,o);n=s[i>>2]|0;s[i>>2]=s[a>>2];s[a>>2]=n;a=i+4|0;n=e+12|0;t=s[a>>2]|0;s[a>>2]=s[n>>2];s[n>>2]=t;Be(i);J=r;return}function re(e,t){e=e|0;t=t|0;Zn(s[e+8>>2]|0,t);return}function ie(e){e=e|0;e=(So(s[e+8>>2]|0)|0)+107|0;return a[e>>0]|a[e+1>>0]<<8|a[e+2>>0]<<16|a[e+3>>0]<<24|0}function se(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,A=0;r=J;J=J+32|0;a=r+16|0;i=r+8|0;o=r;A=Zp(12)|0;Do(A,t,n);s[o>>2]=0;s[a>>2]=s[o>>2];Vo(i,A,a);A=s[i>>2]|0;s[i>>2]=s[e>>2];s[e>>2]=A;A=i+4|0;n=e+4|0;t=s[A>>2]|0;s[A>>2]=s[n>>2];s[n>>2]=t;Lo(i);n=e+8|0;t=Zp(12)|0;Qo(t,s[e>>2]|0);s[o>>2]=0;s[a>>2]=s[o>>2];zo(i,t,a);t=s[i>>2]|0;s[i>>2]=s[n>>2];s[n>>2]=t;t=i+4|0;o=e+12|0;A=s[t>>2]|0;s[t>>2]=s[o>>2];s[o>>2]=A;Xo(i);Ro(i,s[n>>2]|0);n=e+16|0;o=s[i>>2]|0;A=i+4|0;t=s[A>>2]|0;s[i>>2]=0;s[A>>2]=0;s[a>>2]=s[n>>2];s[n>>2]=o;n=e+20|0;s[a+4>>2]=s[n>>2];s[n>>2]=t;Oo(a);Oo(i);J=r;return}function ae(e,t){e=e|0;t=t|0;var n=0;e=e+16|0;n=s[e>>2]|0;e:do{if(n|0)switch(t|0){case 4:{hA(n);break e}case 8:{dA(n);dA(s[e>>2]|0);break e}default:break e}}while(0);return}function oe(e,t){e=e|0;t=t|0;var n=0;n=e+16|0;e=s[n>>2]|0;e:do{if(e|0){switch(t|0){case 1:{$A(e);break e}case 2:{ec(e);break e}case 8:{hA(e);e=s[n>>2]|0;break}case 4:break;default:break e}hA(e)}}while(0);return}function Ae(e,t){e=e|0;t=t|0;var n=0;n=e+16|0;e=s[n>>2]|0;e:do{if(e|0){switch(t|0){case 1:{Dc(e);break e}case 2:{Qc(e);break e}case 8:{dA(e);e=s[n>>2]|0;break}case 4:break;default:break e}dA(e)}}while(0);return}function ce(e,t){e=e|0;t=t|0;e=s[e+16>>2]|0;if(e|0)Hg[s[s[e>>2]>>2]&63](e,t)|0;return}function le(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;s[e+4>>2]=n;s[e+8>>2]=0;r[e+12>>0]=0;r[e+13>>0]=0;s[e+16>>2]=0;return}function ue(e,t){e=e|0;t=t|0;s[e>>2]=t;Oe(e+4|0,t);Ve(e+247|0);s[e+288>>2]=0;s[e+292>>2]=0;s[e+296>>2]=0;Le(e+300|0);t=e+312|0;s[t>>2]=0;s[t+4>>2]=0;s[t+8>>2]=0;s[t+12>>2]=0;He(e+328|0);Ne(e);return}function he(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4296;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;fe(e,r);J=n;return}function de(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function fe(e,t){e=e|0;t=t|0;return}function pe(e){e=e|0;M(e|0)|0;np()}function ve(e){e=e|0;av(e);ep(e);return}function ge(e){e=e|0;e=s[e+12>>2]|0;if(e|0)ep(e);return}function me(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==6407?e+12|0:0)|0}function ye(e){e=e|0;_e(e,16);return}function _e(e,t){e=e|0;t=t|0;be(e);return}function be(e){e=e|0;ep(e);return}function we(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4324;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Ce(e,r);J=n;return}function Be(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Ce(e,t){e=e|0;t=t|0;return}function Me(e){e=e|0;av(e);ep(e);return}function ke(e){e=e|0;e=s[e+12>>2]|0;if(e|0){xe(e);ep(e)}return}function Ee(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==6605?e+12|0:0)|0}function Fe(e){e=e|0;_e(e,16);return}function xe(e){e=e|0;Ue(e+320|0);Ie(e+312|0);Te(e+300|0);Qe(e+288|0);Pe(e+247|0);Se(e+4|0);return}function Ue(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Ie(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Te(e){e=e|0;De(e);return}function Pe(e){e=e|0;e=e+34|0;e=a[e>>0]|a[e+1>>0]<<8|a[e+2>>0]<<16|a[e+3>>0]<<24;if(e|0)Yp(e);return}function Se(e){e=e|0;Re(s[e+12>>2]|0);return}function De(e){e=e|0;var t=0,n=0;t=s[e>>2]|0;n=t;if(t|0){s[e+4>>2]=n;_e(t,(s[e+8>>2]|0)-n|0)}return}function Qe(e){e=e|0;var t=0,n=0;t=s[e>>2]|0;n=t;if(t|0){s[e+4>>2]=n;_e(t,(s[e+8>>2]|0)-n|0)}return}function Re(e){e=e|0;Zv(s[e+-4>>2]|0);return}function Oe(e,t){e=e|0;t=t|0;s[e>>2]=t;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=Ge(1048576)|0;return}function Ve(e){e=e|0;var t=0;t=e+32|0;r[t>>0]=0;r[t+1>>0]=0;e=e+34|0;r[e>>0]=0;r[e+1>>0]=0;r[e+2>>0]=0;r[e+3>>0]=0;return}function Le(e){e=e|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;return}function He(e){e=e|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=0;e=e+16|0;s[e>>2]=-1;s[e+4>>2]=-1;return}function Ne(e){e=e|0;var t=0,n=0,i=0,a=0,o=0,A=0;A=J;J=J+64|0;a=A+32|0;n=A+56|0;t=A+16|0;o=A;je(s[e>>2]|0,n,4);rt(a,n,n+4|0);n=nt(6693)|0;i=r[a+11>>0]|0;if((n|0)==((i<<24>>24<0?s[a+4>>2]|0:i&255)|0)){i=(Cv(a,0,-1,6693,n)|0)==0;yv(a);if(i){n=s[e>>2]|0;s[t>>2]=0;s[t+4>>2]=0;s[t+8>>2]=0;s[t+12>>2]=0;s[a>>2]=s[t>>2];s[a+4>>2]=s[t+4>>2];s[a+8>>2]=s[t+8>>2];s[a+12>>2]=s[t+12>>2];ze(n,a);n=e+20|0;je(s[e>>2]|0,n,227);Xe(e,n);i=Ke()|0;t=s[i>>2]|0;i=s[i+4>>2]|0;if((t|0)!=(i|0))do{Ze(a,t);Je(a,n);Ye(a);t=t+24|0}while((t|0)!=(i|0));qe(e);$e(e);et(s[e>>2]|0);i=s[e>>2]|0;t=(s[e+116>>2]|0)+8|0;n=o;s[n>>2]=0;s[n+4>>2]=0;n=o+8|0;s[n>>2]=t;s[n+4>>2]=0;s[a>>2]=s[o>>2];s[a+4>>2]=s[o+4>>2];s[a+8>>2]=s[o+8>>2];s[a+12>>2]=s[o+12>>2];ze(i,a);tt(e+4|0);J=A;return}}else yv(a);A=C(8)|0;We(A);k(A|0,2592,8)}function Ge(e){e=e|0;var t=0;t=Kv(e+68|0)|0;e=t+68&-64;s[e+-4>>2]=t;return e|0}function je(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0,c=0,l=0;A=e+13|0;if(!(r[A>>0]|0)){o=e+4|0;i=s[o>>2]|0;c=e+8|0;a=s[c>>2]|0;l=i-a|0;n=(l|0)<(n|0)?l:n;if(n){hg(t|0,(s[e>>2]|0)+a|0,n|0)|0;a=s[c>>2]|0;i=s[o>>2]|0}l=a+n|0;s[c>>2]=l;s[e+16>>2]=n;if((l|0)>=(i|0))r[A>>0]=1}else r[e+12>>0]=1;return}function We(e){e=e|0;fv(e,6791);s[e>>2]=4352;return}function ze(e,t){e=e|0;t=t|0;var n=0,i=0,a=0;a=t+8|0;t=s[a>>2]|0;a=s[a+4>>2]|0;n=s[e+4>>2]|0;i=((n|0)<0)<<31>>31;if((a|0)<(i|0)|(a|0)==(i|0)&t>>>0<n>>>0)s[e+8>>2]=t;else r[e+12>>0]=1;return}function Xe(e,t){e=e|0;t=t|0;var n=0.0,i=0.0,s=0,a=0.0,o=0,A=0.0,u=0,h=0.0,d=0,f=0.0;d=t+179|0;r[l>>0]=r[d>>0];r[l+1>>0]=r[d+1>>0];r[l+2>>0]=r[d+2>>0];r[l+3>>0]=r[d+3>>0];r[l+4>>0]=r[d+4>>0];r[l+5>>0]=r[d+5>>0];r[l+6>>0]=r[d+6>>0];r[l+7>>0]=r[d+7>>0];h=+c[l>>3];o=t+187|0;r[l>>0]=r[o>>0];r[l+1>>0]=r[o+1>>0];r[l+2>>0]=r[o+2>>0];r[l+3>>0]=r[o+3>>0];r[l+4>>0]=r[o+4>>0];r[l+5>>0]=r[o+5>>0];r[l+6>>0]=r[o+6>>0];r[l+7>>0]=r[o+7>>0];f=+c[l>>3];e=t+195|0;r[l>>0]=r[e>>0];r[l+1>>0]=r[e+1>>0];r[l+2>>0]=r[e+2>>0];r[l+3>>0]=r[e+3>>0];r[l+4>>0]=r[e+4>>0];r[l+5>>0]=r[e+5>>0];r[l+6>>0]=r[e+6>>0];r[l+7>>0]=r[e+7>>0];a=+c[l>>3];u=t+203|0;r[l>>0]=r[u>>0];r[l+1>>0]=r[u+1>>0];r[l+2>>0]=r[u+2>>0];r[l+3>>0]=r[u+3>>0];r[l+4>>0]=r[u+4>>0];r[l+5>>0]=r[u+5>>0];r[l+6>>0]=r[u+6>>0];r[l+7>>0]=r[u+7>>0];A=+c[l>>3];s=t+211|0;r[l>>0]=r[s>>0];r[l+1>>0]=r[s+1>>0];r[l+2>>0]=r[s+2>>0];r[l+3>>0]=r[s+3>>0];r[l+4>>0]=r[s+4>>0];r[l+5>>0]=r[s+5>>0];r[l+6>>0]=r[s+6>>0];r[l+7>>0]=r[s+7>>0];n=+c[l>>3];t=t+219|0;r[l>>0]=r[t>>0];r[l+1>>0]=r[t+1>>0];r[l+2>>0]=r[t+2>>0];r[l+3>>0]=r[t+3>>0];r[l+4>>0]=r[t+4>>0];r[l+5>>0]=r[t+5>>0];r[l+6>>0]=r[t+6>>0];r[l+7>>0]=r[t+7>>0];i=+c[l>>3];c[l>>3]=f;r[d>>0]=r[l>>0];r[d+1>>0]=r[l+1>>0];r[d+2>>0]=r[l+2>>0];r[d+3>>0]=r[l+3>>0];r[d+4>>0]=r[l+4>>0];r[d+5>>0]=r[l+5>>0];r[d+6>>0]=r[l+6>>0];r[d+7>>0]=r[l+7>>0];c[l>>3]=h;r[u>>0]=r[l>>0];r[u+1>>0]=r[l+1>>0];r[u+2>>0]=r[l+2>>0];r[u+3>>0]=r[l+3>>0];r[u+4>>0]=r[l+4>>0];r[u+5>>0]=r[l+5>>0];r[u+6>>0]=r[l+6>>0];r[u+7>>0]=r[l+7>>0];c[l>>3]=A;r[o>>0]=r[l>>0];r[o+1>>0]=r[l+1>>0];r[o+2>>0]=r[l+2>>0];r[o+3>>0]=r[l+3>>0];r[o+4>>0]=r[l+4>>0];r[o+5>>0]=r[l+5>>0];r[o+6>>0]=r[l+6>>0];r[o+7>>0]=r[l+7>>0];c[l>>3]=a;r[s>>0]=r[l>>0];r[s+1>>0]=r[l+1>>0];r[s+2>>0]=r[l+2>>0];r[s+3>>0]=r[l+3>>0];r[s+4>>0]=r[l+4>>0];r[s+5>>0]=r[l+5>>0];r[s+6>>0]=r[l+6>>0];r[s+7>>0]=r[l+7>>0];c[l>>3]=i;r[e>>0]=r[l>>0];r[e+1>>0]=r[l+1>>0];r[e+2>>0]=r[l+2>>0];r[e+3>>0]=r[l+3>>0];r[e+4>>0]=r[l+4>>0];r[e+5>>0]=r[l+5>>0];r[e+6>>0]=r[l+6>>0];r[e+7>>0]=r[l+7>>0];c[l>>3]=n;r[t>>0]=r[l>>0];r[t+1>>0]=r[l+1>>0];r[t+2>>0]=r[l+2>>0];r[t+3>>0]=r[l+3>>0];r[t+4>>0]=r[l+4>>0];r[t+5>>0]=r[l+5>>0];r[t+6>>0]=r[l+6>>0];r[t+7>>0]=r[l+7>>0];return}function Ke(){var e=0,t=0,n=0,i=0,a=0,o=0,A=0,c=0;a=J;J=J+48|0;n=a+24|0;i=a;e=a+44|0;if((r[21440]|0)==0?Qp(21440)|0:0){s[5374]=0;s[5375]=0;s[5376]=0;jp(21440)}if((r[21448]|0)==0?Qp(21448)|0:0)jp(21448);if((s[5374]|0)==(s[5375]|0)){Av(21508);if((s[5374]|0)==(s[5375]|0)){r[n>>0]=r[e>>0]|0;at(i,n);e=s[5375]|0;do{if(e>>>0>=(s[5376]|0)>>>0){e=((e-(s[5374]|0)|0)/24|0)+1|0;t=ft(21496)|0;if(t>>>0<e>>>0)Xv(21496);else{o=s[5374]|0;c=((s[5376]|0)-o|0)/24|0;A=c<<1;ut(n,c>>>0<t>>>1>>>0?A>>>0<e>>>0?e:A:t,((s[5375]|0)-o|0)/24|0,21504);t=n+8|0;ct(s[t>>2]|0,i);s[t>>2]=(s[t>>2]|0)+24;ht(21496,n);dt(n);break}}else{ot(n,21496,1);c=n+4|0;ct(s[c>>2]|0,i);s[c>>2]=(s[c>>2]|0)+24;At(n)}}while(0);Ye(i)}cv(21508)}J=a;return 21496}function Ze(e,t){e=e|0;t=t|0;var n=0,r=0;n=t+16|0;r=s[n>>2]|0;do{if(r){if((t|0)==(r|0)){r=lt(e)|0;s[e+16>>2]=r;n=s[n>>2]|0;Wg[s[(s[n>>2]|0)+12>>2]&15](n,r);break}else{s[e+16>>2]=Vg[s[(s[r>>2]|0)+8>>2]&15](r)|0;break}}else s[e+16>>2]=0}while(0);return}function Je(e,t){e=e|0;t=t|0;e=s[e+16>>2]|0;if(!e){t=C(4)|0;s[t>>2]=0;Ut(t);k(t|0,4168,131)}else{Wg[s[(s[e>>2]|0)+24>>2]&15](e,t);return}}function Ye(e){e=e|0;var t=0;t=s[e+16>>2]|0;if((e|0)!=(t|0)){if(t|0)jg[s[(s[t>>2]|0)+20>>2]&255](t)}else jg[s[(s[t>>2]|0)+16>>2]&255](t);return}function qe(e){e=e|0;var t=0,n=0,i=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;v=J;J=J+96|0;A=v+16|0;f=v;u=v+72|0;c=s[e>>2]|0;h=o[e+114>>1]|0;d=f;s[d>>2]=0;s[d+4>>2]=0;d=f+8|0;s[d>>2]=h;s[d+4>>2]=0;s[A>>2]=s[f>>2];s[A+4>>2]=s[f+4>>2];s[A+8>>2]=s[f+8>>2];s[A+12>>2]=s[f+12>>2];ze(c,A);c=e+120|0;e:do{if(s[c>>2]|0){l=A+2|0;h=A+16|0;d=A+20|0;f=A+18|0;n=0;while(1){if(!(It(s[e>>2]|0)|0))break e;if(Tt(s[e>>2]|0)|0)break e;je(s[e>>2]|0,A,54);t=7277;i=l;while(1){if((r[i>>0]|0)!=(r[t>>0]|0))break;i=i+1|0;if((i|0)==(h|0)){p=8;break}else t=t+1|0}if((p|0)==8?(p=0,(a[f>>0]|a[f+1>>0]<<8)<<16>>16==22204):0)break;St(s[e>>2]|0,(a[d>>0]|a[d+1>>0]<<8)&65535,0,1);n=n+1|0;if(n>>>0>=(s[c>>2]|0)>>>0)break e}f=(a[d>>0]|a[d+1>>0]<<8)&65535;p=Jp(f)|0;je(s[e>>2]|0,p,f);Pt(e,p);ep(p);p=e+125|0;Qt(u,e+247|0,(a[p>>0]|a[p+1>>0]<<8)&65535);Rt(e+300|0,u)|0;Te(u);J=v;return}}while(0);v=C(8)|0;Dt(v);k(v|0,2672,8)}function $e(e){e=e|0;var t=0,n=0,r=0,i=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0;d=J;J=J+176|0;i=d+40|0;o=d+24|0;t=d+16|0;r=d;l=d+152|0;u=d+136|0;h=d+56|0;c=s[e>>2]|0;A=e+116|0;f=s[A>>2]|0;n=o;s[n>>2]=0;s[n+4>>2]=0;n=o+8|0;s[n>>2]=f;s[n+4>>2]=0;s[i>>2]=s[o>>2];s[i+4>>2]=s[o+4>>2];s[i+8>>2]=s[o+8>>2];s[i+12>>2]=s[o+12>>2];ze(c,i);c=t;s[c>>2]=0;s[c+4>>2]=0;je(s[e>>2]|0,t,8);if(!(It(s[e>>2]|0)|0)){f=C(8)|0;qt(f);k(f|0,2704,8)}n=t;t=s[n>>2]|0;n=s[n+4>>2]|0;if((t|0)==-1&(n|0)==-1){f=C(8)|0;$t(f,7488);k(f|0,2720,8)}f=s[e>>2]|0;c=r;s[c>>2]=0;s[c+4>>2]=0;c=r+8|0;s[c>>2]=t;s[c+4>>2]=n;s[i>>2]=s[r>>2];s[i+4>>2]=s[r+4>>2];s[i+8>>2]=s[r+8>>2];s[i+12>>2]=s[r+12>>2];ze(f,i);if(!(It(s[e>>2]|0)|0)){f=C(8)|0;qt(f);k(f|0,2704,8)}je(s[e>>2]|0,i,8);if(!(It(s[e>>2]|0)|0)){f=C(8)|0;qt(f);k(f|0,2704,8)}if(s[i>>2]|0){f=C(8)|0;en(f);k(f|0,2736,8)}o=e+288|0;c=e+292|0;s[c>>2]=s[o>>2];f=e+259|0;if((a[f>>0]|a[f+1>>0]<<8|a[f+2>>0]<<16|a[f+3>>0]<<24|0)==-1){f=C(8)|0;$t(f,7606);k(f|0,2720,8)}r=i+4|0;tn(o,(s[r>>2]|0)+1|0);f=s[o>>2]|0;s[f>>2]=(s[A>>2]|0)+8;s[f+4>>2]=0;if((s[r>>2]|0)>>>0>1){Oe(l,s[e>>2]|0);nn(u,l);rn(h,32,2,8,0);sn(u);an(h);if(!(s[r>>2]|0)){o=s[o>>2]|0;n=o}else{n=1;do{if(n>>>0>1)t=s[(s[o>>2]|0)+(n+-1<<3)>>2]|0;else t=0;A=on(h,u,t,1)|0;t=s[o>>2]|0;f=t+(n<<3)|0;s[f>>2]=A;s[f+4>>2]=((A|0)<0)<<31>>31;n=n+1|0}while(n>>>0<=(s[r>>2]|0)>>>0);n=t;o=t}t=s[c>>2]|0;if(t-n>>3>>>0>1){i=t-o>>3;r=o;t=1;n=s[r>>2]|0;r=s[r+4>>2]|0;do{f=o+(t<<3)|0;c=f;n=ng(s[c>>2]|0,s[c+4>>2]|0,n|0,r|0)|0;r=B()|0;s[f>>2]=n;s[f+4>>2]=r;t=t+1|0}while(t>>>0<i>>>0)}An(h);cn(u);Se(l)}J=d;return}function et(e){e=e|0;r[e+12>>0]=0;r[e+13>>0]=0;return}function tt(e){e=e|0;s[e+8>>2]=0;s[e+4>>2]=0;return}function nt(e){e=e|0;return Zd(e)|0}function rt(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0,c=0,l=0;A=J;J=J+16|0;a=t;o=A;i=n-a|0;if(i>>>0>4294967279)pv(e);if(i>>>0<11)r[e+11>>0]=i;else{l=i+16&-16;c=Zp(l)|0;s[e>>2]=c;s[e+8>>2]=l|-2147483648;s[e+4>>2]=i;e=c}if((t|0)!=(n|0)){a=n-a|0;i=e;while(1){it(i,t);t=t+1|0;if((t|0)==(n|0))break;else i=i+1|0}e=e+a|0}r[o>>0]=0;it(e,o);J=A;return}function it(e,t){e=e|0;t=t|0;r[e>>0]=r[t>>0]|0;return}function st(e){e=e|0;pp(e);ep(e);return}function at(e,t){e=e|0;t=t|0;s[e>>2]=4372;s[e+16>>2]=e;return}function ot(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;t=s[t+4>>2]|0;s[e+4>>2]=t;s[e+8>>2]=t+(n*24|0);return}function At(e){e=e|0;s[(s[e>>2]|0)+4>>2]=s[e+4>>2];return}function ct(e,t){e=e|0;t=t|0;var n=0,r=0;n=t+16|0;r=s[n>>2]|0;do{if(r){if((t|0)==(r|0)){r=lt(e)|0;s[e+16>>2]=r;n=s[n>>2]|0;Wg[s[(s[n>>2]|0)+12>>2]&15](n,r);break}else{s[e+16>>2]=r;s[n>>2]=0;break}}else s[e+16>>2]=0}while(0);return}function lt(e){e=e|0;return e|0}function ut(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=e+12|0;s[i>>2]=0;s[e+16>>2]=r;do{if(t){if(t>>>0>178956970){i=C(8)|0;hv(i,6723);s[i>>2]=5956;k(i|0,3928,123)}else{r=Zp(t*24|0)|0;break}}else r=0}while(0);s[e>>2]=r;n=r+(n*24|0)|0;s[e+8>>2]=n;s[e+4>>2]=n;s[i>>2]=r+(t*24|0);return}function ht(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0;A=s[e>>2]|0;c=e+4|0;n=s[c>>2]|0;o=t+4|0;if((n|0)==(A|0)){i=o;a=e;r=s[o>>2]|0;n=A}else{r=s[o>>2]|0;do{n=n+-24|0;ct(r+-24|0,n);r=(s[o>>2]|0)+-24|0;s[o>>2]=r}while((n|0)!=(A|0));i=o;a=e;n=s[e>>2]|0}s[a>>2]=r;s[i>>2]=n;A=t+8|0;o=s[c>>2]|0;s[c>>2]=s[A>>2];s[A>>2]=o;A=e+8|0;c=t+12|0;e=s[A>>2]|0;s[A>>2]=s[c>>2];s[c>>2]=e;s[t>>2]=s[i>>2];return}function dt(e){e=e|0;var t=0,n=0,r=0,i=0;n=s[e+4>>2]|0;r=e+8|0;t=s[r>>2]|0;if((t|0)!=(n|0))do{i=t+-24|0;s[r>>2]=i;Ye(i);t=s[r>>2]|0}while((t|0)!=(n|0));t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function ft(e){e=e|0;return 178956970}function pt(e){e=e|0;ep(e);return}function vt(e){e=e|0;e=Zp(8)|0;s[e>>2]=4372;return e|0}function gt(e,t){e=e|0;t=t|0;s[t>>2]=4372;return}function mt(e){e=e|0;return}function yt(e){e=e|0;_e(e,8);return}function _t(e,t){e=e|0;t=t|0;Ct(e+4|0,t);return}function bt(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==7183?e+4|0:0)|0}function wt(e){e=e|0;return 2664}function Bt(e){e=e|0;return}function Ct(e,t){e=e|0;t=t|0;Mt(e,t);return}function Mt(e,t){e=e|0;t=t|0;var n=0,i=0;e=t+104|0;t=a[e>>0]|0;n=t>>>7;i=t>>>6&1;if((n|0)==1&(i|0)!=0){i=C(8)|0;kt(i);k(i|0,2632,8)}if((n|0)==(i|0)){i=C(8)|0;Et(i);k(i|0,2648,8)}else{r[e>>0]=t&63;return}}function kt(e){e=e|0;fv(e,7076);s[e>>2]=4416;return}function Et(e){e=e|0;fv(e,7144);s[e>>2]=4436;return}function Ft(e){e=e|0;pp(e);ep(e);return}function xt(e){e=e|0;pp(e);ep(e);return}function Ut(e){e=e|0;s[e>>2]=6092;return}function It(e){e=e|0;var t=0;t=e+12|0;e=(r[t>>0]|0)==0;r[t>>0]=0;return e|0}function Tt(e){e=e|0;return(r[e+13>>0]|0)!=0|0}function Pt(e,t){e=e|0;t=t|0;e=e+247|0;Ot(e,t);if((a[e>>0]|a[e+1>>0]<<8)<<16>>16==2)return;else{t=C(8)|0;Vt(t);k(t|0,2688,8)}}function St(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;var a=0,o=0;switch(i|0){case 0:break;case 2:{i=s[e+4>>2]|0;t=ng(ng(t|0,n|0,-1,-1)|0,B()|0,i|0,((i|0)<0)<<31>>31|0)|0;n=B()|0;break}case 1:{i=s[e+8>>2]|0;t=ng(i|0,((i|0)<0)<<31>>31|0,t|0,n|0)|0;n=B()|0;break}default:{n=0;t=0}}a=s[e+4>>2]|0;o=((a|0)<0)<<31>>31;i=e+12|0;if((n|0)<0|((n|0)>(o|0)|(n|0)==(o|0)&t>>>0>=a>>>0))r[i>>0]=1;else{r[i>>0]=0;s[e+8>>2]=t}return}function Dt(e){e=e|0;fv(e,7410);s[e>>2]=4476;return}function Qt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,s=0,o=0,A=0,c=0,l=0;o=J;J=J+16|0;s=o;Le(e);i=t+32|0;if((a[i>>0]|a[i+1>>0]<<8)<<16>>16){r=t+34|0;t=0;do{c=a[r>>0]|a[r+1>>0]<<8|a[r+2>>0]<<16|a[r+3>>0]<<24;l=c+(t*6|0)|0;A=c+(t*6|0)+2|0;c=c+(t*6|0)+4|0;Gt(s,(a[l>>0]|a[l+1>>0]<<8)&65535,(a[A>>0]|a[A+1>>0]<<8)&65535,(a[c>>0]|a[c+1>>0]<<8)&65535);Nt(e,s);n=n-((a[A>>0]|a[A+1>>0]<<8)&65535)|0;t=t+1|0}while(t>>>0<((a[i>>0]|a[i+1>>0]<<8)&65535)>>>0)}if((n|0)<0){l=C(8)|0;Vt(l);k(l|0,2688,8)}if(n|0){Gt(s,0,n,2);Nt(e,s)}J=o;return}function Rt(e,t){e=e|0;t=t|0;var n=0,i=0;n=J;J=J+16|0;i=n+1|0;r[i>>0]=r[n>>0]|0;Jt(e,t,i);J=n;return e|0}function Ot(e,t){e=e|0;t=t|0;var n=0,i=0,s=0,o=0,A=0,c=0,l=0;i=t+2|0;o=a[t>>0]|a[t+1>>0]<<8;r[e>>0]=o;r[e+1>>0]=o>>8;o=e+2|0;i=a[i>>0]|a[i+1>>0]<<8;r[o>>0]=i;r[o+1>>0]=i>>8;r[e+4>>0]=r[t+4>>0]|0;o=t+6|0;r[e+5>>0]=r[t+5>>0]|0;i=t+8|0;n=e+6|0;o=a[o>>0]|a[o+1>>0]<<8;r[n>>0]=o;r[n+1>>0]=o>>8;n=t+12|0;o=e+8|0;i=a[i>>0]|a[i+1>>0]<<8|a[i+2>>0]<<16|a[i+3>>0]<<24;r[o>>0]=i;r[o+1>>0]=i>>8;r[o+2>>0]=i>>16;r[o+3>>0]=i>>24;o=e+12|0;n=a[n>>0]|a[n+1>>0]<<8|a[n+2>>0]<<16|a[n+3>>0]<<24;r[o>>0]=n;r[o+1>>0]=n>>8;r[o+2>>0]=n>>16;r[o+3>>0]=n>>24;o=t+16|0;n=o;n=a[n>>0]|a[n+1>>0]<<8|a[n+2>>0]<<16|a[n+3>>0]<<24;o=o+4|0;o=a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24;i=e+16|0;A=i;r[A>>0]=n;r[A+1>>0]=n>>8;r[A+2>>0]=n>>16;r[A+3>>0]=n>>24;i=i+4|0;r[i>>0]=o;r[i+1>>0]=o>>8;r[i+2>>0]=o>>16;r[i+3>>0]=o>>24;i=t+32|0;o=t+24|0;A=o;A=a[A>>0]|a[A+1>>0]<<8|a[A+2>>0]<<16|a[A+3>>0]<<24;o=o+4|0;o=a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24;n=e+24|0;s=n;r[s>>0]=A;r[s+1>>0]=A>>8;r[s+2>>0]=A>>16;r[s+3>>0]=A>>24;n=n+4|0;r[n>>0]=o;r[n+1>>0]=o>>8;r[n+2>>0]=o>>16;r[n+3>>0]=o>>24;n=t+34|0;o=e+32|0;i=a[i>>0]|a[i+1>>0]<<8;r[o>>0]=i;r[o+1>>0]=i>>8;s=e+34|0;e=a[s>>0]|a[s+1>>0]<<8|a[s+2>>0]<<16|a[s+3>>0]<<24;if(!e)e=i;else{Yp(e);e=a[o>>0]|a[o+1>>0]<<8}i=Jp((e&65535)*6|0)|0;r[s>>0]=i;r[s+1>>0]=i>>8;r[s+2>>0]=i>>16;r[s+3>>0]=i>>24;if(e<<16>>16?(e=t+36|0,A=a[n>>0]|a[n+1>>0]<<8,r[i>>0]=A,r[i+1>>0]=A>>8,t=t+38|0,A=i+2|0,e=a[e>>0]|a[e+1>>0]<<8,r[A>>0]=e,r[A+1>>0]=e>>8,A=i+4|0,t=a[t>>0]|a[t+1>>0]<<8,r[A>>0]=t,r[A+1>>0]=t>>8,((a[o>>0]|a[o+1>>0]<<8)&65535)>1):0){e=1;do{t=n;n=n+6|0;A=a[s>>0]|a[s+1>>0]<<8|a[s+2>>0]<<16|a[s+3>>0]<<24;c=t+8|0;i=A+(e*6|0)|0;l=a[n>>0]|a[n+1>>0]<<8;r[i>>0]=l;r[i+1>>0]=l>>8;t=t+10|0;i=A+(e*6|0)+2|0;c=a[c>>0]|a[c+1>>0]<<8;r[i>>0]=c;r[i+1>>0]=c>>8;A=A+(e*6|0)+4|0;t=a[t>>0]|a[t+1>>0]<<8;r[A>>0]=t;r[A+1>>0]=t>>8;e=e+1|0}while(e>>>0<((a[o>>0]|a[o+1>>0]<<8)&65535)>>>0)}return}function Vt(e){e=e|0;fv(e,7354);s[e>>2]=4456;return}function Lt(e){e=e|0;pp(e);ep(e);return}function Ht(e){e=e|0;pp(e);ep(e);return}function Nt(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0;A=J;J=J+32|0;i=A;a=e+4|0;n=s[a>>2]|0;o=e+8|0;do{if((n|0)==(s[o>>2]|0)){n=((n-(s[e>>2]|0)|0)/12|0)+1|0;r=Zt(e)|0;if(r>>>0<n>>>0)Xv(e);else{c=s[e>>2]|0;l=((s[o>>2]|0)-c|0)/12|0;o=l<<1;zt(i,l>>>0<r>>>1>>>0?o>>>0<n>>>0?n:o:r,((s[a>>2]|0)-c|0)/12|0,e+8|0);o=i+8|0;a=s[o>>2]|0;s[a>>2]=s[t>>2];s[a+4>>2]=s[t+4>>2];s[a+8>>2]=s[t+8>>2];s[o>>2]=(s[o>>2]|0)+12;Xt(e,i);Kt(i);break}}else{jt(i,e,1);l=i+4|0;c=s[l>>2]|0;s[c>>2]=s[t>>2];s[c+4>>2]=s[t+4>>2];s[c+8>>2]=s[t+8>>2];s[l>>2]=(s[l>>2]|0)+12;Wt(i)}}while(0);J=A;return}function Gt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;s[e>>2]=t;s[e+4>>2]=n;s[e+8>>2]=r;return}function jt(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;t=s[t+4>>2]|0;s[e+4>>2]=t;s[e+8>>2]=t+(n*12|0);return}function Wt(e){e=e|0;s[(s[e>>2]|0)+4>>2]=s[e+4>>2];return}function zt(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=e+12|0;s[i>>2]=0;s[e+16>>2]=r;do{if(t){if(t>>>0>357913941){i=C(8)|0;hv(i,6723);s[i>>2]=5956;k(i|0,3928,123)}else{r=Zp(t*12|0)|0;break}}else r=0}while(0);s[e>>2]=r;n=r+(n*12|0)|0;s[e+8>>2]=n;s[e+4>>2]=n;s[i>>2]=r+(t*12|0);return}function Xt(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;r=s[e>>2]|0;o=e+4|0;a=t+4|0;i=(s[o>>2]|0)-r|0;n=(s[a>>2]|0)+(((i|0)/-12|0)*12|0)|0;s[a>>2]=n;if((i|0)>0){ug(n|0,r|0,i|0)|0;r=a;n=s[a>>2]|0}else r=a;a=s[e>>2]|0;s[e>>2]=n;s[r>>2]=a;a=t+8|0;i=s[o>>2]|0;s[o>>2]=s[a>>2];s[a>>2]=i;a=e+8|0;o=t+12|0;e=s[a>>2]|0;s[a>>2]=s[o>>2];s[o>>2]=e;s[t>>2]=s[r>>2];return}function Kt(e){e=e|0;var t=0,n=0,r=0;t=s[e+4>>2]|0;n=e+8|0;r=s[n>>2]|0;if((r|0)!=(t|0))s[n>>2]=r+(~(((r+-12-t|0)>>>0)/12|0)*12|0);t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function Zt(e){e=e|0;return 357913941}function Jt(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;Yt(e);s[e>>2]=s[t>>2];n=t+4|0;s[e+4>>2]=s[n>>2];r=t+8|0;s[e+8>>2]=s[r>>2];s[r>>2]=0;s[n>>2]=0;s[t>>2]=0;return}function Yt(e){e=e|0;var t=0,n=0,r=0,i=0;t=s[e>>2]|0;n=t;if(t|0){r=e+4|0;s[r>>2]=n;i=e+8|0;_e(t,(s[i>>2]|0)-n|0);s[i>>2]=0;s[r>>2]=0;s[e>>2]=0}return}function qt(e){e=e|0;fv(e,7660);s[e>>2]=4496;return}function $t(e,t){e=e|0;t=t|0;fv(e,t);s[e>>2]=4516;return}function en(e){e=e|0;fv(e,7704);s[e>>2]=4536;return}function tn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0;n=e+4|0;i=s[e>>2]|0;r=(s[n>>2]|0)-i>>3;if(r>>>0>=t>>>0){if(r>>>0>t>>>0)s[n>>2]=i+(t<<3)}else dn(e,t-r|0);return}function nn(e,t){e=e|0;t=t|0;s[e>>2]=t;s[e+4>>2]=0;s[e+8>>2]=-1;return}function rn(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0;s[e+4>>2]=t;s[e+8>>2]=n;s[e+12>>2]=r;s[e+16>>2]=i;s[e+36>>2]=0;s[e+40>>2]=0;s[e+44>>2]=0;Cn(e+48|0);s[e+68>>2]=0;s[e+72>>2]=0;s[e+76>>2]=0;do{if(!i){n=e+20|0;if((t+-1|0)>>>0<31){s[n>>2]=t;i=1<<t;s[e+24>>2]=i;n=i>>>1;s[e+28>>2]=0-n;n=i+-1-n|0;break}else{s[n>>2]=32;s[e+24>>2]=0;s[e+28>>2]=-2147483648;n=2147483647;break}}else{r=e+20|0;s[r>>2]=0;s[e+24>>2]=i;n=i;a=0;while(1){n=n>>>1;t=a+1|0;if(!n)break;else a=t}s[r>>2]=(1<<a|0)==(i|0)?a:t;n=i>>>1;s[e+28>>2]=0-n;n=i+-1-n|0}}while(0);s[e+32>>2]=n;s[e>>2]=0;return}function sn(e){e=e|0;var t=0;t=((En(s[e>>2]|0)|0)&255)<<24;t=((En(s[e>>2]|0)|0)&255)<<16|t;t=t|((En(s[e>>2]|0)|0)&255)<<8;s[e+4>>2]=t|(En(s[e>>2]|0)|0)&255;return}function an(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0,g=0,m=0,y=0;v=J;J=J+64|0;f=v+44|0;p=v;l=e+36|0;u=e+40|0;e:do{if((s[l>>2]|0)==(s[u>>2]|0)){h=e+8|0;t:do{if(!(s[h>>2]|0))d=e+20|0;else{i=e+20|0;a=e+44|0;o=f+4|0;A=e+44|0;c=f+8|0;r=0;while(1){Tn(p,(s[i>>2]|0)+1|0,0,0);t=s[u>>2]|0;if(t>>>0<(s[a>>2]|0)>>>0){Pn(f,l,1);Dn(s[o>>2]|0,p);s[o>>2]=(s[o>>2]|0)+44;Sn(f)}else{t=((t-(s[l>>2]|0)|0)/44|0)+1|0;n=Vn(l)|0;if(n>>>0<t>>>0)break;g=s[l>>2]|0;y=((s[a>>2]|0)-g|0)/44|0;m=y<<1;Qn(f,y>>>0<n>>>1>>>0?m>>>0<t>>>0?t:m:n,((s[u>>2]|0)-g|0)/44|0,A);Dn(s[c>>2]|0,p);s[c>>2]=(s[c>>2]|0)+44;Rn(l,f);On(f)}kn(p);r=r+1|0;if(r>>>0>=(s[h>>2]|0)>>>0){d=i;break t}}Xv(l)}}while(0);if(s[d>>2]|0){o=e+12|0;A=e+68|0;c=e+72|0;l=e+76|0;u=f+4|0;i=e+76|0;a=f+8|0;r=1;while(1){t=s[o>>2]|0;Tn(p,1<<(r>>>0>t>>>0?t:r),0,0);t=s[c>>2]|0;if(t>>>0<(s[l>>2]|0)>>>0){Pn(f,A,1);Dn(s[u>>2]|0,p);s[u>>2]=(s[u>>2]|0)+44;Sn(f)}else{t=((t-(s[A>>2]|0)|0)/44|0)+1|0;n=Vn(A)|0;if(n>>>0<t>>>0)break;y=s[A>>2]|0;g=((s[l>>2]|0)-y|0)/44|0;m=g<<1;Qn(f,g>>>0<n>>>1>>>0?m>>>0<t>>>0?t:m:n,((s[c>>2]|0)-y|0)/44|0,i);Dn(s[a>>2]|0,p);s[a>>2]=(s[a>>2]|0)+44;Rn(A,f);On(f)}kn(p);r=r+1|0;if(r>>>0>(s[d>>2]|0)>>>0)break e}Xv(A)}}}while(0);J=v;return}function on(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;n=(Nn(e,t,(s[e+36>>2]|0)+(r*44|0)|0)|0)+n|0;t=s[e+24>>2]|0;if((n|0)<0)return n+t|0;else return n-(n>>>0<t>>>0?0:t)|0;return 0}function An(e){e=e|0;Mn(e+68|0);Mn(e+36|0);return}function cn(e){e=e|0;return}function ln(e){e=e|0;pp(e);ep(e);return}function un(e){e=e|0;pp(e);ep(e);return}function hn(e){e=e|0;pp(e);ep(e);return}function dn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0;A=J;J=J+32|0;i=A;a=e+8|0;o=e+4|0;n=s[o>>2]|0;do{if((s[a>>2]|0)-n>>3>>>0<t>>>0){n=(n-(s[e>>2]|0)>>3)+t|0;r=bn(e)|0;if(r>>>0<n>>>0)Xv(e);else{c=s[e>>2]|0;l=(s[a>>2]|0)-c|0;a=l>>2;pn(i,l>>3>>>0<r>>>1>>>0?a>>>0<n>>>0?n:a:r,(s[o>>2]|0)-c>>3,e+8|0);vn(i,t);gn(e,i);mn(i);break}}else fn(e,t)}while(0);J=A;return}function fn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0;i=J;J=J+16|0;r=i;yn(r,e,t);e=r+4|0;t=s[e>>2]|0;n=s[r+8>>2]|0;if((t|0)!=(n|0)){n=n+-8-t|0;dg(t|0,0,n+8&-8|0)|0;s[e>>2]=t+((n>>>3)+1<<3)}_n(r);J=i;return}function pn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=e+12|0;s[i>>2]=0;s[e+16>>2]=r;do{if(t){if(t>>>0>536870911){i=C(8)|0;hv(i,6723);s[i>>2]=5956;k(i|0,3928,123)}else{r=Zp(t<<3)|0;break}}else r=0}while(0);s[e>>2]=r;n=r+(n<<3)|0;s[e+8>>2]=n;s[e+4>>2]=n;s[i>>2]=r+(t<<3);return}function vn(e,t){e=e|0;t=t|0;var n=0,r=0;r=J;J=J+16|0;n=r;wn(n,e+8|0,t);e=s[n>>2]|0;t=s[n+4>>2]|0;if((e|0)!=(t|0)){t=t+-8-e|0;dg(e|0,0,t+8&-8|0)|0;s[n>>2]=e+((t>>>3)+1<<3)}Bn(n);J=r;return}function gn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;r=s[e>>2]|0;o=e+4|0;a=t+4|0;i=(s[o>>2]|0)-r|0;n=(s[a>>2]|0)+(0-(i>>3)<<3)|0;s[a>>2]=n;if((i|0)>0){ug(n|0,r|0,i|0)|0;r=a;n=s[a>>2]|0}else r=a;a=s[e>>2]|0;s[e>>2]=n;s[r>>2]=a;a=t+8|0;i=s[o>>2]|0;s[o>>2]=s[a>>2];s[a>>2]=i;a=e+8|0;o=t+12|0;e=s[a>>2]|0;s[a>>2]=s[o>>2];s[o>>2]=e;s[t>>2]=s[r>>2];return}function mn(e){e=e|0;var t=0,n=0,r=0;t=s[e+4>>2]|0;n=e+8|0;r=s[n>>2]|0;if((r|0)!=(t|0))s[n>>2]=r+(~((r+-8-t|0)>>>3)<<3);t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function yn(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;t=s[t+4>>2]|0;s[e+4>>2]=t;s[e+8>>2]=t+(n<<3);return}function _n(e){e=e|0;s[(s[e>>2]|0)+4>>2]=s[e+4>>2];return}function bn(e){e=e|0;return 536870911}function wn(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=s[t>>2];s[e+4>>2]=(s[t>>2]|0)+(n<<3);s[e+8>>2]=t;return}function Bn(e){e=e|0;s[s[e+8>>2]>>2]=s[e>>2];return}function Cn(e){e=e|0;s[e+12>>2]=1;s[e+16>>2]=2;s[e+8>>2]=4096;s[e+4>>2]=4;s[e>>2]=4;return}function Mn(e){e=e|0;var t=0,n=0,r=0;n=s[e>>2]|0;if(n|0){r=e+4|0;t=s[r>>2]|0;if((t|0)==(n|0))t=n;else{do{t=t+-44|0;kn(t)}while((t|0)!=(n|0));t=s[e>>2]|0}s[r>>2]=n;_e(t,(s[e+8>>2]|0)-t|0)}return}function kn(e){e=e|0;var t=0;t=s[e+8>>2]|0;if(t|0)Re(t);t=s[e+12>>2]|0;if(t|0)Re(t);t=s[e+16>>2]|0;if(t|0)Re(t);return}function En(e){e=e|0;var t=0,n=0;n=e+4|0;t=s[n>>2]|0;if((t|0)>=(s[e+8>>2]|0)){Fn(e);t=s[n>>2]|0}e=s[e+12>>2]|0;s[n>>2]=t+1;return r[e+t>>0]|0}function Fn(e){e=e|0;var t=0;s[e+4>>2]=0;je(s[e>>2]|0,s[e+12>>2]|0,1048576);t=xn(s[e>>2]|0)|0;s[e+8>>2]=t;if(!t){t=C(8)|0;Un(t);k(t|0,2752,8)}else return}function xn(e){e=e|0;return s[e+16>>2]|0}function Un(e){e=e|0;fv(e,7769);s[e>>2]=4556;return}function In(e){e=e|0;pp(e);ep(e);return}function Tn(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;var a=0,o=0,A=0;s[e>>2]=t;r[e+4>>0]=n&1;o=e+8|0;s[o>>2]=0;A=e+12|0;s[A>>2]=0;a=e+16|0;s[a>>2]=0;if((t+-2|0)>>>0>2046){e=C(8)|0;fv(e,7789);k(e|0,3912,8)}s[e+32>>2]=t+-1;if(t>>>0>16&(n^1)){n=3;while(1){if(1<<n+2>>>0<t>>>0)n=n+1|0;else break}t=1<<n;s[e+36>>2]=t;s[e+40>>2]=15-n;s[a>>2]=Ge((t<<2)+8|0)|0;t=s[e>>2]|0}else{s[a>>2]=0;s[e+40>>2]=0;s[e+36>>2]=0}s[o>>2]=Ge(t<<2)|0;a=Ge(s[e>>2]<<2)|0;s[A>>2]=a;s[e+20>>2]=0;t=s[e>>2]|0;n=e+24|0;s[n>>2]=t;t=(t|0)!=0;if(!i){if(t){t=0;do{s[a+(t<<2)>>2]=1;t=t+1|0}while(t>>>0<(s[e>>2]|0)>>>0)}}else if(t){t=0;do{s[a+(t<<2)>>2]=s[i+(t<<2)>>2];t=t+1|0}while(t>>>0<(s[e>>2]|0)>>>0)}Hn(e);i=((s[e>>2]|0)+6|0)>>>1;s[n>>2]=i;s[e+28>>2]=i;return}function Pn(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;t=s[t+4>>2]|0;s[e+4>>2]=t;s[e+8>>2]=t+(n*44|0);return}function Sn(e){e=e|0;s[(s[e>>2]|0)+4>>2]=s[e+4>>2];return}function Dn(e,t){e=e|0;t=t|0;var n=0;s[e>>2]=s[t>>2];r[e+4>>0]=r[t+4>>0]|0;n=t+8|0;s[e+8>>2]=s[n>>2];s[e+12>>2]=s[t+12>>2];s[e+16>>2]=s[t+16>>2];s[e+20>>2]=s[t+20>>2];s[e+24>>2]=s[t+24>>2];s[e+28>>2]=s[t+28>>2];s[e+32>>2]=s[t+32>>2];s[e+36>>2]=s[t+36>>2];s[e+40>>2]=s[t+40>>2];s[n>>2]=0;s[n+4>>2]=0;s[n+8>>2]=0;return}function Qn(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=e+12|0;s[i>>2]=0;s[e+16>>2]=r;do{if(t){if(t>>>0>97612893){i=C(8)|0;hv(i,6723);s[i>>2]=5956;k(i|0,3928,123)}else{r=Zp(t*44|0)|0;break}}else r=0}while(0);s[e>>2]=r;n=r+(n*44|0)|0;s[e+8>>2]=n;s[e+4>>2]=n;s[i>>2]=r+(t*44|0);return}function Rn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0;A=s[e>>2]|0;c=e+4|0;n=s[c>>2]|0;o=t+4|0;if((n|0)==(A|0)){i=o;a=e;r=s[o>>2]|0;n=A}else{r=s[o>>2]|0;do{n=n+-44|0;Ln(r+-44|0,n);r=(s[o>>2]|0)+-44|0;s[o>>2]=r}while((n|0)!=(A|0));i=o;a=e;n=s[e>>2]|0}s[a>>2]=r;s[i>>2]=n;A=t+8|0;o=s[c>>2]|0;s[c>>2]=s[A>>2];s[A>>2]=o;A=e+8|0;c=t+12|0;e=s[A>>2]|0;s[A>>2]=s[c>>2];s[c>>2]=e;s[t>>2]=s[i>>2];return}function On(e){e=e|0;var t=0,n=0,r=0,i=0;n=s[e+4>>2]|0;r=e+8|0;t=s[r>>2]|0;if((t|0)!=(n|0))do{i=t+-44|0;s[r>>2]=i;kn(i);t=s[r>>2]|0}while((t|0)!=(n|0));t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function Vn(e){e=e|0;return 97612893}function Ln(e,t){e=e|0;t=t|0;var n=0,i=0,a=0,o=0;n=s[t>>2]|0;s[e>>2]=n;r[e+4>>0]=r[t+4>>0]|0;s[e+20>>2]=s[t+20>>2];s[e+24>>2]=s[t+24>>2];s[e+28>>2]=s[t+28>>2];s[e+32>>2]=s[t+32>>2];o=e+36|0;s[o>>2]=s[t+36>>2];s[e+40>>2]=s[t+40>>2];n=n<<2;i=Ge(n)|0;s[e+8>>2]=i;a=s[e>>2]|0;if(a|0)hg(i|0,s[t+8>>2]|0,a<<2|0)|0;n=Ge(n)|0;s[e+12>>2]=n;i=s[e>>2]|0;if(i|0)hg(n|0,s[t+12>>2]|0,i<<2|0)|0;n=s[o>>2]|0;if(n){i=Ge((n<<2)+8|0)|0;s[e+16>>2]=i;n=(s[o>>2]<<2)+8|0;if(n|0)hg(i|0,s[t+16>>2]|0,n|0)|0}else s[e+16>>2]=0;return}function Hn(e){e=e|0;var t=0,n=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;v=e+24|0;a=e+20|0;t=(s[a>>2]|0)+(s[v>>2]|0)|0;s[a>>2]=t;if(t>>>0>32768){s[a>>2]=0;if(!(s[e>>2]|0))t=0;else{i=s[e+12>>2]|0;n=0;do{d=i+(n<<2)|0;t=((s[d>>2]|0)+1|0)>>>1;s[d>>2]=t;t=(s[a>>2]|0)+t|0;s[a>>2]=t;n=n+1|0}while(n>>>0<(s[e>>2]|0)>>>0)}}d=2147483648/(t>>>0)|0;do{if((r[e+4>>0]|0)==0?(f=e+36|0,(s[f>>2]|0)!=0):0){if(s[e>>2]|0){c=s[e+8>>2]|0;l=s[e+12>>2]|0;u=e+40|0;h=e+16|0;t=0;o=0;A=0;do{n=(y(o,d)|0)>>>16;s[c+(A<<2)>>2]=n;o=(s[l+(A<<2)>>2]|0)+o|0;n=n>>>(s[u>>2]|0);if(t>>>0<n>>>0){i=A+-1|0;a=s[h>>2]|0;do{t=t+1|0;s[a+(t<<2)>>2]=i}while((t|0)!=(n|0));t=n}A=A+1|0}while(A>>>0<(s[e>>2]|0)>>>0);n=s[h>>2]|0;s[n>>2]=0;if(t>>>0>(s[f>>2]|0)>>>0){t=e;break}}else{n=s[e+16>>2]|0;s[n>>2]=0;t=0}do{t=t+1|0;s[n+(t<<2)>>2]=(s[e>>2]|0)+-1}while(t>>>0<=(s[f>>2]|0)>>>0);t=e}else p=7}while(0);if((p|0)==7)if(!(s[e>>2]|0))t=e;else{i=s[e+8>>2]|0;a=s[e+12>>2]|0;t=0;n=0;do{s[i+(t<<2)>>2]=(y(n,d)|0)>>>16;n=(s[a+(t<<2)>>2]|0)+n|0;t=t+1|0}while(t>>>0<(s[e>>2]|0)>>>0);t=e}p=((s[v>>2]|0)*5|0)>>>2;f=(s[t>>2]<<3)+48|0;p=p>>>0>f>>>0?f:p;s[v>>2]=p;s[e+28>>2]=p;return}function Nn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;n=Gn(t,n)|0;s[e>>2]=n;do{if(n){if(n>>>0>=32){n=s[e+28>>2]|0;break}r=s[e+12>>2]|0;if(n>>>0>r>>>0){r=n-r|0;n=Gn(t,(s[e+68>>2]|0)+((n+-1|0)*44|0)|0)|0;r=n<<r|(jn(t,r)|0)}else r=Gn(t,(s[e+68>>2]|0)+((n+-1|0)*44|0)|0)|0;n=s[e>>2]|0;if((r|0)<(1<<n+-1|0)){n=r+1+(-1<<n)|0;break}else{n=r+1|0;break}}else n=Wn(t,e+48|0)|0}while(0);return n|0}function Gn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0;d=e+8|0;h=s[d>>2]|0;i=s[t+16>>2]|0;if(i){r=e+4|0;n=s[r>>2]|0;u=h>>>15;s[d>>2]=u;c=(n>>>0)/(u>>>0)|0;A=c>>>(s[t+40>>2]|0);a=s[i+(A<<2)>>2]|0;A=(s[i+(A+1<<2)>>2]|0)+1|0;o=a+1|0;l=s[t+8>>2]|0;if(A>>>0>o>>>0){i=a;a=A;do{o=(a+i|0)>>>1;A=(s[l+(o<<2)>>2]|0)>>>0>c>>>0;i=A?i:o;a=A?o:a;o=i+1|0}while(a>>>0>o>>>0);a=i}i=y(s[l+(a<<2)>>2]|0,u)|0;if((a|0)==(s[t+32>>2]|0))o=h;else o=y(s[l+(o<<2)>>2]|0,u)|0}else{l=h>>>15;s[d>>2]=l;A=s[t>>2]|0;u=s[t+8>>2]|0;r=e+4|0;n=s[r>>2]|0;c=A>>>1;i=0;o=h;a=0;do{f=y(s[u+(c<<2)>>2]|0,l)|0;h=f>>>0>n>>>0;o=h?f:o;i=h?i:f;a=h?a:c;A=h?c:A;c=(a+A|0)>>>1}while((c|0)!=(a|0))}s[r>>2]=n-i;f=o-i|0;s[d>>2]=f;if(f>>>0<16777216)zn(e);d=(s[t+12>>2]|0)+(a<<2)|0;s[d>>2]=(s[d>>2]|0)+1;d=t+28|0;f=(s[d>>2]|0)+-1|0;s[d>>2]=f;if(!f)Hn(t);return a|0}function jn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;if(t>>>0>19){n=(Xn(e)|0)&65535;return(jn(e,t+-16|0)|0)<<16|n|0}r=e+4|0;i=s[r>>2]|0;a=e+8|0;n=(s[a>>2]|0)>>>t;s[a>>2]=n;t=(i>>>0)/(n>>>0)|0;s[r>>2]=i-(y(t,n)|0);if(n>>>0<16777216)zn(e);return t|0}function Wn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0;r=e+8|0;i=s[r>>2]|0;n=y(i>>>13,s[t+8>>2]|0)|0;a=e+4|0;o=s[a>>2]|0;A=o>>>0>=n>>>0;if(A){s[a>>2]=o-n;n=i-n|0;s[r>>2]=n}else{s[r>>2]=n;o=t+12|0;s[o>>2]=(s[o>>2]|0)+1}if(n>>>0<16777216)zn(e);o=t+4|0;e=(s[o>>2]|0)+-1|0;s[o>>2]=e;if(!e)Kn(t);return A&1|0}function zn(e){e=e|0;var t=0,n=0,r=0,i=0;t=e+4|0;n=e+8|0;r=s[t>>2]|0;do{r=r<<8|(En(s[e>>2]|0)|0)&255;s[t>>2]=r;i=s[n>>2]<<8;s[n>>2]=i}while(i>>>0<16777216);return}function Xn(e){e=e|0;var t=0,n=0,r=0,i=0;n=e+4|0;i=s[n>>2]|0;t=e+8|0;r=(s[t>>2]|0)>>>16;s[t>>2]=r;t=(i>>>0)/(r>>>0)|0;s[n>>2]=i-(y(t,r)|0);zn(e);return t&65535|0}function Kn(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;i=s[e>>2]|0;n=e+16|0;t=(s[n>>2]|0)+i|0;s[n>>2]=t;if(t>>>0>8192){r=(t+1|0)>>>1;s[n>>2]=r;a=e+12|0;t=((s[a>>2]|0)+1|0)>>>1;s[a>>2]=t;if((t|0)==(r|0)){t=r+1|0;s[n>>2]=t;n=t;t=r}else n=r}else{n=t;t=s[e+12>>2]|0}s[e+8>>2]=(y(t,2147483648/(n>>>0)|0)|0)>>>18;a=i*5|0;a=a>>>0>259?64:a>>>2;s[e>>2]=a;s[e+4>>2]=a;return}function Zn(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0;h=J;J=J+32|0;o=h+16|0;A=h+8|0;c=h;l=e+336|0;r=l;i=e+259|0;if(!((s[r+4>>2]|0)==0?(s[r>>2]|0)==(a[i>>0]|a[i+1>>0]<<8|a[i+2>>0]<<16|a[i+3>>0]<<24|0):0)){r=e+320|0;n=s[r>>2]|0;i=n;if(!((n|0)!=0?(s[e+312>>2]|0)!=0:0)){n=i;u=5}}else{r=e+320|0;n=s[e+320>>2]|0;u=5}if((u|0)==5){u=e+320|0;s[o>>2]=n;s[u>>2]=0;n=e+324|0;s[o+4>>2]=s[n>>2];s[n>>2]=0;Ue(o);i=e+312|0;s[o>>2]=s[i>>2];s[i>>2]=0;d=e+316|0;s[o+4>>2]=s[d>>2];s[d>>2]=0;Ie(o);f=Zp(12)|0;nn(f,e+4|0);s[c>>2]=0;s[o>>2]=s[c>>2];Yn(A,f,o);f=s[A>>2]|0;s[A>>2]=s[i>>2];s[i>>2]=f;f=A+4|0;c=s[f>>2]|0;s[f>>2]=s[d>>2];s[d>>2]=c;Ie(A);Jn(A,s[i>>2]|0,e+300|0);i=s[A>>2]|0;d=A+4|0;c=s[d>>2]|0;s[A>>2]=0;s[d>>2]=0;s[o>>2]=s[u>>2];s[u>>2]=i;s[o+4>>2]=s[n>>2];s[n>>2]=c;Ue(o);Ue(A);n=e+328|0;c=n;c=ng(s[c>>2]|0,s[c+4>>2]|0,1,0)|0;u=B()|0;s[n>>2]=c;s[n+4>>2]=u;n=l;s[n>>2]=0;s[n+4>>2]=0;n=s[r>>2]|0}Hg[s[s[n>>2]>>2]&63](n,t)|0;u=l;u=ng(s[u>>2]|0,s[u+4>>2]|0,1,0)|0;d=B()|0;f=l;s[f>>2]=u;s[f+4>>2]=d;J=h;return}function Jn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;o=J;J=J+64|0;r=o+56|0;i=o;a=rr(n)|0;if((a|0)==-1){o=C(8)|0;ir(o);k(o|0,2784,8)}n=sr(n)|0;e:do{if(!n)switch(a|0){case 0:{a=Zp(4788)|0;pr(a);fr(e,t,a);break e}case 1:{a=Zp(5116)|0;gr(a);vr(e,t,a);break e}case 2:{a=Zp(5104)|0;yr(a);mr(e,t,a);break e}case 3:{a=Zp(5432)|0;br(a);_r(e,t,a);break e}default:{s[e>>2]=0;s[e+4>>2]=0;break e}}else{ar(r,t);or(s[r>>2]|0);if((a|2|0)==3)Ar(s[r>>2]|0);if((a|1|0)==3)cr(s[r>>2]|0);a=s[r>>2]|0;ur(i,n);lr(a,i);hr(i);s[e>>2]=s[r>>2];a=r+4|0;s[e+4>>2]=s[a>>2];s[r>>2]=0;s[a>>2]=0;dr(r)}}while(0);J=o;return}function Yn(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4576;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;qn(e,r);J=n;return}function qn(e,t){e=e|0;t=t|0;return}function $n(e){e=e|0;av(e);ep(e);return}function er(e){e=e|0;e=s[e+12>>2]|0;if(e|0){cn(e);ep(e)}return}function tr(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==7983?e+12|0:0)|0}function nr(e){e=e|0;_e(e,16);return}function rr(e){e=e|0;var t=0,n=0;t=(s[e+4>>2]|0)-(s[e>>2]|0)|0;e:do{if(((t|0)!=0?(n=((t|0)/12|0)+(((sr(e)|0)!=0)<<31>>31)|0,(n|0)!=0):0)?(t=s[e>>2]|0,!(wr(t,Br()|0)|0)):0){switch(n|0){case 1:{e=0;break e}case 2:{if(Cr((s[e>>2]|0)+12|0,Mr()|0)|0){e=1;break e}if(Cr((s[e>>2]|0)+12|0,kr()|0)|0){e=2;break e}break}case 3:{if(Cr((s[e>>2]|0)+12|0,Mr()|0)|0?(n=(s[e>>2]|0)+24|0,Cr(n,kr()|0)|0):0){e=3;break e}break}default:{}}e=-1}else e=-1}while(0);return e|0}function ir(e){e=e|0;fv(e,8131);s[e>>2]=4604;return}function sr(e){e=e|0;var t=0,n=0;t=s[e+4>>2]|0;if(((t|0)!=(s[e>>2]|0)?(n=t,(s[n+-12>>2]|0)==0):0)?(s[n+-4>>2]|0)==2:0)e=s[n+-8>>2]|0;else e=0;return e|0}function ar(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;n=J;J=J+16|0;r=n+4|0;a=n;i=Zp(24)|0;Fr(i,t);s[a>>2]=0;s[r>>2]=s[a>>2];xr(e,i,r);J=n;return}function or(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(4792)|0;Gr(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];jr(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function Ar(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(336)|0;zi(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];Xi(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function cr(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(324)|0;gs(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];ms(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function lr(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;o=c+12|0;A=c;r=c+8|0;a=Zp(64)|0;Ps(a,s[e+4>>2]|0,t);i=e+8|0;s[r>>2]=0;s[o>>2]=s[r>>2];Ss(A,a,o);a=e+12|0;t=s[a>>2]|0;r=e+16|0;do{if(t>>>0>=(s[r>>2]|0)>>>0){t=(t-(s[i>>2]|0)>>3)+1|0;n=Jr(i)|0;if(n>>>0<t>>>0)Xv(i);else{l=s[i>>2]|0;u=(s[r>>2]|0)-l|0;r=u>>2;Xr(o,u>>3>>>0<n>>>1>>>0?r>>>0<t>>>0?t:r:n,(s[a>>2]|0)-l>>3,e+16|0);e=o+8|0;a=s[e>>2]|0;s[a>>2]=s[A>>2];r=A+4|0;s[a+4>>2]=s[r>>2];s[A>>2]=0;s[r>>2]=0;s[e>>2]=a+8;Kr(i,o);Zr(o);break}}else{Wr(o,i,1);u=o+4|0;l=s[u>>2]|0;s[l>>2]=s[A>>2];e=A+4|0;s[l+4>>2]=s[e>>2];s[A>>2]=0;s[e>>2]=0;s[u>>2]=l+8;zr(o)}}while(0);Qr(A);J=c;return}function ur(e,t){e=e|0;t=t|0;var n=0,i=0;n=J;J=J+48|0;i=n;s[e>>2]=t;r[e+4>>0]=0;ka(e+8|0,t);ka(e+20|0,t);Tn(i,256,0,0);Ea(e+32|0,t,i);kn(i);J=n;return}function hr(e){e=e|0;Ua(e+32|0);Gs(e+20|0);Gs(e+8|0);return}function dr(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function fr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;r=J;J=J+16|0;i=r+4|0;o=r;a=Zp(12)|0;Ia(a,t,n);s[o>>2]=0;s[i>>2]=s[o>>2];Ta(e,a,i);J=r;return}function pr(e){e=e|0;qr(e);ja(e+4784|0);return}function vr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;r=J;J=J+16|0;i=r+4|0;o=r;a=Zp(12)|0;Wa(a,t,n);s[o>>2]=0;s[i>>2]=s[o>>2];za(e,a,i);J=r;return}function gr(e){e=e|0;qr(e);io(e+4784|0);return}function mr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;r=J;J=J+16|0;i=r+4|0;o=r;a=Zp(12)|0;so(a,t,n);s[o>>2]=0;s[i>>2]=s[o>>2];ao(e,a,i);J=r;return}function yr(e){e=e|0;qr(e);yo(e+4784|0);return}function _r(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;r=J;J=J+16|0;i=r+4|0;o=r;a=Zp(12)|0;_o(a,t,n);s[o>>2]=0;s[i>>2]=s[o>>2];bo(e,a,i);J=r;return}function br(e){e=e|0;qr(e);Po(e+4784|0);return}function wr(e,t){e=e|0;t=t|0;return(Cr(e,t)|0)^1|0}function Br(){if((r[21456]|0)==0?Qp(21456)|0:0){Gt(21536,6,20,2);jp(21456)}return 21536}function Cr(e,t){e=e|0;t=t|0;if((s[e>>2]|0)==(s[t>>2]|0)?(s[e+8>>2]|0)==(s[t+8>>2]|0):0)e=(s[e+4>>2]|0)==(s[t+4>>2]|0);else e=0;return e|0}function Mr(){if((r[21464]|0)==0?Qp(21464)|0:0){Gt(21548,7,8,2);jp(21464)}return 21548}function kr(){if((r[21472]|0)==0?Qp(21472)|0:0){Gt(21560,8,6,2);jp(21472)}return 21560}function Er(e){e=e|0;pp(e);ep(e);return}function Fr(e,t){e=e|0;t=t|0;Ur(e);s[e>>2]=4624;s[e+4>>2]=t;s[e+8>>2]=0;s[e+12>>2]=0;s[e+16>>2]=0;r[e+20>>0]=1;return}function xr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4664;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Or(e,r);J=n;return}function Ur(e){e=e|0;s[e>>2]=4644;return}function Ir(e,t){e=e|0;t=t|0;var n=0,i=0,a=0,o=0,A=0,c=0,l=0;l=J;J=J+16|0;o=l;n=s[e+8>>2]|0;A=s[e+12>>2]|0;if((n|0)!=(A|0)){c=o+4|0;do{i=s[n>>2]|0;s[o>>2]=i;a=s[n+4>>2]|0;s[c>>2]=a;if(a|0){a=a+4|0;s[a>>2]=(s[a>>2]|0)+1}t=Hg[s[(s[i>>2]|0)+12>>2]&63](i,t)|0;Qr(o);n=n+8|0}while((n|0)!=(A|0))}n=e+20|0;if(r[n>>0]|0){r[n>>0]=0;sn(s[e+4>>2]|0)}J=l;return t|0}function Tr(e){e=e|0;s[e>>2]=4624;Rr(e+8|0);Sr(e);return}function Pr(e){e=e|0;Tr(e);ep(e);return}function Sr(e){e=e|0;return}function Dr(e){e=e|0;Z()}function Qr(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Rr(e){e=e|0;var t=0,n=0,r=0;n=s[e>>2]|0;if(n|0){r=e+4|0;t=s[r>>2]|0;if((t|0)==(n|0))t=n;else{do{t=t+-8|0;Qr(t)}while((t|0)!=(n|0));t=s[e>>2]|0}s[r>>2]=n;_e(t,(s[e+8>>2]|0)-t|0)}return}function Or(e,t){e=e|0;t=t|0;return}function Vr(e){e=e|0;av(e);ep(e);return}function Lr(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+8>>2]&255](e);return}function Hr(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==8546?e+12|0:0)|0}function Nr(e){e=e|0;_e(e,16);return}function Gr(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=4692;s[e+4>>2]=t;qr(e+8|0);return}function jr(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4740;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function Wr(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;t=s[t+4>>2]|0;s[e+4>>2]=t;s[e+8>>2]=t+(n<<3);return}function zr(e){e=e|0;s[(s[e>>2]|0)+4>>2]=s[e+4>>2];return}function Xr(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=e+12|0;s[i>>2]=0;s[e+16>>2]=r;do{if(t){if(t>>>0>536870911){i=C(8)|0;hv(i,6723);s[i>>2]=5956;k(i|0,3928,123)}else{r=Zp(t<<3)|0;break}}else r=0}while(0);s[e>>2]=r;n=r+(n<<3)|0;s[e+8>>2]=n;s[e+4>>2]=n;s[i>>2]=r+(t<<3);return}function Kr(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0;A=s[e>>2]|0;c=e+4|0;n=s[c>>2]|0;o=t+4|0;if((n|0)==(A|0)){i=o;a=e;r=s[o>>2]|0;n=A}else{r=s[o>>2]|0;do{a=n;n=n+-8|0;s[r+-8>>2]=s[n>>2];a=a+-4|0;s[r+-4>>2]=s[a>>2];s[n>>2]=0;s[a>>2]=0;r=(s[o>>2]|0)+-8|0;s[o>>2]=r}while((n|0)!=(A|0));i=o;a=e;n=s[e>>2]|0}s[a>>2]=r;s[i>>2]=n;A=t+8|0;o=s[c>>2]|0;s[c>>2]=s[A>>2];s[A>>2]=o;A=e+8|0;c=t+12|0;e=s[A>>2]|0;s[A>>2]=s[c>>2];s[c>>2]=e;s[t>>2]=s[i>>2];return}function Zr(e){e=e|0;var t=0,n=0,r=0,i=0;n=s[e+4>>2]|0;r=e+8|0;t=s[r>>2]|0;if((t|0)!=(n|0))do{i=t+-8|0;s[r>>2]=i;Qr(i);t=s[r>>2]|0}while((t|0)!=(n|0));t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function Jr(e){e=e|0;return 536870911}function Yr(e){e=e|0;s[e>>2]=4716;return}function qr(e){e=e|0;ai(e);oi(e+3980|0);Ai(e+4380|0);r[e+4780>>0]=0;r[e+4781>>0]=0;return}function $r(e){e=e|0;s[e>>2]=4692;gi(e+8|0);ri(e);return}function ei(e){e=e|0;$r(e);ep(e);return}function ti(e,t){e=e|0;t=t|0;return t|0}function ni(e,t){e=e|0;t=t|0;return yi(e+8|0,s[e+4>>2]|0,t)|0}function ri(e){e=e|0;return}function ii(e){e=e|0;ri(e);ep(e);return}function si(e,t){e=e|0;t=t|0;return t|0}function ai(e){e=e|0;var t=0,n=0;ui(e);hi(e+52|0);hi(e+436|0);Tn(e+852|0,64,0,0);r[e+3976>>0]=0;t=e+20|0;n=t+32|0;do{i[t>>1]=0;t=t+2|0}while((t|0)<(n|0));t=Zp(44)|0;Tn(t,256,0,0);s[e+896>>2]=t;t=Zp(44)|0;Tn(t,256,0,0);s[e+900>>2]=t;t=e+820|0;s[t>>2]=0;s[t+4>>2]=0;s[t+8>>2]=0;s[t+12>>2]=0;s[t+16>>2]=0;s[t+20>>2]=0;s[t+24>>2]=0;s[t+28>>2]=0;t=0;do{n=Zp(44)|0;Tn(n,256,0,0);s[e+904+(t<<2)>>2]=n;n=Zp(44)|0;Tn(n,256,0,0);s[e+1928+(t<<2)>>2]=n;n=Zp(44)|0;Tn(n,256,0,0);s[e+2952+(t<<2)>>2]=n;t=t+1|0}while(t>>>0<256);return}function oi(e){e=e|0;pi(e,16,4,8,0);pi(e+80|0,16,1,8,0);pi(e+160|0,32,2,8,0);pi(e+240|0,32,22,8,0);pi(e+320|0,32,20,8,0);return}function Ai(e){e=e|0;rn(e,16,4,8,0);rn(e+80|0,16,1,8,0);rn(e+160|0,32,2,8,0);rn(e+240|0,32,22,8,0);rn(e+320|0,32,20,8,0);return}function ci(e){e=e|0;vi(e+320|0);vi(e+240|0);vi(e+160|0);vi(e+80|0);vi(e);return}function li(e){e=e|0;var t=0,n=0;t=s[e+896>>2]|0;if(t|0){kn(t);ep(t)}t=s[e+900>>2]|0;if(t|0){kn(t);ep(t)}n=0;do{t=s[e+904+(n<<2)>>2]|0;if(t|0){kn(t);ep(t)}t=s[e+1928+(n<<2)>>2]|0;if(t|0){kn(t);ep(t)}t=s[e+2952+(n<<2)>>2]|0;if(t|0){kn(t);ep(t)}n=n+1|0}while((n|0)!=256);kn(e+852|0);return}function ui(e){e=e|0;var t=0;r[e>>0]=0;r[e+1>>0]=0;r[e+2>>0]=0;r[e+3>>0]=0;t=e+4|0;r[t>>0]=0;r[t+1>>0]=0;r[t+2>>0]=0;r[t+3>>0]=0;e=e+12|0;t=e;r[t>>0]=0;r[t+1>>0]=0;r[t+2>>0]=0;r[t+3>>0]=0;e=e+4|0;r[e>>0]=0;r[e+1>>0]=0;r[e+2>>0]=0;r[e+3>>0]=0;return}function hi(e){e=e|0;var t=0;t=e+384|0;do{di(e);e=e+24|0}while((e|0)!=(t|0));return}function di(e){e=e|0;fi(e);return}function fi(e){e=e|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=0;s[e+16>>2]=0;r[e+20>>0]=1;return}function pi(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0;s[e+4>>2]=t;s[e+8>>2]=n;s[e+12>>2]=r;s[e+16>>2]=i;s[e+36>>2]=0;s[e+40>>2]=0;s[e+44>>2]=0;Cn(e+48|0);s[e+68>>2]=0;s[e+72>>2]=0;s[e+76>>2]=0;do{if(!i){n=e+20|0;if((t+-1|0)>>>0<31){s[n>>2]=t;i=1<<t;s[e+24>>2]=i;n=i>>>1;s[e+28>>2]=0-n;n=i+-1-n|0;break}else{s[n>>2]=32;s[e+24>>2]=0;s[e+28>>2]=-2147483648;n=2147483647;break}}else{r=e+20|0;s[r>>2]=0;s[e+24>>2]=i;n=i;a=0;while(1){n=n>>>1;t=a+1|0;if(!n)break;else a=t}s[r>>2]=(1<<a|0)==(i|0)?a:t;n=i>>>1;s[e+28>>2]=0-n;n=i+-1-n|0}}while(0);s[e+32>>2]=n;s[e>>2]=0;return}function vi(e){e=e|0;var t=0,n=0,r=0,i=0,a=0;a=e+36|0;n=s[a>>2]|0;r=e+40|0;t=s[r>>2]|0;if((t|0)!=(n|0))do{t=t+-44|0;kn(t)}while((t|0)!=(n|0));s[r>>2]=n;r=e+68|0;i=s[r>>2]|0;n=e+72|0;t=s[n>>2]|0;if((t|0)!=(i|0))do{t=t+-44|0;kn(t)}while((t|0)!=(i|0));s[n>>2]=i;Mn(r);Mn(a);return}function gi(e){e=e|0;mi(e+4380|0);ci(e+3980|0);li(e);return}function mi(e){e=e|0;An(e+320|0);An(e+240|0);An(e+160|0);An(e+80|0);An(e);return}function yi(e,t,n){e=e|0;t=t|0;n=n|0;var A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;p=J;J=J+32|0;f=p;A=e+4781|0;if(!(r[A>>0]|0)){_i(e+4380|0);r[A>>0]=1}A=e+3976|0;if(!(r[A>>0]|0)){r[A>>0]=1;wi(bi(t)|0,n,20);Bi(f,n);l=e;A=f;c=l+20|0;do{r[l>>0]=r[A>>0]|0;l=l+1|0;A=A+1|0}while((l|0)<(c|0));i[e+12>>1]=0}else{h=Gn(t,e+852|0)|0;if(h){if(h&32|0)Mi((Gn(t,s[e+904+(((Ci(e)|0)&255)<<2)>>2]|0)|0)&255,e);d=e+14|0;l=r[d>>0]|0;A=l&7;l=(l&255)>>>3&7;c=a[16+(l<<3)+A>>0]|0;A=a[80+(l<<3)+A>>0]|0;if(!(h&16))u=i[e+20+(c<<1)>>1]|0;else{v=e+20+(c<<1)|0;u=(on(e+4380|0,t,o[v>>1]|0,c>>>0<3?c:3)|0)&65535;i[v>>1]=u}i[e+12>>1]=u;if(h&8|0){v=e+15|0;r[v>>0]=Gn(t,s[e+1928+(a[v>>0]<<2)>>2]|0)|0}if(h&4|0){d=Gn(t,s[e+896+(((a[d>>0]|0)>>>6&1)<<2)>>2]|0)|0;v=e+16|0;r[v>>0]=ki(d+(r[v>>0]|0)|0)|0}if(h&2|0){v=e+17|0;r[v>>0]=Gn(t,s[e+2952+(a[v>>0]<<2)>>2]|0)|0}if(h&1){v=e+18|0;i[v>>1]=on(e+4460|0,t,o[v>>1]|0,0)|0}}else{v=r[e+14>>0]|0;A=v&7;v=(v&255)>>>3&7;l=v;c=a[16+(v<<3)+A>>0]|0;A=a[80+(v<<3)+A>>0]|0}u=e+52+(c*24|0)|0;h=e+4540|0;d=(l|0)==1&1;l=on(h,t,Ei(u)|0,d)|0;s[f>>2]=l;s[e>>2]=(s[e>>2]|0)+l;Fi(u,f);u=e+436+(c*24|0)|0;l=Ei(u)|0;c=xi(h)|0;v=e+4620|0;c=on(v,t,l,(c>>>0<20?c&-2:20)|d)|0;s[f>>2]=c;l=e+4|0;s[l>>2]=(s[l>>2]|0)+c;Fi(u,f);f=xi(h)|0;f=(xi(v)|0)+f|0;v=e+820+(A<<2)|0;f=on(e+4700|0,t,s[v>>2]|0,(f>>>0<36?f>>>1&2147483646:18)|d)|0;s[e+8>>2]=f;s[v>>2]=f;Ui(e,n)}J=p;return n+20|0}function _i(e){e=e|0;an(e);an(e+80|0);an(e+160|0);an(e+240|0);an(e+320|0);return}function bi(e){e=e|0;return s[e>>2]|0}function wi(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0,c=0,l=0;l=e+4|0;i=s[l>>2]|0;c=(s[e+8>>2]|0)-i|0;c=c>>>0>n>>>0?n:c;A=e+12|0;a=(s[A>>2]|0)+i|0;o=a+c|0;if(c){i=a;a=t;while(1){r[a>>0]=r[i>>0]|0;i=i+1|0;if((i|0)==(o|0))break;else a=a+1|0}i=s[l>>2]|0}s[l>>2]=i+c;n=n-c|0;if(n|0){Fn(e);a=(s[A>>2]|0)+(s[l>>2]|0)|0;o=a+n|0;i=t+c|0;while(1){r[i>>0]=r[a>>0]|0;a=a+1|0;if((a|0)==(o|0))break;else i=i+1|0}s[l>>2]=(s[l>>2]|0)+n}return}function Bi(e,t){e=e|0;t=t|0;ui(e);s[e>>2]=Ii(t)|0;s[e+4>>2]=Ii(t+4|0)|0;s[e+8>>2]=Ii(t+8|0)|0;i[e+12>>1]=Ti(t+12|0)|0;Mi(Pi(t+14|0)|0,e);r[e+15>>0]=Pi(t+15|0)|0;r[e+16>>0]=Si(t+16|0)|0;r[e+17>>0]=Si(t+17|0)|0;i[e+18>>1]=Ti(t+18|0)|0;return}function Ci(e){e=e|0;return r[e+14>>0]|0}function Mi(e,t){e=e|0;t=t|0;r[t+14>>0]=e;return}function ki(e){e=e|0;return e&255|0}function Ei(e){e=e|0;return s[e+8>>2]|0}function Fi(e,t){e=e|0;t=t|0;var n=0,i=0,a=0,o=0,A=0,c=0,l=0;l=e+20|0;do{if(!(r[l>>0]|0)){c=e+8|0;n=s[c>>2]|0;i=s[t>>2]|0;a=e+4|0;o=s[a>>2]|0;if((n|0)>=(i|0)){if((o|0)<(i|0)){s[e>>2]=o;s[a>>2]=s[t>>2]}else s[e>>2]=i;r[l>>0]=1;break}s[e>>2]=o;s[a>>2]=n;a=e+16|0;o=s[a>>2]|0;A=s[t>>2]|0;n=e+12|0;i=s[n>>2]|0;if((o|0)<(A|0)){s[c>>2]=i;s[n>>2]=o;s[a>>2]=s[t>>2];break}if((i|0)<(A|0)){s[c>>2]=i;s[n>>2]=s[t>>2];break}else{s[c>>2]=A;break}}else{a=s[t>>2]|0;A=e+8|0;n=s[A>>2]|0;o=e+12|0;i=s[o>>2]|0;if((a|0)>=(n|0)){n=e+16|0;if((a|0)<(i|0)){s[n>>2]=i;s[o>>2]=s[t>>2]}else s[n>>2]=a;r[l>>0]=0;break}s[e+16>>2]=i;s[o>>2]=n;n=s[t>>2]|0;i=s[e>>2]|0;a=e+4|0;o=s[a>>2]|0;if((n|0)<(i|0)){s[A>>2]=o;s[a>>2]=i;s[e>>2]=s[t>>2];break}if((n|0)<(o|0)){s[A>>2]=o;s[a>>2]=s[t>>2];break}else{s[A>>2]=n;break}}}while(0);return}function xi(e){e=e|0;return s[e>>2]|0}function Ui(e,t){e=e|0;t=t|0;var n=0;Qi(a[e>>0]|a[e+1>>0]<<8|a[e+2>>0]<<16|a[e+3>>0]<<24,t);n=e+4|0;Qi(a[n>>0]|a[n+1>>0]<<8|a[n+2>>0]<<16|a[n+3>>0]<<24,t+4|0);n=e+8|0;Qi(a[n>>0]|a[n+1>>0]<<8|a[n+2>>0]<<16|a[n+3>>0]<<24,t+8|0);n=e+12|0;Ri(a[n>>0]|a[n+1>>0]<<8,t+12|0);Oi(Ci(e)|0,t+14|0);Oi(r[e+15>>0]|0,t+15|0);Vi(r[e+16>>0]|0,t+16|0);Vi(r[e+17>>0]|0,t+17|0);e=e+18|0;Ri(a[e>>0]|a[e+1>>0]<<8,t+18|0);return}function Ii(e){e=e|0;return Di(e)|0}function Ti(e){e=e|0;return(r[e+1>>0]<<8|a[e>>0])&65535|0}function Pi(e){e=e|0;return r[e>>0]|0}function Si(e){e=e|0;return r[e>>0]|0}function Di(e){e=e|0;return(a[e+1>>0]|0)<<8|(a[e>>0]|0)|(a[e+2>>0]|0)<<16|(a[e+3>>0]|0)<<24|0}function Qi(e,t){e=e|0;t=t|0;Li(e,t);return}function Ri(e,t){e=e|0;t=t|0;r[t+1>>0]=(e&65535)>>>8;r[t>>0]=e;return}function Oi(e,t){e=e|0;t=t|0;r[t>>0]=e;return}function Vi(e,t){e=e|0;t=t|0;r[t>>0]=e;return}function Li(e,t){e=e|0;t=t|0;r[t+3>>0]=e>>>24;r[t+2>>0]=e>>>16;r[t+1>>0]=e>>>8;r[t>>0]=e;return}function Hi(e,t){e=e|0;t=t|0;return}function Ni(e){e=e|0;av(e);ep(e);return}function Gi(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function ji(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==9202?e+12|0:0)|0}function Wi(e){e=e|0;_e(e,16);return}function zi(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=4768;s[e+4>>2]=t;Ki(e+8|0);return}function Xi(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4792;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function Ki(e){e=e|0;qi(e);$i(e+164|0);es(e+244|0);r[e+324>>0]=0;r[e+325>>0]=0;return}function Zi(e){e=e|0;s[e>>2]=4768;ss(e+8|0);ri(e);return}function Ji(e){e=e|0;Zi(e);ep(e);return}function Yi(e,t){e=e|0;t=t|0;return os(e+8|0,s[e+4>>2]|0,t)|0}function qi(e){e=e|0;var t=0,n=0,i=0,a=0,o=0,A=0,c=0;o=J;J=J+16|0;i=o;r[e>>0]=0;Tn(e+4|0,516,0,0);Tn(e+48|0,6,0,0);s[e+92>>2]=0;s[e+96>>2]=0;n=e+100|0;rs(n);is(i);a=s[i>>2]|0;i=s[i+4>>2]|0;t=4;while(1){A=n;c=A;r[c>>0]=a;r[c+1>>0]=a>>8;r[c+2>>0]=a>>16;r[c+3>>0]=a>>24;A=A+4|0;r[A>>0]=i;r[A+1>>0]=i>>8;r[A+2>>0]=i>>16;r[A+3>>0]=i>>24;t=t+-1|0;if(!t)break;else n=n+8|0}c=e+132|0;s[c>>2]=0;s[c+4>>2]=0;s[c+8>>2]=0;s[c+12>>2]=0;s[c+16>>2]=0;s[c+20>>2]=0;s[c+24>>2]=0;s[c+28>>2]=0;J=o;return}function $i(e){e=e|0;pi(e,32,9,8,0);return}function es(e){e=e|0;rn(e,32,9,8,0);return}function ts(e){e=e|0;vi(e);return}function ns(e){e=e|0;kn(e+48|0);kn(e+4|0);return}function rs(e){e=e|0;var t=0;t=e+32|0;do{is(e);e=e+8|0}while((e|0)!=(t|0));return}function is(e){e=e|0;var t=0;t=e;r[t>>0]=0;r[t+1>>0]=0;r[t+2>>0]=0;r[t+3>>0]=0;e=e+4|0;r[e>>0]=0;r[e+1>>0]=0;r[e+2>>0]=0;r[e+3>>0]=0;return}function ss(e){e=e|0;as(e+244|0);ts(e+164|0);ns(e);return}function as(e){e=e|0;An(e);return}function os(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,o=0,A=0,c=0,l=0;i=e+325|0;if(!(r[i>>0]|0)){As(e+244|0);r[i>>0]=1}if(!(r[e>>0]|0)){r[e>>0]=1;wi(bi(t)|0,n,8);A=cs(n)|0;c=B()|0;e=e+100|0;t=e;r[t>>0]=A;r[t+1>>0]=A>>8;r[t+2>>0]=A>>16;r[t+3>>0]=A>>24;e=e+4|0;r[e>>0]=c;r[e+1>>0]=c>>8;r[e+2>>0]=c>>16;r[e+3>>0]=c>>24}else{c=e+92|0;e:do{if(!(s[e+132+(s[c>>2]<<2)>>2]|0)){i=Gn(t,e+48|0)|0;switch(i|0){case 1:{t=on(e+244|0,t,0,0)|0;s[e+132+(s[c>>2]<<2)>>2]=t;t=s[c>>2]|0;l=s[e+132+(t<<2)>>2]|0;A=e+100+(t<<3)|0;o=A;i=o;o=o+4|0;l=ng(a[i>>0]|a[i+1>>0]<<8|a[i+2>>0]<<16|a[i+3>>0]<<24|0,a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24|0,l|0,((l|0)<0)<<31>>31|0)|0;o=B()|0;i=A;r[i>>0]=l;r[i+1>>0]=l>>8;r[i+2>>0]=l>>16;r[i+3>>0]=l>>24;A=A+4|0;r[A>>0]=o;r[A+1>>0]=o>>8;r[A+2>>0]=o>>16;r[A+3>>0]=o>>24;s[e+148+(t<<2)>>2]=0;break e}case 2:{l=e+96|0;s[l>>2]=(s[l>>2]|0)+1&3;A=e+100+(s[c>>2]<<3)+4|0;A=on(e+244|0,t,a[A>>0]|a[A+1>>0]<<8|a[A+2>>0]<<16|a[A+3>>0]<<24,8)|0;i=e+100+(s[l>>2]<<3)|0;o=i;r[o>>0]=0;r[o+1>>0]=0;r[o+2>>0]=0;r[o+3>>0]=0;i=i+4|0;r[i>>0]=A;r[i+1>>0]=A>>8;r[i+2>>0]=A>>16;r[i+3>>0]=A>>24;i=ls(t)|0;l=s[l>>2]|0;t=e+100+(l<<3)|0;A=t;o=A;A=A+4|0;A=a[A>>0]|a[A+1>>0]<<8|a[A+2>>0]<<16|a[A+3>>0]<<24;i=a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24|i;o=t;r[o>>0]=i;r[o+1>>0]=i>>8;r[o+2>>0]=i>>16;r[o+3>>0]=i>>24;t=t+4|0;r[t>>0]=A;r[t+1>>0]=A>>8;r[t+2>>0]=A>>16;r[t+3>>0]=A>>24;s[c>>2]=l;s[e+132+(l<<2)>>2]=0;s[e+148+(s[c>>2]<<2)>>2]=0;break e}default:{if((i|0)<=2)break e;s[c>>2]=i+2+(s[c>>2]|0)&3;os(e,t,n)|0;break e}}}else{A=Gn(t,e+4|0)|0;if((A|0)==1){i=on(e+244|0,t,s[e+132+(s[c>>2]<<2)>>2]|0,1)|0;l=s[c>>2]|0;t=e+100+(l<<3)|0;A=t;o=A;A=A+4|0;i=ng(a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24|0,a[A>>0]|a[A+1>>0]<<8|a[A+2>>0]<<16|a[A+3>>0]<<24|0,i|0,((i|0)<0)<<31>>31|0)|0;A=B()|0;o=t;r[o>>0]=i;r[o+1>>0]=i>>8;r[o+2>>0]=i>>16;r[o+3>>0]=i>>24;t=t+4|0;r[t>>0]=A;r[t+1>>0]=A>>8;r[t+2>>0]=A>>16;r[t+3>>0]=A>>24;s[e+148+(l<<2)>>2]=0;break}if((A|0)>=511){if((A|0)==512){l=e+96|0;s[l>>2]=(s[l>>2]|0)+1&3;A=e+100+(s[c>>2]<<3)+4|0;A=on(e+244|0,t,a[A>>0]|a[A+1>>0]<<8|a[A+2>>0]<<16|a[A+3>>0]<<24,8)|0;i=e+100+(s[l>>2]<<3)|0;o=i;r[o>>0]=0;r[o+1>>0]=0;r[o+2>>0]=0;r[o+3>>0]=0;i=i+4|0;r[i>>0]=A;r[i+1>>0]=A>>8;r[i+2>>0]=A>>16;r[i+3>>0]=A>>24;i=ls(t)|0;l=s[l>>2]|0;t=e+100+(l<<3)|0;A=t;o=A;A=A+4|0;A=a[A>>0]|a[A+1>>0]<<8|a[A+2>>0]<<16|a[A+3>>0]<<24;i=a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24|i;o=t;r[o>>0]=i;r[o+1>>0]=i>>8;r[o+2>>0]=i>>16;r[o+3>>0]=i>>24;t=t+4|0;r[t>>0]=A;r[t+1>>0]=A>>8;r[t+2>>0]=A>>16;r[t+3>>0]=A>>24;s[c>>2]=l;s[e+132+(l<<2)>>2]=0;s[e+148+(s[c>>2]<<2)>>2]=0;break}if((A|0)<=511)break;s[c>>2]=(s[c>>2]|0)+A&3;os(e,t,n)|0;break}do{if(!A){i=on(e+244|0,t,0,7)|0;o=e+148+(s[c>>2]<<2)|0;s[o>>2]=(s[o>>2]|0)+1;o=s[c>>2]|0;if((s[e+148+(o<<2)>>2]|0)>3){s[e+132+(o<<2)>>2]=i;s[e+148+(s[c>>2]<<2)>>2]=0}}else{if((A|0)<500){i=e+244|0;o=y(s[e+132+(s[c>>2]<<2)>>2]|0,A)|0;if((A|0)<10){i=on(i,t,o,2)|0;break}else{i=on(i,t,o,3)|0;break}}if((A|0)==500){i=on(e+244|0,t,(s[e+132+(s[c>>2]<<2)>>2]|0)*500|0,4)|0;o=e+148+(s[c>>2]<<2)|0;s[o>>2]=(s[o>>2]|0)+1;o=s[c>>2]|0;if((s[e+148+(o<<2)>>2]|0)<=3)break;s[e+132+(o<<2)>>2]=i;s[e+148+(s[c>>2]<<2)>>2]=0;break}i=500-A|0;o=e+244|0;A=s[e+132+(s[c>>2]<<2)>>2]|0;if((i|0)>-10){i=on(o,t,y(A,i)|0,5)|0;break}i=on(o,t,y(A,-10)|0,6)|0;o=e+148+(s[c>>2]<<2)|0;s[o>>2]=(s[o>>2]|0)+1;o=s[c>>2]|0;if((s[e+148+(o<<2)>>2]|0)>3){s[e+132+(o<<2)>>2]=i;s[e+148+(s[c>>2]<<2)>>2]=0}}}while(0);l=e+100+(s[c>>2]<<3)|0;o=l;t=o;o=o+4|0;o=ng(a[t>>0]|a[t+1>>0]<<8|a[t+2>>0]<<16|a[t+3>>0]<<24|0,a[o>>0]|a[o+1>>0]<<8|a[o+2>>0]<<16|a[o+3>>0]<<24|0,i|0,((i|0)<0)<<31>>31|0)|0;t=B()|0;A=l;r[A>>0]=o;r[A+1>>0]=o>>8;r[A+2>>0]=o>>16;r[A+3>>0]=o>>24;l=l+4|0;r[l>>0]=t;r[l+1>>0]=t>>8;r[l+2>>0]=t>>16;r[l+3>>0]=t>>24}}while(0);us(e+100+(s[c>>2]<<3)|0,n)}return n+8|0}function As(e){e=e|0;an(e);return}function cs(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;r=Di(e)|0;hs(n,r,Di(e+4|0)|0);e=s[n>>2]|0;w(s[n+4>>2]|0);J=t;return e|0}function ls(e){e=e|0;var t=0;t=(Xn(e)|0)&65535;return((Xn(e)|0)&65535)<<16|t|0}function us(e,t){e=e|0;t=t|0;var n=0;n=e;Li(a[n>>0]|a[n+1>>0]<<8|a[n+2>>0]<<16|a[n+3>>0]<<24,t);e=e+4|0;Li(a[e>>0]|a[e+1>>0]<<8|a[e+2>>0]<<16|a[e+3>>0]<<24,t+4|0);return}function hs(e,t,n){e=e|0;t=t|0;n=n|0;var i=0;i=e;r[i>>0]=t;r[i+1>>0]=t>>8;r[i+2>>0]=t>>16;r[i+3>>0]=t>>24;t=e+4|0;r[t>>0]=n;r[t+1>>0]=n>>8;r[t+2>>0]=n>>16;r[t+3>>0]=n>>24;return}function ds(e){e=e|0;av(e);ep(e);return}function fs(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function ps(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==9890?e+12|0:0)|0}function vs(e){e=e|0;_e(e,16);return}function gs(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=4820;s[e+4>>2]=t;ys(e+8|0);return}function ms(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4844;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function ys(e){e=e|0;r[e>>0]=0;Bs(e+1|0);Tn(e+8|0,128,0,0);Tn(e+52|0,256,0,0);Tn(e+96|0,256,0,0);Tn(e+140|0,256,0,0);Tn(e+184|0,256,0,0);Tn(e+228|0,256,0,0);Tn(e+272|0,256,0,0);return}function _s(e){e=e|0;s[e>>2]=4820;Cs(e+8|0);ri(e);return}function bs(e){e=e|0;_s(e);ep(e);return}function ws(e,t){e=e|0;t=t|0;return Ms(e+8|0,s[e+4>>2]|0,t)|0}function Bs(e){e=e|0;var t=0;r[e>>0]=0;r[e+1>>0]=0;t=e+2|0;r[t>>0]=0;r[t+1>>0]=0;e=e+4|0;r[e>>0]=0;r[e+1>>0]=0;return}function Cs(e){e=e|0;kn(e+272|0);kn(e+228|0);kn(e+184|0);kn(e+140|0);kn(e+96|0);kn(e+52|0);kn(e+8|0);return}function Ms(e,t,n){e=e|0;t=t|0;n=n|0;var s=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0;f=J;J=J+16|0;h=f;if(!(r[e>>0]|0)){r[e>>0]=1;wi(bi(t)|0,n,6);ks(h,n);d=e+1|0;r[d>>0]=r[h>>0]|0;r[d+1>>0]=r[h+1>>0]|0;r[d+2>>0]=r[h+2>>0]|0;r[d+3>>0]=r[h+3>>0]|0;r[d+4>>0]=r[h+4>>0]|0;r[d+5>>0]=r[h+5>>0]|0}else{d=Gn(t,e+8|0)|0;Bs(h);if(!(d&1)){s=e+1|0;s=(a[s>>0]|a[s+1>>0]<<8)&255}else{u=(Gn(t,e+52|0)|0)&255;s=e+1|0;s=(ki(u+((a[s>>0]|a[s+1>>0]<<8)&255)|0)|0)&255}i[h>>1]=s;if(!(d&2)){u=e+1|0;s=s|(a[u>>0]|a[u+1>>0]<<8)&-256}else{s=(Gn(t,e+96|0)|0)&255;u=e+1|0;s=((ki((((a[u>>0]|a[u+1>>0]<<8)&65535)>>>8)+s|0)|0)&255)<<8;s=(s|o[h>>1])&65535}i[h>>1]=s;do{if(d&64){l=e+1|0;A=(s&255)-((a[l>>0]|a[l+1>>0]<<8)&255)|0;if(!(d&4)){s=e+3|0;s=(a[s>>0]|a[s+1>>0]<<8)&255}else{s=(Gn(t,e+140|0)|0)&255;u=e+3|0;u=A+((a[u>>0]|a[u+1>>0]<<8)&255)|0;s=(ki(((u|0)<1?0:(u|0)>254?255:u&255)+s|0)|0)&255}u=h+2|0;i[u>>1]=s;if(!(d&16)){s=e+5|0;s=(a[s>>0]|a[s+1>>0]<<8)&255}else{s=Gn(t,e+228|0)|0;p=e+3|0;c=e+5|0;c=((A+(i[u>>1]&255)-((a[p>>0]|a[p+1>>0]<<8)&255)|0)/2|0)+((a[c>>0]|a[c+1>>0]<<8)&255)|0;s=(ki(((c|0)<1?0:(c|0)>254?255:c&255)+(s&255)|0)|0)&255}c=h+4|0;i[c>>1]=s;s=((o[h>>1]|0)>>>8)-(((a[l>>0]|a[l+1>>0]<<8)&65535)>>>8)|0;if(!(d&8)){A=e+3|0;A=i[u>>1]|(a[A>>0]|a[A+1>>0]<<8)&-256}else{A=(Gn(t,e+184|0)|0)&255;p=e+3|0;p=(((a[p>>0]|a[p+1>>0]<<8)&65535)>>>8)+s|0;A=((ki(((p|0)<1?0:(p|0)>254?255:p&255)+A|0)|0)&255)<<8;A=(A|o[u>>1])&65535}i[u>>1]=A;if(!(d&32)){p=e+5|0;i[c>>1]=i[c>>1]|(a[p>>0]|a[p+1>>0]<<8)&-256;break}else{p=Gn(t,e+272|0)|0;t=e+3|0;d=e+5|0;d=((((o[u>>1]|0)>>>8)+s-(((a[t>>0]|a[t+1>>0]<<8)&65535)>>>8)|0)/2|0)+(((a[d>>0]|a[d+1>>0]<<8)&65535)>>>8)|0;p=((ki(((d|0)<1?0:(d|0)>254?255:d&255)+(p&255)|0)|0)&255)<<8;i[c>>1]=p|o[c>>1];break}}else{i[h+2>>1]=s;i[h+4>>1]=s}}while(0);p=e+1|0;r[p>>0]=r[h>>0]|0;r[p+1>>0]=r[h+1>>0]|0;r[p+2>>0]=r[h+2>>0]|0;r[p+3>>0]=r[h+3>>0]|0;r[p+4>>0]=r[h+4>>0]|0;r[p+5>>0]=r[h+5>>0]|0;Es(p,n)}J=f;return n+6|0}function ks(e,t){e=e|0;t=t|0;var n=0,r=0;r=Ti(t)|0;n=Ti(t+2|0)|0;Fs(e,r,n,Ti(t+4|0)|0);return}function Es(e,t){e=e|0;t=t|0;var n=0;Ri(a[e>>0]|a[e+1>>0]<<8,t);n=e+2|0;Ri(a[n>>0]|a[n+1>>0]<<8,t+2|0);e=e+4|0;Ri(a[e>>0]|a[e+1>>0]<<8,t+4|0);return}function Fs(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;r[e>>0]=t;r[e+1>>0]=t>>8;t=e+2|0;r[t>>0]=n;r[t+1>>0]=n>>8;n=e+4|0;r[n>>0]=i;r[n+1>>0]=i>>8;return}function xs(e){e=e|0;av(e);ep(e);return}function Us(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function Is(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==10570?e+12|0:0)|0}function Ts(e){e=e|0;_e(e,16);return}function Ps(e,t,n){e=e|0;t=t|0;n=n|0;Yr(e);s[e>>2]=4872;s[e+4>>2]=t;Ds(e+8|0,n);return}function Ss(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4896;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function Ds(e,t){e=e|0;t=t|0;s[e>>2]=s[t>>2];r[e+4>>0]=r[t+4>>0]|0;Vs(e+8|0,t+8|0);Vs(e+20|0,t+20|0);Ls(e+32|0,t+32|0);return}function Qs(e){e=e|0;s[e>>2]=4872;hr(e+8|0);ri(e);return}function Rs(e){e=e|0;Qs(e);ep(e);return}function Os(e,t){e=e|0;t=t|0;return _a(e+8|0,s[e+4>>2]|0,t)|0}function Vs(e,t){e=e|0;t=t|0;var n=0,r=0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;n=t+4|0;r=(s[n>>2]|0)-(s[t>>2]|0)|0;if(r|0){Hs(e,r);Ns(e,s[t>>2]|0,s[n>>2]|0,r)}return}function Ls(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+32|0;r=n+24|0;i=n+16|0;o=n+8|0;a=n;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=0;s[e+16>>2]=0;s[e+20>>2]=0;va(o,t);ga(a,t);s[i>>2]=s[o>>2];s[i+4>>2]=s[o+4>>2];s[r>>2]=s[a>>2];s[r+4>>2]=s[a+4>>2];Xs(e,i,r,0);J=n;return}function Hs(e,t){e=e|0;t=t|0;var n=0;if((js(e)|0)>>>0<t>>>0)Xv(e);else{n=Zp(t)|0;s[e+4>>2]=n;s[e>>2]=n;s[e+8>>2]=n+t;return}}function Ns(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=J;J=J+16|0;i=a;Ws(i,e,r);r=i+4|0;e=n-t|0;if((e|0)>0){ug(s[r>>2]|0,t|0,e|0)|0;s[r>>2]=(s[r>>2]|0)+e}zs(i);J=a;return}function Gs(e){e=e|0;var t=0,n=0;t=s[e>>2]|0;n=t;if(t|0){s[e+4>>2]=n;_e(t,(s[e+8>>2]|0)-n|0)}return}function js(e){e=e|0;return 2147483647}function Ws(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;t=s[t+4>>2]|0;s[e+4>>2]=t;s[e+8>>2]=t+n;return}function zs(e){e=e|0;s[(s[e>>2]|0)+4>>2]=s[e+4>>2];return}function Xs(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;v=J;J=J+96|0;p=v+80|0;h=v+64|0;c=v+48|0;l=v+40|0;u=v+8|0;A=v;d=v+32|0;f=v+16|0;o=t;a=s[o>>2]|0;o=s[o+4>>2]|0;i=n;n=s[i>>2]|0;i=s[i+4>>2]|0;r=a;if((i|0)==(o|0))o=0;else o=((i-(s[n>>2]|0)|0)/44|0)+((n-a>>2)*93|0)+((o-(s[a>>2]|0)|0)/-44|0)|0;n=(s[e+8>>2]|0)-(s[e+4>>2]|0)|0;n=((n|0)==0?0:((n>>2)*93|0)+-1|0)-((s[e+20>>2]|0)+(s[e+16>>2]|0))|0;if(o>>>0>n>>>0)Zs(e,o-n|0);Js(l,e);Js(A,e);i=A;n=s[i>>2]|0;i=s[i+4>>2]|0;a=u;s[a>>2]=n;s[a+4>>2]=i;a=n;if(o|0){n=((i-(s[n>>2]|0)|0)/44|0)+o|0;if((n|0)>0){A=(n>>>0)/93|0;o=a+(A<<2)|0;s[u>>2]=o;n=(s[o>>2]|0)+((n-(A*93|0)|0)*44|0)|0}else{n=92-n|0;A=a+(((n|0)/-93|0)<<2)|0;s[u>>2]=A;n=(s[A>>2]|0)+((92-((n|0)%93|0)|0)*44|0)|0}s[u+4>>2]=n}s[h>>2]=s[l>>2];s[h+4>>2]=s[l+4>>2];s[p>>2]=s[u>>2];s[p+4>>2]=s[u+4>>2];Ys(c,h,p);qs(p,c);$s(h,c);if(ea(p,h)|0){a=f+4|0;o=t+4|0;do{ta(d,p);na(f,e,d);n=s[f>>2]|0;if((n|0)!=(s[a>>2]|0)){i=s[o>>2]|0;do{Ln(n,i);n=(s[f>>2]|0)+44|0;s[f>>2]=n;i=i+44|0;s[o>>2]=i;if((i-(s[r>>2]|0)|0)==4092){r=r+4|0;s[t>>2]=r;i=s[r>>2]|0;s[o>>2]=i}}while((n|0)!=(s[a>>2]|0))}ra(f);ia(p)|0}while(ea(p,h)|0)}J=v;return}function Ks(e){e=e|0;var t=0,n=0,r=0;t=s[e+4>>2]|0;n=e+8|0;r=s[n>>2]|0;if((r|0)!=(t|0))s[n>>2]=r+(~((r+-4-t|0)>>>2)<<2);t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function Zs(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0,g=0,m=0,_=0,b=0,w=0,B=0,C=0,M=0,k=0,E=0,F=0;E=J;J=J+64|0;b=E+52|0;_=E+48|0;w=E+28|0;B=E+24|0;C=E+20|0;p=E;M=e+8|0;n=s[M>>2]|0;k=e+4|0;c=s[k>>2]|0;g=((n|0)==(c|0)&1)+t|0;o=(g>>>0)/93|0;o=o+((g-(o*93|0)|0)!=0&1)|0;g=e+16|0;r=s[g>>2]|0;A=(r>>>0)/93|0;v=o>>>0<A>>>0?o:A;t=o-v|0;a=n;e:do{if(!t){s[g>>2]=(y(v,-93)|0)+r;if(v|0){A=e+12|0;l=e+12|0;u=w+4|0;h=w+8|0;d=w+12|0;t=v;r=c;while(1){o=s[r>>2]|0;a=r+4|0;s[k>>2]=a;m=s[A>>2]|0;r=m;do{if((n|0)==(m|0)){m=s[e>>2]|0;n=m;if(a>>>0<=m>>>0){n=r-n|0;n=(n|0)==0?1:n>>1;oa(w,n,n>>>2,l);s[B>>2]=s[k>>2];s[C>>2]=s[M>>2];s[_>>2]=s[B>>2];s[b>>2]=s[C>>2];ua(w,_,b);n=s[e>>2]|0;s[e>>2]=s[w>>2];s[w>>2]=n;n=s[k>>2]|0;s[k>>2]=s[u>>2];s[u>>2]=n;n=s[M>>2]|0;s[M>>2]=s[h>>2];s[h>>2]=n;n=s[A>>2]|0;s[A>>2]=s[d>>2];s[d>>2]=n;la(w);n=s[M>>2]|0;break}m=a;n=((m-n>>2)+1|0)/-2|0;i=a+(n<<2)|0;r=r-m|0;if(!r)n=i;else{hg(i|0,a|0,r|0)|0;n=(s[k>>2]|0)+(n<<2)|0}m=i+(r>>2<<2)|0;s[M>>2]=m;s[k>>2]=n;n=m}}while(0);s[n>>2]=o;n=(s[M>>2]|0)+4|0;s[M>>2]=n;t=t+-1|0;if(!t)break e;r=s[k>>2]|0}}}else{m=e+12|0;r=s[m>>2]|0;i=r-(s[e>>2]|0)|0;n=a-c>>2;if(t>>>0>((i>>2)-n|0)>>>0){f=i>>1;d=n+t|0;oa(p,f>>>0<d>>>0?d:f,n-v|0,e+12|0);do{s[b>>2]=Zp(4092)|0;Aa(p,b);t=t+-1|0}while((t|0)!=0);if(!v)n=s[k>>2]|0;else{A=p+8|0;c=p+12|0;l=p+4|0;u=p+16|0;h=w+4|0;d=w+8|0;f=w+12|0;o=v;t=s[A>>2]|0;n=s[k>>2]|0;do{a=s[c>>2]|0;r=a;do{if((t|0)==(a|0)){i=s[l>>2]|0;a=s[p>>2]|0;t=a;if(i>>>0<=a>>>0){t=r-t|0;t=(t|0)==0?1:t>>1;oa(w,t,t>>>2,s[u>>2]|0);s[B>>2]=s[l>>2];s[C>>2]=s[A>>2];s[_>>2]=s[B>>2];s[b>>2]=s[C>>2];ua(w,_,b);t=s[p>>2]|0;s[p>>2]=s[w>>2];s[w>>2]=t;t=s[l>>2]|0;s[l>>2]=s[h>>2];s[h>>2]=t;t=s[A>>2]|0;s[A>>2]=s[d>>2];s[d>>2]=t;t=s[c>>2]|0;s[c>>2]=s[f>>2];s[f>>2]=t;la(w);t=s[A>>2]|0;break}F=i;t=((F-t>>2)+1|0)/-2|0;a=i+(t<<2)|0;r=r-F|0;if(!r)t=a;else{hg(a|0,i|0,r|0)|0;t=(s[l>>2]|0)+(t<<2)|0}F=a+(r>>2<<2)|0;s[A>>2]=F;s[l>>2]=t;t=F}}while(0);s[t>>2]=s[n>>2];t=(s[A>>2]|0)+4|0;s[A>>2]=t;n=(s[k>>2]|0)+4|0;s[k>>2]=n;o=o+-1|0}while((o|0)!=0)}t=s[M>>2]|0;if((t|0)!=(n|0)){do{t=t+-4|0;ca(p,t);n=s[k>>2]|0}while((t|0)!=(n|0));t=s[M>>2]|0}F=s[e>>2]|0;s[e>>2]=s[p>>2];s[p>>2]=F;F=p+4|0;s[k>>2]=s[F>>2];s[F>>2]=n;F=p+8|0;s[M>>2]=s[F>>2];s[F>>2]=t;F=p+12|0;k=s[m>>2]|0;s[m>>2]=s[F>>2];s[F>>2]=k;s[g>>2]=(s[g>>2]|0)+(y(v,-93)|0);la(p);break}else{t:do{if((r|0)==(a|0))l=18;else{while(1){s[b>>2]=Zp(4092)|0;sa(e,b);t=t+-1|0;if(!t)break;if((s[m>>2]|0)==(s[M>>2]|0)){l=18;break t}}n=v;t=s[g>>2]|0}}while(0);if((l|0)==18){r=~(o>>>0>A>>>0?A:o);n=t;do{s[b>>2]=Zp(4092)|0;aa(e,b);n=n+-1|0;i=(((s[M>>2]|0)-(s[k>>2]|0)|0)==4?92:93)+(s[g>>2]|0)|0;s[g>>2]=i}while((n|0)!=0);n=t+-1-r|0;t=i}s[g>>2]=t+(y(n,-93)|0);if(!n)break;A=e+12|0;c=w+4|0;l=w+8|0;u=w+12|0;t=s[M>>2]|0;do{a=s[k>>2]|0;o=s[a>>2]|0;a=a+4|0;s[k>>2]=a;F=s[m>>2]|0;r=F;do{if((t|0)==(F|0)){F=s[e>>2]|0;t=F;if(a>>>0<=F>>>0){t=r-t|0;t=(t|0)==0?1:t>>1;oa(w,t,t>>>2,A);s[B>>2]=s[k>>2];s[C>>2]=s[M>>2];s[_>>2]=s[B>>2];s[b>>2]=s[C>>2];ua(w,_,b);t=s[e>>2]|0;s[e>>2]=s[w>>2];s[w>>2]=t;t=s[k>>2]|0;s[k>>2]=s[c>>2];s[c>>2]=t;t=s[M>>2]|0;s[M>>2]=s[l>>2];s[l>>2]=t;t=s[m>>2]|0;s[m>>2]=s[u>>2];s[u>>2]=t;la(w);t=s[M>>2]|0;break}F=a;t=((F-t>>2)+1|0)/-2|0;i=a+(t<<2)|0;r=r-F|0;if(!r)t=i;else{hg(i|0,a|0,r|0)|0;t=(s[k>>2]|0)+(t<<2)|0}F=i+(r>>2<<2)|0;s[M>>2]=F;s[k>>2]=t;t=F}}while(0);s[t>>2]=o;t=(s[M>>2]|0)+4|0;s[M>>2]=t;n=n+-1|0}while((n|0)!=0)}}}while(0);J=E;return}function Js(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;n=(s[t+16>>2]|0)+(s[t+20>>2]|0)|0;a=s[t+4>>2]|0;r=(n>>>0)/93|0;i=a+(r<<2)|0;if((s[t+8>>2]|0)==(a|0))t=0;else t=(s[i>>2]|0)+((n-(r*93|0)|0)*44|0)|0;s[e>>2]=i;s[e+4>>2]=t;return}function Ys(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=t;t=s[i+4>>2]|0;r=e;s[r>>2]=s[i>>2];s[r+4>>2]=t;r=n;t=s[r+4>>2]|0;n=e+8|0;s[n>>2]=s[r>>2];s[n+4>>2]=t;return}function qs(e,t){e=e|0;t=t|0;s[e>>2]=s[t>>2];s[e+4>>2]=s[t+4>>2];s[e+8>>2]=s[t+8>>2];s[e+12>>2]=s[t+12>>2];return}function $s(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0;n=J;J=J+32|0;r=n+24|0;i=n+16|0;o=n+8|0;a=n;A=t+8|0;c=s[A>>2]|0;A=s[A+4>>2]|0;t=o;s[t>>2]=c;s[t+4>>2]=A;t=a;s[t>>2]=c;s[t+4>>2]=A;s[i>>2]=s[o>>2];s[i+4>>2]=s[o+4>>2];s[r>>2]=s[a>>2];s[r+4>>2]=s[a+4>>2];Ys(e,i,r);J=n;return}function ea(e,t){e=e|0;t=t|0;return(fa(e,t)|0)^1|0}function ta(e,t){e=e|0;t=t|0;var n=0,r=0;n=s[t>>2]|0;r=s[t+4>>2]|0;if((n|0)==(s[t+8>>2]|0))pa(e,r,s[t+12>>2]|0);else pa(e,r,(s[n>>2]|0)+4092|0);return}function na(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;r=s[n>>2]|0;s[e>>2]=r;s[e+4>>2]=s[n+4>>2];s[e+8>>2]=r;s[e+12>>2]=t;return}function ra(e){e=e|0;var t=0;t=(s[e+12>>2]|0)+20|0;s[t>>2]=(s[t>>2]|0)+(((s[e>>2]|0)-(s[e+8>>2]|0)|0)/44|0);return}function ia(e){e=e|0;var t=0,n=0,r=0;t=s[e>>2]|0;n=e+8|0;if((t|0)==(s[n>>2]|0)){r=n;t=s[r+4>>2]|0;n=e;s[n>>2]=s[r>>2];s[n+4>>2]=t}else{r=t+4|0;s[e>>2]=r;s[e+4>>2]=s[r>>2]}return e|0}function sa(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;p=J;J=J+48|0;i=p+32|0;r=p+28|0;A=p+8|0;c=p+4|0;l=p;f=e+8|0;n=s[f>>2]|0;u=e+12|0;d=s[u>>2]|0;a=d;do{if((n|0)==(d|0)){d=e+4|0;h=s[d>>2]|0;v=s[e>>2]|0;o=v;if(h>>>0<=v>>>0){n=a-o|0;n=(n|0)==0?1:n>>1;oa(A,n,n>>>2,e+12|0);s[c>>2]=s[d>>2];s[l>>2]=s[f>>2];s[r>>2]=s[c>>2];s[i>>2]=s[l>>2];ua(A,r,i);n=s[e>>2]|0;s[e>>2]=s[A>>2];s[A>>2]=n;n=A+4|0;v=s[d>>2]|0;s[d>>2]=s[n>>2];s[n>>2]=v;n=A+8|0;v=s[f>>2]|0;s[f>>2]=s[n>>2];s[n>>2]=v;n=A+12|0;v=s[u>>2]|0;s[u>>2]=s[n>>2];s[n>>2]=v;la(A);n=s[f>>2]|0;break}i=h;r=((i-o>>2)+1|0)/-2|0;e=h+(r<<2)|0;i=n-i|0;if(!i)n=e;else{hg(e|0,h|0,i|0)|0;n=(s[d>>2]|0)+(r<<2)|0}v=e+(i>>2<<2)|0;s[f>>2]=v;s[d>>2]=n;n=v}}while(0);s[n>>2]=s[t>>2];s[f>>2]=(s[f>>2]|0)+4;J=p;return}function aa(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;p=J;J=J+48|0;r=p+32|0;n=p+28|0;o=p+8|0;A=p+4|0;c=p;f=e+4|0;h=s[f>>2]|0;d=s[e>>2]|0;l=d;do{if((h|0)==(d|0)){d=e+8|0;u=s[d>>2]|0;a=e+12|0;v=s[a>>2]|0;i=v;if(u>>>0>=v>>>0){v=i-l|0;v=(v|0)==0?1:v>>1;oa(o,v,(v+3|0)>>>2,e+12|0);s[A>>2]=s[f>>2];s[c>>2]=s[d>>2];s[n>>2]=s[A>>2];s[r>>2]=s[c>>2];ua(o,n,r);n=s[e>>2]|0;s[e>>2]=s[o>>2];s[o>>2]=n;n=o+4|0;v=s[f>>2]|0;s[f>>2]=s[n>>2];s[n>>2]=v;n=o+8|0;v=s[d>>2]|0;s[d>>2]=s[n>>2];s[n>>2]=v;n=o+12|0;v=s[a>>2]|0;s[a>>2]=s[n>>2];s[n>>2]=v;la(o);n=s[f>>2]|0;break}r=u;e=((i-r>>2)+1|0)/2|0;i=u+(e<<2)|0;r=r-h|0;n=i+(0-(r>>2)<<2)|0;if(!r){n=i;r=i}else{hg(n|0,h|0,r|0)|0;r=(s[d>>2]|0)+(e<<2)|0}s[f>>2]=n;s[d>>2]=r}else n=h}while(0);s[n+-4>>2]=s[t>>2];s[f>>2]=(s[f>>2]|0)+-4;J=p;return}function oa(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;i=e+12|0;s[i>>2]=0;s[e+16>>2]=r;do{if(t){if(t>>>0>1073741823){i=C(8)|0;hv(i,6723);s[i>>2]=5956;k(i|0,3928,123)}else{r=Zp(t<<2)|0;break}}else r=0}while(0);s[e>>2]=r;n=r+(n<<2)|0;s[e+8>>2]=n;s[e+4>>2]=n;s[i>>2]=r+(t<<2);return}function Aa(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;p=J;J=J+48|0;i=p+32|0;r=p+28|0;A=p+8|0;c=p+4|0;l=p;f=e+8|0;n=s[f>>2]|0;u=e+12|0;d=s[u>>2]|0;a=d;do{if((n|0)==(d|0)){d=e+4|0;h=s[d>>2]|0;v=s[e>>2]|0;o=v;if(h>>>0<=v>>>0){n=a-o|0;n=(n|0)==0?1:n>>1;oa(A,n,n>>>2,s[e+16>>2]|0);s[c>>2]=s[d>>2];s[l>>2]=s[f>>2];s[r>>2]=s[c>>2];s[i>>2]=s[l>>2];ua(A,r,i);n=s[e>>2]|0;s[e>>2]=s[A>>2];s[A>>2]=n;n=A+4|0;v=s[d>>2]|0;s[d>>2]=s[n>>2];s[n>>2]=v;n=A+8|0;v=s[f>>2]|0;s[f>>2]=s[n>>2];s[n>>2]=v;n=A+12|0;v=s[u>>2]|0;s[u>>2]=s[n>>2];s[n>>2]=v;la(A);n=s[f>>2]|0;break}i=h;r=((i-o>>2)+1|0)/-2|0;e=h+(r<<2)|0;i=n-i|0;if(!i)n=e;else{hg(e|0,h|0,i|0)|0;n=(s[d>>2]|0)+(r<<2)|0}v=e+(i>>2<<2)|0;s[f>>2]=v;s[d>>2]=n;n=v}}while(0);s[n>>2]=s[t>>2];s[f>>2]=(s[f>>2]|0)+4;J=p;return}function ca(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0;p=J;J=J+48|0;r=p+32|0;n=p+28|0;o=p+8|0;A=p+4|0;c=p;f=e+4|0;h=s[f>>2]|0;d=s[e>>2]|0;l=d;do{if((h|0)==(d|0)){d=e+8|0;u=s[d>>2]|0;a=e+12|0;v=s[a>>2]|0;i=v;if(u>>>0>=v>>>0){v=i-l|0;v=(v|0)==0?1:v>>1;oa(o,v,(v+3|0)>>>2,s[e+16>>2]|0);s[A>>2]=s[f>>2];s[c>>2]=s[d>>2];s[n>>2]=s[A>>2];s[r>>2]=s[c>>2];ua(o,n,r);n=s[e>>2]|0;s[e>>2]=s[o>>2];s[o>>2]=n;n=o+4|0;v=s[f>>2]|0;s[f>>2]=s[n>>2];s[n>>2]=v;n=o+8|0;v=s[d>>2]|0;s[d>>2]=s[n>>2];s[n>>2]=v;n=o+12|0;v=s[a>>2]|0;s[a>>2]=s[n>>2];s[n>>2]=v;la(o);n=s[f>>2]|0;break}r=u;e=((i-r>>2)+1|0)/2|0;i=u+(e<<2)|0;r=r-h|0;n=i+(0-(r>>2)<<2)|0;if(!r){n=i;r=i}else{hg(n|0,h|0,r|0)|0;r=(s[d>>2]|0)+(e<<2)|0}s[f>>2]=n;s[d>>2]=r}else n=h}while(0);s[n+-4>>2]=s[t>>2];s[f>>2]=(s[f>>2]|0)+-4;J=p;return}function la(e){e=e|0;var t=0,n=0,r=0;t=s[e+4>>2]|0;n=e+8|0;r=s[n>>2]|0;if((r|0)!=(t|0))s[n>>2]=r+(~((r+-4-t|0)>>>2)<<2);t=s[e>>2]|0;if(t|0)_e(t,(s[e+12>>2]|0)-t|0);return}function ua(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0;o=J;J=J+16|0;a=o;i=s[t>>2]|0;ha(a,e+8|0,(s[n>>2]|0)-i>>2);e=s[a>>2]|0;r=a+4|0;if((e|0)!=(s[r>>2]|0)){n=i;do{s[e>>2]=s[n>>2];e=(s[a>>2]|0)+4|0;s[a>>2]=e;n=n+4|0}while((e|0)!=(s[r>>2]|0));s[t>>2]=n}da(a);J=o;return}function ha(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=s[t>>2];s[e+4>>2]=(s[t>>2]|0)+(n<<2);s[e+8>>2]=t;return}function da(e){e=e|0;s[s[e+8>>2]>>2]=s[e>>2];return}function fa(e,t){e=e|0;t=t|0;return(s[e+4>>2]|0)==(s[t+4>>2]|0)|0}function pa(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;s[e+4>>2]=n;return}function va(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;a=s[t+4>>2]|0;n=s[t+16>>2]|0;r=(n>>>0)/93|0;i=a+(r<<2)|0;if((s[t+8>>2]|0)==(a|0))t=0;else t=(s[i>>2]|0)+((n-(r*93|0)|0)*44|0)|0;s[e>>2]=i;s[e+4>>2]=t;return}function ga(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;n=(s[t+16>>2]|0)+(s[t+20>>2]|0)|0;a=s[t+4>>2]|0;r=(n>>>0)/93|0;i=a+(r<<2)|0;if((s[t+8>>2]|0)==(a|0))t=0;else t=(s[i>>2]|0)+((n-(r*93|0)|0)*44|0)|0;s[e>>2]=i;s[e+4>>2]=t;return}function ma(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0;A=J;J=J+16|0;r=A+8|0;a=A;ya(r,e);Js(a,e);i=r+4|0;t=s[i>>2]|0;a=a+4|0;if((t|0)!=(s[a>>2]|0))do{kn(t);t=(s[i>>2]|0)+44|0;s[i>>2]=t;n=s[r>>2]|0;if((t-(s[n>>2]|0)|0)==4092){t=n+4|0;s[r>>2]=t;t=s[t>>2]|0;s[i>>2]=t}}while((t|0)!=(s[a>>2]|0));s[e+20>>2]=0;i=e+8|0;r=e+4|0;n=s[r>>2]|0;t=(s[i>>2]|0)-n>>2;if(t>>>0>2)do{_e(s[n>>2]|0,4092);n=(s[r>>2]|0)+4|0;s[r>>2]=n;t=(s[i>>2]|0)-n>>2}while(t>>>0>2);switch(t|0){case 1:{t=46;o=11;break}case 2:{t=93;o=11;break}default:{}}if((o|0)==11)s[e+16>>2]=t;J=A;return}function ya(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;a=s[t+4>>2]|0;n=s[t+16>>2]|0;r=(n>>>0)/93|0;i=a+(r<<2)|0;if((s[t+8>>2]|0)==(a|0))t=0;else t=(s[i>>2]|0)+((n-(r*93|0)|0)*44|0)|0;s[e>>2]=i;s[e+4>>2]=t;return}function _a(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,o=0,A=0,c=0,l=0,u=0,h=0;h=J;J=J+16|0;u=h;c=e+4|0;if(!(r[c>>0]|0)){u=bi(t)|0;wi(u,n,s[e>>2]|0);u=s[e>>2]|0;A=n+u|0;if(!u)i=0;else{i=n;o=s[e+8>>2]|0;while(1){r[o>>0]=r[i>>0]|0;i=i+1|0;if((i|0)==(A|0))break;else o=o+1|0}i=s[e>>2]|0}r[c>>0]=1;n=n+i|0}else{o=s[e+20>>2]|0;i=s[e+8>>2]|0;ya(u,e+32|0);e=e+12|0;if((i|0)!=(s[e>>2]|0)){l=u+4|0;c=i;A=o;i=s[l>>2]|0;while(1){o=a[c>>0]|0;o=ba((Gn(t,i)|0)+o|0)|0;r[A>>0]=o;r[n>>0]=o;r[c>>0]=o;c=c+1|0;n=n+1|0;o=s[u>>2]|0;i=(s[l>>2]|0)+44|0;s[l>>2]=i;if((i-(s[o>>2]|0)|0)==4092){i=o+4|0;s[u>>2]=i;i=s[i>>2]|0;s[l>>2]=i}if((c|0)==(s[e>>2]|0))break;else A=A+1|0}}}J=h;return n|0}function ba(e){e=e|0;return e&255|0}function wa(e){e=e|0;av(e);ep(e);return}function Ba(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function Ca(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==11262?e+12|0:0)|0}function Ma(e){e=e|0;_e(e,16);return}function ka(e,t){e=e|0;t=t|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;if(t|0){Hs(e,t);Fa(e,t)}return}function Ea(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=0;s[e+16>>2]=0;s[e+20>>2]=0;if(t|0)xa(e,t,n);return}function Fa(e,t){e=e|0;t=t|0;var n=0,i=0,a=0;a=J;J=J+16|0;i=a;Ws(i,e,t);t=i+4|0;e=s[t>>2]|0;n=i+8|0;if((e|0)!=(s[n>>2]|0))do{r[e>>0]=0;e=(s[t>>2]|0)+1|0;s[t>>2]=e}while((e|0)!=(s[n>>2]|0));zs(i);J=a;return}function xa(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0;f=J;J=J+96|0;d=f+80|0;l=f+64|0;o=f+48|0;A=f+40|0;c=f+8|0;i=f;u=f+32|0;h=f+16|0;r=(s[e+8>>2]|0)-(s[e+4>>2]|0)|0;r=((r|0)==0?0:((r>>2)*93|0)+-1|0)-((s[e+20>>2]|0)+(s[e+16>>2]|0))|0;if(r>>>0<t>>>0)Zs(e,t-r|0);Js(A,e);Js(i,e);r=s[i>>2]|0;i=s[i+4>>2]|0;a=c;s[a>>2]=r;s[a+4>>2]=i;a=r;if(t|0){r=((i-(s[r>>2]|0)|0)/44|0)+t|0;if((r|0)>0){t=(r>>>0)/93|0;a=a+(t<<2)|0;s[c>>2]=a;r=(s[a>>2]|0)+((r-(t*93|0)|0)*44|0)|0}else{r=92-r|0;t=a+(((r|0)/-93|0)<<2)|0;s[c>>2]=t;r=(s[t>>2]|0)+((92-((r|0)%93|0)|0)*44|0)|0}s[c+4>>2]=r}s[l>>2]=s[A>>2];s[l+4>>2]=s[A+4>>2];s[d>>2]=s[c>>2];s[d+4>>2]=s[c+4>>2];Ys(o,l,d);qs(d,o);$s(l,o);if(ea(d,l)|0){i=h+4|0;do{ta(u,d);na(h,e,u);r=s[h>>2]|0;if((r|0)!=(s[i>>2]|0))do{Ln(r,n);r=(s[h>>2]|0)+44|0;s[h>>2]=r}while((r|0)!=(s[i>>2]|0));ra(h);ia(d)|0}while(ea(d,l)|0)}J=f;return}function Ua(e){e=e|0;var t=0,n=0;ma(e);t=s[e+4>>2]|0;n=s[e+8>>2]|0;if((t|0)!=(n|0))do{_e(s[t>>2]|0,4092);t=t+4|0}while((t|0)!=(n|0));Ks(e);return}function Ia(e,t,n){e=e|0;t=t|0;n=n|0;Ur(e);s[e>>2]=4924;s[e+4>>2]=t;s[e+8>>2]=n;return}function Ta(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4944;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Va(e,r);J=n;return}function Pa(e,t){e=e|0;t=t|0;return Qa(s[e+8>>2]|0,s[e+4>>2]|0,t)|0}function Sa(e){e=e|0;var t=0,n=0;s[e>>2]=4924;n=e+8|0;t=s[n>>2]|0;s[n>>2]=0;if(t|0){Oa(t);ep(t)}Sr(e);return}function Da(e){e=e|0;Sa(e);ep(e);return}function Qa(e,t,n){e=e|0;t=t|0;n=n|0;return Ra(e+4784|0,t,yi(e,t,n)|0)|0}function Ra(e,t,n){e=e|0;t=t|0;n=n|0;if(r[e>>0]|0){sn(t);r[e>>0]=0}return n|0}function Oa(e){e=e|0;gi(e);return}function Va(e,t){e=e|0;t=t|0;return}function La(e){e=e|0;av(e);ep(e);return}function Ha(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+8>>2]&255](e);return}function Na(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==12004?e+12|0:0)|0}function Ga(e){e=e|0;_e(e,16);return}function ja(e){e=e|0;r[e>>0]=1;return}function Wa(e,t,n){e=e|0;t=t|0;n=n|0;Ur(e);s[e>>2]=4972;s[e+4>>2]=t;s[e+8>>2]=n;return}function za(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=4992;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Va(e,r);J=n;return}function Xa(e,t){e=e|0;t=t|0;return Ja(s[e+8>>2]|0,s[e+4>>2]|0,t)|0}function Ka(e){e=e|0;var t=0,n=0;s[e>>2]=4972;n=e+8|0;t=s[n>>2]|0;s[n>>2]=0;if(t|0){qa(t);ep(t)}Sr(e);return}function Za(e){e=e|0;Ka(e);ep(e);return}function Ja(e,t,n){e=e|0;t=t|0;n=n|0;return Ya(e+4784|0,t,yi(e,t,n)|0)|0}function Ya(e,t,n){e=e|0;t=t|0;n=n|0;return Ra(e+328|0,t,os(e,t,n)|0)|0}function qa(e){e=e|0;$a(e+4784|0);gi(e);return}function $a(e){e=e|0;ss(e);return}function eo(e){e=e|0;av(e);ep(e);return}function to(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+8>>2]&255](e);return}function no(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==12827?e+12|0:0)|0}function ro(e){e=e|0;_e(e,16);return}function io(e){e=e|0;Ki(e);ja(e+328|0);return}function so(e,t,n){e=e|0;t=t|0;n=n|0;Ur(e);s[e>>2]=5020;s[e+4>>2]=t;s[e+8>>2]=n;return}function ao(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5040;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Va(e,r);J=n;return}function oo(e,t){e=e|0;t=t|0;return lo(s[e+8>>2]|0,s[e+4>>2]|0,t)|0}function Ao(e){e=e|0;var t=0,n=0;s[e>>2]=5020;n=e+8|0;t=s[n>>2]|0;s[n>>2]=0;if(t|0){ho(t);ep(t)}Sr(e);return}function co(e){e=e|0;Ao(e);ep(e);return}function lo(e,t,n){e=e|0;t=t|0;n=n|0;return uo(e+4784|0,t,yi(e,t,n)|0)|0}function uo(e,t,n){e=e|0;t=t|0;n=n|0;return Ra(e+316|0,t,Ms(e,t,n)|0)|0}function ho(e){e=e|0;fo(e+4784|0);gi(e);return}function fo(e){e=e|0;Cs(e);return}function po(e){e=e|0;av(e);ep(e);return}function vo(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+8>>2]&255](e);return}function go(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==13672?e+12|0:0)|0}function mo(e){e=e|0;_e(e,16);return}function yo(e){e=e|0;ys(e);ja(e+316|0);return}function _o(e,t,n){e=e|0;t=t|0;n=n|0;Ur(e);s[e>>2]=5068;s[e+4>>2]=t;s[e+8>>2]=n;return}function bo(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5088;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Va(e,r);J=n;return}function wo(e,t){e=e|0;t=t|0;return Mo(s[e+8>>2]|0,s[e+4>>2]|0,t)|0}function Bo(e){e=e|0;var t=0,n=0;s[e>>2]=5068;n=e+8|0;t=s[n>>2]|0;s[n>>2]=0;if(t|0){Eo(t);ep(t)}Sr(e);return}function Co(e){e=e|0;Bo(e);ep(e);return}function Mo(e,t,n){e=e|0;t=t|0;n=n|0;return ko(e+4784|0,t,yi(e,t,n)|0)|0}function ko(e,t,n){e=e|0;t=t|0;n=n|0;return uo(e+328|0,t,os(e,t,n)|0)|0}function Eo(e){e=e|0;Fo(e+4784|0);gi(e);return}function Fo(e){e=e|0;fo(e+328|0);ss(e);return}function xo(e){e=e|0;av(e);ep(e);return}function Uo(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+8>>2]&255](e);return}function Io(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==14573?e+12|0:0)|0}function To(e){e=e|0;_e(e,16);return}function Po(e){e=e|0;Ki(e);yo(e+328|0);return}function So(e){e=e|0;return e+20|0}function Do(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=t;s[e+4>>2]=n;s[e+8>>2]=0;return}function Qo(e,t){e=e|0;t=t|0;s[e>>2]=t;s[e+4>>2]=0;s[e+8>>2]=-1;return}function Ro(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;n=J;J=J+16|0;r=n+4|0;a=n;i=Zp(24)|0;eA(i,t);s[a>>2]=0;s[r>>2]=s[a>>2];tA(e,i,r);J=n;return}function Oo(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Vo(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5116;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Ho(e,r);J=n;return}function Lo(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Ho(e,t){e=e|0;t=t|0;return}function No(e){e=e|0;av(e);ep(e);return}function Go(e){e=e|0;e=s[e+12>>2]|0;if(e|0)ep(e);return}function jo(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==14966?e+12|0:0)|0}function Wo(e){e=e|0;_e(e,16);return}function zo(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5144;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Ko(e,r);J=n;return}function Xo(e){e=e|0;var t=0,n=0;e=s[e+4>>2]|0;if(e|0?(n=e+4|0,t=s[n>>2]|0,s[n>>2]=t+-1,(t|0)==0):0){jg[s[(s[e>>2]|0)+8>>2]&255](e);ov(e)}return}function Ko(e,t){e=e|0;t=t|0;return}function Zo(e){e=e|0;av(e);ep(e);return}function Jo(e){e=e|0;e=s[e+12>>2]|0;if(e|0){$o(e);ep(e)}return}function Yo(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==15127?e+12|0:0)|0}function qo(e){e=e|0;_e(e,16);return}function $o(e){e=e|0;return}function eA(e,t){e=e|0;t=t|0;Ur(e);s[e>>2]=5172;s[e+4>>2]=t;s[e+8>>2]=0;s[e+12>>2]=0;s[e+16>>2]=0;r[e+20>>0]=1;return}function tA(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5192;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;oA(e,r);J=n;return}function nA(e,t){e=e|0;t=t|0;var n=0,i=0,a=0,o=0,A=0,c=0,l=0;l=J;J=J+16|0;o=l;n=s[e+8>>2]|0;A=s[e+12>>2]|0;if((n|0)!=(A|0)){c=o+4|0;do{i=s[n>>2]|0;s[o>>2]=i;a=s[n+4>>2]|0;s[c>>2]=a;if(a|0){a=a+4|0;s[a>>2]=(s[a>>2]|0)+1}t=Hg[s[(s[i>>2]|0)+12>>2]&63](i,t)|0;Qr(o);n=n+8|0}while((n|0)!=(A|0))}n=e+20|0;if(r[n>>0]|0){r[n>>0]=0;sA(s[e+4>>2]|0)}J=l;return t|0}function rA(e){e=e|0;s[e>>2]=5172;Rr(e+8|0);Sr(e);return}function iA(e){e=e|0;rA(e);ep(e);return}function sA(e){e=e|0;var t=0;t=((aA(s[e>>2]|0)|0)&255)<<24;t=((aA(s[e>>2]|0)|0)&255)<<16|t;t=t|((aA(s[e>>2]|0)|0)&255)<<8;s[e+4>>2]=t|(aA(s[e>>2]|0)|0)&255;return}function aA(e){e=e|0;var t=0,n=0;t=s[e>>2]|0;n=e+8|0;e=s[n>>2]|0;s[n>>2]=e+1;return r[t+e>>0]|0}function oA(e,t){e=e|0;t=t|0;return}function AA(e){e=e|0;av(e);ep(e);return}function cA(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+8>>2]&255](e);return}function lA(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==15450?e+12|0:0)|0}function uA(e){e=e|0;_e(e,16);return}function hA(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(180)|0;fA(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];pA(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function dA(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(180)|0;OA(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];VA(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function fA(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=5220;s[e+4>>2]=t;vA(e+8|0);return}function pA(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5244;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function vA(e){e=e|0;pi(e,32,1,8,0);rn(e+80|0,32,1,8,0);r[e+160>>0]=0;r[e+161>>0]=0;_A(e+164|0);return}function gA(e){e=e|0;s[e>>2]=5220;bA(e+8|0);ri(e);return}function mA(e){e=e|0;gA(e);ep(e);return}function yA(e,t){e=e|0;t=t|0;return wA(e+8|0,s[e+4>>2]|0,t)|0}function _A(e){e=e|0;r[e+4>>0]=0;return}function bA(e){e=e|0;An(e+80|0);vi(e);return}function wA(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0;o=J;J=J+16|0;i=o;if(!(r[e+161>>0]|0))an(e+80|0);a=e+164|0;if(BA(a)|0){t=CA(e+80|0,t,s[a>>2]|0,0)|0;s[i>>2]=t;Qi(t,n)}else{kA(MA(t)|0,n,4);s[i>>2]=Ii(n)|0}EA(a,i);J=o;return n+4|0}function BA(e){e=e|0;return(r[e+4>>0]|0)!=0|0}function CA(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;n=(FA(e,t,(s[e+36>>2]|0)+(r*44|0)|0)|0)+n|0;t=s[e+24>>2]|0;if((n|0)<0)return n+t|0;else return n-(n>>>0<t>>>0?0:t)|0;return 0}function MA(e){e=e|0;return s[e>>2]|0}function kA(e,t,n){e=e|0;t=t|0;n=n|0;var i=0;if((n|0)>0){i=0;do{r[t+i>>0]=aA(e)|0;i=i+1|0}while((i|0)!=(n|0))}return}function EA(e,t){e=e|0;t=t|0;var n=0;n=e+4|0;if(!(r[n>>0]|0))r[n>>0]=1;s[e>>2]=s[t>>2];return}function FA(e,t,n){e=e|0;t=t|0;n=n|0;var r=0;n=xA(t,n)|0;s[e>>2]=n;do{if(n){if(n>>>0>=32){n=s[e+28>>2]|0;break}r=s[e+12>>2]|0;if(n>>>0>r>>>0){r=n-r|0;n=xA(t,(s[e+68>>2]|0)+((n+-1|0)*44|0)|0)|0;r=n<<r|(UA(t,r)|0)}else r=xA(t,(s[e+68>>2]|0)+((n+-1|0)*44|0)|0)|0;n=s[e>>2]|0;if((r|0)<(1<<n+-1|0)){n=r+1+(-1<<n)|0;break}else{n=r+1|0;break}}else n=IA(t,e+48|0)|0}while(0);return n|0}function xA(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0;d=e+8|0;h=s[d>>2]|0;i=s[t+16>>2]|0;if(i){r=e+4|0;n=s[r>>2]|0;u=h>>>15;s[d>>2]=u;c=(n>>>0)/(u>>>0)|0;A=c>>>(s[t+40>>2]|0);a=s[i+(A<<2)>>2]|0;A=(s[i+(A+1<<2)>>2]|0)+1|0;o=a+1|0;l=s[t+8>>2]|0;if(A>>>0>o>>>0){i=a;a=A;do{o=(a+i|0)>>>1;A=(s[l+(o<<2)>>2]|0)>>>0>c>>>0;i=A?i:o;a=A?o:a;o=i+1|0}while(a>>>0>o>>>0);a=i}i=y(s[l+(a<<2)>>2]|0,u)|0;if((a|0)==(s[t+32>>2]|0))o=h;else o=y(s[l+(o<<2)>>2]|0,u)|0}else{l=h>>>15;s[d>>2]=l;A=s[t>>2]|0;u=s[t+8>>2]|0;r=e+4|0;n=s[r>>2]|0;c=A>>>1;i=0;o=h;a=0;do{f=y(s[u+(c<<2)>>2]|0,l)|0;h=f>>>0>n>>>0;o=h?f:o;i=h?i:f;a=h?a:c;A=h?c:A;c=(a+A|0)>>>1}while((c|0)!=(a|0))}s[r>>2]=n-i;f=o-i|0;s[d>>2]=f;if(f>>>0<16777216)TA(e);d=(s[t+12>>2]|0)+(a<<2)|0;s[d>>2]=(s[d>>2]|0)+1;d=t+28|0;f=(s[d>>2]|0)+-1|0;s[d>>2]=f;if(!f)Hn(t);return a|0}function UA(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;if(t>>>0>19){n=(PA(e)|0)&65535;return(UA(e,t+-16|0)|0)<<16|n|0}r=e+4|0;i=s[r>>2]|0;a=e+8|0;n=(s[a>>2]|0)>>>t;s[a>>2]=n;t=(i>>>0)/(n>>>0)|0;s[r>>2]=i-(y(t,n)|0);if(n>>>0<16777216)TA(e);return t|0}function IA(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0,A=0;r=e+8|0;i=s[r>>2]|0;n=y(i>>>13,s[t+8>>2]|0)|0;a=e+4|0;o=s[a>>2]|0;A=o>>>0>=n>>>0;if(A){s[a>>2]=o-n;n=i-n|0;s[r>>2]=n}else{s[r>>2]=n;o=t+12|0;s[o>>2]=(s[o>>2]|0)+1}if(n>>>0<16777216)TA(e);o=t+4|0;e=(s[o>>2]|0)+-1|0;s[o>>2]=e;if(!e)Kn(t);return A&1|0}function TA(e){e=e|0;var t=0,n=0,r=0,i=0;t=e+4|0;n=e+8|0;r=s[t>>2]|0;do{r=r<<8|(aA(s[e>>2]|0)|0)&255;s[t>>2]=r;i=s[n>>2]<<8;s[n>>2]=i}while(i>>>0<16777216);return}function PA(e){e=e|0;var t=0,n=0,r=0,i=0;n=e+4|0;i=s[n>>2]|0;t=e+8|0;r=(s[t>>2]|0)>>>16;s[t>>2]=r;t=(i>>>0)/(r>>>0)|0;s[n>>2]=i-(y(t,r)|0);TA(e);return t&65535|0}function SA(e){e=e|0;av(e);ep(e);return}function DA(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function QA(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==15904?e+12|0:0)|0}function RA(e){e=e|0;_e(e,16);return}function OA(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=5272;s[e+4>>2]=t;LA(e+8|0);return}function VA(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5296;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function LA(e){e=e|0;pi(e,32,1,8,0);rn(e+80|0,32,1,8,0);r[e+160>>0]=0;r[e+161>>0]=0;jA(e+164|0);return}function HA(e){e=e|0;s[e>>2]=5272;WA(e+8|0);ri(e);return}function NA(e){e=e|0;HA(e);ep(e);return}function GA(e,t){e=e|0;t=t|0;return zA(e+8|0,s[e+4>>2]|0,t)|0}function jA(e){e=e|0;r[e+4>>0]=0;return}function WA(e){e=e|0;An(e+80|0);vi(e);return}function zA(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0;o=J;J=J+16|0;i=o;if(!(r[e+161>>0]|0))an(e+80|0);a=e+164|0;if(XA(a)|0){t=CA(e+80|0,t,s[a>>2]|0,0)|0;s[i>>2]=t;Li(t,n)}else{kA(MA(t)|0,n,4);s[i>>2]=Di(n)|0}KA(a,i);J=o;return n+4|0}function XA(e){e=e|0;return(r[e+4>>0]|0)!=0|0}function KA(e,t){e=e|0;t=t|0;var n=0;n=e+4|0;if(!(r[n>>0]|0))r[n>>0]=1;s[e>>2]=s[t>>2];return}function ZA(e){e=e|0;av(e);ep(e);return}function JA(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function YA(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==16402?e+12|0:0)|0}function qA(e){e=e|0;_e(e,16);return}function $A(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(172)|0;tc(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];nc(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function ec(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(176)|0;mc(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];yc(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function tc(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=5324;s[e+4>>2]=t;rc(e+8|0);return}function nc(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5348;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function rc(e){e=e|0;pi(e,8,1,8,0);rn(e+80|0,8,1,8,0);r[e+160>>0]=0;r[e+161>>0]=0;oc(e+162|0);return}function ic(e){e=e|0;s[e>>2]=5324;Ac(e+8|0);ri(e);return}function sc(e){e=e|0;ic(e);ep(e);return}function ac(e,t){e=e|0;t=t|0;return cc(e+8|0,s[e+4>>2]|0,t)|0}function oc(e){e=e|0;r[e+1>>0]=0;return}function Ac(e){e=e|0;An(e+80|0);vi(e);return}function cc(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,s=0,a=0;a=J;J=J+16|0;i=a;if(!(r[e+161>>0]|0))an(e+80|0);s=e+162|0;if(lc(s)|0){t=(CA(e+80|0,t,r[s>>0]|0,0)|0)&255;r[i>>0]=t;uc(t,n)}else{kA(MA(t)|0,n,1);r[i>>0]=hc(n)|0}dc(s,i);J=a;return n+1|0}function lc(e){e=e|0;return(r[e+1>>0]|0)!=0|0}function uc(e,t){e=e|0;t=t|0;r[t>>0]=e;return}function hc(e){e=e|0;return r[e>>0]|0}function dc(e,t){e=e|0;t=t|0;var n=0;n=e+1|0;if(!(r[n>>0]|0))r[n>>0]=1;r[e>>0]=r[t>>0]|0;return}function fc(e){e=e|0;av(e);ep(e);return}function pc(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function vc(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==16900?e+12|0:0)|0}function gc(e){e=e|0;_e(e,16);return}function mc(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=5376;s[e+4>>2]=t;_c(e+8|0);return}function yc(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5400;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function _c(e){e=e|0;pi(e,16,1,8,0);rn(e+80|0,16,1,8,0);r[e+160>>0]=0;r[e+161>>0]=0;Cc(e+162|0);return}function bc(e){e=e|0;s[e>>2]=5376;Mc(e+8|0);ri(e);return}function wc(e){e=e|0;bc(e);ep(e);return}function Bc(e,t){e=e|0;t=t|0;return kc(e+8|0,s[e+4>>2]|0,t)|0}function Cc(e){e=e|0;r[e+2>>0]=0;return}function Mc(e){e=e|0;An(e+80|0);vi(e);return}function kc(e,t,n){e=e|0;t=t|0;n=n|0;var s=0,a=0,o=0;o=J;J=J+16|0;s=o;if(!(r[e+161>>0]|0))an(e+80|0);a=e+162|0;if(Ec(a)|0){t=(CA(e+80|0,t,i[a>>1]|0,0)|0)&65535;i[s>>1]=t;Fc(t,n)}else{kA(MA(t)|0,n,2);i[s>>1]=xc(n)|0}Uc(a,s);J=o;return n+2|0}function Ec(e){e=e|0;return(r[e+2>>0]|0)!=0|0}function Fc(e,t){e=e|0;t=t|0;Ri(e,t);return}function xc(e){e=e|0;return Ti(e)|0}function Uc(e,t){e=e|0;t=t|0;var n=0;n=e+2|0;if(!(r[n>>0]|0))r[n>>0]=1;i[e>>1]=i[t>>1]|0;return}function Ic(e){e=e|0;av(e);ep(e);return}function Tc(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function Pc(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==17398?e+12|0:0)|0}function Sc(e){e=e|0;_e(e,16);return}function Dc(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(172)|0;Rc(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];Oc(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function Qc(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0;c=J;J=J+32|0;r=c+12|0;i=c;t=c+8|0;o=Zp(176)|0;qc(o,s[e+4>>2]|0);a=e+8|0;s[t>>2]=0;s[r>>2]=s[t>>2];$c(i,o,r);o=e+12|0;t=s[o>>2]|0;A=e+16|0;do{if(t>>>0>=(s[A>>2]|0)>>>0){t=(t-(s[a>>2]|0)>>3)+1|0;n=Jr(a)|0;if(n>>>0<t>>>0)Xv(a);else{l=s[a>>2]|0;u=(s[A>>2]|0)-l|0;A=u>>2;Xr(r,u>>3>>>0<n>>>1>>>0?A>>>0<t>>>0?t:A:n,(s[o>>2]|0)-l>>3,e+16|0);A=r+8|0;o=s[A>>2]|0;s[o>>2]=s[i>>2];e=i+4|0;s[o+4>>2]=s[e>>2];s[i>>2]=0;s[e>>2]=0;s[A>>2]=o+8;Kr(a,r);Zr(r);break}}else{Wr(r,a,1);u=r+4|0;l=s[u>>2]|0;s[l>>2]=s[i>>2];A=i+4|0;s[l+4>>2]=s[A>>2];s[i>>2]=0;s[A>>2]=0;s[u>>2]=l+8;zr(r)}}while(0);Qr(i);J=c;return}function Rc(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=5428;s[e+4>>2]=t;Vc(e+8|0);return}function Oc(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5452;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function Vc(e){e=e|0;pi(e,8,1,8,0);rn(e+80|0,8,1,8,0);r[e+160>>0]=0;r[e+161>>0]=0;Gc(e+162|0);return}function Lc(e){e=e|0;s[e>>2]=5428;jc(e+8|0);ri(e);return}function Hc(e){e=e|0;Lc(e);ep(e);return}function Nc(e,t){e=e|0;t=t|0;return Wc(e+8|0,s[e+4>>2]|0,t)|0}function Gc(e){e=e|0;r[e+1>>0]=0;return}function jc(e){e=e|0;An(e+80|0);vi(e);return}function Wc(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,s=0,o=0;o=J;J=J+16|0;i=o;if(!(r[e+161>>0]|0))an(e+80|0);s=e+162|0;if(zc(s)|0){t=(CA(e+80|0,t,a[s>>0]|0,0)|0)&255;r[i>>0]=t;Oi(t,n)}else{kA(MA(t)|0,n,1);r[i>>0]=Pi(n)|0}Xc(s,i);J=o;return n+1|0}function zc(e){e=e|0;return(r[e+1>>0]|0)!=0|0}function Xc(e,t){e=e|0;t=t|0;var n=0;n=e+1|0;if(!(r[n>>0]|0))r[n>>0]=1;r[e>>0]=r[t>>0]|0;return}function Kc(e){e=e|0;av(e);ep(e);return}function Zc(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function Jc(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==17896?e+12|0:0)|0}function Yc(e){e=e|0;_e(e,16);return}function qc(e,t){e=e|0;t=t|0;Yr(e);s[e>>2]=5480;s[e+4>>2]=t;el(e+8|0);return}function $c(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;n=J;J=J+16|0;r=n;s[e>>2]=t;i=Zp(16)|0;s[i+4>>2]=0;s[i+8>>2]=0;s[i>>2]=5504;s[i+12>>2]=t;s[e+4>>2]=i;s[r>>2]=t;s[r+4>>2]=t;Hi(e,r);J=n;return}function el(e){e=e|0;pi(e,16,1,8,0);rn(e+80|0,16,1,8,0);r[e+160>>0]=0;r[e+161>>0]=0;il(e+162|0);return}function tl(e){e=e|0;s[e>>2]=5480;sl(e+8|0);ri(e);return}function nl(e){e=e|0;tl(e);ep(e);return}function rl(e,t){e=e|0;t=t|0;return al(e+8|0,s[e+4>>2]|0,t)|0}function il(e){e=e|0;r[e+2>>0]=0;return}function sl(e){e=e|0;An(e+80|0);vi(e);return}function al(e,t,n){e=e|0;t=t|0;n=n|0;var s=0,a=0,A=0;A=J;J=J+16|0;s=A;if(!(r[e+161>>0]|0))an(e+80|0);a=e+162|0;if(ol(a)|0){t=(CA(e+80|0,t,o[a>>1]|0,0)|0)&65535;i[s>>1]=t;Ri(t,n)}else{kA(MA(t)|0,n,2);i[s>>1]=Ti(n)|0}Al(a,s);J=A;return n+2|0}function ol(e){e=e|0;return(r[e+2>>0]|0)!=0|0}function Al(e,t){e=e|0;t=t|0;var n=0;n=e+2|0;if(!(r[n>>0]|0))r[n>>0]=1;i[e>>1]=i[t>>1]|0;return}function cl(e){e=e|0;av(e);ep(e);return}function ll(e){e=e|0;e=s[e+12>>2]|0;if(e|0)jg[s[(s[e>>2]|0)+4>>2]&255](e);return}function ul(e,t){e=e|0;t=t|0;return((s[t+4>>2]|0)==18394?e+12|0:0)|0}function hl(e){e=e|0;_e(e,16);return}function dl(){return}function fl(e){e=e|0;return wl(e)|0}function pl(){return 0}function vl(){return 0}function gl(e){e=e|0;if(e|0){Bl(e);ep(e)}return}function ml(){return Cl()|0}function yl(){return Ml()|0}function _l(){return kl()|0}function bl(){return 0}function wl(e){e=e|0;return 3360}function Bl(e){e=e|0;var t=0,n=0,r=0,i=0;t=J;J=J+16|0;r=t;s[r>>2]=s[e>>2];s[e>>2]=0;n=e+4|0;s[r+4>>2]=s[n>>2];s[n>>2]=0;de(r);n=e+8|0;s[r>>2]=s[n>>2];s[n>>2]=0;i=e+12|0;s[r+4>>2]=s[i>>2];s[i>>2]=0;Be(r);Be(n);de(e);J=t;return}function Cl(){return 3360}function Ml(){return 3368}function kl(){return 3384}function El(){return 18579}function Fl(){return 18582}function xl(){return 18584}function Ul(){var e=0;e=Zp(16)|0;Rl(e);return e|0}function Il(e){e=e|0;var t=0,n=0,r=0,i=0;t=J;J=J+16|0;n=t;i=ml()|0;r=Pl(n)|0;n=Sl(n)|0;P(i|0,r|0,n|0,El()|0,12,e|0);J=t;return}function Tl(e){e=e|0;return Dl(Og[e&3]()|0)|0}function Pl(e){e=e|0;return 1}function Sl(e){e=e|0;return Ql()|0}function Dl(e){e=e|0;return e|0}function Ql(){return 5524}function Rl(e){e=e|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=0;return}function Ol(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+16|0;r=n;i=n+8|0;o=s[t+4>>2]|0;s[r>>2]=s[t>>2];s[r+4>>2]=o;o=ml()|0;a=Ll(i)|0;i=Hl(i)|0;t=Xl()|0;S(o|0,e|0,a|0,i|0,t|0,4,Nl(r)|0,0);J=n;return}function Vl(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=Gl(t)|0;t=s[e>>2]|0;i=s[e+4>>2]|0;e=a+(i>>1)|0;if(i&1)t=s[(s[e>>2]|0)+t>>2]|0;i=jl(n)|0;a=Wl(r)|0;zg[t&15](e,i,a);return}function Ll(e){e=e|0;return 4}function Hl(e){e=e|0;return zl()|0}function Nl(e){e=e|0;var t=0,n=0;t=Zp(8)|0;n=s[e+4>>2]|0;s[t>>2]=s[e>>2];s[t+4>>2]=n;return t|0}function Gl(e){e=e|0;return e|0}function jl(e){e=e|0;return e|0}function Wl(e){e=e|0;return e|0}function zl(){return 144}function Xl(){return 18587}function Kl(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+16|0;r=n;i=n+8|0;o=s[t+4>>2]|0;s[r>>2]=s[t>>2];s[r+4>>2]=o;o=ml()|0;a=Jl(i)|0;i=Yl(i)|0;t=tu()|0;S(o|0,e|0,a|0,i|0,t|0,7,ql(r)|0,0);J=n;return}function Zl(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=Gl(t)|0;t=s[e>>2]|0;r=s[e+4>>2]|0;e=i+(r>>1)|0;if(r&1)t=s[(s[e>>2]|0)+t>>2]|0;i=$l(n)|0;Wg[t&15](e,i);return}function Jl(e){e=e|0;return 3}function Yl(e){e=e|0;return eu()|0}function ql(e){e=e|0;var t=0,n=0;t=Zp(8)|0;n=s[e+4>>2]|0;s[t>>2]=s[e>>2];s[t+4>>2]=n;return t|0}function $l(e){e=e|0;return e|0}function eu(){return 5528}function tu(){return 18593}function nu(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+16|0;r=n;i=n+8|0;o=s[t+4>>2]|0;s[r>>2]=s[t>>2];s[r+4>>2]=o;o=ml()|0;a=iu(i)|0;i=su(i)|0;t=cu()|0;S(o|0,e|0,a|0,i|0,t|0,41,au(r)|0,0);J=n;return}function ru(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0;r=J;J=J+16|0;n=r;a=Gl(t)|0;t=s[e>>2]|0;i=s[e+4>>2]|0;e=a+(i>>1)|0;if(i&1)t=s[(s[e>>2]|0)+t>>2]|0;s[n>>2]=Vg[t&15](e)|0;a=ou(n)|0;J=r;return a|0}function iu(e){e=e|0;return 2}function su(e){e=e|0;return Au()|0}function au(e){e=e|0;var t=0,n=0;t=Zp(8)|0;n=s[e+4>>2]|0;s[t>>2]=s[e>>2];s[t+4>>2]=n;return t|0}function ou(e){e=e|0;return s[e>>2]|0}function Au(){return 5540}function cu(){return 18598}function lu(){return}function uu(e){e=e|0;return mu(e)|0}function hu(){return 0}function du(){return 0}function fu(e){e=e|0;if(e|0){yu(e);ep(e)}return}function pu(){return _u()|0}function vu(){return bu()|0}function gu(){return wu()|0}function mu(e){e=e|0;return 3400}function yu(e){e=e|0;var t=0,n=0,r=0,i=0;t=J;J=J+16|0;r=t;s[r>>2]=s[e>>2];s[e>>2]=0;n=e+4|0;s[r+4>>2]=s[n>>2];s[n>>2]=0;Lo(r);n=e+16|0;s[r>>2]=s[n>>2];s[n>>2]=0;i=e+20|0;s[r+4>>2]=s[i>>2];s[i>>2]=0;Oo(r);s[r>>2]=s[n>>2];s[n>>2]=0;s[r+4>>2]=s[i>>2];s[i>>2]=0;Oo(r);Oo(n);Xo(e+8|0);Lo(e);J=t;return}function _u(){return 3400}function bu(){return 3408}function wu(){return 3424}function Bu(){var e=0;e=Zp(24)|0;Uu(e);return e|0}function Cu(e){e=e|0;var t=0,n=0,r=0,i=0;t=J;J=J+16|0;n=t;i=pu()|0;r=ku(n)|0;n=Eu(n)|0;P(i|0,r|0,n|0,El()|0,13,e|0);J=t;return}function Mu(e){e=e|0;return Fu(Og[e&3]()|0)|0}function ku(e){e=e|0;return 1}function Eu(e){e=e|0;return xu()|0}function Fu(e){e=e|0;return e|0}function xu(){return 5548}function Uu(e){e=e|0;s[e>>2]=0;s[e+4>>2]=0;s[e+8>>2]=0;s[e+12>>2]=0;s[e+16>>2]=0;s[e+20>>2]=0;return}function Iu(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+16|0;r=n;i=n+8|0;o=s[t+4>>2]|0;s[r>>2]=s[t>>2];s[r+4>>2]=o;o=pu()|0;a=Pu(i)|0;i=Su(i)|0;t=Xl()|0;S(o|0,e|0,a|0,i|0,t|0,5,Du(r)|0,0);J=n;return}function Tu(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=Qu(t)|0;t=s[e>>2]|0;i=s[e+4>>2]|0;e=a+(i>>1)|0;if(i&1)t=s[(s[e>>2]|0)+t>>2]|0;i=jl(n)|0;a=Wl(r)|0;zg[t&15](e,i,a);return}function Pu(e){e=e|0;return 4}function Su(e){e=e|0;return Ru()|0}function Du(e){e=e|0;var t=0,n=0;t=Zp(8)|0;n=s[e+4>>2]|0;s[t>>2]=s[e>>2];s[t+4>>2]=n;return t|0}function Qu(e){e=e|0;return e|0}function Ru(){return 160}function Ou(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+16|0;r=n;i=n+8|0;o=s[t+4>>2]|0;s[r>>2]=s[t>>2];s[r+4>>2]=o;o=pu()|0;a=Lu(i)|0;i=Hu(i)|0;t=tu()|0;S(o|0,e|0,a|0,i|0,t|0,8,Nu(r)|0,0);J=n;return}function Vu(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=Qu(t)|0;t=s[e>>2]|0;r=s[e+4>>2]|0;e=i+(r>>1)|0;if(r&1)t=s[(s[e>>2]|0)+t>>2]|0;i=Wl(n)|0;Wg[t&15](e,i);return}function Lu(e){e=e|0;return 3}function Hu(e){e=e|0;return Gu()|0}function Nu(e){e=e|0;var t=0,n=0;t=Zp(8)|0;n=s[e+4>>2]|0;s[t>>2]=s[e>>2];s[t+4>>2]=n;return t|0}function Gu(){return 5552}function ju(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;n=J;J=J+16|0;r=n;i=n+8|0;o=s[t+4>>2]|0;s[r>>2]=s[t>>2];s[r+4>>2]=o;o=pu()|0;a=zu(i)|0;i=Xu(i)|0;t=tu()|0;S(o|0,e|0,a|0,i|0,t|0,9,Ku(r)|0,0);J=n;return}function Wu(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=Qu(t)|0;t=s[e>>2]|0;r=s[e+4>>2]|0;e=i+(r>>1)|0;if(r&1)t=s[(s[e>>2]|0)+t>>2]|0;i=$l(n)|0;Wg[t&15](e,i);return}function zu(e){e=e|0;return 3}function Xu(e){e=e|0;return Zu()|0}function Ku(e){e=e|0;var t=0,n=0;t=Zp(8)|0;n=s[e+4>>2]|0;s[t>>2]=s[e>>2];s[t+4>>2]=n;return t|0}function Zu(){return 5564}function Ju(){ee();return}function Yu(){qu();return}function qu(){$u(22144);return}function $u(e){e=e|0;var t=0;t=J;J=J+16|0;s[t>>2]=e;eh();J=t;return}function eh(){H(th()|0,18653);I(nh()|0,18658,1,1,0);rh(18663);ih(18668);sh(18680);ah(18694);oh(18700);Ah(18715);ch(18719);lh(18732);uh(18737);hh(18751);dh(18757);V(fh()|0,18764);V(ph()|0,18776);L(vh()|0,4,18809);L(gh()|0,2,18822);L(mh()|0,4,18837);D(yh()|0,18852);_h(18868);bh(18898);wh(18935);Bh(18974);Ch(19005);Mh(19045);kh(19074);Eh(19112);Fh(19142);bh(19181);wh(19213);Bh(19246);Ch(19279);Mh(19313);kh(19346);xh(19380);Uh(19411);Ih(19443);return}function th(){return Gd()|0}function nh(){return Nd()|0}function rh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Ld()|0;R(e|0,s[n>>2]|0,1,-128<<24>>24|0,127<<24>>24|0);J=t;return}function ih(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Od()|0;R(e|0,s[n>>2]|0,1,-128<<24>>24|0,127<<24>>24|0);J=t;return}function sh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Qd()|0;R(e|0,s[n>>2]|0,1,0,255);J=t;return}function ah(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Sd()|0;R(e|0,s[n>>2]|0,2,-32768<<16>>16|0,32767<<16>>16|0);J=t;return}function oh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Td()|0;R(e|0,s[n>>2]|0,2,0,65535);J=t;return}function Ah(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Ud()|0;R(e|0,s[n>>2]|0,4,-2147483648,2147483647);J=t;return}function ch(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Fd()|0;R(e|0,s[n>>2]|0,4,0,-1);J=t;return}function lh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=kd()|0;R(e|0,s[n>>2]|0,4,-2147483648,2147483647);J=t;return}function uh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=Cd()|0;R(e|0,s[n>>2]|0,4,0,-1);J=t;return}function hh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=wd()|0;Q(e|0,s[n>>2]|0,4);J=t;return}function dh(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;s[n>>2]=e;e=_d()|0;Q(e|0,s[n>>2]|0,8);J=t;return}function fh(){return yd()|0}function ph(){return md()|0}function vh(){return gd()|0}function gh(){return vd()|0}function mh(){return pd()|0}function yh(){return fd()|0}function _h(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=ud()|0;e=hd()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function bh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Ad()|0;e=cd()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function wh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=sd()|0;e=ad()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Bh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=nd()|0;e=rd()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Ch(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=$h()|0;e=ed()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Mh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Jh()|0;e=Yh()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function kh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Xh()|0;e=Kh()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Eh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=jh()|0;e=Wh()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Fh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Hh()|0;e=Nh()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function xh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Oh()|0;e=Vh()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Uh(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Dh()|0;e=Qh()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Ih(e){e=e|0;var t=0,n=0,r=0;t=J;J=J+16|0;n=t;s[n>>2]=e;r=Th()|0;e=Ph()|0;O(r|0,e|0,s[n>>2]|0);J=t;return}function Th(){return Sh()|0}function Ph(){return 7}function Sh(){return 3440}function Dh(){return Rh()|0}function Qh(){return 7}function Rh(){return 3448}function Oh(){return Lh()|0}function Vh(){return 6}function Lh(){return 3456}function Hh(){return Gh()|0}function Nh(){return 5}function Gh(){return 3464}function jh(){return zh()|0}function Wh(){return 4}function zh(){return 3472}function Xh(){return Zh()|0}function Kh(){return 5}function Zh(){return 3480}function Jh(){return qh()|0}function Yh(){return 4}function qh(){return 3488}function $h(){return td()|0}function ed(){return 3}function td(){return 3496}function nd(){return id()|0}function rd(){return 2}function id(){return 3504}function sd(){return od()|0}function ad(){return 1}function od(){return 3512}function Ad(){return ld()|0}function cd(){return 0}function ld(){return 3520}function ud(){return dd()|0}function hd(){return 0}function dd(){return 3528}function fd(){return 3536}function pd(){return 3544}function vd(){return 3576}function gd(){return 3600}function md(){return 3624}function yd(){return 3648}function _d(){return bd()|0}function bd(){return 4144}function wd(){return Bd()|0}function Bd(){return 4136}function Cd(){return Md()|0}function Md(){return 4128}function kd(){return Ed()|0}function Ed(){return 4120}function Fd(){return xd()|0}function xd(){return 4112}function Ud(){return Id()|0}function Id(){return 4104}function Td(){return Pd()|0}function Pd(){return 4096}function Sd(){return Dd()|0}function Dd(){return 4088}function Qd(){return Rd()|0}function Rd(){return 4072}function Od(){return Vd()|0}function Vd(){return 4080}function Ld(){return Hd()|0}function Hd(){return 4064}function Nd(){return 4056}function Gd(){return 4040}function jd(e){e=e|0;var t=0,n=0,r=0,i=0;t=J;J=J+16|0;n=t+8|0;r=t+4|0;i=t;s[i>>2]=e;s[r>>2]=s[i>>2];s[n>>2]=s[(s[r>>2]|0)+4>>2];e=kf(s[n>>2]|0)|0;J=t;return e|0}function Wd(){return 21636}function zd(e){e=e|0;return(e+-48|0)>>>0<10|0}function Xd(){return 5576}function Kd(e,t){e=e|0;t=t|0;var n=0,i=0;n=r[e>>0]|0;i=r[t>>0]|0;if(n<<24>>24==0?1:n<<24>>24!=i<<24>>24)e=i;else{do{e=e+1|0;t=t+1|0;n=r[e>>0]|0;i=r[t>>0]|0}while(!(n<<24>>24==0?1:n<<24>>24!=i<<24>>24));e=i}return(n&255)-(e&255)|0}function Zd(e){e=e|0;var t=0,n=0,i=0;i=e;e:do{if(!(i&3))n=5;else{t=i;while(1){if(!(r[e>>0]|0)){e=t;break e}e=e+1|0;t=e;if(!(t&3)){n=5;break}}}}while(0);if((n|0)==5){while(1){t=s[e>>2]|0;if(!((t&-2139062144^-2139062144)&t+-16843009))e=e+4|0;else break}if((t&255)<<24>>24)do{e=e+1|0}while((r[e>>0]|0)!=0)}return e-i|0}function Jd(e){e=e|0;return}function Yd(e){e=e|0;return 1}function qd(e){e=e|0;var t=0,n=0;t=e+74|0;n=r[t>>0]|0;r[t>>0]=n+255|n;t=s[e>>2]|0;if(!(t&8)){s[e+8>>2]=0;s[e+4>>2]=0;n=s[e+44>>2]|0;s[e+28>>2]=n;s[e+20>>2]=n;s[e+16>>2]=n+(s[e+48>>2]|0);e=0}else{s[e>>2]=t|32;e=-1}return e|0}function $d(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0,c=0;i=n+16|0;a=s[i>>2]|0;if(!a){if(!(qd(n)|0)){a=s[i>>2]|0;o=5}else i=0}else o=5;e:do{if((o|0)==5){c=n+20|0;A=s[c>>2]|0;i=A;if((a-A|0)>>>0<t>>>0){i=Ng[s[n+36>>2]&7](n,e,t)|0;break}t:do{if((r[n+75>>0]|0)<0|(t|0)==0){o=0;a=e}else{A=t;while(1){a=A+-1|0;if((r[e+a>>0]|0)==10)break;if(!a){o=0;a=e;break t}else A=a}i=Ng[s[n+36>>2]&7](n,e,A)|0;if(i>>>0<A>>>0)break e;o=A;a=e+A|0;t=t-A|0;i=s[c>>2]|0}}while(0);ug(i|0,a|0,t|0)|0;s[c>>2]=(s[c>>2]|0)+t;i=o+t|0}}while(0);return i|0}function ef(e,t){e=e|0;t=t|0;if(!t)t=0;else t=tf(s[t>>2]|0,s[t+4>>2]|0,e)|0;return((t|0)==0?e:t)|0}function tf(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0;f=(s[e>>2]|0)+1794895138|0;o=nf(s[e+8>>2]|0,f)|0;i=nf(s[e+12>>2]|0,f)|0;a=nf(s[e+16>>2]|0,f)|0;e:do{if((o>>>0<t>>>2>>>0?(d=t-(o<<2)|0,i>>>0<d>>>0&a>>>0<d>>>0):0)?((a|i)&3|0)==0:0){d=i>>>2;h=a>>>2;u=0;while(1){c=o>>>1;l=u+c|0;A=l<<1;a=A+d|0;i=nf(s[e+(a<<2)>>2]|0,f)|0;a=nf(s[e+(a+1<<2)>>2]|0,f)|0;if(!(a>>>0<t>>>0&i>>>0<(t-a|0)>>>0)){i=0;break e}if(r[e+(a+i)>>0]|0){i=0;break e}i=Kd(n,e+a|0)|0;if(!i)break;i=(i|0)<0;if((o|0)==1){i=0;break e}u=i?u:l;o=i?c:o-c|0}i=A+h|0;a=nf(s[e+(i<<2)>>2]|0,f)|0;i=nf(s[e+(i+1<<2)>>2]|0,f)|0;if(i>>>0<t>>>0&a>>>0<(t-i|0)>>>0)i=(r[e+(i+a)>>0]|0)==0?e+i|0:0;else i=0}else i=0}while(0);return i|0}function nf(e,t){e=e|0;t=t|0;var n=0;n=lg(e|0)|0;return((t|0)==0?e:n)|0}function rf(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0;o=t&255;i=(n|0)!=0;e:do{if(i&(e&3|0)!=0){a=t&255;while(1){if((r[e>>0]|0)==a<<24>>24){a=6;break e}e=e+1|0;n=n+-1|0;i=(n|0)!=0;if(!(i&(e&3|0)!=0)){a=5;break}}}else a=5}while(0);if((a|0)==5)if(i)a=6;else e=0;e:do{if((a|0)==6){if((r[e>>0]|0)!=(t&255)<<24>>24){i=y(o,16843009)|0;t:do{if(n>>>0>3)do{o=s[e>>2]^i;if((o&-2139062144^-2139062144)&o+-16843009|0)break t;e=e+4|0;n=n+-4|0}while(n>>>0>3)}while(0)}if(!n)e=0;else{i=t&255;while(1){if((r[e>>0]|0)==i<<24>>24)break e;n=n+-1|0;if(!n){e=0;break}else e=e+1|0}}}}while(0);return e|0}function sf(e,t,n){e=e|0;t=t|0;n=n|0;return Af(e,t,n,1,8)|0}function af(e,t,n,i,o,A){e=e|0;t=+t;n=n|0;i=i|0;o=o|0;A=A|0;var c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0.0,g=0,m=0,_=0,b=0,w=0,C=0,M=0,k=0,E=0,F=0,x=0,U=0,I=0,T=0,P=0;P=J;J=J+560|0;u=P+32|0;b=P+536|0;T=P;I=T;h=P+540|0;s[b>>2]=0;U=h+12|0;_f(t)|0;c=B()|0;if((c|0)<0){t=-t;_f(t)|0;x=1;F=20247;c=B()|0}else{x=(o&2049|0)!=0&1;F=(o&2048|0)==0?(o&1|0)==0?20248:20253:20250}do{if(0==0&(c&2146435072|0)==2146435072){T=(A&32|0)!=0;c=x+3|0;vf(e,32,n,c,o&-65537);lf(e,F,x);lf(e,t!=t|0.0!=0.0?T?20274:20278:T?20266:20270,3);vf(e,32,n,c,o^8192)}else{v=+bf(t,b)*2.0;c=v!=0.0;if(c)s[b>>2]=(s[b>>2]|0)+-1;_=A|32;if((_|0)==97){f=A&32;g=(f|0)==0?F:F+9|0;p=x|2;c=12-i|0;do{if(!(i>>>0>11|(c|0)==0)){t=8.0;do{c=c+-1|0;t=t*16.0}while((c|0)!=0);if((r[g>>0]|0)==45){t=-(t+(-v-t));break}else{t=v+t-t;break}}else t=v}while(0);l=s[b>>2]|0;c=(l|0)<0?0-l|0:l;c=pf(c,((c|0)<0)<<31>>31,U)|0;if((c|0)==(U|0)){c=h+11|0;r[c>>0]=48}r[c+-1>>0]=(l>>31&2)+43;d=c+-2|0;r[d>>0]=A+15;l=(i|0)<1;u=(o&8|0)==0;h=T;do{x=~~t;c=h+1|0;r[h>>0]=f|a[640+x>>0];t=(t-+(x|0))*16.0;if((c-I|0)==1?!(u&(l&t==0.0)):0){r[c>>0]=46;h=h+2|0}else h=c}while(t!=0.0);if((i|0)!=0?(-2-I+h|0)<(i|0):0){l=U;u=d;c=i+2+l-u|0}else{l=U;u=d;c=l-I-u+h|0}U=c+p|0;vf(e,32,n,U,o);lf(e,g,p);vf(e,48,n,U,o^65536);I=h-I|0;lf(e,T,I);T=l-u|0;vf(e,48,c-(I+T)|0,0,0);lf(e,d,T);vf(e,32,n,U,o^8192);c=U;break}l=(i|0)<0?6:i;if(c){c=(s[b>>2]|0)+-28|0;s[b>>2]=c;t=v*268435456.0}else{t=v;c=s[b>>2]|0}E=(c|0)<0?u:u+288|0;u=E;do{M=~~t>>>0;s[u>>2]=M;u=u+4|0;t=(t-+(M>>>0))*1.0e9}while(t!=0.0);M=E;if((c|0)>0){f=E;while(1){d=(c|0)<29?c:29;c=u+-4|0;if(c>>>0>=f>>>0){h=0;do{m=Ag(s[c>>2]|0,0,d|0)|0;m=ng(m|0,B()|0,h|0,0)|0;w=B()|0;h=ag(m|0,w|0,1e9,0)|0;C=tg(h|0,B()|0,1e9,0)|0;C=rg(m|0,w|0,C|0,B()|0)|0;B()|0;s[c>>2]=C;c=c+-4|0}while(c>>>0>=f>>>0);if(h){C=f+-4|0;s[C>>2]=h;h=C}else h=f}else h=f;e:do{if(u>>>0>h>>>0){c=u;while(1){u=c+-4|0;if(s[u>>2]|0){u=c;break e}if(u>>>0>h>>>0)c=u;else break}}}while(0);c=(s[b>>2]|0)-d|0;s[b>>2]=c;if((c|0)>0)f=h;else break}}else h=E;if((c|0)<0){i=((l+25|0)/9|0)+1|0;m=(_|0)==102;do{g=0-c|0;g=(g|0)<9?g:9;if(h>>>0<u>>>0){d=(1<<g)+-1|0;f=1e9>>>g;p=0;c=h;do{C=s[c>>2]|0;s[c>>2]=(C>>>g)+p;p=y(C&d,f)|0;c=c+4|0}while(c>>>0<u>>>0);h=(s[h>>2]|0)==0?h+4|0:h;if(p){s[u>>2]=p;u=u+4|0}}else h=(s[h>>2]|0)==0?h+4|0:h;c=m?E:h;u=(u-c>>2|0)>(i|0)?c+(i<<2)|0:u;c=(s[b>>2]|0)+g|0;s[b>>2]=c}while((c|0)<0);m=h}else m=h;if(m>>>0<u>>>0){c=(M-m>>2)*9|0;d=s[m>>2]|0;if(d>>>0>=10){h=10;do{h=h*10|0;c=c+1|0}while(d>>>0>=h>>>0)}}else c=0;w=(_|0)==103;C=(l|0)!=0;h=l-((_|0)==102?0:c)+((C&w)<<31>>31)|0;if((h|0)<(((u-M>>2)*9|0)+-9|0)){b=h+9216|0;h=(b|0)/9|0;i=E+4+(h+-1024<<2)|0;h=b-(h*9|0)|0;if((h|0)<8){d=10;while(1){d=d*10|0;if((h|0)<7)h=h+1|0;else break}}else d=10;p=s[i>>2]|0;h=(p>>>0)/(d>>>0)|0;g=p-(y(h,d)|0)|0;f=(i+4|0)==(u|0);if(!(f&(g|0)==0)){v=(h&1|0)==0?9007199254740992.0:9007199254740994.0;b=d>>>1;t=g>>>0<b>>>0?0.5:f&(g|0)==(b|0)?1.0:1.5;if(x){b=(r[F>>0]|0)==45;t=b?-t:t;v=b?-v:v}h=p-g|0;s[i>>2]=h;if(v+t!=v){b=h+d|0;s[i>>2]=b;if(b>>>0>999999999){d=i;c=m;while(1){h=d+-4|0;s[d>>2]=0;if(h>>>0<c>>>0){c=c+-4|0;s[c>>2]=0}b=(s[h>>2]|0)+1|0;s[h>>2]=b;if(b>>>0>999999999)d=h;else{d=c;break}}}else{h=i;d=m}c=(M-d>>2)*9|0;p=s[d>>2]|0;if(p>>>0>=10){f=10;do{f=f*10|0;c=c+1|0}while(p>>>0>=f>>>0)}}else{h=i;d=m}}else{h=i;d=m}b=h+4|0;u=u>>>0>b>>>0?b:u}else d=m;i=0-c|0;e:do{if(u>>>0>d>>>0)while(1){h=u+-4|0;if(s[h>>2]|0){b=u;_=1;break e}if(h>>>0>d>>>0)u=h;else{b=h;_=0;break}}else{b=u;_=0}}while(0);do{if(w){l=l+((C^1)&1)|0;if((l|0)>(c|0)&(c|0)>-5){f=A+-1|0;l=l+-1-c|0}else{f=A+-2|0;l=l+-1|0}if(!(o&8)){if(_?(k=s[b+-4>>2]|0,(k|0)!=0):0){if(!((k>>>0)%10|0)){h=0;u=10;do{u=u*10|0;h=h+1|0}while(!((k>>>0)%(u>>>0)|0|0))}else h=0}else h=9;u=((b-M>>2)*9|0)+-9|0;if((f|32|0)==102){A=u-h|0;A=(A|0)>0?A:0;l=(l|0)<(A|0)?l:A;break}else{A=u+c-h|0;A=(A|0)>0?A:0;l=(l|0)<(A|0)?l:A;break}}}else f=A}while(0);m=(l|0)!=0;p=m?1:o>>>3&1;g=(f|32|0)==102;if(g){w=0;c=(c|0)>0?c:0}else{u=(c|0)<0?i:c;u=pf(u,((u|0)<0)<<31>>31,U)|0;h=U;if((h-u|0)<2)do{u=u+-1|0;r[u>>0]=48}while((h-u|0)<2);r[u+-1>>0]=(c>>31&2)+43;c=u+-2|0;r[c>>0]=f;w=c;c=h-c|0}c=x+1+l+p+c|0;vf(e,32,n,c,o);lf(e,F,x);vf(e,48,n,c,o^65536);if(g){p=d>>>0>E>>>0?E:d;g=T+9|0;d=g;f=T+8|0;h=p;do{u=pf(s[h>>2]|0,0,g)|0;if((h|0)==(p|0)){if((u|0)==(g|0)){r[f>>0]=48;u=f}}else if(u>>>0>T>>>0){dg(T|0,48,u-I|0)|0;do{u=u+-1|0}while(u>>>0>T>>>0)}lf(e,u,d-u|0);h=h+4|0}while(h>>>0<=E>>>0);if(!((o&8|0)==0&(m^1)))lf(e,20282,1);if(h>>>0<b>>>0&(l|0)>0)while(1){u=pf(s[h>>2]|0,0,g)|0;if(u>>>0>T>>>0){dg(T|0,48,u-I|0)|0;do{u=u+-1|0}while(u>>>0>T>>>0)}lf(e,u,(l|0)<9?l:9);h=h+4|0;u=l+-9|0;if(!(h>>>0<b>>>0&(l|0)>9)){l=u;break}else l=u}vf(e,48,l+9|0,9,0)}else{b=_?b:d+4|0;if(d>>>0<b>>>0&(l|0)>-1){i=T+9|0;m=(o&8|0)==0;_=i;p=0-I|0;g=T+8|0;f=d;do{u=pf(s[f>>2]|0,0,i)|0;if((u|0)==(i|0)){r[g>>0]=48;u=g}do{if((f|0)==(d|0)){h=u+1|0;lf(e,u,1);if(m&(l|0)<1){u=h;break}lf(e,20282,1);u=h}else{if(u>>>0<=T>>>0)break;dg(T|0,48,u+p|0)|0;do{u=u+-1|0}while(u>>>0>T>>>0)}}while(0);I=_-u|0;lf(e,u,(l|0)>(I|0)?I:l);l=l-I|0;f=f+4|0}while(f>>>0<b>>>0&(l|0)>-1)}vf(e,48,l+18|0,18,0);lf(e,w,U-w|0)}vf(e,32,n,c,o^8192)}}while(0);J=P;return((c|0)<(n|0)?n:c)|0}function of(e,t){e=e|0;t=t|0;var n=0.0,r=0;r=(s[t>>2]|0)+(8-1)&~(8-1);n=+c[r>>3];s[t>>2]=r+8;c[e>>3]=n;return}function Af(e,t,n,i,a){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;var o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0,g=0,m=0,y=0;y=J;J=J+224|0;p=y+208|0;v=y+160|0;g=y+80|0;m=y;o=v;A=o+40|0;do{s[o>>2]=0;o=o+4|0}while((o|0)<(A|0));s[p>>2]=s[n>>2];if((cf(0,t,p,g,v,i,a)|0)<0)n=-1;else{if((s[e+76>>2]|0)>-1)f=Yd(e)|0;else f=0;n=s[e>>2]|0;d=n&32;if((r[e+74>>0]|0)<1)s[e>>2]=n&-33;o=e+48|0;if(!(s[o>>2]|0)){A=e+44|0;c=s[A>>2]|0;s[A>>2]=m;l=e+28|0;s[l>>2]=m;u=e+20|0;s[u>>2]=m;s[o>>2]=80;h=e+16|0;s[h>>2]=m+80;n=cf(e,t,p,g,v,i,a)|0;if(c){Ng[s[e+36>>2]&7](e,0,0)|0;n=(s[u>>2]|0)==0?-1:n;s[A>>2]=c;s[o>>2]=0;s[h>>2]=0;s[l>>2]=0;s[u>>2]=0}}else n=cf(e,t,p,g,v,i,a)|0;o=s[e>>2]|0;s[e>>2]=o|d;if(f|0)Jd(e);n=(o&32|0)==0?n:-1}J=y;return n|0}function cf(e,t,n,a,o,A,l){e=e|0;t=t|0;n=n|0;a=a|0;o=o|0;A=A|0;l=l|0;var u=0,h=0,d=0,f=0,p=0,v=0,g=0,m=0,y=0,_=0,b=0,w=0,C=0,M=0,k=0,E=0,F=0,x=0,U=0,I=0,T=0,P=0,S=0,D=0,Q=0;D=J;J=J+64|0;T=D+56|0;S=D+40|0;E=D;x=D+48|0;U=D+60|0;s[T>>2]=t;C=(e|0)!=0;M=E+40|0;k=M;E=E+39|0;F=x+4|0;u=0;t=0;d=0;e:while(1){do{do{if((t|0)>-1)if((u|0)>(2147483647-t|0)){s[(Wd()|0)>>2]=61;t=-1;break}else{t=u+t|0;break}}while(0);g=s[T>>2]|0;u=r[g>>0]|0;if(!(u<<24>>24)){w=92;break e}h=g;t:while(1){switch(u<<24>>24){case 37:{w=10;break t}case 0:{u=h;break t}default:{}}b=h+1|0;s[T>>2]=b;u=r[b>>0]|0;h=b}t:do{if((w|0)==10){w=0;u=h;do{if((r[h+1>>0]|0)!=37)break t;u=u+1|0;h=h+2|0;s[T>>2]=h}while((r[h>>0]|0)==37)}}while(0);u=u-g|0;if(C)lf(e,g,u)}while((u|0)!=0);b=(zd(r[(s[T>>2]|0)+1>>0]|0)|0)==0;h=s[T>>2]|0;if(!b?(r[h+2>>0]|0)==36:0){y=(r[h+1>>0]|0)+-48|0;p=1;u=3}else{y=-1;p=d;u=1}u=h+u|0;s[T>>2]=u;h=r[u>>0]|0;d=(h<<24>>24)+-32|0;if(d>>>0>31|(1<<d&75913|0)==0)f=0;else{f=0;do{f=1<<d|f;u=u+1|0;s[T>>2]=u;h=r[u>>0]|0;d=(h<<24>>24)+-32|0}while(!(d>>>0>31|(1<<d&75913|0)==0))}if(h<<24>>24==42){if((zd(r[u+1>>0]|0)|0)!=0?(P=s[T>>2]|0,(r[P+2>>0]|0)==36):0){u=P+1|0;s[o+((r[u>>0]|0)+-48<<2)>>2]=10;u=s[a+((r[u>>0]|0)+-48<<3)>>2]|0;d=1;h=P+3|0}else{if(p|0){t=-1;break}if(C){b=(s[n>>2]|0)+(4-1)&~(4-1);u=s[b>>2]|0;s[n>>2]=b+4}else u=0;d=0;h=(s[T>>2]|0)+1|0}s[T>>2]=h;b=(u|0)<0;_=b?0-u|0:u;f=b?f|8192:f;b=d}else{u=uf(T)|0;if((u|0)<0){t=-1;break}_=u;b=p;h=s[T>>2]|0}do{if((r[h>>0]|0)==46){u=h+1|0;if((r[u>>0]|0)!=42){s[T>>2]=u;u=uf(T)|0;h=s[T>>2]|0;break}if(zd(r[h+2>>0]|0)|0?(I=s[T>>2]|0,(r[I+3>>0]|0)==36):0){u=I+2|0;s[o+((r[u>>0]|0)+-48<<2)>>2]=10;u=s[a+((r[u>>0]|0)+-48<<3)>>2]|0;h=I+4|0;s[T>>2]=h;break}if(b|0){t=-1;break e}if(C){m=(s[n>>2]|0)+(4-1)&~(4-1);u=s[m>>2]|0;s[n>>2]=m+4}else u=0;h=(s[T>>2]|0)+2|0;s[T>>2]=h}else u=-1}while(0);m=0;while(1){if(((r[h>>0]|0)+-65|0)>>>0>57){t=-1;break e}d=h;h=h+1|0;s[T>>2]=h;d=r[(r[d>>0]|0)+-65+(176+(m*58|0))>>0]|0;p=d&255;if((p+-1|0)>>>0>=8)break;else m=p}if(!(d<<24>>24)){t=-1;break}v=(y|0)>-1;do{if(d<<24>>24==19){if(v){t=-1;break e}else w=54}else{if(v){s[o+(y<<2)>>2]=p;v=a+(y<<3)|0;y=s[v+4>>2]|0;w=S;s[w>>2]=s[v>>2];s[w+4>>2]=y;w=54;break}if(!C){t=0;break e}hf(S,p,n,l);h=s[T>>2]|0;w=55}}while(0);if((w|0)==54){w=0;if(C)w=55;else u=0}t:do{if((w|0)==55){w=0;h=r[h+-1>>0]|0;h=(m|0)!=0&(h&15|0)==3?h&-33:h;d=f&-65537;y=(f&8192|0)==0?f:d;n:do{switch(h|0){case 110:switch((m&255)<<24>>24){case 0:{s[s[S>>2]>>2]=t;u=0;break t}case 1:{s[s[S>>2]>>2]=t;u=0;break t}case 2:{u=s[S>>2]|0;s[u>>2]=t;s[u+4>>2]=((t|0)<0)<<31>>31;u=0;break t}case 3:{i[s[S>>2]>>1]=t;u=0;break t}case 4:{r[s[S>>2]>>0]=t;u=0;break t}case 6:{s[s[S>>2]>>2]=t;u=0;break t}case 7:{u=s[S>>2]|0;s[u>>2]=t;s[u+4>>2]=((t|0)<0)<<31>>31;u=0;break t}default:{u=0;break t}}case 112:{h=120;u=u>>>0>8?u:8;d=y|8;w=67;break}case 88:case 120:{d=y;w=67;break}case 111:{v=S;v=ff(s[v>>2]|0,s[v+4>>2]|0,M)|0;d=k-v|0;f=0;p=20230;u=(y&8|0)==0|(u|0)>(d|0)?u:d+1|0;d=y;w=73;break}case 105:case 100:{d=S;h=s[d>>2]|0;d=s[d+4>>2]|0;if((d|0)<0){h=rg(0,0,h|0,d|0)|0;d=B()|0;f=S;s[f>>2]=h;s[f+4>>2]=d;f=1;p=20230;w=72;break n}else{f=(y&2049|0)!=0&1;p=(y&2048|0)==0?(y&1|0)==0?20230:20232:20231;w=72;break n}}case 117:{d=S;f=0;p=20230;h=s[d>>2]|0;d=s[d+4>>2]|0;w=72;break}case 99:{r[E>>0]=s[S>>2];g=E;f=0;p=20230;v=1;h=d;u=k;break}case 115:{m=s[S>>2]|0;m=(m|0)==0?20240:m;y=rf(m,0,u)|0;Q=(y|0)==0;g=m;f=0;p=20230;v=Q?u:y-m|0;h=d;u=Q?m+u|0:y;break}case 67:{s[x>>2]=s[S>>2];s[F>>2]=0;s[S>>2]=x;p=-1;w=79;break}case 83:{if(!u){vf(e,32,_,0,y);u=0;w=89}else{p=u;w=79}break}case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:{u=Lg[A&1](e,+c[S>>3],_,u,y,h)|0;break t}default:{f=0;p=20230;v=u;h=y;u=k}}}while(0);n:do{if((w|0)==67){v=S;v=df(s[v>>2]|0,s[v+4>>2]|0,M,h&32)|0;p=S;p=(d&8|0)==0|(s[p>>2]|0)==0&(s[p+4>>2]|0)==0;f=p?0:2;p=p?20230:20230+(h>>>4)|0;w=73}else if((w|0)==72){v=pf(h,d,M)|0;d=y;w=73}else if((w|0)==79){w=0;f=s[S>>2]|0;u=0;while(1){h=s[f>>2]|0;if(!h)break;h=gf(U,h)|0;d=(h|0)<0;if(d|h>>>0>(p-u|0)>>>0){w=83;break}u=h+u|0;if(p>>>0>u>>>0)f=f+4|0;else break}if((w|0)==83){w=0;if(d){t=-1;break e}}vf(e,32,_,u,y);if(!u){u=0;w=89}else{d=s[S>>2]|0;f=0;while(1){h=s[d>>2]|0;if(!h){w=89;break n}h=gf(U,h)|0;f=h+f|0;if((f|0)>(u|0)){w=89;break n}lf(e,U,h);if(f>>>0>=u>>>0){w=89;break}else d=d+4|0}}}}while(0);if((w|0)==73){w=0;h=S;h=(s[h>>2]|0)!=0|(s[h+4>>2]|0)!=0;Q=(u|0)!=0|h;h=k-v+((h^1)&1)|0;g=Q?v:M;v=Q?(u|0)>(h|0)?u:h:0;h=(u|0)>-1?d&-65537:d;u=k}else if((w|0)==89){w=0;vf(e,32,_,u,y^8192);u=(_|0)>(u|0)?_:u;break}y=u-g|0;m=(v|0)<(y|0)?y:v;Q=m+f|0;u=(_|0)<(Q|0)?Q:_;vf(e,32,u,Q,h);lf(e,p,f);vf(e,48,u,Q,h^65536);vf(e,48,m,y,0);lf(e,g,y);vf(e,32,u,Q,h^8192)}}while(0);d=b}e:do{if((w|0)==92)if(!e)if(!d)t=0;else{t=1;while(1){u=s[o+(t<<2)>>2]|0;if(!u)break;hf(a+(t<<3)|0,u,n,l);t=t+1|0;if(t>>>0>=10){t=1;break e}}while(1){if(s[o+(t<<2)>>2]|0){t=-1;break e}t=t+1|0;if(t>>>0>=10){t=1;break}}}}while(0);J=D;return t|0}function lf(e,t,n){e=e|0;t=t|0;n=n|0;if(!(s[e>>2]&32))$d(t,n,e)|0;return}function uf(e){e=e|0;var t=0,n=0;if(!(zd(r[s[e>>2]>>0]|0)|0))t=0;else{t=0;do{n=s[e>>2]|0;t=(t*10|0)+-48+(r[n>>0]|0)|0;n=n+1|0;s[e>>2]=n}while((zd(r[n>>0]|0)|0)!=0)}return t|0}function hf(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0.0;e:do{if(t>>>0<=20)do{switch(t|0){case 9:{t=(s[n>>2]|0)+(4-1)&~(4-1);r=s[t>>2]|0;s[n>>2]=t+4;s[e>>2]=r;break e}case 10:{r=(s[n>>2]|0)+(4-1)&~(4-1);t=s[r>>2]|0;s[n>>2]=r+4;r=e;s[r>>2]=t;s[r+4>>2]=((t|0)<0)<<31>>31;break e}case 11:{r=(s[n>>2]|0)+(4-1)&~(4-1);t=s[r>>2]|0;s[n>>2]=r+4;r=e;s[r>>2]=t;s[r+4>>2]=0;break e}case 12:{r=(s[n>>2]|0)+(8-1)&~(8-1);t=r;i=s[t>>2]|0;t=s[t+4>>2]|0;s[n>>2]=r+8;r=e;s[r>>2]=i;s[r+4>>2]=t;break e}case 13:{i=(s[n>>2]|0)+(4-1)&~(4-1);r=s[i>>2]|0;s[n>>2]=i+4;r=(r&65535)<<16>>16;i=e;s[i>>2]=r;s[i+4>>2]=((r|0)<0)<<31>>31;break e}case 14:{i=(s[n>>2]|0)+(4-1)&~(4-1);r=s[i>>2]|0;s[n>>2]=i+4;i=e;s[i>>2]=r&65535;s[i+4>>2]=0;break e}case 15:{i=(s[n>>2]|0)+(4-1)&~(4-1);r=s[i>>2]|0;s[n>>2]=i+4;r=(r&255)<<24>>24;i=e;s[i>>2]=r;s[i+4>>2]=((r|0)<0)<<31>>31;break e}case 16:{i=(s[n>>2]|0)+(4-1)&~(4-1);r=s[i>>2]|0;s[n>>2]=i+4;i=e;s[i>>2]=r&255;s[i+4>>2]=0;break e}case 17:{i=(s[n>>2]|0)+(8-1)&~(8-1);a=+c[i>>3];s[n>>2]=i+8;c[e>>3]=a;break e}case 18:{Wg[r&15](e,n);break e}default:break e}}while(0)}while(0);return}function df(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;if(!((e|0)==0&(t|0)==0))do{n=n+-1|0;r[n>>0]=a[640+(e&15)>>0]|0|i;e=og(e|0,t|0,4)|0;t=B()|0}while(!((e|0)==0&(t|0)==0));return n|0}function ff(e,t,n){e=e|0;t=t|0;n=n|0;if(!((e|0)==0&(t|0)==0))do{n=n+-1|0;r[n>>0]=e&7|48;e=og(e|0,t|0,3)|0;t=B()|0}while(!((e|0)==0&(t|0)==0));return n|0}function pf(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,s=0,a=0;if(t>>>0>0|(t|0)==0&e>>>0>4294967295){do{i=e;e=ag(e|0,t|0,10,0)|0;s=t;t=B()|0;a=tg(e|0,t|0,10,0)|0;a=rg(i|0,s|0,a|0,B()|0)|0;B()|0;n=n+-1|0;r[n>>0]=a&255|48}while(s>>>0>9|(s|0)==9&i>>>0>4294967295);t=e}else t=e;if(t)do{a=t;t=(t>>>0)/10|0;n=n+-1|0;r[n>>0]=a-(t*10|0)|48}while(a>>>0>=10);return n|0}function vf(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var s=0,a=0;a=J;J=J+256|0;s=a;if((n|0)>(r|0)&(i&73728|0)==0){i=n-r|0;dg(s|0,t<<24>>24|0,(i>>>0<256?i:256)|0)|0;if(i>>>0>255){t=n-r|0;do{lf(e,s,256);i=i+-256|0}while(i>>>0>255);i=t&255}lf(e,s,i)}J=a;return}function gf(e,t){e=e|0;t=t|0;if(!e)e=0;else e=mf(e,t,0)|0;return e|0}function mf(e,t,n){e=e|0;t=t|0;n=n|0;do{if(e){if(t>>>0<128){r[e>>0]=t;e=1;break}if(!(s[s[(yf()|0)+176>>2]>>2]|0))if((t&-128|0)==57216){r[e>>0]=t;e=1;break}else{s[(Wd()|0)>>2]=25;e=-1;break}if(t>>>0<2048){r[e>>0]=t>>>6|192;r[e+1>>0]=t&63|128;e=2;break}if(t>>>0<55296|(t&-8192|0)==57344){r[e>>0]=t>>>12|224;r[e+1>>0]=t>>>6&63|128;r[e+2>>0]=t&63|128;e=3;break}if((t+-65536|0)>>>0<1048576){r[e>>0]=t>>>18|240;r[e+1>>0]=t>>>12&63|128;r[e+2>>0]=t>>>6&63|128;r[e+3>>0]=t&63|128;e=4;break}else{s[(Wd()|0)>>2]=25;e=-1;break}}else e=1}while(0);return e|0}function yf(){return Xd()|0}function _f(e){e=+e;var t=0;c[l>>3]=e;t=s[l>>2]|0;w(s[l+4>>2]|0);return t|0}function bf(e,t){e=+e;t=t|0;var n=0,r=0,i=0;c[l>>3]=e;n=s[l>>2]|0;r=s[l+4>>2]|0;i=og(n|0,r|0,52)|0;B()|0;switch(i&2047){case 0:{if(e!=0.0){e=+bf(e*18446744073709551616.0,t);n=(s[t>>2]|0)+-64|0}else n=0;s[t>>2]=n;break}case 2047:break;default:{s[t>>2]=(i&2047)+-1022;s[l>>2]=n;s[l+4>>2]=r&-2146435073|1071644672;e=+c[l>>3]}}return+e}function wf(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,s=0;e:do{if(!n)e=0;else{while(1){i=r[e>>0]|0;s=r[t>>0]|0;if(i<<24>>24!=s<<24>>24)break;n=n+-1|0;if(!n){e=0;break e}else{e=e+1|0;t=t+1|0}}e=(i&255)-(s&255)|0}}while(0);return e|0}function Bf(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;i=J;J=J+16|0;a=i;s[a>>2]=r;r=Cf(e,t,n,a)|0;J=i;return r|0}function Cf(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;var a=0,o=0,A=0,c=0;c=J;J=J+160|0;a=c+144|0;A=c;ug(A|0,3672,144)|0;if((t+-1|0)>>>0>2147483646){if(!t){e=a;t=1;o=4}else{s[(Wd()|0)>>2]=61;t=-1}}else o=4;if((o|0)==4){o=-2-e|0;o=t>>>0>o>>>0?o:t;s[A+48>>2]=o;a=A+20|0;s[a>>2]=e;s[A+44>>2]=e;t=e+o|0;e=A+16|0;s[e>>2]=t;s[A+28>>2]=t;t=sf(A,n,i)|0;if(o){A=s[a>>2]|0;r[A+(((A|0)==(s[e>>2]|0))<<31>>31)>>0]=0}}J=c;return t|0}function Mf(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;r=e+20|0;i=s[r>>2]|0;e=(s[e+16>>2]|0)-i|0;e=e>>>0>n>>>0?n:e;ug(i|0,t|0,e|0)|0;s[r>>2]=(s[r>>2]|0)+e;return n|0}function kf(e){e=e|0;var t=0,n=0;t=(Zd(e)|0)+1|0;n=Kv(t)|0;if(!n)e=0;else e=ug(n|0,e|0,t|0)|0;return e|0}function Ef(e,t){e=e|0;t=t|0;var n=0,i=0;n=0;while(1){if((a[656+n>>0]|0)==(e|0)){i=4;break}n=n+1|0;if((n|0)==87){e=87;i=5;break}}if((i|0)==4)if(!n)n=752;else{e=n;i=5}if((i|0)==5){n=752;do{do{i=n;n=n+1|0}while((r[i>>0]|0)!=0);e=e+-1|0}while((e|0)!=0)}return Ff(n,s[t+20>>2]|0)|0}function Ff(e,t){e=e|0;t=t|0;return ef(e,t)|0}function xf(e){e=e|0;return Ef(e,s[(Uf()|0)+176>>2]|0)|0}function Uf(){return Xd()|0}function If(e,t,n){e=e|0;t=t|0;n=n|0;var i=0;i=xf(e)|0;e=Zd(i)|0;if(e>>>0>=n>>>0){e=n+-1|0;if(!n)e=68;else{ug(t|0,i|0,e|0)|0;r[t+e>>0]=0;e=68}}else{ug(t|0,i|0,e+1|0)|0;e=0}return e|0}function Tf(){var e=0,t=0,n=0,r=0,i=0,a=0,o=0;r=J;J=J+48|0;a=r+32|0;t=r+24|0;o=r+16|0;i=r;r=r+36|0;e=Pf()|0;if(e|0?(n=s[e>>2]|0,n|0):0){e=n+48|0;if(!(Sf(e)|0)){s[t>>2]=20420;Qf(20370,t)}t=Df(e)|0;if((t|0)==1126902529&(B()|0)==1129074247)e=s[n+44>>2]|0;else e=n+80|0;s[r>>2]=e;n=s[n>>2]|0;e=s[n+4>>2]|0;if(Ng[s[(s[954]|0)+16>>2]&7](3816,n,r)|0){o=s[r>>2]|0;o=Vg[s[(s[o>>2]|0)+8>>2]&15](o)|0;s[i>>2]=20420;s[i+4>>2]=e;s[i+8>>2]=o;Qf(20284,i)}else{s[o>>2]=20420;s[o+4>>2]=e;Qf(20329,o)}}Qf(20408,a)}function Pf(){return 21640}function Sf(e){e=e|0;e=Df(e)|0;return(e&-256|0)==1126902528&(B()|0)==1129074247|0}function Df(e){e=e|0;var t=0;t=e;e=s[t>>2]|0;w(s[t+4>>2]|0);return e|0}function Qf(e,t){e=e|0;t=t|0;Z()}function Rf(e){e=e|0;return}function Of(e){e=e|0;Rf(e);ep(e);return}function Vf(e){e=e|0;return}function Lf(e){e=e|0;return}function Hf(e,t,n){e=e|0;t=t|0;n=n|0;var a=0,o=0,A=0,c=0,l=0,u=0;u=J;J=J+64|0;c=u;if(!(Wf(e,t,0)|0)){if((t|0)!=0?(l=Zf(t,3840,3824,0)|0,(l|0)!=0):0){s[c>>2]=l;s[c+4>>2]=0;s[c+8>>2]=e;s[c+12>>2]=-1;e=c+16|0;t=c+24|0;a=c+48|0;o=e;A=o+36|0;do{s[o>>2]=0;o=o+4|0}while((o|0)<(A|0));i[e+36>>1]=0;r[e+38>>0]=0;s[a>>2]=1;Xg[s[(s[l>>2]|0)+28>>2]&7](l,c,s[n>>2]|0,1);if((s[t>>2]|0)==1){s[n>>2]=s[e>>2];e=1}else e=0}else e=0}else e=1;J=u;return e|0}function Nf(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;if(Wf(e,s[t+8>>2]|0,a)|0)Kf(0,t,n,r,i);return}function Gf(e,t,n,i,a){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;var o=0;do{if(!(Wf(e,s[t+8>>2]|0,a)|0)){if(Wf(e,s[t>>2]|0,a)|0){if((s[t+16>>2]|0)!=(n|0)?(o=t+20|0,(s[o>>2]|0)!=(n|0)):0){s[t+32>>2]=i;s[o>>2]=n;a=t+40|0;s[a>>2]=(s[a>>2]|0)+1;if((s[t+36>>2]|0)==1?(s[t+24>>2]|0)==2:0)r[t+54>>0]=1;s[t+44>>2]=4;break}if((i|0)==1)s[t+32>>2]=1}}else Xf(0,t,n,i)}while(0);return}function jf(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;if(Wf(e,s[t+8>>2]|0,0)|0)zf(0,t,n,r);return}function Wf(e,t,n){e=e|0;t=t|0;n=n|0;if(n){if((e|0)==(t|0))e=1;else e=(Kd(s[e+4>>2]|0,s[t+4>>2]|0)|0)==0}else e=(s[e+4>>2]|0)==(s[t+4>>2]|0);return e|0}function zf(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;var a=0;e=t+16|0;a=s[e>>2]|0;do{if(a){if((a|0)!=(n|0)){i=t+36|0;s[i>>2]=(s[i>>2]|0)+1;s[t+24>>2]=2;r[t+54>>0]=1;break}e=t+24|0;if((s[e>>2]|0)==2)s[e>>2]=i}else{s[e>>2]=n;s[t+24>>2]=i;s[t+36>>2]=1}}while(0);return}function Xf(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0;if((s[t+4>>2]|0)==(n|0)?(i=t+28|0,(s[i>>2]|0)!=1):0)s[i>>2]=r;return}function Kf(e,t,n,i,a){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;r[t+53>>0]=1;do{if((s[t+4>>2]|0)==(i|0)){r[t+52>>0]=1;e=t+16|0;i=s[e>>2]|0;if(!i){s[e>>2]=n;s[t+24>>2]=a;s[t+36>>2]=1;if(!((a|0)==1?(s[t+48>>2]|0)==1:0))break;r[t+54>>0]=1;break}if((i|0)!=(n|0)){a=t+36|0;s[a>>2]=(s[a>>2]|0)+1;r[t+54>>0]=1;break}i=t+24|0;e=s[i>>2]|0;if((e|0)==2){s[i>>2]=a;e=a}if((e|0)==1?(s[t+48>>2]|0)==1:0)r[t+54>>0]=1}}while(0);return}function Zf(e,t,n,a){e=e|0;t=t|0;n=n|0;a=a|0;var o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0;p=J;J=J+64|0;d=p;h=s[e>>2]|0;f=e+(s[h+-8>>2]|0)|0;h=s[h+-4>>2]|0;s[d>>2]=n;s[d+4>>2]=e;s[d+8>>2]=t;s[d+12>>2]=a;e=d+16|0;t=d+20|0;a=d+24|0;o=d+28|0;A=d+32|0;c=d+40|0;l=e;u=l+36|0;do{s[l>>2]=0;l=l+4|0}while((l|0)<(u|0));i[e+36>>1]=0;r[e+38>>0]=0;e:do{if(Wf(h,n,0)|0){s[d+48>>2]=1;Zg[s[(s[h>>2]|0)+20>>2]&3](h,d,f,f,1,0);e=(s[a>>2]|0)==1?f:0}else{Kg[s[(s[h>>2]|0)+24>>2]&3](h,d,f,1,0);switch(s[d+36>>2]|0){case 0:{e=(s[c>>2]|0)==1&(s[o>>2]|0)==1&(s[A>>2]|0)==1?s[t>>2]|0:0;break e}case 1:break;default:{e=0;break e}}if((s[a>>2]|0)!=1?!((s[c>>2]|0)==0&(s[o>>2]|0)==1&(s[A>>2]|0)==1):0){e=0;break}e=s[e>>2]|0}}while(0);J=p;return e|0}function Jf(e){e=e|0;Rf(e);ep(e);return}function Yf(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;if(Wf(e,s[t+8>>2]|0,a)|0)Kf(0,t,n,r,i);else{e=s[e+8>>2]|0;Zg[s[(s[e>>2]|0)+20>>2]&3](e,t,n,r,i,a)}return}function qf(e,t,n,i,a){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;var o=0,A=0,c=0;e:do{if(!(Wf(e,s[t+8>>2]|0,a)|0)){if(!(Wf(e,s[t>>2]|0,a)|0)){A=s[e+8>>2]|0;Kg[s[(s[A>>2]|0)+24>>2]&3](A,t,n,i,a);break}if((s[t+16>>2]|0)!=(n|0)?(A=t+20|0,(s[A>>2]|0)!=(n|0)):0){s[t+32>>2]=i;i=t+44|0;do{if((s[i>>2]|0)!=4){o=t+52|0;r[o>>0]=0;c=t+53|0;r[c>>0]=0;e=s[e+8>>2]|0;Zg[s[(s[e>>2]|0)+20>>2]&3](e,t,n,n,1,a);if(r[c>>0]|0){c=(r[o>>0]|0)==0;s[i>>2]=3;if(c)break;else break e}else{s[i>>2]=4;break}}}while(0);s[A>>2]=n;c=t+40|0;s[c>>2]=(s[c>>2]|0)+1;if((s[t+36>>2]|0)!=1)break;if((s[t+24>>2]|0)!=2)break;r[t+54>>0]=1;break}if((i|0)==1)s[t+32>>2]=1}else Xf(0,t,n,i)}while(0);return}function $f(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;if(Wf(e,s[t+8>>2]|0,0)|0)zf(0,t,n,r);else{e=s[e+8>>2]|0;Xg[s[(s[e>>2]|0)+28>>2]&7](e,t,n,r)}return}function ep(e){e=e|0;Zv(e);return}function tp(e){e=e|0;return}function np(){var e=0,t=0;e=Pf()|0;if((e|0?(t=s[e>>2]|0,t|0):0)?Sf(t+48|0)|0:0)rp(s[t+12>>2]|0);rp(ip()|0)}function rp(e){e=e|0;var t=0;t=J;J=J+16|0;Gg[e&3]();Qf(20559,t)}function ip(){return 2}function sp(e){e=e|0;return}function ap(e){e=e|0;ep(e);return}function op(e){e=e|0;return 20599}function Ap(e){e=e|0;s[e>>2]=5916;hp(e+4|0);return}function cp(e){e=e|0;Ap(e);ep(e);return}function lp(e){e=e|0;return up(e+4|0)|0}function up(e){e=e|0;return s[e>>2]|0}function hp(e){e=e|0;var t=0,n=0;if(dp(e)|0?(t=fp(s[e>>2]|0)|0,n=t+8|0,e=s[n>>2]|0,s[n>>2]=e+-1,(e|0)<1):0)ep(t);return}function dp(e){e=e|0;return 1}function fp(e){e=e|0;return e+-12|0}function pp(e){e=e|0;s[e>>2]=5936;hp(e+4|0);return}function vp(e){e=e|0;pp(e);ep(e);return}function gp(e){e=e|0;return up(e+4|0)|0}function mp(e){e=e|0;Ap(e);ep(e);return}function yp(e){e=e|0;Ap(e);ep(e);return}function _p(){var e=0;e=J;J=J+16|0;Qf(20848,e)}function bp(e){e=e|0;Rf(e);ep(e);return}function wp(e,t,n){e=e|0;t=t|0;n=n|0;return Wf(e,t,0)|0}function Bp(e){e=e|0;Rf(e);ep(e);return}function Cp(e,t,n){e=e|0;t=t|0;n=n|0;var a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0;d=J;J=J+64|0;u=d;do{if(!(Wf(t,4048,0)|0)){if(Mp(e,t,0)|0){t=s[n>>2]|0;if(!t){t=1;break}s[n>>2]=s[t>>2];t=1;break}if((t|0)!=0?(a=Zf(t,3840,3976,0)|0,(a|0)!=0):0){t=s[n>>2]|0;if(t|0)s[n>>2]=s[t>>2];t=s[a+8>>2]|0;A=e+8|0;o=s[A>>2]|0;if((t&7&(o^7)|0)==0?((t&96^96)&o|0)==0:0){o=e+12|0;e=s[o>>2]|0;a=a+12|0;t=s[a>>2]|0;if(!(Wf(e,t,0)|0)){if(Wf(e,4040,0)|0){if(!t){t=1;break}t=(Zf(t,3840,3992,0)|0)==0;break}if(e){t=Zf(e,3840,3976,0)|0;if(t|0){if(!(s[A>>2]&1)){t=0;break}t=kp(t,s[a>>2]|0)|0;break}t=s[o>>2]|0;if(t){t=Zf(t,3840,4008,0)|0;if(t|0){if(!(s[A>>2]&1)){t=0;break}t=Ep(t,s[a>>2]|0)|0;break}t=s[o>>2]|0;if((((t|0)!=0?(c=Zf(t,3840,3824,0)|0,(c|0)!=0):0)?(l=s[a>>2]|0,(l|0)!=0):0)?(h=Zf(l,3840,3824,0)|0,(h|0)!=0):0){s[u>>2]=h;s[u+4>>2]=0;s[u+8>>2]=c;s[u+12>>2]=-1;t=u+16|0;e=u+24|0;a=u+48|0;o=t;A=o+36|0;do{s[o>>2]=0;o=o+4|0}while((o|0)<(A|0));i[t+36>>1]=0;r[t+38>>0]=0;s[a>>2]=1;Xg[s[(s[h>>2]|0)+28>>2]&7](h,u,s[n>>2]|0,1);do{if((s[e>>2]|0)==1){if(!(s[n>>2]|0)){t=1;break}s[n>>2]=s[t>>2];t=1}else t=0}while(0)}else t=0}else t=0}else t=0}else t=1}else t=0}else t=0}else{s[n>>2]=0;t=1}}while(0);J=d;return t|0}function Mp(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;if(!(s[e+8>>2]&24)){if((t|0)!=0?(r=Zf(t,3840,3960,0)|0,(r|0)!=0):0){n=(s[r+8>>2]&24|0)!=0;i=5}else n=0}else{n=1;i=5}if((i|0)==5)n=Wf(e,t,n)|0;return n|0}function kp(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,a=0,o=0;while(1){if(!t){t=0;break}n=Zf(t,3840,3976,0)|0;if(!n){t=0;break}i=s[e+8>>2]|0;if(s[n+8>>2]&~i|0){t=0;break}r=e+12|0;t=s[r>>2]|0;n=n+12|0;if(Wf(t,s[n>>2]|0,0)|0){t=1;break}if((i&1|0)==0|(t|0)==0){t=0;break}e=Zf(t,3840,3976,0)|0;if(!e){o=9;break}t=s[n>>2]|0}if((o|0)==9){t=s[r>>2]|0;if((t|0)!=0?(a=Zf(t,3840,4008,0)|0,(a|0)!=0):0)t=Ep(a,s[n>>2]|0)|0;else t=0}return t|0}function Ep(e,t){e=e|0;t=t|0;var n=0;if((((t|0)!=0?(n=Zf(t,3840,4008,0)|0,(n|0)!=0):0)?(s[n+8>>2]&~s[e+8>>2]|0)==0:0)?Wf(s[e+12>>2]|0,s[n+12>>2]|0,0)|0:0)e=Wf(s[e+16>>2]|0,s[n+16>>2]|0,0)|0;else e=0;return e|0}function Fp(e){e=e|0;Rf(e);ep(e);return}function xp(e,t,n,i,a,o){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;o=o|0;var A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0,g=0;if(Wf(e,s[t+8>>2]|0,o)|0)Kf(0,t,n,i,a);else{g=t+52|0;c=r[g>>0]|0;v=t+53|0;A=r[v>>0]|0;p=s[e+12>>2]|0;h=e+16+(p<<3)|0;r[g>>0]=0;r[v>>0]=0;Pp(e+16|0,t,n,i,a,o);l=r[g>>0]|0;c=l|c;u=r[v>>0]|0;A=u|A;e:do{if((p|0)>1){d=t+24|0;f=e+8|0;p=t+54|0;e=e+24|0;do{A=A&1;c=c&1;if(r[p>>0]|0)break e;if(!(l<<24>>24)){if(u<<24>>24?(s[f>>2]&1|0)==0:0)break e}else{if((s[d>>2]|0)==1)break e;if(!(s[f>>2]&2))break e}r[g>>0]=0;r[v>>0]=0;Pp(e,t,n,i,a,o);l=r[g>>0]|0;c=l|c;u=r[v>>0]|0;A=u|A;e=e+8|0}while(e>>>0<h>>>0)}}while(0);r[g>>0]=c<<24>>24!=0&1;r[v>>0]=A<<24>>24!=0&1}return}function Up(e,t,n,i,a){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;var o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0;e:do{if(!(Wf(e,s[t+8>>2]|0,a)|0)){if(!(Wf(e,s[t>>2]|0,a)|0)){p=s[e+12>>2]|0;l=e+16+(p<<3)|0;Sp(e+16|0,t,n,i,a);o=e+24|0;if((p|0)<=1)break;e=s[e+8>>2]|0;if((e&2|0)==0?(c=t+36|0,(s[c>>2]|0)!=1):0){if(!(e&1)){e=t+54|0;while(1){if(r[e>>0]|0)break e;if((s[c>>2]|0)==1)break e;Sp(o,t,n,i,a);o=o+8|0;if(o>>>0>=l>>>0)break e}}e=t+24|0;A=t+54|0;while(1){if(r[A>>0]|0)break e;if((s[c>>2]|0)==1?(s[e>>2]|0)==1:0)break e;Sp(o,t,n,i,a);o=o+8|0;if(o>>>0>=l>>>0)break e}}e=t+54|0;while(1){if(r[e>>0]|0)break e;Sp(o,t,n,i,a);o=o+8|0;if(o>>>0>=l>>>0)break e}}if((s[t+16>>2]|0)!=(n|0)?(p=t+20|0,(s[p>>2]|0)!=(n|0)):0){s[t+32>>2]=i;f=t+44|0;if((s[f>>2]|0)!=4){c=e+16+(s[e+12>>2]<<3)|0;l=t+52|0;i=t+53|0;u=t+54|0;h=e+8|0;d=t+24|0;o=0;A=e+16|0;e=0;t:while(1){if(A>>>0>=c>>>0){A=18;break}r[l>>0]=0;r[i>>0]=0;Pp(A,t,n,n,1,a);if(r[u>>0]|0){A=18;break}do{if(r[i>>0]|0){if(!(r[l>>0]|0))if(!(s[h>>2]&1)){A=19;break t}else{e=1;break}if((s[d>>2]|0)==1){o=1;A=19;break t}if(!(s[h>>2]&2)){o=1;A=19;break t}else{o=1;e=1}}}while(0);A=A+8|0}if((A|0)==18)if(e)A=19;else e=4;if((A|0)==19)e=3;s[f>>2]=e;if(o&1)break}s[p>>2]=n;n=t+40|0;s[n>>2]=(s[n>>2]|0)+1;if((s[t+36>>2]|0)!=1)break;if((s[t+24>>2]|0)!=2)break;r[t+54>>0]=1;break}if((i|0)==1)s[t+32>>2]=1}else Xf(0,t,n,i)}while(0);return}function Ip(e,t,n,i){e=e|0;t=t|0;n=n|0;i=i|0;var a=0,o=0;e:do{if(!(Wf(e,s[t+8>>2]|0,0)|0)){o=s[e+12>>2]|0;a=e+16+(o<<3)|0;Tp(e+16|0,t,n,i);if((o|0)>1){o=t+54|0;e=e+24|0;do{Tp(e,t,n,i);if(r[o>>0]|0)break e;e=e+8|0}while(e>>>0<a>>>0)}}else zf(0,t,n,i)}while(0);return}function Tp(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,a=0;a=s[e+4>>2]|0;if(n){i=a>>8;if(a&1)i=s[(s[n>>2]|0)+i>>2]|0}else i=0;e=s[e>>2]|0;Xg[s[(s[e>>2]|0)+28>>2]&7](e,t,n+i|0,(a&2|0)==0?2:r);return}function Pp(e,t,n,r,i,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;a=a|0;var o=0,A=0;A=s[e+4>>2]|0;o=A>>8;if(A&1)o=s[(s[r>>2]|0)+o>>2]|0;e=s[e>>2]|0;Zg[s[(s[e>>2]|0)+20>>2]&3](e,t,n,r+o|0,(A&2|0)==0?2:i,a);return}function Sp(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0;o=s[e+4>>2]|0;a=o>>8;if(o&1)a=s[(s[n>>2]|0)+a>>2]|0;e=s[e>>2]|0;Kg[s[(s[e>>2]|0)+24>>2]&3](e,t,n+a|0,(o&2|0)==0?2:r,i);return}function Dp(e){e=e|0;s[e>>2]=5896;return}function Qp(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;Rp(n,e);e=Op(n)|0;J=t;return e|0}function Rp(e,t){e=e|0;t=t|0;Gp(e,t);return}function Op(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;Vp(n,s[e+4>>2]|0);if(!((Lp(n)|0)<<24>>24))e=Np(Hp(e)|0)|0;else e=0;J=t;return e|0}function Vp(e,t){e=e|0;t=t|0;s[e>>2]=t;return}function Lp(e){e=e|0;return r[s[e>>2]>>0]|0}function Hp(e){e=e|0;return e|0}function Np(e){e=e|0;var t=0,n=0,i=0,a=0;a=J;J=J+16|0;i=a;e=s[e+8>>2]|0;t=r[e>>0]|0;do{if(t<<24>>24!=1){if(!(t&2)){r[e>>0]=2;n=1;break}else Qf(20985,i)}else n=0}while(0);J=a;return n|0}function Gp(e,t){e=e|0;t=t|0;s[e>>2]=t;s[e+4>>2]=t;s[e+8>>2]=t+1;s[e+12>>2]=0;return}function jp(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;Rp(n,e);Wp(n);J=t;return}function Wp(e){e=e|0;var t=0,n=0;t=J;J=J+16|0;n=t;Vp(n,s[e+4>>2]|0);zp(n);Xp(Hp(e)|0);J=t;return}function zp(e){e=e|0;r[s[e>>2]>>0]=1;return}function Xp(e){e=e|0;r[s[e+8>>2]>>0]=1;return}function Kp(){return 0}function Zp(e){e=e|0;var t=0,n=0;n=(e|0)==0?1:e;while(1){t=Kv(n)|0;if(t|0){e=6;break}e=Kp()|0;if(!e){e=5;break}Gg[e&3]()}if((e|0)==5){n=C(4)|0;Dp(n);k(n|0,3880,121)}else if((e|0)==6)return t|0;return 0}function Jp(e){e=e|0;return Zp(e)|0}function Yp(e){e=e|0;ep(e);return}function qp(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=J;J=J+16|0;r=i;s[r>>2]=s[n>>2];e=Ng[s[(s[e>>2]|0)+16>>2]&7](e,t,r)|0;if(e)s[n>>2]=s[r>>2];J=i;return e&1|0}function $p(e){e=e|0;if(!e)e=0;else e=(Zf(e,3840,3976,0)|0)!=0&1;return e|0}function ev(e){e=e|0;return 0}function tv(){return(nv()|0)>0|0}function nv(){return E()|0}function rv(e){e=e|0;return}function iv(e){e=e|0;rv(e);ep(e);return}function sv(e){e=e|0;return 21039}function av(e){e=e|0;return}function ov(e){e=e|0;var t=0,n=0;t=e+8|0;if(!((s[t>>2]|0)!=0?(n=s[t>>2]|0,s[t>>2]=n+-1,(n|0)!=0):0))jg[s[(s[e>>2]|0)+16>>2]&255](e);return}function Av(e){e=e|0;e=ev(e)|0;if(!e)return;else zv(e,21145)}function cv(e){e=e|0;return}function lv(e,t){e=e|0;t=t|0;var n=0,r=0;r=Zd(t)|0;n=Zp(r+13|0)|0;s[n>>2]=r;s[n+4>>2]=r;s[n+8>>2]=0;n=uv(n)|0;ug(n|0,t|0,r+1|0)|0;s[e>>2]=n;return}function uv(e){e=e|0;return e+12|0}function hv(e,t){e=e|0;t=t|0;s[e>>2]=5916;lv(e+4|0,t);return}function dv(e,t){e=e|0;t=t|0;s[e>>2]=5936;lv(e+4|0,(r[t+11>>0]|0)<0?s[t>>2]|0:t);return}function fv(e,t){e=e|0;t=t|0;s[e>>2]=5936;lv(e+4|0,t);return}function pv(e){e=e|0;e=C(8)|0;hv(e,21163);s[e>>2]=5956;k(e|0,3928,123)}function vv(e){e=e|0;e=C(8)|0;hv(e,21163);s[e>>2]=5976;k(e|0,3944,123)}function gv(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0;a=J;J=J+16|0;i=a;if(n>>>0>4294967279)pv(e);if(n>>>0<11)r[e+11>>0]=n;else{A=n+16&-16;o=Zp(A)|0;s[e>>2]=o;s[e+8>>2]=A|-2147483648;s[e+4>>2]=n;e=o}mv(e,t,n)|0;r[i>>0]=0;it(e+n|0,i);J=a;return}function mv(e,t,n){e=e|0;t=t|0;n=n|0;if(n|0)ug(e|0,t|0,n|0)|0;return e|0}function yv(e){e=e|0;if((r[e+11>>0]|0)<0)_e(s[e>>2]|0,s[e+8>>2]&2147483647);return}function _v(e,t,n,i,a,o,A,c){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;o=o|0;A=A|0;c=c|0;var l=0,u=0,h=0,d=0,f=0;f=J;J=J+16|0;d=f;if((-18-t|0)>>>0<n>>>0)pv(e);if((r[e+11>>0]|0)<0)h=s[e>>2]|0;else h=e;if(t>>>0<2147483623){l=n+t|0;u=t<<1;l=l>>>0<u>>>0?u:l;l=l>>>0<11?11:l+16&-16}else l=-17;u=Zp(l)|0;if(a|0)mv(u,h,a)|0;if(A|0)mv(u+a|0,c,A)|0;i=i-o|0;n=i-a|0;if(n|0)mv(u+a+A|0,h+a+o|0,n)|0;n=t+1|0;if((n|0)!=11)_e(h,n);s[e>>2]=u;s[e+8>>2]=l|-2147483648;A=i+A|0;s[e+4>>2]=A;r[d>>0]=0;it(u+A|0,d);J=f;return}function bv(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0,c=0,l=0;l=J;J=J+16|0;A=l;c=e+11|0;i=r[c>>0]|0;o=i<<24>>24<0;if(o){a=(s[e+8>>2]&2147483647)+-1|0;i=s[e+4>>2]|0}else{a=10;i=i&255}if((a-i|0)>>>0>=n>>>0){if(n|0){if(o)a=s[e>>2]|0;else a=e;mv(a+i|0,t,n)|0;i=i+n|0;if((r[c>>0]|0)<0)s[e+4>>2]=i;else r[c>>0]=i;r[A>>0]=0;it(a+i|0,A)}}else _v(e,a,i+n-a|0,i,i,0,n,t);J=l;return e|0}function wv(e,t){e=e|0;t=t|0;return bv(e,t,nt(t)|0)|0}function Bv(e,t,n){e=e|0;t=t|0;n=n|0;if(!n)e=0;else e=wf(e,t,n)|0;return e|0}function Cv(e,t,n,i,a){e=e|0;t=t|0;n=n|0;i=i|0;a=a|0;var o=0,A=0;o=r[e+11>>0]|0;A=o<<24>>24<0;if(A)o=s[e+4>>2]|0;else o=o&255;if((a|0)==-1|o>>>0<t>>>0)vv(e);o=o-t|0;n=o>>>0<n>>>0?o:n;if(A)e=s[e>>2]|0;o=n>>>0>a>>>0;e=Bv(e+t|0,i,o?a:n)|0;if(!e)return(n>>>0<a>>>0?-1:o&1)|0;else return e|0;return 0}function Mv(e){e=e|0;return}function kv(e){e=e|0;ep(e);return}function Ev(e){e=e|0;return 21228}function Fv(e,t,n){e=e|0;t=t|0;n=n|0;s[e>>2]=n;s[e+4>>2]=t;return}function xv(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0;i=J;J=J+16|0;r=i;zg[s[(s[e>>2]|0)+12>>2]&15](r,e,t);if((s[r+4>>2]|0)==(s[n+4>>2]|0))e=(s[r>>2]|0)==(s[n>>2]|0);else e=0;J=i;return e|0}function Uv(e,t,n){e=e|0;t=t|0;n=n|0;return((s[t>>2]|0)==(n|0)?(s[t+4>>2]|0)==(e|0):0)|0}function Iv(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)>256)gv(e,21176,nt(21176)|0);else Tv(e,0,n);return}function Tv(e,t,n){e=e|0;t=t|0;n=n|0;Pv(e,n);return}function Pv(e,t){e=e|0;t=t|0;var n=0,i=0,a=0,o=0,A=0;A=J;J=J+1040|0;a=A+1024|0;n=A;o=s[(Wd()|0)>>2]|0;i=Sv(If(t,n,1024)|0,n)|0;if(!(r[i>>0]|0)){s[a>>2]=t;Bf(n,1024,21211,a)|0}else n=i;s[(Wd()|0)>>2]=o;gv(e,n,nt(n)|0);J=A;return}function Sv(e,t){e=e|0;t=t|0;var n=0,r=0;switch(e|0){case 0:{n=t;break}case-1:{e=s[(Wd()|0)>>2]|0;r=3;break}default:r=3}if((r|0)==3)if((e|0)==28)n=22145;else j();return n|0}function Dv(e){e=e|0;ep(e);return}function Qv(e){e=e|0;return 21353}function Rv(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)>256){Vv()|0;t=6180}else{Lv()|0;t=6176}s[e>>2]=n;s[e+4>>2]=t;return}function Ov(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)>256)gv(e,21319,nt(21319)|0);else Tv(e,0,n);return}function Vv(){if((r[21488]|0)==0?Qp(21488)|0:0)jp(21488);return 6180}function Lv(){if((r[21480]|0)==0?Qp(21480)|0:0)jp(21480);return 6176}function Hv(e){e=e|0;pp(e);return}function Nv(e){e=e|0;Hv(e);ep(e);return}function Gv(e,t){e=e|0;t=t|0;var n=0;n=s[t+4>>2]|0;zg[s[(s[n>>2]|0)+24>>2]&15](e,n,s[t>>2]|0);return}function jv(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0;o=J;J=J+16|0;a=o;if(s[t>>2]|0){i=r[n+11>>0]|0;if(i<<24>>24<0)i=s[n+4>>2]|0;else i=i&255;if(i|0)wv(n,21417)|0;Gv(a,t);t=r[a+11>>0]|0;i=t<<24>>24<0;bv(n,i?s[a>>2]|0:a,i?s[a+4>>2]|0:t&255)|0;yv(a)}s[e>>2]=s[n>>2];s[e+4>>2]=s[n+4>>2];s[e+8>>2]=s[n+8>>2];i=0;while(1){if((i|0)==3)break;s[n+(i<<2)>>2]=0;i=i+1|0}J=o;return}function Wv(e,t,n){e=e|0;t=t|0;n=n|0;var r=0,i=0,a=0;r=J;J=J+32|0;a=r+12|0;i=r;gv(i,n,nt(n)|0);jv(a,t,i);dv(e,a);yv(a);yv(i);s[e>>2]=6192;i=t;t=s[i+4>>2]|0;n=e+8|0;s[n>>2]=s[i>>2];s[n+4>>2]=t;J=r;return}function zv(e,t){e=e|0;t=t|0;var n=0,r=0,i=0;i=J;J=J+16|0;r=i+8|0;n=C(16)|0;Vv()|0;s[i>>2]=e;s[i+4>>2]=6180;s[r>>2]=s[i>>2];s[r+4>>2]=s[i+4>>2];Wv(n,r,t);k(n|0,4272,136)}function Xv(e){e=e|0;e=C(8)|0;hv(e,21420);s[e>>2]=5956;k(e|0,3928,123)}function Kv(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,v=0,g=0,m=0,y=0,_=0,b=0,w=0;w=J;J=J+16|0;d=w;do{if(e>>>0<245){l=e>>>0<11?16:e+11&-8;e=l>>>3;h=s[5412]|0;n=h>>>e;if(n&3|0){t=(n&1^1)+e|0;e=21688+(t<<1<<2)|0;n=e+8|0;r=s[n>>2]|0;i=r+8|0;a=s[i>>2]|0;if((a|0)==(e|0))s[5412]=h&~(1<<t);else{s[a+12>>2]=e;s[n>>2]=a}b=t<<3;s[r+4>>2]=b|3;b=r+b+4|0;s[b>>2]=s[b>>2]|1;b=i;J=w;return b|0}u=s[5414]|0;if(l>>>0>u>>>0){if(n|0){t=2<<e;t=n<<e&(t|0-t);t=(t&0-t)+-1|0;A=t>>>12&16;t=t>>>A;n=t>>>5&8;t=t>>>n;a=t>>>2&4;t=t>>>a;e=t>>>1&2;t=t>>>e;r=t>>>1&1;r=(n|A|a|e|r)+(t>>>r)|0;t=21688+(r<<1<<2)|0;e=t+8|0;a=s[e>>2]|0;A=a+8|0;n=s[A>>2]|0;if((n|0)==(t|0)){e=h&~(1<<r);s[5412]=e}else{s[n+12>>2]=t;s[e>>2]=n;e=h}b=r<<3;o=b-l|0;s[a+4>>2]=l|3;i=a+l|0;s[i+4>>2]=o|1;s[a+b>>2]=o;if(u|0){r=s[5417]|0;t=u>>>3;n=21688+(t<<1<<2)|0;t=1<<t;if(!(e&t)){s[5412]=e|t;t=n;e=n+8|0}else{e=n+8|0;t=s[e>>2]|0}s[e>>2]=r;s[t+12>>2]=r;s[r+8>>2]=t;s[r+12>>2]=n}s[5414]=o;s[5417]=i;b=A;J=w;return b|0}a=s[5413]|0;if(a){n=(a&0-a)+-1|0;i=n>>>12&16;n=n>>>i;r=n>>>5&8;n=n>>>r;o=n>>>2&4;n=n>>>o;A=n>>>1&2;n=n>>>A;c=n>>>1&1;c=s[21952+((r|i|o|A|c)+(n>>>c)<<2)>>2]|0;n=c;A=c;c=(s[c+4>>2]&-8)-l|0;while(1){e=s[n+16>>2]|0;if(!e){e=s[n+20>>2]|0;if(!e)break}o=(s[e+4>>2]&-8)-l|0;i=o>>>0<c>>>0;n=e;A=i?e:A;c=i?o:c}o=A+l|0;if(o>>>0>A>>>0){i=s[A+24>>2]|0;t=s[A+12>>2]|0;do{if((t|0)==(A|0)){e=A+20|0;t=s[e>>2]|0;if(!t){e=A+16|0;t=s[e>>2]|0;if(!t){n=0;break}}while(1){r=t+20|0;n=s[r>>2]|0;if(!n){r=t+16|0;n=s[r>>2]|0;if(!n)break;else{t=n;e=r}}else{t=n;e=r}}s[e>>2]=0;n=t}else{n=s[A+8>>2]|0;s[n+12>>2]=t;s[t+8>>2]=n;n=t}}while(0);do{if(i|0){t=s[A+28>>2]|0;e=21952+(t<<2)|0;if((A|0)==(s[e>>2]|0)){s[e>>2]=n;if(!n){s[5413]=a&~(1<<t);break}}else{b=i+16|0;s[((s[b>>2]|0)==(A|0)?b:i+20|0)>>2]=n;if(!n)break}s[n+24>>2]=i;t=s[A+16>>2]|0;if(t|0){s[n+16>>2]=t;s[t+24>>2]=n}t=s[A+20>>2]|0;if(t|0){s[n+20>>2]=t;s[t+24>>2]=n}}}while(0);if(c>>>0<16){b=c+l|0;s[A+4>>2]=b|3;b=A+b+4|0;s[b>>2]=s[b>>2]|1}else{s[A+4>>2]=l|3;s[o+4>>2]=c|1;s[o+c>>2]=c;if(u|0){r=s[5417]|0;t=u>>>3;n=21688+(t<<1<<2)|0;t=1<<t;if(!(t&h)){s[5412]=t|h;t=n;e=n+8|0}else{e=n+8|0;t=s[e>>2]|0}s[e>>2]=r;s[t+12>>2]=r;s[r+8>>2]=t;s[r+12>>2]=n}s[5414]=c;s[5417]=o}b=A+8|0;J=w;return b|0}else h=l}else h=l}else h=l}else if(e>>>0<=4294967231){e=e+11|0;l=e&-8;r=s[5413]|0;if(r){i=0-l|0;e=e>>>8;if(e){if(l>>>0>16777215)c=31;else{h=(e+1048320|0)>>>16&8;v=e<<h;A=(v+520192|0)>>>16&4;v=v<<A;c=(v+245760|0)>>>16&2;c=14-(A|h|c)+(v<<c>>>15)|0;c=l>>>(c+7|0)&1|c<<1}}else c=0;n=s[21952+(c<<2)>>2]|0;e:do{if(!n){n=0;e=0;v=61}else{e=0;A=l<<((c|0)==31?0:25-(c>>>1)|0);a=0;while(1){o=(s[n+4>>2]&-8)-l|0;if(o>>>0<i>>>0)if(!o){e=n;i=0;v=65;break e}else{e=n;i=o}v=s[n+20>>2]|0;n=s[n+16+(A>>>31<<2)>>2]|0;a=(v|0)==0|(v|0)==(n|0)?a:v;if(!n){n=a;v=61;break}else A=A<<1}}}while(0);if((v|0)==61){if((n|0)==0&(e|0)==0){e=2<<c;e=(e|0-e)&r;if(!e){h=l;break}h=(e&0-e)+-1|0;o=h>>>12&16;h=h>>>o;a=h>>>5&8;h=h>>>a;A=h>>>2&4;h=h>>>A;c=h>>>1&2;h=h>>>c;n=h>>>1&1;e=0;n=s[21952+((a|o|A|c|n)+(h>>>n)<<2)>>2]|0}if(!n){A=e;o=i}else v=65}if((v|0)==65){a=n;while(1){h=(s[a+4>>2]&-8)-l|0;n=h>>>0<i>>>0;i=n?h:i;e=n?a:e;n=s[a+16>>2]|0;if(!n)n=s[a+20>>2]|0;if(!n){A=e;o=i;break}else a=n}}if(((A|0)!=0?o>>>0<((s[5414]|0)-l|0)>>>0:0)?(u=A+l|0,u>>>0>A>>>0):0){a=s[A+24>>2]|0;t=s[A+12>>2]|0;do{if((t|0)==(A|0)){e=A+20|0;t=s[e>>2]|0;if(!t){e=A+16|0;t=s[e>>2]|0;if(!t){t=0;break}}while(1){i=t+20|0;n=s[i>>2]|0;if(!n){i=t+16|0;n=s[i>>2]|0;if(!n)break;else{t=n;e=i}}else{t=n;e=i}}s[e>>2]=0}else{b=s[A+8>>2]|0;s[b+12>>2]=t;s[t+8>>2]=b}}while(0);do{if(a){e=s[A+28>>2]|0;n=21952+(e<<2)|0;if((A|0)==(s[n>>2]|0)){s[n>>2]=t;if(!t){r=r&~(1<<e);s[5413]=r;break}}else{b=a+16|0;s[((s[b>>2]|0)==(A|0)?b:a+20|0)>>2]=t;if(!t)break}s[t+24>>2]=a;e=s[A+16>>2]|0;if(e|0){s[t+16>>2]=e;s[e+24>>2]=t}e=s[A+20>>2]|0;if(e){s[t+20>>2]=e;s[e+24>>2]=t}}}while(0);e:do{if(o>>>0<16){b=o+l|0;s[A+4>>2]=b|3;b=A+b+4|0;s[b>>2]=s[b>>2]|1}else{s[A+4>>2]=l|3;s[u+4>>2]=o|1;s[u+o>>2]=o;t=o>>>3;if(o>>>0<256){n=21688+(t<<1<<2)|0;e=s[5412]|0;t=1<<t;if(!(e&t)){s[5412]=e|t;t=n;e=n+8|0}else{e=n+8|0;t=s[e>>2]|0}s[e>>2]=u;s[t+12>>2]=u;s[u+8>>2]=t;s[u+12>>2]=n;break}t=o>>>8;if(t){if(o>>>0>16777215)n=31;else{_=(t+1048320|0)>>>16&8;b=t<<_;y=(b+520192|0)>>>16&4;b=b<<y;n=(b+245760|0)>>>16&2;n=14-(y|_|n)+(b<<n>>>15)|0;n=o>>>(n+7|0)&1|n<<1}}else n=0;t=21952+(n<<2)|0;s[u+28>>2]=n;e=u+16|0;s[e+4>>2]=0;s[e>>2]=0;e=1<<n;if(!(r&e)){s[5413]=r|e;s[t>>2]=u;s[u+24>>2]=t;s[u+12>>2]=u;s[u+8>>2]=u;break}t=s[t>>2]|0;t:do{if((s[t+4>>2]&-8|0)!=(o|0)){r=o<<((n|0)==31?0:25-(n>>>1)|0);while(1){n=t+16+(r>>>31<<2)|0;e=s[n>>2]|0;if(!e)break;if((s[e+4>>2]&-8|0)==(o|0)){t=e;break t}else{r=r<<1;t=e}}s[n>>2]=u;s[u+24>>2]=t;s[u+12>>2]=u;s[u+8>>2]=u;break e}}while(0);_=t+8|0;b=s[_>>2]|0;s[b+12>>2]=u;s[_>>2]=u;s[u+8>>2]=b;s[u+12>>2]=t;s[u+24>>2]=0}}while(0);b=A+8|0;J=w;return b|0}else h=l}else h=l}else h=-1}while(0);n=s[5414]|0;if(n>>>0>=h>>>0){t=n-h|0;e=s[5417]|0;if(t>>>0>15){b=e+h|0;s[5417]=b;s[5414]=t;s[b+4>>2]=t|1;s[e+n>>2]=t;s[e+4>>2]=h|3}else{s[5414]=0;s[5417]=0;s[e+4>>2]=n|3;b=e+n+4|0;s[b>>2]=s[b>>2]|1}b=e+8|0;J=w;return b|0}o=s[5415]|0;if(o>>>0>h>>>0){y=o-h|0;s[5415]=y;b=s[5418]|0;_=b+h|0;s[5418]=_;s[_+4>>2]=y|1;s[b+4>>2]=h|3;b=b+8|0;J=w;return b|0}if(!(s[5530]|0)){s[5532]=4096;s[5531]=4096;s[5533]=-1;s[5534]=-1;s[5535]=0;s[5523]=0;s[5530]=d&-16^1431655768;e=4096}else e=s[5532]|0;A=h+48|0;c=h+47|0;a=e+c|0;i=0-e|0;l=a&i;if(l>>>0<=h>>>0){b=0;J=w;return b|0}e=s[5522]|0;if(e|0?(u=s[5520]|0,d=u+l|0,d>>>0<=u>>>0|d>>>0>e>>>0):0){b=0;J=w;return b|0}e:do{if(!(s[5523]&4)){n=s[5418]|0;t:do{if(n){r=22096;while(1){d=s[r>>2]|0;if(d>>>0<=n>>>0?(d+(s[r+4>>2]|0)|0)>>>0>n>>>0:0)break;e=s[r+8>>2]|0;if(!e){v=128;break t}else r=e}t=a-o&i;if(t>>>0<2147483647){e=Jv(t)|0;if((e|0)==((s[r>>2]|0)+(s[r+4>>2]|0)|0)){if((e|0)!=(-1|0)){o=t;a=e;v=145;break e}}else{r=e;v=136}}else t=0}else v=128}while(0);do{if((v|0)==128){n=Jv(0)|0;if((n|0)!=(-1|0)?(t=n,f=s[5531]|0,p=f+-1|0,t=((p&t|0)==0?0:(p+t&0-f)-t|0)+l|0,f=s[5520]|0,p=t+f|0,t>>>0>h>>>0&t>>>0<2147483647):0){d=s[5522]|0;if(d|0?p>>>0<=f>>>0|p>>>0>d>>>0:0){t=0;break}e=Jv(t)|0;if((e|0)==(n|0)){o=t;a=n;v=145;break e}else{r=e;v=136}}else t=0}}while(0);do{if((v|0)==136){n=0-t|0;if(!(A>>>0>t>>>0&(t>>>0<2147483647&(r|0)!=(-1|0))))if((r|0)==(-1|0)){t=0;break}else{o=t;a=r;v=145;break e}e=s[5532]|0;e=c-t+e&0-e;if(e>>>0>=2147483647){o=t;a=r;v=145;break e}if((Jv(e)|0)==(-1|0)){Jv(n)|0;t=0;break}else{o=e+t|0;a=r;v=145;break e}}}while(0);s[5523]=s[5523]|4;v=143}else{t=0;v=143}}while(0);if(((v|0)==143?l>>>0<2147483647:0)?(y=Jv(l)|0,p=Jv(0)|0,g=p-y|0,m=g>>>0>(h+40|0)>>>0,!((y|0)==(-1|0)|m^1|y>>>0<p>>>0&((y|0)!=(-1|0)&(p|0)!=(-1|0))^1)):0){o=m?g:t;a=y;v=145}if((v|0)==145){t=(s[5520]|0)+o|0;s[5520]=t;if(t>>>0>(s[5521]|0)>>>0)s[5521]=t;c=s[5418]|0;e:do{if(c){t=22096;while(1){e=s[t>>2]|0;n=s[t+4>>2]|0;if((a|0)==(e+n|0)){v=154;break}r=s[t+8>>2]|0;if(!r)break;else t=r}if(((v|0)==154?(_=t+4|0,(s[t+12>>2]&8|0)==0):0)?a>>>0>c>>>0&e>>>0<=c>>>0:0){s[_>>2]=n+o;b=(s[5415]|0)+o|0;y=c+8|0;y=(y&7|0)==0?0:0-y&7;_=c+y|0;y=b-y|0;s[5418]=_;s[5415]=y;s[_+4>>2]=y|1;s[c+b+4>>2]=40;s[5419]=s[5534];break}if(a>>>0<(s[5416]|0)>>>0)s[5416]=a;n=a+o|0;t=22096;while(1){if((s[t>>2]|0)==(n|0)){v=162;break}e=s[t+8>>2]|0;if(!e)break;else t=e}if((v|0)==162?(s[t+12>>2]&8|0)==0:0){s[t>>2]=a;u=t+4|0;s[u>>2]=(s[u>>2]|0)+o;u=a+8|0;u=a+((u&7|0)==0?0:0-u&7)|0;t=n+8|0;t=n+((t&7|0)==0?0:0-t&7)|0;l=u+h|0;A=t-u-h|0;s[u+4>>2]=h|3;t:do{if((c|0)==(t|0)){b=(s[5415]|0)+A|0;s[5415]=b;s[5418]=l;s[l+4>>2]=b|1}else{if((s[5417]|0)==(t|0)){b=(s[5414]|0)+A|0;s[5414]=b;s[5417]=l;s[l+4>>2]=b|1;s[l+b>>2]=b;break}e=s[t+4>>2]|0;if((e&3|0)==1){o=e&-8;r=e>>>3;n:do{if(e>>>0<256){e=s[t+8>>2]|0;n=s[t+12>>2]|0;if((n|0)==(e|0)){s[5412]=s[5412]&~(1<<r);break}else{s[e+12>>2]=n;s[n+8>>2]=e;break}}else{a=s[t+24>>2]|0;e=s[t+12>>2]|0;do{if((e|0)==(t|0)){n=t+16|0;r=n+4|0;e=s[r>>2]|0;if(!e){e=s[n>>2]|0;if(!e){e=0;break}}else n=r;while(1){i=e+20|0;r=s[i>>2]|0;if(!r){i=e+16|0;r=s[i>>2]|0;if(!r)break;else{e=r;n=i}}else{e=r;n=i}}s[n>>2]=0}else{b=s[t+8>>2]|0;s[b+12>>2]=e;s[e+8>>2]=b}}while(0);if(!a)break;n=s[t+28>>2]|0;r=21952+(n<<2)|0;do{if((s[r>>2]|0)!=(t|0)){b=a+16|0;s[((s[b>>2]|0)==(t|0)?b:a+20|0)>>2]=e;if(!e)break n}else{s[r>>2]=e;if(e|0)break;s[5413]=s[5413]&~(1<<n);break n}}while(0);s[e+24>>2]=a;n=t+16|0;r=s[n>>2]|0;if(r|0){s[e+16>>2]=r;s[r+24>>2]=e}n=s[n+4>>2]|0;if(!n)break;s[e+20>>2]=n;s[n+24>>2]=e}}while(0);t=t+o|0;i=o+A|0}else i=A;t=t+4|0;s[t>>2]=s[t>>2]&-2;s[l+4>>2]=i|1;s[l+i>>2]=i;t=i>>>3;if(i>>>0<256){n=21688+(t<<1<<2)|0;e=s[5412]|0;t=1<<t;if(!(e&t)){s[5412]=e|t;t=n;e=n+8|0}else{e=n+8|0;t=s[e>>2]|0}s[e>>2]=l;s[t+12>>2]=l;s[l+8>>2]=t;s[l+12>>2]=n;break}t=i>>>8;do{if(!t)r=0;else{if(i>>>0>16777215){r=31;break}_=(t+1048320|0)>>>16&8;b=t<<_;y=(b+520192|0)>>>16&4;b=b<<y;r=(b+245760|0)>>>16&2;r=14-(y|_|r)+(b<<r>>>15)|0;r=i>>>(r+7|0)&1|r<<1}}while(0);t=21952+(r<<2)|0;s[l+28>>2]=r;e=l+16|0;s[e+4>>2]=0;s[e>>2]=0;e=s[5413]|0;n=1<<r;if(!(e&n)){s[5413]=e|n;s[t>>2]=l;s[l+24>>2]=t;s[l+12>>2]=l;s[l+8>>2]=l;break}t=s[t>>2]|0;n:do{if((s[t+4>>2]&-8|0)!=(i|0)){r=i<<((r|0)==31?0:25-(r>>>1)|0);while(1){n=t+16+(r>>>31<<2)|0;e=s[n>>2]|0;if(!e)break;if((s[e+4>>2]&-8|0)==(i|0)){t=e;break n}else{r=r<<1;t=e}}s[n>>2]=l;s[l+24>>2]=t;s[l+12>>2]=l;s[l+8>>2]=l;break t}}while(0);_=t+8|0;b=s[_>>2]|0;s[b+12>>2]=l;s[_>>2]=l;s[l+8>>2]=b;s[l+12>>2]=t;s[l+24>>2]=0}}while(0);b=u+8|0;J=w;return b|0}t=22096;while(1){e=s[t>>2]|0;if(e>>>0<=c>>>0?(b=e+(s[t+4>>2]|0)|0,b>>>0>c>>>0):0)break;t=s[t+8>>2]|0}i=b+-47|0;e=i+8|0;e=i+((e&7|0)==0?0:0-e&7)|0;i=c+16|0;e=e>>>0<i>>>0?c:e;t=e+8|0;n=o+-40|0;y=a+8|0;y=(y&7|0)==0?0:0-y&7;_=a+y|0;y=n-y|0;s[5418]=_;s[5415]=y;s[_+4>>2]=y|1;s[a+n+4>>2]=40;s[5419]=s[5534];n=e+4|0;s[n>>2]=27;s[t>>2]=s[5524];s[t+4>>2]=s[5525];s[t+8>>2]=s[5526];s[t+12>>2]=s[5527];s[5524]=a;s[5525]=o;s[5527]=0;s[5526]=t;t=e+24|0;do{_=t;t=t+4|0;s[t>>2]=7}while((_+8|0)>>>0<b>>>0);if((e|0)!=(c|0)){a=e-c|0;s[n>>2]=s[n>>2]&-2;s[c+4>>2]=a|1;s[e>>2]=a;t=a>>>3;if(a>>>0<256){n=21688+(t<<1<<2)|0;e=s[5412]|0;t=1<<t;if(!(e&t)){s[5412]=e|t;t=n;e=n+8|0}else{e=n+8|0;t=s[e>>2]|0}s[e>>2]=c;s[t+12>>2]=c;s[c+8>>2]=t;s[c+12>>2]=n;break}t=a>>>8;if(t){if(a>>>0>16777215)r=31;else{_=(t+1048320|0)>>>16&8;b=t<<_;y=(b+520192|0)>>>16&4;b=b<<y;r=(b+245760|0)>>>16&2;r=14-(y|_|r)+(b<<r>>>15)|0;r=a>>>(r+7|0)&1|r<<1}}else r=0;n=21952+(r<<2)|0;s[c+28>>2]=r;s[c+20>>2]=0;s[i>>2]=0;t=s[5413]|0;e=1<<r;if(!(t&e)){s[5413]=t|e;s[n>>2]=c;s[c+24>>2]=n;s[c+12>>2]=c;s[c+8>>2]=c;break}t=s[n>>2]|0;t:do{if((s[t+4>>2]&-8|0)!=(a|0)){r=a<<((r|0)==31?0:25-(r>>>1)|0);while(1){n=t+16+(r>>>31<<2)|0;e=s[n>>2]|0;if(!e)break;if((s[e+4>>2]&-8|0)==(a|0)){t=e;break t}else{r=r<<1;t=e}}s[n>>2]=c;s[c+24>>2]=t;s[c+12>>2]=c;s[c+8>>2]=c;break e}}while(0);_=t+8|0;b=s[_>>2]|0;s[b+12>>2]=c;s[_>>2]=c;s[c+8>>2]=b;s[c+12>>2]=t;s[c+24>>2]=0}}else{b=s[5416]|0;if((b|0)==0|a>>>0<b>>>0)s[5416]=a;s[5524]=a;s[5525]=o;s[5527]=0;s[5421]=s[5530];s[5420]=-1;s[5425]=21688;s[5424]=21688;s[5427]=21696;s[5426]=21696;s[5429]=21704;s[5428]=21704;s[5431]=21712;s[5430]=21712;s[5433]=21720;s[5432]=21720;s[5435]=21728;s[5434]=21728;s[5437]=21736;s[5436]=21736;s[5439]=21744;s[5438]=21744;s[5441]=21752;s[5440]=21752;s[5443]=21760;s[5442]=21760;s[5445]=21768;s[5444]=21768;s[5447]=21776;s[5446]=21776;s[5449]=21784;s[5448]=21784;s[5451]=21792;s[5450]=21792;s[5453]=21800;s[5452]=21800;s[5455]=21808;s[5454]=21808;s[5457]=21816;s[5456]=21816;s[5459]=21824;s[5458]=21824;s[5461]=21832;s[5460]=21832;s[5463]=21840;s[5462]=21840;s[5465]=21848;s[5464]=21848;s[5467]=21856;s[5466]=21856;s[5469]=21864;s[5468]=21864;s[5471]=21872;s[5470]=21872;s[5473]=21880;s[5472]=21880;s[5475]=21888;s[5474]=21888;s[5477]=21896;s[5476]=21896;s[5479]=21904;s[5478]=21904;s[5481]=21912;s[5480]=21912;s[5483]=21920;s[5482]=21920;s[5485]=21928;s[5484]=21928;s[5487]=21936;s[5486]=21936;b=o+-40|0;y=a+8|0;y=(y&7|0)==0?0:0-y&7;_=a+y|0;y=b-y|0;s[5418]=_;s[5415]=y;s[_+4>>2]=y|1;s[a+b+4>>2]=40;s[5419]=s[5534]}}while(0);t=s[5415]|0;if(t>>>0>h>>>0){y=t-h|0;s[5415]=y;b=s[5418]|0;_=b+h|0;s[5418]=_;s[_+4>>2]=y|1;s[b+4>>2]=h|3;b=b+8|0;J=w;return b|0}}s[(Wd()|0)>>2]=48;b=0;J=w;return b|0}function Zv(e){e=e|0;var t=0,n=0,r=0,i=0,a=0,o=0,A=0,c=0;if(!e)return;n=e+-8|0;i=s[5416]|0;e=s[e+-4>>2]|0;t=e&-8;c=n+t|0;do{if(!(e&1)){r=s[n>>2]|0;if(!(e&3))return;o=n+(0-r)|0;a=r+t|0;if(o>>>0<i>>>0)return;if((s[5417]|0)==(o|0)){e=c+4|0;t=s[e>>2]|0;if((t&3|0)!=3){A=o;t=a;break}s[5414]=a;s[e>>2]=t&-2;s[o+4>>2]=a|1;s[o+a>>2]=a;return}n=r>>>3;if(r>>>0<256){e=s[o+8>>2]|0;t=s[o+12>>2]|0;if((t|0)==(e|0)){s[5412]=s[5412]&~(1<<n);A=o;t=a;break}else{s[e+12>>2]=t;s[t+8>>2]=e;A=o;t=a;break}}i=s[o+24>>2]|0;e=s[o+12>>2]|0;do{if((e|0)==(o|0)){t=o+16|0;n=t+4|0;e=s[n>>2]|0;if(!e){e=s[t>>2]|0;if(!e){e=0;break}}else t=n;while(1){r=e+20|0;n=s[r>>2]|0;if(!n){r=e+16|0;n=s[r>>2]|0;if(!n)break;else{e=n;t=r}}else{e=n;t=r}}s[t>>2]=0}else{A=s[o+8>>2]|0;s[A+12>>2]=e;s[e+8>>2]=A}}while(0);if(i){t=s[o+28>>2]|0;n=21952+(t<<2)|0;if((s[n>>2]|0)==(o|0)){s[n>>2]=e;if(!e){s[5413]=s[5413]&~(1<<t);A=o;t=a;break}}else{A=i+16|0;s[((s[A>>2]|0)==(o|0)?A:i+20|0)>>2]=e;if(!e){A=o;t=a;break}}s[e+24>>2]=i;t=o+16|0;n=s[t>>2]|0;if(n|0){s[e+16>>2]=n;s[n+24>>2]=e}t=s[t+4>>2]|0;if(t){s[e+20>>2]=t;s[t+24>>2]=e;A=o;t=a}else{A=o;t=a}}else{A=o;t=a}}else{A=n;o=n}}while(0);if(o>>>0>=c>>>0)return;e=c+4|0;r=s[e>>2]|0;if(!(r&1))return;if(!(r&2)){if((s[5418]|0)==(c|0)){c=(s[5415]|0)+t|0;s[5415]=c;s[5418]=A;s[A+4>>2]=c|1;if((A|0)!=(s[5417]|0))return;s[5417]=0;s[5414]=0;return}if((s[5417]|0)==(c|0)){c=(s[5414]|0)+t|0;s[5414]=c;s[5417]=o;s[A+4>>2]=c|1;s[o+c>>2]=c;return}i=(r&-8)+t|0;n=r>>>3;do{if(r>>>0<256){t=s[c+8>>2]|0;e=s[c+12>>2]|0;if((e|0)==(t|0)){s[5412]=s[5412]&~(1<<n);break}else{s[t+12>>2]=e;s[e+8>>2]=t;break}}else{a=s[c+24>>2]|0;e=s[c+12>>2]|0;do{if((e|0)==(c|0)){t=c+16|0;n=t+4|0;e=s[n>>2]|0;if(!e){e=s[t>>2]|0;if(!e){n=0;break}}else t=n;while(1){r=e+20|0;n=s[r>>2]|0;if(!n){r=e+16|0;n=s[r>>2]|0;if(!n)break;else{e=n;t=r}}else{e=n;t=r}}s[t>>2]=0;n=e}else{n=s[c+8>>2]|0;s[n+12>>2]=e;s[e+8>>2]=n;n=e}}while(0);if(a|0){e=s[c+28>>2]|0;t=21952+(e<<2)|0;if((s[t>>2]|0)==(c|0)){s[t>>2]=n;if(!n){s[5413]=s[5413]&~(1<<e);break}}else{r=a+16|0;s[((s[r>>2]|0)==(c|0)?r:a+20|0)>>2]=n;if(!n)break}s[n+24>>2]=a;e=c+16|0;t=s[e>>2]|0;if(t|0){s[n+16>>2]=t;s[t+24>>2]=n}e=s[e+4>>2]|0;if(e|0){s[n+20>>2]=e;s[e+24>>2]=n}}}}while(0);s[A+4>>2]=i|1;s[o+i>>2]=i;if((A|0)==(s[5417]|0)){s[5414]=i;return}}else{s[e>>2]=r&-2;s[A+4>>2]=t|1;s[o+t>>2]=t;i=t}e=i>>>3;if(i>>>0<256){n=21688+(e<<1<<2)|0;t=s[5412]|0;e=1<<e;if(!(t&e)){s[5412]=t|e;e=n;t=n+8|0}else{t=n+8|0;e=s[t>>2]|0}s[t>>2]=A;s[e+12>>2]=A;s[A+8>>2]=e;s[A+12>>2]=n;return}e=i>>>8;if(e){if(i>>>0>16777215)r=31;else{o=(e+1048320|0)>>>16&8;c=e<<o;a=(c+520192|0)>>>16&4;c=c<<a;r=(c+245760|0)>>>16&2;r=14-(a|o|r)+(c<<r>>>15)|0;r=i>>>(r+7|0)&1|r<<1}}else r=0;e=21952+(r<<2)|0;s[A+28>>2]=r;s[A+20>>2]=0;s[A+16>>2]=0;t=s[5413]|0;n=1<<r;e:do{if(!(t&n)){s[5413]=t|n;s[e>>2]=A;s[A+24>>2]=e;s[A+12>>2]=A;s[A+8>>2]=A}else{e=s[e>>2]|0;t:do{if((s[e+4>>2]&-8|0)!=(i|0)){r=i<<((r|0)==31?0:25-(r>>>1)|0);while(1){n=e+16+(r>>>31<<2)|0;t=s[n>>2]|0;if(!t)break;if((s[t+4>>2]&-8|0)==(i|0)){e=t;break t}else{r=r<<1;e=t}}s[n>>2]=A;s[A+24>>2]=e;s[A+12>>2]=A;s[A+8>>2]=A;break e}}while(0);o=e+8|0;c=s[o>>2]|0;s[c+12>>2]=A;s[o>>2]=A;s[A+8>>2]=c;s[A+12>>2]=e;s[A+24>>2]=0}}while(0);c=(s[5420]|0)+-1|0;s[5420]=c;if(c|0)return;e=22104;while(1){e=s[e>>2]|0;if(!e)break;else e=e+8|0}s[5420]=-1;return}function Jv(e){e=e|0;var t=0,n=0,r=0;r=e+3&-4;e=cg()|0;t=s[e>>2]|0;n=t+r|0;do{if((r|0)<1|n>>>0>t>>>0){if(n>>>0>(z()|0)>>>0?(K(n|0)|0)==0:0)break;s[e>>2]=n;r=t;return r|0}}while(0);s[(Wd()|0)>>2]=48;r=-1;return r|0}function Yv(e){e=e|0;var t=0;t=J;J=J+e|0;J=J+15&-16;return t|0}function qv(e){e=e|0;J=e}function $v(){return J|0}function eg(e,t){e=e|0;t=t|0;var n=0,r=0,i=0,s=0;s=e&65535;i=t&65535;n=y(i,s)|0;r=e>>>16;e=(n>>>16)+(y(i,r)|0)|0;i=t>>>16;t=y(i,s)|0;return(w((e>>>16)+(y(i,r)|0)+(((e&65535)+t|0)>>>16)|0),e+t<<16|n&65535|0)|0}function tg(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;var i=0,s=0;i=e;s=n;n=eg(i,s)|0;e=B()|0;return(w((y(t,s)|0)+(y(r,i)|0)+e|e&0|0),n|0|0)|0}function ng(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;n=e+n>>>0;return(w(t+r+(n>>>0<e>>>0|0)>>>0|0),n|0)|0}function rg(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;r=t-r-(n>>>0>e>>>0|0)>>>0;return(w(r|0),e-n>>>0|0)|0}function ig(e){e=e|0;return(e?31-(_(e^e-1)|0)|0:32)|0}function sg(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;var a=0,o=0,A=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0;u=e;c=t;l=c;o=n;d=r;A=d;if(!l){a=(i|0)!=0;if(!A){if(a){s[i>>2]=(u>>>0)%(o>>>0);s[i+4>>2]=0}d=0;i=(u>>>0)/(o>>>0)>>>0;return(w(d|0),i)|0}else{if(!a){d=0;i=0;return(w(d|0),i)|0}s[i>>2]=e|0;s[i+4>>2]=t&0;d=0;i=0;return(w(d|0),i)|0}}a=(A|0)==0;do{if(o){if(!a){a=(_(A|0)|0)-(_(l|0)|0)|0;if(a>>>0<=31){h=a+1|0;A=31-a|0;t=a-31>>31;o=h;e=u>>>(h>>>0)&t|l<<A;t=l>>>(h>>>0)&t;a=0;A=u<<A;break}if(!i){d=0;i=0;return(w(d|0),i)|0}s[i>>2]=e|0;s[i+4>>2]=c|t&0;d=0;i=0;return(w(d|0),i)|0}a=o-1|0;if(a&o|0){A=(_(o|0)|0)+33-(_(l|0)|0)|0;p=64-A|0;h=32-A|0;c=h>>31;f=A-32|0;t=f>>31;o=A;e=h-1>>31&l>>>(f>>>0)|(l<<h|u>>>(A>>>0))&t;t=t&l>>>(A>>>0);a=u<<p&c;A=(l<<p|u>>>(f>>>0))&c|u<<h&A-33>>31;break}if(i|0){s[i>>2]=a&u;s[i+4>>2]=0}if((o|0)==1){f=c|t&0;p=e|0|0;return(w(f|0),p)|0}else{p=ig(o|0)|0;f=l>>>(p>>>0)|0;p=l<<32-p|u>>>(p>>>0)|0;return(w(f|0),p)|0}}else{if(a){if(i|0){s[i>>2]=(l>>>0)%(o>>>0);s[i+4>>2]=0}f=0;p=(l>>>0)/(o>>>0)>>>0;return(w(f|0),p)|0}if(!u){if(i|0){s[i>>2]=0;s[i+4>>2]=(l>>>0)%(A>>>0)}f=0;p=(l>>>0)/(A>>>0)>>>0;return(w(f|0),p)|0}a=A-1|0;if(!(a&A)){if(i|0){s[i>>2]=e|0;s[i+4>>2]=a&l|t&0}f=0;p=l>>>((ig(A|0)|0)>>>0);return(w(f|0),p)|0}a=(_(A|0)|0)-(_(l|0)|0)|0;if(a>>>0<=30){t=a+1|0;A=31-a|0;o=t;e=l<<A|u>>>(t>>>0);t=l>>>(t>>>0);a=0;A=u<<A;break}if(!i){f=0;p=0;return(w(f|0),p)|0}s[i>>2]=e|0;s[i+4>>2]=c|t&0;f=0;p=0;return(w(f|0),p)|0}}while(0);if(!o){l=A;c=0;A=0}else{h=n|0|0;u=d|r&0;l=ng(h|0,u|0,-1,-1)|0;n=B()|0;c=A;A=0;do{r=c;c=a>>>31|c<<1;a=A|a<<1;r=e<<1|r>>>31|0;d=e>>>31|t<<1|0;rg(l|0,n|0,r|0,d|0)|0;p=B()|0;f=p>>31|((p|0)<0?-1:0)<<1;A=f&1;e=rg(r|0,d|0,f&h|0,(((p|0)<0?-1:0)>>31|((p|0)<0?-1:0)<<1)&u|0)|0;t=B()|0;o=o-1|0}while((o|0)!=0);l=c;c=0}o=0;if(i|0){s[i>>2]=e;s[i+4>>2]=t}f=(a|0)>>>31|(l|o)<<1|(o<<1|a>>>31)&0|c;p=(a<<1|0>>>31)&-2|A;return(w(f|0),p)|0}function ag(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;return sg(e,t,n,r,0)|0}function og(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)<32){w(t>>>n|0);return e>>>n|(t&(1<<n)-1)<<32-n}w(0);return t>>>n-32|0}function Ag(e,t,n){e=e|0;t=t|0;n=n|0;if((n|0)<32){w(t<<n|(e&(1<<n)-1<<32-n)>>>32-n|0);return e<<n}w(e<<n-32|0);return 0}function cg(){return 22176}function lg(e){e=e|0;return(e&255)<<24|(e>>8&255)<<16|(e>>16&255)<<8|e>>>24|0}function ug(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0;if((n|0)>=512){X(e|0,t|0,n|0)|0;return e|0}o=e|0;a=e+n|0;if((e&3)==(t&3)){while(e&3){if(!n)return o|0;r[e>>0]=r[t>>0]|0;e=e+1|0;t=t+1|0;n=n-1|0}n=a&-4|0;i=n-64|0;while((e|0)<=(i|0)){s[e>>2]=s[t>>2];s[e+4>>2]=s[t+4>>2];s[e+8>>2]=s[t+8>>2];s[e+12>>2]=s[t+12>>2];s[e+16>>2]=s[t+16>>2];s[e+20>>2]=s[t+20>>2];s[e+24>>2]=s[t+24>>2];s[e+28>>2]=s[t+28>>2];s[e+32>>2]=s[t+32>>2];s[e+36>>2]=s[t+36>>2];s[e+40>>2]=s[t+40>>2];s[e+44>>2]=s[t+44>>2];s[e+48>>2]=s[t+48>>2];s[e+52>>2]=s[t+52>>2];s[e+56>>2]=s[t+56>>2];s[e+60>>2]=s[t+60>>2];e=e+64|0;t=t+64|0}while((e|0)<(n|0)){s[e>>2]=s[t>>2];e=e+4|0;t=t+4|0}}else{n=a-4|0;while((e|0)<(n|0)){r[e>>0]=r[t>>0]|0;r[e+1>>0]=r[t+1>>0]|0;r[e+2>>0]=r[t+2>>0]|0;r[e+3>>0]=r[t+3>>0]|0;e=e+4|0;t=t+4|0}}while((e|0)<(a|0)){r[e>>0]=r[t>>0]|0;e=e+1|0;t=t+1|0}return o|0}function hg(e,t,n){e=e|0;t=t|0;n=n|0;var i=0;if((t|0)<(e|0)&(e|0)<(t+n|0)){i=e;t=t+n|0;e=e+n|0;while((n|0)>0){e=e-1|0;t=t-1|0;n=n-1|0;r[e>>0]=r[t>>0]|0}e=i}else ug(e,t,n)|0;return e|0}function dg(e,t,n){e=e|0;t=t|0;n=n|0;var i=0,a=0,o=0,A=0;o=e+n|0;t=t&255;if((n|0)>=67){while(e&3){r[e>>0]=t;e=e+1|0}i=o&-4|0;A=t|t<<8|t<<16|t<<24;a=i-64|0;while((e|0)<=(a|0)){s[e>>2]=A;s[e+4>>2]=A;s[e+8>>2]=A;s[e+12>>2]=A;s[e+16>>2]=A;s[e+20>>2]=A;s[e+24>>2]=A;s[e+28>>2]=A;s[e+32>>2]=A;s[e+36>>2]=A;s[e+40>>2]=A;s[e+44>>2]=A;s[e+48>>2]=A;s[e+52>>2]=A;s[e+56>>2]=A;s[e+60>>2]=A;e=e+64|0}while((e|0)<(i|0)){s[e>>2]=A;e=e+4|0}}while((e|0)<(o|0)){r[e>>0]=t;e=e+1|0}return o-n|0}function fg(e){e=e|0;return Og[e&3]()|0}function pg(e,t){e=e|0;t=t|0;return Vg[e&15](t|0)|0}function vg(e,t,n,r,i,s,a){e=e|0;t=t|0;n=+n;r=r|0;i=i|0;s=s|0;a=a|0;return Lg[e&1](t|0,+n,r|0,i|0,s|0,a|0)|0}function gg(e,t,n){e=e|0;t=t|0;n=n|0;return Hg[e&63](t|0,n|0)|0}function mg(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;return Ng[e&7](t|0,n|0,r|0)|0}function yg(e){e=e|0;Gg[e&3]()}function _g(e,t){e=e|0;t=t|0;jg[e&255](t|0)}function bg(e,t,n){e=e|0;t=t|0;n=n|0;Wg[e&15](t|0,n|0)}function wg(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;zg[e&15](t|0,n|0,r|0)}function Bg(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;Xg[e&7](t|0,n|0,r|0,i|0)}function Cg(e,t,n,r,i,s){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;s=s|0;Kg[e&3](t|0,n|0,r|0,i|0,s|0)}function Mg(e,t,n,r,i,s,a){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;s=s|0;a=a|0;Zg[e&3](t|0,n|0,r|0,i|0,s|0,a|0)}function kg(){b(0);return 0}function Eg(e){e=e|0;b(1);return 0}function Fg(e,t,n,r,i,s){e=e|0;t=+t;n=n|0;r=r|0;i=i|0;s=s|0;b(2);return 0}function xg(e,t){e=e|0;t=t|0;b(3);return 0}function Ug(e,t,n){e=e|0;t=t|0;n=n|0;b(4);return 0}function Ig(){b(5)}function Tg(e){e=e|0;b(6)}function Pg(e,t){e=e|0;t=t|0;b(7)}function Sg(e,t,n){e=e|0;t=t|0;n=n|0;b(8)}function Dg(e,t,n,r){e=e|0;t=t|0;n=n|0;r=r|0;b(9)}function Qg(e,t,n,r,i){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;b(10)}function Rg(e,t,n,r,i,s){e=e|0;t=t|0;n=n|0;r=r|0;i=i|0;s=s|0;b(11)}var Og=[kg,Ul,Bu,kg];var Vg=[Eg,gp,vt,wt,op,lp,sv,Ev,Qv,fl,ie,uu,Tl,Mu,Eg,Eg];var Lg=[Fg,af];var Hg=[xg,me,Ee,bt,tr,Ir,Hr,ti,ni,si,ji,Yi,ps,ws,Is,Os,Ca,Pa,Na,Xa,no,oo,go,wo,Io,jo,Yo,nA,lA,yA,QA,GA,YA,ac,vc,Bc,Pc,Nc,Jc,rl,ul,ru,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg,xg];var Ng=[Ug,Mf,Hf,wp,Cp,xv,Uv,Ug];var Gg=[Ig,_p,Tf,Ig];var jg=[Tg,av,ve,ge,ye,Me,ke,Fe,pp,st,Bt,pt,mt,yt,Ft,xt,Lt,Ht,ln,un,hn,In,$n,er,nr,Er,Tr,Pr,Sr,Dr,Vr,Lr,Nr,$r,ei,ri,ii,Ni,Gi,Wi,Zi,Ji,ds,fs,vs,_s,bs,xs,Us,Ts,Qs,Rs,wa,Ba,Ma,Sa,Da,La,Ha,Ga,Ka,Za,eo,to,ro,Ao,co,po,vo,mo,Bo,Co,xo,Uo,To,No,Go,Wo,Zo,Jo,qo,rA,iA,AA,cA,uA,gA,mA,SA,DA,RA,HA,NA,ZA,JA,qA,ic,sc,fc,pc,gc,bc,wc,Ic,Tc,Sc,Lc,Hc,Kc,Zc,Yc,tl,nl,cl,ll,hl,Rf,Of,Vf,Lf,Jf,sp,ap,Ap,cp,vp,mp,yp,bp,Bp,Fp,rv,iv,Mv,kv,Dv,Hv,Nv,gl,fu,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg,Tg];var Wg=[Pg,gt,_t,re,ae,oe,Ae,ce,of,Pg,Pg,Pg,Pg,Pg,Pg,Pg];var zg=[Sg,Fv,Iv,Rv,Ov,ne,se,Zl,Vu,Wu,Sg,Sg,Sg,Sg,Sg,Sg];var Xg=[Dg,jf,$f,Ip,Vl,Tu,Dg,Dg];var Kg=[Qg,Gf,qf,Up];var Zg=[Rg,Nf,Yf,xp];return{__ZSt18uncaught_exceptionv:tv,___cxa_can_catch:qp,___cxa_is_pointer_type:$p,___embind_register_native_and_builtin_types:eh,___errno_location:Wd,___getTypeName:jd,___muldi3:tg,___udivdi3:ag,_bitshift64Lshr:og,_bitshift64Shl:Ag,_emscripten_get_sbrk_ptr:cg,_free:Zv,_i64Add:ng,_i64Subtract:rg,_llvm_bswap_i32:lg,_malloc:Kv,_memcpy:ug,_memmove:hg,_memset:dg,dynCall_i:fg,dynCall_ii:pg,dynCall_iidiiii:vg,dynCall_iii:gg,dynCall_iiii:mg,dynCall_v:yg,dynCall_vi:_g,dynCall_vii:bg,dynCall_viii:wg,dynCall_viiii:Bg,dynCall_viiiii:Cg,dynCall_viiiiii:Mg,globalCtors:$,stackAlloc:Yv,stackRestore:qv,stackSave:$v}}({Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Float32Array:Float32Array,Float64Array:Float64Array},ft,b),vt=t.__ZSt18uncaught_exceptionv=pt.__ZSt18uncaught_exceptionv;t.___cxa_can_catch=pt.___cxa_can_catch,t.___cxa_is_pointer_type=pt.___cxa_is_pointer_type,t.___embind_register_native_and_builtin_types=pt.___embind_register_native_and_builtin_types,t.___errno_location=pt.___errno_location;var gt=t.___getTypeName=pt.___getTypeName;t.___muldi3=pt.___muldi3,t.___udivdi3=pt.___udivdi3,t._bitshift64Lshr=pt._bitshift64Lshr,t._bitshift64Shl=pt._bitshift64Shl,t._emscripten_get_sbrk_ptr=pt._emscripten_get_sbrk_ptr;var mt=t._free=pt._free;t._i64Add=pt._i64Add,t._i64Subtract=pt._i64Subtract,t._llvm_bswap_i32=pt._llvm_bswap_i32;var yt=t._malloc=pt._malloc;t._memcpy=pt._memcpy,t._memmove=pt._memmove,t._memset=pt._memset;var _t,bt,wt=t.globalCtors=pt.globalCtors;if(t.stackAlloc=pt.stackAlloc,t.stackRestore=pt.stackRestore,t.stackSave=pt.stackSave,t.dynCall_i=pt.dynCall_i,t.dynCall_ii=pt.dynCall_ii,t.dynCall_iidiiii=pt.dynCall_iidiiii,t.dynCall_iii=pt.dynCall_iii,t.dynCall_iiii=pt.dynCall_iiii,t.dynCall_v=pt.dynCall_v,t.dynCall_vi=pt.dynCall_vi,t.dynCall_vii=pt.dynCall_vii,t.dynCall_viii=pt.dynCall_viii,t.dynCall_viiii=pt.dynCall_viiii,t.dynCall_viiiii=pt.dynCall_viiiii,t.dynCall_viiiiii=pt.dynCall_viiiiii,t.asm=pt,K)if(J(K)||(_t=K,K=t.locateFile?t.locateFile(_t,h):h+_t),s||a){var Bt=c(K);B.set(Bt,8)}else{W++,t.monitorRunDependencies&&t.monitorRunDependencies(W);var Ct=function(e){e.byteLength&&(e=new Uint8Array(e)),B.set(e,8),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,function(e){if(W--,t.monitorRunDependencies&&t.monitorRunDependencies(W),0==W&&z){var n=z;z=null,n()}}()},Mt=function(){A(K,Ct,(function(){throw new Error("could not load memory initializer "+K)}))},kt=dt(K);if(kt)Ct(kt.buffer);else if(t.memoryInitializerRequest){var Et=function(){var e=t.memoryInitializerRequest,n=e.response;if(200!==e.status&&0!==e.status){var r=dt(t.memoryInitializerRequestURL);if(!r)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+K),void Mt();n=r.buffer}Ct(n)};t.memoryInitializerRequest.response?setTimeout(Et,0):t.memoryInitializerRequest.addEventListener("load",Et)}else Mt()}function Ft(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function xt(e){function n(){bt||(bt=!0,t.calledRun=!0,g||(L(N),L(G),t.onRuntimeInitialized&&t.onRuntimeInitialized(),function(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)e=t.postRun.shift(),j.unshift(e);var e;L(j)}()))}W>0||(!function(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)e=t.preRun.shift(),H.unshift(e);var e;L(H)}(),W>0||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),n()}),1)):n()))}if(z=function e(){bt||xt(),bt||(z=e)},t.run=xt,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return xt(),t}var Vg=null,Lg={0:function(e){return{position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15)}},1:function(e){return{position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15)}},2:function(e){return{position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15),color:[e.getUint16(20,!0),e.getUint16(22,!0),e.getUint16(24,!0)]}},3:function(e){return{position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15),color:[e.getUint16(28,!0),e.getUint16(30,!0),e.getUint16(32,!0)]}}};function Hg(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;r=void 0===r||0===r?1:r;var i=e.slice(n,n+t.BYTES_PER_ELEMENT*r),s=new t(i);if(1===r)return s[0];for(var a=[],o=0;o<r;o++)a.push(s[o]);return a}function Ng(e){var t=131,n={pointsOffset:Hg(e,Uint32Array,96),pointsFormatId:Hg(e,Uint8Array,104),pointsStructSize:Hg(e,Uint16Array,105),pointsCount:Hg(e,Uint32Array,107),scale:Hg(e,Float64Array,t,3)};t+=24,n.offset=Hg(e,Float64Array,t,3),t+=24;var r=Hg(e,Float64Array,t,6);return t+=48,n.maxs=[r[0],r[2],r[4]],n.mins=[r[1],r[3],r[5]],n}var Gg=function(){function e(t){x(this,e),f(this,"arraybuffer",void 0),f(this,"readOffset",0),f(this,"header",{pointsOffset:0,pointsFormatId:0,pointsStructSize:0,pointsCount:0,scale:[0,0,0],offset:[0,0,0],maxs:[0],mins:[0],totalToRead:0,totalRead:0,versionAsString:"",isCompressed:!0}),this.arraybuffer=t}return I(e,[{key:"open",value:function(){return!0}},{key:"getHeader",value:function(){return this.header=Ng(this.arraybuffer),this.header}},{key:"readData",value:function(e,t){var n=this.header,r=this.arraybuffer;if(!n)throw new Error("Cannot start reading data till a header request is issued");var i,s=this.readOffset;if(t<=1){e=Math.min(e,n.pointsCount-s);var a=(i=n.pointsOffset+s*n.pointsStructSize)+e*n.pointsStructSize;return s+=e,this.readOffset=s,{buffer:r.slice(i,a),count:e,hasMoreData:s<n.pointsCount}}for(var o=Math.min(e*t,n.pointsCount-s),A=Math.ceil(o/t),c=0,l=new Uint8Array(A*n.pointsStructSize),u=0;u<o;u++){if(u%t==0){i=n.pointsOffset+s*n.pointsStructSize;var h=new Uint8Array(r,i,n.pointsStructSize);l.set(h,c*n.pointsStructSize),c++}s++}return this.readOffset=s,{buffer:l.buffer,count:c,hasMoreData:s<n.pointsCount}}},{key:"close",value:function(){return this.arraybuffer=null,!0}}]),e}(),jg=function(){function e(t){x(this,e),f(this,"arraybuffer",void 0),f(this,"instance",null),f(this,"header",null),this.arraybuffer=t,Vg||(Vg=Og())}return I(e,[{key:"open",value:function(){try{var e=this.arraybuffer;this.instance=new Vg.LASZip;var t=new Uint8Array(e),n=Vg._malloc(e.byteLength);return this.instance.arraybuffer=e,this.instance.buf=n,Vg.HEAPU8.set(t,n),this.instance.open(n,e.byteLength),this.instance.readOffset=0,!0}catch(e){throw new Error("Failed to open file: ".concat(e.message))}}},{key:"getHeader",value:function(){if(!this.instance)throw new Error("You need to open the file before trying to read header");try{var e=Ng(this.instance.arraybuffer);return e.pointsFormatId&=63,this.header=e,e}catch(e){throw new Error("Failed to get header: ".concat(e.message))}}},{key:"readData",value:function(e,t,n){if(!this.instance)throw new Error("You need to open the file before trying to read stuff");var r=this.header,i=this.instance;if(!r)throw new Error("You need to query header before reading, I maintain state that way, sorry :(");try{for(var s=Math.min(e*n,r.pointsCount-i.readOffset),a=Math.ceil(s/n),o=0,A=new Uint8Array(a*r.pointsStructSize),c=Vg._malloc(r.pointsStructSize),l=0;l<s;l++){if(i.getPoint(c),l%n==0){var u=new Uint8Array(Vg.HEAPU8.buffer,c,r.pointsStructSize);A.set(u,o*r.pointsStructSize),o++}i.readOffset++}return Vg._free(c),{buffer:A.buffer,count:o,hasMoreData:i.readOffset<r.pointsCount}}catch(e){throw new Error("Failed to read data: ".concat(e.message))}}},{key:"close",value:function(){try{return null!==this.instance&&(Vg._free(this.instance.buf),this.instance.delete(),this.instance=null),!0}catch(e){throw new Error("Failed to close file: ".concat(e.message))}}}]),e}(),Wg=function(){function e(t,n,r){x(this,e),f(this,"arrayb",void 0),f(this,"decoder",void 0),f(this,"pointsCount",void 0),f(this,"pointSize",void 0),f(this,"scale",void 0),f(this,"offset",void 0),f(this,"mins",void 0),f(this,"maxs",void 0),this.arrayb=t,this.decoder=Lg[r.pointsFormatId],this.pointsCount=n,this.pointSize=r.pointsStructSize,this.scale=r.scale,this.offset=r.offset,this.mins=r.mins,this.maxs=r.maxs}return I(e,[{key:"getPoint",value:function(e){if(e<0||e>=this.pointsCount)throw new Error("Point index out of range");var t=new DataView(this.arrayb,e*this.pointSize,this.pointSize);return this.decoder(t)}}]),e}(),zg=function(){function e(t){if(x(this,e),f(this,"arraybuffer",void 0),f(this,"formatId",0),f(this,"loader",void 0),f(this,"isCompressed",!0),f(this,"isOpen",!1),f(this,"version",0),f(this,"versionAsString",""),this.arraybuffer=t,this.determineVersion()>13)throw new Error("Only file versions <= 1.3 are supported at this time");if(this.determineFormat(),void 0===Lg[this.formatId])throw new Error("The point format ID is not supported");this.loader=this.isCompressed?new jg(this.arraybuffer):new Gg(this.arraybuffer)}return I(e,[{key:"determineFormat",value:function(){var e=Hg(this.arraybuffer,Uint8Array,104),t=(128&e)>>7,n=(64&e)>>6;if(1===t&&1===n)throw new Error("Old style compression not supported");this.formatId=63&e,this.isCompressed=1===t||1===n}},{key:"determineVersion",value:function(){var e=new Int8Array(this.arraybuffer,24,2);return this.version=10*e[0]+e[1],this.versionAsString="".concat(e[0],".").concat(e[1]),this.version}},{key:"open",value:function(){this.loader.open()&&(this.isOpen=!0)}},{key:"getHeader",value:function(){return this.loader.getHeader()}},{key:"readData",value:function(e,t,n){return this.loader.readData(e,t,n)}},{key:"close",value:function(){this.loader.close()&&(this.isOpen=!1)}},{key:"getUnpacker",value:function(){return Wg}}]),e}();function Xg(e,t){var n=function(e){var t={};t.las_pointsOffset=e.pointsOffset.toString(10),t.las_pointsFormatId=e.pointsFormatId.toString(10),t.las_pointsStructSize=e.pointsStructSize.toString(10),t.las_pointsCount=e.pointsCount.toString(10),t.las_scale=JSON.stringify(e.scale),t.las_offset=JSON.stringify(e.offset),void 0!==e.maxs&&(t.las_maxs=JSON.stringify(e.maxs));void 0!==e.mins&&(t.las_mins=JSON.stringify(e.mins));t.las_totalToRead=e.totalToRead.toString(10),t.las_pointsFortotalReadmatId=e.totalRead.toString(10),void 0!==e.versionAsString&&(t.las_versionAsString=e.versionAsString);void 0!==e.isCompressed&&(t.las_isCompressed=e.isCompressed.toString());return t}(e),r=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{fields:qh(e),metadata:t}}(t,n);return r}function Kg(e,t){return function(e){var t,n,r,i,s,a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},A=0,c={loader:"las",loaderData:{},schema:{fields:[],metadata:{}},header:{vertexCount:0,boundingBox:[[0,0,0],[0,0,0]]},attributes:{},topology:"point-list",mode:0};Zg(e,null===(t=o.las)||void 0===t?void 0:t.skip,(function(){var e,t,l=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},u=arguments.length>1?arguments[1]:void 0;if(!a){var h;a=u;var f=u.totalToRead,p=null!==(h=o.las)&&void 0!==h&&h.fp64?Float64Array:Float32Array;n=new p(3*f),r=u.pointsFormatId>=2?new Uint8Array(4*f):null,i=new Uint16Array(f),s=new Uint8Array(f),c.loaderData=u,c.attributes={POSITION:{value:n,size:3},intensity:{value:i,size:1},classification:{value:s,size:1}},r&&(c.attributes.COLOR_0={value:r,size:4})}for(var v=l.pointsCount,g=k(u.scale,3),m=g[0],y=g[1],_=g[2],b=k(u.offset,3),w=b[0],B=b[1],C=b[2],M=Jg(l,v,null===(e=o.las)||void 0===e?void 0:e.colorDepth),E=0;E<v;E++){var F=l.getPoint(E),x=F.position,U=F.color,I=F.intensity,T=F.classification;n[3*A]=x[0]*m+w,n[3*A+1]=x[1]*y+B,n[3*A+2]=x[2]*_+C,U&&r&&(M?(r[4*A]=U[0]/256,r[4*A+1]=U[1]/256,r[4*A+2]=U[2]/256):(r[4*A]=U[0],r[4*A+1]=U[1],r[4*A+2]=U[2]),r[4*A+3]=255),i[A]=I,s[A]=T,A++}var P=d(d({},c),{},{header:{vertexCount:u.totalRead},progress:u.totalRead/u.totalToRead});null==o||null===(t=o.onProgress)||void 0===t||t.call(o,P)})),c.header={vertexCount:a.totalToRead,boundingBox:Jh((null==c?void 0:c.attributes)||{})},c&&(c.schema=Xg(c.loaderData,c.attributes));return c}(e,t)}function Zg(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new zg(e);try{r.open();var i=r.getHeader(),s=r.getUnpacker(),a=Math.ceil(i.pointsCount/Math.max(1,t));i.totalToRead=a;for(var o=0;;){var A=r.readData(1e5,0,t);o+=A.count,i.totalRead=o,i.versionAsString=A.versionAsString,i.isCompressed=A.isCompressed;var c=new s(A.buffer,A.count,i);if(n(c,i),!A.hasMoreData||o>=a)break}}catch(e){throw e}finally{r.close()}}function Jg(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,r=!1;switch(n){case 8:r=!1;break;case 16:r=!0;break;case"auto":if(e.getPoint(0).color)for(var i=0;i<t;i++){var s=e.getPoint(i),a=s.color;(a[0]>255||a[1]>255||a[2]>255)&&(r=!0)}break;default:console.warn("las: illegal value for options.las.colorDepth")}return r}var Yg,qg=d(d({},Rg),{},{parse:(Yg=l(A().mark((function e(t,n){return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Kg(t,n));case 1:case"end":return e.stop()}}),e)}))),function(e,t){return Yg.apply(this,arguments)}),parseSync:function(e,t){return Kg(e,t)}}),$g=function(e,t){return $g=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},$g(e,t)};
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function em(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}$g(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var tm=function(){return tm=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},tm.apply(this,arguments)};function nm(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{A(r.next(e))}catch(e){s(e)}}function o(e){try{A(r.throw(e))}catch(e){s(e)}}function A(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}A((r=r.apply(e,t||[])).next())}))}function rm(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}function im(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||t)}for(var sm=function(){function e(e,t,n,r){this.left=e,this.top=t,this.width=n,this.height=r}return e.prototype.add=function(t,n,r,i){return new e(this.left+t,this.top+n,this.width+r,this.height+i)},e.fromClientRect=function(t,n){return new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height)},e.fromDOMRectList=function(t,n){var r=Array.from(n).find((function(e){return 0!==e.width}));return r?new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),am=function(e,t){return sm.fromClientRect(e,t.getBoundingClientRect())},om=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=e.charCodeAt(n++);56320==(64512&s)?t.push(((1023&i)<<10)+(1023&s)+65536):(t.push(i),n--)}else t.push(i)}return t},Am=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,s="";++i<n;){var a=e[i];a<=65535?r.push(a):(a-=65536,r.push(55296+(a>>10),a%1024+56320)),(i+1===n||r.length>16384)&&(s+=String.fromCharCode.apply(String,r),r.length=0)}return s},cm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",lm="undefined"==typeof Uint8Array?[]:new Uint8Array(256),um=0;um<cm.length;um++)lm[cm.charCodeAt(um)]=um;for(var hm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",dm="undefined"==typeof Uint8Array?[]:new Uint8Array(256),fm=0;fm<hm.length;fm++)dm[hm.charCodeAt(fm)]=fm;for(var pm=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},vm=function(){function e(e,t,n,r,i,s){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=s}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),gm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",mm="undefined"==typeof Uint8Array?[]:new Uint8Array(256),ym=0;ym<gm.length;ym++)mm[gm.charCodeAt(ym)]=ym;var _m=10,bm=13,wm=15,Bm=17,Cm=18,Mm=19,km=20,Em=21,Fm=22,xm=24,Um=25,Im=26,Tm=27,Pm=28,Sm=30,Dm=32,Qm=33,Rm=34,Om=35,Vm=37,Lm=38,Hm=39,Nm=40,Gm=42,jm=[9001,65288],Wm=function(e,t){var n,r,i,s=function(e){var t,n,r,i,s,a=.75*e.length,o=e.length,A=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),l=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<o;t+=4)n=dm[e.charCodeAt(t)],r=dm[e.charCodeAt(t+1)],i=dm[e.charCodeAt(t+2)],s=dm[e.charCodeAt(t+3)],l[A++]=n<<2|r>>4,l[A++]=(15&r)<<4|i>>2,l[A++]=(3&i)<<6|63&s;return c}(e),a=Array.isArray(s)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n}(s):new Uint32Array(s),o=Array.isArray(s)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n}(s):new Uint16Array(s),A=pm(o,12,a[4]/2),c=2===a[5]?pm(o,(24+a[4])/2):(n=a,r=Math.ceil((24+a[4])/4),n.slice?n.slice(r,i):new Uint32Array(Array.prototype.slice.call(n,r,i)));return new vm(a[0],a[1],a[2],a[3],A,c)}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),zm=[Sm,36],Xm=[1,2,3,5],Km=[_m,8],Zm=[Tm,Im],Jm=Xm.concat(Km),Ym=[Lm,Hm,Nm,Rm,Om],qm=[wm,bm],$m=function(e,t,n,r){var i=r[n];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var s=n;s<=r.length;){if((A=r[++s])===t)return!0;if(A!==_m)break}if(i===_m)for(s=n;s>0;){var a=r[--s];if(Array.isArray(e)?-1!==e.indexOf(a):e===a)for(var o=n;o<=r.length;){var A;if((A=r[++o])===t)return!0;if(A!==_m)break}if(a!==_m)break}return!1},ey=function(e,t){for(var n=e;n>=0;){var r=t[n];if(r!==_m)return r;n--}return 0},ty=function(e,t,n,r,i){if(0===n[r])return"";var s=r-1;if(Array.isArray(i)&&!0===i[s])return"";var a=s-1,o=s+1,A=t[s],c=a>=0?t[a]:0,l=t[o];if(2===A&&3===l)return"";if(-1!==Xm.indexOf(A))return"!";if(-1!==Xm.indexOf(l))return"";if(-1!==Km.indexOf(l))return"";if(8===ey(s,t))return"";if(11===Wm.get(e[s]))return"";if((A===Dm||A===Qm)&&11===Wm.get(e[o]))return"";if(7===A||7===l)return"";if(9===A)return"";if(-1===[_m,bm,wm].indexOf(A)&&9===l)return"";if(-1!==[Bm,Cm,Mm,xm,Pm].indexOf(l))return"";if(ey(s,t)===Fm)return"";if($m(23,Fm,s,t))return"";if($m([Bm,Cm],Em,s,t))return"";if($m(12,12,s,t))return"";if(A===_m)return"";if(23===A||23===l)return"";if(16===l||16===A)return"";if(-1!==[bm,wm,Em].indexOf(l)||14===A)return"";if(36===c&&-1!==qm.indexOf(A))return"";if(A===Pm&&36===l)return"";if(l===km)return"";if(-1!==zm.indexOf(l)&&A===Um||-1!==zm.indexOf(A)&&l===Um)return"";if(A===Tm&&-1!==[Vm,Dm,Qm].indexOf(l)||-1!==[Vm,Dm,Qm].indexOf(A)&&l===Im)return"";if(-1!==zm.indexOf(A)&&-1!==Zm.indexOf(l)||-1!==Zm.indexOf(A)&&-1!==zm.indexOf(l))return"";if(-1!==[Tm,Im].indexOf(A)&&(l===Um||-1!==[Fm,wm].indexOf(l)&&t[o+1]===Um)||-1!==[Fm,wm].indexOf(A)&&l===Um||A===Um&&-1!==[Um,Pm,xm].indexOf(l))return"";if(-1!==[Um,Pm,xm,Bm,Cm].indexOf(l))for(var u=s;u>=0;){if((h=t[u])===Um)return"";if(-1===[Pm,xm].indexOf(h))break;u--}if(-1!==[Tm,Im].indexOf(l))for(u=-1!==[Bm,Cm].indexOf(A)?a:s;u>=0;){var h;if((h=t[u])===Um)return"";if(-1===[Pm,xm].indexOf(h))break;u--}if(Lm===A&&-1!==[Lm,Hm,Rm,Om].indexOf(l)||-1!==[Hm,Rm].indexOf(A)&&-1!==[Hm,Nm].indexOf(l)||-1!==[Nm,Om].indexOf(A)&&l===Nm)return"";if(-1!==Ym.indexOf(A)&&-1!==[km,Im].indexOf(l)||-1!==Ym.indexOf(l)&&A===Tm)return"";if(-1!==zm.indexOf(A)&&-1!==zm.indexOf(l))return"";if(A===xm&&-1!==zm.indexOf(l))return"";if(-1!==zm.concat(Um).indexOf(A)&&l===Fm&&-1===jm.indexOf(e[o])||-1!==zm.concat(Um).indexOf(l)&&A===Cm)return"";if(41===A&&41===l){for(var d=n[s],f=1;d>0&&41===t[--d];)f++;if(f%2!=0)return""}return A===Dm&&l===Qm?"":""},ny=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var n=function(e,t){void 0===t&&(t="strict");var n=[],r=[],i=[];return e.forEach((function(e,s){var a=Wm.get(e);if(a>50?(i.push(!0),a-=50):i.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return r.push(s),n.push(16);if(4===a||11===a){if(0===s)return r.push(s),n.push(Sm);var o=n[s-1];return-1===Jm.indexOf(o)?(r.push(r[s-1]),n.push(o)):(r.push(s),n.push(Sm))}return r.push(s),31===a?n.push("strict"===t?Em:Vm):a===Gm||29===a?n.push(Sm):43===a?e>=131072&&e<=196605||e>=196608&&e<=262141?n.push(Vm):n.push(Sm):void n.push(a)})),[r,n,i]}(e,t.lineBreak),r=n[0],i=n[1],s=n[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(i=i.map((function(e){return-1!==[Um,Sm,Gm].indexOf(e)?Vm:e})));var a="keep-all"===t.wordBreak?s.map((function(t,n){return t&&e[n]>=19968&&e[n]<=40959})):void 0;return[r,i,a]},ry=function(){function e(e,t,n,r){this.codePoints=e,this.required="!"===t,this.start=n,this.end=r}return e.prototype.slice=function(){return Am.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),iy=function(e){return e>=48&&e<=57},sy=function(e){return iy(e)||e>=65&&e<=70||e>=97&&e<=102},ay=function(e){return 10===e||9===e||32===e},oy=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},Ay=function(e){return oy(e)||iy(e)||45===e},cy=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},ly=function(e,t){return 92===e&&10!==t},uy=function(e,t,n){return 45===e?oy(t)||ly(t,n):!!oy(e)||!(92!==e||!ly(e,t))},hy=function(e,t,n){return 43===e||45===e?!!iy(t)||46===t&&iy(n):iy(46===e?t:e)},dy=function(e){var t=0,n=1;43!==e[t]&&45!==e[t]||(45===e[t]&&(n=-1),t++);for(var r=[];iy(e[t]);)r.push(e[t++]);var i=r.length?parseInt(Am.apply(void 0,r),10):0;46===e[t]&&t++;for(var s=[];iy(e[t]);)s.push(e[t++]);var a=s.length,o=a?parseInt(Am.apply(void 0,s),10):0;69!==e[t]&&101!==e[t]||t++;var A=1;43!==e[t]&&45!==e[t]||(45===e[t]&&(A=-1),t++);for(var c=[];iy(e[t]);)c.push(e[t++]);var l=c.length?parseInt(Am.apply(void 0,c),10):0;return n*(i+o*Math.pow(10,-a))*Math.pow(10,A*l)},fy={type:2},py={type:3},vy={type:4},gy={type:13},my={type:8},yy={type:21},_y={type:9},by={type:10},wy={type:11},By={type:12},Cy={type:14},My={type:23},ky={type:1},Ey={type:25},Fy={type:24},xy={type:26},Uy={type:27},Iy={type:28},Ty={type:29},Py={type:31},Sy={type:32},Dy=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(om(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Sy;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),n=this.peekCodePoint(1),r=this.peekCodePoint(2);if(Ay(t)||ly(n,r)){var i=uy(t,n,r)?2:1;return{type:5,value:this.consumeName(),flags:i}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),gy;break;case 39:return this.consumeStringToken(39);case 40:return fy;case 41:return py;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Cy;break;case 43:if(hy(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return vy;case 45:var s=e,a=this.peekCodePoint(0),o=this.peekCodePoint(1);if(hy(s,a,o))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(uy(s,a,o))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(45===a&&62===o)return this.consumeCodePoint(),this.consumeCodePoint(),Fy;break;case 46:if(hy(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var A=this.consumeCodePoint();if(42===A&&47===(A=this.consumeCodePoint()))return this.consumeToken();if(-1===A)return this.consumeToken()}break;case 58:return xy;case 59:return Uy;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),Ey;break;case 64:var c=this.peekCodePoint(0),l=this.peekCodePoint(1),u=this.peekCodePoint(2);if(uy(c,l,u))return{type:7,value:this.consumeName()};break;case 91:return Iy;case 92:if(ly(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return Ty;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),my;break;case 123:return wy;case 125:return By;case 117:case 85:var h=this.peekCodePoint(0),d=this.peekCodePoint(1);return 43!==h||!sy(d)&&63!==d||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),_y;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),yy;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),by;break;case-1:return Sy}return ay(e)?(this.consumeWhiteSpace(),Py):iy(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):oy(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:Am(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();sy(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var n=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),n=!0;if(n)return{type:30,start:parseInt(Am.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),end:parseInt(Am.apply(void 0,e.map((function(e){return 63===e?70:e}))),16)};var r=parseInt(Am.apply(void 0,e),16);if(45===this.peekCodePoint(0)&&sy(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var i=[];sy(t)&&i.length<6;)i.push(t),t=this.consumeCodePoint();return{type:30,start:r,end:parseInt(Am.apply(void 0,i),16)}}return{type:30,start:r,end:r}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:22,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var n=this.consumeStringToken(this.consumeCodePoint());return 0===n.type&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:n.value}):(this.consumeBadUrlRemnants(),My)}for(;;){var r=this.consumeCodePoint();if(-1===r||41===r)return{type:22,value:Am.apply(void 0,e)};if(ay(r))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:Am.apply(void 0,e)}):(this.consumeBadUrlRemnants(),My);if(34===r||39===r||40===r||cy(r))return this.consumeBadUrlRemnants(),My;if(92===r){if(!ly(r,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),My;e.push(this.consumeEscapedCodePoint())}else e.push(r)}},e.prototype.consumeWhiteSpace=function(){for(;ay(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||-1===e)return;ly(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var n=Math.min(5e4,e);t+=Am.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",n=0;;){var r=this._value[n];if(-1===r||void 0===r||r===e)return{type:0,value:t+=this.consumeStringSlice(n)};if(10===r)return this._value.splice(0,n),ky;if(92===r){var i=this._value[n+1];-1!==i&&void 0!==i&&(10===i?(t+=this.consumeStringSlice(n),n=-1,this._value.shift()):ly(r,i)&&(t+=this.consumeStringSlice(n),t+=Am(this.consumeEscapedCodePoint()),n=-1))}n++}},e.prototype.consumeNumber=function(){var e=[],t=4,n=this.peekCodePoint(0);for(43!==n&&45!==n||e.push(this.consumeCodePoint());iy(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0);var r=this.peekCodePoint(1);if(46===n&&iy(r))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;iy(this.peekCodePoint(0));)e.push(this.consumeCodePoint());n=this.peekCodePoint(0),r=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((69===n||101===n)&&((43===r||45===r)&&iy(i)||iy(r)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;iy(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[dy(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],n=e[1],r=this.peekCodePoint(0),i=this.peekCodePoint(1),s=this.peekCodePoint(2);return uy(r,i,s)?{type:15,number:t,flags:n,unit:this.consumeName()}:37===r?(this.consumeCodePoint(),{type:16,number:t,flags:n}):{type:17,number:t,flags:n}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(sy(e)){for(var t=Am(e);sy(this.peekCodePoint(0))&&t.length<6;)t+=Am(this.consumeCodePoint());ay(this.peekCodePoint(0))&&this.consumeCodePoint();var n=parseInt(t,16);return 0===n||function(e){return e>=55296&&e<=57343}(n)||n>1114111?65533:n}return-1===e?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(Ay(t))e+=Am(t);else{if(!ly(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=Am(this.consumeEscapedCodePoint())}}},e}(),Qy=function(){function e(e){this._tokens=e}return e.create=function(t){var n=new Dy;return n.write(t),new e(n.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},n=this.consumeToken();;){if(32===n.type||Wy(n,e))return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue()),n=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var n=this.consumeToken();if(32===n.type||3===n.type)return t;this.reconsumeToken(n),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Sy:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Ry=function(e){return 15===e.type},Oy=function(e){return 17===e.type},Vy=function(e){return 20===e.type},Ly=function(e){return 0===e.type},Hy=function(e,t){return Vy(e)&&e.value===t},Ny=function(e){return 31!==e.type},Gy=function(e){return 31!==e.type&&4!==e.type},jy=function(e){var t=[],n=[];return e.forEach((function(e){if(4===e.type){if(0===n.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(n),void(n=[])}31!==e.type&&n.push(e)})),n.length&&t.push(n),t},Wy=function(e,t){return 11===t&&12===e.type||(28===t&&29===e.type||2===t&&3===e.type)},zy=function(e){return 17===e.type||15===e.type},Xy=function(e){return 16===e.type||zy(e)},Ky=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Zy={type:17,number:0,flags:4},Jy={type:16,number:50,flags:4},Yy={type:16,number:100,flags:4},qy=function(e,t,n){var r=e[0],i=e[1];return[$y(r,t),$y(void 0!==i?i:r,n)]},$y=function(e,t){if(16===e.type)return e.number/100*t;if(Ry(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},e_=function(e,t){if(15===t.type)switch(t.unit){case"deg":return Math.PI*t.number/180;case"grad":return Math.PI/200*t.number;case"rad":return t.number;case"turn":return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},t_=function(e){return 15===e.type&&("deg"===e.unit||"grad"===e.unit||"rad"===e.unit||"turn"===e.unit)},n_=function(e){switch(e.filter(Vy).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Zy,Zy];case"to top":case"bottom":return r_(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Zy,Yy];case"to right":case"left":return r_(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Yy,Yy];case"to bottom":case"top":return r_(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Yy,Zy];case"to left":case"right":return r_(270)}return 0},r_=function(e){return Math.PI*e/180},i_=function(e,t){if(18===t.type){var n=h_[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return n(e,t.values)}if(5===t.type){if(3===t.value.length){var r=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3);return o_(parseInt(r+r,16),parseInt(i+i,16),parseInt(s+s,16),1)}if(4===t.value.length){r=t.value.substring(0,1),i=t.value.substring(1,2),s=t.value.substring(2,3);var a=t.value.substring(3,4);return o_(parseInt(r+r,16),parseInt(i+i,16),parseInt(s+s,16),parseInt(a+a,16)/255)}if(6===t.value.length){r=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6);return o_(parseInt(r,16),parseInt(i,16),parseInt(s,16),1)}if(8===t.value.length){r=t.value.substring(0,2),i=t.value.substring(2,4),s=t.value.substring(4,6),a=t.value.substring(6,8);return o_(parseInt(r,16),parseInt(i,16),parseInt(s,16),parseInt(a,16)/255)}}if(20===t.type){var o=f_[t.value.toUpperCase()];if(void 0!==o)return o}return f_.TRANSPARENT},s_=function(e){return 0==(255&e)},a_=function(e){var t=255&e,n=255&e>>8,r=255&e>>16,i=255&e>>24;return t<255?"rgba("+i+","+r+","+n+","+t/255+")":"rgb("+i+","+r+","+n+")"},o_=function(e,t,n,r){return(e<<24|t<<16|n<<8|Math.round(255*r)<<0)>>>0},A_=function(e,t){if(17===e.type)return e.number;if(16===e.type){var n=3===t?1:255;return 3===t?e.number/100*n:Math.round(e.number/100*n)}return 0},c_=function(e,t){var n=t.filter(Gy);if(3===n.length){var r=n.map(A_),i=r[0],s=r[1],a=r[2];return o_(i,s,a,1)}if(4===n.length){var o=n.map(A_),A=(i=o[0],s=o[1],a=o[2],o[3]);return o_(i,s,a,A)}return 0};function l_(e,t,n){return n<0&&(n+=1),n>=1&&(n-=1),n<1/6?(t-e)*n*6+e:n<.5?t:n<2/3?6*(t-e)*(2/3-n)+e:e}var u_=function(e,t){var n=t.filter(Gy),r=n[0],i=n[1],s=n[2],a=n[3],o=(17===r.type?r_(r.number):e_(e,r))/(2*Math.PI),A=Xy(i)?i.number/100:0,c=Xy(s)?s.number/100:0,l=void 0!==a&&Xy(a)?$y(a,1):1;if(0===A)return o_(255*c,255*c,255*c,1);var u=c<=.5?c*(A+1):c+A-c*A,h=2*c-u,d=l_(h,u,o+1/3),f=l_(h,u,o),p=l_(h,u,o-1/3);return o_(255*d,255*f,255*p,l)},h_={hsl:u_,hsla:u_,rgb:c_,rgba:c_},d_=function(e,t){return i_(e,Qy.create(t).parseComponentValue())},f_={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},p_={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Vy(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},v_={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},g_=function(e,t){var n=i_(e,t[0]),r=t[1];return r&&Xy(r)?{color:n,stop:r}:{color:n,stop:null}},m_=function(e,t){var n=e[0],r=e[e.length-1];null===n.stop&&(n.stop=Zy),null===r.stop&&(r.stop=Yy);for(var i=[],s=0,a=0;a<e.length;a++){var o=e[a].stop;if(null!==o){var A=$y(o,t);A>s?i.push(A):i.push(s),s=A}else i.push(null)}var c=null;for(a=0;a<i.length;a++){var l=i[a];if(null===l)null===c&&(c=a);else if(null!==c){for(var u=a-c,h=(l-i[c-1])/(u+1),d=1;d<=u;d++)i[c+d-1]=h*d;c=null}}return e.map((function(e,n){return{color:e.color,stop:Math.max(Math.min(1,i[n]/t),0)}}))},y_=function(e,t,n){var r="number"==typeof e?e:function(e,t,n){var r=t/2,i=n/2,s=$y(e[0],t)-r,a=i-$y(e[1],n);return(Math.atan2(a,s)+2*Math.PI)%(2*Math.PI)}(e,t,n),i=Math.abs(t*Math.sin(r))+Math.abs(n*Math.cos(r)),s=t/2,a=n/2,o=i/2,A=Math.sin(r-Math.PI/2)*o,c=Math.cos(r-Math.PI/2)*o;return[i,s-c,s+c,a-A,a+A]},__=function(e,t){return Math.sqrt(e*e+t*t)},b_=function(e,t,n,r,i){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var s=t[0],a=t[1],o=__(n-s,r-a);return(i?o<e.optimumDistance:o>e.optimumDistance)?{optimumCorner:t,optimumDistance:o}:e}),{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},w_=function(e,t){var n=r_(180),r=[];return jy(t).forEach((function(t,i){if(0===i){var s=t[0];if(20===s.type&&-1!==["top","left","right","bottom"].indexOf(s.value))return void(n=n_(t));if(t_(s))return void(n=(e_(e,s)+r_(270))%r_(360))}var a=g_(e,t);r.push(a)})),{angle:n,stops:r,type:1}},B_=function(e,t){var n=0,r=3,i=[],s=[];return jy(t).forEach((function(t,a){var o=!0;if(0===a?o=t.reduce((function(e,t){if(Vy(t))switch(t.value){case"center":return s.push(Jy),!1;case"top":case"left":return s.push(Zy),!1;case"right":case"bottom":return s.push(Yy),!1}else if(Xy(t)||zy(t))return s.push(t),!1;return e}),o):1===a&&(o=t.reduce((function(e,t){if(Vy(t))switch(t.value){case"circle":return n=0,!1;case"ellipse":return n=1,!1;case"contain":case"closest-side":return r=0,!1;case"farthest-side":return r=1,!1;case"closest-corner":return r=2,!1;case"cover":case"farthest-corner":return r=3,!1}else if(zy(t)||Xy(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),o)),o){var A=g_(e,t);i.push(A)}})),{size:r,shape:n,stops:i,position:s,type:2}},C_=function(e,t){if(22===t.type){var n={url:t.value,type:0};return e.cache.addImage(t.value),n}if(18===t.type){var r=k_[t.name];if(void 0===r)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return r(e,t.values)}throw new Error("Unsupported image type "+t.type)};var M_,k_={"linear-gradient":function(e,t){var n=r_(180),r=[];return jy(t).forEach((function(t,i){if(0===i){var s=t[0];if(20===s.type&&"to"===s.value)return void(n=n_(t));if(t_(s))return void(n=e_(e,s))}var a=g_(e,t);r.push(a)})),{angle:n,stops:r,type:1}},"-moz-linear-gradient":w_,"-ms-linear-gradient":w_,"-o-linear-gradient":w_,"-webkit-linear-gradient":w_,"radial-gradient":function(e,t){var n=0,r=3,i=[],s=[];return jy(t).forEach((function(t,a){var o=!0;if(0===a){var A=!1;o=t.reduce((function(e,t){if(A)if(Vy(t))switch(t.value){case"center":return s.push(Jy),e;case"top":case"left":return s.push(Zy),e;case"right":case"bottom":return s.push(Yy),e}else(Xy(t)||zy(t))&&s.push(t);else if(Vy(t))switch(t.value){case"circle":return n=0,!1;case"ellipse":return n=1,!1;case"at":return A=!0,!1;case"closest-side":return r=0,!1;case"cover":case"farthest-side":return r=1,!1;case"contain":case"closest-corner":return r=2,!1;case"farthest-corner":return r=3,!1}else if(zy(t)||Xy(t))return Array.isArray(r)||(r=[]),r.push(t),!1;return e}),o)}if(o){var c=g_(e,t);i.push(c)}})),{size:r,shape:n,stops:i,position:s,type:2}},"-moz-radial-gradient":B_,"-ms-radial-gradient":B_,"-o-radial-gradient":B_,"-webkit-radial-gradient":B_,"-webkit-gradient":function(e,t){var n=r_(180),r=[],i=1;return jy(t).forEach((function(t,n){var s=t[0];if(0===n){if(Vy(s)&&"linear"===s.value)return void(i=1);if(Vy(s)&&"radial"===s.value)return void(i=2)}if(18===s.type)if("from"===s.name){var a=i_(e,s.values[0]);r.push({stop:Zy,color:a})}else if("to"===s.name){a=i_(e,s.values[0]);r.push({stop:Yy,color:a})}else if("color-stop"===s.name){var o=s.values.filter(Gy);if(2===o.length){a=i_(e,o[1]);var A=o[0];Oy(A)&&r.push({stop:{type:16,number:100*A.number,flags:A.flags},color:a})}}})),1===i?{angle:(n+r_(180))%r_(360),stops:r,type:i}:{size:3,shape:0,stops:r,position:[],type:i}}},E_={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t.filter((function(e){return Gy(e)&&function(e){return!(20===e.type&&"none"===e.value||18===e.type&&!k_[e.name])}(e)})).map((function(t){return C_(e,t)}))}},F_={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if(Vy(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},x_={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return jy(t).map((function(e){return e.filter(Xy)})).map(Ky)}},U_={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return jy(t).map((function(e){return e.filter(Vy).map((function(e){return e.value})).join(" ")})).map(I_)}},I_=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(M_||(M_={}));var T_,P_={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return jy(t).map((function(e){return e.filter(S_)}))}},S_=function(e){return Vy(e)||Xy(e)},D_=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Q_=D_("top"),R_=D_("right"),O_=D_("bottom"),V_=D_("left"),L_=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return Ky(t.filter(Xy))}}},H_=L_("top-left"),N_=L_("top-right"),G_=L_("bottom-right"),j_=L_("bottom-left"),W_=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},z_=W_("top"),X_=W_("right"),K_=W_("bottom"),Z_=W_("left"),J_=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ry(t)?t.number:0}}},Y_=J_("top"),q_=J_("right"),$_=J_("bottom"),eb=J_("left"),tb={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},nb={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},rb={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Vy).reduce((function(e,t){return e|ib(t.value)}),0)}},ib=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},sb={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},ab={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(T_||(T_={}));var ob,Ab={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?T_.STRICT:T_.NORMAL}},cb={name:"line-height",initialValue:"normal",prefix:!1,type:4},lb=function(e,t){return Vy(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:Xy(e)?$y(e,t):t},ub={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:C_(e,t)}},hb={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},db={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},fb=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},pb=fb("top"),vb=fb("right"),gb=fb("bottom"),mb=fb("left"),yb={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Vy).map((function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},_b={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},bb=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},wb=bb("top"),Bb=bb("right"),Cb=bb("bottom"),Mb=bb("left"),kb={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Eb={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Fb={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Hy(t[0],"none")?[]:jy(t).map((function(t){for(var n={color:f_.TRANSPARENT,offsetX:Zy,offsetY:Zy,blur:Zy},r=0,i=0;i<t.length;i++){var s=t[i];zy(s)?(0===r?n.offsetX=s:1===r?n.offsetY=s:n.blur=s,r++):n.color=i_(e,s)}return n}))}},xb={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Ub={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var n=Ib[t.name];if(void 0===n)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return n(t.values)}return null}},Ib={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),n=t[0],r=t[1];t[2],t[3];var i=t[4],s=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],o=t[13];return t[14],t[15],16===t.length?[n,r,i,s,a,o]:null}},Tb={type:16,number:50,flags:4},Pb=[Tb,Tb],Sb={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var n=t.filter(Xy);return 2!==n.length?Pb:[n[0],n[1]]}},Db={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(ob||(ob={}));for(var Qb={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return ob.BREAK_ALL;case"keep-all":return ob.KEEP_ALL;default:return ob.NORMAL}}},Rb={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Oy(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Ob=function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")},Vb={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Oy(t)?t.number:1}},Lb={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Hb={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Vy).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},Nb={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var n=[],r=[];return t.forEach((function(e){switch(e.type){case 20:case 0:n.push(e.value);break;case 17:n.push(e.number.toString());break;case 4:r.push(n.join(" ")),n.length=0}})),n.length&&r.push(n.join(" ")),r.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},Gb={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},jb={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Oy(t)?t.number:Vy(t)&&"bold"===t.value?700:400}},Wb={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Vy).map((function(e){return e.value}))}},zb={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},Xb=function(e,t){return 0!=(e&t)},Kb={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var n=t[0];return 20===n.type&&"none"===n.value?[]:t}},Zb={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;for(var r=[],i=t.filter(Ny),s=0;s<i.length;s++){var a=i[s],o=i[s+1];if(20===a.type){var A=o&&Oy(o)?o.number:1;r.push({counter:a.value,increment:A})}}return r}},Jb={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var n=[],r=t.filter(Ny),i=0;i<r.length;i++){var s=r[i],a=r[i+1];if(Vy(s)&&"none"!==s.value){var o=a&&Oy(a)?a.number:0;n.push({counter:s.value,reset:o})}}return n}},Yb={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Ry).map((function(t){return Ob(e,t)}))}},qb={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var n=t[0];if(20===n.type&&"none"===n.value)return null;var r=[],i=t.filter(Ly);if(i.length%2!=0)return null;for(var s=0;s<i.length;s+=2){var a=i[s].value,o=i[s+1].value;r.push({open:a,close:o})}return r}},$b=function(e,t,n){if(!e)return"";var r=e[Math.min(t,e.length-1)];return r?n?r.open:r.close:""},ew={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Hy(t[0],"none")?[]:jy(t).map((function(t){for(var n={color:255,offsetX:Zy,offsetY:Zy,blur:Zy,spread:Zy,inset:!1},r=0,i=0;i<t.length;i++){var s=t[i];Hy(s,"inset")?n.inset=!0:zy(s)?(0===r?n.offsetX=s:1===r?n.offsetY=s:2===r?n.blur=s:n.spread=s,r++):n.color=i_(e,s)}return n}))}},tw={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var n=[];return t.filter(Vy).forEach((function(e){switch(e.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2)}})),[0,1,2].forEach((function(e){-1===n.indexOf(e)&&n.push(e)})),n}},nw={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},rw={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ry(t)?t.number:0}},iw=function(){function e(e,t){var n,r;this.animationDuration=ow(e,Yb,t.animationDuration),this.backgroundClip=ow(e,p_,t.backgroundClip),this.backgroundColor=ow(e,v_,t.backgroundColor),this.backgroundImage=ow(e,E_,t.backgroundImage),this.backgroundOrigin=ow(e,F_,t.backgroundOrigin),this.backgroundPosition=ow(e,x_,t.backgroundPosition),this.backgroundRepeat=ow(e,U_,t.backgroundRepeat),this.backgroundSize=ow(e,P_,t.backgroundSize),this.borderTopColor=ow(e,Q_,t.borderTopColor),this.borderRightColor=ow(e,R_,t.borderRightColor),this.borderBottomColor=ow(e,O_,t.borderBottomColor),this.borderLeftColor=ow(e,V_,t.borderLeftColor),this.borderTopLeftRadius=ow(e,H_,t.borderTopLeftRadius),this.borderTopRightRadius=ow(e,N_,t.borderTopRightRadius),this.borderBottomRightRadius=ow(e,G_,t.borderBottomRightRadius),this.borderBottomLeftRadius=ow(e,j_,t.borderBottomLeftRadius),this.borderTopStyle=ow(e,z_,t.borderTopStyle),this.borderRightStyle=ow(e,X_,t.borderRightStyle),this.borderBottomStyle=ow(e,K_,t.borderBottomStyle),this.borderLeftStyle=ow(e,Z_,t.borderLeftStyle),this.borderTopWidth=ow(e,Y_,t.borderTopWidth),this.borderRightWidth=ow(e,q_,t.borderRightWidth),this.borderBottomWidth=ow(e,$_,t.borderBottomWidth),this.borderLeftWidth=ow(e,eb,t.borderLeftWidth),this.boxShadow=ow(e,ew,t.boxShadow),this.color=ow(e,tb,t.color),this.direction=ow(e,nb,t.direction),this.display=ow(e,rb,t.display),this.float=ow(e,sb,t.cssFloat),this.fontFamily=ow(e,Nb,t.fontFamily),this.fontSize=ow(e,Gb,t.fontSize),this.fontStyle=ow(e,zb,t.fontStyle),this.fontVariant=ow(e,Wb,t.fontVariant),this.fontWeight=ow(e,jb,t.fontWeight),this.letterSpacing=ow(e,ab,t.letterSpacing),this.lineBreak=ow(e,Ab,t.lineBreak),this.lineHeight=ow(e,cb,t.lineHeight),this.listStyleImage=ow(e,ub,t.listStyleImage),this.listStylePosition=ow(e,hb,t.listStylePosition),this.listStyleType=ow(e,db,t.listStyleType),this.marginTop=ow(e,pb,t.marginTop),this.marginRight=ow(e,vb,t.marginRight),this.marginBottom=ow(e,gb,t.marginBottom),this.marginLeft=ow(e,mb,t.marginLeft),this.opacity=ow(e,Vb,t.opacity);var i=ow(e,yb,t.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=ow(e,_b,t.overflowWrap),this.paddingTop=ow(e,wb,t.paddingTop),this.paddingRight=ow(e,Bb,t.paddingRight),this.paddingBottom=ow(e,Cb,t.paddingBottom),this.paddingLeft=ow(e,Mb,t.paddingLeft),this.paintOrder=ow(e,tw,t.paintOrder),this.position=ow(e,Eb,t.position),this.textAlign=ow(e,kb,t.textAlign),this.textDecorationColor=ow(e,Lb,null!==(n=t.textDecorationColor)&&void 0!==n?n:t.color),this.textDecorationLine=ow(e,Hb,null!==(r=t.textDecorationLine)&&void 0!==r?r:t.textDecoration),this.textShadow=ow(e,Fb,t.textShadow),this.textTransform=ow(e,xb,t.textTransform),this.transform=ow(e,Ub,t.transform),this.transformOrigin=ow(e,Sb,t.transformOrigin),this.visibility=ow(e,Db,t.visibility),this.webkitTextStrokeColor=ow(e,nw,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=ow(e,rw,t.webkitTextStrokeWidth),this.wordBreak=ow(e,Qb,t.wordBreak),this.zIndex=ow(e,Rb,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return s_(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return Xb(this.display,4)||Xb(this.display,33554432)||Xb(this.display,268435456)||Xb(this.display,536870912)||Xb(this.display,67108864)||Xb(this.display,134217728)},e}(),sw=function(e,t){this.content=ow(e,Kb,t.content),this.quotes=ow(e,qb,t.quotes)},aw=function(e,t){this.counterIncrement=ow(e,Zb,t.counterIncrement),this.counterReset=ow(e,Jb,t.counterReset)},ow=function(e,t,n){var r=new Dy,i=null!=n?n.toString():t.initialValue;r.write(i);var s=new Qy(r.read());switch(t.type){case 2:var a=s.parseComponentValue();return t.parse(e,Vy(a)?a.value:t.initialValue);case 0:return t.parse(e,s.parseComponentValue());case 1:return t.parse(e,s.parseComponentValues());case 4:return s.parseComponentValue();case 3:switch(t.format){case"angle":return e_(e,s.parseComponentValue());case"color":return i_(e,s.parseComponentValue());case"image":return C_(e,s.parseComponentValue());case"length":var o=s.parseComponentValue();return zy(o)?o:Zy;case"length-percentage":var A=s.parseComponentValue();return Xy(A)?A:Zy;case"time":return Ob(e,s.parseComponentValue())}}},Aw=function(e,t){var n=function(e){switch(e.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(e);return 1===n||t===n},cw=function(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,Aw(t,3),this.styles=new iw(e,window.getComputedStyle(t,null)),cB(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=am(this.context,t),Aw(t,4)&&(this.flags|=16)},lw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",uw="undefined"==typeof Uint8Array?[]:new Uint8Array(256),hw=0;hw<lw.length;hw++)uw[lw.charCodeAt(hw)]=hw;for(var dw=function(e,t,n){return e.slice?e.slice(t,n):new Uint16Array(Array.prototype.slice.call(e,t,n))},fw=function(){function e(e,t,n,r,i,s){this.initialValue=e,this.errorValue=t,this.highStart=n,this.highValueIndex=r,this.index=i,this.data=s}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),pw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vw="undefined"==typeof Uint8Array?[]:new Uint8Array(256),gw=0;gw<pw.length;gw++)vw[pw.charCodeAt(gw)]=gw;var mw,yw=8,_w=9,bw=11,ww=12,Bw=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var n=e.length;if(!n)return"";for(var r=[],i=-1,s="";++i<n;){var a=e[i];a<=65535?r.push(a):(a-=65536,r.push(55296+(a>>10),a%1024+56320)),(i+1===n||r.length>16384)&&(s+=String.fromCharCode.apply(String,r),r.length=0)}return s},Cw=function(e,t){var n,r,i,s=function(e){var t,n,r,i,s,a=.75*e.length,o=e.length,A=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),l=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<o;t+=4)n=uw[e.charCodeAt(t)],r=uw[e.charCodeAt(t+1)],i=uw[e.charCodeAt(t+2)],s=uw[e.charCodeAt(t+3)],l[A++]=n<<2|r>>4,l[A++]=(15&r)<<4|i>>2,l[A++]=(3&i)<<6|63&s;return c}(e),a=Array.isArray(s)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=4)n.push(e[r+3]<<24|e[r+2]<<16|e[r+1]<<8|e[r]);return n}(s):new Uint32Array(s),o=Array.isArray(s)?function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n.push(e[r+1]<<8|e[r]);return n}(s):new Uint16Array(s),A=dw(o,12,a[4]/2),c=2===a[5]?dw(o,(24+a[4])/2):(n=a,r=Math.ceil((24+a[4])/4),n.slice?n.slice(r,i):new Uint32Array(Array.prototype.slice.call(n,r,i)));return new fw(a[0],a[1],a[2],a[3],A,c)}("AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),Mw=function(e){return Cw.get(e)},kw=function(e,t,n){var r=n-2,i=t[r],s=t[n-1],a=t[n];if(2===s&&3===a)return"";if(2===s||3===s||4===s)return"";if(2===a||3===a||4===a)return"";if(s===yw&&-1!==[yw,_w,bw,ww].indexOf(a))return"";if(!(s!==bw&&s!==_w||a!==_w&&10!==a))return"";if((s===ww||10===s)&&10===a)return"";if(13===a||5===a)return"";if(7===a)return"";if(1===s)return"";if(13===s&&14===a){for(;5===i;)i=t[--r];if(14===i)return""}if(15===s&&15===a){for(var o=0;15===i;)o++,i=t[--r];if(o%2==0)return""}return""},Ew=function(e){var t=function(e){for(var t=[],n=0,r=e.length;n<r;){var i=e.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var s=e.charCodeAt(n++);56320==(64512&s)?t.push(((1023&i)<<10)+(1023&s)+65536):(t.push(i),n--)}else t.push(i)}return t}(e),n=t.length,r=0,i=0,s=t.map(Mw);return{next:function(){if(r>=n)return{done:!0,value:null};for(var e="";r<n&&""===(e=kw(0,s,++r)););if(""!==e||r===n){var a=Bw.apply(null,t.slice(i,r));return i=r,{value:a,done:!1}}return{done:!0,value:null}}}},Fw=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},xw=function(e,t,n,r,i){var s="http://www.w3.org/2000/svg",a=document.createElementNS(s,"svg"),o=document.createElementNS(s,"foreignObject");return a.setAttributeNS(null,"width",e.toString()),a.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",n.toString()),o.setAttributeNS(null,"y",r.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(o),o.appendChild(i),a},Uw=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){return t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},Iw={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var n=e.createElement("boundtest");n.style.height="123px",n.style.display="block",e.body.appendChild(n),t.selectNode(n);var r=t.getBoundingClientRect(),i=Math.round(r.height);if(e.body.removeChild(n),123===i)return!0}}return!1}(document);return Object.defineProperty(Iw,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Iw.SUPPORT_RANGE_BOUNDS&&function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var n=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var r=t.firstChild,i=om(r.data).map((function(e){return Am(e)})),s=0,a={},o=i.every((function(e,t){n.setStart(r,s),n.setEnd(r,s+e.length);var i=n.getBoundingClientRect();s+=e.length;var o=i.x>a.x||i.y>a.y;return a=i,0===t||o}));return e.body.removeChild(t),o}(document);return Object.defineProperty(Iw,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,n=e.createElement("canvas"),r=n.getContext("2d");if(!r)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{r.drawImage(t,0,0),n.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(Iw,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas"),n=100;t.width=n,t.height=n;var r=t.getContext("2d");if(!r)return Promise.reject(!1);r.fillStyle="rgb(0, 255, 0)",r.fillRect(0,0,n,n);var i=new Image,s=t.toDataURL();i.src=s;var a=xw(n,n,0,0,i);return r.fillStyle="red",r.fillRect(0,0,n,n),Uw(a).then((function(t){r.drawImage(t,0,0);var i=r.getImageData(0,0,n,n).data;r.fillStyle="red",r.fillRect(0,0,n,n);var a=e.createElement("div");return a.style.backgroundImage="url("+s+")",a.style.height="100px",Fw(i)?Uw(xw(n,n,0,0,a)):Promise.reject(!1)})).then((function(e){return r.drawImage(e,0,0),Fw(r.getImageData(0,0,n,n).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(Iw,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(Iw,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(Iw,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Iw,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(Iw,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Tw=function(e,t){this.text=e,this.bounds=t},Pw=function(e,t){var n=t.ownerDocument;if(n){var r=n.createElement("html2canvaswrapper");r.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(r,t);var s=am(e,r);return r.firstChild&&i.replaceChild(r.firstChild,r),s}}return sm.EMPTY},Sw=function(e,t,n){var r=e.ownerDocument;if(!r)throw new Error("Node has no owner document");var i=r.createRange();return i.setStart(e,t),i.setEnd(e,t+n),i},Dw=function(e){if(Iw.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map((function(e){return e.segment}))}return function(e){for(var t,n=Ew(e),r=[];!(t=n.next()).done;)t.value&&r.push(t.value.slice());return r}(e)},Qw=function(e,t){return 0!==t.letterSpacing?Dw(e):function(e,t){if(Iw.SUPPORT_NATIVE_TEXT_SEGMENTATION){var n=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(n.segment(e)).map((function(e){return e.segment}))}return Ow(e,t)}(e,t)},Rw=[32,160,4961,65792,65793,4153,4241],Ow=function(e,t){for(var n,r=function(e,t){var n=om(e),r=ny(n,t),i=r[0],s=r[1],a=r[2],o=n.length,A=0,c=0;return{next:function(){if(c>=o)return{done:!0,value:null};for(var e="";c<o&&""===(e=ty(n,s,i,++c,a)););if(""!==e||c===o){var t=new ry(n,e,A,c);return A=c,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),i=[],s=function(){if(n.value){var e=n.value.slice(),t=om(e),r="";t.forEach((function(e){-1===Rw.indexOf(e)?r+=Am(e):(r.length&&i.push(r),i.push(Am(e)),r="")})),r.length&&i.push(r)}};!(n=r.next()).done;)s();return i},Vw=function(e,t,n){this.text=Lw(t.data,n.textTransform),this.textBounds=function(e,t,n,r){var i=Qw(t,n),s=[],a=0;return i.forEach((function(t){if(n.textDecorationLine.length||t.trim().length>0)if(Iw.SUPPORT_RANGE_BOUNDS){var i=Sw(r,a,t.length).getClientRects();if(i.length>1){var o=Dw(t),A=0;o.forEach((function(t){s.push(new Tw(t,sm.fromDOMRectList(e,Sw(r,A+a,t.length).getClientRects()))),A+=t.length}))}else s.push(new Tw(t,sm.fromDOMRectList(e,i)))}else{var c=r.splitText(t.length);s.push(new Tw(t,Pw(e,r))),r=c}else Iw.SUPPORT_RANGE_BOUNDS||(r=r.splitText(t.length));a+=t.length})),s}(e,this.text,n,t)},Lw=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Hw,Nw);case 2:return e.toUpperCase();default:return e}},Hw=/(^|\s|:|-|\(|\))([a-z])/g,Nw=function(e,t,n){return e.length>0?t+n.toUpperCase():e},Gw=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.src=n.currentSrc||n.src,r.intrinsicWidth=n.naturalWidth,r.intrinsicHeight=n.naturalHeight,r.context.cache.addImage(r.src),r}return em(t,e),t}(cw),jw=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.canvas=n,r.intrinsicWidth=n.width,r.intrinsicHeight=n.height,r}return em(t,e),t}(cw),Ww=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=new XMLSerializer,s=am(t,n);return n.setAttribute("width",s.width+"px"),n.setAttribute("height",s.height+"px"),r.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(n)),r.intrinsicWidth=n.width.baseVal.value,r.intrinsicHeight=n.height.baseVal.value,r.context.cache.addImage(r.svg),r}return em(t,e),t}(cw),zw=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return em(t,e),t}(cw),Xw=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.start=n.start,r.reversed="boolean"==typeof n.reversed&&!0===n.reversed,r}return em(t,e),t}(cw),Kw=[{type:15,flags:0,unit:"px",number:3}],Zw=[{type:16,flags:0,number:50}],Jw="password",Yw=function(e){function t(t,n){var r,i,s,a=e.call(this,t,n)||this;switch(a.type=n.type.toLowerCase(),a.checked=n.checked,a.value=0===(i=(r=n).type===Jw?new Array(r.value.length+1).join(""):r.value).length?r.placeholder||"":i,"checkbox"!==a.type&&"radio"!==a.type||(a.styles.backgroundColor=3739148031,a.styles.borderTopColor=a.styles.borderRightColor=a.styles.borderBottomColor=a.styles.borderLeftColor=2779096575,a.styles.borderTopWidth=a.styles.borderRightWidth=a.styles.borderBottomWidth=a.styles.borderLeftWidth=1,a.styles.borderTopStyle=a.styles.borderRightStyle=a.styles.borderBottomStyle=a.styles.borderLeftStyle=1,a.styles.backgroundClip=[0],a.styles.backgroundOrigin=[0],a.bounds=(s=a.bounds).width>s.height?new sm(s.left+(s.width-s.height)/2,s.top,s.height,s.height):s.width<s.height?new sm(s.left,s.top+(s.height-s.width)/2,s.width,s.width):s),a.type){case"checkbox":a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=Kw;break;case"radio":a.styles.borderTopRightRadius=a.styles.borderTopLeftRadius=a.styles.borderBottomRightRadius=a.styles.borderBottomLeftRadius=Zw}return a}return em(t,e),t}(cw),qw=function(e){function t(t,n){var r=e.call(this,t,n)||this,i=n.options[n.selectedIndex||0];return r.value=i&&i.text||"",r}return em(t,e),t}(cw),$w=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.value=n.value,r}return em(t,e),t}(cw),eB=function(e){function t(t,n){var r=e.call(this,t,n)||this;r.src=n.src,r.width=parseInt(n.width,10)||0,r.height=parseInt(n.height,10)||0,r.backgroundColor=r.styles.backgroundColor;try{if(n.contentWindow&&n.contentWindow.document&&n.contentWindow.document.documentElement){r.tree=iB(t,n.contentWindow.document.documentElement);var i=n.contentWindow.document.documentElement?d_(t,getComputedStyle(n.contentWindow.document.documentElement).backgroundColor):f_.TRANSPARENT,s=n.contentWindow.document.body?d_(t,getComputedStyle(n.contentWindow.document.body).backgroundColor):f_.TRANSPARENT;r.backgroundColor=s_(i)?s_(s)?r.styles.backgroundColor:s:i}}catch(e){}return r}return em(t,e),t}(cw),tB=["OL","UL","MENU"],nB=function e(t,n,r,i){for(var s=n.firstChild,a=void 0;s;s=a)if(a=s.nextSibling,oB(s)&&s.data.trim().length>0)r.textNodes.push(new Vw(t,s,r.styles));else if(AB(s))if(BB(s)&&s.assignedNodes)s.assignedNodes().forEach((function(n){return e(t,n,r,i)}));else{var o=rB(t,s);o.styles.isVisible()&&(sB(s,o,i)?o.flags|=4:aB(o.styles)&&(o.flags|=2),-1!==tB.indexOf(s.tagName)&&(o.flags|=8),r.elements.push(o),s.slot,s.shadowRoot?e(t,s.shadowRoot,o,i):bB(s)||fB(s)||wB(s)||e(t,s,o,i))}},rB=function(e,t){return mB(t)?new Gw(e,t):vB(t)?new jw(e,t):fB(t)?new Ww(e,t):uB(t)?new zw(e,t):hB(t)?new Xw(e,t):dB(t)?new Yw(e,t):wB(t)?new qw(e,t):bB(t)?new $w(e,t):yB(t)?new eB(e,t):new cw(e,t)},iB=function(e,t){var n=rB(e,t);return n.flags|=4,nB(e,t,n,n),n},sB=function(e,t,n){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||pB(e)&&n.styles.isTransparent()},aB=function(e){return e.isPositioned()||e.isFloating()},oB=function(e){return e.nodeType===Node.TEXT_NODE},AB=function(e){return e.nodeType===Node.ELEMENT_NODE},cB=function(e){return AB(e)&&void 0!==e.style&&!lB(e)},lB=function(e){return"object"===M(e.className)},uB=function(e){return"LI"===e.tagName},hB=function(e){return"OL"===e.tagName},dB=function(e){return"INPUT"===e.tagName},fB=function(e){return"svg"===e.tagName},pB=function(e){return"BODY"===e.tagName},vB=function(e){return"CANVAS"===e.tagName},gB=function(e){return"VIDEO"===e.tagName},mB=function(e){return"IMG"===e.tagName},yB=function(e){return"IFRAME"===e.tagName},_B=function(e){return"STYLE"===e.tagName},bB=function(e){return"TEXTAREA"===e.tagName},wB=function(e){return"SELECT"===e.tagName},BB=function(e){return"SLOT"===e.tagName},CB=function(e){return e.tagName.indexOf("-")>0},MB=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,n=e.counterIncrement,r=e.counterReset,i=!0;null!==n&&n.forEach((function(e){var n=t.counters[e.counter];n&&0!==e.increment&&(i=!1,n.length||n.push(1),n[Math.max(0,n.length-1)]+=e.increment)}));var s=[];return i&&r.forEach((function(e){var n=t.counters[e.counter];s.push(e.counter),n||(n=t.counters[e.counter]=[]),n.push(e.reset)})),s},e}(),kB={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},EB={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},FB={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},xB={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},UB=function(e,t,n,r,i,s){return e<t||e>n?DB(e,i,s.length>0):r.integers.reduce((function(t,n,i){for(;e>=n;)e-=n,t+=r.values[i];return t}),"")+s},IB=function(e,t,n,r){var i="";do{n||e--,i=r(e)+i,e/=t}while(e*t>=t);return i},TB=function(e,t,n,r,i){var s=n-t+1;return(e<0?"-":"")+(IB(Math.abs(e),s,r,(function(e){return Am(Math.floor(e%s)+t)}))+i)},PB=function(e,t,n){void 0===n&&(n=". ");var r=t.length;return IB(Math.abs(e),r,!1,(function(e){return t[Math.floor(e%r)]}))+n},SB=function(e,t,n,r,i,s){if(e<-9999||e>9999)return DB(e,4,i.length>0);var a=Math.abs(e),o=i;if(0===a)return t[0]+o;for(var A=0;a>0&&A<=4;A++){var c=a%10;0===c&&Xb(s,1)&&""!==o?o=t[c]+o:c>1||1===c&&0===A||1===c&&1===A&&Xb(s,2)||1===c&&1===A&&Xb(s,4)&&e>100||1===c&&A>1&&Xb(s,8)?o=t[c]+(A>0?n[A-1]:"")+o:1===c&&A>0&&(o=n[A-1]+o),a=Math.floor(a/10)}return(e<0?r:"")+o},DB=function(e,t,n){var r=n?". ":"",i=n?"":"",s=n?", ":"",a=n?" ":"";switch(t){case 0:return""+a;case 1:return""+a;case 2:return""+a;case 5:var o=TB(e,48,57,!0,r);return o.length<4?"0"+o:o;case 4:return PB(e,"",i);case 6:return UB(e,1,3999,kB,3,r).toLowerCase();case 7:return UB(e,1,3999,kB,3,r);case 8:return TB(e,945,969,!1,r);case 9:return TB(e,97,122,!1,r);case 10:return TB(e,65,90,!1,r);case 11:return TB(e,1632,1641,!0,r);case 12:case 49:return UB(e,1,9999,EB,3,r);case 35:return UB(e,1,9999,EB,3,r).toLowerCase();case 13:return TB(e,2534,2543,!0,r);case 14:case 30:return TB(e,6112,6121,!0,r);case 15:return PB(e,"",i);case 16:return PB(e,"",i);case 17:case 48:return SB(e,"","","",i,14);case 47:return SB(e,"","","",i,15);case 42:return SB(e,"","","",i,14);case 41:return SB(e,"","","",i,15);case 26:return SB(e,"","","",i,0);case 25:return SB(e,"","","",i,7);case 31:return SB(e,"","","",s,7);case 33:return SB(e,"","","",s,0);case 32:return SB(e,"","","",s,7);case 18:return TB(e,2406,2415,!0,r);case 20:return UB(e,1,19999,xB,3,r);case 21:return TB(e,2790,2799,!0,r);case 22:return TB(e,2662,2671,!0,r);case 22:return UB(e,1,10999,FB,3,r);case 23:return PB(e,"");case 24:return PB(e,"");case 27:return TB(e,3302,3311,!0,r);case 28:return PB(e,"",i);case 29:return PB(e,"",i);case 34:return TB(e,3792,3801,!0,r);case 37:return TB(e,6160,6169,!0,r);case 38:return TB(e,4160,4169,!0,r);case 39:return TB(e,2918,2927,!0,r);case 40:return TB(e,1776,1785,!0,r);case 43:return TB(e,3046,3055,!0,r);case 44:return TB(e,3174,3183,!0,r);case 45:return TB(e,3664,3673,!0,r);case 46:return TB(e,3872,3881,!0,r);default:return TB(e,48,57,!0,r)}},QB=function(){function e(e,t,n){if(this.context=e,this.options=n,this.scrolledElements=[],this.referenceElement=t,this.counters=new MB,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var n=this,r=OB(e,t);if(!r.contentWindow)return Promise.reject("Unable to find iframe window");var i=e.defaultView.pageXOffset,s=e.defaultView.pageYOffset,a=r.contentWindow,o=a.document,A=HB(r).then((function(){return nm(n,void 0,void 0,(function(){var e,n;return rm(this,(function(i){switch(i.label){case 0:return this.scrolledElements.forEach(zB),a&&(a.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||a.scrollY===t.top&&a.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(a.scrollX-t.left,a.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(n=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:i.sent(),i.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,LB(o)]:[3,4];case 3:i.sent(),i.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(o,n)})).then((function(){return r}))]:[2,r]}}))}))}));return o.open(),o.write(jB(document.doctype)+"<html></html>"),WB(this.referenceElement.ownerDocument,i,s),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),A},e.prototype.createElementClone=function(e){if(Aw(e,2),vB(e))return this.createCanvasClone(e);if(gB(e))return this.createVideoClone(e);if(_B(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return mB(t)&&(mB(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),CB(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return GB(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var n=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),r=e.cloneNode(!1);return r.textContent=n,r}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var n=e.ownerDocument.createElement("img");try{return n.src=e.toDataURL(),n}catch(t){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var r=e.cloneNode(!1);try{r.width=e.width,r.height=e.height;var i=e.getContext("2d"),s=r.getContext("2d");if(s)if(!this.options.allowTaint&&i)s.putImageData(i.getImageData(0,0,e.width,e.height),0,0);else{var a=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(a){var o=a.getContextAttributes();!1===(null==o?void 0:o.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}s.drawImage(e,0,0)}return r}catch(t){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return r},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var n=t.getContext("2d");try{return n&&(n.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||n.getImageData(0,0,t.width,t.height)),t}catch(t){this.context.logger.info("Unable to clone video as it is tainted",e)}var r=e.ownerDocument.createElement("canvas");return r.width=e.offsetWidth,r.height=e.offsetHeight,r},e.prototype.appendChildNode=function(e,t,n){AB(t)&&("SCRIPT"===t.tagName||t.hasAttribute("data-html2canvas-ignore")||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&AB(t)&&_B(t)||e.appendChild(this.cloneNode(t,n))},e.prototype.cloneChildNodes=function(e,t,n){for(var r=this,i=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;i;i=i.nextSibling)if(AB(i)&&BB(i)&&"function"==typeof i.assignedNodes){var s=i.assignedNodes();s.length&&s.forEach((function(e){return r.appendChildNode(t,e,n)}))}else this.appendChildNode(t,i,n)},e.prototype.cloneNode=function(e,t){if(oB(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var n=e.ownerDocument.defaultView;if(n&&AB(e)&&(cB(e)||lB(e))){var r=this.createElementClone(e);r.style.transitionProperty="none";var i=n.getComputedStyle(e),s=n.getComputedStyle(e,":before"),a=n.getComputedStyle(e,":after");this.referenceElement===e&&cB(r)&&(this.clonedReferenceElement=r),pB(r)&&ZB(r);var o=this.counters.parse(new aw(this.context,i)),A=this.resolvePseudoContent(e,r,s,mw.BEFORE);CB(e)&&(t=!0),gB(e)||this.cloneChildNodes(e,r,t),A&&r.insertBefore(A,r.firstChild);var c=this.resolvePseudoContent(e,r,a,mw.AFTER);return c&&r.appendChild(c),this.counters.pop(o),(i&&(this.options.copyStyles||lB(e))&&!yB(e)||t)&&GB(i,r),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([r,e.scrollLeft,e.scrollTop]),(bB(e)||wB(e))&&(bB(r)||wB(r))&&(r.value=e.value),r}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,n,r){var i=this;if(n){var s=n.content,a=t.ownerDocument;if(a&&s&&"none"!==s&&"-moz-alt-content"!==s&&"none"!==n.display){this.counters.parse(new aw(this.context,n));var o=new sw(this.context,n),A=a.createElement("html2canvaspseudoelement");GB(n,A),o.content.forEach((function(t){if(0===t.type)A.appendChild(a.createTextNode(t.value));else if(22===t.type){var n=a.createElement("img");n.src=t.value,n.style.opacity="1",A.appendChild(n)}else if(18===t.type){if("attr"===t.name){var r=t.values.filter(Vy);r.length&&A.appendChild(a.createTextNode(e.getAttribute(r[0].value)||""))}else if("counter"===t.name){var s=t.values.filter(Gy),c=s[0],l=s[1];if(c&&Vy(c)){var u=i.counters.getCounterValue(c.value),h=l&&Vy(l)?db.parse(i.context,l.value):3;A.appendChild(a.createTextNode(DB(u,h,!1)))}}else if("counters"===t.name){var d=t.values.filter(Gy),f=(c=d[0],d[1]);l=d[2];if(c&&Vy(c)){var p=i.counters.getCounterValues(c.value),v=l&&Vy(l)?db.parse(i.context,l.value):3,g=f&&0===f.type?f.value:"",m=p.map((function(e){return DB(e,v,!1)})).join(g);A.appendChild(a.createTextNode(m))}}}else if(20===t.type)switch(t.value){case"open-quote":A.appendChild(a.createTextNode($b(o.quotes,i.quoteDepth++,!0)));break;case"close-quote":A.appendChild(a.createTextNode($b(o.quotes,--i.quoteDepth,!1)));break;default:A.appendChild(a.createTextNode(t.value))}})),A.className=XB+" "+KB;var c=r===mw.BEFORE?" "+XB:" "+KB;return lB(t)?t.className.baseValue+=c:t.className+=c,A}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(mw||(mw={}));var RB,OB=function(e,t){var n=e.createElement("iframe");return n.className="html2canvas-container",n.style.visibility="hidden",n.style.position="fixed",n.style.left="-10000px",n.style.top="0px",n.style.border="0",n.width=t.width.toString(),n.height=t.height.toString(),n.scrolling="no",n.setAttribute("data-html2canvas-ignore","true"),e.body.appendChild(n),n},VB=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},LB=function(e){return Promise.all([].slice.call(e.images,0).map(VB))},HB=function(e){return new Promise((function(t,n){var r=e.contentWindow;if(!r)return n("No window assigned for iframe");var i=r.document;r.onload=e.onload=function(){r.onload=e.onload=null;var n=setInterval((function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(n),t(e))}),50)}}))},NB=["all","d","content"],GB=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e.item(n);-1===NB.indexOf(r)&&t.style.setProperty(r,e.getPropertyValue(r))}return t},jB=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},WB=function(e,t,n){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||n!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,n)},zB=function(e){var t=e[0],n=e[1],r=e[2];t.scrollLeft=n,t.scrollTop=r},XB="___html2canvas___pseudoelement_before",KB="___html2canvas___pseudoelement_after",ZB=function(e){JB(e,"."+XB+':before{\n    content: "" !important;\n    display: none !important;\n}\n         .'+KB+':after{\n    content: "" !important;\n    display: none !important;\n}')},JB=function(e,t){var n=e.ownerDocument;if(n){var r=n.createElement("style");r.textContent=t,e.appendChild(r)}},YB=function(){function e(){}return e.getOrigin=function(t){var n=e._link;return n?(n.href=t,n.href=n.href,n.protocol+n.hostname+n.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),qB=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:sC(e)||nC(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return nm(this,void 0,void 0,(function(){var t,n,r,i,s=this;return rm(this,(function(a){switch(a.label){case 0:return t=YB.isSameOrigin(e),n=!rC(e)&&!0===this._options.useCORS&&Iw.SUPPORT_CORS_IMAGES&&!t,r=!rC(e)&&!t&&!sC(e)&&"string"==typeof this._options.proxy&&Iw.SUPPORT_CORS_XHR&&!n,t||!1!==this._options.allowTaint||rC(e)||sC(e)||r||n?(i=e,r?[4,this.proxy(i)]:[3,2]):[2];case 1:i=a.sent(),a.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var r=new Image;r.onload=function(){return e(r)},r.onerror=t,(iC(i)||n)&&(r.crossOrigin="anonymous"),r.src=i,!0===r.complete&&setTimeout((function(){return e(r)}),500),s._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+s._options.imageTimeout+"ms) loading image")}),s._options.imageTimeout)}))];case 3:return[2,a.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,n=this._options.proxy;if(!n)throw new Error("No proxy defined");var r=e.substring(0,256);return new Promise((function(i,s){var a=Iw.SUPPORT_RESPONSE_TYPE?"blob":"text",o=new XMLHttpRequest;o.onload=function(){if(200===o.status)if("text"===a)i(o.response);else{var e=new FileReader;e.addEventListener("load",(function(){return i(e.result)}),!1),e.addEventListener("error",(function(e){return s(e)}),!1),e.readAsDataURL(o.response)}else s("Failed to proxy resource "+r+" with status code "+o.status)},o.onerror=s;var A=n.indexOf("?")>-1?"&":"?";if(o.open("GET",""+n+A+"url="+encodeURIComponent(e)+"&responseType="+a),"text"!==a&&o instanceof XMLHttpRequest&&(o.responseType=a),t._options.imageTimeout){var c=t._options.imageTimeout;o.timeout=c,o.ontimeout=function(){return s("Timed out ("+c+"ms) proxying "+r)}}o.send()}))},e}(),$B=/^data:image\/svg\+xml/i,eC=/^data:image\/.*;base64,/i,tC=/^data:image\/.*/i,nC=function(e){return Iw.SUPPORT_SVG_DRAWING||!aC(e)},rC=function(e){return tC.test(e)},iC=function(e){return eC.test(e)},sC=function(e){return"blob"===e.substr(0,4)},aC=function(e){return"svg"===e.substr(-3).toLowerCase()||$B.test(e)},oC=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,n){return new e(this.x+t,this.y+n)},e}(),AC=function(e,t,n){return new oC(e.x+(t.x-e.x)*n,e.y+(t.y-e.y)*n)},cC=function(){function e(e,t,n,r){this.type=1,this.start=e,this.startControl=t,this.endControl=n,this.end=r}return e.prototype.subdivide=function(t,n){var r=AC(this.start,this.startControl,t),i=AC(this.startControl,this.endControl,t),s=AC(this.endControl,this.end,t),a=AC(r,i,t),o=AC(i,s,t),A=AC(a,o,t);return n?new e(this.start,r,a,A):new e(A,o,s,this.end)},e.prototype.add=function(t,n){return new e(this.start.add(t,n),this.startControl.add(t,n),this.endControl.add(t,n),this.end.add(t,n))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),lC=function(e){return 1===e.type},uC=function(e){var t=e.styles,n=e.bounds,r=qy(t.borderTopLeftRadius,n.width,n.height),i=r[0],s=r[1],a=qy(t.borderTopRightRadius,n.width,n.height),o=a[0],A=a[1],c=qy(t.borderBottomRightRadius,n.width,n.height),l=c[0],u=c[1],h=qy(t.borderBottomLeftRadius,n.width,n.height),d=h[0],f=h[1],p=[];p.push((i+o)/n.width),p.push((d+l)/n.width),p.push((s+f)/n.height),p.push((A+u)/n.height);var v=Math.max.apply(Math,p);v>1&&(i/=v,s/=v,o/=v,A/=v,l/=v,u/=v,d/=v,f/=v);var g=n.width-o,m=n.height-u,y=n.width-l,_=n.height-f,b=t.borderTopWidth,w=t.borderRightWidth,B=t.borderBottomWidth,C=t.borderLeftWidth,M=$y(t.paddingTop,e.bounds.width),k=$y(t.paddingRight,e.bounds.width),E=$y(t.paddingBottom,e.bounds.width),F=$y(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||s>0?hC(n.left+C/3,n.top+b/3,i-C/3,s-b/3,RB.TOP_LEFT):new oC(n.left+C/3,n.top+b/3),this.topRightBorderDoubleOuterBox=i>0||s>0?hC(n.left+g,n.top+b/3,o-w/3,A-b/3,RB.TOP_RIGHT):new oC(n.left+n.width-w/3,n.top+b/3),this.bottomRightBorderDoubleOuterBox=l>0||u>0?hC(n.left+y,n.top+m,l-w/3,u-B/3,RB.BOTTOM_RIGHT):new oC(n.left+n.width-w/3,n.top+n.height-B/3),this.bottomLeftBorderDoubleOuterBox=d>0||f>0?hC(n.left+C/3,n.top+_,d-C/3,f-B/3,RB.BOTTOM_LEFT):new oC(n.left+C/3,n.top+n.height-B/3),this.topLeftBorderDoubleInnerBox=i>0||s>0?hC(n.left+2*C/3,n.top+2*b/3,i-2*C/3,s-2*b/3,RB.TOP_LEFT):new oC(n.left+2*C/3,n.top+2*b/3),this.topRightBorderDoubleInnerBox=i>0||s>0?hC(n.left+g,n.top+2*b/3,o-2*w/3,A-2*b/3,RB.TOP_RIGHT):new oC(n.left+n.width-2*w/3,n.top+2*b/3),this.bottomRightBorderDoubleInnerBox=l>0||u>0?hC(n.left+y,n.top+m,l-2*w/3,u-2*B/3,RB.BOTTOM_RIGHT):new oC(n.left+n.width-2*w/3,n.top+n.height-2*B/3),this.bottomLeftBorderDoubleInnerBox=d>0||f>0?hC(n.left+2*C/3,n.top+_,d-2*C/3,f-2*B/3,RB.BOTTOM_LEFT):new oC(n.left+2*C/3,n.top+n.height-2*B/3),this.topLeftBorderStroke=i>0||s>0?hC(n.left+C/2,n.top+b/2,i-C/2,s-b/2,RB.TOP_LEFT):new oC(n.left+C/2,n.top+b/2),this.topRightBorderStroke=i>0||s>0?hC(n.left+g,n.top+b/2,o-w/2,A-b/2,RB.TOP_RIGHT):new oC(n.left+n.width-w/2,n.top+b/2),this.bottomRightBorderStroke=l>0||u>0?hC(n.left+y,n.top+m,l-w/2,u-B/2,RB.BOTTOM_RIGHT):new oC(n.left+n.width-w/2,n.top+n.height-B/2),this.bottomLeftBorderStroke=d>0||f>0?hC(n.left+C/2,n.top+_,d-C/2,f-B/2,RB.BOTTOM_LEFT):new oC(n.left+C/2,n.top+n.height-B/2),this.topLeftBorderBox=i>0||s>0?hC(n.left,n.top,i,s,RB.TOP_LEFT):new oC(n.left,n.top),this.topRightBorderBox=o>0||A>0?hC(n.left+g,n.top,o,A,RB.TOP_RIGHT):new oC(n.left+n.width,n.top),this.bottomRightBorderBox=l>0||u>0?hC(n.left+y,n.top+m,l,u,RB.BOTTOM_RIGHT):new oC(n.left+n.width,n.top+n.height),this.bottomLeftBorderBox=d>0||f>0?hC(n.left,n.top+_,d,f,RB.BOTTOM_LEFT):new oC(n.left,n.top+n.height),this.topLeftPaddingBox=i>0||s>0?hC(n.left+C,n.top+b,Math.max(0,i-C),Math.max(0,s-b),RB.TOP_LEFT):new oC(n.left+C,n.top+b),this.topRightPaddingBox=o>0||A>0?hC(n.left+Math.min(g,n.width-w),n.top+b,g>n.width+w?0:Math.max(0,o-w),Math.max(0,A-b),RB.TOP_RIGHT):new oC(n.left+n.width-w,n.top+b),this.bottomRightPaddingBox=l>0||u>0?hC(n.left+Math.min(y,n.width-C),n.top+Math.min(m,n.height-B),Math.max(0,l-w),Math.max(0,u-B),RB.BOTTOM_RIGHT):new oC(n.left+n.width-w,n.top+n.height-B),this.bottomLeftPaddingBox=d>0||f>0?hC(n.left+C,n.top+Math.min(_,n.height-B),Math.max(0,d-C),Math.max(0,f-B),RB.BOTTOM_LEFT):new oC(n.left+C,n.top+n.height-B),this.topLeftContentBox=i>0||s>0?hC(n.left+C+F,n.top+b+M,Math.max(0,i-(C+F)),Math.max(0,s-(b+M)),RB.TOP_LEFT):new oC(n.left+C+F,n.top+b+M),this.topRightContentBox=o>0||A>0?hC(n.left+Math.min(g,n.width+C+F),n.top+b+M,g>n.width+C+F?0:o-C+F,A-(b+M),RB.TOP_RIGHT):new oC(n.left+n.width-(w+k),n.top+b+M),this.bottomRightContentBox=l>0||u>0?hC(n.left+Math.min(y,n.width-(C+F)),n.top+Math.min(m,n.height+b+M),Math.max(0,l-(w+k)),u-(B+E),RB.BOTTOM_RIGHT):new oC(n.left+n.width-(w+k),n.top+n.height-(B+E)),this.bottomLeftContentBox=d>0||f>0?hC(n.left+C+F,n.top+_,Math.max(0,d-(C+F)),f-(B+E),RB.BOTTOM_LEFT):new oC(n.left+C+F,n.top+n.height-(B+E))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(RB||(RB={}));var hC=function(e,t,n,r,i){var s=(Math.sqrt(2)-1)/3*4,a=n*s,o=r*s,A=e+n,c=t+r;switch(i){case RB.TOP_LEFT:return new cC(new oC(e,c),new oC(e,c-o),new oC(A-a,t),new oC(A,t));case RB.TOP_RIGHT:return new cC(new oC(e,t),new oC(e+a,t),new oC(A,c-o),new oC(A,c));case RB.BOTTOM_RIGHT:return new cC(new oC(A,t),new oC(A,t+o),new oC(e+a,c),new oC(e,c));case RB.BOTTOM_LEFT:default:return new cC(new oC(A,c),new oC(A-a,c),new oC(e,t+o),new oC(e,t))}},dC=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},fC=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},pC=function(e,t,n){this.offsetX=e,this.offsetY=t,this.matrix=n,this.type=0,this.target=6},vC=function(e,t){this.path=e,this.target=t,this.type=1},gC=function(e){this.opacity=e,this.type=2,this.target=6},mC=function(e){return 1===e.type},yC=function(e,t){return e.length===t.length&&e.some((function(e,n){return e===t[n]}))},_C=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},bC=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new uC(this.container),this.container.styles.opacity<1&&this.effects.push(new gC(this.container.styles.opacity)),null!==this.container.styles.transform){var n=this.container.bounds.left+this.container.styles.transformOrigin[0].number,r=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new pC(n,r,i))}if(0!==this.container.styles.overflowX){var s=dC(this.curves),a=fC(this.curves);yC(s,a)?this.effects.push(new vC(s,6)):(this.effects.push(new vC(s,2)),this.effects.push(new vC(a,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),n=this.parent,r=this.effects.slice(0);n;){var i=n.effects.filter((function(e){return!mC(e)}));if(t||0!==n.container.styles.position||!n.parent){if(r.unshift.apply(r,i),t=-1===[2,3].indexOf(n.container.styles.position),0!==n.container.styles.overflowX){var s=dC(n.curves),a=fC(n.curves);yC(s,a)||r.unshift(new vC(a,6))}}else r.unshift.apply(r,i);n=n.parent}return r.filter((function(t){return Xb(t.target,e)}))},e}(),wC=function e(t,n,r,i){t.container.elements.forEach((function(s){var a=Xb(s.flags,4),o=Xb(s.flags,2),A=new bC(s,t);Xb(s.styles.display,2048)&&i.push(A);var c=Xb(s.flags,8)?[]:i;if(a||o){var l=a||s.styles.isPositioned()?r:n,u=new _C(A);if(s.styles.isPositioned()||s.styles.opacity<1||s.styles.isTransformed()){var h=s.styles.zIndex.order;if(h<0){var d=0;l.negativeZIndex.some((function(e,t){return h>e.element.container.styles.zIndex.order?(d=t,!1):d>0})),l.negativeZIndex.splice(d,0,u)}else if(h>0){var f=0;l.positiveZIndex.some((function(e,t){return h>=e.element.container.styles.zIndex.order?(f=t+1,!1):f>0})),l.positiveZIndex.splice(f,0,u)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else s.styles.isFloating()?l.nonPositionedFloats.push(u):l.nonPositionedInlineLevel.push(u);e(A,u,a?u:r,c)}else s.styles.isInlineLevel()?n.inlineLevel.push(A):n.nonInlineLevel.push(A),e(A,n,r,c);Xb(s.flags,8)&&BC(s,c)}))},BC=function(e,t){for(var n=e instanceof Xw?e.start:1,r=e instanceof Xw&&e.reversed,i=0;i<t.length;i++){var s=t[i];s.container instanceof zw&&"number"==typeof s.container.value&&0!==s.container.value&&(n=s.container.value),s.listValue=DB(n,s.container.styles.listStyleType,!0),n+=r?-1:1}},CC=function(e){var t=new bC(e,null),n=new _C(t),r=[];return wC(t,n,n,r),BC(t.container,r),n},MC=function(e,t){switch(t){case 0:return EC(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return EC(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return EC(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return EC(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},kC=function(e,t){var n=[];return lC(e)?n.push(e.subdivide(.5,!1)):n.push(e),lC(t)?n.push(t.subdivide(.5,!0)):n.push(t),n},EC=function(e,t,n,r){var i=[];return lC(e)?i.push(e.subdivide(.5,!1)):i.push(e),lC(n)?i.push(n.subdivide(.5,!0)):i.push(n),lC(r)?i.push(r.subdivide(.5,!0).reverse()):i.push(r),lC(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},FC=function(e){var t=e.bounds,n=e.styles;return t.add(n.borderLeftWidth,n.borderTopWidth,-(n.borderRightWidth+n.borderLeftWidth),-(n.borderTopWidth+n.borderBottomWidth))},xC=function(e){var t=e.styles,n=e.bounds,r=$y(t.paddingLeft,n.width),i=$y(t.paddingRight,n.width),s=$y(t.paddingTop,n.width),a=$y(t.paddingBottom,n.width);return n.add(r+t.borderLeftWidth,s+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+r+i),-(t.borderTopWidth+t.borderBottomWidth+s+a))},UC=function(e,t,n){var r=function(e,t){return 0===e?t.bounds:2===e?xC(t):FC(t)}(SC(e.styles.backgroundOrigin,t),e),i=function(e,t){return 0===e?t.bounds:2===e?xC(t):FC(t)}(SC(e.styles.backgroundClip,t),e),s=PC(SC(e.styles.backgroundSize,t),n,r),a=s[0],o=s[1],A=qy(SC(e.styles.backgroundPosition,t),r.width-a,r.height-o);return[DC(SC(e.styles.backgroundRepeat,t),A,s,r,i),Math.round(r.left+A[0]),Math.round(r.top+A[1]),a,o]},IC=function(e){return Vy(e)&&e.value===M_.AUTO},TC=function(e){return"number"==typeof e},PC=function(e,t,n){var r=t[0],i=t[1],s=t[2],a=e[0],o=e[1];if(!a)return[0,0];if(Xy(a)&&o&&Xy(o))return[$y(a,n.width),$y(o,n.height)];var A=TC(s);if(Vy(a)&&(a.value===M_.CONTAIN||a.value===M_.COVER))return TC(s)?n.width/n.height<s!=(a.value===M_.COVER)?[n.width,n.width/s]:[n.height*s,n.height]:[n.width,n.height];var c=TC(r),l=TC(i),u=c||l;if(IC(a)&&(!o||IC(o)))return c&&l?[r,i]:A||u?u&&A?[c?r:i*s,l?i:r/s]:[c?r:n.width,l?i:n.height]:[n.width,n.height];if(A){var h=0,d=0;return Xy(a)?h=$y(a,n.width):Xy(o)&&(d=$y(o,n.height)),IC(a)?h=d*s:o&&!IC(o)||(d=h/s),[h,d]}var f=null,p=null;if(Xy(a)?f=$y(a,n.width):o&&Xy(o)&&(p=$y(o,n.height)),null===f||o&&!IC(o)||(p=c&&l?f/r*i:n.height),null!==p&&IC(a)&&(f=c&&l?p/i*r:n.width),null!==f&&null!==p)return[f,p];throw new Error("Unable to calculate background-size for element")},SC=function(e,t){var n=e[t];return void 0===n?e[0]:n},DC=function(e,t,n,r,i){var s=t[0],a=t[1],o=n[0],A=n[1];switch(e){case 2:return[new oC(Math.round(r.left),Math.round(r.top+a)),new oC(Math.round(r.left+r.width),Math.round(r.top+a)),new oC(Math.round(r.left+r.width),Math.round(A+r.top+a)),new oC(Math.round(r.left),Math.round(A+r.top+a))];case 3:return[new oC(Math.round(r.left+s),Math.round(r.top)),new oC(Math.round(r.left+s+o),Math.round(r.top)),new oC(Math.round(r.left+s+o),Math.round(r.height+r.top)),new oC(Math.round(r.left+s),Math.round(r.height+r.top))];case 1:return[new oC(Math.round(r.left+s),Math.round(r.top+a)),new oC(Math.round(r.left+s+o),Math.round(r.top+a)),new oC(Math.round(r.left+s+o),Math.round(r.top+a+A)),new oC(Math.round(r.left+s),Math.round(r.top+a+A))];default:return[new oC(Math.round(i.left),Math.round(i.top)),new oC(Math.round(i.left+i.width),Math.round(i.top)),new oC(Math.round(i.left+i.width),Math.round(i.height+i.top)),new oC(Math.round(i.left),Math.round(i.height+i.top))]}},QC=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var n=this._document.createElement("div"),r=this._document.createElement("img"),i=this._document.createElement("span"),s=this._document.body;n.style.visibility="hidden",n.style.fontFamily=e,n.style.fontSize=t,n.style.margin="0",n.style.padding="0",n.style.whiteSpace="nowrap",s.appendChild(n),r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",r.width=1,r.height=1,r.style.margin="0",r.style.padding="0",r.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode("Hidden Text")),n.appendChild(i),n.appendChild(r);var a=r.offsetTop-i.offsetTop+2;n.removeChild(i),n.appendChild(this._document.createTextNode("Hidden Text")),n.style.lineHeight="normal",r.style.verticalAlign="super";var o=r.offsetTop-n.offsetTop+2;return s.removeChild(n),{baseline:a,middle:o}},e.prototype.getMetrics=function(e,t){var n=e+" "+t;return void 0===this._data[n]&&(this._data[n]=this.parseMetrics(e,t)),this._data[n]},e}(),RC=function(e,t){this.context=e,this.options=t},OC=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r._activeEffects=[],r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),n.canvas||(r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px"),r.fontMetrics=new QC(document),r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.ctx.textBaseline="bottom",r._activeEffects=[],r.context.logger.debug("Canvas renderer initialized ("+n.width+"x"+n.height+") with scale "+n.scale),r}return em(t,e),t.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},t.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),mC(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return nm(this,void 0,void 0,(function(){return rm(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.renderNode=function(e){return nm(this,void 0,void 0,(function(){return rm(this,(function(t){switch(t.label){case 0:return Xb(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.renderTextWithLetterSpacing=function(e,t,n){var r=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+n):Dw(e.text).reduce((function(t,i){return r.ctx.fillText(i,t,e.bounds.top+n),t+r.ctx.measureText(i).width}),e.bounds.left)},t.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),n=GC(e.fontFamily).join(", "),r=Ry(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,r,n].join(" "),n,r]},t.prototype.renderTextNode=function(e,t){return nm(this,void 0,void 0,(function(){var n,r,i,s,a,o,A,c,l=this;return rm(this,(function(u){return n=this.createFontStyle(t),r=n[0],i=n[1],s=n[2],this.ctx.font=r,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",a=this.fontMetrics.getMetrics(i,s),o=a.baseline,A=a.middle,c=t.paintOrder,e.textBounds.forEach((function(e){c.forEach((function(n){switch(n){case 0:l.ctx.fillStyle=a_(t.color),l.renderTextWithLetterSpacing(e,t.letterSpacing,o);var r=t.textShadow;r.length&&e.text.trim().length&&(r.slice(0).reverse().forEach((function(n){l.ctx.shadowColor=a_(n.color),l.ctx.shadowOffsetX=n.offsetX.number*l.options.scale,l.ctx.shadowOffsetY=n.offsetY.number*l.options.scale,l.ctx.shadowBlur=n.blur.number,l.renderTextWithLetterSpacing(e,t.letterSpacing,o)})),l.ctx.shadowColor="",l.ctx.shadowOffsetX=0,l.ctx.shadowOffsetY=0,l.ctx.shadowBlur=0),t.textDecorationLine.length&&(l.ctx.fillStyle=a_(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:l.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+o),e.bounds.width,1);break;case 2:l.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:l.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+A),e.bounds.width,1)}})));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(l.ctx.strokeStyle=a_(t.webkitTextStrokeColor),l.ctx.lineWidth=t.webkitTextStrokeWidth,l.ctx.lineJoin=window.chrome?"miter":"round",l.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+o)),l.ctx.strokeStyle="",l.ctx.lineWidth=0,l.ctx.lineJoin="miter"}}))})),[2]}))}))},t.prototype.renderReplacedElement=function(e,t,n){if(n&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var r=xC(e),i=fC(t);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(n,0,0,e.intrinsicWidth,e.intrinsicHeight,r.left,r.top,r.width,r.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return nm(this,void 0,void 0,(function(){var n,r,i,s,a,o,A,c,l,u,h,d,f,p,v,g,m,y;return rm(this,(function(_){switch(_.label){case 0:this.applyEffects(e.getEffects(4)),n=e.container,r=e.curves,i=n.styles,s=0,a=n.textNodes,_.label=1;case 1:return s<a.length?(o=a[s],[4,this.renderTextNode(o,i)]):[3,4];case 2:_.sent(),_.label=3;case 3:return s++,[3,1];case 4:if(!(n instanceof Gw))return[3,8];_.label=5;case 5:return _.trys.push([5,7,,8]),[4,this.context.cache.match(n.src)];case 6:return v=_.sent(),this.renderReplacedElement(n,r,v),[3,8];case 7:return _.sent(),this.context.logger.error("Error loading image "+n.src),[3,8];case 8:if(n instanceof jw&&this.renderReplacedElement(n,r,n.canvas),!(n instanceof Ww))return[3,12];_.label=9;case 9:return _.trys.push([9,11,,12]),[4,this.context.cache.match(n.svg)];case 10:return v=_.sent(),this.renderReplacedElement(n,r,v),[3,12];case 11:return _.sent(),this.context.logger.error("Error loading svg "+n.svg.substring(0,255)),[3,12];case 12:return n instanceof eB&&n.tree?[4,new t(this.context,{scale:this.options.scale,backgroundColor:n.backgroundColor,x:0,y:0,width:n.width,height:n.height}).render(n.tree)]:[3,14];case 13:A=_.sent(),n.width&&n.height&&this.ctx.drawImage(A,0,0,n.width,n.height,n.bounds.left,n.bounds.top,n.bounds.width,n.bounds.height),_.label=14;case 14:if(n instanceof Yw&&(c=Math.min(n.bounds.width,n.bounds.height),"checkbox"===n.type?n.checked&&(this.ctx.save(),this.path([new oC(n.bounds.left+.39363*c,n.bounds.top+.79*c),new oC(n.bounds.left+.16*c,n.bounds.top+.5549*c),new oC(n.bounds.left+.27347*c,n.bounds.top+.44071*c),new oC(n.bounds.left+.39694*c,n.bounds.top+.5649*c),new oC(n.bounds.left+.72983*c,n.bounds.top+.23*c),new oC(n.bounds.left+.84*c,n.bounds.top+.34085*c),new oC(n.bounds.left+.39363*c,n.bounds.top+.79*c)]),this.ctx.fillStyle=a_(707406591),this.ctx.fill(),this.ctx.restore()):"radio"===n.type&&n.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(n.bounds.left+c/2,n.bounds.top+c/2,c/4,0,2*Math.PI,!0),this.ctx.fillStyle=a_(707406591),this.ctx.fill(),this.ctx.restore())),VC(n)&&n.value.length){switch(l=this.createFontStyle(i),m=l[0],u=l[1],h=this.fontMetrics.getMetrics(m,u).baseline,this.ctx.font=m,this.ctx.fillStyle=a_(i.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=HC(n.styles.textAlign),y=xC(n),d=0,n.styles.textAlign){case 1:d+=y.width/2;break;case 2:d+=y.width}f=y.add(d,0,0,-y.height/2+1),this.ctx.save(),this.path([new oC(y.left,y.top),new oC(y.left+y.width,y.top),new oC(y.left+y.width,y.top+y.height),new oC(y.left,y.top+y.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Tw(n.value,f),i.letterSpacing,h),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Xb(n.styles.display,2048))return[3,20];if(null===n.styles.listStyleImage)return[3,19];if(0!==(p=n.styles.listStyleImage).type)return[3,18];v=void 0,g=p.url,_.label=15;case 15:return _.trys.push([15,17,,18]),[4,this.context.cache.match(g)];case 16:return v=_.sent(),this.ctx.drawImage(v,n.bounds.left-(v.width+10),n.bounds.top),[3,18];case 17:return _.sent(),this.context.logger.error("Error loading list-style-image "+g),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==n.styles.listStyleType&&(m=this.createFontStyle(i)[0],this.ctx.font=m,this.ctx.fillStyle=a_(i.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",y=new sm(n.bounds.left,n.bounds.top+$y(n.styles.paddingTop,n.bounds.width),n.bounds.width,lb(i.lineHeight,i.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Tw(e.listValue,y),i.letterSpacing,lb(i.lineHeight,i.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),_.label=20;case 20:return[2]}}))}))},t.prototype.renderStackContent=function(e){return nm(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,A,c,l,u,h,d,f,p;return rm(this,(function(v){switch(v.label){case 0:return Xb(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:v.sent(),t=0,n=e.negativeZIndex,v.label=2;case 2:return t<n.length?(p=n[t],[4,this.renderStack(p)]):[3,5];case 3:v.sent(),v.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:v.sent(),r=0,i=e.nonInlineLevel,v.label=7;case 7:return r<i.length?(p=i[r],[4,this.renderNode(p)]):[3,10];case 8:v.sent(),v.label=9;case 9:return r++,[3,7];case 10:s=0,a=e.nonPositionedFloats,v.label=11;case 11:return s<a.length?(p=a[s],[4,this.renderStack(p)]):[3,14];case 12:v.sent(),v.label=13;case 13:return s++,[3,11];case 14:o=0,A=e.nonPositionedInlineLevel,v.label=15;case 15:return o<A.length?(p=A[o],[4,this.renderStack(p)]):[3,18];case 16:v.sent(),v.label=17;case 17:return o++,[3,15];case 18:c=0,l=e.inlineLevel,v.label=19;case 19:return c<l.length?(p=l[c],[4,this.renderNode(p)]):[3,22];case 20:v.sent(),v.label=21;case 21:return c++,[3,19];case 22:u=0,h=e.zeroOrAutoZIndexOrTransformedOrOpacity,v.label=23;case 23:return u<h.length?(p=h[u],[4,this.renderStack(p)]):[3,26];case 24:v.sent(),v.label=25;case 25:return u++,[3,23];case 26:d=0,f=e.positiveZIndex,v.label=27;case 27:return d<f.length?(p=f[d],[4,this.renderStack(p)]):[3,30];case 28:v.sent(),v.label=29;case 29:return d++,[3,27];case 30:return[2]}}))}))},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var t=this;e.forEach((function(e,n){var r=lC(e)?e.start:e;0===n?t.ctx.moveTo(r.x,r.y):t.ctx.lineTo(r.x,r.y),lC(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},t.prototype.renderRepeat=function(e,t,n,r){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(n,r),this.ctx.fill(),this.ctx.translate(-n,-r)},t.prototype.resizeImage=function(e,t,n){var r;if(e.width===t&&e.height===n)return e;var i=(null!==(r=this.canvas.ownerDocument)&&void 0!==r?r:document).createElement("canvas");return i.width=Math.max(1,t),i.height=Math.max(1,n),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,n),i},t.prototype.renderBackgroundImage=function(e){return nm(this,void 0,void 0,(function(){var t,n,r,i,s,a;return rm(this,(function(o){switch(o.label){case 0:t=e.styles.backgroundImage.length-1,n=function(n){var i,s,a,o,A,c,l,u,h,d,f,p,v,g,m,y,_,b,w,B,C,M,k,E,F,x,U,I,T,P,S;return rm(this,(function(D){switch(D.label){case 0:if(0!==n.type)return[3,5];i=void 0,s=n.url,D.label=1;case 1:return D.trys.push([1,3,,4]),[4,r.context.cache.match(s)];case 2:return i=D.sent(),[3,4];case 3:return D.sent(),r.context.logger.error("Error loading background-image "+s),[3,4];case 4:return i&&(a=UC(e,t,[i.width,i.height,i.width/i.height]),y=a[0],M=a[1],k=a[2],w=a[3],B=a[4],g=r.ctx.createPattern(r.resizeImage(i,w,B),"repeat"),r.renderRepeat(y,g,M,k)),[3,6];case 5:1===n.type?(o=UC(e,t,[null,null,null]),y=o[0],M=o[1],k=o[2],w=o[3],B=o[4],A=y_(n.angle,w,B),c=A[0],l=A[1],u=A[2],h=A[3],d=A[4],(f=document.createElement("canvas")).width=w,f.height=B,p=f.getContext("2d"),v=p.createLinearGradient(l,h,u,d),m_(n.stops,c).forEach((function(e){return v.addColorStop(e.stop,a_(e.color))})),p.fillStyle=v,p.fillRect(0,0,w,B),w>0&&B>0&&(g=r.ctx.createPattern(f,"repeat"),r.renderRepeat(y,g,M,k))):function(e){return 2===e.type}(n)&&(m=UC(e,t,[null,null,null]),y=m[0],_=m[1],b=m[2],w=m[3],B=m[4],C=0===n.position.length?[Jy]:n.position,M=$y(C[0],w),k=$y(C[C.length-1],B),E=function(e,t,n,r,i){var s=0,a=0;switch(e.size){case 0:0===e.shape?s=a=Math.min(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(s=Math.min(Math.abs(t),Math.abs(t-r)),a=Math.min(Math.abs(n),Math.abs(n-i)));break;case 2:if(0===e.shape)s=a=Math.min(__(t,n),__(t,n-i),__(t-r,n),__(t-r,n-i));else if(1===e.shape){var o=Math.min(Math.abs(n),Math.abs(n-i))/Math.min(Math.abs(t),Math.abs(t-r)),A=b_(r,i,t,n,!0),c=A[0],l=A[1];a=o*(s=__(c-t,(l-n)/o))}break;case 1:0===e.shape?s=a=Math.max(Math.abs(t),Math.abs(t-r),Math.abs(n),Math.abs(n-i)):1===e.shape&&(s=Math.max(Math.abs(t),Math.abs(t-r)),a=Math.max(Math.abs(n),Math.abs(n-i)));break;case 3:if(0===e.shape)s=a=Math.max(__(t,n),__(t,n-i),__(t-r,n),__(t-r,n-i));else if(1===e.shape){o=Math.max(Math.abs(n),Math.abs(n-i))/Math.max(Math.abs(t),Math.abs(t-r));var u=b_(r,i,t,n,!1);c=u[0],l=u[1],a=o*(s=__(c-t,(l-n)/o))}}return Array.isArray(e.size)&&(s=$y(e.size[0],r),a=2===e.size.length?$y(e.size[1],i):s),[s,a]}(n,M,k,w,B),F=E[0],x=E[1],F>0&&x>0&&(U=r.ctx.createRadialGradient(_+M,b+k,0,_+M,b+k,F),m_(n.stops,2*F).forEach((function(e){return U.addColorStop(e.stop,a_(e.color))})),r.path(y),r.ctx.fillStyle=U,F!==x?(I=e.bounds.left+.5*e.bounds.width,T=e.bounds.top+.5*e.bounds.height,S=1/(P=x/F),r.ctx.save(),r.ctx.translate(I,T),r.ctx.transform(1,0,0,P,0,0),r.ctx.translate(-I,-T),r.ctx.fillRect(_,S*(b-T)+T,w,B*S),r.ctx.restore()):r.ctx.fill())),D.label=6;case 6:return t--,[2]}}))},r=this,i=0,s=e.styles.backgroundImage.slice(0).reverse(),o.label=1;case 1:return i<s.length?(a=s[i],[5,n(a)]):[3,4];case 2:o.sent(),o.label=3;case 3:return i++,[3,1];case 4:return[2]}}))}))},t.prototype.renderSolidBorder=function(e,t,n){return nm(this,void 0,void 0,(function(){return rm(this,(function(r){return this.path(MC(n,t)),this.ctx.fillStyle=a_(e),this.ctx.fill(),[2]}))}))},t.prototype.renderDoubleBorder=function(e,t,n,r){return nm(this,void 0,void 0,(function(){var i,s;return rm(this,(function(a){switch(a.label){case 0:return t<3?[4,this.renderSolidBorder(e,n,r)]:[3,2];case 1:return a.sent(),[2];case 2:return i=function(e,t){switch(t){case 0:return EC(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return EC(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return EC(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return EC(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(r,n),this.path(i),this.ctx.fillStyle=a_(e),this.ctx.fill(),s=function(e,t){switch(t){case 0:return EC(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return EC(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return EC(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return EC(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(r,n),this.path(s),this.ctx.fill(),[2]}}))}))},t.prototype.renderNodeBackgroundAndBorders=function(e){return nm(this,void 0,void 0,(function(){var t,n,r,i,s,a,o,A,c=this;return rm(this,(function(l){switch(l.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,n=!s_(t.backgroundColor)||t.backgroundImage.length,r=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],i=LC(SC(t.backgroundClip,0),e.curves),n||t.boxShadow.length?(this.ctx.save(),this.path(i),this.ctx.clip(),s_(t.backgroundColor)||(this.ctx.fillStyle=a_(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:l.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){c.ctx.save();var n,r,i,s,a,o=dC(e.curves),A=t.inset?0:1e4,l=(n=o,r=-A+(t.inset?1:-1)*t.spread.number,i=(t.inset?1:-1)*t.spread.number,s=t.spread.number*(t.inset?-2:2),a=t.spread.number*(t.inset?-2:2),n.map((function(e,t){switch(t){case 0:return e.add(r,i);case 1:return e.add(r+s,i);case 2:return e.add(r+s,i+a);case 3:return e.add(r,i+a)}return e})));t.inset?(c.path(o),c.ctx.clip(),c.mask(l)):(c.mask(o),c.ctx.clip(),c.path(l)),c.ctx.shadowOffsetX=t.offsetX.number+A,c.ctx.shadowOffsetY=t.offsetY.number,c.ctx.shadowColor=a_(t.color),c.ctx.shadowBlur=t.blur.number,c.ctx.fillStyle=t.inset?a_(t.color):"rgba(0,0,0,1)",c.ctx.fill(),c.ctx.restore()})),l.label=2;case 2:s=0,a=0,o=r,l.label=3;case 3:return a<o.length?0!==(A=o[a]).style&&!s_(A.color)&&A.width>0?2!==A.style?[3,5]:[4,this.renderDashedDottedBorder(A.color,A.width,s,e.curves,2)]:[3,11]:[3,13];case 4:return l.sent(),[3,11];case 5:return 3!==A.style?[3,7]:[4,this.renderDashedDottedBorder(A.color,A.width,s,e.curves,3)];case 6:return l.sent(),[3,11];case 7:return 4!==A.style?[3,9]:[4,this.renderDoubleBorder(A.color,A.width,s,e.curves)];case 8:return l.sent(),[3,11];case 9:return[4,this.renderSolidBorder(A.color,s,e.curves)];case 10:l.sent(),l.label=11;case 11:s++,l.label=12;case 12:return a++,[3,3];case 13:return[2]}}))}))},t.prototype.renderDashedDottedBorder=function(e,t,n,r,i){return nm(this,void 0,void 0,(function(){var s,a,o,A,c,l,u,h,d,f,p,v,g,m,y,_;return rm(this,(function(b){return this.ctx.save(),s=function(e,t){switch(t){case 0:return kC(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return kC(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return kC(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return kC(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(r,n),a=MC(r,n),2===i&&(this.path(a),this.ctx.clip()),lC(a[0])?(o=a[0].start.x,A=a[0].start.y):(o=a[0].x,A=a[0].y),lC(a[1])?(c=a[1].end.x,l=a[1].end.y):(c=a[1].x,l=a[1].y),u=0===n||2===n?Math.abs(o-c):Math.abs(A-l),this.ctx.beginPath(),3===i?this.formatPath(s):this.formatPath(a.slice(0,2)),h=t<3?3*t:2*t,d=t<3?2*t:t,3===i&&(h=t,d=t),f=!0,u<=2*h?f=!1:u<=2*h+d?(h*=p=u/(2*h+d),d*=p):(v=Math.floor((u+d)/(h+d)),g=(u-v*h)/(v-1),d=(m=(u-(v+1)*h)/v)<=0||Math.abs(d-g)<Math.abs(d-m)?g:m),f&&(3===i?this.ctx.setLineDash([0,h+d]):this.ctx.setLineDash([h,d])),3===i?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=a_(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===i&&(lC(a[0])&&(y=a[3],_=a[0],this.ctx.beginPath(),this.formatPath([new oC(y.end.x,y.end.y),new oC(_.start.x,_.start.y)]),this.ctx.stroke()),lC(a[1])&&(y=a[1],_=a[2],this.ctx.beginPath(),this.formatPath([new oC(y.end.x,y.end.y),new oC(_.start.x,_.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},t.prototype.render=function(e){return nm(this,void 0,void 0,(function(){var t;return rm(this,(function(n){switch(n.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=a_(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=CC(e),[4,this.renderStack(t)];case 1:return n.sent(),this.applyEffects([]),[2,this.canvas]}}))}))},t}(RC),VC=function(e){return e instanceof $w||(e instanceof qw||e instanceof Yw&&"radio"!==e.type&&"checkbox"!==e.type)},LC=function(e,t){switch(e){case 0:return dC(t);case 2:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);default:return fC(t)}},HC=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},NC=["-apple-system","system-ui"],GC=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter((function(e){return-1===NC.indexOf(e)})):e},jC=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.canvas=n.canvas?n.canvas:document.createElement("canvas"),r.ctx=r.canvas.getContext("2d"),r.options=n,r.canvas.width=Math.floor(n.width*n.scale),r.canvas.height=Math.floor(n.height*n.scale),r.canvas.style.width=n.width+"px",r.canvas.style.height=n.height+"px",r.ctx.scale(r.options.scale,r.options.scale),r.ctx.translate(-n.x,-n.y),r.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+n.width+"x"+n.height+" at "+n.x+","+n.y+") with scale "+n.scale),r}return em(t,e),t.prototype.render=function(e){return nm(this,void 0,void 0,(function(){var t,n;return rm(this,(function(r){switch(r.label){case 0:return t=xw(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,WC(t)];case 1:return n=r.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=a_(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(n,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},t}(RC),WC=function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.onerror=n,r.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},zC=function(){function e(e){var t=e.id,n=e.enabled;this.id=t,this.enabled=n,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,im([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,im([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,im([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,im([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),XC=function(){function e(t,n){var r;this.windowBounds=n,this.instanceName="#"+e.instanceCount++,this.logger=new zC({id:this.instanceName,enabled:t.logging}),this.cache=null!==(r=t.cache)&&void 0!==r?r:new qB(this,t)}return e.instanceCount=1,e}(),KC=function(e,t){return void 0===t&&(t={}),ZC(e,t)};"undefined"!=typeof window&&YB.setContext(window);var ZC=function(e,t){return nm(void 0,void 0,void 0,(function(){var n,r,i,s,a,o,A,c,l,u,h,d,f,p,v,g,m,y,_,b,w,B,C,k,E,F,x,U,I,T,P,S,D,Q,R,O,V,L;return rm(this,(function(H){switch(H.label){case 0:if(!e||"object"!==M(e))return[2,Promise.reject("Invalid element provided as first argument")];if(!(n=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(r=n.defaultView))throw new Error("Document is not attached to a Window");return i={allowTaint:null!==(B=t.allowTaint)&&void 0!==B&&B,imageTimeout:null!==(C=t.imageTimeout)&&void 0!==C?C:15e3,proxy:t.proxy,useCORS:null!==(k=t.useCORS)&&void 0!==k&&k},s=tm({logging:null===(E=t.logging)||void 0===E||E,cache:t.cache},i),a={windowWidth:null!==(F=t.windowWidth)&&void 0!==F?F:r.innerWidth,windowHeight:null!==(x=t.windowHeight)&&void 0!==x?x:r.innerHeight,scrollX:null!==(U=t.scrollX)&&void 0!==U?U:r.pageXOffset,scrollY:null!==(I=t.scrollY)&&void 0!==I?I:r.pageYOffset},o=new sm(a.scrollX,a.scrollY,a.windowWidth,a.windowHeight),A=new XC(s,o),c=null!==(T=t.foreignObjectRendering)&&void 0!==T&&T,l={allowTaint:null!==(P=t.allowTaint)&&void 0!==P&&P,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:c,copyStyles:c},A.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),u=new QB(A,e,l),(h=u.clonedReferenceElement)?[4,u.toIFrame(n,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return d=H.sent(),f=pB(h)||"HTML"===h.tagName?function(e){var t=e.body,n=e.documentElement;if(!t||!n)throw new Error("Unable to get document size");var r=Math.max(Math.max(t.scrollWidth,n.scrollWidth),Math.max(t.offsetWidth,n.offsetWidth),Math.max(t.clientWidth,n.clientWidth)),i=Math.max(Math.max(t.scrollHeight,n.scrollHeight),Math.max(t.offsetHeight,n.offsetHeight),Math.max(t.clientHeight,n.clientHeight));return new sm(0,0,r,i)}(h.ownerDocument):am(A,h),p=f.width,v=f.height,g=f.left,m=f.top,y=JC(A,h,t.backgroundColor),_={canvas:t.canvas,backgroundColor:y,scale:null!==(D=null!==(S=t.scale)&&void 0!==S?S:r.devicePixelRatio)&&void 0!==D?D:1,x:(null!==(Q=t.x)&&void 0!==Q?Q:0)+g,y:(null!==(R=t.y)&&void 0!==R?R:0)+m,width:null!==(O=t.width)&&void 0!==O?O:Math.ceil(p),height:null!==(V=t.height)&&void 0!==V?V:Math.ceil(v)},c?(A.logger.debug("Document cloned, using foreign object rendering"),[4,new jC(A,_).render(h)]):[3,3];case 2:return b=H.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+g+","+m+" with size "+p+"x"+v+" using computed rendering"),A.logger.debug("Starting DOM parsing"),w=iB(A,h),y===w.styles.backgroundColor&&(w.styles.backgroundColor=f_.TRANSPARENT),A.logger.debug("Starting renderer for element at "+_.x+","+_.y+" with size "+_.width+"x"+_.height),[4,new OC(A,_).render(w)];case 4:b=H.sent(),H.label=5;case 5:return(null===(L=t.removeContainer)||void 0===L||L)&&(QB.destroy(d)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,b]}}))}))},JC=function(e,t,n){var r=t.ownerDocument,i=r.documentElement?d_(e,getComputedStyle(r.documentElement).backgroundColor):f_.TRANSPARENT,s=r.body?d_(e,getComputedStyle(r.body).backgroundColor):f_.TRANSPARENT,a="string"==typeof n?d_(e,n):null===n?f_.TRANSPARENT:4294967295;return t===r.documentElement?s_(i)?s_(s)?a:s:i:a};function YC(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e&&t){var r,i,s=null,a=500,o=3,A=function(e){if(e.preventDefault(),s&&(clearTimeout(s),s=null),!(e.touches.length>1)){var n=e.touches[0];r=n.clientX,i=n.clientY,s=setTimeout((function(){e.clientX=n.clientX,e.clientY=n.clientY,t(e),clearTimeout(s),s=null}),a)}},c=function(e){e.touches.length>1&&s&&(clearTimeout(s),s=null)},l=function(e){if(s){var t=e.touches[0],n=Math.abs(t.clientX-r),a=Math.abs(t.clientY-i);(n>o||a>o)&&(clearTimeout(s),s=null)}},u=function(e){e.preventDefault(),s&&(n(e),clearTimeout(s),s=null)},h=function(e){t(e),e.preventDefault(),e.stopPropagation()};return lA.isIphoneOrIpadSafari()?(e.addEventListener("touchstart",A),e.addEventListener("touchmove",l),e.addEventListener("touchend",u),window.addEventListener("touchstart",c)):e.addEventListener("contextmenu",h),function(){lA.isIphoneOrIpadSafari()?(e.removeEventListener("touchstart",A),e.removeEventListener("touchmove",l),e.removeEventListener("touchend",u),window.removeEventListener("touchstart",c)):e.removeEventListener("contextmenu",h)}}}var qC=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this._highlightClass="viewer-ruler-dot-highlighted",this._x=0,this._y=0,this._dot=document.createElement("div"),this._dot.className+=this._dot.className?" viewer-ruler-dot":"viewer-ruler-dot",this._dotClickable=document.createElement("div"),this._dotClickable.className+=this._dotClickable.className?" viewer-ruler-dot-clickable":"viewer-ruler-dot-clickable",this._visible=!1!==r.visible,this._culled=!1;var i=this._dot,s=i.style;s["border-radius"]="25px",s.border="solid 2px white",s.background="lightgreen",s.position="absolute",s["z-index"]=void 0===r.zIndex?"40000005":r.zIndex,s.width="8px",s.height="8px",s.visibility=this._visible?"visible":"hidden",s.top="0px",s.left="0px",s["box-shadow"]="0 2px 5px 0 #182A3D;",s.opacity=1,s["pointer-events"]="none",r.onContextMenu,t.appendChild(i);var a=this._dotClickable,o=a.style;if(o["border-radius"]="35px",o.border="solid 10px white",o.position="absolute",o["z-index"]=void 0===r.zIndex?"40000007":r.zIndex+1,o.width="8px",o.height="8px",o.visibility="visible",o.top="0px",o.left="0px",o.opacity=0,o["pointer-events"]="none",r.onContextMenu,t.appendChild(a),a.addEventListener("click",(function(e){t.dispatchEvent(new MouseEvent("mouseover",e))})),r.onMouseOver&&a.addEventListener("mouseover",(function(e){r.onMouseOver(e,n),t.dispatchEvent(new MouseEvent("mouseover",e))})),r.onMouseLeave&&a.addEventListener("mouseleave",(function(e){r.onMouseLeave(e,n)})),r.onMouseWheel&&a.addEventListener("wheel",(function(e){r.onMouseWheel(e,n)})),r.onMouseDown&&a.addEventListener("mousedown",(function(e){r.onMouseDown(e,n)})),r.onMouseUp&&a.addEventListener("mouseup",(function(e){r.onMouseUp(e,n)})),r.onMouseMove&&a.addEventListener("mousemove",(function(e){r.onMouseMove(e,n)})),r.onTouchstart&&a.addEventListener("touchstart",(function(e){r.onTouchstart(e,n)})),r.onTouchmove&&a.addEventListener("touchmove",(function(e){r.onTouchmove(e,n)})),r.onTouchend&&a.addEventListener("touchend",(function(e){r.onTouchend(e,n)})),r.onContextMenu){var A=function(e){r.onContextMenu(e,n)};YC(a,A)}this.setPos(r.x||0,r.y||0),this.setFillColor(r.fillColor),this.setBorderColor(r.borderColor)}return I(e,[{key:"setPos",value:function(e,t){this._x=e,this._y=t;var n=this._dot.style;n.left=Math.round(e)-6+"px",n.top=Math.round(t)-6+"px";var r=this._dotClickable.style;r.left=Math.round(e)-14+"px",r.top=Math.round(t)-14+"px"}},{key:"setFillColor",value:function(e){this._dot.style.background=e||"lightgreen"}},{key:"setBorderColor",value:function(e){this._dot.style.border="solid 2px"+(e||"black")}},{key:"setOpacity",value:function(e){this._dot.style.opacity=e}},{key:"_updateVisibility",value:function(){this._dot.style.visibility=this._dotClickable.style.visibility=this._visible&&!this._culled?"visible":"hidden"}},{key:"setVisible",value:function(e){this._visible!==e&&(this._visible=!!e,this._updateVisibility())}},{key:"setCulled",value:function(e){this._culled!==e&&(this._culled=!!e,this._updateVisibility())}},{key:"setClickable",value:function(e){this._dotClickable.style["pointer-events"]=e?"all":"none"}},{key:"setHighlighted",value:function(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._dot.classList.add(this._highlightClass):this._dot.classList.remove(this._highlightClass))}},{key:"destroy",value:function(){this.setVisible(!1),this._dot.parentElement&&this._dot.parentElement.removeChild(this._dot),this._dotClickable.parentElement&&this._dotClickable.parentElement.removeChild(this._dotClickable)}}]),e}(),$C=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this._highlightClass="viewer-ruler-label-highlighted",this._prefix=r.prefix||"",this._x=0,this._y=0,this._visible=!0,this._culled=!1,this._label=document.createElement("div"),this._label.className+=this._label.className?" viewer-ruler-label":"viewer-ruler-label",this._timeout=null;var i=this._label,s=i.style;if(s["border-radius"]="5px",s.color="white",s.padding="4px",s.border="solid 1px",s.background="lightgreen",s.position="absolute",s["z-index"]=void 0===r.zIndex?"5000005":r.zIndex,s.width="auto",s.height="auto",s.visibility="visible",s.top="0px",s.left="0px",s["pointer-events"]="all",s.opacity=1,r.onContextMenu,i.innerText="",t.appendChild(i),this.setPos(r.x||0,r.y||0),this.setFillColor(r.fillColor),this.setBorderColor(r.fillColor),this.setText(r.text),r.onMouseOver&&i.addEventListener("mouseover",(function(e){r.onMouseOver(e,n),e.preventDefault()})),r.onMouseLeave&&i.addEventListener("mouseleave",(function(e){r.onMouseLeave(e,n),e.preventDefault()})),r.onMouseWheel&&i.addEventListener("wheel",(function(e){r.onMouseWheel(e,n)})),r.onMouseDown&&i.addEventListener("mousedown",(function(e){r.onMouseDown(e,n),e.stopPropagation()})),r.onMouseUp&&i.addEventListener("mouseup",(function(e){r.onMouseUp(e,n),e.stopPropagation()})),r.onMouseMove&&i.addEventListener("mousemove",(function(e){r.onMouseMove(e,n)})),r.onContextMenu){var a=function(e){r.onContextMenu(e,n)};YC(i,a)}}return I(e,[{key:"setPos",value:function(e,t){this._x=e,this._y=t;var n=this._label.style;n.left=Math.round(e)-20+"px",n.top=Math.round(t)-12+"px"}},{key:"setPosOnWire",value:function(e,t,n,r){var i=e+.5*(n-e),s=t+.5*(r-t),a=this._label.style;a.left=Math.round(i)-20+"px",a.top=Math.round(s)-12+"px"}},{key:"setPosBetweenWires",value:function(e,t,n,r,i,s){var a=(e+n+i)/3,o=(t+r+s)/3,A=this._label.style;A.left=Math.round(a)-20+"px",A.top=Math.round(o)-12+"px"}},{key:"setText",value:function(e){this._label.innerHTML=this._prefix+(e||"")}},{key:"setFillColor",value:function(e){this._fillColor=e||"lightgreen",this._label.style.background=this._fillColor}},{key:"setBorderColor",value:function(e){this._borderColor=e||"black",this._label.style.border="solid 1px "+this._borderColor}},{key:"setOpacity",value:function(e){this._label.style.opacity=e}},{key:"_updateVisibility",value:function(){this._label.style.visibility=this._visible&&!this._culled?"visible":"hidden"}},{key:"setVisible",value:function(e){this._visible!==e&&(this._visible=!!e,this._updateVisibility())}},{key:"setCulled",value:function(e){this._culled!==e&&(this._culled=!!e,this._updateVisibility())}},{key:"setHighlighted",value:function(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._label.classList.add(this._highlightClass):this._label.classList.remove(this._highlightClass))}},{key:"setClickable",value:function(e){this._label.style["pointer-events"]=e?"all":"none"}},{key:"setPrefix",value:function(e){this._prefix!==e&&(this._prefix=e)}},{key:"destroy",value:function(){this._label.parentElement&&this._label.parentElement.removeChild(this._label)}}]),e}(),eM=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this._color=r.color||"black",this._highlightClass="viewer-ruler-wire-highlighted",this._wire=document.createElement("div"),this._wire.className+=this._wire.className?" viewer-ruler-wire":"viewer-ruler-wire",this._wireClickable=document.createElement("div"),this._wireClickable.className+=this._wireClickable.className?" viewer-ruler-wire-clickable":"viewer-ruler-wire-clickable",this._thickness=r.thickness||1,this._thicknessClickable=r.thicknessClickable||6,this._visible=!0,this._culled=!1;var i=this._wire,s=i.style;s.border="solid "+this._thickness+"px "+this._color,s.position="absolute",s["z-index"]=void 0===r.zIndex?"2000001":r.zIndex,s.width="0px",s.height="0px",s.visibility="visible",s.top="0px",s.left="0px",s["-webkit-transform-origin"]="0 0",s["-moz-transform-origin"]="0 0",s["-ms-transform-origin"]="0 0",s["-o-transform-origin"]="0 0",s["transform-origin"]="0 0",s["-webkit-transform"]="rotate(0deg)",s["-moz-transform"]="rotate(0deg)",s["-ms-transform"]="rotate(0deg)",s["-o-transform"]="rotate(0deg)",s.transform="rotate(0deg)",s.opacity=1,s["pointer-events"]="none",r.onContextMenu,t.appendChild(i);var a=this._wireClickable,o=a.style;if(o.border="solid "+this._thicknessClickable+"px "+this._color,o.position="absolute",o["z-index"]=void 0===r.zIndex?"2000002":r.zIndex+1,o.width="0px",o.height="0px",o.visibility="visible",o.top="0px",o.left="0px",o["-webkit-transform-origin"]="0 0",o["-moz-transform-origin"]="0 0",o["-ms-transform-origin"]="0 0",o["-o-transform-origin"]="0 0",o["transform-origin"]="0 0",o["-webkit-transform"]="rotate(0deg)",o["-moz-transform"]="rotate(0deg)",o["-ms-transform"]="rotate(0deg)",o["-o-transform"]="rotate(0deg)",o.transform="rotate(0deg)",o.opacity=0,o["pointer-events"]="none",r.onContextMenu,t.appendChild(a),r.onMouseOver&&a.addEventListener("mouseover",(function(e){r.onMouseOver(e,n)})),r.onMouseLeave&&a.addEventListener("mouseleave",(function(e){r.onMouseLeave(e,n)})),r.onMouseWheel&&a.addEventListener("wheel",(function(e){r.onMouseWheel(e,n)})),r.onMouseDown&&a.addEventListener("mousedown",(function(e){r.onMouseDown(e,n)})),r.onMouseUp&&a.addEventListener("mouseup",(function(e){r.onMouseUp(e,n)})),r.onMouseMove&&a.addEventListener("mousemove",(function(e){r.onMouseMove(e,n)})),r.onContextMenu){var A=function(e){r.onContextMenu(e,n)};YC(a,A)}this._x1=0,this._y1=0,this._x2=0,this._y2=0,this._update()}return I(e,[{key:"visible",get:function(){return"visible"===this._wire.style.visibility}},{key:"_update",value:function(){var e=Math.abs(Math.sqrt((this._x1-this._x2)*(this._x1-this._x2)+(this._y1-this._y2)*(this._y1-this._y2))),t=180*Math.atan2(this._y2-this._y1,this._x2-this._x1)/Math.PI,n=this._wire.style;n.width=Math.round(e)+"px",n.left=Math.round(this._x1)+"px",n.top=Math.round(this._y1)+"px",n["-webkit-transform"]=n["-moz-transform"]=n["-ms-transform"]=n["-o-transform"]=n.transform="rotate("+t+"deg) translate(-"+this._thickness+"px, -"+this._thickness+"px)";var r=this._wireClickable.style;r.width=Math.round(e)+"px",r.left=Math.round(this._x1)+"px",r.top=Math.round(this._y1)+"px",r["-webkit-transform"]=r["-moz-transform"]=r["-ms-transform"]=r["-o-transform"]=r.transform="rotate("+t+"deg) translate(-"+this._thicknessClickable+"px, -"+this._thicknessClickable+"px)"}},{key:"setStartAndEnd",value:function(e,t,n,r){this._x1=e,this._y1=t,this._x2=n,this._y2=r,this._update()}},{key:"setColor",value:function(e){this._color=e||"black",this._wire.style.border="solid "+this._thickness+"px "+this._color}},{key:"setOpacity",value:function(e){this._wire.style.opacity=e}},{key:"_updateVisibility",value:function(){this._wire.style.visibility=this._wireClickable.style.visibility=this._visible&&!this._culled?"visible":"hidden"}},{key:"setVisible",value:function(e){this._visible!==e&&(this._visible=!!e,this._updateVisibility())}},{key:"setCulled",value:function(e){this._culled!==e&&(this._culled=!!e,this._updateVisibility())}},{key:"setClickable",value:function(e){this._wireClickable.style["pointer-events"]=e?"all":"none"}},{key:"setHighlighted",value:function(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._wire.classList.add(this._highlightClass):this._wire.classList.remove(this._highlightClass))}},{key:"destroy",value:function(e){this._wire.parentElement&&this._wire.parentElement.removeChild(this._wire),this._wireClickable.parentElement&&this._wireClickable.parentElement.removeChild(this._wireClickable)}}]),e}(),tM=De.vec2(),nM=De.vec2(),rM=De.vec2(),iM=De.vec2(),sM=De.vec3(),aM=De.vec3(),oM=De.vec4(),AM=De.vec4(),cM=De.vec4(),lM=De.vec4(),uM=De.mat4(),hM={origin:De.vec3(),direction:De.vec3()},dM=function(){},fM=function(e,t,n,r){var i=(e-De.dotVec3(n,t))/De.dotVec3(r,t);if(i<0)return null;var s=De.vec3();return De.mulVec3Scalar(r,i,s),De.addVec3(n,s,s),s};function pM(e,t,n){var r=e.getBoundingClientRect(),i=t.getBoundingClientRect();n[0]+=r.left-i.left,n[1]+=r.top-i.top}var vM=function(e,t,n){uM.set(e.viewMatrix),uM.set(e.projMatrix),n.set(t),n[3]=1,De.mulMat4v4(e.viewMatrix,n,n),De.mulMat4v4(e.projMatrix,n,n)},gM=function(e,t,n,r){r[0]=.5*(1+n[0])*e.offsetWidth,r[1]=.5*(1-n[1])*e.offsetHeight,pM(e,t,r)},mM=function(e,t,n,r,i,s){var a=e.camera,o=e.canvas.canvas;if(De.distVec3(n,r)<.001)return!1;var A,c=De.subVec3(r,n,sM),l=0,h=1,d=u(e._sectionPlanesState.sectionPlanes);try{for(d.s();!(A=d.n()).done;){var f=A.value,p=De.dotVec3(f.dir,De.subVec3(f.pos,r,aM)),v=De.dotVec3(f.dir,De.subVec3(f.pos,n,aM));if(v>0&&p>0)return!1;if(v>0||p>0){var g=De.dotVec3(f.dir,c);if(Math.abs(g)>=1e-6){var m=De.dotVec3(f.dir,aM)/g;v>0?l=Math.max(l,m):h=Math.min(h,m)}}}}catch(e){d.e(e)}finally{d.f()}var y=oM,_=AM;vM(a,l>0?De.addVec3(n,De.mulVec3Scalar(c,l,aM),aM):n,y),vM(a,h<1?De.addVec3(n,De.mulVec3Scalar(c,h,aM),aM):r,_);var b=y[2]/y[3]<-1||y[3]<0,w=_[2]/_[3]<-1||_[3]<0;if(b&&w)return!1;var B=(y[3]+y[2])/(y[3]+y[2]-(_[3]+_[2]));if(B>0&&B<1){var C=De.subVec4(_,y,cM);De.mulVec4Scalar(C,B,C),De.addVec4(y,C,b?y:_)}De.mulVec4Scalar(y,1/y[3]),De.mulVec4Scalar(_,1/_[3]);for(var M=0,k=1,E=0;E<2;++E){var F=_[E]-y[E],x=(-1-y[E])/F,U=(1-y[E])/F;F>0?(M=Math.max(M,x),k=Math.min(k,U)):F<0?(M=Math.max(M,U),k=Math.min(k,x)):y[0]<-1?M=-window.Infinity:y[0]>1&&(k=window.Infinity)}if(M>=k)return!1;var I=De.subVec4(_,y,cM);return De.addVec4(y,De.mulVec4Scalar(I,k,lM),_),De.addVec4(y,De.mulVec4Scalar(I,M,lM),y),De.mulVec4Scalar(y,1/y[3]),De.mulVec4Scalar(_,1/_[3]),gM(o,t,y,i),gM(o,t,_,s),!0},yM=function(e){m(n,jo);var t=_(n);function n(e,r,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};x(this,n);var o=e.camera;(s=t.call(this,e,r)).__visible=!0;var A=function(e,t){return function(n){e&&e(n),s.fire(t,n,!0)}};s._dot=new qC(i,{borderColor:a.borderColor,fillColor:a.fillColor,zIndex:a.zIndex,onMouseOver:A(a.onMouseOver,"mouseover"),onMouseLeave:A(a.onMouseLeave,"mouseleave"),onMouseWheel:A(a.onMouseWheel,"wheel"),onMouseDown:A(a.onMouseDown,"mousedown"),onMouseUp:A(a.onMouseUp,"mouseup"),onMouseMove:A(a.onMouseMove,"mousemove"),onTouchstart:A(a.onTouchstart,"touchstart"),onTouchmove:A(a.onTouchmove,"touchmove"),onTouchend:A(a.onTouchend,"touchend"),onContextMenu:A(a.onContextMenu,"contextmenu")});var c=function(e,t){t.set(e),t[3]=1,De.mulMat4v4(o.viewMatrix,t,t),De.mulMat4v4(o.projMatrix,t,t)},l=function(t){var n=e.canvas.canvas;t[0]=.5*(1+t[0])*n.offsetWidth,t[1]=.5*(1-t[1])*n.offsetHeight,pM(n,i,t)},u=function(){if(s.__visible){var t=cM;c(s.worldPos,t),De.mulVec3Scalar(t,1/t[3]);var n=t[3]<0||t[0]<-1||t[0]>1||t[1]<-1||t[1]>1||t[2]<-1||t[2]>1||e._sectionPlanesState.sectionPlanes.some((function(e){return De.dotVec3(e.dir,De.subVec3(e.pos,s.worldPos,sM))>0}));s._dot.setCulled(n),n||(l(t),s._dot.setPos(t[0],t[1]))}};s.on("worldPos",u);var h=o.on("viewMatrix",u),d=o.on("projMatrix",u),f=e.canvas.on("boundary",u),p=e.on("sectionPlaneUpdated",u),v=e.on("sectionPlaneCreated",u),g=e.on("sectionPlaneDestroyed",u);return s._updatePosition=u,s._cleanup=function(){o.off(h),o.off(d),e.canvas.off(f),e.off(p),e.off(v),e.off(g),s._dot.destroy()},s}return I(n,[{key:"setClickable",value:function(e){this._dot.setClickable(e)}},{key:"setFillColor",value:function(e){this._dot.setFillColor(e)}},{key:"setBorderColor",value:function(e){this._dot.setBorderColor(e)}},{key:"setHighlighted",value:function(e){this._dot.setHighlighted(e)}},{key:"setOpacity",value:function(e){this._dot.setOpacity(e)}},{key:"setVisible",value:function(e){this.__visible!=e&&(this.__visible=e,this._updatePosition(),this._dot.setVisible(e))}},{key:"destroy",value:function(){this._cleanup(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),_M=function(){function e(t,n,r){var i=this;x(this,e);var s=t.camera;this._label=new $C(n,r),this._start=De.vec3(),this._mid=De.vec3(),this._end=De.vec3(),this._yOff=0,this.__visible=!0,this._updatePos=function(){vM(s,i._start,oM),De.mulVec4Scalar(oM,1/oM[3]),gM(t.canvas.canvas,n,oM,tM),i._label.setPos(tM[0],tM[1])};var a=function(e,t,n){e[0]+=t[0],e[1]+=t[1],De.mulVec2Scalar(e,.5),i._label.setPos(e[0],e[1]+n)};this._updatePosBetween=function(){var e=mM(t,n,i._start,i._mid,tM,nM),r=mM(t,n,i._end,i._mid,rM,iM);i._label.setCulled(!(e||r)),e&&r?(nM[0]+=iM[0],nM[1]+=iM[1],De.mulVec2Scalar(nM,.5),nM[0]+=tM[0]+rM[0],nM[1]+=tM[1]+rM[1],De.mulVec2Scalar(nM,1/3),i._label.setPos(nM[0],nM[1])):e?a(tM,nM,0):r&&a(rM,iM,0)},this._updatePosOnWire=function(){var e=mM(t,n,i._start,i._end,tM,nM)&&De.distVec2(tM,nM)>=i._labelMinAxisLength;i._label.setCulled(!e),e&&a(tM,nM,i._yOff)};var o=function(){};this._setUpdatePositions=function(e){o=e,i._updatePositions()},this._updatePositions=function(){i.__visible&&o()};var A=s.on("viewMatrix",this._updatePositions),c=s.on("projMatrix",this._updatePositions),l=t.canvas.on("boundary",this._updatePositions),u=t.on("sectionPlaneUpdated",this._updatePositions),h=t.on("sectionPlaneCreated",this._updatePositions),d=t.on("sectionPlaneDestroyed",this._updatePositions);this._cleanup=function(){s.off(A),s.off(c),t.canvas.off(l),t.off(u),t.off(h),t.off(d),i._label.destroy()}}return I(e,[{key:"setPos",value:function(e){this._start.set(e),this._setUpdatePositions(this._updatePos)}},{key:"setPosOnWire",value:function(e,t,n,r){this._start.set(e),this._end.set(t),this._yOff=n,this._labelMinAxisLength=r,this._setUpdatePositions(this._updatePosOnWire)}},{key:"setPosBetween",value:function(e,t,n){this._start.set(e),this._mid.set(t),this._end.set(n),this._setUpdatePositions(this._updatePosBetween)}},{key:"setFillColor",value:function(e){this._label.setFillColor(e)}},{key:"setHighlighted",value:function(e){this._label.setHighlighted(e)}},{key:"setText",value:function(e){this._label.setText(e)}},{key:"setClickable",value:function(e){this._label.setClickable(e)}},{key:"setVisible",value:function(e){this.__visible!=e&&(this.__visible=e,this._updatePositions(),this._label.setVisible(e))}},{key:"destroy",value:function(){this._cleanup()}}]),e}(),bM=function(){function e(t,n,r){var i=this;x(this,e);var s=t.camera;this._wire=new eM(n,r),this._start=De.vec3(),this._end=De.vec3(),this.__visible=!0,this._updatePositions=function(){if(i.__visible){var e=mM(t,n,i._start,i._end,tM,nM);i._wire.setCulled(!e),e&&i._wire.setStartAndEnd(tM[0],tM[1],nM[0],nM[1])}};var a=s.on("viewMatrix",this._updatePositions),o=s.on("projMatrix",this._updatePositions),A=t.canvas.on("boundary",this._updatePositions),c=t.on("sectionPlaneUpdated",this._updatePositions),l=t.on("sectionPlaneCreated",this._updatePositions),u=t.on("sectionPlaneDestroyed",this._updatePositions);this._cleanup=function(){s.off(a),s.off(o),t.canvas.off(A),t.off(c),t.off(l),t.off(u),i._wire.destroy()}}return I(e,[{key:"setEnds",value:function(e,t){this._start.set(e),this._end.set(t),this._updatePositions()}},{key:"setClickable",value:function(e){this._wire.setClickable(e)}},{key:"setColor",value:function(e){this._wire.setColor(e)}},{key:"setHighlighted",value:function(e){this._wire.setHighlighted(e)}},{key:"setOpacity",value:function(e){this._wire.setOpacity(e)}},{key:"setVisible",value:function(e){this.__visible!=e&&(this.__visible=e,this._updatePositions(),this._wire.setVisible(e))}},{key:"destroy",value:function(){this._cleanup()}}]),e}(),wM=function(e,t){var n=new yM(e,{},e.canvas.canvas.parentNode,{borderColor:"white",fillColor:t,zIndex:100});return{update:function(e){e&&(n.worldPos=e),n.setVisible(!!e)},setFillColor:function(e){return n.setFillColor(e)},setHighlighted:function(e){return n.setHighlighted(e)},getCanvasPos:function(){return n.canvasPos},getWorldPos:function(){return n.worldPos},destroy:function(){return n.destroy()}}},BM=function(e,t){var n=new bM(e,e.canvas.canvas.ownerDocument.body,{color:t,thickness:1,thicknessClickable:6});return n.setVisible(!1),{update:function(e,t){t&&n.setEnds(e,t),n.setVisible(!!t)},setColor:function(e){return n.setColor(e)},destroy:function(){return n.destroy()}}};function CM(e,t){var n,r=function(e,n){if(e in t)return t[e];if(void 0!==n)return n;throw"config missing: "+e},i=r("viewer"),s=r("ray2WorldPos"),a=r("handleMouseEvents",!1),o=r("handleTouchEvents",!1),A=r("onStart",dM),c=r("onMove",dM),l=r("onEnd",dM),u=i.scene,h=u.canvas.canvas,d=function(e){var t=De.vec2([e.clientX,e.clientY]);pM(h.ownerDocument.documentElement,h,t),c(t,function(e){var t=De.vec3(),n=De.vec3();return De.canvasPosToWorldRay(h,u.camera.viewMatrix,u.camera.projMatrix,u.camera.projection,e,t,n),s(t,n,e)}(t))},f=null,v=function(e){var t=f.matchesEvent(e);t&&d(t)},g=function(t){var n=f.matchesEvent(t);n&&(e.setOpacity(b),f.cleanup(),d(n),l())},m=function(t,n){f&&f.cleanup(),e.setOpacity(1),e.setClickable(!1),i.cameraControl.active=!1,f={matchesEvent:t,cleanup:function(){f=null,e.setClickable(!0),i.cameraControl.active=!0,n()}},A()},y=[],_=function(t,n){var r=e.on(t,n);y.push((function(){return e.off(r)}))};(a&&(_("mouseover",(function(){return!f&&e.setOpacity(1)})),_("mouseleave",(function(){return!f&&e.setOpacity(b)})),_("mousedown",(function(e){1===e.which&&(h.addEventListener("mousemove",v),h.addEventListener("mouseup",g),m((function(e){return 1===e.which&&e}),(function(){h.removeEventListener("mousemove",v),h.removeEventListener("mouseup",g)})))}))),o)&&(_("touchstart",(function(e){e.preventDefault(),1===e.touches.length&&(n=e.touches[0].identifier,m((function(e){return p(e.changedTouches).find((function(e){return e.identifier===n}))}),(function(){n=null})))})),_("touchmove",(function(e){e.preventDefault(),v(e)})),_("touchend",(function(e){e.preventDefault(),g(e)})));var b=.8;return e.setOpacity(b),function(){f&&f.cleanup(),y.forEach((function(e){return e()})),e.setOpacity(1)}}function MM(e){var t=function(t,n){if(t in e)return e[t];if(void 0!==n)return n;throw"config missing: "+t},n=t("viewer"),r=t("handleMouseEvents",!1),i=t("handleTouchEvents",!1),s=t("pointerLens",null),a=t("dots"),o=t("ray2WorldPos"),A=t("onEnd",dM),c=s?function(e){s.visible=!!e,e&&(s.canvasPos=e)}:function(){},l=a.map((function(e){var t;return CM(e,{handleMouseEvents:r,handleTouchEvents:i,viewer:n,ray2WorldPos:function(e,n,r){return o(e,n,r)||t},onStart:function(){t=e.worldPos.slice(),u(!1,e)},onMove:function(t,n){c(t),e.worldPos=n},onEnd:function(){A(t,e)||(e.worldPos=t),c(null),u(!0,e)}})})),u=function(e,t){return a.forEach((function(n){return n!==t&&n.setClickable(e)}))};return u(!0),function(){l.forEach((function(e){return e()})),c(null)}}var kM=function(e,t,n){return function(r,i,s){var a,o=e.scene,A=o.canvas.canvas,c=function(e,t){return t[0]=e.clientX,t[1]=e.clientY,pM(A.ownerDocument.documentElement,A,t),t},l=function(e){var t=De.vec3(),r=De.vec3();return De.canvasPosToWorldRay(A,o.camera.viewMatrix,o.camera.projMatrix,o.camera.projection,e,t,r),n(t,r)},u=null,h=function(){},d=h,f=function(){t.stop(),clearTimeout(u),e.cameraControl.active=!0,d=h,a=null},v=function(){f(),A.removeEventListener("touchstart",g),A.removeEventListener("touchmove",m),A.removeEventListener("touchend",y)},g=function(n){var s=n.touches;if(1!==s.length)f(),r();else{var o=s[0],A=c(o,De.vec2());l(A)&&(a=o.identifier,d=function(e){De.distVec2(A,e)>20&&f()},u=setTimeout((function(){t.start(A),u=setTimeout((function(){t.stop(),e.cameraControl.active=!1,d=function(e){i(e,l(e))},d(A)}),300)}),250))}};A.addEventListener("touchstart",g,{passive:!0});var m=function(e){var t=p(e.changedTouches).find((function(e){return e.identifier===a}));t&&d(c(t,De.vec2()))};A.addEventListener("touchmove",m,{passive:!0});var y=function(e){var t=p(e.changedTouches).find((function(e){return e.identifier===a}));if(t){v();var n=c(t,De.vec2());s(n,l(n))}};return A.addEventListener("touchend",y,{passive:!0}),v}},EM=function(e){for(var t=[],n=0;n<e.length;++n)t.push(n);var r=function(){for(var n=De.vec2(),r=De.vec2(),i=0,s=0;s<t.length;++s){var a=e[t[s]],o=e[t[(s+1)%t.length]],A=e[t[(s+2)%t.length]];De.subVec2(a,o,n),De.subVec2(A,o,r);var c=De.dotVec2(n,r)/Math.sqrt(De.sqLenVec2(n)*De.sqLenVec2(r)),l=Math.acos(Math.max(-1,Math.min(c,1)));i+=n[0]*r[1]-n[1]*r[0]>=0?l:2*Math.PI-l}return i<t.length*Math.PI}(),i=function(){var e=function(e,t,n){return(e[0]-n[0])*(t[1]-n[1])-(t[0]-n[0])*(e[1]-n[1])};return function(t,n,r,i){var s=e(t,n,r),a=e(t,r,i),o=e(t,i,n);return!((s<0||a<0||o<0)&&(s>0||a>0||o>0))}}(),s=[],a=(r?t:t.slice(0).reverse()).map((function(e){return{idx:e}}));a.forEach((function(e,t){e.prev=a[(t-1+a.length)%a.length],e.next=a[(t+1)%a.length]}));for(var o=De.vec2(),A=De.vec2();a.length>2;){for(var c=0,l=function(){if(c>=a.length)throw"isCCW = ".concat(r,"; earIdx = ").concat(c,"; len = ").concat(a.length);var t=a[c],n=e[t.prev.idx],s=e[t.idx],l=e[t.next.idx];if(De.subVec2(n,s,o),De.subVec2(l,s,A),o[0]*A[1]-o[1]*A[0]>=0&&a.every((function(r){return r===t||r===t.prev||r===t.next||!i(e[r.idx],n,s,l)})))return"break";++c};;){if("break"===l())break}var u=a[c];a.splice(c,1),s.push([u.idx,u.next.idx,u.prev.idx]),u.prev.next=u.next,u.next.prev=u.prev}return[e,s,r]},FM=function(e,t){var n=function(t,n){return n[0]=t.clientX,n[1]=t.clientY,pM(e.ownerDocument.documentElement,e,n),n},r=!1,i=[],s=function(){return i.forEach((function(e){return e()}))},a=function(t,n){e.addEventListener(t,n),i.push((function(){return e.removeEventListener(t,n)}))},o=De.vec2();return a("mousedown",(function(e){1===e.which&&(r=!0,t(n(e,o)))})),a("mousemove",(function(e){n(e,tM),r&&De.distVec2(o,tM)>4&&(r=!1),(r||1&!e.buttons)&&t(tM)})),a("mouseup",(function(e){if(1===e.which&&r){var i=t(n(e,tM));i&&(s(),i())}})),s},xM=function(e,t,n,r){var i,s=De.vec2(),a=function(t,n){return n[0]=t.clientX,n[1]=t.clientY,pM(e.ownerDocument.documentElement,e,n),n},o=null,A=dM,c=function(){clearTimeout(o),n.stop(),t.active=!0,A=dM,i=null},l=[],u=function(){return l.forEach((function(e){return e()}))},h=function(t,n){e.addEventListener(t,n,{passive:!0}),l.push((function(){return e.removeEventListener(t,n)}))};return h("touchstart",(function(e){var l=e.touches;if(1!==l.length)c(),r(null);else{var u=l[0];a(u,s),i=u.identifier,A=function(e){De.distVec2(s,e)>20&&c()},o=setTimeout((function(){n.start(s),o=setTimeout((function(){n.stop(),t.active=!1,(A=r)(s)}),300)}),250)}})),h("touchmove",(function(e){var t=p(e.changedTouches).find((function(e){return e.identifier===i}));t&&A(a(t,tM))})),h("touchend",(function(e){var t=p(e.changedTouches).find((function(e){return e.identifier===i}));if(t){var n=r(a(t,tM));c(),n?(u(),n()):r(null)}})),function(){c(),u()}},UM=function(e,t,n,r,i,s){var a,o=e.canvas.canvas,A=t?function(e,n){t.visible=!!e,e&&(t.canvasPos=e,t.snapped=!!n)}:function(){},c=function(){var e=function(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])},t=function(e,t,n){var r=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===r?0:r>0?1:2};return function(n,r){for(var i=r?1:0,s=n[(n.length-2+i)%n.length],a=n[(n.length-1+i)%n.length],o=i;o<n.length-2-1+i;++o){var A=n[o],c=n[o+1],l=t(s,a,A),u=t(s,a,c),h=t(A,c,s),d=t(A,c,a);if(l!==u&&h!==d||0===l&&e(s,A,a)||0===u&&e(s,c,a)||0===h&&e(A,s,c)||0===d&&e(A,a,c))return!0}return!1}}(),l=function(e){return e.length>=3&&function(){var t=De.normalizeVec3(De.subVec3(e[1],e[0],De.vec3())),n=De.normalizeVec3(De.subVec3(e[2],e[0],sM)),r=De.normalizeVec3(De.cross3Vec3(t,n,De.vec3())),i=De.normalizeVec3(De.cross3Vec3(r,t,De.vec3()));return{normal:r,origin:De.vec3(e[0]),u:t,v:i}}()},u=[];return function t(){var h=l(u),d=!1,f=n((function(t){var n=t&&function(e){var t=r(e),n=t&&t.entity&&(!h||t.snapped)&&t.worldPos;if(h){var i=De.dotVec3(h.normal,h.origin),s=n?i-De.dotVec3(n,h.normal):window.Infinity;if(Math.abs(s)<1e-4){var a=De.vec3();return{worldPos:De.addVec3(n,De.mulVec3Scalar(h.normal,s,a),a),snapped:!0}}return{worldPos:fM(i,h.normal,e.origin,e.direction),snapped:!1}}return{worldPos:n,snapped:t&&t.snapped}}(function(t,n){return De.canvasPosToWorldRay(o,e.camera.viewMatrix,e.camera.projMatrix,e.camera.projection,t,n.origin,n.direction),n}(t,hM)),i=n&&n.worldPos;return p(i,t,n&&n.snapped)})),p=function(n,r,a){var o,f=n?e.camera.projectWorldPos(n):r,p=u.length>0&&(o=u[0],{canvasPos:e.camera.projectWorldPos(o),worldPos:o}),v=u.length>=3&&(f&&De.distVec2(f,p.canvasPos)<10||n&&De.compareVec3(n,p.worldPos));A(v?p.canvasPos:f,v||a);var g=r&&(!n||(u.length<3?u.some((function(e){return De.compareVec3(e,n)})):De.compareVec3(u[u.length-1],n))),m=u.concat(v||!n||g?[]:[n]),y=!g&&(h||l(m)),_=y&&m.map((function(e){return De.subVec3(e,y.origin,sM),De.vec2([De.dotVec3(sM,y.u),De.dotVec3(sM,y.v)])})),b=!(g||_&&c(_,v)),w=b&&_&&(v||!c(_,!0))&&function(){try{var e=k(EM(_),3),t=e[0],n=e[1];e[2];return{faces:n,vertices:t.map((function(e){return De.addVec3(y.origin,De.addVec3(De.mulVec3Scalar(y.u,e[0],sM),De.mulVec3Scalar(y.v,e[1],aM),sM),De.vec3())}))}}catch(e){return console.warn("e",e),!1}}();return i(m,v,b,w),d=b&&(v?function(){A(null),s()}:function(){u.push(De.vec3(n)),A(null),t()})};a={closePolygon:function(){var e=u.length>=3&&p(u[0]);return e&&(f(),e()),!!e},placeVertex:function(){return d&&(f(),d()),!!d},popVertex:function(){return u.length>0&&(f(),u.pop(),t(),!0)},removePressListener:f,updateOnChange:function(){return p()}}}(),{cancel:function(){a.removePressListener(),A(null)},closePolygon:function(){return a.closePolygon()},placeVertex:function(){return a.placeVertex()},popVertex:function(){return a.popVertex()},updateOnChange:function(){return a.updateOnChange()}}},IM=function(){function e(t){x(this,e),this.language="en",this.localeService=t.localeService||new pt,this.scene=new uc(this,{canvasId:t.canvasId,canvasElement:t.canvasElement,keyboardEventsElement:t.keyboardEventsElement,contextAttr:{preserveDrawingBuffer:!1!==t.preserveDrawingBuffer,premultipliedAlpha:!!t.premultipliedAlpha,antialias:!1!==t.antialias},spinnerElementId:t.spinnerElementId,transparent:!1!==t.transparent,gammaInput:!0,gammaOutput:!1,backgroundColor:t.backgroundColor,backgroundColorFromAmbientLight:t.backgroundColorFromAmbientLight,ticksPerRender:1,ticksPerOcclusionTest:20,units:t.units,scale:t.scale,origin:t.origin,saoEnabled:t.saoEnabled,alphaDepthMask:!1!==t.alphaDepthMask,entityOffsetsEnabled:!!t.entityOffsetsEnabled,readableGeometryEnabled:!!t.readableGeometryEnabled,logarithmicDepthBufferEnabled:!!t.logarithmicDepthBufferEnabled,pbrEnabled:!!t.pbrEnabled,colorTextureEnabled:!1!==t.colorTextureEnabled,dtxEnabled:!!t.dtxEnabled,markerZOffset:t.markerZOffset,numCachedSectionPlanes:t.numCachedSectionPlanes}),this.metaScene=new tl(this,this.scene),this.id=t.id||this.scene.id,this.camera=this.scene.camera,this.cameraFlight=new Et(this.scene,{duration:.5}),this.cameraControl=new Jc(this.scene,{doublePickFlyTo:!0}),this._plugins=[],this._eventSubs={}}var t;return I(e,[{key:"capabilities",get:function(){return this.scene.capabilities}},{key:"on",value:function(e,t){var n=this._eventSubs[e];n||(n=[],this._eventSubs[e]=n),n.push(t)}},{key:"fire",value:function(e,t){var n=this._eventSubs[e];if(n)for(var r=0,i=n.length;r<i;r++)n[r](t)}},{key:"off",value:function(e){}},{key:"log",value:function(e){console.log("[xeokit viewer ".concat(this.id,"]: ").concat(e))}},{key:"error",value:function(e){console.error("[xeokit viewer ".concat(this.id,"]: ").concat(e))}},{key:"addPlugin",value:function(e){this._plugins.push(e)}},{key:"removePlugin",value:function(e){for(var t=0,n=this._plugins.length;t<n;t++){var r=this._plugins[t];if(r===e)return r.clear&&r.clear(),void this._plugins.splice(t,1)}}},{key:"sendToPlugins",value:function(e,t){for(var n=0,r=this._plugins.length;n<r;n++){var i=this._plugins[n];i.send&&i.send(e,t)}}},{key:"clear",value:function(){throw'Viewer#clear() no longer implemented - use \'#sendToPlugins("clear") instead'}},{key:"resetView",value:function(){throw"Viewer#resetView() no longer implemented - use CameraMemento & ObjectsMemento classes instead"}},{key:"beginSnapshot",value:function(){this._snapshotBegun||(this.scene._renderer.snapshot.beginSnapshot(),this._snapshotBegun=!0)}},{key:"_renderSnapshotToCanvas",value:function(e){var t=this,n=void 0!==e.width&&void 0!==e.height,r=this.scene.canvas.canvas,i=r.clientWidth,s=r.clientHeight,a=!e.includeGizmos;n&&(r.width=e.width?Math.floor(e.width):r.width,r.height=e.height?Math.floor(e.height):r.height),this.beginSnapshot(),a&&this.sendToPlugins("snapshotStarting");var o=this.scene._renderer.snapshot.renderSnapshotToCanvas();return n&&(r.width=i,r.height=s,this.scene.glRedraw()),{canvas:o,toDataURL:function(){a&&t.sendToPlugins("snapshotFinished"),t.endSnapshot();var n=e.format||"png";return"jpeg"!==n&&"png"!==n&&"bmp"!==n&&(console.error("Unsupported image format: '"+n+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'png'"),n="png"),o.toDataURL("image/".concat(n))}}}},{key:"getSnapshot",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.scene.fire("rendering",{},!0),this._renderSnapshotToCanvas(e).toDataURL()}},{key:"getSnapshotWithPlugins",value:(t=l(A().mark((function e(){var t,n,r,i,s,a,o,c,l,u,h,d,f,p,v=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(n=v.length>0&&void 0!==v[0]?v[0]:{},r=this._renderSnapshotToCanvas(n),i={},s=[],a=0,o=this._plugins.length;a<o;a++)(c=this._plugins[a]).getContainerElement&&(l=c.getContainerElement())!==document.body&&(i[l.id]||(i[l.id]=!0,s.push(l)));u=document.createElement("style"),document.head.appendChild(u),null===(t=u.sheet)||void 0===t||t.insertRule("body > div:last-child img { display: inline-block; }"),h=r.canvas,d=0,f=s.length;case 10:if(!(d<f)){e.next=18;break}return p=s[d],e.next=14,KC(p,{canvas:h,backgroundColor:null,scale:h.width/p.clientWidth});case 14:h.getContext("2d").resetTransform();case 15:d++,e.next=10;break;case 18:return u.remove(),e.abrupt("return",r.toDataURL());case 20:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"endSnapshot",value:function(){this._snapshotBegun&&(this.scene._renderer.snapshot.endSnapshot(),this._snapshotBegun=!1)}},{key:"destroy",value:function(){for(var e=this._plugins.slice(),t=0,n=e.length;t<n;t++){e[t].destroy()}this.scene.destroy()}}]),e}();function TM(e,t){return PM.apply(this,arguments)}function PM(){return PM=l(A().mark((function e(t,n){var r,i,s,a,o,c,l,u,h,d,f,p,v,g,m,y,_,b,w,B;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.src&&Array.isArray(n.src)&&6===n.src.length){e.next=2;break}throw new Error("src requires path to 6 images");case 2:if(r=k(n.src,6),i=r[0],s=r[1],a=r[2],o=r[3],c=r[4],l=r[5],i&&s&&a&&o&&c&&l){e.next=5;break}throw new Error("All six images must be provided");case 5:return u=document.createElement("canvas"),h=u.getContext("2d"),d=function(e){return new Promise((function(t,n){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){return t(r)},r.onerror=function(){return n(new Error("Failed to load image: ".concat(e)))},r.src=e}))},e.prev=8,e.next=11,Promise.all([d(i),d(s),d(a),d(o),d(c),d(l)]);case 11:if(f=e.sent,p=k(f,6),v=p[0],g=p[1],m=p[2],y=p[3],_=p[4],b=p[5],w=v.width,g.width===w&&m.width===w&&y.width===w&&_.width===w&&b.width===w){e.next=22;break}throw new Error("All skybox textures must have the same dimensions");case 22:return u.width=4*w,u.height=3*w,h.fillStyle="black",h.fillRect(0,0,u.width,u.height),h.drawImage(g,0*w,1*w,w,w),h.drawImage(v,2*w,1*w,w,w),h.drawImage(m,1*w,0*w,w,w),h.drawImage(y,1*w,2*w,w,w),h.drawImage(_,1*w,1*w,w,w),h.drawImage(b,3*w,1*w,w,w),B=new Ti(t,{image:u,flipY:!0,wrapS:1001,wrapT:1001,encoding:n.encoding||3e3}),e.abrupt("return",B);case 36:throw e.prev=36,e.t0=e.catch(8),console.error("Error creating combined skybox texture:",e.t0),e.t0;case 40:case"end":return e.stop()}}),e,null,[[8,36]])}))),PM.apply(this,arguments)}function SM(e,t){return new vi(e,{geometry:new Wt(e,{primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),background:!0,scale:[1e3,1e3,1e3],rotation:[0,-90,0],material:new wi(e,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:t,backfaces:!0}),visible:!0,pickable:!1,clippable:!1,collidable:!1})}function DM(e,t){var n=new Wt(e,sn({center:[0,0,0],radius:1,heightSegments:60,widthSegments:60})),r=new wi(e,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:t,backfaces:!0});return new vi(e,{geometry:n,background:!0,rotation:[0,0,180],material:r,visible:!0,pickable:!1,clippable:!1,collidable:!1})}var QM=De.vec3(),RM=De.vec3(),OM=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n);var s=e.viewer.scene;(r=t.call(this,s,i)).plugin=e;var a=i.container;if(!a)throw"config missing: container";r._color=i.color||e.defaultColor;var o=function(e){var t=[],n=!1!==e;return{reg:function(e){return t.push(e)},get:function(){return n},set:function(e){n=!1!==e,t.forEach((function(e){return e(n)}))}}};r._visible=o(i.visible),r._originVisible=o(i.originVisible),r._cornerVisible=o(i.cornerVisible),r._targetVisible=o(i.targetVisible),r._originWireVisible=o(i.originWireVisible),r._targetWireVisible=o(i.targetWireVisible),r._angleVisible=o(i.angleVisible),r._labelsVisible=o(),r.labelsVisible=i.labelsVisible,r._clickable=o(!1),r.approximate=i.approximate,r._labelStringFormat=function(e){return(r._approximate?" ~ ":" = ")+e.toFixed(2)+""};var A=s.canvas.canvas,c=i.onMouseOver?function(e){i.onMouseOver(e,w(r)),A.dispatchEvent(new MouseEvent("mouseover",e))}:null,l=i.onMouseLeave?function(e){i.onMouseLeave(e,w(r)),A.dispatchEvent(new MouseEvent("mouseleave",e))}:null,u=i.onContextMenu?function(e){i.onContextMenu(e,w(r))}:null,h=function(e){return A.dispatchEvent(new MouseEvent("mousedown",e))},d=function(e){return A.dispatchEvent(new MouseEvent("mouseup",e))},f=function(e){return A.dispatchEvent(new MouseEvent("mousemove",e))},p=function(e){return A.dispatchEvent(new WheelEvent("wheel",e))};r._cleanups=[],r._drawables=[];var v=function(e,t){var n=function(){return e.setVisible(t.every((function(e){return e.get()})))};t.forEach((function(e){return e.reg(n)})),r._drawables.push(e),r._cleanups.push((function(){return e.destroy()}))},g=function(t,n,r){var i=new bM(s,a,{color:t,thickness:n,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:c,onMouseLeave:l,onMouseWheel:p,onMouseDown:h,onMouseUp:d,onMouseMove:f,onContextMenu:u});return v(i,r),{setEnds:function(e,t){return i.setEnds(e,t)},setColor:function(e){return i.setColor(e)}}};r._originWire=g(r._color||"blue",1,[r._visible,r._originWireVisible]),r._targetWire=g(r._color||"red",1,[r._visible,r._targetWireVisible]);var m=function(t,n,r){var i=new _M(s,a,{fillColor:t,zIndex:e.zIndex+n,onMouseOver:c,onMouseLeave:l,onMouseWheel:p,onMouseDown:h,onMouseUp:d,onMouseMove:f,onContextMenu:u});return v(i,r),{setFillColor:function(e){return i.setFillColor(e)},setPosOnWire:function(e,t,n){return i.setPosOnWire(e,t,n)},setPosBetween:function(e,t,n){return i.setPosBetween(e,t,n)},setText:function(e){return i.setText(e)}}};r._angleLabel=m(r._color||"#00BBFF",2,[r._visible,r._angleVisible,r._labelsVisible]);var y=function(t,n){var i=new yM(s,t,a,{fillColor:r._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:c,onMouseLeave:l,onMouseWheel:p,onMouseDown:h,onMouseUp:d,onMouseMove:f,onContextMenu:u});return i.on("worldPos",(function(){return r._update()})),v(i,n),i};return r._originDot=y(i.origin,[r._visible,r._originVisible]),r._cornerDot=y(i.corner,[r._visible,r._cornerVisible]),r._targetDot=y(i.target,[r._visible,r._targetVisible]),r._update(),r}return I(n,[{key:"_update",value:function(){if(this._targetDot){var e=this._originDot.worldPos,t=this._cornerDot.worldPos,n=this._targetDot.worldPos;this._originWire.setEnds(e,t),this._targetWire.setEnds(t,n),this._angleLabel.setPosBetween(e,t,n),De.subVec3(e,t,QM),De.subVec3(n,t,RM),De.lenVec3(QM)>0&&De.lenVec3(RM)>0?(De.normalizeVec3(QM),De.normalizeVec3(RM),this._angle=Math.abs(De.angleVec3(QM,RM))*De.RADTODEG,this._angleLabel.setText(this._labelStringFormat(this._angle))):(this._angle=void 0,this._angleLabel.setText(""))}}},{key:"approximate",get:function(){return this._approximate},set:function(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._update())}},{key:"origin",get:function(){return this._originDot}},{key:"corner",get:function(){return this._cornerDot}},{key:"target",get:function(){return this._targetDot}},{key:"angle",get:function(){return this._angle}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._originDot.setFillColor(e),this._cornerDot.setFillColor(e),this._targetDot.setFillColor(e),this._originWire.setColor(e||"blue"),this._targetWire.setColor(e||"red"),this._angleLabel.setFillColor(e||"#00BBFF")}},{key:"visible",get:function(){return this._visible.get()},set:function(e){this._visible.set(e)}},{key:"originVisible",get:function(){return this._originVisible.get()},set:function(e){this._originVisible.set(e)}},{key:"cornerVisible",get:function(){return this._cornerVisible.get()},set:function(e){this._cornerVisible.set(e)}},{key:"targetVisible",get:function(){return this._targetVisible.get()},set:function(e){this._targetVisible.set(e)}},{key:"originWireVisible",get:function(){return this._originWireVisible.get()},set:function(e){this._originWireVisible.set(e)}},{key:"targetWireVisible",get:function(){return this._targetWireVisible.get()},set:function(e){this._targetWireVisible.set(e)}},{key:"angleVisible",get:function(){return this._angleVisible.get()},set:function(e){this._angleVisible.set(e)}},{key:"labelsVisible",get:function(){return this._labelsVisible.get()},set:function(e){this._labelsVisible.set(void 0!==e?Boolean(e):this.plugin.defaultLabelsVisible)}},{key:"setHighlighted",value:function(e){this._drawables.forEach((function(t){return t.setHighlighted(e)}))}},{key:"clickable",get:function(){return this._clickable.get()},set:function(e){var t=this;this._clickable.set(!!e),this._drawables.forEach((function(e){return e.setClickable(t._clickable.get())}))}},{key:"labelStringFormat",get:function(){return this._labelStringFormat},set:function(e){this._labelStringFormat=e,this._update()}},{key:"destroy",value:function(){this._cleanups.forEach((function(e){return e()})),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),VM=function(e){m(n,it);var t=_(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"active",get:function(){}},{key:"snapping",get:function(){return!0},set:function(e){}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"reset",value:function(){}},{key:"currentMeasurement",get:function(){return null}},{key:"destroy",value:function(){}}]),n}(),LM=function(e){m(n,VM);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e.viewer.scene))._canvasToPagePos=i.canvasToPagePos,r.pointerLens=i.pointerLens,r._active=!1,r._currentAngleMeasurement=null,r._initMarkerDiv(),r._snapping=!1!==i.snapping,r._mouseState=0,r._attachPlugin(e,i),r}return I(n,[{key:"_initMarkerDiv",value:function(){var e=document.createElement("div"),t=this.scene.canvas.canvas;t.parentNode.insertBefore(e,t),e.style.background="black",e.style.border="2px solid blue",e.style.borderRadius="10px",e.style.width="5px",e.style.height="5px",e.style.top="-200px",e.style.left="-200px",e.style.margin="0 0",e.style.zIndex="100",e.style.position="absolute",e.style.pointerEvents="none",this.markerDiv=e}},{key:"_destroyMarkerDiv",value:function(){this.markerDiv&&(this.markerDiv.parentNode.removeChild(this.markerDiv),this.markerDiv=null)}},{key:"_attachPlugin",value:function(e){this.angleMeasurementsPlugin=e,this.plugin=e}},{key:"active",get:function(){return this._active}},{key:"snapping",get:function(){return this._snapping},set:function(e){this._snapping=e}},{key:"activate",value:function(){var e=this;if(!this._active){this.markerDiv||this._initMarkerDiv(),this.angleMeasurementsPlugin;var t=this.scene;t.input;var n=t.canvas.canvas,r=this.angleMeasurementsPlugin.viewer.cameraControl,i=this.pointerLens,s=!1,a=null,o=0,A=0,c=De.vec3(),l=De.vec2();this._currentAngleMeasurement=null;var u=De.vec2(),h=function(t){t.snappedToVertex||t.snappedToEdge?(i&&(i.visible=!0,i.canvasPos=t.canvasPos,i.snappedCanvasPos=t.snappedCanvasPos||t.canvasPos,i.snapped=!0),e.markerDiv.style.background="greenyellow",e.markerDiv.style.border="2px solid green"):(i&&(i.visible=!0,i.canvasPos=t.canvasPos,i.snappedCanvasPos=t.canvasPos,i.snapped=!1),e.markerDiv.style.background="pink",e.markerDiv.style.border="2px solid red");var r=t.snappedCanvasPos||t.canvasPos;switch(s=!0,a=t.entity,c.set(t.worldPos),l.set(r),e._mouseState){case 0:if(e._canvasToPagePos)e._canvasToPagePos(n,r,u),e.markerDiv.style.left="".concat(u[0]-5,"px"),e.markerDiv.style.top="".concat(u[1]-5,"px");else{var o=De.vec2(r);pM(n,e.markerDiv.parentNode,o),e.markerDiv.style.left="".concat(o[0]-5,"px"),e.markerDiv.style.top="".concat(o[1]-5,"px")}break;case 1:e._currentAngleMeasurement&&(e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.angleVisible=!1,e._currentAngleMeasurement.corner.worldPos=t.worldPos,e._currentAngleMeasurement.corner.entity=t.entity),e.markerDiv.style.left="-10000px",e.markerDiv.style.top="-10000px",n.style.cursor="pointer";break;case 2:e._currentAngleMeasurement&&(e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._currentAngleMeasurement.target.worldPos=t.worldPos,e._currentAngleMeasurement.target.entity=t.entity),e.markerDiv.style.left="-10000px",e.markerDiv.style.top="-10000px",n.style.cursor="pointer"}};this._onHoverSnapOrSurface=r.on("hoverSnapOrSurface",(function(t){e._snapping&&h(t)})),this._onHoverSurface=r.on("hoverSurface",(function(t){e._snapping||h(t)})),n.addEventListener("mousedown",this._onMouseDown=function(e){1===e.which&&(o=e.clientX,A=e.clientY)}),n.addEventListener("mouseup",this._onMouseUp=function(t){if(1===t.which&&!(t.clientX>o+20||t.clientX<o-20||t.clientY>A+20||t.clientY<A-20))switch(e._mouseState){case 0:s&&(e._currentAngleMeasurement=e.angleMeasurementsPlugin.createMeasurement({id:De.createUUID(),origin:{worldPos:c,entity:a},corner:{worldPos:c,entity:a},target:{worldPos:c,entity:a},approximate:!0}),e._currentAngleMeasurement.clickable=!1,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e._currentAngleMeasurement.origin.entity=a,e._mouseState=1,e.angleMeasurementsPlugin.fire("measurementStart",e._currentAngleMeasurement));break;case 1:s?(e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._currentAngleMeasurement.corner.entity=a,e._mouseState=2):e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null,a=null,e._mouseState=0,e.angleMeasurementsPlugin.fire("measurementCancel",e._currentAngleMeasurement));break;case 2:s?(e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e._currentAngleMeasurement.target.entity=a,e._currentAngleMeasurement.clickable=!0,a=null,e.angleMeasurementsPlugin.fire("measurementEnd",e._currentAngleMeasurement),e._currentAngleMeasurement=null,e._mouseState=0):e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null,a=null,e._mouseState=0,e.angleMeasurementsPlugin.fire("measurementCancel",e._currentAngleMeasurement))}});var d=function(t){if(s=!1,i&&(i.visible=!0,i.canvasPos=t.canvasPos,i.snappedCanvasPos=t.snappedCanvasPos||t.canvasPos,i.snapped=!1),e.markerDiv.style.left="-100px",e.markerDiv.style.top="-100px",e._currentAngleMeasurement){switch(e._mouseState){case 0:e._currentAngleMeasurement.originVisible=!1;break;case 1:e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.originWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1;break;case 2:e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1}n.style.cursor="default"}};this._onHoverSnapOrSurfaceOff=r.on("hoverSnapOrSurfaceOff",(function(t){e._snapping&&d(t)})),this._onHoverOff=r.on("hoverOff",(function(t){e._snapping||d(t)})),this._active=!0}}},{key:"deactivate",value:function(){if(this._active){this.pointerLens&&(this.pointerLens.visible=!1),this.reset();var e=this.scene.canvas.canvas;e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp);var t=this.angleMeasurementsPlugin.viewer.cameraControl;t.off(this._onHoverSnapOrSurface),t.off(this._onHoverSurface),t.off(this._onHoverSnapOrSurfaceOff),t.off(this._onHoverOff),this._active=!1}}},{key:"reset",value:function(){this._active&&(this._destroyMarkerDiv(),this._initMarkerDiv(),this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._mouseState=0)}},{key:"currentMeasurement",get:function(){return this._currentAngleMeasurement}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),HM=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"AngleMeasurements",e))._container=i.container||document.body,r._defaultControl=null,r._measurements={},r.defaultColor=void 0!==i.defaultColor?i.defaultColor:"#00BBFF",r.defaultLabelsVisible=!1!==i.defaultLabelsVisible,r.zIndex=i.zIndex||1e4,r._onMouseOver=function(e,t){r.fire("mouseOver",{plugin:w(r),angleMeasurement:t,measurement:t,event:e})},r._onMouseLeave=function(e,t){r.fire("mouseLeave",{plugin:w(r),angleMeasurement:t,measurement:t,event:e})},r._onContextMenu=function(e,t){r.fire("contextMenu",{plugin:w(r),angleMeasurement:t,measurement:t,event:e})},r}return I(n,[{key:"getContainerElement",value:function(){return this._container}},{key:"send",value:function(e,t){}},{key:"control",get:function(){return this._defaultControl||(this._defaultControl=new LM(this,{})),this._defaultControl}},{key:"measurements",get:function(){return this._measurements}},{key:"createMeasurement",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);var n=t.origin,r=t.corner,i=t.target,s=new OM(this,{id:t.id,plugin:this,container:this._container,origin:{entity:n.entity,worldPos:n.worldPos},corner:{entity:r.entity,worldPos:r.worldPos},target:{entity:i.entity,worldPos:i.worldPos},visible:t.visible,originVisible:!0,originWireVisible:!0,cornerVisible:!0,targetWireVisible:!0,targetVisible:!0,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[s.id]=s,s.on("destroyed",(function(){delete e._measurements[s.id]})),s.clickable=!0,this.fire("measurementCreated",s),s}},{key:"destroyMeasurement",value:function(e){var t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("AngleMeasurement not found: "+e)}},{key:"setLabelsShown",value:function(e){for(var t=0,n=Object.entries(this.measurements);t<n.length;t++){var r=k(n[t],2);r[0];r[1].labelShown=e}}},{key:"clear",value:function(){for(var e=Object.keys(this._measurements),t=0,n=e.length;t<n;t++)this.destroyMeasurement(e[t])}},{key:"destroy",value:function(){this.clear(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),NM=De.vec2(),GM=function(e){m(n,VM);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e.viewer.scene)).pointerLens=i.pointerLens,r.pointerCircle=new ft(e.viewer),r._active=!1;var s=document.createElement("div"),a=r.scene.canvas.canvas;return a.parentNode.insertBefore(s,a),s.style.background="black",s.style.border="2px solid blue",s.style.borderRadius="10px",s.style.width="5px",s.style.height="5px",s.style.margin="-200px -200px",s.style.zIndex="100",s.style.position="absolute",s.style.pointerEvents="none",r.markerDiv=s,r._currentAngleMeasurement=null,r._longTouchTimeoutMs=300,r._snapping=!1!==i.snapping,r._touchState=0,r._attachPlugin(e,i),r}return I(n,[{key:"_attachPlugin",value:function(e){this.angleMeasurementsPlugin=e,this.plugin=e}},{key:"active",get:function(){return this._active}},{key:"snapping",get:function(){return this._snapping},set:function(e){this._snapping=e}},{key:"activate",value:function(){var e=this;if(!this._active){var t=this.plugin,n=this.scene,r=n.canvas.canvas;t.pointerLens;var i=De.vec3(),s=20,a=null;this._touchState=0;var o=De.vec2(),A=De.vec2(),c=De.vec2(),l=null,u=function(){e.plugin.viewer.cameraControl.active=!1},h=function(){e.plugin.viewer.cameraControl.active=!0},d=function(e,t){return t[0]=e.clientX,t[1]=e.clientY,pM(r.ownerDocument.documentElement,r,t),t},f=function(e,t){return t.set(e),pM(r,r.ownerDocument.documentElement,t),t};r.addEventListener("touchstart",this._onCanvasTouchStart=function(r){var c=r.touches.length;if(1===c){var p=r.touches[0];switch(d(p,o),A.set(o),e._touchState){case 0:if(1!==c&&null!==a)return a&&(clearTimeout(a),a=null),e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null),h(),void(e._touchState=0);var v=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping});if(v&&v.snapped)i.set(v.worldPos),e.pointerCircle.start(f(v.snappedCanvasPos,NM));else{var g=n.pick({canvasPos:A,pickSurface:!0});if(!g||!g.worldPos)return;i.set(g.worldPos),e.pointerCircle.start(f(g.canvasPos,NM))}a=setTimeout((function(){1!==c||A[0]>o[0]+s||A[0]<o[0]-s||A[1]>o[1]+s||A[1]<o[1]-s||(e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=o,e.pointerLens.cursorPos=o),e.pointerLens&&(e.pointerLens.canvasPos=A,e.pointerLens.snapped=!1),e.pointerLens&&(e.pointerLens.cursorPos=v.canvasPos,e.pointerLens.snapped=!0),e._currentAngleMeasurement?e._currentAngleMeasurement.origin.worldPos=i:(e._currentAngleMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:v.worldPos,entity:v.entity},corner:{worldPos:v.worldPos,entity:v.entity},target:{worldPos:v.worldPos,entity:v.entity}}),e._currentAngleMeasurement.clickable=!1,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!1,e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1),e.angleMeasurementsPlugin.fire("measurementStart",e._currentAngleMeasurement),e._touchState=2,u())}),e._longTouchTimeoutMs),e._touchState=1,l=p.identifier;break;case 3:if(1!==c&&null!==a)return clearTimeout(a),void(a=null);1===c&&(a=setTimeout((function(){if(a=null,!(1!==c||A[0]>o[0]+s||A[0]<o[0]-s||A[1]>o[1]+s||A[1]<o[1]-s)){e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=o,e.pointerLens.snapped=!1);var t=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping});if(t&&t.snapped)e.pointerLens&&(e.pointerLens.cursorPos=t.snappedCanvasPos,e.pointerLens.snapped=!0),e.pointerCircle.start(f(t.snappedCanvasPos,NM)),i.set(t.worldPos),e._currentAngleMeasurement.corner.worldPos=t.worldPos,e._currentAngleMeasurement.corner.entity=t.entity,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e.angleMeasurementsPlugin.fire("measurementStart",e._currentAngleMeasurement);else{var r=n.pick({canvasPos:A,pickSurface:!0});r&&r.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=r.canvasPos,e.pointerLens.snapped=!1),e.pointerCircle.start(f(r.canvasPos,NM)),i.set(r.worldPos),e._currentAngleMeasurement.corner.worldPos=r.worldPos,e._currentAngleMeasurement.corner.entity=r.entity,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e.angleMeasurementsPlugin.fire("measurementStart",e._currentAngleMeasurement)):e.pointerLens&&(e.pointerLens.cursorPos=null,e.pointerLens.snapped=!1)}e._touchState=5,u()}}),e._longTouchTimeoutMs),e._touchState=4),l=p.identifier;break;case 6:if(1!==c&&null!==a)return clearTimeout(a),void(a=null);1===c&&(a=setTimeout((function(){if(a=null,!(1!==c||A[0]>o[0]+s||A[0]<o[0]-s||A[1]>o[1]+s||A[1]<o[1]-s)){e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=o,e.pointerLens.snapped=!1);var t=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping});if(t&&t.snapped)e.pointerLens&&(e.pointerLens.cursorPos=t.snappedCanvasPos,e.pointerLens.snapped=!0),e.pointerCircle.start(f(t.snappedCanvasPos,NM)),i.set(t.worldPos),e._currentAngleMeasurement.target.worldPos=t.worldPos,e._currentAngleMeasurement.target.entity=t.entity,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e.angleMeasurementsPlugin.fire("measurementStart",e._currentAngleMeasurement);else{var r=n.pick({canvasPos:A,pickSurface:!0});r&&r.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=r.canvasPos,e.pointerLens.snapped=!1),e.pointerCircle.start(f(r.canvasPos,NM)),i.set(r.worldPos),e._currentAngleMeasurement.target.worldPos=r.worldPos,e._currentAngleMeasurement.target.entity=r.entity,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e.angleMeasurementsPlugin.fire("measurementStart",e._currentAngleMeasurement)):e.pointerLens&&(e.pointerLens.cursorPos=null,e.pointerLens.snapped=!1)}e._touchState=8,u()}}),e._longTouchTimeoutMs),e._touchState=7),l=p.identifier;break;default:return null!==a&&(clearTimeout(a),a=null),void(e._touchState=7)}}else a&&(clearTimeout(a),a=null)},{passive:!0}),r.addEventListener("touchmove",(function(t){e.pointerCircle.stop();var r=t.touches.length;if(1===r&&1===t.changedTouches.length){var s,o,c=t.touches[0];if(c.identifier===l)switch(d(c,A),e._touchState){case 2:e.pointerLens&&(e.pointerLens.canvasPos=A),(s=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping}))&&s.snapped?(e.pointerLens&&(e.pointerLens.snappedCanvasPos=s.snappedCanvasPos,e.pointerLens.snapped=!0),i.set(s.worldPos),e._currentAngleMeasurement.origin.worldPos=s.worldPos):(o=n.pick({canvasPos:A,pickSurface:!0}))&&o.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=o.canvasPos,e.pointerLens.snapped=!1),i.set(o.worldPos),e._currentAngleMeasurement.origin.worldPos=o.worldPos):e.pointerLens&&(e.pointerLens.cursorPos=null,e.pointerLens.snapped=!1),e._touchState=2;break;case 5:if(1!==r&&null!==a)return clearTimeout(a),a=null,e.pointerLens&&(e.pointerLens.visible=!1),void(e._touchState=7);e.pointerLens&&(e.pointerLens.canvasPos=A),(s=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping}))&&s.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=s.snappedCanvasPos,e.pointerLens.snapped=!0),e._currentAngleMeasurement.corner.worldPos=s.worldPos,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1):(o=n.pick({canvasPos:A,pickSurface:!0}))&&o.worldPos&&(e.pointerLens&&(e.pointerLens.cursorPos=o.canvasPos,e.pointerLens.snapped=!1),e._currentAngleMeasurement.corner.worldPos=o.worldPos,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1),e._touchState=5;break;case 8:if(1!==r&&null!==a)return clearTimeout(a),a=null,e.pointerLens&&(e.pointerLens.visible=!1),void(e._touchState=7);e.pointerLens&&(e.pointerLens.canvasPos=A),(s=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping}))&&s.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=s.snappedCanvasPos,e.pointerLens.snapped=!0),e._currentAngleMeasurement.target.worldPos=s.worldPos,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.angleVisible=!0):(o=n.pick({canvasPos:A,pickSurface:!0}))&&o.worldPos&&(e.pointerLens&&(e.pointerLens.cursorPos=o.canvasPos,e.pointerLens.snapped=!1),e._currentAngleMeasurement.target.worldPos=o.worldPos,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.angleVisible=!0),e._touchState=8}}else a&&(clearTimeout(a),a=null)}),{passive:!0}),r.addEventListener("touchend",this._onCanvasTouchEnd=function(r){e.pointerCircle.stop();var i=r.changedTouches.length;if(1===i){var u=r.changedTouches[0];if(u.identifier===l){a&&(clearTimeout(a),a=null),d(u,c);var f=c[0],p=c[1];switch(e._touchState){case 1:if(1!==i||f>o[0]+s||f<o[0]-s||p>o[1]+s||p<o[1]-s)return void(e._touchState=0);var v=n.pick({canvasPos:A,pickSurface:!0});v&&v.worldPos?(e._currentAngleMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:v.worldPos},corner:{worldPos:v.worldPos},target:{worldPos:v.worldPos}}),e._currentAngleMeasurement.clickable=!1,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!1,e._currentAngleMeasurement.cornerVisible=!1,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e._touchState=3):(e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null),e._touchState=0),h();break;case 2:e.pointerLens&&(e.pointerLens.visible=!1),e._currentAngleMeasurement?e._touchState=3:(e.pointerLens&&(e.pointerLens.snapped=!1,e.pointerLens.visible=!1),e._touchState=0),h();break;case 4:if(1!==i||f>o[0]+s||f<o[0]-s||p>o[1]+s||p<o[1]-s)return void(e._touchState=3);var g=n.pick({canvasPos:A,pickSurface:!0});g&&g.worldPos?(e._currentAngleMeasurement.corner.worldPos=g.worldPos,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!1,e._currentAngleMeasurement.targetVisible=!1,e._currentAngleMeasurement.targetWireVisible=!1,e._currentAngleMeasurement.angleVisible=!1,e._touchState=6):(e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null),e._touchState=0),h();break;case 5:e.pointerLens&&(e.pointerLens.visible=!1),e._touchState=6,h();break;case 7:if(1!==i||f>o[0]+s||f<o[0]-s||p>o[1]+s||p<o[1]-s)return void(e._touchState=6);var m=n.pick({canvasPos:A,pickSurface:!0});m&&m.worldPos?(e._currentAngleMeasurement.target.worldPos=m.worldPos,e._currentAngleMeasurement.originVisible=!0,e._currentAngleMeasurement.originWireVisible=!0,e._currentAngleMeasurement.cornerVisible=!0,e._currentAngleMeasurement.cornerWireVisible=!0,e._currentAngleMeasurement.targetVisible=!0,e._currentAngleMeasurement.targetWireVisible=!0,e._currentAngleMeasurement.angleVisible=!0,e.angleMeasurementsPlugin.fire("measurementEnd",e._currentAngleMeasurement),e._currentAngleMeasurement=null):e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null),e._touchState=0,h();break;case 8:e.pointerLens&&(e.pointerLens.visible=!1),e._currentAngleMeasurement&&e._currentAngleMeasurement.targetVisible?(e._currentAngleMeasurement.clickable=!0,e.angleMeasurementsPlugin.fire("measurementEnd",e._currentAngleMeasurement),e._currentAngleMeasurement=null,e._touchState=0):(e._currentAngleMeasurement&&(e._currentAngleMeasurement.destroy(),e._currentAngleMeasurement=null),e._touchState=0),h()}}}},{passive:!0}),this._active=!0}}},{key:"deactivate",value:function(){if(this._active){this.plugin.pointerLens&&(this.plugin.pointerLens.visible=!1),this.reset();var e=this.plugin.viewer.scene.canvas.canvas;e.removeEventListener("touchstart",this._onCanvasTouchStart),e.removeEventListener("touchend",this._onCanvasTouchEnd),this._active=!1,this.plugin.viewer.cameraControl.active=!0}}},{key:"reset",value:function(){this._active&&this._currentAngleMeasurement&&(this.angleMeasurementsPlugin.fire("measurementCancel",this._currentAngleMeasurement),this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null)}},{key:"currentMeasurement",get:function(){return this._currentAngleMeasurement}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),jM=function(e){m(n,it);var t=_(n);function n(e,r,i,s){var a;x(this,n);var o=e.plugin.viewer;a=t.call(this,o.scene);var A=MM({viewer:o,handleMouseEvents:i,handleTouchEvents:s,pointerLens:r.pointerLens,dots:[e.origin,e.corner,e.target],ray2WorldPos:function(e,t,n){return function e(t){var r=o.scene.pick({canvasPos:n,snapToEdge:t,snapToVertex:t,pickSurface:!0});return r&&r.worldPos?r.worldPos:t&&e(!1)}(!!r.snapping)},onEnd:function(e,t){var n=!De.compareVec3(e,t.worldPos);return n&&a.fire("edited"),n}}),c=e.on("destroyed",A);return a._deactivate=function(){e.off("destroyed",c),A()},a}return I(n,[{key:"deactivate",value:function(){this._deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),WM=function(e){m(n,jM);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!0,!1)}return I(n)}(),zM=function(e){m(n,jM);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!1,!0)}return I(n)}(),XM=De.vec3(),KM=De.vec3(),ZM=De.vec3(),JM=function(e){return e+"px"},YM=function(e){m(n,jo);var t=_(n);function n(e,r){var i;if(x(this,n),(i=t.call(this,e,r)).plugin=r.plugin,i._container=r.container,!i._container)throw"config missing: container";if(!r.markerElement&&!r.markerHTML)throw"config missing: need either markerElement or markerHTML";if(!r.labelElement&&!r.labelHTML)throw"config missing: need either labelElement or labelHTML";return i._htmlDirty=!1,i._curMarkerWidth=void 0,i._curLabelWidth=0,r.markerElement?(i._marker=r.markerElement,i._marker.addEventListener("click",i._onMouseClickedExternalMarker=function(){i.plugin.fire("markerClicked",w(i))}),i._onContextMenuExternalMarker=function(){i.plugin.fire("contextmenu",w(i))},i._onContextMenuExternalMarkerRemover=YC(i._marker,i._onContextMenuExternalMarker),i._marker.addEventListener("mouseenter",i._onMouseEnterExternalMarker=function(){i.plugin.fire("markerMouseEnter",w(i))}),i._marker.addEventListener("mouseleave",i._onMouseLeaveExternalMarker=function(){i.plugin.fire("markerMouseLeave",w(i))}),i._markerExternal=!0):(i._markerHTML=r.markerHTML,i._htmlDirty=!0,i._markerExternal=!1),r.labelElement?(i._label=r.labelElement,i._labelExternal=!0):(i._labelHTML=r.labelHTML,i._htmlDirty=!0,i._labelExternal=!1),i._markerShown=!!r.markerShown,i._labelShown=!!r.labelShown,i._values=r.values||{},i._layoutDirty=!0,i._visibilityDirty=!0,i._labelPosition=24,i._buildHTML(),i._onTick=i.scene.on("tick",(function(){i._htmlDirty&&(i._buildHTML(),i._htmlDirty=!1,i._layoutDirty=!0,i._visibilityDirty=!0),(i._layoutDirty||i._visibilityDirty)&&(i._markerShown||i._labelShown)&&(i._updatePosition(),i._layoutDirty=!1),i._visibilityDirty&&(i._marker.style.visibility=i.visible&&i._markerShown?"visible":"hidden",i._label.style.visibility=i.visible&&i._markerShown&&i._labelShown?"visible":"hidden",i._visibilityDirty=!1)})),i.on("canvasPos",(function(){i._layoutDirty=!0})),i.on("visible",(function(){i._visibilityDirty=!0})),i.setMarkerShown(!1!==r.markerShown),i.setLabelShown(r.labelShown),i.eye=r.eye?r.eye.slice():null,i.look=r.look?r.look.slice():null,i.up=r.up?r.up.slice():null,i.projection=r.projection,i}return I(n,[{key:"_buildHTML",value:function(){var e=this;if(!this._markerExternal){this._marker&&(this._container.removeChild(this._marker),this._marker=null);var t=this._markerHTML||"<p></p>";je.isArray(t)&&(t=t.join("")),t=this._renderTemplate(t.trim());var n=document.createRange().createContextualFragment(t);this._marker=n.firstChild,this._container.appendChild(this._marker),this._marker.style.visibility=this._markerShown?"visible":"hidden",this._marker.addEventListener("click",(function(){e.plugin.fire("markerClicked",e)})),YC(this._marker,(function(t){t.preventDefault(),e.plugin.fire("contextmenu",e)}),(function(t){t.preventDefault(),e.plugin.fire("markerClicked",e)})),this._marker.addEventListener("mouseenter",(function(){e.plugin.fire("markerMouseEnter",e)})),this._marker.addEventListener("mouseleave",(function(){e.plugin.fire("markerMouseLeave",e)})),this._marker.addEventListener("wheel",(function(t){e.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",t))}))}if(!this._labelExternal){this._label&&(this._container.removeChild(this._label),this._label=null);var r=this._labelHTML||"<p></p>";je.isArray(r)&&(r=r.join("")),r=this._renderTemplate(r.trim());var i=document.createRange().createContextualFragment(r);this._label=i.firstChild,this._container.appendChild(this._label),this._label.style.visibility=this._markerShown&&this._labelShown?"visible":"hidden",this._label.addEventListener("wheel",(function(t){e.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",t))}))}}},{key:"_updateWithCurWidths",value:function(){var e=this.scene.canvas.boundary,t=e[0]+this.canvasPos[0],n=e[1]+this.canvasPos[1];if(this._marker.style.top=JM(n-12),this._label.style.top=JM(n-17),"legacy"===this._markerAlign)this._marker.style.left=JM(t-12),this._label.style.left=JM(t+40);else{var r=this._curMarkerWidth,i=t+("right"===this._markerAlign?-1:"center"===this._markerAlign?0:1)*(r/2-12);this._marker.style.left=JM(i-r/2);var s=this._curLabelWidth,a=Math.sign(this._labelPosition);this._label.style.left=JM(i+a*(r/2+Math.abs(this._labelPosition)+s/2)-s/2)}var o=90005+Math.floor(this._viewPos[2])+1;this._marker.style["z-index"]=o,this._label.style["z-index"]=o}},{key:"_updateIfWidthsChanged",value:function(){var e=!1,t=this._marker.getBoundingClientRect().width;if(this._curMarkerWidth!==t&&(this._curMarkerWidth=t,e=!0),1!==Math.sign(this._labelPosition)){var n=this._label.getBoundingClientRect().width;this._curLabelWidth!==n&&(this._curLabelWidth=n,e=!0)}e&&this._updateWithCurWidths()}},{key:"_updatePosition",value:function(){var e=this,t="legacy"===this._markerAlign;t||void 0!==this._curMarkerWidth?(this._updateWithCurWidths(),window.clearTimeout(this._widthTimeout),t||(this._widthTimeout=window.setTimeout((function(){return e._updateIfWidthsChanged()}),500))):this._updateIfWidthsChanged()}},{key:"_renderTemplate",value:function(e){for(var t in this._values)if(this._values.hasOwnProperty(t)){var n=this._values[t];e=e.replace(new RegExp("{{"+t+"}}","g"),n)}return e}},{key:"setFromPickResult",value:function(e){if(e.worldPos&&e.worldNormal){var t=De.normalizeVec3(e.worldNormal,XM),n=this.plugin&&this.plugin.surfaceOffset||0,r=De.mulVec3Scalar(t,n,KM),i=De.addVec3(e.worldPos,r,ZM);this.entity=e.entity,this.worldPos=i}else this.error("Param 'pickResult' does not have both worldPos and worldNormal")}},{key:"setMarkerAlign",value:function(e){var t=["left","center","right","legacy"];t.includes(e)?(this._markerAlign=e,this._updatePosition()):this.error("Param 'align' should be one of: "+JSON.stringify(t))}},{key:"setLabelPosition",value:function(e){"number"!=typeof e?this.error("Param 'position' is not a number"):0===e?this.error("Param 'position' is zero"):(this._labelPosition=e,this._updatePosition())}},{key:"setMarkerShown",value:function(e){e=!!e,this._markerShown!==e&&(this._markerShown=e,this._visibilityDirty=!0)}},{key:"getMarkerShown",value:function(){return this._markerShown}},{key:"setLabelShown",value:function(e){e=!!e,this._labelShown!==e&&(this._labelShown=e,this._visibilityDirty=!0)}},{key:"getLabelShown",value:function(){return this._labelShown}},{key:"setField",value:function(e,t){this._values[e]=t||"",this._htmlDirty=!0}},{key:"getField",value:function(e){return this._values[e]}},{key:"setValues",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this.setField(t,n)}}},{key:"getValues",value:function(){return this._values}},{key:"destroy",value:function(){window.clearTimeout(this._widthTimeout),this._marker&&(this._markerExternal?(this._marker.removeEventListener("click",this._onMouseClickedExternalMarker),this._onContextMenuExternalMarkerRemover(),this._marker.removeEventListener("mouseenter",this._onMouseEnterExternalMarker),this._marker.removeEventListener("mouseleave",this._onMouseLeaveExternalMarker),this._marker=null):(this._marker.parentNode.removeChild(this._marker),this._marker=null)),this._label&&(this._labelExternal||this._label.parentNode.removeChild(this._label),this._label=null),this.scene.off(this._onTick),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),qM=function(e){m(n,uA);var t=_(n);function n(e,r){var i;return x(this,n),(i=t.call(this,"Annotations",e))._labelHTML=r.labelHTML||"<div></div>",i._markerHTML=r.markerHTML||"<div></div>",i._container=r.container||document.body,i._values=r.values||{},i.annotations={},i.surfaceOffset=r.surfaceOffset,i}return I(n,[{key:"getContainerElement",value:function(){return this._container}},{key:"send",value:function(e,t){if("clearAnnotations"===e)this.clear()}},{key:"surfaceOffset",get:function(){return this._surfaceOffset},set:function(e){null==e&&(e=.3),this._surfaceOffset=e}},{key:"createAnnotation",value:function(e){var t=this;this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);var n=null;e.markerElementId&&((n=document.getElementById(e.markerElementId))||this.error("Can't find DOM element for 'markerElementId' value '"+e.markerElementId+"' - defaulting to internally-generated empty DIV"));var r=null;e.labelElementId&&((r=document.getElementById(e.labelElementId))||this.error("Can't find DOM element for 'labelElementId' value '"+e.labelElementId+"' - defaulting to internally-generated empty DIV"));var i=new YM(this.viewer.scene,{id:e.id,plugin:this,container:this._container,markerElement:n,labelElement:r,markerHTML:e.markerHTML||this._markerHTML,labelHTML:e.labelHTML||this._labelHTML,occludable:e.occludable,values:je.apply(e.values,je.apply(this._values,{})),markerShown:e.markerShown,labelShown:e.labelShown,eye:e.eye,look:e.look,up:e.up,projection:e.projection,visible:!1!==e.visible});return e.pickResult=e.pickResult||e.pickRecord,e.pickResult?i.setFromPickResult(e.pickResult):(i.entity=e.entity,i.worldPos=e.worldPos),this.annotations[i.id]=i,i.on("destroyed",(function(){delete t.annotations[i.id],t.fire("annotationDestroyed",i.id)})),this.fire("annotationCreated",i.id),i}},{key:"destroyAnnotation",value:function(e){var t=this.annotations[e];t?t.destroy():this.log("Annotation not found: "+e)}},{key:"clear",value:function(){for(var e=Object.keys(this.annotations),t=0,n=e.length;t<n;t++)this.destroyAnnotation(e[t])}},{key:"destroy",value:function(){this.clear(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),$M=function(e){m(n,uA);var t=_(n);function n(e,r){var i;x(this,n),r=r||{},i=t.call(this,"AxisGizmo",e,r);var s=e.scene.camera;r.canvasId||r.canvasElement||i.error("Config expected: either 'canvasId' or 'canvasElement'");try{i._axisGizmoScene=new uc(e,{canvasId:r.canvasId,canvasElement:r.canvasElement,transparent:!0})}catch(e){return i.error(e),b(i)}var a=i._axisGizmoScene;a.clearLights(),new Po(a,{color:[.45,.45,.5],intensity:.9}),new Do(a,{dir:[-.5,.5,-.6],color:[.8,.8,.7],intensity:1,space:"view"}),new Do(a,{dir:[.5,-.5,-.6],color:[.8,.8,.8],intensity:1,space:"view"});var o=a.camera;s.on("matrix",(function(){var e=s.eye,t=s.look,n=s.up,r=De.mulVec3Scalar(De.normalizeVec3(De.subVec3(e,t,[])),22);o.look=[0,0,0],o.eye=r,o.up=n}));var A=new Wt(a,tn({radiusTop:.01,radiusBottom:.6,height:1.7,radialSegments:20,heightSegments:1,openEnded:!1})),c=new Wt(a,tn({radiusTop:.2,radiusBottom:.2,height:4.5,radialSegments:20,heightSegments:1,openEnded:!1})),l=new wi(a,{diffuse:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),u=new wi(a,{emissive:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),h=new wi(a,{diffuse:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),d=new wi(a,{emissive:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),f=new wi(a,{diffuse:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),p=new wi(a,{emissive:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),v=new wi(a,{diffuse:[.5,.5,.5],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2});return i._meshes=[new vi(a,{geometry:new Wt(a,sn({radius:9,heightSegments:60,widthSegments:60})),material:new wi(a,{diffuse:[0,0,0],emissive:[.1,.1,.1],ambient:[.1,.1,.2],specular:[0,0,0],alpha:.4,alphaMode:"blend",frontface:"cw"}),pickable:!1,collidable:!1,visible:!1!==r.visible}),new vi(a,{geometry:new Wt(a,sn({radius:1})),material:v,pickable:!1,collidable:!1,visible:!1!==r.visible}),new vi(a,{geometry:A,material:l,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[5,0,0],rotation:[0,0,-90]}),new vi(a,{geometry:c,material:l,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[2,0,0],rotation:[0,0,90]}),new vi(a,{geometry:new Wt(a,An({text:"X",size:1.5})),material:u,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[7,0,0],billboard:"spherical"}),new vi(a,{geometry:A,material:h,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[0,5,0]}),new vi(a,{geometry:c,material:h,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[0,2,0]}),new vi(a,{geometry:new Wt(a,An({text:"Y",size:1.5})),material:d,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[0,7,0],billboard:"spherical"}),new vi(a,{geometry:A,material:f,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[0,0,5],rotation:[90,0,0]}),new vi(a,{geometry:c,material:f,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[0,0,2],rotation:[90,0,0]}),new vi(a,{geometry:new Wt(a,An({text:"Z",size:1.5})),material:p,pickable:!1,collidable:!1,visible:!1!==r.visible,position:[0,0,7],billboard:"spherical"})],i}return I(n,[{key:"setVisible",value:function(e){for(var t=0;t<this._meshes.length;t++)this._meshes[t].visible=e}},{key:"destroy",value:function(){this._axisGizmoCanvas=null,this._axisGizmoScene.destroy(),this._axisGizmoScene=null,v(C(n.prototype),"destroy",this).call(this)}}]),n}(),ek=De.vec3(),tk=De.vec3(),nk=De.vec3(),rk=De.vec3(),ik=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"BCFViewpoints",e,i)).originatingSystem=i.originatingSystem||"xeokit.io",r.authoringTool=i.authoringTool||"xeokit.io",r}return I(n,[{key:"getViewpoint",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.viewer.scene,r=n.camera,i=n.realWorldOffset,s=!0===t.reverseClippingPlanes,a={},o=De.normalizeVec3(De.subVec3(r.look,r.eye,De.vec3())),A=r.eye,c=r.up;r.yUp&&(o=ok(o),A=ok(A),c=ok(c));var l=sk(De.addVec3(A,i));"ortho"===r.projection?a.orthogonal_camera={camera_view_point:l,camera_direction:sk(o),camera_up_vector:sk(c),view_to_world_scale:r.ortho.scale}:a.perspective_camera={camera_view_point:l,camera_direction:sk(o),camera_up_vector:sk(c),field_of_view:r.perspective.fov};var u=n.sectionPlanes;for(var h in u)if(u.hasOwnProperty(h)){var d=u[h];if(!d.active)continue;var f=d.pos,p=void 0;p=s?De.negateVec3(d.dir,De.vec3()):d.dir,r.yUp&&(f=ok(f),p=ok(p)),De.addVec3(f,i),f=sk(f),p=sk(p),a.clipping_planes||(a.clipping_planes=[]),a.clipping_planes.push({location:f,direction:p})}var v=n.lineSets;for(var g in v)if(v.hasOwnProperty(g)){var m=v[g];a.lines||(a.lines=[]);for(var y=m.positions,_=m.indices,b=0,w=_.length/2;b<w;b++){var B=_[2*b],C=_[2*b+1];a.lines.push({start_point:{x:y[3*B+0],y:y[3*B+1],z:y[3*B+2]},end_point:{x:y[3*C+0],y:y[3*C+1],z:y[3*C+2]}})}}var M=n.bitmaps;for(var E in M)if(M.hasOwnProperty(E)){var F=M[E],x=F.pos,U=F.normal,I=F.up;r.yUp&&(x=ok(x),U=ok(U),I=ok(I)),De.addVec3(x,i),a.bitmaps||(a.bitmaps=[]),a.bitmaps.push({bitmap_type:F.type,bitmap_data:F.imageData,location:sk(x),normal:sk(U),up:sk(I),height:F.height})}a.components={visibility:{view_setup_hints:{spaces_visible:!!t.spacesVisible,space_boundaries_visible:!!t.spaceBoundariesVisible,openings_visible:!!t.openingsVisible,spaces_translucent:!!t.spaces_translucent,space_boundaries_translucent:!!t.space_boundaries_translucent,openings_translucent:!!t.openings_translucent}}};var T=new Set(n.opacityObjectIds),P=new Set(n.xrayedObjectIds),S=new Set(n.colorizedObjectIds),D=Object.values(n.objects).filter((function(e){return T.has(e.id)||S.has(e.id)||P.has(e.id)})).reduce((function(t,r){var i,s=ck(r.colorize);r.xrayed?(i=0===n.xrayMaterial.fillAlpha&&0!==n.xrayMaterial.edgeAlpha?.1:n.xrayMaterial.fillAlpha,s=(i=Math.round(255*i).toString(16).padStart(2,"0"))+s):T.has(r.id)&&(s=(i=Math.round(255*r.opacity).toString(16).padStart(2,"0"))+s),t[s]||(t[s]=[]);var a=r.id,o=r.originalSystemId,A={ifc_guid:o,originating_system:e.originatingSystem};return o!==a&&(A.authoring_tool_id=a),t[s].push(A),t}),{}),Q=Object.entries(D).map((function(e){var t=k(e,2);return{color:t[0],components:t[1]}}));a.components.coloring=Q;var R=n.objectIds,O=n.visibleObjects,V=n.visibleObjectIds,L=R.filter((function(e){return!O[e]})),H=n.selectedObjectIds;return t.defaultInvisible||V.length<L.length?(a.components.visibility.exceptions=this._createBCFComponents(V),a.components.visibility.default_visibility=!1):(a.components.visibility.exceptions=this._createBCFComponents(L),a.components.visibility.default_visibility=!0),a.components.selection=this._createBCFComponents(H),a.components.translucency=this._createBCFComponents(n.xrayedObjectIds),!1!==t.snapshot&&(a.snapshot={snapshot_type:"png",snapshot_data:this.viewer.getSnapshot({format:"png"})}),a}},{key:"_createBCFComponents",value:function(e){for(var t=this.viewer.scene,n=[],r=0,i=e.length;r<i;r++){var s=e[r],a=t.objects[s];if(a){var o={ifc_guid:a.originalSystemId,originating_system:this.originatingSystem};a.originalSystemId!==s&&(o.authoring_tool_id=s),n.push(o)}}return n}},{key:"setViewpoint",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e){var r=this.viewer,i=r.scene,s=i.camera,a=!1!==n.rayCast,o=!1!==n.immediate,A=!1!==n.reset,c=i.realWorldOffset,l=!0===n.reverseClippingPlanes;if(i.clearSectionPlanes(),e.clipping_planes&&e.clipping_planes.length>0&&e.clipping_planes.forEach((function(e){var t=ak(e.location,ek),n=ak(e.direction,ek);l&&De.negateVec3(n),De.subVec3(t,c),s.yUp&&(t=Ak(t),n=Ak(n)),new oA(i,{pos:t,dir:n})})),i.clearLines(),e.lines&&e.lines.length>0){var u=[],h=[],d=0;e.lines.forEach((function(e){e.start_point&&e.end_point&&(u.push(e.start_point.x),u.push(e.start_point.y),u.push(e.start_point.z),u.push(e.end_point.x),u.push(e.end_point.y),u.push(e.end_point.z),h.push(d++),h.push(d++))})),new Io(i,{positions:u,indices:h,clippable:!1,collidable:!0})}if(i.clearBitmaps(),e.bitmaps&&e.bitmaps.length>0&&e.bitmaps.forEach((function(e){var t=e.bitmap_type||"jpg",n=e.bitmap_data,r=ak(e.location,tk),a=ak(e.normal,nk),o=ak(e.up,rk),A=e.height||1;t&&n&&r&&a&&o&&(s.yUp&&(r=Ak(r),a=Ak(a),o=Ak(o)),new Yi(i,{src:n,type:t,pos:r,normal:a,up:o,clippable:!1,collidable:!0,height:A}))})),A&&(i.setObjectsXRayed(i.xrayedObjectIds,!1),i.setObjectsHighlighted(i.highlightedObjectIds,!1),i.setObjectsSelected(i.selectedObjectIds,!1)),e.components){if(e.components.visibility){e.components.visibility.default_visibility?(i.setObjectsVisible(i.objectIds,!0),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((function(e){return t._withBCFComponent(n,e,(function(e){return e.visible=!1}))}))):(i.setObjectsVisible(i.objectIds,!1),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((function(e){return t._withBCFComponent(n,e,(function(e){return e.visible=!0}))})));var f=e.components.visibility.view_setup_hints;f&&(!1===f.spaces_visible&&i.setObjectsVisible(r.metaScene.getObjectIDsByType("IfcSpace"),!1),void 0!==f.spaces_translucent&&i.setObjectsXRayed(r.metaScene.getObjectIDsByType("IfcSpace"),!0),f.space_boundaries_visible,!1===f.openings_visible&&i.setObjectsVisible(r.metaScene.getObjectIDsByType("IfcOpening"),!0),f.space_boundaries_translucent,void 0!==f.openings_translucent&&i.setObjectsXRayed(r.metaScene.getObjectIDsByType("IfcOpening"),!0))}e.components.selection&&(i.setObjectsSelected(i.selectedObjectIds,!1),e.components.selection.forEach((function(e){return t._withBCFComponent(n,e,(function(e){return e.selected=!0}))}))),e.components.translucency&&(i.setObjectsXRayed(i.xrayedObjectIds,!1),e.components.translucency.forEach((function(e){return t._withBCFComponent(n,e,(function(e){return e.xrayed=!0}))}))),e.components.coloring&&(i.setObjectsColorized(i.colorizedObjectIds,null),e.components.coloring.forEach((function(e){var r=e.color,i=0,s=!1;8===r.length&&((i=parseInt(r.substring(0,2),16)/255)<=1&&i>=.95&&(i=1),r=r.substring(2),s=!0);var a=[parseInt(r.substring(0,2),16)/255,parseInt(r.substring(2,4),16)/255,parseInt(r.substring(4,6),16)/255];e.components.map((function(e){return t._withBCFComponent(n,e,(function(e){e.colorize=a,s&&(e.opacity=i)}))}))})))}if(e.perspective_camera||e.orthogonal_camera){var p,v,g,m;if(e.perspective_camera?(p=ak(e.perspective_camera.camera_view_point,ek),v=ak(e.perspective_camera.camera_direction,ek),g=ak(e.perspective_camera.camera_up_vector,ek),s.perspective.fov=e.perspective_camera.field_of_view,m="perspective"):(p=ak(e.orthogonal_camera.camera_view_point,ek),v=ak(e.orthogonal_camera.camera_direction,ek),g=ak(e.orthogonal_camera.camera_up_vector,ek),s.ortho.scale=e.orthogonal_camera.view_to_world_scale,m="ortho"),De.subVec3(p,c),s.yUp&&(p=Ak(p),v=Ak(v),g=Ak(g)),a){var y=i.pick({pickSurface:!0,origin:p,direction:v});v=y?y.worldPos:De.addVec3(p,v,ek)}else v=De.addVec3(p,v,ek);o?(s.eye=p,s.look=v,s.up=g,s.projection=m):r.cameraFlight.flyTo({eye:p,look:v,up:g,duration:n.duration,projection:m})}}}},{key:"_withBCFComponent",value:function(e,t,n){var r=this.viewer,i=r.scene;if(t.authoring_tool_id&&t.originating_system===this.originatingSystem){var s=t.authoring_tool_id,a=i.objects[s];if(a)return void n(a);if(e.updateCompositeObjects)if(r.metaScene.metaObjects[s])return void i.withObjects(r.metaScene.getObjectIDsInSubtree(s),n)}if(t.ifc_guid){var o=t.ifc_guid,A=i.objects[o];if(A)return void n(A);if(e.updateCompositeObjects)if(r.metaScene.metaObjects[o])return void i.withObjects(r.metaScene.getObjectIDsInSubtree(o),n);Object.keys(i.models).forEach((function(t){var s=De.globalizeObjectId(t,o),a=i.objects[s];a?n(a):e.updateCompositeObjects&&r.metaScene.metaObjects[s]&&i.withObjects(r.metaScene.getObjectIDsInSubtree(s),n)}))}}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}();function sk(e){return{x:e[0],y:e[1],z:e[2]}}function ak(e,t){return(t=new Float64Array(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t}function ok(e){return new Float64Array([e[0],-e[2],e[1]])}function Ak(e){return new Float64Array([e[0],e[2],-e[1]])}function ck(e){var t="";return t+=Math.round(255*e[0]).toString(16).padStart(2,"0"),t+=Math.round(255*e[1]).toString(16).padStart(2,"0"),t+=Math.round(255*e[2]).toString(16).padStart(2,"0")}var lk=De.vec3(),uk=De.vec3(),hk=De.vec3();De.vec4(),De.vec4(),De.vec4();var dk=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n);var s=e.viewer.scene;(r=t.call(this,s,i)).plugin=e;var a=i.container;if(!a)throw"config missing: container";r._color=i.color||e.defaultColor;var o=function(e,t){var n=[],r=void 0!==e?Boolean(e):t;return{reg:function(e){return n.push(e)},get:function(){return r},set:function(e){r=void 0!==e?Boolean(e):t,n.forEach((function(e){return e(r)}))}}};r._visible=o(i.visible,e.defaultVisible),r._originVisible=o(i.originVisible,e.defaultOriginVisible),r._targetVisible=o(i.targetVisible,e.defaultTargetVisible),r._axisVisible=o(i.axisVisible,e.defaultAxisVisible),r._xAxisVisible=o(i.xAxisVisible,e.defaultAxisVisible),r._yAxisVisible=o(i.yAxisVisible,e.defaultAxisVisible),r._zAxisVisible=o(i.zAxisVisible,e.defaultAxisVisible),r._axisEnabled=o(!0,e.defaultAxisVisible),r._wireVisible=o(i.wireVisible,e.defaultWireVisible),r._xLabelEnabled=o(i.xLabelEnabled,e.defaultXLabelEnabled),r._yLabelEnabled=o(i.yLabelEnabled,e.defaultYLabelEnabled),r._zLabelEnabled=o(i.zLabelEnabled,e.defaultZLabelEnabled),r._lengthLabelEnabled=o(i.lengthLabelEnabled,e.defaultLengthLabelEnabled),r._labelsVisible=o(i.labelsVisible,e.defaultLabelsVisible),r._clickable=o(!1,!1),r._labelsOnWires=o(i.labelsOnWires,e.defaultLabelsOnWires),r._useRotationAdjustment=o(i.useRotationAdjustment,e.useRotationAdjustment),r._axesBasis=De.identityMat4(),r.approximate=i.approximate,r._labelStringFormat=function(e){var t=r.plugin.viewer.scene.metrics,n=t.scale,i=t.unitsInfo[t.units].abbrev;return(r.approximate?" ~ ":" = ")+(e*n).toFixed(2)+i};var A=s.canvas.canvas,c=i.onMouseOver?function(e){i.onMouseOver(e,w(r)),A.dispatchEvent(new MouseEvent("mouseover",e))}:null,l=i.onMouseLeave?function(e){i.onMouseLeave(e,w(r)),A.dispatchEvent(new MouseEvent("mouseleave",e))}:null,u=i.onContextMenu?function(e){i.onContextMenu(e,w(r))}:null,h=function(e){return A.dispatchEvent(new MouseEvent("mousedown",e))},d=function(e){return A.dispatchEvent(new MouseEvent("mouseup",e))},f=function(e){return A.dispatchEvent(new MouseEvent("mousemove",e))},p=function(e){return A.dispatchEvent(new WheelEvent("wheel",e))};r._cleanups=[],["units","scale"].forEach((function(e){var t=s.metrics.on("units",(function(){return r._update()}));r._cleanups.push((function(){return s.metrics.off(t)}))})),r._drawables=[];var v=function(e,t){var n=function(){return e.setVisible(t.every((function(e){return e.get()})))};t.forEach((function(e){return e.reg(n)})),r._drawables.push(e),r._cleanups.push((function(){return e.destroy()}))},g=function(t,n,r){var i=new bM(s,a,{color:t,thickness:n,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:c,onMouseLeave:l,onMouseWheel:p,onMouseDown:h,onMouseUp:d,onMouseMove:f,onContextMenu:u});return v(i,r),{setEnds:function(e,t){return i.setEnds(e,t)},setColor:function(e){return i.setColor(e)}}};r._lengthWire=g(r._color,2,[r._visible,r._wireVisible]),r._xAxisWire=g("red",1,[r._visible,r._axisEnabled,r._axisVisible,r._xAxisVisible]),r._yAxisWire=g("green",1,[r._visible,r._axisEnabled,r._axisVisible,r._yAxisVisible]),r._zAxisWire=g("blue",1,[r._visible,r._axisEnabled,r._axisVisible,r._zAxisVisible]);var m=function(t,n,r){var i=new _M(s,a,{fillColor:t,zIndex:void 0!==e.zIndex?e.zIndex+n:void 0,onMouseOver:c,onMouseLeave:l,onMouseWheel:p,onMouseDown:h,onMouseUp:d,onMouseMove:f,onContextMenu:u});return v(i,r),{setFillColor:function(e){return i.setFillColor(e)},setPosOnWire:function(e,t,n,r){return i.setPosOnWire(e,t,n,r)},setPosBetween:function(e,t,n){return i.setPosBetween(e,t,n)},setText:function(e){return i.setText(e.replace(/ /g,"&nbsp;"))}}};r._lengthLabel=m(r._color,4,[r._visible,r._wireVisible,r._labelsVisible,r._clickable,r._axisEnabled,r._lengthLabelEnabled]),r._xAxisLabel=m("red",3,[r._visible,r._axisEnabled,r._axisVisible,r._xAxisVisible,r._labelsVisible,r._clickable,r._xLabelEnabled]),r._yAxisLabel=m("green",3,[r._visible,r._axisEnabled,r._axisVisible,r._yAxisVisible,r._labelsVisible,r._clickable,r._yLabelEnabled]),r._zAxisLabel=m("blue",3,[r._visible,r._axisEnabled,r._axisVisible,r._zAxisVisible,r._labelsVisible,r._clickable,r._zLabelEnabled]);var y=function(t,n){var i=new yM(s,t,a,{fillColor:r._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:c,onMouseLeave:l,onMouseWheel:p,onMouseDown:h,onMouseUp:d,onMouseMove:f,onContextMenu:u});return i.on("worldPos",(function(){return r._update()})),v(i,n),i};return r._originDot=y(i.origin,[r._visible,r._originVisible]),r._targetDot=y(i.target,[r._visible,r._targetVisible]),r._update(),r}return I(n,[{key:"_update",value:function(){var e=this;if(this._targetDot){var t=this._originDot.worldPos,n=this._targetDot.worldPos,r=this._axesBasis,i=De.subVec3(n,t,lk),s=De.transformVec3(r,i,i),a=this._useRotationAdjustment.get()&&Math.abs(i[1])>0,o=function(r,i){var s=e.plugin.viewer.scene.metrics,o=s.scale;s.unitsInfo[s.units].abbrev;var A=function(r,i,s,a){e._labelsOnWires.get()?r.setPosOnWire(i,s,0,e.plugin.labelMinAxisLength):r.setPosOnWire(t,n,35*a,0)};e._xAxisWire.setEnds(t,r),A(e._xAxisLabel,t,r,1),e._xAxisLabel.setText("X"+e._labelStringFormat(De.distVec3(t,r))),e._yAxisWire.setEnds(r,i),A(e._yAxisLabel,r,i,2),e._yAxisLabel.setText("Y"+e._labelStringFormat(De.distVec3(r,i))),e._zAxisWire.setEnds(i,n),A(e._zAxisLabel,i,n,3),e._zAxisLabel.setText((a?"":"Z")+e._labelStringFormat(De.distVec3(i,n))),e._lengthWire.setEnds(t,n),A(e._lengthLabel,t,n,0);var c=De.distVec3(t,n);e._length=c*o,e._lengthLabel.setText(e._labelStringFormat(c))};a?(hk[0]=t[0],hk[1]=n[1],hk[2]=t[2],o(t,hk)):(uk[0]=t[0]+r[0]*s[0],uk[1]=t[1]+r[4]*s[0],uk[2]=t[2]+r[8]*s[0],hk[0]=uk[0]+r[1]*s[1],hk[1]=uk[1]+r[5]*s[1],hk[2]=uk[2]+r[9]*s[1],o(uk,hk))}}},{key:"axesBasis",get:function(){return this._axesBasis},set:function(e){this._axesBasis.set(e),this._update()}},{key:"approximate",get:function(){return this._approximate},set:function(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._update())}},{key:"origin",get:function(){return this._originDot}},{key:"target",get:function(){return this._targetDot}},{key:"length",get:function(){return this._length}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._originDot.setFillColor(e),this._targetDot.setFillColor(e),this._lengthWire.setColor(e),this._lengthLabel.setFillColor(e)}},{key:"visible",get:function(){return this._visible.get()},set:function(e){this._visible.set(e)}},{key:"originVisible",get:function(){return this._originVisible.get()},set:function(e){this._originVisible.set(e)}},{key:"targetVisible",get:function(){return this._targetVisible.get()},set:function(e){this._targetVisible.set(e)}},{key:"useRotationAdjustment",get:function(){return this._useRotationAdjustment.get()},set:function(e){this._useRotationAdjustment.set(e),this._update()}},{key:"axisEnabled",get:function(){return this._axisEnabled.get()},set:function(e){this._axisEnabled.set(e)}},{key:"axisVisible",get:function(){return this._axisVisible.get()},set:function(e){this._axisVisible.set(e)}},{key:"xAxisVisible",get:function(){return this._xAxisVisible.get()},set:function(e){this._xAxisVisible.set(e)}},{key:"yAxisVisible",get:function(){return this._yAxisVisible.get()},set:function(e){this._yAxisVisible.set(e)}},{key:"zAxisVisible",get:function(){return this._zAxisVisible.get()},set:function(e){this._zAxisVisible.set(e)}},{key:"wireVisible",get:function(){return this._wireVisible.get()},set:function(e){this._wireVisible.set(e)}},{key:"labelsVisible",get:function(){return this._labelsVisible.get()},set:function(e){this._labelsVisible.set(e)}},{key:"xLabelEnabled",get:function(){return this._xLabelEnabled.get()},set:function(e){this._xLabelEnabled.set(e)}},{key:"yLabelEnabled",get:function(){return this._yLabelEnabled.get()},set:function(e){this._yLabelEnabled.set(e)}},{key:"zLabelEnabled",get:function(){return this._zLabelEnabled.get()},set:function(e){this._zLabelEnabled.set(e)}},{key:"lengthLabelEnabled",get:function(){return this._lengthLabelEnabled.get()},set:function(e){this._lengthLabelEnabled.set(e)}},{key:"labelsOnWires",get:function(){return this._labelsOnWires.get()},set:function(e){this._labelsOnWires.set(e),this._update()}},{key:"setHighlighted",value:function(e){this._drawables.forEach((function(t){return t.setHighlighted(e)}))}},{key:"clickable",get:function(){return this._clickable.get()},set:function(e){var t=this;this._clickable.set(!!e),this._drawables.forEach((function(e){return e.setClickable(t._clickable.get())}))}},{key:"labelStringFormat",get:function(){return this._labelStringFormat},set:function(e){this._labelStringFormat=e,this._update()}},{key:"destroy",value:function(){this._cleanups.forEach((function(e){return e()})),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),fk=function(e){m(n,it);var t=_(n);function n(){return x(this,n),t.apply(this,arguments)}return I(n,[{key:"active",get:function(){}},{key:"snapping",get:function(){return!0},set:function(e){}},{key:"activate",value:function(){}},{key:"deactivate",value:function(){}},{key:"reset",value:function(){}},{key:"currentMeasurement",get:function(){return null}},{key:"destroy",value:function(){}}]),n}(),pk=function(e){m(n,fk);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e.viewer.scene))._canvasToPagePos=i.canvasToPagePos,r.pointerLens=i.pointerLens,r._active=!1,r._currentDistanceMeasurement=null,r._currentDistanceMeasurementInitState={wireVisible:null,axisVisible:null,xAxisVisible:null,yaxisVisible:null,zAxisVisible:null,targetVisible:null},r._initMarkerDiv(),r._snapping=!1!==i.snapping,r._mouseState=0,r._attachPlugin(e,i),r}return I(n,[{key:"_initMarkerDiv",value:function(){var e=document.createElement("div"),t=this.scene.canvas.canvas;t.parentNode.insertBefore(e,t),e.style.background="black",e.style.border="2px solid blue",e.style.borderRadius="10px",e.style.width="5px",e.style.height="5px",e.style.top="-200px",e.style.left="-200px",e.style.margin="0 0",e.style.zIndex="100",e.style.position="absolute",e.style.pointerEvents="none",this._markerDiv=e}},{key:"_destroyMarkerDiv",value:function(){this._markerDiv&&(this._markerDiv.parentNode.removeChild(this._markerDiv),this._markerDiv=null)}},{key:"_attachPlugin",value:function(e){this.distanceMeasurementsPlugin=e,this.plugin=e}},{key:"active",get:function(){return this._active}},{key:"snapping",get:function(){return this._snapping},set:function(e){this._snapping=e}},{key:"activate",value:function(){var e=this;if(!this._active){this._markerDiv||this._initMarkerDiv(),this.fire("activated",!0);var t=this.distanceMeasurementsPlugin,n=this.scene,r=t.viewer.cameraControl,i=n.canvas.canvas;n.input;var s,a,o=!1,A=De.vec3(),c=De.vec2(),l=null;this._mouseState=0;var u=De.vec2(),h=function(t){var n=t.snappedCanvasPos||t.canvasPos;if(o=!0,A.set(t.worldPos),c.set(t.canvasPos),0===e._mouseState){if(e._canvasToPagePos)e._canvasToPagePos(i,n,u),e._markerDiv.style.left="".concat(u[0]-5,"px"),e._markerDiv.style.top="".concat(u[1]-5,"px");else{var r=De.vec2(n);pM(i,e._markerDiv.parentNode,r),e._markerDiv.style.left="".concat(r[0]-5,"px"),e._markerDiv.style.top="".concat(r[1]-5,"px")}e._markerDiv.style.background="pink",t.snappedToVertex||t.snappedToEdge?(e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=t.canvasPos,e.pointerLens.snappedCanvasPos=t.snappedCanvasPos||t.canvasPos,e.pointerLens.snapped=!0),e._markerDiv.style.background="greenyellow",e._markerDiv.style.border="2px solid green"):(e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=t.canvasPos,e.pointerLens.snappedCanvasPos=t.canvasPos,e.pointerLens.snapped=!1),e._markerDiv.style.background="pink",e._markerDiv.style.border="2px solid red"),l=t.entity}else e._markerDiv.style.left="-10000px",e._markerDiv.style.top="-10000px";i.style.cursor="pointer",e._currentDistanceMeasurement&&(e._currentDistanceMeasurement.wireVisible=e._currentDistanceMeasurementInitState.wireVisible,e._currentDistanceMeasurement.axisVisible=e._currentDistanceMeasurementInitState.axisVisible&&e.distanceMeasurementsPlugin.defaultAxisVisible,e._currentDistanceMeasurement.xAxisVisible=e._currentDistanceMeasurementInitState.xAxisVisible&&e.distanceMeasurementsPlugin.defaultXAxisVisible,e._currentDistanceMeasurement.yAxisVisible=e._currentDistanceMeasurementInitState.yAxisVisible&&e.distanceMeasurementsPlugin.defaultYAxisVisible,e._currentDistanceMeasurement.zAxisVisible=e._currentDistanceMeasurementInitState.zAxisVisible&&e.distanceMeasurementsPlugin.defaultZAxisVisible,e._currentDistanceMeasurement.targetVisible=e._currentDistanceMeasurementInitState.targetVisible,e._currentDistanceMeasurement.target.worldPos=A.slice(),e._markerDiv.style.left="-10000px",e._markerDiv.style.top="-10000px")};this._onHoverSnapOrSurface=r.on("hoverSnapOrSurface",(function(t){e._snapping&&h(t)})),this._onHoverSurface=r.on("hoverSurface",(function(t){e._snapping||h(t)})),i.addEventListener("mousedown",this._onMouseDown=function(e){1===e.which&&(s=e.clientX,a=e.clientY)}),i.addEventListener("mouseup",this._onMouseUp=function(n){1===n.which&&(n.clientX>s+20||n.clientX<s-20||n.clientY>a+20||n.clientY<a-20||(e._currentDistanceMeasurement?o?(e._currentDistanceMeasurement.target.entity=l,l=null,e._currentDistanceMeasurement.clickable=!0,e.distanceMeasurementsPlugin.fire("measurementEnd",e._currentDistanceMeasurement),e._currentDistanceMeasurement=null):(e._currentDistanceMeasurement.destroy(),e.distanceMeasurementsPlugin.fire("measurementCancel",e._currentDistanceMeasurement),e._currentDistanceMeasurement=null,l=null):o&&(e._currentDistanceMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:A.slice(),entity:l},target:{worldPos:A.slice(),entity:l},approximate:!0}),e._currentDistanceMeasurementInitState.axisVisible=e._currentDistanceMeasurement.axisVisible&&e.distanceMeasurementsPlugin.defaultAxisVisible,e._currentDistanceMeasurementInitState.xAxisVisible=e._currentDistanceMeasurement.xAxisVisible&&e.distanceMeasurementsPlugin.defaultXAxisVisible,e._currentDistanceMeasurementInitState.yAxisVisible=e._currentDistanceMeasurement.yAxisVisible&&e.distanceMeasurementsPlugin.defaultYAxisVisible,e._currentDistanceMeasurementInitState.zAxisVisible=e._currentDistanceMeasurement.zAxisVisible&&e.distanceMeasurementsPlugin.defaultZAxisVisible,e._currentDistanceMeasurementInitState.wireVisible=e._currentDistanceMeasurement.wireVisible,e._currentDistanceMeasurementInitState.targetVisible=e._currentDistanceMeasurement.targetVisible,e._currentDistanceMeasurement.clickable=!1,e._currentDistanceMeasurement.origin.entity=l,l=null,e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement))))});var d=function(t){e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=t.canvasPos,e.pointerLens.snappedCanvasPos=t.snappedCanvasPos||t.canvasPos),o=!1,e._markerDiv.style.left="-100px",e._markerDiv.style.top="-100px",e._currentDistanceMeasurement&&(e._currentDistanceMeasurement.wireVisible=!1,e._currentDistanceMeasurement.targetVisible=!1,e._currentDistanceMeasurement.axisVisible=!1),i.style.cursor="default"};this._onHoverSnapOrSurfaceOff=r.on("hoverSnapOrSurfaceOff",(function(t){e._snapping&&d(t)})),this._onHoverOff=r.on("hoverOff",(function(t){e._snapping||d(t)})),this._active=!0}}},{key:"deactivate",value:function(){if(this._active){this.fire("activated",!1),this.pointerLens&&(this.pointerLens.visible=!1),this.reset();var e=this.scene.canvas.canvas;e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp);var t=this.distanceMeasurementsPlugin.viewer.cameraControl;t.off(this._onHoverSnapOrSurface),t.off(this._onHoverSurface),t.off(this._onHoverSnapOrSurfaceOff),t.off(this._onHoverOff),this._active=!1}}},{key:"reset",value:function(){this._active&&(this._destroyMarkerDiv(),this._initMarkerDiv(),this._currentDistanceMeasurement&&(this.distanceMeasurementsPlugin.fire("measurementCancel",this._currentDistanceMeasurement),this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null),this._mouseState=0)}},{key:"currentMeasurement",get:function(){return this._currentDistanceMeasurement}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),vk=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"DistanceMeasurements",e))._pointerLens=i.pointerLens,r._container=i.container||document.body,r._defaultControl=null,r._measurements={},r.labelMinAxisLength=i.labelMinAxisLength,r.defaultVisible=!1!==i.defaultVisible,r.defaultOriginVisible=!1!==i.defaultOriginVisible,r.defaultTargetVisible=!1!==i.defaultTargetVisible,r.defaultWireVisible=!1!==i.defaultWireVisible,r.defaultXLabelEnabled=!1!==i.defaultXLabelEnabled,r.defaultYLabelEnabled=!1!==i.defaultYLabelEnabled,r.defaultZLabelEnabled=!1!==i.defaultZLabelEnabled,r.defaultLengthLabelEnabled=!1!==i.defaultLengthLabelEnabled,r.defaultLabelsVisible=!1!==i.defaultLabelsVisible,r.defaultAxisVisible=!1!==i.defaultAxisVisible,r.defaultXAxisVisible=!1!==i.defaultXAxisVisible,r.defaultYAxisVisible=!1!==i.defaultYAxisVisible,r.defaultZAxisVisible=!1!==i.defaultZAxisVisible,r.defaultColor=void 0!==i.defaultColor?i.defaultColor:"#00BBFF",r.zIndex=i.zIndex||1e4,r.defaultLabelsOnWires=!1!==i.defaultLabelsOnWires,r.useRotationAdjustment=void 0!==i.useRotationAdjustment&&!1!==i.useRotationAdjustment,r._onMouseOver=function(e,t){r.fire("mouseOver",{plugin:w(r),distanceMeasurement:t,measurement:t,event:e})},r._onMouseLeave=function(e,t){r.fire("mouseLeave",{plugin:w(r),distanceMeasurement:t,measurement:t,event:e})},r._onContextMenu=function(e,t){r.fire("contextMenu",{plugin:w(r),distanceMeasurement:t,measurement:t,event:e})},r}return I(n,[{key:"getContainerElement",value:function(){return this._container}},{key:"send",value:function(e,t){}},{key:"pointerLens",get:function(){return this._pointerLens}},{key:"control",get:function(){return this._defaultControl||(this._defaultControl=new pk(this,{})),this._defaultControl}},{key:"measurements",get:function(){return this._measurements}},{key:"labelMinAxisLength",get:function(){return this._labelMinAxisLength},set:function(e){e<1&&(this.error("labelMinAxisLength must be >= 1; defaulting to 25"),e=25),this._labelMinAxisLength=e||25}},{key:"useRotationAdjustment",get:function(){return this._useRotationAdjustment},set:function(e){e=void 0!==e&&Boolean(e),this._useRotationAdjustment=e}},{key:"createMeasurement",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);var n=t.origin,r=t.target,i=new dk(this,{id:t.id,plugin:this,container:this._container,origin:{entity:n.entity,worldPos:n.worldPos},target:{entity:r.entity,worldPos:r.worldPos},visible:t.visible,wireVisible:t.wireVisible,axisVisible:!1!==t.axisVisible&&!1!==this.defaultAxisVisible,xAxisVisible:!1!==t.xAxisVisible&&!1!==this.defaultXAxisVisible,yAxisVisible:!1!==t.yAxisVisible&&!1!==this.defaultYAxisVisible,zAxisVisible:!1!==t.zAxisVisible&&!1!==this.defaultZAxisVisible,xLabelEnabled:!1!==t.xLabelEnabled&&!1!==this.defaultXLabelEnabled,yLabelEnabled:!1!==t.yLabelEnabled&&!1!==this.defaultYLabelEnabled,zLabelEnabled:!1!==t.zLabelEnabled&&!1!==this.defaultZLabelEnabled,lengthLabelEnabled:!1!==t.lengthLabelEnabled&&!1!==this.defaultLengthLabelEnabled,labelsVisible:!1!==t.labelsVisible&&!1!==this.defaultLabelsVisible,useRotationAdjustment:this.useRotationAdjustment,originVisible:t.originVisible,targetVisible:t.targetVisible,color:t.color,labelsOnWires:!1!==t.labelsOnWires&&!1!==this.defaultLabelsOnWires,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[i.id]=i,i.clickable=!0,i.on("destroyed",(function(){delete e._measurements[i.id]})),this.fire("measurementCreated",i),i}},{key:"destroyMeasurement",value:function(e){var t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("DistanceMeasurement not found: "+e)}},{key:"setLabelsShown",value:function(e){for(var t=0,n=Object.entries(this.measurements);t<n.length;t++){var r=k(n[t],2);r[0];r[1].labelShown=e}}},{key:"setAxisVisible",value:function(e){for(var t=0,n=Object.entries(this.measurements);t<n.length;t++){var r=k(n[t],2);r[0];r[1].axisVisible=e}this.defaultAxisVisible=e}},{key:"getAxisVisible",value:function(){return this.defaultAxisVisible}},{key:"clear",value:function(){for(var e=Object.keys(this._measurements),t=0,n=e.length;t<n;t++)this.destroyMeasurement(e[t])}},{key:"destroy",value:function(){this.clear(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),gk=De.vec2(),mk=function(e){m(n,fk);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,e.viewer.scene)).pointerLens=i.pointerLens,r.pointerCircle=new ft(e.viewer),r._active=!1;var s=document.createElement("div"),a=r.scene.canvas.canvas;return a.parentNode.insertBefore(s,a),s.style.background="black",s.style.border="2px solid blue",s.style.borderRadius="10px",s.style.width="5px",s.style.height="5px",s.style.margin="-200px -200px",s.style.zIndex="100",s.style.position="absolute",s.style.pointerEvents="none",r.markerDiv=s,r._currentDistanceMeasurement=null,r._currentDistanceMeasurementInitState={wireVisible:null,axisVisible:null,xAxisVisible:null,yaxisVisible:null,zAxisVisible:null,targetVisible:null},r._longTouchTimeoutMs=300,r._snapping=!1!==i.snapping,r._attachPlugin(e,i),r}return I(n,[{key:"_attachPlugin",value:function(e){this.distanceMeasurementsPlugin=e,this.plugin=e}},{key:"active",get:function(){return this._active}},{key:"snapping",get:function(){return this._snapping},set:function(e){this._snapping=e}},{key:"activate",value:function(){var e=this;if(!this._active){var t=this.plugin,n=this.scene,r=n.canvas.canvas;t.pointerLens;var i=De.vec3(),s=20,a=null;this._touchState=0;var o=De.vec2(),A=De.vec2(),c=De.vec2(),l=null,u=function(){e.plugin.viewer.cameraControl.active=!1},h=function(){e.plugin.viewer.cameraControl.active=!0},d=function(e,t){return t[0]=e.clientX,t[1]=e.clientY,pM(r.ownerDocument.documentElement,r,t),t},f=function(e,t){return t.set(e),pM(r,r.ownerDocument.documentElement,t),t};r.addEventListener("touchstart",this._onCanvasTouchStart=function(r){var c=r.touches.length;if(1===c){var p=r.touches[0];switch(d(p,o),A.set(o),e._touchState){case 0:if(1!==c&&null!==a)return a&&(clearTimeout(a),a=null),e._currentDistanceMeasurement&&(e._currentDistanceMeasurement.destroy(),e._currentDistanceMeasurement=null),h(),void(e._touchState=0);var v=n.pick({canvasPos:A,snapping:e._snapping,snapToEdge:e._snapping});if(v&&v.snapped)i.set(v.worldPos),e.pointerCircle.start(f(v.snappedCanvasPos,gk));else{var g=n.pick({canvasPos:A,pickSurface:!0});if(!g||!g.worldPos)return;i.set(g.worldPos),e.pointerCircle.start(f(g.canvasPos,gk))}a=setTimeout((function(){1!==c||A[0]>o[0]+s||A[0]<o[0]-s||A[1]>o[1]+s||A[1]<o[1]-s||(e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=o,e.pointerLens.cursorPos=o),e.pointerLens&&(e.pointerLens.canvasPos=A,e.pointerLens.snapped=!1),e.pointerLens&&(e.pointerLens.cursorPos=v.canvasPos,e.pointerLens.snapped=!0),e._currentDistanceMeasurement?e._currentDistanceMeasurement.origin.worldPos=i:(e._currentDistanceMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:i,entity:v.entity},target:{worldPos:i,entity:v.entity}}),e._currentDistanceMeasurement.labelsVisible=!1,e._currentDistanceMeasurement.xAxisVisible=!1,e._currentDistanceMeasurement.yAxisVisible=!1,e._currentDistanceMeasurement.zAxisVisible=!1,e._currentDistanceMeasurement.wireVisible=!1,e._currentDistanceMeasurement.originVisible=!0,e._currentDistanceMeasurement.targetVisible=!1,e._currentDistanceMeasurement.clickable=!1),e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement),e._touchState=2,u())}),e._longTouchTimeoutMs),e._touchState=1,l=p.identifier;break;case 3:if(1!==c&&null!==a)return clearTimeout(a),void(a=null);1===c&&(a=setTimeout((function(){if(a=null,!(1!==c||A[0]>o[0]+s||A[0]<o[0]-s||A[1]>o[1]+s||A[1]<o[1]-s)){e.pointerLens&&(e.pointerLens.visible=!0,e.pointerLens.canvasPos=o,e.pointerLens.snapped=!1);var t=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping});if(t&&t.snapped)e.pointerLens&&(e.pointerLens.cursorPos=t.snappedCanvasPos,e.pointerLens.snapped=!0),e.pointerCircle.start(f(t.snappedCanvasPos,gk)),i.set(t.worldPos),e._currentDistanceMeasurement.target.worldPos=t.worldPos,e._currentDistanceMeasurement.target.entity=t.entity,e._currentDistanceMeasurement.targetVisible=!0,e._currentDistanceMeasurement.wireVisible=!0,e._currentDistanceMeasurement.labelsVisible=!0,e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement);else{var r=n.pick({canvasPos:A,pickSurface:!0});r&&r.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=r.canvasPos,e.pointerLens.snapped=!1),e.pointerCircle.start(f(r.canvasPos,gk)),i.set(r.worldPos),e._currentDistanceMeasurement.target.worldPos=r.worldPos,e._currentDistanceMeasurement.target.entity=r.entity,e._currentDistanceMeasurement.targetVisible=!0,e._currentDistanceMeasurement.wireVisible=!0,e._currentDistanceMeasurement.labelsVisible=!0,e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement)):e.pointerLens&&(e.pointerLens.cursorPos=null,e.pointerLens.snapped=!1)}e._touchState=5,u()}}),e._longTouchTimeoutMs),e._touchState=4),l=p.identifier;break;default:return null!==a&&(clearTimeout(a),a=null),void(e._touchState=7)}}else a&&(clearTimeout(a),a=null)},{passive:!0}),r.addEventListener("touchmove",(function(r){e.pointerCircle.stop();var s=r.touches.length;if(1===s&&1===r.changedTouches.length){var o,c,u=r.touches[0];if(u.identifier===l)switch(d(u,A),e._touchState){case 2:e.pointerLens&&(e.pointerLens.canvasPos=A),(o=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping}))&&o.snapped?(e.pointerLens&&(e.pointerLens.snappedCanvasPos=o.snappedCanvasPos,e.pointerLens.snapped=!0),i.set(o.worldPos),e._currentDistanceMeasurement?e._currentDistanceMeasurement.origin.worldPos=o.worldPos:(e._currentDistanceMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:o.worldPos,entity:o.entity},target:{worldPos:o.worldPos,entity:o.entity}}),e._currentDistanceMeasurement.labelsVisible=!1,e._currentDistanceMeasurement.xAxisVisible=!1,e._currentDistanceMeasurement.yAxisVisible=!1,e._currentDistanceMeasurement.zAxisVisible=!1,e._currentDistanceMeasurement.wireVisible=!1,e._currentDistanceMeasurement.originVisible=!0,e._currentDistanceMeasurement.targetVisible=!1,e._currentDistanceMeasurement.clickable=!1),e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement)):(c=n.pick({canvasPos:A,pickSurface:!0}))&&c.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=c.canvasPos,e.pointerLens.snapped=!1),i.set(c.worldPos),e._currentDistanceMeasurement?e._currentDistanceMeasurement.origin.worldPos=c.worldPos:(e._currentDistanceMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:c.worldPos,entity:c.entity},target:{worldPos:c.worldPos,entity:c.entity}}),e._currentDistanceMeasurement.labelsVisible=!1,e._currentDistanceMeasurement.xAxisVisible=!1,e._currentDistanceMeasurement.yAxisVisible=!1,e._currentDistanceMeasurement.zAxisVisible=!1,e._currentDistanceMeasurement.wireVisible=!1,e._currentDistanceMeasurement.originVisible=!0,e._currentDistanceMeasurement.targetVisible=!1,e._currentDistanceMeasurement.clickable=!1),e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement)):e.pointerLens&&(e.pointerLens.cursorPos=null,e.pointerLens.snapped=!1),e._touchState=2;break;case 5:if(1!==s&&null!==a)return clearTimeout(a),a=null,e.pointerLens&&(e.pointerLens.visible=!1),void(e._touchState=7);e.pointerLens&&(e.pointerLens.canvasPos=A),(o=n.pick({canvasPos:A,snapToVertex:e._snapping,snapToEdge:e._snapping}))&&o.worldPos?(e.pointerLens&&(e.pointerLens.cursorPos=o.snappedCanvasPos,e.pointerLens.snapped=!0),e._currentDistanceMeasurement.target.worldPos=o.worldPos,e._currentDistanceMeasurement.target.entity=o.entity,e._currentDistanceMeasurement.targetVisible=!0,e._currentDistanceMeasurement.wireVisible=!0,e._currentDistanceMeasurement.labelsVisible=!0):(c=n.pick({canvasPos:A,pickSurface:!0}))&&c.worldPos&&(e.pointerLens&&(e.pointerLens.cursorPos=c.canvasPos,e.pointerLens.snapped=!1),e._currentDistanceMeasurement.target.worldPos=c.worldPos,e._currentDistanceMeasurement.target.entity=c.entity,e._currentDistanceMeasurement.targetVisible=!0,e._currentDistanceMeasurement.wireVisible=!0,e._currentDistanceMeasurement.labelsVisible=!0),e._touchState=5}}else a&&(clearTimeout(a),a=null)}),{passive:!0}),r.addEventListener("touchend",this._onCanvasTouchEnd=function(r){e.pointerCircle.stop();var i=r.changedTouches.length;if(1===i){var u=r.changedTouches[0];if(u.identifier===l){a&&(clearTimeout(a),a=null),d(u,c);var f=c[0],p=c[1];switch(e._touchState){case 1:if(1!==i||f>o[0]+s||f<o[0]-s||p>o[1]+s||p<o[1]-s)return void(e._touchState=0);var v=n.pick({canvasPos:A,pickSurface:!0});v&&v.worldPos?(e._currentDistanceMeasurement=t.createMeasurement({id:De.createUUID(),origin:{worldPos:v.worldPos,entity:v.entity},target:{worldPos:v.worldPos,entity:v.entity}}),e._currentDistanceMeasurement.labelsVisible=!1,e._currentDistanceMeasurement.xAxisVisible=!1,e._currentDistanceMeasurement.yAxisVisible=!1,e._currentDistanceMeasurement.zAxisVisible=!1,e._currentDistanceMeasurement.wireVisible=!1,e._currentDistanceMeasurement.originVisible=!0,e._currentDistanceMeasurement.targetVisible=!1,e._currentDistanceMeasurement.clickable=!1,e._touchState=3,e.distanceMeasurementsPlugin.fire("measurementStart",e._currentDistanceMeasurement)):(e._currentDistanceMeasurement&&e._currentDistanceMeasurement.destroy(),e._touchState=0),h();break;case 2:e.pointerLens&&(e.pointerLens.visible=!1),e._currentDistanceMeasurement?e._touchState=3:(e.pointerLens&&(e.pointerLens.snapped=!1,e.pointerLens.visible=!1),e._touchState=0),h();break;case 4:if(1!==i||f>o[0]+s||f<o[0]-s||p>o[1]+s||p<o[1]-s)return void(e._touchState=3);var g=n.pick({canvasPos:A,pickSurface:!0});g&&g.worldPos?(e._currentDistanceMeasurement.target.worldPos=g.worldPos,e._currentDistanceMeasurement.target.entity=g.entity,e._currentDistanceMeasurement.targetVisible=!0,e._currentDistanceMeasurement.wireVisible=!0,e._currentDistanceMeasurement.labelsVisible=!0,e._currentDistanceMeasurement.xAxisVisible=!0,e._currentDistanceMeasurement.yAxisVisible=!0,e._currentDistanceMeasurement.zAxisVisible=!0,e._currentDistanceMeasurement.clickable=!0,e.distanceMeasurementsPlugin.fire("measurementEnd",e._currentDistanceMeasurement),e._currentDistanceMeasurement=null):e._currentDistanceMeasurement&&(e._currentDistanceMeasurement.destroy(),e._currentDistanceMeasurement=null),e._touchState=0,h();break;case 5:console.log("long touch"),e.pointerLens&&(e.pointerLens.visible=!1),e._currentDistanceMeasurement&&e._currentDistanceMeasurement.targetVisible?(e._currentDistanceMeasurement.clickable=!0,e.distanceMeasurementsPlugin.fire("measurementEnd",e._currentDistanceMeasurement),e._currentDistanceMeasurement=null,e._touchState=0):(e._currentDistanceMeasurement&&(e._currentDistanceMeasurement.destroy(),e._currentDistanceMeasurement=null),e._touchState=0),h()}}}},{passive:!0}),this._active=!0}}},{key:"deactivate",value:function(){if(this._active){this.plugin.pointerLens&&(this.plugin.pointerLens.visible=!1),this.reset();var e=this.plugin.viewer.scene.canvas.canvas;e.removeEventListener("touchstart",this._onCanvasTouchStart),e.removeEventListener("touchend",this._onCanvasTouchEnd),this._active=!1,this.plugin.viewer.cameraControl.active=!0}}},{key:"reset",value:function(){this._active&&this._currentDistanceMeasurement&&(this.distanceMeasurementsPlugin.fire("measurementCancel",this._currentDistanceMeasurement),this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null)}},{key:"currentMeasurement",get:function(){return this._currentDistanceMeasurement}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),yk=function(e){m(n,it);var t=_(n);function n(e,r,i,s){var a;x(this,n);var o=e.plugin.viewer;a=t.call(this,o.scene);var A=MM({viewer:o,handleMouseEvents:i,handleTouchEvents:s,pointerLens:r.pointerLens,dots:[e.origin,e.target],ray2WorldPos:function(e,t,n){return function e(t){var r=o.scene.pick({canvasPos:n,snapToEdge:t,snapToVertex:t,pickSurface:!0});return r&&r.worldPos?r.worldPos:t&&e(!1)}(!!r.snapping)},onEnd:function(e,t){var n=!De.compareVec3(e,t.worldPos);return n&&a.fire("edited"),n}}),c=e.on("destroyed",A);return a._deactivate=function(){e.off("destroyed",c),A()},a}return I(n,[{key:"deactivate",value:function(){this._deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),_k=function(e){m(n,yk);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!0,!1)}return I(n)}(),bk=function(e){m(n,yk);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!1,!0)}return I(n)}(),wk=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(r=t.call(this,"FastNav",e))._hideColorTexture=!1!==i.hideColorTexture,r._hidePBR=!1!==i.hidePBR,r._hideSAO=!1!==i.hideSAO,r._hideEdges=!1!==i.hideEdges,r._hideTransparentObjects=!!i.hideTransparentObjects,r._scaleCanvasResolution=!!i.scaleCanvasResolution,r._defaultScaleCanvasResolutionFactor=i.defaultScaleCanvasResolutionFactor,r._scaleCanvasResolutionFactor=i.scaleCanvasResolutionFactor||.6,r._delayBeforeRestore=!1!==i.delayBeforeRestore,r._delayBeforeRestoreSeconds=i.delayBeforeRestoreSeconds||.5,r._onMoved=i.onMoved,r._onStopped=null;var s=1e3*r._delayBeforeRestoreSeconds,a=!1,o=function(){s=1e3*r._delayBeforeRestoreSeconds,a||(e.scene._renderer.setColorTextureEnabled(!r._hideColorTexture),e.scene._renderer.setPBREnabled(!r._hidePBR),e.scene._renderer.setSAOEnabled(!r._hideSAO),e.scene._renderer.setTransparentEnabled(!r._hideTransparentObjects),e.scene._renderer.setEdgesEnabled(!r._hideEdges),r._originalCanvasResolutionScale=e.scene.canvas.resolutionScale,r._scaleCanvasResolution?e.scene.canvas.resolutionScale=r._scaleCanvasResolutionFactor:e.scene.canvas.resolutionScale=r._defaultScaleCanvasResolutionFactor,r._onMoved&&(r._onStopped=r._onMoved()),a=!0)},A=function(){e.scene.canvas.resolutionScale=r._defaultScaleCanvasResolutionFactor||r._originalCanvasResolutionScale||1,e.scene._renderer.setEdgesEnabled(!0),e.scene._renderer.setColorTextureEnabled(!0),e.scene._renderer.setPBREnabled(!0),e.scene._renderer.setSAOEnabled(!0),e.scene._renderer.setTransparentEnabled(!0),r._onStopped&&r._onStopped(),a=!1};return r._onCameraMatrix=e.scene.camera.on("matrix",o),r._onSceneTick=e.scene.on("tick",(function(e){a&&(s-=e.deltaTime,(!r._delayBeforeRestore||s<=0)&&A())})),r}return I(n,[{key:"hideColorTexture",get:function(){return this._hideColorTexture},set:function(e){this._hideColorTexture=e}},{key:"hidePBR",get:function(){return this._hidePBR},set:function(e){this._hidePBR=e}},{key:"hideSAO",get:function(){return this._hideSAO},set:function(e){this._hideSAO=e}},{key:"hideEdges",get:function(){return this._hideEdges},set:function(e){this._hideEdges=e}},{key:"hideTransparentObjects",get:function(){return this._hideTransparentObjects},set:function(e){this._hideTransparentObjects=!1!==e}},{key:"scaleCanvasResolution",get:function(){return this._scaleCanvasResolution},set:function(e){this._scaleCanvasResolution=e}},{key:"defaultScaleCanvasResolutionFactor",get:function(){return this._defaultScaleCanvasResolutionFactor},set:function(e){this._defaultScaleCanvasResolutionFactor=e}},{key:"scaleCanvasResolutionFactor",get:function(){return this._scaleCanvasResolutionFactor},set:function(e){this._scaleCanvasResolutionFactor=e||.6}},{key:"delayBeforeRestore",get:function(){return this._delayBeforeRestore},set:function(e){this._delayBeforeRestore=e}},{key:"delayBeforeRestoreSeconds",get:function(){return this._delayBeforeRestoreSeconds},set:function(e){this._delayBeforeRestoreSeconds=null!=e?e:.5}},{key:"send",value:function(e,t){}},{key:"destroy",value:function(){this.viewer.scene.camera.off(this._onCameraMatrix),this.viewer.scene.canvas.off(this._onCanvasBoundary),this.viewer.scene.input.off(this._onSceneMouseDown),this.viewer.scene.input.off(this._onSceneMouseUp),this.viewer.scene.input.off(this._onSceneMouseMove),this.viewer.scene.off(this._onSceneTick),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Bk=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getMetaModel",value:function(e,t,n){je.loadJSON(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}},{key:"getGLTF",value:function(e,t,n){je.loadArraybuffer(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}},{key:"getGLB",value:function(e,t,n){je.loadArraybuffer(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}},{key:"getArrayBuffer",value:function(e,t,n,r){!function(e,t,n,r){var i=function(){};n=n||i,r=r||i;var s=/^data:(.*?)(;base64)?,(.*)$/,a=t.match(s);if(a){var o=!!a[2],A=a[3];A=window.decodeURIComponent(A),o&&(A=window.atob(A));try{for(var c=new ArrayBuffer(A.length),l=new Uint8Array(c),u=0;u<A.length;u++)l[u]=A.charCodeAt(u);tt.scheduleTask((function(){n(c)}))}catch(e){tt.scheduleTask((function(){r(e)}))}}else{var h=function(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(e),d=h+t,f=new XMLHttpRequest;f.open("GET",d,!0),f.responseType="arraybuffer",f.onreadystatechange=function(){4===f.readyState&&(200===f.status?n(f.response):r("loadArrayBuffer error : "+f.response))},f.send(null)}}(this._cacheBusterURL(e),t,(function(e){n(e)}),(function(e){r(e)}))}}]),e}();var Ck=function(){function e(t){x(this,e)}return I(e,[{key:"load",value:function(e,t,n,r,i,s,a){!function(e,t,n,r,i,s,a){var o=e.viewer.scene.canvas.spinner;o.processes++,"glb"===t.split(".").pop()?e.dataSource.getGLB(t,(function(A){r.basePath=Mk(t),kk(e,t,A,n,r,i,s,a),o.processes--}),(function(e){o.processes--,a(e)})):e.dataSource.getGLTF(t,(function(A){r.basePath=Mk(t),kk(e,t,A,n,r,i,s,a),o.processes--}),(function(e){o.processes--,a(e)}))}(e,t,n,r=r||{},i,(function(){tt.scheduleTask((function(){i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1)})),s&&s()}),(function(t){e.error(t),a&&a(t),i.fire("error",t)}))}},{key:"parse",value:function(e,t,n,r,i,s,a){kk(e,"",t,n,r=r||{},i,(function(){i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1),s&&s()}),(function(e){i.error(e),i.fire("error",e),a&&a(e)}))}}]),e}();function Mk(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}function kk(e,t,n,r,i,s,a,o){var A=e.viewer.scene.canvas.spinner;A.processes++,zh(n,Cg,{baseUri:i.basePath}).then((function(n){var o=function(e,t){return(new Qg).postProcess(e,t)}(n),c={src:t,entityId:i.entityId,metaModelJSON:r,autoMetaModel:i.autoMetaModel,globalizeObjectIds:i.globalizeObjectIds,metaObjects:[],loadBuffer:i.loadBuffer,basePath:i.basePath,handlenode:i.handlenode,backfaces:!!i.backfaces,gltfData:o,scene:s.scene,plugin:e,sceneModel:s,numObjects:0,nodes:[],nextId:0,log:function(t){e.log(t)}};!function(e){var t=e.gltfData.textures;if(t)for(var n=0,r=t.length;n<r;n++)Ek(e,t[n])}(c),function(e){var t=e.gltfData.materials;if(t)for(var n=0,r=t.length;n<r;n++){var i=t[n];i._textureSetId=Fk(e,i),i._attributes=xk(e,i)}}(c),i.autoMetaModel&&c.metaObjects.push({id:s.id,type:"Default",name:s.id}),Uk(c),s.finalize(),i.autoMetaModel&&e.viewer.metaScene.createMetaModel(s.id,{metaObjects:c.metaObjects}),A.processes--,a()})).catch((function(e){o&&o(e)}))}function Ek(e,t){if(t.source&&t.source.image){var n="texture-".concat(e.nextId++),r=1005;switch(t.sampler.minFilter){case 9728:r=1003;break;case 9729:r=1006;break;case 9984:r=1004;break;case 9985:r=1007;break;case 9986:r=1005;break;case 9987:r=1008}var i=1006;switch(t.sampler.magFilter){case 9728:i=1003;break;case 9729:i=1006}var s=1e3;switch(t.sampler.wrapS){case 33071:s=1001;break;case 33648:s=1002;break;case 10497:s=1e3}var a=1e3;switch(t.sampler.wrapT){case 33071:a=1001;break;case 33648:a=1002;break;case 10497:a=1e3}var o=1e3;switch(t.sampler.wrapR){case 33071:o=1001;break;case 33648:o=1002;break;case 10497:o=1e3}e.sceneModel.createTexture({id:n,image:t.source.image,flipY:!!t.flipY,minFilter:r,magFilter:i,wrapS:s,wrapT:a,wrapR:o,encoding:3001}),t._textureId=n}}function Fk(e,t){var n={};switch(t.normalTexture&&(n.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(n.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(n.emissiveTextureId=t.emissiveTexture.texture._textureId),t.alphaMode){case"OPAQUE":break;case"MASK":var r=t.alphaCutoff;n.alphaCutoff=void 0!==r?r:.5}var i=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){var s=t.pbrMetallicRoughness,a=s.baseColorTexture||s.colorTexture;a&&(a.texture?n.colorTextureId=a.texture._textureId:n.colorTextureId=e.gltfData.textures[a.index]._textureId),i.metallicRoughnessTexture&&(n.metallicRoughnessTextureId=i.metallicRoughnessTexture.texture._textureId)}var o=t.extensions;if(o){var A=o.KHR_materials_pbrSpecularGlossiness;if(A){A.specularTexture;var c=A.specularColorTexture;null!=c&&(n.colorTextureId=e.gltfData.textures[c.index]._textureId)}}return void 0!==n.normalTextureId||void 0!==n.occlusionTextureId||void 0!==n.emissiveTextureId||void 0!==n.colorTextureId||void 0!==n.metallicRoughnessTextureId?(n.id="textureSet-".concat(e.nextId++,";"),e.sceneModel.createTextureSet(n),n.id):null}function xk(e,t){var n=t.extensions,r={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1,doubleSided:!0};if(n){var i=n.KHR_materials_pbrSpecularGlossiness;if(i){var s=i.diffuseFactor;null!=s&&r.color.set(s)}var a=n.KHR_materials_common;if(a){var o=a.technique,A=a.values||{},c="BLINN"===o,l="PHONG"===o,u="LAMBERT"===o,h=A.diffuse;h&&(c||l||u)&&(je.isString(h)||r.color.set(h));var d=A.transparency;null!=d&&(r.opacity=d);var f=A.transparent;null!=f&&(r.opacity=f)}}var p=t.pbrMetallicRoughness;if(p){var v=p.baseColorFactor;v&&(r.color[0]=v[0],r.color[1]=v[1],r.color[2]=v[2],r.opacity=v[3]);var g=p.metallicFactor;null!=g&&(r.metallic=g);var m=p.roughnessFactor;null!=m&&(r.roughness=m)}return r.doubleSided=!1!==t.doubleSided,r}function Uk(e){var t=e.gltfData,n=t.scene||t.scenes[0];if(n){var r=n.nodes;if(r){!function e(t){t.forEach((function(t){var n=t.mesh;n&&(n.instances||(n.instances=0),n.instances+=1),t.children&&e(t.children)}))}(r);var i=[],s=null;!function t(n,r,a){n.forEach((function(n){var o=n.name,A=null!=o&&o||0===r&&"entity-"+e.nextId++;if(A){for(;e.sceneModel.objects[A];)A="entity-"+e.nextId++;i.push(s),s=[]}var c=function(e,t){var n;e.matrix&&(n=e.matrix,t=t?De.mulMat4(t,n,De.mat4()):n);e.translation&&(n=De.translationMat4v(e.translation),t=t?De.mulMat4(t,n,De.mat4()):n);e.rotation&&(n=De.quaternionToMat4(e.rotation),t=t?De.mulMat4(t,n,De.mat4()):n);e.scale&&(n=De.scalingMat4v(e.scale),t=t?De.mulMat4(t,n,De.mat4()):n);return t}(n,a);if(n.mesh&&function(e,t,n,r){var i=e.mesh;if(!i)return;var s=i.primitives.length;if(s>0)for(var a=0;a<s;a++){var o=i.primitives[a];if(!(o.mode<4)){var A={id:t.sceneModel.id+"."+t.numObjects++},c=o.material;c?(A.textureSetId=c._textureSetId,A.color=c._attributes.color,A.opacity=c._attributes.opacity,A.metallic=c._attributes.metallic,A.roughness=c._attributes.roughness):(A.color=new Float32Array([1,1,1]),A.opacity=1);var l=!1!==t.backfaces||c&&!1!==c.doubleSided;switch(o.mode){case 0:A.primitive="points";break;case 1:case 2:case 3:A.primitive="lines";break;default:A.primitive=l?"triangles":"solid"}var u=o.attributes.POSITION;if(u){A.localPositions=u.value,A.positions=new Float64Array(A.localPositions.length),o.attributes.NORMAL&&(A.normals=o.attributes.NORMAL.value),o.attributes.TEXCOORD_0&&(A.uv=o.attributes.TEXCOORD_0.value),o.indices&&(A.indices=o.indices.value),n?De.transformPositions3(n,A.localPositions,A.positions):A.positions.set(A.localPositions);var h=De.vec3();Mn(A.positions,A.positions,h)&&(A.origin=h),t.sceneModel.createMesh(A),r.push(A.id)}}}}(n,e,c,s),n.children&&t(n.children,r+1,c),A){if(s.length>0){var l=e.globalizeObjectIds?De.globalizeObjectId(e.sceneModel.id,A):A;e.sceneModel.createEntity({id:l,meshIds:s,isObject:!0}),e.autoMetaModel&&e.metaObjects.push({id:l,type:"Default",name:l,parent:e.sceneModel.id})}s=i.pop()}}))}(r,0,null)}}else!function(e,t){e.plugin.error(t)}(e,"glTF has no default scene")}var Ik={DEFAULT:{}},Tk=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"GLTFLoader",e,i))._sceneModelLoader=new Ck(w(r),i),r.dataSource=i.dataSource,r.objectDefaults=i.objectDefaults,r}return I(n,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new Bk}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Ik}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var n=new Uo(this.viewer.scene,je.apply(t,{isModel:!0,dtxEnabled:t.dtxEnabled})),r=n.id;if(!t.src&&!t.gltf)return this.error("load() param expected: src or gltf"),n;if(t.metaModelSrc||t.metaModelJSON){var i=function(i){e.viewer.metaScene.createMetaModel(r,i,{}),e.viewer.scene.canvas.spinner.processes--,t.src?e._sceneModelLoader.load(e,t.src,i,t,n):e._sceneModelLoader.parse(e,t.gltf,i,t,n)};if(t.metaModelSrc){var s=t.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(s,(function(t){e.viewer.scene.canvas.spinner.processes--,i(t)}),(function(t){e.error("load(): Failed to load model metadata for model '".concat(r," from  '").concat(s,"' - ").concat(t)),e.viewer.scene.canvas.spinner.processes--}))}else t.metaModelJSON&&i(t.metaModelJSON)}else t.src?this._sceneModelLoader.load(this,t.src,null,t,n):this._sceneModelLoader.parse(this,t.gltf,null,t,n);return n.once("destroyed",(function(){e.viewer.metaScene.destroyMetaModel(r)})),n}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}();function Pk(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r="lightgrey",i=n.hoverColor||"rgba(0,0,0,0.4)",s=n.textColor||"black",a=n.canvasElement||document.body,o=500,A=o+o/3,c=A/24,l=[{boundary:[6,6,6,6],color:n.frontColor||n.color||"#55FF55"},{boundary:[18,6,6,6],color:n.backColor||n.color||"#55FF55"},{boundary:[12,6,6,6],color:n.rightColor||n.color||"#FF5555"},{boundary:[0,6,6,6],color:n.leftColor||n.color||"#FF5555"},{boundary:[6,0,6,6],color:n.topColor||n.color||"#7777FF"},{boundary:[6,12,6,6],color:n.bottomColor||n.color||"#7777FF"}],u=[{label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,1,0],up:[0,0,1]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,-1,0],up:[0,0,1]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,0,1]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,0,1]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,0,1],up:[0,-1,0]},{boundaries:[[7,5,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,0,-1],up:[1,0,1]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-1,-1],up:[0,-1,1]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,0,-1],up:[-1,0,1]},{boundaries:[[7,11,4,2]],dir:[0,1,1],up:[0,-1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,0,1],up:[-1,0,1]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,-1,1],up:[0,1,1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,0,1],up:[1,0,1]},{boundaries:[[5,7,2,4]],dir:[1,1,0],up:[0,0,1]},{boundaries:[[11,7,2,4]],dir:[-1,1,0],up:[0,0,1]},{boundaries:[[17,7,2,4]],dir:[-1,-1,0],up:[0,0,1]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,-1,0],up:[0,0,1]},{boundaries:[[5,11,2,2]],dir:[1,1,1],up:[-1,-1,1]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[1,-1,1],up:[-1,1,1]},{boundaries:[[5,5,2,2]],dir:[1,1,-1],up:[1,1,1]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-1,-1,1],up:[1,1,1]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-1,-1,-1],up:[-1,-1,1]},{boundaries:[[11,11,2,2]],dir:[-1,1,1],up:[1,-1,1]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[1,-1,-1],up:[1,-1,1]},{boundaries:[[11,5,2,2]],dir:[-1,1,-1],up:[-1,1,1]}];n.frontColor||n.color,n.backColor||n.color,n.rightColor||n.color,n.leftColor||n.color,n.topColor||n.color,n.bottomColor||n.color;for(var h=[{yUp:"",label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,0,1],up:[0,1,0]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,1,0]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,1,0]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,-1,0],up:[0,0,-1]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,1,0],up:[0,0,1]},{boundaries:[[7,5,4,2]],dir:[0,-.7071,-.7071],up:[0,.7071,-.7071]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,-1,0],up:[1,1,0]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-.7071,.7071],up:[0,.7071,.7071]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,-1,0],up:[-1,1,0]},{boundaries:[[7,11,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,1,0],up:[-1,1,0]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,1,1],up:[0,1,-1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,1,0],up:[1,1,0]},{boundaries:[[5,7,2,4]],dir:[1,0,-1],up:[0,1,0]},{boundaries:[[11,7,2,4]],dir:[-1,0,-1],up:[0,1,0]},{boundaries:[[17,7,2,4]],dir:[-1,0,1],up:[0,1,0]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,0,1],up:[0,1,0]},{boundaries:[[5,11,2,2]],dir:[.5,.7071,-.5],up:[-.5,.7071,.5]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[.5,.7071,.5],up:[-.5,.7071,-.5]},{boundaries:[[5,5,2,2]],dir:[.5,-.7071,-.5],up:[.5,.7071,-.5]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-.5,.7071,.5],up:[.5,.7071,-.5]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-.5,-.7071,.5],up:[-.5,.7071,.5]},{boundaries:[[11,11,2,2]],dir:[-.5,.7071,-.5],up:[.5,.7071,.5]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[.5,-.7071,.5],up:[.5,.7071,.5]},{boundaries:[[11,5,2,2]],dir:[-.5,-.7071,-.5],up:[-.5,.7071,-.5]}],d=0,f=u.length;d<f;d++)De.normalizeVec3(u[d].dir,u[d].dir),De.normalizeVec3(u[d].up,u[d].up);for(var p=0,v=h.length;p<v;p++)De.normalizeVec3(h[p].dir,h[p].dir),De.normalizeVec3(h[p].up,h[p].up);var g=h;this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=A,this._textureCanvas.height=o,this._textureCanvas.style.width=A+"px",this._textureCanvas.style.height=o+"px",this._textureCanvas.style.padding="0",this._textureCanvas.style.margin="0",this._textureCanvas.style.top="0",this._textureCanvas.style.background=r,this._textureCanvas.style.position="absolute",this._textureCanvas.style.opacity="1.0",this._textureCanvas.style.visibility="hidden",this._textureCanvas.style["z-index"]=2e6,a.appendChild(this._textureCanvas);var m=this._textureCanvas.getContext("2d"),y=!1;function _(){for(var e=0,n=l.length;e<n;e++){var a=l[e],o=a.boundary,A=Math.round(o[0]*c),u=Math.round(o[1]*c),h=Math.round(o[2]*c),d=Math.round(o[3]*c);m.fillStyle=a.color,m.fillRect(A,u,h,d)}for(var f=0,p=g.length;f<p;f++){for(var v=void 0,y=void 0,_=void 0,b=void 0,w=g[f],B=w.boundaries,M=0,k=B.length;M<k;M++){var E=B[M];v=Math.round(E[0]*c),y=Math.round(E[1]*c),_=Math.round(E[2]*c),b=Math.round(E[3]*c),w.highlighted&&(m.fillStyle=w.highlighted?i:w.color||r,m.fillRect(v,y,_,b))}if(w.label){m.fillStyle=s,m.font="60px sans-serif",m.textAlign="center";var F=v+.5*_,x=y+.7*b;m.fillText(C(w.label),F,x,80)}}t.glRedraw()}var b,w,B,C=(b={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},w={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},B={"NavCube.front":"FRONT","NavCube.back":"BACK","NavCube.right":"RIGHT","NavCube.left":"LEFT","NavCube.top":"TOP","NavCube.bottom":"BOTTOM"},function(t){var n=y?w:b,r=n?n[t]:null;return r?e.localeService.translate(r)||B[r]||r:t});this.setZUp=function(){y=!0,g=u,this.clear()},this.setYUp=function(){y=!1,g=h,this.clear()},this.clear=function(){m.fillStyle=r,m.fillRect(0,0,A,o);for(var e=0,t=g.length;e<t;e++){g[e].highlighted=!1}_()},this.getArea=function(e){for(var t=e[0]*A,n=o-e[1]*o,r=0,i=g.length;r<i;r++)for(var s=g[r].boundaries,a=0,l=s.length;a<l;a++){var u=s[a];if(t>=u[0]*c&&t<=(u[0]+u[2])*c&&n>=u[1]*c&&n<=(u[1]+u[3])*c)return r}return-1},this.setAreaHighlighted=function(e,t){var n=g[e];if(!n)throw"Area not found: "+e;n.highlighted=!!t,_()},this.getAreaDir=function(e){var t=g[e];if(!t)throw"Unknown area: "+e;return t.dir},this.getAreaUp=function(e){var t=g[e];if(!t)throw"Unknown area: "+e;return t.up},this.getImage=function(){return this._textureCanvas},this.destroy=function(){this._textureCanvas&&(this._textureCanvas.parentNode.removeChild(this._textureCanvas),this._textureCanvas=null)}}var Sk=De.vec3(),Dk=De.vec3();De.mat4();var Qk=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),r=t.call(this,"NavCube",e,i),e.navCube=w(r);var s=!0;try{r._navCubeScene=new uc(e,{canvasId:i.canvasId,canvasElement:i.canvasElement,transparent:!0}),r._navCubeCanvas=r._navCubeScene.canvas.canvas,r._navCubeScene.input.keyboardEnabled=!1}catch(e){return r.error(e),b(r)}var a=r._navCubeScene;a.clearLights(),new Do(a,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new Do(a,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new Do(a,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),r._navCubeCamera=a.camera,r._navCubeCamera.ortho.scale=7,r._navCubeCamera.ortho.near=.1,r._navCubeCamera.ortho.far=2e3,a.edgeMaterial.edgeColor=[.2,.2,.2],a.edgeMaterial.edgeAlpha=.6,r._zUp=Boolean(e.camera.zUp);var o=w(r);r.setIsProjectNorth(i.isProjectNorth),r.setProjectNorthOffsetAngle(i.projectNorthOffsetAngle);var A,c=(A=De.mat4(),function(e,t,n){return De.identityMat4(A),De.rotationMat4v(e*o._projectNorthOffsetAngle*De.DEGTORAD,[0,1,0],A),De.transformVec3(A,t,n)});r._synchCamera=function(){var t=De.rotationMat4c(-90*De.DEGTORAD,1,0,0),n=De.vec3(),r=De.vec3(),i=De.vec3();return function(){var s=e.camera.eye,a=e.camera.look,A=e.camera.up;n=De.mulVec3Scalar(De.normalizeVec3(De.subVec3(s,a,n)),5),o._isProjectNorth&&o._projectNorthOffsetAngle&&(n=c(-1,n,Sk),A=c(-1,A,Dk)),o._zUp?(De.transformVec3(t,n,r),De.transformVec3(t,A,i),o._navCubeCamera.look=[0,0,0],o._navCubeCamera.eye=De.transformVec3(t,n,r),o._navCubeCamera.up=De.transformPoint3(t,A,i)):(o._navCubeCamera.look=[0,0,0],o._navCubeCamera.eye=n,o._navCubeCamera.up=A)}}(),r._cubeTextureCanvas=new Pk(e,a,i),r._cubeSampler=new Ti(a,{image:r._cubeTextureCanvas.getImage(),flipY:!0,wrapS:1001,wrapT:1001}),r._cubeMesh=new vi(a,{geometry:new Wt(a,{primitive:"triangles",normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),material:new wi(a,{diffuse:[.4,.4,.4],specular:[.4,.4,.4],emissive:[.6,.6,.6],diffuseMap:r._cubeSampler,emissiveMap:r._cubeSampler}),visible:!!s,edges:!0}),r._shadow=!1===i.shadowVisible?null:new vi(a,{geometry:new Wt(a,tn({center:[0,0,0],radiusTop:.001,radiusBottom:1.4,height:.01,radialSegments:20,heightSegments:1,openEnded:!0})),material:new wi(a,{diffuse:[0,0,0],specular:[0,0,0],emissive:[0,0,0],alpha:.5}),position:[0,-1.5,0],visible:!!s,pickable:!1,backfaces:!1}),r._onCameraMatrix=e.camera.on("matrix",r._synchCamera),r._onCameraWorldAxis=e.camera.on("worldAxis",(function(){e.camera.zUp?(r._zUp=!0,r._cubeTextureCanvas.setZUp(),r._repaint(),r._synchCamera()):e.camera.yUp&&(r._zUp=!1,r._cubeTextureCanvas.setYUp(),r._repaint(),r._synchCamera())})),r._onCameraFOV=e.camera.perspective.on("fov",(function(e){r._synchProjection&&(r._navCubeCamera.perspective.fov=e)})),r._onCameraProjection=e.camera.on("projection",(function(e){r._synchProjection&&(r._navCubeCamera.projection="ortho"===e||"perspective"===e?e:"perspective")}));var l=-1;function u(t,n){var r=(t-d)*-y,i=(n-f)*-y;e.camera.orbitYaw(r),e.camera.orbitPitch(-i),d=t,f=n}function h(e){var t=o._navCubeCanvas.getBoundingClientRect(),n=t.left,r=t.top;return[e.clientX-n,e.clientY-r]}var d,f,p=null,v=null,g=!1,m=!1,y=.5;o._navCubeCanvas.addEventListener("mouseenter",o._onMouseEnter=function(e){m=!0}),o._navCubeCanvas.addEventListener("mouseleave",o._onMouseLeave=function(e){m=!1}),o._navCubeCanvas.addEventListener("mousedown",o._onMouseDown=function(e){if(1===e.which){p=e.x,v=e.y,d=e.clientX,f=e.clientY;var t=h({clientX:e.clientX,clientY:e.clientY}),n=a.pick({canvasPos:t});g=!!n}}),o._navCubeCanvas.addEventListener("mouseup",o._onMouseUp=function(e){if(1===e.which&&(g=!1,null!==p)){var t=h({clientX:e.clientX,clientY:e.clientY}),n=a.pick({canvasPos:t,pickSurface:!0});if(n&&n.uv){var r=o._cubeTextureCanvas.getArea(n.uv);if(r>=0&&(o._navCubeCanvas.style.cursor="pointer",l>=0&&(o._cubeTextureCanvas.setAreaHighlighted(l,!1),o._repaint(),l=-1),r>=0)){if(o._cubeTextureCanvas.setAreaHighlighted(r,!0),l=r,o._repaint(),e.x<p-3||e.x>p+3||e.y<v-3||e.y>v+3)return;var i=o._cubeTextureCanvas.getAreaDir(r);if(i){var s=o._cubeTextureCanvas.getAreaUp(r);o._isProjectNorth&&o._projectNorthOffsetAngle&&(i=c(1,i,Sk),s=c(1,s,Dk)),_(i,s,(function(){l>=0&&(o._cubeTextureCanvas.setAreaHighlighted(l,!1),o._repaint(),l=-1),o._navCubeCanvas.style.cursor="pointer",l>=0&&(o._cubeTextureCanvas.setAreaHighlighted(l,!1),o._repaint(),l=-1),r>=0&&(o._cubeTextureCanvas.setAreaHighlighted(r,!1),l=-1,o._repaint())}))}}}}}),o._navCubeCanvas.addEventListener("mousemove",o._onMouseMove=function(e){if(l>=0&&(o._cubeTextureCanvas.setAreaHighlighted(l,!1),o._repaint(),l=-1),1!==e.buttons||g){if(g){var t=e.clientX,n=e.clientY;return o._navCubeCanvas.style.cursor="move",void u(t,n)}if(m){var r=h({clientX:e.clientX,clientY:e.clientY}),i=a.pick({canvasPos:r,pickSurface:!0});if(i){if(i.uv){o._navCubeCanvas.style.cursor="pointer";var s=o._cubeTextureCanvas.getArea(i.uv);if(s===l)return;l>=0&&o._cubeTextureCanvas.setAreaHighlighted(l,!1),s>=0&&(o._cubeTextureCanvas.setAreaHighlighted(s,!0),o._repaint(),l=s)}}else o._navCubeCanvas.style.cursor="default",l>=0&&(o._cubeTextureCanvas.setAreaHighlighted(l,!1),o._repaint(),l=-1)}}}),o._navCubeCanvas.addEventListener("touchstart",o._onTouchStart=function(e){if(e.touches.length>0){p=e.touches[0].clientX,v=e.touches[0].clientY,d=e.touches[0].clientX,f=e.touches[0].clientY;var t=h({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}),n=a.pick({canvasPos:t});g=!!n}},{passive:!1}),o._navCubeCanvas.addEventListener("touchmove",o._onTouchMove=function(e){e.preventDefault();var t=e.touches[0],n=t.clientX,r=t.clientY,i=document.elementFromPoint(n,r);(m=o._navCubeCanvas===i)&&g&&u(n,r)},{passive:!1}),o._navCubeCanvas.addEventListener("touchend",o._onTouchEnd=function(e){g=!1});var _=function(){var t=De.vec3();return function(n,r,i){var s=o._fitVisible?e.scene.getAABB(e.scene.visibleObjectIds):e.scene.aabb,a=De.getAABB3Diag(s);De.getAABB3Center(s,t);var A=Math.abs(a/Math.tan(o._cameraFitFOV*De.DEGTORAD));e.cameraControl.pivotPos=t,o._cameraFly?e.cameraFlight.flyTo({look:t,eye:[t[0]-A*n[0],t[1]-A*n[1],t[2]-A*n[2]],up:r||[0,1,0],orthoScale:1.1*a,fitFOV:o._cameraFitFOV,duration:o._cameraFlyDuration},i):e.cameraFlight.jumpTo({look:t,eye:[t[0]-A*n[0],t[1]-A*n[1],t[2]-A*n[2]],up:r||[0,1,0],orthoScale:1.1*a,fitFOV:o._cameraFitFOV},i)}}();return r._onUpdated=e.localeService.on("updated",(function(){r._cubeTextureCanvas.clear(),r._repaint()})),r.setVisible(i.visible),r.setCameraFitFOV(i.cameraFitFOV),r.setCameraFly(i.cameraFly),r.setCameraFlyDuration(i.cameraFlyDuration),r.setFitVisible(i.fitVisible),r.setSynchProjection(i.synchProjection),r}return I(n,[{key:"send",value:function(e,t){if("language"===e)this._cubeTextureCanvas.clear(),this._repaint()}},{key:"_repaint",value:function(){var e=this._cubeTextureCanvas.getImage();this._cubeMesh.material.diffuseMap.image=e,this._cubeMesh.material.emissiveMap.image=e}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._navCubeCanvas&&(this._cubeMesh.visible=e,this._shadow&&(this._shadow.visible=e),this._navCubeCanvas.style.visibility=e?"visible":"hidden")}},{key:"getVisible",value:function(){return!!this._navCubeCanvas&&this._cubeMesh.visible}},{key:"setFitVisible",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._fitVisible=e}},{key:"getFitVisible",value:function(){return this._fitVisible}},{key:"setCameraFly",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._cameraFly=e}},{key:"getCameraFly",value:function(){return this._cameraFly}},{key:"setCameraFitFOV",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:45;this._cameraFitFOV=e}},{key:"getCameraFitFOV",value:function(){return this._cameraFitFOV}},{key:"setCameraFlyDuration",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;this._cameraFlyDuration=e}},{key:"getCameraFlyDuration",value:function(){return this._cameraFlyDuration}},{key:"setSynchProjection",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._synchProjection=e}},{key:"getSynchProjection",value:function(){return this._synchProjection}},{key:"setIsProjectNorth",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._isProjectNorth=e}},{key:"getIsProjectNorth",value:function(){return this._isProjectNorth}},{key:"setProjectNorthOffsetAngle",value:function(e){this._projectNorthOffsetAngle=e}},{key:"getProjectNorthOffsetAngle",value:function(){return this._projectNorthOffsetAngle}},{key:"destroy",value:function(){this._navCubeCanvas&&(this.viewer.localeService.off(this._onUpdated),this.viewer.camera.off(this._onCameraMatrix),this.viewer.camera.off(this._onCameraWorldAxis),this.viewer.camera.perspective.off(this._onCameraFOV),this.viewer.camera.off(this._onCameraProjection),this._navCubeCanvas.removeEventListener("mouseenter",this._onMouseEnter),this._navCubeCanvas.removeEventListener("mouseleave",this._onMouseLeave),this._navCubeCanvas.removeEventListener("mousedown",this._onMouseDown),this._navCubeCanvas.removeEventListener("mousemove",this._onMouseMove),this._navCubeCanvas.removeEventListener("mouseup",this._onMouseUp),this._navCubeCanvas.removeEventListener("touchstart",this._onTouchStart),this._navCubeCanvas.removeEventListener("touchmove",this._onTouchMove),this._navCubeCanvas.removeEventListener("touchend",this._onTouchEnd),this._navCubeCanvas=null,this._cubeTextureCanvas.destroy(),this._cubeTextureCanvas=null,this._onMouseEnter=null,this._onMouseLeave=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null),this._navCubeScene.destroy(),this._navCubeScene=null,this._cubeMesh=null,this._shadow=null,v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Rk=De.vec3(),Ok=function(){function e(){x(this,e)}return I(e,[{key:"load",value:function(e,t){var n=e.scene.canvas.spinner;n.processes++,Vk(e,t,(function(t){Hk(e,t,(function(){jk(e,t),n.processes--,tt.scheduleTask((function(){e.fire("loaded",!0,!1)}))}))}))}},{key:"parse",value:function(e,t,n,r){if(t){var i=Lk(e,t,null);n&&Gk(e,n,r),jk(e,i),e.src=null,e.fire("loaded",!0,!1)}else this.warn("load() param expected: objText")}}]),e}(),Vk=function(e,t,n){Wk(t,(function(r){var i=Lk(e,r,t);n(i)}),(function(t){e.error(t)}))},Lk=function(){var e={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};return function(n,r,i){var s,a,o={src:i=i||"",basePath:(s=i,a=s.lastIndexOf("/"),-1===a?s:s.substring(0,a+1)),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};t(o,"",!1),-1!==r.indexOf("\r\n")&&(r=r.replace("\r\n","\n"));for(var A=r.split("\n"),c="",h="",d="",f=[],p="function"==typeof"".trimLeft,v=0,g=A.length;v<g;v++)if(c=A[v],0!==(c=p?c.trimLeft():c.trim()).length&&"#"!==(h=c.charAt(0)))if("v"===h)if(" "===(d=c.charAt(1))&&null!==(f=e.vertex_pattern.exec(c)))o.positions.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else if("n"===d&&null!==(f=e.normal_pattern.exec(c)))o.normals.push(parseFloat(f[1]),parseFloat(f[2]),parseFloat(f[3]));else{if("t"!==d||null===(f=e.uv_pattern.exec(c)))return void n.error("Unexpected vertex/normal/uv line: '"+c+"'");o.uv.push(parseFloat(f[1]),parseFloat(f[2]))}else if("f"===h)if(null!==(f=e.face_vertex_uv_normal.exec(c)))l(o,f[1],f[4],f[7],f[10],f[2],f[5],f[8],f[11],f[3],f[6],f[9],f[12]);else if(null!==(f=e.face_vertex_uv.exec(c)))l(o,f[1],f[3],f[5],f[7],f[2],f[4],f[6],f[8]);else if(null!==(f=e.face_vertex_normal.exec(c)))l(o,f[1],f[3],f[5],f[7],void 0,void 0,void 0,void 0,f[2],f[4],f[6],f[8]);else{if(null===(f=e.face_vertex.exec(c)))return void n.error("Unexpected face line: '"+c+"'");l(o,f[1],f[2],f[3],f[4])}else if("l"===h){var m=c.substring(1).trim().split(" "),y=[],_=[];if(-1===c.indexOf("/"))y=m;else for(var b=0,w=m.length;b<w;b++){var B=m[b].split("/");""!==B[0]&&y.push(B[0]),""!==B[1]&&_.push(B[1])}u(o,y,_)}else if(null!==(f=e.object_pattern.exec(c))){t(o,C=f[0].substr(1).trim(),!0)}else if(e.material_use_pattern.test(c)){var C=c.substring(7).trim();o.object.material.id=C}else if(e.material_library_pattern.test(c))o.materialLibraries[c.substring(7).trim()]=!0;else{if(null===(f=e.smoothing_pattern.exec(c))){if("\0"===c)continue;return void n.error("Unexpected line: '"+c+"'")}var M=f[1].trim().toLowerCase();o.object.material.smooth="1"===M||"on"===M}return o};function t(e,t,n){if(e.object&&!1===e.object.fromDeclaration)return e.object.id=t,void(e.object.fromDeclaration=!1!==n);e.object={id:t||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==n},e.objects.push(e.object)}function n(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)}function r(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)}function i(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)}function s(e,t,n,r){var i=e.positions,s=e.object.geometry.positions;s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[n+2]),s.push(i[r+0]),s.push(i[r+1]),s.push(i[r+2])}function a(e,t){var n=e.positions,r=e.object.geometry.positions;r.push(n[t+0]),r.push(n[t+1]),r.push(n[t+2])}function o(e,t,n,r){var i=e.normals,s=e.object.geometry.normals;s.push(i[t+0]),s.push(i[t+1]),s.push(i[t+2]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[n+2]),s.push(i[r+0]),s.push(i[r+1]),s.push(i[r+2])}function A(e,t,n,r){var i=e.uv,s=e.object.geometry.uv;s.push(i[t+0]),s.push(i[t+1]),s.push(i[n+0]),s.push(i[n+1]),s.push(i[r+0]),s.push(i[r+1])}function c(e,t){var n=e.uv,r=e.object.geometry.uv;r.push(n[t+0]),r.push(n[t+1])}function l(e,t,a,c,l,u,h,d,f,p,v,g,m){var y,_=e.positions.length,b=n(t,_),w=n(a,_),B=n(c,_);if(void 0===l?s(e,b,w,B):(s(e,b,w,y=n(l,_)),s(e,w,B,y)),void 0!==u){var C=e.uv.length;b=i(u,C),w=i(h,C),B=i(d,C),void 0===l?A(e,b,w,B):(A(e,b,w,y=i(f,C)),A(e,w,B,y))}if(void 0!==p){var M=e.normals.length;b=r(p,M),w=p===v?b:r(v,M),B=p===g?b:r(g,M),void 0===l?o(e,b,w,B):(o(e,b,w,y=r(m,M)),o(e,w,B,y))}}function u(e,t,r){e.object.geometry.type="Line";for(var s=e.positions.length,o=e.uv.length,A=0,l=t.length;A<l;A++)a(e,n(t[A],s));for(var u=0,h=r.length;u<h;u++)c(e,i(r[u],o))}}();function Hk(e,t,n){for(var r=t.basePath,i=Object.keys(t.materialLibraries),s=i.length,a=0,o=s;a<o;a++)Nk(e,r,r+i[a],(function(){0==--s&&n()}))}var Nk=function(e,t,n,r){Wk(n,(function(n){Gk(e,n,t),r()}),(function(t){e.error(t),r()}))},Gk=function(){var e=/\s+/;return function(e,i,s){var a,o,A,c,l,u=i.split("\n"),h={id:"Default"},d=!1;s=s||"";for(var f=0;f<u.length;f++)if(0!==(a=u[f].trim()).length&&"#"!==a.charAt(0))switch(A=(A=(o=a.indexOf(" "))>=0?a.substring(0,o):a).toLowerCase(),c=(c=o>=0?a.substring(o+1):"").trim(),A.toLowerCase()){case"newmtl":n(e,h),h={id:c},d=!0;break;case"ka":h.ambient=r(c);break;case"kd":h.diffuse=r(c);break;case"ks":h.specular=r(c);break;case"map_kd":h.diffuseMap||(h.diffuseMap=t(e,s,c,"sRGB"));break;case"map_ks":h.specularMap||(h.specularMap=t(e,s,c,"linear"));break;case"map_bump":case"bump":h.normalMap||(h.normalMap=t(e,s,c));break;case"ns":h.shininess=parseFloat(c);break;case"d":(l=parseFloat(c))<1&&(h.alpha=l,h.alphaMode="blend");break;case"tr":(l=parseFloat(c))>0&&(h.alpha=1-l,h.alphaMode="blend")}d&&n(e,h)};function t(e,t,n,r){var i={},s=n.split(/\s+/),a=s.indexOf("-bm");return a>=0&&s.splice(a,2),(a=s.indexOf("-s"))>=0&&(i.scale=[parseFloat(s[a+1]),parseFloat(s[a+2])],s.splice(a,4)),(a=s.indexOf("-o"))>=0&&(i.translate=[parseFloat(s[a+1]),parseFloat(s[a+2])],s.splice(a,4)),i.src=t+s.join(" ").trim(),i.flipY=!0,i.encoding=r||"linear",new Ti(e,i).id}function n(e,t){new wi(e,t)}function r(t){var n=t.split(e,3);return[parseFloat(n[0]),parseFloat(n[1]),parseFloat(n[2])]}}();function jk(e,t){for(var n=0,r=t.objects.length;n<r;n++){var i=t.objects[n],s=i.geometry;if(s.type,0!==s.positions.length){var a={primitive:"triangles",compressGeometry:!1};a.positions=s.positions,s.normals.length>0&&(a.normals=s.normals),s.uv.length>0&&(a.uv=s.uv);for(var o=new Array(a.positions.length/3),A=0;A<o.length;A++)o[A]=A;a.indices=o;var c=Rk;Mn(s.positions,s.positions,c);var l,u=new Wt(e,a),h=i.material.id;h&&""!==h?(l=e.scene.components[h])||e.error("Material not found: "+h):l=new wi(e,{diffuse:[.6,.6,.6],backfaces:!0});var d=new vi(e,{id:e.id+"#"+i.id,origin:0!==c[0]||0!==c[1]||0!==c[2]?c:null,isObject:!0,geometry:u,material:l,pickable:!0});e.addChild(d)}}}function Wk(e,t,n){var r=new XMLHttpRequest;r.open("GET",e,!0),r.addEventListener("load",(function(e){var r=e.target.response;200===this.status?t&&t(r):0===this.status?(console.warn("loadFile: HTTP Status 0 received."),t&&t(r)):n&&n(e)}),!1),r.addEventListener("error",(function(e){n&&n(e)}),!1),r.send(null)}var zk=function(e){m(n,uA);var t=_(n);function n(e,r){var i;return x(this,n),(i=t.call(this,"OBJLoader",e,r))._sceneGraphLoader=new Ok,i}return I(n,[{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var n=new bn(this.viewer.scene,je.apply(t,{isModel:!0})),r=n.id,i=t.src;if(!i)return this.error("load() param expected: src"),n;if(t.metaModelSrc){var s=t.metaModelSrc;je.loadJSON(s,(function(s){e.viewer.metaScene.createMetaModel(r,s),e._sceneGraphLoader.load(n,i,t)}),(function(t){e.error("load(): Failed to load model modelMetadata for model '".concat(r," from  '").concat(s,"' - ").concat(t))}))}else this._sceneGraphLoader.load(n,i,t);return n.once("destroyed",(function(){e.viewer.metaScene.destroyMetaModel(r)})),n}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Xk=function(){function e(t){var n=this;x(this,e);var r,i,s=t.cameraControl,a=t.scene,o=a.canvas.canvas,A=!1,c=.09,l=.01,u=new bn(a,{position:[0,0,0],scale:[5,5,5],isObject:!1}),h=De.vec3();this._setPosition=(r=De.vec3(),i=De.vec3(),function(e){h.set(e),Cn(e,r,i),u.origin=r,u.position=i}),this._setQuaternion=function(e){u.quaternion=e};var d=function(e,t){return new Wt(u,tn({radiusTop:.001,radiusBottom:e,radialSegments:32,heightSegments:1,height:t,openEnded:!1}))},f=function(e,t,n){return new Wt(u,tn({radiusTop:e,radiusBottom:e,radialSegments:n,heightSegments:1,height:t,openEnded:!1}))},v=function(e,t,n){return new Wt(u,an({radius:.8,tube:e,radialSegments:64,tubeSegments:n,arc:2*Math.PI*t}))},g={curve:v(l,.25,14),curveHandle:v(c,.25,14),hoop:v(l,1,8),arrowHead:d(.07,.2),arrowHeadBig:d(.09,.25),arrowHeadHandle:f(c,.37,8),axis:f(l,1,20),axisHandle:f(c,1,20)},m=function(e,t){return new Xi(u,{edges:!1,fill:!0,fillColor:e,fillAlpha:t})},y=new wi(u,{diffuse:[1,1,0],alpha:0,alphaMode:"blend"}),_={},b=function(e,t){De.mulVec3Scalar(e,-1,De.vec3());var r=function(e){return new wi(u,{diffuse:e,emissive:e,ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2})}(e),i=De.quaternionToRotationMat4(t,De.identityMat4());De.mulMat4(De.rotationMat4v(Math.PI,[0,1,0],De.mat4()),i,i);var s=De.scaleMat4v([.6,.6,.6],De.identityMat4()),c=function(e,t){var n=De.translateMat4v(e,De.identityMat4()),r=De.identityMat4();return De.mulMat4(n,t,r),De.mulMat4(i,r,r),De.mulMat4(r,s,De.identityMat4())},l=u.addChild(new vi(u,{geometry:g.curve,material:r,matrix:i,pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1,isUI:!0,isObject:!1}),A),d=u.addChild(new vi(u,{geometry:g.curveHandle,material:y,matrix:i,pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1,isUI:!0,isObject:!1}),A),f=u.addChild(new vi(u,{geometry:g.arrowHead,material:r,matrix:c([.8,.07,0],De.rotationMat4v(180*De.DEGTORAD,[0,0,1],De.identityMat4())),pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),p=u.addChild(new vi(u,{geometry:g.arrowHead,material:r,matrix:c([.07,.8,0],De.rotationMat4v(90*De.DEGTORAD,[0,0,1],De.identityMat4())),pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),v=u.addChild(new vi(u,{geometry:g.hoop,material:r,highlighted:!0,highlightMaterial:m(e,.6),matrix:i,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),b=De.quaternionToRotationMat4(De.vec3PairToQuaternion([0,1,0],e),De.identityMat4());De.mulMat4(De.rotationMat4v(Math.PI,[0,1,0],De.mat4()),b,b);var w,B,C,M=function(e){return De.mulMat4(b,De.translateMat4c(0,e,0,De.identityMat4()),De.identityMat4())},k=M(1.1),E=M(.5),F=u.addChild(new vi(u,{geometry:g.arrowHead,material:r,matrix:k,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),x=u.addChild(new vi(u,{geometry:g.arrowHeadHandle,material:y,matrix:k,pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),U=u.addChild(new vi(u,{geometry:g.axis,material:r,matrix:E,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),I=u.addChild(new vi(u,{geometry:g.axisHandle,material:y,matrix:E,pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),T=u.addChild(new vi(u,{geometry:g.arrowHeadBig,material:r,matrix:k,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),A),P=function(e,t){return De.vec3ApplyQuaternion(u.quaternion,e,t)},S=(w=De.vec3(),B=De.vec3(),C=De.vec3(),function(t,n){P(e,w);var r=h,i=w;De.canvasPosToWorldRay(o,a.camera.viewMatrix,a.camera.projMatrix,a.camera.projection,t,B,C);var s=De.dotVec3(i,C),A=De.subVec3(B,r,n),c=De.dotVec3(A,i),l=De.dotVec3(A,C),u=1-s*s;if(Math.abs(u)>1e-10){var d=(c-s*l)/u;return De.addVec3(r,De.mulVec3Scalar(i,d,n),n),!0}return!1}),D=De.vec3(),Q=De.vec3();_[x.id]=_[I.id]={setActivated:function(e){return T.visible=e},initDragAction:function(e){return S(e,D)&&De.subVec3(D,h,D)&&function(e){S(e,Q)&&(De.subVec3(Q,D,Q),n._setPosition(Q),n._handlers&&n._handlers.onPosition(Q))}}},_[d.id]={setActivated:function(e){return v.visible=e},initDragAction:function(t){var r=function(){var t=a.camera.projectWorldPos(h);P(e,Q),De.transformVec3(a.camera.normalMatrix,Q,Q);var n=Math.sign(Q[2]);return function(e){var r=e[0]-t[0],i=e[1]-t[1];return n*Math.atan2(-i,r)}}(),i=r(t);return function(t){var s=r(t);u.rotate(e,180*(s-i)/Math.PI),n._handlers&&n._handlers.onQuaternion(u.quaternion),i=s}}};var R=!1,O=!1,V=!1,L=function(){var e=V&&R;x.visible=I.visible=F.visible=U.visible=!!e,e||(T.visible=!1)},H=function(){var e=V&&O;d.visible=l.visible=f.visible=p.visible=!!e,e||(v.visible=!1)};return{setPositionActive:function(e){R=e,L()},setRotationActive:function(e){O=e,H()},set visible(e){V=e,L(),H()}}};this._displayMeshes={center:u.addChild(new vi(u,{geometry:new Wt(u,sn({radius:.05})),material:new wi(u,{diffuse:[0,0,0],emissive:[0,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80}),pickable:!1,collidable:!0,clippable:!1,visible:!1,isObject:!1}),A),x:b([1,0,0],De.vec3PairToQuaternion([1,0,0],[0,0,1])),y:b([0,1,0],De.eulerToQuaternion([90,0,0],"XYZ")),z:b([0,0,1],De.identityQuaternion())};var w=[],B=-1,C=function(e){u.scale[0]!==e&&(u.scale=[e,e,e],n._handlers&&n._handlers.onScreenScale&&n._handlers.onScreenScale(u.scale))},M=a.on("tick",(function(){var e=a.camera,t=Math.abs(De.distVec3(e.eye,h));"perspective"===e.projection?t!==B&&C(.07*t*Math.tan(e.perspective.fov*De.DEGTORAD)):"ortho"===e.projection&&C(e.ortho.scale/10),B=t}));w.push((function(){return a.off(M)}));var k=null,E=null;w.push((function(){E&&E.cleanup()}));var F=De.vec2(),U=function(e,t){t[0]=e.pageX,t[1]=e.pageY,pM(o.ownerDocument.documentElement,o,t)},I=function(e){U(e,F);var t=a.pick({canvasPos:F}),n=t&&t.entity,r=n&&n.id;return r in _&&_[r]},T=function(e,t){var n=I(t(e));if(n){E&&E.cleanup();var r=n.initDragAction(F);return r&&(s.pointerEnabled=!1,n.setActivated(!0),E={onChange:function(e){var n=t(e);n&&(U(n,F),r(F))},cleanup:function(){E=null,s.pointerEnabled=!0,n.setActivated(!1)}}),!!r}return!1},P=function(e,t){o.addEventListener(e,t),w.push((function(){return o.removeEventListener(e,t)}))},S=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()};P("mousedown",(function(e){1===e.which&&T(e,(function(e){return 1===e.which&&e}))&&S(e)})),P("mousemove",(function(e){if(E)E.onChange(e),S(e);else{k&&k();var t=I(e);t?(t.setActivated(!0),k=function(){return t.setActivated(!1)}):k=null}})),P("mouseup",(function(e){E&&(E.onChange(e),E.cleanup())})),P("touchstart",(function(e){if(e.preventDefault(),1===e.touches.length){var t=e.touches[0].identifier;T(e,(function(e){return p(e.changedTouches).find((function(e){return e.identifier===t}))}))&&S(e)}})),P("touchmove",(function(e){E&&(E.onChange(e),S(e))})),P("touchend",(function(e){E&&(E.onChange(e),E.cleanup())})),this.__destroy=function(){for(var e in w.forEach((function(e){return e()})),u.destroy(),_)delete _[e]}}return I(e,[{key:"destroy",value:function(){this.__destroy()}},{key:"setHandlers",value:function(e){Object.values(this._displayMeshes).forEach((function(t){return t.visible=!!e})),this._handlers=e,this._displayMeshes.x.setPositionActive(e&&e.onPosition),this._displayMeshes.y.setPositionActive(e&&e.onPosition),this._displayMeshes.z.setPositionActive(e&&e.onPosition),this._displayMeshes.x.setRotationActive(e&&e.onQuaternion),this._displayMeshes.y.setRotationActive(e&&e.onQuaternion),this._displayMeshes.z.setRotationActive(e&&e.onQuaternion)}},{key:"setPosition",value:function(e){this._setPosition(e)}},{key:"setQuaternion",value:function(e){this._setQuaternion(e)}}]),e}(),Kk=function(){function e(t,n,r){var i=this;x(this,e),this.id=r.id,this._sectionPlane=r,this._mesh=new vi(n,{id:r.id,geometry:new Wt(n,qt({xSize:.5,ySize:.5,zSize:.001})),material:new wi(n,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new Zi(n,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Xi(n,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Xi(n,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});var s=De.vec3([0,0,0]),a=De.vec3(),o=De.vec3([0,0,1]),A=De.vec4(4),c=De.vec3(),l=function(){var e=i._sectionPlane.scene.center,t=[-i._sectionPlane.dir[0],-i._sectionPlane.dir[1],-i._sectionPlane.dir[2]];De.subVec3(e,i._sectionPlane.pos,s);var n=-De.dotVec3(t,s);De.normalizeVec3(t),De.mulVec3Scalar(t,n,a);var r=De.vec3PairToQuaternion(o,i._sectionPlane.dir,A);c[0]=.1*a[0],c[1]=.1*a[1],c[2]=.1*a[2],i._mesh.quaternion=r,i._mesh.position=c};this._onSectionPlanePos=this._sectionPlane.on("pos",l),this._onSectionPlaneDir=this._sectionPlane.on("dir",l),this._highlighted=!1,this._selected=!1}return I(e,[{key:"setHighlighted",value:function(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}},{key:"getHighlighted",value:function(){return this._highlighted}},{key:"setSelected",value:function(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}},{key:"getSelected",value:function(){return this._selected}},{key:"destroy",value:function(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}]),e}(),Zk=function(){function e(t,n){var r=this;if(x(this,e),!(n.onHoverEnterPlane&&n.onHoverLeavePlane&&n.onClickedNothing&&n.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=t,this._viewer=t.viewer,this._onHoverEnterPlane=n.onHoverEnterPlane,this._onHoverLeavePlane=n.onHoverLeavePlane,this._onClickedNothing=n.onClickedNothing,this._onClickedPlane=n.onClickedPlane,this._visible=!0,this._planes={},this._canvas=n.overviewCanvas,this._scene=new uc(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new Do(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new Do(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new Do(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;var i=this._scene.camera,s=De.rotationMat4c(-90*De.DEGTORAD,1,0,0),a=De.vec3(),o=De.vec3(),A=De.vec3();this._synchCamera=function(){var e=r._viewer.camera.eye,t=r._viewer.camera.look,n=r._viewer.camera.up;De.mulVec3Scalar(De.normalizeVec3(De.subVec3(e,t,a)),7),r._zUp?(De.transformVec3(s,a,o),De.transformVec3(s,n,A),i.look=[0,0,0],i.eye=De.transformVec3(s,a,o),i.up=De.transformPoint3(s,n,A)):(i.look=[0,0,0],i.eye=a,i.up=n)},this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(function(e){r._scene.camera.perspective.fov=e}));var c=null;this._onInputMouseMove=this._scene.input.on("mousemove",(function(e){var t=r._scene.pick({canvasPos:e});if(t){if(!c||t.entity.id!==c.id){if(c)r._planes[c.id]&&r._onHoverLeavePlane(c.id);c=t.entity,r._planes[c.id]&&r._onHoverEnterPlane(c.id)}}else c&&(r._onHoverLeavePlane(c.id),c=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=function(){c?r._planes[c.id]&&r._onClickedPlane(c.id):r._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=function(){c&&(r._onHoverLeavePlane(c.id),c=null)}),this.setVisible(n.overviewVisible)}return I(e,[{key:"addSectionPlane",value:function(e){this._planes[e.id]=new Kk(this,this._scene,e)}},{key:"setPlaneHighlighted",value:function(e,t){var n=this._planes[e];n&&n.setHighlighted(t)}},{key:"setPlaneSelected",value:function(e,t){var n=this._planes[e];n&&n.setSelected(t)}},{key:"removeSectionPlane",value:function(e){var t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}},{key:"getVisible",value:function(){return this._visible}},{key:"destroy",value:function(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}]),e}(),Jk=De.AABB3(),Yk=De.vec3(),qk=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,n),(r=t.call(this,"SectionPlanes",e))._freeControls=[],r._sectionPlanes=e.scene.sectionPlanes,r._controls={},r._shownControlId=null,null!==i.overviewCanvasId&&void 0!==i.overviewCanvasId){var s=document.getElementById(i.overviewCanvasId);s?r._overview=new Zk(w(r),{overviewCanvas:s,visible:i.overviewVisible,onHoverEnterPlane:function(e){r._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:function(e){r._overview.setPlaneHighlighted(e,!1)},onClickedPlane:function(e){if(r.getShownControl()!==e){r.showControl(e);var t=r.sectionPlanes[e].pos;Jk.set(r.viewer.scene.aabb),De.getAABB3Center(Jk,Yk),Jk[0]+=t[0]-Yk[0],Jk[1]+=t[1]-Yk[1],Jk[2]+=t[2]-Yk[2],Jk[3]+=t[0]-Yk[0],Jk[4]+=t[1]-Yk[1],Jk[5]+=t[2]-Yk[2],r.viewer.cameraFlight.flyTo({aabb:Jk,fitFOV:65})}else r.hideControl()},onClickedNothing:function(){r.hideControl()}}):r.warn("Can't find overview canvas: '"+i.overviewCanvasId+"' - will create plugin without overview")}return r._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(function(e){r._sectionPlaneCreated(e)})),r}return I(n,[{key:"setOverviewVisible",value:function(e){this._overview&&this._overview.setVisible(e)}},{key:"getOverviewVisible",value:function(){if(this._overview)return this._overview.getVisible()}},{key:"sectionPlanes",get:function(){return this._sectionPlanes}},{key:"createSectionPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);var t=new oA(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0});return t}},{key:"_sectionPlaneCreated",value:function(e){var t,n,r,i,s,a,o,A,c,l,u,h=this,d=this._freeControls.length>0?this._freeControls.pop():(i=h.viewer.scene,(r=new bn(i,{isObject:!1})).addChild(new vi(r,{geometry:new Wt(r,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new wi(r,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,ghostMaterial:new Xi(r,{edges:!1,filled:!0,fillColor:[1,1,0],edgeColor:[0,0,0],fillAlpha:.1,backfaces:!0}),pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1],isObject:!1})),r.addChild(new vi(r,{geometry:new Wt(r,an({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new wi(r,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),highlightMaterial:new Xi(r,{edges:!1,edgeColor:[0,0,0],filled:!0,fillColor:[.8,.8,.8],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45],isObject:!1})),s={setPosition:(t=De.vec3(),n=De.vec3(),function(e){Cn(e,t,n),r.origin=t,r.position=n}),setQuaternion:function(e){r.quaternion=e},setScale:function(e){r.scale=e},setVisible:function(e){r.visible=e},destroy:function(){r.destroy()}},a=function(){},o=new Xk(h.viewer),A=!1,c=!1,l=null,u=function(){var e=c&&!A;s.setVisible(e),o.setHandlers(e&&l)},{_destroy:function(){a(),o.destroy(),s.destroy()},setCulled:function(e){A=e,u()},setVisible:function(e){c=e,u()},_setSectionPlane:function(e){if(a(),e){var t=!1;l={onPosition:function(t){s.setPosition(t),e.pos=t},onQuaternion:function(n){s.setQuaternion(n),t=!0,e.quaternion=n},onScreenScale:function(e){s.setScale(e)}};var n=function(){s.setPosition(e.pos),o.setPosition(e.pos)},r=function(){s.setQuaternion(e.quaternion),o.setQuaternion(e.quaternion)};n(),r();var i=e.on("pos",n),A=e.on("dir",(function(){t?t=!1:r()}));a=function(){e.off(i),e.off(A),a=function(){}}}}});d._setSectionPlane(e),d.setVisible(!1),this._controls[e.id]=d,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(function(){h._sectionPlaneDestroyed(e)}))}},{key:"flipSectionPlanes",value:function(){var e=this.viewer.scene.sectionPlanes;for(var t in e){e[t].flipDir()}}},{key:"showControl",value:function(e){var t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}},{key:"getShownControl",value:function(){return this._shownControlId}},{key:"hideControl",value:function(){for(var e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}},{key:"destroySectionPlane",value:function(e){var t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}},{key:"_sectionPlaneDestroyed",value:function(e){this._overview&&this._overview.removeSectionPlane(e);var t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}},{key:"clear",value:function(){for(var e=Object.keys(this._sectionPlanes),t=0,n=e.length;t<n;t++)this.destroySectionPlane(e[t])}},{key:"send",value:function(e,t){switch(e){case"snapshotStarting":for(var n in this._controls)this._controls.hasOwnProperty(n)&&this._controls[n].setCulled(!0);break;case"snapshotFinished":for(var r in this._controls)this._controls.hasOwnProperty(r)&&this._controls[r].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}},{key:"destroy",value:function(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),v(C(n.prototype),"destroy",this).call(this)}},{key:"_destroyFreeControls",value:function(){for(var e=this._freeControls.pop();e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}}]),n}(),$k=I((function e(t,n,r,i,s,a){x(this,e),this.plugin=t,this.storeyId=s,this.modelId=i,this.storeyAABB=r.slice(),this.aabb=this.storeyAABB,this.modelAABB=n.slice(),this.numObjects=a})),eE=I((function e(t,n,r,i,s,a){x(this,e),this.storeyId=t,this.imageData=n,this.format=r,this.width=i,this.height=s})),tE=De.vec3(),nE=De.mat4(),rE="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==",iE=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"StoreyViews",e))._objectsMemento=new Jo,r._cameraMemento=new zo,r.storeys={},r._storeysList=null,r.modelStoreys={},r._fitStoreyMaps=!!i.fitStoreyMaps,r._onModelLoaded=r.viewer.scene.on("modelLoaded",(function(e){r._registerModelStoreys(e),r.fire("storeys",r.storeys)})),r}return I(n,[{key:"_registerModelStoreys",value:function(e){var t=this,n=this.viewer,r=n.scene,i=n.metaScene,s=i.metaModels[e],a=r.models[e];if(s&&s.rootMetaObjects){for(var o=s.rootMetaObjects,A=0,c=o.length;A<c;A++)for(var l=o[A].getObjectIDsInSubtreeByType(["IfcBuildingStorey"]),u=0,h=l.length;u<h;u++){var d=l[u],f=i.metaObjects[d].getObjectIDsInSubtree(),p=r.getAABB(f),v=Math.random()>.5?f.length:0,g=new $k(this,a.aabb,p,e,d,v);g._onModelDestroyed=a.once("destroyed",(function(){t._deregisterModelStoreys(e),t.fire("storeys",t.storeys)})),this.storeys[d]=g,this._storeysList=null,this.modelStoreys[e]||(this.modelStoreys[e]={}),this.modelStoreys[e][d]=g}this._clipBoundingBoxes()}}},{key:"_clipBoundingBoxes",value:function(){var e,t=this.storeysList,n=this.viewer.metaScene,r=this.viewer.camera.worldUp,i=r[0]>r[1]&&r[0]>r[2],s=!i&&r[1]>r[0]&&r[1]>r[2];!i&&!s&&r[2]>r[0]&&(r[2],r[1]),e=i?0:s?1:2;for(var a=0,o=t.length;a<o;a++){var A=n.metaObjects[t[a].storeyId].attributes.elevation;if(isNaN(A))return;var c=t[a].storeyAABB;if(c[e]=Math.max(c[1],parseFloat(A)),a>0){var l=n.metaObjects[t[a-1].storeyId].attributes.elevation;c[4]=Math.min(c[e+3],parseFloat(l))}this.storeys[t[a].storeyId].storeyAABB=c}}},{key:"_deregisterModelStoreys",value:function(e){var t=this.modelStoreys[e];if(t){var n=this.viewer.scene;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r],s=n.models[i.modelId];s&&s.off(i._onModelDestroyed),delete this.storeys[r],this._storeysList=null}delete this.modelStoreys[e]}}},{key:"fitStoreyMaps",get:function(){return this._fitStoreyMaps}},{key:"gotoStoreyCamera",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.storeys[e];if(!n)return this.error("IfcBuildingStorey not found with this ID: "+e),void(t.done&&t.done());var r=this.viewer,i=r.scene,s=i.camera,a=n.storeyAABB;if(a[3]<a[0]||a[4]<a[1]||a[5]<a[2])t.done&&t.done();else if(a[3]!==a[0]||a[4]!==a[1]||a[5]!==a[2]){var o=De.getAABB3Center(a),A=De.getAABB3Diag(a),c=45,l=Math.abs(A/Math.tan(c*De.DEGTORAD)),u=1.3*A,h=tE;h[0]=o[0]+s.worldUp[0]*l,h[1]=o[1]+s.worldUp[1]*l,h[2]=o[2]+s.worldUp[2]*l;var d=s.worldForward;t.done?r.cameraFlight.flyTo(je.apply(t,{eye:h,look:o,up:d,orthoScale:u}),(function(){t.done()})):(r.cameraFlight.jumpTo(je.apply(t,{eye:h,look:o,up:d,orthoScale:u})),r.camera.ortho.scale=u)}else t.done&&t.done()}},{key:"showStoreyObjects",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.storeys[e];if(n){var r=this.viewer,i=r.scene,s=r.metaScene,a=s.metaObjects[e];a&&(t.hideOthers&&i.setObjectsVisible(r.scene.visibleObjectIds,!1),this.withStoreyObjects(e,(function(e,t){e&&(e.visible=!0)})))}else this.error("IfcBuildingStorey not found with this ID: "+e)}},{key:"withStoreyObjects",value:function(e,t){var n=this.viewer,r=n.scene,i=n.metaScene,s=i.metaObjects[e];if(s)for(var a=s.getObjectIDsInSubtree(),o=0,A=a.length;o<A;o++){var c=a[o],l=i.metaObjects[c],u=r.objects[c];u&&t(u,l)}}},{key:"createStoreyMap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.storeys[e];if(!n)return this.error("IfcBuildingStorey not found with this ID: "+e),rE;var r,i,s=this.viewer,a=s.scene,o=t.format||"png",A=this._fitStoreyMaps?n.storeyAABB:n.modelAABB,c=Math.abs((A[5]-A[2])/(A[3]-A[0])),l=t.padding||0,u=!!t.captureSectionPlanes;t.width&&t.height?(r=t.width,i=t.height):t.height?(i=t.height,r=Math.round(i/c)):t.width?(r=t.width,i=Math.round(r*c)):(r=300,i=Math.round(r*c));var h={visible:!0};this._objectsMemento.saveObjects(a,h),this._cameraMemento.saveCamera(a),this.showStoreyObjects(e,je.apply(t,{hideOthers:!0})),u&&this._toggleSectionPlanes(!1),this._arrangeStoreyMapCamera(n);var d=s.getSnapshot({width:r,height:i,format:o});return this._objectsMemento.restoreObjects(a,h),this._cameraMemento.restoreCamera(a),u&&this._toggleSectionPlanes(!0),new eE(e,d,o,r,i,l)}},{key:"_toggleSectionPlanes",value:function(e){var t=this.viewer.scene.sectionPlanes;for(var n in t)t[n].active=e}},{key:"_arrangeStoreyMapCamera",value:function(e){var t=this.viewer,n=t.scene.camera,r=this._fitStoreyMaps?e.storeyAABB:e.modelAABB,i=De.getAABB3Center(r),s=tE;s[0]=i[0]+.5*n.worldUp[0],s[1]=i[1]+.5*n.worldUp[1],s[2]=i[2]+.5*n.worldUp[2];var a=n.worldForward;t.cameraFlight.jumpTo({eye:s,look:i,up:a});var o=(r[3]-r[0])/2,A=(r[4]-r[1])/2,c=(r[5]-r[2])/2,l=-o,u=+o,h=-A,d=+A,f=-c,p=+c;t.camera.customProjection.matrix=De.orthoMat4c(l,u,f,p,h,d,nE),t.camera.projection="customProjection"}},{key:"pickStoreyMap",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.storeyId,i=this.storeys[r];if(!i)return this.error("IfcBuildingStorey not found with this ID: "+r),null;var s=1-t[0]/e.width,a=1-t[1]/e.height,o=this._fitStoreyMaps?i.storeyAABB:i.modelAABB,A=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=u-A,p=h-c,v=d-l,g=De.vec3([A+f*s,c+.5*p,l+v*a]),m=De.vec3([0,-1,0]),y=De.addVec3(g,m,tE),_=this.viewer.camera.worldForward,b=De.lookAtMat4v(g,y,_,nE),w=this.viewer.scene.pick({pickSurface:n.pickSurface,pickInvisible:!0,matrix:b});return w}},{key:"storeyMapToWorldPos",value:function(e,t){var n=e.storeyId,r=this.storeys[n];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+n),null;var i=1-t[0]/e.width,s=1-t[1]/e.height,a=this._fitStoreyMaps?r.storeyAABB:r.modelAABB,o=a[0],A=a[1],c=a[2],l=a[3],u=a[4],h=a[5],d=l-o,f=u-A,p=h-c,v=De.vec3([o+d*i,A+.5*f,c+p*s]);return v}},{key:"getStoreyContainingWorldPos",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t?this._filterStoreys(t):this.storeys;for(var r in n){var i=n[r];if(De.point3AABB3AbsoluteIntersect(i.storeyAABB,e))return r}return null}},{key:"getStoreyInVerticalRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t?this._filterStoreys(t):this.storeys;for(var r in n){var i=n[r],s=[0,0,0,0,0,0],a=[0,0,0];if(s[1]=i.storeyAABB[1],s[4]=i.storeyAABB[4],a[1]=e[1],De.point3AABB3AbsoluteIntersect(s,a))return r}return null}},{key:"isPositionAboveOrBelowBuilding",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=t?this._filterStoreys(t):this.storeys,r=Object.keys(n);if(r.length<=0)return null;var i=[r[0],r[r.length-1]];return e[1]<n[i[0]].storeyAABB[1]?i[0]:e[1]>n[i[1]].storeyAABB[4]?i[1]:null}},{key:"worldPosToStoreyMap",value:function(e,t,n){var r=e.storeyId,i=this.storeys[r];if(!i)return this.error("IfcBuildingStorey not found with this ID: "+r),!1;var s=this._fitStoreyMaps?i.storeyAABB:i.modelAABB,a=s[0],o=s[1],A=s[2],c=s[3]-a,l=s[4]-o,u=s[5]-A,h=this.viewer.camera.worldUp,d=h[0]>h[1]&&h[0]>h[2],f=!d&&h[1]>h[0]&&h[1]>h[2];!d&&!f&&h[2]>h[0]&&(h[2],h[1]);var p=e.width/c,v=f?e.height/u:e.height/l;return n[0]=Math.floor(e.width-(t[0]-a)*p),n[1]=Math.floor(e.height-(t[2]-A)*v),n[0]>=0&&n[0]<e.width&&n[1]>=0&&n[1]<=e.height}},{key:"worldDirToStoreyMap",value:function(e,t,n){var r=this.viewer.camera,i=r.eye,s=r.look,a=De.subVec3(s,i,tE),o=r.worldUp,A=o[0]>o[1]&&o[0]>o[2],c=!A&&o[1]>o[0]&&o[1]>o[2];!A&&!c&&o[2]>o[0]&&(o[2],o[1]),A?(n[0]=a[1],n[1]=a[2]):c?(n[0]=a[0],n[1]=a[2]):(n[0]=a[0],n[1]=a[1]),De.normalizeVec2(n)}},{key:"destroy",value:function(){this.viewer.scene.off(this._onModelLoaded),v(C(n.prototype),"destroy",this).call(this)}},{key:"storeysList",get:function(){return this._storeysList||(this._storeysList=Object.values(this.storeys),this._storeysList.sort(this._getSpatialSortFunc())),this._storeysList}},{key:"_getSpatialSortFunc",value:function(){var e=this,t=this.viewer.scene.camera;return this._spatialSortFunc||(this._spatialSortFunc=function(n,r){var i=0;i=t.xUp?0:t.yUp?1:2;var s=e.viewer.metaScene,a=s.metaObjects[n.storeyId],o=s.metaObjects[r.storeyId];if(a&&a.attributes&&void 0!==a.attributes.elevation&&o&&o.attributes&&void 0!==o.attributes.elevation){var A=Number.parseFloat(a.attributes.elevation),c=Number.parseFloat(o.attributes.elevation);return A>c?-1:A<c?1:0}return n.aabb[i]>r.aabb[i]?-1:n.aabb[i]<r.aabb[i]?1:0})}},{key:"_filterStoreys",value:function(e){return Object.fromEntries(Object.entries(this.storeys).filter((function(t){var n=k(t,2);n[0];return n[1].modelId===e})))}}]),n}(),sE=new Float64Array([0,0,1]),aE=new Float64Array(4),oE=function(){function e(t){x(this,e),this.id=null,this._viewer=t.viewer,this._plugin=t,this._visible=!1,this._pos=De.vec3(),this._origin=De.vec3(),this._rtcPos=De.vec3(),this._baseDir=De.vec3(),this._rootNode=null,this._displayMeshes=null,this._affordanceMeshes=null,this._ignoreNextSectionPlaneDirUpdate=!1,this._createNodes(),this._bindEvents()}return I(e,[{key:"_setSectionPlane",value:function(e){var t=this;this._sectionPlane&&(this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._onSectionPlanePos=null,this._onSectionPlaneDir=null,this._sectionPlane=null),e&&(this.id=e.id,this._setPos(e.pos),this._setDir(e.dir),this._sectionPlane=e,this._onSectionPlanePos=e.on("pos",(function(){t._setPos(t._sectionPlane.pos)})),this._onSectionPlaneDir=e.on("dir",(function(){t._ignoreNextSectionPlaneDirUpdate?t._ignoreNextSectionPlaneDirUpdate=!1:t._setDir(t._sectionPlane.dir)})))}},{key:"sectionPlane",get:function(){return this._sectionPlane}},{key:"_setPos",value:function(e){this._pos.set(e),Cn(this._pos,this._origin,this._rtcPos),this._rootNode.origin=this._origin,this._rootNode.position=this._rtcPos}},{key:"_setDir",value:function(e){this._baseDir.set(e),this._rootNode.quaternion=De.vec3PairToQuaternion(sE,e,aE)}},{key:"_setSectionPlaneDir",value:function(e){this._sectionPlane&&(this._ignoreNextSectionPlaneDirUpdate=!0,this._sectionPlane.dir=e)}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(this._visible!==e){var t;for(t in this._visible=e,this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].visible=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].visible=e)}}},{key:"getVisible",value:function(){return this._visible}},{key:"setCulled",value:function(e){var t;for(t in this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].culled=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].culled=e)}},{key:"_createNodes",value:function(){var e=!1,t=this._viewer.scene,n=.01;this._rootNode=new bn(t,{position:[0,0,0],scale:[5,5,5]});var r=this._rootNode,i={arrowHead:new Wt(r,tn({radiusTop:.001,radiusBottom:.07,radialSegments:32,heightSegments:1,height:.2,openEnded:!1})),arrowHeadBig:new Wt(r,tn({radiusTop:.001,radiusBottom:.09,radialSegments:32,heightSegments:1,height:.25,openEnded:!1})),axis:new Wt(r,tn({radiusTop:n,radiusBottom:n,radialSegments:20,heightSegments:1,height:1,openEnded:!1}))},s={red:new wi(r,{diffuse:[1,0,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),green:new wi(r,{diffuse:[0,1,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),blue:new wi(r,{diffuse:[0,0,1],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightRed:new Xi(r,{edges:!1,fill:!0,fillColor:[1,0,0],fillAlpha:.6})};this._displayMeshes={plane:r.addChild(new vi(r,{geometry:new Wt(r,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new wi(r,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1]}),e),planeFrame:r.addChild(new vi(r,{geometry:new Wt(r,an({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new wi(r,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45]}),e),center:r.addChild(new vi(r,{geometry:new Wt(r,sn({radius:.05})),material:s.center,pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:r.addChild(new vi(r,{geometry:i.arrowHead,material:s.blue,matrix:function(){var e=De.translateMat4c(0,1.1,0,De.identityMat4()),t=De.rotationMat4v(-90*De.DEGTORAD,[.8,0,0],De.identityMat4());return De.mulMat4(t,e,De.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zShaft:r.addChild(new vi(r,{geometry:i.axis,material:s.blue,matrix:function(){var e=De.translateMat4c(0,.5,0,De.identityMat4()),t=De.rotationMat4v(-90*De.DEGTORAD,[1,0,0],De.identityMat4());return De.mulMat4(t,e,De.identityMat4())}(),clippable:!1,pickable:!1,collidable:!0,visible:!1}),e)},this._affordanceMeshes={planeFrame:r.addChild(new vi(r,{geometry:new Wt(r,an({center:[0,0,0],radius:2,tube:n,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new wi(r,{ambient:[1,1,1],diffuse:[0,0,0],emissive:[1,1,0]}),highlighted:!0,highlightMaterial:new Xi(r,{edges:!1,filled:!0,fillColor:[1,1,0],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,1],rotation:[0,0,45]}),e),zAxisArrow:r.addChild(new vi(r,{geometry:i.arrowHeadBig,material:s.blue,matrix:function(){var e=De.translateMat4c(0,1.1,0,De.identityMat4()),t=De.rotationMat4v(-90*De.DEGTORAD,[.8,0,0],De.identityMat4());return De.mulMat4(t,e,De.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e)}}},{key:"_bindEvents",value:function(){var e=this,t=this._rootNode,n=De.vec2(),r=this._viewer.camera,i=this._viewer.scene,s=0,a=!1,o=De.vec3([0,0,0]),A=-1;this._onCameraViewMatrix=i.camera.on("viewMatrix",(function(){})),this._onCameraProjMatrix=i.camera.on("projMatrix",(function(){})),this._onSceneTick=i.on("tick",(function(){a=!1;var n=Math.abs(De.lenVec3(De.subVec3(i.camera.eye,e._pos,o)));if(n!==A&&"perspective"===r.projection){var c=.07*(Math.tan(r.perspective.fov*De.DEGTORAD)*n);t.scale=[c,c,c],A=n}if("ortho"===r.projection){var u=r.ortho.scale/10;t.scale=[u,u,u],A=n}0!==s&&(l(s),s=0)}));var c=function(){var e=new Float64Array(2);return function(t){if(t){for(var n=t.target,r=0,i=0;n.offsetParent;)r+=n.offsetLeft,i+=n.offsetTop,n=n.offsetParent;e[0]=t.pageX-r,e[1]=t.pageY-i}else t=window.event,e[0]=t.x,e[1]=t.y;return e}}(),l=function(t){var n=e._sectionPlane.pos,r=e._sectionPlane.dir;De.addVec3(n,De.mulVec3Scalar(r,.1*t*e._plugin.getDragSensitivity(),De.vec3())),e._sectionPlane.pos=n},u=!1;this._plugin._controlElement.addEventListener("mousedown",this._canvasMouseDownListener=function(t){if(t.preventDefault(),e._visible&&(e._viewer.cameraControl.pointerEnabled=!1,1===t.which)){u=!0;var r=c(t);n[0]=r[0],n[1]=r[1]}}),this._plugin._controlElement.addEventListener("mousemove",this._canvasMouseMoveListener=function(t){if(e._visible&&u&&!a){var r=c(t),i=r[0],s=r[1];l(s-n[1]),n[0]=i,n[1]=s}}),this._plugin._controlElement.addEventListener("mouseup",this._canvasMouseUpListener=function(t){e._visible&&(e._viewer.cameraControl.pointerEnabled=!0,u&&(t.which,u=!1))}),this._plugin._controlElement.addEventListener("wheel",this._canvasWheelListener=function(t){e._visible&&(s+=Math.max(-1,Math.min(1,40*-t.deltaY)))});var h,d,f=null;this._plugin._controlElement.addEventListener("touchstart",this._handleTouchStart=function(t){t.stopPropagation(),t.preventDefault(),e._visible&&(h=t.touches[0].clientY,f=h,s=0)}),this._plugin._controlElement.addEventListener("touchmove",this._handleTouchMove=function(t){t.stopPropagation(),t.preventDefault(),e._visible&&(a||(a=!0,d=t.touches[0].clientY,null!==f&&(s+=d-f),f=d))}),this._plugin._controlElement.addEventListener("touchend",this._handleTouchEnd=function(t){t.stopPropagation(),t.preventDefault(),e._visible&&(h=null,d=null,s=0)})}},{key:"_destroy",value:function(){this._unbindEvents(),this._destroyNodes()}},{key:"_unbindEvents",value:function(){var e=this._viewer,t=e.scene,n=t.canvas.canvas,r=e.camera,i=this._plugin._controlElement;t.off(this._onSceneTick),n.removeEventListener("mousedown",this._canvasMouseDownListener),n.removeEventListener("mousemove",this._canvasMouseMoveListener),n.removeEventListener("mouseup",this._canvasMouseUpListener),n.removeEventListener("wheel",this._canvasWheelListener),i.removeEventListener("touchstart",this._handleTouchStart),i.removeEventListener("touchmove",this._handleTouchMove),i.removeEventListener("touchend",this._handleTouchEnd),r.off(this._onCameraViewMatrix),r.off(this._onCameraProjMatrix)}},{key:"_destroyNodes",value:function(){this._setSectionPlane(null),this._rootNode.destroy(),this._displayMeshes={},this._affordanceMeshes={}}}]),e}(),AE=function(){function e(t,n,r){var i=this;x(this,e),this.id=r.id,this._sectionPlane=r,this._mesh=new vi(n,{id:r.id,geometry:new Wt(n,qt({xSize:.5,ySize:.5,zSize:.001})),material:new wi(n,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new Zi(n,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Xi(n,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Xi(n,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});var s=De.vec3([0,0,0]),a=De.vec3(),o=De.vec3([0,0,1]),A=De.vec4(4),c=De.vec3(),l=function(){var e=i._sectionPlane.scene.center,t=[-i._sectionPlane.dir[0],-i._sectionPlane.dir[1],-i._sectionPlane.dir[2]];De.subVec3(e,i._sectionPlane.pos,s);var n=-De.dotVec3(t,s);De.normalizeVec3(t),De.mulVec3Scalar(t,n,a);var r=De.vec3PairToQuaternion(o,i._sectionPlane.dir,A);c[0]=.1*a[0],c[1]=.1*a[1],c[2]=.1*a[2],i._mesh.quaternion=r,i._mesh.position=c};this._onSectionPlanePos=this._sectionPlane.on("pos",l),this._onSectionPlaneDir=this._sectionPlane.on("dir",l),this._highlighted=!1,this._selected=!1}return I(e,[{key:"setHighlighted",value:function(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}},{key:"getHighlighted",value:function(){return this._highlighted}},{key:"setSelected",value:function(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}},{key:"getSelected",value:function(){return this._selected}},{key:"destroy",value:function(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}]),e}(),cE=function(){function e(t,n){var r=this;if(x(this,e),!(n.onHoverEnterPlane&&n.onHoverLeavePlane&&n.onClickedNothing&&n.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=t,this._viewer=t.viewer,this._onHoverEnterPlane=n.onHoverEnterPlane,this._onHoverLeavePlane=n.onHoverLeavePlane,this._onClickedNothing=n.onClickedNothing,this._onClickedPlane=n.onClickedPlane,this._visible=!0,this._planes={},this._canvas=n.overviewCanvas,this._scene=new uc(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new Do(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new Do(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new Do(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;var i=this._scene.camera,s=De.rotationMat4c(-90*De.DEGTORAD,1,0,0),a=De.vec3(),o=De.vec3(),A=De.vec3();this._synchCamera=function(){var e=r._viewer.camera.eye,t=r._viewer.camera.look,n=r._viewer.camera.up;De.mulVec3Scalar(De.normalizeVec3(De.subVec3(e,t,a)),7),r._zUp?(De.transformVec3(s,a,o),De.transformVec3(s,n,A),i.look=[0,0,0],i.eye=De.transformVec3(s,a,o),i.up=De.transformPoint3(s,n,A)):(i.look=[0,0,0],i.eye=a,i.up=n)},this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(function(e){r._scene.camera.perspective.fov=e}));var c=null;this._onInputMouseMove=this._scene.input.on("mousemove",(function(e){var t=r._scene.pick({canvasPos:e});if(t){if(!c||t.entity.id!==c.id){if(c)r._planes[c.id]&&r._onHoverLeavePlane(c.id);c=t.entity,r._planes[c.id]&&r._onHoverEnterPlane(c.id)}}else c&&(r._onHoverLeavePlane(c.id),c=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=function(){c?r._planes[c.id]&&r._onClickedPlane(c.id):r._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=function(){c&&(r._onHoverLeavePlane(c.id),c=null)}),this.setVisible(n.overviewVisible)}return I(e,[{key:"addSectionPlane",value:function(e){this._planes[e.id]=new AE(this,this._scene,e)}},{key:"setPlaneHighlighted",value:function(e,t){var n=this._planes[e];n&&n.setHighlighted(t)}},{key:"setPlaneSelected",value:function(e,t){var n=this._planes[e];n&&n.setSelected(t)}},{key:"removeSectionPlane",value:function(e){var t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}},{key:"setVisible",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}},{key:"getVisible",value:function(){return this._visible}},{key:"destroy",value:function(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}]),e}(),lE=De.AABB3(),uE=De.vec3(),hE=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,n),(r=t.call(this,"FaceAlignedSectionPlanesPlugin",e))._freeControls=[],r._sectionPlanes=e.scene.sectionPlanes,r._controls={},r._shownControlId=null,r._dragSensitivity=i.dragSensitivity||1,null!==i.overviewCanvasId&&void 0!==i.overviewCanvasId){var s=document.getElementById(i.overviewCanvasId);s?r._overview=new cE(w(r),{overviewCanvas:s,visible:i.overviewVisible,onHoverEnterPlane:function(e){r._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:function(e){r._overview.setPlaneHighlighted(e,!1)},onClickedPlane:function(e){if(r.getShownControl()!==e){r.showControl(e);var t=r.sectionPlanes[e].pos;lE.set(r.viewer.scene.aabb),De.getAABB3Center(lE,uE),lE[0]+=t[0]-uE[0],lE[1]+=t[1]-uE[1],lE[2]+=t[2]-uE[2],lE[3]+=t[0]-uE[0],lE[4]+=t[1]-uE[1],lE[5]+=t[2]-uE[2],r.viewer.cameraFlight.flyTo({aabb:lE,fitFOV:65})}else r.hideControl()},onClickedNothing:function(){r.hideControl()}}):r.warn("Can't find overview canvas: '"+i.overviewCanvasId+"' - will create plugin without overview")}return null===i.controlElementId||void 0===i.controlElementId?r.error("Parameter expected: controlElementId"):(r._controlElement=document.getElementById(i.controlElementId),r._controlElement||r.warn("Can't find control element: '"+i.controlElementId+"' - will create plugin without control element")),r._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(function(e){r._sectionPlaneCreated(e)})),r}return I(n,[{key:"setDragSensitivity",value:function(e){this._dragSensitivity=e||1}},{key:"getDragSensitivity",value:function(){return this._dragSensitivity}},{key:"setOverviewVisible",value:function(e){this._overview&&this._overview.setVisible(e)}},{key:"getOverviewVisible",value:function(){if(this._overview)return this._overview.getVisible()}},{key:"sectionPlanes",get:function(){return this._sectionPlanes}},{key:"createSectionPlane",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);var t=new oA(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0});return t}},{key:"_sectionPlaneCreated",value:function(e){var t=this,n=this._freeControls.length>0?this._freeControls.pop():new oE(this);n._setSectionPlane(e),n.setVisible(!1),this._controls[e.id]=n,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(function(){t._sectionPlaneDestroyed(e)}))}},{key:"flipSectionPlanes",value:function(){var e=this.viewer.scene.sectionPlanes;for(var t in e){e[t].flipDir()}}},{key:"showControl",value:function(e){var t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}},{key:"getShownControl",value:function(){return this._shownControlId}},{key:"hideControl",value:function(){for(var e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}},{key:"destroySectionPlane",value:function(e){var t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}},{key:"_sectionPlaneDestroyed",value:function(e){this._overview&&this._overview.removeSectionPlane(e);var t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}},{key:"clear",value:function(){for(var e=Object.keys(this._sectionPlanes),t=0,n=e.length;t<n;t++)this.destroySectionPlane(e[t])}},{key:"send",value:function(e,t){switch(e){case"snapshotStarting":for(var n in this._controls)this._controls.hasOwnProperty(n)&&this._controls[n].setCulled(!0);break;case"snapshotFinished":for(var r in this._controls)this._controls.hasOwnProperty(r)&&this._controls[r].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}},{key:"destroy",value:function(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),v(C(n.prototype),"destroy",this).call(this)}},{key:"_destroyFreeControls",value:function(){for(var e=this._freeControls.pop();e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}}]),n}(),dE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getSTL",value:function(e,t,n){e=this._cacheBusterURL(e);var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.responseType="arraybuffer",r.onreadystatechange=function(){4===r.readyState&&(200===r.status?t(r.response):n(r.statusText))},r.send(null)}}]),e}(),fE=De.vec3(),pE=function(){function e(){x(this,e)}return I(e,[{key:"load",value:function(e,t,n,r,i,s){r=r||{};var a=e.viewer.scene.canvas.spinner;a.processes++,e.dataSource.getSTL(n,(function(n){!function(e,t,n,r){try{var i=bE(n);vE(i)?gE(e,i,t,r):mE(e,_E(n),t,r)}catch(e){t.fire("error",e)}}(e,t,n,r);try{var o=bE(n);vE(o)?gE(e,o,t,r):mE(e,_E(n),t,r),a.processes--,tt.scheduleTask((function(){t.fire("loaded",!0,!1)})),i&&i()}catch(n){a.processes--,e.error(n),s&&s(n),t.fire("error",n)}}),(function(n){a.processes--,e.error(n),s&&s(n),t.fire("error",n)}))}},{key:"parse",value:function(e,t,n,r){var i=e.viewer.scene.canvas.spinner;i.processes++;try{var s=bE(n);vE(s)?gE(e,s,t,r):mE(e,_E(n),t,r),i.processes--,tt.scheduleTask((function(){t.fire("loaded",!0,!1)}))}catch(e){i.processes--,t.fire("error",e)}}}]),e}();function vE(e){var t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;for(var n=[115,111,108,105,100],r=0;r<5;r++)if(n[r]!==t.getUint8(r,!1))return!0;return!1}function gE(e,t,n,r){for(var i,s,a,o,A,c,l,u=new DataView(t),h=u.getUint32(80,!0),d=!1,f=null,p=null,v=null,g=!1,m=0;m<70;m++)1129270351===u.getUint32(m,!1)&&82===u.getUint8(m+4)&&61===u.getUint8(m+5)&&(d=!0,o=[],A=u.getUint8(m+6)/255,c=u.getUint8(m+7)/255,l=u.getUint8(m+8)/255,u.getUint8(m+9));for(var y=new Ni(n,{roughness:.5}),_=[],b=[],w=r.splitMeshes,B=0;B<h;B++){var C=84+50*B,M=u.getFloat32(C,!0),k=u.getFloat32(C+4,!0),E=u.getFloat32(C+8,!0);if(d){var F=u.getUint16(C+48,!0);0==(32768&F)?(i=(31&F)/31,s=(F>>5&31)/31,a=(F>>10&31)/31):(i=A,s=c,a=l),(w&&i!==f||s!==p||a!==v)&&(null!==f&&(g=!0),f=i,p=s,v=a)}for(var x=1;x<=3;x++){var U=C+12*x;_.push(u.getFloat32(U,!0)),_.push(u.getFloat32(U+4,!0)),_.push(u.getFloat32(U+8,!0)),b.push(M,k,E),d&&o.push(i,s,a,1)}w&&g&&(yE(n,_,b,o,y,r),_=[],b=[],o=o?[]:null,g=!1)}_.length>0&&yE(n,_,b,o,y,r)}function mE(e,t,n,r){for(var i,s,a,o,A,c,l,u=/facet([\s\S]*?)endfacet/g,h=0,d=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,f=new RegExp("vertex"+d+d+d,"g"),p=new RegExp("normal"+d+d+d,"g"),v=[],g=[];null!==(o=u.exec(t));){for(A=0,c=0,l=o[0];null!==(o=p.exec(l));)i=parseFloat(o[1]),s=parseFloat(o[2]),a=parseFloat(o[3]),c++;for(;null!==(o=f.exec(l));)v.push(parseFloat(o[1]),parseFloat(o[2]),parseFloat(o[3])),g.push(i,s,a),A++;1!==c&&e.error("Error in normal of face "+h),3!==A&&e.error("Error in positions of face "+h),h++}yE(n,v,g,null,new Ni(n,{roughness:.5}),r)}function yE(e,t,n,r,i,s){for(var a=new Int32Array(t.length/3),o=0,A=a.length;o<A;o++)a[o]=o;n=n&&n.length>0?n:null,r=r&&r.length>0?r:null,s.smoothNormals&&De.faceToVertexNormals(t,n,s);var c=fE;Mn(t,t,c);var l=new Wt(e,{primitive:"triangles",positions:t,normals:n,colors:r,indices:a}),u=new vi(e,{origin:0!==c[0]||0!==c[1]||0!==c[2]?c:null,geometry:l,material:i,edges:s.edges});e.addChild(u)}function _E(e){return"string"!=typeof e?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);return decodeURIComponent(escape(t))}(new Uint8Array(e)):e}function bE(e){if("string"==typeof e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer||t}return e}var wE=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"STLLoader",e,i))._sceneGraphLoader=new pE,r.dataSource=i.dataSource,r}return I(n,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new dE}},{key:"load",value:function(e){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new bn(this.viewer.scene,je.apply(e,{isModel:!0})),n=e.src,r=e.stl;return n||r?(n?this._sceneGraphLoader.load(this,t,n,e):this._sceneGraphLoader.parse(this,t,r,e),t):(this.error("load() param expected: either 'src' or 'stl'"),t)}}]),n}(),BE=function(){function e(t){x(this,e),this._treeViewContainer=t}return I(e,[{key:"createRootNode",value:function(){return document.createElement("ul")}},{key:"createNodeElement",value:function(e,t,n,r,i){var s=document.createElement("li");if(s.id=e.nodeId,e.xrayed&&s.classList.add("xrayed-node"),e.children.length>0){var a=document.createElement("a");a.href="#",a.id="switch-".concat(e.nodeId),a.textContent="+",a.classList.add("plus"),t&&a.addEventListener("click",t),s.appendChild(a)}var o=document.createElement("input");o.id="checkbox-".concat(e.nodeId),o.type="checkbox",o.checked=e.checked,o.style["pointer-events"]="all",n&&o.addEventListener("change",n),s.appendChild(o);var A=document.createElement("span");return A.textContent=e.title,s.appendChild(A),r&&YC(A,r),i&&(A.onclick=i),s}},{key:"createDisabledNodeElement",value:function(e){var t=document.createElement("li"),n=document.createElement("a");n.href="#",n.textContent="!",n.classList.add("warn"),n.classList.add("warning"),t.appendChild(n);var r=document.createElement("span");return r.textContent=e,t.appendChild(r),t}},{key:"addChildren",value:function(e,t){var n=document.createElement("ul");t.forEach((function(e){n.appendChild(e)})),e.parentElement.appendChild(n)}},{key:"expand",value:function(e,t,n){e.classList.remove("plus"),e.classList.add("minus"),e.textContent="-",e.removeEventListener("click",t),e.addEventListener("click",n)}},{key:"collapse",value:function(e,t,n){if(e){var r=e.parentElement;if(r){var i=r.querySelector("ul");i&&(r.removeChild(i),e.classList.remove("minus"),e.classList.add("plus"),e.textContent="+",e.removeEventListener("click",n),e.addEventListener("click",t))}}}},{key:"isExpanded",value:function(e){return void 0!==e.parentElement.getElementsByTagName("li")[0]}},{key:"getId",value:function(e){return e.parentElement.id}},{key:"getIdFromCheckbox",value:function(e){return e.id.replace("checkbox-","")}},{key:"getSwitchElement",value:function(e){return this._treeViewContainer.querySelector('[id="switch-'.concat(e,'"]'))}},{key:"isChecked",value:function(e){return e.checked}},{key:"setCheckbox",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this._treeViewContainer.querySelector('[id="checkbox-'.concat(e,'"]'));r&&(t!==r.checked&&(r.checked=t),n!==r.indeterminate&&(r.indeterminate=n,n&&(r.checked=!1)))}},{key:"setXRayed",value:function(e,t){var n=this._treeViewContainer.querySelector('[id="'.concat(e,'"]'));n&&(t?n.classList.add("xrayed-node"):n.classList.remove("xrayed-node"))}},{key:"setHighlighted",value:function(e,t){var n=this._treeViewContainer.querySelector('[id="'.concat(e,'"]'));n&&(t?(n.scrollIntoView({block:"center"}),n.classList.add("highlighted-node")):n.classList.remove("highlighted-node"))}}]),e}(),CE=[],ME=function(e){m(n,uA);var t=_(n);function n(e){var r,i,s,a,o,A=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n),(o=t.call(this,"TreeViewPlugin",e)).errors=[],o.valid=!0;var c=A.containerElement||document.getElementById(A.containerElementId);if(!(c instanceof HTMLElement))return o.error("Mandatory config expected: valid containerElementId or containerElement"),b(o);for(var l=0;;l++)if(!CE[l]){CE[l]=w(o),o._index=l,o._id="tree-".concat(l);break}if(o._containerElement=c,o._metaModels={},o._autoAddModels=!1!==A.autoAddModels,o._autoExpandDepth=A.autoExpandDepth||0,o._sortNodes=!1!==A.sortNodes,o._viewer=e,o._rootElement=null,o._muteSceneEvents=!1,o._muteTreeEvents=!1,o._rootNodes=[],o._objectNodes={},o._nodeNodes={},o._rootNames={},o._sortNodes=A.sortNodes,o._pruneEmptyNodes=A.pruneEmptyNodes,o._showListItemElementId=null,o._renderService=A.renderService||new BE(o._containerElement),o._showIndeterminate=null!==(r=A.showIndeterminate)&&void 0!==r&&r,o._showProjectNode=null!==(i=A.showProjectNode)&&void 0!==i&&i,o._elevationSortFunction=null!==(s=A.elevationSortFunction)&&void 0!==s?s:void 0,o._defaultSortFunction=null!==(a=A.defaultSortFunction)&&void 0!==a?a:void 0,!o._renderService)throw new Error("TreeViewPlugin: no render service set");if(o._containerElement.oncontextmenu=function(e){e.preventDefault()},o._onObjectVisibility=o._viewer.scene.on("objectVisibility",(function(e){if(!o._muteSceneEvents){var t=e.id,n=o._objectNodes[t];if(n){var r=e.visible;if(r!==n.checked){o._muteTreeEvents=!0,n.checked=r,r?n.numVisibleEntities++:n.numVisibleEntities--,o._renderService.setCheckbox(n.nodeId,r);for(var i=n.parent;i;){i.checked=r,r?i.numVisibleEntities++:i.numVisibleEntities--;var s=o._showIndeterminate&&i.numVisibleEntities>0&&i.numVisibleEntities<i.numEntities;i.checked=i.numVisibleEntities>0,o._renderService.setCheckbox(i.nodeId,i.checked,s),i=i.parent}o._muteTreeEvents=!1}}}})),o._onObjectXrayed=o._viewer.scene.on("objectXRayed",(function(e){if(!o._muteSceneEvents){var t=e.id,n=o._objectNodes[t];if(n){o._muteTreeEvents=!0;var r=e.xrayed;r!==n.xrayed&&(n.xrayed=r,o._renderService.setXRayed(n.nodeId,r),o._muteTreeEvents=!1)}}})),o._switchExpandHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;o._expandSwitchElement(t)},o._switchCollapseHandler=function(e){e.preventDefault(),e.stopPropagation();var t=e.target;o._collapseSwitchElement(t)},o._checkboxChangeHandler=function(e){if(!o._muteTreeEvents){o._muteSceneEvents=!0;var t=e.target,n=o._renderService.isChecked(t),r=o._renderService.getIdFromCheckbox(t),i=o._nodeNodes[r],s=o._viewer.scene.objects,a=0;o._withNodeTree(i,(function(e){var t=e.objectId,r=s[t],i=0===e.children.length;e.numVisibleEntities=n?e.numEntities:0,i&&n!==e.checked&&a++,e.checked=n,o._renderService.setCheckbox(e.nodeId,n),r&&(r.visible=n)}));for(var A=i.parent;A;){n?A.numVisibleEntities+=a:A.numVisibleEntities-=a;var c=o._showIndeterminate&&A.numVisibleEntities>0&&A.numVisibleEntities<A.numEntities;A.checked=A.numVisibleEntities>0,o._renderService.setCheckbox(A.nodeId,A.checked,c),A=A.parent}o._muteSceneEvents=!1}},o._hierarchy=A.hierarchy||"containment",o._autoExpandDepth=A.autoExpandDepth||0,o._autoAddModels){for(var u=Object.keys(o.viewer.metaScene.metaModels),h=0,d=u.length;h<d;h++){var f=u[h],p=o.viewer.metaScene.metaModels[f];p.finalized&&o.addModel(f)}o.viewer.scene.on("modelLoaded",(function(e){o.viewer.metaScene.metaModels[e]&&o.addModel(e)}))}return o.hierarchy=A.hierarchy,o}return I(n,[{key:"hierarchy",get:function(){return this._hierarchy},set:function(e){"containment"!==(e=e||"containment")&&"storeys"!==e&&"types"!==e&&(this.error("Unsupported value for `hierarchy' - defaulting to 'containment'"),e="containment"),this._hierarchy!==e&&(this._hierarchy=e,this._createNodes())}},{key:"addModel",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._containerElement){var r=this.viewer.scene.models[e];if(!r)throw"Model not found: "+e;var i=this.viewer.metaScene.metaModels[e];i?this._metaModels[e]?this.warn("Model already added: "+e):(this._metaModels[e]=i,n&&n.rootName&&(this._rootNames[e]=n.rootName),r.on("destroyed",(function(){t.removeModel(r.id)})),this._createNodes()):this.error("MetaModel not found: "+e)}}},{key:"removeModel",value:function(e){this._containerElement&&(this._metaModels[e]&&(this._rootNames[e]&&delete this._rootNames[e],delete this._metaModels[e],this._createNodes()))}},{key:"showNode",value:function(e){this.unShowNode();var t=this._objectNodes[e];if(t){this.collapse();var n=t.nodeId,r=this._renderService.getSwitchElement(n);if(r)return this._expandSwitchElement(r),r.scrollIntoView(),!0;var i=[];i.unshift(t);for(var s=t.parent;s;)i.unshift(s),s=s.parent;for(var a=0,o=i.length;a<o;a++){var A=this._renderService.getSwitchElement(i[a].nodeId);A&&this._expandSwitchElement(A)}this._renderService.setHighlighted(n,!0),this._showListItemElementId=n}}},{key:"unShowNode",value:function(){this._showListItemElementId&&(this._renderService.setHighlighted(this._showListItemElementId,!1),this._showListItemElementId=null)}},{key:"expandToDepth",value:function(e){var t=this;this.collapse();for(var n=function n(r,i){if(i!==e){var s=t._renderService.getSwitchElement(r.nodeId);if(s){t._expandSwitchElement(s);for(var a=r.children,o=0,A=a.length;o<A;o++){n(a[o],i+1)}}}},r=0,i=this._rootNodes.length;r<i;r++){n(this._rootNodes[r],0)}}},{key:"collapse",value:function(){for(var e=0,t=this._rootNodes.length;e<t;e++){var n=this._rootNodes[e].nodeId;this._collapseNode(n)}}},{key:"withNodeTree",value:function(e,t){t(e);var n=e.children;if(n)for(var r=0,i=n.length;r<i;r++)this.withNodeTree(n[r],t)}},{key:"destroy",value:function(){this._containerElement&&(this._metaModels={},this._rootElement&&!this._destroyed&&(this._rootElement.parentNode.removeChild(this._rootElement),this._viewer.scene.off(this._onObjectVisibility),this._destroyed=!0),delete CE[this._index],v(C(n.prototype),"destroy",this).call(this))}},{key:"_createNodes",value:function(){this._rootElement&&(this._rootElement.parentNode.removeChild(this._rootElement),this._rootElement=null),this._rootNodes=[],this._objectNodes={},this._nodeNodes={},this._validate(),this.valid||"storeys"!==this._hierarchy?this._createEnabledNodes():this._createDisabledNodes()}},{key:"_validate",value:function(){if(this.errors=[],"storeys"===this._hierarchy)this.valid=this._validateMetaModelForStoreysHierarchy();else this.valid=this._rootNodes.length>0;return this.valid}},{key:"_validateMetaModelForStoreysHierarchy",value:function(){return!0}},{key:"_createEnabledNodes",value:function(){switch(this._pruneEmptyNodes&&this._findEmptyNodes(),this._hierarchy){case"storeys":this._createStoreysNodes(),0===this._rootNodes.length&&this.error("Failed to build storeys hierarchy");break;case"types":this._createTypesNodes();break;default:this._createContainmentNodes()}this._sortNodes&&this._doSortNodes(),this._synchNodesToEntities(),this._createTrees(),this.expandToDepth(this._autoExpandDepth)}},{key:"_createDisabledNodes",value:function(){var e=this._renderService.createRootNode();this._rootElement=e,this._containerElement.appendChild(e);var t=this._viewer.metaScene.rootMetaObjects;for(var n in t){var r=t[n],i=r.type,s=r.name,a=s&&""!==s&&"Undefined"!==s&&"Default"!==s?s:i,o=this._renderService.createDisabledNodeElement(a);e.appendChild(o)}}},{key:"_findEmptyNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._findEmptyNodes2(e[t])}},{key:"_findEmptyNodes2",value:function(e){var t=this.viewer,n=t.scene,r=e.children,i=e.id,s=n.objects[i];if(e._countEntities=0,s&&e._countEntities++,r)for(var a=0,o=r.length;a<o;a++){var A=r[a];A._countEntities=this._findEmptyNodes2(A),e._countEntities+=A._countEntities}return e._countEntities}},{key:"_createStoreysNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._createStoreysNodes2(e[t],null,null,null,null)}},{key:"_createStoreysNodes2",value:function(e,t,n,r,i){if(!this._pruneEmptyNodes||0!==e._countEntities){var s=e.type,a=e.name,o=e.children,A=e.id;if(this._showProjectNode&&"IfcProject"===s)t={nodeId:"".concat(this._id,"-").concat(A),objectId:A,title:0===e.metaModels.length?a:this._rootNames[e.metaModels[0].id]||(a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:s),type:s,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t;else if("IfcBuilding"===s)n={nodeId:"".concat(this._id,"-").concat(A),objectId:A,title:0===e.metaModels.length?a:this._rootNames[e.metaModels[0].id]||(a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:s),type:s,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t?t.children.push(n):this._rootNodes.push(n),this._objectNodes[n.objectId]=n,this._nodeNodes[n.nodeId]=n;else if("IfcBuildingStorey"===s){if(!n)return void this.error("Failed to build storeys hierarchy for model - model does not have an IfcBuilding object, or is not an IFC model");r={nodeId:"".concat(this._id,"-").concat(A),objectId:A,title:a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:s,type:s,parent:n,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},n.children.push(r),this._objectNodes[r.objectId]=r,this._nodeNodes[r.nodeId]=r,i={}}else{if(r)if(this._viewer.scene.objects[A]){var c=(i=i||{})[s];c||(c={nodeId:"".concat(this._id,"-").concat(r.objectId,"-").concat(s),objectId:"".concat(r.objectId,"-").concat(s),title:s,type:s,parent:r,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},r.children.push(c),this._objectNodes[c.objectId]=c,this._nodeNodes[c.nodeId]=c,i[s]=c);var l={nodeId:"".concat(this._id,"-").concat(A),objectId:A,title:a&&""!==a&&"Undefined"!==a&&"Default"!==a?a:s,type:s,parent:c,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};c.children.push(l),this._objectNodes[l.objectId]=l,this._nodeNodes[l.nodeId]=l}}if(o)for(var u=0,h=o.length;u<h;u++){var d=o[u];this._createStoreysNodes2(d,t,n,r,i)}}}},{key:"_createTypesNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._createTypesNodes2(e[t],null,null)}},{key:"_createTypesNodes2",value:function(e,t,n){if(!this._pruneEmptyNodes||0!==e._countEntities){var r=e.type,i=e.name,s=e.children,a=e.id;if(e.parent){if(t)if(this._viewer.scene.objects[a]){var o=n[r];o||(o={nodeId:"".concat(this._id,"-").concat(t.objectId,"-").concat(r),objectId:"".concat(t.objectId,"-").concat(r),title:r,type:r,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t.children.push(o),this._objectNodes[o.objectId]=o,this._nodeNodes[o.nodeId]=o,n[r]=o);var A={nodeId:"".concat(this._id,"-").concat(a),objectId:a,title:i&&""!==i&&"Default"!==i?i:r,type:r,parent:o,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};o.children.push(A),this._objectNodes[A.objectId]=A,this._nodeNodes[A.nodeId]=A}}else t={nodeId:"".concat(this._id,"-").concat(a),objectId:a,title:0===e.metaModels.length?i:this._rootNames[e.metaModels[0].id]||(i&&""!==i&&"Undefined"!==i&&"Default"!==i?i:r),type:r,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t,n={};if(s)for(var c=0,l=s.length;c<l;c++){var u=s[c];this._createTypesNodes2(u,t,n)}}}},{key:"_createContainmentNodes",value:function(){var e=this._viewer.metaScene.rootMetaObjects;for(var t in e)this._createContainmentNodes2(e[t],null)}},{key:"_createContainmentNodes2",value:function(e,t){if(!this._pruneEmptyNodes||0!==e._countEntities){var n=e.type,r=e.name||n,i=e.children,s=e.id,a={nodeId:"".concat(this._id,"-").concat(s),objectId:s,title:t?r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:n:0===e.metaModels.length?r:this._rootNames[e.metaModels[0].id]||r,type:n,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};if(t?t.children.push(a):this._rootNodes.push(a),this._objectNodes[a.objectId]=a,this._nodeNodes[a.nodeId]=a,i)for(var o=0,A=i.length;o<A;o++){var c=i[o];this._createContainmentNodes2(c,a)}}}},{key:"_doSortNodes",value:function(){for(var e=0,t=this._rootNodes.length;e<t;e++){var n=this._rootNodes[e];this._sortChildren(n)}}},{key:"_sortChildren",value:function(e){var t=e.children;if(t&&0!==t.length){var n=t[0];"storeys"!==this._hierarchy&&"containment"!==this._hierarchy||"IfcBuildingStorey"!==n.type?this._defaultSortFunction?t.sort(this._defaultSortFunction):t.sort(this._alphaSortFunc):this._elevationSortFunction?t.sort(this._elevationSortFunction):t.sort(this._getSpatialSortFunc());for(var r=0,i=t.length;r<i;r++){var s=t[r];this._sortChildren(s)}}}},{key:"_getSpatialSortFunc",value:function(){var e=this,t=this.viewer.scene.camera;return this._spatialSortFunc||(this._spatialSortFunc=function(n,r){t.xUp||t.yUp;var i=e.viewer.metaScene,s=i.metaObjects[n.objectId],a=i.metaObjects[r.objectId];if(s&&s.attributes&&void 0!==s.attributes.elevation&&a&&a.attributes&&void 0!==a.attributes.elevation){var o=Number.parseFloat(s.attributes.elevation),A=Number.parseFloat(a.attributes.elevation);return o>A?-1:o<A?1:0}return 0})}},{key:"_alphaSortFunc",value:function(e,t){var n=e.title.toUpperCase(),r=t.title.toUpperCase();return n<r?-1:n>r?1:0}},{key:"_synchNodesToEntities",value:function(){for(var e=Object.keys(this.viewer.metaScene.metaObjects),t=this._viewer.metaScene.metaObjects,n=this._viewer.scene.objects,r=0,i=e.length;r<i;r++){var s=e[r];if(t[s]){var a=this._objectNodes[s];if(a){var o=n[s];if(o){var A=o.visible;a.numEntities=1,a.xrayed=o.xrayed,A?(a.numVisibleEntities=1,a.checked=!0):(a.numVisibleEntities=0,a.checked=!1);for(var c=a.parent;c;)c.numEntities++,A&&(c.numVisibleEntities++,c.checked=!0),c=c.parent}}}}}},{key:"_withNodeTree",value:function(e,t){t(e);var n=e.children;if(n)for(var r=0,i=n.length;r<i;r++)this._withNodeTree(n[r],t)}},{key:"_createTrees",value:function(){var e=this;if(0!==this._rootNodes.length){var t=this._rootNodes.map((function(t){return e._createNodeElement(t)})),n=this._renderService.createRootNode();t.forEach((function(e){n.appendChild(e)})),this._containerElement.appendChild(n),this._rootElement=n}}},{key:"_createNodeElement",value:function(e){var t=this;return this._renderService.createNodeElement(e,this._switchExpandHandler,this._checkboxChangeHandler,(function(n){t.fire("contextmenu",{event:n,viewer:t._viewer,treeViewPlugin:t,treeViewNode:e}),n.preventDefault()}),(function(n){t.fire("nodeTitleClicked",{event:n,viewer:t._viewer,treeViewPlugin:t,treeViewNode:e}),n.preventDefault()}))}},{key:"_expandSwitchElement",value:function(e){var t=this;if(!this._renderService.isExpanded(e)){var n=this._renderService.getId(e),r=this._nodeNodes[n].children.map((function(e){return t._createNodeElement(e)}));this._renderService.addChildren(e,r),this._renderService.expand(e,this._switchExpandHandler,this._switchCollapseHandler)}}},{key:"_collapseNode",value:function(e){var t=this._renderService.getSwitchElement(e);this._collapseSwitchElement(t)}},{key:"_collapseSwitchElement",value:function(e){this._renderService.collapse(e,this._switchExpandHandler,this._switchCollapseHandler)}}]),n}(),kE=function(){function e(t){var n=this;x(this,e),this._scene=t,this._objects=[],this._objectsViewCulled=[],this._objectsDetailCulled=[],this._objectsChanged=[],this._objectsChangedList=[],this._modelInfos={},this._numObjects=0,this._lenObjectsChangedList=0,this._dirty=!0,this._onModelLoaded=t.on("modelLoaded",(function(e){var r=t.models[e];r&&n._addModel(r)})),this._onTick=t.on("tick",(function(){n._dirty&&n._build(),n._applyChanges()}))}return I(e,[{key:"_addModel",value:function(e){var t=this,n={model:e,onDestroyed:e.on("destroyed",(function(){t._removeModel(e)}))};this._modelInfos[e.id]=n,this._dirty=!0}},{key:"_removeModel",value:function(e){var t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._dirty=!0)}},{key:"_build",value:function(){if(this._dirty){this._applyChanges();for(var e=this._scene.objects,t=0;t<this._numObjects;t++)this._objects[t]=null;for(var n in this._numObjects=0,e){var r=e[n];this._objects[this._numObjects++]=r}this._lenObjectsChangedList=0,this._dirty=!1}}},{key:"_applyChanges",value:function(){if(this._lenObjectsChangedList>0){for(var e=0;e<this._lenObjectsChangedList;e++){var t=this._objectsChangedList[e],n=this._objects[t],r=this._objectsViewCulled[t],i=this._objectsDetailCulled[t],s=r||i;n.culled=s,this._objectsChanged[t]=!1}this._lenObjectsChangedList=0}}},{key:"objects",get:function(){return this._dirty&&this._build(),this._objects}},{key:"numObjects",get:function(){return this._dirty&&this._build(),this._numObjects}},{key:"setObjectViewCulled",value:function(e,t){this._dirty&&this._build(),this._objectsViewCulled[e]!==t&&(this._objectsViewCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}},{key:"setObjectDetailCulled",value:function(e,t){this._dirty&&this._build(),this._objectsDetailCulled[e]!==t&&(this._objectsDetailCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}},{key:"_destroy",value:function(){this._clear(),this._scene.off(this._onModelLoaded),this._scene.off(this._onTick)}},{key:"_clear",value:function(){for(var e in this._modelInfos){var t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._dirty=!0}}]),e}(),EE={};function FE(e){var t=e.id,n=EE[t];return n||(n=new kE(e),EE[t]=n,e.on("destroyed",(function(){delete EE[t],n._destroy()}))),n}var xE=new Float32Array(3),UE=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"ViewCull",e))._objectCullStates=FE(e.scene),r._maxTreeDepth=i.maxTreeDepth||8,r._modelInfos={},r._frustum=new ct,r._kdRoot=null,r._frustumDirty=!1,r._kdTreeDirty=!1,r._onViewMatrix=e.scene.camera.on("viewMatrix",(function(){r._frustumDirty=!0})),r._onProjMatrix=e.scene.camera.on("projMatMatrix",(function(){r._frustumDirty=!0})),r._onModelLoaded=e.scene.on("modelLoaded",(function(e){var t=r.viewer.scene.models[e];t&&r._addModel(t)})),r._onSceneTick=e.scene.on("tick",(function(){r._doCull()})),r}return I(n,[{key:"enabled",get:function(){return this._enabled},set:function(e){this._enabled=e}},{key:"_addModel",value:function(e){var t=this,n={model:e,onDestroyed:e.on("destroyed",(function(){t._removeModel(e)}))};this._modelInfos[e.id]=n,this._kdTreeDirty=!0}},{key:"_removeModel",value:function(e){var t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._kdTreeDirty=!0)}},{key:"_doCull",value:function(){var e=this._frustumDirty||this._kdTreeDirty;if(this._frustumDirty&&this._buildFrustum(),this._kdTreeDirty&&this._buildKDTree(),e){var t=this._kdRoot;t&&this._visitKDNode(t)}}},{key:"_buildFrustum",value:function(){var e=this.viewer.scene.camera;lt(this._frustum,e.viewMatrix,e.projMatrix),this._frustumDirty=!1}},{key:"_buildKDTree",value:function(){var e=this.viewer.scene;this._kdRoot,this._kdRoot={aabb:e.getAABB(),intersection:ct.INTERSECT};for(var t=0,n=this._objectCullStates.numObjects;t<n;t++){var r=this._objectCullStates.objects[t];this._insertEntityIntoKDTree(this._kdRoot,r,t,1)}this._kdTreeDirty=!1}},{key:"_insertEntityIntoKDTree",value:function(e,t,n,r){var i=t.aabb;if(r>=this._maxTreeDepth)return e.objects=e.objects||[],e.objects.push(n),void De.expandAABB3(e.aabb,i);if(e.left&&De.containsAABB3(e.left.aabb,i))this._insertEntityIntoKDTree(e.left,t,n,r+1);else if(e.right&&De.containsAABB3(e.right.aabb,i))this._insertEntityIntoKDTree(e.right,t,n,r+1);else{var s=e.aabb;xE[0]=s[3]-s[0],xE[1]=s[4]-s[1],xE[2]=s[5]-s[2];var a=0;if(xE[1]>xE[a]&&(a=1),xE[2]>xE[a]&&(a=2),!e.left){var o=s.slice();if(o[a+3]=(s[a]+s[a+3])/2,e.left={aabb:o,intersection:ct.INTERSECT},De.containsAABB3(o,i))return void this._insertEntityIntoKDTree(e.left,t,n,r+1)}if(!e.right){var A=s.slice();if(A[a]=(s[a]+s[a+3])/2,e.right={aabb:A,intersection:ct.INTERSECT},De.containsAABB3(A,i))return void this._insertEntityIntoKDTree(e.right,t,n,r+1)}e.objects=e.objects||[],e.objects.push(n),De.expandAABB3(e.aabb,i)}}},{key:"_visitKDNode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct.INTERSECT;if(t===ct.INTERSECT||e.intersects!==t){t===ct.INTERSECT&&(t=ut(this._frustum,e.aabb),e.intersects=t);var n=t===ct.OUTSIDE,r=e.objects;if(r&&r.length>0)for(var i=0,s=r.length;i<s;i++){var a=r[i];this._objectCullStates.setObjectViewCulled(a,n)}e.left&&this._visitKDNode(e.left,t),e.right&&this._visitKDNode(e.right,t)}}},{key:"send",value:function(e,t){}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this),this._clear();var e=this.viewer.scene,t=e.camera;e.off(this._onModelLoaded),e.off(this._onSceneTick),t.off(this._onViewMatrix),t.off(this._onProjMatrix)}},{key:"_clear",value:function(){for(var e in this._modelInfos){var t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._kdRoot=null,this._kdTreeDirty=!0}}]),n}(),IE=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getManifest",value:function(e,t,n){je.loadJSON(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}},{key:"getMetaModel",value:function(e,t,n){je.loadJSON(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}},{key:"getXKT",value:function(e,t,n){var r=function(){};t=t||r,n=n||r;var i=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var s=!!i[2],a=i[3];a=window.decodeURIComponent(a),s&&(a=window.atob(a));try{for(var o=new ArrayBuffer(a.length),A=new Uint8Array(o),c=0;c<a.length;c++)A[c]=a.charCodeAt(c);t(o)}catch(e){n(e)}}else{var l=new XMLHttpRequest;l.open("GET",this._cacheBusterURL(e),!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):n("getXKT error : "+l.response))},l.send(null)}}}]),e}();!function(e,t){"object"==("undefined"==typeof exports?"undefined":M(exports))&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(void 0,(function(e){function t(e){for(var t=e.length;--t>=0;)e[t]=0}var n=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),r=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),i=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),s=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=new Array(576);t(a);var o=new Array(60);t(o);var A=new Array(512);t(A);var c=new Array(256);t(c);var l=new Array(29);t(l);var u,h,d,f=new Array(30);function p(e,t,n,r,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=e&&e.length}function v(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(f);var g=function(e){return e<256?A[e]:A[256+(e>>>7)]},m=function(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},y=function(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,m(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},_=function(e,t,n){y(e,n[2*t],n[2*t+1])},b=function(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},w=function(e,t,n){var r,i,s=new Array(16),a=0;for(r=1;r<=15;r++)a=a+n[r-1]<<1,s[r]=a;for(i=0;i<=t;i++){var o=e[2*i+1];0!==o&&(e[2*i]=b(s[o]++,o))}},B=function(e){var t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},C=function(e){e.bi_valid>8?m(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},k=function(e,t,n,r){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&r[t]<=r[n]},E=function(e,t,n){for(var r=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&k(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!k(t,r,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=r},F=function(e,t,i){var s,a,o,A,u=0;if(0!==e.sym_next)do{s=255&e.pending_buf[e.sym_buf+u++],s+=(255&e.pending_buf[e.sym_buf+u++])<<8,a=e.pending_buf[e.sym_buf+u++],0===s?_(e,a,t):(o=c[a],_(e,o+256+1,t),0!==(A=n[o])&&(a-=l[o],y(e,a,A)),s--,o=g(s),_(e,o,i),0!==(A=r[o])&&(s-=f[o],y(e,s,A)))}while(u<e.sym_next);_(e,256,t)},x=function(e,t){var n,r,i,s=t.dyn_tree,a=t.stat_desc.static_tree,o=t.stat_desc.has_stree,A=t.stat_desc.elems,c=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<A;n++)0!==s[2*n]?(e.heap[++e.heap_len]=c=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=c<2?++c:0)]=1,e.depth[i]=0,e.opt_len--,o&&(e.static_len-=a[2*i+1]);for(t.max_code=c,n=e.heap_len>>1;n>=1;n--)E(e,s,n);i=A;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],E(e,s,1),r=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=r,s[2*i]=s[2*n]+s[2*r],e.depth[i]=(e.depth[n]>=e.depth[r]?e.depth[n]:e.depth[r])+1,s[2*n+1]=s[2*r+1]=i,e.heap[1]=i++,E(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,r,i,s,a,o,A=t.dyn_tree,c=t.max_code,l=t.stat_desc.static_tree,u=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,d=t.stat_desc.extra_base,f=t.stat_desc.max_length,p=0;for(s=0;s<=15;s++)e.bl_count[s]=0;for(A[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=A[2*A[2*(r=e.heap[n])+1]+1]+1)>f&&(s=f,p++),A[2*r+1]=s,r>c||(e.bl_count[s]++,a=0,r>=d&&(a=h[r-d]),o=A[2*r],e.opt_len+=o*(s+a),u&&(e.static_len+=o*(l[2*r+1]+a)));if(0!==p){do{for(s=f-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[f]--,p-=2}while(p>0);for(s=f;0!==s;s--)for(r=e.bl_count[s];0!==r;)(i=e.heap[--n])>c||(A[2*i+1]!==s&&(e.opt_len+=(s-A[2*i+1])*A[2*i],A[2*i+1]=s),r--)}}(e,t),w(s,c,e.bl_count)},U=function(e,t,n){var r,i,s=-1,a=t[1],o=0,A=7,c=4;for(0===a&&(A=138,c=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=t[2*(r+1)+1],++o<A&&i===a||(o<c?e.bl_tree[2*i]+=o:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,s=i,0===a?(A=138,c=3):i===a?(A=6,c=3):(A=7,c=4))},I=function(e,t,n){var r,i,s=-1,a=t[1],o=0,A=7,c=4;for(0===a&&(A=138,c=3),r=0;r<=n;r++)if(i=a,a=t[2*(r+1)+1],!(++o<A&&i===a)){if(o<c)do{_(e,i,e.bl_tree)}while(0!=--o);else 0!==i?(i!==s&&(_(e,i,e.bl_tree),o--),_(e,16,e.bl_tree),y(e,o-3,2)):o<=10?(_(e,17,e.bl_tree),y(e,o-3,3)):(_(e,18,e.bl_tree),y(e,o-11,7));o=0,s=i,0===a?(A=138,c=3):i===a?(A=6,c=3):(A=7,c=4)}},T=!1,P=function(e,t,n,r){y(e,0+(r?1:0),3),C(e),m(e,n),m(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},S=function(e){T||(function(){var e,t,s,v,g,m=new Array(16);for(s=0,v=0;v<28;v++)for(l[v]=s,e=0;e<1<<n[v];e++)c[s++]=v;for(c[s-1]=v,g=0,v=0;v<16;v++)for(f[v]=g,e=0;e<1<<r[v];e++)A[g++]=v;for(g>>=7;v<30;v++)for(f[v]=g<<7,e=0;e<1<<r[v]-7;e++)A[256+g++]=v;for(t=0;t<=15;t++)m[t]=0;for(e=0;e<=143;)a[2*e+1]=8,e++,m[8]++;for(;e<=255;)a[2*e+1]=9,e++,m[9]++;for(;e<=279;)a[2*e+1]=7,e++,m[7]++;for(;e<=287;)a[2*e+1]=8,e++,m[8]++;for(w(a,287,m),e=0;e<30;e++)o[2*e+1]=5,o[2*e]=b(e,5);u=new p(a,n,257,286,15),h=new p(o,r,0,30,15),d=new p(new Array(0),i,0,19,7)}(),T=!0),e.l_desc=new v(e.dyn_ltree,u),e.d_desc=new v(e.dyn_dtree,h),e.bl_desc=new v(e.bl_tree,d),e.bi_buf=0,e.bi_valid=0,B(e)},D=P,Q=function(e,t,n,r){var i,A,c=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),x(e,e.l_desc),x(e,e.d_desc),c=function(e){var t;for(U(e,e.dyn_ltree,e.l_desc.max_code),U(e,e.dyn_dtree,e.d_desc.max_code),x(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*s[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(A=e.static_len+3+7>>>3)<=i&&(i=A)):i=A=n+5,n+4<=i&&-1!==t?P(e,t,n,r):4===e.strategy||A===i?(y(e,2+(r?1:0),3),F(e,a,o)):(y(e,4+(r?1:0),3),function(e,t,n,r){var i;for(y(e,t-257,5),y(e,n-1,5),y(e,r-4,4),i=0;i<r;i++)y(e,e.bl_tree[2*s[i]+1],3);I(e,e.dyn_ltree,t-1),I(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,c+1),F(e,e.dyn_ltree,e.dyn_dtree)),B(e),r&&C(e)},R=function(e,t,n){return e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(c[n]+256+1)]++,e.dyn_dtree[2*g(t)]++),e.sym_next===e.sym_end},O=function(e){y(e,2,3),_(e,256,a),function(e){16===e.bi_valid?(m(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)},V=function(e,t,n,r){for(var i=65535&e|0,s=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{s=s+(i=i+t[r++]|0)|0}while(--a);i%=65521,s%=65521}return i|s<<16|0},L=new Uint32Array(function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}()),H=function(e,t,n,r){var i=L,s=r+n;e^=-1;for(var a=r;a<s;a++)e=e>>>8^i[255&(e^t[a])];return-1^e},N={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},G={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},j=S,W=D,z=Q,X=R,K=O,Z=G.Z_NO_FLUSH,J=G.Z_PARTIAL_FLUSH,Y=G.Z_FULL_FLUSH,q=G.Z_FINISH,$=G.Z_BLOCK,ee=G.Z_OK,te=G.Z_STREAM_END,ne=G.Z_STREAM_ERROR,re=G.Z_DATA_ERROR,ie=G.Z_BUF_ERROR,se=G.Z_DEFAULT_COMPRESSION,ae=G.Z_FILTERED,oe=G.Z_HUFFMAN_ONLY,Ae=G.Z_RLE,ce=G.Z_FIXED,le=G.Z_UNKNOWN,ue=G.Z_DEFLATED,he=258,de=262,fe=42,pe=113,ve=666,ge=function(e,t){return e.msg=N[t],t},me=function(e){return 2*e-(e>4?9:0)},ye=function(e){for(var t=e.length;--t>=0;)e[t]=0},_e=function(e){var t,n,r,i=e.w_size;r=t=e.hash_size;do{n=e.head[--r],e.head[r]=n>=i?n-i:0}while(--t);r=t=i;do{n=e.prev[--r],e.prev[r]=n>=i?n-i:0}while(--t)},be=function(e,t,n){return(t<<e.hash_shift^n)&e.hash_mask},we=function(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},Be=function(e,t){z(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,we(e.strm)},Ce=function(e,t){e.pending_buf[e.pending++]=t},Me=function(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ke=function(e,t,n,r){var i=e.avail_in;return i>r&&(i=r),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),n),1===e.state.wrap?e.adler=V(e.adler,t,i,n):2===e.state.wrap&&(e.adler=H(e.adler,t,i,n)),e.next_in+=i,e.total_in+=i,i)},Ee=function(e,t){var n,r,i=e.max_chain_length,s=e.strstart,a=e.prev_length,o=e.nice_match,A=e.strstart>e.w_size-de?e.strstart-(e.w_size-de):0,c=e.window,l=e.w_mask,u=e.prev,h=e.strstart+he,d=c[s+a-1],f=c[s+a];e.prev_length>=e.good_match&&(i>>=2),o>e.lookahead&&(o=e.lookahead);do{if(c[(n=t)+a]===f&&c[n+a-1]===d&&c[n]===c[s]&&c[++n]===c[s+1]){s+=2,n++;do{}while(c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&c[++s]===c[++n]&&s<h);if(r=he-(h-s),s=h-he,r>a){if(e.match_start=t,a=r,r>=o)break;d=c[s+a-1],f=c[s+a]}}}while((t=u[t&l])>A&&0!=--i);return a<=e.lookahead?a:e.lookahead},Fe=function(e){var t,n,r,i=e.w_size;do{if(n=e.window_size-e.lookahead-e.strstart,e.strstart>=i+(i-de)&&(e.window.set(e.window.subarray(i,i+i-n),0),e.match_start-=i,e.strstart-=i,e.block_start-=i,e.insert>e.strstart&&(e.insert=e.strstart),_e(e),n+=i),0===e.strm.avail_in)break;if(t=ke(e.strm,e.window,e.strstart+e.lookahead,n),e.lookahead+=t,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=be(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=be(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<de&&0!==e.strm.avail_in)},xe=function(e,t){var n,r,i,s=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,a=0,o=e.strm.avail_in;do{if(n=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,n>(r=e.strstart-e.block_start)+e.strm.avail_in&&(n=r+e.strm.avail_in),n>i&&(n=i),n<s&&(0===n&&t!==q||t===Z||n!==r+e.strm.avail_in))break;a=t===q&&n===r+e.strm.avail_in?1:0,W(e,0,0,a),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,we(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(ke(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===a);return(o-=e.strm.avail_in)&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),a?4:t!==Z&&t!==q&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(ke(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,s=(i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i)>e.w_size?e.w_size:i,((r=e.strstart-e.block_start)>=s||(r||t===q)&&t!==Z&&0===e.strm.avail_in&&r<=i)&&(n=r>i?i:r,a=t===q&&0===e.strm.avail_in&&n===r?1:0,W(e,e.block_start,n,a),e.block_start+=n,we(e.strm)),a?3:1)},Ue=function(e,t){for(var n,r;;){if(e.lookahead<de){if(Fe(e),e.lookahead<de&&t===Z)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-de&&(e.match_length=Ee(e,n)),e.match_length>=3)if(r=X(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=be(e,e.ins_h,e.window[e.strstart+1]);else r=X(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(Be(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===q?(Be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Be(e,!1),0===e.strm.avail_out)?1:2},Ie=function(e,t){for(var n,r,i;;){if(e.lookahead<de){if(Fe(e),e.lookahead<de&&t===Z)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-de&&(e.match_length=Ee(e,n),e.match_length<=5&&(e.strategy===ae||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,r=X(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=be(e,e.ins_h,e.window[e.strstart+3-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,r&&(Be(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((r=X(e,0,e.window[e.strstart-1]))&&Be(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=X(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===q?(Be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Be(e,!1),0===e.strm.avail_out)?1:2};function Te(e,t,n,r,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=i}var Pe=[new Te(0,0,0,0,xe),new Te(4,4,8,4,Ue),new Te(4,5,16,8,Ue),new Te(4,6,32,32,Ue),new Te(4,4,16,16,Ie),new Te(8,16,32,32,Ie),new Te(8,16,128,128,Ie),new Te(8,32,128,256,Ie),new Te(32,128,258,1024,Ie),new Te(32,258,258,4096,Ie)];function Se(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=ue,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),ye(this.dyn_ltree),ye(this.dyn_dtree),ye(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),ye(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),ye(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var De=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.status!==fe&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==pe&&t.status!==ve?1:0},Qe=function(e){if(De(e))return ge(e,ne);e.total_in=e.total_out=0,e.data_type=le;var t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?fe:pe,e.adler=2===t.wrap?0:1,t.last_flush=-2,j(t),ee},Re=function(e){var t,n=Qe(e);return n===ee&&((t=e.state).window_size=2*t.w_size,ye(t.head),t.max_lazy_match=Pe[t.level].max_lazy,t.good_match=Pe[t.level].good_length,t.nice_match=Pe[t.level].nice_length,t.max_chain_length=Pe[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),n},Oe=function(e,t,n,r,i,s){if(!e)return ne;var a=1;if(t===se&&(t=6),r<0?(a=0,r=-r):r>15&&(a=2,r-=16),i<1||i>9||n!==ue||r<8||r>15||t<0||t>9||s<0||s>ce||8===r&&1!==a)return ge(e,ne);8===r&&(r=9);var o=new Se;return e.state=o,o.strm=e,o.status=fe,o.wrap=a,o.gzhead=null,o.w_bits=r,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=i+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<i+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=s,o.method=n,Re(e)},Ve=Oe,Le=function(e,t){return De(e)||2!==e.state.wrap?ne:(e.state.gzhead=t,ee)},He=function(e,t){if(De(e)||t>$||t<0)return e?ge(e,ne):ne;var n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===ve&&t!==q)return ge(e,0===e.avail_out?ie:ne);var r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(we(e),0===e.avail_out)return n.last_flush=-1,ee}else if(0===e.avail_in&&me(t)<=me(r)&&t!==q)return ge(e,ie);if(n.status===ve&&0!==e.avail_in)return ge(e,ie);if(n.status===fe&&0===n.wrap&&(n.status=pe),n.status===fe){var i=ue+(n.w_bits-8<<4)<<8;if(i|=(n.strategy>=oe||n.level<2?0:n.level<6?1:6===n.level?2:3)<<6,0!==n.strstart&&(i|=32),Me(n,i+=31-i%31),0!==n.strstart&&(Me(n,e.adler>>>16),Me(n,65535&e.adler)),e.adler=1,n.status=pe,we(e),0!==n.pending)return n.last_flush=-1,ee}if(57===n.status)if(e.adler=0,Ce(n,31),Ce(n,139),Ce(n,8),n.gzhead)Ce(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),Ce(n,255&n.gzhead.time),Ce(n,n.gzhead.time>>8&255),Ce(n,n.gzhead.time>>16&255),Ce(n,n.gzhead.time>>24&255),Ce(n,9===n.level?2:n.strategy>=oe||n.level<2?4:0),Ce(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(Ce(n,255&n.gzhead.extra.length),Ce(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=H(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=69;else if(Ce(n,0),Ce(n,0),Ce(n,0),Ce(n,0),Ce(n,0),Ce(n,9===n.level?2:n.strategy>=oe||n.level<2?4:0),Ce(n,3),n.status=pe,we(e),0!==n.pending)return n.last_flush=-1,ee;if(69===n.status){if(n.gzhead.extra){for(var s=n.pending,a=(65535&n.gzhead.extra.length)-n.gzindex;n.pending+a>n.pending_buf_size;){var o=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+o),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>s&&(e.adler=H(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex+=o,we(e),0!==n.pending)return n.last_flush=-1,ee;s=0,a-=o}var A=new Uint8Array(n.gzhead.extra);n.pending_buf.set(A.subarray(n.gzindex,n.gzindex+a),n.pending),n.pending+=a,n.gzhead.hcrc&&n.pending>s&&(e.adler=H(e.adler,n.pending_buf,n.pending-s,s)),n.gzindex=0}n.status=73}if(73===n.status){if(n.gzhead.name){var c,l=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>l&&(e.adler=H(e.adler,n.pending_buf,n.pending-l,l)),we(e),0!==n.pending)return n.last_flush=-1,ee;l=0}c=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,Ce(n,c)}while(0!==c);n.gzhead.hcrc&&n.pending>l&&(e.adler=H(e.adler,n.pending_buf,n.pending-l,l)),n.gzindex=0}n.status=91}if(91===n.status){if(n.gzhead.comment){var u,h=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>h&&(e.adler=H(e.adler,n.pending_buf,n.pending-h,h)),we(e),0!==n.pending)return n.last_flush=-1,ee;h=0}u=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,Ce(n,u)}while(0!==u);n.gzhead.hcrc&&n.pending>h&&(e.adler=H(e.adler,n.pending_buf,n.pending-h,h))}n.status=103}if(103===n.status){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(we(e),0!==n.pending))return n.last_flush=-1,ee;Ce(n,255&e.adler),Ce(n,e.adler>>8&255),e.adler=0}if(n.status=pe,we(e),0!==n.pending)return n.last_flush=-1,ee}if(0!==e.avail_in||0!==n.lookahead||t!==Z&&n.status!==ve){var d=0===n.level?xe(n,t):n.strategy===oe?function(e,t){for(var n;;){if(0===e.lookahead&&(Fe(e),0===e.lookahead)){if(t===Z)return 1;break}if(e.match_length=0,n=X(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===q?(Be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Be(e,!1),0===e.strm.avail_out)?1:2}(n,t):n.strategy===Ae?function(e,t){for(var n,r,i,s,a=e.window;;){if(e.lookahead<=he){if(Fe(e),e.lookahead<=he&&t===Z)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&((r=a[i=e.strstart-1])===a[++i]&&r===a[++i]&&r===a[++i])){s=e.strstart+he;do{}while(r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&r===a[++i]&&i<s);e.match_length=he-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=X(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=X(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===q?(Be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(Be(e,!1),0===e.strm.avail_out)?1:2}(n,t):Pe[n.level].func(n,t);if(3!==d&&4!==d||(n.status=ve),1===d||3===d)return 0===e.avail_out&&(n.last_flush=-1),ee;if(2===d&&(t===J?K(n):t!==$&&(W(n,0,0,!1),t===Y&&(ye(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),we(e),0===e.avail_out))return n.last_flush=-1,ee}return t!==q?ee:n.wrap<=0?te:(2===n.wrap?(Ce(n,255&e.adler),Ce(n,e.adler>>8&255),Ce(n,e.adler>>16&255),Ce(n,e.adler>>24&255),Ce(n,255&e.total_in),Ce(n,e.total_in>>8&255),Ce(n,e.total_in>>16&255),Ce(n,e.total_in>>24&255)):(Me(n,e.adler>>>16),Me(n,65535&e.adler)),we(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?ee:te)},Ne=function(e){if(De(e))return ne;var t=e.state.status;return e.state=null,t===pe?ge(e,re):ee},Ge=function(e,t){var n=t.length;if(De(e))return ne;var r=e.state,i=r.wrap;if(2===i||1===i&&r.status!==fe||r.lookahead)return ne;if(1===i&&(e.adler=V(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===i&&(ye(r.head),r.strstart=0,r.block_start=0,r.insert=0);var s=new Uint8Array(r.w_size);s.set(t.subarray(n-r.w_size,n),0),t=s,n=r.w_size}var a=e.avail_in,o=e.next_in,A=e.input;for(e.avail_in=n,e.next_in=0,e.input=t,Fe(r);r.lookahead>=3;){var c=r.strstart,l=r.lookahead-2;do{r.ins_h=be(r,r.ins_h,r.window[c+3-1]),r.prev[c&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=c,c++}while(--l);r.strstart=c,r.lookahead=2,Fe(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,e.next_in=o,e.input=A,e.avail_in=a,r.wrap=i,ee},je=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},We=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=M(n))throw new TypeError(n+"must be non-object");for(var r in n)je(n,r)&&(e[r]=n[r])}}return e},ze=function(e){for(var t=0,n=0,r=e.length;n<r;n++)t+=e[n].length;for(var i=new Uint8Array(t),s=0,a=0,o=e.length;s<o;s++){var A=e[s];i.set(A,a),a+=A.length}return i},Xe=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Xe=!1}for(var Ke=new Uint8Array(256),Ze=0;Ze<256;Ze++)Ke[Ze]=Ze>=252?6:Ze>=248?5:Ze>=240?4:Ze>=224?3:Ze>=192?2:1;Ke[254]=Ke[254]=1;var Je=function(e){if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);var t,n,r,i,s,a=e.length,o=0;for(i=0;i<a;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<a&&(56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++)),o+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(o),s=0,i=0;s<o;i++)55296==(64512&(n=e.charCodeAt(i)))&&i+1<a&&(56320==(64512&(r=e.charCodeAt(i+1)))&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?t[s++]=n:n<2048?(t[s++]=192|n>>>6,t[s++]=128|63&n):n<65536?(t[s++]=224|n>>>12,t[s++]=128|n>>>6&63,t[s++]=128|63&n):(t[s++]=240|n>>>18,t[s++]=128|n>>>12&63,t[s++]=128|n>>>6&63,t[s++]=128|63&n);return t},Ye=function(e,t){var n,r,i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));var s=new Array(2*i);for(r=0,n=0;n<i;){var a=e[n++];if(a<128)s[r++]=a;else{var o=Ke[a];if(o>4)s[r++]=65533,n+=o-1;else{for(a&=2===o?31:3===o?15:7;o>1&&n<i;)a=a<<6|63&e[n++],o--;o>1?s[r++]=65533:a<65536?s[r++]=a:(a-=65536,s[r++]=55296|a>>10&1023,s[r++]=56320|1023&a)}}}return function(e,t){if(t<65534&&e.subarray&&Xe)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));for(var n="",r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n}(s,r)},qe=function(e,t){(t=t||e.length)>e.length&&(t=e.length);for(var n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+Ke[e[n]]>t?n:t},$e=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},et=Object.prototype.toString,tt=G.Z_NO_FLUSH,nt=G.Z_SYNC_FLUSH,rt=G.Z_FULL_FLUSH,it=G.Z_FINISH,st=G.Z_OK,at=G.Z_STREAM_END,ot=G.Z_DEFAULT_COMPRESSION,At=G.Z_DEFAULT_STRATEGY,ct=G.Z_DEFLATED;function lt(e){this.options=We({level:ot,method:ct,chunkSize:16384,windowBits:15,memLevel:8,strategy:At},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;var n=Ve(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==st)throw new Error(N[n]);if(t.header&&Le(this.strm,t.header),t.dictionary){var r;if(r="string"==typeof t.dictionary?Je(t.dictionary):"[object ArrayBuffer]"===et.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(n=Ge(this.strm,r))!==st)throw new Error(N[n]);this._dict_set=!0}}function ut(e,t){var n=new lt(t);if(n.push(e,!0),n.err)throw n.msg||N[n.err];return n.result}lt.prototype.push=function(e,t){var n,r,i=this.strm,s=this.options.chunkSize;if(this.ended)return!1;for(r=t===~~t?t:!0===t?it:tt,"string"==typeof e?i.input=Je(e):"[object ArrayBuffer]"===et.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(r===nt||r===rt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if((n=He(i,r))===at)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),n=Ne(this.strm),this.onEnd(n),this.ended=!0,n===st;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},lt.prototype.onData=function(e){this.chunks.push(e)},lt.prototype.onEnd=function(e){e===st&&(this.result=ze(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ht=lt,dt=ut,ft=function(e,t){return(t=t||{}).raw=!0,ut(e,t)},pt=function(e,t){return(t=t||{}).gzip=!0,ut(e,t)},vt=16209,gt=function(e,t){var n,r,i,s,a,o,A,c,l,u,h,d,f,p,v,g,m,y,_,b,w,B,C,M,k=e.state;n=e.next_in,C=e.input,r=n+(e.avail_in-5),i=e.next_out,M=e.output,s=i-(t-e.avail_out),a=i+(e.avail_out-257),o=k.dmax,A=k.wsize,c=k.whave,l=k.wnext,u=k.window,h=k.hold,d=k.bits,f=k.lencode,p=k.distcode,v=(1<<k.lenbits)-1,g=(1<<k.distbits)-1;e:do{d<15&&(h+=C[n++]<<d,d+=8,h+=C[n++]<<d,d+=8),m=f[h&v];t:for(;;){if(h>>>=y=m>>>24,d-=y,0===(y=m>>>16&255))M[i++]=65535&m;else{if(!(16&y)){if(0==(64&y)){m=f[(65535&m)+(h&(1<<y)-1)];continue t}if(32&y){k.mode=16191;break e}e.msg="invalid literal/length code",k.mode=vt;break e}_=65535&m,(y&=15)&&(d<y&&(h+=C[n++]<<d,d+=8),_+=h&(1<<y)-1,h>>>=y,d-=y),d<15&&(h+=C[n++]<<d,d+=8,h+=C[n++]<<d,d+=8),m=p[h&g];n:for(;;){if(h>>>=y=m>>>24,d-=y,!(16&(y=m>>>16&255))){if(0==(64&y)){m=p[(65535&m)+(h&(1<<y)-1)];continue n}e.msg="invalid distance code",k.mode=vt;break e}if(b=65535&m,d<(y&=15)&&(h+=C[n++]<<d,(d+=8)<y&&(h+=C[n++]<<d,d+=8)),(b+=h&(1<<y)-1)>o){e.msg="invalid distance too far back",k.mode=vt;break e}if(h>>>=y,d-=y,b>(y=i-s)){if((y=b-y)>c&&k.sane){e.msg="invalid distance too far back",k.mode=vt;break e}if(w=0,B=u,0===l){if(w+=A-y,y<_){_-=y;do{M[i++]=u[w++]}while(--y);w=i-b,B=M}}else if(l<y){if(w+=A+l-y,(y-=l)<_){_-=y;do{M[i++]=u[w++]}while(--y);if(w=0,l<_){_-=y=l;do{M[i++]=u[w++]}while(--y);w=i-b,B=M}}}else if(w+=l-y,y<_){_-=y;do{M[i++]=u[w++]}while(--y);w=i-b,B=M}for(;_>2;)M[i++]=B[w++],M[i++]=B[w++],M[i++]=B[w++],_-=3;_&&(M[i++]=B[w++],_>1&&(M[i++]=B[w++]))}else{w=i-b;do{M[i++]=M[w++],M[i++]=M[w++],M[i++]=M[w++],_-=3}while(_>2);_&&(M[i++]=M[w++],_>1&&(M[i++]=M[w++]))}break}}break}}while(n<r&&i<a);n-=_=d>>3,h&=(1<<(d-=_<<3))-1,e.next_in=n,e.next_out=i,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=i<a?a-i+257:257-(i-a),k.hold=h,k.bits=d},mt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),yt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),_t=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),bt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),wt=function(e,t,n,r,i,s,a,o){var A,c,l,u,h,d,f,p,v,g=o.bits,m=0,y=0,_=0,b=0,w=0,B=0,C=0,M=0,k=0,E=0,F=null,x=new Uint16Array(16),U=new Uint16Array(16),I=null;for(m=0;m<=15;m++)x[m]=0;for(y=0;y<r;y++)x[t[n+y]]++;for(w=g,b=15;b>=1&&0===x[b];b--);if(w>b&&(w=b),0===b)return i[s++]=20971520,i[s++]=20971520,o.bits=1,0;for(_=1;_<b&&0===x[_];_++);for(w<_&&(w=_),M=1,m=1;m<=15;m++)if(M<<=1,(M-=x[m])<0)return-1;if(M>0&&(0===e||1!==b))return-1;for(U[1]=0,m=1;m<15;m++)U[m+1]=U[m]+x[m];for(y=0;y<r;y++)0!==t[n+y]&&(a[U[t[n+y]]++]=y);if(0===e?(F=I=a,d=20):1===e?(F=mt,I=yt,d=257):(F=_t,I=bt,d=0),E=0,y=0,m=_,h=s,B=w,C=0,l=-1,u=(k=1<<w)-1,1===e&&k>852||2===e&&k>592)return 1;for(;;){f=m-C,a[y]+1<d?(p=0,v=a[y]):a[y]>=d?(p=I[a[y]-d],v=F[a[y]-d]):(p=96,v=0),A=1<<m-C,_=c=1<<B;do{i[h+(E>>C)+(c-=A)]=f<<24|p<<16|v|0}while(0!==c);for(A=1<<m-1;E&A;)A>>=1;if(0!==A?(E&=A-1,E+=A):E=0,y++,0==--x[m]){if(m===b)break;m=t[n+a[y]]}if(m>w&&(E&u)!==l){for(0===C&&(C=w),h+=_,M=1<<(B=m-C);B+C<b&&!((M-=x[B+C])<=0);)B++,M<<=1;if(k+=1<<B,1===e&&k>852||2===e&&k>592)return 1;i[l=E&u]=w<<24|B<<16|h-s|0}}return 0!==E&&(i[h+E]=m-C<<24|64<<16|0),o.bits=w,0},Bt=G.Z_FINISH,Ct=G.Z_BLOCK,Mt=G.Z_TREES,kt=G.Z_OK,Et=G.Z_STREAM_END,Ft=G.Z_NEED_DICT,xt=G.Z_STREAM_ERROR,Ut=G.Z_DATA_ERROR,It=G.Z_MEM_ERROR,Tt=G.Z_BUF_ERROR,Pt=G.Z_DEFLATED,St=16180,Dt=16190,Qt=16191,Rt=16192,Ot=16194,Vt=16199,Lt=16200,Ht=16206,Nt=16209,Gt=function(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)};function jt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Wt,zt,Xt=function(e){if(!e)return 1;var t=e.state;return!t||t.strm!==e||t.mode<St||t.mode>16211?1:0},Kt=function(e){if(Xt(e))return xt;var t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=St,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,kt},Zt=function(e){if(Xt(e))return xt;var t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Kt(e)},Jt=function(e,t){var n;if(Xt(e))return xt;var r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?xt:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,Zt(e))},Yt=function(e,t){if(!e)return xt;var n=new jt;e.state=n,n.strm=e,n.window=null,n.mode=St;var r=Jt(e,t);return r!==kt&&(e.state=null),r},qt=!0,$t=function(e){if(qt){Wt=new Int32Array(512),zt=new Int32Array(32);for(var t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(wt(1,e.lens,0,288,Wt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;wt(2,e.lens,0,32,zt,0,e.work,{bits:5}),qt=!1}e.lencode=Wt,e.lenbits=9,e.distcode=zt,e.distbits=5},en=function(e,t,n,r){var i,s=e.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(t.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):((i=s.wsize-s.wnext)>r&&(i=r),s.window.set(t.subarray(n-r,n-r+i),s.wnext),(r-=i)?(s.window.set(t.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},tn=Zt,nn=Yt,rn=function(e,t){var n,r,i,s,a,o,A,c,l,u,h,d,f,p,v,g,m,y,_,b,w,B,C,M,k=0,E=new Uint8Array(4),F=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Xt(e)||!e.output||!e.input&&0!==e.avail_in)return xt;(n=e.state).mode===Qt&&(n.mode=Rt),a=e.next_out,i=e.output,A=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,u=o,h=A,B=kt;e:for(;;)switch(n.mode){case St:if(0===n.wrap){n.mode=Rt;break}for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(2&n.wrap&&35615===c){0===n.wbits&&(n.wbits=15),n.check=0,E[0]=255&c,E[1]=c>>>8&255,n.check=H(n.check,E,2,0),c=0,l=0,n.mode=16181;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",n.mode=Nt;break}if((15&c)!==Pt){e.msg="unknown compression method",n.mode=Nt;break}if(l-=4,w=8+(15&(c>>>=4)),0===n.wbits&&(n.wbits=w),w>15||w>n.wbits){e.msg="invalid window size",n.mode=Nt;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&c?16189:Qt,c=0,l=0;break;case 16181:for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(n.flags=c,(255&n.flags)!==Pt){e.msg="unknown compression method",n.mode=Nt;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Nt;break}n.head&&(n.head.text=c>>8&1),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,n.check=H(n.check,E,2,0)),c=0,l=0,n.mode=16182;case 16182:for(;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.head&&(n.head.time=c),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,E[2]=c>>>16&255,E[3]=c>>>24&255,n.check=H(n.check,E,4,0)),c=0,l=0,n.mode=16183;case 16183:for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.head&&(n.head.xflags=255&c,n.head.os=c>>8),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,n.check=H(n.check,E,2,0)),c=0,l=0,n.mode=16184;case 16184:if(1024&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.length=c,n.head&&(n.head.extra_len=c),512&n.flags&&4&n.wrap&&(E[0]=255&c,E[1]=c>>>8&255,n.check=H(n.check,E,2,0)),c=0,l=0}else n.head&&(n.head.extra=null);n.mode=16185;case 16185:if(1024&n.flags&&((d=n.length)>o&&(d=o),d&&(n.head&&(w=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+d),w)),512&n.flags&&4&n.wrap&&(n.check=H(n.check,r,d,s)),o-=d,s+=d,n.length-=d),n.length))break e;n.length=0,n.mode=16186;case 16186:if(2048&n.flags){if(0===o)break e;d=0;do{w=r[s+d++],n.head&&w&&n.length<65536&&(n.head.name+=String.fromCharCode(w))}while(w&&d<o);if(512&n.flags&&4&n.wrap&&(n.check=H(n.check,r,d,s)),o-=d,s+=d,w)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=16187;case 16187:if(4096&n.flags){if(0===o)break e;d=0;do{w=r[s+d++],n.head&&w&&n.length<65536&&(n.head.comment+=String.fromCharCode(w))}while(w&&d<o);if(512&n.flags&&4&n.wrap&&(n.check=H(n.check,r,d,s)),o-=d,s+=d,w)break e}else n.head&&(n.head.comment=null);n.mode=16188;case 16188:if(512&n.flags){for(;l<16;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(4&n.wrap&&c!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Nt;break}c=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Qt;break;case 16189:for(;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}e.adler=n.check=Gt(c),c=0,l=0,n.mode=Dt;case Dt:if(0===n.havedict)return e.next_out=a,e.avail_out=A,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=l,Ft;e.adler=n.check=1,n.mode=Qt;case Qt:if(t===Ct||t===Mt)break e;case Rt:if(n.last){c>>>=7&l,l-=7&l,n.mode=Ht;break}for(;l<3;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}switch(n.last=1&c,l-=1,3&(c>>>=1)){case 0:n.mode=16193;break;case 1:if($t(n),n.mode=Vt,t===Mt){c>>>=2,l-=2;break e}break;case 2:n.mode=16196;break;case 3:e.msg="invalid block type",n.mode=Nt}c>>>=2,l-=2;break;case 16193:for(c>>>=7&l,l-=7&l;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Nt;break}if(n.length=65535&c,c=0,l=0,n.mode=Ot,t===Mt)break e;case Ot:n.mode=16195;case 16195:if(d=n.length){if(d>o&&(d=o),d>A&&(d=A),0===d)break e;i.set(r.subarray(s,s+d),a),o-=d,s+=d,A-=d,a+=d,n.length-=d;break}n.mode=Qt;break;case 16196:for(;l<14;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(n.nlen=257+(31&c),c>>>=5,l-=5,n.ndist=1+(31&c),c>>>=5,l-=5,n.ncode=4+(15&c),c>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Nt;break}n.have=0,n.mode=16197;case 16197:for(;n.have<n.ncode;){for(;l<3;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.lens[F[n.have++]]=7&c,c>>>=3,l-=3}for(;n.have<19;)n.lens[F[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,C={bits:n.lenbits},B=wt(0,n.lens,0,19,n.lencode,0,n.work,C),n.lenbits=C.bits,B){e.msg="invalid code lengths set",n.mode=Nt;break}n.have=0,n.mode=16198;case 16198:for(;n.have<n.nlen+n.ndist;){for(;g=(k=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,m=65535&k,!((v=k>>>24)<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(m<16)c>>>=v,l-=v,n.lens[n.have++]=m;else{if(16===m){for(M=v+2;l<M;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(c>>>=v,l-=v,0===n.have){e.msg="invalid bit length repeat",n.mode=Nt;break}w=n.lens[n.have-1],d=3+(3&c),c>>>=2,l-=2}else if(17===m){for(M=v+3;l<M;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}l-=v,w=0,d=3+(7&(c>>>=v)),c>>>=3,l-=3}else{for(M=v+7;l<M;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}l-=v,w=0,d=11+(127&(c>>>=v)),c>>>=7,l-=7}if(n.have+d>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Nt;break}for(;d--;)n.lens[n.have++]=w}}if(n.mode===Nt)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Nt;break}if(n.lenbits=9,C={bits:n.lenbits},B=wt(1,n.lens,0,n.nlen,n.lencode,0,n.work,C),n.lenbits=C.bits,B){e.msg="invalid literal/lengths set",n.mode=Nt;break}if(n.distbits=6,n.distcode=n.distdyn,C={bits:n.distbits},B=wt(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,C),n.distbits=C.bits,B){e.msg="invalid distances set",n.mode=Nt;break}if(n.mode=Vt,t===Mt)break e;case Vt:n.mode=Lt;case Lt:if(o>=6&&A>=258){e.next_out=a,e.avail_out=A,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=l,gt(e,h),a=e.next_out,i=e.output,A=e.avail_out,s=e.next_in,r=e.input,o=e.avail_in,c=n.hold,l=n.bits,n.mode===Qt&&(n.back=-1);break}for(n.back=0;g=(k=n.lencode[c&(1<<n.lenbits)-1])>>>16&255,m=65535&k,!((v=k>>>24)<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(g&&0==(240&g)){for(y=v,_=g,b=m;g=(k=n.lencode[b+((c&(1<<y+_)-1)>>y)])>>>16&255,m=65535&k,!(y+(v=k>>>24)<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}c>>>=y,l-=y,n.back+=y}if(c>>>=v,l-=v,n.back+=v,n.length=m,0===g){n.mode=16205;break}if(32&g){n.back=-1,n.mode=Qt;break}if(64&g){e.msg="invalid literal/length code",n.mode=Nt;break}n.extra=15&g,n.mode=16201;case 16201:if(n.extra){for(M=n.extra;l<M;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.length+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=16202;case 16202:for(;g=(k=n.distcode[c&(1<<n.distbits)-1])>>>16&255,m=65535&k,!((v=k>>>24)<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(0==(240&g)){for(y=v,_=g,b=m;g=(k=n.distcode[b+((c&(1<<y+_)-1)>>y)])>>>16&255,m=65535&k,!(y+(v=k>>>24)<=l);){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}c>>>=y,l-=y,n.back+=y}if(c>>>=v,l-=v,n.back+=v,64&g){e.msg="invalid distance code",n.mode=Nt;break}n.offset=m,n.extra=15&g,n.mode=16203;case 16203:if(n.extra){for(M=n.extra;l<M;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}n.offset+=c&(1<<n.extra)-1,c>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Nt;break}n.mode=16204;case 16204:if(0===A)break e;if(d=h-A,n.offset>d){if((d=n.offset-d)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Nt;break}d>n.wnext?(d-=n.wnext,f=n.wsize-d):f=n.wnext-d,d>n.length&&(d=n.length),p=n.window}else p=i,f=a-n.offset,d=n.length;d>A&&(d=A),A-=d,n.length-=d;do{i[a++]=p[f++]}while(--d);0===n.length&&(n.mode=Lt);break;case 16205:if(0===A)break e;i[a++]=n.length,A--,n.mode=Lt;break;case Ht:if(n.wrap){for(;l<32;){if(0===o)break e;o--,c|=r[s++]<<l,l+=8}if(h-=A,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?H(n.check,i,h,a-h):V(n.check,i,h,a-h)),h=A,4&n.wrap&&(n.flags?c:Gt(c))!==n.check){e.msg="incorrect data check",n.mode=Nt;break}c=0,l=0}n.mode=16207;case 16207:if(n.wrap&&n.flags){for(;l<32;){if(0===o)break e;o--,c+=r[s++]<<l,l+=8}if(4&n.wrap&&c!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Nt;break}c=0,l=0}n.mode=16208;case 16208:B=Et;break e;case Nt:B=Ut;break e;case 16210:return It;default:return xt}return e.next_out=a,e.avail_out=A,e.next_in=s,e.avail_in=o,n.hold=c,n.bits=l,(n.wsize||h!==e.avail_out&&n.mode<Nt&&(n.mode<Ht||t!==Bt))&&en(e,e.output,e.next_out,h-e.avail_out),u-=e.avail_in,h-=e.avail_out,e.total_in+=u,e.total_out+=h,n.total+=h,4&n.wrap&&h&&(e.adler=n.check=n.flags?H(n.check,i,h,e.next_out-h):V(n.check,i,h,e.next_out-h)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Qt?128:0)+(n.mode===Vt||n.mode===Ot?256:0),(0===u&&0===h||t===Bt)&&B===kt&&(B=Tt),B},sn=function(e){if(Xt(e))return xt;var t=e.state;return t.window&&(t.window=null),e.state=null,kt},an=function(e,t){if(Xt(e))return xt;var n=e.state;return 0==(2&n.wrap)?xt:(n.head=t,t.done=!1,kt)},on=function(e,t){var n,r=t.length;return Xt(e)?xt:0!==(n=e.state).wrap&&n.mode!==Dt?xt:n.mode===Dt&&V(1,t,r,0)!==n.check?Ut:en(e,t,r,r)?(n.mode=16210,It):(n.havedict=1,kt)},An=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},cn=Object.prototype.toString,ln=G.Z_NO_FLUSH,un=G.Z_FINISH,hn=G.Z_OK,dn=G.Z_STREAM_END,fn=G.Z_NEED_DICT,pn=G.Z_STREAM_ERROR,vn=G.Z_DATA_ERROR,gn=G.Z_MEM_ERROR;function mn(e){this.options=We({chunkSize:65536,windowBits:15,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new $e,this.strm.avail_out=0;var n=nn(this.strm,t.windowBits);if(n!==hn)throw new Error(N[n]);if(this.header=new An,an(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Je(t.dictionary):"[object ArrayBuffer]"===cn.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=on(this.strm,t.dictionary))!==hn))throw new Error(N[n])}function yn(e,t){var n=new mn(t);if(n.push(e),n.err)throw n.msg||N[n.err];return n.result}mn.prototype.push=function(e,t){var n,r,i,s=this.strm,a=this.options.chunkSize,o=this.options.dictionary;if(this.ended)return!1;for(r=t===~~t?t:!0===t?un:ln,"[object ArrayBuffer]"===cn.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(n=rn(s,r))===fn&&o&&((n=on(s,o))===hn?n=rn(s,r):n===vn&&(n=fn));s.avail_in>0&&n===dn&&s.state.wrap>0&&0!==e[s.next_in];)tn(s),n=rn(s,r);switch(n){case pn:case vn:case fn:case gn:return this.onEnd(n),this.ended=!0,!1}if(i=s.avail_out,s.next_out&&(0===s.avail_out||n===dn))if("string"===this.options.to){var A=qe(s.output,s.next_out),c=s.next_out-A,l=Ye(s.output,A);s.next_out=c,s.avail_out=a-c,c&&s.output.set(s.output.subarray(A,A+c),0),this.onData(l)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(n!==hn||0!==i){if(n===dn)return n=sn(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},mn.prototype.onData=function(e){this.chunks.push(e)},mn.prototype.onEnd=function(e){e===hn&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ze(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var _n=function(e,t){return(t=t||{}).raw=!0,yn(e,t)},bn=ht,wn=dt,Bn=ft,Cn=pt,Mn=mn,kn=yn,En=_n,Fn=yn,xn=G,Un={Deflate:bn,deflate:wn,deflateRaw:Bn,gzip:Cn,Inflate:Mn,inflate:kn,inflateRaw:En,ungzip:Fn,constants:xn};e.Deflate=bn,e.Inflate=Mn,e.constants=xn,e.default=Un,e.deflate=wn,e.deflateRaw=Bn,e.gzip=Cn,e.inflate=kn,e.inflateRaw=En,e.ungzip=Fn,Object.defineProperty(e,"__esModule",{value:!0})}));var TE=Object.freeze({__proto__:null}),PE=window.pako||TE;PE.inflate||(PE=PE.default);var SE,DE=(SE=new Float32Array(3),function(e){return SE[0]=e[0]/255,SE[1]=e[1]/255,SE[2]=e[2]/255,SE});var QE={version:1,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11]}}(n),o=function(e){return{positions:new Uint16Array(PE.inflate(e.positions).buffer),normals:new Int8Array(PE.inflate(e.normals).buffer),indices:new Uint32Array(PE.inflate(e.indices).buffer),edgeIndices:new Uint32Array(PE.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(PE.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(PE.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(PE.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(PE.inflate(e.meshColors).buffer),entityIDs:PE.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(PE.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(PE.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(PE.inflate(e.positionsDecodeMatrix).buffer)}}(a);!function(e,t,n,r,i,s){s.getNextId(),r.positionsCompression="precompressed",r.normalsCompression="precompressed";for(var a=n.positions,o=n.normals,A=n.indices,c=n.edgeIndices,l=n.meshPositions,u=n.meshIndices,h=n.meshEdgesIndices,d=n.meshColors,f=JSON.parse(n.entityIDs),p=n.entityMeshes,v=n.entityIsObjects,g=l.length,m=p.length,y=0;y<m;y++){var _=f[y],b=t.globalizeObjectIds?De.globalizeObjectId(r.id,_):_,w=e.metaScene.metaObjects[b],B={},C={};if(w){if(t.excludeTypesMap&&w.type&&t.excludeTypesMap[w.type])continue;if(t.includeTypesMap&&w.type&&!t.includeTypesMap[w.type])continue;var M=t.objectDefaults?t.objectDefaults[w.type]||t.objectDefaults.DEFAULT:null;M&&(!1===M.visible&&(B.visible=!1),!1===M.pickable&&(B.pickable=!1),M.colorize&&(C.color=M.colorize),void 0!==M.opacity&&null!==M.opacity&&(C.opacity=M.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var k=y===m-1,E=[],F=p[y],x=k?p.length:p[y+1];F<x;F++){var U=F===g-1,I=b+".mesh."+F,T=DE(d.subarray(4*F,4*F+3)),P=d[4*F+3]/255;r.createMesh(je.apply(C,{id:I,primitive:"triangles",positionsCompressed:a.subarray(l[F],U?a.length:l[F+1]),normalsCompressed:o.subarray(l[F],U?a.length:l[F+1]),indices:A.subarray(u[F],U?A.length:u[F+1]),edgeIndices:c.subarray(h[F],U?c.length:h[F+1]),positionsDecodeMatrix:n.positionsDecodeMatrix,color:T,opacity:P})),E.push(I)}r.createEntity(je.apply(B,{id:b,isObject:1===v[y],meshIds:E}))}}(e,t,o,r,0,s)}},RE=window.pako||TE;RE.inflate||(RE=RE.default);var OE=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var VE={version:2,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11],entityMeshIds:e[12],entityMatrices:e[13],entityUsesInstancing:e[14]}}(n),o=function(e){return{positions:new Uint16Array(RE.inflate(e.positions).buffer),normals:new Int8Array(RE.inflate(e.normals).buffer),indices:new Uint32Array(RE.inflate(e.indices).buffer),edgeIndices:new Uint32Array(RE.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(RE.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(RE.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(RE.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(RE.inflate(e.meshColors).buffer),entityIDs:RE.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(RE.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(RE.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(RE.inflate(e.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(RE.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(RE.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(RE.inflate(e.entityUsesInstancing).buffer)}}(a);!function(e,t,n,r,i,s){var a=s.getNextId();r.positionsCompression="precompressed",r.normalsCompression="precompressed";for(var o=n.positions,A=n.normals,c=n.indices,l=n.edgeIndices,u=n.meshPositions,h=n.meshIndices,d=n.meshEdgesIndices,f=n.meshColors,p=JSON.parse(n.entityIDs),v=n.entityMeshes,g=n.entityIsObjects,m=n.entityMeshIds,y=n.entityMatrices,_=n.entityUsesInstancing,b=u.length,w=v.length,B={},C=0;C<w;C++){var M=p[C],k=t.globalizeObjectIds?De.globalizeObjectId(r.id,M):M,E=e.metaScene.metaObjects[k],F={},x={},U=y.subarray(16*C,16*C+16);if(E){if(t.excludeTypesMap&&E.type&&t.excludeTypesMap[E.type])continue;if(t.includeTypesMap&&E.type&&!t.includeTypesMap[E.type])continue;var I=t.objectDefaults?t.objectDefaults[E.type]||t.objectDefaults.DEFAULT:null;I&&(!1===I.visible&&(F.visible=!1),!1===I.pickable&&(F.pickable=!1),I.colorize&&(x.color=I.colorize),void 0!==I.opacity&&null!==I.opacity&&(x.opacity=I.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var T=C===w-1,P=[],S=v[C],D=T?m.length:v[C+1];S<D;S++){var Q=m[S],R=Q===b-1,O=s.getNextId(),V=OE(f.subarray(4*Q,4*Q+3)),L=f[4*Q+3]/255,H=o.subarray(u[Q],R?o.length:u[Q+1]),N=A.subarray(u[Q],R?o.length:u[Q+1]),G=c.subarray(h[Q],R?c.length:h[Q+1]),j=l.subarray(d[Q],R?l.length:d[Q+1]);if(1===_[C]){var W="".concat(a,".geometry.").concat(O,".").concat(Q);W in B||(r.createGeometry({id:W,positionsCompressed:H,normalsCompressed:N,indices:G,edgeIndices:j,primitive:"triangles",positionsDecodeMatrix:n.positionsDecodeMatrix}),B[W]=!0),r.createMesh(je.apply(x,{id:O,color:V,opacity:L,matrix:U,geometryId:W})),P.push(O)}else r.createMesh(je.apply(x,{id:O,primitive:"triangles",positionsCompressed:H,normalsCompressed:N,indices:G,edgeIndices:j,positionsDecodeMatrix:n.positionsDecodeMatrix,color:V,opacity:L})),P.push(O)}P.length&&r.createEntity(je.apply(F,{id:k,isObject:1===g[C],meshIds:P}))}}(e,t,o,r,0,s)}},LE=window.pako||TE;LE.inflate||(LE=LE.default);var HE=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var NE={version:3,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],instancedPositionsDecodeMatrix:e[11],batchedPositionsDecodeMatrix:e[12],entityMeshIds:e[13],entityMatrices:e[14],entityUsesInstancing:e[15]}}(n),o=function(e){return{positions:new Uint16Array(LE.inflate(e.positions).buffer),normals:new Int8Array(LE.inflate(e.normals).buffer),indices:new Uint32Array(LE.inflate(e.indices).buffer),edgeIndices:new Uint32Array(LE.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(LE.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(LE.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(LE.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(LE.inflate(e.meshColors).buffer),entityIDs:LE.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(LE.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(LE.inflate(e.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(LE.inflate(e.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(LE.inflate(e.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(LE.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(LE.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(LE.inflate(e.entityUsesInstancing).buffer)}}(a);!function(e,t,n,r,i,s){var a=s.getNextId();r.positionsCompression="precompressed",r.normalsCompression="precompressed";for(var o=n.positions,A=n.normals,c=n.indices,l=n.edgeIndices,u=n.meshPositions,h=n.meshIndices,d=n.meshEdgesIndices,f=n.meshColors,p=JSON.parse(n.entityIDs),v=n.entityMeshes,g=n.entityIsObjects,m=n.entityMeshIds,y=n.entityMatrices,_=n.entityUsesInstancing,b=u.length,w=v.length,B={},C=0;C<w;C++){var M=p[C],k=t.globalizeObjectIds?De.globalizeObjectId(r.id,M):M,E=e.metaScene.metaObjects[k],F={},x={},U=y.subarray(16*C,16*C+16);if(E){if(t.excludeTypesMap&&E.type&&t.excludeTypesMap[E.type])continue;if(t.includeTypesMap&&E.type&&!t.includeTypesMap[E.type])continue;var I=t.objectDefaults?t.objectDefaults[E.type]||t.objectDefaults.DEFAULT:null;I&&(!1===I.visible&&(F.visible=!1),!1===I.pickable&&(F.pickable=!1),I.colorize&&(x.color=I.colorize),void 0!==I.opacity&&null!==I.opacity&&(x.opacity=I.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var T=C===w-1,P=[],S=v[C],D=T?m.length:v[C+1];S<D;S++){var Q=m[S],R=Q===b-1,O="".concat(a,".").concat(k,".mesh.").concat(Q),V=HE(f.subarray(4*Q,4*Q+3)),L=f[4*Q+3]/255,H=o.subarray(u[Q],R?o.length:u[Q+1]),N=A.subarray(u[Q],R?o.length:u[Q+1]),G=c.subarray(h[Q],R?c.length:h[Q+1]),j=l.subarray(d[Q],R?l.length:d[Q+1]);if(1===_[C]){var W="".concat(a,".geometry.").concat(O,".").concat(Q);W in B||(r.createGeometry({id:W,positionsCompressed:H,normalsCompressed:N,indices:G,edgeIndices:j,primitive:"triangles",positionsDecodeMatrix:n.instancedPositionsDecodeMatrix}),B[W]=!0),r.createMesh(je.apply(x,{id:O,color:V,opacity:L,matrix:U,geometryId:W})),P.push(O)}else r.createMesh(je.apply(x,{id:O,primitive:"triangles",positionsCompressed:H,normalsCompressed:N,indices:G,edgeIndices:j,positionsDecodeMatrix:n.batchedPositionsDecodeMatrix,color:V,opacity:L})),P.push(O)}P.length&&r.createEntity(je.apply(F,{id:k,isObject:1===g[C],meshIds:P}))}}(e,t,o,r,0,s)}},GE=window.pako||TE;GE.inflate||(GE=GE.default);var jE=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var WE={version:4,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],decodeMatrices:e[4],matrices:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveDecodeMatricesPortion:e[9],eachPrimitiveColor:e[10],primitiveInstances:e[11],eachEntityId:e[12],eachEntityPrimitiveInstancesPortion:e[13],eachEntityMatricesPortion:e[14],eachEntityMatrix:e[15]}}(n),o=function(e){return{positions:new Uint16Array(GE.inflate(e.positions).buffer),normals:new Int8Array(GE.inflate(e.normals).buffer),indices:new Uint32Array(GE.inflate(e.indices).buffer),edgeIndices:new Uint32Array(GE.inflate(e.edgeIndices).buffer),decodeMatrices:new Float32Array(GE.inflate(e.decodeMatrices).buffer),matrices:new Float32Array(GE.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(GE.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(GE.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(GE.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(GE.inflate(e.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(GE.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(GE.inflate(e.primitiveInstances).buffer),eachEntityId:GE.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(GE.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(GE.inflate(e.eachEntityMatricesPortion).buffer)}}(a);!function(e,t,n,r,i,s){var a=s.getNextId();r.positionsCompression="precompressed",r.normalsCompression="precompressed";for(var o=n.positions,A=n.normals,c=n.indices,l=n.edgeIndices,u=n.decodeMatrices,h=n.matrices,d=n.eachPrimitivePositionsAndNormalsPortion,f=n.eachPrimitiveIndicesPortion,p=n.eachPrimitiveEdgeIndicesPortion,v=n.eachPrimitiveDecodeMatricesPortion,g=n.eachPrimitiveColor,m=n.primitiveInstances,y=JSON.parse(n.eachEntityId),_=n.eachEntityPrimitiveInstancesPortion,b=n.eachEntityMatricesPortion,w=d.length,B=m.length,C=new Uint8Array(w),M=new Uint32Array(w),k=y.length,E=0;E<w;E++)M[E]=E;M.sort((function(e,t){return v[e]<v[t]?-1:v[e]>v[t]?1:0}));for(var F=0;F<B;F++)C[m[F]]++;for(var x={},U=0;U<k;U++)for(var I=k-1,T=U===I,P=_[U],S=T?_[I]:_[U+1],D=P;D<S;D++){var Q=m[D];C[Q]>1||(x[Q]=U)}for(var R=0;R<w;R++){var O=M[R],V=O===w-1,L=C[O]>1,H=jE(g.subarray(4*O,4*O+3)),N=g[4*O+3]/255,G=o.subarray(d[O],V?o.length:d[O+1]),j=A.subarray(d[O],V?A.length:d[O+1]),W=c.subarray(f[O],V?c.length:f[O+1]),z=l.subarray(p[O],V?l.length:p[O+1]),X=u.subarray(v[O],v[O]+16);if(L){var K="".concat(a,"-geometry.").concat(O);r.createGeometry({id:K,primitive:"triangles",positionsCompressed:G,normalsCompressed:j,indices:W,edgeIndices:z,positionsDecodeMatrix:X})}else{var Z="".concat(a,"-").concat(O);y[x[O]],r.createMesh(je.apply({},{id:Z,primitive:"triangles",positionsCompressed:G,normalsCompressed:j,indices:W,edgeIndices:z,positionsDecodeMatrix:X,color:H,opacity:N}))}}for(var J=0,Y=0;Y<k;Y++){for(var q=k-1,$=Y===q,ee=y[Y],te=_[Y],ne=$?_[q]:_[Y+1],re=[],ie=te;ie<ne;ie++){var se=m[ie];if(C[se]>1){var ae="".concat(a,"-instance.").concat(J++),oe="".concat(a,"-geometry.").concat(se),Ae=16*b[Y],ce=h.subarray(Ae,Ae+16);r.createMesh(je.apply({},{id:ae,geometryId:oe,matrix:ce})),re.push(ae)}else re.push(se)}re.length>0&&r.createEntity(je.apply({},{id:ee,isObject:!0,meshIds:re}))}}(0,0,o,r,0,s)}},zE=window.pako||TE;zE.inflate||(zE=zE.default);var XE=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var KE={version:5,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],eachPrimitivePositionsAndNormalsPortion:e[5],eachPrimitiveIndicesPortion:e[6],eachPrimitiveEdgeIndicesPortion:e[7],eachPrimitiveColor:e[8],primitiveInstances:e[9],eachEntityId:e[10],eachEntityPrimitiveInstancesPortion:e[11],eachEntityMatricesPortion:e[12]}}(n),o=function(e){return{positions:new Float32Array(zE.inflate(e.positions).buffer),normals:new Int8Array(zE.inflate(e.normals).buffer),indices:new Uint32Array(zE.inflate(e.indices).buffer),edgeIndices:new Uint32Array(zE.inflate(e.edgeIndices).buffer),matrices:new Float32Array(zE.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(zE.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(zE.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(zE.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(zE.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(zE.inflate(e.primitiveInstances).buffer),eachEntityId:zE.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(zE.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(zE.inflate(e.eachEntityMatricesPortion).buffer)}}(a);!function(e,t,n,r,i,s){var a=s.getNextId();r.positionsCompression="disabled",r.normalsCompression="precompressed";for(var o=n.positions,A=n.normals,c=n.indices,l=n.edgeIndices,u=n.matrices,h=n.eachPrimitivePositionsAndNormalsPortion,d=n.eachPrimitiveIndicesPortion,f=n.eachPrimitiveEdgeIndicesPortion,p=n.eachPrimitiveColor,v=n.primitiveInstances,g=JSON.parse(n.eachEntityId),m=n.eachEntityPrimitiveInstancesPortion,y=n.eachEntityMatricesPortion,_=h.length,b=v.length,w=new Uint8Array(_),B=g.length,C=0;C<b;C++)w[v[C]]++;for(var M={},k=0;k<B;k++)for(var E=B-1,F=k===E,x=m[k],U=F?m[E]:m[k+1],I=x;I<U;I++){var T=v[I];w[T]>1||(M[T]=k)}for(var P=0;P<_;P++){var S=P===_-1,D=w[P]>1,Q=XE(p.subarray(4*P,4*P+3)),R=p[4*P+3]/255,O=o.subarray(h[P],S?o.length:h[P+1]),V=A.subarray(h[P],S?A.length:h[P+1]),L=c.subarray(d[P],S?c.length:d[P+1]),H=l.subarray(f[P],S?l.length:f[P+1]);if(D){var N="".concat(a,"-geometry.").concat(P);r.createGeometry({id:N,primitive:"triangles",positionsCompressed:O,normalsCompressed:V,indices:L,edgeIndices:H})}else{var G=P;g[M[P]],r.createMesh(je.apply({},{id:G,primitive:"triangles",positionsCompressed:O,normalsCompressed:V,indices:L,edgeIndices:H,color:Q,opacity:R}))}}for(var j=0,W=0;W<B;W++){for(var z=B-1,X=W===z,K=g[W],Z=m[W],J=X?m[z]:m[W+1],Y=[],q=Z;q<J;q++){var $=v[q];if(w[$]>1){var ee="instance."+j++,te="geometry"+$,ne=16*y[W],re=u.subarray(ne,ne+16);r.createMesh(je.apply({},{id:ee,geometryId:te,matrix:re})),Y.push(ee)}else Y.push($)}Y.length>0&&r.createEntity(je.apply({},{id:K,isObject:!0,meshIds:Y}))}}(0,0,o,r,0,s)}},ZE=window.pako||TE;ZE.inflate||(ZE=ZE.default);var JE,YE=(JE=new Float32Array(3),function(e){return JE[0]=e[0]/255,JE[1]=e[1]/255,JE[2]=e[2]/255,JE});var qE={version:6,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],reusedPrimitivesDecodeMatrix:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveColorAndOpacity:e[9],primitiveInstances:e[10],eachEntityId:e[11],eachEntityPrimitiveInstancesPortion:e[12],eachEntityMatricesPortion:e[13],eachTileAABB:e[14],eachTileEntitiesPortion:e[15]}}(n),o=function(e){function t(e,t){return 0===e.length?[]:ZE.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(t(e.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(t(e.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(t(e.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(t(e.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(t(e.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(t(e.primitiveInstances)),eachEntityId:ZE.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(t(e.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(t(e.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(a);!function(e,t,n,r,i,s){for(var a=s.getNextId(),o=n.positions,A=n.normals,c=n.indices,l=n.edgeIndices,u=n.matrices,h=n.reusedPrimitivesDecodeMatrix,d=n.eachPrimitivePositionsAndNormalsPortion,f=n.eachPrimitiveIndicesPortion,p=n.eachPrimitiveEdgeIndicesPortion,v=n.eachPrimitiveColorAndOpacity,g=n.primitiveInstances,m=JSON.parse(n.eachEntityId),y=n.eachEntityPrimitiveInstancesPortion,_=n.eachEntityMatricesPortion,b=n.eachTileAABB,w=n.eachTileEntitiesPortion,B=d.length,C=g.length,M=m.length,k=w.length,E=new Uint32Array(B),F=0;F<C;F++){var x=g[F];void 0!==E[x]?E[x]++:E[x]=1}for(var U=De.vec3(),I=De.AABB3(),T=0;T<k;T++){var P=T===k-1,S=w[T],D=P?M:w[T+1],Q=6*T,R=b.subarray(Q,Q+6);De.getAABB3Center(R,U),I[0]=R[0]-U[0],I[1]=R[1]-U[1],I[2]=R[2]-U[2],I[3]=R[3]-U[0],I[4]=R[4]-U[1],I[5]=R[5]-U[2];for(var O=Nt.createPositionsDecodeMatrix(I),V={},L=S;L<D;L++){var H=m[L],N=t.globalizeObjectIds?De.globalizeObjectId(r.id,H):H,G=_[L],j=u.slice(G,G+16),W=L===M-1,z=y[L],X=W?g.length:y[L+1],K=[],Z=e.metaScene.metaObjects[N],J={},Y={};if(Z){if(t.excludeTypesMap&&Z.type&&t.excludeTypesMap[Z.type])continue;if(t.includeTypesMap&&Z.type&&!t.includeTypesMap[Z.type])continue;if(t.includeIdsMap&&Z.id&&!t.includeIdsMap[Z.id])continue;var q=t.objectDefaults?t.objectDefaults[Z.type]||t.objectDefaults.DEFAULT:null;q&&(!1===q.visible&&(J.visible=!1),!1===q.pickable&&(J.pickable=!1),q.colorize&&(Y.color=q.colorize),void 0!==q.opacity&&null!==q.opacity&&(Y.opacity=q.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(var $=z;$<X;$++){var ee=g[$],te=E[ee]>1,ne=ee===B-1,re=o.subarray(d[ee],ne?o.length:d[ee+1]),ie=A.subarray(d[ee],ne?A.length:d[ee+1]),se=c.subarray(f[ee],ne?c.length:f[ee+1]),ae=l.subarray(p[ee],ne?l.length:p[ee+1]),oe=YE(v.subarray(4*ee,4*ee+3)),Ae=v[4*ee+3]/255,ce=s.getNextId();if(te){var le="".concat(a,"-geometry.").concat(T,".").concat(ee);V[le]||(r.createGeometry({id:le,primitive:"triangles",positionsCompressed:re,indices:se,edgeIndices:ae,positionsDecodeMatrix:h}),V[le]=!0),r.createMesh(je.apply(Y,{id:ce,geometryId:le,origin:U,matrix:j,color:oe,opacity:Ae})),K.push(ce)}else r.createMesh(je.apply(Y,{id:ce,origin:U,primitive:"triangles",positionsCompressed:re,normalsCompressed:ie,indices:se,edgeIndices:ae,positionsDecodeMatrix:O,color:oe,opacity:Ae})),K.push(ce)}K.length>0&&r.createEntity(je.apply(J,{id:N,isObject:!0,meshIds:K}))}}}(e,t,o,r,0,s)}},$E=window.pako||TE;$E.inflate||($E=$E.default);var eF=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function tF(e){for(var t=[],n=0,r=e.length;n<r;n+=3)t.push(e[n]),t.push(e[n+1]),t.push(e[n+2]),t.push(1);return t}var nF={version:7,parse:function(e,t,n,r,i,s){var a=function(e){return{positions:e[0],normals:e[1],colors:e[2],indices:e[3],edgeIndices:e[4],matrices:e[5],reusedGeometriesDecodeMatrix:e[6],eachGeometryPrimitiveType:e[7],eachGeometryPositionsPortion:e[8],eachGeometryNormalsPortion:e[9],eachGeometryColorsPortion:e[10],eachGeometryIndicesPortion:e[11],eachGeometryEdgeIndicesPortion:e[12],eachMeshGeometriesPortion:e[13],eachMeshMatricesPortion:e[14],eachMeshMaterial:e[15],eachEntityId:e[16],eachEntityMeshesPortion:e[17],eachTileAABB:e[18],eachTileEntitiesPortion:e[19]}}(n),o=function(e){function t(e,t){return 0===e.length?[]:$E.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:$E.inflate(e.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(a);!function(e,t,n,r,i,s){for(var a=s.getNextId(),o=n.positions,A=n.normals,c=n.colors,l=n.indices,u=n.edgeIndices,h=n.matrices,d=n.reusedGeometriesDecodeMatrix,f=n.eachGeometryPrimitiveType,p=n.eachGeometryPositionsPortion,v=n.eachGeometryNormalsPortion,g=n.eachGeometryColorsPortion,m=n.eachGeometryIndicesPortion,y=n.eachGeometryEdgeIndicesPortion,_=n.eachMeshGeometriesPortion,b=n.eachMeshMatricesPortion,w=n.eachMeshMaterial,B=JSON.parse(n.eachEntityId),C=n.eachEntityMeshesPortion,M=n.eachTileAABB,k=n.eachTileEntitiesPortion,E=p.length,F=_.length,x=B.length,U=k.length,I=new Uint32Array(E),T=0;T<F;T++){var P=_[T];void 0!==I[P]?I[P]++:I[P]=1}for(var S=De.vec3(),D=De.AABB3(),Q=0;Q<U;Q++){var R=Q===U-1,O=k[Q],V=R?x:k[Q+1],L=6*Q,H=M.subarray(L,L+6);De.getAABB3Center(H,S),D[0]=H[0]-S[0],D[1]=H[1]-S[1],D[2]=H[2]-S[2],D[3]=H[3]-S[0],D[4]=H[4]-S[1],D[5]=H[5]-S[2];for(var N=Nt.createPositionsDecodeMatrix(D),G={},j=O;j<V;j++){var W=B[j],z=t.globalizeObjectIds?De.globalizeObjectId(r.id,W):W,X=j===x-1,K=C[j],Z=X?_.length:C[j+1],J=[],Y=e.metaScene.metaObjects[z],q={},$={};if(Y){if(t.excludeTypesMap&&Y.type&&t.excludeTypesMap[Y.type])continue;if(t.includeTypesMap&&Y.type&&!t.includeTypesMap[Y.type])continue;if(t.includeIdsMap&&Y.id&&!t.includeIdsMap[Y.id])continue;var ee=t.objectDefaults?t.objectDefaults[Y.type]||t.objectDefaults.DEFAULT:null;ee&&(!1===ee.visible&&(q.visible=!1),!1===ee.pickable&&(q.pickable=!1),ee.colorize&&($.color=ee.colorize),void 0!==ee.opacity&&null!==ee.opacity&&($.opacity=ee.opacity),void 0!==ee.metallic&&null!==ee.metallic&&($.metallic=ee.metallic),void 0!==ee.roughness&&null!==ee.roughness&&($.roughness=ee.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var te=K;te<Z;te++){var ne=_[te],re=I[ne]>1,ie=ne===E-1,se=eF(w.subarray(6*te,6*te+3)),ae=w[6*te+3]/255,oe=w[6*te+4]/255,Ae=w[6*te+5]/255,ce=s.getNextId();if(re){var le=b[te],ue=h.slice(le,le+16),he="".concat(a,"-geometry.").concat(Q,".").concat(ne);if(!G[he]){var de=void 0,fe=void 0,pe=void 0,ve=void 0,ge=void 0,me=void 0;switch(f[ne]){case 0:de="solid",fe=o.subarray(p[ne],ie?o.length:p[ne+1]),pe=A.subarray(v[ne],ie?A.length:v[ne+1]),ge=l.subarray(m[ne],ie?l.length:m[ne+1]),me=u.subarray(y[ne],ie?u.length:y[ne+1]);break;case 1:de="surface",fe=o.subarray(p[ne],ie?o.length:p[ne+1]),pe=A.subarray(v[ne],ie?A.length:v[ne+1]),ge=l.subarray(m[ne],ie?l.length:m[ne+1]),me=u.subarray(y[ne],ie?u.length:y[ne+1]);break;case 2:de="points",fe=o.subarray(p[ne],ie?o.length:p[ne+1]),ve=tF(c.subarray(g[ne],ie?c.length:g[ne+1]));break;case 3:de="lines",fe=o.subarray(p[ne],ie?o.length:p[ne+1]),ge=l.subarray(m[ne],ie?l.length:m[ne+1]);break;default:continue}r.createGeometry({id:he,primitive:de,positionsCompressed:fe,normalsCompressed:pe,colors:ve,indices:ge,edgeIndices:me,positionsDecodeMatrix:d}),G[he]=!0}r.createMesh(je.apply($,{id:ce,geometryId:he,origin:S,matrix:ue,color:se,metallic:oe,roughness:Ae,opacity:ae})),J.push(ce)}else{var ye=void 0,_e=void 0,be=void 0,we=void 0,Be=void 0,Ce=void 0;switch(f[ne]){case 0:ye="solid",_e=o.subarray(p[ne],ie?o.length:p[ne+1]),be=A.subarray(v[ne],ie?A.length:v[ne+1]),Be=l.subarray(m[ne],ie?l.length:m[ne+1]),Ce=u.subarray(y[ne],ie?u.length:y[ne+1]);break;case 1:ye="surface",_e=o.subarray(p[ne],ie?o.length:p[ne+1]),be=A.subarray(v[ne],ie?A.length:v[ne+1]),Be=l.subarray(m[ne],ie?l.length:m[ne+1]),Ce=u.subarray(y[ne],ie?u.length:y[ne+1]);break;case 2:ye="points",_e=o.subarray(p[ne],ie?o.length:p[ne+1]),we=tF(c.subarray(g[ne],ie?c.length:g[ne+1]));break;case 3:ye="lines",_e=o.subarray(p[ne],ie?o.length:p[ne+1]),Be=l.subarray(m[ne],ie?l.length:m[ne+1]);break;default:continue}r.createMesh(je.apply($,{id:ce,origin:S,primitive:ye,positionsCompressed:_e,normalsCompressed:be,colors:we,indices:Be,edgeIndices:Ce,positionsDecodeMatrix:N,color:se,metallic:oe,roughness:Ae,opacity:ae})),J.push(ce)}}J.length>0&&r.createEntity(je.apply(q,{id:z,isObject:!0,meshIds:J}))}}}(e,t,o,r,0,s)}},rF=window.pako||TE;rF.inflate||(rF=rF.default);var iF=De.vec4(),sF=De.vec4();var aF=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function oF(e){for(var t=[],n=0,r=e.length;n<r;n+=3)t.push(e[n]),t.push(e[n+1]),t.push(e[n+2]),t.push(1);return t}var AF={version:8,parse:function(e,t,n,r,i,s){var a=function(e){return{types:e[0],eachMetaObjectId:e[1],eachMetaObjectType:e[2],eachMetaObjectName:e[3],eachMetaObjectParent:e[4],positions:e[5],normals:e[6],colors:e[7],indices:e[8],edgeIndices:e[9],matrices:e[10],reusedGeometriesDecodeMatrix:e[11],eachGeometryPrimitiveType:e[12],eachGeometryPositionsPortion:e[13],eachGeometryNormalsPortion:e[14],eachGeometryColorsPortion:e[15],eachGeometryIndicesPortion:e[16],eachGeometryEdgeIndicesPortion:e[17],eachMeshGeometriesPortion:e[18],eachMeshMatricesPortion:e[19],eachMeshMaterial:e[20],eachEntityMetaObject:e[21],eachEntityMeshesPortion:e[22],eachTileAABB:e[23],eachTileEntitiesPortion:e[24]}}(n),o=function(e){function t(e,t){return 0===e.length?[]:rF.inflate(e,t).buffer}return{types:rF.inflate(e.types,{to:"string"}),eachMetaObjectId:rF.inflate(e.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(t(e.eachMetaObjectType)),eachMetaObjectName:rF.inflate(e.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(t(e.eachMetaObjectParent)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(t(e.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(a);!function(e,t,n,r,i,s){var a=s.getNextId(),o=JSON.parse(n.types),A=JSON.parse(n.eachMetaObjectId),c=n.eachMetaObjectType,l=JSON.parse(n.eachMetaObjectName),u=n.eachMetaObjectParent,h=n.positions,d=n.normals,f=n.colors,p=n.indices,v=n.edgeIndices,g=n.matrices,m=n.reusedGeometriesDecodeMatrix,y=n.eachGeometryPrimitiveType,_=n.eachGeometryPositionsPortion,b=n.eachGeometryNormalsPortion,w=n.eachGeometryColorsPortion,B=n.eachGeometryIndicesPortion,C=n.eachGeometryEdgeIndicesPortion,M=n.eachMeshGeometriesPortion,k=n.eachMeshMatricesPortion,E=n.eachMeshMaterial,F=n.eachEntityMetaObject,x=n.eachEntityMeshesPortion,U=n.eachTileAABB,I=n.eachTileEntitiesPortion,T=A.length,P=_.length,S=M.length,D=F.length,Q=I.length;if(i){for(var R={metaObjects:[]},O=0;O<T;O++){var V=A[O],L=o[c[O]]||"default",H=l[O],N=u[O],G=N!==O?A[N]:null;R.metaObjects.push({id:V,type:L,name:H,parent:G})}i.loadData(R,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds})}for(var j=new Uint32Array(P),W=0;W<S;W++){var z=M[W];void 0!==j[z]?j[z]++:j[z]=1}for(var X=De.vec3(),K=De.AABB3(),Z={},J=0;J<Q;J++){var Y=J===Q-1,q=I[J],$=Y?D:I[J+1],ee=6*J,te=U.subarray(ee,ee+6);De.getAABB3Center(te,X),K[0]=te[0]-X[0],K[1]=te[1]-X[1],K[2]=te[2]-X[2],K[3]=te[3]-X[0],K[4]=te[4]-X[1],K[5]=te[5]-X[2];for(var ne=Nt.createPositionsDecodeMatrix(K),re={},ie=q;ie<$;ie++){var se=A[F[ie]],ae=t.globalizeObjectIds?De.globalizeObjectId(r.id,se):se,oe=ie===D-1,Ae=x[ie],ce=oe?M.length:x[ie+1],le=[],ue=e.metaScene.metaObjects[ae],he={},de={};if(ue){if(t.excludeTypesMap&&ue.type&&t.excludeTypesMap[ue.type])continue;if(t.includeTypesMap&&ue.type&&!t.includeTypesMap[ue.type])continue;if(t.includeIdsMap&&ue.id&&!t.includeIdsMap[ue.id])continue;var fe=t.objectDefaults?t.objectDefaults[ue.type]||t.objectDefaults.DEFAULT:null;fe&&(!1===fe.visible&&(he.visible=!1),!1===fe.pickable&&(he.pickable=!1),fe.colorize&&(de.color=fe.colorize),void 0!==fe.opacity&&null!==fe.opacity&&(de.opacity=fe.opacity),void 0!==fe.metallic&&null!==fe.metallic&&(de.metallic=fe.metallic),void 0!==fe.roughness&&null!==fe.roughness&&(de.roughness=fe.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var pe=Ae;pe<ce;pe++){var ve=M[pe],ge=j[ve]>1,me=ve===P-1,ye=aF(E.subarray(6*pe,6*pe+3)),_e=E[6*pe+3]/255,be=E[6*pe+4]/255,we=E[6*pe+5]/255,Be=s.getNextId();if(ge){var Ce=k[pe],Me=g.slice(Ce,Ce+16),ke="".concat(a,"-geometry.").concat(J,".").concat(ve),Ee=Z[ke];if(!Ee){Ee={batchThisMesh:!t.reuseGeometries};var Fe=!1;switch(y[ve]){case 0:Ee.primitiveName="solid",Ee.geometryPositions=h.subarray(_[ve],me?h.length:_[ve+1]),Ee.geometryNormals=d.subarray(b[ve],me?d.length:b[ve+1]),Ee.geometryIndices=p.subarray(B[ve],me?p.length:B[ve+1]),Ee.geometryEdgeIndices=v.subarray(C[ve],me?v.length:C[ve+1]),Fe=Ee.geometryPositions.length>0&&Ee.geometryIndices.length>0;break;case 1:Ee.primitiveName="surface",Ee.geometryPositions=h.subarray(_[ve],me?h.length:_[ve+1]),Ee.geometryNormals=d.subarray(b[ve],me?d.length:b[ve+1]),Ee.geometryIndices=p.subarray(B[ve],me?p.length:B[ve+1]),Ee.geometryEdgeIndices=v.subarray(C[ve],me?v.length:C[ve+1]),Fe=Ee.geometryPositions.length>0&&Ee.geometryIndices.length>0;break;case 2:Ee.primitiveName="points",Ee.geometryPositions=h.subarray(_[ve],me?h.length:_[ve+1]),Ee.geometryColors=oF(f.subarray(w[ve],me?f.length:w[ve+1])),Fe=Ee.geometryPositions.length>0;break;case 3:Ee.primitiveName="lines",Ee.geometryPositions=h.subarray(_[ve],me?h.length:_[ve+1]),Ee.geometryIndices=p.subarray(B[ve],me?p.length:B[ve+1]),Fe=Ee.geometryPositions.length>0&&Ee.geometryIndices.length>0;break;default:continue}if(Fe||(Ee=null),Ee&&(Ee.geometryPositions.length,Ee.batchThisMesh)){Ee.decompressedPositions=new Float32Array(Ee.geometryPositions.length);for(var xe=Ee.geometryPositions,Ue=Ee.decompressedPositions,Ie=0,Te=xe.length;Ie<Te;Ie+=3)Ue[Ie+0]=xe[Ie+0]*m[0]+m[12],Ue[Ie+1]=xe[Ie+1]*m[5]+m[13],Ue[Ie+2]=xe[Ie+2]*m[10]+m[14];Ee.geometryPositions=null,Z[ke]=Ee}}if(Ee)if(Ee.batchThisMesh){for(var Pe=Ee.decompressedPositions,Se=new Uint16Array(Pe.length),Qe=0,Re=Pe.length;Qe<Re;Qe+=3)iF[0]=Pe[Qe+0],iF[1]=Pe[Qe+1],iF[2]=Pe[Qe+2],iF[3]=1,De.transformVec4(Me,iF,sF),Nt.compressPosition(sF,K,iF),Se[Qe+0]=iF[0],Se[Qe+1]=iF[1],Se[Qe+2]=iF[2];r.createMesh(je.apply(de,{id:Be,origin:X,primitive:Ee.primitiveName,positionsCompressed:Se,normalsCompressed:Ee.geometryNormals,colorsCompressed:Ee.geometryColors,indices:Ee.geometryIndices,edgeIndices:Ee.geometryEdgeIndices,positionsDecodeMatrix:ne,color:ye,metallic:be,roughness:we,opacity:_e})),le.push(Be)}else re[ke]||(r.createGeometry({id:ke,primitive:Ee.primitiveName,positionsCompressed:Ee.geometryPositions,normalsCompressed:Ee.geometryNormals,colorsCompressed:Ee.geometryColors,indices:Ee.geometryIndices,edgeIndices:Ee.geometryEdgeIndices,positionsDecodeMatrix:m}),re[ke]=!0),r.createMesh(je.apply(de,{id:Be,geometryId:ke,origin:X,matrix:Me,color:ye,metallic:be,roughness:we,opacity:_e})),le.push(Be)}else{var Oe=void 0,Ve=void 0,Le=void 0,He=void 0,Ne=void 0,Ge=void 0,We=!1;switch(y[ve]){case 0:Oe="solid",Ve=h.subarray(_[ve],me?h.length:_[ve+1]),Le=d.subarray(b[ve],me?d.length:b[ve+1]),Ne=p.subarray(B[ve],me?p.length:B[ve+1]),Ge=v.subarray(C[ve],me?v.length:C[ve+1]),We=Ve.length>0&&Ne.length>0;break;case 1:Oe="surface",Ve=h.subarray(_[ve],me?h.length:_[ve+1]),Le=d.subarray(b[ve],me?d.length:b[ve+1]),Ne=p.subarray(B[ve],me?p.length:B[ve+1]),Ge=v.subarray(C[ve],me?v.length:C[ve+1]),We=Ve.length>0&&Ne.length>0;break;case 2:Oe="points",Ve=h.subarray(_[ve],me?h.length:_[ve+1]),He=oF(f.subarray(w[ve],me?f.length:w[ve+1])),We=Ve.length>0;break;case 3:Oe="lines",Ve=h.subarray(_[ve],me?h.length:_[ve+1]),Ne=p.subarray(B[ve],me?p.length:B[ve+1]),We=Ve.length>0&&Ne.length>0;break;default:continue}We&&(r.createMesh(je.apply(de,{id:Be,origin:X,primitive:Oe,positionsCompressed:Ve,normalsCompressed:Le,colorsCompressed:He,indices:Ne,edgeIndices:Ge,positionsDecodeMatrix:ne,color:ye,metallic:be,roughness:we,opacity:_e})),le.push(Be))}}le.length>0&&r.createEntity(je.apply(he,{id:ae,isObject:!0,meshIds:le}))}}}(e,t,o,r,i,s)}},cF=window.pako||TE;cF.inflate||(cF=cF.default);var lF=De.vec4(),uF=De.vec4();var hF=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();var dF={version:9,parse:function(e,t,n,r,i,s){var a=function(e){return{metadata:e[0],positions:e[1],normals:e[2],colors:e[3],indices:e[4],edgeIndices:e[5],matrices:e[6],reusedGeometriesDecodeMatrix:e[7],eachGeometryPrimitiveType:e[8],eachGeometryPositionsPortion:e[9],eachGeometryNormalsPortion:e[10],eachGeometryColorsPortion:e[11],eachGeometryIndicesPortion:e[12],eachGeometryEdgeIndicesPortion:e[13],eachMeshGeometriesPortion:e[14],eachMeshMatricesPortion:e[15],eachMeshMaterial:e[16],eachEntityId:e[17],eachEntityMeshesPortion:e[18],eachTileAABB:e[19],eachTileEntitiesPortion:e[20]}}(n),o=function(e){function t(e,t){return 0===e.length?[]:cF.inflate(e,t).buffer}return{metadata:JSON.parse(cF.inflate(e.metadata,{to:"string"})),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:JSON.parse(cF.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(a);!function(e,t,n,r,i,s){var a=s.getNextId(),o=n.metadata,A=n.positions,c=n.normals,l=n.colors,u=n.indices,h=n.edgeIndices,d=n.matrices,f=n.reusedGeometriesDecodeMatrix,p=n.eachGeometryPrimitiveType,v=n.eachGeometryPositionsPortion,g=n.eachGeometryNormalsPortion,m=n.eachGeometryColorsPortion,y=n.eachGeometryIndicesPortion,_=n.eachGeometryEdgeIndicesPortion,b=n.eachMeshGeometriesPortion,w=n.eachMeshMatricesPortion,B=n.eachMeshMaterial,C=n.eachEntityId,M=n.eachEntityMeshesPortion,k=n.eachTileAABB,E=n.eachTileEntitiesPortion,F=v.length,x=b.length,U=M.length,I=E.length;i&&i.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(var T=new Uint32Array(F),P=0;P<x;P++){var S=b[P];void 0!==T[S]?T[S]++:T[S]=1}for(var D=De.vec3(),Q=De.AABB3(),R={},O=0;O<I;O++){var V=O===I-1,L=E[O],H=V?U-1:E[O+1]-1,N=6*O,G=k.subarray(N,N+6);De.getAABB3Center(G,D),Q[0]=G[0]-D[0],Q[1]=G[1]-D[1],Q[2]=G[2]-D[2],Q[3]=G[3]-D[0],Q[4]=G[4]-D[1],Q[5]=G[5]-D[2];for(var j=Nt.createPositionsDecodeMatrix(Q),W={},z=L;z<=H;z++){var X=C[z],K=t.globalizeObjectIds?De.globalizeObjectId(r.id,X):X,Z=z===U-1,J=M[z],Y=Z?b.length-1:M[z+1]-1,q=[],$=e.metaScene.metaObjects[K],ee={},te={};if($){if(t.excludeTypesMap&&$.type&&t.excludeTypesMap[$.type])continue;if(t.includeTypesMap&&$.type&&!t.includeTypesMap[$.type])continue;if(t.includeIdsMap&&$.id&&!t.includeIdsMap[$.id])continue;var ne=t.objectDefaults?t.objectDefaults[$.type]||t.objectDefaults.DEFAULT:null;ne&&(!1===ne.visible&&(ee.visible=!1),!1===ne.pickable&&(ee.pickable=!1),ne.colorize&&(te.color=ne.colorize),void 0!==ne.opacity&&null!==ne.opacity&&(te.opacity=ne.opacity),void 0!==ne.metallic&&null!==ne.metallic&&(te.metallic=ne.metallic),void 0!==ne.roughness&&null!==ne.roughness&&(te.roughness=ne.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var re=J;re<=Y;re++){var ie=b[re],se=T[ie]>1,ae=ie===F-1,oe=hF(B.subarray(6*re,6*re+3)),Ae=B[6*re+3]/255,ce=B[6*re+4]/255,le=B[6*re+5]/255,ue=s.getNextId();if(se){var he=w[re],de=d.slice(he,he+16),fe="".concat(a,"-geometry.").concat(O,".").concat(ie),pe=R[fe];if(!pe){pe={batchThisMesh:!t.reuseGeometries};var ve=!1;switch(p[ie]){case 0:pe.primitiveName="solid",pe.geometryPositions=A.subarray(v[ie],ae?A.length:v[ie+1]),pe.geometryNormals=c.subarray(g[ie],ae?c.length:g[ie+1]),pe.geometryIndices=u.subarray(y[ie],ae?u.length:y[ie+1]),pe.geometryEdgeIndices=h.subarray(_[ie],ae?h.length:_[ie+1]),ve=pe.geometryPositions.length>0&&pe.geometryIndices.length>0;break;case 1:pe.primitiveName="surface",pe.geometryPositions=A.subarray(v[ie],ae?A.length:v[ie+1]),pe.geometryNormals=c.subarray(g[ie],ae?c.length:g[ie+1]),pe.geometryIndices=u.subarray(y[ie],ae?u.length:y[ie+1]),pe.geometryEdgeIndices=h.subarray(_[ie],ae?h.length:_[ie+1]),ve=pe.geometryPositions.length>0&&pe.geometryIndices.length>0;break;case 2:pe.primitiveName="points",pe.geometryPositions=A.subarray(v[ie],ae?A.length:v[ie+1]),pe.geometryColors=l.subarray(m[ie],ae?l.length:m[ie+1]),ve=pe.geometryPositions.length>0;break;case 3:pe.primitiveName="lines",pe.geometryPositions=A.subarray(v[ie],ae?A.length:v[ie+1]),pe.geometryIndices=u.subarray(y[ie],ae?u.length:y[ie+1]),ve=pe.geometryPositions.length>0&&pe.geometryIndices.length>0;break;default:continue}if(ve||(pe=null),pe&&(pe.geometryPositions.length,pe.batchThisMesh)){pe.decompressedPositions=new Float32Array(pe.geometryPositions.length),pe.transformedAndRecompressedPositions=new Uint16Array(pe.geometryPositions.length);for(var ge=pe.geometryPositions,me=pe.decompressedPositions,ye=0,_e=ge.length;ye<_e;ye+=3)me[ye+0]=ge[ye+0]*f[0]+f[12],me[ye+1]=ge[ye+1]*f[5]+f[13],me[ye+2]=ge[ye+2]*f[10]+f[14];pe.geometryPositions=null,R[fe]=pe}}if(pe)if(pe.batchThisMesh){for(var be=pe.decompressedPositions,we=pe.transformedAndRecompressedPositions,Be=0,Ce=be.length;Be<Ce;Be+=3)lF[0]=be[Be+0],lF[1]=be[Be+1],lF[2]=be[Be+2],lF[3]=1,De.transformVec4(de,lF,uF),Nt.compressPosition(uF,Q,lF),we[Be+0]=lF[0],we[Be+1]=lF[1],we[Be+2]=lF[2];r.createMesh(je.apply(te,{id:ue,origin:D,primitive:pe.primitiveName,positionsCompressed:we,normalsCompressed:pe.geometryNormals,colorsCompressed:pe.geometryColors,indices:pe.geometryIndices,edgeIndices:pe.geometryEdgeIndices,positionsDecodeMatrix:j,color:oe,metallic:ce,roughness:le,opacity:Ae})),q.push(ue)}else W[fe]||(r.createGeometry({id:fe,primitive:pe.primitiveName,positionsCompressed:pe.geometryPositions,normalsCompressed:pe.geometryNormals,colorsCompressed:pe.geometryColors,indices:pe.geometryIndices,edgeIndices:pe.geometryEdgeIndices,positionsDecodeMatrix:f}),W[fe]=!0),r.createMesh(je.apply(te,{id:ue,geometryId:fe,origin:D,matrix:de,color:oe,metallic:ce,roughness:le,opacity:Ae})),q.push(ue)}else{var Me=void 0,ke=void 0,Ee=void 0,Fe=void 0,xe=void 0,Ue=void 0,Ie=!1;switch(p[ie]){case 0:Me="solid",ke=A.subarray(v[ie],ae?A.length:v[ie+1]),Ee=c.subarray(g[ie],ae?c.length:g[ie+1]),xe=u.subarray(y[ie],ae?u.length:y[ie+1]),Ue=h.subarray(_[ie],ae?h.length:_[ie+1]),Ie=ke.length>0&&xe.length>0;break;case 1:Me="surface",ke=A.subarray(v[ie],ae?A.length:v[ie+1]),Ee=c.subarray(g[ie],ae?c.length:g[ie+1]),xe=u.subarray(y[ie],ae?u.length:y[ie+1]),Ue=h.subarray(_[ie],ae?h.length:_[ie+1]),Ie=ke.length>0&&xe.length>0;break;case 2:Me="points",ke=A.subarray(v[ie],ae?A.length:v[ie+1]),Fe=l.subarray(m[ie],ae?l.length:m[ie+1]),Ie=ke.length>0;break;case 3:Me="lines",ke=A.subarray(v[ie],ae?A.length:v[ie+1]),xe=u.subarray(y[ie],ae?u.length:y[ie+1]),Ie=ke.length>0&&xe.length>0;break;default:continue}Ie&&(r.createMesh(je.apply(te,{id:ue,origin:D,primitive:Me,positionsCompressed:ke,normalsCompressed:Ee,colorsCompressed:Fe,indices:xe,edgeIndices:Ue,positionsDecodeMatrix:j,color:oe,metallic:ce,roughness:le,opacity:Ae})),q.push(ue))}}q.length>0&&r.createEntity(je.apply(ee,{id:K,isObject:!0,meshIds:q}))}}}(e,t,o,r,i,s)}},fF=window.pako||TE;fF.inflate||(fF=fF.default);var pF=De.vec4(),vF=De.vec4();var gF=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function mF(e,t){var n=[];if(t.length>1)for(var r=0,i=t.length-1;r<i;r++)n.push(t[r]),n.push(t[r+1]);else if(e.length>1)for(var s=0,a=e.length/3-1;s<a;s++)n.push(s),n.push(s+1);return n}!function(){var e=document.createElement("canvas"),t=e.getContext("2d")}();var yF={version:10,parse:function(e,t,n,r,i,s){var a=function(e){var t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(n),o=function(e){function t(e,t){return 0===e.length?[]:fF.inflate(e,t).buffer}return{metadata:JSON.parse(fF.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(fF.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(a);!function(e,t,n,r,i,s){var a=s.getNextId(),o=n.metadata,A=n.textureData,c=n.eachTextureDataPortion,l=n.eachTextureAttributes,u=n.positions,h=n.normals,d=n.colors,f=n.uvs,p=n.indices,v=n.edgeIndices,g=n.eachTextureSetTextures,m=n.matrices,y=n.reusedGeometriesDecodeMatrix,_=n.eachGeometryPrimitiveType,b=n.eachGeometryPositionsPortion,w=n.eachGeometryNormalsPortion,B=n.eachGeometryColorsPortion,C=n.eachGeometryUVsPortion,M=n.eachGeometryIndicesPortion,k=n.eachGeometryEdgeIndicesPortion,E=n.eachMeshGeometriesPortion,F=n.eachMeshMatricesPortion,x=n.eachMeshTextureSet,U=n.eachMeshMaterialAttributes,I=n.eachEntityId,T=n.eachEntityMeshesPortion,P=n.eachTileAABB,S=n.eachTileEntitiesPortion,D=c.length,Q=g.length/5,R=b.length,O=E.length,V=T.length,L=S.length;i&&i.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(var H=0;H<D;H++){var N=H===D-1,G=c[H],j=N?A.length:c[H+1],W=j-G>0,z=9*H,X=1===l[z+0],K=l[z+1];l[z+2],l[z+3];var Z=l[z+4],J=l[z+5],Y=l[z+6],q=l[z+7],$=l[z+8];if(W){var ee=new Uint8Array(A.subarray(G,j)).buffer,te="".concat(a,"-texture-").concat(H);if(X)r.createTexture({id:te,buffers:[ee],minFilter:Z,magFilter:J,wrapS:Y,wrapT:q,wrapR:$});else{var ne=new Blob([ee],{type:10001===K?"image/jpeg":10002===K?"image/png":"image/gif"}),re=(window.URL||window.webkitURL).createObjectURL(ne),ie=document.createElement("img");ie.src=re,r.createTexture({id:te,image:ie,minFilter:Z,magFilter:J,wrapS:Y,wrapT:q,wrapR:$})}}}for(var se=0;se<Q;se++){var ae=5*se,oe="".concat(a,"-textureSet-").concat(se),Ae=g[ae+0],ce=g[ae+1],le=g[ae+2],ue=g[ae+3],he=g[ae+4];r.createTextureSet({id:oe,colorTextureId:Ae>=0?"".concat(a,"-texture-").concat(Ae):null,normalsTextureId:le>=0?"".concat(a,"-texture-").concat(le):null,metallicRoughnessTextureId:ce>=0?"".concat(a,"-texture-").concat(ce):null,emissiveTextureId:ue>=0?"".concat(a,"-texture-").concat(ue):null,occlusionTextureId:he>=0?"".concat(a,"-texture-").concat(he):null})}for(var de=new Uint32Array(R),fe=0;fe<O;fe++){var pe=E[fe];void 0!==de[pe]?de[pe]++:de[pe]=1}for(var ve=De.vec3(),ge=De.AABB3(),me={},ye=0;ye<L;ye++){var _e=ye===L-1,be=S[ye],we=_e?V-1:S[ye+1]-1,Be=6*ye,Ce=P.subarray(Be,Be+6);De.getAABB3Center(Ce,ve),ge[0]=Ce[0]-ve[0],ge[1]=Ce[1]-ve[1],ge[2]=Ce[2]-ve[2],ge[3]=Ce[3]-ve[0],ge[4]=Ce[4]-ve[1],ge[5]=Ce[5]-ve[2];for(var Me=Nt.createPositionsDecodeMatrix(ge),ke={},Ee=be;Ee<=we;Ee++){var Fe=I[Ee],xe=t.globalizeObjectIds?De.globalizeObjectId(r.id,Fe):Fe,Ue=Ee===V-1,Ie=T[Ee],Te=Ue?E.length-1:T[Ee+1]-1,Pe=[],Se=e.metaScene.metaObjects[xe],Qe={},Re={};if(Se){if(t.excludeTypesMap&&Se.type&&t.excludeTypesMap[Se.type])continue;if(t.includeTypesMap&&Se.type&&!t.includeTypesMap[Se.type])continue;if(t.includeIdsMap&&Se.id&&!t.includeIdsMap[Se.id])continue;var Oe=t.objectDefaults?t.objectDefaults[Se.type]||t.objectDefaults.DEFAULT:null;Oe&&(!1===Oe.visible&&(Qe.visible=!1),!1===Oe.pickable&&(Qe.pickable=!1),Oe.colorize&&(Re.color=Oe.colorize),void 0!==Oe.opacity&&null!==Oe.opacity&&(Re.opacity=Oe.opacity),void 0!==Oe.metallic&&null!==Oe.metallic&&(Re.metallic=Oe.metallic),void 0!==Oe.roughness&&null!==Oe.roughness&&(Re.roughness=Oe.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var Ve=Ie;Ve<=Te;Ve++){var Le=E[Ve],He=de[Le]>1,Ne=Le===R-1,Ge=x[Ve],We=Ge>=0?"".concat(a,"-textureSet-").concat(Ge):null,ze=gF(U.subarray(6*Ve,6*Ve+3)),Xe=U[6*Ve+3]/255,Ke=U[6*Ve+4]/255,Ze=U[6*Ve+5]/255,Je=s.getNextId();if(He){var Ye=F[Ve],qe=m.slice(Ye,Ye+16),$e="".concat(a,"-geometry.").concat(ye,".").concat(Le),et=me[$e];if(!et){et={batchThisMesh:!t.reuseGeometries};var tt=!1;switch(_[Le]){case 0:et.primitiveName="solid",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryNormals=h.subarray(w[Le],Ne?h.length:w[Le+1]),et.geometryUVs=f.subarray(C[Le],Ne?f.length:C[Le+1]),et.geometryIndices=p.subarray(M[Le],Ne?p.length:M[Le+1]),et.geometryEdgeIndices=v.subarray(k[Le],Ne?v.length:k[Le+1]),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;case 1:et.primitiveName="surface",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryNormals=h.subarray(w[Le],Ne?h.length:w[Le+1]),et.geometryUVs=f.subarray(C[Le],Ne?f.length:C[Le+1]),et.geometryIndices=p.subarray(M[Le],Ne?p.length:M[Le+1]),et.geometryEdgeIndices=v.subarray(k[Le],Ne?v.length:k[Le+1]),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;case 2:et.primitiveName="points",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryColors=d.subarray(B[Le],Ne?d.length:B[Le+1]),tt=et.geometryPositions.length>0;break;case 3:et.primitiveName="lines",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryIndices=p.subarray(M[Le],Ne?p.length:M[Le+1]),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;case 4:et.primitiveName="lines",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryIndices=mF(et.geometryPositions,p.subarray(M[Le],Ne?p.length:M[Le+1])),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;default:continue}if(tt||(et=null),et&&(et.geometryPositions.length,et.batchThisMesh)){et.decompressedPositions=new Float32Array(et.geometryPositions.length),et.transformedAndRecompressedPositions=new Uint16Array(et.geometryPositions.length);for(var nt=et.geometryPositions,rt=et.decompressedPositions,it=0,st=nt.length;it<st;it+=3)rt[it+0]=nt[it+0]*y[0]+y[12],rt[it+1]=nt[it+1]*y[5]+y[13],rt[it+2]=nt[it+2]*y[10]+y[14];et.geometryPositions=null,me[$e]=et}}if(et)if(et.batchThisMesh){for(var at=et.decompressedPositions,ot=et.transformedAndRecompressedPositions,At=0,ct=at.length;At<ct;At+=3)pF[0]=at[At+0],pF[1]=at[At+1],pF[2]=at[At+2],pF[3]=1,De.transformVec4(qe,pF,vF),Nt.compressPosition(vF,ge,pF),ot[At+0]=pF[0],ot[At+1]=pF[1],ot[At+2]=pF[2];r.createMesh(je.apply(Re,{id:Je,textureSetId:We,origin:ve,primitive:et.primitiveName,positionsCompressed:ot,normalsCompressed:et.geometryNormals,uv:et.geometryUVs,colorsCompressed:et.geometryColors,indices:et.geometryIndices,edgeIndices:et.geometryEdgeIndices,positionsDecodeMatrix:Me,color:ze,metallic:Ke,roughness:Ze,opacity:Xe})),Pe.push(Je)}else ke[$e]||(r.createGeometry({id:$e,primitive:et.primitiveName,positionsCompressed:et.geometryPositions,normalsCompressed:et.geometryNormals,uv:et.geometryUVs,colorsCompressed:et.geometryColors,indices:et.geometryIndices,edgeIndices:et.geometryEdgeIndices,positionsDecodeMatrix:y}),ke[$e]=!0),r.createMesh(je.apply(Re,{id:Je,geometryId:$e,textureSetId:We,matrix:qe,color:ze,metallic:Ke,roughness:Ze,opacity:Xe,origin:ve})),Pe.push(Je)}else{var lt=void 0,ut=void 0,ht=void 0,dt=void 0,ft=void 0,pt=void 0,vt=void 0,gt=!1;switch(_[Le]){case 0:lt="solid",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),ht=h.subarray(w[Le],Ne?h.length:w[Le+1]),dt=f.subarray(C[Le],Ne?f.length:C[Le+1]),pt=p.subarray(M[Le],Ne?p.length:M[Le+1]),vt=v.subarray(k[Le],Ne?v.length:k[Le+1]),gt=ut.length>0&&pt.length>0;break;case 1:lt="surface",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),ht=h.subarray(w[Le],Ne?h.length:w[Le+1]),dt=f.subarray(C[Le],Ne?f.length:C[Le+1]),pt=p.subarray(M[Le],Ne?p.length:M[Le+1]),vt=v.subarray(k[Le],Ne?v.length:k[Le+1]),gt=ut.length>0&&pt.length>0;break;case 2:lt="points",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),ft=d.subarray(B[Le],Ne?d.length:B[Le+1]),gt=ut.length>0;break;case 3:lt="lines",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),pt=p.subarray(M[Le],Ne?p.length:M[Le+1]),gt=ut.length>0&&pt.length>0;break;case 4:lt="lines",pt=mF(ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),p.subarray(M[Le],Ne?p.length:M[Le+1])),gt=ut.length>0&&pt.length>0;break;default:continue}gt&&(r.createMesh(je.apply(Re,{id:Je,textureSetId:We,origin:ve,primitive:lt,positionsCompressed:ut,normalsCompressed:ht,uv:dt&&dt.length>0?dt:null,colorsCompressed:ft,indices:pt,edgeIndices:vt,positionsDecodeMatrix:Me,color:ze,metallic:Ke,roughness:Ze,opacity:Xe})),Pe.push(Je))}}Pe.length>0&&r.createEntity(je.apply(Qe,{id:xe,isObject:!0,meshIds:Pe}))}}}(e,t,o,r,i,s)}},_F=De.vec4(),bF=De.vec4();var wF=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function BF(e,t){var n=[];if(t.length>1)for(var r=0,i=t.length-1;r<i;r++)n.push(t[r]),n.push(t[r+1]);else if(e.length>1)for(var s=0,a=e.length/3-1;s<a;s++)n.push(s),n.push(s+1);return n}!function(){var e=document.createElement("canvas"),t=e.getContext("2d")}();var CF={version:11,parseArrayBuffer:function(e,t,n,r,i,s){var a=function(e){var t,n,r=(t=new ArrayBuffer(2),new Uint16Array(t)[0]=1,1!==new Uint8Array(t)[0]),i=function(){var t=0,n=new DataView(e);return function(i){var s=1+2*t++,a=n.getUint32(4*s,!0),o=n.getUint32(4*(s+1),!0),A=i.BYTES_PER_ELEMENT;if(r&&A>1)for(var c=new Uint8Array(e,a,o),l=A/2,u=c.length/A,h=0;h<u;h++)for(var d=h*A,f=0;f<l;f++){var p=d+f,v=d-f+A-1,g=c[p];c[p]=c[v],c[v]=g}return new i(e,a,o/A)}}(),s=(n=new TextDecoder,function(){return JSON.parse(n.decode(i(Uint8Array)))});return{metadata:s(),textureData:i(Uint8Array),eachTextureDataPortion:i(Uint32Array),eachTextureAttributes:i(Uint16Array),positions:i(Uint16Array),normals:i(Int8Array),colors:i(Uint8Array),uvs:i(Float32Array),indices:i(Uint32Array),edgeIndices:i(Uint32Array),eachTextureSetTextures:i(Int32Array),matrices:i(Float32Array),reusedGeometriesDecodeMatrix:i(Float32Array),eachGeometryPrimitiveType:i(Uint8Array),eachGeometryPositionsPortion:i(Uint32Array),eachGeometryNormalsPortion:i(Uint32Array),eachGeometryColorsPortion:i(Uint32Array),eachGeometryUVsPortion:i(Uint32Array),eachGeometryIndicesPortion:i(Uint32Array),eachGeometryEdgeIndicesPortion:i(Uint32Array),eachMeshGeometriesPortion:i(Uint32Array),eachMeshMatricesPortion:i(Uint32Array),eachMeshTextureSet:i(Int32Array),eachMeshMaterialAttributes:i(Uint8Array),eachEntityId:s(),eachEntityMeshesPortion:i(Uint32Array),eachTileAABB:i(Float64Array),eachTileEntitiesPortion:i(Uint32Array)}}(n);!function(e,t,n,r,i,s){var a=s.getNextId(),o=n.metadata,A=n.textureData,c=n.eachTextureDataPortion,l=n.eachTextureAttributes,u=n.positions,h=n.normals,d=n.colors,f=n.uvs,p=n.indices,v=n.edgeIndices,g=n.eachTextureSetTextures,m=n.matrices,y=n.reusedGeometriesDecodeMatrix,_=n.eachGeometryPrimitiveType,b=n.eachGeometryPositionsPortion,w=n.eachGeometryNormalsPortion,B=n.eachGeometryColorsPortion,C=n.eachGeometryUVsPortion,M=n.eachGeometryIndicesPortion,k=n.eachGeometryEdgeIndicesPortion,E=n.eachMeshGeometriesPortion,F=n.eachMeshMatricesPortion,x=n.eachMeshTextureSet,U=n.eachMeshMaterialAttributes,I=n.eachEntityId,T=n.eachEntityMeshesPortion,P=n.eachTileAABB,S=n.eachTileEntitiesPortion,D=c.length,Q=g.length/5,R=b.length,O=E.length,V=T.length,L=S.length;i&&i.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(var H=0;H<D;H++){var N=H===D-1,G=c[H],j=N?A.length:c[H+1],W=j-G>0,z=9*H,X=1===l[z+0],K=l[z+1];l[z+2],l[z+3];var Z=l[z+4],J=l[z+5],Y=l[z+6],q=l[z+7],$=l[z+8];if(W){var ee=new Uint8Array(A.subarray(G,j)).buffer,te="".concat(a,"-texture-").concat(H);if(X)r.createTexture({id:te,buffers:[ee],minFilter:Z,magFilter:J,wrapS:Y,wrapT:q,wrapR:$});else{var ne=new Blob([ee],{type:10001===K?"image/jpeg":10002===K?"image/png":"image/gif"}),re=(window.URL||window.webkitURL).createObjectURL(ne),ie=document.createElement("img");ie.src=re,r.createTexture({id:te,image:ie,minFilter:Z,magFilter:J,wrapS:Y,wrapT:q,wrapR:$})}}}for(var se=0;se<Q;se++){var ae=5*se,oe="".concat(a,"-textureSet-").concat(se),Ae=g[ae+0],ce=g[ae+1],le=g[ae+2],ue=g[ae+3],he=g[ae+4];r.createTextureSet({id:oe,colorTextureId:Ae>=0?"".concat(a,"-texture-").concat(Ae):null,normalsTextureId:le>=0?"".concat(a,"-texture-").concat(le):null,metallicRoughnessTextureId:ce>=0?"".concat(a,"-texture-").concat(ce):null,emissiveTextureId:ue>=0?"".concat(a,"-texture-").concat(ue):null,occlusionTextureId:he>=0?"".concat(a,"-texture-").concat(he):null})}for(var de=new Uint32Array(R),fe=0;fe<O;fe++){var pe=E[fe];void 0!==de[pe]?de[pe]++:de[pe]=1}for(var ve=De.vec3(),ge=De.AABB3(),me={},ye=0;ye<L;ye++){var _e=ye===L-1,be=S[ye],we=_e?V-1:S[ye+1]-1,Be=6*ye,Ce=P.subarray(Be,Be+6);De.getAABB3Center(Ce,ve),ge[0]=Ce[0]-ve[0],ge[1]=Ce[1]-ve[1],ge[2]=Ce[2]-ve[2],ge[3]=Ce[3]-ve[0],ge[4]=Ce[4]-ve[1],ge[5]=Ce[5]-ve[2];for(var Me=Nt.createPositionsDecodeMatrix(ge),ke={},Ee=be;Ee<=we;Ee++){var Fe=I[Ee],xe=t.globalizeObjectIds?De.globalizeObjectId(r.id,Fe):Fe,Ue=Ee===V-1,Ie=T[Ee],Te=Ue?E.length-1:T[Ee+1]-1,Pe=[],Se=e.metaScene.metaObjects[xe],Qe={},Re={};if(Se){if(t.excludeTypesMap&&Se.type&&t.excludeTypesMap[Se.type])continue;if(t.includeTypesMap&&Se.type&&!t.includeTypesMap[Se.type])continue;if(t.includeIdsMap&&Se.id&&!t.includeIdsMap[Se.id])continue;var Oe=t.objectDefaults?t.objectDefaults[Se.type]||t.objectDefaults.DEFAULT:null;Oe&&(!1===Oe.visible&&(Qe.visible=!1),!1===Oe.pickable&&(Qe.pickable=!1),Oe.colorize&&(Re.color=Oe.colorize),void 0!==Oe.opacity&&null!==Oe.opacity&&(Re.opacity=Oe.opacity),void 0!==Oe.metallic&&null!==Oe.metallic&&(Re.metallic=Oe.metallic),void 0!==Oe.roughness&&null!==Oe.roughness&&(Re.roughness=Oe.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var Ve=Ie;Ve<=Te;Ve++){var Le=E[Ve],He=de[Le]>1,Ne=Le===R-1,Ge=x[Ve],We=Ge>=0?"".concat(a,"-textureSet-").concat(Ge):null,ze=wF(U.subarray(6*Ve,6*Ve+3)),Xe=U[6*Ve+3]/255,Ke=U[6*Ve+4]/255,Ze=U[6*Ve+5]/255,Je=s.getNextId();if(He){var Ye=F[Ve],qe=m.slice(Ye,Ye+16),$e="".concat(a,"-geometry.").concat(ye,".").concat(Le),et=me[$e];if(!et){et={batchThisMesh:!t.reuseGeometries};var tt=!1;switch(_[Le]){case 0:et.primitiveName="solid",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryNormals=h.subarray(w[Le],Ne?h.length:w[Le+1]),et.geometryUVs=f.subarray(C[Le],Ne?f.length:C[Le+1]),et.geometryIndices=p.subarray(M[Le],Ne?p.length:M[Le+1]),et.geometryEdgeIndices=v.subarray(k[Le],Ne?v.length:k[Le+1]),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;case 1:et.primitiveName="surface",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryNormals=h.subarray(w[Le],Ne?h.length:w[Le+1]),et.geometryUVs=f.subarray(C[Le],Ne?f.length:C[Le+1]),et.geometryIndices=p.subarray(M[Le],Ne?p.length:M[Le+1]),et.geometryEdgeIndices=v.subarray(k[Le],Ne?v.length:k[Le+1]),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;case 2:et.primitiveName="points",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryColors=d.subarray(B[Le],Ne?d.length:B[Le+1]),tt=et.geometryPositions.length>0;break;case 3:et.primitiveName="lines",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryIndices=p.subarray(M[Le],Ne?p.length:M[Le+1]),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;case 4:et.primitiveName="lines",et.geometryPositions=u.subarray(b[Le],Ne?u.length:b[Le+1]),et.geometryIndices=BF(et.geometryPositions,p.subarray(M[Le],Ne?p.length:M[Le+1])),tt=et.geometryPositions.length>0&&et.geometryIndices.length>0;break;default:continue}if(tt||(et=null),et&&(et.geometryPositions.length,et.batchThisMesh)){et.decompressedPositions=new Float32Array(et.geometryPositions.length),et.transformedAndRecompressedPositions=new Uint16Array(et.geometryPositions.length);for(var nt=et.geometryPositions,rt=et.decompressedPositions,it=0,st=nt.length;it<st;it+=3)rt[it+0]=nt[it+0]*y[0]+y[12],rt[it+1]=nt[it+1]*y[5]+y[13],rt[it+2]=nt[it+2]*y[10]+y[14];et.geometryPositions=null,me[$e]=et}}if(et)if(et.batchThisMesh){for(var at=et.decompressedPositions,ot=et.transformedAndRecompressedPositions,At=0,ct=at.length;At<ct;At+=3)_F[0]=at[At+0],_F[1]=at[At+1],_F[2]=at[At+2],_F[3]=1,De.transformVec4(qe,_F,bF),Nt.compressPosition(bF,ge,_F),ot[At+0]=_F[0],ot[At+1]=_F[1],ot[At+2]=_F[2];r.createMesh(je.apply(Re,{id:Je,textureSetId:We,origin:ve,primitive:et.primitiveName,positionsCompressed:ot,normalsCompressed:et.geometryNormals,uv:et.geometryUVs,colorsCompressed:et.geometryColors,indices:et.geometryIndices,edgeIndices:et.geometryEdgeIndices,positionsDecodeMatrix:Me,color:ze,metallic:Ke,roughness:Ze,opacity:Xe})),Pe.push(Je)}else ke[$e]||(r.createGeometry({id:$e,primitive:et.primitiveName,positionsCompressed:et.geometryPositions,normalsCompressed:et.geometryNormals,uv:et.geometryUVs,colorsCompressed:et.geometryColors,indices:et.geometryIndices,edgeIndices:et.geometryEdgeIndices,positionsDecodeMatrix:y}),ke[$e]=!0),r.createMesh(je.apply(Re,{id:Je,geometryId:$e,textureSetId:We,matrix:qe,color:ze,metallic:Ke,roughness:Ze,opacity:Xe,origin:ve})),Pe.push(Je)}else{var lt=void 0,ut=void 0,ht=void 0,dt=void 0,ft=void 0,pt=void 0,vt=void 0,gt=!1;switch(_[Le]){case 0:lt="solid",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),ht=h.subarray(w[Le],Ne?h.length:w[Le+1]),dt=f.subarray(C[Le],Ne?f.length:C[Le+1]),pt=p.subarray(M[Le],Ne?p.length:M[Le+1]),vt=v.subarray(k[Le],Ne?v.length:k[Le+1]),gt=ut.length>0&&pt.length>0;break;case 1:lt="surface",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),ht=h.subarray(w[Le],Ne?h.length:w[Le+1]),dt=f.subarray(C[Le],Ne?f.length:C[Le+1]),pt=p.subarray(M[Le],Ne?p.length:M[Le+1]),vt=v.subarray(k[Le],Ne?v.length:k[Le+1]),gt=ut.length>0&&pt.length>0;break;case 2:lt="points",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),ft=d.subarray(B[Le],Ne?d.length:B[Le+1]),gt=ut.length>0;break;case 3:lt="lines",ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),pt=p.subarray(M[Le],Ne?p.length:M[Le+1]),gt=ut.length>0&&pt.length>0;break;case 4:lt="lines",pt=BF(ut=u.subarray(b[Le],Ne?u.length:b[Le+1]),p.subarray(M[Le],Ne?p.length:M[Le+1])),gt=ut.length>0&&pt.length>0;break;default:continue}gt&&(r.createMesh(je.apply(Re,{id:Je,textureSetId:We,origin:ve,primitive:lt,positionsCompressed:ut,normalsCompressed:ht,uv:dt&&dt.length>0?dt:null,colorsCompressed:ft,indices:pt,edgeIndices:vt,positionsDecodeMatrix:Me,color:ze,metallic:Ke,roughness:Ze,opacity:Xe})),Pe.push(Je))}}Pe.length>0&&r.createEntity(je.apply(Qe,{id:xe,isObject:!0,meshIds:Pe}))}}}(e,t,a,r,i,s)}},MF=window.pako||TE;MF.inflate||(MF=MF.default);var kF=De.vec4(),EF=De.vec4();var FF=function(){var e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function xF(e,t,n,r,i,s){var a=s.getNextId(),o=n.metadata,A=n.textureData,c=n.eachTextureDataPortion,l=n.eachTextureAttributes,u=n.positions,h=n.normals,f=n.colors,p=n.uvs,v=n.indices,g=n.edgeIndices,m=n.eachTextureSetTextures,y=n.matrices,_=n.reusedGeometriesDecodeMatrix,b=n.eachGeometryPrimitiveType,w=n.eachGeometryAxisLabel,B=n.eachGeometryPositionsPortion,C=n.eachGeometryNormalsPortion,M=n.eachGeometryColorsPortion,k=n.eachGeometryUVsPortion,E=n.eachGeometryIndicesPortion,F=n.eachGeometryEdgeIndicesPortion,x=n.eachMeshGeometriesPortion,U=n.eachMeshMatricesPortion,I=n.eachMeshTextureSet,T=n.eachMeshMaterialAttributes,P=n.eachEntityId,S=n.eachEntityMeshesPortion,D=n.eachTileAABB,Q=n.eachTileEntitiesPortion,R=c.length,O=m.length/5,V=B.length,L=x.length,H=S.length,N=Q.length;i&&i.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(var G=0;G<R;G++){var j=G===R-1,W=c[G],z=j?A.length:c[G+1],X=z-W>0,K=9*G,Z=1===l[K+0],J=l[K+1];l[K+2],l[K+3];var Y=l[K+4],q=l[K+5],$=l[K+6],ee=l[K+7],te=l[K+8];if(X){var ne=new Uint8Array(A.subarray(W,z)).buffer,re="".concat(a,"-texture-").concat(G);if(Z)r.createTexture({id:re,buffers:[ne],minFilter:Y,magFilter:q,wrapS:$,wrapT:ee,wrapR:te});else{var ie=new Blob([ne],{type:10001===J?"image/jpeg":10002===J?"image/png":"image/gif"}),se=(window.URL||window.webkitURL).createObjectURL(ie),ae=document.createElement("img");ae.src=se,r.createTexture({id:re,image:ae,minFilter:Y,magFilter:q,wrapS:$,wrapT:ee,wrapR:te})}}}for(var oe=0;oe<O;oe++){var Ae=5*oe,ce="".concat(a,"-textureSet-").concat(oe),le=m[Ae+0],ue=m[Ae+1],he=m[Ae+2],de=m[Ae+3],fe=m[Ae+4];r.createTextureSet({id:ce,colorTextureId:le>=0?"".concat(a,"-texture-").concat(le):null,normalsTextureId:he>=0?"".concat(a,"-texture-").concat(he):null,metallicRoughnessTextureId:ue>=0?"".concat(a,"-texture-").concat(ue):null,emissiveTextureId:de>=0?"".concat(a,"-texture-").concat(de):null,occlusionTextureId:fe>=0?"".concat(a,"-texture-").concat(fe):null})}for(var pe=new Uint32Array(V),ve=0;ve<L;ve++){var ge=x[ve];void 0!==pe[ge]?pe[ge]++:pe[ge]=1}for(var me=De.vec3(),ye=De.AABB3(),_e={},be=0;be<N;be++){var we=be===N-1,Be=Q[be],Ce=we?H-1:Q[be+1]-1,Me=6*be,ke=D.subarray(Me,Me+6);De.getAABB3Center(ke,me),ye[0]=ke[0]-me[0],ye[1]=ke[1]-me[1],ye[2]=ke[2]-me[2],ye[3]=ke[3]-me[0],ye[4]=ke[4]-me[1],ye[5]=ke[5]-me[2];for(var Ee=Nt.createPositionsDecodeMatrix(ye),Fe={},xe=Be;xe<=Ce;xe++){var Ue=P[xe],Ie=t.globalizeObjectIds?De.globalizeObjectId(r.id,Ue):Ue,Te=xe===H-1,Pe=S[xe],Se=Te?x.length-1:S[xe+1]-1,Qe=[],Re=e.metaScene.metaObjects[Ie],Oe={},Ve={};if(Re){if(t.excludeTypesMap&&Re.type&&t.excludeTypesMap[Re.type])continue;if(t.includeTypesMap&&Re.type&&!t.includeTypesMap[Re.type])continue;if(t.includeIdsMap&&Re.id&&!t.includeIdsMap[Re.id])continue;var Le=t.objectDefaults?t.objectDefaults[Re.type]||t.objectDefaults.DEFAULT:null;Le&&(!1===Le.visible&&(Oe.visible=!1),!1===Le.pickable&&(Oe.pickable=!1),Le.colorize&&(Ve.color=Le.colorize),void 0!==Le.opacity&&null!==Le.opacity&&(Ve.opacity=Le.opacity),void 0!==Le.metallic&&null!==Le.metallic&&(Ve.metallic=Le.metallic),void 0!==Le.roughness&&null!==Le.roughness&&(Ve.roughness=Le.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(var He=Pe;He<=Se;He++){var Ne=x[He],Ge=pe[Ne]>1,We=Ne===V-1,ze=I[He],Xe=ze>=0?"".concat(a,"-textureSet-").concat(ze):null,Ke=FF(T.subarray(6*He,6*He+3)),Ze=T[6*He+3]/255,Je=T[6*He+4]/255,Ye=T[6*He+5]/255,qe=s.getNextId();if(Ge){var $e=U[He],et=y.slice($e,$e+16),tt="".concat(a,"-geometry.").concat(be,".").concat(Ne),nt=_e[tt];if(!nt){nt={batchThisMesh:!t.reuseGeometries};var rt=b[Ne],it=w[Ne],st=!1,at=void 0;switch(rt){case 0:nt.primitiveName="solid",nt.geometryPositions=u.subarray(B[Ne],We?u.length:B[Ne+1]),nt.geometryNormals=h.subarray(C[Ne],We?h.length:C[Ne+1]),nt.geometryUVs=p.subarray(k[Ne],We?p.length:k[Ne+1]),nt.geometryIndices=v.subarray(E[Ne],We?v.length:E[Ne+1]),nt.geometryEdgeIndices=g.subarray(F[Ne],We?g.length:F[Ne+1]),st=nt.geometryPositions.length>0&&nt.geometryIndices.length>0;break;case 1:nt.primitiveName="surface",nt.geometryPositions=u.subarray(B[Ne],We?u.length:B[Ne+1]),nt.geometryNormals=h.subarray(C[Ne],We?h.length:C[Ne+1]),nt.geometryUVs=p.subarray(k[Ne],We?p.length:k[Ne+1]),nt.geometryIndices=v.subarray(E[Ne],We?v.length:E[Ne+1]),nt.geometryEdgeIndices=g.subarray(F[Ne],We?g.length:F[Ne+1]),st=nt.geometryPositions.length>0&&nt.geometryIndices.length>0;break;case 2:nt.primitiveName="points",nt.geometryPositions=u.subarray(B[Ne],We?u.length:B[Ne+1]),nt.geometryColors=f.subarray(M[Ne],We?f.length:M[Ne+1]),st=nt.geometryPositions.length>0;break;case 3:nt.primitiveName="lines",nt.geometryPositions=u.subarray(B[Ne],We?u.length:B[Ne+1]),nt.geometryIndices=v.subarray(E[Ne],We?v.length:E[Ne+1]),st=nt.geometryPositions.length>0&&nt.geometryIndices.length>0;break;case 4:nt.primitiveName="lines",nt.geometryPositions=u.subarray(B[Ne],We?u.length:B[Ne+1]),nt.geometryIndices=UF(nt.geometryPositions,v.subarray(E[Ne],We?v.length:E[Ne+1])),st=nt.geometryPositions.length>0&&nt.geometryIndices.length>0;break;case 7:nt.primitiveName="lines",nt.geometryPositions=u.subarray(B[Ne],We?u.length:B[Ne+1]),nt.decompressedPositions=Nt.decompressPositions(nt.geometryPositions,_),at=An({origin:nt.decompressedPositions,text:it,size:2}),nt.decompressedPositions=at.positions,nt.geometryIndices=at.indices,nt.geometryPositions=null,st=nt.decompressedPositions.length>0&&nt.geometryIndices.length>0;break;default:continue}if(st||(nt=null),nt&&(nt.geometryPositions&&nt.geometryPositions.length,nt.batchThisMesh)){if(7===rt)nt.transformedAndRecompressedPositions=new Uint16Array(nt.decompressedPositions.length);else{nt.decompressedPositions=new Float32Array(nt.geometryPositions.length),nt.transformedAndRecompressedPositions=new Uint16Array(nt.geometryPositions.length);for(var ot=nt.geometryPositions,At=nt.decompressedPositions,ct=0,lt=ot.length;ct<lt;ct+=3)At[ct+0]=ot[ct+0]*_[0]+_[12],At[ct+1]=ot[ct+1]*_[5]+_[13],At[ct+2]=ot[ct+2]*_[10]+_[14];nt.geometryPositions=null}_e[tt]=nt}}if(nt)if(nt.batchThisMesh){for(var ut=nt.decompressedPositions,ht=nt.transformedAndRecompressedPositions,dt=0,ft=ut.length;dt<ft;dt+=3)kF[0]=ut[dt+0],kF[1]=ut[dt+1],kF[2]=ut[dt+2],kF[3]=1,De.transformVec4(et,kF,EF),Nt.compressPosition(EF,ye,kF),ht[dt+0]=kF[0],ht[dt+1]=kF[1],ht[dt+2]=kF[2];r.createMesh(je.apply(Ve,{id:qe,textureSetId:Xe,origin:me,primitive:nt.primitiveName,positionsCompressed:ht,normalsCompressed:nt.geometryNormals,uv:nt.geometryUVs,colorsCompressed:nt.geometryColors,indices:nt.geometryIndices,edgeIndices:nt.geometryEdgeIndices,positionsDecodeMatrix:Ee,color:Ke,metallic:Je,roughness:Ye,opacity:Ze})),Qe.push(qe)}else{if(!Fe[tt]){var pt={id:tt,primitive:nt.primitiveName,normalsCompressed:nt.geometryNormals,uv:nt.geometryUVs,colorsCompressed:nt.geometryColors,indices:nt.geometryIndices,edgeIndices:nt.geometryEdgeIndices};pt=nt.geometryPositions?d(d({},pt),{},{positionsCompressed:nt.geometryPositions,positionsDecodeMatrix:_}):d(d({},pt),{},{positions:nt.decompressedPositions}),r.createGeometry(pt),Fe[tt]=!0}r.createMesh(je.apply(Ve,{id:qe,geometryId:tt,textureSetId:Xe,matrix:et,color:Ke,metallic:Je,roughness:Ye,opacity:Ze,origin:me})),Qe.push(qe)}}else{var vt=b[Ne],gt=w[Ne],mt=void 0,yt=void 0,_t=void 0,bt=void 0,wt=void 0,Bt=void 0,Ct=void 0,Mt=!1,kt=void 0;switch(vt){case 0:mt="solid",yt=u.subarray(B[Ne],We?u.length:B[Ne+1]),_t=h.subarray(C[Ne],We?h.length:C[Ne+1]),bt=p.subarray(k[Ne],We?p.length:k[Ne+1]),Bt=v.subarray(E[Ne],We?v.length:E[Ne+1]),Ct=g.subarray(F[Ne],We?g.length:F[Ne+1]),Mt=yt.length>0&&Bt.length>0;break;case 1:mt="surface",yt=u.subarray(B[Ne],We?u.length:B[Ne+1]),_t=h.subarray(C[Ne],We?h.length:C[Ne+1]),bt=p.subarray(k[Ne],We?p.length:k[Ne+1]),Bt=v.subarray(E[Ne],We?v.length:E[Ne+1]),Ct=g.subarray(F[Ne],We?g.length:F[Ne+1]),Mt=yt.length>0&&Bt.length>0;break;case 2:mt="points",yt=u.subarray(B[Ne],We?u.length:B[Ne+1]),wt=f.subarray(M[Ne],We?f.length:M[Ne+1]),Mt=yt.length>0;break;case 3:mt="lines",yt=u.subarray(B[Ne],We?u.length:B[Ne+1]),Bt=v.subarray(E[Ne],We?v.length:E[Ne+1]),Mt=yt.length>0&&Bt.length>0;break;case 4:mt="lines",Bt=UF(yt=u.subarray(B[Ne],We?u.length:B[Ne+1]),v.subarray(E[Ne],We?v.length:E[Ne+1])),Mt=yt.length>0&&Bt.length>0;break;case 7:mt="lines",yt=u.subarray(B[Ne],We?u.length:B[Ne+1]),yt=(kt=An({origin:yt=Nt.decompressPositions(yt,Ee),text:gt,size:2})).positions,Bt=kt.indices,Mt=yt.length>0&&Bt.length>0;break;default:continue}if(Mt){var Et=je.apply(Ve,{id:qe,textureSetId:Xe,origin:me,primitive:mt,normalsCompressed:_t,uv:bt&&bt.length>0?bt:null,colorsCompressed:wt,indices:Bt,edgeIndices:Ct,color:Ke,metallic:Je,roughness:Ye,opacity:Ze});Et=d(d({},Et),{},7!==vt?{positionsCompressed:yt,positionsDecodeMatrix:Ee}:{positions:yt}),r.createMesh(Et),Qe.push(qe)}}}Qe.length>0&&r.createEntity(je.apply(Oe,{id:Ie,isObject:!0,meshIds:Qe}))}}}function UF(e,t){var n=[];if(t.length>1)for(var r=0,i=t.length-1;r<i;r++)n.push(t[r]),n.push(t[r+1]);else if(e.length>1)for(var s=0,a=e.length/3-1;s<a;s++)n.push(s),n.push(s+1);return n}!function(){var e=document.createElement("canvas"),t=e.getContext("2d")}();var IF={version:12,parseArrayBuffer:function(e,t,n,r,i,s){var a=function(e){var t,n,r=(t=new ArrayBuffer(2),new Uint16Array(t)[0]=1,1!==new Uint8Array(t)[0]),i=function(){var t=0,n=new DataView(e);return function(i){var s=1+2*t++,a=n.getUint32(4*s,!0),o=n.getUint32(4*(s+1),!0),A=i.BYTES_PER_ELEMENT;if(r&&A>1)for(var c=new Uint8Array(e,a,o),l=A/2,u=c.length/A,h=0;h<u;h++)for(var d=h*A,f=0;f<l;f++){var p=d+f,v=d-f+A-1,g=c[p];c[p]=c[v],c[v]=g}return new i(e,a,o/A)}}(),s=(n=new TextDecoder,function(){return JSON.parse(n.decode(i(Uint8Array)))});return{metadata:s(),textureData:i(Uint8Array),eachTextureDataPortion:i(Uint32Array),eachTextureAttributes:i(Uint16Array),positions:i(Uint16Array),normals:i(Int8Array),colors:i(Uint8Array),uvs:i(Float32Array),indices:i(Uint32Array),edgeIndices:i(Uint32Array),eachTextureSetTextures:i(Int32Array),matrices:i(Float32Array),reusedGeometriesDecodeMatrix:i(Float32Array),eachGeometryPrimitiveType:i(Uint8Array),eachGeometryAxisLabel:s(),eachGeometryPositionsPortion:i(Uint32Array),eachGeometryNormalsPortion:i(Uint32Array),eachGeometryColorsPortion:i(Uint32Array),eachGeometryUVsPortion:i(Uint32Array),eachGeometryIndicesPortion:i(Uint32Array),eachGeometryEdgeIndicesPortion:i(Uint32Array),eachMeshGeometriesPortion:i(Uint32Array),eachMeshMatricesPortion:i(Uint32Array),eachMeshTextureSet:i(Int32Array),eachMeshMaterialAttributes:i(Uint8Array),eachEntityId:s(),eachEntityMeshesPortion:i(Uint32Array),eachTileAABB:i(Float64Array),eachTileEntitiesPortion:i(Uint32Array)}}(n);xF(e,t,a,r,i,s)},parse:function(e,t,n,r,i,s){var a=function(e){var t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryAxisLabel:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(n),o=function(e){function t(e,t){return 0===e.length?[]:MF.inflate(e,t).buffer}return{metadata:JSON.parse(MF.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryAxisLabel:JSON.parse(MF.inflate(e.eachGeometryAxisLabel,{to:"string"})),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(MF.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(a);xF(e,t,o,r,i,s)}},TF={};TF[QE.version]=QE,TF[VE.version]=VE,TF[NE.version]=NE,TF[WE.version]=WE,TF[KE.version]=KE,TF[qE.version]=qE,TF[nF.version]=nF,TF[AF.version]=AF,TF[dF.version]=dF,TF[yF.version]=yF,TF[CF.version]=CF,TF[IF.version]=IF;var PF=function(e){m(r,uA);var t,n=_(r);function r(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,r),(t=n.call(this,"XKTLoader",e,i))._maxGeometryBatchSize=i.maxGeometryBatchSize,t.textureTranscoder=i.textureTranscoder,t.dataSource=i.dataSource,t.objectDefaults=i.objectDefaults,t.includeTypes=i.includeTypes,t.excludeTypes=i.excludeTypes,t.excludeUnclassifiedObjects=i.excludeUnclassifiedObjects,t.reuseGeometries=i.reuseGeometries,t}return I(r,[{key:"supportedVersions",get:function(){return Object.keys(TF)}},{key:"textureTranscoder",get:function(){return this._textureTranscoder},set:function(e){this._textureTranscoder=e}},{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new IE}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Ik}},{key:"includeTypes",get:function(){return this._includeTypes},set:function(e){this._includeTypes=e}},{key:"excludeTypes",get:function(){return this._excludeTypes},set:function(e){this._excludeTypes=e}},{key:"includeIds",get:function(){return this._includeIds},set:function(e){this._includeIds=e}},{key:"excludeUnclassifiedObjects",get:function(){return this._excludeUnclassifiedObjects},set:function(e){this._excludeUnclassifiedObjects=!!e}},{key:"globalizeObjectIds",get:function(){return this._globalizeObjectIds},set:function(e){this._globalizeObjectIds=!!e}},{key:"reuseGeometries",get:function(){return this._reuseGeometries},set:function(e){this._reuseGeometries=!1!==e}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id),!(t.src||t.xkt||t.manifestSrc||t.manifest))throw new Error("XKTLoaderPlugin: load() param expected: src, xkt, manifestSrc or manifestData");var n={},r=t.includeTypes||this._includeTypes,i=t.excludeTypes||this._excludeTypes,s=t.includeIds||this._includeIds,a=t.objectDefaults||this._objectDefaults;if(n.reuseGeometries=null!==t.reuseGeometries&&void 0!==t.reuseGeometries?t.reuseGeometries:!1!==this._reuseGeometries,r){n.includeTypesMap={};for(var o=0,A=r.length;o<A;o++)n.includeTypesMap[r[o]]=!0}if(i){n.excludeTypesMap={};for(var c=0,l=i.length;c<l;c++)n.excludeTypesMap[i[c]]=!0}if(s){n.includeIdsMap={};for(var u=0,h=s.length;u<h;u++)n.includeIdsMap[s[u]]=!0}a&&(n.objectDefaults=a),n.excludeUnclassifiedObjects=void 0!==t.excludeUnclassifiedObjects?!!t.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,n.globalizeObjectIds=void 0!==t.globalizeObjectIds&&null!==t.globalizeObjectIds?!!t.globalizeObjectIds:this._globalizeObjectIds;var d=new Uo(this.viewer.scene,je.apply(t,{isModel:!0,textureTranscoder:this._textureTranscoder,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:t.origin,disableVertexWelding:t.disableVertexWelding||!1,disableIndexRebucketing:t.disableIndexRebucketing||!1,dtxEnabled:t.dtxEnabled,renderOrder:t.renderOrder})),f=d.id,p=new el({metaScene:this.viewer.metaScene,id:f});this.viewer.scene.canvas.spinner.processes++;var v=function(){d.destroyed||(d.finalize(),p.finalize(),e.viewer.scene.canvas.spinner.processes--,d.once("destroyed",(function(){e.viewer.metaScene.destroyMetaModel(p.id)})),e.scheduleTask((function(){d.destroyed||(d.scene.fire("modelLoaded",d.id),d.fire("loaded",!0,!1))})))},g=function(t){e.viewer.scene.canvas.spinner.processes--,e.error(t),d.fire("error",t)},m=0,y={getNextId:function(){return"".concat(f,".").concat(m++)}};if(t.metaModelSrc||t.metaModelData)if(t.metaModelSrc){var _=t.metaModelSrc;this._dataSource.getMetaModel(_,(function(s){d.destroyed||(p.loadData(s,{includeTypes:r,excludeTypes:i,globalizeObjectIds:n.globalizeObjectIds}),t.src?e._loadModel(t.src,n,d,null,y,v,g):(e._parseModel(t.xkt,n,d,null,y),v()))}),(function(e){g("load(): Failed to load model metadata for model '".concat(f," from  '").concat(_,"' - ").concat(e))}))}else t.metaModelData&&(p.loadData(t.metaModelData,{includeTypes:r,excludeTypes:i,globalizeObjectIds:n.globalizeObjectIds}),t.src?this._loadModel(t.src,n,d,null,y,v,g):(this._parseModel(t.xkt,n,d,null,y),v()));else if(t.src)this._loadModel(t.src,n,d,p,y,v,g);else if(t.xkt)this._parseModel(t.xkt,n,d,p,y),v();else if(t.manifestSrc||t.manifest){var b=t.manifestSrc?SF(t.manifestSrc):"",w=function(t,s,a){var o=0;!function A(){d.destroyed||o>=t.length?s():e._dataSource.getMetaModel("".concat(b).concat(t[o]),(function(t){p.loadData(t,{includeTypes:r,excludeTypes:i,globalizeObjectIds:n.globalizeObjectIds}),o++,e.scheduleTask(A,200)}),a)}()},B=function(t,r,i){var s=0;!function a(){d.destroyed||s>=t.length?r():e._dataSource.getXKT("".concat(b).concat(t[s]),(function(t){e._parseModel(t,n,d,null,y),d.preFinalize(),s++,e.scheduleTask(a,200)}),i)}()},C=function(t,r,i){var s=0;!function a(){d.destroyed||s>=t.length?r():e._dataSource.getXKT("".concat(b).concat(t[s]),(function(t){e._parseModel(t,n,d,p,y),d.preFinalize(),s++,e.scheduleTask(a,200)}),i)}()};if(t.manifest){var M=t.manifest,k=M.xktFiles;if(!k||0===k.length)return void g("load(): Failed to load model manifest - manifest not valid");var E=M.metaModelFiles;E?w(E,(function(){B(k,v,g)}),g):C(k,v,g)}else this._dataSource.getManifest(t.manifestSrc,(function(e){if(!d.destroyed){var t=e.xktFiles;if(t&&0!==t.length){var n=e.metaModelFiles;n?w(n,(function(){B(t,v,g)}),g):C(t,v,g)}else g("load(): Failed to load model manifest - manifest not valid")}}),g)}return d}},{key:"_loadModel",value:function(e,t,n,r,i,s,a){var o=this;this._dataSource.getXKT(e,(function(e){o._parseModel(e,t,n,r,i),n.preFinalize(),s()}),a)}},{key:"_parseModel",value:(t=l(A().mark((function e(t,n,r,i,s){var a,o,c,l,u,h,d,f,p,v,g;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(a=new DataView(t),o=new Uint8Array(t),c=a.getUint32(0,!0),u=(l=2147483647&c)<11||l>=12&&c>>>31,h=TF[l]){e.next=11;break}return this.error("Unsupported .XKT file version: "+l+" - this XKTLoaderPlugin supports versions "+Object.keys(TF)),e.abrupt("return");case 11:if(u){e.next=14;break}return h.parseArrayBuffer(this.viewer,n,t,r,i,s),e.abrupt("return");case 14:for(d=a.getUint32(4,!0),f=[],p=4*(d+2),v=0;v<d;v++)g=a.getUint32(4*(v+2),!0),f.push(o.subarray(p,p+g)),p+=g;h.parse(this.viewer,n,f,r,i,s);case 19:case"end":return e.stop()}}),e,this)}))),function(e,n,r,i,s){return t.apply(this,arguments)})}]),r}();function SF(e){e.indexOf("?")>-1&&(e=e.split("?")[0]);var t=e.split("/");return t.pop(),t.join("/")+"/"}var DF={};!function(e){var t,n="File format is not recognized.",r="Error while reading zip file.",i="Error while reading file data.",s=524288,a="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(){this.crc=-1}function A(){}function c(e,t){var n,r;return n=new ArrayBuffer(e),r=new Uint8Array(n),t&&r.set(t,0),{buffer:n,array:r,view:new DataView(n)}}function l(){}function u(e){var t,n=this;n.size=0,n.init=function(r,i){var s=new Blob([e],{type:a});(t=new d(s)).init((function(){n.size=t.size,r()}),i)},n.readUint8Array=function(e,n,r,i){t.readUint8Array(e,n,r,i)}}function h(t){var n,r=this;r.size=0,r.init=function(e){for(var i=t.length;"="==t.charAt(i-1);)i--;n=t.indexOf(",")+1,r.size=Math.floor(.75*(i-n)),e()},r.readUint8Array=function(r,i,s){var a,o=c(i),A=4*Math.floor(r/3),l=4*Math.ceil((r+i)/3),u=e.atob(t.substring(A+n,l+n)),h=r-3*Math.floor(A/4);for(a=h;a<h+i;a++)o.array[a-h]=u.charCodeAt(a);s(o.array)}}function d(e){var t=this;t.size=0,t.init=function(n){t.size=e.size,n()},t.readUint8Array=function(t,n,r,i){var s=new FileReader;s.onload=function(e){r(new Uint8Array(e.target.result))},s.onerror=i;try{s.readAsArrayBuffer(function(e,t,n){if(t<0||n<0||t+n>e.size)throw new RangeError("offset:"+t+", length:"+n+", size:"+e.size);return e.slice?e.slice(t,t+n):e.webkitSlice?e.webkitSlice(t,t+n):e.mozSlice?e.mozSlice(t,t+n):e.msSlice?e.msSlice(t,t+n):void 0}(e,t,n))}catch(e){i(e)}}}function f(){}function p(e){var n,r=this;r.init=function(e){n=new Blob([],{type:a}),e()},r.writeUint8Array=function(e,r){n=new Blob([n,t?e:e.buffer],{type:a}),r()},r.getData=function(t,r){var i=new FileReader;i.onload=function(e){t(e.target.result)},i.onerror=r,i.readAsText(n,e)}}function v(t){var n=this,r="",i="";n.init=function(e){r+="data:"+(t||"")+";base64,",e()},n.writeUint8Array=function(t,n){var s,a=i.length,o=i;for(i="",s=0;s<3*Math.floor((a+t.length)/3)-a;s++)o+=String.fromCharCode(t[s]);for(;s<t.length;s++)i+=String.fromCharCode(t[s]);o.length>2?r+=e.btoa(o):i=o,n()},n.getData=function(t){t(r+e.btoa(i))}}function g(e){var n,r=this;r.init=function(t){n=new Blob([],{type:e}),t()},r.writeUint8Array=function(r,i){n=new Blob([n,t?r:r.buffer],{type:e}),i()},r.getData=function(e){e(n)}}function m(e,t,n,r,i,a,o,A,c,l){var u,h,d,f=0,p=t.sn;function v(){e.removeEventListener("message",g,!1),A(h,d)}function g(t){var n=t.data,i=n.data,s=n.error;if(s)return s.toString=function(){return"Error: "+this.message},void c(s);if(n.sn===p)switch("number"==typeof n.codecTime&&(e.codecTime+=n.codecTime),"number"==typeof n.crcTime&&(e.crcTime+=n.crcTime),n.type){case"append":i?(h+=i.length,r.writeUint8Array(i,(function(){m()}),l)):m();break;case"flush":d=n.crc,i?(h+=i.length,r.writeUint8Array(i,(function(){v()}),l)):v();break;case"progress":o&&o(u+n.loaded,a);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",n)}}function m(){(u=f*s)<=a?n.readUint8Array(i+u,Math.min(s,a-u),(function(n){o&&o(u,a);var r=0===u?t:{sn:p};r.type="append",r.data=n;try{e.postMessage(r,[n.buffer])}catch(t){e.postMessage(r)}f++}),c):e.postMessage({sn:p,type:"flush"})}h=0,e.addEventListener("message",g,!1),m()}function y(e,t,n,r,i,a,A,c,l,u){var h,d=0,f=0,p="input"===a,v="output"===a,g=new o;!function a(){var o;if((h=d*s)<i)t.readUint8Array(r+h,Math.min(s,i-h),(function(t){var r;try{r=e.append(t,(function(e){A&&A(h+e,i)}))}catch(e){return void l(e)}r?(f+=r.length,n.writeUint8Array(r,(function(){d++,setTimeout(a,1)}),u),v&&g.append(r)):(d++,setTimeout(a,1)),p&&g.append(t),A&&A(h,i)}),l);else{try{o=e.flush()}catch(e){return void l(e)}o?(v&&g.append(o),f+=o.length,n.writeUint8Array(o,(function(){c(f,g.get())}),u)):c(f,g.get())}}()}function _(t,n,r,i,s,a,o,c,l,u,h){var d="input";e.zip.useWebWorkers&&o?m(t,{sn:n,codecClass:"NOOP",crcType:d},r,i,s,a,l,c,u,h):y(new A,r,i,s,a,d,l,c,u,h)}function b(e){var t,n,r="",i=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)r+=(n=255&e.charCodeAt(t))>127?i[n-128]:String.fromCharCode(n);return r}function w(e){return decodeURIComponent(escape(e))}function B(e){var t,n="";for(t=0;t<e.length;t++)n+=String.fromCharCode(e[t]);return n}function C(e,t,n,r,i){e.version=t.view.getUint16(n,!0),e.bitFlag=t.view.getUint16(n+2,!0),e.compressionMethod=t.view.getUint16(n+4,!0),e.lastModDateRaw=t.view.getUint32(n+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,n=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&n)>>11,(2016&n)>>5,2*(31&n),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((r||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(n+10,!0),e.compressedSize=t.view.getUint32(n+14,!0),e.uncompressedSize=t.view.getUint32(n+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(n+22,!0),e.extraFieldLength=t.view.getUint16(n+24,!0)):i("File is using Zip64 (4gb+ file size).")):i("File contains encrypted entry.")}function M(t,s,a){var o=0;function A(){}A.prototype.getData=function(r,s,A,l){var u=this;function h(e,t){l&&!function(e){var t=c(4);return t.view.setUint32(0,e),u.crc32==t.view.getUint32(0)}(t)?a("CRC failed."):r.getData((function(e){s(e)}))}function d(e){a(e||i)}function f(e){a(e||"Error while writing file data.")}t.readUint8Array(u.offset,30,(function(i){var s,p=c(i.length,i);1347093252==p.view.getUint32(0)?(C(u,p,4,!1,a),s=u.offset+30+u.filenameLength+u.extraFieldLength,r.init((function(){0===u.compressionMethod?_(u._worker,o++,t,r,s,u.compressedSize,l,h,A,d,f):function(t,n,r,i,s,a,o,A,c,l,u){var h=o?"output":"none";e.zip.useWebWorkers?m(t,{sn:n,codecClass:"Inflater",crcType:h},r,i,s,a,c,A,l,u):y(new e.zip.Inflater,r,i,s,a,h,c,A,l,u)}(u._worker,o++,t,r,s,u.compressedSize,l,h,A,d,f)}),f)):a(n)}),d)};var l={getEntries:function(e){var i=this._worker;!function(e){t.size<22?a(n):i(22,(function(){i(Math.min(65558,t.size),(function(){a(n)}))}));function i(n,i){t.readUint8Array(t.size-n,n,(function(t){for(var n=t.length-22;n>=0;n--)if(80===t[n]&&75===t[n+1]&&5===t[n+2]&&6===t[n+3])return void e(new DataView(t.buffer,n,22));i()}),(function(){a(r)}))}}((function(s){var o,l;o=s.getUint32(16,!0),l=s.getUint16(8,!0),o<0||o>=t.size?a(n):t.readUint8Array(o,t.size-o,(function(t){var r,s,o,u,h=0,d=[],f=c(t.length,t);for(r=0;r<l;r++){if((s=new A)._worker=i,1347092738!=f.view.getUint32(h))return void a(n);C(s,f,h+6,!0,a),s.commentLength=f.view.getUint16(h+32,!0),s.directory=16==(16&f.view.getUint8(h+38)),s.offset=f.view.getUint32(h+42,!0),o=B(f.array.subarray(h+46,h+46+s.filenameLength)),s.filename=2048==(2048&s.bitFlag)?w(o):b(o),s.directory||"/"!=s.filename.charAt(s.filename.length-1)||(s.directory=!0),u=B(f.array.subarray(h+46+s.filenameLength+s.extraFieldLength,h+46+s.filenameLength+s.extraFieldLength+s.commentLength)),s.comment=2048==(2048&s.bitFlag)?w(u):b(u),d.push(s),h+=46+s.filenameLength+s.extraFieldLength+s.commentLength}e(d)}),(function(){a(r)}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?U("inflater",(function(e){l._worker=e,s(l)}),(function(e){a(e)})):s(l)}function k(e){return unescape(encodeURIComponent(e))}function E(e){var t,n=[];for(t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}function F(t,n,r,s){var a={},o=[],A=0,l=0;function u(e){r(e||"Error while writing zip file.")}function h(e){r(e||i)}var d={add:function(n,i,d,f,p){var v,g,b,w=this._worker;function B(e,n){var r=c(16);A+=e||0,r.view.setUint32(0,1347094280),void 0!==n&&(v.view.setUint32(10,n,!0),r.view.setUint32(4,n,!0)),i&&(r.view.setUint32(8,e,!0),v.view.setUint32(14,e,!0),r.view.setUint32(12,i.size,!0),v.view.setUint32(18,i.size,!0)),t.writeUint8Array(r.array,(function(){A+=16,d()}),u)}function C(){p=p||{},n=n.trim(),p.directory&&"/"!=n.charAt(n.length-1)&&(n+="/"),a.hasOwnProperty(n)?r("File already exists."):(g=E(k(n)),o.push(n),function(e){var r;b=p.lastModDate||new Date,v=c(26),a[n]={headerArray:v.array,directory:p.directory,filename:g,offset:A,comment:E(k(p.comment||""))},v.view.setUint32(0,335546376),p.version&&v.view.setUint8(0,p.version),s||0===p.level||p.directory||v.view.setUint16(4,2048),v.view.setUint16(6,(b.getHours()<<6|b.getMinutes())<<5|b.getSeconds()/2,!0),v.view.setUint16(8,(b.getFullYear()-1980<<4|b.getMonth()+1)<<5|b.getDate(),!0),v.view.setUint16(22,g.length,!0),(r=c(30+g.length)).view.setUint32(0,1347093252),r.array.set(v.array,4),r.array.set(g,30),A+=r.array.length,t.writeUint8Array(r.array,e,u)}((function(){i?s||0===p.level?_(w,l++,i,t,0,i.size,!0,B,f,h,u):function(t,n,r,i,s,a,o,A,c){var l="input";e.zip.useWebWorkers?m(t,{sn:n,options:{level:s},codecClass:"Deflater",crcType:l},r,i,0,r.size,o,a,A,c):y(new e.zip.Deflater,r,i,0,r.size,l,o,a,A,c)}(w,l++,i,t,p.level,B,f,h,u):B()})))}i?i.init(C,h):C()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var n,r,i,s=0,l=0;for(r=0;r<o.length;r++)s+=46+(i=a[o[r]]).filename.length+i.comment.length;for(n=c(s+22),r=0;r<o.length;r++)i=a[o[r]],n.view.setUint32(l,1347092738),n.view.setUint16(l+4,5120),n.array.set(i.headerArray,l+6),n.view.setUint16(l+32,i.comment.length,!0),i.directory&&n.view.setUint8(l+38,16),n.view.setUint32(l+42,i.offset,!0),n.array.set(i.filename,l+46),n.array.set(i.comment,l+46+i.filename.length),l+=46+i.filename.length+i.comment.length;n.view.setUint32(l,1347093766),n.view.setUint16(l+8,o.length,!0),n.view.setUint16(l+10,o.length,!0),n.view.setUint32(l+12,s,!0),n.view.setUint32(l+16,A,!0),t.writeUint8Array(n.array,(function(){t.getData(e)}),u)},_worker:null};e.zip.useWebWorkers?U("deflater",(function(e){d._worker=e,n(d)}),(function(e){r(e)})):n(d)}o.prototype.append=function(e){for(var t=0|this.crc,n=this.table,r=0,i=0|e.length;r<i;r++)t=t>>>8^n[255&(t^e[r])];this.crc=t},o.prototype.get=function(){return~this.crc},o.prototype.table=function(){var e,t,n,r=[];for(e=0;e<256;e++){for(n=e,t=0;t<8;t++)1&n?n=n>>>1^3988292384:n>>>=1;r[e]=n}return r}(),A.prototype.append=function(e,t){return e},A.prototype.flush=function(){},u.prototype=new l,u.prototype.constructor=u,h.prototype=new l,h.prototype.constructor=h,d.prototype=new l,d.prototype.constructor=d,f.prototype.getData=function(e){e(this.data)},p.prototype=new f,p.prototype.constructor=p,v.prototype=new f,v.prototype.constructor=v,g.prototype=new f,g.prototype.constructor=g;var x={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function U(t,n,r){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var i;if(e.zip.workerScripts){if(i=e.zip.workerScripts[t],!Array.isArray(i))return void r(new Error("zip.workerScripts."+t+" is not an array!"));i=function(e){var t=document.createElement("a");return e.map((function(e){return t.href=e,t.href}))}(i)}else(i=x[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+i[0];var s=new Worker(i[0]);s.codecTime=s.crcTime=0,s.postMessage({type:"importScripts",scripts:i.slice(1)}),s.addEventListener("message",(function e(t){var i=t.data;if(i.error)return s.terminate(),void r(i.error);"importScripts"===i.type&&(s.removeEventListener("message",e),s.removeEventListener("error",a),n(s))})),s.addEventListener("error",a)}else r(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function a(e){s.terminate(),r(e)}}function I(e){console.error(e)}e.zip={Reader:l,Writer:f,BlobReader:d,Data64URIReader:h,TextReader:u,BlobWriter:g,Data64URIWriter:v,TextWriter:p,createReader:function(e,t,n){n=n||I,e.init((function(){M(e,t,n)}),n)},createWriter:function(e,t,n,r){n=n||I,r=!!r,e.init((function(){F(e,t,n,r)}),n)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(DF);var QF=DF.zip;!function(e){var t,n,r=e.Reader,i=e.Writer;try{n=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function s(e){var t=this;function n(n,r){var i;t.data?n():((i=new XMLHttpRequest).addEventListener("load",(function(){t.size||(t.size=Number(i.getResponseHeader("Content-Length"))||Number(i.response.byteLength)),t.data=new Uint8Array(i.response),n()}),!1),i.addEventListener("error",r,!1),i.open("GET",e),i.responseType="arraybuffer",i.send())}t.size=0,t.init=function(r,i){if(function(e){var t=document.createElement("a");return t.href=e,"http:"===t.protocol||"https:"===t.protocol}(e)){var s=new XMLHttpRequest;s.addEventListener("load",(function(){t.size=Number(s.getResponseHeader("Content-Length")),t.size?r():n(r,i)}),!1),s.addEventListener("error",i,!1),s.open("HEAD",e),s.send()}else n(r,i)},t.readUint8Array=function(e,r,i,s){n((function(){i(new Uint8Array(t.data.subarray(e,e+r)))}),s)}}function a(e){var t=this;t.size=0,t.init=function(n,r){var i=new XMLHttpRequest;i.addEventListener("load",(function(){t.size=Number(i.getResponseHeader("Content-Length")),"bytes"==i.getResponseHeader("Accept-Ranges")?n():r("HTTP Range not supported.")}),!1),i.addEventListener("error",r,!1),i.open("HEAD",e),i.send()},t.readUint8Array=function(t,n,r,i){!function(t,n,r,i){var s=new XMLHttpRequest;s.open("GET",e),s.responseType="arraybuffer",s.setRequestHeader("Range","bytes="+t+"-"+(t+n-1)),s.addEventListener("load",(function(){r(s.response)}),!1),s.addEventListener("error",i,!1),s.send()}(t,n,(function(e){r(new Uint8Array(e))}),i)}}function o(e){var t=this;t.size=0,t.init=function(n,r){t.size=e.byteLength,n()},t.readUint8Array=function(t,n,r,i){r(new Uint8Array(e.slice(t,t+n)))}}function A(){var e,t=this;t.init=function(t,n){e=new Uint8Array,t()},t.writeUint8Array=function(t,n,r){var i=new Uint8Array(e.length+t.length);i.set(e),i.set(t,e.length),e=i,n()},t.getData=function(t){t(e.buffer)}}function c(e,t){var r,i=this;i.init=function(t,n){e.createWriter((function(e){r=e,t()}),n)},i.writeUint8Array=function(e,i,s){var a=new Blob([n?e:e.buffer],{type:t});r.onwrite=function(){r.onwrite=null,i()},r.onerror=s,r.write(a)},i.getData=function(t){e.file(t)}}s.prototype=new r,s.prototype.constructor=s,a.prototype=new r,a.prototype.constructor=a,o.prototype=new r,o.prototype.constructor=o,A.prototype=new i,A.prototype.constructor=A,c.prototype=new i,c.prototype.constructor=c,e.FileWriter=c,e.HttpReader=s,e.HttpRangeReader=a,e.ArrayBufferReader=o,e.ArrayBufferWriter=A,e.fs&&((t=e.fs.ZipDirectoryEntry).prototype.addHttpContent=function(n,r,i){return function(n,r,i,s){if(n.directory)return s?new t(n.fs,r,i,n):new e.fs.ZipFileEntry(n.fs,r,i,n);throw"Parent entry is not a directory."}(this,n,{data:r,Reader:i?a:s})},t.prototype.importHttpContent=function(e,t,n,r){this.importZip(t?new a(e):new s(e),n,r)},e.fs.FS.prototype.importHttpContent=function(e,n,r,i){this.entries=[],this.root=new t(this),this.root.importHttpContent(e,n,r,i)})}(QF);var RF=["4.2"],OF=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,e),this.supportedSchemas=RF,this._xrayOpacity=.7,this._src=null,this._options=n,this.viewpoint=null,n.workerScriptsPath?(QF.workerScriptsPath=n.workerScriptsPath,this.src=n.src,this.xrayOpacity=.7,this.displayEffect=n.displayEffect,this.createMetaModel=n.createMetaModel):t.error("Config expected: workerScriptsPath")}return I(e,[{key:"load",value:function(e,t,n,r,i,s){switch(r.materialType){case"MetallicMaterial":t._defaultMaterial=new Ni(t,{baseColor:[1,1,1],metallic:.6,roughness:.6});break;case"SpecularMaterial":t._defaultMaterial=new Wi(t,{diffuse:[1,1,1],specular:De.vec3([1,1,1]),glossiness:.5});break;default:t._defaultMaterial=new wi(t,{reflectivity:.75,shiness:100,diffuse:[1,1,1]})}t._wireframeMaterial=new Vi(t,{color:[0,0,0],lineWidth:2});var a=t.scene.canvas.spinner;a.processes++,VF(e,t,n,r,(function(){a.processes--,i&&i(),t.fire("loaded",!0,!1)}),(function(e){a.processes--,t.error(e),s&&s(e),t.fire("error",e)}),(function(e){console.log("Error, Will Robinson: "+e)}))}}]),e}(),VF=function(e,t,n,r,i,s){!function(e,t,n){var r=new XF;r.load(e,(function(){t(r)}),(function(e){n("Error loading ZIP archive: "+e)}))}(n,(function(n){LF(e,n,r,t,i,s)}),s)},LF=function(){return function(t,n,r,i,s){var a={plugin:t,zip:n,edgeThreshold:30,materialType:r.materialType,scene:i.scene,modelNode:i,info:{references:{}},materials:{}};r.createMetaModel&&(a.metaModelData={modelId:i.id,metaObjects:[{name:i.id,type:"Default",id:i.id}]}),i.scene.loading++,function(t,n){t.zip.getFile("Manifest.xml",(function(r,i){for(var s=i.children,a=0,o=s.length;a<o;a++){var A=s[a];if("Manifest"===A.type)e(t,A,n)}}))}(a,(function(){a.metaModelData&&t.viewer.metaScene.createMetaModel(i.id,a.metaModelData),i.scene.loading--,s()}))};function e(e,n,r){for(var i=n.children,s=0,a=i.length;s<a;s++){var o=i[s];if("Root"===o.type){var A=o.children[0];e.zip.getFile(A,(function(n,i){t(e,i,r)}))}}}function t(e,t,r){for(var i=t.children,s=0,a=i.length;s<a;s++){var o=i[s];if("Model_3dxml"===o.type)n(e,o,r)}}function n(e,t,n){for(var i=t.children,o=0,A=i.length;o<A;o++){var c=i[o];switch(c.type){case"Header":r(e,c);break;case"ProductStructure":s(e,c,n);break;case"DefaultView":a(e,c)}}}function r(e,t){for(var n=t.children,r={},s=0,a=n.length;s<a;s++){var o=n[s];switch(o.type){case"SchemaVersion":r.schemaVersion=o.children[0],i(e,r.schemaVersion)||e.plugin.error("Schema version not supported: "+r.schemaVersion+" - supported versions are: "+RF.join(","));break;case"Title":r.title=o.children[0];break;case"Author":r.author=o.children[0];break;case"Created":r.created=o.children[0]}}e.modelNode.meta=r}function i(e,t){for(var n=0,r=RF.length;n<r;n++)if(t===RF[n])return!0;return!1}function s(e,t,n){!function(e,t,n){for(var r={},i=t.children,s=0,a=0,A=i.length;a<A;a++){"ReferenceRep"===(c=i[a]).type&&s++}for(a=0,A=i.length;a<A;a++){var c;if("ReferenceRep"===(c=i[a]).type)if(c.associatedFile){var l=KF(c.associatedFile);!function(){var t=c.id;e.zip.getFile(l,(function(i,a){var A=i.getElementsByTagName("MaterialId");HF(e,A,(function(){var i={id:t};o(e,a,i),r[t]=i,0==--s&&n(r)}))}),(function(e){}))}()}}}(e,t,(function(r){for(var i=t.children,s={},a={},o={},A=0,c=i.length;A<c;A++){var l=i[A];switch(l.type){case"Reference3D":s[l.id]={type:"Reference3D",id:l.id,name:l.name,instance3Ds:{},instanceReps:{}};break;case"InstanceRep":for(var u=0,h=l.children.length;u<h;u++){switch((g=l.children[u]).type){case"IsAggregatedBy":d=g.children[0];break;case"IsInstanceOf":f=g.children[0]}}a[l.id]={type:"InstanceRep",id:l.id,name:l.name,isAggregatedBy:d,isInstanceOf:f,referenceReps:{}};break;case"Instance3D":var d,f,v;for(u=0,h=l.children.length;u<h;u++){var g;switch((g=l.children[u]).type){case"IsAggregatedBy":d=g.children[0];break;case"IsInstanceOf":f=g.children[0];break;case"RelativeMatrix":v=g.children[0]}}o[l.id]={type:"Instance3D",id:l.id,name:l.name,isAggregatedBy:d,isInstanceOf:f,relativeMatrix:v,reference3Ds:{}}}}for(var m in o){(_=s[(y=o[m]).isAggregatedBy])?_.instance3Ds[y.id]=y:alert("foo")}for(var m in o){var y,_=s[(y=o[m]).isInstanceOf];y.reference3Ds[_.id]=_,_.instance3D=y}for(var m in a){var b=r[(w=a[m]).isInstanceOf];b&&(w.referenceReps[b.id]=b)}for(var m in a){var w;(_=s[(w=a[m]).isAggregatedBy])&&(_.instanceReps[w.id]=w)}function B(e,t,n){for(var r in t.instance3Ds)C(e,t.instance3Ds[r],n);for(var r in t.instanceReps)M(e,t.instanceReps[r],n)}function C(e,t,n){if(t.relativeMatrix){var r=p(t.relativeMatrix,12),i=[r[9],r[10],r[11]],s=r.slice(0,9),a=De.mat3ToMat4(s,De.identityMat4()),o=new bn(e.modelNode,{position:i});e.metaModelData&&e.metaModelData.metaObjects.push({id:o.id,type:"Default",name:t.name,parent:n?n.id:e.modelNode.id}),n?n.addChild(o,!0):e.modelNode.addChild(o,!0),n=o,o=new bn(e.modelNode,{matrix:a}),e.metaModelData&&e.metaModelData.metaObjects.push({id:o.id,type:"Default",name:t.name,parent:n?n.id:e.modelNode.id}),n.addChild(o,!0),n=o}else{o=new bn(e.modelNode,{});e.metaModelData&&e.metaModelData.metaObjects.push({id:o.id,type:"Default",name:t.name,parent:n?n.id:e.modelNode.id}),n?n.addChild(o,!0):e.modelNode.addChild(o,!0),n=o}for(var A in t.reference3Ds)B(e,t.reference3Ds[A],n)}function M(e,t,n){if(t.referenceReps)for(var r in t.referenceReps){var i=t.referenceReps[r];for(var s in i)if("id"!==s){var a=i[s],o="lines"===a.geometry.primitive?e.modelNode._wireframeMaterial:a.materialId?e.materials[a.materialId]:null,A=a.color,c=new vi(e.modelNode,{isObject:!0,geometry:a.geometry,material:o||e.modelNode._defaultMaterial,colorize:A,backfaces:!1});e.metaModelData&&e.metaModelData.metaObjects.push({id:c.id,type:"Default",name:t.name,parent:n?n.id:e.modelNode.id}),n?n.addChild(c,!0):e.modelNode.addChild(c,!0),c.colorize=A}}}for(var m in s){if(!(_=s[m]).instance3D)return B(e,_,null),void n()}alert("No root Reference3D element found in this modelNode - can't load."),n()}))}function a(e,t){for(var n=t.children,r=0,i=n.length;r<i;r++){var s=n[r];if("Viewpoint"===s.type){var a=s.children;e.modelNode.viewpoint={};for(var o=0,A=a.length;o<A;o++){var c=a[r];switch(c.type){case"Position":e.modelNode.viewpoint.eye=p(c.children[0],3);break;case"Sight":e.modelNode.viewpoint.look=p(c.children[0],3);break;case"Up":e.modelNode.viewpoint.up=p(c.children[0],3)}}}}}function o(e,t,n){for(var r=t.children,i=0,s=r.length;i<s;i++){var a=r[i];if("XMLRepresentation"===a.type)A(e,a,n)}}function A(e,t,n){for(var r=t.children,i=0,s=r.length;i<s;i++){var a=r[i];if("Root"===a.type)c(e,a,n)}}function c(e,t,n){t["xsi:type"];for(var r=t.children,i=0,s=r.length;i<s;i++){var a=r[i];if("Rep"===a.type)l(e,a,n)}}function l(e,t,n){t["xsi:type"];for(var r={edgeThreshold:e.edgeThreshold||30,compressGeometry:!0},i=t.children,s=0,a=i.length;s<a;s++){var o=i[s];switch(o.type){case"Rep":l(e,o,n);break;case"Edges":break;case"Faces":r.primitive="triangles",u(e,o,r);break;case"VertexBuffer":f(e,o,r);break;case"SurfaceAttributes":v(e,o,r)}}if(r.positions){var A=new Wt(e.modelNode,r);n[A.id]={geometry:A,color:r.color||[1,1,1,1],materialId:r.materialId}}}function u(e,t,n){for(var r=t.children,i=0,s=r.length;i<s;i++){var a=r[i];if("Face"===a.type)h(e,a,n)}}function h(e,t,n){var r=t.strips;if(r){var i=function(e){for(var t=e.split(","),n=[],r=0,i=t.length;r<i;r++){var s=t[r].trim();if(s.length>0){for(var a=s.trim().split(" "),o=new Int16Array(a.length),A=0,c=0,l=a.length;c<l;c++)""!==a[c]&&(o[A++]=parseInt(a[c]));n.push(o)}}return n}(r);if(i.length>0){n.primitive="triangles";for(var s=[],a=0,o=i.length;a<o;a++)for(var A=d(i[a]),c=0,l=A.length;c<l;c++)s.push(A[c]);n.indices=s}}else{var u=t.triangles;u&&(n.primitive="triangles",n.indices=function(e){e=e.trim().split(" ");for(var t=new Int32Array(e.length),n=0,r=e.length;n<r;n++){var i=e[n];t[n]=parseInt(i)}return t}(u))}var h=t.children;for(a=0,o=h.length;a<o;a++){var f=h[a];if("SurfaceAttributes"===f.type)v(e,f,n)}}function d(e){for(var t=[],n=0,r=e.length;n<r-2;n++)1&n?(t.push(e[n]),t.push(e[n+2]),t.push(e[n+1])):(t.push(e[n]),t.push(e[n+1]),t.push(e[n+2]));return t}function f(e,t,n){for(var r=t.children,i=0,s=r.length;i<s;i++){var a=r[i];switch(a.type){case"Positions":n.positions=p(a.children[0],3);break;case"Normals":n.normals=p(a.children[0],3);break;case"TextureCoordinates":n.uv=p(a.children[0],2)}}}function p(e,t){e=e.split(",");for(var n=new Float32Array(e.length*t),r=0,i=0,s=e.length;i<s;i++)for(var a=e[i],o=0,A=(a=a.split(" ")).length;o<A;o++)""!==a[o]&&(n[r++]=parseFloat(a[o]));return n}function v(e,t,n){n.color=[1,1,1,1];for(var r,i,s=t.children,a=0,o=s.length;a<o;a++){var A=s[a];switch(A.type){case"Color":n.color[0]=A.red,n.color[1]=A.green,n.color[2]=A.blue,n.color[3]=A.alpha;break;case"MaterialApplication":for(var c=A.children,l=0,u=c.length;l<u;l++){var h=c[l];if("MaterialId"===h.type){var d=(r=h.id,i=void 0,-1!==(i=r.lastIndexOf("#"))?r.substring(i+1):r);e.materials[d]||e.plugin.error("material  not found: "+d),n.materialId=d}}}}}}();function HF(e,t,n){var r={};!function i(s,a){if(s>=t.length)n();else{var o=t[s].id,A=o.lastIndexOf(":");A>0&&(o=o.substring(A+1));var c=o.lastIndexOf("#");c>0&&(o=o.substring(0,c)),r[o]?i(s+1):function(e,t,n){e.zip.getFile(t,(function(t,r){!function(e,t,n){for(var r,i=t.children,s=0,a=i.length;s<a;s++)"Model_3dxml"===(r=i[s]).type&&NF(e,r,n)}(e,r,n)}))}(e,o,(function(){r[o]=!0,i(s+1)}))}}(0)}function NF(e,t,n){for(var r,i=t.children,s=0,a=i.length;s<a;s++)"CATMaterialRef"===(r=i[s]).type&&GF(e,r,n)}function GF(e,t,n){for(var r={},i=t.children,s=0,a=0,o=i.length;a<o;a++){if("MaterialDomainInstance"===(d=i[a]).type){for(var A,c,l=0,u=d.children.length;l<u;l++){var h=d.children[l];switch(h.type){case"IsAggregatedBy":A=h.children[0];break;case"IsInstanceOf":c=h.children[0]}}r[c]=A}}for(a=0,o=i.length;a<o;a++){if("MaterialDomain"===(d=i[a]).type)s++}for(a=0,o=i.length;a<o;a++){var d;if("MaterialDomain"===(d=i[a]).type)d.associatedFile&&function(){var t=d.id,i=KF(d.associatedFile);e.zip.getFile(i,(function(i,a){e.materials[r[t]]=jF(e,a),0==--s&&n()}),(function(e){}))}()}}function jF(e,t){for(var n=t.children,r=0,i=n.length;r<i;r++){var s=n[r];if("Osm"===s.type)return WF(e,s)}}function WF(e,t){for(var n=t.children,r=0,i=n.length;r<i;r++){var s=n[r];switch(s.type){case"RenderingRootFeature":break;case"Feature":if("RenderingFeature"===s.Alias){var a,o,A,c,l={},u={},h=s.children;for(a=0,o=h.length;a<o;a++)switch((A=h[a]).Name){case"AmbientCoef":l.ambient=parseFloat(A.Value);break;case"DiffuseCoef":l.diffuse=parseFloat(A.Value);break;case"EmissiveCoef":l.emissive=parseFloat(A.Value);break;case"SpecularExponent":l.specular=parseFloat(A.Value)}for(a=0,o=h.length;a<o;a++)switch((A=h[a]).Name){case"AmbientColor":u.ambient=zF(A.Value,l.ambient);break;case"DiffuseColor":u.diffuse=zF(A.Value,l.diffuse);break;case"EmissiveColor":u.emissive=zF(A.Value,l.emissive);break;case"SpecularColor":u.specular=zF(A.Value,l.specular);break;case"Transparency":var d=1-parseFloat(A.Value);d<1&&(u.alpha=d,u.alphaMode="blend")}switch(e.materialType){case"MetallicMaterial":c=new Ni(e.modelNode,{baseColor:u.diffuse,metallic:.7,roughness:.5,emissive:u.emissive,alpha:u.alpha,alphaMode:u.alphaMode});break;case"SpecularMaterial":c=new Wi(e.modelNode,{diffuse:u.diffuse,specular:u.specular,glossiness:.5,emissive:u.emissive,alpha:u.alpha,alphaMode:u.alphaMode});break;default:c=new wi(e.modelNode,{reflectivity:.5,ambient:u.ambient,diffuse:u.diffuse,specular:u.specular,emissive:u.emissive,alphaMode:u.alphaMode,alpha:t.alpha})}return c}}}}function zF(e,t){t=void 0!==t?t:.5;var n=e.indexOf("["),r=e.indexOf("]");e=(e=e.substring(n+1,r-n)).split(",");for(var i=new Float32Array(e.length),s=0,a=0,o=e.length;a<o;a++)for(var A=e[a],c=0,l=(A=A.trim().split(" ")).length;c<l;c++)""!==A[c]&&(i[s++]=parseFloat(A[c])*t);return i}var XF=function(){var e={};function t(e,n){if(e.nodeType===e.TEXT_NODE){var r=e.nodeValue;if(null===r.match(/^\s+$/))return r}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var i={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var s=0;s<e.attributes.length;s++){var a=e.attributes[s];i[n[a.nodeName]||a.nodeName]=a.nodeValue}for(var o=0;o<e.childNodes.length;o++){(s=t(e.childNodes[o],n))&&i.children.push(s)}return i}}this.load=function(t,n,r){QF.createReader(new QF.HttpReader(t),(function(t){t.getEntries((function(t){if(t.length>0)for(var r=0,i=t.length;r<i;r++){var s=t[r];e[s.filename]=s}n()}))}),r)},this.getFile=function(n,r,i){var s=e[n];if(!s){var a="ZIP entry not found: "+n;return console.error(a),void(i&&i(a))}s.getData(new QF.TextWriter,(function(e){var n=(new DOMParser).parseFromString(e,"text/xml"),i=t(n,{});r(n,i)}))},this.destroy=function(){undefined.close((function(){}))}};function KF(e){var t="urn:3DXML:";return 0===e.indexOf(t)?e.substring(t.length):e}var ZF=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),r=t.call(this,"XML3DLoader",e,i),i.workerScriptsPath?(r._workerScriptsPath=i.workerScriptsPath,r._loader=new OF(w(r),i),r.supportedSchemas=r._loader.supportedSchemas,r):(r.error("Config expected: workerScriptsPath"),b(r))}return I(n,[{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.workerScriptsPath=this._workerScriptsPath,e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new bn(this.viewer.scene,je.apply(e,{isModel:!0})),n=e.src;return n?(this._loader.load(this,t,n,e),t):(this.error("load() param expected: src"),t)}}]),n}(),JF=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getIFC",value:function(e,t,n){e=this._cacheBusterURL(e);var r=function(){};t=t||r,n=n||r;var i=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var s=!!i[2],a=i[3];a=window.decodeURIComponent(a),s&&(a=window.atob(a));try{for(var o=new ArrayBuffer(a.length),A=new Uint8Array(o),c=0;c<a.length;c++)A[c]=a.charCodeAt(c);t(o)}catch(e){n(e)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):n("getXKT error : "+l.response))},l.send(null)}}}]),e}(),YF=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,n),(r=t.call(this,"ifcLoader",e,i)).dataSource=i.dataSource,r.objectDefaults=i.objectDefaults,r.includeTypes=i.includeTypes,r.excludeTypes=i.excludeTypes,r.excludeUnclassifiedObjects=i.excludeUnclassifiedObjects,!i.WebIFC)throw"Parameter expected: WebIFC";if(!i.IfcAPI)throw"Parameter expected: IfcAPI";return r._webIFC=i.WebIFC,r._ifcAPI=i.IfcAPI,r}return I(n,[{key:"supportedVersions",get:function(){return["2x3","4"]}},{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new JF}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Ik}},{key:"includeTypes",get:function(){return this._includeTypes},set:function(e){this._includeTypes=e}},{key:"excludeTypes",get:function(){return this._excludeTypes},set:function(e){this._excludeTypes=e}},{key:"excludeUnclassifiedObjects",get:function(){return this._excludeUnclassifiedObjects},set:function(e){this._excludeUnclassifiedObjects=!!e}},{key:"globalizeObjectIds",get:function(){return this._globalizeObjectIds},set:function(e){this._globalizeObjectIds=!!e}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new Uo(this.viewer.scene,je.apply(e,{isModel:!0}));if(!e.src&&!e.ifc)return this.error("load() param expected: src or IFC"),t;var n={autoNormals:!0};if(!1!==e.loadMetadata){var r=e.includeTypes||this._includeTypes,i=e.excludeTypes||this._excludeTypes,s=e.objectDefaults||this._objectDefaults;if(r){n.includeTypesMap={};for(var a=0,o=r.length;a<o;a++)n.includeTypesMap[r[a]]=!0}if(i){n.excludeTypesMap={};for(var A=0,c=i.length;A<c;A++)n.excludeTypesMap[i[A]]=!0}s&&(n.objectDefaults=s),n.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,n.globalizeObjectIds=void 0!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds}try{e.src?this._loadModel(e.src,e,n,t):this._parseModel(e.ifc,e,n,t)}catch(e){this.error(e),t.fire("error",e)}return t}},{key:"_loadModel",value:function(e,t,n,r){var i=this,s=this.viewer.scene.canvas.spinner;s.processes++,this._dataSource.getIFC(t.src,(function(e){i._parseModel(e,t,n,r),s.processes--}),(function(e){s.processes--,i.error(e),r.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,n,r){if(!r.destroyed){var i=t.stats||{};if(i.sourceFormat="IFC",i.schemaVersion="",i.title="",i.author="",i.created="",i.numMetaObjects=0,i.numPropertySets=0,i.numObjects=0,i.numGeometries=0,i.numTriangles=0,i.numVertices=0,!this._ifcAPI)throw"WebIFCLoaderPlugin has no WebIFC instance configured - please inject via WebIFCLoaderPlugin constructor";var s=new Uint8Array(e),a=this._ifcAPI.OpenModel(s),o=this._ifcAPI.GetModelSchema(a),A=this._ifcAPI.GetLineIDsWithType(a,this._webIFC.IFCPROJECT).get(0),c=!1!==t.loadMetadata,l={modelID:a,modelSchema:o,sceneModel:r,loadMetadata:c,metadata:c?{id:"",projectId:""+A,author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[],propertySets:[]}:null,metaObjects:{},options:n,log:function(e){},nextId:0,stats:i};if(c){if(n.includeTypes){l.includeTypes={};for(var u=0,h=n.includeTypes.length;u<h;u++)l.includeTypes[n.includeTypes[u]]=!0}if(n.excludeTypes){l.excludeTypes={};for(var d=0,f=n.excludeTypes.length;d<f;d++)l.excludeTypes[n.excludeTypes[d]]=!0}this._parseMetaObjects(l),this._parsePropertySets(l)}if(this._parseGeometry(l),r.finalize(),c){var p=r.id;this.viewer.metaScene.createMetaModel(p,l.metadata,n)}r.scene.once("tick",(function(){r.destroyed||(r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1))}))}}},{key:"_parseMetaObjects",value:function(e){var t=this._ifcAPI.GetLineIDsWithType(e.modelID,this._webIFC.IFCPROJECT).get(0),n=this._ifcAPI.GetLine(e.modelID,t);this._parseSpatialChildren(e,n)}},{key:"_parseSpatialChildren",value:function(e,t,n){var r=this._ifcAPI.GetNameFromTypeCode(t.type);if((!e.includeTypes||e.includeTypes[r])&&(!e.excludeTypes||!e.excludeTypes[r])){this._createMetaObject(e,t,n);var i=t.GlobalId.value;this._parseRelatedItemsOfType(e,t.expressID,"RelatingObject","RelatedObjects",this._webIFC.IFCRELAGGREGATES,i),this._parseRelatedItemsOfType(e,t.expressID,"RelatingStructure","RelatedElements",this._webIFC.IFCRELCONTAINEDINSPATIALSTRUCTURE,i)}}},{key:"_createMetaObject",value:function(e,t,n){var r=t.GlobalId.value,i=this._ifcAPI.GetNameFromTypeCode(t.type),s={id:r,name:t.Name&&""!==t.Name.value?t.Name.value:i,type:i,parent:n};e.metadata.metaObjects.push(s),e.metaObjects[r]=s,e.stats.numMetaObjects++}},{key:"_parseRelatedItemsOfType",value:function(e,t,n,r,i,s){for(var a=this,o=this._ifcAPI.GetLineIDsWithType(e.modelID,i),A=0;A<o.size();A++){var c=o.get(A),l=this._ifcAPI.GetLine(e.modelID,c),u=l[n],h=!1;if(Array.isArray(u))h=u.map((function(e){return e.value})).includes(t);else h=u.value===t;if(h){var d=l[r];if(Array.isArray(d))d.forEach((function(t){var n=a._ifcAPI.GetLine(e.modelID,t.value);a._parseSpatialChildren(e,n,s)}));else{var f=this._ifcAPI.GetLine(e.modelID,d.value);this._parseSpatialChildren(e,f,s)}}}}},{key:"_parsePropertySets",value:function(e){for(var t=this._ifcAPI.GetLineIDsWithType(e.modelID,this._webIFC.IFCRELDEFINESBYPROPERTIES),n=0;n<t.size();n++){var r=t.get(n),i=this._ifcAPI.GetLine(e.modelID,r,!0);if(i){var s=i.RelatingPropertyDefinition;if(!s)continue;var a=s.GlobalId.value,o=s.HasProperties;if(o&&o.length>0){for(var A=s.Name.value,c=[],l=0,u=o.length;l<u;l++){var h=o[l],d=h.Name,f=h.NominalValue;if(d&&f){var p={name:d.value,type:f.type,value:f.value,valueType:f.valueType};h.Description?p.description=h.Description.value:f.description&&(p.description=f.description),c.push(p)}}var v={id:a,type:"Default",name:A,properties:c};e.metadata.propertySets.push(v),e.stats.numPropertySets++;var g=i.RelatedObjects;if(!g||0===g.length)return;for(var m=0,y=g.length;m<y;m++){var _=g[m].GlobalId.value,b=e.metaObjects[_];b&&(b.propertySetIds||(b.propertySetIds=[]),b.propertySetIds.push(a))}}}}}},{key:"_parseGeometry",value:function(e){var t=this;this._ifcAPI.StreamAllMeshes(e.modelID,(function(n){var r=n.expressID,i=n.geometries,s=[],a=t._ifcAPI.GetLine(e.modelID,r).GlobalId.value;if(e.loadMetadata){var o=a,A=e.metaObjects[o];if(e.includeTypes&&(!A||!e.includeTypes[A.type]))return;if(e.excludeTypes&&(!A||e.excludeTypes[A.type]))return}for(var c=De.mat4(),l=De.vec3(),u=0,h=i.size();u<h;u++){for(var d=i.get(u),f=t._ifcAPI.GetGeometry(e.modelID,d.geometryExpressID),p=t._ifcAPI.GetVertexArray(f.GetVertexData(),f.GetVertexDataSize()),v=t._ifcAPI.GetIndexArray(f.GetIndexData(),f.GetIndexDataSize()),g=new Float64Array(p.length/2),m=new Float32Array(p.length/2),y=0,_=0,b=p.length/6;y<b;y++,_+=3)g[_+0]=p[6*y+0],g[_+1]=p[6*y+1],g[_+2]=p[6*y+2];c.set(d.flatTransformation),De.transformPositions3(c,g);var w=Mn(g,g,l);if(!e.options.autoNormals)for(var B=0,C=0,M=p.length/6;B<M;B++,C+=3)m[C+0]=p[6*B+3],m[C+1]=p[6*B+4],m[C+2]=p[6*B+5];e.stats.numGeometries++,e.stats.numVertices+=g.length/3,e.stats.numTriangles+=v.length/3;var k="mesh"+e.nextId++;e.sceneModel.createMesh({id:k,primitive:"triangles",origin:w?l:null,positions:g,normals:e.options.autoNormals?null:m,indices:v,color:[d.color.x,d.color.y,d.color.z],opacity:d.color.w}),s.push(k)}var E=e.options.globalizeObjectIds?De.globalizeObjectId(e.sceneModel.id,a):a;e.sceneModel.createEntity({id:E,meshIds:s,isObject:!0}),e.stats.numObjects++}))}}]),n}();function qF(e){return $F.apply(this,arguments)}function $F(){return($F=l(A().mark((function e(t){var n;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(t);case 3:if((n=e.sent).ok){e.next=6;break}throw new Error("HTTP error! Status: ".concat(n.status));case 6:return e.abrupt("return",n.text());case 9:e.prev=9,e.t0=e.catch(0),console.error("Error fetching file:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}var ex=function(e){m(r,uA);var t,n=_(r);function r(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,r),(t=n.call(this,"ifcLoader",e,i)).gltfLoader=new Tk(t.viewer),t.cxConverterModule=null,t}return I(r,[{key:"setCxConverterModule",value:function(e){this.cxConverterModule=e}},{key:"load",value:(t=l(A().mark((function e(){var t,n,r,i,s,a,o=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]?o[0]:{},this.cxConverterModule){e.next=3;break}throw new Error("CxConverter module is not set. Use setCxConverterModule() to set it.");case 3:return t.src||this.error("load() param expected: src"),e.next=6,qF(t.src);case 6:return n=e.sent,e.next=9,this.cxConverterModule.ifc2gltf(n,{remote:!0,progressCallback:t.progressCallback,progressTextCallback:t.progressTextCallback});case 9:return r=e.sent,i=r.gltf,s=r.metaData,a=this.gltfLoader.load({id:"myModel",gltf:i,metaModelJSON:s}),e.abrupt("return",a);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(),tx=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getIFC",value:function(e,t,n){e=this._cacheBusterURL(e);var r=function(){};t=t||r,n=n||r;var i=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var s=!!i[2],a=i[3];a=window.decodeURIComponent(a),s&&(a=window.atob(a));try{for(var o=new ArrayBuffer(a.length),A=new Uint8Array(o),c=0;c<a.length;c++)A[c]=a.charCodeAt(c);t(o)}catch(e){n(e)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="text",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):n("getIFC error : "+l.response))},l.send(null)}}}]),e}(),nx=function(e){m(r,uA);var t,n=_(r);function r(e,t){var i;if(x(this,r),i=n.call(this,"IFCOpenShellLoader",e,t),!t)throw new Error("IFCOpenShellLoaderPlugin: No configuration given");if(!t.ifcopenshell)throw new Error("IFCOpenShellLoaderPlugin: No ifcopenshell given");if(!t.ifcopenshell_geom)throw new Error("IFCOpenShellLoaderPlugin: No ifcopenshell_geom given");return i.ifcopenshell=t.ifcopenshell,i.ifcopenshell_geom=t.ifcopenshell_geom,i.dataSource=t.dataSource,i}return I(r,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new tx}},{key:"globalizeObjectIds",get:function(){return this._globalizeObjectIds},set:function(e){this._globalizeObjectIds=!!e}},{key:"load",value:(t=l(A().mark((function e(){var t,n,r,i,s,a,o,c,l,u,h,d,f,p,v,g,m,y,_=this,b=arguments;return A().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=b.length>0&&void 0!==b[0]?b[0]:{},n=t.id,r=t.backfaces,i=void 0===r||r,s=t.dtxEnabled,a=void 0===s||s,o=t.position,c=t.rotation,l=t.origin,u=t.loadMetadata,h=t.loadMetadataPropertySets,d=t.edges,f=t.saoEnabled,p=t.globalizeObjectIds,v=t.excludeTypes,n&&this.viewer.scene.components[n]&&(this.error("Component with this ID already exists: ".concat(n," - autogenerating SceneModel ID")),n=null),g=new Uo(this.viewer.scene,{id:n,isModel:!0,globalizeObjectIds:p,backfaces:i,dtxEnabled:a,position:o,rotation:c,origin:l,edges:d,saoEnabled:f}),m=g.id,t.src||t.text){e.next=8;break}return this.error("load() expected 'src' or 'text'"),e.abrupt("return",g);case 8:return this.viewer.scene.canvas.spinner.processes++,y=function(e){var t=_.ifcopenshell.file.from_string(e),n={loadMetadataPropertySets:!1!==h,globalizeObjectIds:p||_._globalizeObjectIds,geometryCache:new Map,ifc:t,sceneModel:g};if(v&&(n.excludeTypes=v),_._loadIFCGeometry(n),!1!==u){var r=_._loadIFCMetaModel(n,t);_.viewer.metaScene.createMetaModel(m,r)}_.viewer.scene.canvas.spinner.processes--},t.src?(this.viewer.scene.canvas.spinner.processes++,this._dataSource.getIFC(t.src,(function(e){y(e),_.viewer.scene.canvas.spinner.processes--}),(function(e){_.viewer.scene.canvas.spinner.processes--,_.error(e)}))):y(t.text),g.once("destroyed",(function(){_.viewer.metaScene.destroyMetaModel(m)})),e.abrupt("return",g);case 14:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_loadIFCGeometry",value:function(e){var t=e.ifc,n=e.sceneModel,r=this.ifcopenshell_geom,i=r.settings();i.set(i.WELD_VERTICES,!1);var s=r.iterator.callKwargs({settings:i,file_or_filename:t,exclude:e.excludeTypes,geometry_library:"hybrid-cgal-simple-opencascade"});if(s.initialize())do{var a=s.get();if(a){var o=t.by_id(a.id);this._parseIFCEntity(e,a,o)}}while(s.next());n.finalize(),n.scene.once("tick",(function(){n.destroyed||(n.scene.fire("modelLoaded",n.id),n.fire("loaded",!0,!1))}))}},{key:"_parseIFCEntity",value:function(e,t,n){var r=e.sceneModel,i=e.geometryCache,s=t.geometry.id,a=function(e){var t=(i=e,new Float64Array([i[0][0],i[2][0],-i[1][0],i[3][0],i[0][1],i[2][1],-i[1][1],i[3][1],i[0][2],i[2][2],-i[1][2],i[3][2],i[0][3],i[2][3],-i[1][3],i[3][3]])),n=[],r=t.slice(12,15);var i;return Mn(r,r,n),t.set(r,12),{origin:n,matrix:t}}(t.transformation.data().components.toJs()),o=a.origin,A=a.matrix;if(!i.get(s)){for(var c=t.geometry.materials.toJs().map((function(e){return{diffuse:e.diffuse.components.toJs(),transparency:e.transparency&&!isNaN(e.transparency)?e.transparency:0}})),l=function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];null==r||r<0||(t[r]||(t[r]=[])).push(n)}return t}(new Int32Array(t.geometry.material_ids.toJs())),h=new Map,d=0,f=Object.entries(l);d<f.length;d++){var p=k(f[d],2),v=p[0],g=p[1];if(g&&0!==g.length){var m=new Float32Array(t.geometry.verts.toJs()),y=new Uint32Array(t.geometry.edges.toJs()),_=new Uint32Array(t.geometry.faces.toJs()),b=Number(v),w=ix(g,_),B=rx(s,b);r.createGeometry({id:B,primitive:"triangles",positions:m,indices:w,edgeIndices:y}),h.set(b,B)}}i.set(s,{subGeoms:h,materials:c,mapping:new Map(Object.entries(l).map((function(e){var t=k(e,2),n=t[0],r=t[1];return[Number(n),new Uint32Array(r)]})))})}var C,M=i.get(s),E=[],F=u(M.subGeoms.entries());try{for(F.s();!(C=F.n()).done;){var x=k(C.value,2),U=x[0],I=x[1],T=M.materials[U]||{diffuse:[.6,.6,.6],transparency:0},P=Math.random().toString(36).substr(2,9),S=T.diffuse;r.createMesh({id:P,geometryId:I,origin:o,matrix:A,color:[S[0],S[1],S[2]],opacity:1-T.transparency}),E.push(P)}}catch(e){F.e(e)}finally{F.f()}r.createEntity({id:e.globalizeObjectIds?De.globalizeObjectId(e.sceneModel.id,n.GlobalId):n.GlobalId,isObject:!0,meshIds:E})}},{key:"_loadIFCMetaModel",value:function(e,t){var n,r=new Set,i=[],s=[],a=function(e){return null==e?"":String(e)};function o(e){try{return String(e.GlobalId)}catch(e){return null}}function A(t,n){var a=o(t);if(!a||r.has(a))return!1;r.add(a);var A=e.globalizeObjectIds,c=e.sceneModel.id,l=[];if(e.loadMetadataPropertySets)for(var u=0,h=["HasAssociations","IsDefinedBy","IsDecomposedBy","ContainsElements"];u<h.length;u++){var d=t[h[u]];if(d&&d.length>0){for(var f,p=0;p<d.length;p++){var v=d.get(p);if(v.is_a&&"IfcRelDefinesByProperties"===v.is_a()){var g,m=v.RelatingPropertyDefinition;if(m&&m.is_a&&["IfcPropertySet","IfcElementQuantity"].includes(m.is_a())){var y,_=m.GlobalId?String(m.GlobalId):null,b=m.Name?String(m.Name):"",w=m.is_a?String(m.is_a()):"",B=[],C=m.HasProperties||m.Quantities;if(C&&C.length>0){for(var M,k=0;k<C.length;k++){var E,F=C.get(k),x=F.Name?String(F.Name):"",U="",I=F.is_a?String(F.is_a()):"";if(F.is_a&&"IfcPropertySingleValue"===F.is_a())try{U=F.NominalValue?String(F.NominalValue.wrappedValue):""}catch(e){U=""}else if(F.is_a&&"IfcPropertyEnumeratedValue"===F.is_a())try{var T=F.EnumerationValues;if(T&&T.length>0){for(var P=[],S=0;S<T.length;S++)P.push(String(T.get(S).wrappedValue));U=P.join(", ")}}catch(e){U=""}else if(F.is_a&&"IfcQuantityArea"===F.is_a())U=F.AreaValue?String(F.AreaValue):"";else if(F.is_a&&"IfcQuantityLength"===F.is_a())U=F.LengthValue?String(F.LengthValue):"";else if(F.is_a&&"IfcQuantityVolume"===F.is_a())U=F.VolumeValue?String(F.VolumeValue):"";else try{U=F.NominalValue?String(F.NominalValue):""}catch(e){U=""}B.push({name:x,value:U,type:I}),null===(E=F.destroy)||void 0===E||E.call(F)}null===(M=C.destroy)||void 0===M||M.call(C)}s.push({id:_,name:b,type:w,properties:B}),l.push(_),null===(y=m.destroy)||void 0===y||y.call(m)}null===(g=v.destroy)||void 0===g||g.call(v)}}null===(f=d.destroy)||void 0===f||f.call(d)}}return i.push({id:A?De.globalizeObjectId(c,a):a,type:String(t.is_a()),parent:n?A?De.globalizeObjectId(c,o(n)):o(n):null,propertySetIds:l}),!0}function c(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(e)if(A(e,n)){var r=e.IsDecomposedBy;if(r)for(var i=0;i<r.length;i++){var s,a=r.get(i),o=a.RelatedObjects;if(o){for(var l,u=0;u<o.length;u++){var h,d=o.get(u);c(d,e),null===(h=d.destroy)||void 0===h||h.call(d)}null===(l=o.destroy)||void 0===l||l.call(o)}null===(s=a.destroy)||void 0===s||s.call(a)}var f=e.ContainsElements;if(f)for(var p=0;p<f.length;p++){var v,g=f.get(p),m=g.RelatedElements;if(m){for(var y,_=0;_<m.length;_++){var b,w=m.get(_);c(w,e),null===(b=w.destroy)||void 0===b||b.call(w)}null===(y=m.destroy)||void 0===y||y.call(m)}null===(v=g.destroy)||void 0===v||v.call(g)}null===(t=e.destroy)||void 0===t||t.call(e)}else{var B;null===(B=e.destroy)||void 0===B||B.call(e)}}var l="",u="",h="",d="",f="";try{d=a(t.schema)}catch(e){}if(!d)try{var p=t.wrapped_data.header.file_schema.schema_identifiers;p&&p.length>0&&(d=a(p.get(0)))}catch(e){}var v=t.by_type("IfcProject");if(v&&v.length>0){var g,m=v.get(0);l=a(m.GlobalId);try{var y=m.OwnerHistory;if(y){try{var _=y.OwningUser,b=null==_?void 0:_.ThePerson,w=null==_?void 0:_.TheOrganization,B=null!=b&&b.GivenName?a(b.GivenName):"",C=null!=b&&b.FamilyName?a(b.FamilyName):"";u=[B||C?[B,C].filter(Boolean).join(" "):"",null!=w&&w.Name?a(w.Name):""].filter(Boolean).join(" / ")}catch(e){}try{var M=null==y?void 0:y.CreationDate;"number"==typeof M&&isFinite(M)&&M>0&&(h=new Date(1e3*M).toISOString())}catch(e){}try{var k=null==y?void 0:y.OwningApplication;f=[null!=k&&k.ApplicationFullName?a(k.ApplicationFullName):null!=k&&k.ApplicationIdentifier?a(k.ApplicationIdentifier):"",null!=k&&k.Version?a(k.Version):""].filter(Boolean).join(" ")}catch(e){}}}catch(e){}null===(g=m.destroy)||void 0===g||g.call(m)}try{var E=t.wrapped_data.header.file_name;if(!u)try{var F=E.author;if(F&&F.length>0){for(var x=[],U=0;U<F.length;U++)x.push(a(F.get(U)));u=x.filter(Boolean).join(", ")}}catch(e){}if(!h){var I=a(E.time_stamp);if(I){var T=new Date(I);isNaN(T.getTime())||(h=T.toISOString())}}if(!f)f=[a(E.originating_system),a(E.preprocessor_version)].filter(Boolean).join(" / ")}catch(e){}if(!h)try{for(var P,S=1/0,D=t.by_type("IfcRoot"),Q=0;Q<D.length;Q++){var R,O=D.get(Q),V=null==O?void 0:O.OwnerHistory,L=null==V?void 0:V.CreationDate;"number"==typeof L&&isFinite(L)&&L>0&&L<S&&(S=L),null===(R=O.destroy)||void 0===R||R.call(O)}null===(P=D.destroy)||void 0===P||P.call(D),isFinite(S)&&(h=new Date(1e3*S).toISOString())}catch(e){}for(var H=t.by_type("IfcProject"),N=0;N<H.length;N++){var G,j=H.get(N);c(j,null),null===(G=j.destroy)||void 0===G||G.call(j)}return null===(n=H.destroy)||void 0===n||n.call(H),{id:"",projectId:l,author:u,createdAt:h,schema:d,creatingApplication:f,metaObjects:i,propertySets:s}}},{key:"destroy",value:function(){v(C(r.prototype),"destroy",this).call(this)}}]),r}();function rx(e,t){return"".concat(e,":").concat(t,"#geom")}function ix(e,t){var n,r=new Uint32Array(3*e.length),i=0,s=u(e);try{for(s.s();!(n=s.n()).done;){var a=3*n.value;r[i++]=t[a+0],r[i++]=t[a+1],r[i++]=t[a+2]}}catch(e){s.e(e)}finally{s.f()}return r}var sx=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getLAS",value:function(e,t,n){e=this._cacheBusterURL(e);var r=function(){};t=t||r,n=n||r;var i=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(i){var s=!!i[2],a=i[3];a=window.decodeURIComponent(a),s&&(a=window.atob(a));try{for(var o=new ArrayBuffer(a.length),A=new Uint8Array(o),c=0;c<a.length;c++)A[c]=a.charCodeAt(c);t(o)}catch(e){n(e)}}else{var l=new XMLHttpRequest;l.open("GET",e,!0),l.responseType="arraybuffer",l.onreadystatechange=function(){4===l.readyState&&(200===l.status?t(l.response):n("getLAS error : "+l.response))},l.send(null)}}},{key:"getManifest",value:function(e,t,n){je.loadJSON(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}}]),e}(),ax=[{item:"FileSignature",format:"char",size:4},{item:"FileSoureceID",format:"uShort",size:2},{item:"GlobalEncoding",format:"uShort",size:2},{item:"ProjectID1",format:"notUsed",size:4},{item:"ProjectID2",format:"notUsed",size:2},{item:"ProjectID3",format:"notUsed",size:2},{item:"ProjectID4",format:"notUsed",size:8},{item:"VersionMajor",format:"uChar",size:1},{item:"VersionMinor",format:"uChar",size:1},{item:"SystemIdentifier",format:"char",size:32},{item:"GeneratingSoftware",format:"char",size:32},{item:"CreationDay",format:"uShort",size:2},{item:"CreationYear",format:"uShort",size:2},{item:"HeaderSize",format:"uShort",size:2},{item:"OffsetToPointData",format:"uLong",size:4},{item:"NumberOfVariableLengthRecords",format:"uLong",size:4},{item:"PointDataFormatID",format:"uChar",size:1},{item:"PointDataRecordLength",format:"uShort",size:2},{item:"NumberOfPoints",format:"uLong",size:4},{item:"NumberOfPointByReturn",format:"uLong",size:20},{item:"ScaleFactorX",format:"double",size:8},{item:"ScaleFactorY",format:"double",size:8},{item:"ScaleFactorZ",format:"double",size:8},{item:"OffsetX",format:"double",size:8},{item:"OffsetY",format:"double",size:8},{item:"OffsetZ",format:"double",size:8},{item:"MaxX",format:"double",size:8},{item:"MinX",format:"double",size:8},{item:"MaxY",format:"double",size:8},{item:"MinY",format:"double",size:8},{item:"MaxZ",format:"double",size:8},{item:"MinZ",format:"double",size:8}],ox=[{item:"Reserved",format:"uShort",size:2},{item:"UserId",format:"char",size:16},{item:"RecordId",format:"uShort",size:2},{item:"RecordLengthAfterHeader",format:"uShort",size:2},{item:"Description",format:"char",size:32}],Ax=function(e){var t=0,n=0,r=0,i=new DataView(e),s=new Uint8Array(6e3),a=function(r){var s,a,o=r.item,A=r.format,c=r.size;switch(A){case"char":return a=new Uint8Array(e,t,c),t+=c,[o,s=lx(a)];case"uShort":return s=i.getUint16(t,!0),t+=c,[o,s];case"uLong":return s=i.getUint32(t,!0),"NumberOfVariableLengthRecords"===o&&(n=s),t+=c,[o,s];case"uChar":return s=i.getUint8(t),t+=c,[o,s];case"double":return s=i.getFloat64(t,!0),t+=c,[o,s];default:t+=c}};return function(){var e={};ax.forEach((function(t){var n=a(d({},t));if(void 0!==n){if("FileSignature"===n[0]&&"LASF"!==n[1])throw new Error("Ivalid FileSignature. Is this a LAS/LAZ file");e[n[0]]=n[1]}}));for(var i=[],o=n,A=function(){var e={};ox.forEach((function(n){var i=a(d({},n));e[i[0]]=i[1],"UserId"===i[0]&&"LASF_Projection"===i[1]&&(r=t-18+54)})),i.push(e)};o--;)A();var c=function(e){if(void 0!==e){for(var t=r+e.RecordLengthAfterHeader,n=s.slice(r,t),i=cx(n),a=new DataView(i),o=6,A=Number(a.getUint16(o,!0)),c=[];A--;){var l={};l.key=a.getUint16(o+=2,!0),l.tiffTagLocation=a.getUint16(o+=2,!0),l.count=a.getUint16(o+=2,!0),l.valueOffset=a.getUint16(o+=2,!0),c.push(l)}var u=c.find((function(e){return 3072===e.key}));if(u&&u.hasOwnProperty("valueOffset"))return u.valueOffset}}(i.find((function(e){return"LASF_Projection"===e.UserId})));return c&&(e.epsg=c),e}()},cx=function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),r=0;r<e.length;++r)n[r]=e[r];return t},lx=function(e){var t="";return e.forEach((function(e){var n=String.fromCharCode(e);"\0"!==n&&(t+=n)})),t.trim()},ux=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"lasLoader",e,i)).dataSource=i.dataSource,r.skip=i.skip,r.fp64=i.fp64,r.colorDepth=i.colorDepth,r.center=i.center,r.rotate=i.rotate,r.rotateX=i.rotateX,r.transform=i.transform,r}return I(n,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new sx}},{key:"skip",get:function(){return this._skip},set:function(e){this._skip=e||1}},{key:"fp64",get:function(){return this._fp64},set:function(e){this._fp64=!!e}},{key:"colorDepth",get:function(){return this._colorDepth},set:function(e){this._colorDepth=e||"auto"}},{key:"center",get:function(){return this._center},set:function(e){this._center=!!e}},{key:"transform",get:function(){return this._transform},set:function(e){this._transform=e}},{key:"rotate",get:function(){return this._rotate},set:function(e){this._rotate=e}},{key:"rotateX",get:function(){return this._rotateX},set:function(e){this._rotateX=e}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var n=new Uo(this.viewer.scene,je.apply(t,{maxGeometryBatchSize:5e5,isModel:!0}));if(!(t.src||t.las||t.manifest||t.manifestSrc))return this.error("load() param expected: src or las"),n;var r={las:{skip:this._skip,fp64:this._fp64,colorDepth:this._colorDepth}},i=this.viewer.scene.canvas.spinner,s=function(){n.scene.once("tick",(function(){n.destroyed||(n.scene.fire("modelLoaded",n.id),n.fire("loaded",!0,!1))})),i.processes--},a=function(t){i.processes--,e.error(t),n.fire("error",t)};if(t.src)this._loadModel(t.src,t,r,n);else if(t.las)i.processes++,this._parseModel(t.las,t,r,n).then(s,a);else if(t.manifest||t.manifestSrc){var o=t.manifestSrc?dx(t.manifestSrc):"",A=function(i){var A=0,c=new Array(i.length);!function l(){if(n.destroyed)s();else{if(A>=i.length)return;c[A]=!1,e._dataSource.getLAS("".concat(o).concat(i[A]),(function(i){var a=je.apply(t,{isManifest:!0,index:A});e._parseModel(i,a,r,n).then((function(){c[a.index]=!0;var e=!0;c.forEach((function(t){t||(e=!1)})),e&&s()})),A++,e.scheduleTask(l,200)}),a)}}()},c=function(t){if(!n.destroyed){var r=t.lasFiles||t.lazFiles;!r||r.length<=0?e.error("load(): Failed to load model manifest - manifest not valid"):A(r)}};if(t.manifestSrc)this._dataSource.getManifest(t.manifestSrc,(function(e){c(e)}),(function(t){e.error(t),n.fire("error",t)}));else{var l=t.manifest;c(l)}}return n}},{key:"_loadModel",value:function(e,t,n,r){var i=this,s=this.viewer.scene.canvas.spinner;s.processes++,this._dataSource.getLAS(t.src,(function(e){i._parseModel(e,t,n,r).then((function(){r.scene.once("tick",(function(){r.destroyed||(r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1))})),s.processes--}),(function(e){s.processes--,i.error(e),r.fire("error",e)}))}),(function(e){s.processes--,i.error(e),r.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,n,r){var i=this,s=function(e){var t=e.value;if(i._center){for(var n=De.vec3(),r=t.length,s=0,a=t.length;s<a;s+=3)n[0]+=t[s+0],n[1]+=t[s+1],n[2]+=t[s+2];n[0]/=r,n[1]/=r,n[2]/=r;for(var o=0,A=t.length;o<A;o+=3)t[o+0]-=n[0],t[o+1]-=n[1],t[o+2]-=n[2]}if(i._rotateX&&t)for(var c=0,l=t.length;c<l;c+=3){var u=t[c+1];t[c+1]=t[c+2],t[c+2]=u}if(i._rotate){var h=De.identityQuaternion(),d=De.mat4();De.eulerToQuaternion(i._rotate,"XYZ",h),De.quaternionToRotationMat4(h,d);for(var f=De.vec3(),p=0,v=t.length;p<v;p+=3)f[0]=t[p+0],f[1]=t[p+1],f[2]=t[p+2],De.transformPoint3(d,f,f),t[p+0]=f[0],t[p+1]=f[1],t[p+2]=f[2]}if(i._transform)for(var g=De.mat4(i._transform),m=De.vec3(),y=0,_=t.length;y<_;y+=3)m[0]=t[y+0],m[1]=t[y+1],m[2]=t[y+2],De.transformPoint3(g,m,m),t[y+0]=m[0],t[y+1]=m[1],t[y+2]=m[2];return t};function a(e,t){for(var n=e.value,r=e.size,i=t.value,s=4*i.length,a=new Uint8Array(s),o=0,A=0,c=0,l=i.length;o<l;o++,c+=r,A+=4)a[A+0]=n[c+0],a[A+1]=n[c+1],a[A+2]=n[c+2],a[A+3]=Math.round(i[o]/65536*255);return a}function o(e){for(var t=e.value,n=4*t.length,r=new Uint8Array(n),i=0,s=0,a=t.length;i<a;i++,s+=4)r[s+0]=0,r[s+1]=0,r[s+2]=0,r[s+3]=Math.round(t[i]/65536*255);return r}return new Promise((function(A,c){if(r.destroyed)c();else{var l=t.stats||{};l.sourceFormat="LAS",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;try{var u=Ax(e);zh(e,qg,n).then((function(e){var l,h,d=e.attributes,f=e.loaderData,p=void 0!==f.pointsFormatId?f.pointsFormatId:-1;if(!d.POSITION)return r.finalize(),void c("No positions found in file");switch(p){case 0:l=s(d.POSITION),h=o(d.intensity);break;case 1:if(!d.intensity)return r.finalize(),void c("No positions found in file");l=s(d.POSITION),h=o(d.intensity);break;case 2:case 3:if(!d.intensity)return r.finalize(),void c("No positions found in file");l=s(d.POSITION),h=a(d.COLOR_0,d.intensity)}for(var v=hx(l,15e5),g=hx(h,2e6),m=[],y=0,_=v.length;y<_;y++){var b="".concat(t.isManifest?"model"+t.index:"","pointsMesh").concat(y);m.push(b),r.createMesh({id:b,primitive:"points",positions:v[y],colorsCompressed:y<g.length?g[y]:null})}var w=t.entityId||De.createUUID();if(r.createEntity({id:w,meshIds:m,isObject:!0}),r.finalize(),t.metaModelJSON){var B=r.id;i.viewer.metaScene.createMetaModel(B,t.metaModelJSON,n)}else if(!1!==t.loadMetadata){var C=De.createUUID(),M={projectId:"",author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[{id:C,name:"Model",type:"Model"},{id:w,name:"PointCloud (LAS)",type:"PointCloud",parent:C,attributes:u||{}}],propertySets:[]},k=r.id;i.viewer.metaScene.createMetaModel(k,M,n)}A()}))}catch(e){r.finalize(),c(e)}}}))}}]),n}();function hx(e,t){if(t>=e.length)return[e];for(var n=[],r=0;r<e.length;r+=t)n.push(e.slice(r,r+t));return n}function dx(e){e.indexOf("?")>-1&&(e=e.split("?")[0]);var t=e.split("/");return t.pop(),t.join("/")+"/"}var fx=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getCityJSON",value:function(e,t,n){je.loadJSON(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}}]),e}(),px=De.vec2(),vx=De.vec3(),gx=De.vec3(),mx=De.vec3(),yx=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"cityJSONLoader",e,i)).dataSource=i.dataSource,r}return I(n,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new fx}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new Uo(this.viewer.scene,je.apply(e,{isModel:!0,edges:!0}));if(!e.src&&!e.cityJSON)return this.error("load() param expected: src or cityJSON"),t;var n={};if(e.src)this._loadModel(e.src,e,n,t);else{var r=this.viewer.scene.canvas.spinner;r.processes++,this._parseModel(e.cityJSON,e,n,t),r.processes--}return t}},{key:"_loadModel",value:function(e,t,n,r){var i=this,s=this.viewer.scene.canvas.spinner;s.processes++,this._dataSource.getCityJSON(t.src,(function(e){i._parseModel(e,t,n,r),s.processes--}),(function(e){s.processes--,i.error(e),r.fire("error",e)}))}},{key:"_parseModel",value:function(e,t,n,r){if(!r.destroyed){var i=e.transform?this._transformVertices(e.vertices,e.transform,n.rotateX):e.vertices,s=t.stats||{};s.sourceFormat=e.type||"CityJSON",s.schemaVersion=e.version||"",s.title="",s.author="",s.created="",s.numMetaObjects=0,s.numPropertySets=0,s.numObjects=0,s.numGeometries=0,s.numTriangles=0,s.numVertices=0;var a=!1!==t.loadMetadata,o=a?{id:De.createUUID(),name:"Model",type:"Model"}:null,A=a?{id:"",projectId:"",author:"",createdAt:"",schema:e.version||"",creatingApplication:"",metaObjects:[o],propertySets:[]}:null,c={data:e,vertices:i,sceneModel:r,loadMetadata:a,metadata:A,rootMetaObject:o,nextId:0,stats:s};if(this._parseCityJSON(c),r.finalize(),a){var l=r.id;this.viewer.metaScene.createMetaModel(l,c.metadata,n)}r.scene.once("tick",(function(){r.destroyed||(r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1))}))}}},{key:"_transformVertices",value:function(e,t,n){for(var r=[],i=t.scale||De.vec3([1,1,1]),s=t.translate||De.vec3([0,0,0]),a=0,o=0;a<e.length;a++,o+=3){var A=e[a][0]*i[0]+s[0],c=e[a][1]*i[1]+s[1],l=e[a][2]*i[2]+s[2];n?r.push([A,l,c]):r.push([A,c,l])}return r}},{key:"_parseCityJSON",value:function(e){var t=e.data.CityObjects;for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];this._parseCityObject(e,r,n)}}},{key:"_parseCityObject",value:function(e,t,n){var r=e.sceneModel,i=e.data;if(e.loadMetadata){var s=n,a=t.type,o=a+" : "+n,A=t.parents?t.parents[0]:e.rootMetaObject.id;e.metadata.metaObjects.push({id:s,name:o,type:a,parent:A})}if(e.stats.numMetaObjects++,t.geometry&&t.geometry.length>0){for(var c=[],l=0,u=t.geometry.length;l<u;l++){var h=t.geometry[l],d=void 0,f=void 0,p=i.appearance;if(p){var v=p.materials;if(v){var g=h.material;if(g){var m=Object.keys(g);if(m.length>0){var y=g[m[0]];if(void 0!==y.value)d=v[y.value];else{var _=y.values;if(_){f=[];for(var b=0,w=_.length;b<w;b++){var B=v[_[l]];f.push(B)}}}}}}}f?this._parseGeometrySurfacesWithOwnMaterials(e,h,f,c):this._parseGeometrySurfacesWithSharedMaterial(e,h,d,c)}c.length>0&&(r.createEntity({id:n,meshIds:c,isObject:!0}),e.stats.numObjects++)}}},{key:"_parseGeometrySurfacesWithOwnMaterials",value:function(e,t,n,r){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":var i=t.boundaries;this._parseSurfacesWithOwnMaterials(e,n,i,r);break;case"Solid":for(var s=t.boundaries,a=0;a<s.length;a++){var o=s[a];this._parseSurfacesWithOwnMaterials(e,n,o,r)}break;case"MultiSolid":case"CompositeSolid":for(var A=t.boundaries,c=0;c<A.length;c++)for(var l=0;l<A[c].length;l++){var u=A[c][l];this._parseSurfacesWithOwnMaterials(e,n,u,r)}}}},{key:"_parseSurfacesWithOwnMaterials",value:function(e,t,n,r){for(var i=e.vertices,s=e.sceneModel,a=0;a<n.length;a++){for(var o=n[a],A=t[a]||{diffuseColor:[.8,.8,.8],transparency:1},c=[],l=[],u=[],h={positions:[],indices:[]},d=0;d<o.length;d++){c.length>0&&l.push(c.length);var f=this._extractLocalIndices(e,o[d],u,h);c.push.apply(c,p(f))}if(3===c.length)h.indices.push(c[0]),h.indices.push(c[1]),h.indices.push(c[2]);else if(c.length>3){for(var v=[],g=0;g<c.length;g++)v.push({x:i[u[c[g]]][0],y:i[u[c[g]]][1],z:i[u[c[g]]][2]});for(var m=this._getNormalOfPositions(v,De.vec3()),y=[],_=0;_<v.length;_++)this._to2D(v[_],m,px),y.unshift(px[0]),y.unshift(px[1]);for(var b=W(y,l,2),w=0;w<b.length;w+=3)h.indices.unshift(c[b[w]]),h.indices.unshift(c[b[w+1]]),h.indices.unshift(c[b[w+2]])}var B=""+e.nextId++;s.createMesh({id:B,primitive:"triangles",positions:h.positions,indices:h.indices,color:A&&A.diffuseColor?A.diffuseColor:[.8,.8,.8],opacity:A&&void 0!==A.transparency?1-A.transparency:1}),r.push(B),e.stats.numGeometries++,e.stats.numVertices+=h.positions.length/3,e.stats.numTriangles+=h.indices.length/3}}},{key:"_parseGeometrySurfacesWithSharedMaterial",value:function(e,t,n,r){var i=e.sceneModel,s=[],a={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":var o=t.boundaries;this._parseSurfacesWithSharedMaterial(e,o,s,a);break;case"Solid":for(var A=t.boundaries,c=0;c<A.length;c++){var l=A[c];this._parseSurfacesWithSharedMaterial(e,l,s,a)}break;case"MultiSolid":case"CompositeSolid":for(var u=t.boundaries,h=0;h<u.length;h++)for(var d=0;d<u[h].length;d++){var f=u[h][d];this._parseSurfacesWithSharedMaterial(e,f,s,a)}}if(a.positions.length>0&&a.indices.length>0){var p=""+e.nextId++;i.createMesh({id:p,primitive:"triangles",positions:a.positions,indices:a.indices,color:n&&n.diffuseColor?n.diffuseColor:[.8,.8,.8],opacity:1}),r.push(p),e.stats.numGeometries++,e.stats.numVertices+=a.positions.length/3,e.stats.numTriangles+=a.indices.length/3}}},{key:"_parseSurfacesWithSharedMaterial",value:function(e,t,n,r){for(var i=e.vertices,s=0;s<t.length;s++){for(var a=[],o=[],A=0;A<t[s].length;A++){a.length>0&&o.push(a.length);var c=this._extractLocalIndices(e,t[s][A],n,r);a.push.apply(a,p(c))}if(3===a.length)r.indices.push(a[0]),r.indices.push(a[1]),r.indices.push(a[2]);else if(a.length>3){for(var l=[],u=0;u<a.length;u++)l.push({x:i[n[a[u]]][0],y:i[n[a[u]]][1],z:i[n[a[u]]][2]});for(var h=this._getNormalOfPositions(l,De.vec3()),d=[],f=0;f<l.length;f++)this._to2D(l[f],h,px),d.unshift(px[0]),d.unshift(px[1]);for(var v=W(d,o,2),g=0;g<v.length;g+=3)r.indices.unshift(a[v[g]]),r.indices.unshift(a[v[g+1]]),r.indices.unshift(a[v[g+2]])}}}},{key:"_extractLocalIndices",value:function(e,t,n,r){for(var i=e.vertices,s=[],a=0,o=t.length;a<o;a++){var A=t[a];if(n.includes(A)){var c=n.indexOf(A);s.push(c)}else r.positions.push(i[A][0]),r.positions.push(i[A][1]),r.positions.push(i[A][2]),s.push(n.length),n.push(A)}return s}},{key:"_getNormalOfPositions",value:function(e,t){for(var n=0;n<e.length;n++){var r=n+1;r===e.length&&(r=0),t[0]+=(e[n].y-e[r].y)*(e[n].z+e[r].z),t[1]+=(e[n].z-e[r].z)*(e[n].x+e[r].x),t[2]+=(e[n].x-e[r].x)*(e[n].y+e[r].y)}return De.normalizeVec3(t)}},{key:"_to2D",value:function(e,t,n){var r=vx,i=gx,s=mx;r[0]=e.x,r[1]=e.y,r[2]=e.z,i[0]=t.x,i[1]=t.y,i[2]=t.z,s[0]=1.1,s[1]=1.1,s[2]=1.1,De.lenVec3(De.subVec3(s,i))<.01&&(s[0]+=1,s[1]+=2,s[2]+=3);var a=De.dotVec3(s,i),o=De.mulVec3Scalar(i,a,De.vec3());s[0]-=o[0],s[1]-=o[1],s[2]-=o[2],De.normalizeVec3(s);var A=De.cross3Vec3(i,s,De.vec3()),c=De.dotVec3(r,s),l=De.dotVec3(r,A);n[0]=c,n[1]=l}}]),n}(),_x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};x(this,e),this.cacheBuster=!1!==t.cacheBuster}return I(e,[{key:"_cacheBusterURL",value:function(e){if(!this.cacheBuster)return e;var t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}},{key:"getDotBIM",value:function(e,t,n){je.loadJSON(this._cacheBusterURL(e),(function(e){t(e)}),(function(e){n(e)}))}}]),e}(),bx=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"DotBIMLoader",e,i)).dataSource=i.dataSource,r.objectDefaults=i.objectDefaults,r}return I(n,[{key:"dataSource",get:function(){return this._dataSource},set:function(e){this._dataSource=e||new _x}},{key:"objectDefaults",get:function(){return this._objectDefaults},set:function(e){this._objectDefaults=e||Ik}},{key:"load",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var n=new Uo(this.viewer.scene,je.apply(t,{isModel:!0,backfaces:t.backfaces,dtxEnabled:t.dtxEnabled,rotation:t.rotation,origin:t.origin})),r=n.id;if(!t.src&&!t.dotBIM)return this.error("load() param expected: src or dotBIM"),n;var i,s,a=t.objectDefaults||this._objectDefaults||Ik;if(t.includeTypes){i={};for(var o=0,A=t.includeTypes.length;o<A;o++)i[t.includeTypes[o]]=!0}if(t.excludeTypes){s={},i||(i={});for(var c=0,l=t.excludeTypes.length;c<l;c++)i[t.excludeTypes[c]]=!0}var u=function(t){for(var n=t.fileData,o=t.sceneModel,A={},c=De.createUUID(),l=De.createUUID(),u=De.createUUID(),h=De.createUUID(),d={metaObjects:[{id:c,name:"Project",type:"Project",parent:null},{id:l,name:"Site",type:"Site",parent:c},{id:u,name:"Building",type:"Building",parent:l},{id:h,name:"BuildingStorey",type:"BuildingStorey",parent:u}],propertySets:[]},f=n.elements,v=function(e,t){var r=f[e],c=r.type;if(s&&s[c])return"continue";if(i&&!i[c])return"continue";var l=r.info,u=void 0!==r.guid?"".concat(r.guid):void 0!==l&&void 0!==l.id?l.id:e,v=r.mesh_id,g=r.vector,m=r.rotation,y=a?a[c]||a.DEFAULT:null,_=!0,b=!0;if(void 0===r.face_colors){!function(e,t){if(!A[e]){var r=n.meshes.find((function(e){return e.mesh_id===t.mesh_id}));o.createGeometry({id:e,primitive:"triangles",positions:r.coordinates,indices:r.indices}),A[e]=!0}}(v,r);var w="".concat(u,"-mesh-").concat(v),B=r.color?[r.color.r/255,r.color.g/255,r.color.b/255]:[1,1,1],C=r.color?r.color.a/255:1;y&&(!1===y.visible&&(_=!1),!1===y.pickable&&(b=!1),y.colorize&&(B=y.colorize),void 0!==y.opacity&&null!==y.opacity&&(C=y.opacity)),o.createMesh({id:w,geometryId:v,color:B,opacity:C,quaternion:!m||0===m.qz&&0===m.qy&&0===m.qx&&1===m.qw?void 0:[m.qx,m.qy,m.qz,m.qw],position:g?[g.x,g.y,g.z]:void 0}),o.createEntity({id:u,meshIds:[w],visible:_,pickable:b,isObject:!0})}else{for(var M=r.face_colors,E={},F=0,x=n.meshes.find((function(e){return e.mesh_id===r.mesh_id})),U=0,I=M.length;U<I;U+=4){var T=[M[U],M[U+1],M[U+2],M[U+3]];void 0===E[T]&&(E[T]=[]);var P=x.indices[F],S=x.coordinates[3*P],D=x.coordinates[3*P+1],Q=x.coordinates[3*P+2],R=x.indices[F+1],O=x.coordinates[3*R],V=x.coordinates[3*R+1],L=x.coordinates[3*R+2],H=x.indices[F+2],N=x.coordinates[3*H],G=x.coordinates[3*H+1],j=x.coordinates[3*H+2];E[T].push(S,D,Q,O,V,L,N,G,j),F+=3}for(var W=[],z=0,X=Object.entries(E);z<X.length;z++){var K=k(X[z],2),Z=K[0],J=K[1];o.createGeometry({id:"".concat(v,"-").concat(Z),primitive:"triangles",positions:J,indices:p(Array(J.length/3).keys())});var Y="".concat(u,"-mesh-").concat(v,"-").concat(Z),q=Z.split(",").map(Number),$=[q[0]/255,q[1]/255,q[2]/255],ee=q[3]/255;y&&(!1===y.visible&&(_=!1),!1===y.pickable&&(b=!1),y.colorize&&($=y.colorize),void 0!==y.opacity&&null!==y.opacity&&(ee=y.opacity)),o.createMesh({id:Y,geometryId:"".concat(v,"-").concat(Z),color:$,opacity:ee,quaternion:!m||0===m.qz&&0===m.qy&&0===m.qx&&1===m.qw?void 0:[m.qx,m.qy,m.qz,m.qw],position:g?[g.x,g.y,g.z]:void 0}),W.push(Y)}o.createEntity({id:u,meshIds:W,visible:_,pickable:b,isObject:!0})}var te=[];for(var ne in l)te.push({name:ne,value:l[ne]});d.propertySets.push({id:u,name:"Properties",properties:te}),d.metaObjects.push({id:u,name:l&&l.Name&&"None"!==l.Name?l.Name:"".concat(r.type," ").concat(u),type:r.type,parent:h,propertySetIds:[u]})},g=0,m=f.length;g<m;g++)v(g);o.finalize(),e.viewer.metaScene.createMetaModel(r,d),o.scene.once("tick",(function(){o.destroyed||(o.scene.fire("modelLoaded",o.id),o.fire("loaded",!0,!1))}))};if(t.src){var h=t.src;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getDotBIM(h,(function(t){u({fileData:t,sceneModel:n,nextId:0,error:function(e){}}),e.viewer.scene.canvas.spinner.processes--}),(function(t){e.viewer.scene.canvas.spinner.processes--,e.error(t)}))}else if(t.dotBIM){var d={fileData:t.dotBIM,sceneModel:n,nextId:0,error:function(e){}};u(d)}return n.once("destroyed",(function(){e.viewer.metaScene.destroyMetaModel(r)})),n}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}(),wx=function(e){var t=function(t){return parseInt(e.substr(t+1,2),16)/255};return[t(0),t(2),t(4)]},Bx=function(e,t,n){var r=null,i=function(i){if(i){r&&r.destroy();try{var s,a,o=EM(i.map((function(e){return[e[0],e[2]]}))),A=k(o,2),c=A[0],l=A[1],u=(s=[]).concat.apply(s,p(c.map((function(e){return[e[0],i[0][1],e[1]]})))),h=(a=[]).concat.apply(a,p(l));r=new vi(e,{pickable:!1,geometry:new Wt(e,{positions:u,indices:h,normals:De.buildNormals(u,h)}),material:new wi(e,{alpha:void 0!==n?n:.5,backfaces:!0,diffuse:wx(t)})})}catch(e){r=null}}r&&(r.visible=!!i)};return i(null),{updateBase:i,destroy:function(){return r&&r.destroy()}}},Cx=function(e,t){return function(n,r,i){var s=e.scene,a=s.canvas.canvas,o=function(e,t){return t[0]=e.clientX,t[1]=e.clientY,pM(a.ownerDocument.documentElement,a,t),t},A=function(e){var n=De.vec3(),r=De.vec3();return De.canvasPosToWorldRay(a,s.camera.viewMatrix,s.camera.projMatrix,s.camera.projection,e,n,r),t(n,r)},c=!1,l=function(){c=!1},u=function(){l(),a.removeEventListener("mousedown",d),a.removeEventListener("mousemove",f),e.cameraControl.off(p),a.removeEventListener("mouseup",v)},h=De.vec2(),d=function(e){1===e.which&&(o(e,h),c=!0)};a.addEventListener("mousedown",d);var f=function(e){var t=o(e,De.vec2());c&&De.distVec2(h,t)>20&&(l(),n())};a.addEventListener("mousemove",f);var p=e.cameraControl.on("rayMove",(function(e){var t=e.canvasPos;r(t,A(t))})),v=function(e){if(1===e.which&&c){u();var t=o(e,De.vec2());i(t,A(t))}};return a.addEventListener("mouseup",v),u}},Mx=function(e,t,n,r){var i=-(De.dotVec3(n,t)-e)/De.dotVec3(r,t),s=De.vec3();return De.mulVec3Scalar(r,i,s),De.addVec3(n,s,s),s},kx=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(x(this,n),(r=t.call(this,e.viewer.scene,i)).plugin=e,r._container=i.container,!r._container)throw"config missing: container";return r._eventSubs={},r.plugin.viewer.scene,r._geometry=i.geometry,i.onMouseOver,i.onMouseLeave,i.onContextMenu,r._alpha="alpha"in i&&void 0!==i.alpha?i.alpha:.5,r.color=i.color,r._visible=!0,r._rebuildMesh(),r}return I(n,[{key:"_rebuildMesh",value:function(){var e,t=this,n=this.plugin.viewer.scene,r=this._geometry.planeCoordinates.slice(),i=this._geometry.height<0,s=this._geometry.altitude+(i?this._geometry.height:0),a=this._geometry.height*(i?-1:1),o=k(EM(r),3),A=o[0],c=o[1],l=o[2],h=[],d=[],f=function(e){var t,n=h.length,r=u(A);try{for(r.s();!(t=r.n()).done;){var i=t.value;h.push([i[0],s+(e?a:0),i[1]])}}catch(e){r.e(e)}finally{r.f()}var o,l=u(c);try{for(l.s();!(o=l.n()).done;){var f=o.value;d.push.apply(d,p((e?f:f.slice(0).reverse()).map((function(e){return e+n}))))}}catch(e){l.e(e)}finally{l.f()}};f(!1),f(!0);for(var v=function(e){var t=A[e],n=A[(A.length+e+(l?1:-1))%A.length],r=s,i=s+a,o=h.length;h.push([t[0],r,t[1]],[n[0],r,n[1]],[n[0],i,n[1]],[t[0],i,t[1]]),d.push.apply(d,p([0,1,2,0,2,3].map((function(e){return e+o}))))},g=0;g<A.length;++g)v(g);this._zoneMesh&&this._zoneMesh.destroy();var m=function(e){return Math.min.apply(Math,p(h.map((function(t){return t[e]}))))},y=function(e){return Math.max.apply(Math,p(h.map((function(t){return t[e]}))))},_=m(0),b=m(1),w=m(2),B=y(0),C=y(1),M=y(2);this._center=De.vec3([(_+B)/2,(b+C)/2,(w+M)/2]);var E=(e=[]).concat.apply(e,p(h.map((function(e){return De.subVec3(e,t._center,e)}))));this._zoneMesh=new vi(n,{origin:this._center,edges:this._edges,geometry:new Wt(n,{positions:E,indices:d,normals:De.buildNormals(E,d)}),material:new wi(n,{alpha:this._alpha,backfaces:!0,diffuse:wx(this._color)}),visible:this._visible}),this._zoneMesh.highlighted=this._highlighted,this._zoneMesh.zone=this;var F,x=De.vec2(),U=De.vec2(),I=0,T=u(c);try{for(T.s();!(F=T.n()).done;){var P=F.value,S=A[P[0]],D=A[P[1]],Q=A[P[2]];De.subVec2(D,S,x),De.subVec2(Q,S,U),I+=Math.abs(x[0]*U[1]-x[1]*U[0])}}catch(e){T.e(e)}finally{T.f()}this._baseArea=I/2,this._metrics=null}},{key:"baseArea",get:function(){return this._baseArea}},{key:"area",get:function(){return this._getMetrics().area}},{key:"volume",get:function(){return this._getMetrics().volume}},{key:"_getMetrics",value:function(){if(null===this._metrics){for(var e=0,t=0,n=this._zoneMesh.geometry,r=[De.vec3(),De.vec3(),De.vec3()],i=De.vec3(),s=0;s<n.indices.length;s+=3){for(var a=0;a<3;++a)for(var o=r[a],A=3*n.indices[s+a],c=0;c<3;++c)o[c]=n.positions[A+c];e+=De.dotVec3(r[0],De.cross3Vec3(r[1],r[2],i)),De.subVec3(r[1],r[0],r[1]),De.subVec3(r[2],r[0],r[2]),t+=De.lenVec3(De.cross3Vec3(r[1],r[2],i))}this._metrics={area:t/2,volume:e/6}}return this._metrics}},{key:"sectionedAverage",value:function(e){var t=this._geometry.planeCoordinates.slice(),n=[],r=this._geometry.height,i=this._geometry.altitude,s=i+Math.max(0,r),a=i+Math.min(0,r),o=function(e){var r=t.map((function(t){return[t[0],e?s:a,t[1]]}));n.push(e?r:r.slice(0).reverse())};o(!0),o(!1);for(var A=function(e,n){return[t[e][0],n,t[e][1]]},c=0;c<t.length;++c){var l=(c+1)%t.length;n.push([A(c,a),A(l,a),A(l,s),A(c,s)])}var h,d=u(e);try{for(d.s();!(h=d.n()).done;){var f,p=h.value,v=p.dir,g=p.dist,m=[],y=u(n);try{for(y.s();!(f=y.n()).done;){for(var _=f.value,b=1e-5,w=0,B=[],C=0;C<_.length;C++){var M=De.dotVec3(v,_[C])+g,k=M<-1e-5?2:M>b?1:0;w|=k,B.push(k)}switch(w){case 0:case 1:m.push(_);break;case 2:break;case 3:for(var E=[],F=0;F<_.length;F++){var x=(F+1)%_.length,U=B[F],I=B[x],T=_[F],P=_[x];if(2!==U&&E.push(T),3==(U|I)){var S=De.vec3();De.subVec3(P,T,S);var D=-(g+De.dotVec3(v,T))/De.dotVec3(v,S),Q=[0,0,0];De.lerpVec3(D,0,1,T,P,Q),E.push(Q)}}E.length>=3&&m.push(E)}}}catch(e){y.e(e)}finally{y.f()}n=m}}catch(e){d.e(e)}finally{d.f()}if(0===n.length)return null;var R,O=De.vec3([0,0,0]),V=new Set,L=u(n);try{for(L.s();!(R=L.n()).done;){var H,N=u(R.value);try{for(N.s();!(H=N.n()).done;){var G=H.value,j=G.map((function(e){return e.toFixed(3)})).join(":");V.has(j)||(V.add(j),De.addVec3(O,G,O))}}catch(e){N.e(e)}finally{N.f()}}}catch(e){L.e(e)}finally{L.f()}return De.mulVec3Scalar(O,1/V.size,O),O}},{key:"center",get:function(){return this._center}},{key:"altitude",get:function(){return this._geometry.altitude},set:function(e){this._geometry.altitude=e,this._rebuildMesh()}},{key:"height",get:function(){return this._geometry.height},set:function(e){this._geometry.height=e,this._rebuildMesh()}},{key:"highlighted",get:function(){return this._highlighted},set:function(e){this._highlighted=e,this._zoneMesh&&(this._zoneMesh.highlighted=e)}},{key:"color",get:function(){return this._color},set:function(e){this._color=e,this._zoneMesh&&(this._zoneMesh.material.diffuse=wx(this._color))}},{key:"alpha",get:function(){return this._alpha},set:function(e){this._alpha=e,this._zoneMesh&&(this._zoneMesh.material.alpha=this._alpha)}},{key:"edges",get:function(){return this._edges},set:function(e){this._edges=e,this._zoneMesh&&(this._zoneMesh.edges=this._edges)}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible=!!e,this._zoneMesh.visible=this._visible,this._needUpdate()}},{key:"getJSON",value:function(){return{id:this.id,geometry:this._geometry,alpha:this._alpha,color:this._color}}},{key:"duplicate",value:function(){return this.plugin.createZone({id:De.createUUID(),geometry:{planeCoordinates:this._geometry.planeCoordinates.map((function(e){return e.slice()})),altitude:this._geometry.altitude,height:this._geometry.height},alpha:this._alpha,color:this._color})}},{key:"destroy",value:function(){this._zoneMesh.destroy(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Ex=function(e){m(n,it);var t=_(n);function n(e,r,i){var s;return x(this,n),(s=t.call(this,e.viewer.scene)).zonesPlugin=e,s.pointerLens=r.pointerLens,s.createSelect3dPoint=i,s._deactivate=null,s}return I(n,[{key:"active",get:function(){return!!this._deactivate}},{key:"activate",value:function(e,t,n,r){if(!this._deactivate){if("object"===M(e)&&null!==e){var i=e,s=function(e,t){if(e in i)return i[e];if(void 0!==t)return t;throw"config missing: "+e};e=s("altitude"),t=s("height"),n=s("color","#008000"),r=s("alpha",.5)}var a=this.zonesPlugin,o=a.viewer,A=o.scene,c=this,l=this.createSelect3dPoint(o,(function(t,n){return Mx(e,De.vec3([0,1,0]),t,n)}));!function i(){var s=Bx(A,n,r),o=function(e,t,n,r,i,s){var a=wM(e,t),o=wM(e,t),A=n?function(e){n.visible=!!e,e&&(n.canvasPos=e)}:function(){},c=r((function(){A(null),a.update(null)}),(function(e,t){A(e),a.update(t)}),(function(e,t){a.update(t),c=r((function(){A(null),o.update(null),i(null)}),(function(e,n){A(e),o.update(n),i(De.distVec3(t,n)>.01&&[t,n])}),(function(e,n){o.update(n),a.destroy(),o.destroy(),A(null),s([t,n])}))}));return{deactivate:function(){c(),a.destroy(),o.destroy(),A(null)}}}(A,n,c.pointerLens,l,(function(e){if(e){var t=e[0],n=e[1],r=function(e){return Math.min(t[e],n[e])},i=function(e){return Math.max(t[e],n[e])},a=r(0),o=r(1),A=r(2),c=i(0);i(1);var l=i(2);s.updateBase([[a,o,l],[c,o,l],[c,o,A],[a,o,A]])}else s.updateBase(null)}),(function(o){s.destroy();var A=function(e,t,n,r,i,s,a){var o=function(n){return Math.min(e[n],t[n])},A=function(n){return Math.max(e[n],t[n])},c=o(0),l=o(2),u=A(0),h=A(2);return a.createZone({id:De.createUUID(),geometry:{planeCoordinates:[[c,h],[u,h],[u,l],[c,l]],altitude:n,height:r},alpha:s,color:i})}(o[0],o[1],e,t,n,r,a),l=!0;c._deactivate=function(){l=!1},c.fire("zoneEnd",A),l&&i()})).deactivate;c._deactivate=function(){o(),s.destroy()}}()}}},{key:"deactivate",value:function(){this._deactivate&&(this._deactivate(),this._deactivate=null)}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Fx=function(e){m(n,Ex);var t=_(n);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),t.call(this,e,r,(function(e,t){return Cx(e,t)}))}return I(n)}(),xx=function(e){m(n,Ex);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};x(this,n);var s=new ft(e.viewer);return(r=t.call(this,e,i,(function(e,t){return kM(e,s,t)}))).pointerCircle=s,r}return I(n,[{key:"destroy",value:function(){this.pointerCircle.destroy(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Ux=function(e){m(n,uA);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,"Zones",e))._pointerLens=i.pointerLens,r._container=i.container||document.body,r._zones=[],r.defaultColor=void 0!==i.defaultColor?i.defaultColor:"#00BBFF",r.zIndex=i.zIndex||1e4,r._onMouseOver=function(e,t){r.fire("mouseOver",{plugin:w(r),zone:t,event:e})},r._onMouseLeave=function(e,t){r.fire("mouseLeave",{plugin:w(r),zone:t,event:e})},r._onContextMenu=function(e,t){r.fire("contextMenu",{plugin:w(r),zone:t,event:e})},r}return I(n,[{key:"createZone",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);var n=new kx(this,{id:t.id,plugin:this,container:this._container,geometry:t.geometry,alpha:t.alpha,color:t.color,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._zones.push(n),n.on("destroyed",(function(){var t=e._zones.indexOf(n);t>=0&&e._zones.splice(t,1)})),this.fire("zoneCreated",n),n}},{key:"zones",get:function(){return this._zones}},{key:"destroy",value:function(){v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Ix=function(e,t,n,r,i,s,a,o,A){var c,l=s?function(e){s.visible=!!e,e&&(s.canvasPos=e)}:function(){},u=[function(){return l(null)}],h=Bx(e,r,i);return u.push((function(){return h.destroy()})),function s(d){var f=wM(e,r),p=d.length>0&&BM(e,r),v=p&&d[d.length-1].getWorldPos();u.push((function(){f.destroy(),p&&p.destroy()}));var g=d.length>0&&d[0],m=function(e){var t=g&&g.getCanvasPos();return t&&De.distVec2(t,e)<10&&{canvasPos:t,worldPos:g.getWorldPos()}},y=function(){var e=function(e,t,n){return t[0]<=Math.max(e[0],n[0])&&t[0]>=Math.min(e[0],n[0])&&t[1]<=Math.max(e[1],n[1])&&t[1]>=Math.min(e[1],n[1])},t=function(e,t,n){var r=(t[1]-e[1])*(n[0]-t[0])-(t[0]-e[0])*(n[1]-t[1]);return 0===r?0:r>0?1:2};return function(n,r){for(var i=n[n.length-2],s=n[n.length-1],a=r?1:0;a<n.length-2-1;++a){var o=n[a],A=n[a+1],c=t(i,s,o),l=t(i,s,A),u=t(o,A,i),h=t(o,A,s);if(c!==l&&u!==h||0===c&&e(i,o,s)||0===l&&e(i,A,s)||0===u&&e(o,i,A)||0===h&&e(o,s,A))return!0}return!1}}();c=o((function(){l(null),f.update(null),p&&p.update(v,null),h.updateBase(d.length>2?d.map((function(e){return e.getWorldPos()})):null)}),(function(e,t){var n=d.length>2&&m(e);if(g&&g.setHighlighted(!!n),l(n?n.canvasPos:e),f.update(!n&&t),p&&p.update(v,n?n.worldPos:t),d.length>=2){var r=d.map((function(e){return e.getWorldPos()})).concat(n?[]:[t]),i=y(r.map((function(e){return[e[0],e[2]]})),n);h.updateBase(i?null:r)}else h.updateBase(null)}),(function(e,o){var c=d.length>2&&m(e),l=d.map((function(e){return e.getWorldPos()})).concat(c?[]:[o]);h.updateBase(l);var g=l.map((function(e){return[e[0],e[2]]}));d.length>2&&y(g,c)?(u.pop()(),s(d)):c?(f.update(o),u.forEach((function(e){return e()})),A(a.createZone({id:De.createUUID(),geometry:{planeCoordinates:g,altitude:t,height:n},alpha:i,color:r}))):(f.update(o),p&&p.update(v,o),s(d.concat(f)))}))}([]),{closeSurface:function(){throw"TODO"},deactivate:function(){c(),u.forEach((function(e){return e()}))}}},Tx=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e.viewer.scene)).zonesPlugin=e,r.pointerLens=i.pointerLens,r._action=null,r}return I(n,[{key:"active",get:function(){return!!this._action}},{key:"activate",value:function(e,t,n,r){if("object"===M(e)&&null!==e){var i=e,s=function(e,t){if(e in i)return i[e];if(void 0!==t)return t;throw"config missing: "+e};e=s("altitude"),t=s("height"),n=s("color","#008000"),r=s("alpha",.5)}if(!this._action){var a=this.zonesPlugin,o=a.viewer,A=o.scene,c=this,l=Cx(o,(function(t,n){return Mx(e,De.vec3([0,1,0]),t,n)}));!function i(){c._action=Ix(A,e,t,n,r,c.pointerLens,a,l,(function(e){var t=!0;c._action={deactivate:function(){t=!1}},c.fire("zoneEnd",e),t&&i()}))}()}}},{key:"deactivate",value:function(){this._action&&(this._action.deactivate(),this._action=null)}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Px=function(e){m(n,it);var t=_(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x(this,n),(r=t.call(this,e.viewer.scene)).zonesPlugin=e,r.pointerLens=i.pointerLens,r.pointerCircle=new ft(e.viewer),r._action=null,r}return I(n,[{key:"active",get:function(){return!!this._action}},{key:"activate",value:function(e,t,n,r){if("object"===M(e)&&null!==e){var i=e,s=function(e,t){if(e in i)return i[e];if(void 0!==t)return t;throw"config missing: "+e};e=s("altitude"),t=s("height"),n=s("color","#008000"),r=s("alpha",.5)}if(!this._action){var a=this.zonesPlugin,o=a.viewer,A=o.scene,c=this,l=kM(o,this.pointerCircle,(function(t,n){return Mx(e,De.vec3([0,1,0]),t,n)}));!function i(){c._action=Ix(A,e,t,n,r,c.pointerLens,a,l,(function(e){var t=!0;c._action={deactivate:function(){t=!1}},c.fire("zoneEnd",e),t&&i()}))}()}}},{key:"deactivate",value:function(){this._action&&(this._action.deactivate(),this._action=null)}},{key:"destroy",value:function(){this.deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Sx=function(e){m(n,it);var t=_(n);function n(e,r,i,s){var a;x(this,n);var o=e.plugin.viewer,A=o.scene;a=t.call(this,A);var c=e._geometry.altitude,l=e._geometry.planeCoordinates.map((function(t){var n=A.canvas.canvas.ownerDocument.body,r=new yM(A,{},n,{fillColor:e._color});return r.worldPos=De.vec3([t[0],c,t[1]]),r.on("worldPos",(function(){t[0]=r.worldPos[0],t[1]=r.worldPos[2];try{e._rebuildMesh()}catch(t){e._zoneMesh&&(e._zoneMesh.destroy(),e._zoneMesh=null)}})),r})),u=MM({viewer:o,handleMouseEvents:i,handleTouchEvents:s,pointerLens:r&&r.pointerLens,dots:l,ray2WorldPos:function(e,t){return Mx(c,De.vec3([0,1,0]),e,t)},onEnd:function(t,n){return e._zoneMesh&&a.fire("edited"),!!e._zoneMesh}}),h=function(){u(),l.forEach((function(e){return e.destroy()}))},d=e.on("destroyed",h);return a._deactivate=function(){e.off("destroyed",d),h()},a}return I(n,[{key:"deactivate",value:function(){this._deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Dx=function(e){m(n,Sx);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!0,!1)}return I(n)}(),Qx=function(e){m(n,Sx);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!1,!0)}return I(n)}(),Rx=function(e){m(n,it);var t=_(n);function n(e,r,i,s){var a;x(this,n);var o=e.plugin.viewer,A=o.scene,c=A.canvas.canvas,l=w(a=t.call(this,A)),u=e._geometry.altitude,h=r&&r.pointerLens,d=h?function(e){h.visible=!!e,e&&(h.canvasPos=e)}:function(){},f=function(e){var t,n,r=De.vec3(),i=De.vec3();return De.canvasPosToWorldRay(c,A.camera.viewMatrix,A.camera.projMatrix,A.camera.projection,e,r,i),t=r,n=i,Mx(u,De.vec3([0,1,0]),t,n)},v=function(e,t){return t[0]=e.clientX,t[1]=e.clientY,pM(c.ownerDocument.documentElement,c,t),t},g=function(e,t){var n=function(e){e.preventDefault(),t(e)};return c.addEventListener(e,n),function(){return c.removeEventListener(e,n)}},m=function(){},y=function(t,n,r,i){var s,a,A,u,h=i(t),p=v(h,De.vec2()),y=o.scene.pick({canvasPos:p,includeEntities:[e._zoneMesh.id]});if((y&&y.entity&&y.entity.zone)===e){m(),c.style.cursor="move",o.cameraControl.active=!1;var _=(s=e._geometry.planeCoordinates.map((function(e){return e.slice()})),a=f(p),A=De.vec2([a[0],a[2]]),u=De.vec2(),function(t){var n=f(t);u[0]=n[0],u[1]=n[2],De.subVec2(A,u,u),e._geometry.planeCoordinates.forEach((function(e,t){De.subVec2(s[t],u,e)}));try{e._rebuildMesh()}catch(t){e._zoneMesh&&(e._zoneMesh.destroy(),e._zoneMesh=null)}}),b=g(n,(function(e){var t=i(e);if(t){var n=v(t,De.vec2());_(n),d(n)}})),w=g(r,(function(e){var t=i(e);if(t){var n=v(t,De.vec2());_(n),d(null),m(),l.fire("translated")}}));m=function(){m=function(){},c.style.cursor="default",o.cameraControl.active=!0,b(),w()}}},_=[];i&&_.push(g("mousedown",(function(e){1===e.which&&y(e,"mousemove","mouseup",(function(e){return 1===e.which&&e}))}))),s&&_.push(g("touchstart",(function(e){if(1===e.touches.length){var t=e.touches[0].identifier;y(e,"touchmove","touchend",(function(e){return p(e.changedTouches).find((function(e){return e.identifier===t}))}))}})));var b=function(){m(),_.forEach((function(e){return e()})),d(null)},B=e.on("destroyed",b);return a._deactivate=function(){e.off("destroyed",B),b()},a}return I(n,[{key:"deactivate",value:function(){this._deactivate(),v(C(n.prototype),"destroy",this).call(this)}}]),n}(),Ox=function(e){m(n,Rx);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!0,!1)}return I(n)}(),Vx=function(e){m(n,Rx);var t=_(n);function n(e,r){return x(this,n),t.call(this,e,r,!1,!0)}return I(n)}();export{Jn as AlphaFormat,Po as AmbientLight,WM as AngleMeasurementEditMouseControl,zM as AngleMeasurementEditTouchControl,VM as AngleMeasurementsControl,LM as AngleMeasurementsMouseControl,HM as AngleMeasurementsPlugin,GM as AngleMeasurementsTouchControl,qM as AnnotationsPlugin,$M as AxisGizmoPlugin,ik as BCFViewpointsPlugin,Yi as Bitmap,Ln as ByteType,zo as CameraMemento,bt as CameraPath,Ft as CameraPathAnimation,yx as CityJSONLoaderPlugin,En as ClampToEdgeWrapping,it as Component,Vr as CompressedMediaType,Ys as Configs,G as ContextMenu,Yo as CubicBezierCurve,mt as Curve,ex as CxConverterIFCLoaderPlugin,ja as DefaultLoadingManager,tr as DepthFormat,nr as DepthStencilFormat,Do as DirLight,yk as DistanceMeasurementEditControl,_k as DistanceMeasurementEditMouseControl,bk as DistanceMeasurementEditTouchControl,fk as DistanceMeasurementsControl,pk as DistanceMeasurementsMouseControl,vk as DistanceMeasurementsPlugin,mk as DistanceMeasurementsTouchControl,yM as Dot3D,_x as DotBIMDefaultDataSource,bx as DotBIMLoaderPlugin,Zi as EdgeMaterial,Xi as EmphasisMaterial,hE as FaceAlignedSectionPlanesPlugin,wk as FastNavPlugin,Wn as FloatType,Ji as Fresnel,ct as Frustum,At as FrustumPlane,Qr as GIFMediaType,Bk as GLTFDefaultDataSource,Tk as GLTFLoaderPlugin,zn as HalfFloatType,tx as IFCOpenShellDefaultDataSource,nx as IFCOpenShellLoaderPlugin,Oi as ImagePlane,Gn as IntType,Rr as JPEGMediaType,Ja as KTX2TextureTranscoder,ux as LASLoaderPlugin,_M as Label3D,Vi as LambertMaterial,Ho as LightMap,Io as LineSet,Sr as LinearEncoding,Sn as LinearFilter,On as LinearMipMapLinearFilter,Qn as LinearMipMapNearestFilter,Rn as LinearMipmapLinearFilter,Dn as LinearMipmapNearestFilter,Wa as Loader,Ga as LoadingManager,pt as LocaleService,er as LuminanceAlphaFormat,$n as LuminanceFormat,O as Map,jo as Marker,ht as MarqueePicker,dt as MarqueePickerMouseControl,vi as Mesh,ls as MeshSurfaceArea,ns as MeshVolume,Ni as MetallicMaterial,Fn as MirroredRepeatWrapping,Ko as ModelMemento,Qk as NavCubePlugin,xn as NearestFilter,Pn as NearestMipMapLinearFilter,Un as NearestMipMapNearestFilter,Tn as NearestMipmapLinearFilter,In as NearestMipmapNearestFilter,bn as Node,zk as OBJLoaderPlugin,Re as ObjectsKdTree3,Jo as ObjectsMemento,Or as PNGMediaType,qo as Path,eA as PerformanceModel,wi as PhongMaterial,cA as PickResult,uA as Plugin,Qo as PointLight,ft as PointerCircle,j as PointerLens,$o as QuadraticBezierCurve,Oe as Queue,qn as RGBAFormat,or as RGBAIntegerFormat,Ur as RGBA_ASTC_10x10_Format,Er as RGBA_ASTC_10x5_Format,Fr as RGBA_ASTC_10x6_Format,xr as RGBA_ASTC_10x8_Format,Ir as RGBA_ASTC_12x10_Format,Tr as RGBA_ASTC_12x12_Format,yr as RGBA_ASTC_4x4_Format,_r as RGBA_ASTC_5x4_Format,br as RGBA_ASTC_5x5_Format,wr as RGBA_ASTC_6x5_Format,Br as RGBA_ASTC_6x6_Format,Cr as RGBA_ASTC_8x5_Format,Mr as RGBA_ASTC_8x6_Format,kr as RGBA_ASTC_8x8_Format,Pr as RGBA_BPTC_Format,mr as RGBA_ETC2_EAC_Format,pr as RGBA_PVRTC_2BPPV1_Format,fr as RGBA_PVRTC_4BPPV1_Format,cr as RGBA_S3TC_DXT1_Format,lr as RGBA_S3TC_DXT3_Format,ur as RGBA_S3TC_DXT5_Format,Yn as RGBFormat,vr as RGB_ETC1_Format,gr as RGB_ETC2_Format,dr as RGB_PVRTC_2BPPV1_Format,hr as RGB_PVRTC_4BPPV1_Format,Ar as RGB_S3TC_DXT1_Format,sr as RGFormat,ar as RGIntegerFormat,Wt as ReadableGeometry,rr as RedFormat,ir as RedIntegerFormat,Lo as ReflectionMap,kn as RepeatWrapping,dE as STLDefaultDataSource,wE as STLLoaderPlugin,Uo as SceneModel,ps as SceneModelMesh,bo as SceneModelTransform,oA as SectionPlane,qk as SectionPlanesPlugin,Hn as ShortType,Wi as SpecularMaterial,yt as SplineCurve,Wo as SpriteMarker,iE as StoreyViewsPlugin,Ti as Texture,AA as TextureTranscoder,Xk as TransformControl,ME as TreeViewPlugin,Vn as UnsignedByteType,Zn as UnsignedInt248Type,jn as UnsignedIntType,Xn as UnsignedShort4444Type,Kn as UnsignedShort5551Type,Nn as UnsignedShortType,Kt as VBOGeometry,UE as ViewCullPlugin,IM as Viewer,YF as WebIFCLoaderPlugin,bM as Wire3D,Ka as WorkerPool,IE as XKTDefaultDataSource,PF as XKTLoaderPlugin,ZF as XML3DLoaderPlugin,Sx as ZoneEditControl,Dx as ZoneEditMouseControl,Qx as ZoneEditTouchControl,Rx as ZoneTranslateControl,Ox as ZoneTranslateMouseControl,Vx as ZoneTranslateTouchControl,Fx as ZonesMouseControl,Ux as ZonesPlugin,Tx as ZonesPolysurfaceMouseControl,Px as ZonesPolysurfaceTouchControl,xx as ZonesTouchControl,CM as activateDraggableDot,MM as activateDraggableDots,FM as addMousePressListener,xM as addTouchPressListener,qt as buildBoxGeometry,$t as buildBoxLinesGeometry,en as buildBoxLinesGeometryFromAABB,tn as buildCylinderGeometry,nn as buildGridGeometry,un as buildLineGeometry,rn as buildPlaneGeometry,cn as buildPolylineGeometry,ln as buildPolylineGeometryFromCurve,sn as buildSphereGeometry,an as buildTorusGeometry,An as buildVectorTextGeometry,TM as createCombinedTexture,Bn as createRTCViewMat,SM as createSkyboxMesh,DM as createSphereMapMesh,ut as frustumIntersectsAABB3,qa as getKTX2TextureTranscoder,qi as isTriangleMeshSolid,Jt as load3DSGeometry,Yt as loadOBJGeometry,wM as marker3D,De as math,us as meshSurfaceArea,rs as meshVolume,lA as os,Dr as sRGBEncoding,lt as setFrustum,UM as startPolygonCreate,Ve as stats,kM as touchPointSelector,pM as transformToNode,EM as triangulateEarClipping,je as utils,BM as wire3D,Cn as worldToRTCPos,Mn as worldToRTCPositions};
