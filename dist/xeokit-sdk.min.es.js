class t{constructor(t,e){this.items=t||[],this._lastUniqueId=(e||0)+1}addItem(){let t;if(2===arguments.length){const e=arguments[0];if(t=arguments[1],this.items[e])throw"ID clash: '"+e+"'";return this.items[e]=t,e}for(t=arguments[0]||{};;){const e=this._lastUniqueId++;if(!this.items[e])return this.items[e]=t,e}}removeItem(t){const e=this.items[t];return delete this.items[t],e}}const e=new t;class s{constructor(t){this.id=t,this.parentItem=null,this.groups=[],this.menuElement=null,this.shown=!1,this.mouseOver=0}}class i{constructor(){this.items=[]}}class r{constructor(t,e,s,i,r){this.id=t,this.getTitle=e,this.doAction=s,this.getEnabled=i,this.getShown=r,this.itemElement=null,this.subMenu=null,this.enabled=!0}}class o{constructor(t={}){this._id=e.addItem(),this._context=null,this._enabled=!1,this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={},this._shown=!1,this._nextId=0,this._eventSubs={},!1!==t.hideOnMouseDown&&(document.addEventListener("mousedown",(t=>{t.target.classList.contains("xeokit-context-menu-item")||this.hide()})),document.addEventListener("touchstart",this._canvasTouchStartHandler=t=>{t.target.classList.contains("xeokit-context-menu-item")||this.hide()})),t.items&&(this.items=t.items),this.context=t.context,this.enabled=!1!==t.enabled,this.hide()}on(t,e){let s=this._eventSubs[t];s||(s=[],this._eventSubs[t]=s),s.push(e)}fire(t,e){const s=this._eventSubs[t];if(s)for(let t=0,i=s.length;t<i;t++)s[t](e)}set items(t){this._clear(),this._itemsCfg=t||[],this._parseItems(t),this._createUI()}get items(){return this._itemsCfg}set enabled(t){(t=!!t)!==this._enabled&&(this._enabled=t,this._enabled||this.hide())}get enabled(){return this._enabled}set context(t){this._context=t}get context(){return this._context}show(t,e){this._context?this._enabled&&(this._shown||(this._hideAllMenus(),this._updateItemsTitles(),this._updateItemsEnabledStatus(),this._showMenu(this._rootMenu.id,t,e),this._shown=!0,this.fire("shown",{}))):console.error("ContextMenu cannot be shown without a context - set context first")}get shown(){return this._shown}hide(){this._enabled&&this._shown&&(this._hideAllMenus(),this._shown=!1,this.fire("hidden",{}))}destroy(){this._context=null,this._clear(),null!==this._id&&(e.removeItem(this._id),this._id=null)}_clear(){for(let t=0,e=this._menuList.length;t<e;t++){const e=this._menuList[t].menuElement;e.parentElement.removeChild(e)}this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={}}_parseItems(t){const e=t=>{const o=this._getNextId(),n=new s(o);for(let s=0,o=t.length;s<o;s++){const o=t[s],a=new i;n.groups.push(a);for(let t=0,s=o.length;t<s;t++){const s=o[t],i=s.items,h=i&&i.length>0,l=this._getNextId(),u=s.getTitle||(()=>s.title||""),p=s.doAction||s.callback||(()=>{}),c=s.getEnabled||(()=>!0),d=s.getShown||(()=>!0),m=new r(l,u,p,c,d);if(m.parentMenu=n,a.items.push(m),h){const t=e(i);m.subMenu=t,t.parentItem=m}this._itemList.push(m),this._itemMap[m.id]=m}}return this._menuList.push(n),this._menuMap[n.id]=n,n};this._rootMenu=e(t)}_getNextId(){return"ContextMenu_"+this._id+this._nextId++}_createUI(){const t=e=>{this._createMenuUI(e);const s=e.groups;for(let e=0,i=s.length;e<i;e++){const i=s[e].items;for(let e=0,s=i.length;e<s;e++){const s=i[e].subMenu;s&&t(s)}}};t(this._rootMenu)}_createMenuUI(t){const e=t.groups,s=[];if(s.push('<div class="xeokit-context-menu '+t.id+'" style="z-index:300000; position: absolute;">'),s.push("<ul>"),e)for(let t=0,i=e.length;t<i;t++){const r=t,o=i,n=e[t].items;if(n)for(let t=0,e=n.length;t<e;t++){const i=n[t],a=i.subMenu,h=i.title||"";a?s.push('<li id="'+i.id+'" class="xeokit-context-menu-item" style="'+(r===o-1||t<e-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+h+" [MORE]</li>"):s.push('<li id="'+i.id+'" class="xeokit-context-menu-item" style="'+(r===o-1||t<e-1?"border-bottom: 0":"border-bottom: 1px solid black")+'">'+h+"</li>")}}s.push("</ul>"),s.push("</div>");const i=s.join("");document.body.insertAdjacentHTML("beforeend",i);const r=document.querySelector("."+t.id);t.menuElement=r,r.style["border-radius"]="4px",r.style.display="none",r.style["z-index"]=3e5,r.style.background="white",r.style.border="1px solid black",r.style["box-shadow"]="0 4px 5px 0 gray",r.oncontextmenu=t=>{t.preventDefault()};const o=this;let n=null;if(e)for(let t=0,s=e.length;t<s;t++){const s=e[t].items;if(s)for(let t=0,e=s.length;t<e;t++){const e=s[t],i=e.subMenu;e.itemElement=document.getElementById(e.id),e.itemElement?(e.itemElement.addEventListener("mouseenter",(t=>{if(t.preventDefault(),!1===e.enabled)return;const s=e.subMenu;if(!s)return void(n&&(o._hideMenu(n.id),n=null));n&&n.id!==s.id&&(o._hideMenu(n.id),n=null);const i=e.itemElement,r=s.menuElement,a=i.getBoundingClientRect();r.getBoundingClientRect();a.right+200>window.innerWidth?o._showMenu(s.id,a.left-200,a.top-1):o._showMenu(s.id,a.right-5,a.top-1),n=s})),i||(e.itemElement.addEventListener("click",(t=>{t.preventDefault(),o.hide(),o._context&&!1!==e.enabled&&e.doAction&&e.doAction(o._context)})),e.itemElement.addEventListener("mouseenter",(t=>{t.preventDefault(),!1!==e.enabled&&e.doHover&&e.doHover(o._context)})))):console.error("ContextMenu item element not found: "+e.id)}}}_updateItemsTitles(){if(this._context)for(let t=0,e=this._itemList.length;t<e;t++){const e=this._itemList[t],s=e.itemElement;if(!s)continue;const i=e.getShown;if(!i||!i(this._context))continue;const r=e.getTitle(this._context);e.subMenu,s.innerText=r}}_updateItemsEnabledStatus(){if(this._context)for(let t=0,e=this._itemList.length;t<e;t++){const e=this._itemList[t],s=e.itemElement;if(!s)continue;const i=e.getEnabled;if(!i)continue;const r=e.getShown;if(!r)continue;const o=r(this._context);if(e.shown=o,!o){s.style.visibility="hidden",s.style.height="0",s.style.padding="0";continue}s.style.visibility="visible",s.style.height="auto",s.style.padding=null;const n=i(this._context);e.enabled=n,n?s.classList.remove("disabled"):s.classList.add("disabled")}}_showMenu(t,e,s){const i=this._menuMap[t];if(!i)return void console.error("Menu not found: "+t);if(i.shown)return;const r=i.menuElement;r&&(this._showMenuElement(r,e,s),i.shown=!0)}_hideMenu(t){const e=this._menuMap[t];if(!e)return void console.error("Menu not found: "+t);if(!e.shown)return;const s=e.menuElement;s&&(this._hideMenuElement(s),e.shown=!1)}_hideAllMenus(){for(let t=0,e=this._menuList.length;t<e;t++){const e=this._menuList[t];this._hideMenu(e.id)}}_showMenuElement(t,e,s){t.style.display="block";const i=t.offsetHeight,r=t.offsetWidth;s+i>window.innerHeight&&(s=window.innerHeight-i),e+r>window.innerWidth&&(e=window.innerWidth-r),t.style.left=e+"px",t.style.top=s+"px"}_hideMenuElement(t){t.style.display="none"}}class n{constructor(t,e,s){this.id=s&&s.id?s.id:t,this.viewer=e,this._eventSubs={},e.addPlugin(this)}on(t,e){let s=this._eventSubs[t];s||(s=[],this._eventSubs[t]=s),s.push(e)}fire(t,e){const s=this._eventSubs[t];if(s)for(let t=0,i=s.length;t<i;t++)s[t](e)}log(t){console.log(`[xeokit plugin ${this.id}]: ${t}`)}warn(t){console.warn(`[xeokit plugin ${this.id}]: ${t}`)}error(t){console.error(`[xeokit plugin ${this.id}]: ${t}`)}send(t,e){}destroy(){this.viewer.removePlugin(this)}}let a=!0,h=a?Float64Array:Float32Array;const l=new h(16),u=new h(16),p=new h(4),c={setDoublePrecisionEnabled(t){a=t,h=a?Float64Array:Float32Array},getDoublePrecisionEnabled:()=>a,MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId(t,e){const s=e.indexOf("#");return s===t.length&&e.startsWith(t)?e.substring(s+1):e},globalizeObjectId:(t,e)=>t+"#"+e,vec2:t=>new h(t||2),vec3:t=>new h(t||3),vec4:t=>new h(t||4),mat3:t=>new h(t||9),mat3ToMat4:(t,e=new h(16))=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=0,e[4]=t[3],e[5]=t[4],e[6]=t[5],e[7]=0,e[8]=t[6],e[9]=t[7],e[10]=t[8],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e),mat4:t=>new h(t||16),mat4ToMat3(t,e){},doublesToFloats(t,e,s){const i=new h(2);for(let r=0,o=t.length;r<o;r++)c.splitDouble(t[r],i),e[r]=i[0],s[r]=i[1]},splitDouble(t,e){const s=h.from([t])[0],i=t-s;e[0]=s,e[1]=i},createUUID:(()=>{const t=[];for(let e=0;e<256;e++)t[e]=(e<16?"0":"")+e.toString(16);return()=>{const e=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return`${t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]}-${t[255&s]}${t[s>>8&255]}-${t[s>>16&15|64]}${t[s>>24&255]}-${t[63&i|128]}${t[i>>8&255]}-${t[i>>16&255]}${t[i>>24&255]}${t[255&r]}${t[r>>8&255]}${t[r>>16&255]}${t[r>>24&255]}`}})(),clamp:(t,e,s)=>Math.max(e,Math.min(s,t)),fmod(t,e){if(t<e)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),t;for(;e<=t;)t-=e;return t},compareVec3:(t,e)=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2],negateVec3:(t,e)=>(e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e),negateVec4:(t,e)=>(e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e),addVec4:(t,e,s)=>(s||(s=t),s[0]=t[0]+e[0],s[1]=t[1]+e[1],s[2]=t[2]+e[2],s[3]=t[3]+e[3],s),addVec4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]+e,s[1]=t[1]+e,s[2]=t[2]+e,s[3]=t[3]+e,s),addVec3:(t,e,s)=>(s||(s=t),s[0]=t[0]+e[0],s[1]=t[1]+e[1],s[2]=t[2]+e[2],s),addVec3Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]+e,s[1]=t[1]+e,s[2]=t[2]+e,s),subVec4:(t,e,s)=>(s||(s=t),s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],s[3]=t[3]-e[3],s),subVec3:(t,e,s)=>(s||(s=t),s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],s),subVec2:(t,e,s)=>(s||(s=t),s[0]=t[0]-e[0],s[1]=t[1]-e[1],s),geometricMeanVec2(...t){const e=new h(t[0]);for(let s=1;s<t.length;s++)e[0]+=t[s][0],e[1]+=t[s][1];return e[0]/=t.length,e[1]/=t.length,e},subVec4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]-e,s[1]=t[1]-e,s[2]=t[2]-e,s[3]=t[3]-e,s),subScalarVec4:(t,e,s)=>(s||(s=t),s[0]=e-t[0],s[1]=e-t[1],s[2]=e-t[2],s[3]=e-t[3],s),mulVec4:(t,e,s)=>(s||(s=t),s[0]=t[0]*e[0],s[1]=t[1]*e[1],s[2]=t[2]*e[2],s[3]=t[3]*e[3],s),mulVec4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]*e,s[1]=t[1]*e,s[2]=t[2]*e,s[3]=t[3]*e,s),mulVec3Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]*e,s[1]=t[1]*e,s[2]=t[2]*e,s),mulVec2Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]*e,s[1]=t[1]*e,s),divVec3:(t,e,s)=>(s||(s=t),s[0]=t[0]/e[0],s[1]=t[1]/e[1],s[2]=t[2]/e[2],s),divVec4:(t,e,s)=>(s||(s=t),s[0]=t[0]/e[0],s[1]=t[1]/e[1],s[2]=t[2]/e[2],s[3]=t[3]/e[3],s),divScalarVec3:(t,e,s)=>(s||(s=e),s[0]=t/e[0],s[1]=t/e[1],s[2]=t/e[2],s),divVec3Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]/e,s[1]=t[1]/e,s[2]=t[2]/e,s),divVec4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]/e,s[1]=t[1]/e,s[2]=t[2]/e,s[3]=t[3]/e,s),divScalarVec4:(t,e,s)=>(s||(s=e),s[0]=t/e[0],s[1]=t/e[1],s[2]=t/e[2],s[3]=t/e[3],s),dotVec4:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3],cross3Vec4(t,e){const s=t[0],i=t[1],r=t[2],o=e[0],n=e[1],a=e[2];return[i*a-r*n,r*o-s*a,s*n-i*o,0]},cross3Vec3(t,e,s){s||(s=t);const i=t[0],r=t[1],o=t[2],n=e[0],a=e[1],h=e[2];return s[0]=r*h-o*a,s[1]=o*n-i*h,s[2]=i*a-r*n,s},sqLenVec4:t=>c.dotVec4(t,t),lenVec4:t=>Math.sqrt(c.sqLenVec4(t)),dotVec3:(t,e)=>t[0]*e[0]+t[1]*e[1]+t[2]*e[2],dotVec2:(t,e)=>t[0]*e[0]+t[1]*e[1],sqLenVec3:t=>c.dotVec3(t,t),sqLenVec2:t=>c.dotVec2(t,t),lenVec3:t=>Math.sqrt(c.sqLenVec3(t)),distVec3:(()=>{const t=new h(3);return(e,s)=>c.lenVec3(c.subVec3(e,s,t))})(),lenVec2:t=>Math.sqrt(c.sqLenVec2(t)),distVec2:(()=>{const t=new h(2);return(e,s)=>c.lenVec2(c.subVec2(e,s,t))})(),rcpVec3:(t,e)=>c.divScalarVec3(1,t,e),normalizeVec4(t,e){const s=1/c.lenVec4(t);return c.mulVec4Scalar(t,s,e)},normalizeVec3(t,e){const s=1/c.lenVec3(t);return c.mulVec3Scalar(t,s,e)},normalizeVec2(t,e){const s=1/c.lenVec2(t);return c.mulVec2Scalar(t,s,e)},angleVec3(t,e){let s=c.dotVec3(t,e)/Math.sqrt(c.sqLenVec3(t)*c.sqLenVec3(e));return s=s<-1?-1:s>1?1:s,Math.acos(s)},vec3FromMat4Scale:(()=>{const t=new h(3);return(e,s)=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],s[0]=c.lenVec3(t),t[0]=e[4],t[1]=e[5],t[2]=e[6],s[1]=c.lenVec3(t),t[0]=e[8],t[1]=e[9],t[2]=e[10],s[2]=c.lenVec3(t),s)})(),vecToArray:(()=>{function t(t){return Math.round(1e5*t)/1e5}return e=>{for(let s=0,i=(e=Array.prototype.slice.call(e)).length;s<i;s++)e[s]=t(e[s]);return e}})(),xyzArrayToObject:t=>({x:t[0],y:t[1],z:t[2]}),xyzObjectToArray:(t,e)=>((e=e||c.vec3())[0]=t.x,e[1]=t.y,e[2]=t.z,e),dupMat4:t=>t.slice(0,16),mat4To3:t=>[t[0],t[1],t[2],t[4],t[5],t[6],t[8],t[9],t[10]],m4s:t=>[t,t,t,t,t,t,t,t,t,t,t,t,t,t,t,t],setMat4ToZeroes:()=>c.m4s(0),setMat4ToOnes:()=>c.m4s(1),diagonalMat4v:t=>new h([t[0],0,0,0,0,t[1],0,0,0,0,t[2],0,0,0,0,t[3]]),diagonalMat4c:(t,e,s,i)=>c.diagonalMat4v([t,e,s,i]),diagonalMat4s:t=>c.diagonalMat4c(t,t,t,t),identityMat4:(t=new h(16))=>(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),identityMat3:(t=new h(9))=>(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t),isIdentityMat4:t=>1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15],negateMat4:(t,e)=>(e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e),addMat4:(t,e,s)=>(s||(s=t),s[0]=t[0]+e[0],s[1]=t[1]+e[1],s[2]=t[2]+e[2],s[3]=t[3]+e[3],s[4]=t[4]+e[4],s[5]=t[5]+e[5],s[6]=t[6]+e[6],s[7]=t[7]+e[7],s[8]=t[8]+e[8],s[9]=t[9]+e[9],s[10]=t[10]+e[10],s[11]=t[11]+e[11],s[12]=t[12]+e[12],s[13]=t[13]+e[13],s[14]=t[14]+e[14],s[15]=t[15]+e[15],s),addMat4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]+e,s[1]=t[1]+e,s[2]=t[2]+e,s[3]=t[3]+e,s[4]=t[4]+e,s[5]=t[5]+e,s[6]=t[6]+e,s[7]=t[7]+e,s[8]=t[8]+e,s[9]=t[9]+e,s[10]=t[10]+e,s[11]=t[11]+e,s[12]=t[12]+e,s[13]=t[13]+e,s[14]=t[14]+e,s[15]=t[15]+e,s),addScalarMat4:(t,e,s)=>c.addMat4Scalar(e,t,s),subMat4:(t,e,s)=>(s||(s=t),s[0]=t[0]-e[0],s[1]=t[1]-e[1],s[2]=t[2]-e[2],s[3]=t[3]-e[3],s[4]=t[4]-e[4],s[5]=t[5]-e[5],s[6]=t[6]-e[6],s[7]=t[7]-e[7],s[8]=t[8]-e[8],s[9]=t[9]-e[9],s[10]=t[10]-e[10],s[11]=t[11]-e[11],s[12]=t[12]-e[12],s[13]=t[13]-e[13],s[14]=t[14]-e[14],s[15]=t[15]-e[15],s),subMat4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]-e,s[1]=t[1]-e,s[2]=t[2]-e,s[3]=t[3]-e,s[4]=t[4]-e,s[5]=t[5]-e,s[6]=t[6]-e,s[7]=t[7]-e,s[8]=t[8]-e,s[9]=t[9]-e,s[10]=t[10]-e,s[11]=t[11]-e,s[12]=t[12]-e,s[13]=t[13]-e,s[14]=t[14]-e,s[15]=t[15]-e,s),subScalarMat4:(t,e,s)=>(s||(s=e),s[0]=t-e[0],s[1]=t-e[1],s[2]=t-e[2],s[3]=t-e[3],s[4]=t-e[4],s[5]=t-e[5],s[6]=t-e[6],s[7]=t-e[7],s[8]=t-e[8],s[9]=t-e[9],s[10]=t-e[10],s[11]=t-e[11],s[12]=t-e[12],s[13]=t-e[13],s[14]=t-e[14],s[15]=t-e[15],s),mulMat4(t,e,s){s||(s=t);const i=t[0],r=t[1],o=t[2],n=t[3],a=t[4],h=t[5],l=t[6],u=t[7],p=t[8],c=t[9],d=t[10],m=t[11],f=t[12],g=t[13],_=t[14],y=t[15],v=e[0],b=e[1],P=e[2],T=e[3],w=e[4],x=e[5],M=e[6],D=e[7],E=e[8],I=e[9],S=e[10],A=e[11],C=e[12],F=e[13],O=e[14],R=e[15];return s[0]=v*i+b*a+P*p+T*f,s[1]=v*r+b*h+P*c+T*g,s[2]=v*o+b*l+P*d+T*_,s[3]=v*n+b*u+P*m+T*y,s[4]=w*i+x*a+M*p+D*f,s[5]=w*r+x*h+M*c+D*g,s[6]=w*o+x*l+M*d+D*_,s[7]=w*n+x*u+M*m+D*y,s[8]=E*i+I*a+S*p+A*f,s[9]=E*r+I*h+S*c+A*g,s[10]=E*o+I*l+S*d+A*_,s[11]=E*n+I*u+S*m+A*y,s[12]=C*i+F*a+O*p+R*f,s[13]=C*r+F*h+O*c+R*g,s[14]=C*o+F*l+O*d+R*_,s[15]=C*n+F*u+O*m+R*y,s},mulMat3(t,e,s){s||(s=new h(9));const i=t[0],r=t[3],o=t[6],n=t[1],a=t[4],l=t[7],u=t[2],p=t[5],c=t[8],d=e[0],m=e[3],f=e[6],g=e[1],_=e[4],y=e[7],v=e[2],b=e[5],P=e[8];return s[0]=i*d+r*g+o*v,s[3]=i*m+r*_+o*b,s[6]=i*f+r*y+o*P,s[1]=n*d+a*g+l*v,s[4]=n*m+a*_+l*b,s[7]=n*f+a*y+l*P,s[2]=u*d+p*g+c*v,s[5]=u*m+p*_+c*b,s[8]=u*f+p*y+c*P,s},mulMat4Scalar:(t,e,s)=>(s||(s=t),s[0]=t[0]*e,s[1]=t[1]*e,s[2]=t[2]*e,s[3]=t[3]*e,s[4]=t[4]*e,s[5]=t[5]*e,s[6]=t[6]*e,s[7]=t[7]*e,s[8]=t[8]*e,s[9]=t[9]*e,s[10]=t[10]*e,s[11]=t[11]*e,s[12]=t[12]*e,s[13]=t[13]*e,s[14]=t[14]*e,s[15]=t[15]*e,s),mulMat4v4(t,e,s=c.vec4()){const i=e[0],r=e[1],o=e[2],n=e[3];return s[0]=t[0]*i+t[4]*r+t[8]*o+t[12]*n,s[1]=t[1]*i+t[5]*r+t[9]*o+t[13]*n,s[2]=t[2]*i+t[6]*r+t[10]*o+t[14]*n,s[3]=t[3]*i+t[7]*r+t[11]*o+t[15]*n,s},transposeMat4(t,e){const s=t[4],i=t[14],r=t[8],o=t[13],n=t[12],a=t[9];if(!e||t===e){const e=t[1],h=t[2],l=t[3],u=t[6],p=t[7],c=t[11];return t[1]=s,t[2]=r,t[3]=n,t[4]=e,t[6]=a,t[7]=o,t[8]=h,t[9]=u,t[11]=i,t[12]=l,t[13]=p,t[14]=c,t}return e[0]=t[0],e[1]=s,e[2]=r,e[3]=n,e[4]=t[1],e[5]=t[5],e[6]=a,e[7]=o,e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=i,e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},transposeMat3(t,e){if(e===t){const s=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=s,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e},determinantMat4(t){const e=t[0],s=t[1],i=t[2],r=t[3],o=t[4],n=t[5],a=t[6],h=t[7],l=t[8],u=t[9],p=t[10],c=t[11],d=t[12],m=t[13],f=t[14],g=t[15];return d*u*a*r-l*m*a*r-d*n*p*r+o*m*p*r+l*n*f*r-o*u*f*r-d*u*i*h+l*m*i*h+d*s*p*h-e*m*p*h-l*s*f*h+e*u*f*h+d*n*i*c-o*m*i*c-d*s*a*c+e*m*a*c+o*s*f*c-e*n*f*c-l*n*i*g+o*u*i*g+l*s*a*g-e*u*a*g-o*s*p*g+e*n*p*g},inverseMat4(t,e){e||(e=t);const s=t[0],i=t[1],r=t[2],o=t[3],n=t[4],a=t[5],h=t[6],l=t[7],u=t[8],p=t[9],c=t[10],d=t[11],m=t[12],f=t[13],g=t[14],_=t[15],y=s*a-i*n,v=s*h-r*n,b=s*l-o*n,P=i*h-r*a,T=i*l-o*a,w=r*l-o*h,x=u*f-p*m,M=u*g-c*m,D=u*_-d*m,E=p*g-c*f,I=p*_-d*f,S=c*_-d*g,A=1/(y*S-v*I+b*E+P*D-T*M+w*x);return e[0]=(a*S-h*I+l*E)*A,e[1]=(-i*S+r*I-o*E)*A,e[2]=(f*w-g*T+_*P)*A,e[3]=(-p*w+c*T-d*P)*A,e[4]=(-n*S+h*D-l*M)*A,e[5]=(s*S-r*D+o*M)*A,e[6]=(-m*w+g*b-_*v)*A,e[7]=(u*w-c*b+d*v)*A,e[8]=(n*I-a*D+l*x)*A,e[9]=(-s*I+i*D-o*x)*A,e[10]=(m*T-f*b+_*y)*A,e[11]=(-u*T+p*b-d*y)*A,e[12]=(-n*E+a*M-h*x)*A,e[13]=(s*E-i*M+r*x)*A,e[14]=(-m*P+f*v-g*y)*A,e[15]=(u*P-p*v+c*y)*A,e},traceMat4:t=>t[0]+t[5]+t[10]+t[15],translationMat4v(t,e){const s=e||c.identityMat4();return s[12]=t[0],s[13]=t[1],s[14]=t[2],s},translationMat3v(t,e){const s=e||c.identityMat3();return s[6]=t[0],s[7]=t[1],s},translationMat4c:(()=>{const t=new h(3);return(e,s,i,r)=>(t[0]=e,t[1]=s,t[2]=i,c.translationMat4v(t,r))})(),translationMat4s:(t,e)=>c.translationMat4c(t,t,t,e),translateMat4v:(t,e)=>c.translateMat4c(t[0],t[1],t[2],e),OLDtranslateMat4c(t,e,s,i){const r=i[12];i[0]+=r*t,i[4]+=r*e,i[8]+=r*s;const o=i[13];i[1]+=o*t,i[5]+=o*e,i[9]+=o*s;const n=i[14];i[2]+=n*t,i[6]+=n*e,i[10]+=n*s;const a=i[15];return i[3]+=a*t,i[7]+=a*e,i[11]+=a*s,i},translateMat4c(t,e,s,i){const r=i[3];i[0]+=r*t,i[1]+=r*e,i[2]+=r*s;const o=i[7];i[4]+=o*t,i[5]+=o*e,i[6]+=o*s;const n=i[11];i[8]+=n*t,i[9]+=n*e,i[10]+=n*s;const a=i[15];return i[12]+=a*t,i[13]+=a*e,i[14]+=a*s,i},setMat4Translation:(t,e,s)=>(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=t[15],s),rotationMat4v(t,e,s){const i=c.normalizeVec4([e[0],e[1],e[2],0],[]),r=Math.sin(t),o=Math.cos(t),n=1-o,a=i[0],h=i[1],l=i[2];let u,p,d,m,f,g;return u=a*h,p=h*l,d=l*a,m=a*r,f=h*r,g=l*r,(s=s||c.mat4())[0]=n*a*a+o,s[1]=n*u+g,s[2]=n*d-f,s[3]=0,s[4]=n*u-g,s[5]=n*h*h+o,s[6]=n*p+m,s[7]=0,s[8]=n*d+f,s[9]=n*p-m,s[10]=n*l*l+o,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},rotationMat4c:(t,e,s,i,r)=>c.rotationMat4v(t,[e,s,i],r),scalingMat4v:(t,e=c.identityMat4())=>(e[0]=t[0],e[5]=t[1],e[10]=t[2],e),scalingMat3v:(t,e=c.identityMat3())=>(e[0]=t[0],e[4]=t[1],e),scalingMat4c:(()=>{const t=new h(3);return(e,s,i,r)=>(t[0]=e,t[1]=s,t[2]=i,c.scalingMat4v(t,r))})(),scaleMat4c:(t,e,s,i)=>(i[0]*=t,i[4]*=e,i[8]*=s,i[1]*=t,i[5]*=e,i[9]*=s,i[2]*=t,i[6]*=e,i[10]*=s,i[3]*=t,i[7]*=e,i[11]*=s,i),scaleMat4v(t,e){const s=t[0],i=t[1],r=t[2];return e[0]*=s,e[4]*=i,e[8]*=r,e[1]*=s,e[5]*=i,e[9]*=r,e[2]*=s,e[6]*=i,e[10]*=r,e[3]*=s,e[7]*=i,e[11]*=r,e},scalingMat4s:t=>c.scalingMat4c(t,t,t),rotationTranslationMat4(t,e,s=c.mat4()){const i=t[0],r=t[1],o=t[2],n=t[3],a=i+i,h=r+r,l=o+o,u=i*a,p=i*h,d=i*l,m=r*h,f=r*l,g=o*l,_=n*a,y=n*h,v=n*l;return s[0]=1-(m+g),s[1]=p+v,s[2]=d-y,s[3]=0,s[4]=p-v,s[5]=1-(u+g),s[6]=f+_,s[7]=0,s[8]=d+y,s[9]=f-_,s[10]=1-(u+m),s[11]=0,s[12]=e[0],s[13]=e[1],s[14]=e[2],s[15]=1,s},mat4ToEuler(t,e,s=c.vec4()){const i=c.clamp,r=t[0],o=t[4],n=t[8],a=t[1],h=t[5],l=t[9],u=t[2],p=t[6],d=t[10];return"XYZ"===e?(s[1]=Math.asin(i(n,-1,1)),Math.abs(n)<.99999?(s[0]=Math.atan2(-l,d),s[2]=Math.atan2(-o,r)):(s[0]=Math.atan2(p,h),s[2]=0)):"YXZ"===e?(s[0]=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(s[1]=Math.atan2(n,d),s[2]=Math.atan2(a,h)):(s[1]=Math.atan2(-u,r),s[2]=0)):"ZXY"===e?(s[0]=Math.asin(i(p,-1,1)),Math.abs(p)<.99999?(s[1]=Math.atan2(-u,d),s[2]=Math.atan2(-o,h)):(s[1]=0,s[2]=Math.atan2(a,r))):"ZYX"===e?(s[1]=Math.asin(-i(u,-1,1)),Math.abs(u)<.99999?(s[0]=Math.atan2(p,d),s[2]=Math.atan2(a,r)):(s[0]=0,s[2]=Math.atan2(-o,h))):"YZX"===e?(s[2]=Math.asin(i(a,-1,1)),Math.abs(a)<.99999?(s[0]=Math.atan2(-l,h),s[1]=Math.atan2(-u,r)):(s[0]=0,s[1]=Math.atan2(n,d))):"XZY"===e&&(s[2]=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(s[0]=Math.atan2(p,h),s[1]=Math.atan2(n,r)):(s[0]=Math.atan2(-l,d),s[1]=0)),s},composeMat4:(t,e,s,i=c.mat4())=>(c.quaternionToRotationMat4(e,i),c.scaleMat4v(s,i),c.translateMat4v(t,i),i),decomposeMat4:(()=>{const t=new h(3),e=new h(16);return function(s,i,r,o){t[0]=s[0],t[1]=s[1],t[2]=s[2];let n=c.lenVec3(t);t[0]=s[4],t[1]=s[5],t[2]=s[6];const a=c.lenVec3(t);t[8]=s[8],t[9]=s[9],t[10]=s[10];const h=c.lenVec3(t);c.determinantMat4(s)<0&&(n=-n),i[0]=s[12],i[1]=s[13],i[2]=s[14],e.set(s);const l=1/n,u=1/a,p=1/h;return e[0]*=l,e[1]*=l,e[2]*=l,e[4]*=u,e[5]*=u,e[6]*=u,e[8]*=p,e[9]*=p,e[10]*=p,c.mat4ToQuaternion(e,r),o[0]=n,o[1]=a,o[2]=h,this}})(),getColMat4(t,e){const s=4*e;return[t[s],t[s+1],t[s+2],t[s+3]]},setRowMat4(t,e,s){t[e]=s[0],t[e+4]=s[1],t[e+8]=s[2],t[e+12]=s[3]},lookAtMat4v(t,e,s,i){i||(i=c.mat4());const r=t[0],o=t[1],n=t[2],a=s[0],h=s[1],l=s[2],u=e[0],p=e[1],d=e[2];if(r===u&&o===p&&n===d)return c.identityMat4();let m,f,g,_,y,v,b,P,T,w;return m=r-u,f=o-p,g=n-d,w=1/Math.sqrt(m*m+f*f+g*g),m*=w,f*=w,g*=w,_=h*g-l*f,y=l*m-a*g,v=a*f-h*m,w=Math.sqrt(_*_+y*y+v*v),w?(w=1/w,_*=w,y*=w,v*=w):(_=0,y=0,v=0),b=f*v-g*y,P=g*_-m*v,T=m*y-f*_,w=Math.sqrt(b*b+P*P+T*T),w?(w=1/w,b*=w,P*=w,T*=w):(b=0,P=0,T=0),i[0]=_,i[1]=b,i[2]=m,i[3]=0,i[4]=y,i[5]=P,i[6]=f,i[7]=0,i[8]=v,i[9]=T,i[10]=g,i[11]=0,i[12]=-(_*r+y*o+v*n),i[13]=-(b*r+P*o+T*n),i[14]=-(m*r+f*o+g*n),i[15]=1,i},lookAtMat4c:(t,e,s,i,r,o,n,a,h)=>c.lookAtMat4v([t,e,s],[i,r,o],[n,a,h],[]),orthoMat4c(t,e,s,i,r,o,n){n||(n=c.mat4());const a=e-t,h=i-s,l=o-r;return n[0]=2/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2/h,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=-2/l,n[11]=0,n[12]=-(t+e)/a,n[13]=-(i+s)/h,n[14]=-(o+r)/l,n[15]=1,n},frustumMat4v(t,e,s){s||(s=c.mat4());const i=[t[0],t[1],t[2],0],r=[e[0],e[1],e[2],0];c.addVec4(r,i,l),c.subVec4(r,i,u);const o=2*i[2],n=u[0],a=u[1],h=u[2];return s[0]=o/n,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=o/a,s[6]=0,s[7]=0,s[8]=l[0]/n,s[9]=l[1]/a,s[10]=-l[2]/h,s[11]=-1,s[12]=0,s[13]=0,s[14]=-o*r[2]/h,s[15]=0,s},frustumMat4(t,e,s,i,r,o,n){n||(n=c.mat4());const a=e-t,h=i-s,l=o-r;return n[0]=2*r/a,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=2*r/h,n[6]=0,n[7]=0,n[8]=(e+t)/a,n[9]=(i+s)/h,n[10]=-(o+r)/l,n[11]=-1,n[12]=0,n[13]=0,n[14]=-o*r*2/l,n[15]=0,n},perspectiveMat4(t,e,s,i,r){const o=[],n=[];return o[2]=s,n[2]=i,n[1]=o[2]*Math.tan(t/2),o[1]=-n[1],n[0]=n[1]*e,o[0]=-n[0],c.frustumMat4v(o,n,r)},compareMat4:(t,e)=>t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15],transformPoint3(t,e,s=c.vec3()){const i=e[0],r=e[1],o=e[2];return s[0]=t[0]*i+t[4]*r+t[8]*o+t[12],s[1]=t[1]*i+t[5]*r+t[9]*o+t[13],s[2]=t[2]*i+t[6]*r+t[10]*o+t[14],s},transformPoint4:(t,e,s=c.vec4())=>(s[0]=t[0]*e[0]+t[4]*e[1]+t[8]*e[2]+t[12]*e[3],s[1]=t[1]*e[0]+t[5]*e[1]+t[9]*e[2]+t[13]*e[3],s[2]=t[2]*e[0]+t[6]*e[1]+t[10]*e[2]+t[14]*e[3],s[3]=t[3]*e[0]+t[7]*e[1]+t[11]*e[2]+t[15]*e[3],s),transformPoints3(t,e,s){const i=s||[],r=e.length;let o,n,a,h;const l=t[0],u=t[1],p=t[2],c=t[3],d=t[4],m=t[5],f=t[6],g=t[7],_=t[8],y=t[9],v=t[10],b=t[11],P=t[12],T=t[13],w=t[14],x=t[15];let M;for(let t=0;t<r;++t)h=e[t],o=h[0],n=h[1],a=h[2],M=i[t]||(i[t]=[0,0,0]),M[0]=l*o+d*n+_*a+P,M[1]=u*o+m*n+y*a+T,M[2]=p*o+f*n+v*a+w,M[3]=c*o+g*n+b*a+x;return i.length=r,i},transformPositions3(t,e,s=e){let i;const r=e.length;let o,n,a;const h=t[0],l=t[1],u=t[2];t[3];const p=t[4],c=t[5],d=t[6];t[7];const m=t[8],f=t[9],g=t[10];t[11];const _=t[12],y=t[13],v=t[14];for(t[15],i=0;i<r;i+=3)o=e[i+0],n=e[i+1],a=e[i+2],s[i+0]=h*o+p*n+m*a+_,s[i+1]=l*o+c*n+f*a+y,s[i+2]=u*o+d*n+g*a+v;return s},transformPositions4(t,e,s=e){let i;const r=e.length;let o,n,a;const h=t[0],l=t[1],u=t[2],p=t[3],c=t[4],d=t[5],m=t[6],f=t[7],g=t[8],_=t[9],y=t[10],v=t[11],b=t[12],P=t[13],T=t[14],w=t[15];for(i=0;i<r;i+=4)o=e[i+0],n=e[i+1],a=e[i+2],s[i+0]=h*o+c*n+g*a+b,s[i+1]=l*o+d*n+_*a+P,s[i+2]=u*o+m*n+y*a+T,s[i+3]=p*o+f*n+v*a+w;return s},transformVec3(t,e,s){const i=e[0],r=e[1],o=e[2];return(s=s||this.vec3())[0]=t[0]*i+t[4]*r+t[8]*o,s[1]=t[1]*i+t[5]*r+t[9]*o,s[2]=t[2]*i+t[6]*r+t[10]*o,s},transformVec4(t,e,s){const i=e[0],r=e[1],o=e[2],n=e[3];return(s=s||c.vec4())[0]=t[0]*i+t[4]*r+t[8]*o+t[12]*n,s[1]=t[1]*i+t[5]*r+t[9]*o+t[13]*n,s[2]=t[2]*i+t[6]*r+t[10]*o+t[14]*n,s[3]=t[3]*i+t[7]*r+t[11]*o+t[15]*n,s},rotateVec3X(t,e,s,i){const r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[0],o[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),o[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i},rotateVec3Y(t,e,s,i){const r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),o[1]=r[1],o[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i},rotateVec3Z(t,e,s,i){const r=[],o=[];return r[0]=t[0]-e[0],r[1]=t[1]-e[1],r[2]=t[2]-e[2],o[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),o[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),o[2]=r[2],i[0]=o[0]+e[0],i[1]=o[1]+e[1],i[2]=o[2]+e[2],i},projectVec4(t,e){const s=1/t[3];return(e=e||c.vec2())[0]=t[0]*s,e[1]=t[1]*s,e},unprojectVec3:(()=>{const t=new h(16),e=new h(16),s=new h(16);return function(i,r,o,n){return this.transformVec3(this.mulMat4(this.inverseMat4(r,t),this.inverseMat4(o,e),s),i,n)}})(),lerpVec3(t,e,s,i,r,o){const n=o||c.vec3(),a=(t-e)/(s-e);return n[0]=i[0]+a*(r[0]-i[0]),n[1]=i[1]+a*(r[1]-i[1]),n[2]=i[2]+a*(r[2]-i[2]),n},lerpMat4(t,e,s,i,r,o){const n=o||c.mat4(),a=(t-e)/(s-e);return n[0]=i[0]+a*(r[0]-i[0]),n[1]=i[1]+a*(r[1]-i[1]),n[2]=i[2]+a*(r[2]-i[2]),n[3]=i[3]+a*(r[3]-i[3]),n[4]=i[4]+a*(r[4]-i[4]),n[5]=i[5]+a*(r[5]-i[5]),n[6]=i[6]+a*(r[6]-i[6]),n[7]=i[7]+a*(r[7]-i[7]),n[8]=i[8]+a*(r[8]-i[8]),n[9]=i[9]+a*(r[9]-i[9]),n[10]=i[10]+a*(r[10]-i[10]),n[11]=i[11]+a*(r[11]-i[11]),n[12]=i[12]+a*(r[12]-i[12]),n[13]=i[13]+a*(r[13]-i[13]),n[14]=i[14]+a*(r[14]-i[14]),n[15]=i[15]+a*(r[15]-i[15]),n},flatten(t){const e=[];let s,i,r,o,n;for(s=0,i=t.length;s<i;s++)for(n=t[s],r=0,o=n.length;r<o;r++)e.push(n[r]);return e},identityQuaternion:(t=c.vec4())=>(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t),eulerToQuaternion(t,e,s=c.vec4()){const i=t[0]*c.DEGTORAD/2,r=t[1]*c.DEGTORAD/2,o=t[2]*c.DEGTORAD/2,n=Math.cos(i),a=Math.cos(r),h=Math.cos(o),l=Math.sin(i),u=Math.sin(r),p=Math.sin(o);return"XYZ"===e?(s[0]=l*a*h+n*u*p,s[1]=n*u*h-l*a*p,s[2]=n*a*p+l*u*h,s[3]=n*a*h-l*u*p):"YXZ"===e?(s[0]=l*a*h+n*u*p,s[1]=n*u*h-l*a*p,s[2]=n*a*p-l*u*h,s[3]=n*a*h+l*u*p):"ZXY"===e?(s[0]=l*a*h-n*u*p,s[1]=n*u*h+l*a*p,s[2]=n*a*p+l*u*h,s[3]=n*a*h-l*u*p):"ZYX"===e?(s[0]=l*a*h-n*u*p,s[1]=n*u*h+l*a*p,s[2]=n*a*p-l*u*h,s[3]=n*a*h+l*u*p):"YZX"===e?(s[0]=l*a*h+n*u*p,s[1]=n*u*h+l*a*p,s[2]=n*a*p-l*u*h,s[3]=n*a*h-l*u*p):"XZY"===e&&(s[0]=l*a*h-n*u*p,s[1]=n*u*h-l*a*p,s[2]=n*a*p+l*u*h,s[3]=n*a*h+l*u*p),s},mat4ToQuaternion(t,e=c.vec4()){const s=t[0],i=t[4],r=t[8],o=t[1],n=t[5],a=t[9],h=t[2],l=t[6],u=t[10];let p;const d=s+n+u;return d>0?(p=.5/Math.sqrt(d+1),e[3]=.25/p,e[0]=(l-a)*p,e[1]=(r-h)*p,e[2]=(o-i)*p):s>n&&s>u?(p=2*Math.sqrt(1+s-n-u),e[3]=(l-a)/p,e[0]=.25*p,e[1]=(i+o)/p,e[2]=(r+h)/p):n>u?(p=2*Math.sqrt(1+n-s-u),e[3]=(r-h)/p,e[0]=(i+o)/p,e[1]=.25*p,e[2]=(a+l)/p):(p=2*Math.sqrt(1+u-s-n),e[3]=(o-i)/p,e[0]=(r+h)/p,e[1]=(a+l)/p,e[2]=.25*p),e},vec3PairToQuaternion(t,e,s=c.vec4()){const i=Math.sqrt(c.dotVec3(t,t)*c.dotVec3(e,e));let r=i+c.dotVec3(t,e);return r<1e-8*i?(r=0,Math.abs(t[0])>Math.abs(t[2])?(s[0]=-t[1],s[1]=t[0],s[2]=0):(s[0]=0,s[1]=-t[2],s[2]=t[1])):c.cross3Vec3(t,e,s),s[3]=r,c.normalizeQuaternion(s)},angleAxisToQuaternion(t,e=c.vec4()){const s=t[3]/2,i=Math.sin(s);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(s),e},quaternionToEuler:(()=>{const t=new h(16);return(e,s,i)=>(i=i||c.vec3(),c.quaternionToRotationMat4(e,t),c.mat4ToEuler(t,s,i),i)})(),mulQuaternions(t,e,s=c.vec4()){const i=t[0],r=t[1],o=t[2],n=t[3],a=e[0],h=e[1],l=e[2],u=e[3];return s[0]=n*a+i*u+r*l-o*h,s[1]=n*h+r*u+o*a-i*l,s[2]=n*l+o*u+i*h-r*a,s[3]=n*u-i*a-r*h-o*l,s},vec3ApplyQuaternion(t,e,s=c.vec3()){const i=e[0],r=e[1],o=e[2],n=t[0],a=t[1],h=t[2],l=t[3],u=l*i+a*o-h*r,p=l*r+h*i-n*o,d=l*o+n*r-a*i,m=-n*i-a*r-h*o;return s[0]=u*l+m*-n+p*-h-d*-a,s[1]=p*l+m*-a+d*-n-u*-h,s[2]=d*l+m*-h+u*-a-p*-n,s},quaternionToMat4(t,e){e=c.identityMat4(e);const s=t[0],i=t[1],r=t[2],o=t[3],n=2*s,a=2*i,h=2*r,l=n*o,u=a*o,p=h*o,d=n*s,m=a*s,f=h*s,g=a*i,_=h*i,y=h*r;return e[0]=1-(g+y),e[1]=m+p,e[2]=f-u,e[4]=m-p,e[5]=1-(d+y),e[6]=_+l,e[8]=f+u,e[9]=_-l,e[10]=1-(d+g),e},quaternionToRotationMat4(t,e){const s=t[0],i=t[1],r=t[2],o=t[3],n=s+s,a=i+i,h=r+r,l=s*n,u=s*a,p=s*h,c=i*a,d=i*h,m=r*h,f=o*n,g=o*a,_=o*h;return e[0]=1-(c+m),e[4]=u-_,e[8]=p+g,e[1]=u+_,e[5]=1-(l+m),e[9]=d-f,e[2]=p-g,e[6]=d+f,e[10]=1-(l+c),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},normalizeQuaternion(t,e=t){const s=c.lenVec4([t[0],t[1],t[2],t[3]]);return e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s,e[3]=t[3]/s,e},conjugateQuaternion:(t,e=t)=>(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e),inverseQuaternion:(t,e)=>c.normalizeQuaternion(c.conjugateQuaternion(t,e)),quaternionToAngleAxis(t,e=c.vec4()){const s=(t=c.normalizeQuaternion(t,p))[3],i=2*Math.acos(s),r=Math.sqrt(1-s*s);return r<.001?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r),e[3]=i,e},AABB3:t=>new h(t||6),AABB2:t=>new h(t||4),OBB3:t=>new h(t||32),OBB2:t=>new h(t||16),Sphere3:(t,e,s,i)=>new h([t,e,s,i]),transformOBB3(t,e,s=e){let i;const r=e.length;let o,n,a;const h=t[0],l=t[1],u=t[2],p=t[3],c=t[4],d=t[5],m=t[6],f=t[7],g=t[8],_=t[9],y=t[10],v=t[11],b=t[12],P=t[13],T=t[14],w=t[15];for(i=0;i<r;i+=4)o=e[i+0],n=e[i+1],a=e[i+2],s[i+0]=h*o+c*n+g*a+b,s[i+1]=l*o+d*n+_*a+P,s[i+2]=u*o+m*n+y*a+T,s[i+3]=p*o+f*n+v*a+w;return s},containsAABB3:function(t,e){return t[0]<=e[0]&&e[3]<=t[3]&&t[1]<=e[1]&&e[4]<=t[4]&&t[2]<=e[2]&&e[5]<=t[5]},getAABB3Diag:(()=>{const t=new h(3),e=new h(3),s=new h(3);return i=>(t[0]=i[0],t[1]=i[1],t[2]=i[2],e[0]=i[3],e[1]=i[4],e[2]=i[5],c.subVec3(e,t,s),Math.abs(c.lenVec3(s)))})(),getAABB3DiagPoint:(()=>{const t=new h(3),e=new h(3),s=new h(3);return(i,r)=>{t[0]=i[0],t[1]=i[1],t[2]=i[2],e[0]=i[3],e[1]=i[4],e[2]=i[5];const o=c.subVec3(e,t,s),n=r[0]-i[0],a=i[3]-r[0],h=r[1]-i[1],l=i[4]-r[1],u=r[2]-i[2],p=i[5]-r[2];return o[0]+=n>a?n:a,o[1]+=h>l?h:l,o[2]+=u>p?u:p,Math.abs(c.lenVec3(o))}})(),getAABB3Area:t=>(t[3]-t[0])*(t[4]-t[1])*(t[5]-t[2]),getAABB3Center(t,e){const s=e||c.vec3();return s[0]=(t[0]+t[3])/2,s[1]=(t[1]+t[4])/2,s[2]=(t[2]+t[5])/2,s},getAABB2Center(t,e){const s=e||c.vec2();return s[0]=(t[2]+t[0])/2,s[1]=(t[3]+t[1])/2,s},collapseAABB3:(t=c.AABB3())=>(t[0]=c.MAX_DOUBLE,t[1]=c.MAX_DOUBLE,t[2]=c.MAX_DOUBLE,t[3]=c.MIN_DOUBLE,t[4]=c.MIN_DOUBLE,t[5]=c.MIN_DOUBLE,t),AABB3ToOBB3:(t,e=c.OBB3())=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=1,e[4]=t[3],e[5]=t[1],e[6]=t[2],e[7]=1,e[8]=t[3],e[9]=t[4],e[10]=t[2],e[11]=1,e[12]=t[0],e[13]=t[4],e[14]=t[2],e[15]=1,e[16]=t[0],e[17]=t[1],e[18]=t[5],e[19]=1,e[20]=t[3],e[21]=t[1],e[22]=t[5],e[23]=1,e[24]=t[3],e[25]=t[4],e[26]=t[5],e[27]=1,e[28]=t[0],e[29]=t[4],e[30]=t[5],e[31]=1,e),positions3ToAABB3:(()=>{const t=new h(3);return(e,s,i)=>{s=s||c.AABB3();let r,o,n,a=c.MAX_DOUBLE,h=c.MAX_DOUBLE,l=c.MAX_DOUBLE,u=c.MIN_DOUBLE,p=c.MIN_DOUBLE,d=c.MIN_DOUBLE;for(let s=0,m=e.length;s<m;s+=3)i?(t[0]=e[s+0],t[1]=e[s+1],t[2]=e[s+2],c.decompressPosition(t,i,t),r=t[0],o=t[1],n=t[2]):(r=e[s+0],o=e[s+1],n=e[s+2]),r<a&&(a=r),o<h&&(h=o),n<l&&(l=n),r>u&&(u=r),o>p&&(p=o),n>d&&(d=n);return s[0]=a,s[1]=h,s[2]=l,s[3]=u,s[4]=p,s[5]=d,s}})(),OBB3ToAABB3(t,e=c.AABB3()){let s,i,r,o=c.MAX_DOUBLE,n=c.MAX_DOUBLE,a=c.MAX_DOUBLE,h=c.MIN_DOUBLE,l=c.MIN_DOUBLE,u=c.MIN_DOUBLE;for(let e=0,p=t.length;e<p;e+=4)s=t[e+0],i=t[e+1],r=t[e+2],s<o&&(o=s),i<n&&(n=i),r<a&&(a=r),s>h&&(h=s),i>l&&(l=i),r>u&&(u=r);return e[0]=o,e[1]=n,e[2]=a,e[3]=h,e[4]=l,e[5]=u,e},points3ToAABB3(t,e=c.AABB3()){let s,i,r,o=c.MAX_DOUBLE,n=c.MAX_DOUBLE,a=c.MAX_DOUBLE,h=c.MIN_DOUBLE,l=c.MIN_DOUBLE,u=c.MIN_DOUBLE;for(let e=0,p=t.length;e<p;e++)s=t[e][0],i=t[e][1],r=t[e][2],s<o&&(o=s),i<n&&(n=i),r<a&&(a=r),s>h&&(h=s),i>l&&(l=i),r>u&&(u=r);return e[0]=o,e[1]=n,e[2]=a,e[3]=h,e[4]=l,e[5]=u,e},points3ToSphere3:(()=>{const t=new h(3);return(e,s)=>{s=s||c.vec4();let i,r=0,o=0,n=0;const a=e.length;for(i=0;i<a;i++)r+=e[i][0],o+=e[i][1],n+=e[i][2];s[0]=r/a,s[1]=o/a,s[2]=n/a;let h,l=0;for(i=0;i<a;i++)h=Math.abs(c.lenVec3(c.subVec3(e[i],s,t))),h>l&&(l=h);return s[3]=l,s}})(),positions3ToSphere3:(()=>{const t=new h(3),e=new h(3);return(s,i)=>{i=i||c.vec4();let r,o=0,n=0,a=0;const h=s.length;let l=0;for(r=0;r<h;r+=3)o+=s[r],n+=s[r+1],a+=s[r+2];const u=h/3;let p;for(i[0]=o/u,i[1]=n/u,i[2]=a/u,r=0;r<h;r+=3)t[0]=s[r],t[1]=s[r+1],t[2]=s[r+2],p=Math.abs(c.lenVec3(c.subVec3(t,i,e))),p>l&&(l=p);return i[3]=l,i}})(),OBB3ToSphere3:(()=>{const t=new h(3),e=new h(3);return(s,i)=>{i=i||c.vec4();let r,o=0,n=0,a=0;const h=s.length,l=h/4;for(r=0;r<h;r+=4)o+=s[r+0],n+=s[r+1],a+=s[r+2];i[0]=o/l,i[1]=n/l,i[2]=a/l;let u,p=0;for(r=0;r<h;r+=4)t[0]=s[r+0],t[1]=s[r+1],t[2]=s[r+2],u=Math.abs(c.lenVec3(c.subVec3(t,i,e))),u>p&&(p=u);return i[3]=p,i}})(),getSphere3Center:(t,e=c.vec3())=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],e),getPositionsCenter(t,e=c.vec3()){let s=0,i=0,r=0;for(var o=0,n=t.length;o<n;o+=3)s+=t[o+0],i+=t[o+1],r+=t[o+2];const a=t.length/3;return e[0]=s/a,e[1]=i/a,e[2]=r/a,e},expandAABB3:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]>e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t[4]<e[4]&&(t[4]=e[4]),t[5]<e[5]&&(t[5]=e[5]),t),expandAABB3Point3:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]>e[2]&&(t[2]=e[2]),t[3]<e[0]&&(t[3]=e[0]),t[4]<e[1]&&(t[4]=e[1]),t[5]<e[2]&&(t[5]=e[2]),t),expandAABB3Points3(t,e){for(var s,i,r,o=0,n=e.length;o<n;o+=3)s=e[o],i=e[o+1],r=e[o+2],t[0]>s&&(t[0]=s),t[1]>i&&(t[1]=i),t[2]>r&&(t[2]=r),t[3]<s&&(t[3]=s),t[4]<i&&(t[4]=i),t[5]<r&&(t[5]=r);return t},collapseAABB2:(t=c.AABB2())=>(t[0]=c.MAX_DOUBLE,t[1]=c.MAX_DOUBLE,t[2]=c.MIN_DOUBLE,t[3]=c.MIN_DOUBLE,t),point3AABB3Intersect:(t,e)=>t[0]>e[0]||t[3]<e[0]||t[1]>e[1]||t[4]<e[1]||t[2]>e[2]||t[5]<e[2],planeAABB3Intersect(t,e,s){let i,r;t[0]>0?(i=t[0]*s[0],r=t[0]*s[3]):(i=t[0]*s[3],r=t[0]*s[0]),t[1]>0?(i+=t[1]*s[1],r+=t[1]*s[4]):(i+=t[1]*s[4],r+=t[1]*s[1]),t[2]>0?(i+=t[2]*s[2],r+=t[2]*s[5]):(i+=t[2]*s[5],r+=t[2]*s[2]);if(i<=-e&&r<=-e)return-1;return i>=-e&&r>=-e?1:0},OBB3ToAABB2(t,e=c.AABB2()){let s,i,r,o,n=c.MAX_DOUBLE,a=c.MAX_DOUBLE,h=c.MIN_DOUBLE,l=c.MIN_DOUBLE;for(let e=0,u=t.length;e<u;e+=4)s=t[e+0],i=t[e+1],r=t[e+3]||1,o=1/r,s*=o,i*=o,s<n&&(n=s),i<a&&(a=i),s>h&&(h=s),i>l&&(l=i);return e[0]=n,e[1]=a,e[2]=h,e[3]=l,e},expandAABB2:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[2]&&(t[2]=e[2]),t[3]<e[3]&&(t[3]=e[3]),t),expandAABB2Point2:(t,e)=>(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1]),t),AABB2ToCanvas(t,e,s,i=t){const r=.5*(t[0]+1),o=.5*(t[1]+1),n=.5*(t[2]+1),a=.5*(t[3]+1);return i[0]=Math.floor(r*e),i[1]=s-Math.floor(a*s),i[2]=Math.floor(n*e),i[3]=s-Math.floor(o*s),i},tangentQuadraticBezier:(t,e,s,i)=>2*(1-t)*(s-e)+2*t*(i-s),tangentQuadraticBezier3:(t,e,s,i,r)=>-3*e*(1-t)*(1-t)+3*s*(1-t)*(1-t)-6*t*s*(1-t)+6*t*i*(1-t)-3*t*t*i+3*t*t*r,tangentSpline:t=>6*t*t-6*t+(3*t*t-4*t+1)+(-6*t*t+6*t)+(3*t*t-2*t),catmullRomInterpolate(t,e,s,i,r){const o=.5*(s-t),n=.5*(i-e),a=r*r;return(2*e-2*s+o+n)*(r*a)+(-3*e+3*s-2*o-n)*a+o*r+e},b2p0(t,e){const s=1-t;return s*s*e},b2p1:(t,e)=>2*(1-t)*t*e,b2p2:(t,e)=>t*t*e,b2(t,e,s,i){return this.b2p0(t,e)+this.b2p1(t,s)+this.b2p2(t,i)},b3p0(t,e){const s=1-t;return s*s*s*e},b3p1(t,e){const s=1-t;return 3*s*s*t*e},b3p2:(t,e)=>3*(1-t)*t*t*e,b3p3:(t,e)=>t*t*t*e,b3(t,e,s,i,r){return this.b3p0(t,e)+this.b3p1(t,s)+this.b3p2(t,i)+this.b3p3(t,r)},triangleNormal(t,e,s,i=c.vec3()){const r=e[0]-t[0],o=e[1]-t[1],n=e[2]-t[2],a=s[0]-t[0],h=s[1]-t[1],l=s[2]-t[2],u=o*l-n*h,p=n*a-r*l,d=r*h-o*a,m=Math.sqrt(u*u+p*p+d*d);return 0===m?(i[0]=0,i[1]=0,i[2]=0):(i[0]=u/m,i[1]=p/m,i[2]=d/m),i},rayTriangleIntersect:(()=>{const t=new h(3),e=new h(3),s=new h(3),i=new h(3),r=new h(3);return(o,n,a,h,l,u)=>{u=u||c.vec3();const p=c.subVec3(h,a,t),d=c.subVec3(l,a,e),m=c.cross3Vec3(n,d,s),f=c.dotVec3(p,m);if(f<1e-6)return null;const g=c.subVec3(o,a,i),_=c.dotVec3(g,m);if(_<0||_>f)return null;const y=c.cross3Vec3(g,p,r),v=c.dotVec3(n,y);if(v<0||_+v>f)return null;const b=c.dotVec3(d,y)/f;return u[0]=o[0]+b*n[0],u[1]=o[1]+b*n[1],u[2]=o[2]+b*n[2],u}})(),rayPlaneIntersect:(()=>{const t=new h(3),e=new h(3),s=new h(3),i=new h(3);return(r,o,n,a,h,l)=>{l=l||c.vec3(),o=c.normalizeVec3(o,t);const u=c.subVec3(a,n,e),p=c.subVec3(h,n,s),d=c.cross3Vec3(u,p,i);c.normalizeVec3(d,d);const m=-c.dotVec3(n,d),f=-(c.dotVec3(r,d)+m)/c.dotVec3(o,d);return l[0]=r[0]+f*o[0],l[1]=r[1]+f*o[1],l[2]=r[2]+f*o[2],l}})(),cartesianToBarycentric:(()=>{const t=new h(3),e=new h(3),s=new h(3);return(i,r,o,n,a)=>{const h=c.subVec3(n,r,t),l=c.subVec3(o,r,e),u=c.subVec3(i,r,s),p=c.dotVec3(h,h),d=c.dotVec3(h,l),m=c.dotVec3(h,u),f=c.dotVec3(l,l),g=c.dotVec3(l,u),_=p*f-d*d;if(0===_)return null;const y=1/_,v=(f*m-d*g)*y,b=(p*g-d*m)*y;return a[0]=1-v-b,a[1]=b,a[2]=v,a}})(),barycentricInsideTriangle(t){const e=t[1],s=t[2];return s>=0&&e>=0&&s+e<1},barycentricToCartesian(t,e,s,i,r=c.vec3()){const o=t[0],n=t[1],a=t[2];return r[0]=e[0]*o+s[0]*n+i[0]*a,r[1]=e[1]*o+s[1]*n+i[1]*a,r[2]=e[2]*o+s[2]*n+i[2]*a,r},mergeVertices(t,e,s,i){const r={},o=[],n=[],a=e?[]:null,h=s?[]:null,l=[];let u,p,c,d;const m=1e4;let f,g,_=0;for(f=0,g=t.length;f<g;f+=3)u=t[f],p=t[f+1],c=t[f+2],d=`${Math.round(u*m)}_${Math.round(p*m)}_${Math.round(c*m)}`,void 0===r[d]&&(r[d]=n.length/3,n.push(u),n.push(p),n.push(c),e&&(a.push(e[f]),a.push(e[f+1]),a.push(e[f+2])),s&&(h.push(s[_]),h.push(s[_+1]))),o[f/3]=r[d],_+=2;for(f=0,g=i.length;f<g;f++)l[f]=o[i[f]];const y={positions:n,indices:l};return a&&(y.normals=a),h&&(y.uv=h),y},buildNormals:(()=>{const t=new h(3),e=new h(3),s=new h(3),i=new h(3),r=new h(3),o=new h(3);return(n,a,h)=>{let l,u;const p=new Array(n.length/3);let d,m,f,g,_,y,v;for(l=0,u=a.length;l<u;l+=3){d=a[l],m=a[l+1],f=a[l+2],t[0]=n[3*d],t[1]=n[3*d+1],t[2]=n[3*d+2],e[0]=n[3*m],e[1]=n[3*m+1],e[2]=n[3*m+2],s[0]=n[3*f],s[1]=n[3*f+1],s[2]=n[3*f+2],c.subVec3(e,t,i),c.subVec3(s,t,r);const h=c.vec3();c.normalizeVec3(c.cross3Vec3(i,r,o),h),p[d]||(p[d]=[]),p[m]||(p[m]=[]),p[f]||(p[f]=[]),p[d].push(h),p[m].push(h),p[f].push(h)}for(h=h&&h.length===n.length?h:new Float32Array(n.length),l=0,u=p.length;l<u;l++){g=p[l].length,_=0,y=0,v=0;for(let t=0;t<g;t++)_+=p[l][t][0],y+=p[l][t][1],v+=p[l][t][2];h[3*l]=_/g,h[3*l+1]=y/g,h[3*l+2]=v/g}return h}})(),buildTangents:(()=>{const t=new h(3),e=new h(3),s=new h(3),i=new h(3),r=new h(3),o=new h(3),n=new h(3);return(a,h,l)=>{const u=new Float32Array(a.length);for(let p=0;p<h.length;p+=3){let d=h[p];const m=a.subarray(3*d,3*d+3),f=l.subarray(2*d,2*d+2);d=h[p+1];const g=a.subarray(3*d,3*d+3),_=l.subarray(2*d,2*d+2);d=h[p+2];const y=a.subarray(3*d,3*d+3),v=l.subarray(2*d,2*d+2),b=c.subVec3(g,m,t),P=c.subVec3(y,m,e),T=c.subVec2(_,f,s),w=c.subVec2(v,f,i),x=1/(T[0]*w[1]-T[1]*w[0]),M=c.mulVec3Scalar(c.subVec3(c.mulVec3Scalar(b,w[1],r),c.mulVec3Scalar(P,T[1],o),n),x,o);let D;for(let t=0;t<3;t++)D=3*h[p+t],u[D]+=M[0],u[D+1]+=M[1],u[D+2]+=M[2]}return u}})(),buildPickTriangles(t,e,s){const i=e.length,r=s?new Uint16Array(9*i):new Float32Array(9*i),o=new Uint8Array(12*i);let n,a,h,l,u,p,c=0,d=0,m=0;for(let s=0;s<i;s+=3)p=c>>24&255,u=c>>16&255,l=c>>8&255,h=255&c,a=e[s],n=3*a,r[d++]=t[n],r[d++]=t[n+1],r[d++]=t[n+2],o[m++]=h,o[m++]=l,o[m++]=u,o[m++]=p,a=e[s+1],n=3*a,r[d++]=t[n],r[d++]=t[n+1],r[d++]=t[n+2],o[m++]=h,o[m++]=l,o[m++]=u,o[m++]=p,a=e[s+2],n=3*a,r[d++]=t[n],r[d++]=t[n+1],r[d++]=t[n+2],o[m++]=h,o[m++]=l,o[m++]=u,o[m++]=p,c++;return{positions:r,colors:o}},faceToVertexNormals(t,e,s={}){const i=s.smoothNormalsAngleThreshold||20,r={},o=[],n={};let a,h,l,u,p;const d=1e4;let m,f,g,_,y,v;for(f=0,_=t.length;f<_;f+=3){m=f/3,h=t[f],l=t[f+1],u=t[f+2],p=`${Math.round(h*d)}_${Math.round(l*d)}_${Math.round(u*d)}`,void 0===r[p]?r[p]=[m]:r[p].push(m);const s=c.normalizeVec3([e[f],e[f+1],e[f+2]]);o[m]=s,a=c.vec4([s[0],s[1],s[2],1]),n[m]=a}for(p in r)if(r.hasOwnProperty(p)){const t=r[p],e=t.length;for(f=0;f<e;f++){const s=t[f];for(a=n[s],g=0;g<e;g++){if(f===g)continue;const e=t[g];y=o[s],v=o[e];Math.abs(c.angleVec3(y,v)/c.DEGTORAD)<i&&(a[0]+=v[0],a[1]+=v[1],a[2]+=v[2],a[3]+=1)}}}for(f=0,_=e.length;f<_;f+=3)a=n[f/3],e[f+0]=a[0]/a[3],e[f+1]=a[1]/a[3],e[f+2]=a[2]/a[3]},transformRay:(()=>{const t=new h(4),e=new h(4);return(s,i,r,o,n)=>{t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=1,c.transformVec4(s,t,e),o[0]=e[0],o[1]=e[1],o[2]=e[2],t[0]=r[0],t[1]=r[1],t[2]=r[2],c.transformVec3(s,t,e),c.normalizeVec3(e),n[0]=e[0],n[1]=e[1],n[2]=e[2]}})(),canvasPosToWorldRay:(()=>{const t=new h(16),e=new h(16),s=new h(4),i=new h(4),r=new h(4),o=new h(4);return(n,a,h,l,u,p)=>{const d=c.mulMat4(h,a,t),m=c.inverseMat4(d,e),f=n.width,g=n.height,_=(l[0]-f/2)/(f/2),y=-(l[1]-g/2)/(g/2);s[0]=_,s[1]=y,s[2]=-1,s[3]=1,c.transformVec4(m,s,i),c.mulVec4Scalar(i,1/i[3]),r[0]=_,r[1]=y,r[2]=1,r[3]=1,c.transformVec4(m,r,o),c.mulVec4Scalar(o,1/o[3]),u[0]=o[0],u[1]=o[1],u[2]=o[2],c.subVec3(o,i,p),c.normalizeVec3(p)}})(),canvasPosToLocalRay:(()=>{const t=new h(3),e=new h(3);return(s,i,r,o,n,a,h)=>{c.canvasPosToWorldRay(s,i,r,n,t,e),c.worldRayToLocalRay(o,t,e,a,h)}})(),worldRayToLocalRay:(()=>{const t=new h(16),e=new h(4),s=new h(4);return(i,r,o,n,a)=>{const h=c.inverseMat4(i,t);e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=1,c.transformVec4(h,e,s),n[0]=s[0],n[1]=s[1],n[2]=s[2],c.transformVec3(h,o,a)}})(),buildKDTree:(()=>{const t=new Float32Array;function e(s,i,r,o){const n=new h(6),a={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:n};let l,u;for(n[0]=n[1]=n[2]=Number.POSITIVE_INFINITY,n[3]=n[4]=n[5]=Number.NEGATIVE_INFINITY,l=0,u=s.length;l<u;++l){var p=3*s[l];for(let t=0;t<3;++t){const e=3*i[p+t];r[e]<n[0]&&(n[0]=r[e]),r[e]>n[3]&&(n[3]=r[e]),r[e+1]<n[1]&&(n[1]=r[e+1]),r[e+1]>n[4]&&(n[4]=r[e+1]),r[e+2]<n[2]&&(n[2]=r[e+2]),r[e+2]>n[5]&&(n[5]=r[e+2])}}if(s.length<20||o>10)return a.triangles=s,a.leaf=!0,a;t[0]=n[3]-n[0],t[1]=n[4]-n[1],t[2]=n[5]-n[2];let c=0;t[1]>t[c]&&(c=1),t[2]>t[c]&&(c=2),a.splitDim=c;const d=(n[c]+n[c+3])/2,m=new Array(s.length);let f=0;const g=new Array(s.length);let _=0;for(l=0,u=s.length;l<u;++l){const t=i[p=3*s[l]],e=3*i[p+1],o=3*i[p+2];r[3*t+c]<=d||r[e+c]<=d||r[o+c]<=d?m[f++]=s[l]:g[_++]=s[l]}return m.length=f,g.length=_,a.left=e(m,i,r,o+1),a.right=e(g,i,r,o+1),a}return(t,s)=>{const i=t.length/3,r=new Array(i);for(let t=0;t<i;++t)r[t]=t;return e(r,t,s,0)}})(),decompressPosition(t,e,s){(s=s||t)[0]=t[0]*e[0]+e[12],s[1]=t[1]*e[5]+e[13],s[2]=t[2]*e[10]+e[14]},decompressPositions(t,e,s=new Float32Array(t.length)){for(let i=0,r=t.length;i<r;i+=3)s[i+0]=t[i+0]*e[0]+e[12],s[i+1]=t[i+1]*e[5]+e[13],s[i+2]=t[i+2]*e[10]+e[14];return s},decompressUV(t,e,s){s[0]=t[0]*e[0]+e[6],s[1]=t[1]*e[4]+e[7]},decompressUVs(t,e,s=new Float32Array(t.length)){for(let i=0,r=t.length;i<r;i+=3)s[i+0]=t[i+0]*e[0]+e[6],s[i+1]=t[i+1]*e[4]+e[7];return s},octDecodeVec2(t,e){let s=t[0],i=t[1];s=(2*s+1)/255,i=(2*i+1)/255;const r=1-Math.abs(s)-Math.abs(i);r<0&&(s=(1-Math.abs(i))*(s>=0?1:-1),i=(1-Math.abs(s))*(i>=0?1:-1));const o=Math.sqrt(s*s+i*i+r*r);return e[0]=s/o,e[1]=i/o,e[2]=r/o,e},octDecodeVec2s(t,e){for(let s=0,i=0,r=t.length;s<r;s+=2){let r=t[s+0],o=t[s+1];r=(2*r+1)/255,o=(2*o+1)/255;const n=1-Math.abs(r)-Math.abs(o);n<0&&(r=(1-Math.abs(o))*(r>=0?1:-1),o=(1-Math.abs(r))*(o>=0?1:-1));const a=Math.sqrt(r*r+o*o+n*n);e[i+0]=r/a,e[i+1]=o/a,e[i+2]=n/a,i+=3}return e}};c.buildEdgeIndices=function(){const t=[],e=[],s=[],i=[],r=[];let o=0;const n=new Uint16Array(3),a=new Uint16Array(3),h=new Uint16Array(3),l=c.vec3(),u=c.vec3(),p=c.vec3(),d=c.vec3(),m=c.vec3(),f=c.vec3(),g=c.vec3();return function(_,y,v,b){!function(r,o){const n={};let a,h,l,u;const p=Math.pow(10,4);let c,d,m=0;for(c=0,d=r.length;c<d;c+=3)a=r[c],h=r[c+1],l=r[c+2],u=Math.round(a*p)+"_"+Math.round(h*p)+"_"+Math.round(l*p),void 0===n[u]&&(n[u]=m/3,t[m++]=a,t[m++]=h,t[m++]=l),e[c/3]=n[u];for(c=0,d=o.length;c<d;c++)i[c]=e[o[c]],s[i[c]]=o[c]}(_,y),function(e,s){o=0;for(let _=0,y=e;_<y;_+=3){const e=3*i[_],y=3*i[_+1],v=3*i[_+2];s?(n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],a[0]=t[y],a[1]=t[y+1],a[2]=t[y+2],h[0]=t[v],h[1]=t[v+1],h[2]=t[v+2],c.decompressPosition(n,s,l),c.decompressPosition(a,s,u),c.decompressPosition(h,s,p)):(l[0]=t[e],l[1]=t[e+1],l[2]=t[e+2],u[0]=t[y],u[1]=t[y+1],u[2]=t[y+2],p[0]=t[v],p[1]=t[v+1],p[2]=t[v+2]),c.subVec3(p,u,d),c.subVec3(l,u,m),c.cross3Vec3(d,m,f),c.normalizeVec3(f,g);const b=r[o]||(r[o]={normal:c.vec3()});b.normal[0]=g[0],b.normal[1]=g[1],b.normal[2]=g[2],o++}}(y.length,v);const P=[],T=Math.cos(c.DEGTORAD*b),w={};let x,M,D,E,I,S,A,C,F,O,R,L=!1;for(let t=0,e=y.length;t<e;t+=3){const e=t/3;for(let s=0;s<3;s++)x=i[t+s],M=i[t+(s+1)%3],D=Math.min(x,M),E=Math.max(x,M),I=D+","+E,void 0===w[I]?w[I]={index1:D,index2:E,face1:e,face2:void 0}:w[I].face2=e}for(I in w)S=w[I],void 0!==S.face2&&(A=r[S.face1].normal,C=r[S.face2].normal,F=c.dotVec3(A,C),F>T)||(O=s[S.index1],R=s[S.index2],(!L&&O>65535||R>65535)&&(L=!0),P.push(O),P.push(R));return L?new Uint32Array(P):new Uint16Array(P)}}();class d{constructor(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}get length(){return this._length}shift(){if(this._index>=this._headLength){const t=this._head;if(t.length=0,this._head=this._tail,this._tail=t,this._index=0,this._headLength=this._head.length,!this._headLength)return}const t=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,t}push(t){return this._length++,this._tail.push(t),this}unshift(t){return this._head[--this._index]=t,this._length++,this}}const m={build:{version:"0.8"},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};var f=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(t){for(var e=[],s=t[0].charCodeAt(0),i=s+t[1],r=s;r<i;++r)e.push(r);return String.fromCharCode.apply(null,e)})).join("");function g(t,e){return(e&&4!==e?[0,6]:[0,6,12,18]).map((function(e){return f.substr(parseInt(t/(1<<e))%64,1)})).reverse().join("")}const _={xmlToJson:function t(e,s){if(e.nodeType===e.TEXT_NODE){var i=e.nodeValue;if(null===i.match(/^\s+$/))return i}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var r={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var o=0;o<e.attributes.length;o++){var n=e.attributes[o];r[s[n.nodeName]||n.nodeName]=n.nodeValue}for(var a=0;a<e.childNodes.length;a++){(o=t(e.childNodes[a],s))&&r.children.push(o)}return r}},clone:function(t){return JSON.parse(JSON.stringify(t))},compressGuid:function(t){var e=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(e){return parseInt(t.substr(e,2),16)}));return g(e[0],2)+[1,4,7,10,13].map((function(t){return g((e[t]<<16)+(e[t+1]<<8)+e[t+2])})).join("")},findNodeOfType:function(t,e){var s=[],i=function(t){t.type===e&&s.push(t),(t.children||[]).forEach((function(t){i(t)}))};return i(t),s},timeout:function(t){return new Promise((function(e,s){setTimeout(e,t)}))},httpRequest:function(t){return new Promise((function(e,s){var i=new XMLHttpRequest;i.open(t.method||"GET",t.url,!0),i.onload=function(r){console.log(t.url,i.readyState,i.status),4===i.readyState&&(200===i.status?e(i.responseXML):s(i.statusText))},i.send(null)}))},loadJSON:function(t,e,s){var i=t=>{};e=e||i,s=s||i;var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",t,!0),r.addEventListener("load",(function(t){var i=t.target.response;if(200===this.status){var r;try{r=JSON.parse(i)}catch(t){s(`utils.loadJSON(): Failed to parse JSON response - ${t}`)}e(r)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{e(JSON.parse(i))}catch(t){s(`utils.loadJSON(): Failed to parse JSON response - ${t}`)}}else s(t)}),!1),r.addEventListener("error",(function(t){s(t)}),!1),r.send(null)},loadArraybuffer:function(t,e,s){var i=t=>{};e=e||i,s=s||i;const r=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const t=!!r[2];var o=r[3];o=window.decodeURIComponent(o),t&&(o=window.atob(o));try{const t=new ArrayBuffer(o.length),s=new Uint8Array(t);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);window.setTimeout((function(){e(t)}),0)}catch(t){window.setTimeout((function(){s(t)}),0)}}else{const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e(i.response):s("loadArrayBuffer error : "+i.response))},i.send(null)}},queryString:function(){for(var t={},e=window.location.search.substring(1).split("&"),s=0;s<e.length;s++){var i=e[s].split("=");if(void 0===t[i[0]])t[i[0]]=decodeURIComponent(i[1]);else if("string"==typeof t[i[0]]){var r=[t[i[0]],decodeURIComponent(i[1])];t[i[0]]=r}else t[i[0]].push(decodeURIComponent(i[1]))}return t}(),isArray:function(t){return t&&!t.propertyIsEnumerable("length")&&"object"==typeof t&&"number"==typeof t.length},isString:function(t){return"string"==typeof t||t instanceof String},isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},isID:function(t){return _.isString(t)||_.isNumeric(t)},isSameComponent:function(t,e){return!(!t||!e)&&(_.isNumeric(t)||_.isString(t)?`${t}`:t.id)===(_.isNumeric(e)||_.isString(e)?`${e}`:e.id)},isFunction:function(t){return"function"==typeof t},isObject:function(t){const e={}.constructor;return!!t&&t.constructor===e},copy:function(t){return _.apply(t,{})},apply:function(t,e){for(const s in t)t.hasOwnProperty(s)&&(e[s]=t[s]);return e},apply2:function(t,e){for(const s in t)t.hasOwnProperty(s)&&void 0!==t[s]&&null!==t[s]&&(e[s]=t[s]);return e},applyIf:function(t,e){for(const s in t)t.hasOwnProperty(s)&&(void 0!==e[s]&&null!==e[s]||(e[s]=t[s]));return e},isEmptyObject:function(t){for(const e in t)if(t.hasOwnProperty(e))return!1;return!0},inQuotes:function(t){return _.isNumeric(t)?`${t}`:`'${t}'`},concat:function(t,e){const s=new t.constructor(t.length+e.length);return s.set(t),s.set(e,t.length),s},flattenParentChildHierarchy:function(t){var e=[];return function t(s){s.id=s.uuid,delete s.oid,e.push(s);var i=s.children;if(i)for(var r=0,o=i.length;r<o;r++){i[r].parent=s.id,t(i[r])}s.children=[]}(t),e}};let y=!0,v=null;const b={},P=new t,T=new d,w={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},x=[];let M,D=0,E=0;const I=new function(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(t){if(t.id){if(I.scenes[t.id])return void console.error(`[ERROR] Scene ${_.inQuotes(t.id)} already exists`)}else t.id=P.addItem({});I.scenes[t.id]=t;const e=t.ticksPerOcclusionTest,s=t.ticksPerRender;b[t.id]={ticksPerOcclusionTest:e,ticksPerRender:s,renderCountdown:s},m.components.scenes++,t.once("destroyed",(()=>{P.removeItem(t.id),delete I.scenes[t.id],delete b[t.id],m.components.scenes--}))},this.setRAFEnabled=function(t){t!==y&&(y=t,y?(null!==v&&(clearInterval(v),v=null),window.requestAnimationFrame(S)):v=setInterval(S,16))},this.getRAFEnabled=function(){return y},this.clear=function(){let t;for(const e in I.scenes)I.scenes.hasOwnProperty(e)&&(t=I.scenes[e],"default.scene"===e?t.clear():(t.destroy(),delete I.scenes[t.id]))},this.scheduleTask=function(t,e){T.push(t),T.push(e)},this.runTasks=function(t=-1){let e,s,i=(new Date).getTime(),r=0;for(;T.length>0&&(t<0||i<t);)e=T.shift(),s=T.shift(),s?e.call(s):e(),i=(new Date).getTime(),r++;return r},this.getNumTasks=function(){return T.length}},S=function(){let t=Date.now();if(D>0){M=t-D;var e=1e3/M;E+=e,x.push(e),x.length>=30&&(E-=x.shift()),m.frame.fps=Math.round(E/x.length)}!function(t){const e=I.runTasks(t+10),s=I.getNumTasks();m.frame.tasksRun=e,m.frame.tasksScheduled=s,m.frame.tasksBudget=10}(t),function(t){for(var e in w.time=t,I.scenes)if(I.scenes.hasOwnProperty(e)){var s=I.scenes[e];w.sceneId=e,w.startTime=s.startTime,w.deltaTime=null!=w.prevTime?w.time-w.prevTime:0,s.fire("tick",w,!0)}w.prevTime=t}(t),function(){const t=I.scenes,e=!1;let s,i,r,o,n;for(n in t)t.hasOwnProperty(n)&&(s=t[n],i=b[n],i||(i=b[n]={}),r=s.ticksPerOcclusionTest,i.ticksPerOcclusionTest!==r&&(i.ticksPerOcclusionTest=r,i.renderCountdown=r),--s.occlusionTestCountdown<=0&&(s.doOcclusionTest(),s.occlusionTestCountdown=r),o=s.ticksPerRender,i.ticksPerRender!==o&&(i.ticksPerRender=o,i.renderCountdown=o),0==--i.renderCountdown&&(s.render(e),i.renderCountdown=o))}(),D=t,y&&window.requestAnimationFrame(S)};y?window.requestAnimationFrame(S):v=setInterval(S,16);class A{get type(){return"Component"}get isComponent(){return!0}constructor(t=null,e={}){if(this.scene=null,"Scene"===this.type)this.scene=this,this.viewer=e.viewer;else{if("Scene"===t.type)this.scene=t;else{if(!(t instanceof A))throw"Invalid param: owner must be a Component";this.scene=t.scene}this._owner=t,this._renderer=this.scene._renderer}this._dontClear=!!e.dontClear,this._renderer=this.scene._renderer,this.meta=e.meta||{},this.id=e.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this!==this.scene&&this.scene._addComponent(this),this._updateScheduled=!1,t&&t._own(this)}glRedraw(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}glResort(){this._renderer&&this._renderer.needStateSort()}get owner(){return this._owner}isType(t){return this.type===t}fire(t,e,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==s&&(this._events[t]=e||!0);const i=this._eventSubs[t];let r;if(i)for(const s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,e):this.error("fire: potential stack overflow from recursive event '"+t+"' - dropping this event"),this._eventCallDepth--)}on(e,s,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new t),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[e];r?this._eventSubsNum[e]++:(r={},this._eventSubs[e]=r,this._eventSubsNum[e]=1);const o=this._subIdMap.addItem();r[o]={callback:s,scope:i||this},this._subIdEvents[o]=e;const n=this._events[e];return void 0!==n&&s.call(i||this,n),o}off(t){if(null==t)return;if(!this._subIdEvents)return;const e=this._subIdEvents[t];if(e){delete this._subIdEvents[t];const s=this._eventSubs[e];s&&(delete s[t],this._eventSubsNum[e]--),this._subIdMap.removeItem(t)}}once(t,e,s){const i=this,r=this.on(t,(function(t){i.off(r),e.call(s||this,t)}),s)}hasSubs(t){return this._eventSubsNum&&this._eventSubsNum[t]>0}log(t){t="[LOG]"+this._message(t),window.console.log(t),this.scene.fire("log",t)}_message(t){return" ["+this.type+" "+_.inQuotes(this.id)+"]: "+t}warn(t){t="[WARN]"+this._message(t),window.console.warn(t),this.scene.fire("warn",t)}error(t){t="[ERROR]"+this._message(t),window.console.error(t),this.scene.fire("error",t)}_attach(t){const e=t.name;if(!e)return void this.error("Component 'name' expected");let s=t.component;const i=t.sceneDefault,r=t.sceneSingleton,o=t.type,n=t.on,a=!1!==t.recompiles;if(s&&(_.isNumeric(s)||_.isString(s))){const t=s;if(s=this.scene.components[t],!s)return void this.error("Component not found: "+_.inQuotes(t))}if(!s)if(!0===r){const t=this.scene.types[o];for(const e in t)if(t.hasOwnProperty){s=t[e];break}if(!s)return this.error("Scene has no default component for '"+e+"'"),null}else if(!0===i&&(s=this.scene[e],!s))return this.error("Scene has no default component for '"+e+"'"),null;if(s){if(s.scene.id!==this.scene.id)return void this.error("Not in same scene: "+s.type+" "+_.inQuotes(s.id));if(o&&!s.isType(o))return void this.error("Expected a "+o+" type or subtype: "+s.type+" "+_.inQuotes(s.id))}this._attachments||(this._attachments={});const h=this._attached[e];let l,u,p;if(h){if(s&&h.id===s.id)return;const t=this._attachments[h.id];for(l=t.subs,u=0,p=l.length;u<p;u++)h.off(l[u]);delete this._attached[e],delete this._attachments[h.id];const i=t.params.onDetached;i&&(_.isFunction(i)?i(h):i.scope?i.callback.call(i.scope,h):i.callback(h)),t.managingLifecycle&&h.destroy()}if(s){const i={params:t,component:s,subs:[],managingLifecycle:false};i.subs.push(s.once("destroyed",(function(){i.params.component=null,this._attach(i.params)}),this)),a&&i.subs.push(s.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[e]=s,this._attachments[s.id]=i;const r=t.onAttached;if(r&&(_.isFunction(r)?r(s):r.scope?r.callback.call(r.scope,s):r.callback(s)),n){let t,e,r,o;for(t in n)if(n.hasOwnProperty(t)){if(e=n[t],_.isFunction(e)?(r=e,o=null):(r=e.callback,o=e.scope),!r)continue;i.subs.push(s.on(t,r,o))}}}return a&&this.fire("dirty",this),this.fire(e,s),s}_checkComponent(t,e){if(!e.isComponent){if(!_.isID(e))return void this.error("Expected a Component or ID");{const t=e;if(!(e=this.scene.components[t]))return void this.error("Component not found: "+t)}}if(t===e.type){if(e.scene.id===this.scene.id)return e;this.error("Not in same scene: "+e.type)}else this.error("Expected a "+t+" Component")}_checkComponent2(t,e){if(!e.isComponent){if(!_.isID(e))return void this.error("Expected a Component or ID");{const t=e;if(!(e=this.scene.components[t]))return void this.error("Component not found: "+t)}}if(e.scene.id===this.scene.id){for(var s=0,i=t.length;s<i;s++)if(t[s]===e.type)return e;return this.error("Expected component types: "+t),null}this.error("Not in same scene: "+e.type)}_own(t){this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[t.id]||(this._ownedComponents[t.id]=t),t.once("destroyed",(()=>{delete this._ownedComponents[t.id]}),this)}_needUpdate(t){this._updateScheduled||(this._updateScheduled=!0,0===t?this._doUpdate():I.scheduleTask(this._doUpdate,this))}_doUpdate(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}_update(){}clear(){if(this._ownedComponents)for(var t in this._ownedComponents)if(this._ownedComponents.hasOwnProperty(t)){this._ownedComponents[t].destroy(),delete this._ownedComponents[t]}}destroy(){if(this.destroyed)return;let t,e,s,i,r,o;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(t in this._attachments)if(this._attachments.hasOwnProperty(t)){for(e=this._attachments[t],s=e.component,i=e.subs,r=0,o=i.length;r<o;r++)s.off(i[r]);e.managingLifecycle&&s.destroy()}if(this._ownedComponents)for(t in this._ownedComponents)this._ownedComponents.hasOwnProperty(t)&&(s=this._ownedComponents[t],s.destroy(),delete this._ownedComponents[t]);this.scene._removeComponent(this),this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}}const C=1,F=4,O=8,R=16,L=32,N=256,B=512,k=1024,j=2048,G=new Float32Array([0,0,0]),H=new Uint16Array([0,0,0]);class V{constructor(t,e,s,i,r,o){this._isObject=e,this.scene=t.scene,this.model=t,this.meshes=i,this._numTriangles=0;for(var n=0,a=this.meshes.length;n<a;n++){const t=this.meshes[n];t.parent=this,this._numTriangles+=t.numTriangles}this.id=s,this.originalSystemId=c.unglobalizeObjectId(t.id,s),this._flags=r,this._aabb=o,this._offsetAABB=c.AABB3(o),this._offset=c.vec3(),this._isObject&&t.scene._registerObject(this)}get isEntity(){return!0}get isModel(){return!1}get isObject(){return this._isObject}get aabb(){return this._offsetAABB}get numTriangles(){return this._numTriangles}set visible(t){if(!!(this._flags&C)!==t){this._flags=t?this._flags|C:this._flags&~C;for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}get visible(){return this._getFlag(C)}_getFlag(t){return!!(this._flags&t)}set highlighted(t){if(!!(this._flags&B)!==t){this._flags=t?this._flags|B:this._flags&~B;for(var e=0,s=this.meshes.length;e<s;e++)this.meshes[e]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}get highlighted(){return this._getFlag(B)}set xrayed(t){if(!!(this._flags&N)!==t){this._flags=t?this._flags|N:this._flags&~N;for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}get xrayed(){return this._getFlag(N)}set selected(t){if(!!(this._flags&k)!==t){this._flags=t?this._flags|k:this._flags&~k;for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}get selected(){return this._getFlag(k)}set edges(t){if(!!(this._flags&j)!==t){this._flags=t?this._flags|j:this._flags&~j;for(var e=0,s=this.meshes.length;e<s;e++)this.meshes[e]._setEdges(this._flags);this.model.glRedraw()}}get edges(){return this._getFlag(j)}set culled(t){if(!!(this._flags&F)!==t){this._flags=t?this._flags|F:this._flags&~F;for(var e=0,s=this.meshes.length;e<s;e++)this.meshes[e]._setCulled(this._flags);this.model.glRedraw()}}get culled(){return this._getFlag(F)}set clippable(t){if(!!(this._flags&R)!==t){this._flags=t?this._flags|R:this._flags&~R;for(var e=0,s=this.meshes.length;e<s;e++)this.meshes[e]._setClippable(this._flags);this.model.glRedraw()}}get clippable(){return this._getFlag(R)}set collidable(t){if(!!(this._flags&L)!==t){this._flags=t?this._flags|L:this._flags&~L;for(var e=0,s=this.meshes.length;e<s;e++)this.meshes[e]._setCollidable(this._flags)}}get collidable(){return this._getFlag(L)}set pickable(t){if(!!(this._flags&O)!==t){this._flags=t?this._flags|O:this._flags&~O;for(var e=0,s=this.meshes.length;e<s;e++)this.meshes[e]._setPickable(this._flags)}}get pickable(){return this._getFlag(O)}set colorize(t){if(t){H[0]=Math.floor(255*t[0]),H[1]=Math.floor(255*t[1]),H[2]=Math.floor(255*t[2]);for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setColorize(H)}else for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setColorize(null);if(this._isObject){const e=!!t;this.scene._objectColorizeUpdated(this,e)}this.model.glRedraw()}get colorize(){if(0===this.meshes.length)return null;const t=this.meshes[0]._colorize;return G[0]=t[0]/255,G[1]=t[1]/255,G[2]=t[2]/255,G}set opacity(t){if(0===this.meshes.length)return;const e=null!=t,s=this.meshes[0]._colorize[3];let i=255;if(e){if(t<0?t=0:t>1&&(t=1),i=Math.floor(255*t),s===i)return}else if(i=255,s===i)return;for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setOpacity(i,this._flags);this._isObject&&this.scene._objectOpacityUpdated(this,e),this.model.glRedraw()}get opacity(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1}set offset(t){t?(this._offset[0]=t[0],this._offset[1]=t[1],this._offset[2]=t[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._setOffset(this._offset);this._offsetAABB[0]=this._aabb[0]+this._offset[0],this._offsetAABB[1]=this._aabb[1]+this._offset[1],this._offsetAABB[2]=this._aabb[2]+this._offset[2],this._offsetAABB[3]=this._aabb[3]+this._offset[0],this._offsetAABB[4]=this._aabb[4]+this._offset[1],this._offsetAABB[5]=this._aabb[5]+this._offset[2],this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,t),this.model._aabbDirty=!0,this.model.glRedraw()}get offset(){return this._offset}set castsShadow(t){}get castsShadow(){return!1}set receivesShadow(t){}get receivesShadow(){return!1}get saoEnabled(){return this.model.saoEnabled}_finalize(){const t=this.model.scene;this._isObject&&(this.visible&&t._objectVisibilityUpdated(this),this.highlighted&&t._objectHighlightedUpdated(this),this.xrayed&&t._objectXRayedUpdated(this),this.selected&&t._objectSelectedUpdated(this));for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._finalize(this._flags)}_destroy(){const t=this.model.scene;this._isObject&&(t._deregisterObject(this),this.visible&&t._objectVisibilityUpdated(this,!1),this.xrayed&&t._objectXRayedUpdated(this),this.selected&&t._objectSelectedUpdated(this),this.highlighted&&t._objectHighlightedUpdated(this),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1));for(let t=0,e=this.meshes.length;t<e;t++)this.meshes[t]._destroy();t._aabbDirty=!0}}const z=c.vec3(),U=function(){const t=new Float32Array(16),e=new Float64Array(4),s=new Float64Array(4);return function(i,r,o=t){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=1,c.transformVec4(i,e,s),c.setMat4Translation(i,s,o),o}}();function X(t,e,s){const i=Float32Array.from([t[0]])[0],r=t[0]-i,o=Float32Array.from([t[1]])[0],n=t[1]-o,a=Float32Array.from([t[2]])[0],h=t[2]-a;e[0]=i,e[1]=o,e[2]=a,s[0]=r,s[1]=n,s[2]=h}function W(t,e,s,i=1e6){const r=c.getPositionsCenter(t,z),o=Math.round(r[0]/i)*i,n=Math.round(r[1]/i)*i,a=Math.round(r[2]/i)*i;s[0]=o,s[1]=n,s[2]=a;const h=0!==s[0]||0!==s[1]||0!==s[2];if(h)for(let s=0,i=t.length;s<i;s+=3)e[s+0]=t[s+0]-o,e[s+1]=t[s+1]-n,e[s+2]=t[s+2]-a;return h}function Y(t,e,s,i){const r=c.dotVec3(e,s)+t,o=c.normalizeVec3(e,z);return c.mulVec3Scalar(o,-r,i),i}const K=c.vec4(),Z=c.vec4();class q extends A{constructor(t,e){super(t,e),this._entity=null,this._visible=null,this._worldPos=c.vec3(),this._origin=c.vec3(),this._rtcPos=c.vec3(),this._viewPos=c.vec3(),this._canvasPos=c.vec2(),this._occludable=!1,this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewPosDirty=!0,this._needUpdate()})),this._onCameraProjMatrix=this.scene.camera.on("projMatrix",(()=>{this._canvasPosDirty=!0,this._needUpdate()})),this._onEntityDestroyed=null,this._onEntityModelDestroyed=null,this._renderer.addMarker(this),this.entity=e.entity,this.worldPos=e.worldPos,this.occludable=e.occludable}_update(){if(this._viewPosDirty&&(c.transformPoint3(this.scene.camera.viewMatrix,this._worldPos,this._viewPos),this._viewPosDirty=!1,this._canvasPosDirty=!0,this.fire("viewPos",this._viewPos)),this._canvasPosDirty){K.set(this._viewPos),K[3]=1,c.transformPoint4(this.scene.camera.projMatrix,K,Z);const t=this.scene.canvas.boundary;this._canvasPos[0]=Math.floor((1+Z[0]/Z[3])*t[2]/2),this._canvasPos[1]=Math.floor((1-Z[1]/Z[3])*t[3]/2),this._canvasPosDirty=!1,this.fire("canvasPos",this._canvasPos)}}_setVisible(t){this._visible,this._visible=t,this.fire("visible",this._visible)}set entity(t){if(this._entity){if(this._entity===t)return;null!==this._onEntityDestroyed&&(this._entity.off(this._onEntityDestroyed),this._onEntityDestroyed=null),null!==this._onEntityModelDestroyed&&(this._entity.model.off(this._onEntityModelDestroyed),this._onEntityModelDestroyed=null)}this._entity=t,this._entity&&(this._entity instanceof V?this._onEntityModelDestroyed=this._entity.model.on("destroyed",(()=>{this._entity=null,this._onEntityModelDestroyed=null})):this._onEntityDestroyed=this._entity.on("destroyed",(()=>{this._entity=null,this._onEntityDestroyed=null}))),this.fire("entity",this._entity,!0)}get entity(){return this._entity}set occludable(t){(t=!!t)!==this._occludable&&(this._occludable=t)}get occludable(){return this._occludable}set worldPos(t){this._worldPos.set(t||[0,0,0]),X(this._worldPos,this._origin,this._rtcPos),this._occludable&&this._renderer.markerWorldPosUpdated(this),this._viewPosDirty=!0,this.fire("worldPos",this._worldPos)}get worldPos(){return this._worldPos}get origin(){return this._origin}get rtcPos(){return this._rtcPos}get viewPos(){return this._update(),this._viewPos}get canvasPos(){return this._update(),this._canvasPos}get visible(){return!!this._visible}destroy(){this.fire("destroyed",!0),this.scene.camera.off(this._onCameraViewMatrix),this.scene.camera.off(this._onCameraProjMatrix),this._entity&&(null!==this._onEntityDestroyed&&this._entity.off(this._onEntityDestroyed),null!==this._onEntityModelDestroyed&&this._entity.model.off(this._onEntityModelDestroyed)),this._renderer.removeMarker(this),super.destroy()}}class ${constructor(t,e={}){this._wire=document.createElement("div"),this._wire.className+=this._wire.className?" viewer-ruler-wire":"viewer-ruler-wire";var s=this._wire,i=s.style;this._thickness=e.thickness||1,i.border="solid "+this._thickness+"px "+(e.color||"black"),i.position="absolute",i["z-index"]=void 0===e.zIndex?"2000001":e.zIndex,i.width="0px",i.height="0px",i.visibility="visible",i.top="0px",i.left="0px",i["pointer-events"]="none",i["-webkit-transform-origin"]="0 0",i["-moz-transform-origin"]="0 0",i["-ms-transform-origin"]="0 0",i["-o-transform-origin"]="0 0",i["transform-origin"]="0 0",i["-webkit-transform"]="rotate(0deg)",i["-moz-transform"]="rotate(0deg)",i["-ms-transform"]="rotate(0deg)",i["-o-transform"]="rotate(0deg)",i.transform="rotate(0deg)",i.opacity=1,t.appendChild(s),this._x1=0,this._y1=0,this._x2=0,this._y2=0,this._update()}get _visible(){return"visible"===this._wire.style.visibility}_update(){var t=Math.abs(Math.sqrt((this._x1-this._x2)*(this._x1-this._x2)+(this._y1-this._y2)*(this._y1-this._y2))),e=180*Math.atan2(this._y2-this._y1,this._x2-this._x1)/Math.PI,s=this._wire.style;s.width=Math.round(t)+"px",s.left=Math.round(this._x1)+"px",s.top=Math.round(this._y1)+"px",s["-webkit-transform"]="rotate("+e+"deg)",s["-moz-transform"]="rotate("+e+"deg)",s["-ms-transform"]="rotate("+e+"deg)",s["-o-transform"]="rotate("+e+"deg)",s.transform="rotate("+e+"deg)",s["pointer-events"]="none"}setStartAndEnd(t,e,s,i){this._x1=t,this._y1=e,this._x2=s,this._y2=i,this._update()}setColor(t){this._wire.style.border="solid "+this._thickness+"px "+(t||"black")}setOpacity(t){this._wire.style.opacity=t}setVisible(t){t=!!t,this._visible!==t&&(this._wire.style.visibility=t?"visible":"hidden")}destroy(t){this._wire.parentElement.removeChild(this._wire)}}class Q{constructor(t,e={}){this._x=0,this._y=0,this._visible=!0,this._dot=document.createElement("div"),this._dot.className+=this._dot.className?" viewer-ruler-dot":"viewer-ruler-dot";var s=this._dot,i=s.style;i["border-radius"]="25px",i.border="solid 2px white",i.background="lightgreen",i.position="absolute",i["z-index"]=void 0===e.zIndex?"40000005":e.zIndex,i.width="8px",i.height="8px",i.visibility="visible",i.top="0px",i.left="0px",i["box-shadow"]="0 2px 5px 0 #182A3D;",i["pointer-events"]="none",i.opacity=1,t.appendChild(s),this.setPos(e.x||0,e.y||0),this.setFillColor(e.fillColor),this.setBorderColor(e.borderColor),this.setClickable(!1)}setPos(t,e){this._x=t,this._y=e;var s=this._dot.style;s.left=Math.round(t)-5+"px",s.top=Math.round(e)-5+"px"}setFillColor(t){this._dot.style.background=t||"lightgreen"}setBorderColor(t){this._dot.style.border="solid 2px"+(t||"black")}setOpacity(t){this._dot.style.opacity=t}setVisible(t){this._visible!==t&&(this._visible=!!t,this._dot.style.visibility=this._visible?"visible":"hidden")}setClickable(t){this._dot.style["pointer-events"]=t?"all":"none"}destroy(){this.setVisible(!1),this._dot.parentElement.removeChild(this._dot)}}class J{constructor(t,e={}){this._prefix=e.prefix||"",this._x=0,this._y=0,this._visible=!0,this._label=document.createElement("div"),this._label.className+=this._label.className?" viewer-ruler-label":"viewer-ruler-label";var s=this._label,i=s.style;i["border-radius"]="5px",i.color="white",i.padding="4px",i.border="solid 0px white",i.background="lightgreen",i.position="absolute",i["z-index"]=void 0===e.zIndex?"5000005":e.zIndex,i.width="auto",i.height="auto",i.visibility="visible",i.top="0px",i.left="0px",i["pointer-events"]="none",i.opacity=1,s.innerText="",t.appendChild(s),this.setPos(e.x||0,e.y||0),this.setFillColor(e.fillColor),this.setBorderColor(e.borderColor),this.setText(e.text)}setPos(t,e){this._x=t,this._y=e;var s=this._label.style;s.left=Math.round(t)-20+"px",s.top=Math.round(e)-12+"px"}setPosOnWire(t,e,s,i){var r=t+.5*(s-t),o=e+.5*(i-e),n=this._label.style;n.left=Math.round(r)-20+"px",n.top=Math.round(o)-12+"px"}setPosBetweenWires(t,e,s,i,r,o){var n=(t+s+r)/3,a=(e+i+o)/3,h=this._label.style;h.left=Math.round(n)-20+"px",h.top=Math.round(a)-12+"px"}setText(t){this._label.innerHTML=this._prefix+(t||"")}setFillColor(t){this._label.style.background=t||"lightgreen"}setBorderColor(t){this._label.style.border="solid 2px"+(t||"black")}setOpacity(t){this._label.style.opacity=t}setVisible(t){this._visible!==t&&(this._visible=!!t,this._label.style.visibility=this._visible?"visible":"hidden")}destroy(){this._label.parentElement.removeChild(this._label)}}var tt=c.vec3(),et=c.vec3();class st extends A{constructor(t,e={}){if(super(t.viewer.scene,e),this.plugin=t,this._container=e.container,!this._container)throw"config missing: container";this._color=e.color||t.defaultColor;var s=this.plugin.viewer.scene;this._originMarker=new q(s,e.origin),this._cornerMarker=new q(s,e.corner),this._targetMarker=new q(s,e.target),this._originWorld=c.vec3(),this._cornerWorld=c.vec3(),this._targetWorld=c.vec3(),this._wp=new Float64Array(12),this._vp=new Float64Array(12),this._pp=new Float64Array(12),this._cp=new Int16Array(6),this._originDot=new Q(this._container,{fillColor:this._color,zIndex:t.zIndex+1}),this._cornerDot=new Q(this._container,{fillColor:this._color,zIndex:t.zIndex+1}),this._targetDot=new Q(this._container,{fillColor:this._color,zIndex:t.zIndex+1}),this._originWire=new $(this._container,{color:this._color||"blue",thickness:1,zIndex:t.zIndex}),this._targetWire=new $(this._container,{color:this._color||"red",thickness:1,zIndex:t.zIndex}),this._angleLabel=new J(this._container,{fillColor:this._color||"#00BBFF",prefix:"",text:"",zIndex:t.zIndex+2}),this._wpDirty=!1,this._vpDirty=!1,this._cpDirty=!1,this._visible=!1,this._originVisible=!1,this._cornerVisible=!1,this._targetVisible=!1,this._originWireVisible=!1,this._targetWireVisible=!1,this._angleVisible=!1,this._originMarker.on("worldPos",(t=>{this._originWorld.set(t||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._cornerMarker.on("worldPos",(t=>{this._cornerWorld.set(t||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._targetMarker.on("worldPos",(t=>{this._targetWorld.set(t||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._onViewMatrix=s.camera.on("viewMatrix",(()=>{this._vpDirty=!0,this._needUpdate(0)})),this._onProjMatrix=s.camera.on("projMatrix",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onCanvasBoundary=s.canvas.on("boundary",(()=>{this._cpDirty=!0,this._needUpdate(0)})),this.approximate=e.approximate,this.visible=e.visible,this.originVisible=e.originVisible,this.cornerVisible=e.cornerVisible,this.targetVisible=e.targetVisible,this.originWireVisible=e.originWireVisible,this.targetWireVisible=e.targetWireVisible,this.angleVisible=e.angleVisible}_update(){if(!this._visible)return;const t=this.plugin.viewer.scene;if(this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._cornerWorld[0],this._wp[5]=this._cornerWorld[1],this._wp[6]=this._cornerWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._targetWorld[2],this._wp[11]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(c.transformPositions4(t.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vpDirty=!1,this._cpDirty=!0),this._cpDirty){const d=-.3,m=this._originMarker.viewPos[2],f=this._cornerMarker.viewPos[2],g=this._targetMarker.viewPos[2];if(m>d||f>d||g>d)return this._originDot.setVisible(!1),this._cornerDot.setVisible(!1),this._targetDot.setVisible(!1),this._originWire.setVisible(!1),this._targetWire.setVisible(!1),void this._angleLabel.setVisible(!1);c.transformPositions4(t.camera.project.matrix,this._vp,this._pp);for(var e=this._pp,s=this._cp,i=t.canvas.canvas.getBoundingClientRect(),r=i.top,o=i.left,n=t.canvas.boundary,a=n[2],h=n[3],l=0,u=0,p=e.length;u<p;u+=4)s[l]=o+Math.floor((1+e[u+0]/e[u+3])*a/2),s[l+1]=r+Math.floor((1-e[u+1]/e[u+3])*h/2),l+=2;if(this._originDot.setPos(s[0],s[1]),this._cornerDot.setPos(s[2],s[3]),this._targetDot.setPos(s[4],s[5]),this._originWire.setStartAndEnd(s[0],s[1],s[2],s[3]),this._targetWire.setStartAndEnd(s[2],s[3],s[4],s[5]),this._angleLabel.setPosBetweenWires(s[0],s[1],s[2],s[3],s[4],s[5]),c.subVec3(this._originWorld,this._cornerWorld,tt),c.subVec3(this._targetWorld,this._cornerWorld,et),!(0===tt[0]&&0===tt[1]&&0===tt[2]||0===et[0]&&0===et[1]&&0===et[2])){const t=this._approximate?" ~ ":" = ";c.normalizeVec3(tt),c.normalizeVec3(et);const e=Math.abs(c.angleVec3(tt,et));this._angle=e/c.DEGTORAD,this._angleLabel.setText(t+this._angle.toFixed(2)+"")}else this._angleLabel.setText("");this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setVisible(this._visible&&this._angleVisible),this._cpDirty=!1}}set approximate(t){t=!1!==t,this._approximate!==t&&(this._approximate=t,this._cpDirty=!0,this._needUpdate(0))}get approximate(){return this._approximate}get origin(){return this._originMarker}get corner(){return this._cornerMarker}get target(){return this._targetMarker}get angle(){return this._update(),this._angle}get color(){return this._color}set color(t){this._originDot.setFillColor(t),this._cornerDot.setFillColor(t),this._targetDot.setFillColor(t),this._originWire.setColor(t||"blue"),this._targetWire.setColor(t||"red"),this._angleLabel.setFillColor(t||"#00BBFF"),this._color=t}set visible(t){t=!1!==t,this._visible=t,this._originDot.setVisible(this._visible&&this._originVisible),this._cornerDot.setVisible(this._visible&&this._cornerVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._originWire.setVisible(this._visible&&this._originWireVisible),this._targetWire.setVisible(this._visible&&this._targetWireVisible),this._angleLabel.setVisible(this._visible&&this._angleVisible)}get visible(){return this._visible}set originVisible(t){t=!1!==t,this._originVisible=t,this._originDot.setVisible(this._visible&&this._originVisible)}get originVisible(){return this._originVisible}set cornerVisible(t){t=!1!==t,this._cornerVisible=t,this._cornerDot.setVisible(this._visible&&this._cornerVisible)}get cornerVisible(){return this._cornerVisible}set targetVisible(t){t=!1!==t,this._targetVisible=t,this._targetDot.setVisible(this._visible&&this._targetVisible)}get targetVisible(){return this._targetVisible}set originWireVisible(t){t=!1!==t,this._originWireVisible=t,this._originWire.setVisible(this._visible&&this._originWireVisible)}get originWireVisible(){return this._originWireVisible}set targetWireVisible(t){t=!1!==t,this._targetWireVisible=t,this._targetWire.setVisible(this._visible&&this._targetWireVisible)}get targetWireVisible(){return this._targetWireVisible}set angleVisible(t){t=!1!==t,this._angleVisible=t,this._angleLabel.setVisible(this._visible&&this._angleVisible)}get angleVisible(){return this._angleVisible}destroy(){const t=this.plugin.viewer.scene;this._onViewMatrix&&t.camera.off(this._onViewMatrix),this._onProjMatrix&&t.camera.off(this._onProjMatrix),this._onCanvasBoundary&&t.canvas.off(this._onCanvasBoundary),this._originDot.destroy(),this._cornerDot.destroy(),this._targetDot.destroy(),this._originWire.destroy(),this._targetWire.destroy(),this._angleLabel.destroy(),super.destroy()}}class it extends A{constructor(t){super(t.viewer.scene),this.plugin=t,this._active=!1,this._state=0,this._currentAngleMeasurement=null,this._onhoverSurface=null,this._onPickedSurface=null,this._onHoverNothing=null,this._onPickedNothing=null}get active(){return this._active}activate(){if(this._active)return;this.startDot=new Q(this.plugin._container,{fillColor:this.plugin.defaultColor,zIndex:this.plugin.zIndex+1});const t=this.plugin.viewer.cameraControl;let e=!1,s=null,i=c.vec3();const r=c.vec2(),o=this.plugin.viewer.scene.pickSurfacePrecisionEnabled;let n,a;this._onhoverSurface=t.on("hoverSurface",(t=>{if(e=!0,s=t.entity,i.set(t.worldPos),r.set(t.canvasPos),0===this._state)return this.startDot&&(this.startDot.setVisible(!0),this.startDot.setPos(t.canvasPos[0],t.canvasPos[1])),void(this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer");if(this._currentAngleMeasurement)switch(this._state){case 2:this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.angleVisible=!1,this._currentAngleMeasurement.corner.entity=t.entity,this._currentAngleMeasurement.corner.worldPos=t.worldPos,this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer";break;case 3:this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.target.entity=t.entity,this._currentAngleMeasurement.target.worldPos=t.worldPos,this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer"}}));this._onInputMouseDown=this.plugin.viewer.scene.input.on("mousedown",(t=>{n=t[0],a=t[1]})),this._onInputMouseUp=this.plugin.viewer.scene.input.on("mouseup",(t=>{if(!(t[0]>n+5||t[0]<n-5||t[1]>a+5||t[1]<a-5))switch(this.startDot&&(this.startDot.destroy(),this.startDot=null),this._state){case 0:if(e){if(o){const t=this.plugin.viewer.scene.pick({canvasPos:r,pickSurface:!0,pickSurfacePrecision:!0});t&&t.worldPos&&i.set(t.worldPos)}this._currentAngleMeasurement=this.plugin.createMeasurement({id:c.createUUID(),origin:{entity:s,worldPos:i},corner:{entity:s,worldPos:i},target:{entity:s,worldPos:i},approximate:!0}),this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._state=2,this.fire("measurementStart",this._currentAngleMeasurement)}break;case 2:if(e){if(o){const t=this.plugin.viewer.scene.pick({canvasPos:r,pickSurface:!0,pickSurfacePrecision:!0});t&&t.worldPos&&(this._currentAngleMeasurement.corner.worldPos=t.worldPos)}this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._state=3}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement));break;case 3:if(e){if(o){const t=this.plugin.viewer.scene.pick({canvasPos:r,pickSurface:!0,pickSurfacePrecision:!0});t&&t.worldPos&&(this._currentAngleMeasurement.target.worldPos=t.worldPos,this._currentAngleMeasurement.approximate=!1)}this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null,this._state=0}else this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,this._state=0,this.fire("measurementCancel",this._currentAngleMeasurement))}})),this._onHoverNothing=t.on("hoverOff",(t=>{if(this.startDot&&this.startDot.setVisible(!1),e=!1,this._currentAngleMeasurement){switch(this._state){case 0:case 1:this._currentAngleMeasurement.originVisible=!1;break;case 2:this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.originWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1;break;case 3:this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1}this.plugin.viewer.scene.canvas.canvas.style.cursor="default"}})),this._active=!0}deactivate(){if(!this._active)return;this.startDot&&(this.startDot.destroy(),this.startDot=null),this.reset();const t=this.plugin.viewer.cameraControl,e=this.plugin.viewer.scene.input;e.off(this._onInputMouseDown),e.off(this._onInputMouseUp),t.off(this._onhoverSurface),t.off(this._onPickedSurface),t.off(this._onHoverNothing),t.off(this._onPickedNothing),this._currentAngleMeasurement=null,this._active=!1}reset(){this._active&&(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._state=0)}destroy(){this.deactivate(),super.destroy()}}class rt extends n{constructor(t,e={}){super("AngleMeasurements",t),this._container=e.container||document.body,this._control=new it(this),this._measurements={},this.defaultColor=e.defaultColor,this.zIndex=e.zIndex}send(t,e){}get control(){return this._control}get measurements(){return this._measurements}createMeasurement(t={}){this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);const e=t.origin,s=t.corner,i=t.target,r=new st(this,{id:t.id,plugin:this,container:this._container,origin:{entity:e.entity,worldPos:e.worldPos},corner:{entity:s.entity,worldPos:s.worldPos},target:{entity:i.entity,worldPos:i.worldPos},visible:t.visible,originVisible:!0,originWireVisible:!0,cornerVisible:!0,targetWireVisible:!0,targetVisible:!0});return this._measurements[r.id]=r,r.on("destroyed",(()=>{delete this._measurements[r.id]})),this.fire("measurementCreated",r),r}destroyMeasurement(t){const e=this._measurements[t];e?(e.destroy(),this.fire("measurementDestroyed",e)):this.log("AngleMeasurement not found: "+t)}clear(){const t=Object.keys(this._measurements);for(var e=0,s=t.length;e<s;e++)this.destroyMeasurement(t[e])}destroy(){this.clear(),super.destroy()}}class ot extends q{constructor(t,e){if(super(t,e),this.plugin=e.plugin,this._container=e.container,!this._container)throw"config missing: container";if(!e.markerElement&&!e.markerHTML)throw"config missing: need either markerElement or markerHTML";if(!e.labelElement&&!e.labelHTML)throw"config missing: need either labelElement or labelHTML";this._htmlDirty=!1,e.markerElement?(this._marker=e.markerElement,this._marker.addEventListener("click",this._onMouseClickedExternalMarker=()=>{this.plugin.fire("markerClicked",this)}),this._marker.addEventListener("mouseenter",this._onMouseEnterExternalMarker=()=>{this.plugin.fire("markerMouseEnter",this)}),this._marker.addEventListener("mouseleave",this._onMouseLeaveExternalMarker=()=>{this.plugin.fire("markerMouseLeave",this)}),this._markerExternal=!0):(this._markerHTML=e.markerHTML,this._htmlDirty=!0,this._markerExternal=!1),e.labelElement?(this._label=e.labelElement,this._labelExternal=!0):(this._labelHTML=e.labelHTML,this._htmlDirty=!0,this._labelExternal=!1),this._markerShown=!!e.markerShown,this._labelShown=!!e.labelShown,this._values=e.values||{},this._layoutDirty=!0,this._visibilityDirty=!0,this._buildHTML(),this._onTick=this.scene.on("tick",(()=>{this._htmlDirty&&(this._buildHTML(),this._htmlDirty=!1,this._layoutDirty=!0,this._visibilityDirty=!0),(this._layoutDirty||this._visibilityDirty)&&(this._markerShown||this._labelShown)&&(this._updatePosition(),this._layoutDirty=!1),this._visibilityDirty&&(this._marker.style.visibility=this.visible&&this._markerShown?"visible":"hidden",this._label.style.visibility=this.visible&&this._markerShown&&this._labelShown?"visible":"hidden",this._visibilityDirty=!1)})),this.on("canvasPos",(()=>{this._layoutDirty=!0})),this.on("visible",(()=>{this._visibilityDirty=!0})),this.setMarkerShown(!1!==e.markerShown),this.setLabelShown(e.labelShown),this.eye=e.eye?e.eye.slice():null,this.look=e.look?e.look.slice():null,this.up=e.up?e.up.slice():null,this.projection=e.projection}_buildHTML(){if(!this._markerExternal){this._marker&&(this._container.removeChild(this._marker),this._marker=null);let t=this._markerHTML||"<p></p>";_.isArray(t)&&(t=t.join("")),t=this._renderTemplate(t);const e=document.createRange().createContextualFragment(t);this._marker=e.firstChild,this._container.appendChild(this._marker),this._marker.style.visibility=this._markerShown?"visible":"hidden",this._marker.addEventListener("click",(()=>{this.plugin.fire("markerClicked",this)})),this._marker.addEventListener("mouseenter",(()=>{this.plugin.fire("markerMouseEnter",this)})),this._marker.addEventListener("mouseleave",(()=>{this.plugin.fire("markerMouseLeave",this)}))}if(!this._labelExternal){this._label&&(this._container.removeChild(this._label),this._label=null);let t=this._labelHTML||"<p></p>";_.isArray(t)&&(t=t.join("")),t=this._renderTemplate(t);const e=document.createRange().createContextualFragment(t);this._label=e.firstChild,this._container.appendChild(this._label),this._label.style.visibility=this._markerShown&&this._labelShown?"visible":"hidden"}}_updatePosition(){const t=this.scene.canvas.boundary,e=t[0],s=t[1],i=this.canvasPos;this._marker.style.left=Math.floor(e+i[0])-12+"px",this._marker.style.top=Math.floor(s+i[1])-12+"px",this._marker.style["z-index"]=90005+Math.floor(this._viewPos[2])+1;this._label.style.left=20+Math.floor(e+i[0]+20)+"px",this._label.style.top=Math.floor(s+i[1]+-17)+"px",this._label.style["z-index"]=90005+Math.floor(this._viewPos[2])+1}_renderTemplate(t){for(var e in this._values)if(this._values.hasOwnProperty(e)){const s=this._values[e];t=t.replace(new RegExp("{{"+e+"}}","g"),s)}return t}setMarkerShown(t){t=!!t,this._markerShown!==t&&(this._markerShown=t,this._visibilityDirty=!0)}getMarkerShown(){return this._markerShown}setLabelShown(t){t=!!t,this._labelShown!==t&&(this._labelShown=t,this._visibilityDirty=!0)}getLabelShown(){return this._labelShown}setField(t,e){this._values[t]=e||"",this._htmlDirty=!0}getField(t){return this._values[t]}setValues(t){for(var e in t)if(t.hasOwnProperty(e)){const s=t[e];this.setField(e,s)}}getValues(){return this._values}destroy(){this._marker&&(this._markerExternal?(this._marker.removeEventListener("click",this._onMouseClickedExternalMarker),this._marker.removeEventListener("mouseenter",this._onMouseEnterExternalMarker),this._marker.removeEventListener("mouseleave",this._onMouseLeaveExternalMarker),this._marker=null):this._marker.parentNode.removeChild(this._marker)),this._label&&(this._labelExternal||this._label.parentNode.removeChild(this._label),this._label=null),this.scene.off(this._onTick),super.destroy()}}const nt=c.vec3(),at=c.vec3(),ht=c.vec3();class lt extends n{constructor(t,e){super("Annotations",t),this._labelHTML=e.labelHTML||"<div></div>",this._markerHTML=e.markerHTML||"<div></div>",this._container=e.container||document.body,this._values=e.values||{},this.annotations={},this.surfaceOffset=e.surfaceOffset}send(t,e){if("clearAnnotations"===t)this.clear()}set surfaceOffset(t){null==t&&(t=.3),this._surfaceOffset=t}get surfaceOffset(){return this._surfaceOffset}createAnnotation(t){var e,s;if(this.viewer.scene.components[t.id]&&(this.error("Viewer component with this ID already exists: "+t.id),delete t.id),t.pickResult=t.pickResult||t.pickRecord,t.pickResult){const i=t.pickResult;if(i.worldPos&&i.worldNormal){const t=c.normalizeVec3(i.worldNormal,nt),r=c.mulVec3Scalar(t,this._surfaceOffset,at);e=c.addVec3(i.worldPos,r,ht),s=i.entity}else this.error("Param 'pickResult' does not have both worldPos and worldNormal")}else e=t.worldPos,s=t.entity;var i=null;t.markerElementId&&((i=document.getElementById(t.markerElementId))||this.error("Can't find DOM element for 'markerElementId' value '"+t.markerElementId+"' - defaulting to internally-generated empty DIV"));var r=null;t.labelElementId&&((r=document.getElementById(t.labelElementId))||this.error("Can't find DOM element for 'labelElementId' value '"+t.labelElementId+"' - defaulting to internally-generated empty DIV"));const o=new ot(this.viewer.scene,{id:t.id,plugin:this,entity:s,worldPos:e,container:this._container,markerElement:i,labelElement:r,markerHTML:t.markerHTML||this._markerHTML,labelHTML:t.labelHTML||this._labelHTML,occludable:t.occludable,values:_.apply(t.values,_.apply(this._values,{})),markerShown:t.markerShown,labelShown:t.labelShown,eye:t.eye,look:t.look,up:t.up,projection:t.projection,visible:!1!==t.visible});return this.annotations[o.id]=o,o.on("destroyed",(()=>{delete this.annotations[o.id],this.fire("annotationDestroyed",o.id)})),this.fire("annotationCreated",o.id),o}destroyAnnotation(t){var e=this.annotations[t];e?e.destroy():this.log("Annotation not found: "+t)}clear(){const t=Object.keys(this.annotations);for(var e=0,s=t.length;e<s;e++)this.destroyAnnotation(t[e])}destroy(){this.clear(),super.destroy()}}class ut extends A{get type(){return"Spinner"}constructor(t,e={}){super(t,e),this._canvas=e.canvas,this._element=null,this._isCustom=!1,e.elementId&&(this._element=document.getElementById(e.elementId),this._element?this._adjustPosition():this.error("Can't find given Spinner HTML element: '"+e.elementId+"' - will automatically create default element")),this._element||this._createDefaultSpinner(),this.processes=0}_createDefaultSpinner(){this._injectDefaultCSS();const t=document.createElement("div"),e=t.style;e["z-index"]="9000",e.position="absolute",t.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>',this._canvas.parentElement.appendChild(t),this._element=t,this._isCustom=!1,this._adjustPosition()}_injectDefaultCSS(){const t="xeokit-spinner-css";if(document.getElementById(t))return;const e=document.createElement("style");e.innerHTML=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }",e.id=t,document.body.appendChild(e)}_adjustPosition(){if(this._isCustom)return;const t=this._canvas,e=this._element,s=e.style;s.left=t.offsetLeft+.5*t.clientWidth-.5*e.clientWidth+"px",s.top=t.offsetTop+.5*t.clientHeight-.5*e.clientHeight+"px"}set processes(t){if(t=t||0,this._processes===t)return;if(t<0)return;const e=this._processes;this._processes=t;const s=this._element;s&&(s.style.visibility=this._processes>0?"visible":"hidden"),this.fire("processes",this._processes),0===this._processes&&this._processes!==e&&this.fire("zeroProcesses",this._processes)}get processes(){return this._processes}_destroy(){this._element&&!this._isCustom&&(this._element.parentNode.removeChild(this._element),this._element=null);const t=document.getElementById("xeokit-spinner-css");t&&t.parentNode.removeChild(t)}}const pt={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},ct=document.createElement("canvas");if(ct){const t=ct.getContext("webgl",{antialias:!0})||ct.getContext("experimental-webgl",{antialias:!0});pt.WEBGL=!!t,pt.WEBGL&&(pt.ANTIALIAS=t.getContextAttributes().antialias,t.getShaderPrecisionFormat?t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0?pt.FS_MAX_FLOAT_PRECISION="highp":t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?pt.FS_MAX_FLOAT_PRECISION="mediump":pt.FS_MAX_FLOAT_PRECISION="lowp":pt.FS_MAX_FLOAT_PRECISION="mediump",pt.DEPTH_BUFFER_BITS=t.getParameter(t.DEPTH_BITS),pt.MAX_TEXTURE_SIZE=t.getParameter(t.MAX_TEXTURE_SIZE),pt.MAX_CUBE_MAP_SIZE=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),pt.MAX_RENDERBUFFER_SIZE=t.getParameter(t.MAX_RENDERBUFFER_SIZE),pt.MAX_TEXTURE_UNITS=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),pt.MAX_TEXTURE_IMAGE_UNITS=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),pt.MAX_VERTEX_ATTRIBS=t.getParameter(t.MAX_VERTEX_ATTRIBS),pt.MAX_VERTEX_UNIFORM_VECTORS=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),pt.MAX_FRAGMENT_UNIFORM_VECTORS=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),pt.MAX_VARYING_VECTORS=t.getParameter(t.MAX_VARYING_VECTORS),t.getSupportedExtensions().forEach((function(t){pt.SUPPORTED_EXTENSIONS[t]=!0})),pt.depthTexturesSupported=pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture)}const dt=["webgl","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"];class mt extends A{get type(){return"Canvas"}constructor(t,e={}){super(t,e),this._backgroundColor=c.vec3([e.backgroundColor?e.backgroundColor[0]:1,e.backgroundColor?e.backgroundColor[1]:1,e.backgroundColor?e.backgroundColor[2]:1]),this._backgroundColorFromAmbientLight=!!e.backgroundColorFromAmbientLight,this.canvas=e.canvas,this.gl=null,this.webgl2=!1,this.transparent=!!e.transparent,this.contextAttr=e.contextAttr||{},this.contextAttr.alpha=this.transparent,this.contextAttr.preserveDrawingBuffer=!!this.contextAttr.preserveDrawingBuffer,this.contextAttr.stencil=!1,this.contextAttr.premultipliedAlpha=!!this.contextAttr.premultipliedAlpha,this.contextAttr.antialias=!1!==this.contextAttr.antialias,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight,this.boundary=[this.canvas.offsetLeft,this.canvas.offsetTop,this.canvas.clientWidth,this.canvas.clientHeight],this._initWebGL(e);const s=this;this.canvas.addEventListener("webglcontextlost",this._webglcontextlostListener=function(t){console.time("webglcontextrestored"),s.scene._webglContextLost(),s.fire("webglcontextlost"),t.preventDefault()},!1),this.canvas.addEventListener("webglcontextrestored",this._webglcontextrestoredListener=function(t){s._initWebGL(),s.gl&&(s.scene._webglContextRestored(s.gl),s.fire("webglcontextrestored",s.gl),t.preventDefault()),console.timeEnd("webglcontextrestored")},!1);let i=null,r=null,o=null,n=null,a=null,h=null,l=null;this._tick=this.scene.on("tick",(function(){const t=s.canvas,e=window.innerWidth!==i||window.innerHeight!==r,u=t.clientWidth!==o||t.clientHeight!==n,p=t.offsetLeft!==a||t.offsetTop!==h,c=t.parentElement;if(e||u||p||c!==l){if(s._spinner._adjustPosition(),u||p){const e=t.clientWidth,i=t.clientHeight;if(u){let e,s=0;for(const t in I.scenes)I.scenes.hasOwnProperty(t)&&(e=I.scenes[t],s+=e.canvas.canvas.clientWidth*e.canvas.canvas.clientHeight);m.memory.pixels=s,t.width=t.clientWidth,t.height=t.clientHeight}const r=s.boundary;r[0]=t.offsetLeft,r[1]=t.offsetTop,r[2]=e,r[3]=i,s.fire("boundary",r),o=e,n=i}e&&(i=window.innerWidth,r=window.innerHeight),p&&(a=t.offsetLeft,h=t.offsetTop),l=c}})),this._spinner=new ut(this.scene,{canvas:this.canvas,elementId:e.spinnerElementId})}_createCanvas(){const t="xeokit-canvas-"+c.createUUID(),e=document.getElementsByTagName("body")[0],s=document.createElement("div"),i=s.style;i.height="100%",i.width="100%",i.padding="0",i.margin="0",i.background="rgba(0,0,0,0);",i.float="left",i.left="0",i.top="0",i.position="absolute",i.opacity="1.0",i["z-index"]="-10000",s.innerHTML+='<canvas id="'+t+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>',e.appendChild(s),this.canvas=document.getElementById(t)}_getElementXY(t){let e=0,s=0;for(;t;)e+=t.offsetLeft-t.scrollLeft,s+=t.offsetTop-t.scrollTop,t=t.offsetParent;return{x:e,y:s}}_initWebGL(){if(!this.gl)for(let t=0;!this.gl&&t<dt.length;t++)try{this.gl=this.canvas.getContext(dt[t],this.contextAttr)}catch(t){}if(this.gl||(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0)),this.gl)if(this.webgl2)this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST);else{if(pt.SUPPORTED_EXTENSIONS.OES_standard_derivatives){const t=this.gl.getExtension("OES_standard_derivatives");this.gl.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT_OES,this.gl.FASTEST)}pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&this.gl.getExtension("EXT_frag_depth"),pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&this.gl.getExtension("WEBGL_depth_texture")}}set backgroundColorFromAmbientLight(t){this._backgroundColorFromAmbientLight=!1!==t}get backgroundColorFromAmbientLight(){return this._backgroundColorFromAmbientLight}set backgroundColor(t){t?(this._backgroundColor[0]=t[0],this._backgroundColor[1]=t[1],this._backgroundColor[2]=t[2]):(this._backgroundColor[0]=1,this._backgroundColor[1]=1,this._backgroundColor[2]=1),this.glRedraw()}get backgroundColor(){return this._backgroundColor}getSnapshot(t){throw"Canvas#getSnapshot() has been replaced by Viewer#getSnapshot() - use that method instead."}readPixels(t,e,s,i){return this.scene._renderer.readPixels(t,e,s,i)}loseWebGLContext(){this.canvas.loseContext&&this.canvas.loseContext()}get spinner(){return this._spinner}destroy(){this.scene.off(this._tick),this._spinner._destroy(),this.canvas.removeEventListener("webglcontextlost",this._webglcontextlostListener),this.canvas.removeEventListener("webglcontextrestored",this._webglcontextrestoredListener),this.gl=null,super.destroy()}}class ft{constructor(t){this._scene=t,this._matPool=[],this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.reset()}reset(){this._matPoolNextFreeIndex=0,this._rtcViewMats={},this._rtcPickViewMats={},this.gl=this._scene.canvas.gl,this.lastProgramId=null,this.pbrEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.drawElements=0,this.drawArrays=0,this.useProgram=0,this.bindTexture=0,this.bindArray=0,this.pass=0,this.shadowViewMatrix=null,this.shadowProjMatrix=null,this.pickViewMatrix=null,this.pickProjMatrix=null,this.pickZNear=.01,this.pickZFar=5e3,this.pickInvisible=!1,this.lineWidth=1}getRTCViewMatrix(t,e){let s=this._rtcViewMats[t];return s||(s=this._getNewMat(),U(this._scene.camera.viewMatrix,e,s),this._rtcViewMats[t]=s),s}getRTCPickViewMatrix(t,e){let s=this._rtcPickViewMats[t];if(!s){s=this._getNewMat();const i=this.pickViewMatrix||this._scene.camera.viewMatrix;U(i,e,s),this._rtcPickViewMats[t]=s}return s}_getNewMat(){let t=this._matPool[this._matPoolNextFreeIndex];return t||(t=c.mat4(),this._matPool[this._matPoolNextFreeIndex]=t),this._matPoolNextFreeIndex++,t}}const gt=function(){const t=document.createElement("canvas"),e=String.fromCharCode;if(!t.getContext)return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}};const s=!!t.getContext("2d").getImageData,i=!!t.toDataURL,r=!!window.btoa,o=function(t){let s="";const i=t.width,r=t.height;s+="BM";let o=i*r*4+54;s+=e(o%256),o=Math.floor(o/256),s+=e(o%256),o=Math.floor(o/256),s+=e(o%256),o=Math.floor(o/256),s+=e(o%256),s+=e(0,0,0,0,54,0,0,0),s+=e(40,0,0,0);let n=i;s+=e(n%256),n=Math.floor(n/256),s+=e(n%256),n=Math.floor(n/256),s+=e(n%256),n=Math.floor(n/256),s+=e(n%256);let a=r;s+=e(a%256),a=Math.floor(a/256),s+=e(a%256),a=Math.floor(a/256),s+=e(a%256),a=Math.floor(a/256),s+=e(a%256),s+=e(1,0,32,0),s+=e(0,0,0,0);let h=i*r*4;s+=e(h%256),h=Math.floor(h/256),s+=e(h%256),h=Math.floor(h/256),s+=e(h%256),h=Math.floor(h/256),s+=e(h%256),s+=e(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const l=t.data;let u,p,c,d,m="",f=r;do{for(c=i*(f-1)*4,d="",u=0;u<i;u++)p=4*u,d+=e(l[c+p+2],l[c+p+1],l[c+p],l[c+p+3]);m+=d}while(--f);return function(t){let s,i,r="";if("string"==typeof t)r=t;else for(i=t,s=0;s<i.length;s++)r+=e(i[s]);return btoa(r)}(s+m)},n=function(t){window.open(t)||(document.location.href=t)},a=function(t,e){return"data:"+e+";base64,"+t},h=function(t){const e=document.createElement("img");return e.src=t,e},l=function(t,e,s,i){if(e&&s){const r=document.createElement("canvas");r.width=e,r.height=s,r.style.width=e+"px",r.style.height=s+"px";const o=r.getContext("2d");return i?(o.save(),o.scale(1,-1),o.imageSmoothingEnabled=!0,o.drawImage(t,0,0,t.width,t.height,0,0,e,-s),o.restore()):(o.imageSmoothingEnabled=!0,o.drawImage(t,0,0,t.width,t.height,0,0,e,s)),r}return t};return{saveAsPNG:function(t,e,s,r,o){if(!i)return!1;const a=l(t,s,r,o).toDataURL("image/png");return e?h(a):(n(a),!0)},saveAsJPEG:function(t,e,s,r,o){if(!i)return!1;const a="image/jpeg",u=l(t,s,r,o).toDataURL(a);return 5==u.indexOf(a)&&(e?h(u):(n(u),!0))},saveAsBMP:function(t,e,u,p,c){if(!(i&&s&&r))return!1;const d="image/bmp",m=function(t){const e=parseInt(t.width),s=parseInt(t.height);return t.getContext("2d").getImageData(0,0,e,s)}(l(t,u,p,c)),f=o(m);return e?h(a(f,d)):(n(a(f,d)),!0)}}}();class _t{constructor(t,e,s){s=s||{},this.gl=e,this.allocated=!1,this.canvas=t,this.buffer=null,this.bound=!1,this.size=s.size,this._hasDepthTexture=!!s.depthTexture}setSize(t){this.size=t}webglContextRestored(t){this.gl=t,this.buffer=null,this.allocated=!1,this.bound=!1}bind(){if(this._touch(),this.bound)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,this.buffer.framebuf),this.bound=!0}_touch(){let t,e;const s=this.gl;if(this.size?(t=this.size[0],e=this.size[1]):(t=s.drawingBufferWidth,e=s.drawingBufferHeight),this.buffer){if(this.buffer.width===t&&this.buffer.height===e)return;s.deleteTexture(this.buffer.texture),s.deleteFramebuffer(this.buffer.framebuf),s.deleteRenderbuffer(this.buffer.renderbuf)}const i=s.createTexture();let r;s.bindTexture(s.TEXTURE_2D,i),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t,e,0,s.RGBA,s.UNSIGNED_BYTE,null),this._hasDepthTexture&&(r=s.createTexture(),s.bindTexture(s.TEXTURE_2D,r),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.NEAREST),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texImage2D(s.TEXTURE_2D,0,s.DEPTH_COMPONENT,t,e,0,s.DEPTH_COMPONENT,s.UNSIGNED_INT,null));const o=s.createRenderbuffer();s.bindRenderbuffer(s.RENDERBUFFER,o),s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_COMPONENT16,t,e);const n=s.createFramebuffer();if(s.bindFramebuffer(s.FRAMEBUFFER,n),s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,i,0),this._hasDepthTexture?s.framebufferTexture2D(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.TEXTURE_2D,r,0):s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,o),s.bindTexture(s.TEXTURE_2D,null),s.bindRenderbuffer(s.RENDERBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,null),s.bindFramebuffer(s.FRAMEBUFFER,n),!s.isFramebuffer(n))throw"Invalid framebuffer";s.bindFramebuffer(s.FRAMEBUFFER,null);const a=s.checkFramebufferStatus(s.FRAMEBUFFER);switch(a){case s.FRAMEBUFFER_COMPLETE:break;case s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case s.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+a}this.buffer={framebuf:n,renderbuf:o,texture:i,depthTexture:r,width:t,height:e},this.bound=!1}clear(){if(!this.bound)throw"Render buffer not bound";const t=this.gl;t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)}read(t,e){const s=t,i=this.gl.drawingBufferHeight-e,r=new Uint8Array(4),o=this.gl;return o.readPixels(s,i,1,1,o.RGBA,o.UNSIGNED_BYTE,r),r}readImage(t){const e=this.gl,s=this._getImageDataCache(),i=s.pixelData,r=s.canvas,o=s.imageData,n=s.context;e.readPixels(0,0,this.buffer.width,this.buffer.height,e.RGBA,e.UNSIGNED_BYTE,i),o.data.set(i),n.putImageData(o,0,0);const a=t.width||r.width,h=t.height||r.height,l=t.format||"jpeg",u=!0;let p;switch(l){case"jpeg":p=gt.saveAsJPEG(r,!0,a,h,u);break;case"png":p=gt.saveAsPNG(r,!0,a,h,u);break;case"bmp":p=gt.saveAsBMP(r,!0,a,h,u);break;default:console.error("Unsupported image format: '"+l+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'jpeg'"),p=gt.saveAsJPEG(r,!0,a,h,u)}return p.src}_getImageDataCache(){const t=this.buffer.width,e=this.buffer.height;let s=this._imageDataCache;if(s&&(s.width===t&&s.height===e||(this._imageDataCache=null,s=null)),!s){const i=document.createElement("canvas");i.width=t,i.height=e;const r=i.getContext("2d"),o=r.createImageData(t,e);s={pixelData:new Uint8Array(t*e*4),canvas:i,context:r,imageData:o,width:t,height:e},this._imageDataCache=s}return s}unbind(){const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),this.bound=!1}getTexture(){const t=this;return this._texture||(this._texture={renderBuffer:this,bind:function(e){return!(!t.buffer||!t.buffer.texture)&&(t.gl.activeTexture(t.gl["TEXTURE"+e]),t.gl.bindTexture(t.gl.TEXTURE_2D,t.buffer.texture),!0)},unbind:function(e){t.buffer&&t.buffer.texture&&(t.gl.activeTexture(t.gl["TEXTURE"+e]),t.gl.bindTexture(t.gl.TEXTURE_2D,null))}})}hasDepthTexture(){return this._hasDepthTexture}getDepthTexture(){if(!this._hasDepthTexture)return null;const t=this;return this._depthTexture||(this._dethTexture={renderBuffer:this,bind:function(e){return!(!t.buffer||!t.buffer.depthTexture)&&(t.gl.activeTexture(t.gl["TEXTURE"+e]),t.gl.bindTexture(t.gl.TEXTURE_2D,t.buffer.depthTexture),!0)},unbind:function(e){t.buffer&&t.buffer.depthTexture&&(t.gl.activeTexture(t.gl["TEXTURE"+e]),t.gl.bindTexture(t.gl.TEXTURE_2D,null))}})}destroy(){if(this.allocated){const t=this.gl;t.deleteTexture(this.buffer.texture),t.deleteTexture(this.buffer.depthTexture),t.deleteFramebuffer(this.buffer.framebuf),t.deleteRenderbuffer(this.buffer.renderbuf),this.allocated=!1,this.buffer=null,this.bound=!1}this._imageDataCache=null,this._texture=null,this._depthTexture=null}}class yt{constructor(){this.entity=null,this.primitive=null,this.primIndex=-1,this.pickSurfacePrecision=!1,this._canvasPos=new Int16Array([0,0]),this._origin=new Float64Array([0,0,0]),this._direction=new Float64Array([0,0,0]),this._indices=new Int32Array(3),this._localPos=new Float64Array([0,0,0]),this._worldPos=new Float64Array([0,0,0]),this._viewPos=new Float64Array([0,0,0]),this._bary=new Float64Array([0,0,0]),this._worldNormal=new Float64Array([0,0,0]),this._uv=new Float64Array([0,0]),this.reset()}get canvasPos(){return this._gotCanvasPos?this._canvasPos:null}set canvasPos(t){t?(this._canvasPos[0]=t[0],this._canvasPos[1]=t[1],this._gotCanvasPos=!0):this._gotCanvasPos=!1}get origin(){return this._gotOrigin?this._origin:null}set origin(t){t?(this._origin[0]=t[0],this._origin[1]=t[1],this._origin[2]=t[2],this._gotOrigin=!0):this._gotOrigin=!1}get direction(){return this._gotDirection?this._direction:null}set direction(t){t?(this._direction[0]=t[0],this._direction[1]=t[1],this._direction[2]=t[2],this._gotDirection=!0):this._gotDirection=!1}get indices(){return this.entity&&this._gotIndices?this._indices:null}set indices(t){t?(this._indices[0]=t[0],this._indices[1]=t[1],this._indices[2]=t[2],this._gotIndices=!0):this._gotIndices=!1}get localPos(){return this.entity&&this._gotLocalPos?this._localPos:null}set localPos(t){t?(this._localPos[0]=t[0],this._localPos[1]=t[1],this._localPos[2]=t[2],this._gotLocalPos=!0):this._gotLocalPos=!1}get worldPos(){return this.entity&&this._gotWorldPos?this._worldPos:null}set worldPos(t){t?(this._worldPos[0]=t[0],this._worldPos[1]=t[1],this._worldPos[2]=t[2],this._gotWorldPos=!0):this._gotWorldPos=!1}get viewPos(){return this.entity&&this._gotViewPos?this._viewPos:null}set viewPos(t){t?(this._viewPos[0]=t[0],this._viewPos[1]=t[1],this._viewPos[2]=t[2],this._gotViewPos=!0):this._gotViewPos=!1}get bary(){return this.entity&&this._gotBary?this._bary:null}set bary(t){t?(this._bary[0]=t[0],this._bary[1]=t[1],this._bary[2]=t[2],this._gotBary=!0):this._gotBary=!1}get worldNormal(){return this.entity&&this._gotWorldNormal?this._worldNormal:null}set worldNormal(t){t?(this._worldNormal[0]=t[0],this._worldNormal[1]=t[1],this._worldNormal[2]=t[2],this._gotWorldNormal=!0):this._gotWorldNormal=!1}get uv(){return this.entity&&this._gotUV?this._uv:null}set uv(t){t?(this._uv[0]=t[0],this._uv[1]=t[1],this._gotUV=!0):this._gotUV=!1}reset(){this.entity=null,this.primIndex=-1,this.primitive=null,this.pickSurfacePrecision=!1,this._gotCanvasPos=!1,this._gotOrigin=!1,this._gotDirection=!1,this._gotIndices=!1,this._gotLocalPos=!1,this._gotWorldPos=!1,this._gotViewPos=!1,this._gotBary=!1,this._gotWorldNormal=!1,this._gotUV=!1}}class vt{constructor(t,e,s){if(this.allocated=!1,this.compiled=!1,this.handle=t.createShader(e),this.handle){if(this.allocated=!0,t.shaderSource(this.handle,s),t.compileShader(this.handle),this.compiled=t.getShaderParameter(this.handle,t.COMPILE_STATUS),!this.compiled&&!t.isContextLost()){const e=s.split("\n"),i=[];for(let t=0;t<e.length;t++)i.push(t+1+": "+e[t]+"\n");this.errors=[],this.errors.push(""),this.errors.push(t.getShaderInfoLog(this.handle)),this.errors=this.errors.concat(i.join(""))}}else this.errors=["Failed to allocate"]}destroy(){}}class bt{constructor(t,e){this.bindTexture=function(s,i){return!!s.bind(i)&&(t.uniform1i(e,i),!0)}}}class Pt{constructor(t,e){this._gl=t,this.location=e}bindArrayBuffer(t){t&&(t.bind(),this._gl.enableVertexAttribArray(this.location),this._gl.vertexAttribPointer(this.location,t.itemSize,t.itemType,t.normalized,t.stride,t.offset))}}const Tt=new t({});function wt(t){const e=[];let s,i;for(let r=0,o=t.length;r<o;r++)s=t[r],i=s.indexOf("/"),i>0&&"/"===s.charAt(i+1)&&(s=s.substring(0,i)),e.push(s);return e.join("\n")}function xt(t){console.error(t.join("\n"))}class Mt{constructor(t,e){this.id=Tt.addItem({}),this.source=e,this.init(t)}init(t){if(this.gl=t,this.allocated=!1,this.compiled=!1,this.linked=!1,this.validated=!1,this.errors=null,this.uniforms={},this.samplers={},this.attributes={},this._vertexShader=new vt(t,t.VERTEX_SHADER,wt(this.source.vertex)),this._fragmentShader=new vt(t,t.FRAGMENT_SHADER,wt(this.source.fragment)),!this._vertexShader.allocated)return this.errors=["Vertex shader failed to allocate"].concat(this._vertexShader.errors),void xt(this.errors);if(!this._fragmentShader.allocated)return this.errors=["Fragment shader failed to allocate"].concat(this._fragmentShader.errors),void xt(this.errors);if(this.allocated=!0,!this._vertexShader.compiled)return this.errors=["Vertex shader failed to compile"].concat(this._vertexShader.errors),void xt(this.errors);if(!this._fragmentShader.compiled)return this.errors=["Fragment shader failed to compile"].concat(this._fragmentShader.errors),void xt(this.errors);let e,s,i,r,o;if(this.compiled=!0,this.handle=t.createProgram(),!this.handle)return void(this.errors=["Failed to allocate program"]);if(t.attachShader(this.handle,this._vertexShader.handle),t.attachShader(this.handle,this._fragmentShader.handle),t.linkProgram(this.handle),this.linked=t.getProgramParameter(this.handle,t.LINK_STATUS),this.validated=!0,!this.linked||!this.validated)return this.errors=[],this.errors.push(""),this.errors.push(t.getProgramInfoLog(this.handle)),this.errors.push("\nVertex shader:\n"),this.errors=this.errors.concat(this.source.vertex),this.errors.push("\nFragment shader:\n"),this.errors=this.errors.concat(this.source.fragment),void xt(this.errors);const n=t.getProgramParameter(this.handle,t.ACTIVE_UNIFORMS);for(s=0;s<n;++s)i=t.getActiveUniform(this.handle,s),i&&(r=i.name,"\0"===r[r.length-1]&&(r=r.substr(0,r.length-1)),o=t.getUniformLocation(this.handle,r),i.type===t.SAMPLER_2D||i.type===t.SAMPLER_CUBE||35682===i.type?this.samplers[r]=new bt(t,o):this.uniforms[r]=o);const a=t.getProgramParameter(this.handle,t.ACTIVE_ATTRIBUTES);for(s=0;s<a;s++)e=t.getActiveAttrib(this.handle,s),e&&(o=t.getAttribLocation(this.handle,e.name),this.attributes[e.name]=new Pt(t,o));this.allocated=!0}bind(){this.allocated&&this.gl.useProgram(this.handle)}getLocation(t){if(this.allocated)return this.uniforms[t]}getAttribute(t){if(this.allocated)return this.attributes[t]}bindTexture(t,e,s){if(!this.allocated)return!1;const i=this.samplers[t];return!!i&&i.bindTexture(e,s)}destroy(){this.allocated&&(Tt.removeItem(this.id),this.gl.deleteProgram(this.handle),this.gl.deleteShader(this._vertexShader.handle),this.gl.deleteShader(this._fragmentShader.handle),this.handle=null,this.attributes=null,this.uniforms=null,this.samplers=null,this.allocated=!1)}}class Dt{constructor(t,e,s,i,r,o,n,a,h){switch(this._gl=t,this.type=e,this.allocated=!1,s.constructor){case Uint8Array:this.itemType=t.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=t.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=t.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=t.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=t.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=t.INT,this.itemByteSize=4;break;default:this.itemType=t.FLOAT,this.itemByteSize=4}this.usage=o,this.length=0,this.dataLength=i,this.numItems=0,this.itemSize=r,this.normalized=!!n,this.stride=a||0,this.offset=h||0,this._allocate(s)}_allocate(t){if(this.allocated=!1,this._handle=this._gl.createBuffer(),!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,this._handle),this._gl.bufferData(this.type,t.length>this.dataLength?t.slice(0,this.dataLength):t,this.usage),this._gl.bindBuffer(this.type,null),this.length=t.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}setData(t,e){this.allocated&&(t.length+(e||0)>this.length?(this.destroy(),this._allocate(t)):(this._gl.bindBuffer(this.type,this._handle),e||0===e?this._gl.bufferSubData(this.type,e*this.itemByteSize,t):this._gl.bufferData(this.type,t,this.usage),this._gl.bindBuffer(this.type,null)))}bind(){this.allocated&&this._gl.bindBuffer(this.type,this._handle)}unbind(){this.allocated&&this._gl.bindBuffer(this.type,null)}destroy(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}class Et{constructor(t,e){this.scene=t,this.aabb=c.AABB3(),this.origin=c.vec3(e),this.originHash=this.origin.join(),this.numMarkers=0,this.markers={},this.markerList=[],this.markerIndices={},this.positions=[],this.indices=[],this.positionsBuf=null,this.lenPositionsBuf=0,this.indicesBuf=null,this.sectionPlanesActive=[],this.culledBySectionPlanes=!1,this.occlusionTestList=[],this.lenOcclusionTestList=0,this.pixels=[],this.aabbDirty=!1,this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!1}addMarker(t){this.markers[t.id]=t,this.markerListDirty=!0,this.numMarkers++}markerWorldPosUpdated(t){if(!this.markers[t.id])return;const e=this.markerIndices[t.id];this.positions[3*e+0]=t.worldPos[0],this.positions[3*e+1]=t.worldPos[1],this.positions[3*e+2]=t.worldPos[2],this.positionsDirty=!0}removeMarker(t){delete this.markers[t.id],this.markerListDirty=!0,this.numMarkers--}update(){this.markerListDirty&&(this._buildMarkerList(),this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!0),this.positionsDirty&&(this._buildPositions(),this.positionsDirty=!1,this.aabbDirty=!0,this.vbosDirty=!0),this.aabbDirty&&(this._buildAABB(),this.aabbDirty=!1),this.vbosDirty&&(this._buildVBOs(),this.vbosDirty=!1),this.occlusionTestListDirty&&this._buildOcclusionTestList(),this._updateActiveSectionPlanes()}_buildMarkerList(){for(var t in this.numMarkers=0,this.markers)this.markers.hasOwnProperty(t)&&(this.markerList[this.numMarkers]=this.markers[t],this.markerIndices[t]=this.numMarkers,this.numMarkers++);this.markerList.length=this.numMarkers}_buildPositions(){let t=0;for(let e=0;e<this.numMarkers;e++)if(this.markerList[e]){const s=this.markerList[e].worldPos;this.positions[t++]=s[0],this.positions[t++]=s[1],this.positions[t++]=s[2],this.indices[e]=e}this.positions.length=3*this.numMarkers,this.indices.length=this.numMarkers}_buildAABB(){const t=this.aabb;c.collapseAABB3(t),c.expandAABB3Points3(t,this.positions);const e=this.origin;t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[0],t[4]+=e[1],t[5]+=e[2]}_buildVBOs(){if(this.positionsBuf){if(this.lenPositionsBuf===this.positions.length)return void this.positionsBuf.setData(this.positions);this.positionsBuf.destroy(),this.positionsBuf=null,this.indicesBuf.destroy(),this.indicesBuf=null}const t=this.scene.canvas.gl,e=3*this.numMarkers,s=this.numMarkers;this.positionsBuf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this.positions),e,3,t.STATIC_DRAW),this.indicesBuf=new Dt(t,t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),s,1,t.STATIC_DRAW),this.lenPositionsBuf=this.positions.length}_buildOcclusionTestList(){const t=this.scene.canvas,e=this.scene.camera.perspective.near,s=t.boundary,i=s[2],r=s[3];let o=0;this.lenOcclusionTestList=0;for(let t=0;t<this.numMarkers;t++){const s=this.markerList[t];if(s.viewPos[2]>-e){s._setVisible(!1);continue}const n=s.canvasPos,a=n[0],h=n[1];a+10<0||h+10<0||a-10>i||h-10>r?s._setVisible(!1):!s.entity||s.entity.visible?s.occludable?(this.occlusionTestList[this.lenOcclusionTestList++]=s,this.pixels[o++]=a,this.pixels[o++]=h):s._setVisible(!0):s._setVisible(!1)}}_updateActiveSectionPlanes(){const t=this.scene._sectionPlanesState.sectionPlanes,e=t.length;if(e>0)for(let s=0;s<e;s++){const e=t[s];if(e.active){const t=c.planeAABB3Intersect(e.dir,e.dist,this.aabb);if(-1===t)return void(this.culledBySectionPlanes=!0);const i=0===t;this.sectionPlanesActive[s]=i}else this.sectionPlanesActive[s]=!1}this.culledBySectionPlanes=!1}destroy(){this.markers={},this.markerList.length=0,this.positionsBuf&&this.positionsBuf.destroy(),this.indicesBuf&&this.indicesBuf.destroy()}}const It=c.vec3([1,0,0]),St=c.vec3();class At{constructor(t){this._scene=t,this._occlusionLayers={},this._occlusionLayersList=[],this._occlusionLayersListDirty=!1,this._shaderSource=null,this._program=null,this._shaderSourceHash=null,this._shaderSourceDirty=!0,this._programDirty=!1,this._markersToOcclusionLayersMap={},this._onCameraViewMatrix=t.camera.on("viewMatrix",(()=>{this._occlusionTestListDirty=!0})),this._onCameraProjMatrix=t.camera.on("projMatrix",(()=>{this._occlusionTestListDirty=!0})),this._onCanvasBoundary=t.canvas.on("boundary",(()=>{this._occlusionTestListDirty=!0}))}addMarker(t){const e=t.origin.join();let s=this._occlusionLayers[e];s||(s=new Et(this._scene,t.origin),this._occlusionLayers[s.originHash]=s,this._occlusionLayersListDirty=!0),s.addMarker(t),this._markersToOcclusionLayersMap[t.id]=s,this._occlusionTestListDirty=!0}markerWorldPosUpdated(t){const e=this._markersToOcclusionLayersMap[t.id];if(!e)return void t.error("Marker has not been added to OcclusionTester");const s=t.origin.join();if(s!==e.originHash){1===e.numMarkers?(e.destroy(),delete this._occlusionLayers[e.originHash],this._occlusionLayersListDirty=!0):e.removeMarker(t);let i=this._occlusionLayers[s];i||(i=new Et(this._scene,t.origin),this._occlusionLayers[s]=e,this._occlusionLayersListDirty=!0),i.addMarker(t),this._markersToOcclusionLayersMap[t.id]=i}else e.markerWorldPosUpdated(t)}removeMarker(t){const e=t.origin.join();let s=this._occlusionLayers[e];s&&(1===s.numMarkers?(s.destroy(),delete this._occlusionLayers[s.originHash],this._occlusionLayersListDirty=!0):s.removeMarker(t),delete this._markersToOcclusionLayersMap[t.id])}get needOcclusionTest(){return this._occlusionTestListDirty}bindRenderBuf(){const t=[this._scene.canvas.canvas.id,this._scene._sectionPlanesState.getHash()].join(";");if(t!==this._shaderSourceHash&&(this._shaderSourceHash=t,this._shaderSourceDirty=!0),this._shaderSourceDirty&&(this._buildShaderSource(),this._shaderSourceDirty=!1,this._programDirty=!0),this._programDirty&&(this._buildProgram(),this._programDirty=!1,this._occlusionTestListDirty=!0),this._occlusionLayersListDirty&&(this._buildOcclusionLayersList(),this._occlusionLayersListDirty=!1),this._occlusionTestListDirty){for(let t=0,e=this._occlusionLayersList.length;t<e;t++){this._occlusionLayersList[t].occlusionTestListDirty=!0}this._occlusionTestListDirty=!1}this._readPixelBuf=this._readPixelBuf||(this._readPixelBuf=new _t(this._scene.canvas.canvas,this._scene.canvas.gl)),this._readPixelBuf.bind(),this._readPixelBuf.clear()}_buildOcclusionLayersList(){let t=0;for(let e in this._occlusionLayers)this._occlusionLayers.hasOwnProperty(e)&&(this._occlusionLayersList[t++]=this._occlusionLayers[e]);this._occlusionLayersList.length=t}_buildShaderSource(){this._shaderSource={vertex:this._buildVertexShaderSource(),fragment:this._buildFragmentShaderSource()}}_buildVertexShaderSource(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// OcclusionTester vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("attribute vec3 position;"),s.push("uniform mat4 modelMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),e&&s.push("varying vec4 vWorldPosition;"),s.push("void main(void) {"),s.push("vec4 worldPosition = vec4(position, 1.0); "),s.push("   vec4 viewPosition = viewMatrix * worldPosition;"),e&&s.push("   vWorldPosition = worldPosition;"),s.push("   vec4 clipPos = projMatrix * viewPosition;"),s.push("   gl_Position = clipPos;"),s.push("   gl_PointSize = 20.0;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("}"),s}_buildFragmentShaderSource(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// OcclusionTester fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("void main(void) {"),s){i.push("  float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("if (sectionPlaneActive"+r+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); "),i.push("}"),i}_buildProgram(){this._program&&this._program.destroy();const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}drawMarkers(){const t=this._scene,e=t.canvas.gl,s=this._program,i=t._sectionPlanesState,r=t.camera,o=t.camera.project;if(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&t.logarithmicDepthBufferEnabled&&e.getExtension("EXT_frag_depth"),s.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,r._project._state.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}for(let t=0,s=this._occlusionLayersList.length;t<s;t++){const s=this._occlusionLayersList[t];if(s.update(),s.culledBySectionPlanes)continue;const o=s.origin;e.uniformMatrix4fv(this._uViewMatrix,!1,U(r.viewMatrix,o));const n=i.sectionPlanes.length;if(n>0){const t=i.sectionPlanes;for(let i=0;i<n;i++){const r=this._uSectionPlanes[i];if(r){const n=s.sectionPlanesActive[i];if(e.uniform1i(r.active,n?1:0),n){const s=t[i];e.uniform3fv(r.pos,Y(s.dist,s.dir,o,St)),e.uniform3fv(r.dir,s.dir)}}}}this._aPosition.bindArrayBuffer(s.positionsBuf);const a=s.indicesBuf;a.bind(),e.drawElements(e.POINTS,a.numItems,a.itemType,0)}}doOcclusionTest(){{const t=255*It[0],e=255*It[1],s=255*It[2];for(let i=0,r=this._occlusionLayersList.length;i<r;i++){const r=this._occlusionLayersList[i];for(let i=0;i<r.lenOcclusionTestList;i++){const o=r.occlusionTestList[i],n=2*i,a=this._readPixelBuf.read(r.pixels[n],r.pixels[n+1]),h=a[0]===t&&a[1]===e&&a[2]===s;o._setVisible(h)}}}}unbindRenderBuf(){this._readPixelBuf.unbind()}destroy(){if(!this.destroyed){for(let t=0,e=this._occlusionLayersList.length;t<e;t++){this._occlusionLayersList[t].destroy()}this._program&&this._program.destroy(),this._scene.camera.off(this._onCameraViewMatrix),this._scene.camera.off(this._onCameraProjMatrix),this._scene.canvas.off(this._onCanvasBoundary),this.destroyed=!0}}}const Ct=c.vec2();class Ft{constructor(t){this._scene=t,this._numSamples=null,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uScale=null,this._uIntensity=null,this._uBias=null,this._uKernelRadius=null,this._uMinResolution=null,this._uRandomSeed=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null}render(t){if(this._build(),this._programError)return;this._getInverseProjectMat||(this._getInverseProjectMat=(()=>{let t=!0;this._scene.camera.on("projMatrix",(function(){t=!0}));const e=c.mat4();return()=>(t&&c.inverseMat4(i.camera.projMatrix,e),e)})());const e=this._scene.canvas.gl,s=this._program,i=this._scene,r=i.sao,o=e.drawingBufferWidth,n=e.drawingBufferHeight,a=i.camera.project._state,h=a.near,l=a.far,u=a.matrix,p=this._getInverseProjectMat(),d=Math.random(),m="perspective"===i.camera.projection;Ct[0]=o,Ct[1]=n,e.getExtension("OES_standard_derivatives"),e.viewport(0,0,o,n),e.clearColor(0,0,0,1),e.disable(e.DEPTH_TEST),e.disable(e.BLEND),e.frontFace(e.CCW),e.clear(e.COLOR_BUFFER_BIT),s.bind(),e.uniform1f(this._uCameraNear,h),e.uniform1f(this._uCameraFar,l),e.uniformMatrix4fv(this._uCameraProjectionMatrix,!1,u),e.uniformMatrix4fv(this._uCameraInverseProjectionMatrix,!1,p),e.uniform1i(this._uPerspective,m),e.uniform1f(this._uScale,r.scale*(l/5)),e.uniform1f(this._uIntensity,r.intensity),e.uniform1f(this._uBias,r.bias),e.uniform1f(this._uKernelRadius,r.kernelRadius),e.uniform1f(this._uMinResolution,r.minResolution),e.uniform2fv(this._uViewport,Ct),e.uniform1f(this._uRandomSeed,d);const f=pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?t.getDepthTexture():t.getTexture();s.bindTexture(this._uDepthTexture,f,0),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),e.drawElements(e.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}_build(){let t=!1;const e=this._scene.sao;if(e.numSamples!==this._numSamples&&(this._numSamples=Math.floor(e.numSamples),t=!0),!t)return;const s=this._scene.canvas.gl;if(this._program&&(this._program.destroy(),this._program=null),this._program=new Mt(s,{vertex:["precision highp float;\n                    precision highp int;\n                    \n                    attribute vec3 aPosition;\n                    attribute vec2 aUV;            \n                    \n                    varying vec2 vUV;\n                    \n                    void main () {\n                        gl_Position = vec4(aPosition, 1.0);\n                        vUV = aUV;\n                    }"],fragment:[`#extension GL_OES_standard_derivatives : require              \n                precision highp float;\n                precision highp int;           \n                \n                #define NORMAL_TEXTURE 0\n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n                #define NUM_SAMPLES ${this._numSamples}\n                #define NUM_RINGS 4              \n            \n                varying vec2        vUV;\n            \n                uniform sampler2D   uDepthTexture;\n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;\n                uniform mat4        uProjectMatrix;\n                uniform mat4        uInverseProjectMatrix;\n                \n                uniform bool        uPerspective;\n\n                uniform float       uScale;\n                uniform float       uIntensity;\n                uniform float       uBias;\n                uniform float       uKernelRadius;\n                uniform float       uMinResolution;\n                uniform vec2        uViewport;\n                uniform float       uRandomSeed;\n\n                float pow2( const in float x ) { return x*x; }\n                \n                highp float rand( const in vec2 uv ) {\n                    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n                    highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n                    return fract(sin(sn) * c);\n                }\n\n                vec3 packNormalToRGB( const in vec3 normal ) {\n                    return normalize( normal ) * 0.5 + 0.5;\n                }\n\n                vec3 unpackRGBToNormal( const in vec3 rgb ) {\n                    return 2.0 * rgb.xyz - 1.0;\n                }\n\n                const float packUpscale = 256. / 255.;\n                const float unpackDownScale = 255. / 256.; \n\n                const vec3 packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4 unPackFactors = unpackDownScale / vec4( packFactors, 1. );   \n\n                const float shiftRights = 1. / 256.;\n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float unpackRGBAToFloat( const in vec4 v ) {                   \n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unPackFactors );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n                    return ( near * far ) / ( ( far - near ) * invClipZ - far );\n                }\n\n                float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n                    return linearClipZ * ( near - far ) - near;\n                }\n                \n                float getDepth( const in vec2 screenPosition ) {`+(pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?"return texture2D(uDepthTexture, screenPosition).r;":"return unpackRGBAToFloat(texture2D( uDepthTexture, screenPosition));")+"}\n\n                float getViewZ( const in float depth ) {\n                     if (uPerspective) {\n                         return perspectiveDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     } else {\n                        return orthographicDepthToViewZ( depth, uCameraNear, uCameraFar );\n                     }\n                }\n\n                vec3 getViewPos( const in vec2 screenPos, const in float depth, const in float viewZ ) {\n                \tfloat clipW = uProjectMatrix[2][3] * viewZ + uProjectMatrix[3][3];\n                \tvec4 clipPosition = vec4( ( vec3( screenPos, depth ) - 0.5 ) * 2.0, 1.0 );\n                \tclipPosition *= clipW; \n                \treturn ( uInverseProjectMatrix * clipPosition ).xyz;\n                }\n\n                vec3 getViewNormal( const in vec3 viewPosition, const in vec2 screenPos ) {               \n                    return normalize( cross( dFdx( viewPosition ), dFdy( viewPosition ) ) );\n                }\n\n                float scaleDividedByCameraFar;\n                float minResolutionMultipliedByCameraFar;\n\n                float getOcclusion( const in vec3 centerViewPosition, const in vec3 centerViewNormal, const in vec3 sampleViewPosition ) {\n                \tvec3 viewDelta = sampleViewPosition - centerViewPosition;\n                \tfloat viewDistance = length( viewDelta );\n                \tfloat scaledScreenDistance = scaleDividedByCameraFar * viewDistance;\n                \treturn max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - uBias) / (1.0 + pow2( scaledScreenDistance ) );\n                }\n\n                const float ANGLE_STEP = PI2 * float( NUM_RINGS ) / float( NUM_SAMPLES );\n                const float INV_NUM_SAMPLES = 1.0 / float( NUM_SAMPLES );\n\n                float getAmbientOcclusion( const in vec3 centerViewPosition ) {\n            \n                \tscaleDividedByCameraFar = uScale / uCameraFar;\n                \tminResolutionMultipliedByCameraFar = uMinResolution * uCameraFar;\n                \tvec3 centerViewNormal = getViewNormal( centerViewPosition, vUV );\n\n                \tfloat angle = rand( vUV + uRandomSeed ) * PI2;\n                \tvec2 radius = vec2( uKernelRadius * INV_NUM_SAMPLES ) / uViewport;\n                \tvec2 radiusStep = radius;\n\n                \tfloat occlusionSum = 0.0;\n                \tfloat weightSum = 0.0;\n\n                \tfor( int i = 0; i < NUM_SAMPLES; i ++ ) {\n                \t\tvec2 sampleUv = vUV + vec2( cos( angle ), sin( angle ) ) * radius;\n                \t\tradius += radiusStep;\n                \t\tangle += ANGLE_STEP;\n\n                \t\tfloat sampleDepth = getDepth( sampleUv );\n                \t\tif( sampleDepth >= ( 1.0 - EPSILON ) ) {\n                \t\t\tcontinue;\n                \t\t}\n\n                \t\tfloat sampleViewZ = getViewZ( sampleDepth );\n                \t\tvec3 sampleViewPosition = getViewPos( sampleUv, sampleDepth, sampleViewZ );\n                \t\tocclusionSum += getOcclusion( centerViewPosition, centerViewNormal, sampleViewPosition );\n                \t\tweightSum += 1.0;\n                \t}\n\n                \tif( weightSum == 0.0 ) discard;\n\n                \treturn occlusionSum * ( uIntensity / weightSum );\n                }\n\n                void main() {\n                \n                \tfloat centerDepth = getDepth( vUV );\n                \t\n                \tif( centerDepth >= ( 1.0 - EPSILON ) ) {\n                \t\tdiscard;\n                \t}\n\n                \tfloat centerViewZ = getViewZ( centerDepth );\n                \tvec3 viewPosition = getViewPos( vUV, centerDepth, centerViewZ );\n\n                \tfloat ambientOcclusion = getAmbientOcclusion( viewPosition );\n                \n                \tgl_FragColor = packFloatToRGBA(  1.0- ambientOcclusion );\n                }"]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);const i=new Float32Array([1,1,0,1,0,0,1,0]),r=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),o=new Uint8Array([0,1,2,0,2,3]);this._positionsBuf=new Dt(s,s.ARRAY_BUFFER,r,r.length,3,s.STATIC_DRAW),this._uvBuf=new Dt(s,s.ARRAY_BUFFER,i,i.length,2,s.STATIC_DRAW),this._indicesBuf=new Dt(s,s.ELEMENT_ARRAY_BUFFER,o,o.length,1,s.STATIC_DRAW),this._program.bind(),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uCameraProjectionMatrix=this._program.getLocation("uProjectMatrix"),this._uCameraInverseProjectionMatrix=this._program.getLocation("uInverseProjectMatrix"),this._uPerspective=this._program.getLocation("uPerspective"),this._uScale=this._program.getLocation("uScale"),this._uIntensity=this._program.getLocation("uIntensity"),this._uBias=this._program.getLocation("uBias"),this._uKernelRadius=this._program.getLocation("uKernelRadius"),this._uMinResolution=this._program.getLocation("uMinResolution"),this._uViewport=this._program.getLocation("uViewport"),this._uRandomSeed=this._program.getLocation("uRandomSeed"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV"),this._dirty=!1}destroy(){this._program&&(this._program.destroy(),this._program=null)}}const Ot=new Float32Array(jt(17,[0,1])),Rt=new Float32Array(jt(17,[1,0])),Lt=new Float32Array(function(t,e){const s=[];for(let i=0;i<=t;i++)s.push(kt(i,e));return s}(17,4)),Nt=new Float32Array(2);class Bt{constructor(t){this._scene=t,this._program=null,this._programError=!1,this._aPosition=null,this._aUV=null,this._uDepthTexture="uDepthTexture",this._uOcclusionTexture="uOcclusionTexture",this._uViewport=null,this._uCameraNear=null,this._uCameraFar=null,this._uCameraProjectionMatrix=null,this._uCameraInverseProjectionMatrix=null,this._uScale=null,this._uIntensity=null,this._uBias=null,this._uKernelRadius=null,this._uMinResolution=null,this._uvBuf=null,this._positionsBuf=null,this._indicesBuf=null,this.init()}init(){const t=this._scene.canvas.gl;if(this._program=new Mt(t,{vertex:["precision highp float;\n                precision highp int;\n                    \n                attribute vec3 aPosition;\n                attribute vec2 aUV;\n                uniform vec2 uViewport;\n                varying vec2 vUV;\n                varying vec2 vInvSize;\n                void main () {\n                    vUV = aUV;\n                    vInvSize = 1.0 / uViewport;\n                    gl_Position = vec4(aPosition, 1.0);\n                }"],fragment:["precision highp float;\n                precision highp int;\n                    \n                #define PI 3.14159265359\n                #define PI2 6.28318530718\n                #define EPSILON 1e-6\n\n                #define KERNEL_RADIUS 16\n\n                varying vec2        vUV;\n                varying vec2        vInvSize;\n            \n                uniform sampler2D   uDepthTexture;\n                uniform sampler2D   uOcclusionTexture;              \n               \n                uniform float       uCameraNear;\n                uniform float       uCameraFar;               \n                uniform float       uDepthCutoff;\n\n                uniform vec2        uSampleOffsets[ KERNEL_RADIUS + 1 ];\n                uniform float       uSampleWeights[ KERNEL_RADIUS + 1 ];\n\n                const float         unpackDownscale = 255. / 256.; \n\n                const vec3          packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\n                const vec4          unpackFactors = unpackDownscale / vec4( packFactors, 1. );   \n\n                const float packUpscale = 256. / 255.;\n       \n                const float shiftRights = 1. / 256.;\n                \n                float unpackRGBAToFloat( const in vec4 v ) {\n                    return dot( floor( v * 255.0 + 0.5 ) / 255.0, unpackFactors );\n                }               \n\n                vec4 packFloatToRGBA( const in float v ) {\n                    vec4 r = vec4( fract( v * packFactors ), v );\n                    r.yzw -= r.xyz * shiftRights; \n                    return r * packUpscale;\n                }\n\n                float viewZToOrthographicDepth( const in float viewZ) {\n                    return ( viewZ + uCameraNear ) / ( uCameraNear - uCameraFar );\n                }\n              \n                float orthographicDepthToViewZ( const in float linearClipZ) {\n                    return linearClipZ * ( uCameraNear - uCameraFar ) - uCameraNear;\n                }\n\n                float viewZToPerspectiveDepth( const in float viewZ) {\n                    return (( uCameraNear + viewZ ) * uCameraFar ) / (( uCameraFar - uCameraNear ) * viewZ );\n                }\n                \n                float perspectiveDepthToViewZ( const in float invClipZ) {\n                    return ( uCameraNear * uCameraFar ) / ( ( uCameraFar - uCameraNear ) * invClipZ - uCameraFar );\n                }\n\n                float getDepth( const in vec2 screenPosition ) {"+(pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?"return texture2D(uDepthTexture, screenPosition).r;":"return unpackRGBAToFloat(texture2D( uDepthTexture, screenPosition));")+"}\n\n                float getViewZ( const in float depth ) {\n                     return perspectiveDepthToViewZ( depth );\n                }\n\n                void main() {\n                \n                    float depth = getDepth( vUV );\n                    if( depth >= ( 1.0 - EPSILON ) ) {\n                        discard;\n                    }\n\n                    float centerViewZ = -getViewZ( depth );\n                    bool rBreak = false;\n                    bool lBreak = false;\n\n                    float weightSum = uSampleWeights[0];\n                    float occlusionSum = unpackRGBAToFloat(texture2D( uOcclusionTexture, vUV )) * weightSum;\n\n                    for( int i = 1; i <= KERNEL_RADIUS; i ++ ) {\n\n                        float sampleWeight = uSampleWeights[i];\n                        vec2 sampleUVOffset = uSampleOffsets[i] * vInvSize;\n\n                        vec2 sampleUV = vUV + sampleUVOffset;\n                        float viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            rBreak = true;\n                        }\n\n                        if( ! rBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture2D( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n\n                        sampleUV = vUV - sampleUVOffset;\n                        viewZ = -getViewZ( getDepth( sampleUV ) );\n\n                        if( abs( viewZ - centerViewZ ) > uDepthCutoff ) {\n                            lBreak = true;\n                        }\n\n                        if( ! lBreak ) {\n                            occlusionSum += unpackRGBAToFloat(texture2D( uOcclusionTexture, sampleUV )) * sampleWeight;\n                            weightSum += sampleWeight;\n                        }\n                    }\n\n                    gl_FragColor = packFloatToRGBA(occlusionSum / weightSum);\n                }"]}),this._program.errors)return console.error(this._program.errors.join("\n")),void(this._programError=!0);const e=new Float32Array([1,1,0,1,0,0,1,0]),s=new Float32Array([1,1,0,-1,1,0,-1,-1,0,1,-1,0]),i=new Uint8Array([0,1,2,0,2,3]);this._positionsBuf=new Dt(t,t.ARRAY_BUFFER,s,s.length,3,t.STATIC_DRAW),this._uvBuf=new Dt(t,t.ARRAY_BUFFER,e,e.length,2,t.STATIC_DRAW),this._indicesBuf=new Dt(t,t.ELEMENT_ARRAY_BUFFER,i,i.length,1,t.STATIC_DRAW),this._program.bind(),this._uViewport=this._program.getLocation("uViewport"),this._uCameraNear=this._program.getLocation("uCameraNear"),this._uCameraFar=this._program.getLocation("uCameraFar"),this._uDepthCutoff=this._program.getLocation("uDepthCutoff"),this._uSampleOffsets=t.getUniformLocation(this._program.handle,"uSampleOffsets"),this._uSampleWeights=t.getUniformLocation(this._program.handle,"uSampleWeights"),this._aPosition=this._program.getAttribute("aPosition"),this._aUV=this._program.getAttribute("aUV")}render(t,e,s){if(this._programError)return;this._getInverseProjectMat||(this._getInverseProjectMat=(()=>{let t=!0;this._scene.camera.on("projMatrix",(function(){t=!0}));const e=c.mat4();return()=>(t&&c.inverseMat4(o.camera.projMatrix,e),e)})());const i=this._scene.canvas.gl,r=this._program,o=this._scene,n=i.drawingBufferWidth,a=i.drawingBufferHeight,h=o.camera.project._state,l=h.near,u=h.far;i.viewport(0,0,n,a),i.clearColor(0,0,0,1),i.enable(i.DEPTH_TEST),i.disable(i.BLEND),i.frontFace(i.CCW),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),r.bind(),Nt[0]=n,Nt[1]=a,i.uniform2fv(this._uViewport,Nt),i.uniform1f(this._uCameraNear,l),i.uniform1f(this._uCameraFar,u),i.uniform1f(this._uDepthCutoff,.01),0===s?i.uniform2fv(this._uSampleOffsets,Rt):i.uniform2fv(this._uSampleOffsets,Ot),i.uniform1fv(this._uSampleWeights,Lt);const p=pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?t.getDepthTexture():t.getTexture(),d=e.getTexture();r.bindTexture(this._uDepthTexture,p,0),r.bindTexture(this._uOcclusionTexture,d,1),this._aUV.bindArrayBuffer(this._uvBuf),this._aPosition.bindArrayBuffer(this._positionsBuf),this._indicesBuf.bind(),i.drawElements(i.TRIANGLES,this._indicesBuf.numItems,this._indicesBuf.itemType,0)}destroy(){this._program.destroy()}}function kt(t,e){return Math.exp(-t*t/(e*e*2))/(Math.sqrt(2*Math.PI)*e)}function jt(t,e){const s=[];for(let i=0;i<=t;i++)s.push(e[0]*i),s.push(e[1]*i);return s}const Gt=function(e,s){s=s||{};const i=new ft(e),r=e.canvas.canvas,o=e.canvas.gl,n=!!s.transparent,a=s.alphaDepthMask,h=new t({});let l={},u={},p=!0,d=!0,f=!0;const g=new _t(r,o,{depthTexture:pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture}),_=new _t(r,o),y=new _t(r,o),v=new _t(r,o),b=new _t(r,o);let P=!1;const T=new Ft(e),w=new Bt(e);function x(){p&&(!function(){for(let t in l)if(l.hasOwnProperty(t)){const e=l[t],s=e.drawableMap,i=e.drawableListPreCull;let r=0;for(let t in s)s.hasOwnProperty(t)&&(i[r++]=s[t]);i.length=r}}(),p=!1,d=!0),d&&(!function(){for(let t in l)if(l.hasOwnProperty(t)){const e=l[t];e.isStateSortable&&e.drawableListPreCull.sort(e.stateSortCompare)}}(),d=!1,f=!0),f&&function(){for(let t in l)if(l.hasOwnProperty(t)){const e=l[t],s=e.drawableListPreCull,i=e.drawableList;let r=0;for(let t=0,e=s.length;t<e;t++){const e=s[t];e.rebuildRenderFlags(),e.renderFlags.culled||(i[r++]=e)}i.length=r}}()}function M(t){if(!t.castsShadow)return;const e=t.getShadowRenderBuf();if(e){e.bind(),i.reset(),i.backfaces=!0,i.frontface=!0,i.shadowViewMatrix=t.getShadowViewMatrix(),i.shadowProjMatrix=t.getShadowProjMatrix(),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,1),o.enable(o.DEPTH_TEST),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(let t in l)if(l.hasOwnProperty(t)){const e=l[t].drawableList;for(let t=0,s=e.length;t<s;t++){const s=e[t];!1!==s.visible&&s.castsShadow&&s.drawShadow&&(s.renderFlags.colorOpaque&&s.drawShadow(i))}}e.unbind()}}this._occlusionTester=null,this.needStateSort=function(){d=!0},this.shadowsDirty=function(){},this.imageDirty=function(){f=!0},this.webglContextLost=function(){},this.webglContextRestored=function(t){v.webglContextRestored(t),b.webglContextRestored(t),g.webglContextRestored(t),_.webglContextRestored(t),y.webglContextRestored(t),T.init(),w.init(),f=!0},this.addDrawable=function(t,e){const s=e.type;if(!s)return void console.error("Renderer#addDrawable() : drawable with ID "+t+" has no 'type' - ignoring");let i=l[s];i||(i={type:e.type,count:0,isStateSortable:e.isStateSortable,stateSortCompare:e.stateSortCompare,drawableMap:{},drawableListPreCull:[],drawableList:[]},l[s]=i),i.count++,i.drawableMap[t]=e,u[t]=e,p=!0},this.removeDrawable=function(t){const e=u[t];if(!e)return void console.error("Renderer#removeDrawable() : drawable not found with ID "+t+" - ignoring");const s=e.type,i=l[s];--i.count<=0?delete l[s]:delete i.drawableMap[t],delete u[t],p=!0},this.getPickID=function(t){return h.addItem(t)},this.putPickID=function(t){h.removeItem(t)},this.clear=function(t){if(o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),n)o.clearColor(1,1,1,1);else{const t=e.canvas.backgroundColorFromAmbientLight?this.lights.getAmbientColorAndIntensity():e.canvas.backgroundColor;o.clearColor(t[0],t[1],t[2],1)}o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT)},this.render=function(t){(t=t||{}).force&&(f=!0),x(),f&&(!function(t){pt.SUPPORTED_EXTENSIONS.OES_element_index_uint&&o.getExtension("OES_element_index_uint");e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.getExtension("EXT_frag_depth");pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&o.getExtension("WEBGL_depth_texture");e.sao.possible&&function(t){const s=e.sao;g.bind(),g.clear(),function(t){i.reset(),i.pass=t.pass,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.frontFace(o.CCW),o.enable(o.CULL_FACE),o.depthMask(!0),!1!==t.clear&&o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(let t in l)if(l.hasOwnProperty(t)){const e=l[t].drawableList;for(let t=0,s=e.length;t<s;t++){const s=e[t];!0!==s.culled&&!1!==s.visible&&s.drawDepth&&(s.renderFlags.colorOpaque&&s.drawDepth(i))}}}(t),g.unbind(),_.bind(),_.clear(),T.render(g),_.unbind(),s.blur&&(y.bind(),y.clear(),w.render(g,_,0),y.unbind(),_.bind(),_.clear(),w.render(g,y,1),_.unbind())}(t);(function(){let t=e._lightsState.lights;for(let e=0,s=t.length;e<s;e++){const s=t[e];s.castsShadow&&M(s)}})(),D(t)}(t),m.frame.frameCount++,f=!1)};const D=function(){const t=[],s=[],r=[],h=[],u=[],p=[],c=[],d=[],f=[],g=[],y=[],v=[],b=[],P=[],T=[],w=[];return function(x){const M=e._lightsState.getAmbientColorAndIntensity();if(i.reset(),i.pass=x.pass,i.withSAO=!1,i.pbrEnabled=!!e.pbrEnabled,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),n)o.clearColor(0,0,0,0);else{const t=e.canvas.backgroundColorFromAmbientLight?M:e.canvas.backgroundColor;o.clearColor(t[0],t[1],t[2],1)}o.enable(o.DEPTH_TEST),o.frontFace(o.CCW),o.enable(o.CULL_FACE),o.depthMask(!0),o.lineWidth(1),i.lineWidth=1;const D=e.sao.possible;let E,I,S;i.occlusionTexture=D?_.getTexture():null;const A=Date.now();!1!==x.clear&&o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);let C=0,F=0,O=0,R=0,L=0,N=0,B=0,k=0,j=0,G=0,H=0,V=0,z=0,U=0,X=0,W=0;for(let e in l)if(l.hasOwnProperty(e)){const o=l[e].drawableList;for(E=0,I=o.length;E<I;E++){if(S=o[E],!0===S.culled||!1===S.visible)continue;const e=S.renderFlags;e.colorOpaque&&(D&&S.saoEnabled?t[C++]=S:S.drawColorOpaque(i)),e.colorTransparent&&(r[O++]=S),e.xrayedSilhouetteTransparent&&(c[B++]=S),e.xrayedSilhouetteOpaque&&(u[L++]=S),e.highlightedSilhouetteTransparent&&(y[H++]=S),e.highlightedSilhouetteOpaque&&(f[j++]=S),e.selectedSilhouetteTransparent&&(T[X++]=S),e.selectedSilhouetteOpaque&&(b[z++]=S),e.edgesOpaque&&(s[F++]=S),e.edgesTransparent&&(h[R++]=S),e.selectedEdgesTransparent&&(w[W++]=S),e.selectedEdgesOpaque&&(P[U++]=S),e.xrayedEdgesTransparent&&(d[k++]=S),e.xrayedEdgesOpaque&&(p[N++]=S),e.highlightedEdgesTransparent&&(v[V++]=S),e.highlightedEdgesOpaque&&(g[G++]=S)}}if(C>0)for(i.withSAO=!0,E=0;E<C;E++)t[E].drawColorOpaque(i);if(F>0)for(E=0;E<F;E++)s[E].drawEdgesColorOpaque(i);if(L>0)for(E=0;E<L;E++)u[E].drawSilhouetteXRayed(i);if(N>0)for(E=0;E<N;E++)p[E].drawEdgesXRayed(i);if(B>0||k>0||O>0||R>0){if(o.enable(o.CULL_FACE),o.enable(o.BLEND),n?(o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):(o.blendEquation(o.FUNC_ADD),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,a||o.depthMask(!1),k>0)for(E=0;E<k;E++)d[E].drawEdgesXRayed(i);if(B>0)for(E=0;E<B;E++)c[E].drawSilhouetteXRayed(i);if((O>0||R>0)&&o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),R>0)for(E=0;E<R;E++)S=h[E],S.drawEdgesColorTransparent(i);if(O>0)for(E=0;E<O;E++)S=r[E],S.drawColorTransparent(i);o.disable(o.BLEND),a||o.depthMask(!0)}if(j>0||G>0){if(i.lastProgramId=null,o.clear(o.DEPTH_BUFFER_BIT),G>0)for(E=0;E<G;E++)g[E].drawEdgesHighlighted(i);if(j>0)for(E=0;E<j;E++)f[E].drawSilhouetteHighlighted(i)}if(H>0||V>0||j>0){if(i.lastProgramId=null,o.clear(o.DEPTH_BUFFER_BIT),o.enable(o.CULL_FACE),o.enable(o.BLEND),n?(o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),V>0)for(E=0;E<V;E++)v[E].drawEdgesHighlighted(i);if(H>0)for(E=0;E<H;E++)y[E].drawSilhouetteHighlighted(i);o.disable(o.BLEND)}if(z>0||U>0){if(i.lastProgramId=null,o.clear(o.DEPTH_BUFFER_BIT),U>0)for(E=0;E<U;E++)P[E].drawEdgesSelected(i);if(z>0)for(E=0;E<z;E++)b[E].drawSilhouetteSelected(i)}if(X>0||W>0){if(i.lastProgramId=null,o.clear(o.DEPTH_BUFFER_BIT),o.enable(o.CULL_FACE),o.enable(o.BLEND),n?(o.blendEquation(o.FUNC_ADD),o.blendFuncSeparate(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA,o.ONE,o.ONE_MINUS_SRC_ALPHA)):o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),W>0)for(E=0;E<W;E++)w[E].drawEdgesSelected(i);if(X>0)for(E=0;E<X;E++)T[E].drawSilhouetteSelected(i);o.disable(o.BLEND)}const Y=Date.now(),K=m.frame;K.renderTime=(Y-A)/1e3,K.drawElements=i.drawElements,K.useProgram=i.useProgram,K.bindTexture=i.bindTexture,K.bindArray=i.bindArray;const Z=pt.MAX_TEXTURE_UNITS;for(let t=0;t<Z;t++)o.activeTexture(o.TEXTURE0+t);o.bindTexture(o.TEXTURE_CUBE_MAP,null),o.bindTexture(o.TEXTURE_2D,null);const q=pt.MAX_VERTEX_ATTRIBS;for(let t=0;t<q;t++)o.disableVertexAttribArray(t)}}();this.pick=function(){const t=c.vec3(),s=c.mat4(),n=c.mat4(),a=c.vec3(),u=c.vec3([0,1,0]),p=new yt,d=c.vec2(),m=c.vec3(),f=c.vec3(),g=c.vec3(),_=c.vec3(),y=c.vec3();return function(b,P=p){let T;P.reset(),x(),pt.SUPPORTED_EXTENSIONS.OES_element_index_uint&&o.getExtension("OES_element_index_uint"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.getExtension("EXT_frag_depth"),pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture&&o.getExtension("WEBGL_depth_texture");let w=null,M=null;if(P.pickSurface=b.pickSurface,b.canvasPos)m[0]=b.canvasPos[0],m[1]=b.canvasPos[1],w=e.camera.viewMatrix,M=e.camera.projMatrix,P.canvasPos=b.canvasPos;else{const i=c.frustumMat4(-1,1,-1,1,.01,e.camera.project.far,s);b.matrix?(w=b.matrix,M=i):(f.set(b.origin||[0,0,0]),g.set(b.direction||[0,0,1]),T=c.addVec3(f,g,t),a[0]=Math.random(),a[1]=Math.random(),a[2]=Math.random(),c.normalizeVec3(a),c.cross3Vec3(g,a,u),w=c.lookAtMat4v(f,T,u,n),M=i,P.origin=f,P.direction=g),m[0]=.5*r.clientWidth,m[1]=.5*r.clientHeight}v.bind();const D=function(t,e,s,r){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=e,i.pickProjMatrix=s,i.pickInvisible=!!r.pickInvisible,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);const n=r.includeEntityIds,a=r.excludeEntityIds;for(let t in l)if(l.hasOwnProperty(t)){const e=l[t].drawableList;for(let t=0,s=e.length;t<s;t++){const s=e[t];!s.drawPickMesh||!0===s.culled||!0!==r.pickInvisible&&!1===s.visible||!1===s.pickable||(n&&!n[s.id]||a&&a[s.id]||s.drawPickMesh(i))}}const u=v.read(Math.round(t[0]),Math.round(t[1]));let p=u[0]+256*u[1]+256*u[2]*256+256*u[3]*256*256;if(p<0)return;return h.items[p]}(m,w,M,b);if(!D)return v.unbind(),null;const I=D.delegatePickedEntity?D.delegatePickedEntity():D;return I?(b.pickSurface&&(b.pickSurfacePrecision&&e.pickSurfacePrecisionEnabled?(b.canvasPos&&c.canvasPosToWorldRay(e.canvas.canvas,w,M,m,f,g),D.precisionRayPickSurface(f,g,_,y)&&(P.worldPos=_,!1!==b.pickSurfaceNormal&&(P.worldNormal=y),P.pickSurfacePrecision=!0)):D.canPickTriangle&&D.canPickTriangle()?(!function(t,e,s,r,n){if(!t.drawPickTriangles)return;i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=s,i.pickProjMatrix=r,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),t.drawPickTriangles(i);const a=v.read(e[0],e[1]);let h=a[0]+256*a[1]+256*a[2]*256+256*a[3]*256*256;h*=3,n.primIndex=h}(D,m,w,M,P),D.pickTriangleSurface(w,M,P),P.pickSurfacePrecision=!1):D.canPickWorldPos&&D.canPickWorldPos()&&(d[0]=e.camera.project.near,d[1]=e.camera.project.far,E(D,m,w,M,d,P),!1!==b.pickSurfaceNormal&&function(t,e,s,r,n){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=s,i.pickProjMatrix=r,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),t.drawPickNormals(i);const a=v.read(Math.round(e[0]),Math.round(e[1])),h=[a[0]/256-.5,a[1]/256-.5,a[2]/256-.5];c.normalizeVec3(h),n.worldNormal=h}(D,m,w,M,P),P.pickSurfacePrecision=!1)),v.unbind(),P.entity=I,P):(v.unbind(),null)}}();const E=function(){const t=c.vec4(),e=c.vec4(),s=c.vec4(),n=c.vec4(),a=c.vec4(),h=c.mat4(),l=c.mat4(),u=c.mat4();return function(p,d,m,f,g,_){i.reset(),i.backfaces=!0,i.frontface=!0,i.pickViewMatrix=m,i.pickProjMatrix=f,i.pickZNear=g[0],i.pickZFar=g[1],o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT),p.drawPickDepths(i);const y=function(t){const e=[t[0]/256,t[1]/256,t[2]/256,t[3]/256],s=[1/16777216,1/65536,1/256,1];return c.dotVec4(e,s)}(v.read(Math.round(d[0]),Math.round(d[1]))),b=(d[0]-r.width/2)/(r.width/2),P=-(d[1]-r.height/2)/(r.height/2),T=p.origin;let w;if(T){const t=U(m,T,h);w=c.mulMat4(f,t,l)}else w=c.mulMat4(f,m,l);const x=c.inverseMat4(w,u);t[0]=b,t[1]=P,t[2]=-1,t[3]=1;let M=c.transformVec4(x,t);M=c.mulVec4Scalar(M,1/M[3]),e[0]=b,e[1]=P,e[2]=1,e[3]=1;let D=c.transformVec4(x,e);D=c.mulVec4Scalar(D,1/D[3]);const E=c.subVec3(D,M,s),I=c.addVec3(M,c.mulVec4Scalar(E,y,n),a);T&&c.addVec3(I,T),_.worldPos=I}}();this.addMarker=function(t){this._occlusionTester=this._occlusionTester||new At(e),this._occlusionTester.addMarker(t),e.occlusionTestCountdown=0},this.markerWorldPosUpdated=function(t){this._occlusionTester.markerWorldPosUpdated(t)},this.removeMarker=function(t){this._occlusionTester.removeMarker(t)},this.doOcclusionTest=function(){if(this._occlusionTester&&this._occlusionTester.needOcclusionTest){x(),this._occlusionTester.bindRenderBuf(),i.reset(),i.backfaces=!0,i.frontface=!0,o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.clearColor(0,0,0,0),o.enable(o.DEPTH_TEST),o.disable(o.CULL_FACE),o.disable(o.BLEND),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(let t in l)if(l.hasOwnProperty(t)){const e=l[t].drawableList;for(let t=0,s=e.length;t<s;t++){const s=e[t];s.drawOcclusion&&!0!==s.culled&&!1!==s.visible&&!1!==s.pickable&&s.drawOcclusion(i)}}this._occlusionTester.drawMarkers(i),this._occlusionTester.doOcclusionTest(),this._occlusionTester.unbindRenderBuf()}},this.readPixels=function(t,e,s,i){let r,o,n,a;for(b.bind(),b.clear(),this.render({force:!0,opaqueOnly:i}),o=0;o<s;o++)n=2*o,a=4*o,r=b.read(t[n],t[n+1]),e[a]=r[0],e[a+1]=r[1],e[a+2]=r[2],e[a+3]=r[3];b.unbind(),f=!0},this.beginSnapshot=function(){b.bind(),b.clear(),P=!0},this.renderSnapshot=function(){P&&(b.clear(),this.render({force:!0,opaqueOnly:!1}),f=!0)},this.readSnapshot=function(t){return b.readImage(t)},this.endSnapshot=function(){P&&(b.unbind(),P=!1)},this.destroy=function(){l={},u={},v.destroy(),b.destroy(),g.destroy(),_.destroy(),y.destroy(),T.destroy(),w.destroy(),this._occlusionTester&&this._occlusionTester.destroy()}};class Ht extends A{constructor(t,e={}){super(t,e),this.KEY_BACKSPACE=8,this.KEY_TAB=9,this.KEY_ENTER=13,this.KEY_SHIFT=16,this.KEY_CTRL=17,this.KEY_ALT=18,this.KEY_PAUSE_BREAK=19,this.KEY_CAPS_LOCK=20,this.KEY_ESCAPE=27,this.KEY_PAGE_UP=33,this.KEY_PAGE_DOWN=34,this.KEY_END=35,this.KEY_HOME=36,this.KEY_LEFT_ARROW=37,this.KEY_UP_ARROW=38,this.KEY_RIGHT_ARROW=39,this.KEY_DOWN_ARROW=40,this.KEY_INSERT=45,this.KEY_DELETE=46,this.KEY_NUM_0=48,this.KEY_NUM_1=49,this.KEY_NUM_2=50,this.KEY_NUM_3=51,this.KEY_NUM_4=52,this.KEY_NUM_5=53,this.KEY_NUM_6=54,this.KEY_NUM_7=55,this.KEY_NUM_8=56,this.KEY_NUM_9=57,this.KEY_A=65,this.KEY_B=66,this.KEY_C=67,this.KEY_D=68,this.KEY_E=69,this.KEY_F=70,this.KEY_G=71,this.KEY_H=72,this.KEY_I=73,this.KEY_J=74,this.KEY_K=75,this.KEY_L=76,this.KEY_M=77,this.KEY_N=78,this.KEY_O=79,this.KEY_P=80,this.KEY_Q=81,this.KEY_R=82,this.KEY_S=83,this.KEY_T=84,this.KEY_U=85,this.KEY_V=86,this.KEY_W=87,this.KEY_X=88,this.KEY_Y=89,this.KEY_Z=90,this.KEY_LEFT_WINDOW=91,this.KEY_RIGHT_WINDOW=92,this.KEY_SELECT_KEY=93,this.KEY_NUMPAD_0=96,this.KEY_NUMPAD_1=97,this.KEY_NUMPAD_2=98,this.KEY_NUMPAD_3=99,this.KEY_NUMPAD_4=100,this.KEY_NUMPAD_5=101,this.KEY_NUMPAD_6=102,this.KEY_NUMPAD_7=103,this.KEY_NUMPAD_8=104,this.KEY_NUMPAD_9=105,this.KEY_MULTIPLY=106,this.KEY_ADD=107,this.KEY_SUBTRACT=109,this.KEY_DECIMAL_POINT=110,this.KEY_DIVIDE=111,this.KEY_F1=112,this.KEY_F2=113,this.KEY_F3=114,this.KEY_F4=115,this.KEY_F5=116,this.KEY_F6=117,this.KEY_F7=118,this.KEY_F8=119,this.KEY_F9=120,this.KEY_F10=121,this.KEY_F11=122,this.KEY_F12=123,this.KEY_NUM_LOCK=144,this.KEY_SCROLL_LOCK=145,this.KEY_SEMI_COLON=186,this.KEY_EQUAL_SIGN=187,this.KEY_COMMA=188,this.KEY_DASH=189,this.KEY_PERIOD=190,this.KEY_FORWARD_SLASH=191,this.KEY_GRAVE_ACCENT=192,this.KEY_OPEN_BRACKET=219,this.KEY_BACK_SLASH=220,this.KEY_CLOSE_BRACKET=221,this.KEY_SINGLE_QUOTE=222,this.KEY_SPACE=32,this.element=e.element,this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0,this.keyboardEnabled=!0,this.mouseover=!1,this.mouseCanvasPos=c.vec2(),this._keyboardEventsElement=e.keyboardEventsElement||document,this._bindEvents()}_bindEvents(){if(!this._eventsBound){this._keyboardEventsElement.addEventListener("keydown",this._keyDownListener=t=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.keyCode===this.KEY_CTRL?this.ctrlDown=!0:t.keyCode===this.KEY_ALT?this.altDown=!0:t.keyCode===this.KEY_SHIFT&&(this.shiftDown=!0),this.keyDown[t.keyCode]=!0,this.fire("keydown",t.keyCode,!0))},!1),this._keyboardEventsElement.addEventListener("keyup",this._keyUpListener=t=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==t.target.tagName&&"TEXTAREA"!==t.target.tagName&&(t.keyCode===this.KEY_CTRL?this.ctrlDown=!1:t.keyCode===this.KEY_ALT?this.altDown=!1:t.keyCode===this.KEY_SHIFT&&(this.shiftDown=!1),this.keyDown[t.keyCode]=!1,this.fire("keyup",t.keyCode,!0))}),this.element.addEventListener("mouseenter",this._mouseEnterListener=t=>{this.enabled&&(this.mouseover=!0,this._getMouseCanvasPos(t),this.fire("mouseenter",this.mouseCanvasPos,!0))}),this.element.addEventListener("mouseleave",this._mouseLeaveListener=t=>{this.enabled&&(this.mouseover=!1,this._getMouseCanvasPos(t),this.fire("mouseleave",this.mouseCanvasPos,!0))}),this.element.addEventListener("mousedown",this._mouseDownListener=t=>{if(this.enabled){switch(t.which){case 1:this.mouseDownLeft=!0;break;case 2:this.mouseDownMiddle=!0;break;case 3:this.mouseDownRight=!0}this._getMouseCanvasPos(t),this.element.focus(),this.fire("mousedown",this.mouseCanvasPos,!0),this.mouseover&&t.preventDefault()}}),document.addEventListener("mouseup",this._mouseUpListener=t=>{if(this.enabled){switch(t.which){case 1:this.mouseDownLeft=!1;break;case 2:this.mouseDownMiddle=!1;break;case 3:this.mouseDownRight=!1}this.fire("mouseup",this.mouseCanvasPos,!0)}},!0),document.addEventListener("click",this._clickListener=t=>{if(this.enabled){switch(t.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(t),this.fire("click",this.mouseCanvasPos,!0),this.mouseover&&t.preventDefault()}}),document.addEventListener("dblclick",this._dblClickListener=t=>{if(this.enabled){switch(t.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(t),this.fire("dblclick",this.mouseCanvasPos,!0),this.mouseover&&t.preventDefault()}}),this.element.addEventListener("mousemove",this._mouseMoveListener=t=>{this.enabled&&(this._getMouseCanvasPos(t),this.fire("mousemove",this.mouseCanvasPos,!0),this.mouseover&&t.preventDefault())}),this.element.addEventListener("wheel",this._mouseWheelListener=(t,e)=>{if(!this.enabled)return;const s=Math.max(-1,Math.min(1,40*-t.deltaY));this.fire("mousewheel",s,!0)},{passive:!0});{let t,e;const s=2;this.on("mousedown",(s=>{t=s[0],e=s[1]})),this.on("mouseup",(i=>{t>=i[0]-s&&t<=i[0]+s&&e>=i[1]-s&&e<=i[1]+s&&this.fire("mouseclicked",i,!0)}))}this._eventsBound=!0}}_unbindEvents(){this._eventsBound&&(this._keyboardEventsElement.removeEventListener("keydown",this._keyDownListener),this._keyboardEventsElement.removeEventListener("keyup",this._keyUpListener),this.element.removeEventListener("mouseenter",this._mouseEnterListener),this.element.removeEventListener("mouseleave",this._mouseLeaveListener),this.element.removeEventListener("mousedown",this._mouseDownListener),document.removeEventListener("mouseup",this._mouseDownListener),document.removeEventListener("click",this._clickListener),document.removeEventListener("dblclick",this._dblClickListener),this.element.removeEventListener("mousemove",this._mouseMoveListener),this.element.removeEventListener("wheel",this._mouseWheelListener),window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientListener),this._eventsBound=!1)}_getMouseCanvasPos(t){if(t){let e=t.target,s=0,i=0;for(;e.offsetParent;)s+=e.offsetLeft,i+=e.offsetTop,e=e.offsetParent;this.mouseCanvasPos[0]=t.pageX-s,this.mouseCanvasPos[1]=t.pageY-i}else t=window.event,this.mouseCanvasPos[0]=t.x,this.mouseCanvasPos[1]=t.y}setEnabled(t){this.enabled!==t&&this.fire("enabled",this.enabled=t)}getEnabled(){return this.enabled}setKeyboardEnabled(t){this.keyboardEnabled=t}getKeyboardEnabled(){return this.keyboardEnabled}destroy(){super.destroy(),this._unbindEvents()}}const Vt=new t({});class zt{constructor(t){this.id=Vt.addItem({});for(const e in t)t.hasOwnProperty(e)&&(this[e]=t[e])}destroy(){Vt.removeItem(this.id)}}class Ut extends A{get type(){return"Viewport"}constructor(t,e={}){super(t,e),this._state=new zt({boundary:[0,0,100,100]}),this.boundary=e.boundary,this.autoBoundary=e.autoBoundary}set boundary(t){if(!this._autoBoundary){if(!t){const e=this.scene.canvas.boundary;t=[0,0,e[2],e[3]]}this._state.boundary=t,this.glRedraw(),this.fire("boundary",this._state.boundary)}}get boundary(){return this._state.boundary}set autoBoundary(t){(t=!!t)!==this._autoBoundary&&(this._autoBoundary=t,this._autoBoundary?this._onCanvasSize=this.scene.canvas.on("boundary",(function(t){const e=t[2],s=t[3];this._state.boundary=[0,0,e,s],this.glRedraw(),this.fire("boundary",this._state.boundary)}),this):this._onCanvasSize&&(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}get autoBoundary(){return this._autoBoundary}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}class Xt extends A{get type(){return"Perspective"}constructor(t,e={}){super(t,e),this.camera=t,this._state=new zt({matrix:c.mat4(),inverseMatrix:c.mat4(),transposedMatrix:c.mat4(),near:.1,far:2e3}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this._fov=60,this._canvasResized=this.scene.canvas.on("boundary",this._needUpdate,this),this.fov=e.fov,this.fovAxis=e.fovAxis,this.near=e.near,this.far=e.far}_update(){const t=this.scene.viewport.boundary,e=t[2]/t[3],s=this._fovAxis;let i=this._fov;("x"===s||"min"===s&&e<1||"max"===s&&e>1)&&(i/=e),i=Math.min(i,120),c.perspectiveMat4(i*(Math.PI/180),e,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set fov(t){(t=null!=t?t:60)!==this._fov&&(this._fov=t,this._needUpdate(0),this.fire("fov",this._fov))}get fov(){return this._fov}set fovAxis(t){t=t||"min",this._fovAxis!==t&&("x"!==t&&"y"!==t&&"min"!==t&&(this.error("Unsupported value for 'fovAxis': "+t+" - defaulting to 'min'"),t="min"),this._fovAxis=t,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}get fovAxis(){return this._fovAxis}set near(t){const e=null!=t?t:.1;this._state.near!==e&&(this._state.near=e,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(t){const e=null!=t?t:2e3;this._state.far!==e&&(this._state.far=e,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(c.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(c.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(t,e,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(t[0]-n)/n,s[1]=(t[1]-a)/a,s[2]=e,s[3]=1,c.mulMat4v4(this.inverseMatrix,s,i),c.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,c.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._canvasResized)}}class Wt extends A{get type(){return"Ortho"}constructor(t,e={}){super(t,e),this.camera=t,this._state=new zt({matrix:c.mat4(),inverseMatrix:c.mat4(),transposedMatrix:c.mat4(),near:.1,far:2e3}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.scale=e.scale,this.near=e.near,this.far=e.far,this._onCanvasBoundary=this.scene.canvas.on("boundary",this._needUpdate,this)}_update(){const t=this.scene,e=.5*this._scale,s=t.viewport.boundary,i=s[2],r=s[3],o=i/r;let n,a,h,l;i>r?(n=-e,a=e,h=e/o,l=-e/o):(n=-e*o,a=e*o,h=e,l=-e),c.orthoMat4c(n,a,l,h,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set scale(t){null==t&&(t=1),t<=0&&(t=.01),this._scale=t,this._needUpdate(0),this.fire("scale",this._scale)}get scale(){return this._scale}set near(t){const e=null!=t?t:.1;this._state.near!==e&&(this._state.near=e,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(t){const e=null!=t?t:2e3;this._state.far!==e&&(this._state.far=e,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(c.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(c.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(t,e,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(t[0]-n)/n,s[1]=(t[1]-a)/a,s[2]=e,s[3]=1,c.mulMat4v4(this.inverseMatrix,s,i),c.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,c.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._onCanvasBoundary)}}class Yt extends A{get type(){return"Frustum"}constructor(t,e={}){super(t,e),this.camera=t,this._state=new zt({matrix:c.mat4(),inverseMatrix:c.mat4(),transposedMatrix:c.mat4(),near:.1,far:1e4}),this._left=-1,this._right=1,this._bottom=-1,this._top=1,this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.left=e.left,this.right=e.right,this.bottom=e.bottom,this.top=e.top,this.near=e.near,this.far=e.far}_update(){c.frustumMat4(this._left,this._right,this._bottom,this._top,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set left(t){this._left=null!=t?t:-1,this._needUpdate(0),this.fire("left",this._left)}get left(){return this._left}set right(t){this._right=null!=t?t:1,this._needUpdate(0),this.fire("right",this._right)}get right(){return this._right}set top(t){this._top=null!=t?t:1,this._needUpdate(0),this.fire("top",this._top)}get top(){return this._top}set bottom(t){this._bottom=null!=t?t:-1,this._needUpdate(0),this.fire("bottom",this._bottom)}get bottom(){return this._bottom}set near(t){this._state.near=null!=t?t:.1,this._needUpdate(0),this.fire("near",this._state.near)}get near(){return this._state.near}set far(t){this._state.far=null!=t?t:1e4,this._needUpdate(0),this.fire("far",this._state.far)}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(c.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(c.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(t,e,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(t[0]-n)/n,s[1]=(t[1]-a)/a,s[2]=e,s[3]=1,c.mulMat4v4(this.inverseMatrix,s,i),c.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,c.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),super.destroy()}}class Kt extends A{get type(){return"CustomProjection"}constructor(t,e={}){super(t,e),this.camera=t,this._state=new zt({matrix:c.mat4(),inverseMatrix:c.mat4(),transposedMatrix:c.mat4()}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!1,this.matrix=e.matrix}set matrix(t){this._state.matrix.set(t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("far",this._state.matrix)}get matrix(){return this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(c.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(c.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(t,e,s,i,r){const o=this.scene.canvas.canvas,n=o.offsetWidth/2,a=o.offsetHeight/2;return s[0]=(t[0]-n)/n,s[1]=(t[1]-a)/a,s[2]=e,s[3]=1,c.mulMat4v4(this.inverseMatrix,s,i),c.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,c.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy()}}const Zt=c.vec3(),qt=c.vec3(),$t=c.vec3(),Qt=c.vec3(),Jt=c.vec3(),te=c.vec3(),ee=c.mat4(),se=c.mat4(),ie=c.vec3(),re=c.vec3(),oe=c.vec3(),ne=c.vec3();class ae extends A{get type(){return"Camera"}constructor(t,e={}){super(t,e),this._state=new zt({deviceMatrix:c.mat4(),hasDeviceMatrix:!1,matrix:c.mat4(),normalMatrix:c.mat4(),inverseMatrix:c.mat4()}),this._perspective=new Xt(this),this._ortho=new Wt(this),this._frustum=new Yt(this),this._customProjection=new Kt(this),this._project=this._perspective,this._eye=c.vec3([0,0,10]),this._look=c.vec3([0,0,0]),this._up=c.vec3([0,1,0]),this._worldUp=c.vec3([0,1,0]),this._worldRight=c.vec3([1,0,0]),this._worldForward=c.vec3([0,0,-1]),this.deviceMatrix=e.deviceMatrix,this.eye=e.eye,this.look=e.look,this.up=e.up,this.worldAxis=e.worldAxis,this.gimbalLock=e.gimbalLock,this.constrainPitch=e.constrainPitch,this.projection=e.projection,this._perspective.on("matrix",(()=>{"perspective"===this._projectionType&&this.fire("projMatrix",this._perspective.matrix)})),this._ortho.on("matrix",(()=>{"ortho"===this._projectionType&&this.fire("projMatrix",this._ortho.matrix)})),this._frustum.on("matrix",(()=>{"frustum"===this._projectionType&&this.fire("projMatrix",this._frustum.matrix)})),this._customProjection.on("matrix",(()=>{"customProjection"===this._projectionType&&this.fire("projMatrix",this._customProjection.matrix)}))}_update(){const t=this._state;let e;"ortho"===this.projection?(c.subVec3(this._eye,this._look,ie),c.normalizeVec3(ie,re),c.mulVec3Scalar(re,1e3,oe),c.addVec3(this._look,oe,ne),e=ne):e=this._eye,t.hasDeviceMatrix?(c.lookAtMat4v(e,this._look,this._up,se),c.mulMat4(t.deviceMatrix,se,t.matrix)):c.lookAtMat4v(e,this._look,this._up,t.matrix),c.inverseMat4(this._state.matrix,this._state.inverseMatrix),c.transposeMat4(this._state.inverseMatrix,this._state.normalMatrix),this.glRedraw(),this.fire("matrix",this._state.matrix),this.fire("viewMatrix",this._state.matrix)}orbitYaw(t){let e=c.subVec3(this._eye,this._look,Zt);c.rotationMat4v(.0174532925*t,this._gimbalLock?this._worldUp:this._up,ee),e=c.transformPoint3(ee,e,qt),this.eye=c.addVec3(this._look,e,$t),this.up=c.transformPoint3(ee,this._up,Qt)}orbitPitch(t){if(this._constrainPitch&&(t=c.dotVec3(this._up,this._worldUp)/c.DEGTORAD)<1)return;let e=c.subVec3(this._eye,this._look,Zt);const s=c.cross3Vec3(c.normalizeVec3(e,qt),c.normalizeVec3(this._up,$t));c.rotationMat4v(.0174532925*t,s,ee),e=c.transformPoint3(ee,e,Qt),this.up=c.transformPoint3(ee,this._up,Jt),this.eye=c.addVec3(e,this._look,te)}yaw(t){let e=c.subVec3(this._look,this._eye,Zt);c.rotationMat4v(.0174532925*t,this._gimbalLock?this._worldUp:this._up,ee),e=c.transformPoint3(ee,e,qt),this.look=c.addVec3(e,this._eye,$t),this._gimbalLock&&(this.up=c.transformPoint3(ee,this._up,Qt))}pitch(t){if(this._constrainPitch&&(t=c.dotVec3(this._up,this._worldUp)/c.DEGTORAD)<1)return;let e=c.subVec3(this._look,this._eye,Zt);const s=c.cross3Vec3(c.normalizeVec3(e,qt),c.normalizeVec3(this._up,$t));c.rotationMat4v(.0174532925*t,s,ee),this.up=c.transformPoint3(ee,this._up,te),e=c.transformPoint3(ee,e,Qt),this.look=c.addVec3(e,this._eye,Jt)}pan(t){const e=c.subVec3(this._eye,this._look,Zt),s=[0,0,0];let i;if(0!==t[0]){const r=c.cross3Vec3(c.normalizeVec3(e,[]),c.normalizeVec3(this._up,qt));i=c.mulVec3Scalar(r,t[0]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]}0!==t[1]&&(i=c.mulVec3Scalar(c.normalizeVec3(this._up,$t),t[1]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]),0!==t[2]&&(i=c.mulVec3Scalar(c.normalizeVec3(e,Qt),t[2]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]),this.eye=c.addVec3(this._eye,s,Jt),this.look=c.addVec3(this._look,s,te)}zoom(t){const e=c.subVec3(this._eye,this._look,Zt),s=Math.abs(c.lenVec3(e,qt)),i=Math.abs(s+t);if(i<.5)return;const r=c.normalizeVec3(e,$t);this.eye=c.addVec3(this._look,c.mulVec3Scalar(r,i),Qt)}set eye(t){this._eye.set(t||[0,0,10]),this._needUpdate(0),this.fire("eye",this._eye)}get eye(){return this._eye}set look(t){this._look.set(t||[0,0,0]),this._needUpdate(0),this.fire("look",this._look)}get look(){return this._look}set up(t){this._up.set(t||[0,1,0]),this._needUpdate(0),this.fire("up",this._up)}get up(){return this._up}set deviceMatrix(t){this._state.deviceMatrix.set(t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._state.hasDeviceMatrix=!!t,this._needUpdate(0),this.fire("deviceMatrix",this._state.deviceMatrix)}get deviceMatrix(){return this._state.deviceMatrix}set worldAxis(t){t=t||[1,0,0,0,1,0,0,0,1],this._worldAxis?this._worldAxis.set(t):this._worldAxis=c.vec3(t),this._worldRight[0]=this._worldAxis[0],this._worldRight[1]=this._worldAxis[1],this._worldRight[2]=this._worldAxis[2],this._worldUp[0]=this._worldAxis[3],this._worldUp[1]=this._worldAxis[4],this._worldUp[2]=this._worldAxis[5],this._worldForward[0]=this._worldAxis[6],this._worldForward[1]=this._worldAxis[7],this._worldForward[2]=this._worldAxis[8],this.fire("worldAxis",this._worldAxis)}get worldAxis(){return this._worldAxis}get worldUp(){return this._worldUp}get xUp(){return this._worldUp[0]>this._worldUp[1]&&this._worldUp[0]>this._worldUp[2]}get yUp(){return this._worldUp[1]>this._worldUp[0]&&this._worldUp[1]>this._worldUp[2]}get zUp(){return this._worldUp[2]>this._worldUp[0]&&this._worldUp[2]>this._worldUp[1]}get worldRight(){return this._worldRight}get worldForward(){return this._worldForward}set gimbalLock(t){this._gimbalLock=!1!==t,this.fire("gimbalLock",this._gimbalLock)}get gimbalLock(){return this._gimbalLock}set constrainPitch(t){this._constrainPitch=!!t,this.fire("constrainPitch",this._constrainPitch)}get eyeLookDist(){return c.lenVec3(c.subVec3(this._look,this._eye,Zt))}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get viewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get normalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get viewNormalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get inverseViewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.inverseMatrix}get projMatrix(){return this[this.projection].matrix}get perspective(){return this._perspective}get ortho(){return this._ortho}get frustum(){return this._frustum}get customProjection(){return this._customProjection}set projection(t){t=t||"perspective",this._projectionType!==t&&("perspective"===t?this._project=this._perspective:"ortho"===t?this._project=this._ortho:"frustum"===t?this._project=this._frustum:"customProjection"===t?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+t+" defaulting to 'perspective'"),this._project=this._perspective,t="perspective"),this._project._update(),this._projectionType=t,this.glRedraw(),this._update(),this.fire("dirty"),this.fire("projection",this._projectionType),this.fire("projMatrix",this._project.matrix))}get projection(){return this._projectionType}get project(){return this._project}destroy(){super.destroy(),this._state.destroy()}}class he extends A{get type(){return"Light"}get isLight(){return!0}constructor(t,e={}){super(t,e)}}class le extends he{get type(){return"DirLight"}constructor(t,e={}){super(t,e),this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const s=this.scene.camera,i=this.scene.canvas;this._onCameraViewMatrix=s.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=s.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=i.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new zt({type:"dir",dir:c.vec3([1,1,1]),color:c.vec3([.7,.7,.8]),intensity:1,space:e.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(this._shadowViewMatrixDirty){this._shadowViewMatrix||(this._shadowViewMatrix=c.identityMat4());const t=this.scene.camera,e=this._state.dir,s=t.look,i=[s[0]-e[0],s[1]-e[1],s[2]-e[2]],r=[0,1,0];c.lookAtMat4v(i,s,r,this._shadowViewMatrix),this._shadowViewMatrixDirty=!1}return this._shadowViewMatrix},getShadowProjMatrix:()=>(this._shadowProjMatrixDirty&&(this._shadowProjMatrix||(this._shadowProjMatrix=c.identityMat4()),c.orthoMat4c(-40,40,-40,40,-40,80,this._shadowProjMatrix),this._shadowProjMatrixDirty=!1),this._shadowProjMatrix),getShadowRenderBuf:()=>(this._shadowRenderBuf||(this._shadowRenderBuf=new _t(this.scene.canvas.canvas,this.scene.canvas.gl,{size:[1024,1024]})),this._shadowRenderBuf)}),this.dir=e.dir,this.color=e.color,this.intensity=e.intensity,this.castsShadow=e.castsShadow,this.scene._lightCreated(this)}set dir(t){this._state.dir.set(t||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get dir(){return this._state.dir}set color(t){this._state.color.set(t||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(t){t=void 0!==t?t:1,this._state.intensity=t,this.glRedraw()}get intensity(){return this._state.intensity}set castsShadow(t){t=!!t,this._state.castsShadow!==t&&(this._state.castsShadow=t,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const t=this.scene.camera,e=this.scene.canvas;t.off(this._onCameraViewMatrix),t.off(this._onCameraProjMatrix),e.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}class ue extends he{get type(){return"AmbientLight"}constructor(t,e={}){super(t,e),this._state={type:"ambient",color:c.vec3([.7,.7,.7]),intensity:1},this.color=e.color,this.intensity=e.intensity,this.scene._lightCreated(this)}set color(t){this._state.color.set(t||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(t){this._state.intensity=void 0!==t?t:1,this.glRedraw()}get intensity(){return this._state.intensity}destroy(){super.destroy(),this.scene._lightDestroyed(this)}}class pe extends A{get type(){return"Geometry"}get isGeometry(){return!0}constructor(t,e={}){super(t,e),m.memory.meshes++}destroy(){super.destroy(),m.memory.meshes--}}var ce=function(){const t=[],e=[],s=[],i=[],r=[];let o=0;const n=new Uint16Array(3),a=new Uint16Array(3),h=new Uint16Array(3),l=c.vec3(),u=c.vec3(),p=c.vec3(),d=c.vec3(),m=c.vec3(),f=c.vec3(),g=c.vec3();return function(_,y,v,b){!function(r,o){const n={};let a,h,l,u;const p=Math.pow(10,4);let c,d,m=0;for(c=0,d=r.length;c<d;c+=3)a=r[c],h=r[c+1],l=r[c+2],u=Math.round(a*p)+"_"+Math.round(h*p)+"_"+Math.round(l*p),void 0===n[u]&&(n[u]=m/3,t[m++]=a,t[m++]=h,t[m++]=l),e[c/3]=n[u];for(c=0,d=o.length;c<d;c++)i[c]=e[o[c]],s[i[c]]=o[c]}(_,y),function(e,s){o=0;for(let _=0,y=e;_<y;_+=3){const e=3*i[_],y=3*i[_+1],v=3*i[_+2];s?(n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],a[0]=t[y],a[1]=t[y+1],a[2]=t[y+2],h[0]=t[v],h[1]=t[v+1],h[2]=t[v+2],c.decompressPosition(n,s,l),c.decompressPosition(a,s,u),c.decompressPosition(h,s,p)):(l[0]=t[e],l[1]=t[e+1],l[2]=t[e+2],u[0]=t[y],u[1]=t[y+1],u[2]=t[y+2],p[0]=t[v],p[1]=t[v+1],p[2]=t[v+2]),c.subVec3(p,u,d),c.subVec3(l,u,m),c.cross3Vec3(d,m,f),c.normalizeVec3(f,g);const b=r[o]||(r[o]={normal:c.vec3()});b.normal[0]=g[0],b.normal[1]=g[1],b.normal[2]=g[2],o++}}(y.length,v);const P=[],T=Math.cos(c.DEGTORAD*b),w={};let x,M,D,E,I,S,A,C,F,O,R,L=!1;for(let t=0,e=y.length;t<e;t+=3){const e=t/3;for(let s=0;s<3;s++)x=i[t+s],M=i[t+(s+1)%3],D=Math.min(x,M),E=Math.max(x,M),I=D+","+E,void 0===w[I]?w[I]={index1:D,index2:E,face1:e,face2:void 0}:w[I].face2=e}for(I in w)S=w[I],void 0!==S.face2&&(A=r[S.face1].normal,C=r[S.face2].normal,F=c.dotVec3(A,C),F>T)||(O=s[S.index1],R=s[S.index2],(!L&&O>65535||R>65535)&&(L=!0),P.push(O),P.push(R));return L?new Uint32Array(P):new Uint16Array(P)}}();const de=function(){const t=c.mat4(),e=c.mat4();return function(s,i){i=i||c.mat4();const r=s[0],o=s[1],n=s[2],a=s[3]-r,h=s[4]-o,l=s[5]-n,u=65535;return c.identityMat4(t),c.translationMat4v(s,t),c.identityMat4(e),c.scalingMat4v([a/u,h/u,l/u],e),c.mulMat4(t,e,i),i}}();var me=function(){const t=c.mat4(),e=c.mat4();return function(s,i,r){const o=new Uint16Array(s.length);var n=new Float32Array([r[0]!==i[0]?65535/(r[0]-i[0]):0,r[1]!==i[1]?65535/(r[1]-i[1]):0,r[2]!==i[2]?65535/(r[2]-i[2]):0]);let a;for(a=0;a<s.length;a+=3)o[a+0]=Math.floor((s[a+0]-i[0])*n[0]),o[a+1]=Math.floor((s[a+1]-i[1])*n[1]),o[a+2]=Math.floor((s[a+2]-i[2])*n[2]);c.identityMat4(t),c.translationMat4v(i,t),c.identityMat4(e),c.scalingMat4v([(r[0]-i[0])/65535,(r[1]-i[1])/65535,(r[2]-i[2])/65535],e);return{quantized:o,decodeMatrix:c.mulMat4(t,e,c.identityMat4())}}}();var fe=function(){const t=c.mat3(),e=c.mat3();return function(s,i,r){const o=new Uint16Array(s.length),n=new Float32Array([65535/(r[0]-i[0]),65535/(r[1]-i[1])]);let a;for(a=0;a<s.length;a+=2)o[a+0]=Math.floor((s[a+0]-i[0])*n[0]),o[a+1]=Math.floor((s[a+1]-i[1])*n[1]);c.identityMat3(t),c.translationMat3v(i,t),c.identityMat3(e),c.scalingMat3v([(r[0]-i[0])/65535,(r[1]-i[1])/65535],e);return{quantized:o,decodeMatrix:c.mulMat3(t,e,c.identityMat3())}}}();function ge(t,e,s,i){let r=t[e]/(Math.abs(t[e])+Math.abs(t[e+1])+Math.abs(t[e+2])),o=t[e+1]/(Math.abs(t[e])+Math.abs(t[e+1])+Math.abs(t[e+2]));if(t[e+2]<0){let t=(1-Math.abs(o))*(r>=0?1:-1),e=(1-Math.abs(r))*(o>=0?1:-1);r=t,o=e}return new Int8Array([Math[s](127.5*r+(r<0?-1:0)),Math[i](127.5*o+(o<0?-1:0))])}function _e(t){let e=t[0],s=t[1];e/=e<0?127:128,s/=s<0?127:128;const i=1-Math.abs(e)-Math.abs(s);i<0&&(e=(1-Math.abs(s))*(e>=0?1:-1),s=(1-Math.abs(e))*(s>=0?1:-1));const r=Math.sqrt(e*e+s*s+i*i);return[e/r,s/r,i/r]}function ye(t,e,s){return t[e]*s[0]+t[e+1]*s[1]+t[e+2]*s[2]}const ve={getPositionsBounds:function(t){const e=new Float32Array(3),s=new Float32Array(3);let i,r;for(i=0;i<3;i++)e[i]=Number.MAX_VALUE,s[i]=-Number.MAX_VALUE;for(i=0;i<t.length;i+=3)for(r=0;r<3;r++)e[r]=Math.min(e[r],t[i+r]),s[r]=Math.max(s[r],t[i+r]);return{min:e,max:s}},createPositionsDecodeMatrix:de,compressPositions:me,decompressPositions:function(t,e,s=new Float32Array(t.length)){for(let i=0,r=t.length;i<r;i+=3)s[i+0]=t[i+0]*e[0]+e[12],s[i+1]=t[i+1]*e[5]+e[13],s[i+2]=t[i+2]*e[10]+e[14];return s},decompressPosition:function(t,e,s){return s[0]=t[0]*e[0]+e[12],s[1]=t[1]*e[5]+e[13],s[2]=t[2]*e[10]+e[14],s},decompressAABB:function(t,e,s=t){return s[0]=t[0]*e[0]+e[12],s[1]=t[1]*e[5]+e[13],s[2]=t[2]*e[10]+e[14],s[3]=t[3]*e[0]+e[12],s[4]=t[4]*e[5]+e[13],s[5]=t[5]*e[10]+e[14],s},getUVBounds:function(t){const e=new Float32Array(2),s=new Float32Array(2);let i,r;for(i=0;i<2;i++)e[i]=Number.MAX_VALUE,s[i]=-Number.MAX_VALUE;for(i=0;i<t.length;i+=2)for(r=0;r<2;r++)e[r]=Math.min(e[r],t[i+r]),s[r]=Math.max(s[r],t[i+r]);return{min:e,max:s}},compressUVs:fe,decompressUVs:function(t,e,s=new Float32Array(t.length)){for(let i=0,r=t.length;i<r;i+=3)s[i+0]=t[i+0]*e[0]+e[6],s[i+1]=t[i+1]*e[4]+e[7];return s},decompressUV:function(t,e,s){s[0]=t[0]*e[0]+e[6],s[1]=t[1]*e[4]+e[7]},compressNormals:function(t){const e=new Int8Array(t.length);let s,i,r,o,n;for(let a=0;a<t.length;a+=3)r=s=ge(t,a,"floor","floor"),i=_e(s),o=n=ye(t,a,i),s=ge(t,a,"ceil","floor"),i=_e(s),o=ye(t,a,i),o>n&&(r=s,n=o),s=ge(t,a,"floor","ceil"),i=_e(s),o=ye(t,a,i),o>n&&(r=s,n=o),s=ge(t,a,"ceil","ceil"),i=_e(s),o=ye(t,a,i),o>n&&(r=s,n=o),e[a]=r[0],e[a+1]=r[1];return e},decompressNormals:function(t,e){for(let s=0,i=0,r=t.length;s<r;s+=2){let r=t[s+0],o=t[s+1];r=(2*r+1)/255,o=(2*o+1)/255;const n=1-Math.abs(r)-Math.abs(o);n<0&&(r=(1-Math.abs(o))*(r>=0?1:-1),o=(1-Math.abs(r))*(o>=0?1:-1));const a=Math.sqrt(r*r+o*o+n*n);e[i+0]=r/a,e[i+1]=o/a,e[i+2]=n/a,i+=3}return e},decompressNormal:function(t,e){let s=t[0],i=t[1];s=(2*s+1)/255,i=(2*i+1)/255;const r=1-Math.abs(s)-Math.abs(i);r<0&&(s=(1-Math.abs(i))*(s>=0?1:-1),i=(1-Math.abs(s))*(i>=0?1:-1));const o=Math.sqrt(s*s+i*i+r*r);return e[0]=s/o,e[1]=i/o,e[2]=r/o,e}},be=m.memory,Pe=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint,Te=Pe?Uint32Array:Uint16Array,we=c.AABB3();class xe extends pe{get type(){return"ReadableGeometry"}get isReadableGeometry(){return!0}constructor(t,e={}){super(t,e),this._state=new zt({compressGeometry:!!e.compressGeometry,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=e.edgeThreshold||10,this._edgeIndicesBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._aabbDirty=!0,this._boundingSphere=!0,this._aabb=null,this._aabbDirty=!0,this._obb=null,this._obbDirty=!0;const s=this._state,i=this.scene.canvas.gl;switch(e.primitive=e.primitive||"triangles",e.primitive){case"points":s.primitive=i.POINTS,s.primitiveName=e.primitive;break;case"lines":s.primitive=i.LINES,s.primitiveName=e.primitive;break;case"line-loop":s.primitive=i.LINE_LOOP,s.primitiveName=e.primitive;break;case"line-strip":s.primitive=i.LINE_STRIP,s.primitiveName=e.primitive;break;case"triangles":s.primitive=i.TRIANGLES,s.primitiveName=e.primitive;break;case"triangle-strip":s.primitive=i.TRIANGLE_STRIP,s.primitiveName=e.primitive;break;case"triangle-fan":s.primitive=i.TRIANGLE_FAN,s.primitiveName=e.primitive;break;default:this.error("Unsupported value for 'primitive': '"+e.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=i.TRIANGLES,s.primitiveName=e.primitive}if(e.positions)if(this._state.compressGeometry){const t=ve.getPositionsBounds(e.positions),i=ve.compressPositions(e.positions,t.min,t.max);s.positions=i.quantized,s.positionsDecodeMatrix=i.decodeMatrix}else s.positions=e.positions.constructor===Float32Array?e.positions:new Float32Array(e.positions);if(e.colors&&(s.colors=e.colors.constructor===Float32Array?e.colors:new Float32Array(e.colors)),e.uv)if(this._state.compressGeometry){const t=ve.getUVBounds(e.uv),i=ve.compressUVs(e.uv,t.min,t.max);s.uv=i.quantized,s.uvDecodeMatrix=i.decodeMatrix}else s.uv=e.uv.constructor===Float32Array?e.uv:new Float32Array(e.uv);if(e.normals&&(this._state.compressGeometry?s.normals=ve.compressNormals(e.normals):s.normals=e.normals.constructor===Float32Array?e.normals:new Float32Array(e.normals)),e.indices){if(!Pe&&e.indices.constructor===Uint32Array)return void this.error("This WebGL implementation does not support Uint32Array");s.indices=e.indices.constructor===Uint32Array||e.indices.constructor===Uint16Array?e.indices:new Te(e.indices),"triangles"===this._state.primitiveName&&(this._numTriangles=e.indices.length/3)}this._buildHash(),be.meshes++,this._buildVBOs()}_buildVBOs(){const t=this._state,e=this.scene.canvas.gl;if(t.indices&&(t.indicesBuf=new Dt(e,e.ELEMENT_ARRAY_BUFFER,t.indices,t.indices.length,1,e.STATIC_DRAW),be.indices+=t.indicesBuf.numItems),t.positions&&(t.positionsBuf=new Dt(e,e.ARRAY_BUFFER,t.positions,t.positions.length,3,e.STATIC_DRAW),be.positions+=t.positionsBuf.numItems),t.normals){let s=t.compressGeometry;t.normalsBuf=new Dt(e,e.ARRAY_BUFFER,t.normals,t.normals.length,3,e.STATIC_DRAW,s),be.normals+=t.normalsBuf.numItems}t.colors&&(t.colorsBuf=new Dt(e,e.ARRAY_BUFFER,t.colors,t.colors.length,4,e.STATIC_DRAW),be.colors+=t.colorsBuf.numItems),t.uv&&(t.uvBuf=new Dt(e,e.ARRAY_BUFFER,t.uv,t.uv.length,2,e.STATIC_DRAW),be.uvs+=t.uvBuf.numItems)}_buildHash(){const t=this._state,e=["/g"];e.push("/"+t.primitive+";"),t.positions&&e.push("p"),t.colors&&e.push("c"),(t.normals||t.autoVertexNormals)&&e.push("n"),t.uv&&e.push("u"),t.compressGeometry&&e.push("cp"),e.push(";"),t.hash=e.join("")}_getEdgeIndices(){return this._edgeIndicesBuf||this._buildEdgeIndices(),this._edgeIndicesBuf}_getPickTrianglePositions(){return this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs(),this._pickTrianglePositionsBuf}_getPickTriangleColors(){return this._pickTriangleColorsBuf||this._buildPickTriangleVBOs(),this._pickTriangleColorsBuf}_buildEdgeIndices(){const t=this._state;if(!t.positions||!t.indices)return;const e=this.scene.canvas.gl,s=ce(t.positions,t.indices,t.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new Dt(e,e.ELEMENT_ARRAY_BUFFER,s,s.length,1,e.STATIC_DRAW),be.indices+=this._edgeIndicesBuf.numItems}_buildPickTriangleVBOs(){const t=this._state;if(!t.positions||!t.indices)return;const e=this.scene.canvas.gl,s=c.buildPickTriangles(t.positions,t.indices,t.compressGeometry),i=s.positions,r=s.colors;this._pickTrianglePositionsBuf=new Dt(e,e.ARRAY_BUFFER,i,i.length,3,e.STATIC_DRAW),this._pickTriangleColorsBuf=new Dt(e,e.ARRAY_BUFFER,r,r.length,4,e.STATIC_DRAW,!0),be.positions+=this._pickTrianglePositionsBuf.numItems,be.colors+=this._pickTriangleColorsBuf.numItems}_buildPickVertexVBOs(){}_webglContextLost(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextLost()}_webglContextRestored(){this._sceneVertexBufs&&this._sceneVertexBufs.webglContextRestored(),this._buildVBOs(),this._edgeIndicesBuf=null,this._pickVertexPositionsBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._pickVertexPositionsBuf=null,this._pickVertexColorsBuf=null}get primitive(){return this._state.primitiveName}get compressGeometry(){return this._state.compressGeometry}get positions(){return this._state.positions?this._state.compressGeometry?(this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),ve.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions)),this._decompressedPositions):this._state.positions:null}set positions(t){const e=this._state,s=e.positions;if(s)if(s.length===t.length){if(this._state.compressGeometry){const s=ve.getPositionsBounds(t),i=ve.compressPositions(t,s.min,s.max);t=i.quantized,e.positionsDecodeMatrix=i.decodeMatrix}s.set(t),e.positionsBuf&&e.positionsBuf.setData(s),this._setAABBDirty(),this.glRedraw()}else this.error("can't update geometry positions - new positions are wrong length");else this.error("can't update geometry positions - geometry has no positions")}get normals(){if(this._state.normals){if(!this._state.compressGeometry)return this._state.normals;if(!this._decompressedNormals){const t=this._state.normals.length,e=t+t/2;this._decompressedNormals=new Float32Array(e),ve.decompressNormals(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}}set normals(t){if(this._state.compressGeometry)return void this.error("can't update geometry normals - quantized geometry is immutable");const e=this._state,s=e.normals;s?s.length===t.length?(s.set(t),e.normalsBuf&&e.normalsBuf.setData(s),this.glRedraw()):this.error("can't update geometry normals - new normals are wrong length"):this.error("can't update geometry normals - geometry has no normals")}get uv(){return this._state.uv?this._state.compressGeometry?(this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),ve.decompressUVs(this._state.uv,this._state.uvDecodeMatrix,this._decompressedUV)),this._decompressedUV):this._state.uv:null}set uv(t){if(this._state.compressGeometry)return void this.error("can't update geometry UVs - quantized geometry is immutable");const e=this._state,s=e.uv;s?s.length===t.length?(s.set(t),e.uvBuf&&e.uvBuf.setData(s),this.glRedraw()):this.error("can't update geometry UVs - new UVs are wrong length"):this.error("can't update geometry UVs - geometry has no UVs")}get colors(){return this._state.colors}set colors(t){if(this._state.compressGeometry)return void this.error("can't update geometry colors - quantized geometry is immutable");const e=this._state,s=e.colors;s?s.length===t.length?(s.set(t),e.colorsBuf&&e.colorsBuf.setData(s),this.glRedraw()):this.error("can't update geometry colors - new colors are wrong length"):this.error("can't update geometry colors - geometry has no colors")}get indices(){return this._state.indices}get aabb(){return this._aabbDirty&&(this._aabb||(this._aabb=c.AABB3()),c.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),this._aabbDirty=!1),this._aabb}get obb(){return this._obbDirty&&(this._obb||(this._obb=c.OBB3()),c.positions3ToAABB3(this._state.positions,we,this._state.positionsDecodeMatrix),c.AABB3ToOBB3(we,this._obb),this._obbDirty=!1),this._obb}get numTriangles(){return this._numTriangles}_setAABBDirty(){this._aabbDirty||(this._aabbDirty=!0,this._aabbDirty=!0,this._obbDirty=!0)}_getState(){return this._state}destroy(){super.destroy();const t=this._state;t.indicesBuf&&t.indicesBuf.destroy(),t.positionsBuf&&t.positionsBuf.destroy(),t.normalsBuf&&t.normalsBuf.destroy(),t.uvBuf&&t.uvBuf.destroy(),t.colorsBuf&&t.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy(),this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy(),this._pickVertexPositionsBuf&&this._pickVertexPositionsBuf.destroy(),this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy(),t.destroy(),be.meshes--}}function Me(t={}){let e=t.xSize||1;e<0&&(console.error("negative xSize not allowed - will invert"),e*=-1);let s=t.ySize||1;s<0&&(console.error("negative ySize not allowed - will invert"),s*=-1);let i=t.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);const r=t.center,o=r?r[0]:0,n=r?r[1]:0,a=r?r[2]:0,h=-e+o,l=-s+n,u=-i+a,p=e+o,c=s+n,d=i+a;return _.apply(t,{positions:[p,c,d,h,c,d,h,l,d,p,l,d,p,c,d,p,l,d,p,l,u,p,c,u,p,c,d,p,c,u,h,c,u,h,c,d,h,c,d,h,c,u,h,l,u,h,l,d,h,l,u,p,l,u,p,l,d,h,l,d,p,l,u,h,l,u,h,c,u,p,c,u],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}class De extends A{get type(){return"Material"}constructor(t,e={}){super(t,e),m.memory.materials++}destroy(){super.destroy(),m.memory.materials--}}const Ee={opaque:0,mask:1,blend:2},Ie=["opaque","mask","blend"];class Se extends De{get type(){return"PhongMaterial"}constructor(t,e={}){super(t,e),this._state=new zt({type:"PhongMaterial",ambient:c.vec3([1,1,1]),diffuse:c.vec3([1,1,1]),specular:c.vec3([1,1,1]),emissive:c.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.ambient=e.ambient,this.diffuse=e.diffuse,this.specular=e.specular,this.emissive=e.emissive,this.alpha=e.alpha,this.shininess=e.shininess,this.reflectivity=e.reflectivity,this.lineWidth=e.lineWidth,this.pointSize=e.pointSize,e.ambientMap&&(this._ambientMap=this._checkComponent("Texture",e.ambientMap)),e.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",e.diffuseMap)),e.specularMap&&(this._specularMap=this._checkComponent("Texture",e.specularMap)),e.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",e.emissiveMap)),e.alphaMap&&(this._alphaMap=this._checkComponent("Texture",e.alphaMap)),e.reflectivityMap&&(this._reflectivityMap=this._checkComponent("Texture",e.reflectivityMap)),e.normalMap&&(this._normalMap=this._checkComponent("Texture",e.normalMap)),e.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",e.occlusionMap)),e.diffuseFresnel&&(this._diffuseFresnel=this._checkComponent("Fresnel",e.diffuseFresnel)),e.specularFresnel&&(this._specularFresnel=this._checkComponent("Fresnel",e.specularFresnel)),e.emissiveFresnel&&(this._emissiveFresnel=this._checkComponent("Fresnel",e.emissiveFresnel)),e.alphaFresnel&&(this._alphaFresnel=this._checkComponent("Fresnel",e.alphaFresnel)),e.reflectivityFresnel&&(this._reflectivityFresnel=this._checkComponent("Fresnel",e.reflectivityFresnel)),this.alphaMode=e.alphaMode,this.alphaCutoff=e.alphaCutoff,this.backfaces=e.backfaces,this.frontface=e.frontface,this._makeHash()}_makeHash(){const t=this._state,e=["/p"];this._normalMap&&(e.push("/nm"),this._normalMap.hasMatrix&&e.push("/mat")),this._ambientMap&&(e.push("/am"),this._ambientMap.hasMatrix&&e.push("/mat"),e.push("/"+this._ambientMap.encoding)),this._diffuseMap&&(e.push("/dm"),this._diffuseMap.hasMatrix&&e.push("/mat"),e.push("/"+this._diffuseMap.encoding)),this._specularMap&&(e.push("/sm"),this._specularMap.hasMatrix&&e.push("/mat")),this._emissiveMap&&(e.push("/em"),this._emissiveMap.hasMatrix&&e.push("/mat"),e.push("/"+this._emissiveMap.encoding)),this._alphaMap&&(e.push("/opm"),this._alphaMap.hasMatrix&&e.push("/mat")),this._reflectivityMap&&(e.push("/rm"),this._reflectivityMap.hasMatrix&&e.push("/mat")),this._occlusionMap&&(e.push("/ocm"),this._occlusionMap.hasMatrix&&e.push("/mat")),this._diffuseFresnel&&e.push("/df"),this._specularFresnel&&e.push("/sf"),this._emissiveFresnel&&e.push("/ef"),this._alphaFresnel&&e.push("/of"),this._reflectivityFresnel&&e.push("/rf"),e.push(";"),t.hash=e.join("")}set ambient(t){let e=this._state.ambient;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.ambient=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=.2,e[1]=.2,e[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set diffuse(t){let e=this._state.diffuse;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.diffuse=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}set specular(t){let e=this._state.specular;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.specular=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),this.glRedraw()}get specular(){return this._state.specular}set emissive(t){let e=this._state.emissive;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.emissive=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=0,e[1]=0,e[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(t){t=null!=t?t:1,this._state.alpha!==t&&(this._state.alpha=t,this.glRedraw())}get alpha(){return this._state.alpha}set shininess(t){this._state.shininess=void 0!==t?t:80,this.glRedraw()}get shininess(){return this._state.shininess}set lineWidth(t){this._state.lineWidth=t||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(t){this._state.pointSize=t||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set reflectivity(t){this._state.reflectivity=void 0!==t?t:1,this.glRedraw()}get reflectivity(){return this._state.reflectivity}get normalMap(){return this._normalMap}get ambientMap(){return this._ambientMap}get diffuseMap(){return this._diffuseMap}get specularMap(){return this._specularMap}get emissiveMap(){return this._emissiveMap}get alphaMap(){return this._alphaMap}get reflectivityMap(){return this._reflectivityMap}get occlusionMap(){return this._occlusionMap}get diffuseFresnel(){return this._diffuseFresnel}get specularFresnel(){return this._specularFresnel}get emissiveFresnel(){return this._emissiveFresnel}get alphaFresnel(){return this._alphaFresnel}get reflectivityFresnel(){return this._reflectivityFresnel}set alphaMode(t){let e=Ee[t=t||"opaque"];void 0===e&&(this.error("Unsupported value for 'alphaMode': "+t+" - defaulting to 'opaque'"),e="opaque"),this._state.alphaMode!==e&&(this._state.alphaMode=e,this.glRedraw())}get alphaMode(){return Ie[this._state.alphaMode]}set alphaCutoff(t){null==t&&(t=.5),this._state.alphaCutoff!==t&&(this._state.alphaCutoff=t)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(t){t=!!t,this._state.backfaces!==t&&(this._state.backfaces=t,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(t){t="cw"!==t,this._state.frontface!==t&&(this._state.frontface=t,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}destroy(){super.destroy(),this._state.destroy()}}const Ae={default:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultWhiteBG:{fill:!0,fillColor:[1,1,1],fillAlpha:.6,edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultDarkBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1},phosphorous:{fill:!0,fillColor:[0,0,0],fillAlpha:.4,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2},sunset:{fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1},vectorscope:{fill:!0,fillColor:[0,0,0],fillAlpha:.7,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2},battlezone:{fill:!0,fillColor:[0,0,0],fillAlpha:1,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3},sepia:{fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},yellowHighlight:{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},greenSelected:{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[.4577854573726654,.529411792755127,.4100345969200134],edgeAlpha:1,edgeWidth:1},gamegrid:{fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9,edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3}};class Ce extends De{get type(){return"EmphasisMaterial"}get presets(){return Ae}constructor(t,e={}){super(t,e),this._state=new zt({type:"EmphasisMaterial",fill:null,fillColor:null,fillAlpha:null,edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,backfaces:!0}),this._preset="default",e.preset?(this.preset=e.preset,void 0!==e.fill&&(this.fill=e.fill),e.fillColor&&(this.fillColor=e.fillColor),void 0!==e.fillAlpha&&(this.fillAlpha=e.fillAlpha),void 0!==e.edges&&(this.edges=e.edges),e.edgeColor&&(this.edgeColor=e.edgeColor),void 0!==e.edgeAlpha&&(this.edgeAlpha=e.edgeAlpha),void 0!==e.edgeWidth&&(this.edgeWidth=e.edgeWidth),void 0!==e.backfaces&&(this.backfaces=e.backfaces)):(this.fill=e.fill,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.edges=e.edges,this.edgeColor=e.edgeColor,this.edgeAlpha=e.edgeAlpha,this.edgeWidth=e.edgeWidth,this.backfaces=e.backfaces)}set fill(t){t=!1!==t,this._state.fill!==t&&(this._state.fill=t,this.glRedraw())}get fill(){return this._state.fill}set fillColor(t){let e=this._state.fillColor;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.fillColor=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=.4,e[1]=.4,e[2]=.4),this.glRedraw()}get fillColor(){return this._state.fillColor}set fillAlpha(t){t=null!=t?t:.2,this._state.fillAlpha!==t&&(this._state.fillAlpha=t,this.glRedraw())}get fillAlpha(){return this._state.fillAlpha}set edges(t){t=!1!==t,this._state.edges!==t&&(this._state.edges=t,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(t){let e=this._state.edgeColor;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.edgeColor=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=.2,e[1]=.2,e[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(t){t=null!=t?t:.5,this._state.edgeAlpha!==t&&(this._state.edgeAlpha=t,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(t){this._state.edgeWidth=t||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set backfaces(t){t=!!t,this._state.backfaces!==t&&(this._state.backfaces=t,this.glRedraw())}get backfaces(){return this._state.backfaces}set preset(t){if(t=t||"default",this._preset===t)return;const e=Ae[t];e?(this.fill=e.fill,this.fillColor=e.fillColor,this.fillAlpha=e.fillAlpha,this.edges=e.edges,this.edgeColor=e.edgeColor,this.edgeAlpha=e.edgeAlpha,this.edgeWidth=e.edgeWidth,this._preset=t):this.error("unsupported preset: '"+t+"' - supported values are "+Object.keys(Ae).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}const Fe={default:{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}};class Oe extends De{get type(){return"EdgeMaterial"}get presets(){return Fe}constructor(t,e={}){super(t,e),this._state=new zt({type:"EdgeMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null}),this._preset="default",e.preset?(this.preset=e.preset,e.edgeColor&&(this.edgeColor=e.edgeColor),void 0!==e.edgeAlpha&&(this.edgeAlpha=e.edgeAlpha),void 0!==e.edgeWidth&&(this.edgeWidth=e.edgeWidth)):(this.edgeColor=e.edgeColor,this.edgeAlpha=e.edgeAlpha,this.edgeWidth=e.edgeWidth),this.edges=!1!==e.edges}set edges(t){t=!1!==t,this._state.edges!==t&&(this._state.edges=t,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(t){let e=this._state.edgeColor;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.edgeColor=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=.2,e[1]=.2,e[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(t){t=null!=t?t:1,this._state.edgeAlpha!==t&&(this._state.edgeAlpha=t,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(t){this._state.edgeWidth=t||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set preset(t){if(t=t||"default",this._preset===t)return;const e=Fe[t];e?(this.edgeColor=e.edgeColor,this.edgeAlpha=e.edgeAlpha,this.edgeWidth=e.edgeWidth,this._preset=t):this.error("unsupported preset: '"+t+"' - supported values are "+Object.keys(Fe).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}const Re={meters:{abbrev:"m"},metres:{abbrev:"m"},centimeters:{abbrev:"cm"},centimetres:{abbrev:"cm"},millimeters:{abbrev:"mm"},millimetres:{abbrev:"mm"},yards:{abbrev:"yd"},feet:{abbrev:"ft"},inches:{abbrev:"in"}};class Le extends A{constructor(t,e={}){super(t,e),this._units="meters",this._scale=1,this._origin=c.vec3([0,0,0]),this.units=e.units,this.scale=e.scale,this.origin=e.origin}get unitsInfo(){return Re}set units(t){t||(t="meters");Re[t]||(this.error("Unsupported value for 'units': "+t+" defaulting to 'meters'"),t="meters"),this._units=t,this.fire("units",this._units)}get units(){return this._units}set scale(t){(t=t||1)<=0?this.error("scale value should be larger than zero"):(this._scale=t,this.fire("scale",this._scale))}get scale(){return this._scale}set origin(t){if(!t)return this._origin[0]=0,this._origin[1]=0,void(this._origin[2]=0);this._origin[0]=t[0],this._origin[1]=t[1],this._origin[2]=t[2],this.fire("origin",this._origin)}get origin(){return this._origin}worldToRealPos(t,e=c.vec3(3)){e[0]=this._origin[0]+this._scale*t[0],e[1]=this._origin[1]+this._scale*t[1],e[2]=this._origin[2]+this._scale*t[2]}realToWorldPos(t,e=c.vec3(3)){return e[0]=(t[0]-this._origin[0])/this._scale,e[1]=(t[1]-this._origin[1])/this._scale,e[2]=(t[2]-this._origin[2])/this._scale,e}}class Ne extends A{constructor(t,e={}){super(t,e);const s=navigator.userAgent.match(/(opera|chrome|safari|firefox|msie|mobile)\/?\s*(\.?\d+(\.\d+)*)/i),i=s&&"safari"===s[1].toLowerCase();this._supported=!i&&pt.SUPPORTED_EXTENSIONS.OES_standard_derivatives,this.enabled=e.enabled,this.kernelRadius=e.kernelRadius,this.intensity=e.intensity,this.bias=e.bias,this.scale=e.scale,this.minResolution=e.minResolution,this.numSamples=e.numSamples,this.blur=e.blur,this.blendCutoff=e.blendCutoff,this.blendFactor=e.blendFactor}get supported(){return this._supported}set enabled(t){t=!!t,this._enabled!==t&&(this._enabled=t,this.glRedraw())}get enabled(){return this._enabled}get possible(){if(!this._supported)return!1;if(!this._enabled)return!1;const t=this.scene.camera.projection;return"customProjection"!==t&&"frustum"!==t}get active(){return this._active}set kernelRadius(t){null==t&&(t=100),this._kernelRadius!==t&&(this._kernelRadius=t,this.glRedraw())}get kernelRadius(){return this._kernelRadius}set intensity(t){null==t&&(t=.15),this._intensity!==t&&(this._intensity=t,this.glRedraw())}get intensity(){return this._intensity}set bias(t){null==t&&(t=.5),this._bias!==t&&(this._bias=t,this.glRedraw())}get bias(){return this._bias}set scale(t){null==t&&(t=1),this._scale!==t&&(this._scale=t,this.glRedraw())}get scale(){return this._scale}set minResolution(t){null==t&&(t=0),this._minResolution!==t&&(this._minResolution=t,this.glRedraw())}get minResolution(){return this._minResolution}set numSamples(t){null==t&&(t=10),this._numSamples!==t&&(this._numSamples=t,this.glRedraw())}get numSamples(){return this._numSamples}set blur(t){t=!1!==t,this._blur!==t&&(this._blur=t,this.glRedraw())}get blur(){return this._blur}set blendCutoff(t){null==t&&(t=.3),this._blendCutoff!==t&&(this._blendCutoff=t,this.glRedraw())}get blendCutoff(){return this._blendCutoff}set blendFactor(t){null==t&&(t=1),this._blendFactor!==t&&(this._blendFactor=t,this.glRedraw())}get blendFactor(){return this._blendFactor}destroy(){super.destroy()}}const Be={default:{pointSize:4,roundPoints:!0,perspectivePoints:!0},square:{pointSize:4,roundPoints:!1,perspectivePoints:!0},round:{pointSize:4,roundPoints:!0,perspectivePoints:!0}};class ke extends De{get type(){return"PointsMaterial"}get presets(){return Be}constructor(t,e={}){super(t,e),this._state=new zt({type:"PointsMaterial",pointSize:null,roundPoints:null,perspectivePoints:null,minPerspectivePointSize:null,maxPerspectivePointSize:null,filterIntensity:null,minIntensity:null,maxIntensity:null}),e.preset?(this.preset=e.preset,void 0!==e.pointSize&&(this.pointSize=e.pointSize),void 0!==e.roundPoints&&(this.roundPoints=e.roundPoints),void 0!==e.perspectivePoints&&(this.perspectivePoints=e.perspectivePoints),void 0!==e.minPerspectivePointSize&&(this.minPerspectivePointSize=e.minPerspectivePointSize),void 0!==e.maxPerspectivePointSize&&(this.maxPerspectivePointSize=e.minPerspectivePointSize)):(this._preset="default",this.pointSize=e.pointSize,this.roundPoints=e.roundPoints,this.perspectivePoints=e.perspectivePoints,this.minPerspectivePointSize=e.minPerspectivePointSize,this.maxPerspectivePointSize=e.maxPerspectivePointSize),this.filterIntensity=e.filterIntensity,this.minIntensity=e.minIntensity,this.maxIntensity=e.maxIntensity}set pointSize(t){this._state.pointSize=t||2,this.glRedraw()}get pointSize(){return this._state.pointSize}set roundPoints(t){t=!1!==t,this._state.roundPoints!==t&&(this._state.roundPoints=t,this.scene._needRecompile=!0,this.glRedraw())}get roundPoints(){return this._state.roundPoints}set perspectivePoints(t){t=!1!==t,this._state.perspectivePoints!==t&&(this._state.perspectivePoints=t,this.scene._needRecompile=!0,this.glRedraw())}get perspectivePoints(){return this._state.perspectivePoints}set minPerspectivePointSize(t){this._state.minPerspectivePointSize=t||1,this.scene._needRecompile=!0,this.glRedraw()}get minPerspectivePointSize(){return this._state.minPerspectivePointSize}set maxPerspectivePointSize(t){this._state.maxPerspectivePointSize=t||6,this.scene._needRecompile=!0,this.glRedraw()}get maxPerspectivePointSize(){return this._state.maxPerspectivePointSize}set filterIntensity(t){t=!1!==t,this._state.filterIntensity!==t&&(this._state.filterIntensity=t,this.scene._needRecompile=!0,this.glRedraw())}get filterIntensity(){return this._state.filterIntensity}set minIntensity(t){this._state.minIntensity=null!=t?t:0,this.glRedraw()}get minIntensity(){return this._state.minIntensity}set maxIntensity(t){this._state.maxIntensity=null!=t?t:1,this.glRedraw()}get maxIntensity(){return this._state.maxIntensity}set preset(t){if(t=t||"default",this._preset===t)return;const e=Be[t];e?(this.pointSize=e.pointSize,this.roundPoints=e.roundPoints,this.perspectivePoints=e.perspectivePoints,this.minPerspectivePointSize=e.minPerspectivePointSize,this.maxPerspectivePointSize=e.maxPerspectivePointSize,this._preset=t):this.error("unsupported preset: '"+t+"' - supported values are "+Object.keys(Be).join(", "))}get preset(){return this._preset}get hash(){return[this.pointSize,this.roundPoints,this.perspectivePoints,this.minPerspectivePointSize,this.maxPerspectivePointSize,this.filterIntensity].join(";")}destroy(){super.destroy(),this._state.destroy()}}const je={default:{lineWidth:1},thick:{lineWidth:2},thicker:{lineWidth:4}};class Ge extends De{get type(){return"LinesMaterial"}get presets(){return je}constructor(t,e={}){super(t,e),this._state=new zt({type:"LinesMaterial",lineWidth:null}),e.preset?(this.preset=e.preset,void 0!==e.lineWidth&&(this.lineWidth=e.lineWidth)):(this._preset="default",this.lineWidth=e.lineWidth)}set lineWidth(t){this._state.lineWidth=t||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set preset(t){if(t=t||"default",this._preset===t)return;const e=je[t];e?(this.lineWidth=e.lineWidth,this._preset=t):this.error("unsupported preset: '"+t+"' - supported values are "+Object.keys(je).join(", "))}get preset(){return this._preset}get hash(){return[""+this.lineWidth].join(";")}destroy(){super.destroy(),this._state.destroy()}}function He(t,e){const s={};let i,r;for(let o=0,n=e.length;o<n;o++)i=e[o],r=t.component[i],r?r.isEntity?s[i]=!0:t.warn("pick(): Component is not an Entity: "+i):t.warn("pick(): Component not found: "+i);return s}class Ve extends A{get type(){return"Scene"}constructor(t,e={}){super(null,e);const s=e.canvasElement||document.getElementById(e.canvasId);if(!(s instanceof HTMLCanvasElement))throw"Mandatory config expected: valid canvasId or canvasElement";const i=!!e.transparent,r=!!e.alphaDepthMask;this._aabbDirty=!0,this.viewer=t,this.occlusionTestCountdown=0,this.loading=0,this.startTime=(new Date).getTime(),this.models={},this.objects={},this._numObjects=0,this.visibleObjects={},this._numVisibleObjects=0,this.xrayedObjects={},this._numXRayedObjects=0,this.highlightedObjects={},this._numHighlightedObjects=0,this.selectedObjects={},this._numSelectedObjects=0,this.colorizedObjects={},this._numColorizedObjects=0,this.opacityObjects={},this._numOpacityObjects=0,this.offsetObjects={},this._numOffsetObjects=0,this._modelIds=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this._opacityObjectIds=null,this._offsetObjectIds=null,this._collidables={},this._compilables={},this._needRecompile=!1,this.types={},this.components={},this.sectionPlanes={},this.lights={},this.lightMaps={},this.reflectionMaps={},this.realWorldOffset=e.realWorldOffset||new Float64Array([0,0,0]),this.canvas=new mt(this,{dontClear:!0,canvas:s,spinnerElementId:e.spinnerElementId,transparent:i,webgl2:!1!==e.webgl2,contextAttr:e.contextAttr||{},backgroundColor:e.backgroundColor,backgroundColorFromAmbientLight:e.backgroundColorFromAmbientLight,premultipliedAlpha:e.premultipliedAlpha}),this.canvas.on("boundary",(()=>{this.glRedraw()})),this.canvas.on("webglContextFailed",(()=>{alert("xeokit failed to find WebGL!")})),this._renderer=new Gt(this,{transparent:i,alphaDepthMask:r}),this._sectionPlanesState=new function(){this.sectionPlanes=[],this.clippingCaps=!1;let t=null;this.getHash=function(){if(t)return t;const e=this.sectionPlanes;if(0===e.length)return this.hash=";";const s=[];for(let t=0,i=e.length;t<i;t++)e[t],s.push("cp");return s.push(";"),t=s.join(""),t},this.addSectionPlane=function(e){this.sectionPlanes.push(e),t=null},this.removeSectionPlane=function(e){for(let s=0,i=this.sectionPlanes.length;s<i;s++)if(this.sectionPlanes[s].id===e.id)return this.sectionPlanes.splice(s,1),void(t=null)}},this._lightsState=new function(){const t=c.vec4([0,0,0,0]),e=c.vec4();this.lights=[],this.reflectionMaps=[],this.lightMaps=[];let s=null,i=null;this.getHash=function(){if(s)return s;const t=[],e=this.lights;let i;for(let s=0,r=e.length;s<r;s++)i=e[s],t.push("/"),t.push(i.type),t.push("world"===i.space?"w":"v"),i.castsShadow&&t.push("sh");return this.lightMaps.length>0&&t.push("/lm"),this.reflectionMaps.length>0&&t.push("/rm"),t.push(";"),s=t.join(""),s},this.addLight=function(t){this.lights.push(t),i=null,s=null},this.removeLight=function(t){for(let e=0,r=this.lights.length;e<r;e++){if(this.lights[e].id===t.id)return this.lights.splice(e,1),i&&i.id===t.id&&(i=null),void(s=null)}},this.addReflectionMap=function(t){this.reflectionMaps.push(t),s=null},this.removeReflectionMap=function(t){for(let e=0,i=this.reflectionMaps.length;e<i;e++)if(this.reflectionMaps[e].id===t.id)return this.reflectionMaps.splice(e,1),void(s=null)},this.addLightMap=function(t){this.lightMaps.push(t),s=null},this.removeLightMap=function(t){for(let e=0,i=this.lightMaps.length;e<i;e++)if(this.lightMaps[e].id===t.id)return this.lightMaps.splice(e,1),void(s=null)},this.getAmbientColorAndIntensity=function(){if(!i)for(let t=0,e=this.lights.length;t<e;t++){const e=this.lights[t];if("ambient"===e.type){i=e;break}}if(i){const t=i.color,s=i.intensity;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=s,e}return t}},this.input=new Ht(this,{dontClear:!0,element:this.canvas.canvas,keyboardEventsElement:e.keyboardEventsElement}),this.metrics=new Le(this,{units:e.units,scale:e.scale,origin:e.origin}),this.sao=new Ne(this,{enabled:e.saoEnabled}),this.ticksPerRender=e.ticksPerRender,this.ticksPerOcclusionTest=e.ticksPerOcclusionTest,this.passes=e.passes,this.clearEachPass=e.clearEachPass,this.gammaInput=e.gammaInput,this.gammaOutput=e.gammaOutput,this.gammaFactor=e.gammaFactor,this._entityOffsetsEnabled=!!e.entityOffsetsEnabled,this._pickSurfacePrecisionEnabled=!!e.pickSurfacePrecisionEnabled,this._logarithmicDepthBufferEnabled=!!e.logarithmicDepthBufferEnabled,this._pbrEnabled=!!e.pbrEnabled,I._addScene(this),this._initDefaults(),this._viewport=new Ut(this,{id:"default.viewport",autoBoundary:!0,dontClear:!0}),this._camera=new ae(this,{id:"default.camera",dontClear:!0}),new ue(this,{color:[1,1,1],intensity:.7}),new le(this,{dir:[.8,-.5,-.5],color:[.67,.67,1],intensity:.7,space:"world"}),new le(this,{dir:[-.8,-1,.5],color:[1,1,.9],intensity:.9,space:"world"}),this._camera.on("dirty",(()=>{this._renderer.imageDirty()}))}_initDefaults(){this.geometry,this.material,this.xrayMaterial,this.edgeMaterial,this.selectedMaterial,this.highlightMaterial}_addComponent(t){if(t.id&&this.components[t.id]&&(this.error("Component "+_.inQuotes(t.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),t.id=null),!t.id)for(void 0===window.nextID&&(window.nextID=0),t.id="__"+window.nextID++;this.components[t.id];)t.id=c.createUUID();this.components[t.id]=t;const e=t.type;let s=this.types[t.type];s||(s=this.types[e]={}),s[t.id]=t,t.compile&&(this._compilables[t.id]=t),t.isDrawable&&(this._renderer.addDrawable(t.id,t),this._collidables[t.id]=t)}_removeComponent(t){var e=t.id,s=t.type;delete this.components[e];const i=this.types[s];i&&(delete i[e],_.isEmptyObject(i)&&delete this.types[s]),t.compile&&delete this._compilables[t.id],t.isDrawable&&(this._renderer.removeDrawable(t.id),delete this._collidables[t.id])}_sectionPlaneCreated(t){this.sectionPlanes[t.id]=t,this.scene._sectionPlanesState.addSectionPlane(t._state),this.scene.fire("sectionPlaneCreated",t,!0),this._needRecompile=!0}_lightCreated(t){this.lights[t.id]=t,this.scene._lightsState.addLight(t._state),this._needRecompile=!0}_lightMapCreated(t){this.lightMaps[t.id]=t,this.scene._lightsState.addLightMap(t._state),this._needRecompile=!0}_reflectionMapCreated(t){this.reflectionMaps[t.id]=t,this.scene._lightsState.addReflectionMap(t._state),this._needRecompile=!0}_sectionPlaneDestroyed(t){delete this.sectionPlanes[t.id],this.scene._sectionPlanesState.removeSectionPlane(t._state),this.scene.fire("sectionPlaneDestroyed",t,!0),this._needRecompile=!0}_lightDestroyed(t){delete this.lights[t.id],this.scene._lightsState.removeLight(t._state),this._needRecompile=!0}_lightMapDestroyed(t){delete this.lightMaps[t.id],this.scene._lightsState.removeLightMap(t._state),this._needRecompile=!0}_reflectionMapDestroyed(t){delete this.reflectionMaps[t.id],this.scene._lightsState.removeReflectionMap(t._state),this._needRecompile=!0}_registerModel(t){this.models[t.id]=t,this._modelIds=null}_deregisterModel(t){const e=t.id;delete this.models[e],this._modelIds=null,this.fire("modelUnloaded",e)}_registerObject(t){this.objects[t.id]=t,this._numObjects++,this._objectIds=null}_deregisterObject(t){delete this.objects[t.id],this._numObjects--,this._objectIds=null}_objectVisibilityUpdated(t,e=!0){t.visible?(this.visibleObjects[t.id]=t,this._numVisibleObjects++):(delete this.visibleObjects[t.id],this._numVisibleObjects--),this._visibleObjectIds=null,e&&this.fire("objectVisibility",t,!0)}_objectXRayedUpdated(t){t.xrayed?(this.xrayedObjects[t.id]=t,this._numXRayedObjects++):(delete this.xrayedObjects[t.id],this._numXRayedObjects--),this._xrayedObjectIds=null}_objectHighlightedUpdated(t){t.highlighted?(this.highlightedObjects[t.id]=t,this._numHighlightedObjects++):(delete this.highlightedObjects[t.id],this._numHighlightedObjects--),this._highlightedObjectIds=null}_objectSelectedUpdated(t){t.selected?(this.selectedObjects[t.id]=t,this._numSelectedObjects++):(delete this.selectedObjects[t.id],this._numSelectedObjects--),this._selectedObjectIds=null}_objectColorizeUpdated(t,e){e?(this.colorizedObjects[t.id]=t,this._numColorizedObjects++):(delete this.colorizedObjects[t.id],this._numColorizedObjects--),this._colorizedObjectIds=null}_objectOpacityUpdated(t,e){e?(this.opacityObjects[t.id]=t,this._numOpacityObjects++):(delete this.opacityObjects[t.id],this._numOpacityObjects--),this._opacityObjectIds=null}_objectOffsetUpdated(t,e){!e||0===e[0]&&0===e[1]&&0===e[2]?(this.offsetObjects[t.id]=t,this._numOffsetObjects++):(delete this.offsetObjects[t.id],this._numOffsetObjects--),this._offsetObjectIds=null}_webglContextLost(){this.canvas.spinner.processes++;for(const t in this.components)if(this.components.hasOwnProperty(t)){const e=this.components[t];e._webglContextLost&&e._webglContextLost()}this._renderer.webglContextLost()}_webglContextRestored(){const t=this.canvas.gl;for(const e in this.components)if(this.components.hasOwnProperty(e)){const s=this.components[e];s._webglContextRestored&&s._webglContextRestored(t)}this._renderer.webglContextRestored(t),this.canvas.spinner.processes--}get entityOffsetsEnabled(){return this._entityOffsetsEnabled}get pickSurfacePrecisionEnabled(){return this._pickSurfacePrecisionEnabled}get logarithmicDepthBufferEnabled(){return this._logarithmicDepthBufferEnabled}set pbrEnabled(t){this._pbrEnabled=!!t,this.glRedraw()}get pbrEnabled(){return this._pbrEnabled}doOcclusionTest(){this._needRecompile&&(this._recompile(),this._needRecompile=!1),this._renderer.doOcclusionTest()}render(t){t&&I.runTasks();const e={sceneId:null,pass:0};this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),e.sceneId=this.id;const s=this._passes,i=this._clearEachPass;let r,o;for(r=0;r<s;r++)e.pass=r,this.fire("rendering",e,!0),o=i||0===r,this._renderer.render({pass:r,clear:o,force:t}),this.fire("rendered",e,!0);this._saveAmbientColor()}_recompile(){for(const t in this._compilables)this._compilables.hasOwnProperty(t)&&this._compilables[t].compile();this._renderer.shadowsDirty(),this.fire("compile",this,!0)}_saveAmbientColor(){const t=this.canvas;if(t.transparent||t.backgroundImage||t.backgroundColor)this._lastAmbientColor=null;else{const e=this._lightsState.getAmbientColorAndIntensity();this._lastAmbientColor&&this._lastAmbientColor[0]===e[0]&&this._lastAmbientColor[1]===e[1]&&this._lastAmbientColor[2]===e[2]&&this._lastAmbientColor[3]===e[3]||(t.backgroundColor=e,this._lastAmbientColor||(this._lastAmbientColor=c.vec4([0,0,0,1])),this._lastAmbientColor.set(e))}}get modelIds(){return this._modelIds||(this._modelIds=Object.keys(this.models)),this._modelIds}get numObjects(){return this._numObjects}get objectIds(){return this._objectIds||(this._objectIds=Object.keys(this.objects)),this._objectIds}get numVisibleObjects(){return this._numVisibleObjects}get visibleObjectIds(){return this._visibleObjectIds||(this._visibleObjectIds=Object.keys(this.visibleObjects)),this._visibleObjectIds}get numXRayedObjects(){return this._numXRayedObjects}get xrayedObjectIds(){return this._xrayedObjectIds||(this._xrayedObjectIds=Object.keys(this.xrayedObjects)),this._xrayedObjectIds}get numHighlightedObjects(){return this._numHighlightedObjects}get highlightedObjectIds(){return this._highlightedObjectIds||(this._highlightedObjectIds=Object.keys(this.highlightedObjects)),this._highlightedObjectIds}get numSelectedObjects(){return this._numSelectedObjects}get selectedObjectIds(){return this._selectedObjectIds||(this._selectedObjectIds=Object.keys(this.selectedObjects)),this._selectedObjectIds}get numColorizedObjects(){return this._numColorizedObjects}get colorizedObjectIds(){return this._colorizedObjectIds||(this._colorizedObjectIds=Object.keys(this.colorizedObjects)),this._colorizedObjectIds}get opacityObjectIds(){return this._opacityObjectIds||(this._opacityObjectIds=Object.keys(this.opacityObjects)),this._opacityObjectIds}get offsetObjectIds(){return this._offsetObjectIds||(this._offsetObjectIds=Object.keys(this.offsetObjects)),this._offsetObjectIds}set ticksPerRender(t){null==t?t=1:(!_.isNumeric(t)||t<=0)&&(this.error("Unsupported value for 'ticksPerRender': '"+t+"' - should be an integer greater than zero."),t=1),t!==this._ticksPerRender&&(this._ticksPerRender=t)}get ticksPerRender(){return this._ticksPerRender}set ticksPerOcclusionTest(t){null==t?t=20:(!_.isNumeric(t)||t<=0)&&(this.error("Unsupported value for 'ticksPerOcclusionTest': '"+t+"' - should be an integer greater than zero."),t=20),t!==this._ticksPerOcclusionTest&&(this._ticksPerOcclusionTest=t)}get ticksPerOcclusionTest(){return this._ticksPerOcclusionTest}set passes(t){null==t?t=1:(!_.isNumeric(t)||t<=0)&&(this.error("Unsupported value for 'passes': '"+t+"' - should be an integer greater than zero."),t=1),t!==this._passes&&(this._passes=t,this.glRedraw())}get passes(){return this._passes}set clearEachPass(t){(t=!!t)!==this._clearEachPass&&(this._clearEachPass=t,this.glRedraw())}get clearEachPass(){return this._clearEachPass}set gammaInput(t){(t=!1!==t)!==this._renderer.gammaInput&&(this._renderer.gammaInput=t,this._needRecompile=!0,this.glRedraw())}get gammaInput(){return this._renderer.gammaInput}set gammaOutput(t){(t=!!t)!==this._renderer.gammaOutput&&(this._renderer.gammaOutput=t,this._needRecompile=!0,this.glRedraw())}get gammaOutput(){return this._renderer.gammaOutput}set gammaFactor(t){(t=null==t?2.2:t)!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=t,this.glRedraw())}get gammaFactor(){return this._renderer.gammaFactor}get geometry(){return this.components["default.geometry"]||Me(xe)}get material(){return this.components["default.material"]||new Se(this,{id:"default.material",emissive:[.4,.4,.4],dontClear:!0})}get xrayMaterial(){return this.components["default.xrayMaterial"]||new Ce(this,{id:"default.xrayMaterial",preset:"sepia",dontClear:!0})}get highlightMaterial(){return this.components["default.highlightMaterial"]||new Ce(this,{id:"default.highlightMaterial",preset:"yellowHighlight",dontClear:!0})}get selectedMaterial(){return this.components["default.selectedMaterial"]||new Ce(this,{id:"default.selectedMaterial",preset:"greenSelected",dontClear:!0})}get edgeMaterial(){return this.components["default.edgeMaterial"]||new Oe(this,{id:"default.edgeMaterial",preset:"default",edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get pointsMaterial(){return this.components["default.pointsMaterial"]||new ke(this,{id:"default.pointsMaterial",preset:"default",dontClear:!0})}get linesMaterial(){return this.components["default.linesMaterial"]||new Ge(this,{id:"default.linesMaterial",preset:"default",dontClear:!0})}get viewport(){return this._viewport}get camera(){return this._camera}get center(){if(this._aabbDirty||!this._center){this._center&&this._center||(this._center=c.vec3());const t=this.aabb;this._center[0]=(t[0]+t[3])/2,this._center[1]=(t[1]+t[4])/2,this._center[2]=(t[2]+t[5])/2}return this._center}get aabb(){if(this._aabbDirty){this._aabb||(this._aabb=c.AABB3());let t,e=c.MAX_DOUBLE,s=c.MAX_DOUBLE,i=c.MAX_DOUBLE,r=c.MIN_DOUBLE,o=c.MIN_DOUBLE,n=c.MIN_DOUBLE;const a=this._collidables;let h,l=!1;for(const u in a)if(a.hasOwnProperty(u)){if(h=a[u],!1===h.collidable)continue;t=h.aabb,t[0]<e&&(e=t[0]),t[1]<s&&(s=t[1]),t[2]<i&&(i=t[2]),t[3]>r&&(r=t[3]),t[4]>o&&(o=t[4]),t[5]>n&&(n=t[5]),l=!0}l||(e=-100,s=-100,i=-100,r=100,o=100,n=100),this._aabb[0]=e,this._aabb[1]=s,this._aabb[2]=i,this._aabb[3]=r,this._aabb[4]=o,this._aabb[5]=n,this._aabbDirty=!1}return this._aabb}_setAABBDirty(){this._aabbDirty=!0,this.fire("boundary")}pick(t,e){if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;(t=t||{}).pickSurface=t.pickSurface||t.rayPick,t.canvasPos||t.matrix||t.origin&&t.direction||this.warn("picking without canvasPos, matrix, or ray origin and direction");const s=t.includeEntities||t.include;s&&(t.includeEntityIds=He(this,s));const i=t.excludeEntities||t.exclude;return i&&(t.excludeEntityIds=He(this,i)),this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),(e=this._renderer.pick(t,e))?(e.entity&&e.entity.fire&&e.entity.fire("picked",e),e):void 0}clear(){var t;for(const e in this.components)this.components.hasOwnProperty(e)&&((t=this.components[e])._dontClear||t.destroy())}clearLights(){const t=Object.keys(this.lights);for(let e=0,s=t.length;e<s;e++)this.lights[t[e]].destroy()}clearSectionPlanes(){const t=Object.keys(this.sectionPlanes);for(let e=0,s=t.length;e<s;e++)this.sectionPlanes[t[e]].destroy()}getAABB(t){if(void 0===t)return this.aabb;if(_.isString(t)){const e=this.objects[t];if(e&&e.aabb)return e.aabb;t=[t]}if(0===t.length)return this.aabb;let e,s=c.MAX_DOUBLE,i=c.MAX_DOUBLE,r=c.MAX_DOUBLE,o=c.MIN_DOUBLE,n=c.MIN_DOUBLE,a=c.MIN_DOUBLE;if(this.withObjects(t,(t=>{if(t.collidable){const h=t.aabb;h[0]<s&&(s=h[0]),h[1]<i&&(i=h[1]),h[2]<r&&(r=h[2]),h[3]>o&&(o=h[3]),h[4]>n&&(n=h[4]),h[5]>a&&(a=h[5]),e=!0}})),e){const t=c.AABB3();return t[0]=s,t[1]=i,t[2]=r,t[3]=o,t[4]=n,t[5]=a,t}return this.aabb}setObjectsVisible(t,e){return this.withObjects(t,(t=>{const s=t.visible!==e;return t.visible=e,s}))}setObjectsCollidable(t,e){return this.withObjects(t,(t=>{const s=t.collidable!==e;return t.collidable=e,s}))}setObjectsCulled(t,e){return this.withObjects(t,this.objects,(t=>{const s=t.culled!==e;return t.culled=e,s}))}setObjectsSelected(t,e){return this.withObjects(t,(t=>{const s=t.selected!==e;return t.selected=e,s}))}setObjectsHighlighted(t,e){return this.withObjects(t,(t=>{const s=t.highlighted!==e;return t.highlighted=e,s}))}setObjectsXRayed(t,e){return this.withObjects(t,(t=>{const s=t.xrayed!==e;return t.xrayed=e,s}))}setObjectsEdges(t,e){return this.withObjects(t,(t=>{const s=t.edges!==e;return t.edges=e,s}))}setObjectsColorized(t,e){return this.withObjects(t,(t=>{t.colorize=e}))}setObjectsOpacity(t,e){return this.withObjects(t,(t=>{const s=t.opacity!==e;return t.opacity=e,s}))}setObjectsPickable(t,e){return this.withObjects(t,(t=>{const s=t.pickable!==e;return t.pickable=e,s}))}setObjectsOffset(t,e){this.withObjects(t,(t=>{t.offset=e}))}withObjects(t,e){_.isString(t)&&(t=[t]);let s=!1;for(let i=0,r=t.length;i<r;i++){const r=t[i];let o=this.objects[r];if(o)s=e(o)||s;else{const t=this.modelIds;for(let i=0,n=t.length;i<n;i++){const n=t[i],a=c.globalizeObjectId(n,r);o=this.objects[a],o&&(s=e(o)||s)}}}return s}destroy(){super.destroy();for(const t in this.components)this.components.hasOwnProperty(t)&&this.components[t].destroy();this.canvas.gl=null,this.components=null,this.models=null,this.objects=null,this.visibleObjects=null,this.xrayedObjects=null,this.highlightedObjects=null,this.selectedObjects=null,this.colorizedObjects=null,this.opacityObjects=null,this.sectionPlanes=null,this.lights=null,this.lightMaps=null,this.reflectionMaps=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this.types=null,this.components=null,this.canvas=null,this._renderer=null,this.input=null,this._viewport=null,this._camera=null}}const ze=function(t){"LambertMaterial"===t._material._state.type?(this.vertex=function(t){const e=t.scene,s=t.scene._sectionPlanesState,i=t.scene._lightsState,r=t._geometry._state,o=t._state.billboard,n=t._state.stationary,a=s.sectionPlanes.length>0,h=!!r.compressGeometry,l=[];l.push("// Lambertian drawing vertex shader"),e.logarithmicDepthBufferEnabled&&l.push("#extension GL_EXT_frag_depth : enable");l.push("attribute vec3 position;"),l.push("uniform mat4 modelMatrix;"),l.push("uniform mat4 viewMatrix;"),l.push("uniform mat4 projMatrix;"),l.push("uniform vec4 colorize;"),l.push("uniform vec3 offset;"),h&&l.push("uniform mat4 positionsDecodeMatrix;");e.logarithmicDepthBufferEnabled&&(l.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&l.push("varying float vFragDepth;"),l.push("bool isPerspectiveMatrix(mat4 m) {"),l.push("    return (m[2][3] == - 1.0);"),l.push("}"),l.push("varying float isPerspective;"));a&&l.push("varying vec4 vWorldPosition;");if(l.push("uniform vec4 lightAmbient;"),l.push("uniform vec4 materialColor;"),l.push("uniform vec3 materialEmissive;"),r.normalsBuf){l.push("attribute vec3 normal;"),l.push("uniform mat4 modelNormalMatrix;"),l.push("uniform mat4 viewNormalMatrix;");for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];"ambient"!==e.type&&(l.push("uniform vec4 lightColor"+t+";"),"dir"===e.type&&l.push("uniform vec3 lightDir"+t+";"),"point"===e.type&&l.push("uniform vec3 lightPos"+t+";"),"spot"===e.type&&(l.push("uniform vec3 lightPos"+t+";"),l.push("uniform vec3 lightDir"+t+";")))}h&&(l.push("vec3 octDecode(vec2 oct) {"),l.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),l.push("    if (v.z < 0.0) {"),l.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),l.push("    }"),l.push("    return normalize(v);"),l.push("}"))}l.push("varying vec4 vColor;"),"points"===r.primitiveName&&l.push("uniform float pointSize;");"spherical"!==o&&"cylindrical"!==o||(l.push("void billboard(inout mat4 mat) {"),l.push("   mat[0][0] = 1.0;"),l.push("   mat[0][1] = 0.0;"),l.push("   mat[0][2] = 0.0;"),"spherical"===o&&(l.push("   mat[1][0] = 0.0;"),l.push("   mat[1][1] = 1.0;"),l.push("   mat[1][2] = 0.0;")),l.push("   mat[2][0] = 0.0;"),l.push("   mat[2][1] = 0.0;"),l.push("   mat[2][2] =1.0;"),l.push("}"));l.push("void main(void) {"),l.push("vec4 localPosition = vec4(position, 1.0); "),l.push("vec4 worldPosition;"),h&&l.push("localPosition = positionsDecodeMatrix * localPosition;");r.normalsBuf&&(h?l.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):l.push("vec4 localNormal = vec4(normal, 0.0); "),l.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),l.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));l.push("mat4 viewMatrix2 = viewMatrix;"),l.push("mat4 modelMatrix2 = modelMatrix;"),n&&l.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===o||"cylindrical"===o?(l.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),l.push("billboard(modelMatrix2);"),l.push("billboard(viewMatrix2);"),l.push("billboard(modelViewMatrix);"),r.normalsBuf&&(l.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),l.push("billboard(modelNormalMatrix2);"),l.push("billboard(viewNormalMatrix2);"),l.push("billboard(modelViewNormalMatrix);")),l.push("worldPosition = modelMatrix2 * localPosition;"),l.push("worldPosition.xyz = worldPosition.xyz + offset;"),l.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(l.push("worldPosition = modelMatrix2 * localPosition;"),l.push("worldPosition.xyz = worldPosition.xyz + offset;"),l.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));r.normalsBuf&&l.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");if(l.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),l.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),l.push("float lambertian = 1.0;"),r.normalsBuf)for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?l.push("viewLightDir = normalize(lightDir"+t+");"):l.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?l.push("viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);"):l.push("viewLightDir = -normalize((viewMatrix2 * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?l.push("viewLightDir = normalize(lightDir"+t+");"):l.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+t+", 0.0)).xyz);")}l.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),l.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}l.push("vColor = vec4((lightAmbient.rgb * lightAmbient.a * materialColor.rgb) + materialEmissive.rgb + (reflectedColor * materialColor.rgb), materialColor.a) * colorize;"),a&&l.push("vWorldPosition = worldPosition;");"points"===r.primitiveName&&l.push("gl_PointSize = pointSize;");l.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?l.push("vFragDepth = 1.0 + clipPos.w;"):(l.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),l.push("clipPos.z *= clipPos.w;")),l.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return l.push("gl_Position = clipPos;"),l.push("}"),l}(t),this.fragment=function(t){const e=t.scene,s=e._sectionPlanesState;t._material._state;const i=t._geometry._state,r=s.sectionPlanes.length>0,o=e.gammaOutput,n=[];n.push("// Lambertian drawing fragment shader"),e.logarithmicDepthBufferEnabled&&n.push("#extension GL_EXT_frag_depth : enable");n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(n.push("varying float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("varying float vFragDepth;"));if(r){n.push("varying vec4 vWorldPosition;"),n.push("uniform bool clippable;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)n.push("uniform bool sectionPlaneActive"+t+";"),n.push("uniform vec3 sectionPlanePos"+t+";"),n.push("uniform vec3 sectionPlaneDir"+t+";")}n.push("varying vec4 vColor;"),o&&(n.push("uniform float gammaFactor;"),n.push("    vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("    return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}"));if(n.push("void main(void) {"),r){n.push("if (clippable) {"),n.push("  float dist = 0.0;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)n.push("if (sectionPlaneActive"+t+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { discard; }"),n.push("}")}"points"===i.primitiveName&&(n.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),n.push("float r = dot(cxy, cxy);"),n.push("if (r > 1.0) {"),n.push("   discard;"),n.push("}"));e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");o?n.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):n.push("gl_FragColor = vColor;");return n.push("}"),n}(t)):(this.vertex=function(t){const e=t.scene,s=t._material,i=t._state,r=e._sectionPlanesState,o=t._geometry._state,n=e._lightsState;let a;const h=i.billboard,l=i.background,u=i.stationary,p=function(t){if(!t._geometry._state.uvBuf)return!1;const e=t._material;return!!(e._ambientMap||e._occlusionMap||e._baseColorMap||e._diffuseMap||e._alphaMap||e._specularMap||e._glossinessMap||e._specularGlossinessMap||e._emissiveMap||e._metallicMap||e._roughnessMap||e._metallicRoughnessMap||e._reflectivityMap||e._normalMap)}(t),c=We(t),d=r.sectionPlanes.length>0,m=Xe(t),f=!!o.compressGeometry,g=[];g.push("// Drawing vertex shader"),c&&s._normalMap&&g.push("#extension GL_OES_standard_derivatives : enable");e.logarithmicDepthBufferEnabled&&g.push("#extension GL_EXT_frag_depth : enable");g.push("attribute  vec3 position;"),f&&g.push("uniform mat4 positionsDecodeMatrix;");g.push("uniform  mat4 modelMatrix;"),g.push("uniform  mat4 viewMatrix;"),g.push("uniform  mat4 projMatrix;"),g.push("varying  vec3 vViewPosition;"),g.push("uniform  vec3 offset;"),d&&g.push("varying vec4 vWorldPosition;");e.logarithmicDepthBufferEnabled&&(g.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&g.push("varying float vFragDepth;"),g.push("bool isPerspectiveMatrix(mat4 m) {"),g.push("    return (m[2][3] == - 1.0);"),g.push("}"),g.push("varying float isPerspective;"));n.lightMaps.length>0&&g.push("varying    vec3 vWorldNormal;");if(c){g.push("attribute  vec3 normal;"),g.push("uniform    mat4 modelNormalMatrix;"),g.push("uniform    mat4 viewNormalMatrix;"),g.push("varying    vec3 vViewNormal;");for(let t=0,e=n.lights.length;t<e;t++)a=n.lights[t],"ambient"!==a.type&&("dir"===a.type&&g.push("uniform vec3 lightDir"+t+";"),"point"===a.type&&g.push("uniform vec3 lightPos"+t+";"),"spot"===a.type&&(g.push("uniform vec3 lightPos"+t+";"),g.push("uniform vec3 lightDir"+t+";")),"dir"===a.type&&"view"===a.space||g.push("varying vec4 vViewLightReverseDirAndDist"+t+";"));f&&(g.push("vec3 octDecode(vec2 oct) {"),g.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),g.push("    if (v.z < 0.0) {"),g.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),g.push("    }"),g.push("    return normalize(v);"),g.push("}"))}p&&(g.push("attribute vec2 uv;"),g.push("varying vec2 vUV;"),f&&g.push("uniform mat3 uvDecodeMatrix;"));o.colors&&(g.push("attribute vec4 color;"),g.push("varying vec4 vColor;"));"points"===o.primitiveName&&g.push("uniform float pointSize;");"spherical"!==h&&"cylindrical"!==h||(g.push("void billboard(inout mat4 mat) {"),g.push("   mat[0][0] = 1.0;"),g.push("   mat[0][1] = 0.0;"),g.push("   mat[0][2] = 0.0;"),"spherical"===h&&(g.push("   mat[1][0] = 0.0;"),g.push("   mat[1][1] = 1.0;"),g.push("   mat[1][2] = 0.0;")),g.push("   mat[2][0] = 0.0;"),g.push("   mat[2][1] = 0.0;"),g.push("   mat[2][2] =1.0;"),g.push("}"));if(m){g.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);");for(let t=0,e=n.lights.length;t<e;t++)n.lights[t].castsShadow&&(g.push("uniform mat4 shadowViewMatrix"+t+";"),g.push("uniform mat4 shadowProjMatrix"+t+";"),g.push("varying vec4 vShadowPosFromLight"+t+";"))}g.push("void main(void) {"),g.push("vec4 localPosition = vec4(position, 1.0); "),g.push("vec4 worldPosition;"),f&&g.push("localPosition = positionsDecodeMatrix * localPosition;");c&&(f?g.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):g.push("vec4 localNormal = vec4(normal, 0.0); "),g.push("mat4 modelNormalMatrix2    = modelNormalMatrix;"),g.push("mat4 viewNormalMatrix2     = viewNormalMatrix;"));g.push("mat4 viewMatrix2           = viewMatrix;"),g.push("mat4 modelMatrix2          = modelMatrix;"),u?g.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;"):l&&g.push("viewMatrix2[3] = vec4(0.0, 0.0, 0.0 ,1.0);");"spherical"===h||"cylindrical"===h?(g.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),g.push("billboard(modelMatrix2);"),g.push("billboard(viewMatrix2);"),g.push("billboard(modelViewMatrix);"),c&&(g.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),g.push("billboard(modelNormalMatrix2);"),g.push("billboard(viewNormalMatrix2);"),g.push("billboard(modelViewNormalMatrix);")),g.push("worldPosition = modelMatrix2 * localPosition;"),g.push("worldPosition.xyz = worldPosition.xyz + offset;"),g.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(g.push("worldPosition = modelMatrix2 * localPosition;"),g.push("worldPosition.xyz = worldPosition.xyz + offset;"),g.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));if(c){g.push("vec3 worldNormal = (modelNormalMatrix2 * localNormal).xyz; "),n.lightMaps.length>0&&g.push("vWorldNormal = worldNormal;"),g.push("vViewNormal = normalize((viewNormalMatrix2 * vec4(worldNormal, 1.0)).xyz);"),g.push("vec3 tmpVec3;"),g.push("float lightDist;");for(let t=0,e=n.lights.length;t<e;t++)a=n.lights[t],"ambient"!==a.type&&("dir"===a.type&&"world"===a.space&&(g.push("tmpVec3 = vec3(viewMatrix2 * vec4(lightDir"+t+", 0.0) ).xyz;"),g.push("vViewLightReverseDirAndDist"+t+" = vec4(-tmpVec3, 0.0);")),"point"===a.type&&("world"===a.space?(g.push("tmpVec3 = (viewMatrix2 * vec4(lightPos"+t+", 1.0)).xyz - viewPosition.xyz;"),g.push("lightDist = abs(length(tmpVec3));")):(g.push("tmpVec3 = lightPos"+t+".xyz - viewPosition.xyz;"),g.push("lightDist = abs(length(tmpVec3));")),g.push("vViewLightReverseDirAndDist"+t+" = vec4(tmpVec3, lightDist);")))}p&&(f?g.push("vUV = (uvDecodeMatrix * vec3(uv, 1.0)).xy;"):g.push("vUV = uv;"));o.colors&&g.push("vColor = color;");"points"===o.primitiveName&&g.push("gl_PointSize = pointSize;");d&&g.push("vWorldPosition = worldPosition;");g.push("   vViewPosition = viewPosition.xyz;"),g.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?g.push("vFragDepth = 1.0 + clipPos.w;"):(g.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),g.push("clipPos.z *= clipPos.w;")),g.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));l&&g.push("clipPos.z = clipPos.w;");if(g.push("gl_Position = clipPos;"),m){g.push("const mat4 texUnitConverter = mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0);"),g.push("vec4 tempx; ");for(let t=0,e=n.lights.length;t<e;t++)n.lights[t].castsShadow&&g.push("vShadowPosFromLight"+t+" = texUnitConverter * shadowProjMatrix"+t+" * (shadowViewMatrix"+t+" * worldPosition); ")}return g.push("}"),g}(t),this.fragment=function(t){const e=t.scene;e.canvas.gl;const s=t._material,i=t._geometry._state,r=t.scene._sectionPlanesState,o=t.scene._lightsState,n=t._material._state,a=r.sectionPlanes.length>0,h=We(t),l=i.uvBuf,u="PhongMaterial"===n.type,p="MetallicMaterial"===n.type,c="SpecularMaterial"===n.type,d=Xe(t);e.gammaInput;const m=e.gammaOutput,f=[];f.push("// Drawing fragment shader"),e.logarithmicDepthBufferEnabled&&f.push("#extension GL_EXT_frag_depth : enable");h&&s._normalMap&&f.push("#extension GL_OES_standard_derivatives : enable");f.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),f.push("precision highp float;"),f.push("precision highp int;"),f.push("#else"),f.push("precision mediump float;"),f.push("precision mediump int;"),f.push("#endif"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(f.push("varying float isPerspective;"),f.push("uniform float logDepthBufFC;"),f.push("varying float vFragDepth;"));d&&(f.push("float unpackDepth (vec4 color) {"),f.push("  const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),f.push("  return dot(color, bitShift);"),f.push("}"));f.push("uniform float gammaFactor;"),f.push("vec4 linearToLinear( in vec4 value ) {"),f.push("  return value;"),f.push("}"),f.push("vec4 sRGBToLinear( in vec4 value ) {"),f.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),f.push("}"),f.push("vec4 gammaToLinear( in vec4 value) {"),f.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),f.push("}"),m&&(f.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),f.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),f.push("}"));if(a){f.push("varying vec4 vWorldPosition;"),f.push("uniform bool clippable;");for(var g=0;g<r.sectionPlanes.length;g++)f.push("uniform bool sectionPlaneActive"+g+";"),f.push("uniform vec3 sectionPlanePos"+g+";"),f.push("uniform vec3 sectionPlaneDir"+g+";")}h&&(o.lightMaps.length>0&&(f.push("uniform samplerCube lightMap;"),f.push("uniform mat4 viewNormalMatrix;")),o.reflectionMaps.length>0&&f.push("uniform samplerCube reflectionMap;"),(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("uniform mat4 viewMatrix;"),f.push("#define PI 3.14159265359"),f.push("#define RECIPROCAL_PI 0.31830988618"),f.push("#define RECIPROCAL_PI2 0.15915494"),f.push("#define EPSILON 1e-6"),f.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),f.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),f.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),f.push("}"),f.push("struct IncidentLight {"),f.push("   vec3 color;"),f.push("   vec3 direction;"),f.push("};"),f.push("struct ReflectedLight {"),f.push("   vec3 diffuse;"),f.push("   vec3 specular;"),f.push("};"),f.push("struct Geometry {"),f.push("   vec3 position;"),f.push("   vec3 viewNormal;"),f.push("   vec3 worldNormal;"),f.push("   vec3 viewEyeDir;"),f.push("};"),f.push("struct Material {"),f.push("   vec3    diffuseColor;"),f.push("   float   specularRoughness;"),f.push("   vec3    specularColor;"),f.push("   float   shine;"),f.push("};"),u&&((o.lightMaps.length>0||o.reflectionMaps.length>0)&&(f.push("void computePhongLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.lightMaps.length>0&&(f.push("   vec3 irradiance = "+Ue[o.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),f.push("   irradiance *= PI;"),f.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),o.reflectionMaps.length>0&&(f.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),f.push("   vec3 radiance               = textureCube(reflectionMap, reflectVec).rgb * 0.2;"),f.push("   radiance *= PI;"),f.push("   reflectedLight.specular     += radiance;")),f.push("}")),f.push("void computePhongLighting(const in IncidentLight directLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),f.push("   float dotNL     = saturate(dot(geometry.viewNormal, directLight.direction));"),f.push("   vec3 irradiance = dotNL * directLight.color * PI;"),f.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.specular += directLight.color * material.specularColor * pow(max(dot(reflect(-directLight.direction, -geometry.viewNormal), geometry.viewEyeDir), 0.0), material.shine);"),f.push("}")),(p||c)&&(f.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),f.push("   float r = ggxRoughness + 0.0001;"),f.push("   return (2.0 / (r * r) - 2.0);"),f.push("}"),f.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),f.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),f.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),f.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),f.push("}"),o.reflectionMaps.length>0&&(f.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),f.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),f.push("   vec3 envMapColor = "+Ue[o.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),f.push("  return envMapColor;"),f.push("}")),f.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),f.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),f.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),f.push("}"),f.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),f.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),f.push("   return 1.0 / ( gl * gv );"),f.push("}"),f.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),f.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),f.push("   return 0.5 / max( gv + gl, EPSILON );"),f.push("}"),f.push("float D_GGX(const in float alpha, const in float dotNH) {"),f.push("   float a2 = ( alpha * alpha );"),f.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),f.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),f.push("}"),f.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),f.push("   float alpha = ( roughness * roughness );"),f.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),f.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),f.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),f.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),f.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),f.push("   vec3  F = F_Schlick( specularColor, dotLH );"),f.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),f.push("   float D = D_GGX( alpha, dotNH );"),f.push("   return F * (G * D);"),f.push("}"),f.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),f.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),f.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),f.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),f.push("   vec4 r = roughness * c0 + c1;"),f.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),f.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),f.push("   return specularColor * AB.x + AB.y;"),f.push("}"),(o.lightMaps.length>0||o.reflectionMaps.length>0)&&(f.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),o.lightMaps.length>0&&(f.push("   vec3 irradiance = sRGBToLinear(textureCube(lightMap, geometry.worldNormal)).rgb;"),f.push("   irradiance *= PI;"),f.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),o.reflectionMaps.length>0&&(f.push("   vec3 reflectVec             = reflect(-geometry.viewEyeDir, geometry.viewNormal);"),f.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),f.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),f.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),f.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),f.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),f.push("}")),f.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),f.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),f.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),f.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),f.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),f.push("}")));f.push("varying vec3 vViewPosition;"),i.colors&&f.push("varying vec4 vColor;");l&&(h&&s._normalMap||s._ambientMap||s._baseColorMap||s._diffuseMap||s._emissiveMap||s._metallicMap||s._roughnessMap||s._metallicRoughnessMap||s._specularMap||s._glossinessMap||s._specularGlossinessMap||s._occlusionMap||s._alphaMap)&&f.push("varying vec2 vUV;");h&&(o.lightMaps.length>0&&f.push("varying vec3 vWorldNormal;"),f.push("varying vec3 vViewNormal;"));n.ambient&&f.push("uniform vec3 materialAmbient;");n.baseColor&&f.push("uniform vec3 materialBaseColor;");void 0!==n.alpha&&null!==n.alpha&&f.push("uniform vec4 materialAlphaModeCutoff;");n.emissive&&f.push("uniform vec3 materialEmissive;");n.diffuse&&f.push("uniform vec3 materialDiffuse;");void 0!==n.glossiness&&null!==n.glossiness&&f.push("uniform float materialGlossiness;");void 0!==n.shininess&&null!==n.shininess&&f.push("uniform float materialShininess;");n.specular&&f.push("uniform vec3 materialSpecular;");void 0!==n.metallic&&null!==n.metallic&&f.push("uniform float materialMetallic;");void 0!==n.roughness&&null!==n.roughness&&f.push("uniform float materialRoughness;");void 0!==n.specularF0&&null!==n.specularF0&&f.push("uniform float materialSpecularF0;");l&&s._ambientMap&&(f.push("uniform sampler2D ambientMap;"),s._ambientMap._state.matrix&&f.push("uniform mat4 ambientMapMatrix;"));l&&s._baseColorMap&&(f.push("uniform sampler2D baseColorMap;"),s._baseColorMap._state.matrix&&f.push("uniform mat4 baseColorMapMatrix;"));l&&s._diffuseMap&&(f.push("uniform sampler2D diffuseMap;"),s._diffuseMap._state.matrix&&f.push("uniform mat4 diffuseMapMatrix;"));l&&s._emissiveMap&&(f.push("uniform sampler2D emissiveMap;"),s._emissiveMap._state.matrix&&f.push("uniform mat4 emissiveMapMatrix;"));h&&l&&s._metallicMap&&(f.push("uniform sampler2D metallicMap;"),s._metallicMap._state.matrix&&f.push("uniform mat4 metallicMapMatrix;"));h&&l&&s._roughnessMap&&(f.push("uniform sampler2D roughnessMap;"),s._roughnessMap._state.matrix&&f.push("uniform mat4 roughnessMapMatrix;"));h&&l&&s._metallicRoughnessMap&&(f.push("uniform sampler2D metallicRoughnessMap;"),s._metallicRoughnessMap._state.matrix&&f.push("uniform mat4 metallicRoughnessMapMatrix;"));h&&s._normalMap&&(f.push("uniform sampler2D normalMap;"),s._normalMap._state.matrix&&f.push("uniform mat4 normalMapMatrix;"),f.push("vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {"),f.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),f.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),f.push("      vec2 st0 = dFdx( uv.st );"),f.push("      vec2 st1 = dFdy( uv.st );"),f.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),f.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),f.push("      vec3 N = normalize( surf_norm );"),f.push("      vec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;"),f.push("      mat3 tsn = mat3( S, T, N );"),f.push("      return normalize( tsn * mapN );"),f.push("}"));l&&s._occlusionMap&&(f.push("uniform sampler2D occlusionMap;"),s._occlusionMap._state.matrix&&f.push("uniform mat4 occlusionMapMatrix;"));l&&s._alphaMap&&(f.push("uniform sampler2D alphaMap;"),s._alphaMap._state.matrix&&f.push("uniform mat4 alphaMapMatrix;"));h&&l&&s._specularMap&&(f.push("uniform sampler2D specularMap;"),s._specularMap._state.matrix&&f.push("uniform mat4 specularMapMatrix;"));h&&l&&s._glossinessMap&&(f.push("uniform sampler2D glossinessMap;"),s._glossinessMap._state.matrix&&f.push("uniform mat4 glossinessMapMatrix;"));h&&l&&s._specularGlossinessMap&&(f.push("uniform sampler2D materialSpecularGlossinessMap;"),s._specularGlossinessMap._state.matrix&&f.push("uniform mat4 materialSpecularGlossinessMapMatrix;"));h&&(s._diffuseFresnel||s._specularFresnel||s._alphaFresnel||s._emissiveFresnel||s._reflectivityFresnel)&&(f.push("float fresnel(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {"),f.push("    float fr = abs(dot(eyeDir, normal));"),f.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),f.push("    return pow(finalFr, power);"),f.push("}"),s._diffuseFresnel&&(f.push("uniform float  diffuseFresnelCenterBias;"),f.push("uniform float  diffuseFresnelEdgeBias;"),f.push("uniform float  diffuseFresnelPower;"),f.push("uniform vec3   diffuseFresnelCenterColor;"),f.push("uniform vec3   diffuseFresnelEdgeColor;")),s._specularFresnel&&(f.push("uniform float  specularFresnelCenterBias;"),f.push("uniform float  specularFresnelEdgeBias;"),f.push("uniform float  specularFresnelPower;"),f.push("uniform vec3   specularFresnelCenterColor;"),f.push("uniform vec3   specularFresnelEdgeColor;")),s._alphaFresnel&&(f.push("uniform float  alphaFresnelCenterBias;"),f.push("uniform float  alphaFresnelEdgeBias;"),f.push("uniform float  alphaFresnelPower;"),f.push("uniform vec3   alphaFresnelCenterColor;"),f.push("uniform vec3   alphaFresnelEdgeColor;")),s._reflectivityFresnel&&(f.push("uniform float  materialSpecularF0FresnelCenterBias;"),f.push("uniform float  materialSpecularF0FresnelEdgeBias;"),f.push("uniform float  materialSpecularF0FresnelPower;"),f.push("uniform vec3   materialSpecularF0FresnelCenterColor;"),f.push("uniform vec3   materialSpecularF0FresnelEdgeColor;")),s._emissiveFresnel&&(f.push("uniform float  emissiveFresnelCenterBias;"),f.push("uniform float  emissiveFresnelEdgeBias;"),f.push("uniform float  emissiveFresnelPower;"),f.push("uniform vec3   emissiveFresnelCenterColor;"),f.push("uniform vec3   emissiveFresnelEdgeColor;")));if(f.push("uniform vec4   lightAmbient;"),h)for(let t=0,e=o.lights.length;t<e;t++){const e=o.lights[t];"ambient"!==e.type&&(f.push("uniform vec4 lightColor"+t+";"),"point"===e.type&&f.push("uniform vec3 lightAttenuation"+t+";"),"dir"===e.type&&"view"===e.space&&f.push("uniform vec3 lightDir"+t+";"),"point"===e.type&&"view"===e.space?f.push("uniform vec3 lightPos"+t+";"):f.push("varying vec4 vViewLightReverseDirAndDist"+t+";"))}if(d)for(let t=0,e=o.lights.length;t<e;t++)o.lights[t].castsShadow&&(f.push("varying vec4 vShadowPosFromLight"+t+";"),f.push("uniform sampler2D shadowMap"+t+";"));if(f.push("uniform vec4 colorize;"),f.push("void main(void) {"),a){f.push("if (clippable) {"),f.push("  float dist = 0.0;");for(g=0;g<r.sectionPlanes.length;g++)f.push("if (sectionPlaneActive"+g+") {"),f.push("   dist += clamp(dot(-sectionPlaneDir"+g+".xyz, vWorldPosition.xyz - sectionPlanePos"+g+".xyz), 0.0, 1000.0);"),f.push("}");f.push("  if (dist > 0.0) { discard; }"),f.push("}")}"points"===i.primitiveName&&(f.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),f.push("float r = dot(cxy, cxy);"),f.push("if (r > 1.0) {"),f.push("   discard;"),f.push("}"));f.push("float occlusion = 1.0;"),n.ambient?f.push("vec3 ambientColor = materialAmbient;"):f.push("vec3 ambientColor = vec3(1.0, 1.0, 1.0);");n.diffuse?f.push("vec3 diffuseColor = materialDiffuse;"):n.baseColor?f.push("vec3 diffuseColor = materialBaseColor;"):f.push("vec3 diffuseColor = vec3(1.0, 1.0, 1.0);");i.colors&&f.push("diffuseColor *= vColor.rgb;");n.emissive?f.push("vec3 emissiveColor = materialEmissive;"):f.push("vec3  emissiveColor = vec3(0.0, 0.0, 0.0);");n.specular?f.push("vec3 specular = materialSpecular;"):f.push("vec3 specular = vec3(1.0, 1.0, 1.0);");void 0!==n.alpha?f.push("float alpha = materialAlphaModeCutoff[0];"):f.push("float alpha = 1.0;");i.colors&&f.push("alpha *= vColor.a;");void 0!==n.glossiness?f.push("float glossiness = materialGlossiness;"):f.push("float glossiness = 1.0;");void 0!==n.metallic?f.push("float metallic = materialMetallic;"):f.push("float metallic = 1.0;");void 0!==n.roughness?f.push("float roughness = materialRoughness;"):f.push("float roughness = 1.0;");void 0!==n.specularF0?f.push("float specularF0 = materialSpecularF0;"):f.push("float specularF0 = 1.0;");l&&(h&&s._normalMap||s._ambientMap||s._baseColorMap||s._diffuseMap||s._occlusionMap||s._emissiveMap||s._metallicMap||s._roughnessMap||s._metallicRoughnessMap||s._specularMap||s._glossinessMap||s._specularGlossinessMap||s._alphaMap)&&(f.push("vec4 texturePos = vec4(vUV.s, vUV.t, 1.0, 1.0);"),f.push("vec2 textureCoord;"));l&&s._ambientMap&&(s._ambientMap._state.matrix?f.push("textureCoord = (ambientMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 ambientTexel = texture2D(ambientMap, textureCoord).rgb;"),f.push("ambientTexel = "+Ue[s._ambientMap._state.encoding]+"(ambientTexel);"),f.push("ambientColor *= ambientTexel.rgb;"));l&&s._diffuseMap&&(s._diffuseMap._state.matrix?f.push("textureCoord = (diffuseMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 diffuseTexel = texture2D(diffuseMap, textureCoord);"),f.push("diffuseTexel = "+Ue[s._diffuseMap._state.encoding]+"(diffuseTexel);"),f.push("diffuseColor *= diffuseTexel.rgb;"),f.push("alpha *= diffuseTexel.a;"));l&&s._baseColorMap&&(s._baseColorMap._state.matrix?f.push("textureCoord = (baseColorMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 baseColorTexel = texture2D(baseColorMap, textureCoord);"),f.push("baseColorTexel = "+Ue[s._baseColorMap._state.encoding]+"(baseColorTexel);"),f.push("diffuseColor *= baseColorTexel.rgb;"),f.push("alpha *= baseColorTexel.a;"));l&&s._emissiveMap&&(s._emissiveMap._state.matrix?f.push("textureCoord = (emissiveMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 emissiveTexel = texture2D(emissiveMap, textureCoord);"),f.push("emissiveTexel = "+Ue[s._emissiveMap._state.encoding]+"(emissiveTexel);"),f.push("emissiveColor = emissiveTexel.rgb;"));l&&s._alphaMap&&(s._alphaMap._state.matrix?f.push("textureCoord = (alphaMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("alpha *= texture2D(alphaMap, textureCoord).r;"));l&&s._occlusionMap&&(s._occlusionMap._state.matrix?f.push("textureCoord = (occlusionMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("occlusion *= texture2D(occlusionMap, textureCoord).r;"));if(h&&(o.lights.length>0||o.lightMaps.length>0||o.reflectionMaps.length>0)){l&&s._normalMap?(s._normalMap._state.matrix?f.push("textureCoord = (normalMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec3 viewNormal = perturbNormal2Arb( vViewPosition, normalize(vViewNormal), textureCoord );")):f.push("vec3 viewNormal = normalize(vViewNormal);"),l&&s._specularMap&&(s._specularMap._state.matrix?f.push("textureCoord = (specularMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("specular *= texture2D(specularMap, textureCoord).rgb;")),l&&s._glossinessMap&&(s._glossinessMap._state.matrix?f.push("textureCoord = (glossinessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("glossiness *= texture2D(glossinessMap, textureCoord).r;")),l&&s._specularGlossinessMap&&(s._specularGlossinessMap._state.matrix?f.push("textureCoord = (materialSpecularGlossinessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec4 specGlossRGB = texture2D(materialSpecularGlossinessMap, textureCoord).rgba;"),f.push("specular *= specGlossRGB.rgb;"),f.push("glossiness *= specGlossRGB.a;")),l&&s._metallicMap&&(s._metallicMap._state.matrix?f.push("textureCoord = (metallicMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("metallic *= texture2D(metallicMap, textureCoord).r;")),l&&s._roughnessMap&&(s._roughnessMap._state.matrix?f.push("textureCoord = (roughnessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("roughness *= texture2D(roughnessMap, textureCoord).r;")),l&&s._metallicRoughnessMap&&(s._metallicRoughnessMap._state.matrix?f.push("textureCoord = (metallicRoughnessMapMatrix * texturePos).xy;"):f.push("textureCoord = texturePos.xy;"),f.push("vec3 metalRoughRGB = texture2D(metallicRoughnessMap, textureCoord).rgb;"),f.push("metallic *= metalRoughRGB.b;"),f.push("roughness *= metalRoughRGB.g;")),f.push("vec3 viewEyeDir = normalize(-vViewPosition);"),s._diffuseFresnel&&(f.push("float diffuseFresnel = fresnel(viewEyeDir, viewNormal, diffuseFresnelEdgeBias, diffuseFresnelCenterBias, diffuseFresnelPower);"),f.push("diffuseColor *= mix(diffuseFresnelEdgeColor, diffuseFresnelCenterColor, diffuseFresnel);")),s._specularFresnel&&(f.push("float specularFresnel = fresnel(viewEyeDir, viewNormal, specularFresnelEdgeBias, specularFresnelCenterBias, specularFresnelPower);"),f.push("specular *= mix(specularFresnelEdgeColor, specularFresnelCenterColor, specularFresnel);")),s._alphaFresnel&&(f.push("float alphaFresnel = fresnel(viewEyeDir, viewNormal, alphaFresnelEdgeBias, alphaFresnelCenterBias, alphaFresnelPower);"),f.push("alpha *= mix(alphaFresnelEdgeColor.r, alphaFresnelCenterColor.r, alphaFresnel);")),s._emissiveFresnel&&(f.push("float emissiveFresnel = fresnel(viewEyeDir, viewNormal, emissiveFresnelEdgeBias, emissiveFresnelCenterBias, emissiveFresnelPower);"),f.push("emissiveColor *= mix(emissiveFresnelEdgeColor, emissiveFresnelCenterColor, emissiveFresnel);")),f.push("if (materialAlphaModeCutoff[1] == 1.0 && alpha < materialAlphaModeCutoff[2]) {"),f.push("   discard;"),f.push("}"),f.push("IncidentLight  light;"),f.push("Material       material;"),f.push("Geometry       geometry;"),f.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),f.push("vec3           viewLightDir;"),u&&(f.push("material.diffuseColor      = diffuseColor;"),f.push("material.specularColor     = specular;"),f.push("material.shine             = materialShininess;")),c&&(f.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),f.push("material.diffuseColor      = diffuseColor * oneMinusSpecularStrength;"),f.push("material.specularRoughness = clamp( 1.0 - glossiness, 0.04, 1.0 );"),f.push("material.specularColor     = specular;")),p&&(f.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),f.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),f.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),f.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);")),f.push("geometry.position      = vViewPosition;"),o.lightMaps.length>0&&f.push("geometry.worldNormal   = normalize(vWorldNormal);"),f.push("geometry.viewNormal    = viewNormal;"),f.push("geometry.viewEyeDir    = viewEyeDir;"),u&&(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("computePhongLightMapping(geometry, material, reflectedLight);"),(c||p)&&(o.lightMaps.length>0||o.reflectionMaps.length>0)&&f.push("computePBRLightMapping(geometry, material, reflectedLight);"),f.push("float shadow = 1.0;"),f.push("float shadowAcneRemover = 0.007;"),f.push("vec3 fragmentDepth;"),f.push("float texelSize = 1.0 / 1024.0;"),f.push("float amountInLight = 0.0;"),f.push("vec3 shadowCoord;"),f.push("vec4 rgbaDepth;"),f.push("float depth;");for(let t=0,e=o.lights.length;t<e;t++){const e=o.lights[t];"ambient"!==e.type&&("dir"===e.type&&"view"===e.space?f.push("viewLightDir = -normalize(lightDir"+t+");"):"point"===e.type&&"view"===e.space?f.push("viewLightDir = normalize(lightPos"+t+" - vViewPosition);"):f.push("viewLightDir = normalize(vViewLightReverseDirAndDist"+t+".xyz);"),d&&e.castsShadow?(f.push("shadow = 0.0;"),f.push("fragmentDepth = vShadowPosFromLight"+t+".xyz;"),f.push("fragmentDepth.z -= shadowAcneRemover;"),f.push("for (int x = -3; x <= 3; x++) {"),f.push("  for (int y = -3; y <= 3; y++) {"),f.push("      float texelDepth = unpackDepth(texture2D(shadowMap"+t+", fragmentDepth.xy + vec2(x, y) * texelSize));"),f.push("      if (fragmentDepth.z < texelDepth) {"),f.push("          shadow += 1.0;"),f.push("      }"),f.push("  }"),f.push("}"),f.push("shadow = shadow / 9.0;"),f.push("light.color =  lightColor"+t+".rgb * (lightColor"+t+".a * shadow);")):f.push("light.color =  lightColor"+t+".rgb * (lightColor"+t+".a );"),f.push("light.direction = viewLightDir;"),u&&f.push("computePhongLighting(light, geometry, material, reflectedLight);"),(c||p)&&f.push("computePBRLighting(light, geometry, material, reflectedLight);"))}u?f.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * diffuseColor) + ((occlusion * (( reflectedLight.diffuse + reflectedLight.specular)))) + emissiveColor;"):f.push("vec3 outgoingLight = (occlusion * (reflectedLight.diffuse)) + (occlusion * reflectedLight.specular) + emissiveColor;")}else f.push("ambientColor *= (lightAmbient.rgb * lightAmbient.a);"),f.push("vec3 outgoingLight = emissiveColor + ambientColor;");f.push("gl_FragColor = vec4(outgoingLight, alpha) * colorize;"),m&&f.push("gl_FragColor = linearToGamma(gl_FragColor, gammaFactor);");e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&f.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return f.push("}"),f}(t))},Ue={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};function Xe(t){if(!t.receivesShadow)return!1;const e=t.scene._lightsState.lights;if(!e||0===e.length)return!1;for(let t=0,s=e.length;t<s;t++)if(e[t].castsShadow)return!0;return!1}function We(t){const e=t._geometry._state.primitiveName;return!(!t._geometry._state.autoVertexNormals&&!t._geometry._state.normalsBuf||"triangles"!==e&&"triangle-strip"!==e&&"triangle-fan"!==e)}const Ye=c.vec3(),Ke=new t({}),Ze=function(t,e){this.id=Ke.addItem({}),this._hash=t,this._scene=e.scene,this._useCount=0,this._shaderSource=new ze(e),this._allocate(e)},qe={};Ze.get=function(t){const e=t.scene,s=[e.canvas.canvas.id,(e.gammaInput?"gi;":";")+(e.gammaOutput?"go":""),e._lightsState.getHash(),e._sectionPlanesState.getHash(),t._geometry._state.hash,t._material._state.hash,t._state.drawHash].join(";");let i=qe[s];if(!i){if(i=new Ze(s,t),i.errors)return console.log(i.errors.join("\n")),null;qe[s]=i,m.memory.programs++}return i._useCount++,i},Ze.prototype.put=function(){0==--this._useCount&&(Ke.removeItem(this.id),this._program&&this._program.destroy(),delete qe[this._hash],m.memory.programs--)},Ze.prototype.webglContextRestored=function(){this._program=null},Ze.prototype.drawMesh=function(t,e){this._program||this._allocate(e);const s=pt.MAX_TEXTURE_UNITS,i=e.scene,r=e._material,o=i.canvas.gl,n=this._program,a=e._state,h=e._material._state,l=e._geometry._state,u=i.camera,p=e.origin,c=a.background;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,c&&o.depthFunc(o.LEQUAL),this._bindProgram(t)),o.uniformMatrix4fv(this._uViewMatrix,!1,p?t.getRTCViewMatrix(a.originHash,p):u.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,u.viewNormalMatrix),a.clippable){const t=i._sectionPlanesState.sectionPlanes.length;if(t>0){const s=i._sectionPlanesState.sectionPlanes,r=e.renderFlags;for(let e=0;e<t;e++){const t=this._uSectionPlanes[e];if(t){const i=r.sectionPlanesActivePerLayer[e];if(o.uniform1i(t.active,i?1:0),i){const i=s[e];o.uniform3fv(t.pos,p?Y(i.dist,i.dir,p,Ye):i.pos),o.uniform3fv(t.dir,i.dir)}}}}}if(h.id!==this._lastMaterialId){t.textureUnit=this._baseTextureUnit;const e=h.backfaces;t.backfaces!==e&&(e?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),t.backfaces=e);const i=h.frontface;switch(t.frontface!==i&&(i?o.frontFace(o.CCW):o.frontFace(o.CW),t.frontface=i),t.lineWidth!==h.lineWidth&&(o.lineWidth(h.lineWidth),t.lineWidth=h.lineWidth),this._uPointSize&&o.uniform1f(this._uPointSize,h.pointSize),h.type){case"LambertMaterial":this._uMaterialAmbient&&o.uniform3fv(this._uMaterialAmbient,h.ambient),this._uMaterialColor&&o.uniform4f(this._uMaterialColor,h.color[0],h.color[1],h.color[2],h.alpha),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive);break;case"PhongMaterial":this._uMaterialShininess&&o.uniform1f(this._uMaterialShininess,h.shininess),this._uMaterialAmbient&&o.uniform3fv(this._uMaterialAmbient,h.ambient),this._uMaterialDiffuse&&o.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&o.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0),r._ambientMap&&r._ambientMap._state.texture&&this._uMaterialAmbientMap&&(n.bindTexture(this._uMaterialAmbientMap,r._ambientMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uMaterialAmbientMapMatrix&&o.uniformMatrix4fv(this._uMaterialAmbientMapMatrix,!1,r._ambientMap._state.matrix)),r._diffuseMap&&r._diffuseMap._state.texture&&this._uDiffuseMap&&(n.bindTexture(this._uDiffuseMap,r._diffuseMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uDiffuseMapMatrix&&o.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,r._diffuseMap._state.matrix)),r._specularMap&&r._specularMap._state.texture&&this._uSpecularMap&&(n.bindTexture(this._uSpecularMap,r._specularMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uSpecularMapMatrix&&o.uniformMatrix4fv(this._uSpecularMapMatrix,!1,r._specularMap._state.matrix)),r._emissiveMap&&r._emissiveMap._state.texture&&this._uEmissiveMap&&(n.bindTexture(this._uEmissiveMap,r._emissiveMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,r._emissiveMap._state.matrix)),r._alphaMap&&r._alphaMap._state.texture&&this._uAlphaMap&&(n.bindTexture(this._uAlphaMap,r._alphaMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,r._alphaMap._state.matrix)),r._reflectivityMap&&r._reflectivityMap._state.texture&&this._uReflectivityMap&&(n.bindTexture(this._uReflectivityMap,r._reflectivityMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,this._uReflectivityMapMatrix&&o.uniformMatrix4fv(this._uReflectivityMapMatrix,!1,r._reflectivityMap._state.matrix)),r._normalMap&&r._normalMap._state.texture&&this._uNormalMap&&(n.bindTexture(this._uNormalMap,r._normalMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,r._normalMap._state.matrix)),r._occlusionMap&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(n.bindTexture(this._uOcclusionMap,r._occlusionMap._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,r._occlusionMap._state.matrix)),r._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias&&o.uniform1f(this._uDiffuseFresnelEdgeBias,r._diffuseFresnel.edgeBias),this._uDiffuseFresnelCenterBias&&o.uniform1f(this._uDiffuseFresnelCenterBias,r._diffuseFresnel.centerBias),this._uDiffuseFresnelEdgeColor&&o.uniform3fv(this._uDiffuseFresnelEdgeColor,r._diffuseFresnel.edgeColor),this._uDiffuseFresnelCenterColor&&o.uniform3fv(this._uDiffuseFresnelCenterColor,r._diffuseFresnel.centerColor),this._uDiffuseFresnelPower&&o.uniform1f(this._uDiffuseFresnelPower,r._diffuseFresnel.power)),r._specularFresnel&&(this._uSpecularFresnelEdgeBias&&o.uniform1f(this._uSpecularFresnelEdgeBias,r._specularFresnel.edgeBias),this._uSpecularFresnelCenterBias&&o.uniform1f(this._uSpecularFresnelCenterBias,r._specularFresnel.centerBias),this._uSpecularFresnelEdgeColor&&o.uniform3fv(this._uSpecularFresnelEdgeColor,r._specularFresnel.edgeColor),this._uSpecularFresnelCenterColor&&o.uniform3fv(this._uSpecularFresnelCenterColor,r._specularFresnel.centerColor),this._uSpecularFresnelPower&&o.uniform1f(this._uSpecularFresnelPower,r._specularFresnel.power)),r._alphaFresnel&&(this._uAlphaFresnelEdgeBias&&o.uniform1f(this._uAlphaFresnelEdgeBias,r._alphaFresnel.edgeBias),this._uAlphaFresnelCenterBias&&o.uniform1f(this._uAlphaFresnelCenterBias,r._alphaFresnel.centerBias),this._uAlphaFresnelEdgeColor&&o.uniform3fv(this._uAlphaFresnelEdgeColor,r._alphaFresnel.edgeColor),this._uAlphaFresnelCenterColor&&o.uniform3fv(this._uAlphaFresnelCenterColor,r._alphaFresnel.centerColor),this._uAlphaFresnelPower&&o.uniform1f(this._uAlphaFresnelPower,r._alphaFresnel.power)),r._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias&&o.uniform1f(this._uReflectivityFresnelEdgeBias,r._reflectivityFresnel.edgeBias),this._uReflectivityFresnelCenterBias&&o.uniform1f(this._uReflectivityFresnelCenterBias,r._reflectivityFresnel.centerBias),this._uReflectivityFresnelEdgeColor&&o.uniform3fv(this._uReflectivityFresnelEdgeColor,r._reflectivityFresnel.edgeColor),this._uReflectivityFresnelCenterColor&&o.uniform3fv(this._uReflectivityFresnelCenterColor,r._reflectivityFresnel.centerColor),this._uReflectivityFresnelPower&&o.uniform1f(this._uReflectivityFresnelPower,r._reflectivityFresnel.power)),r._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias&&o.uniform1f(this._uEmissiveFresnelEdgeBias,r._emissiveFresnel.edgeBias),this._uEmissiveFresnelCenterBias&&o.uniform1f(this._uEmissiveFresnelCenterBias,r._emissiveFresnel.centerBias),this._uEmissiveFresnelEdgeColor&&o.uniform3fv(this._uEmissiveFresnelEdgeColor,r._emissiveFresnel.edgeColor),this._uEmissiveFresnelCenterColor&&o.uniform3fv(this._uEmissiveFresnelCenterColor,r._emissiveFresnel.centerColor),this._uEmissiveFresnelPower&&o.uniform1f(this._uEmissiveFresnelPower,r._emissiveFresnel.power));break;case"MetallicMaterial":this._uBaseColor&&o.uniform3fv(this._uBaseColor,h.baseColor),this._uMaterialMetallic&&o.uniform1f(this._uMaterialMetallic,h.metallic),this._uMaterialRoughness&&o.uniform1f(this._uMaterialRoughness,h.roughness),this._uMaterialSpecularF0&&o.uniform1f(this._uMaterialSpecularF0,h.specularF0),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);const e=r._baseColorMap;e&&e._state.texture&&this._uBaseColorMap&&(n.bindTexture(this._uBaseColorMap,e._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uBaseColorMapMatrix&&o.uniformMatrix4fv(this._uBaseColorMapMatrix,!1,e._state.matrix));const i=r._metallicMap;i&&i._state.texture&&this._uMetallicMap&&(n.bindTexture(this._uMetallicMap,i._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uMetallicMapMatrix&&o.uniformMatrix4fv(this._uMetallicMapMatrix,!1,i._state.matrix));const a=r._roughnessMap;a&&a._state.texture&&this._uRoughnessMap&&(n.bindTexture(this._uRoughnessMap,a._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uRoughnessMapMatrix&&o.uniformMatrix4fv(this._uRoughnessMapMatrix,!1,a._state.matrix));const l=r._metallicRoughnessMap;l&&l._state.texture&&this._uMetallicRoughnessMap&&(n.bindTexture(this._uMetallicRoughnessMap,l._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uMetallicRoughnessMapMatrix&&o.uniformMatrix4fv(this._uMetallicRoughnessMapMatrix,!1,l._state.matrix)),(d=r._emissiveMap)&&d._state.texture&&this._uEmissiveMap&&(n.bindTexture(this._uEmissiveMap,d._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._state.matrix)),(m=r._occlusionMap)&&r._occlusionMap._state.texture&&this._uOcclusionMap&&(n.bindTexture(this._uOcclusionMap,m._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,m._state.matrix)),(f=r._alphaMap)&&f._state.texture&&this._uAlphaMap&&(n.bindTexture(this._uAlphaMap,f._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,f._state.matrix)),(g=r._normalMap)&&g._state.texture&&this._uNormalMap&&(n.bindTexture(this._uNormalMap,g._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,g._state.matrix));break;case"SpecularMaterial":this._uMaterialDiffuse&&o.uniform3fv(this._uMaterialDiffuse,h.diffuse),this._uMaterialSpecular&&o.uniform3fv(this._uMaterialSpecular,h.specular),this._uMaterialGlossiness&&o.uniform1f(this._uMaterialGlossiness,h.glossiness),this._uMaterialReflectivity&&o.uniform1f(this._uMaterialReflectivity,h.reflectivity),this._uMaterialEmissive&&o.uniform3fv(this._uMaterialEmissive,h.emissive),this._uAlphaModeCutoff&&o.uniform4f(this._uAlphaModeCutoff,1*h.alpha,1===h.alphaMode?1:0,h.alphaCutoff,0);const u=r._diffuseMap;u&&u._state.texture&&this._uDiffuseMap&&(n.bindTexture(this._uDiffuseMap,u._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uDiffuseMapMatrix&&o.uniformMatrix4fv(this._uDiffuseMapMatrix,!1,u._state.matrix));const p=r._specularMap;p&&p._state.texture&&this._uSpecularMap&&(n.bindTexture(this._uSpecularMap,p._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uSpecularMapMatrix&&o.uniformMatrix4fv(this._uSpecularMapMatrix,!1,p._state.matrix));const c=r._glossinessMap;c&&c._state.texture&&this._uGlossinessMap&&(n.bindTexture(this._uGlossinessMap,c._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uGlossinessMapMatrix&&o.uniformMatrix4fv(this._uGlossinessMapMatrix,!1,c._state.matrix));const _=r._specularGlossinessMap;var d,m,f,g;_&&_._state.texture&&this._uSpecularGlossinessMap&&(n.bindTexture(this._uSpecularGlossinessMap,_._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uSpecularGlossinessMapMatrix&&o.uniformMatrix4fv(this._uSpecularGlossinessMapMatrix,!1,_._state.matrix)),(d=r._emissiveMap)&&d._state.texture&&this._uEmissiveMap&&(n.bindTexture(this._uEmissiveMap,d._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uEmissiveMapMatrix&&o.uniformMatrix4fv(this._uEmissiveMapMatrix,!1,d._state.matrix)),(m=r._occlusionMap)&&m._state.texture&&this._uOcclusionMap&&(n.bindTexture(this._uOcclusionMap,m._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uOcclusionMapMatrix&&o.uniformMatrix4fv(this._uOcclusionMapMatrix,!1,m._state.matrix)),(f=r._alphaMap)&&f._state.texture&&this._uAlphaMap&&(n.bindTexture(this._uAlphaMap,f._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uAlphaMapMatrix&&o.uniformMatrix4fv(this._uAlphaMapMatrix,!1,f._state.matrix)),(g=r._normalMap)&&g._state.texture&&this._uNormalMap&&(n.bindTexture(this._uNormalMap,g._state.texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%s,t.bindTexture++,this._uNormalMapMatrix&&o.uniformMatrix4fv(this._uNormalMapMatrix,!1,g._state.matrix))}this._lastMaterialId=h.id}if(o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,e.worldMatrix),this._uModelNormalMatrix&&o.uniformMatrix4fv(this._uModelNormalMatrix,o.FALSE,e.worldNormalMatrix),this._uClippable&&o.uniform1i(this._uClippable,a.clippable),this._uColorize){const t=a.colorize,e=this._lastColorize;e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]||(o.uniform4fv(this._uColorize,t),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3])}o.uniform3fv(this._uOffset,a.offset),l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._uUVDecodeMatrix&&o.uniformMatrix3fv(this._uUVDecodeMatrix,!1,l.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf),t.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(l.normalsBuf),t.bindArray++),this._aUV&&(this._aUV.bindArrayBuffer(l.uvBuf),t.bindArray++),this._aColor&&(this._aColor.bindArrayBuffer(l.colorsBuf),t.bindArray++),this._aFlags&&(this._aFlags.bindArrayBuffer(l.flagsBuf),t.bindArray++),l.indicesBuf&&(l.indicesBuf.bind(),t.bindArray++),this._lastGeometryId=l.id),l.indicesBuf?(o.drawElements(l.primitive,l.indicesBuf.numItems,l.indicesBuf.itemType,0),t.drawElements++):l.positions&&(o.drawArrays(o.TRIANGLES,0,l.positions.numItems),t.drawArrays++),c&&o.depthFunc(o.LESS)},Ze.prototype._allocate=function(t){const e=t.scene,s=e.canvas.gl,i=t._material,r=e._lightsState,o=e._sectionPlanesState,n=t._material._state;if(this._program=new Mt(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const a=this._program;this._uPositionsDecodeMatrix=a.getLocation("positionsDecodeMatrix"),this._uUVDecodeMatrix=a.getLocation("uvDecodeMatrix"),this._uModelMatrix=a.getLocation("modelMatrix"),this._uModelNormalMatrix=a.getLocation("modelNormalMatrix"),this._uViewMatrix=a.getLocation("viewMatrix"),this._uViewNormalMatrix=a.getLocation("viewNormalMatrix"),this._uProjMatrix=a.getLocation("projMatrix"),this._uGammaFactor=a.getLocation("gammaFactor"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[],this._uShadowViewMatrix=[],this._uShadowProjMatrix=[],e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=a.getLocation("logDepthBufFC"));const h=r.lights;let l;for(var u=0,p=h.length;u<p;u++){switch(l=h[u],l.type){case"ambient":this._uLightAmbient[u]=a.getLocation("lightAmbient");break;case"dir":this._uLightColor[u]=a.getLocation("lightColor"+u),this._uLightPos[u]=null,this._uLightDir[u]=a.getLocation("lightDir"+u);break;case"point":this._uLightColor[u]=a.getLocation("lightColor"+u),this._uLightPos[u]=a.getLocation("lightPos"+u),this._uLightDir[u]=null,this._uLightAttenuation[u]=a.getLocation("lightAttenuation"+u);break;case"spot":this._uLightColor[u]=a.getLocation("lightColor"+u),this._uLightPos[u]=a.getLocation("lightPos"+u),this._uLightDir[u]=a.getLocation("lightDir"+u),this._uLightAttenuation[u]=a.getLocation("lightAttenuation"+u)}l.castsShadow&&(this._uShadowViewMatrix[u]=a.getLocation("shadowViewMatrix"+u),this._uShadowProjMatrix[u]=a.getLocation("shadowProjMatrix"+u))}r.lightMaps.length>0&&(this._uLightMap="lightMap"),r.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),this._uSectionPlanes=[];for(u=0,p=o.sectionPlanes.length;u<p;u++)this._uSectionPlanes.push({active:a.getLocation("sectionPlaneActive"+u),pos:a.getLocation("sectionPlanePos"+u),dir:a.getLocation("sectionPlaneDir"+u)});switch(this._uPointSize=a.getLocation("pointSize"),n.type){case"LambertMaterial":this._uMaterialColor=a.getLocation("materialColor"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff");break;case"PhongMaterial":this._uMaterialAmbient=a.getLocation("materialAmbient"),this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),this._uMaterialShininess=a.getLocation("materialShininess"),i._ambientMap&&(this._uMaterialAmbientMap="ambientMap",this._uMaterialAmbientMapMatrix=a.getLocation("ambientMapMatrix")),i._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),i._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),i._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),i._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),i._reflectivityMap&&(this._uReflectivityMap="reflectivityMap",this._uReflectivityMapMatrix=a.getLocation("reflectivityMapMatrix")),i._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix")),i._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),i._diffuseFresnel&&(this._uDiffuseFresnelEdgeBias=a.getLocation("diffuseFresnelEdgeBias"),this._uDiffuseFresnelCenterBias=a.getLocation("diffuseFresnelCenterBias"),this._uDiffuseFresnelEdgeColor=a.getLocation("diffuseFresnelEdgeColor"),this._uDiffuseFresnelCenterColor=a.getLocation("diffuseFresnelCenterColor"),this._uDiffuseFresnelPower=a.getLocation("diffuseFresnelPower")),i._specularFresnel&&(this._uSpecularFresnelEdgeBias=a.getLocation("specularFresnelEdgeBias"),this._uSpecularFresnelCenterBias=a.getLocation("specularFresnelCenterBias"),this._uSpecularFresnelEdgeColor=a.getLocation("specularFresnelEdgeColor"),this._uSpecularFresnelCenterColor=a.getLocation("specularFresnelCenterColor"),this._uSpecularFresnelPower=a.getLocation("specularFresnelPower")),i._alphaFresnel&&(this._uAlphaFresnelEdgeBias=a.getLocation("alphaFresnelEdgeBias"),this._uAlphaFresnelCenterBias=a.getLocation("alphaFresnelCenterBias"),this._uAlphaFresnelEdgeColor=a.getLocation("alphaFresnelEdgeColor"),this._uAlphaFresnelCenterColor=a.getLocation("alphaFresnelCenterColor"),this._uAlphaFresnelPower=a.getLocation("alphaFresnelPower")),i._reflectivityFresnel&&(this._uReflectivityFresnelEdgeBias=a.getLocation("reflectivityFresnelEdgeBias"),this._uReflectivityFresnelCenterBias=a.getLocation("reflectivityFresnelCenterBias"),this._uReflectivityFresnelEdgeColor=a.getLocation("reflectivityFresnelEdgeColor"),this._uReflectivityFresnelCenterColor=a.getLocation("reflectivityFresnelCenterColor"),this._uReflectivityFresnelPower=a.getLocation("reflectivityFresnelPower")),i._emissiveFresnel&&(this._uEmissiveFresnelEdgeBias=a.getLocation("emissiveFresnelEdgeBias"),this._uEmissiveFresnelCenterBias=a.getLocation("emissiveFresnelCenterBias"),this._uEmissiveFresnelEdgeColor=a.getLocation("emissiveFresnelEdgeColor"),this._uEmissiveFresnelCenterColor=a.getLocation("emissiveFresnelCenterColor"),this._uEmissiveFresnelPower=a.getLocation("emissiveFresnelPower"));break;case"MetallicMaterial":this._uBaseColor=a.getLocation("materialBaseColor"),this._uMaterialMetallic=a.getLocation("materialMetallic"),this._uMaterialRoughness=a.getLocation("materialRoughness"),this._uMaterialSpecularF0=a.getLocation("materialSpecularF0"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),i._baseColorMap&&(this._uBaseColorMap="baseColorMap",this._uBaseColorMapMatrix=a.getLocation("baseColorMapMatrix")),i._metallicMap&&(this._uMetallicMap="metallicMap",this._uMetallicMapMatrix=a.getLocation("metallicMapMatrix")),i._roughnessMap&&(this._uRoughnessMap="roughnessMap",this._uRoughnessMapMatrix=a.getLocation("roughnessMapMatrix")),i._metallicRoughnessMap&&(this._uMetallicRoughnessMap="metallicRoughnessMap",this._uMetallicRoughnessMapMatrix=a.getLocation("metallicRoughnessMapMatrix")),i._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),i._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),i._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),i._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"));break;case"SpecularMaterial":this._uMaterialDiffuse=a.getLocation("materialDiffuse"),this._uMaterialSpecular=a.getLocation("materialSpecular"),this._uMaterialGlossiness=a.getLocation("materialGlossiness"),this._uMaterialReflectivity=a.getLocation("reflectivityFresnel"),this._uMaterialEmissive=a.getLocation("materialEmissive"),this._uAlphaModeCutoff=a.getLocation("materialAlphaModeCutoff"),i._diffuseMap&&(this._uDiffuseMap="diffuseMap",this._uDiffuseMapMatrix=a.getLocation("diffuseMapMatrix")),i._specularMap&&(this._uSpecularMap="specularMap",this._uSpecularMapMatrix=a.getLocation("specularMapMatrix")),i._glossinessMap&&(this._uGlossinessMap="glossinessMap",this._uGlossinessMapMatrix=a.getLocation("glossinessMapMatrix")),i._specularGlossinessMap&&(this._uSpecularGlossinessMap="materialSpecularGlossinessMap",this._uSpecularGlossinessMapMatrix=a.getLocation("materialSpecularGlossinessMapMatrix")),i._emissiveMap&&(this._uEmissiveMap="emissiveMap",this._uEmissiveMapMatrix=a.getLocation("emissiveMapMatrix")),i._occlusionMap&&(this._uOcclusionMap="occlusionMap",this._uOcclusionMapMatrix=a.getLocation("occlusionMapMatrix")),i._alphaMap&&(this._uAlphaMap="alphaMap",this._uAlphaMapMatrix=a.getLocation("alphaMapMatrix")),i._normalMap&&(this._uNormalMap="normalMap",this._uNormalMapMatrix=a.getLocation("normalMapMatrix"))}this._aPosition=a.getAttribute("position"),this._aNormal=a.getAttribute("normal"),this._aUV=a.getAttribute("uv"),this._aColor=a.getAttribute("color"),this._aFlags=a.getAttribute("flags"),this._uClippable=a.getLocation("clippable"),this._uColorize=a.getLocation("colorize"),this._uOffset=a.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize=new Float32Array(4),this._baseTextureUnit=0},Ze.prototype._bindProgram=function(t){const e=pt.MAX_TEXTURE_UNITS,s=this._scene,i=s.canvas.gl,r=s._lightsState,o=s.camera.project;let n;const a=this._program;if(a.bind(),t.useProgram++,t.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastColorize[0]=-1,this._lastColorize[1]=-1,this._lastColorize[2]=-1,this._lastColorize[3]=-1,i.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),s.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,t)}for(var h=0,l=r.lights.length;h<l;h++)if(n=r.lights[h],this._uLightAmbient[h])i.uniform4f(this._uLightAmbient[h],n.color[0],n.color[1],n.color[2],n.intensity);else if(this._uLightColor[h]&&i.uniform4f(this._uLightColor[h],n.color[0],n.color[1],n.color[2],n.intensity),this._uLightPos[h]&&(i.uniform3fv(this._uLightPos[h],n.pos),this._uLightAttenuation[h]&&i.uniform1f(this._uLightAttenuation[h],n.attenuation)),this._uLightDir[h]&&i.uniform3fv(this._uLightDir[h],n.dir),n.castsShadow){this._uShadowViewMatrix[h]&&i.uniformMatrix4fv(this._uShadowViewMatrix[h],!1,n.getShadowViewMatrix()),this._uShadowProjMatrix[h]&&i.uniformMatrix4fv(this._uShadowProjMatrix[h],!1,n.getShadowProjMatrix());const s=n.getShadowRenderBuf();s&&(a.bindTexture("shadowMap"+h,s.getTexture(),t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++)}r.lightMaps.length>0&&r.lightMaps[0].texture&&this._uLightMap&&(a.bindTexture(this._uLightMap,r.lightMaps[0].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++),r.reflectionMaps.length>0&&r.reflectionMaps[0].texture&&this._uReflectionMap&&(a.bindTexture(this._uReflectionMap,r.reflectionMaps[0].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++),this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor),this._baseTextureUnit=t.textureUnit};class $e{constructor(t){this.vertex=function(t){const e=t.scene,s=e._lightsState,i=function(t){const e=t._geometry._state.primitiveName;if((t._geometry._state.autoVertexNormals||t._geometry._state.normalsBuf)&&("triangles"===e||"triangle-strip"===e||"triangle-fan"===e))return!0;return!1}(t),r=e._sectionPlanesState.sectionPlanes.length>0,o=!!t._geometry._state.compressGeometry,n=t._state.billboard,a=t._state.stationary,h=[];h.push("// EmphasisFillShaderSource vertex shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&h.push("#extension GL_EXT_frag_depth : enable");h.push("attribute vec3 position;"),h.push("uniform mat4 modelMatrix;"),h.push("uniform mat4 viewMatrix;"),h.push("uniform mat4 projMatrix;"),h.push("uniform vec4 colorize;"),h.push("uniform vec3 offset;"),o&&h.push("uniform mat4 positionsDecodeMatrix;");e.logarithmicDepthBufferEnabled&&(h.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&h.push("varying float vFragDepth;"),h.push("bool isPerspectiveMatrix(mat4 m) {"),h.push("    return (m[2][3] == - 1.0);"),h.push("}"),h.push("varying float isPerspective;"));r&&h.push("varying vec4 vWorldPosition;");if(h.push("uniform vec4   lightAmbient;"),h.push("uniform vec4   fillColor;"),i){h.push("attribute vec3 normal;"),h.push("uniform mat4 modelNormalMatrix;"),h.push("uniform mat4 viewNormalMatrix;");for(let t=0,e=s.lights.length;t<e;t++){const e=s.lights[t];"ambient"!==e.type&&(h.push("uniform vec4 lightColor"+t+";"),"dir"===e.type&&h.push("uniform vec3 lightDir"+t+";"),"point"===e.type&&h.push("uniform vec3 lightPos"+t+";"),"spot"===e.type&&h.push("uniform vec3 lightPos"+t+";"))}o&&(h.push("vec3 octDecode(vec2 oct) {"),h.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),h.push("    if (v.z < 0.0) {"),h.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),h.push("    }"),h.push("    return normalize(v);"),h.push("}"))}h.push("varying vec4 vColor;"),("spherical"===n||"cylindrical"===n)&&(h.push("void billboard(inout mat4 mat) {"),h.push("   mat[0][0] = 1.0;"),h.push("   mat[0][1] = 0.0;"),h.push("   mat[0][2] = 0.0;"),"spherical"===n&&(h.push("   mat[1][0] = 0.0;"),h.push("   mat[1][1] = 1.0;"),h.push("   mat[1][2] = 0.0;")),h.push("   mat[2][0] = 0.0;"),h.push("   mat[2][1] = 0.0;"),h.push("   mat[2][2] =1.0;"),h.push("}"));h.push("void main(void) {"),h.push("vec4 localPosition = vec4(position, 1.0); "),h.push("vec4 worldPosition;"),o&&h.push("localPosition = positionsDecodeMatrix * localPosition;");i&&(o?h.push("vec4 localNormal = vec4(octDecode(normal.xy), 0.0); "):h.push("vec4 localNormal = vec4(normal, 0.0); "),h.push("mat4 modelNormalMatrix2 = modelNormalMatrix;"),h.push("mat4 viewNormalMatrix2 = viewNormalMatrix;"));h.push("mat4 viewMatrix2 = viewMatrix;"),h.push("mat4 modelMatrix2 = modelMatrix;"),a&&h.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===n||"cylindrical"===n?(h.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),h.push("billboard(modelMatrix2);"),h.push("billboard(viewMatrix2);"),h.push("billboard(modelViewMatrix);"),i&&(h.push("mat4 modelViewNormalMatrix =  viewNormalMatrix2 * modelNormalMatrix2;"),h.push("billboard(modelNormalMatrix2);"),h.push("billboard(viewNormalMatrix2);"),h.push("billboard(modelViewNormalMatrix);")),h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(h.push("worldPosition = modelMatrix2 * localPosition;"),h.push("worldPosition.xyz = worldPosition.xyz + offset;"),h.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));i&&h.push("vec3 viewNormal = normalize((viewNormalMatrix2 * modelNormalMatrix2 * localNormal).xyz);");if(h.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),h.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),h.push("float lambertian = 1.0;"),i)for(let t=0,e=s.lights.length;t<e;t++){const e=s.lights[t];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?h.push("viewLightDir = normalize(lightDir"+t+");"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightDir"+t+", 0.0)).xyz);");else{if("point"!==e.type)continue;"view"===e.space?h.push("viewLightDir = normalize(lightPos"+t+" - viewPosition.xyz);"):h.push("viewLightDir = normalize((viewMatrix2 * vec4(lightPos"+t+", 0.0)).xyz);")}h.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),h.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}h.push("vColor = vec4(reflectedColor * fillColor.rgb, fillColor.a);"),r&&h.push("vWorldPosition = worldPosition;");"points"===t._geometry._state.primitiveName&&h.push("gl_PointSize = pointSize;");h.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?h.push("vFragDepth = 1.0 + clipPos.w;"):(h.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),h.push("clipPos.z *= clipPos.w;")),h.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return h.push("gl_Position = clipPos;"),h.push("}"),h}(t),this.fragment=function(t){const e=t.scene,s=t.scene._sectionPlanesState,i=t.scene.gammaOutput,r=s.sectionPlanes.length>0,o=[];o.push("// Lambertian drawing fragment shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable");o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;"));i&&(o.push("uniform float gammaFactor;"),o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}"));if(r){o.push("varying vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)o.push("uniform bool sectionPlaneActive"+t+";"),o.push("uniform vec3 sectionPlanePos"+t+";"),o.push("uniform vec3 sectionPlaneDir"+t+";")}if(o.push("varying vec4 vColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)o.push("if (sectionPlaneActive"+t+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}"points"===t._geometry._state.primitiveName&&(o.push("vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("float r = dot(cxy, cxy);"),o.push("if (r > 1.0) {"),o.push("   discard;"),o.push("}"));e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");i?o.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):o.push("gl_FragColor = vColor;");return o.push("}"),o}(t)}}const Qe=new t({}),Je=c.vec3(),ts=function(t,e){this.id=Qe.addItem({}),this._hash=t,this._scene=e.scene,this._useCount=0,this._shaderSource=new $e(e),this._allocate(e)},es={};ts.get=function(t){const e=[t.scene.id,t.scene.gammaOutput?"go":"",t.scene._sectionPlanesState.getHash(),t._geometry._state.normalsBuf?"n":"",t._geometry._state.compressGeometry?"cp":"",t._state.hash].join(";");let s=es[e];return s||(s=new ts(e,t),es[e]=s,m.memory.programs++),s._useCount++,s},ts.prototype.put=function(){0==--this._useCount&&(Qe.removeItem(this.id),this._program&&this._program.destroy(),delete es[this._hash],m.memory.programs--)},ts.prototype.webglContextRestored=function(){this._program=null},ts.prototype.drawMesh=function(t,e,s){this._program||this._allocate(e);const i=this._scene,r=i.camera,o=i.canvas.gl,n=0===s?e._xrayMaterial._state:1===s?e._highlightMaterial._state:e._selectedMaterial._state,a=e._state,h=e._geometry._state,l=e.origin;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),o.uniformMatrix4fv(this._uViewMatrix,!1,l?t.getRTCViewMatrix(a.originHash,l):r.viewMatrix),o.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),a.clippable){const t=i._sectionPlanesState.sectionPlanes.length;if(t>0){const s=i._sectionPlanesState.sectionPlanes,r=e.renderFlags;for(let e=0;e<t;e++){const t=this._uSectionPlanes[e];if(t){const i=r.sectionPlanesActivePerLayer[e];if(o.uniform1i(t.active,i?1:0),i){const i=s[e];o.uniform3fv(t.pos,l?Y(i.dist,i.dir,l,Je):i.pos),o.uniform3fv(t.dir,i.dir)}}}}}if(n.id!==this._lastMaterialId){const e=n.fillColor,s=n.backfaces;t.backfaces!==s&&(s?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),t.backfaces=s),o.uniform4f(this._uFillColor,e[0],e[1],e[2],n.fillAlpha),this._lastMaterialId=n.id}o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,e.worldMatrix),this._uModelNormalMatrix&&o.uniformMatrix4fv(this._uModelNormalMatrix,o.FALSE,e.worldNormalMatrix),this._uClippable&&o.uniform1i(this._uClippable,a.clippable),o.uniform3fv(this._uOffset,a.offset),h.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,h.positionsDecodeMatrix),this._uUVDecodeMatrix&&o.uniformMatrix3fv(this._uUVDecodeMatrix,!1,h.uvDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(h.positionsBuf),t.bindArray++),this._aNormal&&(this._aNormal.bindArrayBuffer(h.normalsBuf),t.bindArray++),h.indicesBuf?(h.indicesBuf.bind(),t.bindArray++):h.positionsBuf,this._lastGeometryId=h.id),h.indicesBuf?(o.drawElements(h.primitive,h.indicesBuf.numItems,h.indicesBuf.itemType,0),t.drawElements++):h.positionsBuf&&(o.drawArrays(o.TRIANGLES,0,h.positionsBuf.numItems),t.drawArrays++)},ts.prototype._allocate=function(t){const e=t.scene,s=e._lightsState,i=e._sectionPlanesState,r=e.canvas.gl;if(this._program=new Mt(r,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const o=this._program;this._uPositionsDecodeMatrix=o.getLocation("positionsDecodeMatrix"),this._uModelMatrix=o.getLocation("modelMatrix"),this._uModelNormalMatrix=o.getLocation("modelNormalMatrix"),this._uViewMatrix=o.getLocation("viewMatrix"),this._uViewNormalMatrix=o.getLocation("viewNormalMatrix"),this._uProjMatrix=o.getLocation("projMatrix"),this._uLightAmbient=[],this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];for(let t=0,e=s.lights.length;t<e;t++){switch(s.lights[t].type){case"ambient":this._uLightAmbient[t]=o.getLocation("lightAmbient");break;case"dir":this._uLightColor[t]=o.getLocation("lightColor"+t),this._uLightPos[t]=null,this._uLightDir[t]=o.getLocation("lightDir"+t);break;case"point":this._uLightColor[t]=o.getLocation("lightColor"+t),this._uLightPos[t]=o.getLocation("lightPos"+t),this._uLightDir[t]=null,this._uLightAttenuation[t]=o.getLocation("lightAttenuation"+t)}}this._uSectionPlanes=[];for(let t=0,e=i.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:o.getLocation("sectionPlaneActive"+t),pos:o.getLocation("sectionPlanePos"+t),dir:o.getLocation("sectionPlaneDir"+t)});this._uFillColor=o.getLocation("fillColor"),this._aPosition=o.getAttribute("position"),this._aNormal=o.getAttribute("normal"),this._uClippable=o.getLocation("clippable"),this._uGammaFactor=o.getLocation("gammaFactor"),this._uOffset=o.getLocation("offset"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=o.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},ts.prototype._bindProgram=function(t){const e=this._scene,s=e.canvas.gl,i=e._lightsState,r=e.camera,o=r.project;if(this._program.bind(),t.useProgram++,t.textureUnit=0,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,this._lastIndicesBufId=null,s.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.normalMatrix),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),e.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];this._uLightAmbient[t]?s.uniform4f(this._uLightAmbient[t],e.color[0],e.color[1],e.color[2],e.intensity):(this._uLightColor[t]&&s.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(s.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&s.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&s.uniform3fv(this._uLightDir[t],e.dir))}this._uGammaFactor&&s.uniform1f(this._uGammaFactor,e.gammaFactor)};class ss{constructor(t){this.vertex=function(t){const e=t.scene,s=e._sectionPlanesState.sectionPlanes.length>0,i=!!t._geometry._state.compressGeometry,r=t._state.billboard,o=t._state.stationary,n=[];n.push("// Edges drawing vertex shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable");n.push("attribute vec3 position;"),n.push("uniform mat4 modelMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform vec4 edgeColor;"),n.push("uniform vec3 offset;"),i&&n.push("uniform mat4 positionsDecodeMatrix;");e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("varying float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("varying float isPerspective;"));s&&n.push("varying vec4 vWorldPosition;");n.push("varying vec4 vColor;"),("spherical"===r||"cylindrical"===r)&&(n.push("void billboard(inout mat4 mat) {"),n.push("   mat[0][0] = 1.0;"),n.push("   mat[0][1] = 0.0;"),n.push("   mat[0][2] = 0.0;"),"spherical"===r&&(n.push("   mat[1][0] = 0.0;"),n.push("   mat[1][1] = 1.0;"),n.push("   mat[1][2] = 0.0;")),n.push("   mat[2][0] = 0.0;"),n.push("   mat[2][1] = 0.0;"),n.push("   mat[2][2] =1.0;"),n.push("}"));n.push("void main(void) {"),n.push("vec4 localPosition = vec4(position, 1.0); "),n.push("vec4 worldPosition;"),i&&n.push("localPosition = positionsDecodeMatrix * localPosition;");n.push("mat4 viewMatrix2 = viewMatrix;"),n.push("mat4 modelMatrix2 = modelMatrix;"),o&&n.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"===r||"cylindrical"===r?(n.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),n.push("billboard(modelMatrix2);"),n.push("billboard(viewMatrix2);"),n.push("billboard(modelViewMatrix);"),n.push("worldPosition = modelMatrix2 * localPosition;"),n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition = modelViewMatrix * localPosition;")):(n.push("worldPosition = modelMatrix2 * localPosition;"),n.push("worldPosition.xyz = worldPosition.xyz + offset;"),n.push("vec4 viewPosition  = viewMatrix2 * worldPosition; "));n.push("vColor = edgeColor;"),s&&n.push("vWorldPosition = worldPosition;");n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?n.push("vFragDepth = 1.0 + clipPos.w;"):(n.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),n.push("clipPos.z *= clipPos.w;")),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return n.push("gl_Position = clipPos;"),n.push("}"),n}(t),this.fragment=function(t){const e=t.scene,s=t.scene._sectionPlanesState,i=t.scene.gammaOutput,r=s.sectionPlanes.length>0,o=[];o.push("// Edges drawing fragment shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable");o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;"));i&&(o.push("uniform float gammaFactor;"),o.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),o.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),o.push("}"));if(r){o.push("varying vec4 vWorldPosition;"),o.push("uniform bool clippable;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)o.push("uniform bool sectionPlaneActive"+t+";"),o.push("uniform vec3 sectionPlanePos"+t+";"),o.push("uniform vec3 sectionPlaneDir"+t+";")}if(o.push("varying vec4 vColor;"),o.push("void main(void) {"),r){o.push("if (clippable) {"),o.push("  float dist = 0.0;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)o.push("if (sectionPlaneActive"+t+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");i?o.push("gl_FragColor = linearToGamma(vColor, gammaFactor);"):o.push("gl_FragColor = vColor;");return o.push("}"),o}(t)}}const is=new t({}),rs=c.vec3(),os=function(t,e){this.id=is.addItem({}),this._hash=t,this._scene=e.scene,this._useCount=0,this._shaderSource=new ss(e),this._allocate(e)},ns={};os.get=function(t){const e=[t.scene.id,t.scene.gammaOutput?"go":"",t.scene._sectionPlanesState.getHash(),t._geometry._state.compressGeometry?"cp":"",t._state.hash].join(";");let s=ns[e];return s||(s=new os(e,t),ns[e]=s,m.memory.programs++),s._useCount++,s},os.prototype.put=function(){0==--this._useCount&&(is.removeItem(this.id),this._program&&this._program.destroy(),delete ns[this._hash],m.memory.programs--)},os.prototype.webglContextRestored=function(){this._program=null},os.prototype.drawMesh=function(t,e,s){this._program||this._allocate(e);const i=this._scene,r=i.camera,o=i.canvas.gl;let n;const a=e._state,h=e._geometry,l=h._state,u=e.origin;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),o.uniformMatrix4fv(this._uViewMatrix,!1,u?t.getRTCViewMatrix(a.originHash,u):r.viewMatrix),a.clippable){const t=i._sectionPlanesState.sectionPlanes.length;if(t>0){const s=i._sectionPlanesState.sectionPlanes,r=e.renderFlags;for(let e=0;e<t;e++){const t=this._uSectionPlanes[e];if(t){const i=r.sectionPlanesActivePerLayer[e];if(o.uniform1i(t.active,i?1:0),i){const i=s[e];o.uniform3fv(t.pos,u?Y(i.dist,i.dir,u,rs):i.pos),o.uniform3fv(t.dir,i.dir)}}}}}switch(s){case 0:n=e._xrayMaterial._state;break;case 1:n=e._highlightMaterial._state;break;case 2:n=e._selectedMaterial._state;break;default:n=e._edgeMaterial._state}if(n.id!==this._lastMaterialId){const e=n.backfaces;if(t.backfaces!==e&&(e?o.disable(o.CULL_FACE):o.enable(o.CULL_FACE),t.backfaces=e),t.lineWidth!==n.edgeWidth&&(o.lineWidth(n.edgeWidth),t.lineWidth=n.edgeWidth),this._uEdgeColor){const t=n.edgeColor,e=n.edgeAlpha;o.uniform4f(this._uEdgeColor,t[0],t[1],t[2],e)}this._lastMaterialId=n.id}let p;o.uniformMatrix4fv(this._uModelMatrix,o.FALSE,e.worldMatrix),this._uClippable&&o.uniform1i(this._uClippable,a.clippable),o.uniform3fv(this._uOffset,a.offset),l.primitive===o.TRIANGLES?p=h._getEdgeIndices():l.primitive===o.LINES&&(p=l.indicesBuf),p&&(l.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,l.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(l.positionsBuf,l.compressGeometry?o.UNSIGNED_SHORT:o.FLOAT),t.bindArray++),p.bind(),t.bindArray++,this._lastGeometryId=l.id),o.drawElements(o.LINES,p.numItems,p.itemType,0),t.drawElements++)},os.prototype._allocate=function(t){const e=t.scene,s=e.canvas.gl,i=e._sectionPlanesState;if(this._program=new Mt(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const r=this._program;this._uPositionsDecodeMatrix=r.getLocation("positionsDecodeMatrix"),this._uModelMatrix=r.getLocation("modelMatrix"),this._uViewMatrix=r.getLocation("viewMatrix"),this._uProjMatrix=r.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=i.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:r.getLocation("sectionPlaneActive"+t),pos:r.getLocation("sectionPlanePos"+t),dir:r.getLocation("sectionPlaneDir"+t)});this._uEdgeColor=r.getLocation("edgeColor"),this._aPosition=r.getAttribute("position"),this._uClippable=r.getLocation("clippable"),this._uGammaFactor=r.getLocation("gammaFactor"),this._uOffset=r.getLocation("offset"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=r.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},os.prototype._bindProgram=function(t){const e=this._program,s=this._scene,i=s.canvas.gl,r=s.camera.project;if(e.bind(),t.useProgram++,this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,i.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),s.logarithmicDepthBufferEnabled){const t=2/(Math.log(r.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,t)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor)};class as{constructor(t){this.vertex=function(t){const e=t.scene,s=e._sectionPlanesState.sectionPlanes.length>0,i=!!t._geometry._state.compressGeometry,r=t._state.billboard,o=t._state.stationary,n=[];n.push("// Mesh picking vertex shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable");n.push("attribute vec3 position;"),n.push("uniform mat4 modelMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("varying vec4 vViewPosition;"),n.push("uniform vec3 offset;"),i&&n.push("uniform mat4 positionsDecodeMatrix;");s&&n.push("varying vec4 vWorldPosition;");e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("varying float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("varying float isPerspective;"));"spherical"!==r&&"cylindrical"!==r||(n.push("void billboard(inout mat4 mat) {"),n.push("   mat[0][0] = 1.0;"),n.push("   mat[0][1] = 0.0;"),n.push("   mat[0][2] = 0.0;"),"spherical"===r&&(n.push("   mat[1][0] = 0.0;"),n.push("   mat[1][1] = 1.0;"),n.push("   mat[1][2] = 0.0;")),n.push("   mat[2][0] = 0.0;"),n.push("   mat[2][1] = 0.0;"),n.push("   mat[2][2] =1.0;"),n.push("}"));n.push("void main(void) {"),n.push("vec4 localPosition = vec4(position, 1.0); "),i&&n.push("localPosition = positionsDecodeMatrix * localPosition;");n.push("mat4 viewMatrix2 = viewMatrix;"),n.push("mat4 modelMatrix2 = modelMatrix;"),o&&n.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"!==r&&"cylindrical"!==r||(n.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),n.push("billboard(modelMatrix2);"),n.push("billboard(viewMatrix2);"));n.push("   vec4 worldPosition = modelMatrix2 * localPosition;"),n.push("   worldPosition.xyz = worldPosition.xyz + offset;"),n.push("   vec4 viewPosition = viewMatrix2 * worldPosition;"),s&&n.push("   vWorldPosition = worldPosition;");n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?n.push("vFragDepth = 1.0 + clipPos.w;"):(n.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),n.push("clipPos.z *= clipPos.w;")),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return n.push("gl_Position = clipPos;"),n.push("}"),n}(t),this.fragment=function(t){const e=t.scene,s=e._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];r.push("// Mesh picking fragment shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable");r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;"));if(r.push("uniform vec4 pickColor;"),i){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(var o=0;o<s.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<s.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("   gl_FragColor = pickColor; "),r.push("}"),r}(t)}}const hs=c.vec3(),ls=function(t,e){this._hash=t,this._shaderSource=new as(e),this._scene=e.scene,this._useCount=0,this._allocate(e)},us={};ls.get=function(t){const e=[t.scene.canvas.canvas.id,t.scene._sectionPlanesState.getHash(),t._geometry._state.hash,t._state.hash].join(";");let s=us[e];if(!s){if(s=new ls(e,t),s.errors)return console.log(s.errors.join("\n")),null;us[e]=s,m.memory.programs++}return s._useCount++,s},ls.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete us[this._hash],m.memory.programs--)},ls.prototype.webglContextRestored=function(){this._program=null},ls.prototype.drawMesh=function(t,e){this._program||this._allocate(e);const s=this._scene,i=s.canvas.gl,r=e._state,o=e._material._state,n=e._geometry._state,a=e.origin;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),i.uniformMatrix4fv(this._uViewMatrix,!1,a?t.getRTCPickViewMatrix(r.originHash,a):t.pickViewMatrix),r.clippable){const t=s._sectionPlanesState.sectionPlanes.length;if(t>0){const r=s._sectionPlanesState.sectionPlanes,o=e.renderFlags;for(let e=0;e<t;e++){const t=this._uSectionPlanes[e];if(t){const s=o.sectionPlanesActivePerLayer[e];if(i.uniform1i(t.active,s?1:0),s){const s=r[e];i.uniform3fv(t.pos,a?Y(s.dist,s.dir,a,hs):s.pos),i.uniform3fv(t.dir,s.dir)}}}}}if(o.id!==this._lastMaterialId){const e=o.backfaces;t.backfaces!==e&&(e?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),t.backfaces=e);const s=o.frontface;t.frontface!==s&&(s?i.frontFace(i.CCW):i.frontFace(i.CW),t.frontface=s),this._lastMaterialId=o.id}i.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),i.uniformMatrix4fv(this._uModelMatrix,!1,e.worldMatrix),this._uClippable&&i.uniform1i(this._uClippable,e._state.clippable),i.uniform3fv(this._uOffset,e._state.offset),n.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(n.positionsBuf,n.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),t.bindArray++),n.indicesBuf&&(n.indicesBuf.bind(),t.bindArray++),this._lastGeometryId=n.id);var h=e._state.pickID;const l=h>>24&255,u=h>>16&255,p=h>>8&255,c=255&h;i.uniform4f(this._uPickColor,c/255,p/255,u/255,l/255),n.indicesBuf?(i.drawElements(n.primitive,n.indicesBuf.numItems,n.indicesBuf.itemType,0),t.drawElements++):n.positions&&i.drawArrays(i.TRIANGLES,0,n.positions.numItems)},ls.prototype._allocate=function(t){const e=t.scene,s=e.canvas.gl;if(this._program=new Mt(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._uClippable=i.getLocation("clippable"),this._uPickColor=i.getLocation("pickColor"),this._uOffset=i.getLocation("offset"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastGeometryId=null},ls.prototype._bindProgram=function(t){const e=this._scene,s=e.canvas.gl,i=e.camera.project;if(this._program.bind(),t.useProgram++,e.logarithmicDepthBufferEnabled){const t=2/(Math.log(i.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}this._lastMaterialId=null,this._lastGeometryId=null};class ps{constructor(t){this.vertex=function(t){const e=t.scene,s=e._sectionPlanesState.sectionPlanes.length>0,i=!!t._geometry._state.compressGeometry;t._state.billboard,t._state.stationary;const r=[];r.push("// Surface picking vertex shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable");r.push("attribute vec3 position;"),r.push("attribute vec4 color;"),r.push("uniform mat4 modelMatrix;"),r.push("uniform mat4 viewMatrix;"),r.push("uniform mat4 projMatrix;"),r.push("uniform vec3 offset;"),s&&(r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;"));e.logarithmicDepthBufferEnabled&&(r.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("varying float vFragDepth;"),r.push("bool isPerspectiveMatrix(mat4 m) {"),r.push("    return (m[2][3] == - 1.0);"),r.push("}"),r.push("varying float isPerspective;"));r.push("varying vec4 vColor;"),i&&r.push("uniform mat4 positionsDecodeMatrix;");r.push("void main(void) {"),r.push("vec4 localPosition = vec4(position, 1.0); "),i&&r.push("localPosition = positionsDecodeMatrix * localPosition;");r.push("   vec4 worldPosition = modelMatrix * localPosition; "),r.push("   worldPosition.xyz = worldPosition.xyz + offset;"),r.push("   vec4 viewPosition = viewMatrix * worldPosition;"),s&&r.push("   vWorldPosition = worldPosition;");r.push("   vColor = color;"),r.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?r.push("vFragDepth = 1.0 + clipPos.w;"):(r.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),r.push("clipPos.z *= clipPos.w;")),r.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return r.push("gl_Position = clipPos;"),r.push("}"),r}(t),this.fragment=function(t){const e=t.scene,s=e._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];r.push("// Surface picking fragment shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable");r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),r.push("varying vec4 vColor;"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;"));if(i){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(let t=0;t<s.sectionPlanes.length;t++)r.push("uniform bool sectionPlaneActive"+t+";"),r.push("uniform vec3 sectionPlanePos"+t+";"),r.push("uniform vec3 sectionPlaneDir"+t+";")}if(r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(let t=0;t<s.sectionPlanes.length;t++)r.push("if (sectionPlaneActive"+t+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("   gl_FragColor = vColor;"),r.push("}"),r}(t)}}const cs=c.vec3(),ds=function(t,e){this._hash=t,this._scene=e.scene,this._useCount=0,this._shaderSource=new ps(e),this._allocate(e)},ms={};ds.get=function(t){const e=[t.scene.canvas.canvas.id,t.scene._sectionPlanesState.getHash(),t._geometry._state.compressGeometry?"cp":"",t._state.hash].join(";");let s=ms[e];if(!s){if(s=new ds(e,t),s.errors)return console.log(s.errors.join("\n")),null;ms[e]=s,m.memory.programs++}return s._useCount++,s},ds.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete ms[this._hash],m.memory.programs--)},ds.prototype.webglContextRestored=function(){this._program=null},ds.prototype.drawMesh=function(t,e){this._program||this._allocate(e);const s=this._scene,i=s.canvas.gl,r=e._state,o=e._material._state,n=e._geometry,a=e._geometry._state,h=e.origin,l=o.backfaces,u=o.frontface,p=s.camera.project,c=n._getPickTrianglePositions(),d=n._getPickTriangleColors();if(this._program.bind(),t.useProgram++,s.logarithmicDepthBufferEnabled){const t=2/(Math.log(p.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,t)}if(i.uniformMatrix4fv(this._uViewMatrix,!1,h?t.getRTCPickViewMatrix(r.originHash,h):t.pickViewMatrix),r.clippable){const t=s._sectionPlanesState.sectionPlanes.length;if(t>0){const r=s._sectionPlanesState.sectionPlanes,o=e.renderFlags;for(let e=0;e<t;e++){const t=this._uSectionPlanes[e];if(t){const s=o.sectionPlanesActivePerLayer[e];if(i.uniform1i(t.active,s?1:0),s){const s=r[e];i.uniform3fv(t.pos,h?Y(s.dist,s.dir,h,cs):s.pos),i.uniform3fv(t.dir,s.dir)}}}}}i.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),s.logarithmicDepthBufferEnabled&&i.uniform1f(this._uZFar,s.camera.project.far),t.backfaces!==l&&(l?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),t.backfaces=l),t.frontface!==u&&(u?i.frontFace(i.CCW):i.frontFace(i.CW),t.frontface=u),i.uniformMatrix4fv(this._uModelMatrix,!1,e.worldMatrix),this._uClippable&&i.uniform1i(this._uClippable,e._state.clippable),i.uniform3fv(this._uOffset,e._state.offset),this._uPositionsDecodeMatrix?(i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,a.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(c,a.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT)):this._aPosition.bindArrayBuffer(c),d.bind(),i.enableVertexAttribArray(this._aColor.location),i.vertexAttribPointer(this._aColor.location,d.itemSize,d.itemType,!0,0,0),i.drawArrays(a.primitive,0,c.numItems/3)},ds.prototype._allocate=function(t){const e=t.scene,s=e.canvas.gl;if(this._program=new Mt(s,this._shaderSource),this._useCount=0,this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._uClippable=i.getLocation("clippable"),this._uOffset=i.getLocation("offset"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))};class fs{constructor(t){this.vertex=function(t){const e=t.scene,s=e._sectionPlanesState.sectionPlanes.length>0,i=!!t._geometry._state.compressGeometry,r=t._state.billboard,o=t._state.stationary,n=[];n.push("// Mesh occlusion vertex shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable");n.push("attribute vec3 position;"),n.push("uniform mat4 modelMatrix;"),n.push("uniform mat4 viewMatrix;"),n.push("uniform mat4 projMatrix;"),n.push("uniform vec3 offset;"),i&&n.push("uniform mat4 positionsDecodeMatrix;");s&&n.push("varying vec4 vWorldPosition;");e.logarithmicDepthBufferEnabled&&(n.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("varying float vFragDepth;"),n.push("bool isPerspectiveMatrix(mat4 m) {"),n.push("    return (m[2][3] == - 1.0);"),n.push("}"),n.push("varying float isPerspective;"));"spherical"!==r&&"cylindrical"!==r||(n.push("void billboard(inout mat4 mat) {"),n.push("   mat[0][0] = 1.0;"),n.push("   mat[0][1] = 0.0;"),n.push("   mat[0][2] = 0.0;"),"spherical"===r&&(n.push("   mat[1][0] = 0.0;"),n.push("   mat[1][1] = 1.0;"),n.push("   mat[1][2] = 0.0;")),n.push("   mat[2][0] = 0.0;"),n.push("   mat[2][1] = 0.0;"),n.push("   mat[2][2] =1.0;"),n.push("}"));n.push("void main(void) {"),n.push("vec4 localPosition = vec4(position, 1.0); "),i&&n.push("localPosition = positionsDecodeMatrix * localPosition;");n.push("mat4 viewMatrix2 = viewMatrix;"),n.push("mat4 modelMatrix2 = modelMatrix;"),o&&n.push("viewMatrix2[3][0] = viewMatrix2[3][1] = viewMatrix2[3][2] = 0.0;");"spherical"!==r&&"cylindrical"!==r||(n.push("mat4 modelViewMatrix = viewMatrix2 * modelMatrix2;"),n.push("billboard(modelMatrix2);"),n.push("billboard(viewMatrix2);"));n.push("   vec4 worldPosition = modelMatrix2 * localPosition;"),n.push("   worldPosition.xyz = worldPosition.xyz + offset;"),n.push("   vec4 viewPosition = viewMatrix2 * worldPosition;"),s&&n.push("   vWorldPosition = worldPosition;");n.push("vec4 clipPos = projMatrix * viewPosition;"),e.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?n.push("vFragDepth = 1.0 + clipPos.w;"):(n.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),n.push("clipPos.z *= clipPos.w;")),n.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"));return n.push("gl_Position = clipPos;"),n.push("}"),n}(t),this.fragment=function(t){const e=t.scene,s=e._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];r.push("// Mesh occlusion fragment shader"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable");r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;"));if(i){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(var o=0;o<s.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<s.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}r.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),e.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;");return r.push("}"),r}(t)}}const gs=c.vec3(),_s=function(t,e){this._hash=t,this._shaderSource=new fs(e),this._scene=e.scene,this._useCount=0,this._allocate(e)},ys={};_s.get=function(t){const e=[t.scene.canvas.canvas.id,t.scene._sectionPlanesState.getHash(),t._geometry._state.hash,t._state.hash].join(";");let s=ys[e];if(!s){if(s=new _s(e,t),s.errors)return console.log(s.errors.join("\n")),null;ys[e]=s,m.memory.programs++}return s._useCount++,s},_s.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete ys[this._hash],m.memory.programs--)},_s.prototype.webglContextRestored=function(){this._program=null},_s.prototype.drawMesh=function(t,e){this._program||this._allocate(e);const s=this._scene,i=s.canvas.gl,r=e._material._state,o=e._state,n=e._geometry._state,a=e.origin;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),r.id!==this._lastMaterialId){const e=r.backfaces;t.backfaces!==e&&(e?i.disable(i.CULL_FACE):i.enable(i.CULL_FACE),t.backfaces=e);const s=r.frontface;t.frontface!==s&&(s?i.frontFace(i.CCW):i.frontFace(i.CW),t.frontface=s),this._lastMaterialId=r.id}const h=s.camera;if(i.uniformMatrix4fv(this._uViewMatrix,!1,a?t.getRTCViewMatrix(o.originHash,a):h.viewMatrix),o.clippable){const t=s._sectionPlanesState.sectionPlanes.length;if(t>0){const r=s._sectionPlanesState.sectionPlanes,o=e.renderFlags;for(let e=0;e<t;e++){const t=this._uSectionPlanes[e];if(t){const s=o.sectionPlanesActivePerLayer[e];if(i.uniform1i(t.active,s?1:0),s){const s=r[e];i.uniform3fv(t.pos,a?Y(s.dist,s.dir,a,gs):s.pos),i.uniform3fv(t.dir,s.dir)}}}}}i.uniformMatrix4fv(this._uProjMatrix,!1,h._project._state.matrix),i.uniformMatrix4fv(this._uModelMatrix,i.FALSE,e.worldMatrix),this._uClippable&&i.uniform1i(this._uClippable,e._state.clippable),i.uniform3fv(this._uOffset,e._state.offset),n.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,n.positionsDecodeMatrix),this._aPosition&&(this._aPosition.bindArrayBuffer(n.positionsBuf,n.compressGeometry?i.UNSIGNED_SHORT:i.FLOAT),t.bindArray++),n.indicesBuf&&(n.indicesBuf.bind(),t.bindArray++),this._lastGeometryId=n.id),n.indicesBuf?(i.drawElements(n.primitive,n.indicesBuf.numItems,n.indicesBuf.itemType,0),t.drawElements++):n.positions&&i.drawArrays(i.TRIANGLES,0,n.positions.numItems)},_s.prototype._allocate=function(t){const e=t.scene,s=e.canvas.gl;if(this._program=new Mt(s,this._shaderSource),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._uClippable=i.getLocation("clippable"),this._uOffset=i.getLocation("offset"),e.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC")),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},_s.prototype._bindProgram=function(t){const e=this._scene,s=e.camera.project,i=e.canvas.gl;if(this._program.bind(),t.useProgram++,i.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),e.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,t)}this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null};class vs{constructor(t){this.vertex=function(t){const e=t.scene._sectionPlanesState.sectionPlanes.length>0,s=!!t._geometry._state.compressGeometry,i=[];i.push("// Mesh shadow vertex shader"),i.push("attribute vec3 position;"),i.push("uniform mat4 modelMatrix;"),i.push("uniform mat4 shadowViewMatrix;"),i.push("uniform mat4 shadowProjMatrix;"),i.push("uniform vec3 offset;"),s&&i.push("uniform mat4 positionsDecodeMatrix;");e&&i.push("varying vec4 vWorldPosition;");i.push("void main(void) {"),i.push("vec4 localPosition = vec4(position, 1.0); "),i.push("vec4 worldPosition;"),s&&i.push("localPosition = positionsDecodeMatrix * localPosition;");i.push("worldPosition = modelMatrix * localPosition;"),i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = shadowViewMatrix * worldPosition; "),e&&i.push("vWorldPosition = worldPosition;");return i.push("   gl_Position = shadowProjMatrix * viewPosition;"),i.push("}"),i}(t),this.fragment=function(t){const e=t.scene;e.canvas.gl;const s=e._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];if(r.push("// Mesh shadow fragment shader"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),i){r.push("uniform bool clippable;"),r.push("varying vec4 vWorldPosition;");for(var o=0;o<s.sectionPlanes.length;o++)r.push("uniform bool sectionPlaneActive"+o+";"),r.push("uniform vec3 sectionPlanePos"+o+";"),r.push("uniform vec3 sectionPlaneDir"+o+";")}if(r.push("vec4 encodeFloat( const in float depth ) {"),r.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),r.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),r.push("  vec4 comp = fract(depth * bitShift);"),r.push("  comp -= comp.xxyz * bitMask;"),r.push("  return comp;"),r.push("}"),r.push("void main(void) {"),i){r.push("if (clippable) {"),r.push("  float dist = 0.0;");for(o=0;o<s.sectionPlanes.length;o++)r.push("if (sectionPlaneActive"+o+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+o+".xyz, vWorldPosition.xyz - sectionPlanePos"+o+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { discard; }"),r.push("}")}return r.push("gl_FragColor = encodeFloat(gl_FragCoord.z);"),r.push("}"),r}(t)}}const bs=function(t,e){this._hash=t,this._shaderSource=new vs(e),this._scene=e.scene,this._useCount=0,this._allocate(e)},Ps={};bs.get=function(t){const e=t.scene,s=[e.canvas.canvas.id,e._sectionPlanesState.getHash(),t._geometry._state.hash,t._state.hash].join(";");let i=Ps[s];if(!i){if(i=new bs(s,t),i.errors)return console.log(i.errors.join("\n")),null;Ps[s]=i,m.memory.programs++}return i._useCount++,i},bs.prototype.put=function(){0==--this._useCount&&(this._program&&this._program.destroy(),delete Ps[this._hash],m.memory.programs--)},bs.prototype.webglContextRestored=function(){this._program=null},bs.prototype.drawMesh=function(t,e){this._program||this._allocate(e);const s=this._scene.canvas.gl,i=e._material._state,r=e._geometry._state;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),i.id!==this._lastMaterialId){const e=i.backfaces;t.backfaces!==e&&(e?s.disable(s.CULL_FACE):s.enable(s.CULL_FACE),t.backfaces=e);const r=i.frontface;t.frontface!==r&&(r?s.frontFace(s.CCW):s.frontFace(s.CW),t.frontface=r),t.lineWidth!==i.lineWidth&&(s.lineWidth(i.lineWidth),t.lineWidth=i.lineWidth),this._uPointSize&&s.uniform1i(this._uPointSize,i.pointSize),this._lastMaterialId=i.id}if(s.uniformMatrix4fv(this._uModelMatrix,s.FALSE,e.worldMatrix),r.combineGeometry){const i=e.vertexBufs;i.id!==this._lastVertexBufsId&&(i.positionsBuf&&this._aPosition&&(this._aPosition.bindArrayBuffer(i.positionsBuf,i.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),t.bindArray++),this._lastVertexBufsId=i.id)}this._uClippable&&s.uniform1i(this._uClippable,e._state.clippable),s.uniform3fv(this._uOffset,e._state.offset),r.id!==this._lastGeometryId&&(this._uPositionsDecodeMatrix&&s.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,r.positionsDecodeMatrix),r.combineGeometry?r.indicesBufCombined&&(r.indicesBufCombined.bind(),t.bindArray++):(this._aPosition&&(this._aPosition.bindArrayBuffer(r.positionsBuf,r.compressGeometry?s.UNSIGNED_SHORT:s.FLOAT),t.bindArray++),r.indicesBuf&&(r.indicesBuf.bind(),t.bindArray++)),this._lastGeometryId=r.id),r.combineGeometry?r.indicesBufCombined&&(s.drawElements(r.primitive,r.indicesBufCombined.numItems,r.indicesBufCombined.itemType,0),t.drawElements++):r.indicesBuf?(s.drawElements(r.primitive,r.indicesBuf.numItems,r.indicesBuf.itemType,0),t.drawElements++):r.positions&&(s.drawArrays(s.TRIANGLES,0,r.positions.numItems),t.drawArrays++)},bs.prototype._allocate=function(t){const e=t.scene,s=e.canvas.gl;if(this._program=new Mt(s,this._shaderSource),this._scene=e,this._useCount=0,this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uModelMatrix=i.getLocation("modelMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),this._uSectionPlanes={};for(let t=0,s=e._sectionPlanesState.sectionPlanes.length;t<s;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._uClippable=i.getLocation("clippable"),this._uOffset=i.getLocation("offset"),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null},bs.prototype._bindProgram=function(t){this._program||this._allocate(mesh);const e=this._scene,s=e.canvas.gl,i=e._sectionPlanesState;if(this._program.bind(),t.useProgram++,s.uniformMatrix4fv(this._uShadowViewMatrix,!1,t.shadowViewMatrix),s.uniformMatrix4fv(this._uShadowProjMatrix,!1,t.shadowProjMatrix),this._lastMaterialId=null,this._lastVertexBufsId=null,this._lastGeometryId=null,i.sectionPlanes.length>0){let t,e,r,o,n;for(let a=0,h=this._uSectionPlanes.length;a<h;a++)t=this._uSectionPlanes[a],e=t.active,r=i.sectionPlanes[a],e&&s.uniform1i(e,r.active),o=t.pos,o&&s.uniform3fv(t.pos,r.pos),n=t.dir,n&&s.uniform3fv(t.dir,r.dir)}};class Ts{constructor(){this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}reset(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}const ws=c.OBB3(),xs=c.vec4(),Ms=c.vec4(),Ds=c.vec4(),Es=c.vec3([1,0,0]),Is=c.vec3([0,1,0]),Ss=c.vec3([0,0,1]),As=c.vec3(3),Cs=c.vec3(3),Fs=c.identityMat4();class Os extends A{constructor(t,e={}){super(t,e),this.originalSystemId=e.originalSystemId||this.id,this.renderFlags=new Ts,this._state=new zt({visible:!0,culled:!1,pickable:null,clippable:null,collidable:null,occluder:!1!==e.occluder,castsShadow:null,receivesShadow:null,xrayed:!1,highlighted:!1,selected:!1,edges:!1,stationary:!!e.stationary,background:!!e.background,billboard:this._checkBillboard(e.billboard),layer:null,colorize:null,pickID:this.scene._renderer.getPickID(this),drawHash:"",pickHash:"",offset:c.vec3(),origin:null,originHash:null}),this._drawRenderer=null,this._shadowRenderer=null,this._emphasisFillRenderer=null,this._emphasisEdgesRenderer=null,this._pickMeshRenderer=null,this._pickTriangleRenderer=null,this._occlusionRenderer=null,this._geometry=e.geometry?this._checkComponent2(["ReadableGeometry","VBOGeometry"],e.geometry):this.scene.geometry,this._material=e.material?this._checkComponent2(["PhongMaterial","MetallicMaterial","SpecularMaterial","LambertMaterial"],e.material):this.scene.material,this._xrayMaterial=e.xrayMaterial?this._checkComponent("EmphasisMaterial",e.xrayMaterial):this.scene.xrayMaterial,this._highlightMaterial=e.highlightMaterial?this._checkComponent("EmphasisMaterial",e.highlightMaterial):this.scene.highlightMaterial,this._selectedMaterial=e.selectedMaterial?this._checkComponent("EmphasisMaterial",e.selectedMaterial):this.scene.selectedMaterial,this._edgeMaterial=e.edgeMaterial?this._checkComponent("EdgeMaterial",e.edgeMaterial):this.scene.edgeMaterial,this._parentNode=null,this._aabb=null,this._aabbDirty=!0,this._numTriangles=this._geometry?this._geometry.numTriangles:0,this.scene._aabbDirty=!0,this._scale=c.vec3(),this._quaternion=c.identityQuaternion(),this._rotation=c.vec3(),this._position=c.vec3(),this._worldMatrix=c.identityMat4(),this._worldNormalMatrix=c.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0;const s=e.origin||e.rtcCenter;if(s&&(this._state.origin=c.vec3(s),this._state.originHash=s.join()),e.matrix?this.matrix=e.matrix:(this.scale=e.scale,this.position=e.position,e.quaternion||(this.rotation=e.rotation)),this._isObject=e.isObject,this._isObject&&this.scene._registerObject(this),this._isModel=e.isModel,this._isModel&&this.scene._registerModel(this),this.visible=e.visible,this.culled=e.culled,this.pickable=e.pickable,this.clippable=e.clippable,this.collidable=e.collidable,this.castsShadow=e.castsShadow,this.receivesShadow=e.receivesShadow,this.xrayed=e.xrayed,this.highlighted=e.highlighted,this.selected=e.selected,this.edges=e.edges,this.layer=e.layer,this.colorize=e.colorize,this.opacity=e.opacity,this.offset=e.offset,e.parentId){const t=this.scene.components[e.parentId];t?t.isNode?t.addChild(this):this.error("Parent is not a Node: '"+e.parentId+"'"):this.error("Parent not found: '"+e.parentId+"'"),this._parentNode=t}else e.parent&&(e.parent.isNode||this.error("Parent is not a Node"),e.parent.addChild(this),this._parentNode=e.parent);this.compile()}get type(){return"Mesh"}get isMesh(){return!0}get parent(){return this._parentNode}get geometry(){return this._geometry}get material(){return this._material}get position(){return this._position}set position(t){this._position.set(t||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set rotation(t){this._rotation.set(t||[0,0,0]),c.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set quaternion(t){this._quaternion.set(t||[0,0,0,1]),c.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set scale(t){this._scale.set(t||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=c.identityMat4()),c.composeMat4(this._position,this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1),this.__localMatrix}set matrix(t){this.__localMatrix||(this.__localMatrix=c.identityMat4()),this.__localMatrix.set(t||Fs),c.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix(),this._worldNormalMatrix}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}get origin(){return this._state.origin}set origin(t){t?(this._state.origin||(this._state.origin=c.vec3()),this._state.origin.set(t),this._state.originHash=t.join(),this._setAABBDirty(),this.scene._aabbDirty=!0):this._state.origin&&(this._state.origin=null,this._state.originHash=null,this._setAABBDirty(),this.scene._aabbDirty=!0)}get rtcCenter(){return this.origin}set rtcCenter(t){this.origin=t}get numTriangles(){return this._numTriangles}get visible(){return this._state.visible}set visible(t){t=!1!==t,this._state.visible=t,this._isObject&&this.scene._objectVisibilityUpdated(this),this.glRedraw()}get xrayed(){return this._state.xrayed}set xrayed(t){t=!!t,this._state.xrayed!==t&&(this._state.xrayed=t,this._isObject&&this.scene._objectXRayedUpdated(this),this.glRedraw())}get highlighted(){return this._state.highlighted}set highlighted(t){(t=!!t)!==this._state.highlighted&&(this._state.highlighted=t,this._isObject&&this.scene._objectHighlightedUpdated(this),this.glRedraw())}get selected(){return this._state.selected}set selected(t){(t=!!t)!==this._state.selected&&(this._state.selected=t,this._isObject&&this.scene._objectSelectedUpdated(this),this.glRedraw())}get edges(){return this._state.edges}set edges(t){(t=!!t)!==this._state.edges&&(this._state.edges=t,this.glRedraw())}get culled(){return this._state.culled}set culled(t){this._state.culled=!!t,this.glRedraw()}get clippable(){return this._state.clippable}set clippable(t){t=!1!==t,this._state.clippable!==t&&(this._state.clippable=t,this.glRedraw())}get collidable(){return this._state.collidable}set collidable(t){(t=!1!==t)!==this._state.collidable&&(this._state.collidable=t,this._setAABBDirty(),this.scene._aabbDirty=!0)}get pickable(){return this._state.pickable}set pickable(t){t=!1!==t,this._state.pickable!==t&&(this._state.pickable=t)}get castsShadow(){return this._state.castsShadow}set castsShadow(t){(t=!1!==t)!==this._state.castsShadow&&(this._state.castsShadow=t,this.glRedraw())}get receivesShadow(){return this._state.receivesShadow}set receivesShadow(t){(t=!1!==t)!==this._state.receivesShadow&&(this._state.receivesShadow=t,this._state.hash=t?"/mod/rs;":"/mod;",this.fire("dirty",this))}get saoEnabled(){return!1}get colorize(){return this._state.colorize}set colorize(t){let e=this._state.colorize;e||(e=this._state.colorize=new Float32Array(4),e[3]=1),t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1);const s=!!t;this.scene._objectColorizeUpdated(this,s),this.glRedraw()}get opacity(){return this._state.colorize[3]}set opacity(t){let e=this._state.colorize;e||(e=this._state.colorize=new Float32Array(4),e[0]=1,e[1]=1,e[2]=1);const s=null!=t;e[3]=s?t:1,this.scene._objectOpacityUpdated(this,s),this.glRedraw()}get transparent(){return 2===this._material.alphaMode||this._state.colorize[3]<1}get layer(){return this._state.layer}set layer(t){t=t||0,(t=Math.round(t))!==this._state.layer&&(this._state.layer=t,this._renderer.needStateSort())}get stationary(){return this._state.stationary}get billboard(){return this._state.billboard}get offset(){return this._state.offset}set offset(t){this._state.offset.set(t||[0,0,0]),this._setAABBDirty(),this.glRedraw()}get isDrawable(){return!0}get isStateSortable(){return!0}get xrayMaterial(){return this._xrayMaterial}get highlightMaterial(){return this._highlightMaterial}get selectedMaterial(){return this._selectedMaterial}get edgeMaterial(){return this._edgeMaterial}_checkBillboard(t){return"spherical"!==(t=t||"none")&&"cylindrical"!==t&&"none"!==t&&(this.error("Unsupported value for 'billboard': "+t+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),t="none"),t}compile(){const t=this._makeDrawHash();this._state.drawHash!==t&&(this._state.drawHash=t,this._putDrawRenderers(),this._drawRenderer=Ze.get(this),this._emphasisFillRenderer=ts.get(this),this._emphasisEdgesRenderer=os.get(this));const e=this._makePickHash();if(this._state.pickHash!==e&&(this._state.pickHash=e,this._putPickRenderers(),this._pickMeshRenderer=ls.get(this)),this._state.occluder){const t=this._makeOcclusionHash();this._state.occlusionHash!==t&&(this._state.occlusionHash=t,this._putOcclusionRenderer(),this._occlusionRenderer=_s.get(this))}}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0}_buildWorldMatrix(){const t=this.matrix;if(this._parentNode)c.mulMat4(this._parentNode.worldMatrix,t,this._worldMatrix);else for(let e=0,s=t.length;e<s;e++)this._worldMatrix[e]=t[e];this._worldMatrixDirty=!1}_buildWorldNormalMatrix(){this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldNormalMatrix||(this._worldNormalMatrix=c.mat4()),c.transposeMat4(this._worldMatrix,this._worldNormalMatrix),c.inverseMat4(this._worldNormalMatrix),this._worldNormalMatrixDirty=!1}_setAABBDirty(){if(this.collidable)for(let t=this;t;t=t._parentNode)t._aabbDirty=!0}_updateAABB(){this.scene._aabbDirty=!0,this._aabb||(this._aabb=c.AABB3()),this._buildAABB(this.worldMatrix,this._aabb),this._aabbDirty=!1}_webglContextRestored(){this._drawRenderer&&this._drawRenderer.webglContextRestored(),this._shadowRenderer&&this._shadowRenderer.webglContextRestored(),this._emphasisFillRenderer&&this._emphasisFillRenderer.webglContextRestored(),this._emphasisEdgesRenderer&&this._emphasisEdgesRenderer.webglContextRestored(),this._pickMeshRenderer&&this._pickMeshRenderer.webglContextRestored(),this._pickTriangleRenderer&&this._pickMeshRenderer.webglContextRestored(),this._occlusionRenderer&&this._occlusionRenderer.webglContextRestored()}_makeDrawHash(){const t=this.scene,e=[t.canvas.canvas.id,(t.gammaInput?"gi;":";")+(t.gammaOutput?"go":""),t._lightsState.getHash(),t._sectionPlanesState.getHash()],s=this._state;return s.stationary&&e.push("/s"),"none"===s.billboard?e.push("/n"):"spherical"===s.billboard?e.push("/s"):"cylindrical"===s.billboard&&e.push("/c"),s.receivesShadow&&e.push("/rs"),e.push(";"),e.join("")}_makePickHash(){const t=this.scene,e=[t.canvas.canvas.id,t._sectionPlanesState.getHash()],s=this._state;return s.stationary&&e.push("/s"),"none"===s.billboard?e.push("/n"):"spherical"===s.billboard?e.push("/s"):"cylindrical"===s.billboard&&e.push("/c"),e.push(";"),e.join("")}_makeOcclusionHash(){const t=this.scene,e=[t.canvas.canvas.id,t._sectionPlanesState.getHash()],s=this._state;return s.stationary&&e.push("/s"),"none"===s.billboard?e.push("/n"):"spherical"===s.billboard?e.push("/s"):"cylindrical"===s.billboard&&e.push("/c"),e.push(";"),e.join("")}_buildAABB(t,e){c.transformOBB3(t,this._geometry.obb,ws),c.OBB3ToAABB3(ws,e);const s=this._state.offset;if(e[0]+=s[0],e[1]+=s[1],e[2]+=s[2],e[3]+=s[0],e[4]+=s[1],e[5]+=s[2],this._state.origin){const t=this._state.origin;e[0]+=t[0],e[1]+=t[1],e[2]+=t[2],e[3]+=t[0],e[4]+=t[1],e[5]+=t[2]}}rotate(t,e){return xs[0]=t[0],xs[1]=t[1],xs[2]=t[2],xs[3]=e*c.DEGTORAD,c.angleAxisToQuaternion(xs,Ms),c.mulQuaternions(this.quaternion,Ms,Ds),this.quaternion=Ds,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(t,e){return xs[0]=t[0],xs[1]=t[1],xs[2]=t[2],xs[3]=e*c.DEGTORAD,c.angleAxisToQuaternion(xs,Ms),c.mulQuaternions(Ms,this.quaternion,Ms),this}rotateX(t){return this.rotate(Es,t)}rotateY(t){return this.rotate(Is,t)}rotateZ(t){return this.rotate(Ss,t)}translate(t,e){return c.vec3ApplyQuaternion(this.quaternion,t,As),c.mulVec3Scalar(As,e,Cs),c.addVec3(this.position,Cs,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(t){return this.translate(Es,t)}translateY(t){return this.translate(Is,t)}translateZ(t){return this.translate(Ss,t)}_putDrawRenderers(){this._drawRenderer&&(this._drawRenderer.put(),this._drawRenderer=null),this._shadowRenderer&&(this._shadowRenderer.put(),this._shadowRenderer=null),this._emphasisFillRenderer&&(this._emphasisFillRenderer.put(),this._emphasisFillRenderer=null),this._emphasisEdgesRenderer&&(this._emphasisEdgesRenderer.put(),this._emphasisEdgesRenderer=null)}_putPickRenderers(){this._pickMeshRenderer&&(this._pickMeshRenderer.put(),this._pickMeshRenderer=null),this._pickTriangleRenderer&&(this._pickTriangleRenderer.put(),this._pickTriangleRenderer=null)}_putOcclusionRenderer(){this._occlusionRenderer&&(this._occlusionRenderer.put(),this._occlusionRenderer=null)}stateSortCompare(t,e){return t._state.layer-e._state.layer||t._drawRenderer.id-e._drawRenderer.id||t._material._state.id-e._material._state.id||t._geometry._state.id-e._geometry._state.id}rebuildRenderFlags(){this.renderFlags.reset(),this._getActiveSectionPlanes()?(this.renderFlags.numLayers=1,this.renderFlags.numVisibleLayers=1,this.renderFlags.visibleLayers[0]=0,this._updateRenderFlags()):this.renderFlags.culled=!0}_updateRenderFlags(){const t=this.renderFlags,e=this._state;if(e.xrayed){const e=this._xrayMaterial._state;e.fill&&(e.fillAlpha<1?t.xrayedSilhouetteTransparent=!0:t.xrayedSilhouetteOpaque=!0),e.edges&&(e.edgeAlpha<1?t.xrayedEdgesTransparent=!0:t.xrayedEdgesOpaque=!0)}else{if(this._material._state.alpha<1||e.colorize[3]<1?t.colorTransparent=!0:t.colorOpaque=!0,e.edges){this._edgeMaterial._state.alpha<1?t.edgesTransparent=!0:t.edgesOpaque=!0}if(e.selected){const e=this._selectedMaterial._state;e.fill&&(e.fillAlpha<1?t.selectedSilhouetteTransparent=!0:t.selectedSilhouetteOpaque=!0),e.edges&&(e.edgeAlpha<1?t.selectedEdgesTransparent=!0:t.selectedEdgesOpaque=!0)}else if(e.highlighted){const e=this._highlightMaterial._state;e.fill&&(e.fillAlpha<1?t.highlightedSilhouetteTransparent=!0:t.highlightedSilhouetteOpaque=!0),e.edges&&(e.edgeAlpha<1?t.highlightedEdgesTransparent=!0:t.highlightedEdgesOpaque=!0)}}}_getActiveSectionPlanes(){if(this._state.clippable){const t=this.scene._sectionPlanesState.sectionPlanes,e=t.length;if(e>0)for(let s=0;s<e;s++){const e=t[s],i=this.renderFlags;if(e.active)if(this._state.origin){const t=c.planeAABB3Intersect(e.dir,e.dist,this.aabb);if(-1===t)return!1;const r=0===t;i.sectionPlanesActivePerLayer[s]=r}else i.sectionPlanesActivePerLayer[s]=!0;else i.sectionPlanesActivePerLayer[s]=!1}}return!0}drawColorOpaque(t){(this._drawRenderer||(this._drawRenderer=Ze.get(this)))&&this._drawRenderer.drawMesh(t,this)}drawColorTransparent(t){(this._drawRenderer||(this._drawRenderer=Ze.get(this)))&&this._drawRenderer.drawMesh(t,this)}drawSilhouetteXRayed(t){(this._emphasisFillRenderer||(this._emphasisFillRenderer=ts.get(this)))&&this._emphasisFillRenderer.drawMesh(t,this,0)}drawSilhouetteHighlighted(t){(this._emphasisFillRenderer||(this._emphasisFillRenderer=ts.get(this)))&&this._emphasisFillRenderer.drawMesh(t,this,1)}drawSilhouetteSelected(t){(this._emphasisFillRenderer||(this._emphasisFillRenderer=ts.get(this)))&&this._emphasisFillRenderer.drawMesh(t,this,2)}drawEdgesColorOpaque(t){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=os.get(this)))&&this._emphasisEdgesRenderer.drawMesh(t,this,3)}drawEdgesColorTransparent(t){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=os.get(this)))&&this._emphasisEdgesRenderer.drawMesh(t,this,3)}drawEdgesXRayed(t){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=os.get(this)))&&this._emphasisEdgesRenderer.drawMesh(t,this,0)}drawEdgesHighlighted(t){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=os.get(this)))&&this._emphasisEdgesRenderer.drawMesh(t,this,1)}drawEdgesSelected(t){(this._emphasisEdgesRenderer||(this._emphasisEdgesRenderer=os.get(this)))&&this._emphasisEdgesRenderer.drawMesh(t,this,2)}drawOcclusion(t){(this._state.occluder&&this._occlusionRenderer||(this._occlusionRenderer=_s.get(this)))&&this._occlusionRenderer.drawMesh(t,this)}drawShadow(t){(this._shadowRenderer||(this._shadowRenderer=bs.get(this)))&&this._shadowRenderer.drawMesh(t,this)}drawPickMesh(t){(this._pickMeshRenderer||(this._pickMeshRenderer=ls.get(this)))&&this._pickMeshRenderer.drawMesh(t,this)}canPickTriangle(){return this._geometry.isReadableGeometry}drawPickTriangles(t){(this._pickTriangleRenderer||(this._pickTriangleRenderer=ds.get(this)))&&this._pickTriangleRenderer.drawMesh(t,this)}pickTriangleSurface(t,e,s){Rs(this,t,e,s)}drawPickVertices(t){}delegatePickedEntity(){return this}destroy(){super.destroy(),this._putDrawRenderers(),this._putPickRenderers(),this._putOcclusionRenderer(),this.scene._renderer.putPickID(this._state.pickID),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this.glRedraw()}}const Rs=function(){const t=c.vec3(),e=c.vec3(),s=c.vec3(),i=c.vec3(),r=c.vec3(),o=c.vec3(),n=c.vec4(),a=c.vec3(),h=c.vec3(),l=c.vec3(),u=c.vec3(),p=c.vec3(),d=c.vec3(),m=c.vec3(),f=c.vec3(),g=c.vec3(),_=c.vec4(),y=c.vec4(),v=c.vec4(),b=c.vec3(),P=c.vec3(),T=c.vec3(),w=c.vec3(),x=c.vec3(),M=c.vec3(),D=c.vec3(),E=c.vec3(),I=c.vec3(),S=c.vec3(),A=c.vec3();return function(C,F,O,R){var L=R.primIndex;if(null!=L&&L>-1){const j=C.geometry._state,G=C.scene,H=G.camera,V=G.canvas;if("triangles"===j.primitiveName){R.primitive="triangle";const G=L,z=j.indices,U=j.positions;let X,W,Y,K;if(z){var N=z[G+0],B=z[G+1],k=z[G+2];o[0]=N,o[1]=B,o[2]=k,R.indices=o,X=3*N,W=3*B,Y=3*k}else X=3*G,W=X+3,Y=W+3;if(s[0]=U[X+0],s[1]=U[X+1],s[2]=U[X+2],i[0]=U[W+0],i[1]=U[W+1],i[2]=U[W+2],r[0]=U[Y+0],r[1]=U[Y+1],r[2]=U[Y+2],j.compressGeometry){const t=j.positionsDecodeMatrix;t&&(ve.decompressPosition(s,t,s),ve.decompressPosition(i,t,i),ve.decompressPosition(r,t,r))}R.canvasPos?(K=R.canvasPos,c.canvasPosToLocalRay(V.canvas,F,O,C.worldMatrix,K,t,e)):R.origin&&R.direction&&c.worldRayToLocalRay(C.worldMatrix,R.origin,R.direction,t,e),c.normalizeVec3(e),c.rayPlaneIntersect(t,e,s,i,r,n),R.localPos=n,R.position=n,_[0]=n[0],_[1]=n[1],_[2]=n[2],_[3]=1,c.transformVec4(C.worldMatrix,_,y),a[0]=y[0],a[1]=y[1],a[2]=y[2],R.worldPos=a,c.transformVec4(H.matrix,y,v),h[0]=v[0],h[1]=v[1],h[2]=v[2],R.viewPos=h,c.cartesianToBarycentric(n,s,i,r,l),R.bary=l;const Z=j.normals;if(Z){if(j.compressGeometry){const t=3*N,e=3*B,s=3*k;ve.decompressNormal(Z.subarray(t,t+2),u),ve.decompressNormal(Z.subarray(e,e+2),p),ve.decompressNormal(Z.subarray(s,s+2),d)}else u[0]=Z[X],u[1]=Z[X+1],u[2]=Z[X+2],p[0]=Z[W],p[1]=Z[W+1],p[2]=Z[W+2],d[0]=Z[Y],d[1]=Z[Y+1],d[2]=Z[Y+2];const t=c.addVec3(c.addVec3(c.mulVec3Scalar(u,l[0],b),c.mulVec3Scalar(p,l[1],P),T),c.mulVec3Scalar(d,l[2],w),x);R.worldNormal=c.normalizeVec3(c.transformVec3(C.worldNormalMatrix,t,M))}const q=j.uv;if(q){if(m[0]=q[2*N],m[1]=q[2*N+1],f[0]=q[2*B],f[1]=q[2*B+1],g[0]=q[2*k],g[1]=q[2*k+1],j.compressGeometry){const t=j.uvDecodeMatrix;t&&(ve.decompressUV(m,t,m),ve.decompressUV(f,t,f),ve.decompressUV(g,t,g))}R.uv=c.addVec3(c.addVec3(c.mulVec2Scalar(m,l[0],D),c.mulVec2Scalar(f,l[1],E),I),c.mulVec2Scalar(g,l[2],S),A)}}}}}();function Ls(t={}){let e=t.radiusTop||1;e<0&&(console.error("negative radiusTop not allowed - will invert"),e*=-1);let s=t.radiusBottom||1;s<0&&(console.error("negative radiusBottom not allowed - will invert"),s*=-1);let i=t.height||1;i<0&&(console.error("negative height not allowed - will invert"),i*=-1);let r=t.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<3&&(r=3);let o=t.heightSegments||1;o<0&&(console.error("negative heightSegments not allowed - will invert"),o*=-1),o<1&&(o=1);const n=!!t.openEnded;let a=t.center;const h=a?a[0]:0,l=a?a[1]:0,u=a?a[2]:0,p=i/2,c=i/o,d=2*Math.PI/r,m=1/r,f=(e-s)/o,g=[],y=[],v=[],b=[];let P,T,w,x,M,D,E,I,S,A,C;const F=(90-180*Math.atan(i/(s-e))/Math.PI)/90;for(P=0;P<=o;P++)for(M=e-P*f,D=p-P*c,T=0;T<=r;T++)w=Math.sin(T*d),x=Math.cos(T*d),y.push(M*w),y.push(F),y.push(M*x),v.push(T*m),v.push(1*P/o),g.push(M*w+h),g.push(D+l),g.push(M*x+u);for(P=0;P<o;P++)for(T=0;T<=r;T++)E=P*(r+1)+T,I=E+r,b.push(E),b.push(I),b.push(I+1),b.push(E),b.push(I+1),b.push(E+1);if(!n&&e>0){for(S=g.length/3,y.push(0),y.push(1),y.push(0),v.push(.5),v.push(.5),g.push(0+h),g.push(p+l),g.push(0+u),T=0;T<=r;T++)w=Math.sin(T*d),x=Math.cos(T*d),A=.5*Math.sin(T*d)+.5,C=.5*Math.cos(T*d)+.5,y.push(e*w),y.push(1),y.push(e*x),v.push(A),v.push(C),g.push(e*w+h),g.push(p+l),g.push(e*x+u);for(T=0;T<r;T++)a=S,E=S+1+T,b.push(E),b.push(E+1),b.push(a)}if(!n&&s>0){for(S=g.length/3,y.push(0),y.push(-1),y.push(0),v.push(.5),v.push(.5),g.push(0+h),g.push(0-p+l),g.push(0+u),T=0;T<=r;T++)w=Math.sin(T*d),x=Math.cos(T*d),A=.5*Math.sin(T*d)+.5,C=.5*Math.cos(T*d)+.5,y.push(s*w),y.push(-1),y.push(s*x),v.push(A),v.push(C),g.push(s*w+h),g.push(0-p+l),g.push(s*x+u);for(T=0;T<r;T++)a=S,E=S+1+T,b.push(a),b.push(E+1),b.push(E)}return _.apply(t,{positions:g,normals:y,uv:v,indices:b})}function Ns(t={}){const e=t.lod||1,s=t.center?t.center[0]:0,i=t.center?t.center[1]:0,r=t.center?t.center[2]:0;let o=t.radius||1;o<0&&(console.error("negative radius not allowed - will invert"),o*=-1);let n=t.heightSegments||18;n<0&&(console.error("negative heightSegments not allowed - will invert"),n*=-1),n=Math.floor(e*n),n<18&&(n=18);let a=t.widthSegments||18;a<0&&(console.error("negative widthSegments not allowed - will invert"),a*=-1),a=Math.floor(e*a),a<18&&(a=18);const h=[],l=[],u=[],p=[];let c,d,m,f,g,y,v,b,P,T,w,x,M,D,E;for(c=0;c<=n;c++)for(m=c*Math.PI/n,f=Math.sin(m),g=Math.cos(m),d=0;d<=a;d++)y=2*d*Math.PI/a,v=Math.sin(y),b=Math.cos(y),P=b*f,T=g,w=v*f,x=1-d/a,M=c/n,l.push(P),l.push(T),l.push(w),u.push(x),u.push(M),h.push(s+o*P),h.push(i+o*T),h.push(r+o*w);for(c=0;c<n;c++)for(d=0;d<a;d++)D=c*(a+1)+d,E=D+a+1,p.push(D+1),p.push(E+1),p.push(E),p.push(D+1),p.push(E),p.push(D);return _.apply(t,{positions:h,normals:l,uv:u,indices:p})}const Bs={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function ks(t={}){var e=t.origin||[0,0,0],s=e[0],i=e[1],r=e[2],o=t.size||1,n=[],a=[],h=t.text;_.isNumeric(h)&&(h=""+h);for(var l,u,p,c,d,m,f,g,y,v=(h||"").split("\n"),b=0,P=0,T=.04,w=0;w<v.length;w++){l=0,p=(u=v[w]).length;for(var x=0;x<p;x++)if(c=Bs[u.charAt(x)]){d=1,m=-1,f=-1,g=c.points.length;for(var M=0;M<g;M++)-1!==(y=c.points[M])[0]||-1!==y[1]?(n.push(l+y[0]*o*T+s),n.push(P+y[1]*o*T+i),n.push(0+r),-1===m?m=b:(-1===f||(m=f),f=b),b++,d?d=!1:(a.push(m),a.push(f))):d=1;l+=c.width*T*o}P-=35*T*o}return _.apply(t,{primitive:"lines",positions:n,indices:a})}class js extends n{constructor(t,e){super("AxisGizmo",t,e=e||{});const s=t.scene.camera;e.canvasId||e.canvasElement||this.error("Config expected: either 'canvasId' or 'canvasElement'");try{this._axisGizmoScene=new Ve(t,{canvasId:e.canvasId,canvasElement:e.canvasElement,transparent:!0})}catch(t){return void this.error(t)}const i=this._axisGizmoScene;i.clearLights(),new ue(i,{color:[.45,.45,.5],intensity:.9}),new le(i,{dir:[-.5,.5,-.6],color:[.8,.8,.7],intensity:1,space:"view"}),new le(i,{dir:[.5,-.5,-.6],color:[.8,.8,.8],intensity:1,space:"view"});const r=i.camera;s.on("matrix",(function(){const t=s.eye,e=s.look,i=s.up,o=c.mulVec3Scalar(c.normalizeVec3(c.subVec3(t,e,[])),22);r.look=[0,0,0],r.eye=o,r.up=i}));const o=new xe(i,Ls({radiusTop:.01,radiusBottom:.6,height:1.7,radialSegments:20,heightSegments:1,openEnded:!1})),n=new xe(i,Ls({radiusTop:.2,radiusBottom:.2,height:4.5,radialSegments:20,heightSegments:1,openEnded:!1})),a=new Se(i,{diffuse:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),h=new Se(i,{emissive:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),l=new Se(i,{diffuse:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),u=new Se(i,{emissive:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),p=new Se(i,{diffuse:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),d=new Se(i,{emissive:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),m=new Se(i,{diffuse:[.5,.5,.5],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2});this._meshes=[new Os(i,{geometry:new xe(i,Ns({radius:9,heightSegments:60,widthSegments:60})),material:new Se(i,{diffuse:[0,0,0],emissive:[.1,.1,.1],ambient:[.1,.1,.2],specular:[0,0,0],alpha:.4,alphaMode:"blend",frontface:"cw"}),pickable:!1,collidable:!1,visible:!1!==e.visible}),new Os(i,{geometry:new xe(i,Ns({radius:1})),material:m,pickable:!1,collidable:!1,visible:!1!==e.visible}),new Os(i,{geometry:o,material:a,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[5,0,0],rotation:[0,0,-90]}),new Os(i,{geometry:n,material:a,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[2,0,0],rotation:[0,0,90]}),new Os(i,{geometry:new xe(i,ks({text:"X",size:1.5})),material:h,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[7,0,0],billboard:"spherical"}),new Os(i,{geometry:o,material:l,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[0,5,0]}),new Os(i,{geometry:n,material:l,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[0,2,0]}),new Os(i,{geometry:new xe(i,ks({text:"Y",size:1.5})),material:u,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[0,7,0],billboard:"spherical"}),new Os(i,{geometry:o,material:p,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[0,0,5],rotation:[90,0,0]}),new Os(i,{geometry:n,material:p,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[0,0,2],rotation:[90,0,0]}),new Os(i,{geometry:new xe(i,ks({text:"Z",size:1.5})),material:d,pickable:!1,collidable:!1,visible:!1!==e.visible,position:[0,0,7],billboard:"spherical"})]}setVisible(t){for(let e=0;e<this._meshes.length;e++)this._meshes[e].visible=t}destroy(){this._axisGizmoCanvas=null,this._axisGizmoScene.destroy(),this._axisGizmoScene=null,super.destroy()}}class Gs extends A{get type(){return"SectionPlane"}constructor(t,e={}){super(t,e),this._state=new zt({active:!0,pos:c.vec3(),dir:c.vec3(),dist:0}),this.active=e.active,this.pos=e.pos,this.dir=e.dir,this.scene._sectionPlaneCreated(this)}set active(t){this._state.active=!1!==t,this.glRedraw(),this.fire("active",this._state.active)}get active(){return this._state.active}set pos(t){this._state.pos.set(t||[0,0,0]),this._state.dist=-c.dotVec3(this._state.pos,this._state.dir),this.fire("pos",this._state.pos)}get pos(){return this._state.pos}set dir(t){this._state.dir.set(t||[0,0,-1]),this._state.dist=-c.dotVec3(this._state.pos,this._state.dir),this.glRedraw(),this.fire("dir",this._state.dir)}get dir(){return this._state.dir}get dist(){return this._state.dist}flipDir(){const t=this._state.dir;t[0]*=-1,t[1]*=-1,t[2]*=-1,this._state.dist=-c.dotVec3(this._state.pos,this._state.dir),this.fire("dir",this._state.dir),this.glRedraw()}destroy(){this._state.destroy(),this.scene._sectionPlaneDestroyed(this),super.destroy()}}const Hs=c.vec3();class Vs extends n{constructor(t,e={}){super("BCFViewpoints",t,e),this.originatingSystem=e.originatingSystem||"xeokit.io",this.authoringTool=e.authoringTool||"xeokit.io"}getViewpoint(t={}){const e=this.viewer.scene,s=e.camera,i=e.realWorldOffset,r=!0===t.reverseClippingPlanes;let o={},n=c.normalizeVec3(c.subVec3(s.look,s.eye,c.vec3())),a=s.eye,h=s.up;s.yUp&&(n=Xs(n),a=Xs(a),h=Xs(h));const l=zs(c.addVec3(a,i));"ortho"===s.projection?o.orthogonal_camera={camera_view_point:l,camera_direction:zs(n),camera_up_vector:zs(h),view_to_world_scale:s.ortho.scale}:o.perspective_camera={camera_view_point:l,camera_direction:zs(n),camera_up_vector:zs(h),field_of_view:s.perspective.fov};const u=e.sectionPlanes;for(let t in u)if(u.hasOwnProperty(t)){let e,n=u[t],a=n.pos;e=r?c.negateVec3(n.dir,c.vec3()):n.dir,s.yUp&&(a=Xs(a),e=Xs(e)),c.addVec3(a,i),a=zs(a),e=zs(e),o.clipping_planes||(o.clipping_planes=[]),o.clipping_planes.push({location:a,direction:e})}o.components={visibility:{view_setup_hints:{spaces_visible:!!t.spacesVisible,space_boundaries_visible:!!t.spaceBoundariesVisible,openings_visible:!!t.openingsVisible}}};const p=new Set(e.opacityObjectIds),d=new Set(e.xrayedObjectIds),m=new Set(e.colorizedObjectIds),f=Object.values(e.objects).filter((t=>p.has(t.id)||m.has(t.id)||d.has(t.id))).reduce(((t,s)=>{let i,r=function(t){let e="";return e+=Math.round(255*t[0]).toString(16).padStart(2,"0"),e+=Math.round(255*t[1]).toString(16).padStart(2,"0"),e+=Math.round(255*t[2]).toString(16).padStart(2,"0"),e}(s.colorize);s.xrayed?(i=0===e.xrayMaterial.fillAlpha&&0!==e.xrayMaterial.edgeAlpha?.1:e.xrayMaterial.fillAlpha,i=Math.round(255*i).toString(16).padStart(2,"0"),r=i+r):p.has(s.id)&&(i=Math.round(255*s.opacity).toString(16).padStart(2,"0"),r=i+r),t[r]||(t[r]=[]);const o=s.id,n=s.originalSystemId,a={ifc_guid:n,originating_system:this.originatingSystem};return n!==o&&(a.authoring_tool_id=o),t[r].push(a),t}),{}),g=Object.entries(f).map((([t,e])=>({color:t,components:e})));o.components.coloring=g;const _=e.objectIds,y=e.visibleObjects,v=e.visibleObjectIds,b=_.filter((t=>!y[t])),P=e.selectedObjectIds;return t.defaultInvisible||v.length<b.length?(o.components.visibility.exceptions=this._createBCFComponents(v),o.components.visibility.default_visibility=!1):(o.components.visibility.exceptions=this._createBCFComponents(b),o.components.visibility.default_visibility=!0),o.components.selection=this._createBCFComponents(P),!1!==t.snapshot&&(o.snapshot={snapshot_type:"png",snapshot_data:this.viewer.getSnapshot({format:"png"})}),o}_createBCFComponents(t){const e=this.viewer.scene,s=[];for(let i=0,r=t.length;i<r;i++){const r=t[i],o=e.objects[r];if(o){const t={ifc_guid:o.originalSystemId,originating_system:this.originatingSystem};o.originalSystemId!==r&&(t.authoring_tool_id=r),s.push(t)}}return s}setViewpoint(t,e={}){if(!t)return;const s=this.viewer,i=s.scene,r=i.camera,o=!1!==e.rayCast,n=!1!==e.immediate,a=!1!==e.reset,h=i.realWorldOffset,l=!0===e.reverseClippingPlanes;if(i.clearSectionPlanes(),t.clipping_planes&&t.clipping_planes.forEach((function(t){let e=Us(t.location,Hs),s=Us(t.direction,Hs);l&&c.negateVec3(s),c.subVec3(e,h),r.yUp&&(e=Ws(e),s=Ws(s)),new Gs(i,{pos:e,dir:s})})),a&&(i.setObjectsXRayed(i.xrayedObjectIds,!1),i.setObjectsHighlighted(i.highlightedObjectIds,!1),i.setObjectsSelected(i.selectedObjectIds,!1)),t.components){if(t.components.visibility){t.components.visibility.default_visibility?(i.setObjectsVisible(i.objectIds,!0),t.components.visibility.exceptions&&t.components.visibility.exceptions.forEach((t=>this._withBCFComponent(e,t,(t=>t.visible=!1))))):(i.setObjectsVisible(i.objectIds,!1),t.components.visibility.exceptions&&t.components.visibility.exceptions.forEach((t=>this._withBCFComponent(e,t,(t=>t.visible=!0)))));const r=t.components.visibility.view_setup_hints;r&&(!1===r.spaces_visible&&i.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcSpace"),!1),!1===r.openings_visible&&i.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcOpening"),!1),r.space_boundaries_visible)}t.components.selection&&(i.setObjectsSelected(i.selectedObjectIds,!1),t.components.selection.forEach((t=>this._withBCFComponent(e,t,(t=>t.selected=!0))))),t.components.coloring&&t.components.coloring.forEach((t=>{let s=t.color,i=0,r=!1;8===s.length&&(i=parseInt(s.substring(0,2),16)/256,i<=1&&i>=.95&&(i=1),s=s.substring(2),r=!0);const o=[parseInt(s.substring(0,2),16)/256,parseInt(s.substring(2,4),16)/256,parseInt(s.substring(4,6),16)/256];t.components.map((t=>this._withBCFComponent(e,t,(t=>{t.colorize=o,r&&(t.opacity=i)}))))}))}if(t.perspective_camera||t.orthogonal_camera){let a,l,u,p;if(t.perspective_camera?(a=Us(t.perspective_camera.camera_view_point,Hs),l=Us(t.perspective_camera.camera_direction,Hs),u=Us(t.perspective_camera.camera_up_vector,Hs),r.perspective.fov=t.perspective_camera.field_of_view,p="perspective"):(a=Us(t.orthogonal_camera.camera_view_point,Hs),l=Us(t.orthogonal_camera.camera_direction,Hs),u=Us(t.orthogonal_camera.camera_up_vector,Hs),r.ortho.scale=t.orthogonal_camera.view_to_world_scale,p="ortho"),c.subVec3(a,h),r.yUp&&(a=Ws(a),l=Ws(l),u=Ws(u)),o){const t=i.pick({pickSurface:!0,origin:a,direction:l});l=t?t.worldPos:c.addVec3(a,l,Hs)}else l=c.addVec3(a,l,Hs);n?(r.eye=a,r.look=l,r.up=u,r.projection=p):s.cameraFlight.flyTo({eye:a,look:l,up:u,duration:e.duration,projection:p})}}_withBCFComponent(t,e,s){const i=this.viewer,r=i.scene;if(e.authoring_tool_id&&e.originating_system===this.originatingSystem){const o=e.authoring_tool_id,n=r.objects[o];if(n)return void s(n);if(t.updateCompositeObjects){if(i.metaScene.metaObjects[o])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(o),s)}}if(e.ifc_guid){const o=e.ifc_guid,n=r.objects[o];if(n)return void s(n);if(t.updateCompositeObjects){if(i.metaScene.metaObjects[o])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(o),s)}Object.keys(r.models).forEach((e=>{const n=c.globalizeObjectId(e,o),a=r.objects[n];if(a)s(a);else if(t.updateCompositeObjects){if(i.metaScene.metaObjects[n])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(n),s)}}))}}destroy(){super.destroy()}}function zs(t){return{x:t[0],y:t[1],z:t[2]}}function Us(t,e){return(e=new Float64Array(3))[0]=t.x,e[1]=t.y,e[2]=t.z,e}function Xs(t){return new Float64Array([t[0],-t[2],t[1]])}function Ws(t){return new Float64Array([t[0],t[2],-t[1]])}var Ys=c.vec3();const Ks=(t,e,s,i)=>{var r=t-s,o=e-i;return Math.sqrt(r*r+o*o)};class Zs extends A{constructor(t,e={}){if(super(t.viewer.scene,e),this.plugin=t,this._container=e.container,!this._container)throw"config missing: container";this._eventSubs={};var s=this.plugin.viewer.scene;this._originMarker=new q(s,e.origin),this._targetMarker=new q(s,e.target),this._originWorld=c.vec3(),this._targetWorld=c.vec3(),this._wp=new Float64Array(24),this._vp=new Float64Array(24),this._pp=new Float64Array(24),this._cp=new Int16Array(8),this._xAxisLabelCulled=!1,this._yAxisLabelCulled=!1,this._zAxisLabelCulled=!1,this._color=e.color||this.plugin.defaultColor,this._originDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==t.zIndex?t.zIndex+1:void 0}),this._targetDot=new Q(this._container,{fillColor:this._color,zIndex:void 0!==t.zIndex?t.zIndex+1:void 0}),this._lengthWire=new $(this._container,{color:this._color,thickness:2,zIndex:t.zIndex}),this._xAxisWire=new $(this._container,{color:"red",thickness:1,zIndex:t.zIndex}),this._yAxisWire=new $(this._container,{color:"green",thickness:1,zIndex:t.zIndex}),this._zAxisWire=new $(this._container,{color:"blue",thickness:1,zIndex:t.zIndex}),this._lengthLabel=new J(this._container,{fillColor:this._color,prefix:"",text:"",zIndex:void 0!==t.zIndex?t.zIndex+2:void 0}),this._xAxisLabel=new J(this._container,{fillColor:"red",prefix:"X",text:"",zIndex:void 0!==t.zIndex?t.zIndex+2:void 0}),this._yAxisLabel=new J(this._container,{fillColor:"green",prefix:"Y",text:"",zIndex:void 0!==t.zIndex?t.zIndex+2:void 0}),this._zAxisLabel=new J(this._container,{fillColor:"blue",prefix:"Z",text:"",zIndex:void 0!==t.zIndex?t.zIndex+2:void 0}),this._wpDirty=!1,this._vpDirty=!1,this._cpDirty=!1,this._visible=!1,this._originVisible=!1,this._targetVisible=!1,this._wireVisible=!1,this._axisVisible=!1,this._originMarker.on("worldPos",(t=>{this._originWorld.set(t||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._targetMarker.on("worldPos",(t=>{this._targetWorld.set(t||[0,0,0]),this._wpDirty=!0,this._needUpdate(0)})),this._onViewMatrix=s.camera.on("viewMatrix",(()=>{this._vpDirty=!0,this._needUpdate(0)})),this._onProjMatrix=s.camera.on("projMatrix",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onCanvasBoundary=s.canvas.on("boundary",(()=>{this._cpDirty=!0,this._needUpdate(0)})),this._onMetricsUnits=s.metrics.on("units",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onMetricsScale=s.metrics.on("scale",(()=>{this._cpDirty=!0,this._needUpdate()})),this._onMetricsOrigin=s.metrics.on("origin",(()=>{this._cpDirty=!0,this._needUpdate()})),this.approximate=e.approximate,this.visible=e.visible,this.originVisible=e.originVisible,this.targetVisible=e.targetVisible,this.wireVisible=e.wireVisible,this.axisVisible=e.axisVisible}_update(){if(!this._visible)return;const t=this.plugin.viewer.scene;this._wpDirty&&(this._wp[0]=this._originWorld[0],this._wp[1]=this._originWorld[1],this._wp[2]=this._originWorld[2],this._wp[3]=1,this._wp[4]=this._targetWorld[0],this._wp[5]=this._originWorld[1],this._wp[6]=this._originWorld[2],this._wp[7]=1,this._wp[8]=this._targetWorld[0],this._wp[9]=this._targetWorld[1],this._wp[10]=this._originWorld[2],this._wp[11]=1,this._wp[12]=this._targetWorld[0],this._wp[13]=this._targetWorld[1],this._wp[14]=this._targetWorld[2],this._wp[15]=1,this._wpDirty=!1,this._vpDirty=!0),this._vpDirty&&(c.transformPositions4(t.camera.viewMatrix,this._wp,this._vp),this._vp[3]=1,this._vp[7]=1,this._vp[11]=1,this._vp[15]=1,this._vpDirty=!1,this._cpDirty=!0);const e=this._originMarker.viewPos[2],s=this._targetMarker.viewPos[2];if(e>-.3||s>-.3)return this._xAxisLabel.setVisible(!1),this._yAxisLabel.setVisible(!1),this._zAxisLabel.setVisible(!1),this._lengthLabel.setVisible(!1),this._xAxisWire.setVisible(!1),this._yAxisWire.setVisible(!1),this._zAxisWire.setVisible(!1),this._lengthWire.setVisible(!1),this._originDot.setVisible(!1),void this._targetDot.setVisible(!1);if(this._cpDirty){c.transformPositions4(t.camera.project.matrix,this._vp,this._pp);var i=this._pp,r=this._cp,o=t.canvas.canvas.getBoundingClientRect(),n=o.top,a=o.left,h=t.canvas.boundary,l=h[2],u=h[3],p=0;const e=this.plugin.viewer.scene.metrics,s=e.scale,f=e.units,g=e.unitsInfo[f].abbrev;for(var d=0,m=i.length;d<m;d+=4)r[p]=a+Math.floor((1+i[d+0]/i[d+3])*l/2),r[p+1]=n+Math.floor((1-i[d+1]/i[d+3])*u/2),p+=2;this._originDot.setPos(r[0],r[1]),this._targetDot.setPos(r[6],r[7]),this._lengthWire.setStartAndEnd(r[0],r[1],r[6],r[7]),this._xAxisWire.setStartAndEnd(r[0],r[1],r[2],r[3]),this._yAxisWire.setStartAndEnd(r[2],r[3],r[4],r[5]),this._zAxisWire.setStartAndEnd(r[4],r[5],r[6],r[7]),this._lengthLabel.setPosOnWire(r[0],r[1],r[6],r[7]),this._xAxisLabel.setPosOnWire(r[0],r[1],r[2],r[3]),this._yAxisLabel.setPosOnWire(r[2],r[3],r[4],r[5]),this._zAxisLabel.setPosOnWire(r[4],r[5],r[6],r[7]);const _=this._approximate?" ~ ":" = ";this._length=Math.abs(c.lenVec3(c.subVec3(this._targetWorld,this._originWorld,Ys))),this._lengthLabel.setText(_+(this._length*s).toFixed(2)+g);const y=Math.abs(Ks(r[0],r[1],r[2],r[3])),v=Math.abs(Ks(r[2],r[3],r[4],r[5])),b=Math.abs(Ks(r[4],r[5],r[6],r[7])),P=this.plugin.labelMinAxisLength;this._xAxisLabelCulled=y<P,this._yAxisLabelCulled=v<P,this._zAxisLabelCulled=b<P,this._xAxisLabelCulled?this._xAxisLabel.setVisible(!1):(this._xAxisLabel.setText(_+Math.abs((this._targetWorld[0]-this._originWorld[0])*s).toFixed(2)+g),this._xAxisLabel.setVisible(this.axisVisible)),this._yAxisLabelCulled?this._yAxisLabel.setVisible(!1):(this._yAxisLabel.setText(_+Math.abs((this._targetWorld[1]-this._originWorld[1])*s).toFixed(2)+g),this._yAxisLabel.setVisible(this.axisVisible)),this._zAxisLabelCulled?this._zAxisLabel.setVisible(!1):(this._zAxisLabel.setText(_+Math.abs((this._targetWorld[2]-this._originWorld[2])*s).toFixed(2)+g),this._zAxisLabel.setVisible(this.axisVisible)),this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._xAxisWire.setVisible(this.axisVisible),this._yAxisWire.setVisible(this.axisVisible),this._zAxisWire.setVisible(this.axisVisible),this._lengthWire.setVisible(this.wireVisible),this._lengthLabel.setVisible(this.wireVisible),this._cpDirty=!1}}set approximate(t){t=!1!==t,this._approximate!==t&&(this._approximate=t,this._cpDirty=!0,this._needUpdate(0))}get approximate(){return this._approximate}get origin(){return this._originMarker}get target(){return this._targetMarker}get length(){this._update();const t=this.plugin.viewer.scene.metrics.scale;return this._length*t}get color(){return this._color}set color(t){this._color=t,this._originDot.setFillColor(t),this._targetDot.setFillColor(t),this._lengthWire.setColor(t),this._lengthLabel.setFillColor(t)}set visible(t){t=void 0!==t?Boolean(t):this.plugin.defaultVisible,this._visible=t,this._originDot.setVisible(this._visible&&this._originVisible),this._targetDot.setVisible(this._visible&&this._targetVisible),this._lengthWire.setVisible(this._visible&&this._wireVisible),this._lengthLabel.setVisible(this._visible&&this._wireVisible);var e=this._visible&&this._axisVisible;this._xAxisWire.setVisible(e),this._yAxisWire.setVisible(e),this._zAxisWire.setVisible(e),this._xAxisLabel.setVisible(e&&!this._xAxisLabelCulled),this._yAxisLabel.setVisible(e&&!this._yAxisLabelCulled),this._zAxisLabel.setVisible(e&&!this._zAxisLabelCulled)}get visible(){return this._visible}set originVisible(t){t=void 0!==t?Boolean(t):this.plugin.defaultOriginVisible,this._originVisible=t,this._originDot.setVisible(this._visible&&this._originVisible)}get originVisible(){return this._originVisible}set targetVisible(t){t=void 0!==t?Boolean(t):this.plugin.defaultTargetVisible,this._targetVisible=t,this._targetDot.setVisible(this._visible&&this._targetVisible)}get targetVisible(){return this._targetVisible}set axisVisible(t){t=void 0!==t?Boolean(t):this.plugin.defaultAxisVisible,this._axisVisible=t;var e=this._visible&&this._axisVisible;this._xAxisWire.setVisible(e),this._yAxisWire.setVisible(e),this._zAxisWire.setVisible(e),this._xAxisLabel.setVisible(e&&!this._xAxisLabelCulled),this._yAxisLabel.setVisible(e&&!this._yAxisLabelCulled),this._zAxisLabel.setVisible(e&&!this._zAxisLabelCulled)}get axisVisible(){return this._axisVisible}set wireVisible(t){t=void 0!==t?Boolean(t):this.plugin.defaultWireVisible,this._wireVisible=t;var e=this._visible&&this._wireVisible;this._lengthLabel.setVisible(e),this._lengthWire.setVisible(e)}get wireVisible(){return this._wireVisible}destroy(){const t=this.plugin.viewer.scene,e=t.metrics;this._onViewMatrix&&t.camera.off(this._onViewMatrix),this._onProjMatrix&&t.camera.off(this._onProjMatrix),this._onCanvasBoundary&&t.canvas.off(this._onCanvasBoundary),this._onMetricsUnits&&e.off(this._onMetricsUnits),this._onMetricsScale&&e.off(this._onMetricsScale),this._onMetricsOrigin&&e.off(this._onMetricsOrigin),this._originDot.destroy(),this._targetDot.destroy(),this._xAxisWire.destroy(),this._yAxisWire.destroy(),this._zAxisWire.destroy(),this._lengthLabel.destroy(),this._xAxisLabel.destroy(),this._yAxisLabel.destroy(),this._zAxisLabel.destroy(),this._lengthWire.destroy(),super.destroy()}}class qs extends A{constructor(t){super(t.viewer.scene),this.plugin=t,this._active=!1,this._currentDistMeasurement=null,this._currentDistMeasurementInitState={wireVisible:null,axisVisible:null,targetVisible:null},this._onHoverSurface=null,this._onHoverOff=null,this._onPickedNothing=null,this._onInputMouseDown=null,this._onInputMouseUp=null}get active(){return this._active}activate(){if(this._active)return;const t=this.plugin.viewer.cameraControl;let e=null;const s=c.vec3(),i=c.vec2(),r=this.plugin.viewer.scene.pickSurfacePrecisionEnabled;let o,n;this.startDot=new Q(this.plugin._container,{fillColor:this.plugin.defaultColor,zIndex:this.plugin.zIndex+1}),this._onHoverSurface=t.on("hoverSurface",(t=>{e=t.entity,s.set(t.worldPos),i.set(t.canvasPos),this.plugin.viewer.scene.canvas.canvas.style.cursor="pointer",this._currentDistMeasurement?(this._currentDistMeasurement.wireVisible=this._currentDistMeasurementInitState.wireVisible,this._currentDistMeasurement.axisVisible=this._currentDistMeasurementInitState.axisVisible,this._currentDistMeasurement.targetVisible=this._currentDistMeasurementInitState.targetVisible,this._currentDistMeasurement.target.entity=e,this._currentDistMeasurement.target.worldPos=s):this.startDot&&(this.startDot.setVisible(!0),this.startDot.setPos(t.canvasPos[0],t.canvasPos[1]))}));this._onInputMouseDown=this.plugin.viewer.scene.input.on("mousedown",(t=>{o=t[0],n=t[1]})),this._onInputMouseUp=this.plugin.viewer.scene.input.on("mouseup",(t=>{if(!(t[0]>o+5||t[0]<o-5||t[1]>n+5||t[1]<n-5))if(this.startDot&&(this.startDot.destroy(),this.startDot=null),this._currentDistMeasurement)if(e){if(r){const t=this.plugin.viewer.scene.pick({canvasPos:i,pickSurface:!0,pickSurfacePrecision:!0});t&&t.worldPos&&(this._currentDistMeasurement.target.worldPos=t.worldPos),this._currentDistMeasurement.approximate=!1}this.fire("measurementEnd",this._currentDistMeasurement),this._currentDistMeasurement=null}else this._currentDistMeasurement.destroy(),this.fire("measurementCancel",this._currentDistMeasurement),this._currentDistMeasurement=null;else if(e){if(r){const t=this.plugin.viewer.scene.pick({canvasPos:i,pickSurface:!0,pickSurfacePrecision:!0});t&&t.worldPos&&s.set(t.worldPos)}this._currentDistMeasurement=this.plugin.createMeasurement({id:c.createUUID(),origin:{entity:e,worldPos:s},target:{entity:e,worldPos:s},approximate:!0}),this._currentDistMeasurementInitState.axisVisible=this._currentDistMeasurement.axisVisible,this._currentDistMeasurementInitState.wireVisible=this._currentDistMeasurement.wireVisible,this._currentDistMeasurementInitState.targetVisible=this._currentDistMeasurement.targetVisible,this.fire("measurementStart",this._currentDistMeasurement)}})),this._onHoverOff=t.on("hoverOff",(t=>{this.startDot&&this.startDot.setVisible(!1),e=null,this._currentDistMeasurement&&(this._currentDistMeasurement.wireVisible=!1,this._currentDistMeasurement.targetVisible=!1,this._currentDistMeasurement.axisVisible=!1),this.plugin.viewer.scene.canvas.canvas.style.cursor="default"})),this._onPickedNothing=t.on("pickedNothing",(t=>{this._currentDistMeasurement&&(this._currentDistMeasurement.destroy(),this._currentDistMeasurement=null)})),this._active=!0}deactivate(){if(!this._active)return;this.startDot&&(this.startDot.destroy(),this.startDot=null),this.reset();const t=this.plugin.viewer.scene.input;t.off(this._onInputMouseDown),t.off(this._onInputMouseUp);const e=this.plugin.viewer.cameraControl;e.off(this._onHoverSurface),e.off(this._onHoverOff),e.off(this._onPickedNothing),this._currentDistMeasurement=null,this._active=!1}reset(){this._active&&this._currentDistMeasurement&&(this._currentDistMeasurement.destroy(),this._currentDistMeasurement=null)}destroy(){this.deactivate(),super.destroy()}}class $s extends n{constructor(t,e={}){super("DistanceMeasurements",t),this._container=e.container||document.body,this._control=new qs(this),this._measurements={},this.labelMinAxisLength=e.labelMinAxisLength,this.defaultVisible=!1!==e.defaultVisible,this.defaultOriginVisible=!1!==e.defaultOriginVisible,this.defaultTargetVisible=!1!==e.defaultTargetVisible,this.defaultWireVisible=!1!==e.defaultWireVisible,this.defaultAxisVisible=!1!==e.defaultAxisVisible,this.defaultColor=void 0!==e.defaultColor?e.defaultColor:"#00BBFF",this.zIndex=e.zIndex}send(t,e){}get control(){return this._control}get measurements(){return this._measurements}set labelMinAxisLength(t){t<1&&(this.error("labelMinAxisLength must be >= 1; defaulting to 25"),t=25),this._labelMinAxisLength=t||25}get labelMinAxisLength(){return this._labelMinAxisLength}createMeasurement(t={}){this.viewer.scene.components[t.id]&&(this.error("Viewer scene component with this ID already exists: "+t.id),delete t.id);const e=t.origin,s=t.target,i=new Zs(this,{id:t.id,plugin:this,container:this._container,origin:{entity:e.entity,worldPos:e.worldPos},target:{entity:s.entity,worldPos:s.worldPos},visible:t.visible,wireVisible:t.wireVisible,originVisible:t.originVisible,targetVisible:t.targetVisible,color:t.color});return this._measurements[i.id]=i,i.on("destroyed",(()=>{delete this._measurements[i.id]})),this.fire("measurementCreated",i),i}destroyMeasurement(t){const e=this._measurements[t];e?(e.destroy(),this.fire("measurementDestroyed",e)):this.log("DistanceMeasurement not found: "+t)}clear(){const t=Object.keys(this._measurements);for(var e=0,s=t.length;e<s;e++)this.destroyMeasurement(t[e])}destroy(){this.clear(),super.destroy()}}class Qs extends n{constructor(t,e={}){super("FastNav",t),this._pbrEnabled=void 0!==e.pbrEnabled&&null!==e.pbrEnabled?e.pbrEnabled:t.scene.pbrEnabled,this._saoEnabled=void 0!==e.saoEnabled&&null!==e.saoEnabled?e.saoEnabled:t.scene.sao.enabled,this._edgesEnabled=void 0!==e.edgesEnabled&&null!==e.edgesEnabled?e.edgesEnabled:t.scene.edgeMaterial.edges,this._pInterval=null,this._fadeMillisecs=500;let s=600,i=s,r=!1;this._onCanvasBoundary=t.scene.canvas.on("boundary",(()=>{i=s,r||(this._cancelFade(),t.scene.pbrEnabled=!1,t.scene.sao.enabled=!1,t.scene.edgeMaterial.edges=!1,r=!0)})),this._onCameraMatrix=t.scene.camera.on("matrix",(()=>{i=s,r||(this._cancelFade(),t.scene.pbrEnabled=!1,t.scene.sao.enabled=!1,t.scene.edgeMaterial.edges=!1,r=!0)})),this._onSceneTick=t.scene.on("tick",(e=>{r&&(i-=e.deltaTime,i<=0&&r&&(this._startFade(),this._pInterval2=setTimeout((()=>{t.scene.pbrEnabled=this._pbrEnabled,t.scene.sao.enabled=this._saoEnabled,t.scene.edgeMaterial.edges=this._edgesEnabled}),100),r=!1))}));let o=!1;this._onSceneMouseDown=t.scene.input.on("mousedown",(()=>{o=!0})),this._onSceneMouseUp=t.scene.input.on("mouseup",(()=>{o=!1})),this._onSceneMouseMove=t.scene.input.on("mousemove",(()=>{o&&(i=s,r||(this._cancelFade(),t.scene.pbrEnabled=!1,t.scene.sao.enabled=!1,t.scene.edgeMaterial.edges=!1,r=!0))}))}_startFade(){this._img||this._initFade();const t=1/(this._fadeMillisecs/50);this._pInterval&&(clearInterval(this._pInterval),this._pInterval=null);const e=this.viewer,s=e.scene.canvas.canvas,i=Js(s),r=(parseInt(s.style["z-index"])||0)+1;this._img.style.position="fixed",this._img.style.margin="0px",this._img.style["z-index"]=r,this._img.style.background=s.style.background,this._img.style.left=i.left+"px",this._img.style.top=i.top+"px",this._img.style.width=s.width+"px",this._img.style.height=s.height+"px",this._img.width=s.width,this._img.height=s.height,this._img.src="",this._img.src=e.getSnapshot({format:"png",includeGizmos:!0}),this._img.style.visibility="visible",this._img.style.opacity=1;let o=1;this._pInterval=setInterval((()=>{if(o-=t,o>0){this._img.style.opacity=o;const t=Js(s);this._img.style.left=t.left+"px",this._img.style.top=t.top+"px",this._img.style.width=s.width+"px",this._img.style.height=s.height+"px",this._img.style.opacity=o,this._img.width=s.width,this._img.height=s.height}else this._img.style.opacity=0,this._img.style.visibility="hidden",clearInterval(this._pInterval),this._pInterval=null}),50)}_initFade(){this._img=document.createElement("img");const t=this.viewer.scene.canvas.canvas,e=Js(t);parseInt(t.style["z-index"]),this._img.style.position="absolute",this._img.style.visibility="hidden",this._img.style["pointer-events"]="none",this._img.style["z-index"]=5,this._img.style.left=e.left+"px",this._img.style.top=e.top+"px",this._img.style.width=t.width+"px",this._img.style.height=t.height+"px",this._img.style.opacity=1,this._img.width=t.width,this._img.height=t.height,this._img.left=e.left,this._img.top=e.top,t.parentNode.insertBefore(this._img,t.nextSibling)}_cancelFade(){this._img&&(this._pInterval&&(clearInterval(this._pInterval),this._pInterval=null),this._pInterval2&&(clearInterval(this._pInterval2),this._pInterval2=null),this._img.style.opacity=0,this._img.style.visibility="hidden")}set pbrEnabled(t){this._pbrEnabled=t}get pbrEnabled(){return this._pbrEnabled}set saoEnabled(t){this._saoEnabled=t}get saoEnabled(){return this._saoEnabled}set edgesEnabled(t){this._edgesEnabled=t}get edgesEnabled(){return this._edgesEnabled}send(t,e){if("clear"===t)this._cancelFade()}destroy(){this._cancelFade(),this.viewer.scene.camera.off(this._onCameraMatrix),this.viewer.scene.canvas.off(this._onCanvasBoundary),this.viewer.scene.input.off(this._onSceneMouseDown),this.viewer.scene.input.off(this._onSceneMouseUp),this.viewer.scene.input.off(this._onSceneMouseMove),this.viewer.scene.off(this._onSceneTick),super.destroy(),this._img&&(this._img.parentNode.removeChild(this._img),this._img=null)}}function Js(t){let e=0,s=0;do{e+=t.offsetTop||0,s+=t.offsetLeft||0,t=t.offsetParent}while(t);return{top:e,left:s}}class ti{constructor(){}getMetaModel(t,e,s){_.loadJSON(t,(t=>{e(t)}),(function(t){s(t)}))}getGLTF(t,e,s){_.loadJSON(t,(t=>{e(t)}),(function(t){s(t)}))}getArrayBuffer(t,e,s,i){!function(t,e,s,i){var r=()=>{};s=s||r,i=i||r;const o=/^data:(.*?)(;base64)?,(.*)$/,n=e.match(o);if(n){const t=!!n[2];var a=n[3];a=window.decodeURIComponent(a),t&&(a=window.atob(a));try{const t=new ArrayBuffer(a.length),e=new Uint8Array(t);for(var h=0;h<a.length;h++)e[h]=a.charCodeAt(h);window.setTimeout((function(){s(t)}),0)}catch(t){window.setTimeout((function(){i(t)}),0)}}else{const r=function(t){var e=t.lastIndexOf("/");return 0!==e?t.substring(0,e+1):""}(t),o=r+e,n=new XMLHttpRequest;n.open("GET",o,!0),n.responseType="arraybuffer",n.onreadystatechange=function(){4===n.readyState&&(200===n.status?s(n.response):i("loadArrayBuffer error : "+n.response))},n.send(null)}}(t,e,(t=>{s(t)}),(function(t){i(t)}))}}class ei{constructor(t,e,s,i,r=null,o=0){this.model=t,this.object=null,this.parent=null,this.id=e,this.pickId=this.model.scene._renderer.getPickID(this),this.aabb=c.AABB3(),this._layer=r,this._portionId=o,this._color=[s[0],s[1],s[2],i],this._colorize=[s[0],s[1],s[2],i],this._colorizing=!1,this._transparent=i<255,this.numTriangles=0,this.origin=null}_finalize(t){this._layer.initFlags(this._portionId,t,this._transparent)}_setVisible(t){this._layer.setVisible(this._portionId,t,this._transparent)}_setColor(t){this._color[0]=t[0],this._color[1]=t[1],this._color[2]=t[2],this._colorizing||this._layer.setColor(this._portionId,this._color,!1)}_setColorize(t){t?(this._colorize[0]=t[0],this._colorize[1]=t[1],this._colorize[2]=t[2],this._layer.setColor(this._portionId,this._colorize,false),this._colorizing=!0):(this._layer.setColor(this._portionId,this._color,false),this._colorizing=!1)}_setOpacity(t,e){const s=t<255,i=this._transparent!==s;this._color[3]=t,this._colorize[3]=t,this._transparent=s,this._colorizing?this._layer.setColor(this._portionId,this._colorize):this._layer.setColor(this._portionId,this._color),i&&this._layer.setTransparent(this._portionId,e,s)}_setOffset(t){this._layer.setOffset(this._portionId,t)}_setHighlighted(t){this._layer.setHighlighted(this._portionId,t,this._transparent)}_setXRayed(t){this._layer.setXRayed(this._portionId,t,this._transparent)}_setSelected(t){this._layer.setSelected(this._portionId,t,this._transparent)}_setEdges(t){this._layer.setEdges(this._portionId,t,this._transparent)}_setClippable(t){this._layer.setClippable(this._portionId,t,this._transparent)}_setCollidable(t){this._layer.setCollidable(this._portionId,t)}_setPickable(t){this._layer.setPickable(this._portionId,t,this._transparent)}_setCulled(t){this._layer.setCulled(this._portionId,t,this._transparent)}canPickTriangle(){return!1}drawPickTriangles(t,e){}pickTriangleSurface(t){}precisionRayPickSurface(t,e,s,i){return!!this._layer.precisionRayPickSurface&&this._layer.precisionRayPickSurface(this._portionId,t,e,s,i)}canPickWorldPos(){return!0}drawPickDepths(t){this.model.drawPickDepths(t)}drawPickNormals(t){this.model.drawPickNormals(t)}delegatePickedEntity(){return this.parent}_destroy(){this.model.scene._renderer.putPickID(this.pickId)}}const si=new class{constructor(){this._uint8Arrays={},this._float32Arrays={}}_clear(){this._uint8Arrays={},this._float32Arrays={}}getUInt8Array(t){let e=this._uint8Arrays[t];return e||(e=new Uint8Array(t),this._uint8Arrays[t]=e),e}getFloat32Array(t){let e=this._float32Arrays[t];return e||(e=new Float32Array(t),this._float32Arrays[t]=e),e}};let ii=0;const ri=0,oi=1,ni=2,ai=3,hi=4,li=5,ui=6,pi=7,ci=8,di=9,mi=10,fi=11,gi=c.vec4(),_i=c.vec3();class yi{constructor(t,e){this._scene=t,this._withSAO=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const t=this._scene;return[t._lightsState.getHash(),t._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(t,e,s){const i=this._scene,r=i.camera,o=e.model,n=i.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,o.worldNormalMatrix);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const t=i._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,r=o.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const o=r.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,o?1:0),o){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,_i);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._lightsState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let t=0,e=r.length;t<e;t++)switch(o=r[t],o.type){case"dir":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=null,this._uLightDir[t]=i.getLocation("lightDir"+t);break;case"point":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=null,this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t);break;case"spot":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=i.getLocation("lightDir"+t),this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t)}this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene,s=e.canvas.gl,i=this._program,r=e._lightsState.lights,o=e.camera.project;i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,e._lightsState.getAmbientColorAndIntensity());for(let t=0,e=r.length;t<e;t++){const e=r[t];this._uLightColor[t]&&s.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(s.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&s.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&s.uniform3fv(this._uLightDir[t],e.dir)}if(this._withSAO){const i=e.sao;if(i.possible){const e=s.drawingBufferWidth,r=s.drawingBufferHeight;gi[0]=e,gi[1]=r,gi[2]=i.blendCutoff,gi[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,gi),this._program.bindTexture(this._uOcclusionTexture,t.occlusionTexture,0)}}if(e.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState,s=t._lightsState,i=e.sectionPlanes.length>0;let r;const o=[];o.push("// Triangles batching draw vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec3 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("uniform vec4 lightAmbient;");for(let t=0,e=s.lights.length;t<e;t++)r=s.lights[t],"ambient"!==r.type&&(o.push("uniform vec4 lightColor"+t+";"),"dir"===r.type&&o.push("uniform vec3 lightDir"+t+";"),"point"===r.type&&o.push("uniform vec3 lightPos"+t+";"),"spot"===r.type&&(o.push("uniform vec3 lightPos"+t+";"),o.push("uniform vec3 lightDir"+t+";")));o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),i&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;")),o.push("varying vec4 vColor;"),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),o.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),o.push("float lambertian = 1.0;");for(let t=0,e=s.lights.length;t<e;t++)if(r=s.lights[t],"ambient"!==r.type){if("dir"===r.type)"view"===r.space?o.push("viewLightDir = normalize(lightDir"+t+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===r.type)"view"===r.space?o.push("viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);"):o.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==r.type)continue;"view"===r.space?o.push("viewLightDir = normalize(lightDir"+t+");"):o.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}o.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),o.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}return o.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),o.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;")),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;")),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Triangles batching draw fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),this._withSAO&&(i.push("uniform sampler2D uOcclusionTexture;"),i.push("uniform vec4      uSAOParams;"),i.push("const float       packUpscale = 256. / 255.;"),i.push("const float       unpackDownScale = 255. / 256.;"),i.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),i.push("float unpackRGBToFloat( const in vec4 v ) {"),i.push("    return dot( v, unPackFactors );"),i.push("}")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(i.push("   float viewportWidth     = uSAOParams[0];"),i.push("   float viewportHeight    = uSAOParams[1];"),i.push("   float blendCutoff       = uSAOParams[2];"),i.push("   float blendFactor       = uSAOParams[3];"),i.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),i.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),i.push("   gl_FragColor            = vec4(vColor.rgb * ambient, 1.0);")):i.push("   gl_FragColor            = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const vi=c.vec4(),bi=c.vec3();class Pi{constructor(t,e){this._scene=t,this._withSAO=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const t=this._scene;return[t._lightsState.getHash(),t._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(t,e,s){const i=this._scene,r=i.camera,o=e.model,n=i.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const t=i._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,r=o.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e],o=r.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,o?1:0),o){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,bi);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._lightsState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let t=0,e=r.length;t<e;t++)switch(o=r[t],o.type){case"dir":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=null,this._uLightDir[t]=i.getLocation("lightDir"+t);break;case"point":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=null,this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t);break;case"spot":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=i.getLocation("lightDir"+t),this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t)}this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene,s=e.canvas.gl,i=this._program,r=e._lightsState.lights,o=e.camera.project;i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,o.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,e._lightsState.getAmbientColorAndIntensity());for(let t=0,e=r.length;t<e;t++){const e=r[t];this._uLightColor[t]&&s.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(s.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&s.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&s.uniform3fv(this._uLightDir[t],e.dir)}if(this._withSAO){const i=e.sao;if(i.possible){const e=s.drawingBufferWidth,r=s.drawingBufferHeight;vi[0]=e,vi[1]=r,vi[2]=i.blendCutoff,vi[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,vi),this._program.bindTexture(this._uOcclusionTexture,t.occlusionTexture,0)}}if(e.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching flat-shading draw vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vViewPosition = viewPosition;"),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._lightsState,s=t._sectionPlanesState,i=s.sectionPlanes.length>0,r=[];if(r.push("// Triangles batching flat-shading draw fragment shader"),r.push("#extension GL_OES_standard_derivatives : enable"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("#extension GL_EXT_frag_depth : enable"),r.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),r.push("precision highp float;"),r.push("precision highp int;"),r.push("#else"),r.push("precision mediump float;"),r.push("precision mediump int;"),r.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(r.push("varying float isPerspective;"),r.push("uniform float logDepthBufFC;"),r.push("varying float vFragDepth;")),this._withSAO&&(r.push("uniform sampler2D uOcclusionTexture;"),r.push("uniform vec4      uSAOParams;"),r.push("const float       packUpscale = 256. / 255.;"),r.push("const float       unpackDownScale = 255. / 256.;"),r.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),r.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),r.push("float unpackRGBToFloat( const in vec4 v ) {"),r.push("    return dot( v, unPackFactors );"),r.push("}")),i){r.push("varying vec4 vWorldPosition;"),r.push("varying vec4 vFlags2;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)r.push("uniform bool sectionPlaneActive"+t+";"),r.push("uniform vec3 sectionPlanePos"+t+";"),r.push("uniform vec3 sectionPlaneDir"+t+";")}r.push("uniform mat4 viewMatrix;"),r.push("uniform vec4 lightAmbient;");for(let t=0,s=e.lights.length;t<s;t++){const s=e.lights[t];"ambient"!==s.type&&(r.push("uniform vec4 lightColor"+t+";"),"dir"===s.type&&r.push("uniform vec3 lightDir"+t+";"),"point"===s.type&&r.push("uniform vec3 lightPos"+t+";"),"spot"===s.type&&(r.push("uniform vec3 lightPos"+t+";"),r.push("uniform vec3 lightDir"+t+";")))}if(r.push("varying vec4 vViewPosition;"),r.push("varying vec4 vColor;"),r.push("void main(void) {"),i){r.push("  bool clippable = (float(vFlags2.x) > 0.0);"),r.push("  if (clippable) {"),r.push("  float dist = 0.0;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)r.push("if (sectionPlaneActive"+t+") {"),r.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),r.push("}");r.push("  if (dist > 0.0) { "),r.push("      discard;"),r.push("  }"),r.push("}")}r.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),r.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),r.push("float lambertian = 1.0;"),r.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),r.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),r.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );");for(let t=0,s=e.lights.length;t<s;t++){const s=e.lights[t];if("ambient"!==s.type){if("dir"===s.type)"view"===s.space?r.push("viewLightDir = normalize(lightDir"+t+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===s.type)"view"===s.space?r.push("viewLightDir = -normalize(lightPos"+t+" - viewPosition.xyz);"):r.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==s.type)continue;"view"===s.space?r.push("viewLightDir = normalize(lightDir"+t+");"):r.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}r.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),r.push("reflectedColor += lambertian * (lightColor"+t+".rgb * lightColor"+t+".a);")}}return r.push("vec4 fragColor =  vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(r.push("   float viewportWidth     = uSAOParams[0];"),r.push("   float viewportHeight    = uSAOParams[1];"),r.push("   float blendCutoff       = uSAOParams[2];"),r.push("   float blendFactor       = uSAOParams[3];"),r.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),r.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),r.push("   gl_FragColor            = vec4(fragColor.rgb * ambient, 1.0);")):r.push("   gl_FragColor            = fragColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&r.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),r.push("}"),r}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ti=new Float32Array([1,1,1]),wi=c.vec3();class xi{constructor(t,e){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===li){const t=r.xrayMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ai){const t=r.highlightMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===hi){const t=r.selectedMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,Ti);const l=h?U(o.viewMatrix,h):o.viewMatrix;n.uniformMatrix4fv(this._uViewMatrix,!1,l),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,wi);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching silhouette vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 color;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState;let s,i;const r=e.sectionPlanes.length>0,o=[];if(o.push("// Triangles batching silhouette fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("uniform vec4 color;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("gl_FragColor = color;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Mi=c.vec3(),Di=new Float32Array([0,0,0,1]);class Ei{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===mi){const t=r.xrayMaterial._state,e=t.edgeColor,s=t.edgeAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ci){const t=r.highlightMaterial._state,e=t.edgeColor,s=t.edgeAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===di){const t=r.selectedMaterial._state,e=t.edgeColor,s=t.edgeAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,Di);n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,o=i.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Mi);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.edgeIndicesBuf.bind(),n.drawElements(n.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uColor=s.getLocation("color"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=this._program,i=t.camera.project;if(s.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(i.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry edges drawing vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("uniform vec4 color;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(color.r, color.g, color.b, color.a);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry edges drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ii=c.vec3();class Si{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,o=i.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Ii);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.edgeIndicesBuf.bind(),n.drawElements(n.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=this._program,i=t.camera.project;if(s.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(i.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry edges drawing vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry edges drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ai=c.vec3();class Ci{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;this._program||this._allocate(e),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=t.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,u),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Ai);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(a.pickColorsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene.canvas.gl;this._program.bind(),e.uniform1i(this._uPickInvisible,t.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry picking vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 pickColor;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),e&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry picking fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   gl_FragColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Fi=c.vec3();class Oi{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;this._program||this._allocate(),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,t.pickInvisible);const l=t.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),n.uniform1f(this._uPickZNear,t.pickZNear),n.uniform1f(this._uPickZFar,t.pickZFar),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(t.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Fi);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching pick depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Triangles batching pick depth fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("varying vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    gl_FragColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ri=c.vec3();class Li{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;this._program||this._allocate(e),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,t.pickInvisible),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=t.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Ri);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching pick normals vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec3 normal;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec3 vWorldNormal;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vec3 worldNormal =  octDecode(normal.xy); "),s.push("      vWorldNormal = worldNormal;"),e&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Triangles batching pick normals fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("varying vec3 vWorldNormal;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ni=c.vec3();class Bi{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.canvas.gl,n=e._state,a=r.camera,h=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,s),o.uniformMatrix4fv(this._uViewMatrix,!1,h?U(a.viewMatrix,h):a.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,n=i.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const r=n.sectionPlanesActivePerLayer[s+e];if(o.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Ni);o.uniform3fv(i.pos,t)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aColor&&this._aColor.bindArrayBuffer(n.colorsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),n.indicesBuf.bind(),o.drawElements(o.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching occlusion vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Triangles batching occlusion fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("      if (sectionPlaneActive"+t+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const ki=c.vec3();class ji{constructor(t){this._scene=t,this._allocate(),this._hash=this._getHash()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,o=i.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,ki);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec2 vHighPrecisionZW;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vHighPrecisionZW = gl_Position.zw;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Triangles batching depth fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("precision highp float;"),i.push("precision highp int;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("const float   packUpScale = 256. / 255.;"),i.push("const float   unpackDownscale = 255. / 256.;"),i.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),i.push("const float   shiftRight8 = 1.0 / 256.;"),i.push("vec4 packDepthToRGBA( const in float v ) {"),i.push("    vec4 r = vec4( fract( v * packFactors ), v );"),i.push("    r.yzw -= r.xyz * shiftRight8;"),i.push("    return r * packUpScale;"),i.push("}"),i.push("varying vec2 vHighPrecisionZW;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?i.push("    gl_FragColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "):i.push("    gl_FragColor = packDepthToRGBA(fragCoordZ); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null,m.memory.programs--}}const Gi=c.vec3();class Hi{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(e)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(o.viewMatrix,h):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const l=r._sectionPlanesState.sectionPlanes.length;if(l>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,o=i.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Gi);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uWorldNormalMatrix=s.getLocation("worldNormalMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uViewNormalMatrix=s.getLocation("viewNormalMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aNormal=s.getAttribute("normal"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2&&(this._aFlags2=s.getAttribute("flags2")),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry normals vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec3 normal;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 worldNormalMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 viewNormalMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec3 vViewNormal;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition   = viewMatrix * worldPosition; "),s.push("      vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),s.push("      vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),e&&(s.push("      vWorldPosition  = worldPosition;"),s.push("      vFlags2         = flags2;")),s.push("      vViewNormal = viewNormal;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry normals fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Vi=c.vec3();class zi{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e){const s=this._scene,i=s.canvas.gl,r=e._state;this._program||this._allocate(),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),i.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),s.logarithmicDepthBufferEnabled&&i.uniform1f(this._uZFar,s.camera.project.far),this._aPosition.bindArrayBuffer(r.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(r.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(r.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(r.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(r.offsetsBuf),r.indicesBuf.bind();const o=s._sectionPlanesState.sectionPlanes.length;if(o>0){const t=s._sectionPlanesState.sectionPlanes,r=e.layerIndex*o,n=model.renderFlags,a=e._state.origin;for(let e=0;e<o;e++){const s=this._uSectionPlanes[e];if(s){const o=n.sectionPlanesActivePerLayer[r+e];if(i.uniform1i(s.active,o?1:0),o){const r=t[e];if(a){const t=Y(r.dist,r.dir,a,Vi);i.uniform3fv(s.pos,t)}else i.uniform3fv(s.pos,r.pos);i.uniform3fv(s.dir,r.dir)}}}}i.drawElements(i.TRIANGLES,r.indicesBuf.numItems,r.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),t.logarithmicDepthBufferEnabled&&(this._uZFar=i.getLocation("zFar")),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2")}_bindProgram(t){const e=this._scene.canvas.gl;this._program.bind(),e.uniformMatrix4fv(this._uShadowViewMatrix,!1,t.shadowViewMatrix),e.uniformMatrix4fv(this._uShadowProjMatrix,!1,t.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Batched geometry shadow vertex shader"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("void main(void) {"),s.push("  bool visible        = (float(flags.x) > 0.0);"),s.push("  bool transparent    = ((float(color.a) / 255.0) < 1.0);"),s.push("  if (!visible || transparent) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = shadowViewMatrix * worldPosition; "),e&&(s.push("      vWorldPosition = worldPosition;"),s.push("      vFlags2 = flags2;")),s.push("      vViewPosition = viewPosition;"),s.push("      gl_Position = shadowProjMatrix * viewPosition;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene._sectionPlanesState,e=t.sectionPlanes.length>0,s=[];if(s.push("// Batched geometry shadow fragment shader"),s.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),s.push("precision highp float;"),s.push("precision highp int;"),s.push("#else"),s.push("precision mediump float;"),s.push("precision mediump int;"),s.push("#endif"),e){s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;");for(let e=0;e<t.sectionPlanes.length;e++)s.push("uniform bool sectionPlaneActive"+e+";"),s.push("uniform vec3 sectionPlanePos"+e+";"),s.push("uniform vec3 sectionPlaneDir"+e+";")}if(s.push("varying vec4 vViewPosition;"),s.push("vec4 encodeFloat( const in float v ) {"),s.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),s.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),s.push("  vec4 comp = fract(v * bitShift);"),s.push("  comp -= comp.xxyz * bitMask;"),s.push("  return comp;"),s.push("}"),s.push("void main(void) {"),e){s.push("  bool clippable = (float(vFlags2.x) > 0.0);"),s.push("  if (clippable) {"),s.push("      float dist = 0.0;");for(var i=0;i<t.sectionPlanes.length;i++)s.push("      if (sectionPlaneActive"+i+") {"),s.push("          dist += clamp(dot(-sectionPlaneDir"+i+".xyz, vWorldPosition.xyz - sectionPlanePos"+i+".xyz), 0.0, 1000.0);"),s.push("      }");s.push("      if (dist > 0.0) { discard; }"),s.push("  }")}return s.push("    gl_FragColor = encodeFloat( gl_FragCoord.z); "),s.push("}"),s}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ui=c.vec4(),Xi=c.vec3(),Wi={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};class Yi{constructor(t,e){this._scene=t,this._withSAO=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const t=this._scene;return[t.gammaOutput,t._lightsState.getHash(),t._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(t,e,s){const i=this._scene,r=i.camera,o=e.model,n=i.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,r.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,o.worldNormalMatrix);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const t=i._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,r=o.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const o=r.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,o?1:0),o){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Xi);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal&&this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aMetallicRoughness&&this._aMetallicRoughness.bindArrayBuffer(a.metallicRoughnessBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._lightsState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let t=0,e=r.length;t<e;t++)switch(o=r[t],o.type){case"dir":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=null,this._uLightDir[t]=i.getLocation("lightDir"+t);break;case"point":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=null,this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t);break;case"spot":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=i.getLocation("lightDir"+t),this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t)}s.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),s.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aMetallicRoughness=i.getAttribute("metallicRoughness"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._withSAO&&(this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams")),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=pt.MAX_TEXTURE_UNITS,s=this._scene,i=s.canvas.gl,r=this._program,o=s._lightsState,n=o.lights,a=s.camera.project;r.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,a.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,s._lightsState.getAmbientColorAndIntensity());for(let t=0,e=n.length;t<e;t++){const e=n[t];this._uLightColor[t]&&i.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(i.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&i.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&i.uniform3fv(this._uLightDir[t],e.dir)}if(o.reflectionMaps.length>0&&o.reflectionMaps[0].texture&&this._uReflectionMap&&(r.bindTexture(this._uReflectionMap,o.reflectionMaps[0].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++),o.lightMaps.length>0&&o.lightMaps[0].texture&&this._uLightMap&&(r.bindTexture(this._uLightMap,o.lightMaps[0].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++),this._withSAO){const r=s.sao;if(r.possible){const s=i.drawingBufferWidth,o=i.drawingBufferHeight;Ui[0]=s,Ui[1]=o,Ui[2]=r.blendCutoff,Ui[3]=r.blendFactor,i.uniform4fv(this._uSAOParams,Ui),this._program.bindTexture(this._uOcclusionTexture,t.occlusionTexture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++}}if(s.logarithmicDepthBufferEnabled){const t=2/(Math.log(a.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,t)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState,s=t._lightsState,i=e.sectionPlanes.length>0,r=e.clippingCaps,o=[];return o.push("// Triangles batching quality draw vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec3 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec2 metallicRoughness;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("varying vec4 vViewPosition;"),o.push("varying vec3 vViewNormal;"),o.push("varying vec4 vColor;"),o.push("varying vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("varying vec3 vWorldNormal;"),i&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),r&&o.push("varying vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&o.push("worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 worldNormal =  worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),o.push("vec3 viewNormal = normalize((viewNormalMatrix * worldNormal).xyz);"),o.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;"))),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vMetallicRoughness = metallicRoughness;"),s.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const t=this._scene,e=t.gammaOutput,s=t._sectionPlanesState,i=t._lightsState,r=s.sectionPlanes.length>0,o=s.clippingCaps,n=[];n.push("// Triangles batching quality draw fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(n.push("varying float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("varying float vFragDepth;")),n.push("varying vec4 vViewPosition;"),n.push("varying vec3 vViewNormal;"),n.push("varying vec4 vColor;"),n.push("varying vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("varying vec3 vWorldNormal;"),n.push("uniform mat4 viewMatrix;"),i.reflectionMaps.length>0&&n.push("uniform samplerCube reflectionMap;"),i.lightMaps.length>0&&n.push("uniform samplerCube lightMap;"),n.push("uniform vec4 lightAmbient;");for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];"ambient"!==e.type&&(n.push("uniform vec4 lightColor"+t+";"),"dir"===e.type&&n.push("uniform vec3 lightDir"+t+";"),"point"===e.type&&n.push("uniform vec3 lightPos"+t+";"),"spot"===e.type&&(n.push("uniform vec3 lightPos"+t+";"),n.push("uniform vec3 lightDir"+t+";")))}if(this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBAToDepth( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),n.push("uniform float gammaFactor;"),n.push("vec4 linearToLinear( in vec4 value ) {"),n.push("  return value;"),n.push("}"),n.push("vec4 sRGBToLinear( in vec4 value ) {"),n.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),n.push("}"),n.push("vec4 gammaToLinear( in vec4 value) {"),n.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),n.push("}"),e&&(n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}")),r){n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;"),o&&n.push("varying vec4 vClipPosition;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)n.push("uniform bool sectionPlaneActive"+t+";"),n.push("uniform vec3 sectionPlanePos"+t+";"),n.push("uniform vec3 sectionPlaneDir"+t+";")}if(n.push("#define PI 3.14159265359"),n.push("#define RECIPROCAL_PI 0.31830988618"),n.push("#define RECIPROCAL_PI2 0.15915494"),n.push("#define EPSILON 1e-6"),n.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),n.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),n.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),n.push("}"),n.push("struct IncidentLight {"),n.push("   vec3 color;"),n.push("   vec3 direction;"),n.push("};"),n.push("struct ReflectedLight {"),n.push("   vec3 diffuse;"),n.push("   vec3 specular;"),n.push("};"),n.push("struct Geometry {"),n.push("   vec3 position;"),n.push("   vec3 viewNormal;"),n.push("   vec3 worldNormal;"),n.push("   vec3 viewEyeDir;"),n.push("};"),n.push("struct Material {"),n.push("   vec3    diffuseColor;"),n.push("   float   specularRoughness;"),n.push("   vec3    specularColor;"),n.push("   float   shine;"),n.push("};"),n.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),n.push("   float r = ggxRoughness + 0.0001;"),n.push("   return (2.0 / (r * r) - 2.0);"),n.push("}"),n.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),n.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),n.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),n.push("}"),i.reflectionMaps.length>0&&(n.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),n.push("   vec3 envMapColor = "+Wi[i.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),n.push("  return envMapColor;"),n.push("}")),n.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),n.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),n.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),n.push("}"),n.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   return 1.0 / ( gl * gv );"),n.push("}"),n.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   return 0.5 / max( gv + gl, EPSILON );"),n.push("}"),n.push("float D_GGX(const in float alpha, const in float dotNH) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),n.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float alpha = ( roughness * roughness );"),n.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),n.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),n.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),n.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),n.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),n.push("   vec3  F = F_Schlick( specularColor, dotLH );"),n.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),n.push("   float D = D_GGX( alpha, dotNH );"),n.push("   return F * (G * D);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),n.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),n.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),n.push("   vec4 r = roughness * c0 + c1;"),n.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),n.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),n.push("   return specularColor * AB.x + AB.y;"),n.push("}"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&(n.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),i.lightMaps.length>0&&(n.push("   vec3 irradiance = "+Wi[i.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),n.push("   irradiance *= PI;"),n.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.diffuse +=  irradiance * diffuseBRDFContrib;")),i.reflectionMaps.length>0&&(n.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),n.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),n.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),n.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),n.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),n.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),n.push("}")),n.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),n.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),n.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),n.push("}"),n.push("void main(void) {"),r){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)n.push("if (sectionPlaneActive"+t+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),n.push("}");o?(n.push("  if (dist > (0.002 * vClipPosition.w)) {"),n.push("      discard;"),n.push("  }"),n.push("  if (dist > 0.0) { "),n.push("      gl_FragColor=vec4(1.0, 0.0, 0.0, 1.0);"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("  gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("  return;"),n.push("}")):(n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }")),n.push("}")}n.push("IncidentLight  light;"),n.push("Material       material;"),n.push("Geometry       geometry;"),n.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),n.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),n.push("float alpha = float(vColor.a) / 255.0;"),n.push("vec3  diffuseColor = rgb;"),n.push("float specularF0 = 1.0;"),n.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),n.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),n.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),n.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),n.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),n.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);"),n.push("geometry.position      = vViewPosition.xyz;"),n.push("geometry.viewNormal    = -normalize(vViewNormal);"),n.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),i.lightMaps.length>0&&n.push("geometry.worldNormal   = normalize(vWorldNormal);"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&n.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?n.push("light.direction =  normalize(lightDir"+t+");"):n.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?n.push("light.direction =  normalize(lightPos"+t+" - vViewPosition.xyz);"):n.push("light.direction =  normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?n.push("light.direction =  normalize(lightDir"+t+");"):n.push("light.direction =  normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}n.push("light.color =  lightColor"+t+".rgb * lightColor"+t+".a;"),n.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return n.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular);"),n.push("vec4 fragColor;"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),n.push("   fragColor               = vec4(outgoingLight.rgb * ambient, alpha);")):n.push("   fragColor            = vec4(outgoingLight.rgb, alpha);"),e&&n.push("fragColor = linearToGamma(fragColor, gammaFactor);"),n.push("gl_FragColor = fragColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ki=c.vec3();class Zi{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;this._program||this._allocate(e),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,t.pickInvisible),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const l=t.pickViewMatrix||o.viewMatrix,u=h?U(l,h):l;if(n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e],r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Ki);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles batching pick flat normals vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("varying vec4 vWorldPosition;"),e&&s.push("varying vec4 vFlags2;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("  } else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("      vWorldPosition = worldPosition;"),e&&s.push("      vFlags2 = flags2;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("  }"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Triangles batching pick flat normals fragment shader"),i.push("#extension GL_OES_standard_derivatives : enable"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),i.push("varying vec4 vWorldPosition;"),s){i.push("varying vec4 vFlags2;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),i.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),i.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),i.push("  gl_FragColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class qi{constructor(t){this._scene=t}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorQualityRenderer&&!this._colorQualityRenderer.getValid()&&(this._colorQualityRenderer.destroy(),this._colorQualityRenderer=null),this._colorQualityRendererWithSAO&&!this._colorQualityRendererWithSAO.getValid()&&(this._colorQualityRendererWithSAO.destroy(),this._colorQualityRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!1===this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new yi(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new yi(this._scene,!0)),this._colorRendererWithSAO}get flatColorRenderer(){return this._flatColorRenderer||(this._flatColorRenderer=new Pi(this._scene,!1)),this._flatColorRenderer}get flatColorRendererWithSAO(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new Pi(this._scene,!0)),this._flatColorRendererWithSAO}get colorQualityRenderer(){return this._colorQualityRenderer||(this._colorQualityRenderer=new Yi(this._scene,!1)),this._colorQualityRenderer}get colorQualityRendererWithSAO(){return this._colorQualityRendererWithSAO||(this._colorQualityRendererWithSAO=new Yi(this._scene,!0)),this._colorQualityRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new xi(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new ji(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new Hi(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new Ei(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new Si(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new Ci(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new Li(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new Zi(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Oi(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new Bi(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new zi(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorQualityRenderer&&this._colorQualityRenderer.destroy(),this._colorQualityRendererWithSAO&&this._colorQualityRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const $i={};const Qi=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint;class Ji{constructor(t=5e6){Qi?t>5e6&&(t=5e6):t>65530&&(t=65530),this.maxVerts=t,this.maxIndices=3*t,this.positions=[],this.colors=[],this.metallicRoughness=[],this.normals=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[],this.edgeIndices=[]}}const tr=c.mat4(),er=c.mat4();function sr(t,e,s){const i=t.length,r=new Uint16Array(i),o=e[0],n=e[1],a=e[2],h=e[3]-o,l=e[4]-n,u=e[5]-a,p=65525,d=p/h,m=p/l,f=p/u,g=t=>t>=0?t:0;for(let e=0;e<i;e+=3)r[e+0]=Math.floor(g(t[e+0]-o)*d),r[e+1]=Math.floor(g(t[e+1]-n)*m),r[e+2]=Math.floor(g(t[e+2]-a)*f);return c.identityMat4(tr),c.translationMat4v(e,tr),c.identityMat4(er),c.scalingMat4v([h/p,l/p,u/p],er),c.mulMat4(tr,er,s),r}function ir(t,e,s){let i=t[0]/(Math.abs(t[0])+Math.abs(t[1])+Math.abs(t[2])),r=t[1]/(Math.abs(t[0])+Math.abs(t[1])+Math.abs(t[2]));if(t[2]<0){let t=i,e=r;t=(1-Math.abs(r))*(i>=0?1:-1),e=(1-Math.abs(i))*(r>=0?1:-1),i=t,r=e}return new Int8Array([Math[e](127.5*i+(i<0?-1:0)),Math[s](127.5*r+(r<0?-1:0))])}function rr(t,e,s,i){let r=t[e]/(Math.abs(t[e])+Math.abs(t[e+1])+Math.abs(t[e+2])),o=t[e+1]/(Math.abs(t[e])+Math.abs(t[e+1])+Math.abs(t[e+2]));if(t[e+2]<0){let t=(1-Math.abs(o))*(r>=0?1:-1),e=(1-Math.abs(r))*(o>=0?1:-1);r=t,o=e}return new Int8Array([Math[s](127.5*r+(r<0?-1:0)),Math[i](127.5*o+(o<0?-1:0))])}function or(t){let e=t[0],s=t[1];e/=e<0?127:128,s/=s<0?127:128;const i=1-Math.abs(e)-Math.abs(s);i<0&&(e=(1-Math.abs(s))*(e>=0?1:-1),s=(1-Math.abs(e))*(s>=0?1:-1));const r=Math.sqrt(e*e+s*s+i*i);return[e/r,s/r,i/r]}function nr(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}const ar=c.mat4(),hr=c.mat4(),lr=c.vec4([0,0,0,1]),ur=c.vec4([0,0,0,1]),pr=c.vec4([0,0,0,1]),cr=c.OBB3(),dr=c.vec3(),mr=c.vec3(),fr=c.vec3(),gr=c.vec3(),_r=c.vec3(),yr=c.vec3(),vr=c.vec3();class br{constructor(t,e){this.sortId="TrianglesBatchingLayer"+(e.solid?"-solid":"-surface")+(e.autoNormals?"-autonormals":"-normals"),this.layerIndex=e.layerIndex,this._batchingRenderers=function(t){const e=t.id;let s=$i[e];return s||(s=new qi(t),$i[e]=s,s._compile(),t.on("compile",(()=>{s._compile()})),t.on("destroyed",(()=>{delete $i[e],s._destroy()}))),s}(t.scene),this.model=t,this._buffer=new Ji(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new zt({positionsBuf:null,offsetsBuf:null,normalsBuf:null,colorsBuf:null,metallicRoughnessBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,edgeIndicesBuf:null,positionsDecodeMatrix:c.mat4()}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=c.collapseAABB3(),this._portions=[],this._finalized=!1,e.positionsDecodeMatrix?(this._state.positionsDecodeMatrix.set(e.positionsDecodeMatrix),this._preCompressed=!0):this._preCompressed=!1,e.origin&&(this._state.origin=c.vec3(e.origin)),this.aabb=c.collapseAABB3(),this.solid=!!e.solid}canCreatePortion(t,e){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+t<3*this._buffer.maxVerts&&this._buffer.indices.length+e<this._buffer.maxIndices}createPortion(t){if(this._finalized)throw"Already finalized";const e=t.positions,s=t.normals,i=t.indices,r=t.edgeIndices,o=t.color,n=t.metallic,a=t.roughness,h=t.colors,l=t.opacity,u=t.meshMatrix,p=t.worldMatrix,d=t.worldAABB,m=t.pickColor,f=this.model.scene,g=this._buffer,_=g.positions.length/3,y=e.length/3,v=e.length;if(this._preCompressed){for(let t=0,s=e.length;t<s;t++)g.positions.push(e[t]);const t=ve.getPositionsBounds(e),s=ve.decompressPosition(t.min,this._state.positionsDecodeMatrix,[]),i=ve.decompressPosition(t.max,this._state.positionsDecodeMatrix,[]);d[0]=s[0],d[1]=s[1],d[2]=s[2],d[3]=i[0],d[4]=i[1],d[5]=i[2],p&&(c.AABB3ToOBB3(d,cr),c.transformOBB3(p,cr),c.OBB3ToAABB3(cr,d))}else{const t=g.positions.length;for(let t=0,s=e.length;t<s;t++)g.positions.push(e[t]);if(u)for(let e=t,s=t+v;e<s;e+=3)lr[0]=g.positions[e+0],lr[1]=g.positions[e+1],lr[2]=g.positions[e+2],c.transformPoint4(u,lr,ur),g.positions[e+0]=ur[0],g.positions[e+1]=ur[1],g.positions[e+2]=ur[2],c.expandAABB3Point3(this._modelAABB,ur),p?(c.transformPoint4(p,ur,pr),c.expandAABB3Point3(d,pr)):c.expandAABB3Point3(d,ur);else for(let e=t,s=t+v;e<s;e+=3)lr[0]=g.positions[e+0],lr[1]=g.positions[e+1],lr[2]=g.positions[e+2],c.expandAABB3Point3(this._modelAABB,lr),p?(c.transformPoint4(p,lr,ur),c.expandAABB3Point3(d,ur)):c.expandAABB3Point3(d,lr)}if(this._state.origin){const t=this._state.origin;d[0]+=t[0],d[1]+=t[1],d[2]+=t[2],d[3]+=t[0],d[4]+=t[1],d[5]+=t[2]}if(c.expandAABB3(this.aabb,d),s&&s.length>0)if(this._preCompressed)for(let t=0,e=s.length;t<e;t++)g.normals.push(s[t]);else{const t=ar;u?c.inverseMat4(c.transposeMat4(u,hr),t):c.identityMat4(t,t),function(t,e,s,i,r){let o,n,a,h,l,u,p=new Float32Array([0,0,0,0]),d=new Float32Array([0,0,0,0]);for(u=0;u<s;u+=3)p[0]=e[u],p[1]=e[u+1],p[2]=e[u+2],c.transformVec3(t,p,d),c.normalizeVec3(d,d),a=o=ir(d,"floor","floor"),n=or(o),h=l=nr(d,n),o=ir(d,"ceil","floor"),n=or(o),h=nr(d,n),h>l&&(a=o,l=h),o=ir(d,"floor","ceil"),n=or(o),h=nr(d,n),h>l&&(a=o,l=h),o=ir(d,"ceil","ceil"),n=or(o),h=nr(d,n),h>l&&(a=o,l=h),i[r+u+0]=a[0],i[r+u+1]=a[1],i[r+u+2]=0}(t,s,s.length,g.normals,g.normals.length)}if(h)for(let t=0,e=h.length;t<e;t+=3)g.colors.push(255*h[t]),g.colors.push(255*h[t+1]),g.colors.push(255*h[t+2]),g.colors.push(255);else if(o){const t=o[0],e=o[1],s=o[2],i=l,r=null!=n?n:0,h=null!=a?a:255;for(let o=0;o<y;o++)g.colors.push(t),g.colors.push(e),g.colors.push(s),g.colors.push(i),g.metallicRoughness.push(r),g.metallicRoughness.push(h)}if(i)for(let t=0,e=i.length;t<e;t++)g.indices.push(i[t]+_);if(r)for(let t=0,e=r.length;t<e;t++)g.edgeIndices.push(r[t]+_);{const t=g.pickColors.length;for(let e=t,s=t+4*y;e<s;e+=4)g.pickColors.push(m[0]),g.pickColors.push(m[1]),g.pickColors.push(m[2]),g.pickColors.push(m[3])}if(f.entityOffsetsEnabled)for(let t=0;t<y;t++)g.offsets.push(0),g.offsets.push(0),g.offsets.push(0);const b=this._portions.length,P={vertsBase:_,numVerts:y};return f.pickSurfacePrecisionEnabled&&(i&&(P.indices=i),f.entityOffsetsEnabled&&(P.offset=new Float32Array(3))),this._portions.push(P),this._numPortions++,this.model.numPortions++,b}finalize(){if(this._finalized)return void this.model.error("Already finalized");const t=this._state,e=this.model.scene.canvas.gl,s=this._buffer;if(s.positions.length>0){const i=this._preCompressed?new Uint16Array(s.positions):sr(s.positions,this._modelAABB,t.positionsDecodeMatrix);if(t.positionsBuf=new Dt(e,e.ARRAY_BUFFER,i,i.length,3,e.STATIC_DRAW),this.model.scene.pickSurfacePrecisionEnabled)for(let t=0,e=this._portions.length;t<e;t++){const e=this._portions[t],s=3*e.vertsBase,r=s+3*e.numVerts;e.quantizedPositions=i.slice(s,r)}}if(s.normals.length>0){const i=new Int8Array(s.normals);let r=!0;t.normalsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.normals.length,3,e.STATIC_DRAW,r)}if(s.colors.length>0){const i=new Uint8Array(s.colors);let r=!1;t.colorsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.colors.length,4,e.DYNAMIC_DRAW,r)}if(s.metallicRoughness.length>0){const i=new Uint8Array(s.metallicRoughness);let r=!1;t.metallicRoughnessBuf=new Dt(e,e.ARRAY_BUFFER,i,s.metallicRoughness.length,2,e.STATIC_DRAW,r)}if(s.positions.length>0){const i=s.positions.length/3*4,r=new Uint8Array(i),o=new Uint8Array(i);let n=!1,a=!0;t.flagsBuf=new Dt(e,e.ARRAY_BUFFER,r,r.length,4,e.DYNAMIC_DRAW,n),t.flags2Buf=new Dt(e,e.ARRAY_BUFFER,o,o.length,4,e.DYNAMIC_DRAW,a)}if(s.pickColors.length>0){const i=new Uint8Array(s.pickColors);let r=!1;t.pickColorsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.pickColors.length,4,e.STATIC_DRAW,r)}if(this.model.scene.entityOffsetsEnabled&&s.offsets.length>0){const i=new Float32Array(s.offsets);t.offsetsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.offsets.length,3,e.DYNAMIC_DRAW)}const i=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint;if(s.indices.length>0){const r=i?new Uint32Array(s.indices):new Uint16Array(s.indices);t.indicesBuf=new Dt(e,e.ELEMENT_ARRAY_BUFFER,r,s.indices.length,1,e.STATIC_DRAW)}if(s.edgeIndices.length>0){const r=i?new Uint32Array(s.edgeIndices):new Uint16Array(s.edgeIndices);t.edgeIndicesBuf=new Dt(e,e.ELEMENT_ARRAY_BUFFER,r,s.edgeIndices.length,1,e.STATIC_DRAW)}this._buffer=null,this._finalized=!0}isEmpty(){return!this._state.indicesBuf}initFlags(t,e,s){e&C&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),e&B&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),e&N&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),e&k&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),e&R&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),e&j&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),e&O&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),e&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(t,e,s),this._setFlags2(t,e)}setVisible(t,e,s){if(!this._finalized)throw"Not finalized";e&C?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(t,e,s)}setHighlighted(t,e,s){if(!this._finalized)throw"Not finalized";e&B?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(t,e,s)}setXRayed(t,e,s){if(!this._finalized)throw"Not finalized";e&N?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(t,e,s)}setSelected(t,e,s){if(!this._finalized)throw"Not finalized";e&k?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(t,e,s)}setEdges(t,e,s){if(!this._finalized)throw"Not finalized";e&j?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(t,e,s)}setClippable(t,e){if(!this._finalized)throw"Not finalized";e&R?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(t,e)}setCulled(t,e,s){if(!this._finalized)throw"Not finalized";e&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(t,e,s)}setCollidable(t,e){if(!this._finalized)throw"Not finalized"}setPickable(t,e,s){if(!this._finalized)throw"Not finalized";e&O?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(t,e,s)}setColor(t,e){if(!this._finalized)throw"Not finalized";const s=t,i=this._portions[s],r=4*i.vertsBase,o=4*i.numVerts,n=this._scratchMemory.getUInt8Array(o),a=e[0],h=e[1],l=e[2],u=e[3];for(let t=0;t<o;t+=4)n[t+0]=a,n[t+1]=h,n[t+2]=l,n[t+3]=u;this._state.colorsBuf&&this._state.colorsBuf.setData(n,r,o)}setTransparent(t,e,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(t,e,s)}_setFlags(t,e,s){if(!this._finalized)throw"Not finalized";const i=t,r=this._portions[i],o=4*r.vertsBase,n=4*r.numVerts,a=this._scratchMemory.getUInt8Array(n),h=!!(e&C),l=!!(e&N),u=!!(e&B),p=!!(e&k),c=!!(e&F);let d,m;d=!h||c||l?ri:s?ni:oi,m=!h||c?ri:p?hi:u?ai:l?li:ri;let f=0;f=!h||c?ri:p?di:u?ci:l?mi:!!(e&j)?s?pi:ui:ri;let g=h&&!c&&!!(e&O)?fi:ri;for(let t=0;t<n;t+=4)a[t+0]=d,a[t+1]=m,a[t+2]=f,a[t+3]=g;this._state.flagsBuf&&this._state.flagsBuf.setData(a,o,n)}_setFlags2(t,e){if(!this._finalized)throw"Not finalized";const s=t,i=this._portions[s],r=4*i.vertsBase,o=4*i.numVerts,n=this._scratchMemory.getUInt8Array(o),a=e&R?255:0;for(let t=0;t<o;t+=4)n[t+0]=a;this._state.flags2Buf&&this._state.flags2Buf.setData(n,r,o)}setOffset(t,e){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const s=t,i=this._portions[s],r=3*i.vertsBase,o=3*i.numVerts,n=this._scratchMemory.getFloat32Array(o),a=e[0],h=e[1],l=e[2];for(let t=0;t<o;t+=3)n[t+0]=a,n[t+1]=h,n[t+2]=l;this._state.offsetsBuf&&this._state.offsetsBuf.setData(n,r,o),this.model.scene.pickSurfacePrecisionEnabled&&(i.offset[0]=e[0],i.offset[1]=e[1],i.offset[2]=e[2])}drawColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),e.withSAO&&this.model.saoEnabled?e.pbrEnabled&&this.model.pbrEnabled&&this._state.normalsBuf?this._batchingRenderers.colorQualityRendererWithSAO&&this._batchingRenderers.colorQualityRendererWithSAO.drawLayer(e,this,oi):this._state.normalsBuf?this._batchingRenderers.colorRendererWithSAO&&this._batchingRenderers.colorRendererWithSAO.drawLayer(e,this,oi):this._batchingRenderers.flatColorRendererWithSAO&&this._batchingRenderers.flatColorRendererWithSAO.drawLayer(e,this,oi):e.pbrEnabled&&this.model.pbrEnabled&&this._state.normalsBuf?this._batchingRenderers.colorQualityRenderer&&this._batchingRenderers.colorQualityRenderer.drawLayer(e,this,oi):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(e,this,oi):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(e,this,oi))}_updateBackfaceCull(t,e){const s=this.model.backfaces||!this.solid||t.sectioned;if(e.backfaces!==s){const t=e.gl;s?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),e.backfaces=s}}drawColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),e.pbrEnabled&&this.model.pbrEnabled&&this._state.normalsBuf?this._batchingRenderers.colorQualityRenderer&&this._batchingRenderers.colorQualityRenderer.drawLayer(e,this,ni):this._state.normalsBuf?this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(e,this,ni):this._batchingRenderers.flatColorRenderer&&this._batchingRenderers.flatColorRenderer.drawLayer(e,this,ni))}drawDepth(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.depthRenderer&&this._batchingRenderers.depthRenderer.drawLayer(e,this,oi))}drawNormals(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.normalsRenderer&&this._batchingRenderers.normalsRenderer.drawLayer(e,this,oi))}drawSilhouetteXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(e,this,li))}drawSilhouetteHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(e,this,ai))}drawSilhouetteSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(e,this,hi))}drawEdgesColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(e,this,ui)}drawEdgesColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&0!==this._numTransparentLayerPortions&&this._batchingRenderers.edgesColorRenderer&&this._batchingRenderers.edgesColorRenderer.drawLayer(e,this,pi)}drawEdgesHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(e,this,ci)}drawEdgesSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(e,this,di)}drawEdgesXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.edgesRenderer&&this._batchingRenderers.edgesRenderer.drawLayer(e,this,mi)}drawOcclusion(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.occlusionRenderer&&this._batchingRenderers.occlusionRenderer.drawLayer(e,this,oi))}drawShadow(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.shadowRenderer&&this._batchingRenderers.shadowRenderer.drawLayer(e,this,oi))}drawPickMesh(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.pickMeshRenderer&&this._batchingRenderers.pickMeshRenderer.drawLayer(e,this,fi))}drawPickDepths(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._batchingRenderers.pickDepthRenderer&&this._batchingRenderers.pickDepthRenderer.drawLayer(e,this,fi))}drawPickNormals(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._state.normalsBuf?this._batchingRenderers.pickNormalsRenderer&&this._batchingRenderers.pickNormalsRenderer.drawLayer(e,this,fi):this._batchingRenderers.pickNormalsFlatRenderer&&this._batchingRenderers.pickNormalsFlatRenderer.drawLayer(e,this,fi))}precisionRayPickSurface(t,e,s,i,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state,n=this._portions[t];if(!n)return this.model.error("portion not found: "+t),!1;const a=n.quantizedPositions,h=n.indices,l=o.origin,u=n.offset,p=dr,d=mr;p.set(l?c.subVec3(e,l,fr):e),d.set(s),u&&c.subVec3(p,u),c.transformRay(this.model.worldNormalMatrix,p,d,p,d);const m=gr,f=_r,g=yr;let _=!1,y=0;const v=vr;for(let t=0,s=h.length;t<s;t+=3){const s=3*h[t],n=3*h[t+1],b=3*h[t+2];if(m[0]=a[s],m[1]=a[s+1],m[2]=a[s+2],f[0]=a[n],f[1]=a[n+1],f[2]=a[n+2],g[0]=a[b],g[1]=a[b+1],g[2]=a[b+2],c.decompressPosition(m,o.positionsDecodeMatrix),c.decompressPosition(f,o.positionsDecodeMatrix),c.decompressPosition(g,o.positionsDecodeMatrix),c.rayTriangleIntersect(p,d,m,f,g,v)){c.transformPoint3(this.model.worldMatrix,v,v),u&&c.addVec3(v,u),l&&c.addVec3(v,l);const t=Math.abs(c.lenVec3(c.subVec3(v,e,[])));(!_||t>y)&&(y=t,i.set(v),r&&c.triangleNormal(m,f,g,r),_=!0)}}return _&&r&&(c.transformVec3(this.model.worldNormalMatrix,r,r),c.normalizeVec3(r)),_}destroy(){const t=this._state;t.positionsBuf&&(t.positionsBuf.destroy(),t.positionsBuf=null),t.offsetsBuf&&(t.offsetsBuf.destroy(),t.offsetsBuf=null),t.normalsBuf&&(t.normalsBuf.destroy(),t.normalsBuf=null),t.colorsBuf&&(t.colorsBuf.destroy(),t.colorsBuf=null),t.metallicRoughnessBuf&&(t.metallicRoughnessBuf.destroy(),t.metallicRoughnessBuf=null),t.flagsBuf&&(t.flagsBuf.destroy(),t.flagsBuf=null),t.flags2Buf&&(t.flags2Buf.destroy(),t.flags2Buf=null),t.pickColorsBuf&&(t.pickColorsBuf.destroy(),t.pickColorsBuf=null),t.indicesBuf&&(t.indicesBuf.destroy(),t.indicessBuf=null),t.edgeIndicesBuf&&(t.edgeIndicesBuf.destroy(),t.edgeIndicessBuf=null),t.destroy()}}const Pr=c.vec4(),Tr=c.vec3();class wr{constructor(t,e){this._scene=t,this._withSAO=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const t=this._scene;return[t._lightsState.getHash(),t._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Tr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._lightsState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let t=0,e=r.length;t<e;t++)switch(o=r[t],o.type){case"dir":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=null,this._uLightDir[t]=i.getLocation("lightDir"+t);break;case"point":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=null,this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t);break;case"spot":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=i.getLocation("lightDir"+t),this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t)}this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=i.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=i.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=i.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene,s=e.canvas.gl,i=e._lightsState.lights,r=e.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,e._lightsState.getAmbientColorAndIntensity());for(let t=0,e=i.length;t<e;t++){const e=i[t];this._uLightColor[t]&&s.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(s.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&s.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&s.uniform3fv(this._uLightDir[t],e.dir)}if(this._withSAO){const i=e.sao;if(i.possible){const e=s.drawingBufferWidth,r=s.drawingBufferHeight;Pr[0]=e,Pr[1]=r,Pr[2]=i.blendCutoff,Pr[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,Pr),this._program.bindTexture(this._uOcclusionTexture,t.occlusionTexture,0)}}if(e.logarithmicDepthBufferEnabled){const t=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState,s=t._lightsState,i=e.sectionPlanes.length>0;let r,o,n;const a=[];for(a.push("// Instancing geometry drawing vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("#extension GL_EXT_frag_depth : enable"),a.push("uniform int renderPass;"),a.push("attribute vec3 position;"),a.push("attribute vec2 normal;"),a.push("attribute vec4 color;"),a.push("attribute vec4 flags;"),a.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&a.push("attribute vec3 offset;"),a.push("attribute vec4 modelMatrixCol0;"),a.push("attribute vec4 modelMatrixCol1;"),a.push("attribute vec4 modelMatrixCol2;"),a.push("attribute vec4 modelNormalMatrixCol0;"),a.push("attribute vec4 modelNormalMatrixCol1;"),a.push("attribute vec4 modelNormalMatrixCol2;"),a.push("uniform mat4 worldMatrix;"),a.push("uniform mat4 worldNormalMatrix;"),a.push("uniform mat4 viewMatrix;"),a.push("uniform mat4 viewNormalMatrix;"),a.push("uniform mat4 projMatrix;"),a.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(a.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&a.push("varying float vFragDepth;"),a.push("bool isPerspectiveMatrix(mat4 m) {"),a.push("    return (m[2][3] == - 1.0);"),a.push("}"),a.push("varying float isPerspective;")),a.push("uniform vec4 lightAmbient;"),r=0,o=s.lights.length;r<o;r++)n=s.lights[r],"ambient"!==n.type&&(a.push("uniform vec4 lightColor"+r+";"),"dir"===n.type&&a.push("uniform vec3 lightDir"+r+";"),"point"===n.type&&a.push("uniform vec3 lightPos"+r+";"),"spot"===n.type&&(a.push("uniform vec3 lightPos"+r+";"),a.push("uniform vec3 lightDir"+r+";")));for(a.push("vec3 octDecode(vec2 oct) {"),a.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),a.push("    if (v.z < 0.0) {"),a.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),a.push("    }"),a.push("    return normalize(v);"),a.push("}"),i&&(a.push("varying vec4 vWorldPosition;"),a.push("varying vec4 vFlags2;")),a.push("varying vec4 vColor;"),a.push("void main(void) {"),a.push("if (int(flags.x) != renderPass) {"),a.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),a.push("} else {"),a.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),a.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&a.push("      worldPosition.xyz = worldPosition.xyz + offset;"),a.push("vec4 viewPosition  = viewMatrix * worldPosition; "),a.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),a.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),a.push("vec3 viewNormal = normalize(vec4(viewNormalMatrix * worldNormal).xyz);"),a.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),a.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),a.push("float lambertian = 1.0;"),r=0,o=s.lights.length;r<o;r++)if(n=s.lights[r],"ambient"!==n.type){if("dir"===n.type)"view"===n.space?a.push("viewLightDir = normalize(lightDir"+r+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);");else if("point"===n.type)"view"===n.space?a.push("viewLightDir = -normalize(lightPos"+r+" - viewPosition.xyz);"):a.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+r+", 0.0)).xyz);");else{if("spot"!==n.type)continue;"view"===n.space?a.push("viewLightDir = normalize(lightDir"+r+");"):a.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+r+", 0.0)).xyz);")}a.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),a.push("reflectedColor += lambertian * (lightColor"+r+".rgb * lightColor"+r+".a);")}return a.push("vec3 rgb = (vec3(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0));"),a.push("vColor =  vec4((lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedColor * rgb), float(color.a) / 255.0);"),a.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?a.push("vFragDepth = 1.0 + clipPos.w;"):(a.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),a.push("clipPos.z *= clipPos.w;")),a.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(a.push("vWorldPosition = worldPosition;"),a.push("vFlags2 = flags2;")),a.push("gl_Position = clipPos;"),a.push("}"),a.push("}"),a}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Instancing geometry drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),this._withSAO&&(i.push("uniform sampler2D uOcclusionTexture;"),i.push("uniform vec4      uSAOParams;"),i.push("const float       packUpscale = 256. / 255.;"),i.push("const float       unpackDownScale = 255. / 256.;"),i.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),i.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),i.push("float unpackRGBToFloat( const in vec4 v ) {"),i.push("    return dot( v, unPackFactors );"),i.push("}")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { "),i.push("      discard;"),i.push("  }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),this._withSAO?(i.push("   float viewportWidth     = uSAOParams[0];"),i.push("   float viewportHeight    = uSAOParams[1];"),i.push("   float blendCutoff       = uSAOParams[2];"),i.push("   float blendFactor       = uSAOParams[3];"),i.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),i.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),i.push("   gl_FragColor            = vec4(vColor.rgb * ambient, 1.0);")):i.push("    gl_FragColor           = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const xr=c.vec4(),Mr=c.vec3();class Dr{constructor(t,e){this._scene=t,this._withSAO=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const t=this._scene;return[t._lightsState.getHash(),t._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e],r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Mr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._lightsState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(let t=0,e=r.length;t<e;t++)switch(o=r[t],o.type){case"dir":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=null,this._uLightDir[t]=i.getLocation("lightDir"+t);break;case"point":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=null,this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t);break;case"spot":this._uLightColor[t]=i.getLocation("lightColor"+t),this._uLightPos[t]=i.getLocation("lightPos"+t),this._uLightDir[t]=i.getLocation("lightDir"+t),this._uLightAttenuation[t]=i.getLocation("lightAttenuation"+t)}this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene,s=e.canvas.gl,i=e._lightsState.lights,r=e.camera.project;this._program.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),this._uLightAmbient&&s.uniform4fv(this._uLightAmbient,e._lightsState.getAmbientColorAndIntensity());for(let t=0,e=i.length;t<e;t++){const e=i[t];this._uLightColor[t]&&s.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(s.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&s.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&s.uniform3fv(this._uLightDir[t],e.dir)}if(this._withSAO){const i=e.sao;if(i.possible){const e=s.drawingBufferWidth,r=s.drawingBufferHeight;xr[0]=e,xr[1]=r,xr[2]=i.blendCutoff,xr[3]=i.blendFactor,s.uniform4fv(this._uSAOParams,xr),this._program.bindTexture(this._uOcclusionTexture,t.occlusionTexture,0)}}if(e.logarithmicDepthBufferEnabled){const t=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry flat-shading drawing vertex shader"),s.push("#extension GL_OES_standard_derivatives : enable"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vViewPosition = viewPosition;"),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=t._lightsState;let i,r;const o=e.sectionPlanes.length>0,n=[];if(n.push("// Instancing geometry flat-shading drawing fragment shader"),n.push("#extension GL_OES_standard_derivatives : enable"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(n.push("varying float isPerspective;"),n.push("uniform float logDepthBufFC;"),n.push("varying float vFragDepth;")),this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBToFloat( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),o){n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)n.push("uniform bool sectionPlaneActive"+t+";"),n.push("uniform vec3 sectionPlanePos"+t+";"),n.push("uniform vec3 sectionPlaneDir"+t+";")}for(n.push("uniform mat4 viewMatrix;"),n.push("uniform vec4 lightAmbient;"),i=0,r=s.lights.length;i<r;i++){const t=s.lights[i];"ambient"!==t.type&&(n.push("uniform vec4 lightColor"+i+";"),"dir"===t.type&&n.push("uniform vec3 lightDir"+i+";"),"point"===t.type&&n.push("uniform vec3 lightPos"+i+";"),"spot"===t.type&&(n.push("uniform vec3 lightPos"+i+";"),n.push("uniform vec3 lightDir"+i+";")))}if(n.push("varying vec4 vViewPosition;"),n.push("varying vec4 vColor;"),n.push("void main(void) {"),o){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)n.push("if (sectionPlaneActive"+t+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),n.push("}");n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }"),n.push("}")}for(n.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),n.push("vec3 viewLightDir = vec3(0.0, 0.0, -1.0);"),n.push("float lambertian = 1.0;"),n.push("vec3 xTangent = dFdx( vViewPosition.xyz );"),n.push("vec3 yTangent = dFdy( vViewPosition.xyz );"),n.push("vec3 viewNormal = normalize( cross( xTangent, yTangent ) );"),i=0,r=s.lights.length;i<r;i++){const t=s.lights[i];if("ambient"!==t.type){if("dir"===t.type)"view"===t.space?n.push("viewLightDir = normalize(lightDir"+i+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+i+", 0.0)).xyz);");else if("point"===t.type)"view"===t.space?n.push("viewLightDir = -normalize(lightPos"+i+" - viewPosition.xyz);"):n.push("viewLightDir = -normalize((viewMatrix * vec4(lightPos"+i+", 0.0)).xyz);");else{if("spot"!==t.type)continue;"view"===t.space?n.push("viewLightDir = normalize(lightDir"+i+");"):n.push("viewLightDir = normalize((viewMatrix * vec4(lightDir"+i+", 0.0)).xyz);")}n.push("lambertian = max(dot(-viewNormal, viewLightDir), 0.0);"),n.push("reflectedColor += lambertian * (lightColor"+i+".rgb * lightColor"+i+".a);")}}return n.push("vec4 fragColor = vec4((lightAmbient.rgb * lightAmbient.a * vColor.rgb) + (reflectedColor * vColor.rgb), vColor.a);"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBToFloat(texture2D(uOcclusionTexture, uv))) * blendFactor;"),n.push("   gl_FragColor            = vec4(fragColor.rgb * ambient, 1.0);")):n.push("    gl_FragColor           = fragColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Er=c.vec3();class Ir{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e.model.scene),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===li){const t=r.xrayMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ai){const t=r.highlightMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===hi){const t=r.selectedMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,c.vec3([1,1,1]));n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Er);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing fill vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("uniform vec4 color;"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Instancing fill fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("uniform vec4 color;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Sr=c.vec3(),Ar=new Float32Array([0,0,0,1]);class Cr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===mi){const t=r.xrayMaterial._state,e=t.edgeColor,s=t.edgeAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ci){const t=r.highlightMaterial._state,e=t.edgeColor,s=t.edgeAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===di){const t=r.selectedMaterial._state,e=t.edgeColor,s=t.edgeAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,Ar);n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Sr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags&&(this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.edgeIndicesBuf.bind(),h.drawElementsInstancedANGLE(n.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0),this._aFlags&&h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uColor=i.getLocation("color"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles instancing edges vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("uniform vec4 color;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(color.r, color.g, color.b, color.a);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry edges drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Fr=c.vec3();class Or{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Fr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags&&(this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1)),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.edgeIndicesBuf.bind(),h.drawElementsInstancedANGLE(n.LINES,a.edgeIndicesBuf.numItems,a.edgeIndicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0),this._aFlags&&h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Triangles instancing edges vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.z) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vColor = vec4(float(color.r*0.5) / 255.0, float(color.g*0.5) / 255.0, float(color.b*0.5) / 255.0, float(color.a) / 255.0);"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry edges drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = vColor;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Rr=c.vec3();class Lr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s);const u=t.pickViewMatrix||o.viewMatrix,p=l?U(u,l):u;if(n.uniformMatrix4fv(this._uViewMatrix,!1,p),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(a.pickColorsBuf),h.vertexAttribDivisorANGLE(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind();const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*c,o=i.renderFlags;for(let e=0;e<c;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Rr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aPickColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._uRenderPass=i.getLocation("renderPass"),this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene.canvas.gl;this._program.bind(),e.uniform1i(this._uPickInvisible,t.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry picking vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 pickColor;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vPickColor;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),e&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry picking fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Nr=c.vec3();class Br{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.canvas.gl,n=e._state,a=this._instanceExt,h=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram());const l=r.camera;o.uniform1i(this._uRenderPass,s),o.uniform1i(this._uPickInvisible,t.pickInvisible);const u=t.pickViewMatrix||l.viewMatrix,p=h?U(u,h):u;if(o.uniformMatrix4fv(this._uViewMatrix,!1,p),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),o.uniform1f(this._uPickZNear,t.pickZNear),o.uniform1f(this._uPickZFar,t.pickZFar),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(t.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,e)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*c,n=i.renderFlags;for(let e=0;e<c;e++){const i=this._uSectionPlanes[e];if(i){const r=n.sectionPlanesActivePerLayer[s+e];if(o.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Nr);o.uniform3fv(i.pos,t)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),a.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),a.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),a.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),a.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),a.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),a.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.indicesBuf.bind(),a.drawElementsInstancedANGLE(o.TRIANGLES,n.indicesBuf.numItems,n.indicesBuf.itemType,0,n.numInstances),a.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),a.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),a.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),a.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vViewPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("  vWorldPosition = worldPosition;"),s.push("  vFlags2 = flags2;")),s.push("  vViewPosition = viewPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry depth fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    gl_FragColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const kr=c.vec3();class jr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,t.pickInvisible);const u=t.pickViewMatrix||o.viewMatrix,p=l?U(u,l):u;if(n.uniformMatrix4fv(this._uViewMatrix,!1,p),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*c,o=i.renderFlags;for(let e=0;e<c;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,kr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=i.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=i.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=i.getAttribute("modelNormalMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry normals vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec2 normal;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("attribute vec4 modelNormalMatrixCol0;"),s.push("attribute vec4 modelNormalMatrixCol1;"),s.push("attribute vec4 modelNormalMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec3 vWorldNormal;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),s.push("  vec3 worldNormal = vec3(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2));"),s.push("  vWorldNormal = worldNormal;"),e&&s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry normals fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec3 vWorldNormal;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("if (sectionPlaneActive"+r+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4((vWorldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Gr=c.vec3();class Hr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Gr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1)),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),this._aColor&&h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing occlusion vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),e&&s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Instancing occlusion fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Vr=c.vec3();class zr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Vr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry depth drawing vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec2 vHighPrecisionZW;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("vHighPrecisionZW = gl_Position.zw;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState;let s,i;const r=e.sectionPlanes.length>0,o=[];if(o.push("// Instancing geometry depth drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("precision highp float;"),o.push("precision highp int;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("varying float isPerspective;"),o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture||(o.push("const float   packUpScale = 256. / 255.;"),o.push("const float   unpackDownscale = 255. / 256.;"),o.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),o.push("const float   shiftRight8 = 1.0 / 256.;"),o.push("vec4 packDepthToRGBA( const in float v ) {"),o.push("    vec4 r = vec4( fract( v * packFactors ), v );"),o.push("    r.yzw -= r.xyz * shiftRight8;"),o.push("    return r * packUpScale;"),o.push("}")),o.push("varying vec2 vHighPrecisionZW;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;"),pt.SUPPORTED_EXTENSIONS.WEBGL_depth_texture?o.push("    gl_FragColor = vec4(vec3(1.0 - fragCoordZ), 1.0); "):o.push("    gl_FragColor = packDepthToRGBA(fragCoordZ); "),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Ur=c.vec3();class Xr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Ur);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2&&(this._aFlags2=i.getAttribute("flags2")),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry normals drawing vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec3 normal;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 worldNormalMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 viewNormalMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),s.push("vec3 octDecode(vec2 oct) {"),s.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),s.push("    if (v.z < 0.0) {"),s.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),s.push("    }"),s.push("    return normalize(v);"),s.push("}"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec3 vViewNormal;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vec4 worldNormal    = worldNormalMatrix * vec4(octDecode(normal.xy), 0.0); "),s.push("  vec3 viewNormal     = normalize((viewNormalMatrix * worldNormal).xyz);"),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("  vViewNormal = viewNormal;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Instancing geometry depth drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Wr=c.vec3();class Yr{constructor(t){this._scene=t,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e){const s=e.model,i=s.scene,r=i.canvas.gl,o=e._state,n=this._instanceExt;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t,e)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),n.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aColor.bindArrayBuffer(o.colorsBuf),n.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(o.flagsBuf),n.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),n.vertexAttribDivisorANGLE(this._aFlags2.location,1));const a=i._sectionPlanesState.sectionPlanes.length;if(a>0){const t=i._sectionPlanesState.sectionPlanes,o=e.layerIndex*a,n=s.renderFlags,h=e._state.origin;for(let e=0;e<a;e++){const s=this._uSectionPlanes[e];if(s){const i=n.sectionPlanesActivePerLayer[o+e];if(r.uniform1i(s.active,i?1:0),i){const i=t[e];if(h){const t=Y(i.dist,i.dir,h,Wr);r.uniform3fv(s.pos,t)}else r.uniform3fv(s.pos,i.pos);r.uniform3fv(s.dir,i.dir)}}}}o.indicesBuf.bind(),n.drawElementsInstancedANGLE(r.TRIANGLES,o.indicesBuf.numItems,o.indicesBuf.itemType,0,o.numInstances),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),n.vertexAttribDivisorANGLE(this._aColor.location,0),n.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2")}_bindProgram(t,e){const s=this._scene.canvas.gl;this._program.bind(),s.uniformMatrix4fv(this._uShadowViewMatrix,!1,t.shadowViewMatrix),s.uniformMatrix4fv(this._uShadowProjMatrix,!1,t.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry shadow drawing vertex shader"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("bool visible      = (float(flags.x) > 0.0);"),s.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),s.push("if (!visible || transparent) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("  gl_Position = shadowProjMatrix * viewPosition;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Instancing geometry depth drawing fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Kr=c.vec4(),Zr=c.vec3(),qr={linear:"linearToLinear",sRGB:"sRGBToLinear",gamma:"gammaToLinear"};class $r{constructor(t,e){this._scene=t,this._withSAO=e,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){const t=this._scene;return[t.gammaOutput,t._lightsState.getHash(),t._sectionPlanesState.getHash(),this._withSAO?"sao":"nosao"].join(";")}drawLayer(t,e,s){const i=e.model,r=this._scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uViewNormalMatrix,!1,o.viewNormalMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uWorldNormalMatrix,!1,i.worldNormalMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Zr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aModelNormalMatrixCol0.bindArrayBuffer(a.modelNormalMatrixCol0Buf),this._aModelNormalMatrixCol1.bindArrayBuffer(a.modelNormalMatrixCol1Buf),this._aModelNormalMatrixCol2.bindArrayBuffer(a.modelNormalMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aNormal.bindArrayBuffer(a.normalsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aMetallicRoughness.bindArrayBuffer(a.metallicRoughnessBuf),h.vertexAttribDivisorANGLE(this._aMetallicRoughness.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelNormalMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aMetallicRoughness.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._lightsState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uWorldNormalMatrix=i.getLocation("worldNormalMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uViewNormalMatrix=i.getLocation("viewNormalMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uGammaFactor=i.getLocation("gammaFactor"),this._uLightAmbient=i.getLocation("lightAmbient"),this._uLightColor=[],this._uLightDir=[],this._uLightPos=[],this._uLightAttenuation=[];const r=s.lights;let o;for(var n=0,a=r.length;n<a;n++)switch(o=r[n],o.type){case"dir":this._uLightColor[n]=i.getLocation("lightColor"+n),this._uLightPos[n]=null,this._uLightDir[n]=i.getLocation("lightDir"+n);break;case"point":this._uLightColor[n]=i.getLocation("lightColor"+n),this._uLightPos[n]=i.getLocation("lightPos"+n),this._uLightDir[n]=null,this._uLightAttenuation[n]=i.getLocation("lightAttenuation"+n);break;case"spot":this._uLightColor[n]=i.getLocation("lightColor"+n),this._uLightPos[n]=i.getLocation("lightPos"+n),this._uLightDir[n]=i.getLocation("lightDir"+n),this._uLightAttenuation[n]=i.getLocation("lightAttenuation"+n)}s.reflectionMaps.length>0&&(this._uReflectionMap="reflectionMap"),s.lightMaps.length>0&&(this._uLightMap="lightMap"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aNormal=i.getAttribute("normal"),this._aColor=i.getAttribute("color"),this._aMetallicRoughness=i.getAttribute("metallicRoughness"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._aModelNormalMatrixCol0=i.getAttribute("modelNormalMatrixCol0"),this._aModelNormalMatrixCol1=i.getAttribute("modelNormalMatrixCol1"),this._aModelNormalMatrixCol2=i.getAttribute("modelNormalMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uSAOParams=i.getLocation("uSAOParams"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=pt.MAX_TEXTURE_UNITS,s=this._scene,i=s.canvas.gl,r=s._lightsState,o=r.lights,n=s.camera.project;this._program.bind(),i.uniformMatrix4fv(this._uProjMatrix,!1,n.matrix),this._uLightAmbient&&i.uniform4fv(this._uLightAmbient,s._lightsState.getAmbientColorAndIntensity());for(let t=0,e=o.length;t<e;t++){const e=o[t];this._uLightColor[t]&&i.uniform4f(this._uLightColor[t],e.color[0],e.color[1],e.color[2],e.intensity),this._uLightPos[t]&&(i.uniform3fv(this._uLightPos[t],e.pos),this._uLightAttenuation[t]&&i.uniform1f(this._uLightAttenuation[t],e.attenuation)),this._uLightDir[t]&&i.uniform3fv(this._uLightDir[t],e.dir)}if(r.reflectionMaps.length>0&&r.reflectionMaps[0].texture&&this._uReflectionMap&&(this._program.bindTexture(this._uReflectionMap,r.reflectionMaps[0].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++),r.lightMaps.length>0&&r.lightMaps[0].texture&&this._uLightMap&&(this._program.bindTexture(this._uLightMap,r.lightMaps[0].texture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++),this._withSAO){const r=s.sao;if(r.possible){const s=i.drawingBufferWidth,o=i.drawingBufferHeight;Kr[0]=s,Kr[1]=o,Kr[2]=r.blendCutoff,Kr[3]=r.blendFactor,i.uniform4fv(this._uSAOParams,Kr),this._program.bindTexture(this._uOcclusionTexture,t.occlusionTexture,t.textureUnit),t.textureUnit=(t.textureUnit+1)%e,t.bindTexture++}}if(s.logarithmicDepthBufferEnabled){const t=2/(Math.log(n.far+1)/Math.LN2);i.uniform1f(this._uLogDepthBufFC,t)}this._uGammaFactor&&i.uniform1f(this._uGammaFactor,s.gammaFactor)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState,s=t._lightsState,i=e.sectionPlanes.length>0,r=e.clippingCaps,o=[];return o.push("// Instancing geometry quality drawing vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("uniform int renderPass;"),o.push("attribute vec3 position;"),o.push("attribute vec2 normal;"),o.push("attribute vec4 color;"),o.push("attribute vec2 metallicRoughness;"),o.push("attribute vec4 flags;"),o.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&o.push("attribute vec3 offset;"),o.push("attribute vec4 modelMatrixCol0;"),o.push("attribute vec4 modelMatrixCol1;"),o.push("attribute vec4 modelMatrixCol2;"),o.push("attribute vec4 modelNormalMatrixCol0;"),o.push("attribute vec4 modelNormalMatrixCol1;"),o.push("attribute vec4 modelNormalMatrixCol2;"),o.push("uniform mat4 worldMatrix;"),o.push("uniform mat4 worldNormalMatrix;"),o.push("uniform mat4 viewMatrix;"),o.push("uniform mat4 viewNormalMatrix;"),o.push("uniform mat4 projMatrix;"),o.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(o.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("varying float vFragDepth;"),o.push("bool isPerspectiveMatrix(mat4 m) {"),o.push("    return (m[2][3] == - 1.0);"),o.push("}"),o.push("varying float isPerspective;")),o.push("vec3 octDecode(vec2 oct) {"),o.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),o.push("    if (v.z < 0.0) {"),o.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),o.push("    }"),o.push("    return normalize(v);"),o.push("}"),o.push("varying vec4 vViewPosition;"),o.push("varying vec3 vViewNormal;"),o.push("varying vec4 vColor;"),o.push("varying vec2 vMetallicRoughness;"),s.lightMaps.length>0&&o.push("varying vec3 vWorldNormal;"),i&&(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),r&&o.push("varying vec4 vClipPosition;")),o.push("void main(void) {"),o.push("if (int(flags.x) != renderPass) {"),o.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),o.push("} else {"),o.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),o.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&o.push("      worldPosition.xyz = worldPosition.xyz + offset;"),o.push("vec4 viewPosition  = viewMatrix * worldPosition; "),o.push("vec4 modelNormal = vec4(octDecode(normal.xy), 0.0); "),o.push("vec4 worldNormal = worldNormalMatrix * vec4(dot(modelNormal, modelNormalMatrixCol0), dot(modelNormal, modelNormalMatrixCol1), dot(modelNormal, modelNormalMatrixCol2), 0.0);"),o.push("vec3 viewNormal = vec4(viewNormalMatrix * worldNormal).xyz;"),o.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?o.push("vFragDepth = 1.0 + clipPos.w;"):(o.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),o.push("clipPos.z *= clipPos.w;")),o.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),i&&(o.push("vWorldPosition = worldPosition;"),o.push("vFlags2 = flags2;"),r&&o.push("vClipPosition = clipPos;")),o.push("vViewPosition = viewPosition;"),o.push("vViewNormal = viewNormal;"),o.push("vColor = color;"),o.push("vMetallicRoughness = metallicRoughness;"),s.lightMaps.length>0&&o.push("vWorldNormal = worldNormal.xyz;"),o.push("gl_Position = clipPos;"),o.push("}"),o.push("}"),o}_buildFragmentShader(){const t=this._scene,e=t.gammaOutput,s=t._sectionPlanesState,i=t._lightsState,r=s.sectionPlanes.length>0,o=s.clippingCaps,n=[];n.push("// Instancing geometry quality drawing fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("#extension GL_EXT_frag_depth : enable"),n.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),n.push("precision highp float;"),n.push("precision highp int;"),n.push("#else"),n.push("precision mediump float;"),n.push("precision mediump int;"),n.push("#endif"),t.logarithmicDepthBufferEnabled&&(n.push("varying float isPerspective;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(n.push("uniform float logDepthBufFC;"),n.push("varying float vFragDepth;"))),this._withSAO&&(n.push("uniform sampler2D uOcclusionTexture;"),n.push("uniform vec4      uSAOParams;"),n.push("const float       packUpscale = 256. / 255.;"),n.push("const float       unpackDownScale = 255. / 256.;"),n.push("const vec3        packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),n.push("const vec4        unPackFactors = unpackDownScale / vec4( packFactors, 1. );"),n.push("float unpackRGBAToDepth( const in vec4 v ) {"),n.push("    return dot( v, unPackFactors );"),n.push("}")),i.reflectionMaps.length>0&&n.push("uniform samplerCube reflectionMap;"),i.lightMaps.length>0&&n.push("uniform samplerCube lightMap;"),n.push("uniform vec4 lightAmbient;");for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];"ambient"!==e.type&&(n.push("uniform vec4 lightColor"+t+";"),"dir"===e.type&&n.push("uniform vec3 lightDir"+t+";"),"point"===e.type&&n.push("uniform vec3 lightPos"+t+";"),"spot"===e.type&&(n.push("uniform vec3 lightPos"+t+";"),n.push("uniform vec3 lightDir"+t+";")))}if(n.push("uniform float gammaFactor;"),n.push("vec4 linearToLinear( in vec4 value ) {"),n.push("  return value;"),n.push("}"),n.push("vec4 sRGBToLinear( in vec4 value ) {"),n.push("  return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );"),n.push("}"),n.push("vec4 gammaToLinear( in vec4 value) {"),n.push("  return vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );"),n.push("}"),e&&(n.push("vec4 linearToGamma( in vec4 value, in float gammaFactor ) {"),n.push("  return vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );"),n.push("}")),r){n.push("varying vec4 vWorldPosition;"),n.push("varying vec4 vFlags2;"),o&&n.push("varying vec4 vClipPosition;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)n.push("uniform bool sectionPlaneActive"+t+";"),n.push("uniform vec3 sectionPlanePos"+t+";"),n.push("uniform vec3 sectionPlaneDir"+t+";")}if(n.push("varying vec4 vViewPosition;"),n.push("varying vec3 vViewNormal;"),n.push("varying vec4 vColor;"),n.push("varying vec2 vMetallicRoughness;"),i.lightMaps.length>0&&n.push("varying vec3 vWorldNormal;"),n.push("uniform mat4 viewMatrix;"),n.push("#define PI 3.14159265359"),n.push("#define RECIPROCAL_PI 0.31830988618"),n.push("#define RECIPROCAL_PI2 0.15915494"),n.push("#define EPSILON 1e-6"),n.push("#define saturate(a) clamp( a, 0.0, 1.0 )"),n.push("vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {"),n.push("   return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );"),n.push("}"),n.push("struct IncidentLight {"),n.push("   vec3 color;"),n.push("   vec3 direction;"),n.push("};"),n.push("struct ReflectedLight {"),n.push("   vec3 diffuse;"),n.push("   vec3 specular;"),n.push("};"),n.push("struct Geometry {"),n.push("   vec3 position;"),n.push("   vec3 viewNormal;"),n.push("   vec3 worldNormal;"),n.push("   vec3 viewEyeDir;"),n.push("};"),n.push("struct Material {"),n.push("   vec3    diffuseColor;"),n.push("   float   specularRoughness;"),n.push("   vec3    specularColor;"),n.push("   float   shine;"),n.push("};"),n.push("float GGXRoughnessToBlinnExponent(const in float ggxRoughness) {"),n.push("   float r = ggxRoughness + 0.0001;"),n.push("   return (2.0 / (r * r) - 2.0);"),n.push("}"),n.push("float getSpecularMIPLevel(const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float maxMIPLevelScalar = float( maxMIPLevel );"),n.push("   float desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( ( blinnShininessExponent * blinnShininessExponent ) + 1.0 );"),n.push("   return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );"),n.push("}"),i.reflectionMaps.length>0&&(n.push("vec3 getLightProbeIndirectRadiance(const in vec3 reflectVec, const in float blinnShininessExponent, const in int maxMIPLevel) {"),n.push("   float mipLevel = 0.5 * getSpecularMIPLevel(blinnShininessExponent, maxMIPLevel);"),n.push("   vec3 envMapColor = "+qr[i.reflectionMaps[0].encoding]+"(textureCube(reflectionMap, reflectVec, mipLevel)).rgb;"),n.push("  return envMapColor;"),n.push("}")),n.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),n.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),n.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),n.push("}"),n.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   return 1.0 / ( gl * gv );"),n.push("}"),n.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),n.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),n.push("   return 0.5 / max( gv + gl, EPSILON );"),n.push("}"),n.push("float D_GGX(const in float alpha, const in float dotNH) {"),n.push("   float a2 = ( alpha * alpha );"),n.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),n.push("   return RECIPROCAL_PI * a2 / ( denom * denom);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX(const in IncidentLight incidentLight, const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float alpha = ( roughness * roughness );"),n.push("   vec3 halfDir = normalize( incidentLight.direction + geometry.viewEyeDir );"),n.push("   float dotNL = saturate( dot( geometry.viewNormal, incidentLight.direction ) );"),n.push("   float dotNV = saturate( dot( geometry.viewNormal, geometry.viewEyeDir ) );"),n.push("   float dotNH = saturate( dot( geometry.viewNormal, halfDir ) );"),n.push("   float dotLH = saturate( dot( incidentLight.direction, halfDir ) );"),n.push("   vec3  F = F_Schlick( specularColor, dotLH );"),n.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),n.push("   float D = D_GGX( alpha, dotNH );"),n.push("   return F * (G * D);"),n.push("}"),n.push("vec3 BRDF_Specular_GGX_Environment(const in Geometry geometry, const in vec3 specularColor, const in float roughness) {"),n.push("   float dotNV = saturate(dot(geometry.viewNormal, geometry.viewEyeDir));"),n.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),n.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),n.push("   vec4 r = roughness * c0 + c1;"),n.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),n.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),n.push("   return specularColor * AB.x + AB.y;"),n.push("}"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&(n.push("void computePBRLightMapping(const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),i.lightMaps.length>0&&(n.push("   vec3 irradiance = "+qr[i.lightMaps[0].encoding]+"(textureCube(lightMap, geometry.worldNormal)).rgb;"),n.push("   irradiance *= PI;"),n.push("   vec3 diffuseBRDFContrib = (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.diffuse += irradiance * diffuseBRDFContrib;")),i.reflectionMaps.length>0&&(n.push("   vec3 reflectVec             = reflect(geometry.viewEyeDir, geometry.viewNormal);"),n.push("   reflectVec                  = inverseTransformDirection(reflectVec, viewMatrix);"),n.push("   float blinnExpFromRoughness = GGXRoughnessToBlinnExponent(material.specularRoughness);"),n.push("   vec3 radiance               = getLightProbeIndirectRadiance(reflectVec, blinnExpFromRoughness, 8);"),n.push("   vec3 specularBRDFContrib    = BRDF_Specular_GGX_Environment(geometry, material.specularColor, material.specularRoughness);"),n.push("   reflectedLight.specular     += radiance * specularBRDFContrib;")),n.push("}")),n.push("void computePBRLighting(const in IncidentLight incidentLight, const in Geometry geometry, const in Material material, inout ReflectedLight reflectedLight) {"),n.push("   float dotNL     = saturate(dot(geometry.viewNormal, incidentLight.direction));"),n.push("   vec3 irradiance = dotNL * incidentLight.color * PI;"),n.push("   reflectedLight.diffuse  += irradiance * (RECIPROCAL_PI * material.diffuseColor);"),n.push("   reflectedLight.specular += irradiance * BRDF_Specular_GGX(incidentLight, geometry, material.specularColor, material.specularRoughness);"),n.push("}"),n.push("void main(void) {"),r){n.push("  bool clippable = (float(vFlags2.x) > 0.0);"),n.push("  if (clippable) {"),n.push("  float dist = 0.0;");for(let t=0,e=s.sectionPlanes.length;t<e;t++)n.push("if (sectionPlaneActive"+t+") {"),n.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),n.push("}");o?(n.push("  if (dist > (0.002 * vClipPosition.w)) {"),n.push("      discard;"),n.push("  }"),n.push("  if (dist > 0.0) { "),n.push("      gl_FragColor=vec4(1.0, 0.0, 0.0, 1.0);"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("  gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("  return;"),n.push("}")):(n.push("  if (dist > 0.0) { "),n.push("      discard;"),n.push("  }")),n.push("}")}n.push("IncidentLight  light;"),n.push("Material       material;"),n.push("Geometry       geometry;"),n.push("ReflectedLight reflectedLight = ReflectedLight(vec3(0.0,0.0,0.0), vec3(0.0,0.0,0.0));"),n.push("vec3 rgb = (vec3(float(vColor.r) / 255.0, float(vColor.g) / 255.0, float(vColor.b) / 255.0));"),n.push("float alpha = float(vColor.a) / 255.0;"),n.push("vec3  diffuseColor = rgb;"),n.push("float specularF0 = 1.0;"),n.push("float metallic = float(vMetallicRoughness.r) / 255.0;"),n.push("float roughness = float(vMetallicRoughness.g) / 255.0;"),n.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),n.push("material.diffuseColor      = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),n.push("material.specularRoughness = clamp(roughness, 0.04, 1.0);"),n.push("material.specularColor     = mix(vec3(dielectricSpecular), diffuseColor, metallic);"),n.push("geometry.position      = vViewPosition.xyz;"),n.push("geometry.viewNormal    = -normalize(vViewNormal);"),n.push("geometry.viewEyeDir    = normalize(vViewPosition.xyz);"),i.lightMaps.length>0&&n.push("geometry.worldNormal   = normalize(vWorldNormal);"),(i.lightMaps.length>0||i.reflectionMaps.length>0)&&n.push("computePBRLightMapping(geometry, material, reflectedLight);");for(let t=0,e=i.lights.length;t<e;t++){const e=i.lights[t];if("ambient"!==e.type){if("dir"===e.type)"view"===e.space?n.push("light.direction = normalize(lightDir"+t+");"):n.push("light.direction = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);");else if("point"===e.type)"view"===e.space?n.push("light.direction = normalize(lightPos"+t+" - vViewPosition.xyz);"):n.push("light.direction = normalize((viewMatrix * vec4(lightPos"+t+", 0.0)).xyz);");else{if("spot"!==e.type)continue;"view"===e.space?n.push("light.direction = normalize(lightDir"+t+");"):n.push("light.direction = normalize((viewMatrix * vec4(lightDir"+t+", 0.0)).xyz);")}n.push("light.color =  lightColor"+t+".rgb * lightColor"+t+".a;"),n.push("computePBRLighting(light, geometry, material, reflectedLight);")}}return n.push("vec3 outgoingLight = (lightAmbient.rgb * lightAmbient.a * rgb) + (reflectedLight.diffuse) + (reflectedLight.specular);"),n.push("vec4 fragColor;"),this._withSAO?(n.push("   float viewportWidth     = uSAOParams[0];"),n.push("   float viewportHeight    = uSAOParams[1];"),n.push("   float blendCutoff       = uSAOParams[2];"),n.push("   float blendFactor       = uSAOParams[3];"),n.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),n.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),n.push("   fragColor            = vec4(outgoingLight.rgb * ambient, alpha);")):n.push("   fragColor            = vec4(outgoingLight.rgb, alpha);"),e&&n.push("fragColor = linearToGamma(fragColor, gammaFactor);"),n.push("gl_FragColor = fragColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&n.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),n.push("}"),n}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Qr=c.vec3();class Jr{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,t.pickInvisible);const u=t.pickViewMatrix||o.viewMatrix,p=l?U(u,l):u;if(n.uniformMatrix4fv(this._uViewMatrix,!1,p),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*c,o=i.renderFlags;for(let e=0;e<c;e++){const i=this._uSectionPlanes[e],r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Qr);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.TRIANGLES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry normals vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform bool pickInvisible;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;"),s.push("bool isPerspectiveMatrix(mat4 m) {"),s.push("    return (m[2][3] == - 1.0);"),s.push("}"),s.push("varying float isPerspective;")),e&&s.push("varying vec4 vFlags2;"),s.push("varying vec4 vWorldPosition;"),s.push("void main(void) {"),s.push("if (int(flags.w) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("  vWorldPosition = worldPosition;"),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;")),s.push("isPerspective = float (isPerspectiveMatrix(projMatrix));")),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Batched geometry normals fragment shader"),i.push("#extension GL_OES_standard_derivatives : enable"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("varying float isPerspective;"),i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),i.push("varying vec4 vWorldPosition;"),s){i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec3 vWorldNormal;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("if (sectionPlaneActive"+r+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("    gl_FragDepthEXT = isPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("  vec3 xTangent = dFdx( vWorldPosition.xyz );"),i.push("  vec3 yTangent = dFdy( vWorldPosition.xyz );"),i.push("  vec3 worldNormal = normalize( cross( xTangent, yTangent ) );"),i.push("  gl_FragColor = vec4((worldNormal * 0.5) + 0.5, 1.0);"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class to{constructor(t){this._scene=t}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._colorRendererWithSAO&&!this._colorRendererWithSAO.getValid()&&(this._colorRendererWithSAO.destroy(),this._colorRendererWithSAO=null),this._flatColorRenderer&&!this._flatColorRenderer.getValid()&&(this._flatColorRenderer.destroy(),this._flatColorRenderer=null),this._flatColorRendererWithSAO&&!this._flatColorRendererWithSAO.getValid()&&(this._flatColorRendererWithSAO.destroy(),this._flatColorRendererWithSAO=null),this._colorQualityRenderer&&!this._colorQualityRenderer.getValid()&&(this._colorQualityRenderer.destroy(),this._colorQualityRenderer=null),this._colorQualityRendererWithSAO&&!this._colorQualityRendererWithSAO.getValid()&&(this._colorQualityRendererWithSAO.destroy(),this._colorQualityRendererWithSAO=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._normalsRenderer&&!this._normalsRenderer.getValid()&&(this._normalsRenderer.destroy(),this._normalsRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._edgesRenderer&&!this._edgesRenderer.getValid()&&(this._edgesRenderer.destroy(),this._edgesRenderer=null),this._edgesColorRenderer&&!this._edgesColorRenderer.getValid()&&(this._edgesColorRenderer.destroy(),this._edgesColorRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._pickNormalsRenderer&&!1===this._pickNormalsRenderer.getValid()&&(this._pickNormalsRenderer.destroy(),this._pickNormalsRenderer=null),this._pickNormalsFlatRenderer&&!this._pickNormalsFlatRenderer.getValid()&&(this._pickNormalsFlatRenderer.destroy(),this._pickNormalsFlatRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new wr(this._scene,!1)),this._colorRenderer}get colorRendererWithSAO(){return this._colorRendererWithSAO||(this._colorRendererWithSAO=new wr(this._scene,!0)),this._colorRendererWithSAO}get flatColorRenderer(){return this._flatColorRenderer||(this._flatColorRenderer=new Dr(this._scene,!1)),this._flatColorRenderer}get flatColorRendererWithSAO(){return this._flatColorRendererWithSAO||(this._flatColorRendererWithSAO=new Dr(this._scene,!0)),this._flatColorRendererWithSAO}get colorQualityRenderer(){return this._colorQualityRenderer||(this._colorQualityRenderer=new $r(this._scene,!1)),this._colorQualityRenderer}get colorQualityRendererWithSAO(){return this._colorQualityRendererWithSAO||(this._colorQualityRendererWithSAO=new $r(this._scene,!0)),this._colorQualityRendererWithSAO}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Ir(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new zr(this._scene)),this._depthRenderer}get normalsRenderer(){return this._normalsRenderer||(this._normalsRenderer=new Xr(this._scene)),this._normalsRenderer}get edgesRenderer(){return this._edgesRenderer||(this._edgesRenderer=new Cr(this._scene)),this._edgesRenderer}get edgesColorRenderer(){return this._edgesColorRenderer||(this._edgesColorRenderer=new Or(this._scene)),this._edgesColorRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new Lr(this._scene)),this._pickMeshRenderer}get pickNormalsRenderer(){return this._pickNormalsRenderer||(this._pickNormalsRenderer=new jr(this._scene)),this._pickNormalsRenderer}get pickNormalsFlatRenderer(){return this._pickNormalsFlatRenderer||(this._pickNormalsFlatRenderer=new Jr(this._scene)),this._pickNormalsFlatRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Br(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new Hr(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new Yr(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._colorRendererWithSAO&&this._colorRendererWithSAO.destroy(),this._flatColorRenderer&&this._flatColorRenderer.destroy(),this._flatColorRendererWithSAO&&this._flatColorRendererWithSAO.destroy(),this._colorQualityRenderer&&this._colorQualityRenderer.destroy(),this._colorQualityRendererWithSAO&&this._colorQualityRendererWithSAO.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._normalsRenderer&&this._normalsRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._edgesRenderer&&this._edgesRenderer.destroy(),this._edgesColorRenderer&&this._edgesColorRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._pickNormalsRenderer&&this._pickNormalsRenderer.destroy(),this._pickNormalsFlatRenderer&&this._pickNormalsFlatRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const eo={};const so=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint,io=new Uint8Array(4),ro=c.vec4([0,0,0,1]),oo=c.vec4([0,0,0,1]),no=c.vec4([0,0,0,1]),ao=new Float32Array(3),ho=c.vec3(),lo=c.vec3(),uo=c.vec3(),po=c.vec3(),co=c.vec3(),mo=c.vec3(),fo=c.vec3();class go{constructor(t,e){this.sortId="TrianglesInstancingLayer"+(e.solid?"-solid":"-surface")+(e.normals?"-normals":"-autoNormals"),this.layerIndex=e.layerIndex,this._instancingRenderers=function(t){const e=t.id;let s=eo[e];return s||(s=new to(t),eo[e]=s,s._compile(),t.on("compile",(()=>{s._compile()})),t.on("destroyed",(()=>{delete eo[e],s._destroy()}))),s}(t.scene),this.model=t,this._aabb=c.collapseAABB3();const s={positionsDecodeMatrix:c.mat4(),numInstances:0,obb:c.OBB3(),origin:null},i=!!e.positionsDecodeMatrix,r=this.model.scene.pickSurfacePrecisionEnabled,o=this.model.scene.canvas.gl;if(e.positions)if(i){const t=!1;s.positionsBuf=new Dt(o,o.ARRAY_BUFFER,e.positions,e.positions.length,3,o.STATIC_DRAW,t),s.positionsDecodeMatrix.set(e.positionsDecodeMatrix);const i=c.collapseAABB3();c.expandAABB3Points3(i,e.positions),ve.decompressAABB(i,s.positionsDecodeMatrix),c.AABB3ToOBB3(i,s.obb),r&&(s.quantizedPositions=e.positions)}else{const t=e.positions.length,i=c.collapseAABB3();c.expandAABB3Points3(i,e.positions),c.AABB3ToOBB3(i,s.obb);const n=sr(e.positions,i,s.positionsDecodeMatrix);let a=!1;s.positionsBuf=new Dt(o,o.ARRAY_BUFFER,n,t,3,o.STATIC_DRAW,a),r&&(s.quantizedPositions=n)}if(e.normals&&e.normals.length>0)if(i){const t=!0;s.normalsBuf=new Dt(o,o.ARRAY_BUFFER,e.normals,e.normals.length,3,o.STATIC_DRAW,t)}else{const t=function(t){const e=t.length,s=new Int8Array(e);let i,r,o,n;for(let a=0;a<e;a+=3)r=i=rr(t,a,"floor","floor"),or(i),o=n=nr(t,a),i=rr(t,a,"ceil","floor"),or(i),o=nr(t,a),o>n&&(r=i,n=o),i=rr(t,a,"floor","ceil"),or(i),o=nr(t,a),o>n&&(r=i,n=o),i=rr(t,a,"ceil","ceil"),or(i),o=nr(t,a),o>n&&(r=i,n=o),s[a+0]=r[0],s[a+1]=r[1],s[a+2]=0;return new Int8Array(s)}(e.normals),i=!0;s.normalsBuf=new Dt(o,o.ARRAY_BUFFER,t,t.length,3,o.STATIC_DRAW,i)}e.indices&&(s.indicesBuf=new Dt(o,o.ELEMENT_ARRAY_BUFFER,so?new Uint32Array(e.indices):new Uint16Array(e.indices),e.indices.length,1,o.STATIC_DRAW),r&&(s.indices=e.indices));let n=e.edgeIndices;n||(n=ce(e.positions,e.indices,null,e.edgeThreshold||10)),s.edgeIndicesBuf=new Dt(o,o.ELEMENT_ARRAY_BUFFER,so?new Uint32Array(n):new Uint16Array(n),n.length,1,o.STATIC_DRAW),this._state=new zt(s),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.indices?e.indices.length/3:0,this._colors=[],this._metallicRoughness=[],this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[],this._portions=[],e.origin&&(this._state.origin=c.vec3(e.origin)),this._finalized=!1,this.aabb=c.collapseAABB3(),this.solid=!!e.solid}createPortion(t){const e=t.color,s=t.metallic,i=t.roughness,r=t.opacity,o=t.meshMatrix,n=t.worldMatrix,a=t.aabb,h=t.pickColor;if(this._finalized)throw"Already finalized";const l=e[0],u=e[1],p=e[2];if(e[3],this._colors.push(l),this._colors.push(u),this._colors.push(p),this._colors.push(r),this._metallicRoughness.push(null!=s?s:0),this._metallicRoughness.push(null!=i?i:255),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(o[0]),this._modelMatrixCol0.push(o[4]),this._modelMatrixCol0.push(o[8]),this._modelMatrixCol0.push(o[12]),this._modelMatrixCol1.push(o[1]),this._modelMatrixCol1.push(o[5]),this._modelMatrixCol1.push(o[9]),this._modelMatrixCol1.push(o[13]),this._modelMatrixCol2.push(o[2]),this._modelMatrixCol2.push(o[6]),this._modelMatrixCol2.push(o[10]),this._modelMatrixCol2.push(o[14]),this._state.normalsBuf){let t=c.transposeMat4(o,c.mat4()),e=c.inverseMat4(t);this._modelNormalMatrixCol0.push(e[0]),this._modelNormalMatrixCol0.push(e[4]),this._modelNormalMatrixCol0.push(e[8]),this._modelNormalMatrixCol0.push(e[12]),this._modelNormalMatrixCol1.push(e[1]),this._modelNormalMatrixCol1.push(e[5]),this._modelNormalMatrixCol1.push(e[9]),this._modelNormalMatrixCol1.push(e[13]),this._modelNormalMatrixCol2.push(e[2]),this._modelNormalMatrixCol2.push(e[6]),this._modelNormalMatrixCol2.push(e[10]),this._modelNormalMatrixCol2.push(e[14])}this._pickColors.push(h[0]),this._pickColors.push(h[1]),this._pickColors.push(h[2]),this._pickColors.push(h[3]),c.collapseAABB3(a);const d=this._state.obb,m=d.length;for(let t=0;t<m;t+=4)ro[0]=d[t+0],ro[1]=d[t+1],ro[2]=d[t+2],c.transformPoint4(o,ro,oo),n?(c.transformPoint4(n,oo,no),c.expandAABB3Point3(a,no)):c.expandAABB3Point3(a,oo);if(this._state.origin){const t=this._state.origin;a[0]+=t[0],a[1]+=t[1],a[2]+=t[2],a[3]+=t[0],a[4]+=t[1],a[5]+=t[2]}c.expandAABB3(this.aabb,a),this._state.numInstances++;const f=this._portions.length,g={};return this.model.scene.pickSurfacePrecisionEnabled&&(g.matrix=o.slice(),g.inverseMatrix=null,g.normalMatrix=null),this._portions.push(g),this._numPortions++,this.model.numPortions++,f}finalize(){if(this._finalized)throw"Already finalized";const t=this.model.scene.canvas.gl,e=this._colors.length,s=e;if(e>0){let e=!1;this._state.colorsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,t.DYNAMIC_DRAW,e),this._colors=[]}if(this._metallicRoughness.length>0){const e=new Uint8Array(this._metallicRoughness);let s=!1;this._state.metallicRoughnessBuf=new Dt(t,t.ARRAY_BUFFER,e,this._metallicRoughness.length,2,t.STATIC_DRAW,s)}if(s>0){let e=!1,i=!0;this._state.flagsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(s),s,4,t.DYNAMIC_DRAW,e),this._state.flags2Buf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(s),s,4,t.DYNAMIC_DRAW,i)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const e=!1;this._state.offsetsBuf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,t.DYNAMIC_DRAW,e),this._offsets=[]}if(this._modelMatrixCol0.length>0){const e=!1;this._state.modelMatrixCol0Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,t.STATIC_DRAW,e),this._state.modelMatrixCol1Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,t.STATIC_DRAW,e),this._state.modelMatrixCol2Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,t.STATIC_DRAW,e),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._state.normalsBuf&&(this._state.modelNormalMatrixCol0Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol0),this._modelNormalMatrixCol0.length,4,t.STATIC_DRAW,e),this._state.modelNormalMatrixCol1Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol1),this._modelNormalMatrixCol1.length,4,t.STATIC_DRAW,e),this._state.modelNormalMatrixCol2Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelNormalMatrixCol2),this._modelNormalMatrixCol2.length,4,t.STATIC_DRAW,e),this._modelNormalMatrixCol0=[],this._modelNormalMatrixCol1=[],this._modelNormalMatrixCol2=[])}if(this._pickColors.length>0){const e=!1;this._state.pickColorsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,t.STATIC_DRAW,e),this._pickColors=[]}this._finalized=!0}initFlags(t,e,s){e&C&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),e&B&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),e&N&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),e&k&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),e&R&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),e&j&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),e&O&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),e&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(t,e,s),this._setFlags2(t,e)}setVisible(t,e,s){if(!this._finalized)throw"Not finalized";e&C?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(t,e,s)}setHighlighted(t,e,s){if(!this._finalized)throw"Not finalized";e&B?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(t,e,s)}setXRayed(t,e,s){if(!this._finalized)throw"Not finalized";e&N?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(t,e,s)}setSelected(t,e,s){if(!this._finalized)throw"Not finalized";e&k?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(t,e,s)}setEdges(t,e,s){if(!this._finalized)throw"Not finalized";e&j?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(t,e,s)}setClippable(t,e){if(!this._finalized)throw"Not finalized";e&R?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(t,e)}setCollidable(t,e){if(!this._finalized)throw"Not finalized"}setPickable(t,e,s){if(!this._finalized)throw"Not finalized";e&O?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(t,e,s)}setCulled(t,e,s){if(!this._finalized)throw"Not finalized";e&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(t,e,s)}setColor(t,e){if(!this._finalized)throw"Not finalized";io[0]=e[0],io[1]=e[1],io[2]=e[2],io[3]=e[3],this._state.colorsBuf&&this._state.colorsBuf.setData(io,4*t,4)}setTransparent(t,e,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(t,e,s)}_setFlags(t,e,s){if(!this._finalized)throw"Not finalized";const i=!!(e&C),r=!!(e&N),o=!!(e&B),n=!!(e&k),a=!!(e&F);let h,l;h=!i||a||r?ri:s?ni:oi,l=!i||a?ri:n?hi:o?ai:r?li:ri;let u=0;u=!i||a?ri:n?di:o?ci:r?mi:!!(e&j)?s?pi:ui:ri;let p=i&&!a&&!!(e&O)?fi:ri;io[0]=h,io[1]=l,io[2]=u,io[3]=p,this._state.flagsBuf&&this._state.flagsBuf.setData(io,4*t,4)}_setFlags2(t,e){if(!this._finalized)throw"Not finalized";const s=e&R?255:0;io[0]=s,this._state.flags2Buf&&this._state.flags2Buf.setData(io,4*t,4)}setOffset(t,e){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(ao[0]=e[0],ao[1]=e[1],ao[2]=e[2],this._state.offsetsBuf&&this._state.offsetsBuf.setData(ao,3*t,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),e.withSAO&&this.model.saoEnabled?e.pbrEnabled&&this.model.pbrEnabled&&this._state.normalsBuf?this._instancingRenderers.colorQualityRendererWithSAO&&this._instancingRenderers.colorQualityRendererWithSAO.drawLayer(e,this,oi):this._state.normalsBuf?this._instancingRenderers.colorRendererWithSAO&&this._instancingRenderers.colorRendererWithSAO.drawLayer(e,this,oi):this._instancingRenderers.flatColorRendererWithSAO&&this._instancingRenderers.flatColorRendererWithSAO.drawLayer(e,this,oi):e.pbrEnabled&&this.model.pbrEnabled&&this._state.normalsBuf?this._instancingRenderers.colorQualityRenderer&&this._instancingRenderers.colorQualityRenderer.drawLayer(e,this,oi):this._state.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(e,this,oi):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(e,this,oi))}_updateBackfaceCull(t,e){const s=this.model.backfaces||!this.solid||t.sectioned;if(e.backfaces!==s){const t=e.gl;s?t.disable(t.CULL_FACE):t.enable(t.CULL_FACE),e.backfaces=s}}drawColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),e.pbrEnabled&&this.model.pbrEnabled&&this._state.normalsBuf?this._instancingRenderers.colorQualityRenderer&&this._instancingRenderers.colorQualityRenderer.drawLayer(e,this,ni):this._state.normalsBuf?this._instancingRenderers.colorRenderer&&this._instancingRenderers.colorRenderer.drawLayer(e,this,ni):this._instancingRenderers.flatColorRenderer&&this._instancingRenderers.flatColorRenderer.drawLayer(e,this,ni))}drawDepth(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.depthRenderer&&this._instancingRenderers.depthRenderer.drawLayer(e,this,oi))}drawNormals(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.normalsRenderer&&this._instancingRenderers.normalsRenderer.drawLayer(e,this,oi))}drawSilhouetteXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(e,this,li))}drawSilhouetteHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(e,this,ai))}drawSilhouetteSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.silhouetteRenderer&&this._instancingRenderers.silhouetteRenderer.drawLayer(e,this,hi))}drawEdgesColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(e,this,ui)}drawEdgesColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numEdgesLayerPortions&&this._instancingRenderers.edgesColorRenderer&&this._instancingRenderers.edgesColorRenderer.drawLayer(e,this,pi)}drawEdgesXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(e,this,mi)}drawEdgesHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(e,this,ci)}drawEdgesSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._instancingRenderers.edgesRenderer&&this._instancingRenderers.edgesRenderer.drawLayer(e,this,di)}drawOcclusion(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.occlusionRenderer&&this._instancingRenderers.occlusionRenderer.drawLayer(e,this,oi))}drawShadow(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.shadowRenderer&&this._instancingRenderers.shadowRenderer.drawLayer(e,this,oi))}drawPickMesh(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.pickMeshRenderer&&this._instancingRenderers.pickMeshRenderer.drawLayer(e,this,fi))}drawPickDepths(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.pickDepthRenderer&&this._instancingRenderers.pickDepthRenderer.drawLayer(e,this,fi))}drawPickNormals(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&(this._updateBackfaceCull(t,e),this._instancingRenderers.pickNormalsRenderer&&this._instancingRenderers.pickNormalsRenderer.drawLayer(e,this,fi))}precisionRayPickSurface(t,e,s,i,r){if(!this.model.scene.pickSurfacePrecisionEnabled)return!1;const o=this._state,n=this._portions[t];if(!n)return this.model.error("portion not found: "+t),!1;n.inverseMatrix||(n.inverseMatrix=c.inverseMat4(n.matrix,c.mat4())),r&&!n.normalMatrix&&(n.normalMatrix=c.transposeMat4(n.inverseMatrix,c.mat4()));const a=o.quantizedPositions,h=o.indices,l=o.origin,u=n.offset,p=ho,d=lo;p.set(l?c.subVec3(e,l,uo):e),d.set(s),u&&c.subVec3(p,u),c.transformRay(this.model.worldNormalMatrix,p,d,p,d),c.transformRay(n.inverseMatrix,p,d,p,d);const m=po,f=co,g=mo;let _=!1,y=0;const v=fo;for(let t=0,s=h.length;t<s;t+=3){const s=3*h[t+0],b=3*h[t+1],P=3*h[t+2];if(m[0]=a[s],m[1]=a[s+1],m[2]=a[s+2],f[0]=a[b],f[1]=a[b+1],f[2]=a[b+2],g[0]=a[P],g[1]=a[P+1],g[2]=a[P+2],c.decompressPosition(m,o.positionsDecodeMatrix),c.decompressPosition(f,o.positionsDecodeMatrix),c.decompressPosition(g,o.positionsDecodeMatrix),c.rayTriangleIntersect(p,d,m,f,g,v)){c.transformPoint3(n.matrix,v,v),c.transformPoint3(this.model.worldMatrix,v,v),u&&c.addVec3(v,u),l&&c.addVec3(v,l);const t=Math.abs(c.lenVec3(c.subVec3(v,e,[])));(!_||t>y)&&(y=t,i.set(v),r&&c.triangleNormal(m,f,g,r),_=!0)}}return _&&r&&(c.transformVec3(n.normalMatrix,r,r),c.transformVec3(this.model.worldNormalMatrix,r,r),c.normalizeVec3(r)),_}destroy(){const t=this._state;t.positionsBuf&&(t.positionsBuf.destroy(),t.positionsBuf=null),t.normalsBuf&&(t.normalsBuf.destroy(),t.normalsBuf=null),t.colorsBuf&&(t.colorsBuf.destroy(),t.colorsBuf=null),t.metallicRoughnessBuf&&(t.metallicRoughnessBuf.destroy(),t.metallicRoughnessBuf=null),t.flagsBuf&&(t.flagsBuf.destroy(),t.flagsBuf=null),t.flags2Buf&&(t.flags2Buf.destroy(),t.flags2Buf=null),t.offsetsBuf&&(t.offsetsBuf.destroy(),t.offsetsBuf=null),t.modelMatrixCol0Buf&&(t.modelMatrixCol0Buf.destroy(),t.modelMatrixCol0Buf=null),t.modelMatrixCol1Buf&&(t.modelMatrixCol1Buf.destroy(),t.modelMatrixCol1Buf=null),t.modelMatrixCol2Buf&&(t.modelMatrixCol2Buf.destroy(),t.modelMatrixCol2Buf=null),t.modelNormalMatrixCol0Buf&&(t.modelNormalMatrixCol0Buf.destroy(),t.modelNormalMatrixCol0Buf=null),t.modelNormalMatrixCol1Buf&&(t.modelNormalMatrixCol1Buf.destroy(),t.modelNormalMatrixCol1Buf=null),t.modelNormalMatrixCol2Buf&&(t.modelNormalMatrixCol2Buf.destroy(),t.modelNormalMatrixCol2Buf=null),t.indicesBuf&&(t.indicesBuf.destroy(),t.indicessBuf=null),t.edgeIndicesBuf&&(t.edgeIndicesBuf.destroy(),t.edgeIndicessBuf=null),t.pickColorsBuf&&(t.pickColorsBuf.destroy(),t.pickColorsBuf=null),t.destroy()}}const _o=c.vec3();class yo{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=this._scene,r=i.camera,o=e.model,n=i.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix),n.lineWidth(i.linesMaterial.lineWidth);const l=i._sectionPlanesState.sectionPlanes.length;if(l>0){const t=i._sectionPlanesState.sectionPlanes,s=e.layerIndex*l,r=o.renderFlags;for(let e=0;e<l;e++){const i=this._uSectionPlanes[e];if(i){const o=r.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,o?1:0),o){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,_o);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),a.indicesBuf.bind(),n.drawElements(n.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene,s=e.canvas.gl,i=this._program,r=e.camera.project;if(i.bind(),s.uniformMatrix4fv(this._uProjMatrix,!1,r.matrix),e.logarithmicDepthBufferEnabled){const t=2/(Math.log(r.far+1)/Math.LN2);s.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Lines batching color vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, float(color.a) / 255.0);"),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Lines batching color fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   gl_FragColor            = vColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const vo=new Float32Array([1,1,1]),bo=c.vec3();class Po{constructor(t,e){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===li){const t=r.xrayMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ai){const t=r.highlightMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===hi){const t=r.selectedMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,vo);const l=h?U(o.viewMatrix,h):o.viewMatrix;n.uniformMatrix4fv(this._uViewMatrix,!1,l),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.lineWidth(r.linesMaterial.lineWidth);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,bo);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),a.indicesBuf.bind(),n.drawElements(n.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Lines batching silhouette vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform vec4 color;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Lines batching silhouette fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("uniform vec4 color;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class To{constructor(t){this._scene=t}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new yo(this._scene,!1)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Po(this._scene)),this._silhouetteRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}const wo={};const xo=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint;class Mo{constructor(t=5e6){xo?t>5e6&&(t=5e6):t>65530&&(t=65530),this.maxVerts=t,this.maxIndices=3*t,this.positions=[],this.colors=[],this.flags=[],this.flags2=[],this.offsets=[],this.indices=[]}}const Do=c.vec4([0,0,0,1]),Eo=c.vec4([0,0,0,1]),Io=c.vec4([0,0,0,1]),So=c.OBB3();class Ao{constructor(t,e){this.layerIndex=e.layerIndex,this._batchingRenderers=function(t){const e=t.id;let s=wo[e];return s||(s=new To(t),wo[e]=s,s._compile(),t.on("compile",(()=>{s._compile()})),t.on("destroyed",(()=>{delete wo[e],s._destroy()}))),s}(t.scene),this.model=t,this._buffer=new Mo(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new zt({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,indicesBuf:null,positionsDecodeMatrix:c.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=c.collapseAABB3(),this._portions=[],this._finalized=!1,this._positionsDecodeMatrix=e.positionsDecodeMatrix,this._preCompressed=!!this._positionsDecodeMatrix,e.origin&&(this._state.origin=c.vec3(e.origin)),this.aabb=c.collapseAABB3()}canCreatePortion(t,e){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+t<3*this._buffer.maxVerts&&this._buffer.indices.length+e<this._buffer.maxIndices}createPortion(t){if(this._finalized)throw"Already finalized";const e=t.positions,s=t.indices,i=t.color,r=t.opacity,o=t.meshMatrix,n=t.worldMatrix,a=t.worldAABB;t.pickColor;const h=this._buffer,l=h.positions.length/3,u=e.length/3,p=e.length;if(this._preCompressed){for(let t=0,s=e.length;t<s;t++)h.positions.push(e[t]);const t=ve.getPositionsBounds(e),s=ve.decompressPosition(t.min,this._positionsDecodeMatrix,[]),i=ve.decompressPosition(t.max,this._positionsDecodeMatrix,[]);a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=i[0],a[4]=i[1],a[5]=i[2],n&&(c.AABB3ToOBB3(a,So),c.transformOBB3(n,So),c.OBB3ToAABB3(So,a))}else{const t=h.positions.length;for(let t=0,s=e.length;t<s;t++)h.positions.push(e[t]);if(o)for(let e=t,s=t+p;e<s;e+=3)Do[0]=h.positions[e+0],Do[1]=h.positions[e+1],Do[2]=h.positions[e+2],c.transformPoint4(o,Do,Eo),h.positions[e+0]=Eo[0],h.positions[e+1]=Eo[1],h.positions[e+2]=Eo[2],c.expandAABB3Point3(this._modelAABB,Eo),n?(c.transformPoint4(n,Eo,Io),c.expandAABB3Point3(a,Io)):c.expandAABB3Point3(a,Eo);else for(let e=t,s=t+p;e<s;e+=3)Do[0]=h.positions[e+0],Do[1]=h.positions[e+1],Do[2]=h.positions[e+2],c.expandAABB3Point3(this._modelAABB,Do),n?(c.transformPoint4(n,Do,Eo),c.expandAABB3Point3(a,Eo)):c.expandAABB3Point3(a,Do)}if(this._state.origin){const t=this._state.origin;a[0]+=t[0],a[1]+=t[1],a[2]+=t[2],a[3]+=t[0],a[4]+=t[1],a[5]+=t[2]}if(c.expandAABB3(this.aabb,a),i){const t=i[0],e=i[1],s=i[2],o=r;for(let i=0;i<u;i++)h.colors.push(t),h.colors.push(e),h.colors.push(s),h.colors.push(o)}if(s)for(let t=0,e=s.length;t<e;t++)h.indices.push(s[t]+l);if(this.model.scene.entityOffsetsEnabled)for(let t=0;t<u;t++)h.offsets.push(0),h.offsets.push(0),h.offsets.push(0);const d=this._portions.length/2;return this._portions.push(l),this._portions.push(u),this._numPortions++,this.model.numPortions++,d}finalize(){if(this._finalized)return void this.model.error("Already finalized");const t=this._state,e=this.model.scene.canvas.gl,s=this._buffer;if(s.positions.length>0)if(this._preCompressed){t.positionsDecodeMatrix=this._positionsDecodeMatrix;const i=new Uint16Array(s.positions);t.positionsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.positions.length,3,e.STATIC_DRAW)}else{const i=sr(new Float32Array(s.positions),this._modelAABB,t.positionsDecodeMatrix);t.positionsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.positions.length,3,e.STATIC_DRAW)}if(s.colors.length>0){const i=new Uint8Array(s.colors);let r=!1;t.colorsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.colors.length,4,e.DYNAMIC_DRAW,r)}if(s.colors.length>0){const i=s.colors.length,r=new Uint8Array(i),o=new Uint8Array(i);let n=!1,a=!0;t.flagsBuf=new Dt(e,e.ARRAY_BUFFER,r,r.length,4,e.DYNAMIC_DRAW,n),t.flags2Buf=new Dt(e,e.ARRAY_BUFFER,o,o.length,4,e.DYNAMIC_DRAW,a)}if(this.model.scene.entityOffsetsEnabled&&s.offsets.length>0){const i=new Float32Array(s.offsets);t.offsetsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.offsets.length,3,e.DYNAMIC_DRAW)}const i=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint;if(s.indices.length>0){const r=i?new Uint32Array(s.indices):new Uint16Array(s.indices);t.indicesBuf=new Dt(e,e.ELEMENT_ARRAY_BUFFER,r,s.indices.length,1,e.STATIC_DRAW)}this._buffer=null,this._finalized=!0}initFlags(t,e,s){e&C&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),e&B&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),e&N&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),e&k&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),e&R&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),e&j&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),e&O&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),e&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(t,e,s),this._setFlags2(t,e)}setVisible(t,e,s){if(!this._finalized)throw"Not finalized";e&C?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(t,e,s)}setHighlighted(t,e,s){if(!this._finalized)throw"Not finalized";e&B?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(t,e,s)}setXRayed(t,e,s){if(!this._finalized)throw"Not finalized";e&N?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(t,e,s)}setSelected(t,e,s){if(!this._finalized)throw"Not finalized";e&k?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(t,e,s)}setEdges(t,e,s){if(!this._finalized)throw"Not finalized";e&j?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(t,e,s)}setClippable(t,e){if(!this._finalized)throw"Not finalized";e&R?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(t,e)}setCulled(t,e,s){if(!this._finalized)throw"Not finalized";e&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(t,e,s)}setCollidable(t,e){if(!this._finalized)throw"Not finalized"}setPickable(t,e,s){if(!this._finalized)throw"Not finalized";e&O?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(t,e,s)}setColor(t,e){if(!this._finalized)throw"Not finalized";const s=2*t,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=e[0],a=e[1],h=e[2],l=e[3];for(let t=0;t<r;t+=4)o[t+0]=n,o[t+1]=a,o[t+2]=h,o[t+3]=l;this._state.colorsBuf.setData(o,i,r)}setTransparent(t,e,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(t,e,s)}_setFlags(t,e,s){if(!this._finalized)throw"Not finalized";const i=2*t,r=4*this._portions[i],o=4*this._portions[i+1],n=this._scratchMemory.getUInt8Array(o),a=!!(e&C),h=!!(e&N),l=!!(e&F);let u,p;u=!a||l||h?ri:s?ni:oi,p=!a||l?ri:!!(e&k)?hi:!!(e&B)?ai:h?li:ri;let c=a&&!l&&!!(e&O)?fi:ri;for(let t=0;t<o;t+=4)n[t+0]=u,n[t+1]=p,n[t+2]=0,n[t+3]=c;this._state.flagsBuf.setData(n,r,o)}_setFlags2(t,e){if(!this._finalized)throw"Not finalized";const s=2*t,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=e&R?255:0;for(let t=0;t<r;t+=4)o[t+0]=n;this._state.flags2Buf.setData(o,i,r)}setOffset(t,e){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const s=2*t,i=3*this._portions[s],r=3*this._portions[s+1],o=this._scratchMemory.getFloat32Array(r),n=e[0],a=e[1],h=e[2];for(let t=0;t<r;t+=3)o[t+0]=n,o[t+1]=a,o[t+2]=h;this._state.offsetsBuf.setData(o,i,r)}drawColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(e,this,oi)}drawColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._batchingRenderers.colorRenderer&&this._batchingRenderers.colorRenderer.drawLayer(e,this,ni)}drawDepth(t,e){}drawNormals(t,e){}drawSilhouetteXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(e,this,li)}drawSilhouetteHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(e,this,ai)}drawSilhouetteSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._batchingRenderers.silhouetteRenderer&&this._batchingRenderers.silhouetteRenderer.drawLayer(e,this,hi)}drawEdgesColorOpaque(t,e){}drawEdgesColorTransparent(t,e){}drawEdgesHighlighted(t,e){}drawEdgesSelected(t,e){}drawEdgesXRayed(t,e){}drawPickMesh(t){}drawPickDepths(t){}drawPickNormals(t){}drawOcclusion(t){}drawShadow(t){}destroy(){const t=this._state;t.positionsBuf&&(t.positionsBuf.destroy(),t.positionsBuf=null),t.offsetsBuf&&(t.offsetsBuf.destroy(),t.offsetsBuf=null),t.colorsBuf&&(t.colorsBuf.destroy(),t.colorsBuf=null),t.flagsBuf&&(t.flagsBuf.destroy(),t.flagsBuf=null),t.flags2Buf&&(t.flags2Buf.destroy(),t.flags2Buf=null),t.indicesBuf&&(t.indicesBuf.destroy(),t.indicessBuf=null),t.destroy()}}const Co=c.vec3();class Fo{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.lineWidth(r.linesMaterial.lineWidth);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Co);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aColor=s.getAttribute("color"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aOffset=s.getAttribute("offset"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Lines instancing color vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),s.push("uniform vec4 lightAmbient;"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("varying vec4 vColor;"),s.push("void main(void) {"),s.push("if (int(flags.x) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),s.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0,  float(color.a) / 255.0);"),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState;let s,i;const r=e.sectionPlanes.length>0,o=[];if(o.push("// Lines instancing color fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("varying vec4 vColor;"),o.push("void main(void) {"),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return this._withSAO?(o.push("   float viewportWidth     = uSAOParams[0];"),o.push("   float viewportHeight    = uSAOParams[1];"),o.push("   float blendCutoff       = uSAOParams[2];"),o.push("   float blendFactor       = uSAOParams[3];"),o.push("   vec2 uv                 = vec2(gl_FragCoord.x / viewportWidth, gl_FragCoord.y / viewportHeight);"),o.push("   float ambient           = smoothstep(blendCutoff, 1.0, unpackRGBAToDepth(texture2D(uOcclusionTexture, uv))) * blendFactor;"),o.push("   gl_FragColor            = vec4(vColor.rgb * ambient, vColor.a);")):o.push("    gl_FragColor           = vColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Oo=c.vec3();class Ro{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin;if(!this._program&&(this._allocate(e.model.scene),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===li){const t=r.xrayMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ai){const t=r.highlightMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===hi){const t=r.selectedMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,c.vec3([1,1,1]));n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.lineWidth(r.linesMaterial.lineWidth);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,o=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Oo);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),a.indicesBuf.bind(),h.drawElementsInstancedANGLE(n.LINES,a.indicesBuf.numItems,a.indicesBuf.itemType,0,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Lines instancing silhouette vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("#extension GL_EXT_frag_depth : enable"),s.push("uniform int renderPass;"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 worldMatrix;"),s.push("uniform mat4 viewMatrix;"),s.push("uniform mat4 projMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),t.logarithmicDepthBufferEnabled&&(s.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&s.push("varying float vFragDepth;")),s.push("uniform vec4 color;"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("if (int(flags.y) != renderPass) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?s.push("vFragDepth = 1.0 + clipPos.w;"):(s.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),s.push("clipPos.z *= clipPos.w;"))),s.push("gl_Position = clipPos;"),s.push("}"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Lines instancing silhouette fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("uniform vec4 color;"),i.push("void main(void) {"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class Lo{constructor(t){this._scene=t}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new Fo(this._scene)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Ro(this._scene)),this._silhouetteRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy()}}const No={};const Bo=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint,ko=new Uint8Array(4),jo=c.vec4([0,0,0,1]),Go=c.vec4([0,0,0,1]),Ho=c.vec4([0,0,0,1]),Vo=new Float32Array(3);class zo{constructor(t,e){this.sortId="LinesInstancingLayer",this.layerIndex=e.layerIndex,this._linesInstancingRenderers=function(t){const e=t.id;let s=No[e];return s||(s=new Lo(t),No[e]=s,s._compile(),t.on("compile",(()=>{s._compile()})),t.on("destroyed",(()=>{delete No[e],s._destroy()}))),s}(t.scene),this.model=t,this._aabb=c.collapseAABB3();const s=t.scene.canvas.gl,i={positionsDecodeMatrix:c.mat4(),numInstances:0,obb:c.OBB3(),origin:null},r=!!e.positionsDecodeMatrix;if(e.positions)if(r){let t=!1;i.positionsBuf=new Dt(s,s.ARRAY_BUFFER,e.positions,e.positions.length,3,s.STATIC_DRAW,t),i.positionsDecodeMatrix.set(e.positionsDecodeMatrix);let r=c.collapseAABB3();c.expandAABB3Points3(r,e.positions),ve.decompressAABB(r,i.positionsDecodeMatrix),c.AABB3ToOBB3(r,i.obb)}else{let t=e.positions.length,r=c.collapseAABB3();c.expandAABB3Points3(r,e.positions),c.AABB3ToOBB3(r,i.obb);const o=sr(e.positions,r,i.positionsDecodeMatrix);let n=!1;i.positionsBuf=new Dt(s,s.ARRAY_BUFFER,o,t,3,s.STATIC_DRAW,n)}e.indices&&(i.indicesBuf=new Dt(s,s.ELEMENT_ARRAY_BUFFER,Bo?new Uint32Array(e.indices):new Uint16Array(e.indices),e.indices.length,1,s.STATIC_DRAW)),this._state=new zt(i),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this.numIndices=e.indices?e.indices.length/3:0,this._colors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],e.origin&&(this._state.origin=c.vec3(e.origin)),this._finalized=!1,this.aabb=c.collapseAABB3()}createPortion(t){const e=t.color,s=t.opacity,i=t.meshMatrix,r=t.worldMatrix,o=t.aabb;if(this._finalized)throw"Already finalized";const n=e[0],a=e[1],h=e[2];e[3],this._colors.push(n),this._colors.push(a),this._colors.push(h),this._colors.push(s),this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(i[0]),this._modelMatrixCol0.push(i[4]),this._modelMatrixCol0.push(i[8]),this._modelMatrixCol0.push(i[12]),this._modelMatrixCol1.push(i[1]),this._modelMatrixCol1.push(i[5]),this._modelMatrixCol1.push(i[9]),this._modelMatrixCol1.push(i[13]),this._modelMatrixCol2.push(i[2]),this._modelMatrixCol2.push(i[6]),this._modelMatrixCol2.push(i[10]),this._modelMatrixCol2.push(i[14]),c.collapseAABB3(o);const l=this._state.obb,u=l.length;for(let t=0;t<u;t+=4)jo[0]=l[t+0],jo[1]=l[t+1],jo[2]=l[t+2],c.transformPoint4(i,jo,Go),r?(c.transformPoint4(r,Go,Ho),c.expandAABB3Point3(o,Ho)):c.expandAABB3Point3(o,Go);if(this._state.origin){const t=this._state.origin;o[0]+=t[0],o[1]+=t[1],o[2]+=t[2],o[3]+=t[0],o[4]+=t[1],o[5]+=t[2]}c.expandAABB3(this.aabb,o),this._state.numInstances++;const p=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,p}finalize(){if(this._finalized)throw"Already finalized";const t=this.model.scene.canvas.gl,e=this._colors.length,s=e;if(e>0){let e=!1;this._state.colorsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(this._colors),this._colors.length,4,t.DYNAMIC_DRAW,e),this._colors=[]}if(s>0){let e=!1,i=!0;this._state.flagsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(s),s,4,t.DYNAMIC_DRAW,e),this._state.flags2Buf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(s),s,4,t.DYNAMIC_DRAW,i)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const e=!1;this._state.offsetsBuf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,t.DYNAMIC_DRAW,e),this._offsets=[]}if(this._modelMatrixCol0.length>0){const e=!1;this._state.modelMatrixCol0Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,t.STATIC_DRAW,e),this._state.modelMatrixCol1Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,t.STATIC_DRAW,e),this._state.modelMatrixCol2Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,t.STATIC_DRAW,e),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}this._finalized=!0}initFlags(t,e,s){e&C&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),e&B&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),e&N&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),e&k&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),e&R&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),e&j&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),e&O&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),e&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(t,e,s),this._setFlags2(t,e)}setVisible(t,e,s){if(!this._finalized)throw"Not finalized";e&C?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(t,e,s)}setHighlighted(t,e,s){if(!this._finalized)throw"Not finalized";e&B?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(t,e,s)}setXRayed(t,e,s){if(!this._finalized)throw"Not finalized";e&N?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(t,e,s)}setSelected(t,e,s){if(!this._finalized)throw"Not finalized";e&k?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(t,e,s)}setEdges(t,e,s){if(!this._finalized)throw"Not finalized";e&j?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(t,e,s)}setClippable(t,e){if(!this._finalized)throw"Not finalized";e&R?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(t,e)}setCollidable(t,e){if(!this._finalized)throw"Not finalized"}setPickable(t,e,s){if(!this._finalized)throw"Not finalized";e&O?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(t,e,s)}setCulled(t,e,s){if(!this._finalized)throw"Not finalized";e&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(t,e,s)}setColor(t,e){if(!this._finalized)throw"Not finalized";ko[0]=e[0],ko[1]=e[1],ko[2]=e[2],ko[3]=e[3],this._state.colorsBuf.setData(ko,4*t,4)}setTransparent(t,e,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(t,e,s)}_setFlags(t,e,s){if(!this._finalized)throw"Not finalized";const i=!!(e&C),r=!!(e&N),o=!!(e&B),n=!!(e&k),a=!!(e&F);let h,l;h=!i||a||r?ri:s?ni:oi,l=!i||a?ri:n?hi:o?ai:r?li:ri;let u=0;u=!i||a?ri:n?di:o?ci:r?mi:!!(e&j)?s?pi:ui:ri;let p=i&&!a&&!!(e&O)?fi:ri;ko[0]=h,ko[1]=l,ko[2]=u,ko[3]=p,this._state.flagsBuf.setData(ko,4*t,4)}_setFlags2(t,e){if(!this._finalized)throw"Not finalized";const s=e&R?255:0;ko[0]=s,this._state.flags2Buf.setData(ko,4*t,4)}setOffset(t,e){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(Vo[0]=e[0],Vo[1]=e[1],Vo[2]=e[2],this._state.offsetsBuf.setData(Vo,3*t,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(e,this,oi)}drawColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._linesInstancingRenderers.colorRenderer&&this._linesInstancingRenderers.colorRenderer.drawLayer(e,this,ni)}drawDepth(t,e){}drawNormals(t,e){}drawSilhouetteXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(e,this,li)}drawSilhouetteHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(e,this,ai)}drawSilhouetteSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._linesInstancingRenderers.silhouetteRenderer&&this._linesInstancingRenderers.silhouetteRenderer.drawLayer(e,this,hi)}drawEdgesColorOpaque(t,e){}drawEdgesColorTransparent(t,e){}drawEdgesXRayed(t,e){}drawEdgesHighlighted(t,e){}drawEdgesSelected(t,e){}drawOcclusion(t,e){}drawShadow(t,e){}drawPickMesh(t,e){}drawPickDepths(t,e){}drawPickNormals(t,e){}destroy(){const t=this._state;t.positionsBuf&&(t.positionsBuf.destroy(),t.positionsBuf=null),t.colorsBuf&&(t.colorsBuf.destroy(),t.colorsBuf=null),t.flagsBuf&&(t.flagsBuf.destroy(),t.flagsBuf=null),t.flags2Buf&&(t.flags2Buf.destroy(),t.flags2Buf=null),t.offsetsBuf&&(t.offsetsBuf.destroy(),t.offsetsBuf=null),t.modelMatrixCol0Buf&&(t.modelMatrixCol0Buf.destroy(),t.modelMatrixCol0Buf=null),t.modelMatrixCol1Buf&&(t.modelMatrixCol1Buf.destroy(),t.modelMatrixCol1Buf=null),t.modelMatrixCol2Buf&&(t.modelMatrixCol2Buf.destroy(),t.modelMatrixCol2Buf=null),t.indicesBuf&&(t.indicesBuf.destroy(),t.indicessBuf=null),t.destroy()}}const Uo=c.vec3();class Xo{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=this._scene,r=i.camera,o=e.model,n=i.canvas.gl,a=e._state,h=e._state.origin,l=i.pointsMaterial;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,h?U(r.viewMatrix,h):r.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,o.worldMatrix);const u=i._sectionPlanesState.sectionPlanes.length;if(u>0){const t=i._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,r=o.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const o=r.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,o?1:0),o){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Uo);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor&&this._aColor.bindArrayBuffer(a.colorsBuf),l.filterIntensity&&n.uniform2f(this._uIntensityRange,l.minIntensity,l.maxIntensity),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),n.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===i.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*i.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,p),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const t=this._scene,e=t.pointsMaterial._state,s=t.canvas.gl;if(this._program=new Mt(s,this._buildShader(t)),this._program.errors)return void(this.errors=this._program.errors);const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.filterIntensity&&(this._uIntensityRange=i.getLocation("intensityRange")),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=this._program,i=t.camera.project;if(s.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,i.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(i.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial,i=[];return i.push("// Points batching color vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),s.filterIntensity&&i.push("uniform vec2 intensityRange;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),s.filterIntensity&&(i.push("float intensity = float(color.a) / 255.0;"),i.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {")),i.push("vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&i.push("worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),e&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),s.filterIntensity&&i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points batching color fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("  if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   gl_FragColor = vColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Wo=new Float32Array([1,1,1]),Yo=c.vec3();class Ko{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===li){const t=r.xrayMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ai){const t=r.highlightMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===hi){const t=r.selectedMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,Wo);const u=h?U(o.viewMatrix,h):o.viewMatrix;n.uniformMatrix4fv(this._uViewMatrix,!1,u),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Yo);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),n.uniform1f(this._uPointSize,l.pointSize);const c="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,c),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uColor=s.getLocation("color"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points batching silhouette vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform vec4 color;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState;let s,i;const r=e.sectionPlanes.length>0,o=[];if(o.push("// Points batching silhouette vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("uniform vec4 color;"),o.push("void main(void) {"),t.pointsMaterial.roundPoints&&(o.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("  float r = dot(cxy, cxy);"),o.push("  if (r > 1.0) {"),o.push("       discard;"),o.push("  }")),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("  if (dist > 0.0) { discard; }"),o.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("gl_FragColor = color;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Zo=c.vec3();class qo{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin,l=r.pointsMaterial._state;this._program||this._allocate(e),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=t.pickViewMatrix||o.viewMatrix,p=h?U(u,h):u;if(n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,p),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*c,o=i.renderFlags;for(let e=0;e<c;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Zo);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),this._aPickColor&&this._aPickColor.bindArrayBuffer(a.pickColorsBuf),n.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aPickColor=s.getAttribute("pickColor"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene.canvas.gl;this._program.bind(),e.uniform1i(this._uPickInvisible,t.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points batching pick mesh vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 pickColor;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("      vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),e&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("gl_PointSize += 10.0;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points batching pick mesh vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("uniform bool sectionPlaneActive"+r+";"),i.push("uniform vec3 sectionPlanePos"+r+";"),i.push("uniform vec3 sectionPlaneDir"+r+";")}if(i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   gl_FragColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const $o=c.vec3();class Qo{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=e._state.origin,l=r.pointsMaterial._state;this._program||this._allocate(),t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniform1i(this._uPickInvisible,t.pickInvisible);const u=t.pickViewMatrix||o.viewMatrix,p=h?U(u,h):u;if(n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,p),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),n.uniform1f(this._uPickZNear,t.pickZNear),n.uniform1f(this._uPickZFar,t.pickZFar),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(t.pickZFar+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,e)}const c=r._sectionPlanesState.sectionPlanes.length;if(c>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*c,o=i.renderFlags;for(let e=0;e<c;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,$o);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(a.offsetsBuf),this._aFlags&&this._aFlags.bindArrayBuffer(a.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(a.flags2Buf),n.uniform1f(this._uPointSize,l.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d),n.drawArrays(n.POINTS,0,a.positionsBuf.numItems)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points batched pick depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("gl_PointSize += 10.0;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points batched pick depth fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(var r=0;r<e.sectionPlanes.length;r++)i.push("      if (sectionPlaneActive"+r+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+r+".xyz, vWorldPosition.xyz - sectionPlanePos"+r+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    gl_FragColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Jo=c.vec3();class tn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.canvas.gl,n=e._state,a=r.camera,h=e._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),o.uniform1i(this._uRenderPass,s),o.uniformMatrix4fv(this._uViewMatrix,!1,h?U(a.viewMatrix,h):a.viewMatrix),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const u=r._sectionPlanesState.sectionPlanes.length;if(u>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*u,n=i.renderFlags;for(let e=0;e<u;e++){const i=this._uSectionPlanes[e];if(i){const r=n.sectionPlanesActivePerLayer[s+e];if(o.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,Jo);o.uniform3fv(i.pos,t)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aOffset&&this._aOffset.bindArrayBuffer(n.offsetsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),this._aFlags2&&this._aFlags2.bindArrayBuffer(n.flags2Buf),o.uniform1f(this._uPointSize,l.pointSize);const p="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,p),o.drawArrays(o.POINTS,0,n.positionsBuf.numItems)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points batching occlusion vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("  } else {"),i.push("      vec4 worldPosition = worldMatrix * (positionsDecodeMatrix * vec4(position, 1.0)); "),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("      vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(i.push("      vWorldPosition = worldPosition;"),i.push("      vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("  gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("  }"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points batching occlusion fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("      float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("      if (sectionPlaneActive"+t+") {"),i.push("          dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("      }");i.push("      if (dist > 0.0) { discard; }"),i.push("  }")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class en{constructor(t){this._scene=t}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new Xo(this._scene)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new Ko(this._scene)),this._silhouetteRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new qo(this._scene)),this._pickMeshRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new Qo(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new tn(this._scene)),this._occlusionRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy()}}const sn={};const rn=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint;class on{constructor(t=5e6){rn?t>5e6&&(t=5e6):t>65530&&(t=65530),this.maxVerts=t,this.maxIndices=3*t,this.positions=[],this.colors=[],this.intensities=[],this.pickColors=[],this.flags=[],this.flags2=[],this.offsets=[]}}const nn=c.vec4(),an=c.vec4(),hn=c.vec4([0,0,0,1]),ln=c.vec4([0,0,0,1]),un=c.vec4([0,0,0,1]),pn=c.OBB3();class cn{constructor(t,e){this.sortId="PointsBatchingLayer",this.layerIndex=e.layerIndex,this._pointsBatchingRenderers=function(t){const e=t.id;let s=sn[e];return s||(s=new en(t),sn[e]=s,s._compile(),t.on("compile",(()=>{s._compile()})),t.on("destroyed",(()=>{delete sn[e],s._destroy()}))),s}(t.scene),this.model=t,this._buffer=new on(e.maxGeometryBatchSize),this._scratchMemory=e.scratchMemory,this._state=new zt({positionsBuf:null,offsetsBuf:null,colorsBuf:null,flagsBuf:null,flags2Buf:null,positionsDecodeMatrix:c.mat4(),origin:null}),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numSelectedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numClippableLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._modelAABB=c.collapseAABB3(),this._portions=[],this._finalized=!1,this._positionsDecodeMatrix=e.positionsDecodeMatrix,this._preCompressed=!!this._positionsDecodeMatrix,e.origin&&(this._state.origin=c.vec3(e.origin)),this.aabb=c.collapseAABB3()}canCreatePortion(t){if(this._finalized)throw"Already finalized";return this._buffer.positions.length+t<3*this._buffer.maxVerts}createPortion(t){if(this._finalized)throw"Already finalized";const e=t.positions,s=t.color,i=t.colorsCompressed,r=t.colors,o=t.meshMatrix,n=t.worldMatrix,a=t.worldAABB,h=t.pickColor,l=this._buffer,u=l.positions.length/3,p=e.length/3,d=e.length;if(this._preCompressed){for(let t=0,s=e.length;t<s;t++)l.positions.push(e[t]);const t=ve.getPositionsBounds(e),s=ve.decompressPosition(t.min,this._positionsDecodeMatrix,nn),i=ve.decompressPosition(t.max,this._positionsDecodeMatrix,an);a[0]=s[0],a[1]=s[1],a[2]=s[2],a[3]=i[0],a[4]=i[1],a[5]=i[2],n&&(c.AABB3ToOBB3(a,pn),c.transformOBB3(n,pn),c.OBB3ToAABB3(pn,a))}else{const t=l.positions.length;for(let t=0,s=e.length;t<s;t++)l.positions.push(e[t]);if(o)for(let e=t,s=t+d;e<s;e+=3)hn[0]=l.positions[e+0],hn[1]=l.positions[e+1],hn[2]=l.positions[e+2],c.transformPoint4(o,hn,ln),l.positions[e+0]=ln[0],l.positions[e+1]=ln[1],l.positions[e+2]=ln[2],c.expandAABB3Point3(this._modelAABB,ln),n?(c.transformPoint4(n,ln,un),c.expandAABB3Point3(a,un)):c.expandAABB3Point3(a,ln);else for(let e=t,s=t+d;e<s;e+=3)hn[0]=l.positions[e+0],hn[1]=l.positions[e+1],hn[2]=l.positions[e+2],c.expandAABB3Point3(this._modelAABB,hn),n?(c.transformPoint4(n,hn,ln),c.expandAABB3Point3(a,ln)):c.expandAABB3Point3(a,hn)}if(this._state.origin){const t=this._state.origin;a[0]+=t[0],a[1]+=t[1],a[2]+=t[2],a[3]+=t[0],a[4]+=t[1],a[5]+=t[2]}if(c.expandAABB3(this.aabb,a),i)for(let t=0,e=i.length;t<e;t++)l.colors.push(i[t]);else if(r)for(let t=0,e=r.length;t<e;t++)l.colors.push(255*r[t]);else if(s){const t=s[0],e=s[1],i=s[2],r=1;for(let s=0;s<p;s++)l.colors.push(t),l.colors.push(e),l.colors.push(i),l.colors.push(r)}{const t=l.pickColors.length;for(let e=t,s=t+4*p;e<s;e+=4)l.pickColors.push(h[0]),l.pickColors.push(h[1]),l.pickColors.push(h[2]),l.pickColors.push(h[3])}if(this.model.scene.entityOffsetsEnabled)for(let t=0;t<p;t++)l.offsets.push(0),l.offsets.push(0),l.offsets.push(0);const m=this._portions.length/2;return this._portions.push(u),this._portions.push(p),this._numPortions++,this.model.numPortions++,m}finalize(){if(this._finalized)return void this.model.error("Already finalized");const t=this._state,e=this.model.scene.canvas.gl,s=this._buffer;if(s.positions.length>0)if(this._preCompressed){t.positionsDecodeMatrix=this._positionsDecodeMatrix;const i=new Uint16Array(s.positions);t.positionsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.positions.length,3,e.STATIC_DRAW)}else{const i=sr(new Float32Array(s.positions),this._modelAABB,t.positionsDecodeMatrix);t.positionsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.positions.length,3,e.STATIC_DRAW)}if(s.colors.length>0){const i=new Uint8Array(s.colors);let r=!1;t.colorsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.colors.length,4,e.STATIC_DRAW,r)}if(s.positions.length>0){const i=s.positions.length/3*4,r=new Uint8Array(i),o=new Uint8Array(i);let n=!1,a=!0;t.flagsBuf=new Dt(e,e.ARRAY_BUFFER,r,r.length,4,e.DYNAMIC_DRAW,n),t.flags2Buf=new Dt(e,e.ARRAY_BUFFER,o,o.length,4,e.DYNAMIC_DRAW,a)}if(s.pickColors.length>0){const i=new Uint8Array(s.pickColors);let r=!1;t.pickColorsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.pickColors.length,4,e.STATIC_DRAW,r)}if(this.model.scene.entityOffsetsEnabled&&s.offsets.length>0){const i=new Float32Array(s.offsets);t.offsetsBuf=new Dt(e,e.ARRAY_BUFFER,i,s.offsets.length,3,e.DYNAMIC_DRAW)}this._buffer=null,this._finalized=!0}initFlags(t,e,s){e&C&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),e&B&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),e&N&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),e&k&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),e&R&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),e&O&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),e&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(t,e,s),this._setFlags2(t,e)}setVisible(t,e,s){if(!this._finalized)throw"Not finalized";e&C?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(t,e,s)}setHighlighted(t,e,s){if(!this._finalized)throw"Not finalized";e&B?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(t,e,s)}setXRayed(t,e,s){if(!this._finalized)throw"Not finalized";e&N?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(t,e,s)}setSelected(t,e,s){if(!this._finalized)throw"Not finalized";e&k?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(t,e,s)}setEdges(t,e,s){if(!this._finalized)throw"Not finalized"}setClippable(t,e){if(!this._finalized)throw"Not finalized";e&R?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(t,e)}setCulled(t,e,s){if(!this._finalized)throw"Not finalized";e&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(t,e,s)}setCollidable(t,e){if(!this._finalized)throw"Not finalized"}setPickable(t,e,s){if(!this._finalized)throw"Not finalized";e&O?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags(t,e,s)}setColor(t,e){if(!this._finalized)throw"Not finalized";const s=2*t,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=e[0],a=e[1],h=e[2];for(let t=0;t<r;t+=4)o[t+0]=n,o[t+1]=a,o[t+2]=h;this._state.colorsBuf.setData(o,i,r)}setTransparent(t,e,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(t,e,s)}_setFlags(t,e,s){if(!this._finalized)throw"Not finalized";const i=2*t,r=4*this._portions[i],o=4*this._portions[i+1],n=this._scratchMemory.getUInt8Array(o),a=!!(e&C),h=!!(e&N),l=!!(e&F);let u,p;u=!a||l||h?ri:s?ni:oi,p=!a||l?ri:!!(e&k)?hi:!!(e&B)?ai:h?li:ri;let c=a&&!l&&!!(e&O)?fi:ri;for(let t=0;t<o;t+=4)n[t+0]=u,n[t+1]=p,n[t+2]=0,n[t+3]=c;this._state.flagsBuf.setData(n,r,o)}_setFlags2(t,e){if(!this._finalized)throw"Not finalized";const s=2*t,i=4*this._portions[s],r=4*this._portions[s+1],o=this._scratchMemory.getUInt8Array(r),n=e&R?255:0;for(let t=0;t<r;t+=4)o[t+0]=n;this._state.flags2Buf.setData(o,i,r)}setOffset(t,e){if(!this._finalized)throw"Not finalized";if(!this.model.scene.entityOffsetsEnabled)return void this.model.error("Entity#offset not enabled for this Viewer");const s=2*t,i=3*this._portions[s],r=3*this._portions[s+1],o=this._scratchMemory.getFloat32Array(r),n=e[0],a=e[1],h=e[2];for(let t=0;t<r;t+=3)o[t+0]=n,o[t+1]=a,o[t+2]=h;this._state.offsetsBuf.setData(o,i,r)}drawColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(e,this,oi)}drawColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsBatchingRenderers.colorRenderer&&this._pointsBatchingRenderers.colorRenderer.drawLayer(e,this,ni)}drawDepth(t,e){}drawNormals(t,e){}drawSilhouetteXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(e,this,li)}drawSilhouetteHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(e,this,ai)}drawSilhouetteSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsBatchingRenderers.silhouetteRenderer&&this._pointsBatchingRenderers.silhouetteRenderer.drawLayer(e,this,hi)}drawEdgesColorOpaque(t,e){}drawEdgesColorTransparent(t,e){}drawEdgesHighlighted(t,e){}drawEdgesSelected(t,e){}drawEdgesXRayed(t,e){}drawPickMesh(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickMeshRenderer&&this._pointsBatchingRenderers.pickMeshRenderer.drawLayer(e,this,fi)}drawPickDepths(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.pickDepthRenderer&&this._pointsBatchingRenderers.pickDepthRenderer.drawLayer(e,this,fi)}drawPickNormals(t,e){}drawOcclusion(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsBatchingRenderers.occlusionRenderer&&this._pointsBatchingRenderers.occlusionRenderer.drawLayer(e,this,oi)}drawShadow(t,e){}destroy(){const t=this._state;t.positionsBuf&&(t.positionsBuf.destroy(),t.positionsBuf=null),t.offsetsBuf&&(t.offsetsBuf.destroy(),t.offsetsBuf=null),t.colorsBuf&&(t.colorsBuf.destroy(),t.colorsBuf=null),t.flagsBuf&&(t.flagsBuf.destroy(),t.flagsBuf=null),t.flags2Buf&&(t.flags2Buf.destroy(),t.flags2Buf=null),t.pickColorsBuf&&(t.pickColorsBuf.destroy(),t.pickColorsBuf=null),t.destroy()}}const dn=c.vec3();class mn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin,u=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aColor.bindArrayBuffer(a.colorsBuf),u.filterIntensity&&n.uniform2f(this._uIntensityRange,u.minIntensity,u.maxIntensity);const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,dn);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.uniform1f(this._uPointSize,u.pointSize);const c="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,c),h.drawArraysInstancedANGLE(n.POINTS,0,a.positionsBuf.numItems,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.pointsMaterial._state,s=t.canvas.gl;if(this._program=new Mt(s,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=s.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,s=t._sectionPlanesState.sectionPlanes.length;e<s;e++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+e),pos:i.getLocation("sectionPlanePos"+e),dir:i.getLocation("sectionPlaneDir"+e)});this._aPosition=i.getAttribute("position"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aOffset=i.getAttribute("offset"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uOcclusionTexture="uOcclusionTexture",this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),e.filterIntensity&&(this._uIntensityRange=i.getLocation("intensityRange")),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points instancing color vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),s.filterIntensity&&i.push("uniform vec2 intensityRange;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vColor;"),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),s.filterIntensity&&(i.push("float intensity = float(color.a) / 255.0;"),i.push("if (intensity < intensityRange[0] || intensity > intensityRange[1]) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {")),i.push("vec4 worldPosition =  positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("vColor = vec4(float(color.r) / 255.0, float(color.g) / 255.0, float(color.b) / 255.0, 1.0);"),e&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),s.filterIntensity&&i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points instancing color fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vColor;"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   gl_FragColor = vColor;"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const fn=c.vec3();class gn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin,u=r.pointsMaterial._state;if(!this._program&&(this._allocate(e.model.scene),this.errors))return;if(t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),s===li){const t=r.xrayMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===ai){const t=r.highlightMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else if(s===hi){const t=r.selectedMaterial._state,e=t.fillColor,s=t.fillAlpha;n.uniform4f(this._uColor,e[0],e[1],e[2],s)}else n.uniform4fv(this._uColor,c.vec3([1,1,1]));n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,fn);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf,n.UNSIGNED_BYTE,!0),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.uniform1f(this._uPointSize,u.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d),h.drawArraysInstancedANGLE(n.POINTS,0,a.positionsBuf.numItems,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uColor=i.getLocation("color"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points instancing silhouette vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),i.push("uniform vec4 color;"),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.y) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points instancing silhouette fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("uniform vec4 color;"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = color;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const _n=c.vec3();class yn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin,u=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t)),n.uniform1i(this._uRenderPass,s);const p=t.pickViewMatrix||o.viewMatrix,c=l?U(p,l):p;if(n.uniformMatrix4fv(this._uViewMatrix,!1,c),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),r.logarithmicDepthBufferEnabled){const t=2/(Math.log(o.project.far+1)/Math.LN2);n.uniform1f(this._uLogDepthBufFC,t)}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPickColor.bindArrayBuffer(a.pickColorsBuf),h.vertexAttribDivisorANGLE(this._aPickColor.location,1),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),n.uniform1f(this._uPointSize,u.pointSize);const d="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,d);const m=r._sectionPlanesState.sectionPlanes.length;if(m>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*m,o=i.renderFlags;for(let e=0;e<m;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,_n);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}h.drawArraysInstancedANGLE(n.POINTS,0,a.positionsBuf.numItems,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aPickColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uPickInvisible=i.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._uRenderPass=i.getLocation("renderPass"),this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aPickColor=i.getAttribute("pickColor"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(t){const e=this._scene.canvas.gl;this._program.bind(),e.uniform1i(this._uPickInvisible,t.pickInvisible)}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points instancing pick mesh vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 pickColor;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),i.push("  vPickColor = vec4(float(pickColor.r) / 255.0, float(pickColor.g) / 255.0, float(pickColor.b) / 255.0, float(pickColor.a) / 255.0);"),e&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points instancing pick mesh fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vPickColor;"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("gl_FragColor = vPickColor; "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const vn=c.vec3();class bn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.canvas.gl,n=e._state,a=this._instanceExt,h=e._state.origin,l=r.pointsMaterial._state;if(!this._program&&(this._allocate(e),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram());const u=r.camera;o.uniform1i(this._uRenderPass,s),o.uniform1i(this._uPickInvisible,t.pickInvisible);const p=t.pickViewMatrix||u.viewMatrix,c=h?U(p,h):p;if(o.uniformMatrix4fv(this._uViewMatrix,!1,c),o.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),o.uniformMatrix4fv(this._uProjMatrix,!1,t.pickProjMatrix),o.uniform1f(this._uPickZNear,t.pickZNear),o.uniform1f(this._uPickZFar,t.pickZFar),r.logarithmicDepthBufferEnabled){const e=2/(Math.log(t.pickZFar+1)/Math.LN2);o.uniform1f(this._uLogDepthBufFC,e)}const d=r._sectionPlanesState.sectionPlanes.length;if(d>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*d,n=i.renderFlags;for(let e=0;e<d;e++){const i=this._uSectionPlanes[e];if(i){const r=n.sectionPlanesActivePerLayer[s+e];if(o.uniform1i(i.active,r?1:0),r){const s=t[e];if(h){const t=Y(s.dist,s.dir,h,vn);o.uniform3fv(i.pos,t)}else o.uniform3fv(i.pos,s.pos);o.uniform3fv(i.dir,s.dir)}}}}o.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(n.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(n.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(n.modelMatrixCol2Buf),a.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),a.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),a.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(n.positionsBuf),this._aFlags.bindArrayBuffer(n.flagsBuf),a.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(n.flags2Buf),a.vertexAttribDivisorANGLE(this._aFlags2.location,1)),this._aOffset&&(this._aOffset.bindArrayBuffer(n.offsetsBuf),a.vertexAttribDivisorANGLE(this._aOffset.location,1)),o.uniform1f(this._uPointSize,l.pointSize);const m="ortho"===r.camera.projection?1:o.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));o.uniform1f(this._uNearPlaneHeight,m),a.drawArraysInstancedANGLE(o.POINTS,0,n.positionsBuf.numItems,n.numInstances),a.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),a.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),a.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),a.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&a.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&a.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPickInvisible=s.getLocation("pickInvisible"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPickZNear=s.getLocation("pickZNear"),this._uPickZFar=s.getLocation("pickZFar"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){this._program.bind()}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points instancing pick depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform bool pickInvisible;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("varying vec4 vViewPosition;"),i.push("void main(void) {"),i.push("if (int(flags.w) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(i.push("  vWorldPosition = worldPosition;"),i.push("  vFlags2 = flags2;")),i.push("  vViewPosition = viewPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points instancing pick depth fragment shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),i.push("uniform float pickZNear;"),i.push("uniform float pickZFar;"),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec4 vViewPosition;"),i.push("vec4 packDepth(const in float depth) {"),i.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),i.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),i.push("  vec4 res = fract(depth * bitShift);"),i.push("  res -= res.xxyz * bitMask;"),i.push("  return res;"),i.push("}"),i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    float zNormalizedDepth = abs((pickZNear + vViewPosition.z) / (pickZFar - pickZNear));"),i.push("    gl_FragColor = packDepth(zNormalizedDepth); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Pn=c.vec3();class Tn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin,u=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix);const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,Pn);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aColor&&(this._aColor.bindArrayBuffer(a.colorsBuf),h.vertexAttribDivisorANGLE(this._aColor.location,1)),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),n.uniform1f(this._uPointSize,u.pointSize);const c="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,c),h.drawArraysInstancedANGLE(n.POINTS,0,a.positionsBuf.numItems,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),this._aColor&&h.vertexAttribDivisorANGLE(this._aColor.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uRenderPass=i.getLocation("renderPass"),this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=i.getLocation("worldMatrix"),this._uViewMatrix=i.getLocation("viewMatrix"),this._uProjMatrix=i.getLocation("projMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize"),this._uNearPlaneHeight=i.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=i.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points instancing occlusion vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 color;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("      gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),e&&i.push("  vWorldPosition = worldPosition;"),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Points instancing occlusion vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("void main(void) {"),t.pointsMaterial.roundPoints&&(i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }")),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0;t<e.sectionPlanes.length;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return i.push("   gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0); "),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const wn=c.vec3();class xn{constructor(t){this._scene=t,this._hash=this._getHash(),this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()+this._scene.pointsMaterial.hash}drawLayer(t,e,s){const i=e.model,r=i.scene,o=r.camera,n=r.canvas.gl,a=e._state,h=this._instanceExt,l=e._state.origin,u=r.pointsMaterial._state;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram()),n.uniform1i(this._uRenderPass,s),n.uniformMatrix4fv(this._uWorldMatrix,!1,i.worldMatrix),n.uniformMatrix4fv(this._uViewMatrix,!1,l?U(o.viewMatrix,l):o.viewMatrix);const p=r._sectionPlanesState.sectionPlanes.length;if(p>0){const t=r._sectionPlanesState.sectionPlanes,s=e.layerIndex*p,o=i.renderFlags;for(let e=0;e<p;e++){const i=this._uSectionPlanes[e];if(i){const r=o.sectionPlanesActivePerLayer[s+e];if(n.uniform1i(i.active,r?1:0),r){const s=t[e];if(l){const t=Y(s.dist,s.dir,l,wn);n.uniform3fv(i.pos,t)}else n.uniform3fv(i.pos,s.pos);n.uniform3fv(i.dir,s.dir)}}}}this._aModelMatrixCol0.bindArrayBuffer(a.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(a.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(a.modelMatrixCol2Buf),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),n.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aPosition.bindArrayBuffer(a.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(a.offsetsBuf),h.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aFlags.bindArrayBuffer(a.flagsBuf),h.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(a.flags2Buf),h.vertexAttribDivisorANGLE(this._aFlags2.location,1)),n.uniform1f(this._uPointSize,u.pointSize);const c="ortho"===r.camera.projection?1:n.drawingBufferHeight/(2*Math.tan(.5*r.camera.perspective.fov*Math.PI/180));n.uniform1f(this._uNearPlaneHeight,c),h.drawArraysInstancedANGLE(n.POINTS,0,a.positionsBuf.numItems,a.numInstances),h.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),h.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),h.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&h.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&h.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const s=this._program;this._uRenderPass=s.getLocation("renderPass"),this._uPositionsDecodeMatrix=s.getLocation("positionsDecodeMatrix"),this._uWorldMatrix=s.getLocation("worldMatrix"),this._uViewMatrix=s.getLocation("viewMatrix"),this._uProjMatrix=s.getLocation("projMatrix"),this._uSectionPlanes=[];for(let e=0,i=t._sectionPlanesState.sectionPlanes.length;e<i;e++)this._uSectionPlanes.push({active:s.getLocation("sectionPlaneActive"+e),pos:s.getLocation("sectionPlanePos"+e),dir:s.getLocation("sectionPlaneDir"+e)});this._aPosition=s.getAttribute("position"),this._aOffset=s.getAttribute("offset"),this._aFlags=s.getAttribute("flags"),this._aFlags2=s.getAttribute("flags2"),this._aModelMatrixCol0=s.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=s.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=s.getAttribute("modelMatrixCol2"),this._uPointSize=s.getLocation("pointSize"),this._uNearPlaneHeight=s.getLocation("nearPlaneHeight"),t.logarithmicDepthBufferEnabled&&(this._uLogDepthBufFC=s.getLocation("logDepthBufFC"))}_bindProgram(){const t=this._scene,e=t.canvas.gl,s=t.camera.project;if(this._program.bind(),e.uniformMatrix4fv(this._uProjMatrix,!1,s.matrix),t.logarithmicDepthBufferEnabled){const t=2/(Math.log(s.far+1)/Math.LN2);e.uniform1f(this._uLogDepthBufFC,t)}}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=t.pointsMaterial._state,i=[];return i.push("// Points instancing depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("uniform int renderPass;"),i.push("attribute vec3 position;"),t.entityOffsetsEnabled&&i.push("attribute vec3 offset;"),i.push("attribute vec4 flags;"),i.push("attribute vec4 flags2;"),i.push("attribute vec4 modelMatrixCol0;"),i.push("attribute vec4 modelMatrixCol1;"),i.push("attribute vec4 modelMatrixCol2;"),i.push("uniform mat4 worldMatrix;"),i.push("uniform mat4 viewMatrix;"),i.push("uniform mat4 projMatrix;"),i.push("uniform mat4 positionsDecodeMatrix;"),i.push("uniform float pointSize;"),s.perspectivePoints&&i.push("uniform float nearPlaneHeight;"),t.logarithmicDepthBufferEnabled&&(i.push("uniform float logDepthBufFC;"),pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("varying float vFragDepth;")),e&&(i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;")),i.push("void main(void) {"),i.push("if (int(flags.x) != renderPass) {"),i.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),i.push("} else {"),i.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),i.push("  worldPosition = worldMatrix * vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&i.push("      worldPosition.xyz = worldPosition.xyz + offset;"),i.push("  vec4 viewPosition  = viewMatrix * worldPosition; "),e&&(i.push("vWorldPosition = worldPosition;"),i.push("vFlags2 = flags2;")),i.push("vec4 clipPos = projMatrix * viewPosition;"),t.logarithmicDepthBufferEnabled&&(pt.SUPPORTED_EXTENSIONS.EXT_frag_depth?i.push("vFragDepth = 1.0 + clipPos.w;"):(i.push("clipPos.z = log2( max( 1e-6, clipPos.w + 1.0 ) ) * logDepthBufFC - 1.0;"),i.push("clipPos.z *= clipPos.w;"))),i.push("gl_Position = clipPos;"),s.perspectivePoints?(i.push("gl_PointSize = (nearPlaneHeight * pointSize) / clipPos.w;"),i.push("gl_PointSize = max(gl_PointSize, "+Math.floor(s.minPerspectivePointSize)+".0);"),i.push("gl_PointSize = min(gl_PointSize, "+Math.floor(s.maxPerspectivePointSize)+".0);")):i.push("gl_PointSize = pointSize;"),i.push("}"),i.push("}"),i}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState;let s,i;const r=e.sectionPlanes.length>0,o=[];if(o.push("// Points instancing depth vertex shader"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("#extension GL_EXT_frag_depth : enable"),o.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),o.push("precision highp float;"),o.push("precision highp int;"),o.push("#else"),o.push("precision mediump float;"),o.push("precision mediump int;"),o.push("#endif"),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(o.push("uniform float logDepthBufFC;"),o.push("varying float vFragDepth;")),r)for(o.push("varying vec4 vWorldPosition;"),o.push("varying vec4 vFlags2;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("uniform bool sectionPlaneActive"+s+";"),o.push("uniform vec3 sectionPlanePos"+s+";"),o.push("uniform vec3 sectionPlaneDir"+s+";");if(o.push("const float   packUpScale = 256. / 255.;"),o.push("const float   unpackDownscale = 255. / 256.;"),o.push("const vec3    packFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );"),o.push("const vec4    unpackFactors = unpackDownscale / vec4( packFactors, 1. );"),o.push("const float   shiftRight8 = 1.0 / 256.;"),o.push("vec4 packDepthToRGBA( const in float v ) {"),o.push("    vec4 r = vec4( fract( v * packFactors ), v );"),o.push("    r.yzw -= r.xyz * shiftRight8;"),o.push("    return r * packUpScale;"),o.push("}"),o.push("void main(void) {"),t.pointsMaterial.roundPoints&&(o.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),o.push("  float r = dot(cxy, cxy);"),o.push("  if (r > 1.0) {"),o.push("       discard;"),o.push("  }")),r){for(o.push("  bool clippable = (float(vFlags2.x) > 0.0);"),o.push("  if (clippable) {"),o.push("  float dist = 0.0;"),s=0,i=e.sectionPlanes.length;s<i;s++)o.push("if (sectionPlaneActive"+s+") {"),o.push("   dist += clamp(dot(-sectionPlaneDir"+s+".xyz, vWorldPosition.xyz - sectionPlanePos"+s+".xyz), 0.0, 1000.0);"),o.push("}");o.push("if (dist > 0.0) { discard; }"),o.push("}")}return o.push("    gl_FragColor = packDepthToRGBA( gl_FragCoord.z); "),t.logarithmicDepthBufferEnabled&&pt.SUPPORTED_EXTENSIONS.EXT_frag_depth&&o.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),o.push("}"),o}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}const Mn=c.vec3();class Dn{constructor(t){this._scene=t,this._hash=this._getHash(),this._lastLightId=null,this._allocate()}getValid(){return this._hash===this._getHash()}_getHash(){return this._scene._sectionPlanesState.getHash()}drawLayer(t,e){const s=e.model,i=s.scene,r=i.canvas.gl,o=e._state,n=this._instanceExt;if(!this._program&&(this._allocate(),this.errors))return;t.lastProgramId!==this._program.id&&(t.lastProgramId=this._program.id,this._bindProgram(t,e)),r.uniformMatrix4fv(this._uPositionsDecodeMatrix,!1,e._state.positionsDecodeMatrix),this._aModelMatrixCol0.bindArrayBuffer(o.modelMatrixCol0Buf),this._aModelMatrixCol1.bindArrayBuffer(o.modelMatrixCol1Buf),this._aModelMatrixCol2.bindArrayBuffer(o.modelMatrixCol2Buf),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,1),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,1),this._aPosition.bindArrayBuffer(o.positionsBuf),this._aOffset&&(this._aOffset.bindArrayBuffer(o.offsetsBuf),n.vertexAttribDivisorANGLE(this._aOffset.location,1)),this._aColor.bindArrayBuffer(o.colorsBuf),n.vertexAttribDivisorANGLE(this._aColor.location,1),this._aFlags.bindArrayBuffer(o.flagsBuf),n.vertexAttribDivisorANGLE(this._aFlags.location,1),this._aFlags2&&(this._aFlags2.bindArrayBuffer(o.flags2Buf),n.vertexAttribDivisorANGLE(this._aFlags2.location,1));const a=i._sectionPlanesState.sectionPlanes.length;if(a>0){const t=i._sectionPlanesState.sectionPlanes,o=e.layerIndex*a,n=s.renderFlags,h=e._state.origin;for(let e=0;e<a;e++){const s=this._uSectionPlanes[e];if(s){const i=n.sectionPlanesActivePerLayer[o+e];if(r.uniform1i(s.active,i?1:0),i){const i=t[e];if(h){const t=Y(i.dist,i.dir,h,Mn);r.uniform3fv(s.pos,t)}else r.uniform3fv(s.pos,i.pos);r.uniform3fv(s.dir,i.dir)}}}}r.uniform1f(this._uPointSize,10),n.drawArraysInstancedANGLE(r.POINTS,0,o.positionsBuf.numItems,o.numInstances),n.vertexAttribDivisorANGLE(this._aModelMatrixCol0.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol1.location,0),n.vertexAttribDivisorANGLE(this._aModelMatrixCol2.location,0),n.vertexAttribDivisorANGLE(this._aColor.location,0),n.vertexAttribDivisorANGLE(this._aFlags.location,0),this._aFlags2&&n.vertexAttribDivisorANGLE(this._aFlags2.location,0),this._aOffset&&n.vertexAttribDivisorANGLE(this._aOffset.location,0)}_allocate(){const t=this._scene,e=t.canvas.gl,s=t._sectionPlanesState;if(this._program=new Mt(e,this._buildShader()),this._program.errors)return void(this.errors=this._program.errors);this._instanceExt=e.getExtension("ANGLE_instanced_arrays");const i=this._program;this._uPositionsDecodeMatrix=i.getLocation("positionsDecodeMatrix"),this._uShadowViewMatrix=i.getLocation("shadowViewMatrix"),this._uShadowProjMatrix=i.getLocation("shadowProjMatrix"),this._uSectionPlanes=[];for(let t=0,e=s.sectionPlanes.length;t<e;t++)this._uSectionPlanes.push({active:i.getLocation("sectionPlaneActive"+t),pos:i.getLocation("sectionPlanePos"+t),dir:i.getLocation("sectionPlaneDir"+t)});this._aPosition=i.getAttribute("position"),this._aOffset=i.getAttribute("offset"),this._aColor=i.getAttribute("color"),this._aFlags=i.getAttribute("flags"),this._aFlags2=i.getAttribute("flags2"),this._aModelMatrixCol0=i.getAttribute("modelMatrixCol0"),this._aModelMatrixCol1=i.getAttribute("modelMatrixCol1"),this._aModelMatrixCol2=i.getAttribute("modelMatrixCol2"),this._uPointSize=i.getLocation("pointSize")}_bindProgram(t,e){const s=this._scene.canvas.gl;this._program.bind(),s.uniformMatrix4fv(this._uShadowViewMatrix,!1,t.shadowViewMatrix),s.uniformMatrix4fv(this._uShadowProjMatrix,!1,t.shadowProjMatrix),this._lastLightId=null}_buildShader(){return{vertex:this._buildVertexShader(),fragment:this._buildFragmentShader()}}_buildVertexShader(){const t=this._scene,e=t._sectionPlanesState.sectionPlanes.length>0,s=[];return s.push("// Instancing geometry shadow drawing vertex shader"),s.push("attribute vec3 position;"),t.entityOffsetsEnabled&&s.push("attribute vec3 offset;"),s.push("attribute vec4 color;"),s.push("attribute vec4 flags;"),s.push("attribute vec4 flags2;"),s.push("attribute vec4 modelMatrixCol0;"),s.push("attribute vec4 modelMatrixCol1;"),s.push("attribute vec4 modelMatrixCol2;"),s.push("uniform mat4 shadowViewMatrix;"),s.push("uniform mat4 shadowProjMatrix;"),s.push("uniform mat4 positionsDecodeMatrix;"),s.push("uniform float pointSize;"),e&&(s.push("varying vec4 vWorldPosition;"),s.push("varying vec4 vFlags2;")),s.push("void main(void) {"),s.push("bool visible      = (float(flags.x) > 0.0);"),s.push("bool transparent  = ((float(color.a) / 255.0) < 1.0);"),s.push("if (!visible || transparent) {"),s.push("   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);"),s.push("} else {"),s.push("  vec4 worldPosition = positionsDecodeMatrix * vec4(position, 1.0); "),s.push("  worldPosition = vec4(dot(worldPosition, modelMatrixCol0), dot(worldPosition, modelMatrixCol1), dot(worldPosition, modelMatrixCol2), 1.0);"),t.entityOffsetsEnabled&&s.push("      worldPosition.xyz = worldPosition.xyz + offset;"),s.push("  vec4 viewPosition  = shadowViewMatrix * worldPosition; "),e&&(s.push("vWorldPosition = worldPosition;"),s.push("vFlags2 = flags2;")),s.push("  gl_Position = shadowProjMatrix * viewPosition;"),s.push("}"),s.push("gl_PointSize = pointSize;"),s.push("}"),s}_buildFragmentShader(){const t=this._scene,e=t._sectionPlanesState,s=e.sectionPlanes.length>0,i=[];if(i.push("// Instancing geometry depth drawing fragment shader"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("#extension GL_EXT_frag_depth : enable"),i.push("#ifdef GL_FRAGMENT_PRECISION_HIGH"),i.push("precision highp float;"),i.push("precision highp int;"),i.push("#else"),i.push("precision mediump float;"),i.push("precision mediump int;"),i.push("#endif"),t.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&(i.push("uniform float logDepthBufFC;"),i.push("varying float vFragDepth;")),s){i.push("varying vec4 vWorldPosition;"),i.push("varying vec4 vFlags2;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("uniform bool sectionPlaneActive"+t+";"),i.push("uniform vec3 sectionPlanePos"+t+";"),i.push("uniform vec3 sectionPlaneDir"+t+";")}if(i.push("varying vec3 vViewNormal;"),i.push("vec3 packNormalToRGB( const in vec3 normal ) {"),i.push("    return normalize( normal ) * 0.5 + 0.5;"),i.push("}"),i.push("void main(void) {"),i.push("  vec2 cxy = 2.0 * gl_PointCoord - 1.0;"),i.push("  float r = dot(cxy, cxy);"),i.push("  if (r > 1.0) {"),i.push("       discard;"),i.push("  }"),s){i.push("  bool clippable = (float(vFlags2.x) > 0.0);"),i.push("  if (clippable) {"),i.push("  float dist = 0.0;");for(let t=0,s=e.sectionPlanes.length;t<s;t++)i.push("if (sectionPlaneActive"+t+") {"),i.push("   dist += clamp(dot(-sectionPlaneDir"+t+".xyz, vWorldPosition.xyz - sectionPlanePos"+t+".xyz), 0.0, 1000.0);"),i.push("}");i.push("if (dist > 0.0) { discard; }"),i.push("}")}return t.logarithmicDepthBufferEnabled&&WEBGL_INFO.SUPPORTED_EXTENSIONS.EXT_frag_depth&&i.push("gl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;"),i.push("    gl_FragColor = vec4(packNormalToRGB(vViewNormal), 1.0); "),i.push("}"),i}webglContextRestored(){this._program=null}destroy(){this._program&&this._program.destroy(),this._program=null}}class En{constructor(t){this._scene=t}_compile(){this._colorRenderer&&!this._colorRenderer.getValid()&&(this._colorRenderer.destroy(),this._colorRenderer=null),this._depthRenderer&&!this._depthRenderer.getValid()&&(this._depthRenderer.destroy(),this._depthRenderer=null),this._silhouetteRenderer&&!this._silhouetteRenderer.getValid()&&(this._silhouetteRenderer.destroy(),this._silhouetteRenderer=null),this._pickMeshRenderer&&!this._pickMeshRenderer.getValid()&&(this._pickMeshRenderer.destroy(),this._pickMeshRenderer=null),this._pickDepthRenderer&&!this._pickDepthRenderer.getValid()&&(this._pickDepthRenderer.destroy(),this._pickDepthRenderer=null),this._occlusionRenderer&&!1===this._occlusionRenderer.getValid()&&(this._occlusionRenderer.destroy(),this._occlusionRenderer=null),this._shadowRenderer&&!this._shadowRenderer.getValid()&&(this._shadowRenderer.destroy(),this._shadowRenderer=null)}get colorRenderer(){return this._colorRenderer||(this._colorRenderer=new mn(this._scene,!1)),this._colorRenderer}get silhouetteRenderer(){return this._silhouetteRenderer||(this._silhouetteRenderer=new gn(this._scene)),this._silhouetteRenderer}get depthRenderer(){return this._depthRenderer||(this._depthRenderer=new xn(this._scene)),this._depthRenderer}get pickMeshRenderer(){return this._pickMeshRenderer||(this._pickMeshRenderer=new yn(this._scene)),this._pickMeshRenderer}get pickDepthRenderer(){return this._pickDepthRenderer||(this._pickDepthRenderer=new bn(this._scene)),this._pickDepthRenderer}get occlusionRenderer(){return this._occlusionRenderer||(this._occlusionRenderer=new Tn(this._scene)),this._occlusionRenderer}get shadowRenderer(){return this._shadowRenderer||(this._shadowRenderer=new Dn(this._scene)),this._shadowRenderer}_destroy(){this._colorRenderer&&this._colorRenderer.destroy(),this._depthRenderer&&this._depthRenderer.destroy(),this._silhouetteRenderer&&this._silhouetteRenderer.destroy(),this._pickMeshRenderer&&this._pickMeshRenderer.destroy(),this._pickDepthRenderer&&this._pickDepthRenderer.destroy(),this._occlusionRenderer&&this._occlusionRenderer.destroy(),this._shadowRenderer&&this._shadowRenderer.destroy()}}const In={};const Sn=new Uint8Array(4),An=c.vec4([0,0,0,1]),Cn=c.vec4([0,0,0,1]),Fn=c.vec4([0,0,0,1]),On=new Float32Array(3);class Rn{constructor(t,e){this.sortId="PointsInstancingLayer",this.layerIndex=e.layerIndex,this._pointsInstancingRenderers=function(t){const e=t.id;let s=In[e];return s||(s=new En(t),In[e]=s,s._compile(),t.on("compile",(()=>{s._compile()})),t.on("destroyed",(()=>{delete In[e],s._destroy()}))),s}(t.scene),this.model=t,this._aabb=c.collapseAABB3();const s=t.scene.canvas.gl,i={positionsDecodeMatrix:c.mat4(),numInstances:0,obb:c.OBB3(),origin:null},r=!!e.positionsDecodeMatrix;if(!e.positions)throw"positions expected";const o=e.positions.length/3;if(r){let t=!1;i.positionsBuf=new Dt(s,s.ARRAY_BUFFER,e.positions,e.positions.length,3,s.STATIC_DRAW,t),i.positionsDecodeMatrix.set(e.positionsDecodeMatrix);let r=c.collapseAABB3();c.expandAABB3Points3(r,e.positions),ve.decompressAABB(r,i.positionsDecodeMatrix),c.AABB3ToOBB3(r,i.obb)}else{let t=e.positions.length,r=c.collapseAABB3();c.expandAABB3Points3(r,e.positions),c.AABB3ToOBB3(r,i.obb);const o=sr(e.positions,r,i.positionsDecodeMatrix);let n=!1;i.positionsBuf=new Dt(s,s.ARRAY_BUFFER,o,t,3,s.STATIC_DRAW,n)}if(e.colorsCompressed){const t=new Uint8Array(e.colorsCompressed);let r=!1;i.colorsBuf=new Dt(s,s.ARRAY_BUFFER,t,t.length,4,s.STATIC_DRAW,r)}else if(e.colors){const t=e.colors,r=new Uint8Array(t.length);for(let e=0,s=t.length;e<s;e++)r[e]=255*t[e];let o=!1;i.colorsBuf=new Dt(s,s.ARRAY_BUFFER,r,r.length,4,s.STATIC_DRAW,o)}else{const t=new Uint8Array(4*o);for(let e=0,s=4*o;e<s;e++)t[e]=255;let e=!1;i.colorsBuf=new Dt(s,s.ARRAY_BUFFER,t,t.length,4,s.STATIC_DRAW,e)}this._state=new zt(i),this._numPortions=0,this._numVisibleLayerPortions=0,this._numTransparentLayerPortions=0,this._numXRayedLayerPortions=0,this._numHighlightedLayerPortions=0,this._numSelectedLayerPortions=0,this._numClippableLayerPortions=0,this._numEdgesLayerPortions=0,this._numPickableLayerPortions=0,this._numCulledLayerPortions=0,this._pickColors=[],this._offsets=[],this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[],this._portions=[],e.origin&&(this._state.origin=c.vec3(e.origin)),this._finalized=!1,this.aabb=c.collapseAABB3()}createPortion(t){const e=t.meshMatrix,s=t.worldMatrix,i=t.aabb,r=t.pickColor;if(this._finalized)throw"Already finalized";this.model.scene.entityOffsetsEnabled&&(this._offsets.push(0),this._offsets.push(0),this._offsets.push(0)),this._modelMatrixCol0.push(e[0]),this._modelMatrixCol0.push(e[4]),this._modelMatrixCol0.push(e[8]),this._modelMatrixCol0.push(e[12]),this._modelMatrixCol1.push(e[1]),this._modelMatrixCol1.push(e[5]),this._modelMatrixCol1.push(e[9]),this._modelMatrixCol1.push(e[13]),this._modelMatrixCol2.push(e[2]),this._modelMatrixCol2.push(e[6]),this._modelMatrixCol2.push(e[10]),this._modelMatrixCol2.push(e[14]),this._pickColors.push(r[0]),this._pickColors.push(r[1]),this._pickColors.push(r[2]),this._pickColors.push(r[3]),c.collapseAABB3(i);const o=this._state.obb,n=o.length;for(let t=0;t<n;t+=4)An[0]=o[t+0],An[1]=o[t+1],An[2]=o[t+2],c.transformPoint4(e,An,Cn),s?(c.transformPoint4(s,Cn,Fn),c.expandAABB3Point3(i,Fn)):c.expandAABB3Point3(i,Cn);if(this._state.origin){const t=this._state.origin;i[0]+=t[0],i[1]+=t[1],i[2]+=t[2],i[3]+=t[0],i[4]+=t[1],i[5]+=t[2]}c.expandAABB3(this.aabb,i),this._state.numInstances++;const a=this._portions.length;return this._portions.push({}),this._numPortions++,this.model.numPortions++,a}finalize(){if(this._finalized)throw"Already finalized";const t=this.model.scene.canvas.gl,e=this._pickColors.length;if(e>0){let s=!1,i=!0;this._state.flagsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(e),e,4,t.DYNAMIC_DRAW,s),this._state.flags2Buf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(e),e,4,t.DYNAMIC_DRAW,i)}if(this.model.scene.entityOffsetsEnabled&&this._offsets.length>0){const e=!1;this._state.offsetsBuf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._offsets),this._offsets.length,3,t.DYNAMIC_DRAW,e),this._offsets=[]}if(this._modelMatrixCol0.length>0){const e=!1;this._state.modelMatrixCol0Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol0),this._modelMatrixCol0.length,4,t.STATIC_DRAW,e),this._state.modelMatrixCol1Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol1),this._modelMatrixCol1.length,4,t.STATIC_DRAW,e),this._state.modelMatrixCol2Buf=new Dt(t,t.ARRAY_BUFFER,new Float32Array(this._modelMatrixCol2),this._modelMatrixCol2.length,4,t.STATIC_DRAW,e),this._modelMatrixCol0=[],this._modelMatrixCol1=[],this._modelMatrixCol2=[]}if(this._pickColors.length>0){const e=!1;this._state.pickColorsBuf=new Dt(t,t.ARRAY_BUFFER,new Uint8Array(this._pickColors),this._pickColors.length,4,t.STATIC_DRAW,e),this._pickColors=[]}this._finalized=!0}initFlags(t,e,s){e&C&&(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++),e&B&&(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++),e&N&&(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++),e&k&&(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++),e&R&&(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++),e&j&&(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++),e&O&&(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++),e&F&&(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++),this._setFlags(t,e,s),this._setFlags2(t,e)}setVisible(t,e,s){if(!this._finalized)throw"Not finalized";e&C?(this._numVisibleLayerPortions++,this.model.numVisibleLayerPortions++):(this._numVisibleLayerPortions--,this.model.numVisibleLayerPortions--),this._setFlags(t,e,s)}setHighlighted(t,e,s){if(!this._finalized)throw"Not finalized";e&B?(this._numHighlightedLayerPortions++,this.model.numHighlightedLayerPortions++):(this._numHighlightedLayerPortions--,this.model.numHighlightedLayerPortions--),this._setFlags(t,e,s)}setXRayed(t,e,s){if(!this._finalized)throw"Not finalized";e&N?(this._numXRayedLayerPortions++,this.model.numXRayedLayerPortions++):(this._numXRayedLayerPortions--,this.model.numXRayedLayerPortions--),this._setFlags(t,e,s)}setSelected(t,e,s){if(!this._finalized)throw"Not finalized";e&k?(this._numSelectedLayerPortions++,this.model.numSelectedLayerPortions++):(this._numSelectedLayerPortions--,this.model.numSelectedLayerPortions--),this._setFlags(t,e,s)}setEdges(t,e,s){if(!this._finalized)throw"Not finalized";e&j?(this._numEdgesLayerPortions++,this.model.numEdgesLayerPortions++):(this._numEdgesLayerPortions--,this.model.numEdgesLayerPortions--),this._setFlags(t,e,s)}setClippable(t,e){if(!this._finalized)throw"Not finalized";e&R?(this._numClippableLayerPortions++,this.model.numClippableLayerPortions++):(this._numClippableLayerPortions--,this.model.numClippableLayerPortions--),this._setFlags2(t,e)}setCollidable(t,e){if(!this._finalized)throw"Not finalized"}setPickable(t,e,s){if(!this._finalized)throw"Not finalized";e&O?(this._numPickableLayerPortions++,this.model.numPickableLayerPortions++):(this._numPickableLayerPortions--,this.model.numPickableLayerPortions--),this._setFlags2(t,e,s)}setCulled(t,e,s){if(!this._finalized)throw"Not finalized";e&F?(this._numCulledLayerPortions++,this.model.numCulledLayerPortions++):(this._numCulledLayerPortions--,this.model.numCulledLayerPortions--),this._setFlags(t,e,s)}setColor(t,e){if(!this._finalized)throw"Not finalized";Sn[0]=e[0],Sn[1]=e[1],Sn[2]=e[2],this._state.colorsBuf.setData(Sn,3*t,3)}setTransparent(t,e,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(t,e,s)}_setFlags(t,e,s){if(!this._finalized)throw"Not finalized";const i=!!(e&C),r=!!(e&N),o=!!(e&B),n=!!(e&k),a=!!(e&F);let h,l;h=!i||a||r?ri:s?ni:oi,l=!i||a?ri:n?hi:o?ai:r?li:ri;let u=0;u=!i||a?ri:n?di:o?ci:r?mi:!!(e&j)?s?pi:ui:ri;let p=i&&!a&&!!(e&O)?fi:ri;Sn[0]=h,Sn[1]=l,Sn[2]=u,Sn[3]=p,this._state.flagsBuf.setData(Sn,4*t,4)}_setFlags2(t,e){if(!this._finalized)throw"Not finalized";const s=e&R?255:0;Sn[0]=s,this._state.flags2Buf.setData(Sn,4*t,4)}setOffset(t,e){if(!this._finalized)throw"Not finalized";this.model.scene.entityOffsetsEnabled?(On[0]=e[0],On[1]=e[1],On[2]=e[2],this._state.offsetsBuf.setData(On,3*t,3)):this.model.error("Entity#offset not enabled for this Viewer")}drawColorOpaque(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._numTransparentLayerPortions!==this._numPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(e,this,oi)}drawColorTransparent(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numTransparentLayerPortions&&this._numXRayedLayerPortions!==this._numPortions&&this._pointsInstancingRenderers.colorRenderer&&this._pointsInstancingRenderers.colorRenderer.drawLayer(e,this,ni)}drawDepth(t,e){}drawNormals(t,e){}drawSilhouetteXRayed(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numXRayedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(e,this,li)}drawSilhouetteHighlighted(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numHighlightedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(e,this,ai)}drawSilhouetteSelected(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&0!==this._numSelectedLayerPortions&&this._pointsInstancingRenderers.silhouetteRenderer&&this._pointsInstancingRenderers.silhouetteRenderer.drawLayer(e,this,hi)}drawEdgesColorOpaque(t,e){}drawEdgesColorTransparent(t,e){}drawEdgesHighlighted(t,e){}drawEdgesSelected(t,e){}drawEdgesXRayed(t,e){}drawOcclusion(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.occlusionRenderer&&this._pointsInstancingRenderers.occlusionRenderer.drawLayer(e,this,oi)}drawShadow(t,e){}drawPickMesh(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickMeshRenderer&&this._pointsInstancingRenderers.pickMeshRenderer.drawLayer(e,this,fi)}drawPickDepths(t,e){this._numCulledLayerPortions!==this._numPortions&&0!==this._numVisibleLayerPortions&&this._pointsInstancingRenderers.pickDepthRenderer&&this._pointsInstancingRenderers.pickDepthRenderer.drawLayer(e,this,fi)}drawPickNormals(t,e){}destroy(){const t=this._state;t.positionsBuf&&(t.positionsBuf.destroy(),t.positionsBuf=null),t.colorsBuf&&(t.colorsBuf.destroy(),t.colorsBuf=null),t.flagsBuf&&(t.flagsBuf.destroy(),t.flagsBuf=null),t.flags2Buf&&(t.flags2Buf.destroy(),t.flags2Buf=null),t.offsetsBuf&&(t.offsetsBuf.destroy(),t.offsetsBuf=null),t.modelMatrixCol0Buf&&(t.modelMatrixCol0Buf.destroy(),t.modelMatrixCol0Buf=null),t.modelMatrixCol1Buf&&(t.modelMatrixCol1Buf.destroy(),t.modelMatrixCol1Buf=null),t.modelMatrixCol2Buf&&(t.modelMatrixCol2Buf.destroy(),t.modelMatrixCol2Buf=null),t.pickColorsBuf&&(t.pickColorsBuf.destroy(),t.pickColorsBuf=null),t.destroy()}}const Ln=pt.SUPPORTED_EXTENSIONS.ANGLE_instanced_arrays,Nn=c.vec3(),Bn=c.mat4(),kn=c.vec3([1,1,1]),jn=c.vec3([0,0,0]),Gn=c.vec3([0,0,0]),Hn=c.identityQuaternion();class Vn extends A{constructor(t,e={}){super(t,e),this._maxGeometryBatchSize=e.maxGeometryBatchSize,this._aabb=c.collapseAABB3(),this._aabbDirty=!1,this._layerList=[],this._nodeList=[],this._lastOrigin=null,this._lastDecodeMatrix=null,this._lastNormals=null,this._instancingLayers={},this._currentBatchingLayers={},this._scratchMemory=(ii++,si),this._meshes={},this._nodes={},this.renderFlags=new Ts,this.numGeometries=0,this.numPortions=0,this.numVisibleLayerPortions=0,this.numTransparentLayerPortions=0,this.numXRayedLayerPortions=0,this.numHighlightedLayerPortions=0,this.numSelectedLayerPortions=0,this.numEdgesLayerPortions=0,this.numPickableLayerPortions=0,this.numClippableLayerPortions=0,this.numCulledLayerPortions=0,this.numEntities=0,this._numTriangles=0,this._numLines=0,this._numPoints=0,this._edgeThreshold=e.edgeThreshold||10,this.visible=e.visible,this.culled=e.culled,this.pickable=e.pickable,this.clippable=e.clippable,this.collidable=e.collidable,this.castsShadow=e.castsShadow,this.receivesShadow=e.receivesShadow,this.xrayed=e.xrayed,this.highlighted=e.highlighted,this.selected=e.selected,this.edges=e.edges,this.colorize=e.colorize,this.opacity=e.opacity,this.backfaces=e.backfaces,this._origin=new Float64Array(e.origin||[0,0,0]),this._position=new Float32Array(e.position||[0,0,0]),this._rotation=new Float32Array(e.rotation||[0,0,0]),this._quaternion=new Float32Array(e.quaternion||[0,0,0,1]),e.rotation&&c.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._scale=new Float32Array(e.scale||[1,1,1]),this._worldMatrix=c.mat4(),c.composeMat4(this._position,this._quaternion,this._scale,this._worldMatrix),this._worldNormalMatrix=c.mat4(),c.inverseMat4(this._worldMatrix,this._worldNormalMatrix),c.transposeMat4(this._worldNormalMatrix),(e.matrix||e.position||e.rotation||e.scale||e.quaternion)&&(this._viewMatrix=c.mat4(),this._viewNormalMatrix=c.mat4(),this._viewMatrixDirty=!0,this._worldMatrixNonIdentity=!0),this._opacity=1,this._colorize=[1,1,1],this._saoEnabled=!1!==e.saoEnabled,this._pbrEnabled=!!e.pbrEnabled,this._isModel=e.isModel,this._isModel&&this.scene._registerModel(this),this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewMatrixDirty=!0}))}get isPerformanceModel(){return!0}get origin(){return this._origin}get position(){return this._position}get rotation(){return this._rotation}get quaternion(){return this._quaternion}get scale(){return this._scale}get matrix(){return this._worldMatrix}get worldMatrix(){return this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrix}get viewMatrix(){return this._viewMatrix?(this._viewMatrixDirty&&(c.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),c.inverseMat4(this._viewMatrix,this._viewNormalMatrix),c.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewMatrix):this.scene.camera.viewMatrix}get viewNormalMatrix(){return this._viewNormalMatrix?(this._viewMatrixDirty&&(c.mulMat4(this.scene.camera.viewMatrix,this._worldMatrix,this._viewMatrix),c.inverseMat4(this._viewMatrix,this._viewNormalMatrix),c.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}get backfaces(){return this._backfaces}set backfaces(t){t=!!t,this._backfaces=t,this.glRedraw()}get entityList(){return this._nodeList}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return!1}get aabb(){return this._aabbDirty&&this._rebuildAABB(),this._aabb}get numTriangles(){return this._numTriangles}get numLines(){return this._numLines}get numPoints(){return this._numPoints}get visible(){return this.numVisibleLayerPortions>0}set visible(t){t=!1!==t,this._visible=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].visible=t;this.glRedraw()}get xrayed(){return this.numXRayedLayerPortions>0}set xrayed(t){t=!!t,this._xrayed=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].xrayed=t;this.glRedraw()}get highlighted(){return this.numHighlightedLayerPortions>0}set highlighted(t){t=!!t,this._highlighted=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].highlighted=t;this.glRedraw()}get selected(){return this.numSelectedLayerPortions>0}set selected(t){t=!!t,this._selected=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].selected=t;this.glRedraw()}get edges(){return this.numEdgesLayerPortions>0}set edges(t){t=!!t,this._edges=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].edges=t;this.glRedraw()}get culled(){return this._culled}set culled(t){t=!!t,this._culled=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].culled=t;this.glRedraw()}get clippable(){return this._clippable}set clippable(t){t=!1!==t,this._clippable=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].clippable=t;this.glRedraw()}get collidable(){return this._collidable}set collidable(t){t=!1!==t,this._collidable=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].collidable=t}get pickable(){return this.numPickableLayerPortions>0}set pickable(t){t=!1!==t,this._pickable=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].pickable=t}get colorize(){return this._colorize}set colorize(t){this._colorize=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].colorize=t}get opacity(){return this._opacity}set opacity(t){this._opacity=t;for(let e=0,s=this._nodeList.length;e<s;e++)this._nodeList[e].opacity=t}get castsShadow(){return this._castsShadow}set castsShadow(t){(t=!1!==t)!==this._castsShadow&&(this._castsShadow=t,this.glRedraw())}get receivesShadow(){return this._receivesShadow}set receivesShadow(t){(t=!1!==t)!==this._receivesShadow&&(this._receivesShadow=t,this.glRedraw())}get saoEnabled(){return this._saoEnabled}get pbrEnabled(){return this._pbrEnabled}get isDrawable(){return!0}get isStateSortable(){return!1}get xrayMaterial(){return this.scene.xrayMaterial}get highlightMaterial(){return this.scene.highlightMaterial}get selectedMaterial(){return this.scene.selectedMaterial}get edgeMaterial(){return this.scene.edgeMaterial}getPickViewMatrix(t){return this._viewMatrix?this._viewMatrix:t}createGeometry(t){if(!Ln)return void this.error("WebGL instanced arrays not supported");const e=t.id;if(null==e)return void this.error("Config missing: id");if(this._instancingLayers[e])return void this.error("Geometry already created: "+e);let s;const i=t.primitive;if(null==i)return void this.error("Config missing: primitive");const r=t.origin||t.rtcCenter?c.addVec3(this._origin,t.origin||t.rtcCenter,Nn):null;switch(i){case"triangles":case"solid":s=new go(this,_.apply({origin:r,layerIndex:0,solid:!0},t)),this._numTriangles+=t.indices?Math.round(t.indices.length/3):0;break;case"surface":s=new go(this,_.apply({origin:r,layerIndex:0,solid:!1},t)),this._numTriangles+=t.indices?Math.round(t.indices.length/3):0;break;case"lines":s=new zo(this,_.apply({origin:r,layerIndex:0},t)),this._numLines+=t.indices?Math.round(t.indices.length/2):0;break;case"points":s=new Rn(this,_.apply({origin:r,layerIndex:0},t)),this._numPoints+=t.positions?Math.round(t.positions.length/3):0}this._instancingLayers[e]=s,this._layerList.push(s),this.numGeometries++}createMesh(t){let e=t.id;if(null==e)return void this.error("Config missing: id");if(this._meshes[e])return void this.error("PerformanceModel already has a Mesh with this ID: "+e);const s=t.geometryId,i=void 0!==s;if(i){if(!Ln)return void this.error("WebGL instanced arrays not supported");if(!this._instancingLayers[s])return void this.error("Geometry not found: "+s+" - ensure that you create it first with createGeometry()")}let r,o;const n=t.color?new Uint8Array([Math.floor(255*t.color[0]),Math.floor(255*t.color[1]),Math.floor(255*t.color[2])]):[255,255,255],a=void 0!==t.opacity&&null!==t.opacity?Math.floor(255*t.opacity):255,h=void 0!==t.metallic&&null!==t.metallic?Math.floor(255*t.metallic):0,l=void 0!==t.roughness&&null!==t.roughness?Math.floor(255*t.roughness):255,u=new ei(this,e,n,a),p=u.pickId,d=new Uint8Array([255&p,p>>8&255,p>>16&255,p>>24&255]),m=c.collapseAABB3();if(i){let e,i=this._worldMatrixNonIdentity?this._worldMatrix:null;if(t.matrix)e=t.matrix;else{const s=t.scale||kn,i=t.position||jn,r=t.rotation||Gn;c.eulerToQuaternion(r,"XYZ",Hn),e=c.composeMat4(i,Hn,s,Bn)}const p=this._instancingLayers[s];r=p,o=p.createPortion({color:n,metallic:h,roughness:l,opacity:a,meshMatrix:e,worldMatrix:i,aabb:m,pickColor:d}),c.expandAABB3(this._aabb,m);const f=Math.round(p.numIndices/3);this._numTriangles+=f,u.numTriangles=f,u.origin=p.origin}else{let e=t.primitive||"triangles";"points"!==e&&"lines"!==e&&"triangles"!==e&&"solid"!==e&&"surface"!==e&&(this.error(`Unsupported value for 'primitive': '${e}' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.`),e="triangles");let s=t.positions;if(!s)return this.error("Config missing: positions (no meshIds provided, so expecting geometry arrays instead)"),null;let i=t.indices,p=t.edgeIndices;if(!t.indices&&"triangles"===e)return this.error("Config missing for triangles primitive: indices (no meshIds provided, so expecting geometry arrays instead)"),null;let f=!1;const g=t.origin||t.rtcCenter?c.addVec3(this._origin,t.origin||t.rtcCenter,Nn):null;if(g&&(this._lastOrigin?c.compareVec3(this._lastOrigin,g)||(f=!0,this._lastOrigin.set(g)):(f=!0,this._lastOrigin=c.vec3(g))),t.positionsDecodeMatrix&&(this._lastDecodeMatrix?c.compareMat4(this._lastDecodeMatrix,t.positionsDecodeMatrix)||(f=!0,this._lastDecodeMatrix.set(t.positionsDecodeMatrix)):(f=!0,this._lastDecodeMatrix=c.mat4(t.positionsDecodeMatrix))),f){for(let t in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(t)&&this._currentBatchingLayers[t].finalize();this._currentBatchingLayers={}}const _=!!t.normals&&t.normals.length>0;"triangles"!==e&&"solid"!==e&&"surface"!==e||(null!==this._lastNormals&&_!==this._lastNormals&&["triangles","solid","surface"].map((t=>{this._currentBatchingLayers[t]&&(this._currentBatchingLayers[t].finalize(),delete this._currentBatchingLayers[t])})),this._lastNormals=_);const y=this._worldMatrixNonIdentity?this._worldMatrix:null;let v;if(!t.positionsDecodeMatrix)if(t.matrix)v=t.matrix;else{const e=t.scale||kn,s=t.position||jn,i=t.rotation||Gn;c.eulerToQuaternion(i,"XYZ",Hn),v=c.composeMat4(s,Hn,e,Bn)}switch(r=this._currentBatchingLayers[e],e){case"triangles":case"solid":case"surface":r&&(r.canCreatePortion(s.length,i.length)||(r.finalize(),delete this._currentBatchingLayers[e],r=null)),r||(r=new br(this,{layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:t.positionsDecodeMatrix,origin:g,maxGeometryBatchSize:this._maxGeometryBatchSize,solid:"solid"===e,autoNormals:!_}),this._layerList.push(r),this._currentBatchingLayers[e]=r),p||(p=ce(s,i,null,this._edgeThreshold)),o=r.createPortion({positions:s,normals:t.normals,indices:i,edgeIndices:p,color:n,metallic:h,roughness:l,colors:t.colors,colorsCompressed:t.colorsCompressed,opacity:a,meshMatrix:v,worldMatrix:y,worldAABB:m,pickColor:d});const c=Math.round(i.length/3);this._numTriangles+=c,u.numTriangles=c;break;case"lines":r&&(r.canCreatePortion(s.length,i.length)||(r.finalize(),delete this._currentBatchingLayers[e],r=null)),r||(r=new Ao(this,{layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:t.positionsDecodeMatrix,origin:g,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(r),this._currentBatchingLayers[e]=r),o=r.createPortion({positions:s,indices:i,color:n,colors:t.colors,colorsCompressed:t.colorsCompressed,opacity:a,meshMatrix:v,worldMatrix:y,worldAABB:m,pickColor:d}),this._numLines+=Math.round(i.length/2);break;case"points":r&&(r.canCreatePortion(s.length)||(r.finalize(),delete this._currentBatchingLayers[e],r=null)),r||(r=new cn(this,{layerIndex:0,scratchMemory:this._scratchMemory,positionsDecodeMatrix:t.positionsDecodeMatrix,origin:g,maxGeometryBatchSize:this._maxGeometryBatchSize}),this._layerList.push(r),this._currentBatchingLayers[e]=r),o=r.createPortion({positions:s,color:n,colors:t.colors,colorsCompressed:t.colorsCompressed,opacity:a,meshMatrix:v,worldMatrix:y,worldAABB:m,pickColor:d}),this._numPoints+=Math.round(s.length/3)}c.expandAABB3(this._aabb,m),this.numGeometries++,u.origin=g}u.parent=null,u._layer=r,u._portionId=o,u.aabb=m,this._meshes[e]=u}createEntity(t){let e=t.id;void 0===e?e=c.createUUID():this.scene.components[e]&&(this.error("Scene already has a Component with this ID: "+e+" - will assign random ID"),e=c.createUUID());const s=t.meshIds;if(void 0===s)return void this.error("Config missing: meshIds");let i=[];for(let t=0,e=s.length;t<e;t++){const e=s[t],r=this._meshes[e];r?r.parent?this.error("Mesh with ID "+e+" already belongs to object with ID "+r.parent.id+" - ignoring this mesh"):i.push(r):this.error("Mesh with this ID not found: "+e+" - ignoring this mesh")}let r,o=0;if(this._visible&&!1!==t.visible&&(o|=C),this._pickable&&!1!==t.pickable&&(o|=O),this._culled&&!1!==t.culled&&(o|=F),this._clippable&&!1!==t.clippable&&(o|=R),this._collidable&&!1!==t.collidable&&(o|=L),this._edges&&!1!==t.edges&&(o|=j),this._xrayed&&!1!==t.xrayed&&(o|=N),this._highlighted&&!1!==t.highlighted&&(o|=B),this._selected&&!1!==t.selected&&(o|=k),1===i.length)r=i[0].aabb;else{r=c.collapseAABB3();for(let t=0,e=i.length;t<e;t++)c.expandAABB3(r,i[t].aabb)}const n=new V(this,t.isObject,e,i,o,r);return this._nodeList.push(n),this._nodes[e]=n,this.numEntities++,n}finalize(){if(!this.destroyed){for(const t in this._instancingLayers)this._instancingLayers.hasOwnProperty(t)&&this._instancingLayers[t].finalize();for(let t in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(t)&&this._currentBatchingLayers[t].finalize();this._currentBatchingLayers={};for(let t=0,e=this._nodeList.length;t<e;t++){this._nodeList[t]._finalize()}this._layerList.sort(((t,e)=>t.sortId<e.sortId?-1:t.sortId>e.sortId?1:0));for(let t=0,e=this._layerList.length;t<e;t++){this._layerList[t].layerIndex=t}this.glRedraw(),this.scene._aabbDirty=!0}}_rebuildAABB(){c.collapseAABB3(this._aabb);for(let t=0,e=this._nodeList.length;t<e;t++){const e=this._nodeList[t];c.expandAABB3(this._aabb,e.aabb)}this._aabbDirty=!1}stateSortCompare(t,e){}rebuildRenderFlags(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}_updateRenderFlagsVisibleLayers(){const t=this.renderFlags;t.numLayers=this._layerList.length,t.numVisibleLayers=0;for(let e=0,s=this._layerList.length;e<s;e++){const s=this._layerList[e];this._getActiveSectionPlanesForLayer(s)&&(t.visibleLayers[t.numVisibleLayers++]=e)}}_getActiveSectionPlanesForLayer(t){const e=this.renderFlags,s=this.scene._sectionPlanesState.sectionPlanes,i=s.length,r=t.layerIndex*i;if(i>0)for(let t=0;t<i;t++){s[t].active?(e.sectionPlanesActivePerLayer[r+t]=!0,e.sectioned=!0):e.sectionPlanesActivePerLayer[r+t]=!1}return!0}_updateRenderFlags(){if(0===this.numVisibleLayerPortions)return;if(this.numCulledLayerPortions===this.numPortions)return;const t=this.renderFlags;if(t.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(t.colorTransparent=!0),this.numXRayedLayerPortions>0){const e=this.scene.xrayMaterial._state;e.fill&&(e.fillAlpha<1?t.xrayedSilhouetteTransparent=!0:t.xrayedSilhouetteOpaque=!0),e.edges&&(e.edgeAlpha<1?t.xrayedEdgesTransparent=!0:t.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0){this.scene.edgeMaterial._state.edges&&(t.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(t.edgesTransparent=!0))}if(this.numSelectedLayerPortions>0){const e=this.scene.selectedMaterial._state;e.fill&&(e.fillAlpha<1?t.selectedSilhouetteTransparent=!0:t.selectedSilhouetteOpaque=!0),e.edges&&(e.edgeAlpha<1?t.selectedEdgesTransparent=!0:t.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){const e=this.scene.highlightMaterial._state;e.fill&&(e.fillAlpha<1?t.highlightedSilhouetteTransparent=!0:t.highlightedSilhouetteOpaque=!0),e.edges&&(e.edgeAlpha<1?t.highlightedEdgesTransparent=!0:t.highlightedEdgesOpaque=!0)}}drawColorOpaque(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawColorOpaque(e,t)}}drawColorTransparent(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawColorTransparent(e,t)}}drawDepth(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawDepth(e,t)}}drawNormals(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawNormals(e,t)}}drawSilhouetteXRayed(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawSilhouetteXRayed(e,t)}}drawSilhouetteHighlighted(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawSilhouetteHighlighted(e,t)}}drawSilhouetteSelected(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawSilhouetteSelected(e,t)}}drawEdgesColorOpaque(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawEdgesColorOpaque(e,t)}}drawEdgesColorTransparent(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawEdgesColorTransparent(e,t)}}drawEdgesXRayed(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawEdgesXRayed(e,t)}}drawEdgesHighlighted(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawEdgesHighlighted(e,t)}}drawEdgesSelected(t){const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawEdgesSelected(e,t)}}drawOcclusion(t){if(0===this.numVisibleLayerPortions)return;const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawOcclusion(e,t)}}drawShadow(t){if(0===this.numVisibleLayerPortions)return;const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawShadow(e,t)}}drawPickMesh(t){if(0===this.numVisibleLayerPortions)return;const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawPickMesh(e,t)}}drawPickDepths(t){if(0===this.numVisibleLayerPortions)return;const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawPickDepths(e,t)}}drawPickNormals(t){if(0===this.numVisibleLayerPortions)return;const e=this.renderFlags;for(let s=0,i=e.visibleLayers.length;s<i;s++){const i=e.visibleLayers[s];this._layerList[i].drawPickNormals(e,t)}}destroy(){for(let t in this._currentBatchingLayers)this._currentBatchingLayers.hasOwnProperty(t)&&this._currentBatchingLayers[t].destroy();this._currentBatchingLayers={},this.scene.camera.off(this._onCameraViewMatrix);for(let t=0,e=this._layerList.length;t<e;t++)this._layerList[t].destroy();for(let t=0,e=this._nodeList.length;t<e;t++)this._nodeList[t]._destroy();this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),0!==ii&&(ii--,0===ii&&si._clear()),super.destroy()}}const zn=c.vec4(4),Un=c.vec4(),Xn=c.vec4(),Wn=c.vec3([1,0,0]),Yn=c.vec3([0,1,0]),Kn=c.vec3([0,0,1]),Zn=c.vec3(3),qn=c.vec3(3),$n=c.identityMat4();class Qn extends A{constructor(t,e={}){if(super(t,e),this._parentNode=null,this._children=[],this._aabb=null,this._aabbDirty=!0,this.scene._aabbDirty=!0,this._numTriangles=0,this._scale=c.vec3(),this._quaternion=c.identityQuaternion(),this._rotation=c.vec3(),this._position=c.vec3(),this._offset=c.vec3(),this._localMatrix=c.identityMat4(),this._worldMatrix=c.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,e.matrix?this.matrix=e.matrix:(this.scale=e.scale,this.position=e.position,e.quaternion||(this.rotation=e.rotation)),this._isModel=e.isModel,this._isModel&&this.scene._registerModel(this),this._isObject=e.isObject,this._isObject&&this.scene._registerObject(this),this.origin=e.origin,this.visible=e.visible,this.culled=e.culled,this.pickable=e.pickable,this.clippable=e.clippable,this.collidable=e.collidable,this.castsShadow=e.castsShadow,this.receivesShadow=e.receivesShadow,this.xrayed=e.xrayed,this.highlighted=e.highlighted,this.selected=e.selected,this.edges=e.edges,this.colorize=e.colorize,this.opacity=e.opacity,this.offset=e.offset,e.children){const t=e.children;for(let s=0,i=t.length;s<i;s++)this.addChild(t[s],e.inheritStates)}if(e.parentId){const t=this.scene.components[e.parentId];t?t.isNode?t.addChild(this):this.error("Parent is not a Node: '"+e.parentId+"'"):this.error("Parent not found: '"+e.parentId+"'")}else e.parent&&(e.parent.isNode||this.error("Parent is not a Node"),e.parent.addChild(this))}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}set origin(t){t?(this._origin||(this._origin=c.vec3()),this._origin.set(t)):this._origin&&(this._origin=null);for(let e=0,s=this._children.length;e<s;e++)this._children[e].origin=t}get origin(){return this._origin}set rtcCenter(t){this.origin=t}get rtcCenter(){return this.origin}get numTriangles(){return this._numTriangles}set visible(t){t=!1!==t,this._visible=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].visible=t;this._isObject&&this.scene._objectVisibilityUpdated(this,t)}get visible(){return this._visible}set xrayed(t){t=!!t,this._xrayed=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].xrayed=t;this._isObject&&this.scene._objectXRayedUpdated(this,t)}get xrayed(){return this._xrayed}set highlighted(t){t=!!t,this._highlighted=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].highlighted=t;this._isObject&&this.scene._objectHighlightedUpdated(this,t)}get highlighted(){return this._highlighted}set selected(t){t=!!t,this._selected=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].selected=t;this._isObject&&this.scene._objectSelectedUpdated(this,t)}get selected(){return this._selected}set edges(t){t=!!t,this._edges=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].edges=t}get edges(){return this._edges}set culled(t){t=!!t,this._culled=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].culled=t}get culled(){return this._culled}set clippable(t){t=!1!==t,this._clippable=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].clippable=t}get clippable(){return this._clippable}set collidable(t){t=!1!==t,this._collidable=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].collidable=t}get collidable(){return this._collidable}set pickable(t){t=!1!==t,this._pickable=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].pickable=t}get pickable(){return this._pickable}set colorize(t){let e=this._colorize;e||(e=this._colorize=new Float32Array(4),e[3]=1),t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1);for(let t=0,s=this._children.length;t<s;t++)this._children[t].colorize=e;if(this._isObject){const e=!!t;this.scene._objectColorizeUpdated(this,e)}}get colorize(){return this._colorize.slice(0,3)}set opacity(t){let e=this._colorize;e||(e=this._colorize=new Float32Array(4),e[0]=1,e[1]=1,e[2]=1),e[3]=null!=t?t:1;for(let e=0,s=this._children.length;e<s;e++)this._children[e].opacity=t;if(this._isObject){const e=null!=t;this.scene._objectOpacityUpdated(this,e)}}get opacity(){return this._colorize[3]}set castsShadow(t){t=!!t,this._castsShadow=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].castsShadow=t}get castsShadow(){return this._castsShadow}set receivesShadow(t){t=!!t,this._receivesShadow=t;for(let e=0,s=this._children.length;e<s;e++)this._children[e].receivesShadow=t}get receivesShadow(){return this._receivesShadow}get saoEnabled(){return!1}set offset(t){t?(this._offset[0]=t[0],this._offset[1]=t[1],this._offset[2]=t[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let t=0,e=this._children.length;t<e;t++)this._children[t].offset=this._offset;this._isObject&&this.scene._objectOffsetUpdated(this,t)}get offset(){return this._offset}get isNode(){return!0}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0;for(let t=0,e=this._children.length;t<e;t++)this._children[t]._setWorldMatrixDirty()}_buildWorldMatrix(){const t=this.matrix;if(this._parentNode)c.mulMat4(this._parentNode.worldMatrix,t,this._worldMatrix);else for(let e=0,s=t.length;e<s;e++)this._worldMatrix[e]=t[e];this._worldMatrixDirty=!1}_setSubtreeAABBsDirty(t){if(t._aabbDirty=!0,t._children)for(let e=0,s=t._children.length;e<s;e++)this._setSubtreeAABBsDirty(t._children[e])}_setAABBDirty(){if(this._setSubtreeAABBsDirty(this),this.collidable)for(let t=this;t;t=t._parentNode)t._aabbDirty=!0}_updateAABB(){if(this.scene._aabbDirty=!0,this._aabb||(this._aabb=c.AABB3()),this._buildAABB)this._buildAABB(this.worldMatrix,this._aabb);else{let t;c.collapseAABB3(this._aabb);for(let e=0,s=this._children.length;e<s;e++)t=this._children[e],t.collidable&&c.expandAABB3(this._aabb,t.aabb)}this._aabbDirty=!1}addChild(t,e){if(_.isNumeric(t)||_.isString(t)){const e=t;if(!(t=this.scene.component[e]))return void this.warn("Component not found: "+_.inQuotes(e));if(!t.isNode&&!t.isMesh)return void this.error("Not a Node or Mesh: "+e)}else{if(!t.isNode&&!t.isMesh)return void this.error("Not a Node or Mesh: "+t.id);if(t._parentNode){if(t._parentNode.id===this.id)return void this.warn("Already a child: "+t.id);t._parentNode.removeChild(t)}}if(t.id,t.scene.id===this.scene.id)return this._children.push(t),t._parentNode=this,e&&(t.visible=this.visible,t.culled=this.culled,t.xrayed=this.xrayed,t.highlited=this.highlighted,t.selected=this.selected,t.edges=this.edges,t.clippable=this.clippable,t.pickable=this.pickable,t.collidable=this.collidable,t.castsShadow=this.castsShadow,t.receivesShadow=this.receivesShadow,t.colorize=this.colorize,t.opacity=this.opacity,t.offset=this.offset),t._setWorldMatrixDirty(),t._setAABBDirty(),this._numTriangles+=t.numTriangles,t;this.error("Child not in same Scene: "+t.id)}removeChild(t){for(let e=0,s=this._children.length;e<s;e++)if(this._children[e].id===t.id)return t._parentNode=null,this._children=this._children.splice(e,1),t._setWorldMatrixDirty(),t._setAABBDirty(),this._setAABBDirty(),void(this._numTriangles-=t.numTriangles)}removeChildren(){let t;for(let e=0,s=this._children.length;e<s;e++)t=this._children[e],t._parentNode=null,t._setWorldMatrixDirty(),t._setAABBDirty(),this._numTriangles-=t.numTriangles;this._children=[],this._setAABBDirty()}get numChildren(){return this._children.length}get children(){return this._children}set parent(t){if(_.isNumeric(t)||_.isString(t)){const e=t;if(!(t=this.scene.components[e]))return void this.warn("Node not found: "+_.inQuotes(e));if(!t.isNode)return void this.error("Not a Node: "+t.id)}t.scene.id===this.scene.id?this._parentNode&&this._parentNode.id===t.id?this.warn("Already a child of Node: "+t.id):t.addChild(this):this.error("Node not in same Scene: "+t.id)}get parent(){return this._parentNode}set position(t){this._position.set(t||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get position(){return this._position}set rotation(t){this._rotation.set(t||[0,0,0]),c.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set quaternion(t){this._quaternion.set(t||[0,0,0,1]),c.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set scale(t){this._scale.set(t||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set matrix(t){this._localMatrix||(this._localMatrix=c.identityMat4()),this._localMatrix.set(t||$n),c.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=c.identityMat4()),c.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}rotate(t,e){return zn[0]=t[0],zn[1]=t[1],zn[2]=t[2],zn[3]=e*c.DEGTORAD,c.angleAxisToQuaternion(zn,Un),c.mulQuaternions(this.quaternion,Un,Xn),this.quaternion=Xn,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(t,e){return zn[0]=t[0],zn[1]=t[1],zn[2]=t[2],zn[3]=e*c.DEGTORAD,c.angleAxisToQuaternion(zn,Un),c.mulQuaternions(Un,this.quaternion,Un),this}rotateX(t){return this.rotate(Wn,t)}rotateY(t){return this.rotate(Yn,t)}rotateZ(t){return this.rotate(Kn,t)}translate(t,e){return c.vec3ApplyQuaternion(this.quaternion,t,Zn),c.mulVec3Scalar(Zn,e,qn),c.addVec3(this.position,qn,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(t){return this.translate(Wn,t)}translateY(t){return this.translate(Yn,t)}translateZ(t){return this.translate(Kn,t)}get type(){return"Node"}destroy(){if(super.destroy(),this._parentNode&&this._parentNode.removeChild(this),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this._children.length){const t=this._children.splice();let e;for(let s=0,i=t.length;s<i;s++)e=t[s],e.destroy()}this._children=[],this._setAABBDirty(),this.scene._aabbDirty=!0}}const Jn=m.memory,ta=pt.SUPPORTED_EXTENSIONS.OES_element_index_uint,ea=ta?Uint32Array:Uint16Array,sa=c.AABB3();class ia extends pe{get type(){return"VBOGeometry"}get isVBOGeometry(){return!0}constructor(t,e={}){super(t,e),this._state=new zt({compressGeometry:!0,primitive:null,primitiveName:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=e.edgeThreshold||10,this._aabb=null,this._obb=c.OBB3();const s=this._state,i=this.scene.canvas.gl;switch(e.primitive=e.primitive||"triangles",e.primitive){case"points":s.primitive=i.POINTS,s.primitiveName=e.primitive;break;case"lines":s.primitive=i.LINES,s.primitiveName=e.primitive;break;case"line-loop":s.primitive=i.LINE_LOOP,s.primitiveName=e.primitive;break;case"line-strip":s.primitive=i.LINE_STRIP,s.primitiveName=e.primitive;break;case"triangles":s.primitive=i.TRIANGLES,s.primitiveName=e.primitive;break;case"triangle-strip":s.primitive=i.TRIANGLE_STRIP,s.primitiveName=e.primitive;break;case"triangle-fan":s.primitive=i.TRIANGLE_FAN,s.primitiveName=e.primitive;break;default:this.error("Unsupported value for 'primitive': '"+e.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=i.TRIANGLES,s.primitiveName=e.primitive}if(e.positions)if(e.indices){var r;if(e.positionsDecodeMatrix);else{const t=ve.getPositionsBounds(e.positions),o=ve.compressPositions(e.positions,t.min,t.max);r=o.quantized,s.positionsDecodeMatrix=o.decodeMatrix,s.positionsBuf=new Dt(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),Jn.positions+=s.positionsBuf.numItems,c.positions3ToAABB3(e.positions,this._aabb),c.positions3ToAABB3(r,sa,s.positionsDecodeMatrix),c.AABB3ToOBB3(sa,this._obb)}if(e.colors){const t=e.colors.constructor===Float32Array?e.colors:new Float32Array(e.colors);s.colorsBuf=new Dt(i,i.ARRAY_BUFFER,t,t.length,4,i.STATIC_DRAW),Jn.colors+=s.colorsBuf.numItems}if(e.uv){const t=ve.getUVBounds(e.uv),r=ve.compressUVs(e.uv,t.min,t.max),o=r.quantized;s.uvDecodeMatrix=r.decodeMatrix,s.uvBuf=new Dt(i,i.ARRAY_BUFFER,o,o.length,2,i.STATIC_DRAW),Jn.uvs+=s.uvBuf.numItems}if(e.normals){const t=ve.compressNormals(e.normals);let r=s.compressGeometry;s.normalsBuf=new Dt(i,i.ARRAY_BUFFER,t,t.length,3,i.STATIC_DRAW,r),Jn.normals+=s.normalsBuf.numItems}if(ta||e.indices.constructor!==Uint32Array){{const t=e.indices.constructor===Uint32Array||e.indices.constructor===Uint16Array?e.indices:new ea(e.indices);s.indicesBuf=new Dt(i,i.ELEMENT_ARRAY_BUFFER,t,t.length,1,i.STATIC_DRAW),Jn.indices+=s.indicesBuf.numItems;const o=ce(r,t,s.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new Dt(i,i.ELEMENT_ARRAY_BUFFER,o,o.length,1,i.STATIC_DRAW),"triangles"===this._state.primitiveName&&(this._numTriangles=e.indices.length/3)}this._buildHash(),Jn.meshes++}else this.error("This WebGL implementation does not support Uint32Array")}else this.error("Config expected: indices");else this.error("Config expected: positions")}_buildHash(){const t=this._state,e=["/g"];e.push("/"+t.primitive+";"),t.positionsBuf&&e.push("p"),t.colorsBuf&&e.push("c"),(t.normalsBuf||t.autoVertexNormals)&&e.push("n"),t.uvBuf&&e.push("u"),e.push("cp"),e.push(";"),t.hash=e.join("")}_getEdgeIndices(){return this._edgeIndicesBuf}get primitive(){return this._state.primitiveName}get aabb(){return this._aabb}get obb(){return this._obb}get numTriangles(){return this._numTriangles}_getState(){return this._state}destroy(){super.destroy();const t=this._state;t.indicesBuf&&t.indicesBuf.destroy(),t.positionsBuf&&t.positionsBuf.destroy(),t.normalsBuf&&t.normalsBuf.destroy(),t.uvBuf&&t.uvBuf.destroy(),t.colorsBuf&&t.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),t.destroy(),Jn.meshes--}}const ra={opaque:0,mask:1,blend:2},oa=["opaque","mask","blend"];class na extends De{get type(){return"MetallicMaterial"}constructor(t,e={}){super(t,e),this._state=new zt({type:"MetallicMaterial",baseColor:c.vec4([1,1,1]),emissive:c.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.baseColor=e.baseColor,this.metallic=e.metallic,this.roughness=e.roughness,this.specularF0=e.specularF0,this.emissive=e.emissive,this.alpha=e.alpha,e.baseColorMap&&(this._baseColorMap=this._checkComponent("Texture",e.baseColorMap)),e.metallicMap&&(this._metallicMap=this._checkComponent("Texture",e.metallicMap)),e.roughnessMap&&(this._roughnessMap=this._checkComponent("Texture",e.roughnessMap)),e.metallicRoughnessMap&&(this._metallicRoughnessMap=this._checkComponent("Texture",e.metallicRoughnessMap)),e.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",e.emissiveMap)),e.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",e.occlusionMap)),e.alphaMap&&(this._alphaMap=this._checkComponent("Texture",e.alphaMap)),e.normalMap&&(this._normalMap=this._checkComponent("Texture",e.normalMap)),this.alphaMode=e.alphaMode,this.alphaCutoff=e.alphaCutoff,this.backfaces=e.backfaces,this.frontface=e.frontface,this.lineWidth=e.lineWidth,this.pointSize=e.pointSize,this._makeHash()}_makeHash(){const t=this._state,e=["/met"];this._baseColorMap&&(e.push("/bm"),this._baseColorMap._state.hasMatrix&&e.push("/mat"),e.push("/"+this._baseColorMap._state.encoding)),this._metallicMap&&(e.push("/mm"),this._metallicMap._state.hasMatrix&&e.push("/mat")),this._roughnessMap&&(e.push("/rm"),this._roughnessMap._state.hasMatrix&&e.push("/mat")),this._metallicRoughnessMap&&(e.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&e.push("/mat")),this._emissiveMap&&(e.push("/em"),this._emissiveMap._state.hasMatrix&&e.push("/mat")),this._occlusionMap&&(e.push("/ocm"),this._occlusionMap._state.hasMatrix&&e.push("/mat")),this._alphaMap&&(e.push("/am"),this._alphaMap._state.hasMatrix&&e.push("/mat")),this._normalMap&&(e.push("/nm"),this._normalMap._state.hasMatrix&&e.push("/mat")),e.push(";"),t.hash=e.join("")}set baseColor(t){let e=this._state.baseColor;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.baseColor=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),this.glRedraw()}get baseColor(){return this._state.baseColor}get baseColorMap(){return this._baseColorMap}set metallic(t){t=null!=t?t:1,this._state.metallic!==t&&(this._state.metallic=t,this.glRedraw())}get metallic(){return this._state.metallic}get metallicMap(){return this._attached.metallicMap}set roughness(t){t=null!=t?t:1,this._state.roughness!==t&&(this._state.roughness=t,this.glRedraw())}get roughness(){return this._state.roughness}get roughnessMap(){return this._attached.roughnessMap}get metallicRoughnessMap(){return this._attached.metallicRoughnessMap}set specularF0(t){t=null!=t?t:0,this._state.specularF0!==t&&(this._state.specularF0=t,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(t){let e=this._state.emissive;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.emissive=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=0,e[1]=0,e[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._attached.emissiveMap}get occlusionMap(){return this._attached.occlusionMap}set alpha(t){t=null!=t?t:1,this._state.alpha!==t&&(this._state.alpha=t,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._attached.alphaMap}get normalMap(){return this._attached.normalMap}set alphaMode(t){let e=ra[t=t||"opaque"];void 0===e&&(this.error("Unsupported value for 'alphaMode': "+t+" defaulting to 'opaque'"),e="opaque"),this._state.alphaMode!==e&&(this._state.alphaMode=e,this.glRedraw())}get alphaMode(){return oa[this._state.alphaMode]}set alphaCutoff(t){null==t&&(t=.5),this._state.alphaCutoff!==t&&(this._state.alphaCutoff=t)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(t){t=!!t,this._state.backfaces!==t&&(this._state.backfaces=t,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(t){t="cw"!==t,this._state.frontface!==t&&(this._state.frontface=t,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(t){this._state.lineWidth=t||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(t){this._state.pointSize=t||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}const aa={opaque:0,mask:1,blend:2},ha=["opaque","mask","blend"];class la extends De{get type(){return"SpecularMaterial"}constructor(t,e={}){super(t,e),this._state=new zt({type:"SpecularMaterial",diffuse:c.vec3([1,1,1]),emissive:c.vec3([0,0,0]),specular:c.vec3([1,1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.diffuse=e.diffuse,this.specular=e.specular,this.glossiness=e.glossiness,this.specularF0=e.specularF0,this.emissive=e.emissive,this.alpha=e.alpha,e.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",e.diffuseMap)),e.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",e.emissiveMap)),e.specularMap&&(this._specularMap=this._checkComponent("Texture",e.specularMap)),e.glossinessMap&&(this._glossinessMap=this._checkComponent("Texture",e.glossinessMap)),e.specularGlossinessMap&&(this._specularGlossinessMap=this._checkComponent("Texture",e.specularGlossinessMap)),e.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",e.occlusionMap)),e.alphaMap&&(this._alphaMap=this._checkComponent("Texture",e.alphaMap)),e.normalMap&&(this._normalMap=this._checkComponent("Texture",e.normalMap)),this.alphaMode=e.alphaMode,this.alphaCutoff=e.alphaCutoff,this.backfaces=e.backfaces,this.frontface=e.frontface,this.lineWidth=e.lineWidth,this.pointSize=e.pointSize,this._makeHash()}_makeHash(){const t=this._state,e=["/spe"];this._diffuseMap&&(e.push("/dm"),this._diffuseMap.hasMatrix&&e.push("/mat"),e.push("/"+this._diffuseMap.encoding)),this._emissiveMap&&(e.push("/em"),this._emissiveMap.hasMatrix&&e.push("/mat")),this._glossinessMap&&(e.push("/gm"),this._glossinessMap.hasMatrix&&e.push("/mat")),this._specularMap&&(e.push("/sm"),this._specularMap.hasMatrix&&e.push("/mat")),this._specularGlossinessMap&&(e.push("/sgm"),this._specularGlossinessMap.hasMatrix&&e.push("/mat")),this._occlusionMap&&(e.push("/ocm"),this._occlusionMap.hasMatrix&&e.push("/mat")),this._normalMap&&(e.push("/nm"),this._normalMap.hasMatrix&&e.push("/mat")),this._alphaMap&&(e.push("/opm"),this._alphaMap.hasMatrix&&e.push("/mat")),e.push(";"),t.hash=e.join("")}set diffuse(t){let e=this._state.diffuse;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.diffuse=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}get diffuseMap(){return this._diffuseMap}set specular(t){let e=this._state.specular;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.specular=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),this.glRedraw()}get specular(){return this._state.specular}get specularMap(){return this._specularMap}get specularGlossinessMap(){return this._specularGlossinessMap}set glossiness(t){t=null!=t?t:1,this._state.glossiness!==t&&(this._state.glossiness=t,this.glRedraw())}get glossiness(){return this._state.glossiness}get glossinessMap(){return this._glossinessMap}set specularF0(t){t=null!=t?t:0,this._state.specularF0!==t&&(this._state.specularF0=t,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(t){let e=this._state.emissive;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.emissive=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=0,e[1]=0,e[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._emissiveMap}set alpha(t){t=null!=t?t:1,this._state.alpha!==t&&(this._state.alpha=t,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._alphaMap}get normalMap(){return this._normalMap}get occlusionMap(){return this._occlusionMap}set alphaMode(t){let e=aa[t=t||"opaque"];void 0===e&&(this.error("Unsupported value for 'alphaMode': "+t+" defaulting to 'opaque'"),e="opaque"),this._state.alphaMode!==e&&(this._state.alphaMode=e,this.glRedraw())}get alphaMode(){return ha[this._state.alphaMode]}set alphaCutoff(t){null==t&&(t=.5),this._state.alphaCutoff!==t&&(this._state.alphaCutoff=t)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(t){t=!!t,this._state.backfaces!==t&&(this._state.backfaces=t,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(t){t="cw"!==t,this._state.frontface!==t&&(this._state.frontface=t,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(t){this._state.lineWidth=t||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(t){this._state.pointSize=t||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}const ua={funcAdd:"FUNC_ADD",funcSubtract:"FUNC_SUBTRACT",funcReverseSubtract:"FUNC_REVERSE_SUBTRACT",zero:"ZERO",one:"ONE",srcColor:"SRC_COLOR",oneMinusSrcColor:"ONE_MINUS_SRC_COLOR",dstColor:"DST_COLOR",oneMinusDstColor:"ONE_MINUS_DST_COLOR",srcAlpha:"SRC_ALPHA",oneMinusSrcAlpha:"ONE_MINUS_SRC_ALPHA",dstAlpha:"DST_ALPHA",oneMinusDstAlpha:"ONE_MINUS_DST_ALPHA",contantColor:"CONSTANT_COLOR",oneMinusConstantColor:"ONE_MINUS_CONSTANT_COLOR",constantAlpha:"CONSTANT_ALPHA",oneMinusConstantAlpha:"ONE_MINUS_CONSTANT_ALPHA",srcAlphaSaturate:"SRC_ALPHA_SATURATE",front:"FRONT",back:"BACK",frontAndBack:"FRONT_AND_BACK",never:"NEVER",less:"LESS",equal:"EQUAL",lequal:"LEQUAL",greater:"GREATER",notequal:"NOTEQUAL",gequal:"GEQUAL",always:"ALWAYS",cw:"CW",ccw:"CCW",linear:"LINEAR",nearest:"NEAREST",linearMipmapNearest:"LINEAR_MIPMAP_NEAREST",nearestMipmapNearest:"NEAREST_MIPMAP_NEAREST",nearestMipmapLinear:"NEAREST_MIPMAP_LINEAR",linearMipmapLinear:"LINEAR_MIPMAP_LINEAR",repeat:"REPEAT",clampToEdge:"CLAMP_TO_EDGE",mirroredRepeat:"MIRRORED_REPEAT",alpha:"ALPHA",rgb:"RGB",rgba:"RGBA",luminance:"LUMINANCE",luminanceAlpha:"LUMINANCE_ALPHA",textureBinding2D:"TEXTURE_BINDING_2D",textureBindingCubeMap:"TEXTURE_BINDING_CUBE_MAP",compareRToTexture:"COMPARE_R_TO_TEXTURE",unsignedByte:"UNSIGNED_BYTE"};function pa(t,e,s){if(void 0===e)return s;const i=ua[e];return void 0===i?s:t[i]}const ca=new Uint8Array([0,0,0,1]);class da{constructor(t,e){this.gl=t,this.target=e||t.TEXTURE_2D,this.texture=t.createTexture(),this.setPreloadColor([0,0,0,0]),this.allocated=!0}setPreloadColor(t){t?(ca[0]=Math.floor(255*t[0]),ca[1]=Math.floor(255*t[1]),ca[2]=Math.floor(255*t[2]),ca[3]=Math.floor(255*(void 0!==t[3]?t[3]:1))):(ca[0]=0,ca[1]=0,ca[2]=0,ca[3]=255);const e=this.gl;if(e.bindTexture(this.target,this.texture),e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,e.NEAREST),this.target===e.TEXTURE_CUBE_MAP){const t=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let s=0,i=t.length;s<i;s++)e.texImage2D(t[s],0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ca)}else e.texImage2D(this.target,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,ca);e.bindTexture(this.target,null)}setTarget(t){this.target=t||this.gl.TEXTURE_2D}setImage(t,e){const s=this.gl;if(s.bindTexture(this.target,this.texture),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flipY),this.target===s.TEXTURE_CUBE_MAP){if(_.isArray(t)){const e=t,i=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let t=0,r=i.length;t<r;t++)s.texImage2D(i[t],0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,e[t])}}else s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,t);s.bindTexture(this.target,null)}setProps(t){const e=this.gl;if(e.bindTexture(this.target,this.texture),t.minFilter){const s=pa(e,t.minFilter);s&&(e.texParameteri(this.target,e.TEXTURE_MIN_FILTER,s),s!==e.NEAREST_MIPMAP_NEAREST&&s!==e.LINEAR_MIPMAP_NEAREST&&s!==e.NEAREST_MIPMAP_LINEAR&&s!==e.LINEAR_MIPMAP_LINEAR||e.generateMipmap(this.target))}if(t.magFilter){const s=pa(e,t.magFilter);s&&e.texParameteri(this.target,e.TEXTURE_MAG_FILTER,s)}if(t.wrapS){const s=pa(e,t.wrapS);s&&e.texParameteri(this.target,e.TEXTURE_WRAP_S,s)}if(t.wrapT){const s=pa(e,t.wrapT);s&&e.texParameteri(this.target,e.TEXTURE_WRAP_T,s)}e.bindTexture(this.target,null)}bind(t){if(this.allocated){if(this.texture){const e=this.gl;return e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,this.texture),!0}return!1}}unbind(t){if(this.allocated&&this.texture){const e=this.gl;e.activeTexture(e["TEXTURE"+t]),e.bindTexture(this.target,null)}}destroy(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}function ma(t){if(!fa(t.width)||!fa(t.height)){const e=document.createElement("canvas");e.width=ga(t.width),e.height=ga(t.height);e.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),t=e}return t}function fa(t){return 0==(t&t-1)}function ga(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}class _a extends A{get type(){return"Texture"}constructor(t,e={}){super(t,e),this._state=new zt({texture:new da(this.scene.canvas.gl),matrix:c.identityMat4(),hasMatrix:e.translate&&(0!==e.translate[0]||0!==e.translate[1])||!!e.rotate||e.scale&&(0!==e.scale[0]||0!==e.scale[1]),minFilter:this._checkMinFilter(e.minFilter),magFilter:this._checkMagFilter(e.magFilter),wrapS:this._checkWrapS(e.wrapS),wrapT:this._checkWrapT(e.wrapT),flipY:this._checkFlipY(e.flipY),encoding:this._checkEncoding(e.encoding)}),this._src=null,this._image=null,this._translate=c.vec2([0,0]),this._scale=c.vec2([1,1]),this._rotate=c.vec2([0,0]),this._matrixDirty=!1,this.translate=e.translate,this.scale=e.scale,this.rotate=e.rotate,e.src?this.src=e.src:e.image&&(this.image=e.image),m.memory.textures++}_checkMinFilter(t){return"linear"!==(t=t||"linearMipmapLinear")&&"linearMipmapNearest"!==t&&"linearMipmapLinear"!==t&&"nearestMipmapLinear"!==t&&"nearestMipmapNearest"!==t&&(this.error("Unsupported value for 'minFilter': '"+t+"' - supported values are 'linear', 'linearMipmapNearest', 'nearestMipmapNearest', 'nearestMipmapLinear' and 'linearMipmapLinear'. Defaulting to 'linearMipmapLinear'."),t="linearMipmapLinear"),t}_checkMagFilter(t){return"linear"!==(t=t||"linear")&&"nearest"!==t&&(this.error("Unsupported value for 'magFilter': '"+t+"' - supported values are 'linear' and 'nearest'. Defaulting to 'linear'."),t="linear"),t}_checkFilter(t){return"linear"!==(t=t||"linear")&&"nearest"!==t&&(this.error("Unsupported value for 'magFilter': '"+t+"' - supported values are 'linear' and 'nearest'. Defaulting to 'linear'."),t="linear"),t}_checkWrapS(t){return"clampToEdge"!==(t=t||"repeat")&&"mirroredRepeat"!==t&&"repeat"!==t&&(this.error("Unsupported value for 'wrapS': '"+t+"' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'."),t="repeat"),t}_checkWrapT(t){return"clampToEdge"!==(t=t||"repeat")&&"mirroredRepeat"!==t&&"repeat"!==t&&(this.error("Unsupported value for 'wrapT': '"+t+"' - supported values are 'clampToEdge', 'mirroredRepeat' and 'repeat'. Defaulting to 'repeat'."),t="repeat"),t}_checkFlipY(t){return!!t}_checkEncoding(t){return"linear"!==(t=t||"linear")&&"sRGB"!==t&&"gamma"!==t&&(this.error("Unsupported value for 'encoding': '"+t+"' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),t="linear"),t}_webglContextRestored(){this._state.texture=new da(this.scene.canvas.gl),this._image?this.image=this._image:this._src&&(this.src=this._src)}_update(){const t=this._state;if(this._matrixDirty){let e,s;0===this._translate[0]&&0===this._translate[1]||(e=c.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix)),1===this._scale[0]&&1===this._scale[1]||(s=c.scalingMat4v([this._scale[0],this._scale[1],1]),e=e?c.mulMat4(e,s):s),0!==this._rotate&&(s=c.rotationMat4v(.0174532925*this._rotate,[0,0,1]),e=e?c.mulMat4(e,s):s),e&&(t.matrix=e),this._matrixDirty=!1}this.glRedraw()}set image(t){this._image=ma(t),this._image.crossOrigin="Anonymous",this._state.texture.setImage(this._image,this._state),this._state.texture.setProps(this._state),this._src=null,this.glRedraw()}get image(){return this._image}set src(t){this.scene.loading++,this.scene.canvas.spinner.processes++;const e=this;let s=new Image;s.onload=function(){s=ma(s),e._state.texture.setImage(s,e._state),e._state.texture.setProps(e._state),e.scene.loading--,e.glRedraw(),e.scene.canvas.spinner.processes--},s.src=t,this._src=t,this._image=null}get src(){return this._src}set translate(t){this._translate.set(t||[0,0]),this._matrixDirty=!0,this._needUpdate()}get translate(){return this._translate}set scale(t){this._scale.set(t||[1,1]),this._matrixDirty=!0,this._needUpdate()}get scale(){return this._scale}set rotate(t){t=t||0,this._rotate!==t&&(this._rotate=t,this._matrixDirty=!0,this._needUpdate())}get rotate(){return this._rotate}get minFilter(){return this._state.minFilter}get magFilter(){return this._state.magFilter}get wrapS(){return this._state.wrapS}get wrapT(){return this._state.wrapT}get flipY(){return this._state.flipY}get encoding(){return this._state.encoding}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),this._state.destroy(),m.memory.textures--}}class ya{constructor(t){}load(t,e,s,i,r,o){i=i||{};var n=e.scene.canvas.spinner;n.processes++,va(t,e,s,i,(function(){n.processes--,I.scheduleTask((function(){e.scene.fire("modelLoaded",e.id),e.fire("loaded",!0,!1)})),r&&r()}),(function(t){n.processes--,e.error(t),o&&o(t),e.fire("error",t)}))}parse(t,e,s,i,r,o){i=i||{};var n=e.scene.canvas.spinner;n.processes++,ba(t,s,"",i,e,(function(){n.processes--,e.scene.fire("modelLoaded",e.id),e.fire("loaded",!0,!1),r&&r()}),(function(t){n.processes--,e.error(t),e.fire("error",t),o&&o(t)}))}}var va=function(t,e,s,i,r,o){t.dataSource.getGLTF(s,(function(n){i.basePath=function(t){var e=t.lastIndexOf("/");return 0!==e?t.substring(0,e+1):""}(s),ba(t,n,s,i,e,r,o)}),o)},ba=function(){const t={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};return function(t,e,u,p,c,d){c.clear();var m={src:u,loadBuffer:p.loadBuffer,basePath:p.basePath,prioritizeGLTFNode:p.prioritizeGLTFNode,handleGLTFNode:p.handleGLTFNode,ignoreMaterials:!!p.ignoreMaterials,edgeThreshold:p.edgeThreshold,readableGeometry:!!p.readableGeometry,json:e,scene:c.scene,plugin:t,modelNode:c,modelNodeProps:{visible:c.visible,culled:c.culled,xrayed:c.xrayed,highlighted:c.highlighted,selected:c.selected,outlined:c.outlined,clippable:c.clippable,pickable:c.pickable,collidable:c.collidable,castsShadow:c.castsShadow,receivesShadow:c.receivesShadow,colorize:c.colorize,opacity:c.opacity,edges:c.edges}};c.scene.loading++,function(t,e){var i=t.json.buffers;if(i)for(var r=i.length,o=0,n=i.length;o<n;o++)s(t,i[o],(function(){0==--r&&e()}),(function(s){t.plugin.error(s),0==--r&&e()}));else e()}(m,(function(){!function(t){var e=t.json.bufferViews;if(e)for(var s=0,r=e.length;s<r;s++)i(t,e[s])}(m),function(t){var e=t.json.accessors;if(e)for(var s=0,i=e.length;s<i;s++)r(t,e[s])}(m),function(t){var e=t.json.textures;if(e)for(var s=0,i=e.length;s<i;s++)o(t,e[s])}(m),function(t){var e,s,i=t.json.materials;if(i)for(var r=0,o=i.length;r<o;r++)s=n(t,e=i[r]),e._material=s}(m),function(t){var e=t.json.meshes;if(e)for(var s=0,i=e.length;s<i;s++)a(t,e[s])}(m),function(t){var e=t.json,s=e.scene||0,i=e.scenes[s];if(!i)return void l(t,"glTF has no default scene");!function(t,e){var s=e.nodes;if(!s)return;for(var i,r=t.json,o=0,n=s.length;o<n;o++)(i=r.nodes[s[o]])?h(t,i,null,null):l(t,"Node not found: "+o)}(t,i)}(m),c.scene.loading--,d()}))};function s(t,e,s,i){var r=e.uri;r?t.plugin.dataSource.getArrayBuffer(t.src,r,(function(t){e._buffer=t,s()}),i):i("gltf/handleBuffer missing uri in "+JSON.stringify(e))}function i(t,e){var s=t.json.buffers[e.buffer];e._typedArray=null;var i=e.byteLength||0,r=e.byteOffset||0;e._buffer=s._buffer.slice(r,r+i)}function r(s,i){var r=s.json.bufferViews[i.bufferView],o=e[i.type],n=t[i.componentType],a=n.BYTES_PER_ELEMENT*o;i.byteStride&&i.byteStride!==a||(i._typedArray=new n(r._buffer,i.byteOffset||0,i.count*o),i._itemSize=o)}function o(t,e){e._texture=new _a(t.modelNode,{src:t.json.images[e.source].uri?t.basePath+t.json.images[e.source].uri:void 0,flipY:!!e.flipY,encoding:"sRGB"})}function n(t,e){var s,i=t.json,r={},o=e.normalTexture;o&&(s=i.textures[o.index])&&(r.normalMap=s._texture);var n=e.occlusionTexture;n&&(s=i.textures[n.index])&&(r.occlusionMap=s._texture);var a=e.emissiveTexture;a&&(s=i.textures[a.index])&&(r.emissiveMap=s._texture);var h=e.emissiveFactor;switch(h&&(r.emissive=h),r.backfaces=!!e.doubleSided,e.alphaMode){case"NORMAL_OPAQUE":r.alphaMode="opaque";break;case"MASK":r.alphaMode="mask";break;case"BLEND":r.alphaMode="blend"}var l=e.alphaCutoff;void 0!==l&&(r.alphaCutoff=l);var u=e.extensions;if(u){var p=u.KHR_materials_pbrSpecularGlossiness;if(p){var c=p.diffuseFactor;null!=c&&(r.diffuse=c.slice(0,3),r.alpha=c[3]);var d=p.diffuseTexture;d&&(s=i.textures[d.index])&&(r.diffuseMap=s._texture);var m=p.specularFactor;null!=m&&(r.specular=m.slice(0,3));var f=p.glossinessFactor;null!=f&&(r.glossiness=f);var g=p.specularGlossinessTexture;return g&&(s=i.textures[g.index])&&(r.specularGlossinessMap=s._texture),new la(t.modelNode,r)}var y=u.KHR_materials_common;if(y){var v,b=y.technique,P=y.values||{},T="BLINN"===b,w="PHONG"===b,x="LAMBERT"===b,M=P.shininess;r.shininess=(T||w)&&null!=M?M:0;var D=P.diffuse;D&&(T||w||x)?_.isString(D)?(v=t.textures[D])&&(r.diffuseMap=v):r.diffuse=D.slice(0,3):r.diffuse=[0,0,0];var E=P.specular;E&&(T||w)?_.isString(E)?(v=t.textures[E])&&(r.specularMap=v):r.specular=E.slice(0,3):r.specular=[0,0,0];var I=P.emission;I?_.isString(I)?(v=t.textures[I])&&(r.emissiveMap=v):r.emissive=I.slice(0,3):r.emissive=[0,0,0];var S=P.transparency;return r.alpha=null!=S?S:1,P.transparent,new Se(t.scene,r)}}var A=e.pbrMetallicRoughness;if(A){var C=A.baseColorFactor;C&&(r.baseColor=C.slice(0,3),r.alpha=C[3]);var F=A.baseColorTexture;F&&(s=i.textures[F.index])&&(r.baseColorMap=s._texture);var O=A.metallicFactor;null!=O&&(r.metallic=O);var R=A.roughnessFactor;null!=R&&(r.roughness=R);var L=A.metallicRoughnessTexture;return L&&(s=i.textures[L.index])&&(r.metallicRoughnessMap=s._texture),new na(t.scene,r)}return new Se(t.scene,r)}function a(t,e){var s,i,r,o,n=t.json,a=[],h=e.primitives;if(h)for(var l,u,p,c,d,m,f,g,_=0,y=h.length;_<y;_++)(l=h[_]).mode<4||(m={primitive:"triangles",compressGeometry:!0,edgeThreshold:t.edgeThreshold},null!=(u=l.indices)&&(r=n.accessors[u],m.indices=r._typedArray),(o=l.attributes)&&(null!=(p=o.POSITION)&&(r=n.accessors[p],m.positions=r._typedArray),null!=(c=o.NORMAL)&&(r=n.accessors[c],m.normals=r._typedArray),null!=(d=o.TEXCOORD_0)&&(r=n.accessors[d],m.uv=r._typedArray),f={},g=t.readableGeometry?new xe(t.modelNode,m):new ia(t.modelNode,m),f.geometry=g,null!=(s=l.material)&&(i=n.materials[s])&&(f.material=i._material),a.push(f)));e._mesh=a}function h(t,e,s,i){var r;if(i=i||t.modelNode,t.prioritizeGLTFNode){const s=t.prioritizeGLTFNode(t.modelNode.id,e);if(null==s)return}if(t.handleGLTFNode){var o={};if(!t.handleGLTFNode(t.modelNode.id,e,o))return;o.createEntity&&(r=o.createEntity)}const n=t.json,a=t.modelNode,u=e.children&&e.children.length>0;var p;if(e.matrix&&(p=e.matrix,s=s?c.mulMat4(s,p,c.mat4()):p),e.translation&&(p=c.translationMat4v(e.translation),s=s?c.mulMat4(s,p,p):p),e.rotation&&(p=c.quaternionToMat4(e.rotation),s=s?c.mulMat4(s,p,p):p),e.scale&&(p=c.scalingMat4v(e.scale),s=s?c.mulMat4(s,p,p):p),void 0!==e.mesh){var d=n.meshes[e.mesh];if(d){var m,f,g=d._mesh,y=g.length;if(!r&&y>0&&!u){for(var v=0,b=y;v<b;v++){let e={geometry:(m=g[v]).geometry,matrix:s};_.apply(t.modelNodeProps,e),e.material=m.material,f=new Os(a,e),i.addChild(f,!1)}return}if(r&&1===y&&!u){let e={geometry:(m=g[0]).geometry,matrix:s};return _.apply(t.modelNodeProps,e),e.material=m.material,_.apply(r,e),f=new Os(a,e),void i.addChild(f,!1)}if(r&&y>0&&!u){let e={matrix:s};_.apply(t.modelNodeProps,e),_.apply(r,e);let o=new Qn(a,e);i.addChild(o,!1);for(let e=0,s=y;e<s;e++){m=g[e];let s={geometry:m.geometry};_.apply(t.modelNodeProps,s),s.material=m.material,_.apply(r,s),s.id=null,f=new Os(a,s),o.addChild(f,!1)}return}if(!r&&y>0&&u){let e={matrix:s};_.apply(t.modelNodeProps,e);let r=new Qn(a,e);i.addChild(r,!1);for(let t=0,s=y;t<s;t++){m=g[t];let s={geometry:m.geometry};_.apply(e,s),s.id=null,s.matrix=null,s.material=m.material,f=new Os(a,s),r.addChild(f,!1)}s=null,i=r}if(r&&0===y&&u){let e={matrix:s};_.apply(t.modelNodeProps,e),_.apply(r,e),r.matrix=s;let o=new Qn(a,e);i.addChild(o,!1),s=null,i=o}if(r&&y>0||u){let e={matrix:s};_.apply(t.modelNodeProps,e),r&&_.apply(r,e);let o=new Qn(a,e);i.addChild(o,!1);for(let e=0,s=y;e<s;e++){m=g[e];let s={geometry:m.geometry};_.apply(t.modelProps,s),s.material=m.material,r&&_.apply(r,s),s.id=null,f=new Os(a,s),o.addChild(f,!1)}s=null,i=o}}}if(e.children){var P,T,w=e.children;for(let e=0,r=w.length;e<r;e++)T=w[e],(P=n.nodes[T])?h(t,P,s,i):l(t,"Node not found: "+e)}}function l(t,e){t.plugin.error(e)}}();class Pa{constructor(t){}load(t,e,s,i,r,o){Ta(t,e,s,i=i||{},(function(){I.scheduleTask((function(){e.scene.fire("modelLoaded",e.id),e.fire("loaded",!0,!1)})),r&&r()}),(function(s){t.error(s),o&&o(s),e.fire("error",s)}))}parse(t,e,s,i,r,o){wa(t,s,"",i=i||{},e,(function(){e.scene.fire("modelLoaded",e.id),e.fire("loaded",!0,!1),r&&r()}),(function(t){e.error(t),e.fire("error",t),o&&o(t)}))}}const Ta=function(t,e,s,i,r,o){const n=t.viewer.scene.canvas.spinner;n.processes++,t.dataSource.getGLTF(s,(function(a){n.processes--,wa(t,a,s,i,e,r,o)}),o)},wa=function(){const t={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},e={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};return function(t,e,a,h,u,p){const c={src:a,loadBuffer:h.loadBuffer,handleGLTFNode:h.handleGLTFNode,json:e,scene:u.scene,plugin:t,performanceModel:u,geometryCreated:{},numObjects:0,nodes:[]},d=t.viewer.scene.canvas.spinner;d.processes++,function(t,e){const i=t.json.buffers;if(i){let r=i.length;for(let o=0,n=i.length;o<n;o++)s(t,i[o],(function(){0==--r&&e()}),(function(s){t.plugin.error(s),0==--r&&e()}))}else e()}(c,(function(){!function(t){const e=t.json.bufferViews;if(e)for(let s=0,r=e.length;s<r;s++)i(t,e[s])}(c),function(t){const e=t.json.buffers;if(e)for(let t=0,s=e.length;t<s;t++)e[t]._buffer=null}(c),function(t){const e=t.json.materials;if(e)for(let s=0,i=e.length;s<i;s++){const i=e[s],o=r(t,i);i._rgbaColor=o}}(c),d.processes--,function(t){const e=t.json,s=e.scene||0,i=e.scenes[s];if(!i)return void l(t,"glTF has no default scene");(function(t,e){const s=e.nodes;if(!s)return;const i=t.json;for(let e=0,r=s.length;e<r;e++){i.nodes[s[e]]?o(t,e):l(t,"Node not found: "+e)}})(t,i),function(t,e){const s=e.nodes;if(!s)return;const i=t.json;for(let e=0,r=s.length;e<r;e++){const r=i.nodes[s[e]];r?o(t,r):l(t,"Node not found: "+e)}t.plugin.viewer.scene.canvas.spinner.processes++;for(let e=0,r=s.length;e<r;e++){n(t,i.nodes[s[e]],null)}t.plugin.viewer.scene.canvas.spinner.processes--}(t,i)}(c),u.finalize(),p()}))};function s(t,e,s,i){const r=e.uri;r?t.plugin.dataSource.getArrayBuffer(t.src,r,(function(t){e._buffer=t,s()}),i):i("gltf/handleBuffer missing uri in "+JSON.stringify(e))}function i(t,e){const s=t.json.buffers[e.buffer];e._typedArray=null;const i=e.byteLength||0,r=e.byteOffset||0;e._buffer=s._buffer.slice(r,r+i)}function r(t,e){const s=new Float32Array([1,1,1,1]),i=e.extensions;if(i){const t=i.KHR_materials_pbrSpecularGlossiness;if(t){const e=t.diffuseFactor;null!=e&&s.set(e)}const e=i.KHR_materials_common;if(e){const t=e.technique,i=e.values||{},r="BLINN"===t,o="PHONG"===t,n="LAMBERT"===t,a=i.diffuse;a&&(r||o||n)&&(_.isString(a)||s.set(a));const h=i.transparency;null!=h&&(s[3]=h);const l=i.transparent;null!=l&&(s[3]=l)}}const r=e.pbrMetallicRoughness;if(r){const t=r.baseColorFactor;t&&s.set(t)}return s}function o(t,e){const s=t.json;if(void 0!==e.mesh){const t=s.meshes[e.mesh];t&&(t.instances=t.instances?t.instances+1:1)}if(e.children){const i=e.children;for(let e=0,r=i.length;e<r;e++){const r=i[e],n=s.nodes[r];n?o(t,n):l(t,"Node not found: "+e)}}}function n(t,e,s){const i=t.json;let r;if(e.matrix&&(r=e.matrix,s=s?c.mulMat4(s,r,c.mat4()):r),e.translation&&(r=c.translationMat4v(e.translation),s=s?c.mulMat4(s,r,c.mat4()):r),e.rotation&&(r=c.quaternionToMat4(e.rotation),s=s?c.mulMat4(s,r,c.mat4()):r),e.scale&&(r=c.scalingMat4v(e.scale),s=s?c.mulMat4(s,r,c.mat4()):r),void 0!==e.mesh){const r=i.meshes[e.mesh];if(r){let o;if(t.handleGLTFNode){const s={};if(!t.handleGLTFNode(t.performanceModel.id,e,s))return;s.createEntity&&(o=s.createEntity)}const n=t.performanceModel,h=s?s.slice():c.identityMat4(),l=r.primitives.length;if(l>0){const e=[];for(let s=0;s<l;s++){const l=r.primitives[s];if(l.mode<4)continue;const u={id:n.id+"."+t.numObjects++},p=l.material;let d;null!=p&&(d=i.materials[p]),d?(u.color=d._rgbaColor,u.opacity=d._rgbaColor[3]):(u.color=new Float32Array([1,1,1]),u.opacity=1),o&&(o.colorize&&(u.color=o.colorize),void 0!==o.opacity&&null!==o.opacity&&(u.opacity=o.opacity)),a(t,l,u),c.transformPositions3(h,u.localPositions,u.positions);const m=c.vec3();W(u.positions,u.positions,m,1e4)&&(u.origin=m),n.createMesh(u),e.push(u.id)}o?n.createEntity(_.apply(o,{meshIds:e})):n.createEntity({meshIds:e})}}}if(e.children){const r=e.children;for(let e=0,o=r.length;e<o;e++){const o=r[e],a=i.nodes[o];a?n(t,a,s):l(t,"Node not found: "+e)}}}function a(t,e,s){const i=e.attributes;if(!i)return;s.primitive="triangles";const r=e.indices;if(null!=r){const e=t.json.accessors[r];s.indices=h(t,e)}const o=i.POSITION;if(null!=o){const e=t.json.accessors[o];s.localPositions=h(t,e),s.positions=new Float64Array(s.localPositions.length)}const n=i.NORMAL;if(null!=n){const e=t.json.accessors[n];s.normals=h(t,e)}s.indices&&(s.edgeIndices=ce(s.localPositions,s.indices,null,10))}function h(s,i){const r=s.json.bufferViews[i.bufferView],o=e[i.type],n=t[i.componentType],a=n.BYTES_PER_ELEMENT*o;if(!i.byteStride||i.byteStride===a)return new n(r._buffer,i.byteOffset||0,i.count*o);l("interleaved buffer!")}function l(t,e){t.plugin.error(e)}}(),xa={IfcOpeningElement:{pickable:!1,visible:!1},IfcSpace:{colorize:[.137255,.403922,.870588],pickable:!1,visible:!1,opacity:.4},IfcWindow:{colorize:[.137255,.403922,.870588],opacity:.3},IfcPlate:{colorize:[.8470588235,.427450980392,0,.5],opacity:.3},DEFAULT:{}};class Ma extends n{constructor(t,e={}){super("GLTFLoader",t,e),this._sceneGraphLoader=new ya(this,e),this._performanceModelLoader=new Pa(this,e),this.dataSource=e.dataSource,this.objectDefaults=e.objectDefaults}set dataSource(t){this._dataSource=t||new ti}get dataSource(){return this._dataSource}set objectDefaults(t){this._objectDefaults=t||xa}get objectDefaults(){return this._objectDefaults}load(t={}){t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);const e=!1!==t.performance,s=e?new Vn(this.viewer.scene,_.apply(t,{isModel:!0})):new Qn(this.viewer.scene,_.apply(t,{isModel:!0})),i=s.id;if(!t.src&&!t.gltf)return this.error("load() param expected: src or gltf"),s;const r=e?this._performanceModelLoader:this._sceneGraphLoader;if(t.metaModelSrc||t.metaModelData){const e=t.objectDefaults||this._objectDefaults||xa,o=o=>{var n;if(this.viewer.metaScene.createMetaModel(i,o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes}),this.viewer.scene.canvas.spinner.processes--,t.includeTypes){n={};for(let e=0,s=t.includeTypes.length;e<s;e++)n[t.includeTypes[e]]=!0}if(t.excludeTypes){n||(n={});for(let e=0,s=t.excludeTypes.length;e<s;e++)n[t.excludeTypes[e]]=!0}t.readableGeometry=!1,t.handleGLTFNode=(t,s,i)=>{const r=s.name;if(!r)return!0;const o=r,n=this.viewer.metaScene.metaObjects[o],a=(n?n.type:"DEFAULT")||"DEFAULT";i.createEntity={id:o,isObject:!0};const h=e[a];return h&&(!1===h.visible&&(i.createEntity.visible=!1),h.colorize&&(i.createEntity.colorize=h.colorize),!1===h.pickable&&(i.createEntity.pickable=!1),void 0!==h.opacity&&null!==h.opacity&&(i.createEntity.opacity=h.opacity)),!0},t.src?r.load(this,s,t.src,t):r.parse(this,s,t.gltf,t)};if(t.metaModelSrc){const e=t.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(e,(t=>{this.viewer.scene.canvas.spinner.processes--,o(t)}),(t=>{this.error(`load(): Failed to load model metadata for model '${i} from  '${e}' - ${t}`),this.viewer.scene.canvas.spinner.processes--}))}else t.metaModelData&&o(t.metaModelData)}else t.handleGLTFNode=(t,e,s)=>{const i=e.name;if(!i)return!0;const r=i;return s.createEntity={id:r,isObject:!0},!0},t.src?r.load(this,s,t.src,t):r.parse(this,s,t.gltf,t);return s.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(i)})),s}destroy(){super.destroy()}}function Da(t,e={}){const s="lightgrey",i=e.hoverColor||"rgba(0,0,0,0.4)",r=500,o=r+r/3,n=o/24,a=[{boundary:[6,6,6,6],color:e.frontColor||e.color||"#55FF55"},{boundary:[18,6,6,6],color:e.backColor||e.color||"#55FF55"},{boundary:[12,6,6,6],color:e.leftColor||e.color||"#FF5555"},{boundary:[0,6,6,6],color:e.rightColor||e.color||"#FF5555"},{boundary:[6,0,6,6],color:e.topColor||e.color||"#7777FF"},{boundary:[6,12,6,6],color:e.bottomColor||e.color||"#7777FF"}],h=[{label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,1,0],up:[0,0,1]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,-1,0],up:[0,0,1]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,0,1]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,0,1]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,0,1],up:[0,-1,0]},{boundaries:[[7,5,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,0,-1],up:[1,0,1]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-1,-1],up:[0,-1,1]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,0,-1],up:[-1,0,1]},{boundaries:[[7,11,4,2]],dir:[0,1,1],up:[0,-1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,0,1],up:[-1,0,1]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,-1,1],up:[0,1,1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,0,1],up:[1,0,1]},{boundaries:[[5,7,2,4]],dir:[1,1,0],up:[0,0,1]},{boundaries:[[11,7,2,4]],dir:[-1,1,0],up:[0,0,1]},{boundaries:[[17,7,2,4]],dir:[-1,-1,0],up:[0,0,1]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,-1,0],up:[0,0,1]},{boundaries:[[5,11,2,2]],dir:[1,1,1],up:[-1,-1,1]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[1,-1,1],up:[-1,1,1]},{boundaries:[[5,5,2,2]],dir:[1,1,-1],up:[1,1,1]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-1,-1,1],up:[1,1,1]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-1,-1,-1],up:[-1,-1,1]},{boundaries:[[11,11,2,2]],dir:[-1,1,1],up:[1,-1,1]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[1,-1,-1],up:[1,-1,1]},{boundaries:[[11,5,2,2]],dir:[-1,1,-1],up:[-1,1,1]}];e.frontColor||e.color,e.backColor||e.color,e.leftColor||e.color,e.rightColor||e.color,e.topColor||e.color,e.bottomColor||e.color;const l=[{yUp:"",label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,0,1],up:[0,1,0]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,1,0]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,1,0]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,-1,0],up:[0,0,-1]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,1,0],up:[0,0,1]},{boundaries:[[7,5,4,2]],dir:[0,-.7071,-.7071],up:[0,.7071,-.7071]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,-1,0],up:[1,1,0]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-.7071,.7071],up:[0,.7071,.7071]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,-1,0],up:[-1,1,0]},{boundaries:[[7,11,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,1,0],up:[-1,1,0]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,1,1],up:[0,1,-1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,1,0],up:[1,1,0]},{boundaries:[[5,7,2,4]],dir:[1,0,-1],up:[0,1,0]},{boundaries:[[11,7,2,4]],dir:[-1,0,-1],up:[0,1,0]},{boundaries:[[17,7,2,4]],dir:[-1,0,1],up:[0,1,0]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,0,1],up:[0,1,0]},{boundaries:[[5,11,2,2]],dir:[.5,.7071,-.5],up:[-.5,.7071,.5]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[.5,.7071,.5],up:[-.5,.7071,-.5]},{boundaries:[[5,5,2,2]],dir:[.5,-.7071,-.5],up:[.5,.7071,-.5]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-.5,.7071,.5],up:[.5,.7071,-.5]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-.5,-.7071,.5],up:[-.5,.7071,.5]},{boundaries:[[11,11,2,2]],dir:[-.5,.7071,-.5],up:[.5,.7071,.5]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[.5,-.7071,.5],up:[.5,.7071,.5]},{boundaries:[[11,5,2,2]],dir:[-.5,-.7071,-.5],up:[-.5,.7071,-.5]}];for(let t=0,e=h.length;t<e;t++)c.normalizeVec3(h[t].dir,h[t].dir),c.normalizeVec3(h[t].up,h[t].up);for(let t=0,e=l.length;t<e;t++)c.normalizeVec3(l[t].dir,l[t].dir),c.normalizeVec3(l[t].up,l[t].up);var u=l;this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=o,this._textureCanvas.height=r,this._textureCanvas.style.width=o+"px",this._textureCanvas.style.height="500px",this._textureCanvas.style.padding="0",this._textureCanvas.style.margin="0",this._textureCanvas.style.top="0",this._textureCanvas.style.background=s,this._textureCanvas.style.position="absolute",this._textureCanvas.style.opacity="1.0",this._textureCanvas.style.visibility="hidden",this._textureCanvas.style["z-index"]=2e6;document.getElementsByTagName("body")[0].appendChild(this._textureCanvas);const p=this._textureCanvas.getContext("2d");let d=!1;function m(){for(let t=0,e=a.length;t<e;t++){const e=a[t],s=e.boundary,i=Math.round(s[0]*n),r=Math.round(s[1]*n),o=Math.round(s[2]*n),h=Math.round(s[3]*n);p.fillStyle=e.color,p.fillRect(i,r,o,h)}for(let t=0,a=u.length;t<a;t++){let a,l,c,d;const m=u[t],g=m.boundaries;for(var e=0,r=g.length;e<r;e++){const t=g[e];a=Math.round(t[0]*n),l=Math.round(t[1]*n),c=Math.round(t[2]*n),d=Math.round(t[3]*n),m.highlighted&&(p.fillStyle=m.highlighted?i:m.color||s,p.fillRect(a,l,c,d))}if(m.label){p.fillStyle="black",p.font="60px sans-serif",p.textAlign="center";var o=a+.5*c,h=l+.7*d;p.fillText(f(m.label),o,h,80)}}t.scene.glRedraw()}const f=function(){const e={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},s={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},i={"NavCube.front":"FRONT","NavCube.back":"BACK","NavCube.right":"RIGHT","NavCube.left":"LEFT","NavCube.top":"TOP","NavCube.bottom":"BOTTOM"};return function(r){const o=d?s:e,n=o?o[r]:null;return n?t.localeService.translate(n)||i[n]||n:r}}();this.setZUp=function(){d=!0,u=h,this.clear()},this.setYUp=function(){d=!1,u=l,this.clear()},this.clear=function(){p.fillStyle=s,p.fillRect(0,0,o,r);for(var t=0,e=u.length;t<e;t++){u[t].highlighted=!1}m()},this.getArea=function(t){const e=t[0]*o,s=r-t[1]*r;for(var i=0,a=u.length;i<a;i++){const t=u[i].boundaries;for(var h=0,l=t.length;h<l;h++){const r=t[h];if(e>=r[0]*n&&e<=(r[0]+r[2])*n&&s>=r[1]*n&&s<=(r[1]+r[3])*n)return i}}return-1},this.setAreaHighlighted=function(t,e){var s=u[t];if(!s)throw"Area not found: "+t;s.highlighted=!!e,m()},this.getAreaDir=function(t){var e=u[t];if(!e)throw"Unknown area: "+t;return e.dir},this.getAreaUp=function(t){var e=u[t];if(!e)throw"Unknown area: "+t;return e.up},this.getImage=function(){return this._textureCanvas},this.destroy=function(){this._textureCanvas&&(this._textureCanvas.parentNode.removeChild(this._textureCanvas),this._textureCanvas=null)}}class Ea extends n{constructor(t,e={}){super("NavCube",t,e),t.navCube=this;try{this._navCubeScene=new Ve(t,{canvasId:e.canvasId,canvasElement:e.canvasElement,transparent:!0}),this._navCubeCanvas=this._navCubeScene.canvas.canvas,this._navCubeScene.input.keyboardEnabled=!1}catch(t){return void this.error(t)}const s=this._navCubeScene;s.clearLights(),new le(s,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new le(s,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new le(s,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._navCubeCamera=s.camera,this._navCubeCamera.ortho.scale=7,this._navCubeCamera.ortho.near=.1,this._navCubeCamera.ortho.far=2e3,s.edgeMaterial.edgeColor=[.2,.2,.2],s.edgeMaterial.edgeAlpha=.6,this._zUp=Boolean(t.camera.zUp);var i=this;this._synchCamera=function(){var e=c.rotationMat4c(-90*c.DEGTORAD,1,0,0),s=c.vec3(),r=c.vec3(),o=c.vec3();return function(){var n=t.camera.eye,a=t.camera.look,h=t.camera.up;s=c.mulVec3Scalar(c.normalizeVec3(c.subVec3(n,a,s)),5),i._zUp?(c.transformVec3(e,s,r),c.transformVec3(e,h,o),i._navCubeCamera.look=[0,0,0],i._navCubeCamera.eye=c.transformVec3(e,s,r),i._navCubeCamera.up=c.transformPoint3(e,h,o)):(i._navCubeCamera.look=[0,0,0],i._navCubeCamera.eye=s,i._navCubeCamera.up=h)}}(),this._cubeTextureCanvas=new Da(t,e),this._cubeSampler=new _a(s,{image:this._cubeTextureCanvas.getImage(),flipY:!0,wrapS:"clampToEdge",wrapT:"clampToEdge"}),this._cubeMesh=new Os(s,{geometry:new xe(s,{primitive:"triangles",normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),material:new Se(s,{diffuse:[.4,.4,.4],specular:[.4,.4,.4],emissive:[.6,.6,.6],diffuseMap:this._cubeSampler,emissiveMap:this._cubeSampler}),visible:!0,edges:!0}),this._shadow=!1===e.shadowVisible?null:new Os(s,{geometry:new xe(s,Ls({center:[0,0,0],radiusTop:.001,radiusBottom:1.4,height:.01,radialSegments:20,heightSegments:1,openEnded:!0})),material:new Se(s,{diffuse:[0,0,0],specular:[0,0,0],emissive:[0,0,0],alpha:.5}),position:[0,-1.5,0],visible:!0,pickable:!1,backfaces:!1}),this._onCameraMatrix=t.camera.on("matrix",this._synchCamera),this._onCameraWorldAxis=t.camera.on("worldAxis",(()=>{t.camera.zUp?(this._zUp=!0,this._cubeTextureCanvas.setZUp(),this._repaint(),this._synchCamera()):t.camera.yUp&&(this._zUp=!1,this._cubeTextureCanvas.setYUp(),this._repaint(),this._synchCamera())})),this._onCameraFOV=t.camera.perspective.on("fov",(t=>{this._synchProjection&&(this._navCubeCamera.perspective.fov=t)})),this._onCameraProjection=t.camera.on("projection",(t=>{this._synchProjection&&(this._navCubeCamera.projection="ortho"===t||"perspective"===t?t:"perspective")}));var r=-1;function o(t){var e=[0,0];if(t){for(var s=t.target,i=0,r=0;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;e[0]=t.pageX-i,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e}var n,a,h=null,l=null,u=!1,p=!1,d=.5;i._navCubeCanvas.addEventListener("mouseenter",i._onMouseEnter=function(t){p=!0}),i._navCubeCanvas.addEventListener("mouseleave",i._onMouseLeave=function(t){p=!1}),i._navCubeCanvas.addEventListener("mousedown",i._onMouseDown=function(t){if(1===t.which){h=t.x,l=t.y,n=t.clientX,a=t.clientY;var e=o(t),i=s.pick({canvasPos:e});u=!!i}}),document.addEventListener("mouseup",i._onMouseUp=function(t){if(1===t.which&&(u=!1,null!==h)){var e=o(t),n=s.pick({canvasPos:e,pickSurface:!0});if(n&&n.uv){var a=i._cubeTextureCanvas.getArea(n.uv);if(a>=0&&(document.body.style.cursor="pointer",r>=0&&(i._cubeTextureCanvas.setAreaHighlighted(r,!1),i._repaint(),r=-1),a>=0)){if(i._cubeTextureCanvas.setAreaHighlighted(a,!0),r=a,i._repaint(),t.x<h-3||t.x>h+3||t.y<l-3||t.y>l+3)return;var p=i._cubeTextureCanvas.getAreaDir(a);if(p){var c=i._cubeTextureCanvas.getAreaUp(a);m(p,c,(function(){r>=0&&(i._cubeTextureCanvas.setAreaHighlighted(r,!1),i._repaint(),r=-1),document.body.style.cursor="pointer",r>=0&&(i._cubeTextureCanvas.setAreaHighlighted(r,!1),i._repaint(),r=-1),a>=0&&(i._cubeTextureCanvas.setAreaHighlighted(a,!1),r=-1,i._repaint())}))}}}}}),document.addEventListener("mousemove",i._onMouseMove=function(e){if(r>=0&&(i._cubeTextureCanvas.setAreaHighlighted(r,!1),i._repaint(),r=-1),1!==e.buttons||u){if(u){var h=e.clientX,l=e.clientY;return document.body.style.cursor="move",void function(e,s){var i=(e-n)*-d,r=(s-a)*-d;t.camera.orbitYaw(i),t.camera.orbitPitch(-r),n=e,a=s}(h,l)}if(p){var c=o(e),m=s.pick({canvasPos:c,pickSurface:!0});if(m){if(m.uv){document.body.style.cursor="pointer";var f=i._cubeTextureCanvas.getArea(m.uv);if(f===r)return;r>=0&&i._cubeTextureCanvas.setAreaHighlighted(r,!1),f>=0&&(i._cubeTextureCanvas.setAreaHighlighted(f,!0),i._repaint(),r=f)}}else document.body.style.cursor="default",r>=0&&(i._cubeTextureCanvas.setAreaHighlighted(r,!1),i._repaint(),r=-1)}}});var m=function(){var e=c.vec3();return function(s,r,o){var n=i._fitVisible?t.scene.getAABB(t.scene.visibleObjectIds):t.scene.aabb,a=c.getAABB3Diag(n);c.getAABB3Center(n,e);var h=Math.abs(a/Math.tan(i._cameraFitFOV*c.DEGTORAD));t.cameraControl.pivotPos=e,i._cameraFly?t.cameraFlight.flyTo({look:e,eye:[e[0]-h*s[0],e[1]-h*s[1],e[2]-h*s[2]],up:r||[0,1,0],orthoScale:1.1*a,fitFOV:i._cameraFitFOV,duration:i._cameraFlyDuration},o):t.cameraFlight.jumpTo({look:e,eye:[e[0]-h*s[0],e[1]-h*s[1],e[2]-h*s[2]],up:r||[0,1,0],orthoScale:1.1*a,fitFOV:i._cameraFitFOV},o)}}();this._onUpdated=t.localeService.on("updated",(()=>{this._cubeTextureCanvas.clear(),this._repaint()})),this.setVisible(e.visible),this.setCameraFitFOV(e.cameraFitFOV),this.setCameraFly(e.cameraFly),this.setCameraFlyDuration(e.cameraFlyDuration),this.setFitVisible(e.fitVisible),this.setSynchProjection(e.synchProjection)}send(t,e){if("language"===t)this._cubeTextureCanvas.clear(),this._repaint()}_repaint(){const t=this._cubeTextureCanvas.getImage();this._cubeMesh.material.diffuseMap.image=t,this._cubeMesh.material.emissiveMap.image=t}setVisible(t=!0){this._navCubeCanvas&&(this._cubeMesh.visible=t,this._shadow&&(this._shadow.visible=t),this._navCubeCanvas.style.visibility=t?"visible":"hidden")}getVisible(){return!!this._navCubeCanvas&&this._cubeMesh.visible}setFitVisible(t=!1){this._fitVisible=t}getFitVisible(){return this._fitVisible}setCameraFly(t=!0){this._cameraFly=t}getCameraFly(){return this._cameraFly}setCameraFitFOV(t=45){this._cameraFitFOV=t}getCameraFitFOV(){return this._cameraFitFOV}setCameraFlyDuration(t=.5){this._cameraFlyDuration=t}getCameraFlyDuration(){return this._cameraFlyDuration}setSynchProjection(t=!1){this._synchProjection=t}getSynchProjection(){return this._synchProjection}destroy(){this._navCubeCanvas&&(this.viewer.localeService.off(this._onUpdated),this.viewer.camera.off(this._onCameraMatrix),this.viewer.camera.off(this._onCameraWorldAxis),this.viewer.camera.perspective.off(this._onCameraFOV),this.viewer.camera.off(this._onCameraProjection),this._navCubeCanvas.removeEventListener("mouseenter",this._onMouseEnter),this._navCubeCanvas.removeEventListener("mouseleave",this._onMouseLeave),this._navCubeCanvas.removeEventListener("mousedown",this._onMouseDown),document.removeEventListener("mousemove",this._onMouseMove),document.removeEventListener("mouseup",this._onMouseUp),this._navCubeCanvas=null,this._cubeTextureCanvas.destroy(),this._cubeTextureCanvas=null,this._onMouseEnter=null,this._onMouseLeave=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null),this._navCubeScene.destroy(),this._navCubeScene=null,this._cubeMesh=null,this._shadow=null,super.destroy()}}const Ia=c.vec3();class Sa{load(t,e,s={}){var i=t.scene.canvas.spinner;i.processes++,Aa(t,e,(function(e){!function(t,e,s){for(var i=e.basePath,r=Object.keys(e.materialLibraries),o=r.length,n=0,a=o;n<a;n++)Fa(t,i,i+r[n],(function(){0==--o&&s()}))}(t,e,(function(){Ra(t,e),i.processes--,I.scheduleTask((function(){t.fire("loaded",!0,!1)}))}))}))}parse(t,e,s,i){if(e){var r=Ca(t,e,null);s&&Oa(t,s,i),Ra(t,r),t.src=null,t.fire("loaded",!0,!1)}else this.warn("load() param expected: objText")}}var Aa=function(t,e,s){La(e,(function(i){var r=Ca(t,i,e);s(r)}),(function(e){t.error(e)}))},Ca=function(){const t={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};return function(s,i,r){var o,n,a={src:r=r||"",basePath:(o=r,n=o.lastIndexOf("/"),-1===n?o:o.substring(0,n+1)),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};e(a,"",!1),-1!==i.indexOf("\r\n")&&(i=i.replace("\r\n","\n"));for(var h=i.split("\n"),l="",c="",d="",m=[],f="function"==typeof"".trimLeft,g=0,_=h.length;g<_;g++)if(l=h[g],0!==(l=f?l.trimLeft():l.trim()).length&&"#"!==(c=l.charAt(0)))if("v"===c)if(" "===(d=l.charAt(1))&&null!==(m=t.vertex_pattern.exec(l)))a.positions.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));else if("n"===d&&null!==(m=t.normal_pattern.exec(l)))a.normals.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3]));else{if("t"!==d||null===(m=t.uv_pattern.exec(l)))return void s.error("Unexpected vertex/normal/uv line: '"+l+"'");a.uv.push(parseFloat(m[1]),parseFloat(m[2]))}else if("f"===c)if(null!==(m=t.face_vertex_uv_normal.exec(l)))u(a,m[1],m[4],m[7],m[10],m[2],m[5],m[8],m[11],m[3],m[6],m[9],m[12]);else if(null!==(m=t.face_vertex_uv.exec(l)))u(a,m[1],m[3],m[5],m[7],m[2],m[4],m[6],m[8]);else if(null!==(m=t.face_vertex_normal.exec(l)))u(a,m[1],m[3],m[5],m[7],void 0,void 0,void 0,void 0,m[2],m[4],m[6],m[8]);else{if(null===(m=t.face_vertex.exec(l)))return void s.error("Unexpected face line: '"+l+"'");u(a,m[1],m[2],m[3],m[4])}else if("l"===c){var y=l.substring(1).trim().split(" "),v=[],b=[];if(-1===l.indexOf("/"))v=y;else for(var P=0,T=y.length;P<T;P++){var w=y[P].split("/");""!==w[0]&&v.push(w[0]),""!==w[1]&&b.push(w[1])}p(a,v,b)}else if(null!==(m=t.object_pattern.exec(l))){e(a,x=m[0].substr(1).trim(),!0)}else if(t.material_use_pattern.test(l)){var x=l.substring(7).trim();a.object.material.id=x}else if(t.material_library_pattern.test(l))a.materialLibraries[l.substring(7).trim()]=!0;else{if(null===(m=t.smoothing_pattern.exec(l))){if("\0"===l)continue;return void s.error("Unexpected line: '"+l+"'")}var M=m[1].trim().toLowerCase();a.object.material.smooth="1"===M||"on"===M}return a};function e(t,e,s){if(t.object&&!1===t.object.fromDeclaration)return t.object.id=e,void(t.object.fromDeclaration=!1!==s);t.object={id:e||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==s},t.objects.push(t.object)}function s(t,e){var s=parseInt(t,10);return 3*(s>=0?s-1:s+e/3)}function i(t,e){var s=parseInt(t,10);return 3*(s>=0?s-1:s+e/3)}function r(t,e){var s=parseInt(t,10);return 2*(s>=0?s-1:s+e/2)}function o(t,e,s,i){var r=t.positions,o=t.object.geometry.positions;o.push(r[e+0]),o.push(r[e+1]),o.push(r[e+2]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[s+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2])}function n(t,e){var s=t.positions,i=t.object.geometry.positions;i.push(s[e+0]),i.push(s[e+1]),i.push(s[e+2])}function a(t,e,s,i){var r=t.normals,o=t.object.geometry.normals;o.push(r[e+0]),o.push(r[e+1]),o.push(r[e+2]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[s+2]),o.push(r[i+0]),o.push(r[i+1]),o.push(r[i+2])}function h(t,e,s,i){var r=t.uv,o=t.object.geometry.uv;o.push(r[e+0]),o.push(r[e+1]),o.push(r[s+0]),o.push(r[s+1]),o.push(r[i+0]),o.push(r[i+1])}function l(t,e){var s=t.uv,i=t.object.geometry.uv;i.push(s[e+0]),i.push(s[e+1])}function u(t,e,n,l,u,p,c,d,m,f,g,_,y){var v,b=t.positions.length,P=s(e,b),T=s(n,b),w=s(l,b);if(void 0===u?o(t,P,T,w):(o(t,P,T,v=s(u,b)),o(t,T,w,v)),void 0!==p){var x=t.uv.length;P=r(p,x),T=r(c,x),w=r(d,x),void 0===u?h(t,P,T,w):(h(t,P,T,v=r(m,x)),h(t,T,w,v))}if(void 0!==f){var M=t.normals.length;P=i(f,M),T=f===g?P:i(g,M),w=f===_?P:i(_,M),void 0===u?a(t,P,T,w):(a(t,P,T,v=i(y,M)),a(t,T,w,v))}}function p(t,e,i){t.object.geometry.type="Line";for(var o=t.positions.length,a=t.uv.length,h=0,u=e.length;h<u;h++)n(t,s(e[h],o));for(var p=0,c=i.length;p<c;p++)l(t,r(i[p],a))}}();var Fa=function(t,e,s,i){La(s,(function(s){Oa(t,s,e),i()}),(function(e){t.error(e),i()}))},Oa=function(){var t=/\s+/;return function(t,r,o){var n,a,h,l,u,p=r.split("\n"),c={id:"Default"},d=!1;o=o||"";for(var m=0;m<p.length;m++)if(0!==(n=p[m].trim()).length&&"#"!==n.charAt(0))switch(h=(h=(a=n.indexOf(" "))>=0?n.substring(0,a):n).toLowerCase(),l=(l=a>=0?n.substring(a+1):"").trim(),h.toLowerCase()){case"newmtl":s(t,c),c={id:l},d=!0;break;case"ka":c.ambient=i(l);break;case"kd":c.diffuse=i(l);break;case"ks":c.specular=i(l);break;case"map_kd":c.diffuseMap||(c.diffuseMap=e(t,o,l,"sRGB"));break;case"map_ks":c.specularMap||(c.specularMap=e(t,o,l,"linear"));break;case"map_bump":case"bump":c.normalMap||(c.normalMap=e(t,o,l));break;case"ns":c.shininess=parseFloat(l);break;case"d":(u=parseFloat(l))<1&&(c.alpha=u,c.alphaMode="blend");break;case"tr":(u=parseFloat(l))>0&&(c.alpha=1-u,c.alphaMode="blend")}d&&s(t,c)};function e(t,e,s,i){var r={},o=s.split(/\s+/),n=o.indexOf("-bm");return n>=0&&o.splice(n,2),(n=o.indexOf("-s"))>=0&&(r.scale=[parseFloat(o[n+1]),parseFloat(o[n+2])],o.splice(n,4)),(n=o.indexOf("-o"))>=0&&(r.translate=[parseFloat(o[n+1]),parseFloat(o[n+2])],o.splice(n,4)),r.src=e+o.join(" ").trim(),r.flipY=!0,r.encoding=i||"linear",new _a(t,r).id}function s(t,e){new Se(t,e)}function i(e){var s=e.split(t,3);return[parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])]}}();function Ra(t,e){for(var s=0,i=e.objects.length;s<i;s++){var r=e.objects[s],o=r.geometry;if(o.type,0===o.positions.length)continue;var n={primitive:"triangles",compressGeometry:!1};n.positions=o.positions,o.normals.length>0&&(n.normals=o.normals),o.uv.length>0&&(n.uv=o.uv);for(var a=new Array(n.positions.length/3),h=0;h<a.length;h++)a[h]=h;n.indices=a;const i=Ia;W(o.positions,o.positions,i);var l,u=new xe(t,n),p=r.material.id;p&&""!==p?(l=t.scene.components[p])||t.error("Material not found: "+p):l=new Se(t,{diffuse:[.6,.6,.6],backfaces:!0});var c=new Os(t,{id:t.id+"#"+r.id,origin:0!==i[0]||0!==i[1]||0!==i[2]?i:null,isObject:!0,geometry:u,material:l,pickable:!0});t.addChild(c)}}function La(t,e,s){var i=new XMLHttpRequest;i.open("GET",t,!0),i.addEventListener("load",(function(t){var i=t.target.response;200===this.status?e&&e(i):0===this.status?(console.warn("loadFile: HTTP Status 0 received."),e&&e(i)):s&&s(t)}),!1),i.addEventListener("error",(function(t){s&&s(t)}),!1),i.send(null)}class Na extends n{constructor(t,e){super("OBJLoader",t,e),this._sceneGraphLoader=new Sa}load(t={}){t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);var e=new Qn(this.viewer.scene,_.apply(t,{isModel:!0}));const s=e.id,i=t.src;if(!i)return this.error("load() param expected: src"),e;if(t.metaModelSrc){const r=t.metaModelSrc;_.loadJSON(r,(r=>{this.viewer.metaScene.createMetaModel(s,r),this._sceneGraphLoader.load(e,i,t)}),(t=>{this.error(`load(): Failed to load model modelMetadata for model '${s} from  '${r}' - ${t}`)}))}else this._sceneGraphLoader.load(e,i,t);return e.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),e}destroy(){super.destroy()}}function Ba(t={}){let e=t.radius||1;e<0&&(console.error("negative radius not allowed - will invert"),e*=-1),e*=.5;let s=t.tube||.3;s<0&&(console.error("negative tube not allowed - will invert"),s*=-1);let i=t.radialSegments||32;i<0&&(console.error("negative radialSegments not allowed - will invert"),i*=-1),i<4&&(i=4);let r=t.tubeSegments||24;r<0&&(console.error("negative tubeSegments not allowed - will invert"),r*=-1),r<4&&(r=4);let o=t.arc||2*Math.PI;o<0&&(console.warn("negative arc not allowed - will invert"),o*=-1),o>360&&(o=360);const n=t.center;let a=n?n[0]:0,h=n?n[1]:0;const l=n?n[2]:0,u=[],p=[],d=[],m=[];let f,g,y,v,b,P,T,w,x,M,D,E;for(w=0;w<=r;w++)for(T=0;T<=i;T++)f=T/i*o,g=.785398+w/r*Math.PI*2,a=e*Math.cos(f),h=e*Math.sin(f),y=(e+s*Math.cos(g))*Math.cos(f),v=(e+s*Math.cos(g))*Math.sin(f),b=s*Math.sin(g),u.push(y+a),u.push(v+h),u.push(b+l),d.push(1-T/i),d.push(w/r),P=c.normalizeVec3(c.subVec3([y,v,b],[a,h,l],[]),[]),p.push(P[0]),p.push(P[1]),p.push(P[2]);for(w=1;w<=r;w++)for(T=1;T<=i;T++)x=(i+1)*w+T-1,M=(i+1)*(w-1)+T-1,D=(i+1)*(w-1)+T,E=(i+1)*w+T,m.push(x),m.push(M),m.push(D),m.push(D),m.push(E),m.push(x);return _.apply(t,{positions:u,normals:p,uv:d,indices:m})}const ka=new Float64Array([0,0,1]),ja=new Float64Array(4);class Ga{constructor(t){this.id=null,this._viewer=t.viewer,this._visible=!1,this._pos=c.vec3(),this._origin=c.vec3(),this._rtcPos=c.vec3(),this._baseDir=c.vec3(),this._rootNode=null,this._displayMeshes=null,this._affordanceMeshes=null,this._ignoreNextSectionPlaneDirUpdate=!1,this._createNodes(),this._bindEvents()}_setSectionPlane(t){this._sectionPlane&&(this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._onSectionPlanePos=null,this._onSectionPlaneDir=null,this._sectionPlane=null),t&&(this.id=t.id,this._setPos(t.pos),this._setDir(t.dir),this._sectionPlane=t,this._onSectionPlanePos=t.on("pos",(()=>{this._setPos(this._sectionPlane.pos)})),this._onSectionPlaneDir=t.on("dir",(()=>{this._ignoreNextSectionPlaneDirUpdate?this._ignoreNextSectionPlaneDirUpdate=!1:this._setDir(this._sectionPlane.dir)})))}get sectionPlane(){return this._sectionPlane}_setPos(t){this._pos.set(t),X(this._pos,this._origin,this._rtcPos),this._rootNode.origin=this._origin,this._rootNode.position=this._rtcPos}_setDir(t){this._baseDir.set(t),this._rootNode.quaternion=c.vec3PairToQuaternion(ka,t,ja)}_setSectionPlaneDir(t){this._sectionPlane&&(this._ignoreNextSectionPlaneDirUpdate=!0,this._sectionPlane.dir=t)}setVisible(t=!0){if(this._visible!==t){var e;for(e in this._visible=t,this._displayMeshes)this._displayMeshes.hasOwnProperty(e)&&(this._displayMeshes[e].visible=t);if(!t)for(e in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(e)&&(this._affordanceMeshes[e].visible=t)}}getVisible(){return this._visible}setCulled(t){var e;for(e in this._displayMeshes)this._displayMeshes.hasOwnProperty(e)&&(this._displayMeshes[e].culled=t);if(!t)for(e in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(e)&&(this._affordanceMeshes[e].culled=t)}_createNodes(){const t=!1,e=this._viewer.scene,s=.01;this._rootNode=new Qn(e,{position:[0,0,0],scale:[5,5,5]});const i=this._rootNode,r={arrowHead:new xe(i,Ls({radiusTop:.001,radiusBottom:.07,radialSegments:32,heightSegments:1,height:.2,openEnded:!1})),arrowHeadBig:new xe(i,Ls({radiusTop:.001,radiusBottom:.09,radialSegments:32,heightSegments:1,height:.25,openEnded:!1})),arrowHeadHandle:new xe(i,Ls({radiusTop:.09,radiusBottom:.09,radialSegments:8,heightSegments:1,height:.37,openEnded:!1})),curve:new xe(i,Ba({radius:.8,tube:s,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),curveHandle:new xe(i,Ba({radius:.8,tube:.06,radialSegments:64,tubeSegments:14,arc:2*Math.PI/4})),hoop:new xe(i,Ba({radius:.8,tube:s,radialSegments:64,tubeSegments:8,arc:2*Math.PI})),axis:new xe(i,Ls({radiusTop:s,radiusBottom:s,radialSegments:20,heightSegments:1,height:1,openEnded:!1})),axisHandle:new xe(i,Ls({radiusTop:.08,radiusBottom:.08,radialSegments:20,heightSegments:1,height:1,openEnded:!1}))},o={pickable:new Se(i,{diffuse:[1,1,0],alpha:0,alphaMode:"blend"}),red:new Se(i,{diffuse:[1,0,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightRed:new Ce(i,{edges:!1,fill:!0,fillColor:[1,0,0],fillAlpha:.6}),green:new Se(i,{diffuse:[0,1,0],emissive:[0,1,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightGreen:new Ce(i,{edges:!1,fill:!0,fillColor:[0,1,0],fillAlpha:.6}),blue:new Se(i,{diffuse:[0,0,1],emissive:[0,0,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightBlue:new Ce(i,{edges:!1,fill:!0,fillColor:[0,0,1],fillAlpha:.2}),center:new Se(i,{diffuse:[0,0,0],emissive:[0,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80}),highlightBall:new Ce(i,{edges:!1,fill:!0,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1}),highlightPlane:new Ce(i,{edges:!0,edgeWidth:3,fill:!1,fillColor:[.5,.5,.5],fillAlpha:.5,vertices:!1})};this._displayMeshes={plane:i.addChild(new Os(i,{geometry:new xe(i,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new Se(i,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,ghostMaterial:new Ce(i,{edges:!1,filled:!0,fillColor:[1,1,0],edgeColor:[0,0,0],fillAlpha:.1,backfaces:!0}),pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1]}),t),planeFrame:i.addChild(new Os(i,{geometry:new xe(i,Ba({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new Se(i,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),highlightMaterial:new Ce(i,{edges:!1,edgeColor:[0,0,0],filled:!0,fillColor:[.8,.8,.8],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45]}),t),xCurve:i.addChild(new Os(i,{geometry:r.curve,material:o.red,matrix:function(){const t=c.rotationMat4v(90*c.DEGTORAD,[0,1,0],c.identityMat4()),e=c.rotationMat4v(270*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),t),xCurveHandle:i.addChild(new Os(i,{geometry:r.curveHandle,material:o.pickable,matrix:function(){const t=c.rotationMat4v(90*c.DEGTORAD,[0,1,0],c.identityMat4()),e=c.rotationMat4v(270*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),t),xCurveArrow1:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.red,matrix:function(){const t=c.translateMat4c(0,-.07,-.8,c.identityMat4()),e=c.scaleMat4v([.6,.6,.6],c.identityMat4()),s=c.rotationMat4v(0*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(c.mulMat4(t,e,c.identityMat4()),s,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),xCurveArrow2:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.red,matrix:function(){const t=c.translateMat4c(0,-.8,-.07,c.identityMat4()),e=c.scaleMat4v([.6,.6,.6],c.identityMat4()),s=c.rotationMat4v(90*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(c.mulMat4(t,e,c.identityMat4()),s,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),yCurve:i.addChild(new Os(i,{geometry:r.curve,material:o.green,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),t),yCurveHandle:i.addChild(new Os(i,{geometry:r.curveHandle,material:o.pickable,rotation:[-90,0,0],pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),t),yCurveArrow1:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.green,matrix:function(){const t=c.translateMat4c(.07,0,-.8,c.identityMat4()),e=c.scaleMat4v([.6,.6,.6],c.identityMat4()),s=c.rotationMat4v(90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(c.mulMat4(t,e,c.identityMat4()),s,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),yCurveArrow2:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.green,matrix:function(){const t=c.translateMat4c(.8,0,-.07,c.identityMat4()),e=c.scaleMat4v([.6,.6,.6],c.identityMat4()),s=c.rotationMat4v(90*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(c.mulMat4(t,e,c.identityMat4()),s,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),zCurve:i.addChild(new Os(i,{geometry:r.curve,material:o.blue,matrix:c.rotationMat4v(180*c.DEGTORAD,[1,0,0],c.identityMat4()),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),zCurveHandle:i.addChild(new Os(i,{geometry:r.curveHandle,material:o.pickable,matrix:c.rotationMat4v(180*c.DEGTORAD,[1,0,0],c.identityMat4()),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),zCurveCurveArrow1:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.blue,matrix:function(){const t=c.translateMat4c(.8,-.07,0,c.identityMat4()),e=c.scaleMat4v([.6,.6,.6],c.identityMat4());return c.mulMat4(t,e,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),zCurveArrow2:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.blue,matrix:function(){const t=c.translateMat4c(.05,-.8,0,c.identityMat4()),e=c.scaleMat4v([.6,.6,.6],c.identityMat4()),s=c.rotationMat4v(90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(c.mulMat4(t,e,c.identityMat4()),s,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),center:i.addChild(new Os(i,{geometry:new xe(i,Ns({radius:.05})),material:o.center,pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),xAxisArrow:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.red,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),xAxisArrowHandle:i.addChild(new Os(i,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),xAxis:i.addChild(new Os(i,{geometry:r.axis,material:o.red,matrix:function(){const t=c.translateMat4c(0,.5,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),xAxisHandle:i.addChild(new Os(i,{geometry:r.axisHandle,material:o.pickable,matrix:function(){const t=c.translateMat4c(0,.5,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),yAxisArrow:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.green,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(180*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),yAxisArrowHandle:i.addChild(new Os(i,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(180*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1,opacity:.2}),t),yShaft:i.addChild(new Os(i,{geometry:r.axis,material:o.green,position:[0,-.5,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),yShaftHandle:i.addChild(new Os(i,{geometry:r.axisHandle,material:o.pickable,position:[0,-.5,0],pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),zAxisArrow:i.addChild(new Os(i,{geometry:r.arrowHead,material:o.blue,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[.8,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),zAxisArrowHandle:i.addChild(new Os(i,{geometry:r.arrowHeadHandle,material:o.pickable,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[.8,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!0,collidable:!0,clippable:!1,visible:!1}),t),zShaft:i.addChild(new Os(i,{geometry:r.axis,material:o.blue,matrix:function(){const t=c.translateMat4c(0,.5,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),clippable:!1,pickable:!1,collidable:!0,visible:!1}),t),zAxisHandle:i.addChild(new Os(i,{geometry:r.axisHandle,material:o.pickable,matrix:function(){const t=c.translateMat4c(0,.5,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),clippable:!1,pickable:!0,collidable:!0,visible:!1}),t)},this._affordanceMeshes={planeFrame:i.addChild(new Os(i,{geometry:new xe(i,Ba({center:[0,0,0],radius:2,tube:s,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new Se(i,{ambient:[1,1,1],diffuse:[0,0,0],emissive:[1,1,0]}),highlighted:!0,highlightMaterial:new Ce(i,{edges:!1,filled:!0,fillColor:[1,1,0],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,1],rotation:[0,0,45]}),t),xHoop:i.addChild(new Os(i,{geometry:r.hoop,material:o.red,highlighted:!0,highlightMaterial:o.highlightRed,matrix:function(){const t=c.rotationMat4v(90*c.DEGTORAD,[0,1,0],c.identityMat4()),e=c.rotationMat4v(270*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),yHoop:i.addChild(new Os(i,{geometry:r.hoop,material:o.green,highlighted:!0,highlightMaterial:o.highlightGreen,rotation:[-90,0,0],pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),zHoop:i.addChild(new Os(i,{geometry:r.hoop,material:o.blue,highlighted:!0,highlightMaterial:o.highlightBlue,matrix:c.rotationMat4v(180*c.DEGTORAD,[1,0,0],c.identityMat4()),pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1}),t),xAxisArrow:i.addChild(new Os(i,{geometry:r.arrowHeadBig,material:o.red,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[0,0,1],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),yAxisArrow:i.addChild(new Os(i,{geometry:r.arrowHeadBig,material:o.green,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(180*c.DEGTORAD,[1,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t),zAxisArrow:i.addChild(new Os(i,{geometry:r.arrowHeadBig,material:o.blue,matrix:function(){const t=c.translateMat4c(0,1.1,0,c.identityMat4()),e=c.rotationMat4v(-90*c.DEGTORAD,[.8,0,0],c.identityMat4());return c.mulMat4(e,t,c.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),t)}}_bindEvents(){const t=this;var e=!1;const s=-1,i=0,r=1,o=2,n=3,a=4,h=5,l=this._rootNode;var u=null,p=null;const d=c.vec2(),m=c.vec3([1,0,0]),f=c.vec3([0,1,0]),g=c.vec3([0,0,1]),_=this._viewer.scene.canvas.canvas,y=this._viewer.camera,v=this._viewer.scene;{const t=c.vec3([0,0,0]);let e=-1;this._onCameraViewMatrix=v.camera.on("viewMatrix",(()=>{})),this._onCameraProjMatrix=v.camera.on("projMatrix",(()=>{})),this._onSceneTick=v.on("tick",(()=>{const s=Math.abs(c.lenVec3(c.subVec3(v.camera.eye,this._pos,t)));if(s!==e&&"perspective"===y.projection){const t=.07*(Math.tan(y.perspective.fov*c.DEGTORAD)*s);l.scale=[t,t,t],e=s}if("ortho"===y.projection){const t=y.ortho.scale/10;l.scale=[t,t,t],e=s}}))}const b=function(){const t=new Float64Array(2);return function(e){if(e){for(var s=e.target,i=0,r=0;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t}}(),P=function(){const e=c.mat4();return function(s,i){return c.quaternionToMat4(t._rootNode.quaternion,e),c.transformVec3(e,s,i),c.normalizeVec3(i),i}}();var T=function(){const t=c.vec3();return function(e){const s=Math.abs(e[0]);return s>Math.abs(e[1])&&s>Math.abs(e[2])?c.cross3Vec3(e,[0,1,0],t):c.cross3Vec3(e,[1,0,0],t),c.cross3Vec3(t,e,t),c.normalizeVec3(t),t}}();const w=function(){const e=c.vec3(),s=c.vec3(),i=c.vec4();return function(r,o,n){P(r,i);const a=T(i,o,n);M(o,a,e),M(n,a,s),c.subVec3(s,e);const h=c.dotVec3(s,i);t._pos[0]+=i[0]*h,t._pos[1]+=i[1]*h,t._pos[2]+=i[2]*h,t._rootNode.position=t._pos,t._sectionPlane&&(t._sectionPlane.pos=t._pos)}}();var x=function(){const e=c.vec4(),s=c.vec4(),i=c.vec4(),r=c.vec4();return function(o,n,a){P(o,r);if(!(M(n,r,e)&&M(a,r,s))){const t=T(r,n,a);M(n,t,e,1),M(a,t,s,1);var h=c.dotVec3(e,r);e[0]-=h*r[0],e[1]-=h*r[1],e[2]-=h*r[2],h=c.dotVec3(s,r),s[0]-=h*r[0],s[1]-=h*r[1],s[2]-=h*r[2]}c.normalizeVec3(e),c.normalizeVec3(s),h=c.dotVec3(e,s),h=c.clamp(h,-1,1);var l=Math.acos(h)*c.RADTODEG;c.cross3Vec3(e,s,i),c.dotVec3(i,r)<0&&(l=-l),t._rootNode.rotate(o,l),D()}}(),M=function(){const e=c.vec4([0,0,0,1]),s=c.mat4();return function(i,r,o,n){n=n||0,e[0]=i[0]/_.width*2-1,e[1]=-(i[1]/_.height*2-1),e[2]=0,e[3]=1,c.mulMat4(y.projMatrix,y.viewMatrix,s),c.inverseMat4(s),c.transformVec4(s,e,e),c.mulVec4Scalar(e,1/e[3]);var a=y.eye;c.subVec4(e,a,e);const h=t._sectionPlane.pos;var l=-c.dotVec3(h,r)-n,u=c.dotVec3(r,e);if(Math.abs(u)>.005){var p=-(c.dotVec3(r,a)+l)/u;return c.mulVec3Scalar(e,p,o),c.addVec3(o,a),c.subVec3(o,h,o),!0}return!1}}();const D=function(){const e=c.vec3(),s=c.mat4();return function(){t.sectionPlane&&(c.quaternionToMat4(l.quaternion,s),c.transformVec3(s,[0,0,1],e),t._setSectionPlaneDir(e))}}();var E,I=!1;this._onCameraControlHover=this._viewer.cameraControl.on("hoverEnter",(t=>{if(!this._visible)return;if(I)return;var l;e=!1,E&&(E.visible=!1);switch(t.entity.id){case this._displayMeshes.xAxisArrowHandle.id:case this._displayMeshes.xAxisHandle.id:l=this._affordanceMeshes.xAxisArrow,u=i;break;case this._displayMeshes.yAxisArrowHandle.id:case this._displayMeshes.yShaftHandle.id:l=this._affordanceMeshes.yAxisArrow,u=r;break;case this._displayMeshes.zAxisArrowHandle.id:case this._displayMeshes.zAxisHandle.id:l=this._affordanceMeshes.zAxisArrow,u=o;break;case this._displayMeshes.xCurveHandle.id:l=this._affordanceMeshes.xHoop,u=n;break;case this._displayMeshes.yCurveHandle.id:l=this._affordanceMeshes.yHoop,u=a;break;case this._displayMeshes.zCurveHandle.id:l=this._affordanceMeshes.zHoop,u=h;break;default:return void(u=s)}l&&(l.visible=!0),E=l,e=!0})),this._onCameraControlHoverLeave=this._viewer.cameraControl.on("hoverOut",(t=>{this._visible&&(E&&(E.visible=!1),E=null,u=s)})),_.addEventListener("mousedown",this._canvasMouseDownListener=t=>{if(t.preventDefault(),this._visible&&e&&(this._viewer.cameraControl.pointerEnabled=!1,1===t.which)){I=!0;var s=b(t);p=u,d[0]=s[0],d[1]=s[1]}}),_.addEventListener("mousemove",this._canvasMouseMoveListener=t=>{if(!this._visible)return;if(!I)return;var e=b(t);const s=e[0],l=e[1];switch(p){case i:w(m,d,e);break;case r:w(f,d,e);break;case o:w(g,d,e);break;case n:x(m,d,e);break;case a:x(f,d,e);break;case h:x(g,d,e)}d[0]=s,d[1]=l}),_.addEventListener("mouseup",this._canvasMouseUpListener=t=>{this._visible&&(this._viewer.cameraControl.pointerEnabled=!0,I&&(t.which,I=!1,e=!1))}),_.addEventListener("wheel",this._canvasWheelListener=t=>{if(this._visible)Math.max(-1,Math.min(1,40*-t.deltaY))})}_destroy(){this._unbindEvents(),this._destroyNodes()}_unbindEvents(){const t=this._viewer,e=t.scene,s=e.canvas.canvas,i=t.camera,r=t.cameraControl;e.off(this._onSceneTick),s.removeEventListener("mousedown",this._canvasMouseDownListener),s.removeEventListener("mousemove",this._canvasMouseMoveListener),s.removeEventListener("mouseup",this._canvasMouseUpListener),s.removeEventListener("wheel",this._canvasWheelListener),i.off(this._onCameraViewMatrix),i.off(this._onCameraProjMatrix),r.off(this._onCameraControlHover),r.off(this._onCameraControlHoverLeave)}_destroyNodes(){this._setSectionPlane(null),this._rootNode.destroy(),this._displayMeshes={},this._affordanceMeshes={}}}class Ha{constructor(t,e,s){this.id=s.id,this._sectionPlane=s,this._mesh=new Os(e,{id:s.id,geometry:new xe(e,Me({xSize:.5,ySize:.5,zSize:.001})),material:new Se(e,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new Oe(e,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Ce(e,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Ce(e,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});{const t=c.vec3([0,0,0]),e=c.vec3(),s=c.vec3([0,0,1]),i=c.vec4(4),r=c.vec3(),o=()=>{const o=this._sectionPlane.scene.center,n=[-this._sectionPlane.dir[0],-this._sectionPlane.dir[1],-this._sectionPlane.dir[2]];c.subVec3(o,this._sectionPlane.pos,t);const a=-c.dotVec3(n,t);c.normalizeVec3(n),c.mulVec3Scalar(n,a,e);const h=c.vec3PairToQuaternion(s,this._sectionPlane.dir,i);r[0]=.1*e[0],r[1]=.1*e[1],r[2]=.1*e[2],this._mesh.quaternion=h,this._mesh.position=r};this._onSectionPlanePos=this._sectionPlane.on("pos",o),this._onSectionPlaneDir=this._sectionPlane.on("dir",o)}this._highlighted=!1,this._selected=!1}setHighlighted(t){this._highlighted=!!t,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=t?[0,.7,0]:[0,0,0]}getHighlighted(){return this._highlighted}setSelected(t){this._selected=!!t,this._mesh.edgeMaterial.edgeWidth=t?3:1,this._mesh.highlightMaterial.edgeWidth=t?3:1}getSelected(){return this._selected}destroy(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}class Va{constructor(t,e){if(!(e.onHoverEnterPlane&&e.onHoverLeavePlane&&e.onClickedNothing&&e.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=t,this._viewer=t.viewer,this._onHoverEnterPlane=e.onHoverEnterPlane,this._onHoverLeavePlane=e.onHoverLeavePlane,this._onClickedNothing=e.onClickedNothing,this._onClickedPlane=e.onClickedPlane,this._visible=!0,this._planes={},this._canvas=e.overviewCanvas,this._scene=new Ve(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new le(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new le(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new le(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;{const t=this._scene.camera,e=c.rotationMat4c(-90*c.DEGTORAD,1,0,0),s=c.vec3(),i=c.vec3(),r=c.vec3();this._synchCamera=()=>{const o=this._viewer.camera.eye,n=this._viewer.camera.look,a=this._viewer.camera.up;c.mulVec3Scalar(c.normalizeVec3(c.subVec3(o,n,s)),7),this._zUp?(c.transformVec3(e,s,i),c.transformVec3(e,a,r),t.look=[0,0,0],t.eye=c.transformVec3(e,s,i),t.up=c.transformPoint3(e,a,r)):(t.look=[0,0,0],t.eye=s,t.up=a)}}this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(t=>{this._scene.camera.perspective.fov=t}));var s=null;this._onInputMouseMove=this._scene.input.on("mousemove",(t=>{const e=this._scene.pick({canvasPos:t});if(e){if(!s||e.entity.id!==s.id){if(s){this._planes[s.id]&&this._onHoverLeavePlane(s.id)}s=e.entity;this._planes[s.id]&&this._onHoverEnterPlane(s.id)}}else s&&(this._onHoverLeavePlane(s.id),s=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=()=>{if(s){this._planes[s.id]&&this._onClickedPlane(s.id)}else this._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=()=>{s&&(this._onHoverLeavePlane(s.id),s=null)}),this.setVisible(e.overviewVisible)}addSectionPlane(t){this._planes[t.id]=new Ha(this,this._scene,t)}setPlaneHighlighted(t,e){const s=this._planes[t];s&&s.setHighlighted(e)}setPlaneSelected(t,e){const s=this._planes[t];s&&s.setSelected(e)}removeSectionPlane(t){const e=this._planes[t.id];e&&(e.destroy(),delete this._planes[t.id])}setVisible(t=!0){this._visible=t,this._canvas.style.visibility=t?"visible":"hidden"}getVisible(){return this._visible}destroy(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}const za=c.AABB3(),Ua=c.vec3();class Xa extends n{constructor(t,e={}){if(super("SectionPlanes",t),this._freeControls=[],this._sectionPlanes=t.scene.sectionPlanes,this._controls={},this._shownControlId=null,null!==e.overviewCanvasId&&void 0!==e.overviewCanvasId){const t=document.getElementById(e.overviewCanvasId);t?this._overview=new Va(this,{overviewCanvas:t,visible:e.overviewVisible,onHoverEnterPlane:t=>{this._overview.setPlaneHighlighted(t,!0)},onHoverLeavePlane:t=>{this._overview.setPlaneHighlighted(t,!1)},onClickedPlane:t=>{if(this.getShownControl()===t)return void this.hideControl();this.showControl(t);const e=this.sectionPlanes[t].pos;za.set(this.viewer.scene.aabb),c.getAABB3Center(za,Ua),za[0]+=e[0]-Ua[0],za[1]+=e[1]-Ua[1],za[2]+=e[2]-Ua[2],za[3]+=e[0]-Ua[0],za[4]+=e[1]-Ua[1],za[5]+=e[2]-Ua[2],this.viewer.cameraFlight.flyTo({aabb:za,fitFOV:65})},onClickedNothing:()=>{this.hideControl()}}):this.warn("Can't find overview canvas: '"+e.overviewCanvasId+"' - will create plugin without overview")}this._onSceneSectionPlaneCreated=t.scene.on("sectionPlaneCreated",(t=>{this._sectionPlaneCreated(t)}))}setOverviewVisible(t){this._overview&&this._overview.setVisible(t)}getOverviewVisible(){if(this._overview)return this._overview.getVisible()}get sectionPlanes(){return this._sectionPlanes}createSectionPlane(t={}){void 0!==t.id&&null!==t.id&&this.viewer.scene.components[t.id]&&(this.error("Viewer component with this ID already exists: "+t.id),delete t.id);return new Gs(this.viewer.scene,{id:t.id,pos:t.pos,dir:t.dir,active:!0})}_sectionPlaneCreated(t){const e=this._freeControls.length>0?this._freeControls.pop():new Ga(this);e._setSectionPlane(t),e.setVisible(!1),this._controls[t.id]=e,this._overview&&this._overview.addSectionPlane(t),t.once("destroyed",(()=>{this._sectionPlaneDestroyed(t)}))}flipSectionPlanes(){const t=this.viewer.scene.sectionPlanes;for(let e in t){t[e].flipDir()}}showControl(t){const e=this._controls[t];e?(this.hideControl(),e.setVisible(!0),this._overview&&this._overview.setPlaneSelected(t,!0),this._shownControlId=t):this.error("Control not found: "+t)}getShownControl(){return this._shownControlId}hideControl(){for(var t in this._controls)this._controls.hasOwnProperty(t)&&(this._controls[t].setVisible(!1),this._overview&&this._overview.setPlaneSelected(t,!1));this._shownControlId=null}destroySectionPlane(t){var e=this.viewer.scene.sectionPlanes[t];e?(this._sectionPlaneDestroyed(e),e.destroy(),t===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+t)}_sectionPlaneDestroyed(t){this._overview&&this._overview.removeSectionPlane(t);const e=this._controls[t.id];e&&(e.setVisible(!1),e._setSectionPlane(null),delete this._controls[t.id],this._freeControls.push(e))}clear(){const t=Object.keys(this._sectionPlanes);for(var e=0,s=t.length;e<s;e++)this.destroySectionPlane(t[e])}send(t,e){switch(t){case"snapshotStarting":for(let t in this._controls)this._controls.hasOwnProperty(t)&&this._controls[t].setCulled(!0);break;case"snapshotFinished":for(let t in this._controls)this._controls.hasOwnProperty(t)&&this._controls[t].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}destroy(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),super.destroy()}_destroyFreeControls(){for(var t=this._freeControls.pop();t;)t._destroy(),t=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}}class Wa extends A{constructor(t,e={}){super(t,e),this._skyboxMesh=new Os(this,{geometry:new xe(this,{primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),background:!0,scale:[2e3,2e3,2e3],rotation:[0,-90,0],material:new Se(this,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:new _a(this,{src:e.src,flipY:!0,wrapS:"clampToEdge",wrapT:"clampToEdge",encoding:e.encoding||"sRGB"}),backfaces:!0}),visible:!1,pickable:!1,collidable:!1}),this.size=e.size,this.active=e.active}set size(t){this._size=t||1e3,this._skyboxMesh.scale=[this._size,this._size,this._size]}get size(){return this._size}set active(t){this._skyboxMesh.visible=t}get active(){return this._skyboxMesh.visible}}class Ya extends n{constructor(t){super("skyboxes",t),this.skyboxes={}}send(t,e){if("clear"===t)this.clear()}createSkybox(t,e){if(this.viewer.scene.components[t])return this.error("Component with this ID already exists: "+t),this;var s=new Wa(this.viewer.scene,{id:t,pos:e.pos,dir:e.dir,active:!0});return this.skyboxes[t]=s,s}destroySkybox(t){var e=this.skyboxes[t];e?e.destroy():this.error("Skybox not found: "+t)}clear(){for(var t=Object.keys(this.viewer.scene.skyboxes),e=0,s=t.length;e<s;e++)this.destroySkybox(t[e])}destroy(){this.clear(),super.clear()}}class Ka{getSTL(t,e,s){const i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e(i.response):s(i.statusText))},i.send(null)}}const Za=c.vec3();class qa{load(t,e,s,i,r,o){i=i||{};const n=t.viewer.scene.canvas.spinner;n.processes++,t.dataSource.getSTL(s,(function(s){!function(t,e,s,i){try{const r=sh(s);$a(r)?Qa(t,r,e,i):Ja(t,eh(s),e,i)}catch(t){e.fire("error",t)}}(t,e,s,i);try{const o=sh(s);$a(o)?Qa(t,o,e,i):Ja(t,eh(s),e,i),n.processes--,I.scheduleTask((function(){e.fire("loaded",!0,!1)})),r&&r()}catch(s){n.processes--,t.error(s),o&&o(s),e.fire("error",s)}}),(function(s){n.processes--,t.error(s),o&&o(s),e.fire("error",s)}))}parse(t,e,s,i){const r=t.viewer.scene.canvas.spinner;r.processes++;try{const o=sh(s);$a(o)?Qa(t,o,e,i):Ja(t,eh(s),e,i),r.processes--,I.scheduleTask((function(){e.fire("loaded",!0,!1)}))}catch(t){r.processes--,e.fire("error",t)}}}function $a(t){const e=new DataView(t);if(84+50*e.getUint32(80,!0)===e.byteLength)return!0;const s=[115,111,108,105,100];for(var i=0;i<5;i++)if(s[i]!==e.getUint8(i,!1))return!0;return!1}function Qa(t,e,s,i){const r=new DataView(e),o=r.getUint32(80,!0);let n,a,h,l,u,p,c,d=!1,m=null,f=null,g=null,_=!1;for(let t=0;t<70;t++)1129270351===r.getUint32(t,!1)&&82===r.getUint8(t+4)&&61===r.getUint8(t+5)&&(d=!0,l=[],u=r.getUint8(t+6)/255,p=r.getUint8(t+7)/255,c=r.getUint8(t+8)/255,r.getUint8(t+9));const y=new na(s,{roughness:.5});let v=[],b=[],P=i.splitMeshes;for(let t=0;t<o;t++){let e=84+50*t,o=r.getFloat32(e,!0),T=r.getFloat32(e+4,!0),w=r.getFloat32(e+8,!0);if(d){let t=r.getUint16(e+48,!0);0==(32768&t)?(n=(31&t)/31,a=(t>>5&31)/31,h=(t>>10&31)/31):(n=u,a=p,h=c),(P&&n!==m||a!==f||h!==g)&&(null!==m&&(_=!0),m=n,f=a,g=h)}for(let t=1;t<=3;t++){let s=e+12*t;v.push(r.getFloat32(s,!0)),v.push(r.getFloat32(s+4,!0)),v.push(r.getFloat32(s+8,!0)),b.push(o,T,w),d&&l.push(n,a,h,1)}P&&_&&(th(s,v,b,l,y,i),v=[],b=[],l=l?[]:null,_=!1)}v.length>0&&th(s,v,b,l,y,i)}function Ja(t,e,s,i){const r=/facet([\s\S]*?)endfacet/g;let o=0;const n=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,a=new RegExp("vertex"+n+n+n,"g"),h=new RegExp("normal"+n+n+n,"g"),l=[],u=[];let p,c,d,m,f,g,_;for(;null!==(m=r.exec(e));){for(f=0,g=0,_=m[0];null!==(m=h.exec(_));)p=parseFloat(m[1]),c=parseFloat(m[2]),d=parseFloat(m[3]),g++;for(;null!==(m=a.exec(_));)l.push(parseFloat(m[1]),parseFloat(m[2]),parseFloat(m[3])),u.push(p,c,d),f++;1!==g&&t.error("Error in normal of face "+o),3!==f&&t.error("Error in positions of face "+o),o++}th(s,l,u,null,new na(s,{roughness:.5}),i)}function th(t,e,s,i,r,o){const n=new Int32Array(e.length/3);for(let t=0,e=n.length;t<e;t++)n[t]=t;s=s&&s.length>0?s:null,i=i&&i.length>0?i:null,o.smoothNormals&&c.faceToVertexNormals(e,s,o);const a=Za;W(e,e,a);const h=new xe(t,{primitive:"triangles",positions:e,normals:s,colors:i,indices:n}),l=new Os(t,{origin:0!==a[0]||0!==a[1]||0!==a[2]?a:null,geometry:h,material:r,edges:o.edges});t.addChild(l)}function eh(t){return"string"!=typeof t?function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let s=0,i=t.length;s<i;s++)e+=String.fromCharCode(t[s]);return decodeURIComponent(escape(e))}(new Uint8Array(t)):t}function sh(t){if("string"==typeof t){const e=new Uint8Array(t.length);for(let s=0;s<t.length;s++)e[s]=255&t.charCodeAt(s);return e.buffer||e}return t}class ih extends n{constructor(t,e={}){super("STLLoader",t,e),this._sceneGraphLoader=new qa,this.dataSource=e.dataSource}set dataSource(t){this._dataSource=t||new Ka}get dataSource(){return this._dataSource}load(t){t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);const e=new Qn(this.viewer.scene,_.apply(t,{isModel:!0})),s=t.src,i=t.stl;return s||i?(s?this._sceneGraphLoader.load(this,e,s,t):this._sceneGraphLoader.parse(this,e,i,t),e):(this.error("load() param expected: either 'src' or 'stl'"),e)}}class rh{constructor(t,e,s,i,r){this.plugin=t,this.storeyId=i,this.modelId=s,this.aabb=e.slice(),this.numObjects=r}}const oh={IfcSlab:{visible:!0,edges:!1,colorize:[1,1,1,1]},IfcWall:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcWallStandardCase:{visible:!0,edges:!1,colorize:[.1,.1,.1,1]},IfcDoor:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcWindow:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcColumn:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcCurtainWall:{visible:!0,edges:!1,colorize:[.5,.5,.5,1]},IfcStair:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcStairFlight:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcRamp:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFurniture:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFooting:{visible:!0,edges:!1,colorize:[.7,.7,.7,1]},IfcFloor:{visible:!0,edges:!1,colorize:[1,1,1,1]},DEFAULT:{visible:!1}},nh=c.vec3();class ah{constructor(){this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsHasColorize=[],this.objectsOpacity=[],this.numObjects=0}saveObjects(t,e){this.numObjects=0,this._mask=e?_.apply(e,{}):null;const s=t.objects,i=!e||e.visible,r=!e||e.edges,o=!e||e.xrayed,n=!e||e.highlighted,a=!e||e.selected,h=!e||e.clippable,l=!e||e.pickable,u=!e||e.colorize,p=!e||e.opacity;for(let t in s)if(s.hasOwnProperty(t)){const e=s[t],c=this.numObjects;if(i&&(this.objectsVisible[c]=e.visible),r&&(this.objectsEdges[c]=e.edges),o&&(this.objectsXrayed[c]=e.xrayed),n&&(this.objectsHighlighted[c]=e.highlighted),a&&(this.objectsSelected[c]=e.selected),h&&(this.objectsClippable[c]=e.clippable),l&&(this.objectsPickable[c]=e.pickable),u){const t=e.colorize;t?(this.objectsColorize[3*c+0]=t[0],this.objectsColorize[3*c+1]=t[1],this.objectsColorize[3*c+2]=t[2],this.objectsHasColorize[c]=!0):this.objectsHasColorize[c]=!1}p&&(this.objectsOpacity[c]=e.opacity),this.numObjects++}}restoreObjects(t){const e=this._mask,s=!e||e.visible,i=!e||e.edges,r=!e||e.xrayed,o=!e||e.highlighted,n=!e||e.selected,a=!e||e.clippable,h=!e||e.pickable,l=!e||e.colorize,u=!e||e.opacity;var p=0;const c=t.objects;for(let t in c)if(c.hasOwnProperty(t)){const e=c[t];s&&(e.visible=this.objectsVisible[p]),i&&(e.edges=this.objectsEdges[p]),r&&(e.xrayed=this.objectsXrayed[p]),o&&(e.highlighted=this.objectsHighlighted[p]),n&&(e.selected=this.objectsSelected[p]),a&&(e.clippable=this.objectsClippable[p]),h&&(e.pickable=this.objectsPickable[p]),l&&(this.objectsHasColorize[p]?(nh[0]=this.objectsColorize[3*p+0],nh[1]=this.objectsColorize[3*p+1],nh[2]=this.objectsColorize[3*p+2],e.colorize=nh):e.colorize=null),u&&(e.opacity=this.objectsOpacity[p]),p++}}}class hh{constructor(t){this._eye=c.vec3(),this._look=c.vec3(),this._up=c.vec3(),this._projection={},t&&this.saveCamera(t)}saveCamera(t){const e=t.camera,s=e.project;switch(this._eye.set(e.eye),this._look.set(e.look),this._up.set(e.up),e.projection){case"perspective":this._projection={projection:"perspective",fov:s.fov,fovAxis:s.fovAxis,near:s.near,far:s.far};break;case"ortho":this._projection={projection:"ortho",scale:s.scale,near:s.near,far:s.far};break;case"frustum":this._projection={projection:"frustum",left:s.left,right:s.right,top:s.top,bottom:s.bottom,near:s.near,far:s.far};break;case"custom":this._projection={projection:"custom",matrix:s.matrix.slice()}}}restoreCamera(t,e){const s=t.camera,i=this._projection;function r(){switch(i.type){case"perspective":s.perspective.fov=i.fov,s.perspective.fovAxis=i.fovAxis,s.perspective.near=i.near,s.perspective.far=i.far;break;case"ortho":s.ortho.scale=i.scale,s.ortho.near=i.near,s.ortho.far=i.far;break;case"frustum":s.frustum.left=i.left,s.frustum.right=i.right,s.frustum.top=i.top,s.frustum.bottom=i.bottom,s.frustum.near=i.near,s.frustum.far=i.far;break;case"custom":s.customProjection.matrix=i.matrix}}e?t.viewer.cameraFlight.flyTo({eye:this._eye,look:this._look,up:this._up,orthoScale:i.scale,projection:i.projection},(()=>{r(),e()})):(s.eye=this._eye,s.look=this._look,s.up=this._up,r(),s.projection=i.projection)}}class lh{constructor(t,e,s,i,r,o){this.storeyId=t,this.imageData=e,this.format=s,this.width=i,this.height=r}}const uh=c.vec3(),ph=c.mat4();class ch extends n{constructor(t,e={}){super("StoreyViews",t),this._objectsMemento=new ah,this._cameraMemento=new hh,this.storeys={},this.modelStoreys={},this.objectStates=e.objectStates,this._onModelLoaded=this.viewer.scene.on("modelLoaded",(t=>{this._registerModelStoreys(t),this.fire("storeys",this.storeys)}))}_registerModelStoreys(t){const e=this.viewer,s=e.scene,i=e.metaScene,r=i.metaModels[t],o=s.models[t];if(!r||!r.rootMetaObject)return;const n=r.rootMetaObject.getObjectIDsInSubtreeByType(["IfcBuildingStorey"]);for(let e=0,r=n.length;e<r;e++){const r=n[e],a=i.metaObjects[r].getObjectIDsInSubtree(),h=s.getAABB(a),l=Math.random()>.5?a.length:0,u=new rh(this,h,t,r,l);u._onModelDestroyed=o.once("destroyed",(()=>{this._deregisterModelStoreys(t),this.fire("storeys",this.storeys)})),this.storeys[r]=u,this.modelStoreys[t]||(this.modelStoreys[t]={}),this.modelStoreys[t][r]=u}}_deregisterModelStoreys(t){const e=this.modelStoreys[t];if(e){const s=this.viewer.scene;for(let t in e)if(e.hasOwnProperty(t)){const i=e[t],r=s.models[i.modelId];r&&r.off(i._onModelDestroyed),delete this.storeys[t]}delete this.modelStoreys[t]}}set objectStates(t){this._objectStates=t||oh}get objectStates(){return this._objectStates}gotoStoreyCamera(t,e={}){const s=this.storeys[t];if(!s)return this.error("IfcBuildingStorey not found with this ID: "+t),void(e.done&&e.done());const i=this.viewer,r=i.scene.camera,o=s.aabb;if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])return void(e.done&&e.done());if(o[3]===o[0]&&o[4]===o[1]&&o[5]===o[2])return void(e.done&&e.done());const n=c.getAABB3Center(o),a=c.getAABB3Diag(o),h=Math.abs(a/Math.tan(45*c.DEGTORAD)),l=1.3*a,u=uh;u[0]=n[0]+r.worldUp[0]*h,u[1]=n[1]+r.worldUp[1]*h,u[2]=n[2]+r.worldUp[2]*h;const p=r.worldForward;e.done?i.cameraFlight.flyTo(_.apply(e,{eye:u,look:n,up:p,orthoScale:l}),(()=>{e.done()})):(i.cameraFlight.jumpTo(_.apply(e,{eye:u,look:n,up:p,orthoScale:l})),i.camera.ortho.scale=l)}showStoreyObjects(t,e={}){if(!this.storeys[t])return void this.error("IfcBuildingStorey not found with this ID: "+t);const s=this.viewer,i=s.scene;s.metaScene.metaObjects[t]&&(e.hideOthers&&i.setObjectsVisible(s.scene.visibleObjectIds,!1),this.withStoreyObjects(t,((t,s)=>{if(t)if(e.useObjectStates){const e=this._objectStates[s.type]||this._objectStates.DEFAULT;e&&(t.visible=e.visible,t.edges=e.edges,e.colorize&&(t.colorize=e.colorize),null!==e.opacity&&void 0!==e.opacity&&(t.opacity=e.opacity))}else t.visible=!0})))}withStoreyObjects(t,e){const s=this.viewer,i=s.scene,r=s.metaScene,o=r.metaObjects[t];if(!o)return;const n=o.getObjectIDsInSubtree();for(var a=0,h=n.length;a<h;a++){const t=n[a],s=r.metaObjects[t],o=i.objects[t];o&&e(o,s)}}createStoreyMap(t,e={}){const s=this.storeys[t];if(!s)return this.error("IfcBuildingStorey not found with this ID: "+t),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==";const i=this.viewer,r=i.scene,o=e.format||"png",n=s.aabb,a=(n[5]-n[2])/(n[3]-n[0]),h=e.padding||0;let l,u;e.width&&e.height?(l=e.width,u=e.height):e.height?(u=e.height,l=u/a):e.width?(l=e.width,u=l*a):(l=300,u=l*a),this._objectsMemento.saveObjects(r),this._cameraMemento.saveCamera(r),i.beginSnapshot(),this.showStoreyObjects(t,_.apply(e,{useObjectStates:!0,hideOthers:!0})),this._arrangeStoreyMapCamera(s);const p=i.getSnapshot({width:l,height:u,format:o});return this._objectsMemento.restoreObjects(r),this._cameraMemento.restoreCamera(r),i.endSnapshot(),new lh(t,p,o,l,u,h)}_arrangeStoreyMapCamera(t){const e=this.viewer,s=e.scene.camera,i=t.aabb,r=c.getAABB3Center(i),o=uh;o[0]=r[0]+.5*s.worldUp[0],o[1]=r[1]+.5*s.worldUp[1],o[2]=r[2]+.5*s.worldUp[2];const n=s.worldForward;e.cameraFlight.jumpTo({eye:o,look:r,up:n});const a=(i[3]-i[0])/2,h=(i[4]-i[1])/2,l=(i[5]-i[2])/2,u=-a,p=+a,d=-h,m=+h,f=-l,g=+l;e.camera.customProjection.matrix=c.orthoMat4c(u,p,f,g,d,m,ph),e.camera.projection="customProjection"}pickStoreyMap(t,e,s={}){const i=t.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),null;const o=1-e[0]/t.width,n=1-e[1]/t.height,a=r.aabb,h=a[0],l=a[1],u=a[2],p=a[3]-h,d=a[4]-l,m=a[5]-u,f=c.vec3([h+p*o,l+.5*d,u+m*n]),g=c.vec3([0,-1,0]),_=c.addVec3(f,g,uh),y=this.viewer.camera.worldForward,v=c.lookAtMat4v(f,_,y,ph),b=this.viewer.scene.pick({pickSurface:s.pickSurface,pickInvisible:!0,matrix:v});if(b){const t=this.viewer.metaScene.metaObjects[b.entity.id],e=this.objectStates[t.type];if(!e||!e.visible)return null}return b}getStoreyContainingWorldPos(t){for(var e in this.storeys){const s=this.storeys[e];if(c.point3AABB3Intersect(s.aabb,t))return e}return null}worldPosToStoreyMap(t,e,s){const i=t.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),!1;const o=r.aabb,n=o[0],a=o[1],h=o[2],l=o[3]-n,u=o[4]-a,p=o[5]-h,c=this.viewer.camera.worldUp,d=c[0]>c[1]&&c[0]>c[2],m=!d&&c[1]>c[0]&&c[1]>c[2];!d&&!m&&c[2]>c[0]&&(c[2],c[1]);const f=t.width/l,g=m?t.height/p:t.height/u;return s[0]=Math.floor(t.width-(e[0]-n)*f),s[1]=Math.floor(t.height-(e[2]-h)*g),s[0]>=0&&s[0]<t.width&&s[1]>=0&&s[1]<=t.height}worldDirToStoreyMap(t,e,s){const i=this.viewer.camera,r=i.eye,o=i.look,n=c.subVec3(o,r,uh),a=i.worldUp,h=a[0]>a[1]&&a[0]>a[2],l=!h&&a[1]>a[0]&&a[1]>a[2];!h&&!l&&a[2]>a[0]&&(a[2],a[1]),h?(s[0]=n[1],s[1]=n[2]):l?(s[0]=n[0],s[1]=n[2]):(s[0]=n[0],s[1]=n[1]),c.normalizeVec2(s)}destroy(){this.viewer.scene.off(this._onModelLoaded),super.destroy()}}function dh(t,e){const s=t.rootMetaObject;return s?mh(s,e):(e.push("Can't build storeys hierarchy: model is empty"),!1)}function mh(t,e,s=0,i,r){i=i||{foundIFCBuildingStoreys:!1};const o=t.type,n=t.children;if("IfcBuilding"===o)r=!0;else if("IfcBuildingStorey"===o){if(!r)return e.push("Can't build storeys hierarchy: IfcBuildingStorey found without parent IfcBuilding"),!1;i.foundIFCBuildingStoreys=!0}if(n)for(let t=0,o=n.length;t<o;t++){if(!mh(n[t],e,s+1,i,r))return!1}return 0===s&&i.foundIFCBuildingStoreys,!0}const fh=new t;class gh{constructor(t,e,s,i,r){if(!r.containerElement)throw"Config expected: containerElement";const o=i.rootMetaObject;o&&(this.errors=[],this.valid=!0,this.metaModel=i,this._id=fh.addItem(),this._baseId=""+this._id,this._viewer=t,this._treeViewPlugin=e,this._rootMetaObject=o,this._containerElement=r.containerElement,this._rootElement=null,this._muteSceneEvents=!1,this._muteTreeEvents=!1,this._rootNodes=[],this._objectNodes={},this._rootName=r.rootName,this._sortNodes=r.sortNodes,this._pruneEmptyNodes=r.pruneEmptyNodes,this._showListItemElementId=null,this._containerElement.oncontextmenu=t=>{t.preventDefault()},this._onObjectVisibility=this._viewer.scene.on("objectVisibility",(t=>{if(this._muteSceneEvents)return;const e=t.id,s=this._objectNodes[e];if(!s)return;const i=t.visible;if(!(i!==s.checked))return;this._muteTreeEvents=!0,s.checked=i,i?s.numVisibleEntities++:s.numVisibleEntities--;const r=document.getElementById(s.nodeId);r&&(r.checked=i);let o=s.parent;for(;o;){o.checked=i,i?o.numVisibleEntities++:o.numVisibleEntities--;const t=document.getElementById(o.nodeId);if(t){const e=o.numVisibleEntities>0;e!==t.checked&&(t.checked=e)}o=o.parent}this._muteTreeEvents=!1})),this.switchExpandHandler=t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this._expandSwitchElement(e)},this.switchCollapseHandler=t=>{t.preventDefault(),t.stopPropagation();const e=t.target;this._collapseSwitchElement(e)},this._checkboxChangeHandler=t=>{if(this._muteTreeEvents)return;this._muteSceneEvents=!0;const e=t.target,s=e.checked,i=e.id,r=this._nodeToObjectID(i),o=this._objectNodes[r],n=this._viewer.scene.objects;let a=0;this._withNodeTree(o,(t=>{const e=t.objectId,i=t.nodeId,r=n[e],o=0===t.children.length;t.numVisibleEntities=s?t.numEntities:0,o&&s!==t.checked&&a++,t.checked=s;const h=document.getElementById(i);h&&(h.checked=s),r&&(r.visible=s)}));let h=o.parent;for(;h;){h.checked=s;const t=document.getElementById(h.nodeId);s?h.numVisibleEntities+=a:h.numVisibleEntities-=a;const e=h.numVisibleEntities>0;e!==t.checked&&(t.checked=e),h=h.parent}this._muteSceneEvents=!1},this._hierarchy=r.hierarchy||"containment",this._autoExpandDepth=r.autoExpandDepth||0,this._createNodes())}_nodeToObjectID(t){return t.substring(this._baseId.length)}_objectToNodeID(t){return this._baseId+t}setAutoExpandDepth(t=0){this._autoExpandDepth=t}setHierarchy(t){this._hierarchy!==t&&(this._hierarchy=t,this._createNodes())}_createNodes(){this._rootElement&&(this._rootElement.parentNode.removeChild(this._rootElement),this._rootElement=null),this._rootNodes=[],this._objectNodes={},this._validate(),this.valid||"storeys"!==this._hierarchy?this._createEnabledNodes():this._createDisabledNodes()}_validate(){switch(this.errors=[],this._hierarchy){case"storeys":this.valid=dh(this.metaModel,this.errors);break;case"types":this.valid=(t=this.metaModel,e=this.errors,!!t.rootMetaObject||(e.push("Can't build types hierarchy: model is empty"),!1));break;default:this.valid=function(t,e){return!!t.rootMetaObject||(e.push("Can't build containment hierarchy: model is empty"),!1)}(this.metaModel,this.errors)}var t,e;return this.valid}_createEnabledNodes(){switch(this._pruneEmptyNodes&&this._findEmptyNodes(),this._hierarchy){case"storeys":this._createStoreysNodes(),0===this._rootNodes.length&&this._treeViewPlugin.error("Failed to build storeys hierarchy for model '"+this.metaModel.id+"' - perhaps this model is not an IFC model?");break;case"types":this._createTypesNodes();break;default:this._createContainmentNodes()}this._sortNodes&&this._doSortNodes(),this._synchNodesToEntities(),this._createTrees(),this.expandToDepth(this._autoExpandDepth)}_createDisabledNodes(){const t=this._rootMetaObject,e=t.type,s=t.name,i=s&&""!==s&&"Undefined"!==s&&"Default"!==s?s:e,r=document.createElement("ul"),o=document.createElement("li");r.appendChild(o),this._containerElement.appendChild(r),this._rootElement=r;const n=document.createElement("a");n.href="#",n.textContent="!",n.classList.add("warn"),n.classList.add("warning"),o.appendChild(n);const a=document.createElement("span");a.textContent=i,o.appendChild(a)}_findEmptyNodes(t=this._rootMetaObject,e=0){const s=this._treeViewPlugin.viewer.scene,i=t.children,r=t.id,o=s.objects[r];if(t._countEntities=0,o&&t._countEntities++,i)for(let e=0,s=i.length;e<s;e++){const s=i[e];s._countEntities=this._findEmptyNodes(s),t._countEntities+=s._countEntities}return t._countEntities}_createStoreysNodes(t=this._rootMetaObject,e,s,i){if(this._pruneEmptyNodes&&0===t._countEntities)return;const r=t.type,o=t.name,n=t.children,a=t.id;if("IfcBuilding"===r)e={nodeId:this._objectToNodeID(a),objectId:a,title:this._rootName||(o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r),type:r,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},this._rootNodes.push(e),this._objectNodes[e.objectId]=e;else if("IfcBuildingStorey"===r){if(!e)return void this._treeViewPlugin.error("Failed to build storeys hierarchy for model '"+this.metaModel.id+"' - model does not have an IfcBuilding object, or is not an IFC model");s={nodeId:this._objectToNodeID(a),objectId:a,title:o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,type:r,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},e.children.push(s),this._objectNodes[s.objectId]=s,i={}}else if(s){if(this._viewer.scene.objects[a]){let t=(i=i||{})[r];if(!t){const e=s.objectId+"."+r;t={nodeId:this._objectToNodeID(e),objectId:e,title:r,type:r,parent:s,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},s.children.push(t),this._objectNodes[e]=t,i[r]=t}const e={nodeId:this._objectToNodeID(a),objectId:a,title:o&&""!==o&&"Undefined"!==o&&"Default"!==o?o:r,type:r,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,children:[]};t.children.push(e),this._objectNodes[e.objectId]=e}}if(n)for(let t=0,r=n.length;t<r;t++){const r=n[t];this._createStoreysNodes(r,e,s,i)}}_createTypesNodes(t=this._rootMetaObject,e,s){if(this._pruneEmptyNodes&&0===t._countEntities)return;const i=t.type,r=t.name,o=t.children,n=t.id;if(t.id===this._rootMetaObject.id)e={nodeId:this._objectToNodeID(n),objectId:n,title:this._rootName||(r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:i),type:i,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},this._rootNodes.push(e),this._objectNodes[e.objectId]=e,s={};else if(e){if(this._viewer.scene.objects[n]){let t=s[i];t||(t={nodeId:this._objectToNodeID(e.objectId+"."+i),objectId:e.objectId+"."+i,title:i,type:i,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,children:[]},e.children.push(t),this._objectNodes[t.objectId]=t,s[i]=t);const o={nodeId:this._objectToNodeID(n),objectId:n,title:r&&""!==r&&"Default"!==r?r:i,type:i,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,children:[]};t.children.push(o),this._objectNodes[o.objectId]=o}}if(o)for(let t=0,i=o.length;t<i;t++){const i=o[t];this._createTypesNodes(i,e,s)}}_createContainmentNodes(t=this._rootMetaObject,e){if(this._pruneEmptyNodes&&0===t._countEntities)return;const s=t.type,i=t.name||s,r=t.children,o=t.id,n={nodeId:this._objectToNodeID(o),objectId:o,title:e?i&&""!==i&&"Undefined"!==i&&"Default"!==i?i:s:this._rootName||i,type:s,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,children:[]};if(e?e.children.push(n):this._rootNodes.push(n),this._objectNodes[n.objectId]=n,r)for(let t=0,e=r.length;t<e;t++){const e=r[t];this._createContainmentNodes(e,n)}}_doSortNodes(){for(let t=0,e=this._rootNodes.length;t<e;t++){const e=this._rootNodes[t];this._sortChildren(e)}}_sortChildren(t){const e=t.children;if(e&&0!==e.length){"storeys"===this._hierarchy&&"IfcBuilding"===t.type?e.sort(this._getSpatialSortFunc()):e.sort(this._alphaSortFunc);for(let t=0,s=e.length;t<s;t++){const s=e[t];this._sortChildren(s)}}}_getSpatialSortFunc(){const t=this._treeViewPlugin.viewer,e=t.scene,s=e.camera,i=t.metaScene;return this._spatialSortFunc||(this._spatialSortFunc=(t,r)=>{t.aabb&&r.aabb||(t.aabb||(t.aabb=e.getAABB(i.getObjectIDsInSubtree(t.objectId))),r.aabb||(r.aabb=e.getAABB(i.getObjectIDsInSubtree(r.objectId))));let o=0;return o=s.xUp?0:s.yUp?1:2,t.aabb[o]>r.aabb[o]?-1:t.aabb[o]<r.aabb[o]?1:0})}_alphaSortFunc(t,e){const s=t.title.toUpperCase(),i=e.title.toUpperCase();return s<i?-1:s>i?1:0}_synchNodesToEntities(){const t=this._rootMetaObject.getObjectIDsInSubtree(),e=this._viewer.metaScene.metaObjects,s=this._viewer.scene.objects;for(let i=0,r=t.length;i<r;i++){const r=t[i];if(e[r]){const t=this._objectNodes[r];if(t){const e=s[r];if(e){const s=e.visible;t.numEntities=1,s?(t.numVisibleEntities=1,t.checked=!0):(t.numVisibleEntities=0,t.checked=!1);let i=t.parent;for(;i;)i.numEntities++,s&&(i.numVisibleEntities++,i.checked=!0),i=i.parent}}}}}_withNodeTree(t,e){e(t);const s=t.children;if(s)for(let t=0,i=s.length;t<i;t++)this._withNodeTree(s[t],e)}_createTrees(){if(0===this._rootNodes.length)return;const t=this._rootNodes.map((t=>this._createNodeElement(t))),e=document.createElement("ul");t.forEach((t=>{e.appendChild(t)})),this._containerElement.appendChild(e),this._rootElement=e}_createNodeElement(t){const e=document.createElement("li"),s=t.nodeId;if(e.id="node-"+s,t.children.length>0){const t="switch-"+s,i=document.createElement("a");i.href="#",i.id=t,i.textContent="+",i.classList.add("plus"),i.addEventListener("click",this.switchExpandHandler),e.appendChild(i)}const i=document.createElement("input");i.id=s,i.type="checkbox",i.checked=t.checked,i.style["pointer-events"]="all",i.addEventListener("change",this._checkboxChangeHandler),e.appendChild(i);const r=document.createElement("span");return r.textContent=t.title,e.appendChild(r),r.oncontextmenu=e=>{this._treeViewPlugin.fire("contextmenu",{event:e,viewer:this._viewer,treeViewPlugin:this._treeViewPlugin,treeViewNode:t}),e.preventDefault()},r.onclick=e=>{this._treeViewPlugin.fire("nodeTitleClicked",{event:e,viewer:this._viewer,treeViewPlugin:this._treeViewPlugin,treeViewNode:t}),e.preventDefault()},e}expandToDepth(t){const e=(s,i)=>{if(i===t)return;const r="switch-"+s.nodeId,o=document.getElementById(r);if(o){this._expandSwitchElement(o);const t=s.children;for(var n=0,a=t.length;n<a;n++){const s=t[n];e(s,i+1)}}};for(let t=0,s=this._rootNodes.length;t<s;t++){const s=this._rootNodes[t];e(s,0)}}collapse(){for(let t=0,e=this._rootNodes.length;t<e;t++){const e=this._rootNodes[t].objectId;this._collapseNode(e)}}showNode(t){this._showListItemElementId&&this.unShowNode();const e=this._objectNodes[t];if(!e)return;const s=e.nodeId,i="switch-"+s,r=document.getElementById(i);if(r)return this._expandSwitchElement(r),void r.scrollIntoView();const o=[];o.unshift(e);let n=e.parent;for(;n;)o.unshift(n),n=n.parent;for(let t=0,e=o.length;t<e;t++){const e="switch-"+o[t].nodeId,s=document.getElementById(e);s&&this._expandSwitchElement(s)}const a="node-"+s,h=document.getElementById(a);h.scrollIntoView({block:"center"}),h.classList.add("highlighted-node"),this._showListItemElementId=a}unShowNode(){if(!this._showListItemElementId)return;const t=document.getElementById(this._showListItemElementId);t?(t.classList.remove("highlighted-node"),this._showListItemElementId=null):this._showListItemElementId=null}_expandSwitchElement(t){const e=t.parentElement;if(e.getElementsByTagName("li")[0])return;const s=e.id.replace("node-",""),i=this._nodeToObjectID(s),r=this._objectNodes[i].children.map((t=>this._createNodeElement(t))),o=document.createElement("ul");r.forEach((t=>{o.appendChild(t)})),e.appendChild(o),t.classList.remove("plus"),t.classList.add("minus"),t.textContent="-",t.removeEventListener("click",this.switchExpandHandler),t.addEventListener("click",this.switchCollapseHandler)}_collapseNode(t){const e="switch-"+this._objectToNodeID(t),s=document.getElementById(e);this._collapseSwitchElement(s)}_collapseSwitchElement(t){if(!t)return;const e=t.parentElement;if(!e)return;const s=e.querySelector("ul");s&&(e.removeChild(s),t.classList.remove("minus"),t.classList.add("plus"),t.textContent="+",t.removeEventListener("click",this.switchCollapseHandler),t.addEventListener("click",this.switchExpandHandler))}destroy(){this._rootElement&&!this._destroyed&&(this._rootElement.parentNode.removeChild(this._rootElement),this._viewer.scene.off(this._onObjectVisibility),this._destroyed=!0,fh.removeItem(this._id))}}class _h extends n{constructor(t,e={}){if(super("TreeViewPlugin",t),e.containerElement){if(this._containerElement=e.containerElement,this._modelTreeViews={},this._autoAddModels=!1!==e.autoAddModels,this._autoExpandDepth=e.autoExpandDepth||0,this._sortNodes=!1!==e.sortNodes,this._pruneEmptyNodes=!1!==e.pruneEmptyNodes,this._autoAddModels){const t=Object.keys(this.viewer.metaScene.metaModels);for(let e=0,s=t.length;e<s;e++){const s=t[e];this.addModel(s)}this.viewer.scene.on("modelLoaded",(t=>{this.viewer.metaScene.metaModels[t]&&this.addModel(t)}))}this.hierarchy=e.hierarchy}else this.error("Config expected: containerElement")}get modelTreeViews(){return this._modelTreeViews}set hierarchy(t){"containment"!==(t=t||"containment")&&"storeys"!==t&&"types"!==t&&(this.error("Unsupported value for `hierarchy' - defaulting to 'containment'"),t="containment"),this._hierarchy=t;for(let t in this._modelTreeViews)this._modelTreeViews.hasOwnProperty(t)&&this._modelTreeViews[t].setHierarchy(this._hierarchy)}get hierarchy(){return this._hierarchy}addModel(t,e={}){if(!this._containerElement)return;const s=this.viewer.scene.models[t];if(!s)throw"Model not found: "+t;const i=this.viewer.metaScene.metaModels[t];if(!i)return void this.error("MetaModel not found: "+t);if(this._modelTreeViews[t])return void this.warn("Model already added: "+t);const r=new gh(this.viewer,this,s,i,{containerElement:this._containerElement,autoExpandDepth:this._autoExpandDepth,hierarchy:this._hierarchy,sortNodes:this._sortNodes,pruneEmptyNodes:this._pruneEmptyNodes,rootName:e.rootName});return this._modelTreeViews[t]=r,s.on("destroyed",(()=>{this.removeModel(s.id)})),r}removeModel(t){if(!this._containerElement)return;const e=this._modelTreeViews[t];e&&(e.destroy(),delete this._modelTreeViews[t])}collapse(){for(let t in this._modelTreeViews)if(this._modelTreeViews.hasOwnProperty(t)){this._modelTreeViews[t].collapse()}}showNode(t){this.unShowNode();const e=this.viewer.metaScene.metaObjects[t];if(!e)return void this.error("MetaObject not found: "+t);const s=e.metaModel.id,i=this._modelTreeViews[s];i?i.showNode(t):this.error("Object not in this TreeView: "+t)}unShowNode(){for(let t in this._modelTreeViews)if(this._modelTreeViews.hasOwnProperty(t)){this._modelTreeViews[t].unShowNode()}}expandToDepth(t){for(let e in this._modelTreeViews)if(this._modelTreeViews.hasOwnProperty(e)){const s=this._modelTreeViews[e];s.collapse(),s.expandToDepth(t)}}withNodeTree(t,e){e(t);const s=t.children;if(s)for(let t=0,i=s.length;t<i;t++)this.withNodeTree(s[t],e)}destroy(){if(this._containerElement){for(let t in this._modelTreeViews)this._modelTreeViews.hasOwnProperty(t)&&this._modelTreeViews[t].destroy();this._modelTreeViews={},super.destroy()}}}const yh=c.vec3(),vh=c.vec3(),bh=c.mat4();class Ph{constructor(){this.normal=c.vec3(),this.offset=0,this.testVertex=c.vec3()}set(t,e,s,i){const r=1/Math.sqrt(t*t+e*e+s*s);this.normal[0]=t*r,this.normal[1]=e*r,this.normal[2]=s*r,this.offset=i*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0}}class Th{constructor(){this.planes=[new Ph,new Ph,new Ph,new Ph,new Ph,new Ph]}}Th.INSIDE=0,Th.INTERSECT=1,Th.OUTSIDE=2;class wh{constructor(t){this._scene=t,this._objects=[],this._objectsViewCulled=[],this._objectsDetailCulled=[],this._objectsChanged=[],this._objectsChangedList=[],this._modelInfos={},this._numObjects=0,this._lenObjectsChangedList=0,this._dirty=!0,this._onModelLoaded=t.on("modelLoaded",(e=>{const s=t.models[e];s&&this._addModel(s)})),this._onTick=t.on("tick",(()=>{this._dirty&&this._build(),this._applyChanges()}))}_addModel(t){const e={model:t,onDestroyed:t.on("destroyed",(()=>{this._removeModel(t)}))};this._modelInfos[t.id]=e,this._dirty=!0}_removeModel(t){const e=this._modelInfos[t.id];e&&(e.model.off(e.onDestroyed),delete this._modelInfos[t.id],this._dirty=!0)}_build(){if(!this._dirty)return;this._applyChanges();const t=this._scene.objects;for(let t=0;t<this._numObjects;t++)this._objects[t]=null;this._numObjects=0;for(let e in t){const s=t[e];this._objects[this._numObjects++]=s}this._lenObjectsChangedList=0,this._dirty=!1}_applyChanges(){if(this._lenObjectsChangedList>0){for(let t=0;t<this._lenObjectsChangedList;t++){const e=this._objectsChangedList[t],s=this._objects[e],i=this._objectsViewCulled[e],r=this._objectsDetailCulled[e],o=i||r;s.culled=o,this._objectsChanged[e]=!1}this._lenObjectsChangedList=0}}get objects(){return this._dirty&&this._build(),this._objects}get numObjects(){return this._dirty&&this._build(),this._numObjects}setObjectViewCulled(t,e){this._dirty&&this._build(),this._objectsViewCulled[t]!==e&&(this._objectsViewCulled[t]=e,this._objectsChanged[t]||(this._objectsChanged[t]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=t))}setObjectDetailCulled(t,e){this._dirty&&this._build(),this._objectsDetailCulled[t]!==e&&(this._objectsDetailCulled[t]=e,this._objectsChanged[t]||(this._objectsChanged[t]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=t))}_destroy(){this._clear(),this._scene.off(this._onModelLoaded),this._scene.off(this._onTick)}_clear(){for(let t in this._modelInfos){const e=this._modelInfos[t];e.model.off(e.onDestroyed)}this._modelInfos={},this._dirty=!0}}const xh={};const Mh=new Float32Array(3);class Dh extends n{constructor(t,e={}){super("ViewCull",t),this._objectCullStates=function(t){const e=t.id;let s=xh[e];return s||(s=new wh(t),xh[e]=s,t.on("destroyed",(()=>{delete xh[e],s._destroy()}))),s}(t.scene),this._maxTreeDepth=e.maxTreeDepth||8,this._modelInfos={},this._frustum=new Th,this._kdRoot=null,this._frustumDirty=!1,this._kdTreeDirty=!1,this._onViewMatrix=t.scene.camera.on("viewMatrix",(()=>{this._frustumDirty=!0})),this._onProjMatrix=t.scene.camera.on("projMatMatrix",(()=>{this._frustumDirty=!0})),this._onModelLoaded=t.scene.on("modelLoaded",(t=>{const e=this.viewer.scene.models[t];e&&this._addModel(e)})),this._onSceneTick=t.scene.on("tick",(()=>{this._doCull()}))}set enabled(t){this._enabled=t}get enabled(){return this._enabled}_addModel(t){const e={model:t,onDestroyed:t.on("destroyed",(()=>{this._removeModel(t)}))};this._modelInfos[t.id]=e,this._kdTreeDirty=!0}_removeModel(t){const e=this._modelInfos[t.id];e&&(e.model.off(e.onDestroyed),delete this._modelInfos[t.id],this._kdTreeDirty=!0)}_doCull(){const t=this._frustumDirty||this._kdTreeDirty;if(this._frustumDirty&&this._buildFrustum(),this._kdTreeDirty&&this._buildKDTree(),t){const t=this._kdRoot;t&&this._visitKDNode(t)}}_buildFrustum(){const t=this.viewer.scene.camera;!function(t,e,s){const i=c.mulMat4(s,e,bh),r=i[0],o=i[1],n=i[2],a=i[3],h=i[4],l=i[5],u=i[6],p=i[7],d=i[8],m=i[9],f=i[10],g=i[11],_=i[12],y=i[13],v=i[14],b=i[15];t.planes[0].set(a-r,p-h,g-d,b-_),t.planes[1].set(a+r,p+h,g+d,b+_),t.planes[2].set(a-o,p-l,g-m,b-y),t.planes[3].set(a+o,p+l,g+m,b+y),t.planes[4].set(a-n,p-u,g-f,b-v),t.planes[5].set(a+n,p+u,g+f,b+v)}(this._frustum,t.viewMatrix,t.projMatrix),this._frustumDirty=!1}_buildKDTree(){const t=this.viewer.scene;this._kdRoot,this._kdRoot={aabb:t.getAABB(),intersection:Th.INTERSECT};for(let t=0,e=this._objectCullStates.numObjects;t<e;t++){const e=this._objectCullStates.objects[t];this._insertEntityIntoKDTree(this._kdRoot,e,t,1)}this._kdTreeDirty=!1}_insertEntityIntoKDTree(t,e,s,i){const r=e.aabb;if(i>=this._maxTreeDepth)return t.objects=t.objects||[],t.objects.push(s),void c.expandAABB3(t.aabb,r);if(t.left&&c.containsAABB3(t.left.aabb,r))return void this._insertEntityIntoKDTree(t.left,e,s,i+1);if(t.right&&c.containsAABB3(t.right.aabb,r))return void this._insertEntityIntoKDTree(t.right,e,s,i+1);const o=t.aabb;Mh[0]=o[3]-o[0],Mh[1]=o[4]-o[1],Mh[2]=o[5]-o[2];let n=0;if(Mh[1]>Mh[n]&&(n=1),Mh[2]>Mh[n]&&(n=2),!t.left){const a=o.slice();if(a[n+3]=(o[n]+o[n+3])/2,t.left={aabb:a,intersection:Th.INTERSECT},c.containsAABB3(a,r))return void this._insertEntityIntoKDTree(t.left,e,s,i+1)}if(!t.right){const a=o.slice();if(a[n]=(o[n]+o[n+3])/2,t.right={aabb:a,intersection:Th.INTERSECT},c.containsAABB3(a,r))return void this._insertEntityIntoKDTree(t.right,e,s,i+1)}t.objects=t.objects||[],t.objects.push(s),c.expandAABB3(t.aabb,r)}_visitKDNode(t,e=Th.INTERSECT){if(e!==Th.INTERSECT&&t.intersects===e)return;e===Th.INTERSECT&&(e=function(t,e){let s=Th.INSIDE;const i=yh,r=vh;i[0]=e[0],i[1]=e[1],i[2]=e[2],r[0]=e[3],r[1]=e[4],r[2]=e[5];const o=[i,r];for(let e=0;e<6;++e){const i=t.planes[e];if(i.normal[0]*o[i.testVertex[0]][0]+i.normal[1]*o[i.testVertex[1]][1]+i.normal[2]*o[i.testVertex[2]][2]+i.offset<0)return Th.OUTSIDE;i.normal[0]*o[1-i.testVertex[0]][0]+i.normal[1]*o[1-i.testVertex[1]][1]+i.normal[2]*o[1-i.testVertex[2]][2]+i.offset<0&&(s=Th.INTERSECT)}return s}(this._frustum,t.aabb),t.intersects=e);const s=e===Th.OUTSIDE,i=t.objects;if(i&&i.length>0)for(let t=0,e=i.length;t<e;t++){const e=i[t];this._objectCullStates.setObjectViewCulled(e,s)}t.left&&this._visitKDNode(t.left,e),t.right&&this._visitKDNode(t.right,e)}send(t,e){}destroy(){super.destroy(),this._clear();const t=this.viewer.scene,e=t.camera;t.off(this._onModelLoaded),t.off(this._onSceneTick),e.off(this._onViewMatrix),e.off(this._onProjMatrix)}_clear(){for(let t in this._modelInfos){const e=this._modelInfos[t];e.model.off(e.onDestroyed)}this._modelInfos={},this._kdRoot=null,this._kdTreeDirty=!0}}class Eh{constructor(){}getMetaModel(t,e,s){_.loadJSON(t,(t=>{e(t)}),(function(t){s(t)}))}getXKT(t,e,s){var i=()=>{};e=e||i,s=s||i;const r=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const t=!!r[2];var o=r[3];o=window.decodeURIComponent(o),t&&(o=window.atob(o));try{const t=new ArrayBuffer(o.length),s=new Uint8Array(t);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);e(t)}catch(t){s(t)}}else{const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e(i.response):s("getXKT error : "+i.response))},i.send(null)}}}!function(t){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pako=t()}}((function(){return function t(e,s,i){function r(n,a){if(!s[n]){if(!e[n]){var h="function"==typeof require&&require;if(!a&&h)return h(n,!0);if(o)return o(n,!0);var l=new Error("Cannot find module '"+n+"'");throw l.code="MODULE_NOT_FOUND",l}var u=s[n]={exports:{}};e[n][0].call(u.exports,(function(t){return r(e[n][1][t]||t)}),u,u.exports,t,e,s,i)}return s[n].exports}for(var o="function"==typeof require&&require,n=0;n<i.length;n++)r(i[n]);return r}({1:[function(t,e,s){var i=t("./zlib/deflate"),r=t("./utils/common"),o=t("./utils/strings"),n=t("./zlib/messages"),a=t("./zlib/zstream"),h=Object.prototype.toString;function l(t){if(!(this instanceof l))return new l(t);this.options=r.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new a,this.strm.avail_out=0;var s=i.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(0!==s)throw new Error(n[s]);if(e.header&&i.deflateSetHeader(this.strm,e.header),e.dictionary){var u;if(u="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===h.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,0!==(s=i.deflateSetDictionary(this.strm,u)))throw new Error(n[s]);this._dict_set=!0}}function u(t,e){var s=new l(e);if(s.push(t,!0),s.err)throw s.msg||n[s.err];return s.result}l.prototype.push=function(t,e){var s,n,a=this.strm,l=this.options.chunkSize;if(this.ended)return!1;n=e===~~e?e:!0===e?4:0,"string"==typeof t?a.input=o.string2buf(t):"[object ArrayBuffer]"===h.call(t)?a.input=new Uint8Array(t):a.input=t,a.next_in=0,a.avail_in=a.input.length;do{if(0===a.avail_out&&(a.output=new r.Buf8(l),a.next_out=0,a.avail_out=l),1!==(s=i.deflate(a,n))&&0!==s)return this.onEnd(s),this.ended=!0,!1;0!==a.avail_out&&(0!==a.avail_in||4!==n&&2!==n)||("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(a.output,a.next_out))):this.onData(r.shrinkBuf(a.output,a.next_out)))}while((a.avail_in>0||0===a.avail_out)&&1!==s);return 4===n?(s=i.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,0===s):2!==n||(this.onEnd(0),a.avail_out=0,!0)},l.prototype.onData=function(t){this.chunks.push(t)},l.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},s.Deflate=l,s.deflate=u,s.deflateRaw=function(t,e){return(e=e||{}).raw=!0,u(t,e)},s.gzip=function(t,e){return(e=e||{}).gzip=!0,u(t,e)}},{"./utils/common":3,"./utils/strings":4,"./zlib/deflate":8,"./zlib/messages":13,"./zlib/zstream":15}],2:[function(t,e,s){var i=t("./zlib/inflate"),r=t("./utils/common"),o=t("./utils/strings"),n=t("./zlib/constants"),a=t("./zlib/messages"),h=t("./zlib/zstream"),l=t("./zlib/gzheader"),u=Object.prototype.toString;function p(t){if(!(this instanceof p))return new p(t);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new h,this.strm.avail_out=0;var s=i.inflateInit2(this.strm,e.windowBits);if(s!==n.Z_OK)throw new Error(a[s]);if(this.header=new l,i.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===u.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(s=i.inflateSetDictionary(this.strm,e.dictionary))!==n.Z_OK))throw new Error(a[s])}function c(t,e){var s=new p(e);if(s.push(t,!0),s.err)throw s.msg||a[s.err];return s.result}p.prototype.push=function(t,e){var s,a,h,l,p,c=this.strm,d=this.options.chunkSize,m=this.options.dictionary,f=!1;if(this.ended)return!1;a=e===~~e?e:!0===e?n.Z_FINISH:n.Z_NO_FLUSH,"string"==typeof t?c.input=o.binstring2buf(t):"[object ArrayBuffer]"===u.call(t)?c.input=new Uint8Array(t):c.input=t,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new r.Buf8(d),c.next_out=0,c.avail_out=d),(s=i.inflate(c,n.Z_NO_FLUSH))===n.Z_NEED_DICT&&m&&(s=i.inflateSetDictionary(this.strm,m)),s===n.Z_BUF_ERROR&&!0===f&&(s=n.Z_OK,f=!1),s!==n.Z_STREAM_END&&s!==n.Z_OK)return this.onEnd(s),this.ended=!0,!1;c.next_out&&(0!==c.avail_out&&s!==n.Z_STREAM_END&&(0!==c.avail_in||a!==n.Z_FINISH&&a!==n.Z_SYNC_FLUSH)||("string"===this.options.to?(h=o.utf8border(c.output,c.next_out),l=c.next_out-h,p=o.buf2string(c.output,h),c.next_out=l,c.avail_out=d-l,l&&r.arraySet(c.output,c.output,h,l,0),this.onData(p)):this.onData(r.shrinkBuf(c.output,c.next_out)))),0===c.avail_in&&0===c.avail_out&&(f=!0)}while((c.avail_in>0||0===c.avail_out)&&s!==n.Z_STREAM_END);return s===n.Z_STREAM_END&&(a=n.Z_FINISH),a===n.Z_FINISH?(s=i.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===n.Z_OK):a!==n.Z_SYNC_FLUSH||(this.onEnd(n.Z_OK),c.avail_out=0,!0)},p.prototype.onData=function(t){this.chunks.push(t)},p.prototype.onEnd=function(t){t===n.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},s.Inflate=p,s.inflate=c,s.inflateRaw=function(t,e){return(e=e||{}).raw=!0,c(t,e)},s.ungzip=c},{"./utils/common":3,"./utils/strings":4,"./zlib/constants":6,"./zlib/gzheader":9,"./zlib/inflate":11,"./zlib/messages":13,"./zlib/zstream":15}],3:[function(t,e,s){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}s.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var s=e.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(var i in s)r(s,i)&&(t[i]=s[i])}}return t},s.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var o={arraySet:function(t,e,s,i,r){if(e.subarray&&t.subarray)t.set(e.subarray(s,s+i),r);else for(var o=0;o<i;o++)t[r+o]=e[s+o]},flattenChunks:function(t){var e,s,i,r,o,n;for(i=0,e=0,s=t.length;e<s;e++)i+=t[e].length;for(n=new Uint8Array(i),r=0,e=0,s=t.length;e<s;e++)o=t[e],n.set(o,r),r+=o.length;return n}},n={arraySet:function(t,e,s,i,r){for(var o=0;o<i;o++)t[r+o]=e[s+o]},flattenChunks:function(t){return[].concat.apply([],t)}};s.setTyped=function(t){t?(s.Buf8=Uint8Array,s.Buf16=Uint16Array,s.Buf32=Int32Array,s.assign(s,o)):(s.Buf8=Array,s.Buf16=Array,s.Buf32=Array,s.assign(s,n))},s.setTyped(i)},{}],4:[function(t,e,s){var i=t("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var n=new i.Buf8(256),a=0;a<256;a++)n[a]=a>=252?6:a>=248?5:a>=240?4:a>=224?3:a>=192?2:1;function h(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(t,e));for(var s="",n=0;n<e;n++)s+=String.fromCharCode(t[n]);return s}n[254]=n[254]=1,s.string2buf=function(t){var e,s,r,o,n,a=t.length,h=0;for(o=0;o<a;o++)55296==(64512&(s=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=t.charCodeAt(o+1)))&&(s=65536+(s-55296<<10)+(r-56320),o++),h+=s<128?1:s<2048?2:s<65536?3:4;for(e=new i.Buf8(h),n=0,o=0;n<h;o++)55296==(64512&(s=t.charCodeAt(o)))&&o+1<a&&56320==(64512&(r=t.charCodeAt(o+1)))&&(s=65536+(s-55296<<10)+(r-56320),o++),s<128?e[n++]=s:s<2048?(e[n++]=192|s>>>6,e[n++]=128|63&s):s<65536?(e[n++]=224|s>>>12,e[n++]=128|s>>>6&63,e[n++]=128|63&s):(e[n++]=240|s>>>18,e[n++]=128|s>>>12&63,e[n++]=128|s>>>6&63,e[n++]=128|63&s);return e},s.buf2binstring=function(t){return h(t,t.length)},s.binstring2buf=function(t){for(var e=new i.Buf8(t.length),s=0,r=e.length;s<r;s++)e[s]=t.charCodeAt(s);return e},s.buf2string=function(t,e){var s,i,r,o,a=e||t.length,l=new Array(2*a);for(i=0,s=0;s<a;)if((r=t[s++])<128)l[i++]=r;else if((o=n[r])>4)l[i++]=65533,s+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&s<a;)r=r<<6|63&t[s++],o--;o>1?l[i++]=65533:r<65536?l[i++]=r:(r-=65536,l[i++]=55296|r>>10&1023,l[i++]=56320|1023&r)}return h(l,i)},s.utf8border=function(t,e){var s;for((e=e||t.length)>t.length&&(e=t.length),s=e-1;s>=0&&128==(192&t[s]);)s--;return s<0||0===s?e:s+n[t[s]]>e?s:e}},{"./common":3}],5:[function(t,e,s){e.exports=function(t,e,s,i){for(var r=65535&t|0,o=t>>>16&65535|0,n=0;0!==s;){s-=n=s>2e3?2e3:s;do{o=o+(r=r+e[i++]|0)|0}while(--n);r%=65521,o%=65521}return r|o<<16|0}},{}],6:[function(t,e,s){e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],7:[function(t,e,s){var i=function(){for(var t,e=[],s=0;s<256;s++){t=s;for(var i=0;i<8;i++)t=1&t?3988292384^t>>>1:t>>>1;e[s]=t}return e}();e.exports=function(t,e,s,r){var o=i,n=r+s;t^=-1;for(var a=r;a<n;a++)t=t>>>8^o[255&(t^e[a])];return-1^t}},{}],8:[function(t,e,s){var i,r=t("../utils/common"),o=t("./trees"),n=t("./adler32"),a=t("./crc32"),h=t("./messages"),l=-2,u=258,p=262,c=103,d=113,m=666;function f(t,e){return t.msg=h[e],e}function g(t){return(t<<1)-(t>4?9:0)}function _(t){for(var e=t.length;--e>=0;)t[e]=0}function y(t){var e=t.state,s=e.pending;s>t.avail_out&&(s=t.avail_out),0!==s&&(r.arraySet(t.output,e.pending_buf,e.pending_out,s,t.next_out),t.next_out+=s,e.pending_out+=s,t.total_out+=s,t.avail_out-=s,e.pending-=s,0===e.pending&&(e.pending_out=0))}function v(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,y(t.strm)}function b(t,e){t.pending_buf[t.pending++]=e}function P(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function T(t,e){var s,i,r=t.max_chain_length,o=t.strstart,n=t.prev_length,a=t.nice_match,h=t.strstart>t.w_size-p?t.strstart-(t.w_size-p):0,l=t.window,c=t.w_mask,d=t.prev,m=t.strstart+u,f=l[o+n-1],g=l[o+n];t.prev_length>=t.good_match&&(r>>=2),a>t.lookahead&&(a=t.lookahead);do{if(l[(s=e)+n]===g&&l[s+n-1]===f&&l[s]===l[o]&&l[++s]===l[o+1]){o+=2,s++;do{}while(l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&l[++o]===l[++s]&&o<m);if(i=u-(m-o),o=m-u,i>n){if(t.match_start=e,n=i,i>=a)break;f=l[o+n-1],g=l[o+n]}}}while((e=d[e&c])>h&&0!=--r);return n<=t.lookahead?n:t.lookahead}function w(t){var e,s,i,o,h,l,u,c,d,m,f=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=f+(f-p)){r.arraySet(t.window,t.window,f,f,0),t.match_start-=f,t.strstart-=f,t.block_start-=f,e=s=t.hash_size;do{i=t.head[--e],t.head[e]=i>=f?i-f:0}while(--s);e=s=f;do{i=t.prev[--e],t.prev[e]=i>=f?i-f:0}while(--s);o+=f}if(0===t.strm.avail_in)break;if(l=t.strm,u=t.window,c=t.strstart+t.lookahead,d=o,m=void 0,(m=l.avail_in)>d&&(m=d),s=0===m?0:(l.avail_in-=m,r.arraySet(u,l.input,l.next_in,m,c),1===l.state.wrap?l.adler=n(l.adler,u,m,c):2===l.state.wrap&&(l.adler=a(l.adler,u,m,c)),l.next_in+=m,l.total_in+=m,m),t.lookahead+=s,t.lookahead+t.insert>=3)for(h=t.strstart-t.insert,t.ins_h=t.window[h],t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[h+3-1])&t.hash_mask,t.prev[h&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=h,h++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<p&&0!==t.strm.avail_in)}function x(t,e){for(var s,i;;){if(t.lookahead<p){if(w(t),t.lookahead<p&&0===e)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==s&&t.strstart-s<=t.w_size-p&&(t.match_length=T(t,s)),t.match_length>=3)if(i=o._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else i=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(i&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function M(t,e){for(var s,i,r;;){if(t.lookahead<p){if(w(t),t.lookahead<p&&0===e)return 1;if(0===t.lookahead)break}if(s=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==s&&t.prev_length<t.max_lazy_match&&t.strstart-s<=t.w_size-p&&(t.match_length=T(t,s),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){r=t.strstart+t.lookahead-3,i=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=r&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,s=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,i&&(v(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((i=o._tr_tally(t,0,t.window[t.strstart-1]))&&v(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(i=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}function D(t,e,s,i,r){this.good_length=t,this.max_lazy=e,this.nice_length=s,this.max_chain=i,this.func=r}function E(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(1146),this.dyn_dtree=new r.Buf16(122),this.bl_tree=new r.Buf16(78),_(this.dyn_ltree),_(this.dyn_dtree),_(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(16),this.heap=new r.Buf16(573),_(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(573),_(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function I(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?42:d,t.adler=2===e.wrap?0:1,e.last_flush=0,o._tr_init(e),0):f(t,l)}function S(t){var e,s=I(t);return 0===s&&((e=t.state).window_size=2*e.w_size,_(e.head),e.max_lazy_match=i[e.level].max_lazy,e.good_match=i[e.level].good_length,e.nice_match=i[e.level].nice_length,e.max_chain_length=i[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=2,e.match_available=0,e.ins_h=0),s}function A(t,e,s,i,o,n){if(!t)return l;var a=1;if(-1===e&&(e=6),i<0?(a=0,i=-i):i>15&&(a=2,i-=16),o<1||o>9||8!==s||i<8||i>15||e<0||e>9||n<0||n>4)return f(t,l);8===i&&(i=9);var h=new E;return t.state=h,h.strm=t,h.wrap=a,h.gzhead=null,h.w_bits=i,h.w_size=1<<h.w_bits,h.w_mask=h.w_size-1,h.hash_bits=o+7,h.hash_size=1<<h.hash_bits,h.hash_mask=h.hash_size-1,h.hash_shift=~~((h.hash_bits+3-1)/3),h.window=new r.Buf8(2*h.w_size),h.head=new r.Buf16(h.hash_size),h.prev=new r.Buf16(h.w_size),h.lit_bufsize=1<<o+6,h.pending_buf_size=4*h.lit_bufsize,h.pending_buf=new r.Buf8(h.pending_buf_size),h.d_buf=1*h.lit_bufsize,h.l_buf=3*h.lit_bufsize,h.level=e,h.strategy=n,h.method=s,S(t)}i=[new D(0,0,0,0,(function(t,e){var s=65535;for(s>t.pending_buf_size-5&&(s=t.pending_buf_size-5);;){if(t.lookahead<=1){if(w(t),0===t.lookahead&&0===e)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var i=t.block_start+s;if((0===t.strstart||t.strstart>=i)&&(t.lookahead=t.strstart-i,t.strstart=i,v(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-p&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(v(t,!1),t.strm.avail_out),1)})),new D(4,4,8,4,x),new D(4,5,16,8,x),new D(4,6,32,32,x),new D(4,4,16,16,M),new D(8,16,32,32,M),new D(8,16,128,128,M),new D(8,32,128,256,M),new D(32,128,258,1024,M),new D(32,258,258,4096,M)],s.deflateInit=function(t,e){return A(t,e,8,15,8,0)},s.deflateInit2=A,s.deflateReset=S,s.deflateResetKeep=I,s.deflateSetHeader=function(t,e){return t&&t.state?2!==t.state.wrap?l:(t.state.gzhead=e,0):l},s.deflate=function(t,e){var s,r,n,h;if(!t||!t.state||e>5||e<0)return t?f(t,l):l;if(r=t.state,!t.output||!t.input&&0!==t.avail_in||r.status===m&&4!==e)return f(t,0===t.avail_out?-5:l);if(r.strm=t,s=r.last_flush,r.last_flush=e,42===r.status)if(2===r.wrap)t.adler=0,b(r,31),b(r,139),b(r,8),r.gzhead?(b(r,(r.gzhead.text?1:0)+(r.gzhead.hcrc?2:0)+(r.gzhead.extra?4:0)+(r.gzhead.name?8:0)+(r.gzhead.comment?16:0)),b(r,255&r.gzhead.time),b(r,r.gzhead.time>>8&255),b(r,r.gzhead.time>>16&255),b(r,r.gzhead.time>>24&255),b(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),b(r,255&r.gzhead.os),r.gzhead.extra&&r.gzhead.extra.length&&(b(r,255&r.gzhead.extra.length),b(r,r.gzhead.extra.length>>8&255)),r.gzhead.hcrc&&(t.adler=a(t.adler,r.pending_buf,r.pending,0)),r.gzindex=0,r.status=69):(b(r,0),b(r,0),b(r,0),b(r,0),b(r,0),b(r,9===r.level?2:r.strategy>=2||r.level<2?4:0),b(r,3),r.status=d);else{var p=8+(r.w_bits-8<<4)<<8;p|=(r.strategy>=2||r.level<2?0:r.level<6?1:6===r.level?2:3)<<6,0!==r.strstart&&(p|=32),p+=31-p%31,r.status=d,P(r,p),0!==r.strstart&&(P(r,t.adler>>>16),P(r,65535&t.adler)),t.adler=1}if(69===r.status)if(r.gzhead.extra){for(n=r.pending;r.gzindex<(65535&r.gzhead.extra.length)&&(r.pending!==r.pending_buf_size||(r.gzhead.hcrc&&r.pending>n&&(t.adler=a(t.adler,r.pending_buf,r.pending-n,n)),y(t),n=r.pending,r.pending!==r.pending_buf_size));)b(r,255&r.gzhead.extra[r.gzindex]),r.gzindex++;r.gzhead.hcrc&&r.pending>n&&(t.adler=a(t.adler,r.pending_buf,r.pending-n,n)),r.gzindex===r.gzhead.extra.length&&(r.gzindex=0,r.status=73)}else r.status=73;if(73===r.status)if(r.gzhead.name){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=a(t.adler,r.pending_buf,r.pending-n,n)),y(t),n=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.name.length?255&r.gzhead.name.charCodeAt(r.gzindex++):0,b(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>n&&(t.adler=a(t.adler,r.pending_buf,r.pending-n,n)),0===h&&(r.gzindex=0,r.status=91)}else r.status=91;if(91===r.status)if(r.gzhead.comment){n=r.pending;do{if(r.pending===r.pending_buf_size&&(r.gzhead.hcrc&&r.pending>n&&(t.adler=a(t.adler,r.pending_buf,r.pending-n,n)),y(t),n=r.pending,r.pending===r.pending_buf_size)){h=1;break}h=r.gzindex<r.gzhead.comment.length?255&r.gzhead.comment.charCodeAt(r.gzindex++):0,b(r,h)}while(0!==h);r.gzhead.hcrc&&r.pending>n&&(t.adler=a(t.adler,r.pending_buf,r.pending-n,n)),0===h&&(r.status=c)}else r.status=c;if(r.status===c&&(r.gzhead.hcrc?(r.pending+2>r.pending_buf_size&&y(t),r.pending+2<=r.pending_buf_size&&(b(r,255&t.adler),b(r,t.adler>>8&255),t.adler=0,r.status=d)):r.status=d),0!==r.pending){if(y(t),0===t.avail_out)return r.last_flush=-1,0}else if(0===t.avail_in&&g(e)<=g(s)&&4!==e)return f(t,-5);if(r.status===m&&0!==t.avail_in)return f(t,-5);if(0!==t.avail_in||0!==r.lookahead||0!==e&&r.status!==m){var T=2===r.strategy?function(t,e){for(var s;;){if(0===t.lookahead&&(w(t),0===t.lookahead)){if(0===e)return 1;break}if(t.match_length=0,s=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,s&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(r,e):3===r.strategy?function(t,e){for(var s,i,r,n,a=t.window;;){if(t.lookahead<=u){if(w(t),t.lookahead<=u&&0===e)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(i=a[r=t.strstart-1])===a[++r]&&i===a[++r]&&i===a[++r]){n=t.strstart+u;do{}while(i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&i===a[++r]&&r<n);t.match_length=u-(n-r),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(s=o._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(s=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),s&&(v(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===e?(v(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(v(t,!1),0===t.strm.avail_out)?1:2}(r,e):i[r.level].func(r,e);if(3!==T&&4!==T||(r.status=m),1===T||3===T)return 0===t.avail_out&&(r.last_flush=-1),0;if(2===T&&(1===e?o._tr_align(r):5!==e&&(o._tr_stored_block(r,0,0,!1),3===e&&(_(r.head),0===r.lookahead&&(r.strstart=0,r.block_start=0,r.insert=0))),y(t),0===t.avail_out))return r.last_flush=-1,0}return 4!==e?0:r.wrap<=0?1:(2===r.wrap?(b(r,255&t.adler),b(r,t.adler>>8&255),b(r,t.adler>>16&255),b(r,t.adler>>24&255),b(r,255&t.total_in),b(r,t.total_in>>8&255),b(r,t.total_in>>16&255),b(r,t.total_in>>24&255)):(P(r,t.adler>>>16),P(r,65535&t.adler)),y(t),r.wrap>0&&(r.wrap=-r.wrap),0!==r.pending?0:1)},s.deflateEnd=function(t){var e;return t&&t.state?42!==(e=t.state.status)&&69!==e&&73!==e&&91!==e&&e!==c&&e!==d&&e!==m?f(t,l):(t.state=null,e===d?f(t,-3):0):l},s.deflateSetDictionary=function(t,e){var s,i,o,a,h,u,p,c,d=e.length;if(!t||!t.state)return l;if(2===(a=(s=t.state).wrap)||1===a&&42!==s.status||s.lookahead)return l;for(1===a&&(t.adler=n(t.adler,e,d,0)),s.wrap=0,d>=s.w_size&&(0===a&&(_(s.head),s.strstart=0,s.block_start=0,s.insert=0),c=new r.Buf8(s.w_size),r.arraySet(c,e,d-s.w_size,s.w_size,0),e=c,d=s.w_size),h=t.avail_in,u=t.next_in,p=t.input,t.avail_in=d,t.next_in=0,t.input=e,w(s);s.lookahead>=3;){i=s.strstart,o=s.lookahead-2;do{s.ins_h=(s.ins_h<<s.hash_shift^s.window[i+3-1])&s.hash_mask,s.prev[i&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=i,i++}while(--o);s.strstart=i,s.lookahead=2,w(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,t.next_in=u,t.input=p,t.avail_in=h,s.wrap=a,0},s.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./messages":13,"./trees":14}],9:[function(t,e,s){e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],10:[function(t,e,s){e.exports=function(t,e){var s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P,T,w,x,M,D;s=t.state,i=t.next_in,M=t.input,r=i+(t.avail_in-5),o=t.next_out,D=t.output,n=o-(e-t.avail_out),a=o+(t.avail_out-257),h=s.dmax,l=s.wsize,u=s.whave,p=s.wnext,c=s.window,d=s.hold,m=s.bits,f=s.lencode,g=s.distcode,_=(1<<s.lenbits)-1,y=(1<<s.distbits)-1;t:do{m<15&&(d+=M[i++]<<m,m+=8,d+=M[i++]<<m,m+=8),v=f[d&_];e:for(;;){if(d>>>=b=v>>>24,m-=b,0===(b=v>>>16&255))D[o++]=65535&v;else{if(!(16&b)){if(0==(64&b)){v=f[(65535&v)+(d&(1<<b)-1)];continue e}if(32&b){s.mode=12;break t}t.msg="invalid literal/length code",s.mode=30;break t}P=65535&v,(b&=15)&&(m<b&&(d+=M[i++]<<m,m+=8),P+=d&(1<<b)-1,d>>>=b,m-=b),m<15&&(d+=M[i++]<<m,m+=8,d+=M[i++]<<m,m+=8),v=g[d&y];s:for(;;){if(d>>>=b=v>>>24,m-=b,!(16&(b=v>>>16&255))){if(0==(64&b)){v=g[(65535&v)+(d&(1<<b)-1)];continue s}t.msg="invalid distance code",s.mode=30;break t}if(T=65535&v,m<(b&=15)&&(d+=M[i++]<<m,(m+=8)<b&&(d+=M[i++]<<m,m+=8)),(T+=d&(1<<b)-1)>h){t.msg="invalid distance too far back",s.mode=30;break t}if(d>>>=b,m-=b,T>(b=o-n)){if((b=T-b)>u&&s.sane){t.msg="invalid distance too far back",s.mode=30;break t}if(w=0,x=c,0===p){if(w+=l-b,b<P){P-=b;do{D[o++]=c[w++]}while(--b);w=o-T,x=D}}else if(p<b){if(w+=l+p-b,(b-=p)<P){P-=b;do{D[o++]=c[w++]}while(--b);if(w=0,p<P){P-=b=p;do{D[o++]=c[w++]}while(--b);w=o-T,x=D}}}else if(w+=p-b,b<P){P-=b;do{D[o++]=c[w++]}while(--b);w=o-T,x=D}for(;P>2;)D[o++]=x[w++],D[o++]=x[w++],D[o++]=x[w++],P-=3;P&&(D[o++]=x[w++],P>1&&(D[o++]=x[w++]))}else{w=o-T;do{D[o++]=D[w++],D[o++]=D[w++],D[o++]=D[w++],P-=3}while(P>2);P&&(D[o++]=D[w++],P>1&&(D[o++]=D[w++]))}break}}break}}while(i<r&&o<a);i-=P=m>>3,d&=(1<<(m-=P<<3))-1,t.next_in=i,t.next_out=o,t.avail_in=i<r?r-i+5:5-(i-r),t.avail_out=o<a?a-o+257:257-(o-a),s.hold=d,s.bits=m}},{}],11:[function(t,e,s){var i=t("../utils/common"),r=t("./adler32"),o=t("./crc32"),n=t("./inffast"),a=t("./inftrees"),h=-2,l=12,u=30;function p(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function c(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function d(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=1,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new i.Buf32(852),e.distcode=e.distdyn=new i.Buf32(592),e.sane=1,e.back=-1,0):h}function m(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,d(t)):h}function f(t,e){var s,i;return t&&t.state?(i=t.state,e<0?(s=0,e=-e):(s=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?h:(null!==i.window&&i.wbits!==e&&(i.window=null),i.wrap=s,i.wbits=e,m(t))):h}function g(t,e){var s,i;return t?(i=new c,t.state=i,i.window=null,0!==(s=f(t,e))&&(t.state=null),s):h}var _,y,v=!0;function b(t){if(v){var e;for(_=new i.Buf32(512),y=new i.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(a(1,t.lens,0,288,_,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;a(2,t.lens,0,32,y,0,t.work,{bits:5}),v=!1}t.lencode=_,t.lenbits=9,t.distcode=y,t.distbits=5}function P(t,e,s,r){var o,n=t.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new i.Buf8(n.wsize)),r>=n.wsize?(i.arraySet(n.window,e,s-n.wsize,n.wsize,0),n.wnext=0,n.whave=n.wsize):((o=n.wsize-n.wnext)>r&&(o=r),i.arraySet(n.window,e,s-r,o,n.wnext),(r-=o)?(i.arraySet(n.window,e,s-r,r,0),n.wnext=r,n.whave=n.wsize):(n.wnext+=o,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=o))),0}s.inflateReset=m,s.inflateReset2=f,s.inflateResetKeep=d,s.inflateInit=function(t){return g(t,15)},s.inflateInit2=g,s.inflate=function(t,e){var s,c,d,m,f,g,_,y,v,T,w,x,M,D,E,I,S,A,C,F,O,R,L,N,B=0,k=new i.Buf8(4),j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return h;(s=t.state).mode===l&&(s.mode=13),f=t.next_out,d=t.output,_=t.avail_out,m=t.next_in,c=t.input,g=t.avail_in,y=s.hold,v=s.bits,T=g,w=_,R=0;t:for(;;)switch(s.mode){case 1:if(0===s.wrap){s.mode=13;break}for(;v<16;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(2&s.wrap&&35615===y){s.check=0,k[0]=255&y,k[1]=y>>>8&255,s.check=o(s.check,k,2,0),y=0,v=0,s.mode=2;break}if(s.flags=0,s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&y)<<8)+(y>>8))%31){t.msg="incorrect header check",s.mode=u;break}if(8!=(15&y)){t.msg="unknown compression method",s.mode=u;break}if(v-=4,O=8+(15&(y>>>=4)),0===s.wbits)s.wbits=O;else if(O>s.wbits){t.msg="invalid window size",s.mode=u;break}s.dmax=1<<O,t.adler=s.check=1,s.mode=512&y?10:l,y=0,v=0;break;case 2:for(;v<16;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(s.flags=y,8!=(255&s.flags)){t.msg="unknown compression method",s.mode=u;break}if(57344&s.flags){t.msg="unknown header flags set",s.mode=u;break}s.head&&(s.head.text=y>>8&1),512&s.flags&&(k[0]=255&y,k[1]=y>>>8&255,s.check=o(s.check,k,2,0)),y=0,v=0,s.mode=3;case 3:for(;v<32;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}s.head&&(s.head.time=y),512&s.flags&&(k[0]=255&y,k[1]=y>>>8&255,k[2]=y>>>16&255,k[3]=y>>>24&255,s.check=o(s.check,k,4,0)),y=0,v=0,s.mode=4;case 4:for(;v<16;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}s.head&&(s.head.xflags=255&y,s.head.os=y>>8),512&s.flags&&(k[0]=255&y,k[1]=y>>>8&255,s.check=o(s.check,k,2,0)),y=0,v=0,s.mode=5;case 5:if(1024&s.flags){for(;v<16;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}s.length=y,s.head&&(s.head.extra_len=y),512&s.flags&&(k[0]=255&y,k[1]=y>>>8&255,s.check=o(s.check,k,2,0)),y=0,v=0}else s.head&&(s.head.extra=null);s.mode=6;case 6:if(1024&s.flags&&((x=s.length)>g&&(x=g),x&&(s.head&&(O=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Array(s.head.extra_len)),i.arraySet(s.head.extra,c,m,x,O)),512&s.flags&&(s.check=o(s.check,c,x,m)),g-=x,m+=x,s.length-=x),s.length))break t;s.length=0,s.mode=7;case 7:if(2048&s.flags){if(0===g)break t;x=0;do{O=c[m+x++],s.head&&O&&s.length<65536&&(s.head.name+=String.fromCharCode(O))}while(O&&x<g);if(512&s.flags&&(s.check=o(s.check,c,x,m)),g-=x,m+=x,O)break t}else s.head&&(s.head.name=null);s.length=0,s.mode=8;case 8:if(4096&s.flags){if(0===g)break t;x=0;do{O=c[m+x++],s.head&&O&&s.length<65536&&(s.head.comment+=String.fromCharCode(O))}while(O&&x<g);if(512&s.flags&&(s.check=o(s.check,c,x,m)),g-=x,m+=x,O)break t}else s.head&&(s.head.comment=null);s.mode=9;case 9:if(512&s.flags){for(;v<16;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(y!==(65535&s.check)){t.msg="header crc mismatch",s.mode=u;break}y=0,v=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),t.adler=s.check=0,s.mode=l;break;case 10:for(;v<32;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}t.adler=s.check=p(y),y=0,v=0,s.mode=11;case 11:if(0===s.havedict)return t.next_out=f,t.avail_out=_,t.next_in=m,t.avail_in=g,s.hold=y,s.bits=v,2;t.adler=s.check=1,s.mode=l;case l:if(5===e||6===e)break t;case 13:if(s.last){y>>>=7&v,v-=7&v,s.mode=27;break}for(;v<3;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}switch(s.last=1&y,v-=1,3&(y>>>=1)){case 0:s.mode=14;break;case 1:if(b(s),s.mode=20,6===e){y>>>=2,v-=2;break t}break;case 2:s.mode=17;break;case 3:t.msg="invalid block type",s.mode=u}y>>>=2,v-=2;break;case 14:for(y>>>=7&v,v-=7&v;v<32;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if((65535&y)!=(y>>>16^65535)){t.msg="invalid stored block lengths",s.mode=u;break}if(s.length=65535&y,y=0,v=0,s.mode=15,6===e)break t;case 15:s.mode=16;case 16:if(x=s.length){if(x>g&&(x=g),x>_&&(x=_),0===x)break t;i.arraySet(d,c,m,x,f),g-=x,m+=x,_-=x,f+=x,s.length-=x;break}s.mode=l;break;case 17:for(;v<14;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(s.nlen=257+(31&y),y>>>=5,v-=5,s.ndist=1+(31&y),y>>>=5,v-=5,s.ncode=4+(15&y),y>>>=4,v-=4,s.nlen>286||s.ndist>30){t.msg="too many length or distance symbols",s.mode=u;break}s.have=0,s.mode=18;case 18:for(;s.have<s.ncode;){for(;v<3;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}s.lens[j[s.have++]]=7&y,y>>>=3,v-=3}for(;s.have<19;)s.lens[j[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,L={bits:s.lenbits},R=a(0,s.lens,0,19,s.lencode,0,s.work,L),s.lenbits=L.bits,R){t.msg="invalid code lengths set",s.mode=u;break}s.have=0,s.mode=19;case 19:for(;s.have<s.nlen+s.ndist;){for(;I=(B=s.lencode[y&(1<<s.lenbits)-1])>>>16&255,S=65535&B,!((E=B>>>24)<=v);){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(S<16)y>>>=E,v-=E,s.lens[s.have++]=S;else{if(16===S){for(N=E+2;v<N;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(y>>>=E,v-=E,0===s.have){t.msg="invalid bit length repeat",s.mode=u;break}O=s.lens[s.have-1],x=3+(3&y),y>>>=2,v-=2}else if(17===S){for(N=E+3;v<N;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}v-=E,O=0,x=3+(7&(y>>>=E)),y>>>=3,v-=3}else{for(N=E+7;v<N;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}v-=E,O=0,x=11+(127&(y>>>=E)),y>>>=7,v-=7}if(s.have+x>s.nlen+s.ndist){t.msg="invalid bit length repeat",s.mode=u;break}for(;x--;)s.lens[s.have++]=O}}if(s.mode===u)break;if(0===s.lens[256]){t.msg="invalid code -- missing end-of-block",s.mode=u;break}if(s.lenbits=9,L={bits:s.lenbits},R=a(1,s.lens,0,s.nlen,s.lencode,0,s.work,L),s.lenbits=L.bits,R){t.msg="invalid literal/lengths set",s.mode=u;break}if(s.distbits=6,s.distcode=s.distdyn,L={bits:s.distbits},R=a(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,L),s.distbits=L.bits,R){t.msg="invalid distances set",s.mode=u;break}if(s.mode=20,6===e)break t;case 20:s.mode=21;case 21:if(g>=6&&_>=258){t.next_out=f,t.avail_out=_,t.next_in=m,t.avail_in=g,s.hold=y,s.bits=v,n(t,w),f=t.next_out,d=t.output,_=t.avail_out,m=t.next_in,c=t.input,g=t.avail_in,y=s.hold,v=s.bits,s.mode===l&&(s.back=-1);break}for(s.back=0;I=(B=s.lencode[y&(1<<s.lenbits)-1])>>>16&255,S=65535&B,!((E=B>>>24)<=v);){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(I&&0==(240&I)){for(A=E,C=I,F=S;I=(B=s.lencode[F+((y&(1<<A+C)-1)>>A)])>>>16&255,S=65535&B,!(A+(E=B>>>24)<=v);){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}y>>>=A,v-=A,s.back+=A}if(y>>>=E,v-=E,s.back+=E,s.length=S,0===I){s.mode=26;break}if(32&I){s.back=-1,s.mode=l;break}if(64&I){t.msg="invalid literal/length code",s.mode=u;break}s.extra=15&I,s.mode=22;case 22:if(s.extra){for(N=s.extra;v<N;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}s.length+=y&(1<<s.extra)-1,y>>>=s.extra,v-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=23;case 23:for(;I=(B=s.distcode[y&(1<<s.distbits)-1])>>>16&255,S=65535&B,!((E=B>>>24)<=v);){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(0==(240&I)){for(A=E,C=I,F=S;I=(B=s.distcode[F+((y&(1<<A+C)-1)>>A)])>>>16&255,S=65535&B,!(A+(E=B>>>24)<=v);){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}y>>>=A,v-=A,s.back+=A}if(y>>>=E,v-=E,s.back+=E,64&I){t.msg="invalid distance code",s.mode=u;break}s.offset=S,s.extra=15&I,s.mode=24;case 24:if(s.extra){for(N=s.extra;v<N;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}s.offset+=y&(1<<s.extra)-1,y>>>=s.extra,v-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){t.msg="invalid distance too far back",s.mode=u;break}s.mode=25;case 25:if(0===_)break t;if(x=w-_,s.offset>x){if((x=s.offset-x)>s.whave&&s.sane){t.msg="invalid distance too far back",s.mode=u;break}x>s.wnext?(x-=s.wnext,M=s.wsize-x):M=s.wnext-x,x>s.length&&(x=s.length),D=s.window}else D=d,M=f-s.offset,x=s.length;x>_&&(x=_),_-=x,s.length-=x;do{d[f++]=D[M++]}while(--x);0===s.length&&(s.mode=21);break;case 26:if(0===_)break t;d[f++]=s.length,_--,s.mode=21;break;case 27:if(s.wrap){for(;v<32;){if(0===g)break t;g--,y|=c[m++]<<v,v+=8}if(w-=_,t.total_out+=w,s.total+=w,w&&(t.adler=s.check=s.flags?o(s.check,d,w,f-w):r(s.check,d,w,f-w)),w=_,(s.flags?y:p(y))!==s.check){t.msg="incorrect data check",s.mode=u;break}y=0,v=0}s.mode=28;case 28:if(s.wrap&&s.flags){for(;v<32;){if(0===g)break t;g--,y+=c[m++]<<v,v+=8}if(y!==(4294967295&s.total)){t.msg="incorrect length check",s.mode=u;break}y=0,v=0}s.mode=29;case 29:R=1;break t;case u:R=-3;break t;case 31:return-4;default:return h}return t.next_out=f,t.avail_out=_,t.next_in=m,t.avail_in=g,s.hold=y,s.bits=v,(s.wsize||w!==t.avail_out&&s.mode<u&&(s.mode<27||4!==e))&&P(t,t.output,t.next_out,w-t.avail_out),T-=t.avail_in,w-=t.avail_out,t.total_in+=T,t.total_out+=w,s.total+=w,s.wrap&&w&&(t.adler=s.check=s.flags?o(s.check,d,w,t.next_out-w):r(s.check,d,w,t.next_out-w)),t.data_type=s.bits+(s.last?64:0)+(s.mode===l?128:0)+(20===s.mode||15===s.mode?256:0),(0===T&&0===w||4===e)&&0===R&&(R=-5),R},s.inflateEnd=function(t){if(!t||!t.state)return h;var e=t.state;return e.window&&(e.window=null),t.state=null,0},s.inflateGetHeader=function(t,e){var s;return t&&t.state?0==(2&(s=t.state).wrap)?h:(s.head=e,e.done=!1,0):h},s.inflateSetDictionary=function(t,e){var s,i=e.length;return t&&t.state?0!==(s=t.state).wrap&&11!==s.mode?h:11===s.mode&&r(1,e,i,0)!==s.check?-3:P(t,e,i,i)?(s.mode=31,-4):(s.havedict=1,0):h},s.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":3,"./adler32":5,"./crc32":7,"./inffast":10,"./inftrees":12}],12:[function(t,e,s){var i=t("../utils/common"),r=15,o=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],n=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],h=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(t,e,s,l,u,p,c,d){var m,f,g,_,y,v,b,P,T,w=d.bits,x=0,M=0,D=0,E=0,I=0,S=0,A=0,C=0,F=0,O=0,R=null,L=0,N=new i.Buf16(16),B=new i.Buf16(16),k=null,j=0;for(x=0;x<=r;x++)N[x]=0;for(M=0;M<l;M++)N[e[s+M]]++;for(I=w,E=r;E>=1&&0===N[E];E--);if(I>E&&(I=E),0===E)return u[p++]=20971520,u[p++]=20971520,d.bits=1,0;for(D=1;D<E&&0===N[D];D++);for(I<D&&(I=D),C=1,x=1;x<=r;x++)if(C<<=1,(C-=N[x])<0)return-1;if(C>0&&(0===t||1!==E))return-1;for(B[1]=0,x=1;x<r;x++)B[x+1]=B[x]+N[x];for(M=0;M<l;M++)0!==e[s+M]&&(c[B[e[s+M]]++]=M);if(0===t?(R=k=c,v=19):1===t?(R=o,L-=257,k=n,j-=257,v=256):(R=a,k=h,v=-1),O=0,M=0,x=D,y=p,S=I,A=0,g=-1,_=(F=1<<I)-1,1===t&&F>852||2===t&&F>592)return 1;for(;;){b=x-A,c[M]<v?(P=0,T=c[M]):c[M]>v?(P=k[j+c[M]],T=R[L+c[M]]):(P=96,T=0),m=1<<x-A,D=f=1<<S;do{u[y+(O>>A)+(f-=m)]=b<<24|P<<16|T|0}while(0!==f);for(m=1<<x-1;O&m;)m>>=1;if(0!==m?(O&=m-1,O+=m):O=0,M++,0==--N[x]){if(x===E)break;x=e[s+c[M]]}if(x>I&&(O&_)!==g){for(0===A&&(A=I),y+=D,C=1<<(S=x-A);S+A<E&&!((C-=N[S+A])<=0);)S++,C<<=1;if(F+=1<<S,1===t&&F>852||2===t&&F>592)return 1;u[g=O&_]=I<<24|S<<16|y-p|0}}return 0!==O&&(u[y+O]=x-A<<24|64<<16|0),d.bits=I,0}},{"../utils/common":3}],13:[function(t,e,s){e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],14:[function(t,e,s){var i=t("../utils/common");function r(t){for(var e=t.length;--e>=0;)t[e]=0}var o=256,n=286,a=30,h=15,l=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],p=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],c=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],d=new Array(576);r(d);var m=new Array(60);r(m);var f=new Array(512);r(f);var g=new Array(256);r(g);var _=new Array(29);r(_);var y,v,b,P=new Array(a);function T(t,e,s,i,r){this.static_tree=t,this.extra_bits=e,this.extra_base=s,this.elems=i,this.max_length=r,this.has_stree=t&&t.length}function w(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function x(t){return t<256?f[t]:f[256+(t>>>7)]}function M(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function D(t,e,s){t.bi_valid>16-s?(t.bi_buf|=e<<t.bi_valid&65535,M(t,t.bi_buf),t.bi_buf=e>>16-t.bi_valid,t.bi_valid+=s-16):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=s)}function E(t,e,s){D(t,s[2*e],s[2*e+1])}function I(t,e){var s=0;do{s|=1&t,t>>>=1,s<<=1}while(--e>0);return s>>>1}function S(t,e,s){var i,r,o=new Array(16),n=0;for(i=1;i<=h;i++)o[i]=n=n+s[i-1]<<1;for(r=0;r<=e;r++){var a=t[2*r+1];0!==a&&(t[2*r]=I(o[a]++,a))}}function A(t){var e;for(e=0;e<n;e++)t.dyn_ltree[2*e]=0;for(e=0;e<a;e++)t.dyn_dtree[2*e]=0;for(e=0;e<19;e++)t.bl_tree[2*e]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function C(t){t.bi_valid>8?M(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function F(t,e,s,i){var r=2*e,o=2*s;return t[r]<t[o]||t[r]===t[o]&&i[e]<=i[s]}function O(t,e,s){for(var i=t.heap[s],r=s<<1;r<=t.heap_len&&(r<t.heap_len&&F(e,t.heap[r+1],t.heap[r],t.depth)&&r++,!F(e,i,t.heap[r],t.depth));)t.heap[s]=t.heap[r],s=r,r<<=1;t.heap[s]=i}function R(t,e,s){var i,r,n,a,h=0;if(0!==t.last_lit)do{i=t.pending_buf[t.d_buf+2*h]<<8|t.pending_buf[t.d_buf+2*h+1],r=t.pending_buf[t.l_buf+h],h++,0===i?E(t,r,e):(E(t,(n=g[r])+o+1,e),0!==(a=l[n])&&D(t,r-=_[n],a),E(t,n=x(--i),s),0!==(a=u[n])&&D(t,i-=P[n],a))}while(h<t.last_lit);E(t,256,e)}function L(t,e){var s,i,r,o=e.dyn_tree,n=e.stat_desc.static_tree,a=e.stat_desc.has_stree,l=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=573,s=0;s<l;s++)0!==o[2*s]?(t.heap[++t.heap_len]=u=s,t.depth[s]=0):o[2*s+1]=0;for(;t.heap_len<2;)o[2*(r=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[r]=0,t.opt_len--,a&&(t.static_len-=n[2*r+1]);for(e.max_code=u,s=t.heap_len>>1;s>=1;s--)O(t,o,s);r=l;do{s=t.heap[1],t.heap[1]=t.heap[t.heap_len--],O(t,o,1),i=t.heap[1],t.heap[--t.heap_max]=s,t.heap[--t.heap_max]=i,o[2*r]=o[2*s]+o[2*i],t.depth[r]=(t.depth[s]>=t.depth[i]?t.depth[s]:t.depth[i])+1,o[2*s+1]=o[2*i+1]=r,t.heap[1]=r++,O(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function(t,e){var s,i,r,o,n,a,l=e.dyn_tree,u=e.max_code,p=e.stat_desc.static_tree,c=e.stat_desc.has_stree,d=e.stat_desc.extra_bits,m=e.stat_desc.extra_base,f=e.stat_desc.max_length,g=0;for(o=0;o<=h;o++)t.bl_count[o]=0;for(l[2*t.heap[t.heap_max]+1]=0,s=t.heap_max+1;s<573;s++)(o=l[2*l[2*(i=t.heap[s])+1]+1]+1)>f&&(o=f,g++),l[2*i+1]=o,i>u||(t.bl_count[o]++,n=0,i>=m&&(n=d[i-m]),a=l[2*i],t.opt_len+=a*(o+n),c&&(t.static_len+=a*(p[2*i+1]+n)));if(0!==g){do{for(o=f-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[f]--,g-=2}while(g>0);for(o=f;0!==o;o--)for(i=t.bl_count[o];0!==i;)(r=t.heap[--s])>u||(l[2*r+1]!==o&&(t.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}(t,e),S(o,u,t.bl_count)}function N(t,e,s){var i,r,o=-1,n=e[1],a=0,h=7,l=4;for(0===n&&(h=138,l=3),e[2*(s+1)+1]=65535,i=0;i<=s;i++)r=n,n=e[2*(i+1)+1],++a<h&&r===n||(a<l?t.bl_tree[2*r]+=a:0!==r?(r!==o&&t.bl_tree[2*r]++,t.bl_tree[32]++):a<=10?t.bl_tree[34]++:t.bl_tree[36]++,a=0,o=r,0===n?(h=138,l=3):r===n?(h=6,l=3):(h=7,l=4))}function B(t,e,s){var i,r,o=-1,n=e[1],a=0,h=7,l=4;for(0===n&&(h=138,l=3),i=0;i<=s;i++)if(r=n,n=e[2*(i+1)+1],!(++a<h&&r===n)){if(a<l)do{E(t,r,t.bl_tree)}while(0!=--a);else 0!==r?(r!==o&&(E(t,r,t.bl_tree),a--),E(t,16,t.bl_tree),D(t,a-3,2)):a<=10?(E(t,17,t.bl_tree),D(t,a-3,3)):(E(t,18,t.bl_tree),D(t,a-11,7));a=0,o=r,0===n?(h=138,l=3):r===n?(h=6,l=3):(h=7,l=4)}}r(P);var k=!1;function j(t,e,s,r){D(t,0+(r?1:0),3),function(t,e,s,r){C(t),r&&(M(t,s),M(t,~s)),i.arraySet(t.pending_buf,t.window,e,s,t.pending),t.pending+=s}(t,e,s,!0)}s._tr_init=function(t){k||(!function(){var t,e,s,i,r,o=new Array(16);for(s=0,i=0;i<28;i++)for(_[i]=s,t=0;t<1<<l[i];t++)g[s++]=i;for(g[s-1]=i,r=0,i=0;i<16;i++)for(P[i]=r,t=0;t<1<<u[i];t++)f[r++]=i;for(r>>=7;i<a;i++)for(P[i]=r<<7,t=0;t<1<<u[i]-7;t++)f[256+r++]=i;for(e=0;e<=h;e++)o[e]=0;for(t=0;t<=143;)d[2*t+1]=8,t++,o[8]++;for(;t<=255;)d[2*t+1]=9,t++,o[9]++;for(;t<=279;)d[2*t+1]=7,t++,o[7]++;for(;t<=287;)d[2*t+1]=8,t++,o[8]++;for(S(d,287,o),t=0;t<a;t++)m[2*t+1]=5,m[2*t]=I(t,5);y=new T(d,l,257,n,h),v=new T(m,u,0,a,h),b=new T(new Array(0),p,0,19,7)}(),k=!0),t.l_desc=new w(t.dyn_ltree,y),t.d_desc=new w(t.dyn_dtree,v),t.bl_desc=new w(t.bl_tree,b),t.bi_buf=0,t.bi_valid=0,A(t)},s._tr_stored_block=j,s._tr_flush_block=function(t,e,s,i){var r,n,a=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function(t){var e,s=4093624447;for(e=0;e<=31;e++,s>>>=1)if(1&s&&0!==t.dyn_ltree[2*e])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(e=32;e<o;e++)if(0!==t.dyn_ltree[2*e])return 1;return 0}(t)),L(t,t.l_desc),L(t,t.d_desc),a=function(t){var e;for(N(t,t.dyn_ltree,t.l_desc.max_code),N(t,t.dyn_dtree,t.d_desc.max_code),L(t,t.bl_desc),e=18;e>=3&&0===t.bl_tree[2*c[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),r=t.opt_len+3+7>>>3,(n=t.static_len+3+7>>>3)<=r&&(r=n)):r=n=s+5,s+4<=r&&-1!==e?j(t,e,s,i):4===t.strategy||n===r?(D(t,2+(i?1:0),3),R(t,d,m)):(D(t,4+(i?1:0),3),function(t,e,s,i){var r;for(D(t,e-257,5),D(t,s-1,5),D(t,i-4,4),r=0;r<i;r++)D(t,t.bl_tree[2*c[r]+1],3);B(t,t.dyn_ltree,e-1),B(t,t.dyn_dtree,s-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,a+1),R(t,t.dyn_ltree,t.dyn_dtree)),A(t),i&&C(t)},s._tr_tally=function(t,e,s){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&s,t.last_lit++,0===e?t.dyn_ltree[2*s]++:(t.matches++,e--,t.dyn_ltree[2*(g[s]+o+1)]++,t.dyn_dtree[2*x(e)]++),t.last_lit===t.lit_bufsize-1},s._tr_align=function(t){D(t,2,3),E(t,256,d),function(t){16===t.bi_valid?(M(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},{"../utils/common":3}],15:[function(t,e,s){e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],"/":[function(t,e,s){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),e.exports=i},{"./lib/deflate":1,"./lib/inflate":2,"./lib/utils/common":3,"./lib/zlib/constants":6}]},{},[])("/")}));var Ih=Object.freeze({__proto__:null});let Sh=window.pako||Ih;Sh.inflate||(Sh=Sh.default);const Ah=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const Ch={version:1,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],indices:t[2],edgeIndices:t[3],meshPositions:t[4],meshIndices:t[5],meshEdgesIndices:t[6],meshColors:t[7],entityIDs:t[8],entityMeshes:t[9],entityIsObjects:t[10],positionsDecodeMatrix:t[11]}}(s),o=function(t){return{positions:new Uint16Array(Sh.inflate(t.positions).buffer),normals:new Int8Array(Sh.inflate(t.normals).buffer),indices:new Uint32Array(Sh.inflate(t.indices).buffer),edgeIndices:new Uint32Array(Sh.inflate(t.edgeIndices).buffer),meshPositions:new Uint32Array(Sh.inflate(t.meshPositions).buffer),meshIndices:new Uint32Array(Sh.inflate(t.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Sh.inflate(t.meshEdgesIndices).buffer),meshColors:new Uint8Array(Sh.inflate(t.meshColors).buffer),entityIDs:Sh.inflate(t.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Sh.inflate(t.entityMeshes).buffer),entityIsObjects:new Uint8Array(Sh.inflate(t.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Sh.inflate(t.positionsDecodeMatrix).buffer)}}(r);!function(t,e,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.meshPositions,l=s.meshIndices,u=s.meshEdgesIndices,p=s.meshColors,d=JSON.parse(s.entityIDs),m=s.entityMeshes,f=s.entityIsObjects,g=h.length,y=m.length;for(let v=0;v<y;v++){const b=d[v],P=e.globalizeObjectIds?c.globalizeObjectId(i.id,b):b,T=t.metaScene.metaObjects[P],w={},x={};if(T){if(e.excludeTypesMap&&T.type&&e.excludeTypesMap[T.type])continue;if(e.includeTypesMap&&T.type&&!e.includeTypesMap[T.type])continue;const t=e.objectDefaults?e.objectDefaults[T.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(w.visible=!1),!1===t.pickable&&(w.pickable=!1),t.colorize&&(x.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(x.opacity=t.opacity))}else if(e.excludeUnclassifiedObjects)continue;const M=v===y-1,D=[];for(let t=m[v],e=M?m.length:m[v+1];t<e;t++){const e=t===g-1,c=P+".mesh."+t,d=Ah(p.subarray(4*t,4*t+3)),m=p[4*t+3]/255;i.createMesh(_.apply(x,{id:c,primitive:"triangles",positions:r.subarray(h[t],e?r.length:h[t+1]),normals:o.subarray(h[t],e?r.length:h[t+1]),indices:n.subarray(l[t],e?n.length:l[t+1]),edgeIndices:a.subarray(u[t],e?a.length:u[t+1]),positionsDecodeMatrix:s.positionsDecodeMatrix,color:d,opacity:m})),D.push(c)}i.createEntity(_.apply(w,{id:P,isObject:1===f[v],meshIds:D}))}}(t,e,o,i)}};let Fh=window.pako||Ih;Fh.inflate||(Fh=Fh.default);const Oh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const Rh={version:2,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],indices:t[2],edgeIndices:t[3],meshPositions:t[4],meshIndices:t[5],meshEdgesIndices:t[6],meshColors:t[7],entityIDs:t[8],entityMeshes:t[9],entityIsObjects:t[10],positionsDecodeMatrix:t[11],entityMeshIds:t[12],entityMatrices:t[13],entityUsesInstancing:t[14]}}(s),o=function(t){return{positions:new Uint16Array(Fh.inflate(t.positions).buffer),normals:new Int8Array(Fh.inflate(t.normals).buffer),indices:new Uint32Array(Fh.inflate(t.indices).buffer),edgeIndices:new Uint32Array(Fh.inflate(t.edgeIndices).buffer),meshPositions:new Uint32Array(Fh.inflate(t.meshPositions).buffer),meshIndices:new Uint32Array(Fh.inflate(t.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Fh.inflate(t.meshEdgesIndices).buffer),meshColors:new Uint8Array(Fh.inflate(t.meshColors).buffer),entityIDs:Fh.inflate(t.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Fh.inflate(t.entityMeshes).buffer),entityIsObjects:new Uint8Array(Fh.inflate(t.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Fh.inflate(t.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Fh.inflate(t.entityMeshIds).buffer),entityMatrices:new Float32Array(Fh.inflate(t.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Fh.inflate(t.entityUsesInstancing).buffer)}}(r);!function(t,e,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.meshPositions,l=s.meshIndices,u=s.meshEdgesIndices,p=s.meshColors,d=JSON.parse(s.entityIDs),m=s.entityMeshes,f=s.entityIsObjects,g=s.entityMeshIds,y=s.entityMatrices,v=s.entityUsesInstancing,b=h.length,P=m.length,T={};for(let w=0;w<P;w++){const x=d[w],M=e.globalizeObjectIds?c.globalizeObjectId(i.id,x):x,D=t.metaScene.metaObjects[M],E={},I={},S=y.subarray(16*w,16*w+16);if(D){if(e.excludeTypesMap&&D.type&&e.excludeTypesMap[D.type])continue;if(e.includeTypesMap&&D.type&&!e.includeTypesMap[D.type])continue;const t=e.objectDefaults?e.objectDefaults[D.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(E.visible=!1),!1===t.pickable&&(E.pickable=!1),t.colorize&&(I.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(I.opacity=t.opacity))}else if(e.excludeUnclassifiedObjects)continue;const A=w===P-1,C=[];for(let t=m[w],e=A?g.length:m[w+1];t<e;t++){const e=g[t],c=e===b-1,d=M+".mesh."+e,m=Oh(p.subarray(4*e,4*e+3)),f=p[4*e+3]/255,y=r.subarray(h[e],c?r.length:h[e+1]),P=o.subarray(h[e],c?r.length:h[e+1]),x=n.subarray(l[e],c?n.length:l[e+1]),D=a.subarray(u[e],c?a.length:u[e+1]);if(1===v[w]){const t="geometry."+e;t in T||(i.createGeometry({id:t,positions:y,normals:P,indices:x,edgeIndices:D,primitive:"triangles",positionsDecodeMatrix:s.positionsDecodeMatrix}),T[t]=!0),i.createMesh(_.apply(I,{id:d,color:m,opacity:f,matrix:S,geometryId:t})),C.push(d)}else i.createMesh(_.apply(I,{id:d,primitive:"triangles",positions:y,normals:P,indices:x,edgeIndices:D,positionsDecodeMatrix:s.positionsDecodeMatrix,color:m,opacity:f})),C.push(d)}C.length&&i.createEntity(_.apply(E,{id:M,isObject:1===f[w],meshIds:C}))}}(t,e,o,i)}};let Lh=window.pako||Ih;Lh.inflate||(Lh=Lh.default);const Nh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const Bh={version:3,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],indices:t[2],edgeIndices:t[3],meshPositions:t[4],meshIndices:t[5],meshEdgesIndices:t[6],meshColors:t[7],entityIDs:t[8],entityMeshes:t[9],entityIsObjects:t[10],instancedPositionsDecodeMatrix:t[11],batchedPositionsDecodeMatrix:t[12],entityMeshIds:t[13],entityMatrices:t[14],entityUsesInstancing:t[15]}}(s),o=function(t){return{positions:new Uint16Array(Lh.inflate(t.positions).buffer),normals:new Int8Array(Lh.inflate(t.normals).buffer),indices:new Uint32Array(Lh.inflate(t.indices).buffer),edgeIndices:new Uint32Array(Lh.inflate(t.edgeIndices).buffer),meshPositions:new Uint32Array(Lh.inflate(t.meshPositions).buffer),meshIndices:new Uint32Array(Lh.inflate(t.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Lh.inflate(t.meshEdgesIndices).buffer),meshColors:new Uint8Array(Lh.inflate(t.meshColors).buffer),entityIDs:Lh.inflate(t.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Lh.inflate(t.entityMeshes).buffer),entityIsObjects:new Uint8Array(Lh.inflate(t.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(Lh.inflate(t.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(Lh.inflate(t.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Lh.inflate(t.entityMeshIds).buffer),entityMatrices:new Float32Array(Lh.inflate(t.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Lh.inflate(t.entityUsesInstancing).buffer)}}(r);!function(t,e,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.meshPositions,l=s.meshIndices,u=s.meshEdgesIndices,p=s.meshColors,d=JSON.parse(s.entityIDs),m=s.entityMeshes,f=s.entityIsObjects,g=s.entityMeshIds,y=s.entityMatrices,v=s.entityUsesInstancing,b=h.length,P=m.length,T={};for(let S=0;S<P;S++){const A=d[S],C=e.globalizeObjectIds?c.globalizeObjectId(i.id,A):A,F=t.metaScene.metaObjects[C],O={},R={},L=y.subarray(16*S,16*S+16);if(F){if(e.excludeTypesMap&&F.type&&e.excludeTypesMap[F.type])continue;if(e.includeTypesMap&&F.type&&!e.includeTypesMap[F.type])continue;const t=e.objectDefaults?e.objectDefaults[F.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(O.visible=!1),!1===t.pickable&&(O.pickable=!1),t.colorize&&(R.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(R.opacity=t.opacity))}else if(e.excludeUnclassifiedObjects)continue;const N=S===P-1,B=[];for(let t=m[S],e=N?g.length:m[S+1];t<e;t++){var w=g[t];const e=w===b-1,c=C+".mesh."+w,d=Nh(p.subarray(4*w,4*w+3)),m=p[4*w+3]/255;var x=r.subarray(h[w],e?r.length:h[w+1]),M=o.subarray(h[w],e?r.length:h[w+1]),D=n.subarray(l[w],e?n.length:l[w+1]),E=a.subarray(u[w],e?a.length:u[w+1]);if(1===v[S]){var I="geometry."+w;I in T||(i.createGeometry({id:I,positions:x,normals:M,indices:D,edgeIndices:E,primitive:"triangles",positionsDecodeMatrix:s.instancedPositionsDecodeMatrix}),T[I]=!0),i.createMesh(_.apply(R,{id:c,color:d,opacity:m,matrix:L,geometryId:I})),B.push(c)}else i.createMesh(_.apply(R,{id:c,primitive:"triangles",positions:x,normals:M,indices:D,edgeIndices:E,positionsDecodeMatrix:s.batchedPositionsDecodeMatrix,color:d,opacity:m})),B.push(c)}B.length&&i.createEntity(_.apply(O,{id:C,isObject:1===f[S],meshIds:B}))}}(t,e,o,i)}};let kh=window.pako||Ih;kh.inflate||(kh=kh.default);const jh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const Gh={version:4,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],indices:t[2],edgeIndices:t[3],decodeMatrices:t[4],matrices:t[5],eachPrimitivePositionsAndNormalsPortion:t[6],eachPrimitiveIndicesPortion:t[7],eachPrimitiveEdgeIndicesPortion:t[8],eachPrimitiveDecodeMatricesPortion:t[9],eachPrimitiveColor:t[10],primitiveInstances:t[11],eachEntityId:t[12],eachEntityPrimitiveInstancesPortion:t[13],eachEntityMatricesPortion:t[14],eachEntityMatrix:t[15]}}(s),o=function(t){return{positions:new Uint16Array(kh.inflate(t.positions).buffer),normals:new Int8Array(kh.inflate(t.normals).buffer),indices:new Uint32Array(kh.inflate(t.indices).buffer),edgeIndices:new Uint32Array(kh.inflate(t.edgeIndices).buffer),decodeMatrices:new Float32Array(kh.inflate(t.decodeMatrices).buffer),matrices:new Float32Array(kh.inflate(t.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(kh.inflate(t.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(kh.inflate(t.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(kh.inflate(t.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(kh.inflate(t.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(kh.inflate(t.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(kh.inflate(t.primitiveInstances).buffer),eachEntityId:kh.inflate(t.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(kh.inflate(t.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(kh.inflate(t.eachEntityMatricesPortion).buffer)}}(r);!function(t,e,s,i){i.positionsCompression="precompressed",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.decodeMatrices,l=s.matrices,u=s.eachPrimitivePositionsAndNormalsPortion,p=s.eachPrimitiveIndicesPortion,c=s.eachPrimitiveEdgeIndicesPortion,d=s.eachPrimitiveDecodeMatricesPortion,m=s.eachPrimitiveColor,f=s.primitiveInstances,g=JSON.parse(s.eachEntityId),y=s.eachEntityPrimitiveInstancesPortion,v=s.eachEntityMatricesPortion,b=u.length,P=f.length,T=new Uint8Array(b),w=new Uint32Array(b),x=g.length;for(let t=0;t<b;t++)w[t]=t;w.sort(((t,e)=>d[t]<d[e]?-1:d[t]>d[e]?1:0));for(let t=0;t<P;t++)T[f[t]]++;const M={};for(let t=0;t<x;t++){const e=x-1,s=t===e,i=y[t],r=s?y[e]:y[t+1];for(let e=i;e<r;e++){const s=f[e];T[s]>1||(M[s]=t)}}for(let t=0;t<b;t++){const e=w[t],s=e===b-1,l=T[e]>1,f=jh(m.subarray(4*e,4*e+3)),y=m[4*e+3]/255,v=r.subarray(u[e],s?r.length:u[e+1]),P=o.subarray(u[e],s?o.length:u[e+1]),x=n.subarray(p[e],s?n.length:p[e+1]),E=a.subarray(c[e],s?a.length:c[e+1]),I=h.subarray(d[e],d[e]+16);if(l){var D="geometry"+e;i.createGeometry({id:D,primitive:"triangles",positions:v,normals:P,indices:x,edgeIndices:E,positionsDecodeMatrix:I})}else{const t=e;g[M[e]];const s={};i.createMesh(_.apply(s,{id:t,primitive:"triangles",positions:v,normals:P,indices:x,edgeIndices:E,positionsDecodeMatrix:I,color:f,opacity:y}))}}let E=0;for(let t=0;t<x;t++){const e=x-1,s=t===e,r=g[t],o=y[t],n=s?y[e]:y[t+1],a=[];for(let e=o;e<n;e++){const s=f[e];if(T[s]>1){const e={},r="instance."+E++,o="geometry"+s,n=16*v[t],h=l.subarray(n,n+16);i.createMesh(_.apply(e,{id:r,geometryId:o,matrix:h})),a.push(r)}else a.push(s)}if(a.length>0){const t={};i.createEntity(_.apply(t,{id:r,isObject:!0,meshIds:a}))}}}(0,0,o,i)}};let Hh=window.pako||Ih;Hh.inflate||(Hh=Hh.default);const Vh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const zh={version:5,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],indices:t[2],edgeIndices:t[3],matrices:t[4],eachPrimitivePositionsAndNormalsPortion:t[5],eachPrimitiveIndicesPortion:t[6],eachPrimitiveEdgeIndicesPortion:t[7],eachPrimitiveColor:t[8],primitiveInstances:t[9],eachEntityId:t[10],eachEntityPrimitiveInstancesPortion:t[11],eachEntityMatricesPortion:t[12]}}(s),o=function(t){return{positions:new Float32Array(Hh.inflate(t.positions).buffer),normals:new Int8Array(Hh.inflate(t.normals).buffer),indices:new Uint32Array(Hh.inflate(t.indices).buffer),edgeIndices:new Uint32Array(Hh.inflate(t.edgeIndices).buffer),matrices:new Float32Array(Hh.inflate(t.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(Hh.inflate(t.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(Hh.inflate(t.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(Hh.inflate(t.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(Hh.inflate(t.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(Hh.inflate(t.primitiveInstances).buffer),eachEntityId:Hh.inflate(t.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(Hh.inflate(t.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(Hh.inflate(t.eachEntityMatricesPortion).buffer)}}(r);!function(t,e,s,i){i.positionsCompression="disabled",i.normalsCompression="precompressed";const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.matrices,l=s.eachPrimitivePositionsAndNormalsPortion,u=s.eachPrimitiveIndicesPortion,p=s.eachPrimitiveEdgeIndicesPortion,c=s.eachPrimitiveColor,d=s.primitiveInstances,m=JSON.parse(s.eachEntityId),f=s.eachEntityPrimitiveInstancesPortion,g=s.eachEntityMatricesPortion,y=l.length,v=d.length,b=new Uint8Array(y),P=m.length;for(let t=0;t<v;t++)b[d[t]]++;const T={};for(let t=0;t<P;t++){const e=P-1,s=t===e,i=f[t],r=s?f[e]:f[t+1];for(let e=i;e<r;e++){const s=d[e];b[s]>1||(T[s]=t)}}for(let t=0;t<y;t++){const e=t===y-1,s=b[t]>1,h=Vh(c.subarray(4*t,4*t+3)),d=c[4*t+3]/255,f=r.subarray(l[t],e?r.length:l[t+1]),g=o.subarray(l[t],e?o.length:l[t+1]),v=n.subarray(u[t],e?n.length:u[t+1]),P=a.subarray(p[t],e?a.length:p[t+1]);if(s){var w="geometry"+t;i.createGeometry({id:w,primitive:"triangles",positions:f,normals:g,indices:v,edgeIndices:P})}else{const e=t;m[T[t]];const s={};i.createMesh(_.apply(s,{id:e,primitive:"triangles",positions:f,normals:g,indices:v,edgeIndices:P,color:h,opacity:d}))}}let x=0;for(let t=0;t<P;t++){const e=P-1,s=t===e,r=m[t],o=f[t],n=s?f[e]:f[t+1],a=[];for(let e=o;e<n;e++){const s=d[e];if(b[s]>1){const e={},r="instance."+x++,o="geometry"+s,n=16*g[t],l=h.subarray(n,n+16);i.createMesh(_.apply(e,{id:r,geometryId:o,matrix:l})),a.push(r)}else a.push(s)}if(a.length>0){const t={};i.createEntity(_.apply(t,{id:r,isObject:!0,meshIds:a}))}}}(0,0,o,i)}};let Uh=window.pako||Ih;Uh.inflate||(Uh=Uh.default);const Xh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const Wh={version:6,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],indices:t[2],edgeIndices:t[3],matrices:t[4],reusedPrimitivesDecodeMatrix:t[5],eachPrimitivePositionsAndNormalsPortion:t[6],eachPrimitiveIndicesPortion:t[7],eachPrimitiveEdgeIndicesPortion:t[8],eachPrimitiveColorAndOpacity:t[9],primitiveInstances:t[10],eachEntityId:t[11],eachEntityPrimitiveInstancesPortion:t[12],eachEntityMatricesPortion:t[13],eachTileAABB:t[14],eachTileEntitiesPortion:t[15]}}(s),o=function(t){function e(t,e){return 0===t.length?[]:Uh.inflate(t,e).buffer}return{positions:new Uint16Array(e(t.positions)),normals:new Int8Array(e(t.normals)),indices:new Uint32Array(e(t.indices)),edgeIndices:new Uint32Array(e(t.edgeIndices)),matrices:new Float32Array(e(t.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(e(t.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(e(t.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(e(t.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(e(t.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(e(t.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(e(t.primitiveInstances)),eachEntityId:Uh.inflate(t.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(e(t.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(e(t.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(e(t.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(e(t.eachTileEntitiesPortion))}}(r);!function(t,e,s,i){const r=s.positions,o=s.normals,n=s.indices,a=s.edgeIndices,h=s.matrices,l=s.reusedPrimitivesDecodeMatrix,u=s.eachPrimitivePositionsAndNormalsPortion,p=s.eachPrimitiveIndicesPortion,d=s.eachPrimitiveEdgeIndicesPortion,m=s.eachPrimitiveColorAndOpacity,f=s.primitiveInstances,g=JSON.parse(s.eachEntityId),y=s.eachEntityPrimitiveInstancesPortion,v=s.eachEntityMatricesPortion,b=s.eachTileAABB,P=s.eachTileEntitiesPortion,T=u.length,w=f.length,x=g.length,M=P.length;let D=0;const E=new Uint32Array(T);for(let t=0;t<w;t++){const e=f[t];void 0!==E[e]?E[e]++:E[e]=1}const I=c.vec3(),S=c.AABB3();for(let s=0;s<M;s++){const w=s===M-1,A=P[s],C=w?x:P[s+1],F=6*s,O=b.subarray(F,F+6);c.getAABB3Center(O,I),S[0]=O[0]-I[0],S[1]=O[1]-I[1],S[2]=O[2]-I[2],S[3]=O[3]-I[0],S[4]=O[4]-I[1],S[5]=O[5]-I[2];const R=ve.createPositionsDecodeMatrix(S),L={};for(let b=A;b<C;b++){const P=g[b],w=e.globalizeObjectIds?c.globalizeObjectId(i.id,P):P,M=v[b],S=h.slice(M,M+16),A=b===x-1,C=y[b],F=A?f.length:y[b+1],O=[],N=t.metaScene.metaObjects[w],B={},k={};if(N){if(e.excludeTypesMap&&N.type&&e.excludeTypesMap[N.type])continue;if(e.includeTypesMap&&N.type&&!e.includeTypesMap[N.type])continue;const t=e.objectDefaults?e.objectDefaults[N.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(B.visible=!1),!1===t.pickable&&(B.pickable=!1),t.colorize&&(k.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(k.opacity=t.opacity))}else if(e.excludeUnclassifiedObjects)continue;for(let t=C;t<F;t++){const e=f[t],h=E[e]>1,c=e===T-1,g=r.subarray(u[e],c?r.length:u[e+1]),y=o.subarray(u[e],c?o.length:u[e+1]),v=n.subarray(p[e],c?n.length:p[e+1]),b=a.subarray(d[e],c?a.length:d[e+1]),P=Xh(m.subarray(4*e,4*e+3)),w=m[4*e+3]/255,x=D++;if(h){const t="geometry."+s+"."+e;L[t]||(i.createGeometry({id:t,origin:I,primitive:"triangles",positions:g,normals:y,indices:v,edgeIndices:b,positionsDecodeMatrix:l}),L[t]=!0),i.createMesh(_.apply(k,{id:x,geometryId:t,matrix:S,color:P,opacity:w})),O.push(x)}else i.createMesh(_.apply(k,{id:x,origin:I,primitive:"triangles",positions:g,normals:y,indices:v,edgeIndices:b,positionsDecodeMatrix:R,color:P,opacity:w})),O.push(x)}O.length>0&&i.createEntity(_.apply(B,{id:w,isObject:!0,meshIds:O}))}}}(t,e,o,i)}};let Yh=window.pako||Ih;Yh.inflate||(Yh=Yh.default);const Kh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();function Zh(t){const e=[];for(let s=0,i=t.length;s<i;s+=3)e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]),e.push(1);return e}const qh={version:7,parse:function(t,e,s,i){const r=function(t){return{positions:t[0],normals:t[1],colors:t[2],indices:t[3],edgeIndices:t[4],matrices:t[5],reusedGeometriesDecodeMatrix:t[6],eachGeometryPrimitiveType:t[7],eachGeometryPositionsPortion:t[8],eachGeometryNormalsPortion:t[9],eachGeometryColorsPortion:t[10],eachGeometryIndicesPortion:t[11],eachGeometryEdgeIndicesPortion:t[12],eachMeshGeometriesPortion:t[13],eachMeshMatricesPortion:t[14],eachMeshMaterial:t[15],eachEntityId:t[16],eachEntityMeshesPortion:t[17],eachTileAABB:t[18],eachTileEntitiesPortion:t[19]}}(s),o=function(t){function e(t,e){return 0===t.length?[]:Yh.inflate(t,e).buffer}return{positions:new Uint16Array(e(t.positions)),normals:new Int8Array(e(t.normals)),colors:new Uint8Array(e(t.colors)),indices:new Uint32Array(e(t.indices)),edgeIndices:new Uint32Array(e(t.edgeIndices)),matrices:new Float32Array(e(t.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(e(t.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(e(t.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(e(t.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(e(t.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(e(t.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(e(t.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(e(t.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(e(t.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(e(t.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(e(t.eachMeshMaterial)),eachEntityId:Yh.inflate(t.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(e(t.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(e(t.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(e(t.eachTileEntitiesPortion))}}(r);!function(t,e,s,i){const r=s.positions,o=s.normals,n=s.colors,a=s.indices,h=s.edgeIndices,l=s.matrices,u=s.reusedGeometriesDecodeMatrix,p=s.eachGeometryPrimitiveType,d=s.eachGeometryPositionsPortion,m=s.eachGeometryNormalsPortion,f=s.eachGeometryColorsPortion,g=s.eachGeometryIndicesPortion,y=s.eachGeometryEdgeIndicesPortion,v=s.eachMeshGeometriesPortion,b=s.eachMeshMatricesPortion,P=s.eachMeshMaterial,T=JSON.parse(s.eachEntityId),w=s.eachEntityMeshesPortion,x=s.eachTileAABB,M=s.eachTileEntitiesPortion,D=d.length,E=v.length,I=T.length,S=M.length;let A=0;const C=new Uint32Array(D);for(let t=0;t<E;t++){const e=v[t];void 0!==C[e]?C[e]++:C[e]=1}const F=c.vec3(),O=c.AABB3();for(let s=0;s<S;s++){const E=s===S-1,R=M[s],L=E?I:M[s+1],N=6*s,B=x.subarray(N,N+6);c.getAABB3Center(B,F),O[0]=B[0]-F[0],O[1]=B[1]-F[1],O[2]=B[2]-F[2],O[3]=B[3]-F[0],O[4]=B[4]-F[1],O[5]=B[5]-F[2];const k=ve.createPositionsDecodeMatrix(O),j={};for(let x=R;x<L;x++){const M=T[x],E=e.globalizeObjectIds?c.globalizeObjectId(i.id,M):M,S=x===I-1,O=w[x],R=S?v.length:w[x+1],L=[],N=t.metaScene.metaObjects[E],B={},G={};if(N){if(e.excludeTypesMap&&N.type&&e.excludeTypesMap[N.type])continue;if(e.includeTypesMap&&N.type&&!e.includeTypesMap[N.type])continue;const t=e.objectDefaults?e.objectDefaults[N.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(B.visible=!1),!1===t.pickable&&(B.pickable=!1),t.colorize&&(G.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(G.opacity=t.opacity),void 0!==t.metallic&&null!==t.metallic&&(G.metallic=t.metallic),void 0!==t.roughness&&null!==t.roughness&&(G.roughness=t.roughness))}else if(e.excludeUnclassifiedObjects)continue;for(let t=O;t<R;t++){const e=v[t],c=C[e]>1,T=e===D-1,w=Kh(P.subarray(6*t,6*t+3)),x=P[6*t+3]/255,M=P[6*t+4]/255,E=P[6*t+5]/255,I=A++;if(c){const c=b[t],v=l.slice(c,c+16),P="geometry."+s+"."+e;if(!j[P]){let t,s,l,c,_,v;switch(p[e]){case 0:t="solid",s=r.subarray(d[e],T?r.length:d[e+1]),l=o.subarray(m[e],T?o.length:m[e+1]),_=a.subarray(g[e],T?a.length:g[e+1]),v=h.subarray(y[e],T?h.length:y[e+1]);break;case 1:t="surface",s=r.subarray(d[e],T?r.length:d[e+1]),l=o.subarray(m[e],T?o.length:m[e+1]),_=a.subarray(g[e],T?a.length:g[e+1]),v=h.subarray(y[e],T?h.length:y[e+1]);break;case 2:t="points",s=r.subarray(d[e],T?r.length:d[e+1]),c=Zh(n.subarray(f[e],T?n.length:f[e+1]));break;case 3:t="lines",s=r.subarray(d[e],T?r.length:d[e+1]),_=a.subarray(g[e],T?a.length:g[e+1]);break;default:continue}i.createGeometry({id:P,origin:F,primitive:t,positions:s,normals:l,colors:c,indices:_,edgeIndices:v,positionsDecodeMatrix:u}),j[P]=!0}i.createMesh(_.apply(G,{id:I,geometryId:P,matrix:v,color:w,metallic:M,roughness:E,opacity:x})),L.push(I)}else{let t,s,l,u,c,v;switch(p[e]){case 0:t="solid",s=r.subarray(d[e],T?r.length:d[e+1]),l=o.subarray(m[e],T?o.length:m[e+1]),c=a.subarray(g[e],T?a.length:g[e+1]),v=h.subarray(y[e],T?h.length:y[e+1]);break;case 1:t="surface",s=r.subarray(d[e],T?r.length:d[e+1]),l=o.subarray(m[e],T?o.length:m[e+1]),c=a.subarray(g[e],T?a.length:g[e+1]),v=h.subarray(y[e],T?h.length:y[e+1]);break;case 2:t="points",s=r.subarray(d[e],T?r.length:d[e+1]),u=Zh(n.subarray(f[e],T?n.length:f[e+1]));break;case 3:t="lines",s=r.subarray(d[e],T?r.length:d[e+1]),c=a.subarray(g[e],T?a.length:g[e+1]);break;default:continue}i.createMesh(_.apply(G,{id:I,origin:F,primitive:t,positions:s,normals:l,colors:u,indices:c,edgeIndices:v,positionsDecodeMatrix:k,color:w,metallic:M,roughness:E,opacity:x})),L.push(I)}}L.length>0&&i.createEntity(_.apply(B,{id:E,isObject:!0,meshIds:L}))}}}(t,e,o,i)}};let $h=window.pako||Ih;$h.inflate||($h=$h.default);const Qh=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();function Jh(t){const e=[];for(let s=0,i=t.length;s<i;s+=3)e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]),e.push(1);return e}const tl={version:8,parse:function(t,e,s,i){const r=function(t){return{types:t[0],eachMetaObjectId:t[1],eachMetaObjectType:t[2],eachMetaObjectName:t[3],eachMetaObjectParent:t[4],positions:t[5],normals:t[6],colors:t[7],indices:t[8],edgeIndices:t[9],matrices:t[10],reusedGeometriesDecodeMatrix:t[11],eachGeometryPrimitiveType:t[12],eachGeometryPositionsPortion:t[13],eachGeometryNormalsPortion:t[14],eachGeometryColorsPortion:t[15],eachGeometryIndicesPortion:t[16],eachGeometryEdgeIndicesPortion:t[17],eachMeshGeometriesPortion:t[18],eachMeshMatricesPortion:t[19],eachMeshMaterial:t[20],eachEntityMetaObject:t[21],eachEntityMeshesPortion:t[22],eachTileAABB:t[23],eachTileEntitiesPortion:t[24]}}(s),o=function(t){function e(t,e){return 0===t.length?[]:$h.inflate(t,e).buffer}return{types:$h.inflate(t.types,{to:"string"}),eachMetaObjectId:$h.inflate(t.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(e(t.eachMetaObjectType)),eachMetaObjectName:$h.inflate(t.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(e(t.eachMetaObjectParent)),positions:new Uint16Array(e(t.positions)),normals:new Int8Array(e(t.normals)),colors:new Uint8Array(e(t.colors)),indices:new Uint32Array(e(t.indices)),edgeIndices:new Uint32Array(e(t.edgeIndices)),matrices:new Float32Array(e(t.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(e(t.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(e(t.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(e(t.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(e(t.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(e(t.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(e(t.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(e(t.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(e(t.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(e(t.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(e(t.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(e(t.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(e(t.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(e(t.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(e(t.eachTileEntitiesPortion))}}(r);!function(t,e,s,i){const r=JSON.parse(s.types),o=JSON.parse(s.eachMetaObjectId),n=s.eachMetaObjectType,a=JSON.parse(s.eachMetaObjectName),h=s.eachMetaObjectParent,l=s.positions,u=s.normals,p=s.colors,d=s.indices,m=s.edgeIndices,f=s.matrices,g=s.reusedGeometriesDecodeMatrix,y=s.eachGeometryPrimitiveType,v=s.eachGeometryPositionsPortion,b=s.eachGeometryNormalsPortion,P=s.eachGeometryColorsPortion,T=s.eachGeometryIndicesPortion,w=s.eachGeometryEdgeIndicesPortion,x=s.eachMeshGeometriesPortion,M=s.eachMeshMatricesPortion,D=s.eachMeshMaterial,E=s.eachEntityMetaObject,I=s.eachEntityMeshesPortion,S=s.eachTileAABB,A=s.eachTileEntitiesPortion,C=o.length,F=v.length,O=x.length,R=E.length,L=A.length;let N=0;const B=i.id;if(!t.metaScene.metaModels[B]){const s={metaObjects:[]};for(let t=0;t<C;t++){const e=o[t],i=r[n[t]]||"default",l=a[t],u=h[t],p=u!==t?o[u]:null;s.metaObjects.push({id:e,type:i,name:l,parent:p})}t.metaScene.createMetaModel(B,s,{includeTypes:e.includeTypes,excludeTypes:e.excludeTypes,globalizeObjectIds:e.globalizeObjectIds}),i.once("destroyed",(()=>{t.metaScene.destroyMetaModel(B)}))}const k=new Uint32Array(F);for(let t=0;t<O;t++){const e=x[t];void 0!==k[e]?k[e]++:k[e]=1}const j=c.vec3(),G=c.AABB3();for(let s=0;s<L;s++){const r=s===L-1,n=A[s],a=r?R:A[s+1],h=6*s,C=S.subarray(h,h+6);c.getAABB3Center(C,j),G[0]=C[0]-j[0],G[1]=C[1]-j[1],G[2]=C[2]-j[2],G[3]=C[3]-j[0],G[4]=C[4]-j[1],G[5]=C[5]-j[2];const O=ve.createPositionsDecodeMatrix(G),B={};for(let r=n;r<a;r++){const n=o[E[r]],a=e.globalizeObjectIds?c.globalizeObjectId(i.id,n):n,h=r===R-1,S=I[r],A=h?x.length:I[r+1],C=[],L=t.metaScene.metaObjects[a],G={},H={};if(L){if(e.excludeTypesMap&&L.type&&e.excludeTypesMap[L.type])continue;if(e.includeTypesMap&&L.type&&!e.includeTypesMap[L.type])continue;const t=e.objectDefaults?e.objectDefaults[L.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(G.visible=!1),!1===t.pickable&&(G.pickable=!1),t.colorize&&(H.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(H.opacity=t.opacity),void 0!==t.metallic&&null!==t.metallic&&(H.metallic=t.metallic),void 0!==t.roughness&&null!==t.roughness&&(H.roughness=t.roughness))}else if(e.excludeUnclassifiedObjects)continue;for(let t=S;t<A;t++){const e=x[t],r=k[e]>1,o=e===F-1,n=Qh(D.subarray(6*t,6*t+3)),a=D[6*t+3]/255,h=D[6*t+4]/255,c=D[6*t+5]/255,E=N++;if(r){const r=M[t],x=f.slice(r,r+16),D="geometry."+s+"."+e;if(!B[D]){let t,s,r,n,a,h,c=!1;switch(y[e]){case 0:t="solid",s=l.subarray(v[e],o?l.length:v[e+1]),r=u.subarray(b[e],o?u.length:b[e+1]),a=d.subarray(T[e],o?d.length:T[e+1]),h=m.subarray(w[e],o?m.length:w[e+1]),c=s.length>0&&a.length>0;break;case 1:t="surface",s=l.subarray(v[e],o?l.length:v[e+1]),r=u.subarray(b[e],o?u.length:b[e+1]),a=d.subarray(T[e],o?d.length:T[e+1]),h=m.subarray(w[e],o?m.length:w[e+1]),c=s.length>0&&a.length>0;break;case 2:t="points",s=l.subarray(v[e],o?l.length:v[e+1]),n=Jh(p.subarray(P[e],o?p.length:P[e+1])),c=s.length>0;break;case 3:t="lines",s=l.subarray(v[e],o?l.length:v[e+1]),a=d.subarray(T[e],o?d.length:T[e+1]),c=s.length>0&&a.length>0;break;default:continue}c&&(i.createGeometry({id:D,origin:j,primitive:t,positions:s,normals:r,colorsCompressed:n,indices:a,edgeIndices:h,positionsDecodeMatrix:g}),B[D]=!0)}B[D]&&(i.createMesh(_.apply(H,{id:E,geometryId:D,matrix:x,color:n,metallic:h,roughness:c,opacity:a})),C.push(E))}else{let t,s,r,f,g,x,M=!1;switch(y[e]){case 0:t="solid",s=l.subarray(v[e],o?l.length:v[e+1]),r=u.subarray(b[e],o?u.length:b[e+1]),g=d.subarray(T[e],o?d.length:T[e+1]),x=m.subarray(w[e],o?m.length:w[e+1]),M=s.length>0&&g.length>0;break;case 1:t="surface",s=l.subarray(v[e],o?l.length:v[e+1]),r=u.subarray(b[e],o?u.length:b[e+1]),g=d.subarray(T[e],o?d.length:T[e+1]),x=m.subarray(w[e],o?m.length:w[e+1]),M=s.length>0&&g.length>0;break;case 2:t="points",s=l.subarray(v[e],o?l.length:v[e+1]),f=Jh(p.subarray(P[e],o?p.length:P[e+1])),M=s.length>0;break;case 3:t="lines",s=l.subarray(v[e],o?l.length:v[e+1]),g=d.subarray(T[e],o?d.length:T[e+1]),M=s.length>0&&g.length>0;break;default:continue}M&&(i.createMesh(_.apply(H,{id:E,origin:j,primitive:t,positions:s,normals:r,colorsCompressed:f,indices:g,edgeIndices:x,positionsDecodeMatrix:O,color:n,metallic:h,roughness:c,opacity:a})),C.push(E))}}C.length>0&&i.createEntity(_.apply(G,{id:a,isObject:!0,meshIds:C}))}}}(t,e,o,i)}};let el=window.pako||Ih;el.inflate||(el=el.default);const sl=function(){const t=new Float32Array(3);return function(e){return t[0]=e[0]/255,t[1]=e[1]/255,t[2]=e[2]/255,t}}();const il={version:9,parse:function(t,e,s,i){const r=function(t){return{metadata:t[0],positions:t[1],normals:t[2],colors:t[3],indices:t[4],edgeIndices:t[5],matrices:t[6],reusedGeometriesDecodeMatrix:t[7],eachGeometryPrimitiveType:t[8],eachGeometryPositionsPortion:t[9],eachGeometryNormalsPortion:t[10],eachGeometryColorsPortion:t[11],eachGeometryIndicesPortion:t[12],eachGeometryEdgeIndicesPortion:t[13],eachMeshGeometriesPortion:t[14],eachMeshMatricesPortion:t[15],eachMeshMaterial:t[16],eachEntityId:t[17],eachEntityMeshesPortion:t[18],eachTileAABB:t[19],eachTileEntitiesPortion:t[20]}}(s),o=function(t){function e(t,e){return 0===t.length?[]:el.inflate(t,e).buffer}return{metadata:JSON.parse(el.inflate(t.metadata,{to:"string"})),positions:new Uint16Array(e(t.positions)),normals:new Int8Array(e(t.normals)),colors:new Uint8Array(e(t.colors)),indices:new Uint32Array(e(t.indices)),edgeIndices:new Uint32Array(e(t.edgeIndices)),matrices:new Float32Array(e(t.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(e(t.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(e(t.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(e(t.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(e(t.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(e(t.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(e(t.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(e(t.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(e(t.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(e(t.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(e(t.eachMeshMaterial)),eachEntityId:JSON.parse(el.inflate(t.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(e(t.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(e(t.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(e(t.eachTileEntitiesPortion))}}(r);!function(t,e,s,i){const r=s.metadata,o=s.positions,n=s.normals,a=s.colors,h=s.indices,l=s.edgeIndices,u=s.matrices,p=s.reusedGeometriesDecodeMatrix,d=s.eachGeometryPrimitiveType,m=s.eachGeometryPositionsPortion,f=s.eachGeometryNormalsPortion,g=s.eachGeometryColorsPortion,y=s.eachGeometryIndicesPortion,v=s.eachGeometryEdgeIndicesPortion,b=s.eachMeshGeometriesPortion,P=s.eachMeshMatricesPortion,T=s.eachMeshMaterial,w=s.eachEntityId,x=s.eachEntityMeshesPortion,M=s.eachTileAABB,D=s.eachTileEntitiesPortion,E=m.length,I=b.length,S=x.length,A=D.length;let C=0;const F=i.id;t.metaScene.metaModels[F]||(t.metaScene.createMetaModel(F,r,{includeTypes:e.includeTypes,excludeTypes:e.excludeTypes,globalizeObjectIds:e.globalizeObjectIds}),i.once("destroyed",(()=>{t.metaScene.destroyMetaModel(F)})));const O=new Uint32Array(E);for(let t=0;t<I;t++){const e=b[t];void 0!==O[e]?O[e]++:O[e]=1}const R=c.vec3(),L=c.AABB3();for(let s=0;s<A;s++){const r=s===A-1,I=D[s],F=r?S-1:D[s+1]-1,N=6*s,B=M.subarray(N,N+6);c.getAABB3Center(B,R),L[0]=B[0]-R[0],L[1]=B[1]-R[1],L[2]=B[2]-R[2],L[3]=B[3]-R[0],L[4]=B[4]-R[1],L[5]=B[5]-R[2];const k=ve.createPositionsDecodeMatrix(L),j={};for(let r=I;r<=F;r++){const M=w[r],D=e.globalizeObjectIds?c.globalizeObjectId(i.id,M):M,I=r===S-1,A=x[r],F=I?b.length-1:x[r+1]-1,L=[],N=t.metaScene.metaObjects[D],B={},G={};if(N){if(e.excludeTypesMap&&N.type&&e.excludeTypesMap[N.type])continue;if(e.includeTypesMap&&N.type&&!e.includeTypesMap[N.type])continue;const t=e.objectDefaults?e.objectDefaults[N.type]||e.objectDefaults.DEFAULT:null;t&&(!1===t.visible&&(B.visible=!1),!1===t.pickable&&(B.pickable=!1),t.colorize&&(G.color=t.colorize),void 0!==t.opacity&&null!==t.opacity&&(G.opacity=t.opacity),void 0!==t.metallic&&null!==t.metallic&&(G.metallic=t.metallic),void 0!==t.roughness&&null!==t.roughness&&(G.roughness=t.roughness))}else if(e.excludeUnclassifiedObjects)continue;for(let t=A;t<=F;t++){const e=b[t],r=O[e]>1,c=e===E-1,w=sl(T.subarray(6*t,6*t+3)),x=T[6*t+3]/255,M=T[6*t+4]/255,D=T[6*t+5]/255,I=C++;if(r){const r=P[t],b=u.slice(r,r+16),T="geometry."+s+"."+e;if(!j[T]){let t,s,r,u,_,b,P=!1;switch(d[e]){case 0:t="solid",s=o.subarray(m[e],c?o.length:m[e+1]),r=n.subarray(f[e],c?n.length:f[e+1]),_=h.subarray(y[e],c?h.length:y[e+1]),b=l.subarray(v[e],c?l.length:v[e+1]),P=s.length>0&&_.length>0;break;case 1:t="surface",s=o.subarray(m[e],c?o.length:m[e+1]),r=n.subarray(f[e],c?n.length:f[e+1]),_=h.subarray(y[e],c?h.length:y[e+1]),b=l.subarray(v[e],c?l.length:v[e+1]),P=s.length>0&&_.length>0;break;case 2:t="points",s=o.subarray(m[e],c?o.length:m[e+1]),u=a.subarray(g[e],c?a.length:g[e+1]),P=s.length>0;break;case 3:t="lines",s=o.subarray(m[e],c?o.length:m[e+1]),_=h.subarray(y[e],c?h.length:y[e+1]),P=s.length>0&&_.length>0;break;default:continue}P&&(i.createGeometry({id:T,origin:R,primitive:t,positions:s,normals:r,colorsCompressed:u,indices:_,edgeIndices:b,positionsDecodeMatrix:p}),j[T]=!0)}j[T]&&(i.createMesh(_.apply(G,{id:I,geometryId:T,matrix:b,color:w,metallic:M,roughness:D,opacity:x})),L.push(I))}else{let t,s,r,u,p,b,P=!1;switch(d[e]){case 0:t="solid",s=o.subarray(m[e],c?o.length:m[e+1]),r=n.subarray(f[e],c?n.length:f[e+1]),p=h.subarray(y[e],c?h.length:y[e+1]),b=l.subarray(v[e],c?l.length:v[e+1]),P=s.length>0&&p.length>0;break;case 1:t="surface",s=o.subarray(m[e],c?o.length:m[e+1]),r=n.subarray(f[e],c?n.length:f[e+1]),p=h.subarray(y[e],c?h.length:y[e+1]),b=l.subarray(v[e],c?l.length:v[e+1]),P=s.length>0&&p.length>0;break;case 2:t="points",s=o.subarray(m[e],c?o.length:m[e+1]),u=a.subarray(g[e],c?a.length:g[e+1]),P=s.length>0;break;case 3:t="lines",s=o.subarray(m[e],c?o.length:m[e+1]),p=h.subarray(y[e],c?h.length:y[e+1]),P=s.length>0&&p.length>0;break;default:continue}P&&(i.createMesh(_.apply(G,{id:I,origin:R,primitive:t,positions:s,normals:r,colorsCompressed:u,indices:p,edgeIndices:b,positionsDecodeMatrix:k,color:w,metallic:M,roughness:D,opacity:x})),L.push(I))}}L.length>0&&i.createEntity(_.apply(B,{id:D,isObject:!0,meshIds:L}))}}}(t,e,o,i)}},rl={};rl[Ch.version]=Ch,rl[Rh.version]=Rh,rl[Bh.version]=Bh,rl[Gh.version]=Gh,rl[zh.version]=zh,rl[Wh.version]=Wh,rl[qh.version]=qh,rl[tl.version]=tl,rl[il.version]=il;class ol extends n{constructor(t,e={}){super("XKTLoader",t,e),this._maxGeometryBatchSize=e.maxGeometryBatchSize,this.dataSource=e.dataSource,this.objectDefaults=e.objectDefaults,this.includeTypes=e.includeTypes,this.excludeTypes=e.excludeTypes,this.excludeUnclassifiedObjects=e.excludeUnclassifiedObjects}get supportedVersions(){return Object.keys(rl)}get dataSource(){return this._dataSource}set dataSource(t){this._dataSource=t||new Eh}get objectDefaults(){return this._objectDefaults}set objectDefaults(t){this._objectDefaults=t||xa}get includeTypes(){return this._includeTypes}set includeTypes(t){this._includeTypes=t}get excludeTypes(){return this._excludeTypes}set excludeTypes(t){this._excludeTypes=t}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(t){this._excludeUnclassifiedObjects=!!t}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(t){this._globalizeObjectIds=!!t}load(t={}){t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);const e=new Vn(this.viewer.scene,_.apply(t,{isModel:!0,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:t.origin})),s=e.id;if(!t.src&&!t.xkt)return this.error("load() param expected: src or xkt"),e;const i={},r=t.includeTypes||this._includeTypes,o=t.excludeTypes||this._excludeTypes,n=t.objectDefaults||this._objectDefaults;if(r){i.includeTypesMap={};for(let t=0,e=r.length;t<e;t++)i.includeTypesMap[r[t]]=!0}if(o){i.excludeTypesMap={};for(let t=0,e=o.length;t<e;t++)i.excludeTypesMap[o[t]]=!0}if(n&&(i.objectDefaults=n),i.excludeUnclassifiedObjects=void 0!==t.excludeUnclassifiedObjects?!!t.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,i.globalizeObjectIds=void 0!==t.globalizeObjectIds?!!t.globalizeObjectIds:this._globalizeObjectIds,t.metaModelSrc||t.metaModelData){const n=n=>!!this.viewer.metaScene.createMetaModel(s,n,{includeTypes:r,excludeTypes:o,globalizeObjectIds:this.globalizeObjectIds})&&(t.src?this._loadModel(t.src,t,i,e):this._parseModel(t.xkt,t,i,e),e.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(e.id)})),!0);if(t.metaModelSrc){const i=t.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(i,(t=>{e.destroyed||(n(t)||(this.error(`load(): Failed to load model metadata for model '${s} from '${i}' - metadata not valid`),e.fire("error","Metadata not valid")),this.viewer.scene.canvas.spinner.processes--)}),(t=>{this.error(`load(): Failed to load model metadata for model '${s} from  '${i}' - ${t}`),e.fire("error",`Failed to load model metadata from  '${i}' - ${t}`),this.viewer.scene.canvas.spinner.processes--}))}else t.metaModelData&&(n(t.metaModelData)||(this.error(`load(): Failed to load model metadata for model '${s} from '${t.metaModelSrc}' - metadata not valid`),e.fire("error","Metadata not valid")))}else t.src?this._loadModel(t.src,t,i,e):this._parseModel(t.xkt,t,i,e);return e}_loadModel(t,e,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getXKT(e.src,(t=>{this._parseModel(t,e,s,i),r.processes--}),(t=>{r.processes--,this.error(t),i.fire("error",t)}))}_parseModel(t,e,s,i){if(i.destroyed)return;const r=new DataView(t),o=new Uint8Array(t),n=r.getUint32(0,!0),a=rl[n];if(!a)return void this.error("Unsupported .XKT file version: "+n+" - this XKTLoaderPlugin supports versions "+Object.keys(rl));this.log("Loading .xkt V"+n);const h=r.getUint32(4,!0),l=[];let u=4*(h+2);for(let t=0;t<h;t++){const e=r.getUint32(4*(t+2),!0);l.push(o.subarray(u,u+e)),u+=e}a.parse(this.viewer,s,l,i),i.finalize(),this._createDefaultMetaModelIfNeeded(i,e,s),i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_createDefaultMetaModelIfNeeded(t,e,s){const i=t.id;if(!this.viewer.metaScene.metaModels[i]){const r={metaObjects:[]};r.metaObjects.push({id:i,type:"default",name:i,parent:null});const o=t.entityList;for(let t=0,e=o.length;t<e;t++){const e=o[t];e.isObject&&r.metaObjects.push({id:e.id,type:"default",name:e.id,parent:i})}const n=e.src;this.viewer.metaScene.createMetaModel(i,r,{includeTypes:s.includeTypes,excludeTypes:s.excludeTypes,globalizeObjectIds:s.globalizeObjectIds,getProperties:async t=>await this._dataSource.getProperties(n,t)}),t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(i)}))}}}class nl extends De{get type(){return"LambertMaterial"}constructor(t,e={}){super(t,e),this._state=new zt({type:"LambertMaterial",ambient:c.vec3([1,1,1]),color:c.vec3([1,1,1]),emissive:c.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"}),this.ambient=e.ambient,this.color=e.color,this.emissive=e.emissive,this.alpha=e.alpha,this.lineWidth=e.lineWidth,this.pointSize=e.pointSize,this.backfaces=e.backfaces,this.frontface=e.frontface}set ambient(t){let e=this._state.ambient;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.ambient=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=.2,e[1]=.2,e[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set color(t){let e=this._state.color;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.color=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=1,e[1]=1,e[2]=1),this.glRedraw()}get color(){return this._state.color}set emissive(t){let e=this._state.emissive;if(e){if(t&&e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2])return}else e=this._state.emissive=new Float32Array(3);t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):(e[0]=0,e[1]=0,e[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(t){t=null!=t?t:1,this._state.alpha!==t&&(this._state.alpha=t,this._state.alphaMode=t<1?2:0,this.glRedraw())}get alpha(){return this._state.alpha}set lineWidth(t){this._state.lineWidth=t||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(t){this._state.pointSize=t||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set backfaces(t){t=!!t,this._state.backfaces!==t&&(this._state.backfaces=t,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(t){t="cw"!==t,this._state.frontface!==t&&(this._state.frontface=t,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}var al={};!function(t){var e,s="File format is not recognized.",i="Error while reading zip file.",r="Error while reading file data.",o=524288,n="text/plain";try{e=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(t){}function a(){this.crc=-1}function h(){}function l(t,e){var s,i;return s=new ArrayBuffer(t),i=new Uint8Array(s),e&&i.set(e,0),{buffer:s,array:i,view:new DataView(s)}}function u(){}function p(t){var e,s=this;s.size=0,s.init=function(i,r){var o=new Blob([t],{type:n});(e=new d(o)).init((function(){s.size=e.size,i()}),r)},s.readUint8Array=function(t,s,i,r){e.readUint8Array(t,s,i,r)}}function c(e){var s,i=this;i.size=0,i.init=function(t){for(var r=e.length;"="==e.charAt(r-1);)r--;s=e.indexOf(",")+1,i.size=Math.floor(.75*(r-s)),t()},i.readUint8Array=function(i,r,o){var n,a=l(r),h=4*Math.floor(i/3),u=4*Math.ceil((i+r)/3),p=t.atob(e.substring(h+s,u+s)),c=i-3*Math.floor(h/4);for(n=c;n<c+r;n++)a.array[n-c]=p.charCodeAt(n);o(a.array)}}function d(t){var e=this;e.size=0,e.init=function(s){e.size=t.size,s()},e.readUint8Array=function(e,s,i,r){var o=new FileReader;o.onload=function(t){i(new Uint8Array(t.target.result))},o.onerror=r;try{o.readAsArrayBuffer(function(t,e,s){if(e<0||s<0||e+s>t.size)throw new RangeError("offset:"+e+", length:"+s+", size:"+t.size);return t.slice?t.slice(e,e+s):t.webkitSlice?t.webkitSlice(e,e+s):t.mozSlice?t.mozSlice(e,e+s):t.msSlice?t.msSlice(e,e+s):void 0}(t,e,s))}catch(t){r(t)}}}function m(){}function f(t){var s,i=this;i.init=function(t){s=new Blob([],{type:n}),t()},i.writeUint8Array=function(t,i){s=new Blob([s,e?t:t.buffer],{type:n}),i()},i.getData=function(e,i){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=i,r.readAsText(s,t)}}function g(e){var s=this,i="",r="";s.init=function(t){i+="data:"+(e||"")+";base64,",t()},s.writeUint8Array=function(e,s){var o,n=r.length,a=r;for(r="",o=0;o<3*Math.floor((n+e.length)/3)-n;o++)a+=String.fromCharCode(e[o]);for(;o<e.length;o++)r+=String.fromCharCode(e[o]);a.length>2?i+=t.btoa(a):r=a,s()},s.getData=function(e){e(i+t.btoa(r))}}function _(t){var s,i=this;i.init=function(e){s=new Blob([],{type:t}),e()},i.writeUint8Array=function(i,r){s=new Blob([s,e?i:i.buffer],{type:t}),r()},i.getData=function(t){t(s)}}function y(t,e,s,i,r,n,a,h,l,u){var p,c,d,m=0,f=e.sn;function g(){t.removeEventListener("message",_,!1),h(c,d)}function _(e){var s=e.data,r=s.data,o=s.error;if(o)return o.toString=function(){return"Error: "+this.message},void l(o);if(s.sn===f)switch("number"==typeof s.codecTime&&(t.codecTime+=s.codecTime),"number"==typeof s.crcTime&&(t.crcTime+=s.crcTime),s.type){case"append":r?(c+=r.length,i.writeUint8Array(r,(function(){y()}),u)):y();break;case"flush":d=s.crc,r?(c+=r.length,i.writeUint8Array(r,(function(){g()}),u)):g();break;case"progress":a&&a(p+s.loaded,n);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",s)}}function y(){(p=m*o)<=n?s.readUint8Array(r+p,Math.min(o,n-p),(function(s){a&&a(p,n);var i=0===p?e:{sn:f};i.type="append",i.data=s;try{t.postMessage(i,[s.buffer])}catch(e){t.postMessage(i)}m++}),l):t.postMessage({sn:f,type:"flush"})}c=0,t.addEventListener("message",_,!1),y()}function v(t,e,s,i,r,n,h,l,u,p){var c,d=0,m=0,f="input"===n,g="output"===n,_=new a;!function n(){var a;if((c=d*o)<r)e.readUint8Array(i+c,Math.min(o,r-c),(function(e){var i;try{i=t.append(e,(function(t){h&&h(c+t,r)}))}catch(t){return void u(t)}i?(m+=i.length,s.writeUint8Array(i,(function(){d++,setTimeout(n,1)}),p),g&&_.append(i)):(d++,setTimeout(n,1)),f&&_.append(e),h&&h(c,r)}),u);else{try{a=t.flush()}catch(t){return void u(t)}a?(g&&_.append(a),m+=a.length,s.writeUint8Array(a,(function(){l(m,_.get())}),p)):l(m,_.get())}}()}function b(e,s,i,r,o,n,a,l,u,p,c){var d="input";t.zip.useWebWorkers&&a?y(e,{sn:s,codecClass:"NOOP",crcType:d},i,r,o,n,u,l,p,c):v(new h,i,r,o,n,d,u,l,p,c)}function P(t){var e,s,i="",r=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(e=0;e<t.length;e++)i+=(s=255&t.charCodeAt(e))>127?r[s-128]:String.fromCharCode(s);return i}function T(t){return decodeURIComponent(escape(t))}function w(t){var e,s="";for(e=0;e<t.length;e++)s+=String.fromCharCode(t[e]);return s}function x(t,e,s,i,r){t.version=e.view.getUint16(s,!0),t.bitFlag=e.view.getUint16(s+2,!0),t.compressionMethod=e.view.getUint16(s+4,!0),t.lastModDateRaw=e.view.getUint32(s+6,!0),t.lastModDate=function(t){var e=(4294901760&t)>>16,s=65535&t;try{return new Date(1980+((65024&e)>>9),((480&e)>>5)-1,31&e,(63488&s)>>11,(2016&s)>>5,2*(31&s),0)}catch(t){}}(t.lastModDateRaw),1!=(1&t.bitFlag)?((i||8!=(8&t.bitFlag))&&(t.crc32=e.view.getUint32(s+10,!0),t.compressedSize=e.view.getUint32(s+14,!0),t.uncompressedSize=e.view.getUint32(s+18,!0)),4294967295!==t.compressedSize&&4294967295!==t.uncompressedSize?(t.filenameLength=e.view.getUint16(s+22,!0),t.extraFieldLength=e.view.getUint16(s+24,!0)):r("File is using Zip64 (4gb+ file size).")):r("File contains encrypted entry.")}function M(e,o,n){var a=0;function h(){}h.prototype.getData=function(i,o,h,u){var p=this;function c(t,e){u&&!function(t){var e=l(4);return e.view.setUint32(0,t),p.crc32==e.view.getUint32(0)}(e)?n("CRC failed."):i.getData((function(t){o(t)}))}function d(t){n(t||r)}function m(t){n(t||"Error while writing file data.")}e.readUint8Array(p.offset,30,(function(r){var o,f=l(r.length,r);1347093252==f.view.getUint32(0)?(x(p,f,4,!1,n),o=p.offset+30+p.filenameLength+p.extraFieldLength,i.init((function(){0===p.compressionMethod?b(p._worker,a++,e,i,o,p.compressedSize,u,c,h,d,m):function(e,s,i,r,o,n,a,h,l,u,p){var c=a?"output":"none";t.zip.useWebWorkers?y(e,{sn:s,codecClass:"Inflater",crcType:c},i,r,o,n,l,h,u,p):v(new t.zip.Inflater,i,r,o,n,c,l,h,u,p)}(p._worker,a++,e,i,o,p.compressedSize,u,c,h,d,m)}),m)):n(s)}),d)};var u={getEntries:function(t){var r=this._worker;!function(t){e.size<22?n(s):r(22,(function(){r(Math.min(65558,e.size),(function(){n(s)}))}));function r(s,r){e.readUint8Array(e.size-s,s,(function(e){for(var s=e.length-22;s>=0;s--)if(80===e[s]&&75===e[s+1]&&5===e[s+2]&&6===e[s+3])return void t(new DataView(e.buffer,s,22));r()}),(function(){n(i)}))}}((function(o){var a,u;a=o.getUint32(16,!0),u=o.getUint16(8,!0),a<0||a>=e.size?n(s):e.readUint8Array(a,e.size-a,(function(e){var i,o,a,p,c=0,d=[],m=l(e.length,e);for(i=0;i<u;i++){if((o=new h)._worker=r,1347092738!=m.view.getUint32(c))return void n(s);x(o,m,c+6,!0,n),o.commentLength=m.view.getUint16(c+32,!0),o.directory=16==(16&m.view.getUint8(c+38)),o.offset=m.view.getUint32(c+42,!0),a=w(m.array.subarray(c+46,c+46+o.filenameLength)),o.filename=2048==(2048&o.bitFlag)?T(a):P(a),o.directory||"/"!=o.filename.charAt(o.filename.length-1)||(o.directory=!0),p=w(m.array.subarray(c+46+o.filenameLength+o.extraFieldLength,c+46+o.filenameLength+o.extraFieldLength+o.commentLength)),o.comment=2048==(2048&o.bitFlag)?T(p):P(p),d.push(o),c+=46+o.filenameLength+o.extraFieldLength+o.commentLength}t(d)}),(function(){n(i)}))}))},close:function(t){this._worker&&(this._worker.terminate(),this._worker=null),t&&t()},_worker:null};t.zip.useWebWorkers?A("inflater",(function(t){u._worker=t,o(u)}),(function(t){n(t)})):o(u)}function D(t){return unescape(encodeURIComponent(t))}function E(t){var e,s=[];for(e=0;e<t.length;e++)s.push(t.charCodeAt(e));return s}function I(e,s,i,o){var n={},a=[],h=0,u=0;function p(t){i(t||"Error while writing zip file.")}function c(t){i(t||r)}var d={add:function(s,r,d,m,f){var g,_,P,T=this._worker;function w(t,s){var i=l(16);h+=t||0,i.view.setUint32(0,1347094280),void 0!==s&&(g.view.setUint32(10,s,!0),i.view.setUint32(4,s,!0)),r&&(i.view.setUint32(8,t,!0),g.view.setUint32(14,t,!0),i.view.setUint32(12,r.size,!0),g.view.setUint32(18,r.size,!0)),e.writeUint8Array(i.array,(function(){h+=16,d()}),p)}function x(){f=f||{},s=s.trim(),f.directory&&"/"!=s.charAt(s.length-1)&&(s+="/"),n.hasOwnProperty(s)?i("File already exists."):(_=E(D(s)),a.push(s),function(t){var i;P=f.lastModDate||new Date,g=l(26),n[s]={headerArray:g.array,directory:f.directory,filename:_,offset:h,comment:E(D(f.comment||""))},g.view.setUint32(0,335546376),f.version&&g.view.setUint8(0,f.version),o||0===f.level||f.directory||g.view.setUint16(4,2048),g.view.setUint16(6,(P.getHours()<<6|P.getMinutes())<<5|P.getSeconds()/2,!0),g.view.setUint16(8,(P.getFullYear()-1980<<4|P.getMonth()+1)<<5|P.getDate(),!0),g.view.setUint16(22,_.length,!0),(i=l(30+_.length)).view.setUint32(0,1347093252),i.array.set(g.array,4),i.array.set(_,30),h+=i.array.length,e.writeUint8Array(i.array,t,p)}((function(){r?o||0===f.level?b(T,u++,r,e,0,r.size,!0,w,m,c,p):function(e,s,i,r,o,n,a,h,l){var u="input";t.zip.useWebWorkers?y(e,{sn:s,options:{level:o},codecClass:"Deflater",crcType:u},i,r,0,i.size,a,n,h,l):v(new t.zip.Deflater,i,r,0,i.size,u,a,n,h,l)}(T,u++,r,e,f.level,w,m,c,p):w()})))}r?r.init(x,c):x()},close:function(t){this._worker&&(this._worker.terminate(),this._worker=null);var s,i,r,o=0,u=0;for(i=0;i<a.length;i++)o+=46+(r=n[a[i]]).filename.length+r.comment.length;for(s=l(o+22),i=0;i<a.length;i++)r=n[a[i]],s.view.setUint32(u,1347092738),s.view.setUint16(u+4,5120),s.array.set(r.headerArray,u+6),s.view.setUint16(u+32,r.comment.length,!0),r.directory&&s.view.setUint8(u+38,16),s.view.setUint32(u+42,r.offset,!0),s.array.set(r.filename,u+46),s.array.set(r.comment,u+46+r.filename.length),u+=46+r.filename.length+r.comment.length;s.view.setUint32(u,1347093766),s.view.setUint16(u+8,a.length,!0),s.view.setUint16(u+10,a.length,!0),s.view.setUint32(u+12,o,!0),s.view.setUint32(u+16,h,!0),e.writeUint8Array(s.array,(function(){e.getData(t)}),p)},_worker:null};t.zip.useWebWorkers?A("deflater",(function(t){d._worker=t,s(d)}),(function(t){i(t)})):s(d)}a.prototype.append=function(t){for(var e=0|this.crc,s=this.table,i=0,r=0|t.length;i<r;i++)e=e>>>8^s[255&(e^t[i])];this.crc=e},a.prototype.get=function(){return~this.crc},a.prototype.table=function(){var t,e,s,i=[];for(t=0;t<256;t++){for(s=t,e=0;e<8;e++)1&s?s=s>>>1^3988292384:s>>>=1;i[t]=s}return i}(),h.prototype.append=function(t,e){return t},h.prototype.flush=function(){},p.prototype=new u,p.prototype.constructor=p,c.prototype=new u,c.prototype.constructor=c,d.prototype=new u,d.prototype.constructor=d,m.prototype.getData=function(t){t(this.data)},f.prototype=new m,f.prototype.constructor=f,g.prototype=new m,g.prototype.constructor=g,_.prototype=new m,_.prototype.constructor=_;var S={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function A(e,s,i){if(null===t.zip.workerScripts||null===t.zip.workerScriptsPath){var r,o,n;if(t.zip.workerScripts){if(r=t.zip.workerScripts[e],!Array.isArray(r))return void i(new Error("zip.workerScripts."+e+" is not an array!"));o=r,n=document.createElement("a"),r=o.map((function(t){return n.href=t,n.href}))}else(r=S[e].slice(0))[0]=(t.zip.workerScriptsPath||"")+r[0];var a=new Worker(r[0]);a.codecTime=a.crcTime=0,a.postMessage({type:"importScripts",scripts:r.slice(1)}),a.addEventListener("message",(function t(e){var r=e.data;if(r.error)return a.terminate(),void i(r.error);"importScripts"===r.type&&(a.removeEventListener("message",t),a.removeEventListener("error",h),s(a))})),a.addEventListener("error",h)}else i(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function h(t){a.terminate(),i(t)}}function C(t){console.error(t)}t.zip={Reader:u,Writer:m,BlobReader:d,Data64URIReader:c,TextReader:p,BlobWriter:_,Data64URIWriter:g,TextWriter:f,createReader:function(t,e,s){s=s||C,t.init((function(){M(t,e,s)}),s)},createWriter:function(t,e,s,i){s=s||C,i=!!i,t.init((function(){I(t,e,s,i)}),s)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(al);const hl=al.zip;!function(t){var e,s,i=t.Reader,r=t.Writer;try{s=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(t){}function o(t){var e=this;function s(s,i){var r;e.data?s():((r=new XMLHttpRequest).addEventListener("load",(function(){e.size||(e.size=Number(r.getResponseHeader("Content-Length"))||Number(r.response.byteLength)),e.data=new Uint8Array(r.response),s()}),!1),r.addEventListener("error",i,!1),r.open("GET",t),r.responseType="arraybuffer",r.send())}e.size=0,e.init=function(i,r){if(function(t){var e=document.createElement("a");return e.href=t,"http:"===e.protocol||"https:"===e.protocol}(t)){var o=new XMLHttpRequest;o.addEventListener("load",(function(){e.size=Number(o.getResponseHeader("Content-Length")),e.size?i():s(i,r)}),!1),o.addEventListener("error",r,!1),o.open("HEAD",t),o.send()}else s(i,r)},e.readUint8Array=function(t,i,r,o){s((function(){r(new Uint8Array(e.data.subarray(t,t+i)))}),o)}}function n(t){var e=this;e.size=0,e.init=function(s,i){var r=new XMLHttpRequest;r.addEventListener("load",(function(){e.size=Number(r.getResponseHeader("Content-Length")),"bytes"==r.getResponseHeader("Accept-Ranges")?s():i("HTTP Range not supported.")}),!1),r.addEventListener("error",i,!1),r.open("HEAD",t),r.send()},e.readUint8Array=function(e,s,i,r){!function(e,s,i,r){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="arraybuffer",o.setRequestHeader("Range","bytes="+e+"-"+(e+s-1)),o.addEventListener("load",(function(){i(o.response)}),!1),o.addEventListener("error",r,!1),o.send()}(e,s,(function(t){i(new Uint8Array(t))}),r)}}function a(t){var e=this;e.size=0,e.init=function(s,i){e.size=t.byteLength,s()},e.readUint8Array=function(e,s,i,r){i(new Uint8Array(t.slice(e,e+s)))}}function h(){var t,e=this;e.init=function(e,s){t=new Uint8Array,e()},e.writeUint8Array=function(e,s,i){var r=new Uint8Array(t.length+e.length);r.set(t),r.set(e,t.length),t=r,s()},e.getData=function(e){e(t.buffer)}}function l(t,e){var i,r=this;r.init=function(e,s){t.createWriter((function(t){i=t,e()}),s)},r.writeUint8Array=function(t,r,o){var n=new Blob([s?t:t.buffer],{type:e});i.onwrite=function(){i.onwrite=null,r()},i.onerror=o,i.write(n)},r.getData=function(e){t.file(e)}}o.prototype=new i,o.prototype.constructor=o,n.prototype=new i,n.prototype.constructor=n,a.prototype=new i,a.prototype.constructor=a,h.prototype=new r,h.prototype.constructor=h,l.prototype=new r,l.prototype.constructor=l,t.FileWriter=l,t.HttpReader=o,t.HttpRangeReader=n,t.ArrayBufferReader=a,t.ArrayBufferWriter=h,t.fs&&((e=t.fs.ZipDirectoryEntry).prototype.addHttpContent=function(s,i,r){return function(s,i,r,o){if(s.directory)return o?new e(s.fs,i,r,s):new t.fs.ZipFileEntry(s.fs,i,r,s);throw"Parent entry is not a directory."}(this,s,{data:i,Reader:r?n:o})},e.prototype.importHttpContent=function(t,e,s,i){this.importZip(e?new n(t):new o(t),s,i)},t.fs.FS.prototype.importHttpContent=function(t,s,i,r){this.entries=[],this.root=new e(this),this.root.importHttpContent(t,s,i,r)})}(hl);const ll=["4.2"];class ul{constructor(t,e={}){this.supportedSchemas=ll,this._xrayOpacity=.7,this._src=null,this._options=e,this.viewpoint=null,e.workerScriptsPath?(hl.workerScriptsPath=e.workerScriptsPath,this.src=e.src,this.xrayOpacity=.7,this.displayEffect=e.displayEffect,this.createMetaModel=e.createMetaModel):t.error("Config expected: workerScriptsPath")}load(t,e,s,i,r,o){switch(i.materialType){case"MetallicMaterial":e._defaultMaterial=new na(e,{baseColor:[1,1,1],metallic:.6,roughness:.6});break;case"SpecularMaterial":e._defaultMaterial=new la(e,{diffuse:[1,1,1],specular:c.vec3([1,1,1]),glossiness:.5});break;default:e._defaultMaterial=new Se(e,{reflectivity:.75,shiness:100,diffuse:[1,1,1]})}e._wireframeMaterial=new nl(e,{color:[0,0,0],lineWidth:2});var n=e.scene.canvas.spinner;n.processes++,pl(t,e,s,i,(function(){n.processes--,r&&r(),e.fire("loaded",!0,!1)}),(function(t){n.processes--,e.error(t),o&&o(t),e.fire("error",t)}),(function(t){console.log("Error, Will Robinson: "+t)}))}}var pl=function(t,e,s,i,r,o){!function(t,e,s){var i=new vl;i.load(t,(function(){e(i)}),(function(t){s("Error loading ZIP archive: "+t)}))}(s,(function(s){cl(t,s,i,e,r,o)}),o)},cl=function(){return function(e,s,i,r,o){var n={plugin:e,zip:s,edgeThreshold:30,materialType:i.materialType,scene:r.scene,modelNode:r,info:{references:{}},materials:{}};i.createMetaModel&&(n.metaModelData={modelId:r.id,metaObjects:[{name:r.id,type:"Default",id:r.id}]}),r.scene.loading++,function(e,s){e.zip.getFile("Manifest.xml",(function(i,r){for(var o=r.children,n=0,a=o.length;n<a;n++){var h=o[n];if("Manifest"===h.type)t(e,h,s)}}))}(n,(function(){n.metaModelData&&e.viewer.metaScene.createMetaModel(r.id,n.metaModelData),r.scene.loading--,o()}))};function t(t,s,i){for(var r=s.children,o=0,n=r.length;o<n;o++){var a=r[o];if("Root"===a.type){var h=a.children[0];t.zip.getFile(h,(function(s,r){e(t,r,i)}))}}}function e(t,e,i){for(var r=e.children,o=0,n=r.length;o<n;o++){var a=r[o];if("Model_3dxml"===a.type)s(t,a,i)}}function s(t,e,s){for(var r=e.children,a=0,h=r.length;a<h;a++){var l=r[a];switch(l.type){case"Header":i(t,l);break;case"ProductStructure":o(t,l,s);break;case"DefaultView":n(t,l)}}}function i(t,e){for(var s=e.children,i={},o=0,n=s.length;o<n;o++){var a=s[o];switch(a.type){case"SchemaVersion":i.schemaVersion=a.children[0],r(t,i.schemaVersion)||t.plugin.error("Schema version not supported: "+i.schemaVersion+" - supported versions are: "+ll.join(","));break;case"Title":i.title=a.children[0];break;case"Author":i.author=a.children[0];break;case"Created":i.created=a.children[0]}}t.modelNode.meta=i}function r(t,e){for(var s=0,i=ll.length;s<i;s++)if(e===ll[s])return!0;return!1}function o(t,e,s){!function(t,e,s){for(var i={},r=e.children,o=0,n=0,h=r.length;n<h;n++){"ReferenceRep"===(l=r[n]).type&&o++}for(n=0,h=r.length;n<h;n++){var l;if("ReferenceRep"===(l=r[n]).type)if(l.associatedFile){var u=bl(l.associatedFile);!function(){var e=l.id;t.zip.getFile(u,(function(r,n){var h=r.getElementsByTagName("MaterialId");dl(t,h,(function(){var r={id:e};a(t,n,r),i[e]=r,0==--o&&s(i)}))}),(function(t){}))}()}}}(t,e,(function(i){for(var r=e.children,o={},n={},a={},h=0,l=r.length;h<l;h++){var u=r[h];switch(u.type){case"Reference3D":o[u.id]={type:"Reference3D",id:u.id,name:u.name,instance3Ds:{},instanceReps:{}};break;case"InstanceRep":for(var p=0,d=u.children.length;p<d;p++){switch((y=u.children[p]).type){case"IsAggregatedBy":m=y.children[0];break;case"IsInstanceOf":f=y.children[0]}}n[u.id]={type:"InstanceRep",id:u.id,name:u.name,isAggregatedBy:m,isInstanceOf:f,referenceReps:{}};break;case"Instance3D":var m,f,_;for(p=0,d=u.children.length;p<d;p++){var y;switch((y=u.children[p]).type){case"IsAggregatedBy":m=y.children[0];break;case"IsInstanceOf":f=y.children[0];break;case"RelativeMatrix":_=y.children[0]}}a[u.id]={type:"Instance3D",id:u.id,name:u.name,isAggregatedBy:m,isInstanceOf:f,relativeMatrix:_,reference3Ds:{}}}}for(var v in a){(P=o[(b=a[v]).isAggregatedBy])?P.instance3Ds[b.id]=b:alert("foo")}for(var v in a){var b,P=o[(b=a[v]).isInstanceOf];b.reference3Ds[P.id]=P,P.instance3D=b}for(var v in n){var T=i[(w=n[v]).isInstanceOf];T&&(w.referenceReps[T.id]=T)}for(var v in n){var w;(P=o[(w=n[v]).isAggregatedBy])&&(P.instanceReps[w.id]=w)}function x(t,e,s){for(var i in e.instance3Ds)M(t,e.instance3Ds[i],s);for(var i in e.instanceReps)D(t,e.instanceReps[i],s)}function M(t,e,s){if(e.relativeMatrix){var i=g(e.relativeMatrix,12),r=[i[9],i[10],i[11]],o=i.slice(0,9),n=c.mat3ToMat4(o,c.identityMat4()),a=new Qn(t.modelNode,{position:r});t.metaModelData&&t.metaModelData.metaObjects.push({id:a.id,type:"Default",name:e.name,parent:s?s.id:t.modelNode.id}),s?s.addChild(a,!0):t.modelNode.addChild(a,!0),s=a,a=new Qn(t.modelNode,{matrix:n}),t.metaModelData&&t.metaModelData.metaObjects.push({id:a.id,type:"Default",name:e.name,parent:s?s.id:t.modelNode.id}),s.addChild(a,!0),s=a}else{a=new Qn(t.modelNode,{});t.metaModelData&&t.metaModelData.metaObjects.push({id:a.id,type:"Default",name:e.name,parent:s?s.id:t.modelNode.id}),s?s.addChild(a,!0):t.modelNode.addChild(a,!0),s=a}for(var h in e.reference3Ds)x(t,e.reference3Ds[h],s)}function D(t,e,s){if(e.referenceReps)for(var i in e.referenceReps){var r=e.referenceReps[i];for(var o in r)if("id"!==o){var n=r[o],a="lines"===n.geometry.primitive?t.modelNode._wireframeMaterial:n.materialId?t.materials[n.materialId]:null,h=n.color,l=new Os(t.modelNode,{isObject:!0,geometry:n.geometry,material:a||t.modelNode._defaultMaterial,colorize:h,backfaces:!1});t.metaModelData&&t.metaModelData.metaObjects.push({id:l.id,type:"Default",name:e.name,parent:s?s.id:t.modelNode.id}),s?s.addChild(l,!0):t.modelNode.addChild(l,!0),l.colorize=h}}}for(var v in o){if(!(P=o[v]).instance3D)return x(t,P,null),void s()}alert("No root Reference3D element found in this modelNode - can't load."),s()}))}function n(t,e){for(var s=e.children,i=0,r=s.length;i<r;i++){var o=s[i];if("Viewpoint"===o.type){var n=o.children;t.modelNode.viewpoint={};for(var a=0,h=n.length;a<h;a++){var l=n[i];switch(l.type){case"Position":t.modelNode.viewpoint.eye=g(l.children[0],3);break;case"Sight":t.modelNode.viewpoint.look=g(l.children[0],3);break;case"Up":t.modelNode.viewpoint.up=g(l.children[0],3)}}}}}function a(t,e,s){for(var i=e.children,r=0,o=i.length;r<o;r++){var n=i[r];if("XMLRepresentation"===n.type)h(t,n,s)}}function h(t,e,s){for(var i=e.children,r=0,o=i.length;r<o;r++){var n=i[r];if("Root"===n.type)l(t,n,s)}}function l(t,e,s){e["xsi:type"];for(var i=e.children,r=0,o=i.length;r<o;r++){var n=i[r];if("Rep"===n.type)u(t,n,s)}}function u(t,e,s){e["xsi:type"];for(var i={edgeThreshold:t.edgeThreshold||30,compressGeometry:!0},r=e.children,o=0,n=r.length;o<n;o++){var a=r[o];switch(a.type){case"Rep":u(t,a,s);break;case"Edges":break;case"Faces":i.primitive="triangles",p(t,a,i);break;case"VertexBuffer":f(t,a,i);break;case"SurfaceAttributes":_(t,a,i)}}if(i.positions){var h=new xe(t.modelNode,i);s[h.id]={geometry:h,color:i.color||[1,1,1,1],materialId:i.materialId}}}function p(t,e,s){for(var i=e.children,r=0,o=i.length;r<o;r++){var n=i[r];if("Face"===n.type)d(t,n,s)}}function d(t,e,s){var i=e.strips;if(i){var r=function(t){for(var e=t.split(","),s=[],i=0,r=e.length;i<r;i++){var o=e[i].trim();if(o.length>0){for(var n=o.trim().split(" "),a=new Int16Array(n.length),h=0,l=0,u=n.length;l<u;l++)""!==n[l]&&(a[h++]=parseInt(n[l]));s.push(a)}}return s}(i);if(r.length>0){s.primitive="triangles";for(var o=[],n=0,a=r.length;n<a;n++)for(var h=m(r[n]),l=0,u=h.length;l<u;l++)o.push(h[l]);s.indices=o}}else{var p=e.triangles;p&&(s.primitive="triangles",s.indices=function(t){t=t.trim().split(" ");for(var e=new Int32Array(t.length),s=0,i=t.length;s<i;s++){var r=t[s];e[s]=parseInt(r)}return e}(p))}var c=e.children;for(n=0,a=c.length;n<a;n++){var d=c[n];if("SurfaceAttributes"===d.type)_(t,d,s)}}function m(t){for(var e=[],s=0,i=t.length;s<i-2;s++)1&s?(e.push(t[s]),e.push(t[s+2]),e.push(t[s+1])):(e.push(t[s]),e.push(t[s+1]),e.push(t[s+2]));return e}function f(t,e,s){for(var i=e.children,r=0,o=i.length;r<o;r++){var n=i[r];switch(n.type){case"Positions":s.positions=g(n.children[0],3);break;case"Normals":s.normals=g(n.children[0],3);break;case"TextureCoordinates":s.uv=g(n.children[0],2)}}}function g(t,e){t=t.split(",");for(var s=new Float32Array(t.length*e),i=0,r=0,o=t.length;r<o;r++)for(var n=t[r],a=0,h=(n=n.split(" ")).length;a<h;a++)""!==n[a]&&(s[i++]=parseFloat(n[a]));return s}function _(t,e,s){s.color=[1,1,1,1];for(var i,r,o=e.children,n=0,a=o.length;n<a;n++){var h=o[n];switch(h.type){case"Color":s.color[0]=h.red,s.color[1]=h.green,s.color[2]=h.blue,s.color[3]=h.alpha;break;case"MaterialApplication":for(var l=h.children,u=0,p=l.length;u<p;u++){var c=l[u];if("MaterialId"===c.type){var d=(i=c.id,r=void 0,-1!==(r=i.lastIndexOf("#"))?i.substring(r+1):i);t.materials[d]||t.plugin.error("material  not found: "+d),s.materialId=d}}}}}}();function dl(t,e,s){var i={};!function r(o,n){if(o>=e.length)s();else{var a=e[o].id,h=a.lastIndexOf(":");h>0&&(a=a.substring(h+1));var l=a.lastIndexOf("#");l>0&&(a=a.substring(0,l)),i[a]?r(o+1):function(t,e,s){t.zip.getFile(e,(function(e,i){!function(t,e,s){for(var i,r=e.children,o=0,n=r.length;o<n;o++)"Model_3dxml"===(i=r[o]).type&&ml(t,i,s)}(t,i,s)}))}(t,a,(function(){i[a]=!0,r(o+1)}))}}(0)}function ml(t,e,s){for(var i,r=e.children,o=0,n=r.length;o<n;o++)"CATMaterialRef"===(i=r[o]).type&&fl(t,i,s)}function fl(t,e,s){for(var i={},r=e.children,o=0,n=0,a=r.length;n<a;n++){if("MaterialDomainInstance"===(d=r[n]).type){for(var h,l,u=0,p=d.children.length;u<p;u++){var c=d.children[u];switch(c.type){case"IsAggregatedBy":h=c.children[0];break;case"IsInstanceOf":l=c.children[0]}}i[l]=h}}for(n=0,a=r.length;n<a;n++){if("MaterialDomain"===(d=r[n]).type)o++}for(n=0,a=r.length;n<a;n++){var d;if("MaterialDomain"===(d=r[n]).type)d.associatedFile&&function(){var e=d.id,r=bl(d.associatedFile);t.zip.getFile(r,(function(r,n){t.materials[i[e]]=gl(t,n),0==--o&&s()}),(function(t){}))}()}}function gl(t,e){for(var s=e.children,i=0,r=s.length;i<r;i++){var o=s[i];if("Osm"===o.type)return _l(t,o)}}function _l(t,e){for(var s=e.children,i=0,r=s.length;i<r;i++){var o=s[i];switch(o.type){case"RenderingRootFeature":break;case"Feature":if("RenderingFeature"===o.Alias){var n,a,h,l,u={},p={},c=o.children;for(n=0,a=c.length;n<a;n++)switch((h=c[n]).Name){case"AmbientCoef":u.ambient=parseFloat(h.Value);break;case"DiffuseCoef":u.diffuse=parseFloat(h.Value);break;case"EmissiveCoef":u.emissive=parseFloat(h.Value);break;case"SpecularExponent":u.specular=parseFloat(h.Value)}for(n=0,a=c.length;n<a;n++)switch((h=c[n]).Name){case"AmbientColor":p.ambient=yl(h.Value,u.ambient);break;case"DiffuseColor":p.diffuse=yl(h.Value,u.diffuse);break;case"EmissiveColor":p.emissive=yl(h.Value,u.emissive);break;case"SpecularColor":p.specular=yl(h.Value,u.specular);break;case"Transparency":var d=1-parseFloat(h.Value);d<1&&(p.alpha=d,p.alphaMode="blend")}switch(t.materialType){case"MetallicMaterial":l=new na(t.modelNode,{baseColor:p.diffuse,metallic:.7,roughness:.5,emissive:p.emissive,alpha:p.alpha,alphaMode:p.alphaMode});break;case"SpecularMaterial":l=new la(t.modelNode,{diffuse:p.diffuse,specular:p.specular,glossiness:.5,emissive:p.emissive,alpha:p.alpha,alphaMode:p.alphaMode});break;default:l=new Se(t.modelNode,{reflectivity:.5,ambient:p.ambient,diffuse:p.diffuse,specular:p.specular,emissive:p.emissive,alphaMode:p.alphaMode,alpha:e.alpha})}return l}}}}function yl(t,e){e=void 0!==e?e:.5;var s=t.indexOf("["),i=t.indexOf("]");t=(t=t.substring(s+1,i-s)).split(",");for(var r=new Float32Array(t.length),o=0,n=0,a=t.length;n<a;n++)for(var h=t[n],l=0,u=(h=h.trim().split(" ")).length;l<u;l++)""!==h[l]&&(r[o++]=parseFloat(h[l])*e);return r}var vl=function(){var t={};function e(t,s){if(t.nodeType===t.TEXT_NODE){var i=t.nodeValue;if(null===i.match(/^\s+$/))return i}else if(t.nodeType===t.ELEMENT_NODE||t.nodeType===t.DOCUMENT_NODE){var r={type:t.nodeName,children:[]};if(t.nodeType===t.ELEMENT_NODE)for(var o=0;o<t.attributes.length;o++){var n=t.attributes[o];r[s[n.nodeName]||n.nodeName]=n.nodeValue}for(var a=0;a<t.childNodes.length;a++){(o=e(t.childNodes[a],s))&&r.children.push(o)}return r}}this.load=function(e,s,i){hl.createReader(new hl.HttpReader(e),(function(e){e.getEntries((function(e){if(e.length>0)for(var i=0,r=e.length;i<r;i++){var o=e[i];t[o.filename]=o}s()}))}),i)},this.getFile=function(s,i,r){var o=t[s];if(!o){var n="ZIP entry not found: "+s;return console.error(n),void(r&&r(n))}o.getData(new hl.TextWriter,(function(t){var s=(new DOMParser).parseFromString(t,"text/xml"),r=e(s,{});i(s,r)}))},this.destroy=function(){undefined.close((function(){}))}};function bl(t){var e="urn:3DXML:";return 0===t.indexOf(e)?t.substring(e.length):t}class Pl extends n{constructor(t,e={}){super("XML3DLoader",t,e),e.workerScriptsPath?(this._workerScriptsPath=e.workerScriptsPath,this._loader=new ul(this,e),this.supportedSchemas=this._loader.supportedSchemas):this.error("Config expected: workerScriptsPath")}load(t={}){t.workerScriptsPath=this._workerScriptsPath,t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);const e=new Qn(this.viewer.scene,_.apply(t,{isModel:!0})),s=t.src;return s?(this._loader.load(this,e,s,t),e):(this.error("load() param expected: src"),e)}}var Tl=Object.defineProperty,wl=Object.getOwnPropertySymbols,xl=Object.prototype.hasOwnProperty,Ml=Object.prototype.propertyIsEnumerable,Dl=(t,e,s)=>e in t?Tl(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,El=(t,e)=>{for(var s in e||(e={}))xl.call(e,s)&&Dl(t,s,e[s]);if(wl)for(var s of wl(e))Ml.call(e,s)&&Dl(t,s,e[s]);return t},Il=t=>{if("undefined"!=typeof require)return require(t);throw new Error('Dynamic require of "'+t+'" is not supported')},Sl=(t,e)=>function(){return e||(0,t[Object.keys(t)[0]])((e={exports:{}}).exports,e),e.exports},Al=Sl({"(disabled):crypto"(){}}),Cl=Sl({"dist/web-ifc.js"(t,e){var s,i=(s="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,"undefined"!=typeof __filename&&(s=s||__filename),function(t){var e,i,r=void 0!==(t=t||{})?t:{};r.ready=new Promise((function(t,s){e=t,i=s}));var o,n={};for(o in r)r.hasOwnProperty(o)&&(n[o]=r[o]);var a,h,l,u,p="./this.program",c=function(t,e){throw e};a="object"==typeof window,h="function"==typeof importScripts,l="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,u=!a&&!l&&!h;var d,m,f,g,_="";l?(_=h?Il("path").dirname(_)+"/":__dirname+"/",d=function(t,e){return f||(f=Il("fs")),g||(g=Il("path")),t=g.normalize(t),f.readFileSync(t,e?null:"utf8")},m=function(t){var e=d(t,!0);return e.buffer||(e=new Uint8Array(e)),x(e.buffer),e},process.argv.length>1&&(p=process.argv[1].replace(/\\/g,"/")),process.argv.slice(2),process.on("uncaughtException",(function(t){if(!(t instanceof ys))throw t})),process.on("unhandledRejection",rt),c=function(t){process.exit(t)},r.inspect=function(){return"[Emscripten Module object]"}):u?("undefined"!=typeof read&&(d=function(t){return read(t)}),m=function(t){var e;return"function"==typeof readbuffer?new Uint8Array(readbuffer(t)):(x("object"==typeof(e=read(t,"binary"))),e)},"undefined"!=typeof scriptArgs&&scriptArgs,"function"==typeof quit&&(c=function(t){quit(t)}),"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(a||h)&&(h?_=self.location.href:"undefined"!=typeof document&&document.currentScript&&(_=document.currentScript.src),s&&(_=s),_=0!==_.indexOf("blob:")?_.substr(0,_.lastIndexOf("/")+1):"",d=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},h&&(m=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}));var y,v,b,P=r.print||console.log.bind(console),T=r.printErr||console.warn.bind(console);for(o in n)n.hasOwnProperty(o)&&(r[o]=n[o]);n=null,r.arguments&&r.arguments,r.thisProgram&&(p=r.thisProgram),r.quit&&(c=r.quit),r.wasmBinary&&(y=r.wasmBinary),r.noExitRuntime&&(v=r.noExitRuntime),"object"!=typeof WebAssembly&&rt("no native wasm support detected");var w=!1;function x(t,e){t||rt("Assertion failed: "+e)}var M="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function D(t,e,s){for(var i=(e>>>=0)+s,r=e;t[r>>>0]&&!(r>=i);)++r;if(r-e>16&&t.subarray&&M)return M.decode(t.subarray(e>>>0,r>>>0));for(var o="";e<r;){var n=t[e++>>>0];if(128&n){var a=63&t[e++>>>0];if(192!=(224&n)){var h=63&t[e++>>>0];if((n=224==(240&n)?(15&n)<<12|a<<6|h:(7&n)<<18|a<<12|h<<6|63&t[e++>>>0])<65536)o+=String.fromCharCode(n);else{var l=n-65536;o+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else o+=String.fromCharCode((31&n)<<6|a)}else o+=String.fromCharCode(n)}return o}function E(t,e){return(t>>>=0)?D(O,t,e):""}function I(t,e,s,i){if(!(i>0))return 0;for(var r=s>>>=0,o=s+i-1,n=0;n<t.length;++n){var a=t.charCodeAt(n);if(a>=55296&&a<=57343&&(a=65536+((1023&a)<<10)|1023&t.charCodeAt(++n)),a<=127){if(s>=o)break;e[s++>>>0]=a}else if(a<=2047){if(s+1>=o)break;e[s++>>>0]=192|a>>6,e[s++>>>0]=128|63&a}else if(a<=65535){if(s+2>=o)break;e[s++>>>0]=224|a>>12,e[s++>>>0]=128|a>>6&63,e[s++>>>0]=128|63&a}else{if(s+3>=o)break;e[s++>>>0]=240|a>>18,e[s++>>>0]=128|a>>12&63,e[s++>>>0]=128|a>>6&63,e[s++>>>0]=128|63&a}}return e[s>>>0]=0,s-r}function S(t,e,s){return I(t,O,e,s)}function A(t){for(var e=0,s=0;s<t.length;++s){var i=t.charCodeAt(s);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&t.charCodeAt(++s)),i<=127?++e:e+=i<=2047?2:i<=65535?3:4}return e}var C,F,O,R,L,N,B,k,j,G="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function H(t,e){for(var s=t,i=s>>1,r=i+e/2;!(i>=r)&&L[i>>>0];)++i;if((s=i<<1)-t>32&&G)return G.decode(O.subarray(t>>>0,s>>>0));for(var o="",n=0;!(n>=e/2);++n){var a=R[t+2*n>>>1];if(0==a)break;o+=String.fromCharCode(a)}return o}function V(t,e,s){if(void 0===s&&(s=2147483647),s<2)return 0;for(var i=e,r=(s-=2)<2*t.length?s/2:t.length,o=0;o<r;++o){var n=t.charCodeAt(o);R[e>>>1]=n,e+=2}return R[e>>>1]=0,e-i}function z(t){return 2*t.length}function U(t,e){for(var s=0,i="";!(s>=e/4);){var r=N[t+4*s>>>2];if(0==r)break;if(++s,r>=65536){var o=r-65536;i+=String.fromCharCode(55296|o>>10,56320|1023&o)}else i+=String.fromCharCode(r)}return i}function X(t,e,s){if(void 0===s&&(s=2147483647),s<4)return 0;for(var i=e>>>=0,r=i+s-4,o=0;o<t.length;++o){var n=t.charCodeAt(o);if(n>=55296&&n<=57343&&(n=65536+((1023&n)<<10)|1023&t.charCodeAt(++o)),N[e>>>2]=n,(e+=4)+4>r)break}return N[e>>>2]=0,e-i}function W(t){for(var e=0,s=0;s<t.length;++s){var i=t.charCodeAt(s);i>=55296&&i<=57343&&++s,e+=4}return e}function Y(t){C=t,r.HEAP8=F=new Int8Array(t),r.HEAP16=R=new Int16Array(t),r.HEAP32=N=new Int32Array(t),r.HEAPU8=O=new Uint8Array(t),r.HEAPU16=L=new Uint16Array(t),r.HEAPU32=B=new Uint32Array(t),r.HEAPF32=k=new Float32Array(t),r.HEAPF64=j=new Float64Array(t)}var K,Z=r.INITIAL_MEMORY||16777216;(b=r.wasmMemory?r.wasmMemory:new WebAssembly.Memory({initial:Z/65536,maximum:65536}))&&(C=b.buffer),Z=C.byteLength,Y(C);var q=[],$=[],Q=[],J=[],tt=0,et=null;function st(t){tt++,r.monitorRunDependencies&&r.monitorRunDependencies(tt)}function it(t){if(tt--,r.monitorRunDependencies&&r.monitorRunDependencies(tt),0==tt&&et){var e=et;et=null,e()}}function rt(t){r.onAbort&&r.onAbort(t),T(t+=""),w=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.";var e=new WebAssembly.RuntimeError(t);throw i(e),e}function ot(t,e){return String.prototype.startsWith?t.startsWith(e):0===t.indexOf(e)}function nt(t){return ot(t,"data:application/octet-stream;base64,")}function at(t){return ot(t,"file://")}r.preloadedImages={},r.preloadedAudios={};var ht,lt,ut,pt="web-ifc.wasm";function ct(){try{if(y)return new Uint8Array(y);if(m)return m(pt);throw"both async and sync fetching of the wasm failed"}catch(t){rt(t)}}function dt(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var s=e.func;"number"==typeof s?void 0===e.arg?K.get(s)():K.get(s)(e.arg):s(void 0===e.arg?null:e.arg)}else e(r)}}function mt(t,e,s){return-1!=t.indexOf("j")?function(t,e,s){return s&&s.length?r["dynCall_"+t].apply(null,[e].concat(s)):r["dynCall_"+t].call(null,e)}(t,e,s):K.get(e).apply(null,s)}nt(pt)||(ht=pt,pt=r.locateFile?r.locateFile(ht,_):_+ht);var ft=0,gt=4,_t=8,yt=12,vt=13,bt=16;function Pt(t){this.excPtr=t,this.ptr=t-bt,this.set_type=function(t){N[this.ptr+_t>>>2]=t},this.get_type=function(){return N[this.ptr+_t>>>2]},this.set_destructor=function(t){N[this.ptr+ft>>>2]=t},this.get_destructor=function(){return N[this.ptr+ft>>>2]},this.set_refcount=function(t){N[this.ptr+gt>>>2]=t},this.set_caught=function(t){t=t?1:0,F[this.ptr+yt>>>0]=t},this.get_caught=function(){return 0!=F[this.ptr+yt>>>0]},this.set_rethrown=function(t){t=t?1:0,F[this.ptr+vt>>>0]=t},this.get_rethrown=function(){return 0!=F[this.ptr+vt>>>0]},this.init=function(t,e){this.set_type(t),this.set_destructor(e),this.set_refcount(0),this.set_caught(!1),this.set_rethrown(!1)},this.add_ref=function(){var t=N[this.ptr+gt>>>2];N[this.ptr+gt>>>2]=t+1},this.release_ref=function(){var t=N[this.ptr+gt>>>2];return N[this.ptr+gt>>>2]=t-1,1===t}}function Tt(t){return N[_s()>>>2]=t,t}var wt={splitPath:function(t){return/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/.exec(t).slice(1)},normalizeArray:function(t,e){for(var s=0,i=t.length-1;i>=0;i--){var r=t[i];"."===r?t.splice(i,1):".."===r?(t.splice(i,1),s++):s&&(t.splice(i,1),s--)}if(e)for(;s;s--)t.unshift("..");return t},normalize:function(t){var e="/"===t.charAt(0),s="/"===t.substr(-1);return t=wt.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"),t||e||(t="."),t&&s&&(t+="/"),(e?"/":"")+t},dirname:function(t){var e=wt.splitPath(t),s=e[0],i=e[1];return s||i?(i&&(i=i.substr(0,i.length-1)),s+i):"."},basename:function(t){if("/"===t)return"/";var e=(t=(t=wt.normalize(t)).replace(/\/$/,"")).lastIndexOf("/");return-1===e?t:t.substr(e+1)},extname:function(t){return wt.splitPath(t)[3]},join:function(){var t=Array.prototype.slice.call(arguments,0);return wt.normalize(t.join("/"))},join2:function(t,e){return wt.normalize(t+"/"+e)}},xt={resolve:function(){for(var t="",e=!1,s=arguments.length-1;s>=-1&&!e;s--){var i=s>=0?arguments[s]:It.cwd();if("string"!=typeof i)throw new TypeError("Arguments to path.resolve must be strings");if(!i)return"";t=i+"/"+t,e="/"===i.charAt(0)}return t=wt.normalizeArray(t.split("/").filter((function(t){return!!t})),!e).join("/"),(e?"/":"")+t||"."},relative:function(t,e){function s(t){for(var e=0;e<t.length&&""===t[e];e++);for(var s=t.length-1;s>=0&&""===t[s];s--);return e>s?[]:t.slice(e,s-e+1)}t=xt.resolve(t).substr(1),e=xt.resolve(e).substr(1);for(var i=s(t.split("/")),r=s(e.split("/")),o=Math.min(i.length,r.length),n=o,a=0;a<o;a++)if(i[a]!==r[a]){n=a;break}var h=[];for(a=n;a<i.length;a++)h.push("..");return(h=h.concat(r.slice(n))).join("/")}},Mt={ttys:[],init:function(){},shutdown:function(){},register:function(t,e){Mt.ttys[t]={input:[],output:[],ops:e},It.registerDevice(t,Mt.stream_ops)},stream_ops:{open:function(t){var e=Mt.ttys[t.node.rdev];if(!e)throw new It.ErrnoError(43);t.tty=e,t.seekable=!1},close:function(t){t.tty.ops.flush(t.tty)},flush:function(t){t.tty.ops.flush(t.tty)},read:function(t,e,s,i,r){if(!t.tty||!t.tty.ops.get_char)throw new It.ErrnoError(60);for(var o=0,n=0;n<i;n++){var a;try{a=t.tty.ops.get_char(t.tty)}catch(t){throw new It.ErrnoError(29)}if(void 0===a&&0===o)throw new It.ErrnoError(6);if(null==a)break;o++,e[s+n]=a}return o&&(t.node.timestamp=Date.now()),o},write:function(t,e,s,i,r){if(!t.tty||!t.tty.ops.put_char)throw new It.ErrnoError(60);try{for(var o=0;o<i;o++)t.tty.ops.put_char(t.tty,e[s+o])}catch(t){throw new It.ErrnoError(29)}return i&&(t.node.timestamp=Date.now()),o}},default_tty_ops:{get_char:function(t){if(!t.input.length){var e=null;if(l){var s=Buffer.alloc?Buffer.alloc(256):new Buffer(256),i=0;try{i=f.readSync(process.stdin.fd,s,0,256,null)}catch(t){if(-1==t.toString().indexOf("EOF"))throw t;i=0}e=i>0?s.slice(0,i).toString("utf-8"):null}else"undefined"!=typeof window&&"function"==typeof window.prompt?null!==(e=window.prompt("Input: "))&&(e+="\n"):"function"==typeof readline&&null!==(e=readline())&&(e+="\n");if(!e)return null;t.input=us(e,!0)}return t.input.shift()},put_char:function(t,e){null===e||10===e?(P(D(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(P(D(t.output,0)),t.output=[])}},default_tty1_ops:{put_char:function(t,e){null===e||10===e?(T(D(t.output,0)),t.output=[]):0!=e&&t.output.push(e)},flush:function(t){t.output&&t.output.length>0&&(T(D(t.output,0)),t.output=[])}}};function Dt(t){for(var e=function(t,e){return e||(e=16),Math.ceil(t/e)*e}(t,16384),s=ds(e);t<e;)F[s+t++>>>0]=0;return s}var Et={ops_table:null,mount:function(t){return Et.createNode(null,"/",16895,0)},createNode:function(t,e,s,i){if(It.isBlkdev(s)||It.isFIFO(s))throw new It.ErrnoError(63);Et.ops_table||(Et.ops_table={dir:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr,lookup:Et.node_ops.lookup,mknod:Et.node_ops.mknod,rename:Et.node_ops.rename,unlink:Et.node_ops.unlink,rmdir:Et.node_ops.rmdir,readdir:Et.node_ops.readdir,symlink:Et.node_ops.symlink},stream:{llseek:Et.stream_ops.llseek}},file:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr},stream:{llseek:Et.stream_ops.llseek,read:Et.stream_ops.read,write:Et.stream_ops.write,allocate:Et.stream_ops.allocate,mmap:Et.stream_ops.mmap,msync:Et.stream_ops.msync}},link:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr,readlink:Et.node_ops.readlink},stream:{}},chrdev:{node:{getattr:Et.node_ops.getattr,setattr:Et.node_ops.setattr},stream:It.chrdev_stream_ops}});var r=It.createNode(t,e,s,i);return It.isDir(r.mode)?(r.node_ops=Et.ops_table.dir.node,r.stream_ops=Et.ops_table.dir.stream,r.contents={}):It.isFile(r.mode)?(r.node_ops=Et.ops_table.file.node,r.stream_ops=Et.ops_table.file.stream,r.usedBytes=0,r.contents=null):It.isLink(r.mode)?(r.node_ops=Et.ops_table.link.node,r.stream_ops=Et.ops_table.link.stream):It.isChrdev(r.mode)&&(r.node_ops=Et.ops_table.chrdev.node,r.stream_ops=Et.ops_table.chrdev.stream),r.timestamp=Date.now(),t&&(t.contents[e]=r),r},getFileDataAsRegularArray:function(t){if(t.contents&&t.contents.subarray){for(var e=[],s=0;s<t.usedBytes;++s)e.push(t.contents[s]);return e}return t.contents},getFileDataAsTypedArray:function(t){return t.contents?t.contents.subarray?t.contents.subarray(0,t.usedBytes):new Uint8Array(t.contents):new Uint8Array(0)},expandFileStorage:function(t,e){e>>>=0;var s=t.contents?t.contents.length:0;if(!(s>=e)){e=Math.max(e,s*(s<1048576?2:1.125)>>>0),0!=s&&(e=Math.max(e,256));var i=t.contents;t.contents=new Uint8Array(e),t.usedBytes>0&&t.contents.set(i.subarray(0,t.usedBytes),0)}},resizeFileStorage:function(t,e){if(e>>>=0,t.usedBytes!=e){if(0==e)return t.contents=null,void(t.usedBytes=0);if(!t.contents||t.contents.subarray){var s=t.contents;return t.contents=new Uint8Array(e),s&&t.contents.set(s.subarray(0,Math.min(e,t.usedBytes))),void(t.usedBytes=e)}if(t.contents||(t.contents=[]),t.contents.length>e)t.contents.length=e;else for(;t.contents.length<e;)t.contents.push(0);t.usedBytes=e}},node_ops:{getattr:function(t){var e={};return e.dev=It.isChrdev(t.mode)?t.id:1,e.ino=t.id,e.mode=t.mode,e.nlink=1,e.uid=0,e.gid=0,e.rdev=t.rdev,It.isDir(t.mode)?e.size=4096:It.isFile(t.mode)?e.size=t.usedBytes:It.isLink(t.mode)?e.size=t.link.length:e.size=0,e.atime=new Date(t.timestamp),e.mtime=new Date(t.timestamp),e.ctime=new Date(t.timestamp),e.blksize=4096,e.blocks=Math.ceil(e.size/e.blksize),e},setattr:function(t,e){void 0!==e.mode&&(t.mode=e.mode),void 0!==e.timestamp&&(t.timestamp=e.timestamp),void 0!==e.size&&Et.resizeFileStorage(t,e.size)},lookup:function(t,e){throw It.genericErrors[44]},mknod:function(t,e,s,i){return Et.createNode(t,e,s,i)},rename:function(t,e,s){if(It.isDir(t.mode)){var i;try{i=It.lookupNode(e,s)}catch(t){}if(i)for(var r in i.contents)throw new It.ErrnoError(55)}delete t.parent.contents[t.name],t.name=s,e.contents[s]=t,t.parent=e},unlink:function(t,e){delete t.contents[e]},rmdir:function(t,e){var s=It.lookupNode(t,e);for(var i in s.contents)throw new It.ErrnoError(55);delete t.contents[e]},readdir:function(t){var e=[".",".."];for(var s in t.contents)t.contents.hasOwnProperty(s)&&e.push(s);return e},symlink:function(t,e,s){var i=Et.createNode(t,e,41471,0);return i.link=s,i},readlink:function(t){if(!It.isLink(t.mode))throw new It.ErrnoError(28);return t.link}},stream_ops:{read:function(t,e,s,i,r){var o=t.node.contents;if(r>=t.node.usedBytes)return 0;var n=Math.min(t.node.usedBytes-r,i);if(n>8&&o.subarray)e.set(o.subarray(r,r+n),s);else for(var a=0;a<n;a++)e[s+a]=o[r+a];return n},write:function(t,e,s,i,r,o){if(e.buffer===F.buffer&&(o=!1),!i)return 0;var n=t.node;if(n.timestamp=Date.now(),e.subarray&&(!n.contents||n.contents.subarray)){if(o)return n.contents=e.subarray(s,s+i),n.usedBytes=i,i;if(0===n.usedBytes&&0===r)return n.contents=e.slice(s,s+i),n.usedBytes=i,i;if(r+i<=n.usedBytes)return n.contents.set(e.subarray(s,s+i),r),i}if(Et.expandFileStorage(n,r+i),n.contents.subarray&&e.subarray)n.contents.set(e.subarray(s,s+i),r);else for(var a=0;a<i;a++)n.contents[r+a]=e[s+a];return n.usedBytes=Math.max(n.usedBytes,r+i),i},llseek:function(t,e,s){var i=e;if(1===s?i+=t.position:2===s&&It.isFile(t.node.mode)&&(i+=t.node.usedBytes),i<0)throw new It.ErrnoError(28);return i},allocate:function(t,e,s){Et.expandFileStorage(t.node,e+s),t.node.usedBytes=Math.max(t.node.usedBytes,e+s)},mmap:function(t,e,s,i,r,o){if(x(0===e),!It.isFile(t.node.mode))throw new It.ErrnoError(43);var n,a,h=t.node.contents;if(2&o||h.buffer!==C){if((i>0||i+s<h.length)&&(h=h.subarray?h.subarray(i,i+s):Array.prototype.slice.call(h,i,i+s)),a=!0,!(n=Dt(s)))throw new It.ErrnoError(48);n>>>=0,F.set(h,n>>>0)}else a=!1,n=h.byteOffset;return{ptr:n,allocated:a}},msync:function(t,e,s,i,r){if(!It.isFile(t.node.mode))throw new It.ErrnoError(43);return 2&r||Et.stream_ops.write(t,e,0,i,s,!1),0}}},It={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,trackingDelegate:{},tracking:{openFlags:{READ:1,WRITE:2}},ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:function(t,e){if(e=e||{},!(t=xt.resolve(It.cwd(),t)))return{path:"",node:null};var s={follow_mount:!0,recurse_count:0};for(var i in s)void 0===e[i]&&(e[i]=s[i]);if(e.recurse_count>8)throw new It.ErrnoError(32);for(var r=wt.normalizeArray(t.split("/").filter((function(t){return!!t})),!1),o=It.root,n="/",a=0;a<r.length;a++){var h=a===r.length-1;if(h&&e.parent)break;if(o=It.lookupNode(o,r[a]),n=wt.join2(n,r[a]),It.isMountpoint(o)&&(!h||h&&e.follow_mount)&&(o=o.mounted.root),!h||e.follow)for(var l=0;It.isLink(o.mode);){var u=It.readlink(n);if(n=xt.resolve(wt.dirname(n),u),o=It.lookupPath(n,{recurse_count:e.recurse_count}).node,l++>40)throw new It.ErrnoError(32)}}return{path:n,node:o}},getPath:function(t){for(var e;;){if(It.isRoot(t)){var s=t.mount.mountpoint;return e?"/"!==s[s.length-1]?s+"/"+e:s+e:s}e=e?t.name+"/"+e:t.name,t=t.parent}},hashName:function(t,e){for(var s=0,i=0;i<e.length;i++)s=(s<<5)-s+e.charCodeAt(i)|0;return(t+s>>>0)%It.nameTable.length},hashAddNode:function(t){var e=It.hashName(t.parent.id,t.name);t.name_next=It.nameTable[e],It.nameTable[e]=t},hashRemoveNode:function(t){var e=It.hashName(t.parent.id,t.name);if(It.nameTable[e]===t)It.nameTable[e]=t.name_next;else for(var s=It.nameTable[e];s;){if(s.name_next===t){s.name_next=t.name_next;break}s=s.name_next}},lookupNode:function(t,e){var s=It.mayLookup(t);if(s)throw new It.ErrnoError(s,t);for(var i=It.hashName(t.id,e),r=It.nameTable[i];r;r=r.name_next){var o=r.name;if(r.parent.id===t.id&&o===e)return r}return It.lookup(t,e)},createNode:function(t,e,s,i){var r=new It.FSNode(t,e,s,i);return It.hashAddNode(r),r},destroyNode:function(t){It.hashRemoveNode(t)},isRoot:function(t){return t===t.parent},isMountpoint:function(t){return!!t.mounted},isFile:function(t){return 32768==(61440&t)},isDir:function(t){return 16384==(61440&t)},isLink:function(t){return 40960==(61440&t)},isChrdev:function(t){return 8192==(61440&t)},isBlkdev:function(t){return 24576==(61440&t)},isFIFO:function(t){return 4096==(61440&t)},isSocket:function(t){return 49152==(49152&t)},flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:function(t){var e=It.flagModes[t];if(void 0===e)throw new Error("Unknown file open mode: "+t);return e},flagsToPermissionString:function(t){var e=["r","w","rw"][3&t];return 512&t&&(e+="w"),e},nodePermissions:function(t,e){return It.ignorePermissions||(-1===e.indexOf("r")||292&t.mode)&&(-1===e.indexOf("w")||146&t.mode)&&(-1===e.indexOf("x")||73&t.mode)?0:2},mayLookup:function(t){var e=It.nodePermissions(t,"x");return e||(t.node_ops.lookup?0:2)},mayCreate:function(t,e){try{return It.lookupNode(t,e),20}catch(t){}return It.nodePermissions(t,"wx")},mayDelete:function(t,e,s){var i;try{i=It.lookupNode(t,e)}catch(t){return t.errno}var r=It.nodePermissions(t,"wx");if(r)return r;if(s){if(!It.isDir(i.mode))return 54;if(It.isRoot(i)||It.getPath(i)===It.cwd())return 10}else if(It.isDir(i.mode))return 31;return 0},mayOpen:function(t,e){return t?It.isLink(t.mode)?32:It.isDir(t.mode)&&("r"!==It.flagsToPermissionString(e)||512&e)?31:It.nodePermissions(t,It.flagsToPermissionString(e)):44},MAX_OPEN_FDS:4096,nextfd:function(t,e){t=t||0,e=e||It.MAX_OPEN_FDS;for(var s=t;s<=e;s++)if(!It.streams[s])return s;throw new It.ErrnoError(33)},getStream:function(t){return It.streams[t]},createStream:function(t,e,s){It.FSStream||(It.FSStream=function(){},It.FSStream.prototype={object:{get:function(){return this.node},set:function(t){this.node=t}},isRead:{get:function(){return 1!=(2097155&this.flags)}},isWrite:{get:function(){return 0!=(2097155&this.flags)}},isAppend:{get:function(){return 1024&this.flags}}});var i=new It.FSStream;for(var r in t)i[r]=t[r];t=i;var o=It.nextfd(e,s);return t.fd=o,It.streams[o]=t,t},closeStream:function(t){It.streams[t]=null},chrdev_stream_ops:{open:function(t){var e=It.getDevice(t.node.rdev);t.stream_ops=e.stream_ops,t.stream_ops.open&&t.stream_ops.open(t)},llseek:function(){throw new It.ErrnoError(70)}},major:function(t){return t>>8},minor:function(t){return 255&t},makedev:function(t,e){return t<<8|e},registerDevice:function(t,e){It.devices[t]={stream_ops:e}},getDevice:function(t){return It.devices[t]},getMounts:function(t){for(var e=[],s=[t];s.length;){var i=s.pop();e.push(i),s.push.apply(s,i.mounts)}return e},syncfs:function(t,e){"function"==typeof t&&(e=t,t=!1),It.syncFSRequests++,It.syncFSRequests>1&&T("warning: "+It.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var s=It.getMounts(It.root.mount),i=0;function r(t){return It.syncFSRequests--,e(t)}function o(t){if(t)return o.errored?void 0:(o.errored=!0,r(t));++i>=s.length&&r(null)}s.forEach((function(e){if(!e.type.syncfs)return o(null);e.type.syncfs(e,t,o)}))},mount:function(t,e,s){var i,r="/"===s,o=!s;if(r&&It.root)throw new It.ErrnoError(10);if(!r&&!o){var n=It.lookupPath(s,{follow_mount:!1});if(s=n.path,i=n.node,It.isMountpoint(i))throw new It.ErrnoError(10);if(!It.isDir(i.mode))throw new It.ErrnoError(54)}var a={type:t,opts:e,mountpoint:s,mounts:[]},h=t.mount(a);return h.mount=a,a.root=h,r?It.root=h:i&&(i.mounted=a,i.mount&&i.mount.mounts.push(a)),h},unmount:function(t){var e=It.lookupPath(t,{follow_mount:!1});if(!It.isMountpoint(e.node))throw new It.ErrnoError(28);var s=e.node,i=s.mounted,r=It.getMounts(i);Object.keys(It.nameTable).forEach((function(t){for(var e=It.nameTable[t];e;){var s=e.name_next;-1!==r.indexOf(e.mount)&&It.destroyNode(e),e=s}})),s.mounted=null;var o=s.mount.mounts.indexOf(i);s.mount.mounts.splice(o,1)},lookup:function(t,e){return t.node_ops.lookup(t,e)},mknod:function(t,e,s){var i=It.lookupPath(t,{parent:!0}).node,r=wt.basename(t);if(!r||"."===r||".."===r)throw new It.ErrnoError(28);var o=It.mayCreate(i,r);if(o)throw new It.ErrnoError(o);if(!i.node_ops.mknod)throw new It.ErrnoError(63);return i.node_ops.mknod(i,r,e,s)},create:function(t,e){return e=void 0!==e?e:438,e&=4095,e|=32768,It.mknod(t,e,0)},mkdir:function(t,e){return e=void 0!==e?e:511,e&=1023,e|=16384,It.mknod(t,e,0)},mkdirTree:function(t,e){for(var s=t.split("/"),i="",r=0;r<s.length;++r)if(s[r]){i+="/"+s[r];try{It.mkdir(i,e)}catch(t){if(20!=t.errno)throw t}}},mkdev:function(t,e,s){return void 0===s&&(s=e,e=438),e|=8192,It.mknod(t,e,s)},symlink:function(t,e){if(!xt.resolve(t))throw new It.ErrnoError(44);var s=It.lookupPath(e,{parent:!0}).node;if(!s)throw new It.ErrnoError(44);var i=wt.basename(e),r=It.mayCreate(s,i);if(r)throw new It.ErrnoError(r);if(!s.node_ops.symlink)throw new It.ErrnoError(63);return s.node_ops.symlink(s,i,t)},rename:function(t,e){var s,i,r=wt.dirname(t),o=wt.dirname(e),n=wt.basename(t),a=wt.basename(e);if(s=It.lookupPath(t,{parent:!0}).node,i=It.lookupPath(e,{parent:!0}).node,!s||!i)throw new It.ErrnoError(44);if(s.mount!==i.mount)throw new It.ErrnoError(75);var h,l=It.lookupNode(s,n),u=xt.relative(t,o);if("."!==u.charAt(0))throw new It.ErrnoError(28);if("."!==(u=xt.relative(e,r)).charAt(0))throw new It.ErrnoError(55);try{h=It.lookupNode(i,a)}catch(t){}if(l!==h){var p=It.isDir(l.mode),c=It.mayDelete(s,n,p);if(c)throw new It.ErrnoError(c);if(c=h?It.mayDelete(i,a,p):It.mayCreate(i,a))throw new It.ErrnoError(c);if(!s.node_ops.rename)throw new It.ErrnoError(63);if(It.isMountpoint(l)||h&&It.isMountpoint(h))throw new It.ErrnoError(10);if(i!==s&&(c=It.nodePermissions(s,"w")))throw new It.ErrnoError(c);try{It.trackingDelegate.willMovePath&&It.trackingDelegate.willMovePath(t,e)}catch(s){T("FS.trackingDelegate['willMovePath']('"+t+"', '"+e+"') threw an exception: "+s.message)}It.hashRemoveNode(l);try{s.node_ops.rename(l,i,a)}catch(t){throw t}finally{It.hashAddNode(l)}try{It.trackingDelegate.onMovePath&&It.trackingDelegate.onMovePath(t,e)}catch(s){T("FS.trackingDelegate['onMovePath']('"+t+"', '"+e+"') threw an exception: "+s.message)}}},rmdir:function(t){var e=It.lookupPath(t,{parent:!0}).node,s=wt.basename(t),i=It.lookupNode(e,s),r=It.mayDelete(e,s,!0);if(r)throw new It.ErrnoError(r);if(!e.node_ops.rmdir)throw new It.ErrnoError(63);if(It.isMountpoint(i))throw new It.ErrnoError(10);try{It.trackingDelegate.willDeletePath&&It.trackingDelegate.willDeletePath(t)}catch(e){T("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.rmdir(e,s),It.destroyNode(i);try{It.trackingDelegate.onDeletePath&&It.trackingDelegate.onDeletePath(t)}catch(e){T("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readdir:function(t){var e=It.lookupPath(t,{follow:!0}).node;if(!e.node_ops.readdir)throw new It.ErrnoError(54);return e.node_ops.readdir(e)},unlink:function(t){var e=It.lookupPath(t,{parent:!0}).node,s=wt.basename(t),i=It.lookupNode(e,s),r=It.mayDelete(e,s,!1);if(r)throw new It.ErrnoError(r);if(!e.node_ops.unlink)throw new It.ErrnoError(63);if(It.isMountpoint(i))throw new It.ErrnoError(10);try{It.trackingDelegate.willDeletePath&&It.trackingDelegate.willDeletePath(t)}catch(e){T("FS.trackingDelegate['willDeletePath']('"+t+"') threw an exception: "+e.message)}e.node_ops.unlink(e,s),It.destroyNode(i);try{It.trackingDelegate.onDeletePath&&It.trackingDelegate.onDeletePath(t)}catch(e){T("FS.trackingDelegate['onDeletePath']('"+t+"') threw an exception: "+e.message)}},readlink:function(t){var e=It.lookupPath(t).node;if(!e)throw new It.ErrnoError(44);if(!e.node_ops.readlink)throw new It.ErrnoError(28);return xt.resolve(It.getPath(e.parent),e.node_ops.readlink(e))},stat:function(t,e){var s=It.lookupPath(t,{follow:!e}).node;if(!s)throw new It.ErrnoError(44);if(!s.node_ops.getattr)throw new It.ErrnoError(63);return s.node_ops.getattr(s)},lstat:function(t){return It.stat(t,!0)},chmod:function(t,e,s){var i;if(!(i="string"==typeof t?It.lookupPath(t,{follow:!s}).node:t).node_ops.setattr)throw new It.ErrnoError(63);i.node_ops.setattr(i,{mode:4095&e|-4096&i.mode,timestamp:Date.now()})},lchmod:function(t,e){It.chmod(t,e,!0)},fchmod:function(t,e){var s=It.getStream(t);if(!s)throw new It.ErrnoError(8);It.chmod(s.node,e)},chown:function(t,e,s,i){var r;if(!(r="string"==typeof t?It.lookupPath(t,{follow:!i}).node:t).node_ops.setattr)throw new It.ErrnoError(63);r.node_ops.setattr(r,{timestamp:Date.now()})},lchown:function(t,e,s){It.chown(t,e,s,!0)},fchown:function(t,e,s){var i=It.getStream(t);if(!i)throw new It.ErrnoError(8);It.chown(i.node,e,s)},truncate:function(t,e){if(e<0)throw new It.ErrnoError(28);var s;if(!(s="string"==typeof t?It.lookupPath(t,{follow:!0}).node:t).node_ops.setattr)throw new It.ErrnoError(63);if(It.isDir(s.mode))throw new It.ErrnoError(31);if(!It.isFile(s.mode))throw new It.ErrnoError(28);var i=It.nodePermissions(s,"w");if(i)throw new It.ErrnoError(i);s.node_ops.setattr(s,{size:e,timestamp:Date.now()})},ftruncate:function(t,e){var s=It.getStream(t);if(!s)throw new It.ErrnoError(8);if(0==(2097155&s.flags))throw new It.ErrnoError(28);It.truncate(s.node,e)},utime:function(t,e,s){var i=It.lookupPath(t,{follow:!0}).node;i.node_ops.setattr(i,{timestamp:Math.max(e,s)})},open:function(t,e,s,i,o){if(""===t)throw new It.ErrnoError(44);var n;if(s=void 0===s?438:s,s=64&(e="string"==typeof e?It.modeStringToFlags(e):e)?4095&s|32768:0,"object"==typeof t)n=t;else{t=wt.normalize(t);try{n=It.lookupPath(t,{follow:!(131072&e)}).node}catch(t){}}var a=!1;if(64&e)if(n){if(128&e)throw new It.ErrnoError(20)}else n=It.mknod(t,s,0),a=!0;if(!n)throw new It.ErrnoError(44);if(It.isChrdev(n.mode)&&(e&=-513),65536&e&&!It.isDir(n.mode))throw new It.ErrnoError(54);if(!a){var h=It.mayOpen(n,e);if(h)throw new It.ErrnoError(h)}512&e&&It.truncate(n,0),e&=-131713;var l=It.createStream({node:n,path:It.getPath(n),flags:e,seekable:!0,position:0,stream_ops:n.stream_ops,ungotten:[],error:!1},i,o);l.stream_ops.open&&l.stream_ops.open(l),!r.logReadFiles||1&e||(It.readFiles||(It.readFiles={}),t in It.readFiles||(It.readFiles[t]=1,T("FS.trackingDelegate error on read file: "+t)));try{if(It.trackingDelegate.onOpenFile){var u=0;1!=(2097155&e)&&(u|=It.tracking.openFlags.READ),0!=(2097155&e)&&(u|=It.tracking.openFlags.WRITE),It.trackingDelegate.onOpenFile(t,u)}}catch(e){T("FS.trackingDelegate['onOpenFile']('"+t+"', flags) threw an exception: "+e.message)}return l},close:function(t){if(It.isClosed(t))throw new It.ErrnoError(8);t.getdents&&(t.getdents=null);try{t.stream_ops.close&&t.stream_ops.close(t)}catch(t){throw t}finally{It.closeStream(t.fd)}t.fd=null},isClosed:function(t){return null===t.fd},llseek:function(t,e,s){if(It.isClosed(t))throw new It.ErrnoError(8);if(!t.seekable||!t.stream_ops.llseek)throw new It.ErrnoError(70);if(0!=s&&1!=s&&2!=s)throw new It.ErrnoError(28);return t.position=t.stream_ops.llseek(t,e,s),t.ungotten=[],t.position},read:function(t,e,s,i,r){if(s>>>=0,i<0||r<0)throw new It.ErrnoError(28);if(It.isClosed(t))throw new It.ErrnoError(8);if(1==(2097155&t.flags))throw new It.ErrnoError(8);if(It.isDir(t.node.mode))throw new It.ErrnoError(31);if(!t.stream_ops.read)throw new It.ErrnoError(28);var o=void 0!==r;if(o){if(!t.seekable)throw new It.ErrnoError(70)}else r=t.position;var n=t.stream_ops.read(t,e,s,i,r);return o||(t.position+=n),n},write:function(t,e,s,i,r,o){if(s>>>=0,i<0||r<0)throw new It.ErrnoError(28);if(It.isClosed(t))throw new It.ErrnoError(8);if(0==(2097155&t.flags))throw new It.ErrnoError(8);if(It.isDir(t.node.mode))throw new It.ErrnoError(31);if(!t.stream_ops.write)throw new It.ErrnoError(28);t.seekable&&1024&t.flags&&It.llseek(t,0,2);var n=void 0!==r;if(n){if(!t.seekable)throw new It.ErrnoError(70)}else r=t.position;var a=t.stream_ops.write(t,e,s,i,r,o);n||(t.position+=a);try{t.path&&It.trackingDelegate.onWriteToFile&&It.trackingDelegate.onWriteToFile(t.path)}catch(e){T("FS.trackingDelegate['onWriteToFile']('"+t.path+"') threw an exception: "+e.message)}return a},allocate:function(t,e,s){if(It.isClosed(t))throw new It.ErrnoError(8);if(e<0||s<=0)throw new It.ErrnoError(28);if(0==(2097155&t.flags))throw new It.ErrnoError(8);if(!It.isFile(t.node.mode)&&!It.isDir(t.node.mode))throw new It.ErrnoError(43);if(!t.stream_ops.allocate)throw new It.ErrnoError(138);t.stream_ops.allocate(t,e,s)},mmap:function(t,e,s,i,r,o){if(e>>>=0,0!=(2&r)&&0==(2&o)&&2!=(2097155&t.flags))throw new It.ErrnoError(2);if(1==(2097155&t.flags))throw new It.ErrnoError(2);if(!t.stream_ops.mmap)throw new It.ErrnoError(43);return t.stream_ops.mmap(t,e,s,i,r,o)},msync:function(t,e,s,i,r){return s>>>=0,t&&t.stream_ops.msync?t.stream_ops.msync(t,e,s,i,r):0},munmap:function(t){return 0},ioctl:function(t,e,s){if(!t.stream_ops.ioctl)throw new It.ErrnoError(59);return t.stream_ops.ioctl(t,e,s)},readFile:function(t,e){if((e=e||{}).flags=e.flags||0,e.encoding=e.encoding||"binary","utf8"!==e.encoding&&"binary"!==e.encoding)throw new Error('Invalid encoding type "'+e.encoding+'"');var s,i=It.open(t,e.flags),r=It.stat(t).size,o=new Uint8Array(r);return It.read(i,o,0,r,0),"utf8"===e.encoding?s=D(o,0):"binary"===e.encoding&&(s=o),It.close(i),s},writeFile:function(t,e,s){(s=s||{}).flags=s.flags||577;var i=It.open(t,s.flags,s.mode);if("string"==typeof e){var r=new Uint8Array(A(e)+1),o=I(e,r,0,r.length);It.write(i,r,0,o,void 0,s.canOwn)}else{if(!ArrayBuffer.isView(e))throw new Error("Unsupported data type");It.write(i,e,0,e.byteLength,void 0,s.canOwn)}It.close(i)},cwd:function(){return It.currentPath},chdir:function(t){var e=It.lookupPath(t,{follow:!0});if(null===e.node)throw new It.ErrnoError(44);if(!It.isDir(e.node.mode))throw new It.ErrnoError(54);var s=It.nodePermissions(e.node,"x");if(s)throw new It.ErrnoError(s);It.currentPath=e.path},createDefaultDirectories:function(){It.mkdir("/tmp"),It.mkdir("/home"),It.mkdir("/home/web_user")},createDefaultDevices:function(){It.mkdir("/dev"),It.registerDevice(It.makedev(1,3),{read:function(){return 0},write:function(t,e,s,i,r){return i}}),It.mkdev("/dev/null",It.makedev(1,3)),Mt.register(It.makedev(5,0),Mt.default_tty_ops),Mt.register(It.makedev(6,0),Mt.default_tty1_ops),It.mkdev("/dev/tty",It.makedev(5,0)),It.mkdev("/dev/tty1",It.makedev(6,0));var t=function(){if("object"==typeof crypto&&"function"==typeof crypto.getRandomValues){var t=new Uint8Array(1);return function(){return crypto.getRandomValues(t),t[0]}}if(l)try{var e=Al();return function(){return e.randomBytes(1)[0]}}catch(t){}return function(){rt("randomDevice")}}();It.createDevice("/dev","random",t),It.createDevice("/dev","urandom",t),It.mkdir("/dev/shm"),It.mkdir("/dev/shm/tmp")},createSpecialDirectories:function(){It.mkdir("/proc"),It.mkdir("/proc/self"),It.mkdir("/proc/self/fd"),It.mount({mount:function(){var t=It.createNode("/proc/self","fd",16895,73);return t.node_ops={lookup:function(t,e){var s=+e,i=It.getStream(s);if(!i)throw new It.ErrnoError(8);var r={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:function(){return i.path}}};return r.parent=r,r}},t}},{},"/proc/self/fd")},createStandardStreams:function(){r.stdin?It.createDevice("/dev","stdin",r.stdin):It.symlink("/dev/tty","/dev/stdin"),r.stdout?It.createDevice("/dev","stdout",null,r.stdout):It.symlink("/dev/tty","/dev/stdout"),r.stderr?It.createDevice("/dev","stderr",null,r.stderr):It.symlink("/dev/tty1","/dev/stderr"),It.open("/dev/stdin",0),It.open("/dev/stdout",1),It.open("/dev/stderr",1)},ensureErrnoError:function(){It.ErrnoError||(It.ErrnoError=function(t,e){this.node=e,this.setErrno=function(t){this.errno=t},this.setErrno(t),this.message="FS error"},It.ErrnoError.prototype=new Error,It.ErrnoError.prototype.constructor=It.ErrnoError,[44].forEach((function(t){It.genericErrors[t]=new It.ErrnoError(t),It.genericErrors[t].stack="<generic error, no stack>"})))},staticInit:function(){It.ensureErrnoError(),It.nameTable=new Array(4096),It.mount(Et,{},"/"),It.createDefaultDirectories(),It.createDefaultDevices(),It.createSpecialDirectories(),It.filesystems={MEMFS:Et}},init:function(t,e,s){It.init.initialized=!0,It.ensureErrnoError(),r.stdin=t||r.stdin,r.stdout=e||r.stdout,r.stderr=s||r.stderr,It.createStandardStreams()},quit:function(){It.init.initialized=!1;var t=r._fflush;t&&t(0);for(var e=0;e<It.streams.length;e++){var s=It.streams[e];s&&It.close(s)}},getMode:function(t,e){var s=0;return t&&(s|=365),e&&(s|=146),s},findObject:function(t,e){var s=It.analyzePath(t,e);return s.exists?s.object:null},analyzePath:function(t,e){try{t=(i=It.lookupPath(t,{follow:!e})).path}catch(t){}var s={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var i=It.lookupPath(t,{parent:!0});s.parentExists=!0,s.parentPath=i.path,s.parentObject=i.node,s.name=wt.basename(t),i=It.lookupPath(t,{follow:!e}),s.exists=!0,s.path=i.path,s.object=i.node,s.name=i.node.name,s.isRoot="/"===i.path}catch(t){s.error=t.errno}return s},createPath:function(t,e,s,i){t="string"==typeof t?t:It.getPath(t);for(var r=e.split("/").reverse();r.length;){var o=r.pop();if(o){var n=wt.join2(t,o);try{It.mkdir(n)}catch(t){}t=n}}return n},createFile:function(t,e,s,i,r){var o=wt.join2("string"==typeof t?t:It.getPath(t),e),n=It.getMode(i,r);return It.create(o,n)},createDataFile:function(t,e,s,i,r,o){var n=e?wt.join2("string"==typeof t?t:It.getPath(t),e):t,a=It.getMode(i,r),h=It.create(n,a);if(s){if("string"==typeof s){for(var l=new Array(s.length),u=0,p=s.length;u<p;++u)l[u]=s.charCodeAt(u);s=l}It.chmod(h,146|a);var c=It.open(h,577);It.write(c,s,0,s.length,0,o),It.close(c),It.chmod(h,a)}return h},createDevice:function(t,e,s,i){var r=wt.join2("string"==typeof t?t:It.getPath(t),e),o=It.getMode(!!s,!!i);It.createDevice.major||(It.createDevice.major=64);var n=It.makedev(It.createDevice.major++,0);return It.registerDevice(n,{open:function(t){t.seekable=!1},close:function(t){i&&i.buffer&&i.buffer.length&&i(10)},read:function(t,e,i,r,o){for(var n=0,a=0;a<r;a++){var h;try{h=s()}catch(t){throw new It.ErrnoError(29)}if(void 0===h&&0===n)throw new It.ErrnoError(6);if(null==h)break;n++,e[i+a]=h}return n&&(t.node.timestamp=Date.now()),n},write:function(t,e,s,r,o){for(var n=0;n<r;n++)try{i(e[s+n])}catch(t){throw new It.ErrnoError(29)}return r&&(t.node.timestamp=Date.now()),n}}),It.mkdev(r,o,n)},forceLoadFile:function(t){if(t.isDevice||t.isFolder||t.link||t.contents)return!0;if("undefined"!=typeof XMLHttpRequest)throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(!d)throw new Error("Cannot load without read() or XMLHttpRequest.");try{t.contents=us(d(t.url),!0),t.usedBytes=t.contents.length}catch(t){throw new It.ErrnoError(29)}},createLazyFile:function(t,e,s,i,r){function o(){this.lengthKnown=!1,this.chunks=[]}if(o.prototype.get=function(t){if(!(t>this.length-1||t<0)){var e=t%this.chunkSize,s=t/this.chunkSize|0;return this.getter(s)[e]}},o.prototype.setDataGetter=function(t){this.getter=t},o.prototype.cacheLength=function(){var t=new XMLHttpRequest;if(t.open("HEAD",s,!1),t.send(null),!(t.status>=200&&t.status<300||304===t.status))throw new Error("Couldn't load "+s+". Status: "+t.status);var e,i=Number(t.getResponseHeader("Content-length")),r=(e=t.getResponseHeader("Accept-Ranges"))&&"bytes"===e,o=(e=t.getResponseHeader("Content-Encoding"))&&"gzip"===e,n=1048576;r||(n=i);var a=this;a.setDataGetter((function(t){var e=t*n,r=(t+1)*n-1;if(r=Math.min(r,i-1),void 0===a.chunks[t]&&(a.chunks[t]=function(t,e){if(t>e)throw new Error("invalid range ("+t+", "+e+") or no bytes requested!");if(e>i-1)throw new Error("only "+i+" bytes available! programmer error!");var r=new XMLHttpRequest;if(r.open("GET",s,!1),i!==n&&r.setRequestHeader("Range","bytes="+t+"-"+e),"undefined"!=typeof Uint8Array&&(r.responseType="arraybuffer"),r.overrideMimeType&&r.overrideMimeType("text/plain; charset=x-user-defined"),r.send(null),!(r.status>=200&&r.status<300||304===r.status))throw new Error("Couldn't load "+s+". Status: "+r.status);return void 0!==r.response?new Uint8Array(r.response||[]):us(r.responseText||"",!0)}(e,r)),void 0===a.chunks[t])throw new Error("doXHR failed!");return a.chunks[t]})),!o&&i||(n=i=1,i=this.getter(0).length,n=i,P("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=i,this._chunkSize=n,this.lengthKnown=!0},"undefined"!=typeof XMLHttpRequest){if(!h)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var n=new o;Object.defineProperties(n,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var a={isDevice:!1,contents:n}}else a={isDevice:!1,url:s};var l=It.createFile(t,e,a,i,r);a.contents?l.contents=a.contents:a.url&&(l.contents=null,l.url=a.url),Object.defineProperties(l,{usedBytes:{get:function(){return this.contents.length}}});var u={};return Object.keys(l.stream_ops).forEach((function(t){var e=l.stream_ops[t];u[t]=function(){return It.forceLoadFile(l),e.apply(null,arguments)}})),u.read=function(t,e,s,i,r){It.forceLoadFile(l);var o=t.node.contents;if(r>=o.length)return 0;var n=Math.min(o.length-r,i);if(o.slice)for(var a=0;a<n;a++)e[s+a]=o[r+a];else for(a=0;a<n;a++)e[s+a]=o.get(r+a);return n},l.stream_ops=u,l},createPreloadedFile:function(t,e,s,i,o,n,a,h,l,u){Browser.init();var p=e?xt.resolve(wt.join2(t,e)):t;function c(s){function c(s){u&&u(),h||It.createDataFile(t,e,s,i,o,l),n&&n(),it()}var d=!1;r.preloadPlugins.forEach((function(t){d||t.canHandle(p)&&(t.handle(s,p,c,(function(){a&&a(),it()})),d=!0)})),d||c(s)}st(),"string"==typeof s?Browser.asyncLoad(s,(function(t){c(t)}),a):c(s)},indexedDB:function(){return window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB},DB_NAME:function(){return"EM_FS_"+window.location.pathname},DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:function(t,e,s){e=e||function(){},s=s||function(){};var i=It.indexedDB();try{var r=i.open(It.DB_NAME(),It.DB_VERSION)}catch(t){return s(t)}r.onupgradeneeded=function(){P("creating db"),r.result.createObjectStore(It.DB_STORE_NAME)},r.onsuccess=function(){var i=r.result.transaction([It.DB_STORE_NAME],"readwrite"),o=i.objectStore(It.DB_STORE_NAME),n=0,a=0,h=t.length;function l(){0==a?e():s()}t.forEach((function(t){var e=o.put(It.analyzePath(t).object.contents,t);e.onsuccess=function(){++n+a==h&&l()},e.onerror=function(){a++,n+a==h&&l()}})),i.onerror=s},r.onerror=s},loadFilesFromDB:function(t,e,s){e=e||function(){},s=s||function(){};var i=It.indexedDB();try{var r=i.open(It.DB_NAME(),It.DB_VERSION)}catch(t){return s(t)}r.onupgradeneeded=s,r.onsuccess=function(){var i=r.result;try{var o=i.transaction([It.DB_STORE_NAME],"readonly")}catch(t){return void s(t)}var n=o.objectStore(It.DB_STORE_NAME),a=0,h=0,l=t.length;function u(){0==h?e():s()}t.forEach((function(t){var e=n.get(t);e.onsuccess=function(){It.analyzePath(t).exists&&It.unlink(t),It.createDataFile(wt.dirname(t),wt.basename(t),e.result,!0,!0,!0),++a+h==l&&u()},e.onerror=function(){h++,a+h==l&&u()}})),o.onerror=s},r.onerror=s}},St={mappings:{},DEFAULT_POLLMASK:5,umask:511,calculateAt:function(t,e){if("/"!==e[0]){var s;if(-100===t)s=It.cwd();else{var i=It.getStream(t);if(!i)throw new It.ErrnoError(8);s=i.path}e=wt.join2(s,e)}return e},doStat:function(t,e,s){try{var i=t(e)}catch(t){if(t&&t.node&&wt.normalize(e)!==wt.normalize(It.getPath(t.node)))return-54;throw t}return N[s>>>2]=i.dev,N[s+4>>>2]=0,N[s+8>>>2]=i.ino,N[s+12>>>2]=i.mode,N[s+16>>>2]=i.nlink,N[s+20>>>2]=i.uid,N[s+24>>>2]=i.gid,N[s+28>>>2]=i.rdev,N[s+32>>>2]=0,ut=[i.size>>>0,(lt=i.size,+Math.abs(lt)>=1?lt>0?(0|Math.min(+Math.floor(lt/4294967296),4294967295))>>>0:~~+Math.ceil((lt-+(~~lt>>>0))/4294967296)>>>0:0)],N[s+40>>>2]=ut[0],N[s+44>>>2]=ut[1],N[s+48>>>2]=4096,N[s+52>>>2]=i.blocks,N[s+56>>>2]=i.atime.getTime()/1e3|0,N[s+60>>>2]=0,N[s+64>>>2]=i.mtime.getTime()/1e3|0,N[s+68>>>2]=0,N[s+72>>>2]=i.ctime.getTime()/1e3|0,N[s+76>>>2]=0,ut=[i.ino>>>0,(lt=i.ino,+Math.abs(lt)>=1?lt>0?(0|Math.min(+Math.floor(lt/4294967296),4294967295))>>>0:~~+Math.ceil((lt-+(~~lt>>>0))/4294967296)>>>0:0)],N[s+80>>>2]=ut[0],N[s+84>>>2]=ut[1],0},doMsync:function(t,e,s,i,r){var o=O.slice(t,t+s);It.msync(e,o,r,s,i)},doMkdir:function(t,e){return"/"===(t=wt.normalize(t))[t.length-1]&&(t=t.substr(0,t.length-1)),It.mkdir(t,e,0),0},doMknod:function(t,e,s){switch(61440&e){case 32768:case 8192:case 24576:case 4096:case 49152:break;default:return-28}return It.mknod(t,e,s),0},doReadlink:function(t,e,s){if(s<=0)return-28;var i=It.readlink(t),r=Math.min(s,A(i)),o=F[e+r>>>0];return S(i,e,s+1),F[e+r>>>0]=o,r},doAccess:function(t,e){if(-8&e)return-28;var s;if(!(s=It.lookupPath(t,{follow:!0}).node))return-44;var i="";return 4&e&&(i+="r"),2&e&&(i+="w"),1&e&&(i+="x"),i&&It.nodePermissions(s,i)?-2:0},doDup:function(t,e,s){var i=It.getStream(s);return i&&It.close(i),It.open(t,e,0,s,s).fd},doReadv:function(t,e,s,i){for(var r=0,o=0;o<s;o++){var n=N[e+8*o>>>2],a=N[e+(8*o+4)>>>2],h=It.read(t,F,n,a,i);if(h<0)return-1;if(r+=h,h<a)break}return r},doWritev:function(t,e,s,i){for(var r=0,o=0;o<s;o++){var n=N[e+8*o>>>2],a=N[e+(8*o+4)>>>2],h=It.write(t,F,n,a,i);if(h<0)return-1;r+=h}return r},varargs:void 0,get:function(){return St.varargs+=4,N[St.varargs-4>>>2]},getStr:function(t){return E(t)},getStreamFromFD:function(t){var e=It.getStream(t);if(!e)throw new It.ErrnoError(8);return e},get64:function(t,e){return t}},At={};function Ct(t){for(;t.length;){var e=t.pop();t.pop()(e)}}function Ft(t){return this.fromWireType(B[t>>>2])}var Ot={},Rt={},Lt={};function Nt(t){if(void 0===t)return"_unknown";var e=(t=t.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return e>=48&&e<=57?"_"+t:t}function Bt(t,e){return t=Nt(t),new Function("body","return function "+t+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(e)}function kt(t,e){var s=Bt(e,(function(t){this.name=e,this.message=t;var s=new Error(t).stack;void 0!==s&&(this.stack=this.toString()+"\n"+s.replace(/^Error(:[^\n]*)?\n/,""))}));return s.prototype=Object.create(t.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},s}var jt=void 0;function Gt(t){throw new jt(t)}function Ht(t,e,s){function i(e){var i=s(e);i.length!==t.length&&Gt("Mismatched type converter count");for(var r=0;r<t.length;++r)Kt(t[r],i[r])}t.forEach((function(t){Lt[t]=e}));var r=new Array(e.length),o=[],n=0;e.forEach((function(t,e){Rt.hasOwnProperty(t)?r[e]=Rt[t]:(o.push(t),Ot.hasOwnProperty(t)||(Ot[t]=[]),Ot[t].push((function(){r[e]=Rt[t],++n===o.length&&i(r)})))})),0===o.length&&i(r)}var Vt={};function zt(t){switch(t){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+t)}}var Ut=void 0;function Xt(t){for(var e="",s=t;O[s>>>0];)e+=Ut[O[s++>>>0]];return e}var Wt=void 0;function Yt(t){throw new Wt(t)}function Kt(t,e,s){if(s=s||{},!("argPackAdvance"in e))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=e.name;if(t||Yt('type "'+i+'" must have a positive integer typeid pointer'),Rt.hasOwnProperty(t)){if(s.ignoreDuplicateRegistrations)return;Yt("Cannot register type '"+i+"' twice")}if(Rt[t]=e,delete Lt[t],Ot.hasOwnProperty(t)){var r=Ot[t];delete Ot[t],r.forEach((function(t){t()}))}}function Zt(t){if(!(this instanceof he))return!1;if(!(t instanceof he))return!1;for(var e=this.$$.ptrType.registeredClass,s=this.$$.ptr,i=t.$$.ptrType.registeredClass,r=t.$$.ptr;e.baseClass;)s=e.upcast(s),e=e.baseClass;for(;i.baseClass;)r=i.upcast(r),i=i.baseClass;return e===i&&s===r}function qt(t){Yt(t.$$.ptrType.registeredClass.name+" instance already deleted")}var $t=!1;function Qt(t){}function Jt(t){t.count.value-=1,0===t.count.value&&function(t){t.smartPtr?t.smartPtrType.rawDestructor(t.smartPtr):t.ptrType.registeredClass.rawDestructor(t.ptr)}(t)}function te(t){return"undefined"==typeof FinalizationGroup?(te=function(t){return t},t):($t=new FinalizationGroup((function(t){for(var e=t.next();!e.done;e=t.next()){var s=e.value;s.ptr?Jt(s):console.warn("object already deleted: "+s.ptr)}})),Qt=function(t){$t.unregister(t.$$)},(te=function(t){return $t.register(t,t.$$,t.$$),t})(t))}function ee(){if(this.$$.ptr||qt(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var t,e=te(Object.create(Object.getPrototypeOf(this),{$$:{value:(t=this.$$,{count:t.count,deleteScheduled:t.deleteScheduled,preservePointerOnDelete:t.preservePointerOnDelete,ptr:t.ptr,ptrType:t.ptrType,smartPtr:t.smartPtr,smartPtrType:t.smartPtrType})}}));return e.$$.count.value+=1,e.$$.deleteScheduled=!1,e}function se(){this.$$.ptr||qt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Yt("Object already scheduled for deletion"),Qt(this),Jt(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ie(){return!this.$$.ptr}var re=void 0,oe=[];function ne(){for(;oe.length;){var t=oe.pop();t.$$.deleteScheduled=!1,t.delete()}}function ae(){return this.$$.ptr||qt(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&Yt("Object already scheduled for deletion"),oe.push(this),1===oe.length&&re&&re(ne),this.$$.deleteScheduled=!0,this}function he(){}var le={};function ue(t,e,s){if(void 0===t[e].overloadTable){var i=t[e];t[e]=function(){return t[e].overloadTable.hasOwnProperty(arguments.length)||Yt("Function '"+s+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+t[e].overloadTable+")!"),t[e].overloadTable[arguments.length].apply(this,arguments)},t[e].overloadTable=[],t[e].overloadTable[i.argCount]=i}}function pe(t,e,s){r.hasOwnProperty(t)?((void 0===s||void 0!==r[t].overloadTable&&void 0!==r[t].overloadTable[s])&&Yt("Cannot register public name '"+t+"' twice"),ue(r,t,t),r.hasOwnProperty(s)&&Yt("Cannot register multiple overloads of a function with the same number of arguments ("+s+")!"),r[t].overloadTable[s]=e):(r[t]=e,void 0!==s&&(r[t].numArguments=s))}function ce(t,e,s,i,r,o,n,a){this.name=t,this.constructor=e,this.instancePrototype=s,this.rawDestructor=i,this.baseClass=r,this.getActualType=o,this.upcast=n,this.downcast=a,this.pureVirtualFunctions=[]}function de(t,e,s){for(;e!==s;)e.upcast||Yt("Expected null or instance of "+s.name+", got an instance of "+e.name),t=e.upcast(t),e=e.baseClass;return t}function me(t,e){if(null===e)return this.isReference&&Yt("null is not a valid "+this.name),0;e.$$||Yt('Cannot pass "'+Ue(e)+'" as a '+this.name),e.$$.ptr||Yt("Cannot pass deleted object as a pointer of type "+this.name);var s=e.$$.ptrType.registeredClass;return de(e.$$.ptr,s,this.registeredClass)}function fe(t,e){var s;if(null===e)return this.isReference&&Yt("null is not a valid "+this.name),this.isSmartPointer?(s=this.rawConstructor(),null!==t&&t.push(this.rawDestructor,s),s):0;e.$$||Yt('Cannot pass "'+Ue(e)+'" as a '+this.name),e.$$.ptr||Yt("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&e.$$.ptrType.isConst&&Yt("Cannot convert argument of type "+(e.$$.smartPtrType?e.$$.smartPtrType.name:e.$$.ptrType.name)+" to parameter type "+this.name);var i=e.$$.ptrType.registeredClass;if(s=de(e.$$.ptr,i,this.registeredClass),this.isSmartPointer)switch(void 0===e.$$.smartPtr&&Yt("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:e.$$.smartPtrType===this?s=e.$$.smartPtr:Yt("Cannot convert argument of type "+(e.$$.smartPtrType?e.$$.smartPtrType.name:e.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:s=e.$$.smartPtr;break;case 2:if(e.$$.smartPtrType===this)s=e.$$.smartPtr;else{var r=e.clone();s=this.rawShare(s,He((function(){r.delete()}))),null!==t&&t.push(this.rawDestructor,s)}break;default:Yt("Unsupporting sharing policy")}return s}function ge(t,e){if(null===e)return this.isReference&&Yt("null is not a valid "+this.name),0;e.$$||Yt('Cannot pass "'+Ue(e)+'" as a '+this.name),e.$$.ptr||Yt("Cannot pass deleted object as a pointer of type "+this.name),e.$$.ptrType.isConst&&Yt("Cannot convert argument of type "+e.$$.ptrType.name+" to parameter type "+this.name);var s=e.$$.ptrType.registeredClass;return de(e.$$.ptr,s,this.registeredClass)}function _e(t){return this.rawGetPointee&&(t=this.rawGetPointee(t)),t}function ye(t){this.rawDestructor&&this.rawDestructor(t)}function ve(t){null!==t&&t.delete()}function be(t,e,s){if(e===s)return t;if(void 0===s.baseClass)return null;var i=be(t,e,s.baseClass);return null===i?null:s.downcast(i)}function Pe(){return Object.keys(xe).length}function Te(){var t=[];for(var e in xe)xe.hasOwnProperty(e)&&t.push(xe[e]);return t}function we(t){re=t,oe.length&&re&&re(ne)}var xe={};function Me(t,e){return e=function(t,e){for(void 0===e&&Yt("ptr should not be undefined");t.baseClass;)e=t.upcast(e),t=t.baseClass;return e}(t,e),xe[e]}function De(t,e){return e.ptrType&&e.ptr||Gt("makeClassHandle requires ptr and ptrType"),!!e.smartPtrType!=!!e.smartPtr&&Gt("Both smartPtrType and smartPtr must be specified"),e.count={value:1},te(Object.create(t,{$$:{value:e}}))}function Ee(t){var e=this.getPointee(t);if(!e)return this.destructor(t),null;var s=Me(this.registeredClass,e);if(void 0!==s){if(0===s.$$.count.value)return s.$$.ptr=e,s.$$.smartPtr=t,s.clone();var i=s.clone();return this.destructor(t),i}function r(){return this.isSmartPointer?De(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:e,smartPtrType:this,smartPtr:t}):De(this.registeredClass.instancePrototype,{ptrType:this,ptr:t})}var o,n=this.registeredClass.getActualType(e),a=le[n];if(!a)return r.call(this);o=this.isConst?a.constPointerType:a.pointerType;var h=be(e,this.registeredClass,o.registeredClass);return null===h?r.call(this):this.isSmartPointer?De(o.registeredClass.instancePrototype,{ptrType:o,ptr:h,smartPtrType:this,smartPtr:t}):De(o.registeredClass.instancePrototype,{ptrType:o,ptr:h})}function Ie(t,e,s,i,r,o,n,a,h,l,u){this.name=t,this.registeredClass=e,this.isReference=s,this.isConst=i,this.isSmartPointer=r,this.pointeeType=o,this.sharingPolicy=n,this.rawGetPointee=a,this.rawConstructor=h,this.rawShare=l,this.rawDestructor=u,r||void 0!==e.baseClass?this.toWireType=fe:i?(this.toWireType=me,this.destructorFunction=null):(this.toWireType=ge,this.destructorFunction=null)}function Se(t,e,s){r.hasOwnProperty(t)||Gt("Replacing nonexistant public symbol"),void 0!==r[t].overloadTable&&void 0!==s?r[t].overloadTable[s]=e:(r[t]=e,r[t].argCount=s)}function Ae(t,e){var s=-1!=(t=Xt(t)).indexOf("j")?function(t,e){x(t.indexOf("j")>=0,"getDynCaller should only be called with i64 sigs");var s=[];return function(){s.length=arguments.length;for(var i=0;i<arguments.length;i++)s[i]=arguments[i];return mt(t,e,s)}}(t,e):K.get(e);return"function"!=typeof s&&Yt("unknown function pointer with signature "+t+": "+e),s}var Ce=void 0;function Fe(t){var e=fs(t),s=Xt(e);return ms(e),s}function Oe(t,e){var s=[],i={};throw e.forEach((function t(e){i[e]||Rt[e]||(Lt[e]?Lt[e].forEach(t):(s.push(e),i[e]=!0))})),new Ce(t+": "+s.map(Fe).join([", "]))}function Re(t,e){for(var s=[],i=0;i<t;i++)s.push(N[(e>>2)+i>>>0]);return s}function Le(t,e,s,i,r){var o=e.length;o<2&&Yt("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var n=null!==e[1]&&null!==s,a=!1,h=1;h<e.length;++h)if(null!==e[h]&&void 0===e[h].destructorFunction){a=!0;break}var l="void"!==e[0].name,u="",p="";for(h=0;h<o-2;++h)u+=(0!==h?", ":"")+"arg"+h,p+=(0!==h?", ":"")+"arg"+h+"Wired";var c="return function "+Nt(t)+"("+u+") {\nif (arguments.length !== "+(o-2)+") {\nthrowBindingError('function "+t+" called with ' + arguments.length + ' arguments, expected "+(o-2)+" args!');\n}\n";a&&(c+="var destructors = [];\n");var d=a?"destructors":"null",m=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[Yt,i,r,Ct,e[0],e[1]];for(n&&(c+="var thisWired = classParam.toWireType("+d+", this);\n"),h=0;h<o-2;++h)c+="var arg"+h+"Wired = argType"+h+".toWireType("+d+", arg"+h+"); // "+e[h+2].name+"\n",m.push("argType"+h),f.push(e[h+2]);if(n&&(p="thisWired"+(p.length>0?", ":"")+p),c+=(l?"var rv = ":"")+"invoker(fn"+(p.length>0?", ":"")+p+");\n",a)c+="runDestructors(destructors);\n";else for(h=n?1:2;h<e.length;++h){var g=1===h?"thisWired":"arg"+(h-2)+"Wired";null!==e[h].destructorFunction&&(c+=g+"_dtor("+g+"); // "+e[h].name+"\n",m.push(g+"_dtor"),f.push(e[h].destructorFunction))}return l&&(c+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),c+="}\n",m.push(c),function(t,e){if(!(t instanceof Function))throw new TypeError("new_ called with constructor type "+typeof t+" which is not a function");var s=Bt(t.name||"unknownFunctionName",(function(){}));s.prototype=t.prototype;var i=new s,r=t.apply(i,e);return r instanceof Object?r:i}(Function,m).apply(null,f)}var Ne=[],Be=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function ke(t){t>4&&0==--Be[t].refcount&&(Be[t]=void 0,Ne.push(t))}function je(){for(var t=0,e=5;e<Be.length;++e)void 0!==Be[e]&&++t;return t}function Ge(){for(var t=5;t<Be.length;++t)if(void 0!==Be[t])return Be[t];return null}function He(t){switch(t){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var e=Ne.length?Ne.pop():Be.length;return Be[e]={refcount:1,value:t},e}}function Ve(t,e,s){switch(e){case 0:return function(t){var e=s?F:O;return this.fromWireType(e[t>>>0])};case 1:return function(t){var e=s?R:L;return this.fromWireType(e[t>>>1])};case 2:return function(t){var e=s?N:B;return this.fromWireType(e[t>>>2])};default:throw new TypeError("Unknown integer type: "+t)}}function ze(t,e){var s=Rt[t];return void 0===s&&Yt(e+" has unknown type "+Fe(t)),s}function Ue(t){if(null===t)return"null";var e=typeof t;return"object"===e||"array"===e||"function"===e?t.toString():""+t}function Xe(t,e){switch(e){case 2:return function(t){return this.fromWireType(k[t>>>2])};case 3:return function(t){return this.fromWireType(j[t>>>3])};default:throw new TypeError("Unknown float type: "+t)}}function We(t,e,s){switch(e){case 0:return s?function(t){return F[t>>>0]}:function(t){return O[t>>>0]};case 1:return s?function(t){return R[t>>>1]}:function(t){return L[t>>>1]};case 2:return s?function(t){return N[t>>>2]}:function(t){return B[t>>>2]};default:throw new TypeError("Unknown integer type: "+t)}}function Ye(t){return t||Yt("Cannot use deleted val. handle = "+t),Be[t].value}var Ke,Ze={};function qe(t){var e=Ze[t];return void 0===e?Xt(t):e}function $e(){return"object"==typeof globalThis?globalThis:Function("return this")()}function Qe(t){try{return b.grow(t-C.byteLength+65535>>>16),Y(b.buffer),1}catch(t){}}Ke=l?function(){var t=process.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof dateNow?dateNow:function(){return performance.now()};var Je={};function ts(){if(!ts.strings){var t={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:("object"==typeof navigator&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:p||"./this.program"};for(var e in Je)t[e]=Je[e];var s=[];for(var e in t)s.push(e+"="+t[e]);ts.strings=s}return ts.strings}function es(t){return t%4==0&&(t%100!=0||t%400==0)}function ss(t,e){for(var s=0,i=0;i<=e;s+=t[i++]);return s}var is=[31,29,31,30,31,30,31,31,30,31,30,31],rs=[31,28,31,30,31,30,31,31,30,31,30,31];function os(t,e){for(var s=new Date(t.getTime());e>0;){var i=es(s.getFullYear()),r=s.getMonth(),o=(i?is:rs)[r];if(!(e>o-s.getDate()))return s.setDate(s.getDate()+e),s;e-=o-s.getDate()+1,s.setDate(1),r<11?s.setMonth(r+1):(s.setMonth(0),s.setFullYear(s.getFullYear()+1))}return s}function ns(t,e,s,i){var r=N[i+40>>>2],o={tm_sec:N[i>>>2],tm_min:N[i+4>>>2],tm_hour:N[i+8>>>2],tm_mday:N[i+12>>>2],tm_mon:N[i+16>>>2],tm_year:N[i+20>>>2],tm_wday:N[i+24>>>2],tm_yday:N[i+28>>>2],tm_isdst:N[i+32>>>2],tm_gmtoff:N[i+36>>>2],tm_zone:r?E(r):""},n=E(s),a={"%c":"%a %b %d %H:%M:%S %Y","%D":"%m/%d/%y","%F":"%Y-%m-%d","%h":"%b","%r":"%I:%M:%S %p","%R":"%H:%M","%T":"%H:%M:%S","%x":"%m/%d/%y","%X":"%H:%M:%S","%Ec":"%c","%EC":"%C","%Ex":"%m/%d/%y","%EX":"%H:%M:%S","%Ey":"%y","%EY":"%Y","%Od":"%d","%Oe":"%e","%OH":"%H","%OI":"%I","%Om":"%m","%OM":"%M","%OS":"%S","%Ou":"%u","%OU":"%U","%OV":"%V","%Ow":"%w","%OW":"%W","%Oy":"%y"};for(var h in a)n=n.replace(new RegExp(h,"g"),a[h]);var l=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],u=["January","February","March","April","May","June","July","August","September","October","November","December"];function p(t,e,s){for(var i="number"==typeof t?t.toString():t||"";i.length<e;)i=s[0]+i;return i}function c(t,e){return p(t,e,"0")}function d(t,e){function s(t){return t<0?-1:t>0?1:0}var i;return 0===(i=s(t.getFullYear()-e.getFullYear()))&&0===(i=s(t.getMonth()-e.getMonth()))&&(i=s(t.getDate()-e.getDate())),i}function m(t){switch(t.getDay()){case 0:return new Date(t.getFullYear()-1,11,29);case 1:return t;case 2:return new Date(t.getFullYear(),0,3);case 3:return new Date(t.getFullYear(),0,2);case 4:return new Date(t.getFullYear(),0,1);case 5:return new Date(t.getFullYear()-1,11,31);case 6:return new Date(t.getFullYear()-1,11,30)}}function f(t){var e=os(new Date(t.tm_year+1900,0,1),t.tm_yday),s=new Date(e.getFullYear(),0,4),i=new Date(e.getFullYear()+1,0,4),r=m(s),o=m(i);return d(r,e)<=0?d(o,e)<=0?e.getFullYear()+1:e.getFullYear():e.getFullYear()-1}var g={"%a":function(t){return l[t.tm_wday].substring(0,3)},"%A":function(t){return l[t.tm_wday]},"%b":function(t){return u[t.tm_mon].substring(0,3)},"%B":function(t){return u[t.tm_mon]},"%C":function(t){return c((t.tm_year+1900)/100|0,2)},"%d":function(t){return c(t.tm_mday,2)},"%e":function(t){return p(t.tm_mday,2," ")},"%g":function(t){return f(t).toString().substring(2)},"%G":function(t){return f(t)},"%H":function(t){return c(t.tm_hour,2)},"%I":function(t){var e=t.tm_hour;return 0==e?e=12:e>12&&(e-=12),c(e,2)},"%j":function(t){return c(t.tm_mday+ss(es(t.tm_year+1900)?is:rs,t.tm_mon-1),3)},"%m":function(t){return c(t.tm_mon+1,2)},"%M":function(t){return c(t.tm_min,2)},"%n":function(){return"\n"},"%p":function(t){return t.tm_hour>=0&&t.tm_hour<12?"AM":"PM"},"%S":function(t){return c(t.tm_sec,2)},"%t":function(){return"\t"},"%u":function(t){return t.tm_wday||7},"%U":function(t){var e=new Date(t.tm_year+1900,0,1),s=0===e.getDay()?e:os(e,7-e.getDay()),i=new Date(t.tm_year+1900,t.tm_mon,t.tm_mday);if(d(s,i)<0){var r=ss(es(i.getFullYear())?is:rs,i.getMonth()-1)-31,o=31-s.getDate()+r+i.getDate();return c(Math.ceil(o/7),2)}return 0===d(s,e)?"01":"00"},"%V":function(t){var e,s=new Date(t.tm_year+1900,0,4),i=new Date(t.tm_year+1901,0,4),r=m(s),o=m(i),n=os(new Date(t.tm_year+1900,0,1),t.tm_yday);return d(n,r)<0?"53":d(o,n)<=0?"01":(e=r.getFullYear()<t.tm_year+1900?t.tm_yday+32-r.getDate():t.tm_yday+1-r.getDate(),c(Math.ceil(e/7),2))},"%w":function(t){return t.tm_wday},"%W":function(t){var e=new Date(t.tm_year,0,1),s=1===e.getDay()?e:os(e,0===e.getDay()?1:7-e.getDay()+1),i=new Date(t.tm_year+1900,t.tm_mon,t.tm_mday);if(d(s,i)<0){var r=ss(es(i.getFullYear())?is:rs,i.getMonth()-1)-31,o=31-s.getDate()+r+i.getDate();return c(Math.ceil(o/7),2)}return 0===d(s,e)?"01":"00"},"%y":function(t){return(t.tm_year+1900).toString().substring(2)},"%Y":function(t){return t.tm_year+1900},"%z":function(t){var e=t.tm_gmtoff,s=e>=0;return e=(e=Math.abs(e)/60)/60*100+e%60,(s?"+":"-")+String("0000"+e).slice(-4)},"%Z":function(t){return t.tm_zone},"%%":function(){return"%"}};for(var h in g)n.indexOf(h)>=0&&(n=n.replace(new RegExp(h,"g"),g[h](o)));var _,y,v=us(n,!1);return v.length>e?0:(_=v,y=t,F.set(_,y>>>0),v.length-1)}var as=function(t,e,s,i){t||(t=this),this.parent=t,this.mount=t.mount,this.mounted=null,this.id=It.nextInode++,this.name=e,this.mode=s,this.node_ops={},this.stream_ops={},this.rdev=i},hs=365,ls=146;function us(t,e,s){var i=s>0?s:A(t)+1,r=new Array(i),o=I(t,r,0,r.length);return e&&(r.length=o),r}Object.defineProperties(as.prototype,{read:{get:function(){return(this.mode&hs)===hs},set:function(t){t?this.mode|=hs:this.mode&=-366}},write:{get:function(){return(this.mode&ls)===ls},set:function(t){t?this.mode|=ls:this.mode&=-147}},isFolder:{get:function(){return It.isDir(this.mode)}},isDevice:{get:function(){return It.isChrdev(this.mode)}}}),It.FSNode=as,It.staticInit(),r.FS_createPath=It.createPath,r.FS_createDataFile=It.createDataFile,r.FS_createPreloadedFile=It.createPreloadedFile,r.FS_createLazyFile=It.createLazyFile,r.FS_createDevice=It.createDevice,r.FS_unlink=It.unlink,jt=r.InternalError=kt(Error,"InternalError"),function(){for(var t=new Array(256),e=0;e<256;++e)t[e]=String.fromCharCode(e);Ut=t}(),Wt=r.BindingError=kt(Error,"BindingError"),he.prototype.isAliasOf=Zt,he.prototype.clone=ee,he.prototype.delete=se,he.prototype.isDeleted=ie,he.prototype.deleteLater=ae,Ie.prototype.getPointee=_e,Ie.prototype.destructor=ye,Ie.prototype.argPackAdvance=8,Ie.prototype.readValueFromPointer=Ft,Ie.prototype.deleteObject=ve,Ie.prototype.fromWireType=Ee,r.getInheritedInstanceCount=Pe,r.getLiveInheritedInstances=Te,r.flushPendingDeletes=ne,r.setDelayFunction=we,Ce=r.UnboundTypeError=kt(Error,"UnboundTypeError"),r.count_emval_handles=je,r.get_first_emval=Ge,$.push({func:function(){cs()}});var ps={x:function(t,e,s,i){rt("Assertion failed: "+E(t)+", at: "+[e?E(e):"unknown filename",s,i?E(i):"unknown function"])},H:function(t){return ds(t+bt)+bt},G:function(t,e,s){throw new Pt(t).init(e,s),t},C:function(t,e,s){St.varargs=s;try{var i=St.getStreamFromFD(t);switch(e){case 0:return(r=St.get())<0?-28:It.open(i.path,i.flags,0,r).fd;case 1:case 2:case 13:case 14:return 0;case 3:return i.flags;case 4:var r=St.get();return i.flags|=r,0;case 12:return r=St.get(),R[r+0>>>1]=2,0;default:return-28;case 9:return Tt(28),-1}}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),-t.errno}},V:function(t,e,s){St.varargs=s;try{var i=St.getStreamFromFD(t);switch(e){case 21509:case 21505:case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:case 21523:case 21524:return i.tty?0:-59;case 21519:if(!i.tty)return-59;var r=St.get();return N[r>>>2]=0,0;case 21520:return i.tty?-28:-59;case 21531:return r=St.get(),It.ioctl(i,e,r);default:rt("bad ioctl syscall "+e)}}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),-t.errno}},W:function(t,e,s){St.varargs=s;try{var i=St.getStr(t),r=St.get();return It.open(i,e,r).fd}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),-t.errno}},$:function(t){var e=At[t];delete At[t];var s=e.elements,i=s.length,r=s.map((function(t){return t.getterReturnType})).concat(s.map((function(t){return t.setterArgumentType}))),o=e.rawConstructor,n=e.rawDestructor;Ht([t],r,(function(t){return s.forEach((function(e,s){var r=t[s],o=e.getter,n=e.getterContext,a=t[s+i],h=e.setter,l=e.setterContext;e.read=function(t){return r.fromWireType(o(n,t))},e.write=function(t,e){var s=[];h(l,t,a.toWireType(s,e)),Ct(s)}})),[{name:e.name,fromWireType:function(t){for(var e=new Array(i),r=0;r<i;++r)e[r]=s[r].read(t);return n(t),e},toWireType:function(t,r){if(i!==r.length)throw new TypeError("Incorrect number of tuple elements for "+e.name+": expected="+i+", actual="+r.length);for(var a=o(),h=0;h<i;++h)s[h].write(a,r[h]);return null!==t&&t.push(n,a),a},argPackAdvance:8,readValueFromPointer:Ft,destructorFunction:n}]}))},q:function(t){var e=Vt[t];delete Vt[t];var s=e.rawConstructor,i=e.rawDestructor,r=e.fields;Ht([t],r.map((function(t){return t.getterReturnType})).concat(r.map((function(t){return t.setterArgumentType}))),(function(t){var o={};return r.forEach((function(e,s){var i=e.fieldName,n=t[s],a=e.getter,h=e.getterContext,l=t[s+r.length],u=e.setter,p=e.setterContext;o[i]={read:function(t){return n.fromWireType(a(h,t))},write:function(t,e){var s=[];u(p,t,l.toWireType(s,e)),Ct(s)}}})),[{name:e.name,fromWireType:function(t){var e={};for(var s in o)e[s]=o[s].read(t);return i(t),e},toWireType:function(t,e){for(var r in o)if(!(r in e))throw new TypeError('Missing field:  "'+r+'"');var n=s();for(r in o)o[r].write(n,e[r]);return null!==t&&t.push(i,n),n},argPackAdvance:8,readValueFromPointer:Ft,destructorFunction:i}]}))},Y:function(t,e,s,i,r){var o=zt(s);Kt(t,{name:e=Xt(e),fromWireType:function(t){return!!t},toWireType:function(t,e){return e?i:r},argPackAdvance:8,readValueFromPointer:function(t){var i;if(1===s)i=F;else if(2===s)i=R;else{if(4!==s)throw new TypeError("Unknown boolean type size: "+e);i=N}return this.fromWireType(i[t>>>o])},destructorFunction:null})},t:function(t,e,s,i,r,o,n,a,h,l,u,p,c){u=Xt(u),o=Ae(r,o),a&&(a=Ae(n,a)),l&&(l=Ae(h,l)),c=Ae(p,c);var d=Nt(u);pe(d,(function(){Oe("Cannot construct "+u+" due to unbound types",[i])})),Ht([t,e,s],i?[i]:[],(function(e){var s,r;e=e[0],r=i?(s=e.registeredClass).instancePrototype:he.prototype;var n=Bt(d,(function(){if(Object.getPrototypeOf(this)!==h)throw new Wt("Use 'new' to construct "+u);if(void 0===p.constructor_body)throw new Wt(u+" has no accessible constructor");var t=p.constructor_body[arguments.length];if(void 0===t)throw new Wt("Tried to invoke ctor of "+u+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(p.constructor_body).toString()+") parameters instead!");return t.apply(this,arguments)})),h=Object.create(r,{constructor:{value:n}});n.prototype=h;var p=new ce(u,n,h,c,s,o,a,l),m=new Ie(u,p,!0,!1,!1),f=new Ie(u+"*",p,!1,!1,!1),g=new Ie(u+" const*",p,!1,!0,!1);return le[t]={pointerType:f,constPointerType:g},Se(d,n),[m,f,g]}))},s:function(t,e,s,i,r,o){x(e>0);var n=Re(e,s);r=Ae(i,r);var a=[o],h=[];Ht([],[t],(function(t){var s="constructor "+(t=t[0]).name;if(void 0===t.registeredClass.constructor_body&&(t.registeredClass.constructor_body=[]),void 0!==t.registeredClass.constructor_body[e-1])throw new Wt("Cannot register multiple constructors with identical number of parameters ("+(e-1)+") for class '"+t.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return t.registeredClass.constructor_body[e-1]=function(){Oe("Cannot construct "+t.name+" due to unbound types",n)},Ht([],n,(function(i){return t.registeredClass.constructor_body[e-1]=function(){arguments.length!==e-1&&Yt(s+" called with "+arguments.length+" arguments, expected "+(e-1)),h.length=0,a.length=e;for(var t=1;t<e;++t)a[t]=i[t].toWireType(h,arguments[t-1]);var o=r.apply(null,a);return Ct(h),i[0].fromWireType(o)},[]})),[]}))},c:function(t,e,s,i,r,o,n,a){var h=Re(s,i);e=Xt(e),o=Ae(r,o),Ht([],[t],(function(t){var i=(t=t[0]).name+"."+e;function r(){Oe("Cannot call "+i+" due to unbound types",h)}a&&t.registeredClass.pureVirtualFunctions.push(e);var l=t.registeredClass.instancePrototype,u=l[e];return void 0===u||void 0===u.overloadTable&&u.className!==t.name&&u.argCount===s-2?(r.argCount=s-2,r.className=t.name,l[e]=r):(ue(l,e,i),l[e].overloadTable[s-2]=r),Ht([],h,(function(r){var a=Le(i,r,t,o,n);return void 0===l[e].overloadTable?(a.argCount=s-2,l[e]=a):l[e].overloadTable[s-2]=a,[]})),[]}))},X:function(t,e){Kt(t,{name:e=Xt(e),fromWireType:function(t){var e=Be[t].value;return ke(t),e},toWireType:function(t,e){return He(e)},argPackAdvance:8,readValueFromPointer:Ft,destructorFunction:null})},_:function(t,e,s,i){var r=zt(s);function o(){}e=Xt(e),o.values={},Kt(t,{name:e,constructor:o,fromWireType:function(t){return this.constructor.values[t]},toWireType:function(t,e){return e.value},argPackAdvance:8,readValueFromPointer:Ve(e,r,i),destructorFunction:null}),pe(e,o)},v:function(t,e,s){var i=ze(t,"enum");e=Xt(e);var r=i.constructor,o=Object.create(i.constructor.prototype,{value:{value:s},constructor:{value:Bt(i.name+"_"+e,(function(){}))}});r.values[s]=o,r[e]=o},E:function(t,e,s){var i=zt(s);Kt(t,{name:e=Xt(e),fromWireType:function(t){return t},toWireType:function(t,e){if("number"!=typeof e&&"boolean"!=typeof e)throw new TypeError('Cannot convert "'+Ue(e)+'" to '+this.name);return e},argPackAdvance:8,readValueFromPointer:Xe(e,i),destructorFunction:null})},f:function(t,e,s,i,r,o){var n=Re(e,s);t=Xt(t),r=Ae(i,r),pe(t,(function(){Oe("Cannot call "+t+" due to unbound types",n)}),e-1),Ht([],n,(function(s){var i=[s[0],null].concat(s.slice(1));return Se(t,Le(t,i,null,r,o),e-1),[]}))},m:function(t,e,s,i,r){e=Xt(e),-1===r&&(r=4294967295);var o=zt(s),n=function(t){return t};if(0===i){var a=32-8*s;n=function(t){return t<<a>>>a}}var h=-1!=e.indexOf("unsigned");Kt(t,{name:e,fromWireType:n,toWireType:function(t,s){if("number"!=typeof s&&"boolean"!=typeof s)throw new TypeError('Cannot convert "'+Ue(s)+'" to '+this.name);if(s<i||s>r)throw new TypeError('Passing a number "'+Ue(s)+'" from JS side to C/C++ side to an argument of type "'+e+'", which is outside the valid range ['+i+", "+r+"]!");return h?s>>>0:0|s},argPackAdvance:8,readValueFromPointer:We(e,o,0!==i),destructorFunction:null})},k:function(t,e,s){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][e];function r(t){var e=B,s=e[(t>>=2)>>>0],r=e[t+1>>>0];return new i(C,r,s)}Kt(t,{name:s=Xt(s),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},F:function(t,e){var s="std::string"===(e=Xt(e));Kt(t,{name:e,fromWireType:function(t){var e,i=B[t>>>2];if(s)for(var r=t+4,o=0;o<=i;++o){var n=t+4+o;if(o==i||0==O[n>>>0]){var a=E(r,n-r);void 0===e?e=a:(e+=String.fromCharCode(0),e+=a),r=n+1}}else{var h=new Array(i);for(o=0;o<i;++o)h[o]=String.fromCharCode(O[t+4+o>>>0]);e=h.join("")}return ms(t),e},toWireType:function(t,e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));var i="string"==typeof e;i||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Int8Array||Yt("Cannot pass non-string to std::string");var r=(s&&i?function(){return A(e)}:function(){return e.length})(),o=ds(4+r+1);if(B[(o>>>=0)>>>2]=r,s&&i)S(e,o+4,r+1);else if(i)for(var n=0;n<r;++n){var a=e.charCodeAt(n);a>255&&(ms(o),Yt("String has UTF-16 code units that do not fit in 8 bits")),O[o+4+n>>>0]=a}else for(n=0;n<r;++n)O[o+4+n>>>0]=e[n];return null!==t&&t.push(ms,o),o},argPackAdvance:8,readValueFromPointer:Ft,destructorFunction:function(t){ms(t)}})},w:function(t,e,s){var i,r,o,n,a;s=Xt(s),2===e?(i=H,r=V,n=z,o=function(){return L},a=1):4===e&&(i=U,r=X,n=W,o=function(){return B},a=2),Kt(t,{name:s,fromWireType:function(t){for(var s,r=B[t>>>2],n=o(),h=t+4,l=0;l<=r;++l){var u=t+4+l*e;if(l==r||0==n[u>>>a]){var p=i(h,u-h);void 0===s?s=p:(s+=String.fromCharCode(0),s+=p),h=u+e}}return ms(t),s},toWireType:function(t,i){"string"!=typeof i&&Yt("Cannot pass non-string to C++ string type "+s);var o=n(i),h=ds(4+o+e);return B[(h>>>=0)>>>2]=o>>a,r(i,h+4,o+e),null!==t&&t.push(ms,h),h},argPackAdvance:8,readValueFromPointer:Ft,destructorFunction:function(t){ms(t)}})},aa:function(t,e,s,i,r,o){At[t]={name:Xt(e),rawConstructor:Ae(s,i),rawDestructor:Ae(r,o),elements:[]}},h:function(t,e,s,i,r,o,n,a,h){At[t].elements.push({getterReturnType:e,getter:Ae(s,i),getterContext:r,setterArgumentType:o,setter:Ae(n,a),setterContext:h})},r:function(t,e,s,i,r,o){Vt[t]={name:Xt(e),rawConstructor:Ae(s,i),rawDestructor:Ae(r,o),fields:[]}},e:function(t,e,s,i,r,o,n,a,h,l){Vt[t].fields.push({fieldName:Xt(e),getterReturnType:s,getter:Ae(i,r),getterContext:o,setterArgumentType:n,setter:Ae(a,h),setterContext:l})},Z:function(t,e){Kt(t,{isVoid:!0,name:e=Xt(e),argPackAdvance:0,fromWireType:function(){},toWireType:function(t,e){}})},o:function(t,e,s){t=Ye(t),e=ze(e,"emval::as");var i=[],r=He(i);return N[s>>>2]=r,e.toWireType(i,t)},ba:function(t,e,s,i){t=Ye(t);for(var r=function(t,e){for(var s=new Array(t),i=0;i<t;++i)s[i]=ze(N[(e>>2)+i>>>0],"parameter "+i);return s}(e,s),o=new Array(e),n=0;n<e;++n){var a=r[n];o[n]=a.readValueFromPointer(i),i+=a.argPackAdvance}return He(t.apply(void 0,o))},b:ke,J:function(t){return 0===t?He($e()):(t=qe(t),He($e()[t]))},l:function(t,e){return He((t=Ye(t))[e=Ye(e)])},j:function(t){t>4&&(Be[t].refcount+=1)},N:function(t,e){return(t=Ye(t))instanceof(e=Ye(e))},I:function(t){return"number"==typeof(t=Ye(t))},y:function(){return He([])},g:function(t){return He(qe(t))},u:function(){return He({})},n:function(t){Ct(Be[t].value),ke(t)},i:function(t,e,s){t=Ye(t),e=Ye(e),s=Ye(s),t[e]=s},d:function(t,e){return He((t=ze(t,"_emval_take_value")).readValueFromPointer(e))},A:function(){rt()},T:function(t,e){var s;if(0===t)s=Date.now();else{if(1!==t&&4!==t)return Tt(28),-1;s=Ke()}return N[e>>>2]=s/1e3|0,N[e+4>>>2]=s%1e3*1e3*1e3|0,0},M:function(t,e,s){O.copyWithin(t>>>0,e>>>0,e+s>>>0)},p:function(t){t>>>=0;var e=O.length,s=4294967296;if(t>s)return!1;for(var i,r,o=1;o<=4;o*=2){var n=e*(1+.2/o);if(n=Math.min(n,t+100663296),Qe(Math.min(s,((i=Math.max(16777216,t,n))%(r=65536)>0&&(i+=r-i%r),i))))return!0}return!1},R:function(t,e){try{var s=0;return ts().forEach((function(i,r){var o=e+s;N[t+4*r>>>2]=o,function(t,e,s){for(var i=0;i<t.length;++i)F[e++>>>0]=t.charCodeAt(i);s||(F[e>>>0]=0)}(i,o),s+=i.length+1})),0}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),t.errno}},S:function(t,e){try{var s=ts();N[t>>>2]=s.length;var i=0;return s.forEach((function(t){i+=t.length+1})),N[e>>>2]=i,0}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),t.errno}},D:function(t){try{var e=St.getStreamFromFD(t);return It.close(e),0}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),t.errno}},U:function(t,e,s,i){try{var r=St.getStreamFromFD(t),o=St.doReadv(r,e,s);return N[i>>>2]=o,0}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),t.errno}},K:function(t,e,s,i,r){try{var o=St.getStreamFromFD(t),n=4294967296*s+(e>>>0),a=9007199254740992;return n<=-a||n>=a?-61:(It.llseek(o,n,i),ut=[o.position>>>0,(lt=o.position,+Math.abs(lt)>=1?lt>0?(0|Math.min(+Math.floor(lt/4294967296),4294967295))>>>0:~~+Math.ceil((lt-+(~~lt>>>0))/4294967296)>>>0:0)],N[r>>>2]=ut[0],N[r+4>>>2]=ut[1],o.getdents&&0===n&&0===i&&(o.getdents=null),0)}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),t.errno}},B:function(t,e,s,i){try{var r=St.getStreamFromFD(t),o=St.doWritev(r,e,s);return N[i>>>2]=o,0}catch(t){return void 0!==It&&t instanceof It.ErrnoError||rt(t),t.errno}},a:b,z:function(){},P:function(){},O:function(){},L:function(t){},Q:function(t,e,s,i){return ns(t,e,s,i)}};!function(){var t={a:ps};function e(t,e){var s=t.exports;r.asm=s,K=r.asm.ca,it()}function s(t){e(t.instance)}function o(e){return(y||!a&&!h||"function"!=typeof fetch||at(pt)?Promise.resolve().then(ct):fetch(pt,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+pt+"'";return t.arrayBuffer()})).catch((function(){return ct()}))).then((function(e){return WebAssembly.instantiate(e,t)})).then(e,(function(t){T("failed to asynchronously prepare wasm: "+t),rt(t)}))}if(st(),r.instantiateWasm)try{return r.instantiateWasm(t,e)}catch(t){return T("Module.instantiateWasm callback failed with error: "+t),!1}(y||"function"!=typeof WebAssembly.instantiateStreaming||nt(pt)||at(pt)||"function"!=typeof fetch?o(s):fetch(pt,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(s,(function(t){return T("wasm streaming compile failed: "+t),T("falling back to ArrayBuffer instantiation"),o(s)}))}))).catch(i)}();var cs=r.___wasm_call_ctors=function(){return(cs=r.___wasm_call_ctors=r.asm.da).apply(null,arguments)};r._main=function(){return(r._main=r.asm.ea).apply(null,arguments)};var ds=r._malloc=function(){return(ds=r._malloc=r.asm.fa).apply(null,arguments)},ms=r._free=function(){return(ms=r._free=r.asm.ga).apply(null,arguments)},fs=r.___getTypeName=function(){return(fs=r.___getTypeName=r.asm.ha).apply(null,arguments)};r.___embind_register_native_and_builtin_types=function(){return(r.___embind_register_native_and_builtin_types=r.asm.ia).apply(null,arguments)};var gs,_s=r.___errno_location=function(){return(_s=r.___errno_location=r.asm.ja).apply(null,arguments)};function ys(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function vs(t){var e,s=r._main;try{e=s(0,0),!0&&v&&0===e||(v||(r.onExit&&r.onExit(e),w=!0),c(e,new ys(e)))}catch(t){if(t instanceof ys)return;if("unwind"==t)return void(v=!0);var i=t;t&&"object"==typeof t&&t.stack&&(i=[t,t.stack]),T("exception thrown: "+i),c(1,t)}}function bs(t){function s(){gs||(gs=!0,r.calledRun=!0,w||(r.noFSInit||It.init.initialized||It.init(),dt($),It.ignorePermissions=!1,dt(Q),e(r),r.onRuntimeInitialized&&r.onRuntimeInitialized(),Ps&&vs(),function(){if(r.postRun)for("function"==typeof r.postRun&&(r.postRun=[r.postRun]);r.postRun.length;)t=r.postRun.shift(),J.unshift(t);var t;dt(J)}()))}tt>0||(function(){if(r.preRun)for("function"==typeof r.preRun&&(r.preRun=[r.preRun]);r.preRun.length;)t=r.preRun.shift(),q.unshift(t);var t;dt(q)}(),tt>0||(r.setStatus?(r.setStatus("Running..."),setTimeout((function(){setTimeout((function(){r.setStatus("")}),1),s()}),1)):s()))}if(r.dynCall_jiji=function(){return(r.dynCall_jiji=r.asm.ka).apply(null,arguments)},r.dynCall_viijii=function(){return(r.dynCall_viijii=r.asm.la).apply(null,arguments)},r.dynCall_iiiiiijj=function(){return(r.dynCall_iiiiiijj=r.asm.ma).apply(null,arguments)},r.dynCall_iiiiij=function(){return(r.dynCall_iiiiij=r.asm.na).apply(null,arguments)},r.dynCall_iiiiijj=function(){return(r.dynCall_iiiiijj=r.asm.oa).apply(null,arguments)},r.addRunDependency=st,r.removeRunDependency=it,r.FS_createPath=It.createPath,r.FS_createDataFile=It.createDataFile,r.FS_createPreloadedFile=It.createPreloadedFile,r.FS_createLazyFile=It.createLazyFile,r.FS_createDevice=It.createDevice,r.FS_unlink=It.unlink,r.FS=It,et=function t(){gs||bs(),gs||(et=t)},r.run=bs,r.preInit)for("function"==typeof r.preInit&&(r.preInit=[r.preInit]);r.preInit.length>0;)r.preInit.pop()();var Ps=!0;return r.noInitialRun&&(Ps=!1),v=!0,bs(),t.ready});"object"==typeof t&&"object"==typeof e?e.exports=i:"function"==typeof define&&define.amd?define([],(function(){return i})):"object"==typeof t&&(t.WebIFCWasm=i)}}),Fl=[4288193352,1634111441,177149247,2056796094,3087945054,325726236,1674181508,277319702,753842376,2906023776,4196446775,32344328,644574406,963979645,4031249490,3299480353,2979338954,1095909175,3124254112,2938176219,635142910,3758799889,1051757585,4217484030,3999819293,3902619387,3296154744,1677625105,639361253,843113511,905975707,3221913625,3571504051,2272882330,25142252,4136498852,3640358203,1973544240,3495092785,4074379575,3426335179,1335981549,1052013943,1062813311,1945004755,3040386961,3041715199,395920057,3242481149,342316401,3518393246,1360408905,1904799276,862014818,3310460725,264262732,402227799,1003880860,1758889154,4123344466,1623761950,1658829314,2814081492,3747195512,484807127,1209101575,2853485674,24185140,1310830890,3415622556,647756555,2827207264,2143335405,1287392070,819412036,1426591983,2058353004,4278956645,182646315,2188021234,3132237377,987401354,707683696,2223149337,3508470533,900683007,263784265,1509553395,3493046030,3009204131,3319311131,2068733104,4175244083,2176052936,76236018,629592764,1154579445,377706215,1437502449,1073191201,1911478936,2474470126,3588315303,3079942009,3694346114,1687234759,310824031,3612865200,3171933400,1156407060,3740093272,1946335990,3651124850,738039164,2295281155,3219374653,90941305,2262370178,3024970846,3283111854,4021432810,979691226,3027567501,2320036040,2016517767,3053780830,4086658281,1329646415,4097777520,1529196076,3127900445,3027962421,3420628829,3856911033,1999602285,1412071761,2706606064,463610769,1404847402,331165859,4252922144,682877961,3544373492,1179482911,1004757350,4243806635,214636428,2445595289,2757150158,3136571912,1807405624,530289379,1621171031,2082059205,734778138,1235345126,3689010777,3657597509,1975003073,3979015343,2218152070,603775116,3101698114,1162798199,413509423,812556717,3824725483,2347447852,3663046924,3825984169,1620046519,3026737570,630975310,4292641817,4207607924,1530820697,2391383451,2769231204,926996030,2391406946,4156078855,3512223829,4237592921,3304561284,486154966],Ol={3821786052:t=>Rl.FromTape(t.ID,t.type,t.arguments),2296667514:t=>Ll.FromTape(t.ID,t.type,t.arguments),3630933823:t=>Nl.FromTape(t.ID,t.type,t.arguments),4288193352:t=>Bl.FromTape(t.ID,t.type,t.arguments),2874132201:t=>kl.FromTape(t.ID,t.type,t.arguments),618182010:t=>jl.FromTape(t.ID,t.type,t.arguments),1635779807:t=>Gl.FromTape(t.ID,t.type,t.arguments),2603310189:t=>Hl.FromTape(t.ID,t.type,t.arguments),3406155212:t=>Vl.FromTape(t.ID,t.type,t.arguments),1634111441:t=>zl.FromTape(t.ID,t.type,t.arguments),177149247:t=>Ul.FromTape(t.ID,t.type,t.arguments),1411407467:t=>Xl.FromTape(t.ID,t.type,t.arguments),3352864051:t=>Wl.FromTape(t.ID,t.type,t.arguments),2056796094:t=>Yl.FromTape(t.ID,t.type,t.arguments),1871374353:t=>Kl.FromTape(t.ID,t.type,t.arguments),3087945054:t=>Zl.FromTape(t.ID,t.type,t.arguments),3001207471:t=>ql.FromTape(t.ID,t.type,t.arguments),325726236:t=>$l.FromTape(t.ID,t.type,t.arguments),749761778:t=>Ql.FromTape(t.ID,t.type,t.arguments),3199563722:t=>Jl.FromTape(t.ID,t.type,t.arguments),2483840362:t=>tu.FromTape(t.ID,t.type,t.arguments),3379348081:t=>eu.FromTape(t.ID,t.type,t.arguments),3239324667:t=>su.FromTape(t.ID,t.type,t.arguments),4263986512:t=>iu.FromTape(t.ID,t.type,t.arguments),53199957:t=>ru.FromTape(t.ID,t.type,t.arguments),2029264950:t=>ou.FromTape(t.ID,t.type,t.arguments),3512275521:t=>nu.FromTape(t.ID,t.type,t.arguments),1674181508:t=>au.FromTape(t.ID,t.type,t.arguments),669184980:t=>hu.FromTape(t.ID,t.type,t.arguments),639542469:t=>lu.FromTape(t.ID,t.type,t.arguments),411424972:t=>uu.FromTape(t.ID,t.type,t.arguments),130549933:t=>pu.FromTape(t.ID,t.type,t.arguments),3869604511:t=>cu.FromTape(t.ID,t.type,t.arguments),3798115385:t=>du.FromTape(t.ID,t.type,t.arguments),1310608509:t=>mu.FromTape(t.ID,t.type,t.arguments),2705031697:t=>fu.FromTape(t.ID,t.type,t.arguments),3460190687:t=>gu.FromTape(t.ID,t.type,t.arguments),3207858831:t=>_u.FromTape(t.ID,t.type,t.arguments),277319702:t=>yu.FromTape(t.ID,t.type,t.arguments),1532957894:t=>vu.FromTape(t.ID,t.type,t.arguments),4261334040:t=>bu.FromTape(t.ID,t.type,t.arguments),3125803723:t=>Pu.FromTape(t.ID,t.type,t.arguments),2740243338:t=>Tu.FromTape(t.ID,t.type,t.arguments),1967976161:t=>wu.FromTape(t.ID,t.type,t.arguments),2461110595:t=>xu.FromTape(t.ID,t.type,t.arguments),2887950389:t=>Mu.FromTape(t.ID,t.type,t.arguments),167062518:t=>Du.FromTape(t.ID,t.type,t.arguments),753842376:t=>Eu.FromTape(t.ID,t.type,t.arguments),2906023776:t=>Iu.FromTape(t.ID,t.type,t.arguments),819618141:t=>Su.FromTape(t.ID,t.type,t.arguments),4196446775:t=>Au.FromTape(t.ID,t.type,t.arguments),3649138523:t=>Cu.FromTape(t.ID,t.type,t.arguments),616511568:t=>Fu.FromTape(t.ID,t.type,t.arguments),1334484129:t=>Ou.FromTape(t.ID,t.type,t.arguments),32344328:t=>Ru.FromTape(t.ID,t.type,t.arguments),231477066:t=>Lu.FromTape(t.ID,t.type,t.arguments),3649129432:t=>Nu.FromTape(t.ID,t.type,t.arguments),2736907675:t=>Bu.FromTape(t.ID,t.type,t.arguments),4037036970:t=>ku.FromTape(t.ID,t.type,t.arguments),1136057603:t=>ju.FromTape(t.ID,t.type,t.arguments),1560379544:t=>Gu.FromTape(t.ID,t.type,t.arguments),3367102660:t=>Hu.FromTape(t.ID,t.type,t.arguments),1387855156:t=>Vu.FromTape(t.ID,t.type,t.arguments),2069777674:t=>zu.FromTape(t.ID,t.type,t.arguments),1260505505:t=>Uu.FromTape(t.ID,t.type,t.arguments),4182860854:t=>Xu.FromTape(t.ID,t.type,t.arguments),2581212453:t=>Wu.FromTape(t.ID,t.type,t.arguments),2713105998:t=>Yu.FromTape(t.ID,t.type,t.arguments),644574406:t=>Ku.FromTape(t.ID,t.type,t.arguments),963979645:t=>Zu.FromTape(t.ID,t.type,t.arguments),4031249490:t=>qu.FromTape(t.ID,t.type,t.arguments),3299480353:t=>$u.FromTape(t.ID,t.type,t.arguments),2979338954:t=>Qu.FromTape(t.ID,t.type,t.arguments),39481116:t=>Ju.FromTape(t.ID,t.type,t.arguments),1095909175:t=>tp.FromTape(t.ID,t.type,t.arguments),1909888760:t=>ep.FromTape(t.ID,t.type,t.arguments),1950629157:t=>sp.FromTape(t.ID,t.type,t.arguments),3124254112:t=>ip.FromTape(t.ID,t.type,t.arguments),1177604601:t=>rp.FromTape(t.ID,t.type,t.arguments),2938176219:t=>op.FromTape(t.ID,t.type,t.arguments),2188180465:t=>np.FromTape(t.ID,t.type,t.arguments),2898889636:t=>ap.FromTape(t.ID,t.type,t.arguments),635142910:t=>hp.FromTape(t.ID,t.type,t.arguments),395041908:t=>lp.FromTape(t.ID,t.type,t.arguments),3758799889:t=>up.FromTape(t.ID,t.type,t.arguments),3293546465:t=>pp.FromTape(t.ID,t.type,t.arguments),1051757585:t=>cp.FromTape(t.ID,t.type,t.arguments),2674252688:t=>dp.FromTape(t.ID,t.type,t.arguments),4217484030:t=>mp.FromTape(t.ID,t.type,t.arguments),1285652485:t=>fp.FromTape(t.ID,t.type,t.arguments),3999819293:t=>gp.FromTape(t.ID,t.type,t.arguments),3203706013:t=>_p.FromTape(t.ID,t.type,t.arguments),1123145078:t=>yp.FromTape(t.ID,t.type,t.arguments),574549367:t=>vp.FromTape(t.ID,t.type,t.arguments),1675464909:t=>bp.FromTape(t.ID,t.type,t.arguments),2059837836:t=>Pp.FromTape(t.ID,t.type,t.arguments),59481748:t=>Tp.FromTape(t.ID,t.type,t.arguments),3749851601:t=>wp.FromTape(t.ID,t.type,t.arguments),3486308946:t=>xp.FromTape(t.ID,t.type,t.arguments),3331915920:t=>Mp.FromTape(t.ID,t.type,t.arguments),1416205885:t=>Dp.FromTape(t.ID,t.type,t.arguments),3150382593:t=>Ep.FromTape(t.ID,t.type,t.arguments),3902619387:t=>Ip.FromTape(t.ID,t.type,t.arguments),2951183804:t=>Sp.FromTape(t.ID,t.type,t.arguments),3296154744:t=>Ap.FromTape(t.ID,t.type,t.arguments),2197970202:t=>Cp.FromTape(t.ID,t.type,t.arguments),2611217952:t=>Fp.FromTape(t.ID,t.type,t.arguments),2937912522:t=>Op.FromTape(t.ID,t.type,t.arguments),1383045692:t=>Rp.FromTape(t.ID,t.type,t.arguments),1062206242:t=>Lp.FromTape(t.ID,t.type,t.arguments),1677625105:t=>Np.FromTape(t.ID,t.type,t.arguments),3893394355:t=>Bp.FromTape(t.ID,t.type,t.arguments),747523909:t=>kp.FromTape(t.ID,t.type,t.arguments),647927063:t=>jp.FromTape(t.ID,t.type,t.arguments),2205249479:t=>Gp.FromTape(t.ID,t.type,t.arguments),639361253:t=>Hp.FromTape(t.ID,t.type,t.arguments),2301859152:t=>Vp.FromTape(t.ID,t.type,t.arguments),776857604:t=>zp.FromTape(t.ID,t.type,t.arguments),3285139300:t=>Up.FromTape(t.ID,t.type,t.arguments),3264961684:t=>Xp.FromTape(t.ID,t.type,t.arguments),843113511:t=>Wp.FromTape(t.ID,t.type,t.arguments),905975707:t=>Yp.FromTape(t.ID,t.type,t.arguments),300633059:t=>Kp.FromTape(t.ID,t.type,t.arguments),3221913625:t=>Zp.FromTape(t.ID,t.type,t.arguments),400855858:t=>qp.FromTape(t.ID,t.type,t.arguments),2542286263:t=>$p.FromTape(t.ID,t.type,t.arguments),3875453745:t=>Qp.FromTape(t.ID,t.type,t.arguments),3732776249:t=>Jp.FromTape(t.ID,t.type,t.arguments),15328376:t=>tc.FromTape(t.ID,t.type,t.arguments),2485617015:t=>ec.FromTape(t.ID,t.type,t.arguments),1485152156:t=>sc.FromTape(t.ID,t.type,t.arguments),3571504051:t=>ic.FromTape(t.ID,t.type,t.arguments),3850581409:t=>rc.FromTape(t.ID,t.type,t.arguments),2272882330:t=>oc.FromTape(t.ID,t.type,t.arguments),2816379211:t=>nc.FromTape(t.ID,t.type,t.arguments),2510884976:t=>ac.FromTape(t.ID,t.type,t.arguments),370225590:t=>hc.FromTape(t.ID,t.type,t.arguments),1981873012:t=>lc.FromTape(t.ID,t.type,t.arguments),2859738748:t=>uc.FromTape(t.ID,t.type,t.arguments),45288368:t=>pc.FromTape(t.ID,t.type,t.arguments),2614616156:t=>cc.FromTape(t.ID,t.type,t.arguments),2732653382:t=>dc.FromTape(t.ID,t.type,t.arguments),775493141:t=>mc.FromTape(t.ID,t.type,t.arguments),1959218052:t=>fc.FromTape(t.ID,t.type,t.arguments),3898045240:t=>gc.FromTape(t.ID,t.type,t.arguments),2185764099:t=>_c.FromTape(t.ID,t.type,t.arguments),1060000209:t=>yc.FromTape(t.ID,t.type,t.arguments),4105962743:t=>vc.FromTape(t.ID,t.type,t.arguments),488727124:t=>bc.FromTape(t.ID,t.type,t.arguments),1525564444:t=>Pc.FromTape(t.ID,t.type,t.arguments),2559216714:t=>Tc.FromTape(t.ID,t.type,t.arguments),2574617495:t=>wc.FromTape(t.ID,t.type,t.arguments),3419103109:t=>xc.FromTape(t.ID,t.type,t.arguments),3050246964:t=>Mc.FromTape(t.ID,t.type,t.arguments),3293443760:t=>Dc.FromTape(t.ID,t.type,t.arguments),25142252:t=>Ec.FromTape(t.ID,t.type,t.arguments),578613899:t=>Ic.FromTape(t.ID,t.type,t.arguments),2889183280:t=>Sc.FromTape(t.ID,t.type,t.arguments),2713554722:t=>Ac.FromTape(t.ID,t.type,t.arguments),4136498852:t=>Cc.FromTape(t.ID,t.type,t.arguments),335055490:t=>Fc.FromTape(t.ID,t.type,t.arguments),3640358203:t=>Oc.FromTape(t.ID,t.type,t.arguments),2954562838:t=>Rc.FromTape(t.ID,t.type,t.arguments),1785450214:t=>Lc.FromTape(t.ID,t.type,t.arguments),1466758467:t=>Nc.FromTape(t.ID,t.type,t.arguments),3895139033:t=>Bc.FromTape(t.ID,t.type,t.arguments),1419761937:t=>kc.FromTape(t.ID,t.type,t.arguments),602808272:t=>jc.FromTape(t.ID,t.type,t.arguments),1973544240:t=>Gc.FromTape(t.ID,t.type,t.arguments),1916426348:t=>Hc.FromTape(t.ID,t.type,t.arguments),3295246426:t=>Vc.FromTape(t.ID,t.type,t.arguments),1815067380:t=>zc.FromTape(t.ID,t.type,t.arguments),2506170314:t=>Uc.FromTape(t.ID,t.type,t.arguments),2147822146:t=>Xc.FromTape(t.ID,t.type,t.arguments),539742890:t=>Wc.FromTape(t.ID,t.type,t.arguments),3495092785:t=>Yc.FromTape(t.ID,t.type,t.arguments),1457835157:t=>Kc.FromTape(t.ID,t.type,t.arguments),2601014836:t=>Zc.FromTape(t.ID,t.type,t.arguments),2827736869:t=>qc.FromTape(t.ID,t.type,t.arguments),2629017746:t=>$c.FromTape(t.ID,t.type,t.arguments),1186437898:t=>Qc.FromTape(t.ID,t.type,t.arguments),3800577675:t=>Jc.FromTape(t.ID,t.type,t.arguments),1105321065:t=>td.FromTape(t.ID,t.type,t.arguments),2367409068:t=>ed.FromTape(t.ID,t.type,t.arguments),3510044353:t=>sd.FromTape(t.ID,t.type,t.arguments),1213902940:t=>id.FromTape(t.ID,t.type,t.arguments),4074379575:t=>rd.FromTape(t.ID,t.type,t.arguments),3961806047:t=>od.FromTape(t.ID,t.type,t.arguments),3426335179:t=>nd.FromTape(t.ID,t.type,t.arguments),1306400036:t=>ad.FromTape(t.ID,t.type,t.arguments),3632507154:t=>hd.FromTape(t.ID,t.type,t.arguments),1765591967:t=>ld.FromTape(t.ID,t.type,t.arguments),1045800335:t=>ud.FromTape(t.ID,t.type,t.arguments),2949456006:t=>pd.FromTape(t.ID,t.type,t.arguments),32440307:t=>cd.FromTape(t.ID,t.type,t.arguments),1335981549:t=>dd.FromTape(t.ID,t.type,t.arguments),2635815018:t=>md.FromTape(t.ID,t.type,t.arguments),1945343521:t=>fd.FromTape(t.ID,t.type,t.arguments),1052013943:t=>gd.FromTape(t.ID,t.type,t.arguments),1599208980:t=>_d.FromTape(t.ID,t.type,t.arguments),562808652:t=>yd.FromTape(t.ID,t.type,t.arguments),1062813311:t=>vd.FromTape(t.ID,t.type,t.arguments),2063403501:t=>bd.FromTape(t.ID,t.type,t.arguments),1945004755:t=>Pd.FromTape(t.ID,t.type,t.arguments),3256556792:t=>Td.FromTape(t.ID,t.type,t.arguments),3040386961:t=>wd.FromTape(t.ID,t.type,t.arguments),3849074793:t=>xd.FromTape(t.ID,t.type,t.arguments),3041715199:t=>Md.FromTape(t.ID,t.type,t.arguments),3205830791:t=>Dd.FromTape(t.ID,t.type,t.arguments),1154170062:t=>Ed.FromTape(t.ID,t.type,t.arguments),770865208:t=>Id.FromTape(t.ID,t.type,t.arguments),3732053477:t=>Sd.FromTape(t.ID,t.type,t.arguments),395920057:t=>Ad.FromTape(t.ID,t.type,t.arguments),2963535650:t=>Cd.FromTape(t.ID,t.type,t.arguments),1714330368:t=>Fd.FromTape(t.ID,t.type,t.arguments),3242481149:t=>Od.FromTape(t.ID,t.type,t.arguments),526551008:t=>Rd.FromTape(t.ID,t.type,t.arguments),2323601079:t=>Ld.FromTape(t.ID,t.type,t.arguments),445594917:t=>Nd.FromTape(t.ID,t.type,t.arguments),4006246654:t=>Bd.FromTape(t.ID,t.type,t.arguments),342316401:t=>kd.FromTape(t.ID,t.type,t.arguments),869906466:t=>jd.FromTape(t.ID,t.type,t.arguments),3518393246:t=>Gd.FromTape(t.ID,t.type,t.arguments),3760055223:t=>Hd.FromTape(t.ID,t.type,t.arguments),1360408905:t=>Vd.FromTape(t.ID,t.type,t.arguments),2030761528:t=>zd.FromTape(t.ID,t.type,t.arguments),3900360178:t=>Ud.FromTape(t.ID,t.type,t.arguments),476780140:t=>Xd.FromTape(t.ID,t.type,t.arguments),1472233963:t=>Wd.FromTape(t.ID,t.type,t.arguments),1904799276:t=>Yd.FromTape(t.ID,t.type,t.arguments),663422040:t=>Kd.FromTape(t.ID,t.type,t.arguments),862014818:t=>Zd.FromTape(t.ID,t.type,t.arguments),2417008758:t=>qd.FromTape(t.ID,t.type,t.arguments),3310460725:t=>$d.FromTape(t.ID,t.type,t.arguments),3277789161:t=>Qd.FromTape(t.ID,t.type,t.arguments),264262732:t=>Jd.FromTape(t.ID,t.type,t.arguments),1534661035:t=>tm.FromTape(t.ID,t.type,t.arguments),402227799:t=>em.FromTape(t.ID,t.type,t.arguments),1217240411:t=>sm.FromTape(t.ID,t.type,t.arguments),1003880860:t=>im.FromTape(t.ID,t.type,t.arguments),712377611:t=>rm.FromTape(t.ID,t.type,t.arguments),1758889154:t=>om.FromTape(t.ID,t.type,t.arguments),4123344466:t=>nm.FromTape(t.ID,t.type,t.arguments),2397081782:t=>am.FromTape(t.ID,t.type,t.arguments),1623761950:t=>hm.FromTape(t.ID,t.type,t.arguments),2590856083:t=>lm.FromTape(t.ID,t.type,t.arguments),1883228015:t=>um.FromTape(t.ID,t.type,t.arguments),339256511:t=>pm.FromTape(t.ID,t.type,t.arguments),2777663545:t=>cm.FromTape(t.ID,t.type,t.arguments),1704287377:t=>dm.FromTape(t.ID,t.type,t.arguments),2835456948:t=>mm.FromTape(t.ID,t.type,t.arguments),1658829314:t=>fm.FromTape(t.ID,t.type,t.arguments),2107101300:t=>gm.FromTape(t.ID,t.type,t.arguments),2814081492:t=>_m.FromTape(t.ID,t.type,t.arguments),132023988:t=>ym.FromTape(t.ID,t.type,t.arguments),3747195512:t=>vm.FromTape(t.ID,t.type,t.arguments),3174744832:t=>bm.FromTape(t.ID,t.type,t.arguments),484807127:t=>Pm.FromTape(t.ID,t.type,t.arguments),3390157468:t=>Tm.FromTape(t.ID,t.type,t.arguments),4148101412:t=>wm.FromTape(t.ID,t.type,t.arguments),211053100:t=>xm.FromTape(t.ID,t.type,t.arguments),4024345920:t=>Mm.FromTape(t.ID,t.type,t.arguments),297599258:t=>Dm.FromTape(t.ID,t.type,t.arguments),4294318154:t=>Em.FromTape(t.ID,t.type,t.arguments),3200245327:t=>Im.FromTape(t.ID,t.type,t.arguments),1437805879:t=>Sm.FromTape(t.ID,t.type,t.arguments),1209101575:t=>Am.FromTape(t.ID,t.type,t.arguments),2853485674:t=>Cm.FromTape(t.ID,t.type,t.arguments),2242383968:t=>Fm.FromTape(t.ID,t.type,t.arguments),1040185647:t=>Om.FromTape(t.ID,t.type,t.arguments),3548104201:t=>Rm.FromTape(t.ID,t.type,t.arguments),477187591:t=>Lm.FromTape(t.ID,t.type,t.arguments),2804161546:t=>Nm.FromTape(t.ID,t.type,t.arguments),2556980723:t=>Bm.FromTape(t.ID,t.type,t.arguments),2047409740:t=>km.FromTape(t.ID,t.type,t.arguments),1809719519:t=>jm.FromTape(t.ID,t.type,t.arguments),803316827:t=>Gm.FromTape(t.ID,t.type,t.arguments),3008276851:t=>Hm.FromTape(t.ID,t.type,t.arguments),807026263:t=>Vm.FromTape(t.ID,t.type,t.arguments),3737207727:t=>zm.FromTape(t.ID,t.type,t.arguments),24185140:t=>Um.FromTape(t.ID,t.type,t.arguments),1310830890:t=>Xm.FromTape(t.ID,t.type,t.arguments),4219587988:t=>Wm.FromTape(t.ID,t.type,t.arguments),3415622556:t=>Ym.FromTape(t.ID,t.type,t.arguments),346874300:t=>Km.FromTape(t.ID,t.type,t.arguments),647756555:t=>Zm.FromTape(t.ID,t.type,t.arguments),2489546625:t=>qm.FromTape(t.ID,t.type,t.arguments),2827207264:t=>$m.FromTape(t.ID,t.type,t.arguments),2143335405:t=>Qm.FromTape(t.ID,t.type,t.arguments),1287392070:t=>Jm.FromTape(t.ID,t.type,t.arguments),738692330:t=>tf.FromTape(t.ID,t.type,t.arguments),374418227:t=>ef.FromTape(t.ID,t.type,t.arguments),315944413:t=>sf.FromTape(t.ID,t.type,t.arguments),819412036:t=>rf.FromTape(t.ID,t.type,t.arguments),1810631287:t=>of.FromTape(t.ID,t.type,t.arguments),1426591983:t=>nf.FromTape(t.ID,t.type,t.arguments),4222183408:t=>af.FromTape(t.ID,t.type,t.arguments),2652556860:t=>hf.FromTape(t.ID,t.type,t.arguments),2058353004:t=>lf.FromTape(t.ID,t.type,t.arguments),3907093117:t=>uf.FromTape(t.ID,t.type,t.arguments),4278956645:t=>pf.FromTape(t.ID,t.type,t.arguments),3198132628:t=>cf.FromTape(t.ID,t.type,t.arguments),182646315:t=>df.FromTape(t.ID,t.type,t.arguments),4037862832:t=>mf.FromTape(t.ID,t.type,t.arguments),2188021234:t=>ff.FromTape(t.ID,t.type,t.arguments),3815607619:t=>gf.FromTape(t.ID,t.type,t.arguments),3132237377:t=>_f.FromTape(t.ID,t.type,t.arguments),1482959167:t=>yf.FromTape(t.ID,t.type,t.arguments),987401354:t=>vf.FromTape(t.ID,t.type,t.arguments),1834744321:t=>bf.FromTape(t.ID,t.type,t.arguments),707683696:t=>Pf.FromTape(t.ID,t.type,t.arguments),1339347760:t=>Tf.FromTape(t.ID,t.type,t.arguments),2223149337:t=>wf.FromTape(t.ID,t.type,t.arguments),2297155007:t=>xf.FromTape(t.ID,t.type,t.arguments),3508470533:t=>Mf.FromTape(t.ID,t.type,t.arguments),3009222698:t=>Df.FromTape(t.ID,t.type,t.arguments),900683007:t=>Ef.FromTape(t.ID,t.type,t.arguments),1893162501:t=>If.FromTape(t.ID,t.type,t.arguments),263784265:t=>Sf.FromTape(t.ID,t.type,t.arguments),4238390223:t=>Af.FromTape(t.ID,t.type,t.arguments),1509553395:t=>Cf.FromTape(t.ID,t.type,t.arguments),1268542332:t=>Ff.FromTape(t.ID,t.type,t.arguments),3493046030:t=>Of.FromTape(t.ID,t.type,t.arguments),4095422895:t=>Rf.FromTape(t.ID,t.type,t.arguments),987898635:t=>Lf.FromTape(t.ID,t.type,t.arguments),3448662350:t=>Nf.FromTape(t.ID,t.type,t.arguments),2453401579:t=>Bf.FromTape(t.ID,t.type,t.arguments),4142052618:t=>kf.FromTape(t.ID,t.type,t.arguments),3590301190:t=>jf.FromTape(t.ID,t.type,t.arguments),3009204131:t=>Gf.FromTape(t.ID,t.type,t.arguments),852622518:t=>Hf.FromTape(t.ID,t.type,t.arguments),178086475:t=>Vf.FromTape(t.ID,t.type,t.arguments),2706460486:t=>zf.FromTape(t.ID,t.type,t.arguments),812098782:t=>Uf.FromTape(t.ID,t.type,t.arguments),3319311131:t=>Xf.FromTape(t.ID,t.type,t.arguments),1251058090:t=>Wf.FromTape(t.ID,t.type,t.arguments),2068733104:t=>Yf.FromTape(t.ID,t.type,t.arguments),1806887404:t=>Kf.FromTape(t.ID,t.type,t.arguments),1484403080:t=>Zf.FromTape(t.ID,t.type,t.arguments),3905492369:t=>qf.FromTape(t.ID,t.type,t.arguments),3570813810:t=>$f.FromTape(t.ID,t.type,t.arguments),2571569899:t=>Qf.FromTape(t.ID,t.type,t.arguments),178912537:t=>Jf.FromTape(t.ID,t.type,t.arguments),2294589976:t=>tg.FromTape(t.ID,t.type,t.arguments),1437953363:t=>eg.FromTape(t.ID,t.type,t.arguments),2133299955:t=>sg.FromTape(t.ID,t.type,t.arguments),4175244083:t=>ig.FromTape(t.ID,t.type,t.arguments),3946677679:t=>rg.FromTape(t.ID,t.type,t.arguments),3113134337:t=>og.FromTape(t.ID,t.type,t.arguments),2391368822:t=>ng.FromTape(t.ID,t.type,t.arguments),3741457305:t=>ag.FromTape(t.ID,t.type,t.arguments),3020489413:t=>hg.FromTape(t.ID,t.type,t.arguments),2176052936:t=>lg.FromTape(t.ID,t.type,t.arguments),4288270099:t=>ug.FromTape(t.ID,t.type,t.arguments),572779678:t=>pg.FromTape(t.ID,t.type,t.arguments),3827777499:t=>cg.FromTape(t.ID,t.type,t.arguments),428585644:t=>dg.FromTape(t.ID,t.type,t.arguments),1585845231:t=>mg.FromTape(t.ID,t.type,t.arguments),76236018:t=>fg.FromTape(t.ID,t.type,t.arguments),1051575348:t=>gg.FromTape(t.ID,t.type,t.arguments),2655187982:t=>_g.FromTape(t.ID,t.type,t.arguments),3452421091:t=>yg.FromTape(t.ID,t.type,t.arguments),4162380809:t=>vg.FromTape(t.ID,t.type,t.arguments),629592764:t=>bg.FromTape(t.ID,t.type,t.arguments),1161773419:t=>Pg.FromTape(t.ID,t.type,t.arguments),1566485204:t=>Tg.FromTape(t.ID,t.type,t.arguments),1402838566:t=>wg.FromTape(t.ID,t.type,t.arguments),125510826:t=>xg.FromTape(t.ID,t.type,t.arguments),2604431987:t=>Mg.FromTape(t.ID,t.type,t.arguments),4266656042:t=>Dg.FromTape(t.ID,t.type,t.arguments),1520743889:t=>Eg.FromTape(t.ID,t.type,t.arguments),3422422726:t=>Ig.FromTape(t.ID,t.type,t.arguments),1281925730:t=>Sg.FromTape(t.ID,t.type,t.arguments),3092502836:t=>Ag.FromTape(t.ID,t.type,t.arguments),388784114:t=>Cg.FromTape(t.ID,t.type,t.arguments),1154579445:t=>Fg.FromTape(t.ID,t.type,t.arguments),2624227202:t=>Og.FromTape(t.ID,t.type,t.arguments),1008929658:t=>Rg.FromTape(t.ID,t.type,t.arguments),1425443689:t=>Lg.FromTape(t.ID,t.type,t.arguments),3057273783:t=>Ng.FromTape(t.ID,t.type,t.arguments),2347385850:t=>Bg.FromTape(t.ID,t.type,t.arguments),1838606355:t=>kg.FromTape(t.ID,t.type,t.arguments),1847130766:t=>jg.FromTape(t.ID,t.type,t.arguments),3708119e3:t=>Gg.FromTape(t.ID,t.type,t.arguments),2852063980:t=>Hg.FromTape(t.ID,t.type,t.arguments),760658860:t=>Vg.FromTape(t.ID,t.type,t.arguments),2022407955:t=>zg.FromTape(t.ID,t.type,t.arguments),248100487:t=>Ug.FromTape(t.ID,t.type,t.arguments),3303938423:t=>Xg.FromTape(t.ID,t.type,t.arguments),1303795690:t=>Wg.FromTape(t.ID,t.type,t.arguments),1847252529:t=>Yg.FromTape(t.ID,t.type,t.arguments),2199411900:t=>Kg.FromTape(t.ID,t.type,t.arguments),2235152071:t=>Zg.FromTape(t.ID,t.type,t.arguments),164193824:t=>qg.FromTape(t.ID,t.type,t.arguments),3079605661:t=>$g.FromTape(t.ID,t.type,t.arguments),3404854881:t=>Qg.FromTape(t.ID,t.type,t.arguments),552965576:t=>Jg.FromTape(t.ID,t.type,t.arguments),3265635763:t=>t_.FromTape(t.ID,t.type,t.arguments),853536259:t=>e_.FromTape(t.ID,t.type,t.arguments),1507914824:t=>s_.FromTape(t.ID,t.type,t.arguments),2597039031:t=>i_.FromTape(t.ID,t.type,t.arguments),377706215:t=>r_.FromTape(t.ID,t.type,t.arguments),2108223431:t=>o_.FromTape(t.ID,t.type,t.arguments),1437502449:t=>n_.FromTape(t.ID,t.type,t.arguments),1114901282:t=>a_.FromTape(t.ID,t.type,t.arguments),1073191201:t=>h_.FromTape(t.ID,t.type,t.arguments),1911478936:t=>l_.FromTape(t.ID,t.type,t.arguments),3181161470:t=>u_.FromTape(t.ID,t.type,t.arguments),3368373690:t=>p_.FromTape(t.ID,t.type,t.arguments),2998442950:t=>c_.FromTape(t.ID,t.type,t.arguments),2706619895:t=>d_.FromTape(t.ID,t.type,t.arguments),2474470126:t=>m_.FromTape(t.ID,t.type,t.arguments),977012517:t=>f_.FromTape(t.ID,t.type,t.arguments),1918398963:t=>g_.FromTape(t.ID,t.type,t.arguments),3888040117:t=>__.FromTape(t.ID,t.type,t.arguments),219451334:t=>y_.FromTape(t.ID,t.type,t.arguments),3701648758:t=>v_.FromTape(t.ID,t.type,t.arguments),2251480897:t=>b_.FromTape(t.ID,t.type,t.arguments),4143007308:t=>P_.FromTape(t.ID,t.type,t.arguments),590820931:t=>T_.FromTape(t.ID,t.type,t.arguments),3388369263:t=>w_.FromTape(t.ID,t.type,t.arguments),3505215534:t=>x_.FromTape(t.ID,t.type,t.arguments),2485787929:t=>M_.FromTape(t.ID,t.type,t.arguments),2665983363:t=>D_.FromTape(t.ID,t.type,t.arguments),3588315303:t=>E_.FromTape(t.ID,t.type,t.arguments),3079942009:t=>I_.FromTape(t.ID,t.type,t.arguments),4251960020:t=>S_.FromTape(t.ID,t.type,t.arguments),1411181986:t=>A_.FromTape(t.ID,t.type,t.arguments),643959842:t=>C_.FromTape(t.ID,t.type,t.arguments),1029017970:t=>F_.FromTape(t.ID,t.type,t.arguments),144952367:t=>O_.FromTape(t.ID,t.type,t.arguments),3694346114:t=>R_.FromTape(t.ID,t.type,t.arguments),2837617999:t=>L_.FromTape(t.ID,t.type,t.arguments),1207048766:t=>N_.FromTape(t.ID,t.type,t.arguments),2529465313:t=>B_.FromTape(t.ID,t.type,t.arguments),2519244187:t=>k_.FromTape(t.ID,t.type,t.arguments),1682466193:t=>j_.FromTape(t.ID,t.type,t.arguments),2382730787:t=>G_.FromTape(t.ID,t.type,t.arguments),3566463478:t=>H_.FromTape(t.ID,t.type,t.arguments),3327091369:t=>V_.FromTape(t.ID,t.type,t.arguments),2077209135:t=>z_.FromTape(t.ID,t.type,t.arguments),101040310:t=>U_.FromTape(t.ID,t.type,t.arguments),3021840470:t=>X_.FromTape(t.ID,t.type,t.arguments),2483315170:t=>W_.FromTape(t.ID,t.type,t.arguments),2226359599:t=>Y_.FromTape(t.ID,t.type,t.arguments),1687234759:t=>K_.FromTape(t.ID,t.type,t.arguments),1158309216:t=>Z_.FromTape(t.ID,t.type,t.arguments),310824031:t=>q_.FromTape(t.ID,t.type,t.arguments),804291784:t=>$_.FromTape(t.ID,t.type,t.arguments),3612865200:t=>Q_.FromTape(t.ID,t.type,t.arguments),4231323485:t=>J_.FromTape(t.ID,t.type,t.arguments),597895409:t=>ty.FromTape(t.ID,t.type,t.arguments),2004835150:t=>ey.FromTape(t.ID,t.type,t.arguments),603570806:t=>sy.FromTape(t.ID,t.type,t.arguments),1663979128:t=>iy.FromTape(t.ID,t.type,t.arguments),220341763:t=>ry.FromTape(t.ID,t.type,t.arguments),3171933400:t=>oy.FromTape(t.ID,t.type,t.arguments),1156407060:t=>ny.FromTape(t.ID,t.type,t.arguments),4017108033:t=>ay.FromTape(t.ID,t.type,t.arguments),2067069095:t=>hy.FromTape(t.ID,t.type,t.arguments),4022376103:t=>ly.FromTape(t.ID,t.type,t.arguments),1423911732:t=>uy.FromTape(t.ID,t.type,t.arguments),2924175390:t=>py.FromTape(t.ID,t.type,t.arguments),2775532180:t=>cy.FromTape(t.ID,t.type,t.arguments),2839578677:t=>dy.FromTape(t.ID,t.type,t.arguments),3724593414:t=>my.FromTape(t.ID,t.type,t.arguments),3740093272:t=>fy.FromTape(t.ID,t.type,t.arguments),1946335990:t=>gy.FromTape(t.ID,t.type,t.arguments),3355820592:t=>_y.FromTape(t.ID,t.type,t.arguments),759155922:t=>yy.FromTape(t.ID,t.type,t.arguments),2559016684:t=>vy.FromTape(t.ID,t.type,t.arguments),3727388367:t=>by.FromTape(t.ID,t.type,t.arguments),3778827333:t=>Py.FromTape(t.ID,t.type,t.arguments),3967405729:t=>Ty.FromTape(t.ID,t.type,t.arguments),1775413392:t=>wy.FromTape(t.ID,t.type,t.arguments),677532197:t=>xy.FromTape(t.ID,t.type,t.arguments),2022622350:t=>My.FromTape(t.ID,t.type,t.arguments),1304840413:t=>Dy.FromTape(t.ID,t.type,t.arguments),3119450353:t=>Ey.FromTape(t.ID,t.type,t.arguments),2417041796:t=>Iy.FromTape(t.ID,t.type,t.arguments),2744685151:t=>Sy.FromTape(t.ID,t.type,t.arguments),569719735:t=>Ay.FromTape(t.ID,t.type,t.arguments),2945172077:t=>Cy.FromTape(t.ID,t.type,t.arguments),4208778838:t=>Fy.FromTape(t.ID,t.type,t.arguments),673634403:t=>Oy.FromTape(t.ID,t.type,t.arguments),2095639259:t=>Ry.FromTape(t.ID,t.type,t.arguments),3958567839:t=>Ly.FromTape(t.ID,t.type,t.arguments),2802850158:t=>Ny.FromTape(t.ID,t.type,t.arguments),103090709:t=>By.FromTape(t.ID,t.type,t.arguments),653396225:t=>ky.FromTape(t.ID,t.type,t.arguments),2904328755:t=>jy.FromTape(t.ID,t.type,t.arguments),3843373140:t=>Gy.FromTape(t.ID,t.type,t.arguments),3651124850:t=>Hy.FromTape(t.ID,t.type,t.arguments),2598011224:t=>Vy.FromTape(t.ID,t.type,t.arguments),986844984:t=>zy.FromTape(t.ID,t.type,t.arguments),871118103:t=>Uy.FromTape(t.ID,t.type,t.arguments),1680319473:t=>Xy.FromTape(t.ID,t.type,t.arguments),148025276:t=>Wy.FromTape(t.ID,t.type,t.arguments),4166981789:t=>Yy.FromTape(t.ID,t.type,t.arguments),3710013099:t=>Ky.FromTape(t.ID,t.type,t.arguments),2752243245:t=>Zy.FromTape(t.ID,t.type,t.arguments),941946838:t=>qy.FromTape(t.ID,t.type,t.arguments),1451395588:t=>$y.FromTape(t.ID,t.type,t.arguments),3357820518:t=>Qy.FromTape(t.ID,t.type,t.arguments),492091185:t=>Jy.FromTape(t.ID,t.type,t.arguments),3650150729:t=>tv.FromTape(t.ID,t.type,t.arguments),110355661:t=>ev.FromTape(t.ID,t.type,t.arguments),3521284610:t=>sv.FromTape(t.ID,t.type,t.arguments),1482703590:t=>iv.FromTape(t.ID,t.type,t.arguments),738039164:t=>rv.FromTape(t.ID,t.type,t.arguments),2295281155:t=>ov.FromTape(t.ID,t.type,t.arguments),655969474:t=>nv.FromTape(t.ID,t.type,t.arguments),1842657554:t=>av.FromTape(t.ID,t.type,t.arguments),3219374653:t=>hv.FromTape(t.ID,t.type,t.arguments),90941305:t=>lv.FromTape(t.ID,t.type,t.arguments),2250791053:t=>uv.FromTape(t.ID,t.type,t.arguments),2044713172:t=>pv.FromTape(t.ID,t.type,t.arguments),2093928680:t=>cv.FromTape(t.ID,t.type,t.arguments),931644368:t=>dv.FromTape(t.ID,t.type,t.arguments),2090586900:t=>mv.FromTape(t.ID,t.type,t.arguments),3252649465:t=>fv.FromTape(t.ID,t.type,t.arguments),2405470396:t=>gv.FromTape(t.ID,t.type,t.arguments),825690147:t=>_v.FromTape(t.ID,t.type,t.arguments),2262370178:t=>yv.FromTape(t.ID,t.type,t.arguments),2893384427:t=>vv.FromTape(t.ID,t.type,t.arguments),3024970846:t=>bv.FromTape(t.ID,t.type,t.arguments),3283111854:t=>Pv.FromTape(t.ID,t.type,t.arguments),2324767716:t=>Tv.FromTape(t.ID,t.type,t.arguments),1469900589:t=>wv.FromTape(t.ID,t.type,t.arguments),1232101972:t=>xv.FromTape(t.ID,t.type,t.arguments),683857671:t=>Mv.FromTape(t.ID,t.type,t.arguments),2770003689:t=>Dv.FromTape(t.ID,t.type,t.arguments),3615266464:t=>Ev.FromTape(t.ID,t.type,t.arguments),2798486643:t=>Iv.FromTape(t.ID,t.type,t.arguments),3454111270:t=>Sv.FromTape(t.ID,t.type,t.arguments),3915482550:t=>Av.FromTape(t.ID,t.type,t.arguments),2433181523:t=>Cv.FromTape(t.ID,t.type,t.arguments),4021432810:t=>Fv.FromTape(t.ID,t.type,t.arguments),3413951693:t=>Ov.FromTape(t.ID,t.type,t.arguments),1580146022:t=>Rv.FromTape(t.ID,t.type,t.arguments),3765753017:t=>Lv.FromTape(t.ID,t.type,t.arguments),979691226:t=>Nv.FromTape(t.ID,t.type,t.arguments),2572171363:t=>Bv.FromTape(t.ID,t.type,t.arguments),3027567501:t=>kv.FromTape(t.ID,t.type,t.arguments),964333572:t=>jv.FromTape(t.ID,t.type,t.arguments),2320036040:t=>Gv.FromTape(t.ID,t.type,t.arguments),2310774935:t=>Hv.FromTape(t.ID,t.type,t.arguments),160246688:t=>Vv.FromTape(t.ID,t.type,t.arguments),3939117080:t=>zv.FromTape(t.ID,t.type,t.arguments),1683148259:t=>Uv.FromTape(t.ID,t.type,t.arguments),2495723537:t=>Xv.FromTape(t.ID,t.type,t.arguments),1307041759:t=>Wv.FromTape(t.ID,t.type,t.arguments),1027710054:t=>Yv.FromTape(t.ID,t.type,t.arguments),4278684876:t=>Kv.FromTape(t.ID,t.type,t.arguments),2857406711:t=>Zv.FromTape(t.ID,t.type,t.arguments),205026976:t=>qv.FromTape(t.ID,t.type,t.arguments),1865459582:t=>$v.FromTape(t.ID,t.type,t.arguments),4095574036:t=>Qv.FromTape(t.ID,t.type,t.arguments),919958153:t=>Jv.FromTape(t.ID,t.type,t.arguments),2728634034:t=>tb.FromTape(t.ID,t.type,t.arguments),982818633:t=>eb.FromTape(t.ID,t.type,t.arguments),3840914261:t=>sb.FromTape(t.ID,t.type,t.arguments),2655215786:t=>ib.FromTape(t.ID,t.type,t.arguments),826625072:t=>rb.FromTape(t.ID,t.type,t.arguments),1204542856:t=>ob.FromTape(t.ID,t.type,t.arguments),3945020480:t=>nb.FromTape(t.ID,t.type,t.arguments),4201705270:t=>ab.FromTape(t.ID,t.type,t.arguments),3190031847:t=>hb.FromTape(t.ID,t.type,t.arguments),2127690289:t=>lb.FromTape(t.ID,t.type,t.arguments),1638771189:t=>ub.FromTape(t.ID,t.type,t.arguments),504942748:t=>pb.FromTape(t.ID,t.type,t.arguments),3678494232:t=>cb.FromTape(t.ID,t.type,t.arguments),3242617779:t=>db.FromTape(t.ID,t.type,t.arguments),886880790:t=>mb.FromTape(t.ID,t.type,t.arguments),2802773753:t=>fb.FromTape(t.ID,t.type,t.arguments),2565941209:t=>gb.FromTape(t.ID,t.type,t.arguments),2551354335:t=>_b.FromTape(t.ID,t.type,t.arguments),693640335:t=>yb.FromTape(t.ID,t.type,t.arguments),1462361463:t=>vb.FromTape(t.ID,t.type,t.arguments),4186316022:t=>bb.FromTape(t.ID,t.type,t.arguments),307848117:t=>Pb.FromTape(t.ID,t.type,t.arguments),781010003:t=>Tb.FromTape(t.ID,t.type,t.arguments),3940055652:t=>wb.FromTape(t.ID,t.type,t.arguments),279856033:t=>xb.FromTape(t.ID,t.type,t.arguments),427948657:t=>Mb.FromTape(t.ID,t.type,t.arguments),3268803585:t=>Db.FromTape(t.ID,t.type,t.arguments),1441486842:t=>Eb.FromTape(t.ID,t.type,t.arguments),750771296:t=>Ib.FromTape(t.ID,t.type,t.arguments),1245217292:t=>Sb.FromTape(t.ID,t.type,t.arguments),4122056220:t=>Ab.FromTape(t.ID,t.type,t.arguments),366585022:t=>Cb.FromTape(t.ID,t.type,t.arguments),3451746338:t=>Fb.FromTape(t.ID,t.type,t.arguments),3523091289:t=>Ob.FromTape(t.ID,t.type,t.arguments),1521410863:t=>Rb.FromTape(t.ID,t.type,t.arguments),1401173127:t=>Lb.FromTape(t.ID,t.type,t.arguments),478536968:t=>Nb.FromTape(t.ID,t.type,t.arguments),816062949:t=>Bb.FromTape(t.ID,t.type,t.arguments),1076942058:t=>kb.FromTape(t.ID,t.type,t.arguments),3377609919:t=>jb.FromTape(t.ID,t.type,t.arguments),3008791417:t=>Gb.FromTape(t.ID,t.type,t.arguments),1660063152:t=>Hb.FromTape(t.ID,t.type,t.arguments),2914609552:t=>Vb.FromTape(t.ID,t.type,t.arguments),2943643501:t=>zb.FromTape(t.ID,t.type,t.arguments),1608871552:t=>Ub.FromTape(t.ID,t.type,t.arguments),2439245199:t=>Xb.FromTape(t.ID,t.type,t.arguments),1042787934:t=>Wb.FromTape(t.ID,t.type,t.arguments),1856042241:t=>Yb.FromTape(t.ID,t.type,t.arguments),3243963512:t=>Kb.FromTape(t.ID,t.type,t.arguments),4158566097:t=>Zb.FromTape(t.ID,t.type,t.arguments),3626867408:t=>qb.FromTape(t.ID,t.type,t.arguments),2016517767:t=>$b.FromTape(t.ID,t.type,t.arguments),2781568857:t=>Qb.FromTape(t.ID,t.type,t.arguments),2341007311:t=>Jb.FromTape(t.ID,t.type,t.arguments),2778083089:t=>tP.FromTape(t.ID,t.type,t.arguments),448429030:t=>eP.FromTape(t.ID,t.type,t.arguments),3053780830:t=>sP.FromTape(t.ID,t.type,t.arguments),1768891740:t=>iP.FromTape(t.ID,t.type,t.arguments),1054537805:t=>rP.FromTape(t.ID,t.type,t.arguments),2157484638:t=>oP.FromTape(t.ID,t.type,t.arguments),2042790032:t=>nP.FromTape(t.ID,t.type,t.arguments),4165799628:t=>aP.FromTape(t.ID,t.type,t.arguments),1862484736:t=>hP.FromTape(t.ID,t.type,t.arguments),1290935644:t=>lP.FromTape(t.ID,t.type,t.arguments),1509187699:t=>uP.FromTape(t.ID,t.type,t.arguments),4086658281:t=>pP.FromTape(t.ID,t.type,t.arguments),1783015770:t=>cP.FromTape(t.ID,t.type,t.arguments),1329646415:t=>dP.FromTape(t.ID,t.type,t.arguments),4074543187:t=>mP.FromTape(t.ID,t.type,t.arguments),867548509:t=>fP.FromTape(t.ID,t.type,t.arguments),3982875396:t=>gP.FromTape(t.ID,t.type,t.arguments),4240577450:t=>_P.FromTape(t.ID,t.type,t.arguments),4124623270:t=>yP.FromTape(t.ID,t.type,t.arguments),3692461612:t=>vP.FromTape(t.ID,t.type,t.arguments),3663146110:t=>bP.FromTape(t.ID,t.type,t.arguments),4097777520:t=>PP.FromTape(t.ID,t.type,t.arguments),1529196076:t=>TP.FromTape(t.ID,t.type,t.arguments),3127900445:t=>wP.FromTape(t.ID,t.type,t.arguments),3027962421:t=>xP.FromTape(t.ID,t.type,t.arguments),2533589738:t=>MP.FromTape(t.ID,t.type,t.arguments),2609359061:t=>DP.FromTape(t.ID,t.type,t.arguments),3420628829:t=>EP.FromTape(t.ID,t.type,t.arguments),1072016465:t=>IP.FromTape(t.ID,t.type,t.arguments),723233188:t=>SP.FromTape(t.ID,t.type,t.arguments),3856911033:t=>AP.FromTape(t.ID,t.type,t.arguments),1999602285:t=>CP.FromTape(t.ID,t.type,t.arguments),1305183839:t=>FP.FromTape(t.ID,t.type,t.arguments),3812236995:t=>OP.FromTape(t.ID,t.type,t.arguments),1412071761:t=>RP.FromTape(t.ID,t.type,t.arguments),710998568:t=>LP.FromTape(t.ID,t.type,t.arguments),2706606064:t=>NP.FromTape(t.ID,t.type,t.arguments),3893378262:t=>BP.FromTape(t.ID,t.type,t.arguments),463610769:t=>kP.FromTape(t.ID,t.type,t.arguments),2481509218:t=>jP.FromTape(t.ID,t.type,t.arguments),451544542:t=>GP.FromTape(t.ID,t.type,t.arguments),4015995234:t=>HP.FromTape(t.ID,t.type,t.arguments),1404847402:t=>VP.FromTape(t.ID,t.type,t.arguments),3112655638:t=>zP.FromTape(t.ID,t.type,t.arguments),331165859:t=>UP.FromTape(t.ID,t.type,t.arguments),4252922144:t=>XP.FromTape(t.ID,t.type,t.arguments),1039846685:t=>WP.FromTape(t.ID,t.type,t.arguments),338393293:t=>YP.FromTape(t.ID,t.type,t.arguments),682877961:t=>KP.FromTape(t.ID,t.type,t.arguments),3544373492:t=>ZP.FromTape(t.ID,t.type,t.arguments),2515109513:t=>qP.FromTape(t.ID,t.type,t.arguments),1179482911:t=>$P.FromTape(t.ID,t.type,t.arguments),2273995522:t=>QP.FromTape(t.ID,t.type,t.arguments),1004757350:t=>JP.FromTape(t.ID,t.type,t.arguments),4243806635:t=>tT.FromTape(t.ID,t.type,t.arguments),214636428:t=>eT.FromTape(t.ID,t.type,t.arguments),2445595289:t=>sT.FromTape(t.ID,t.type,t.arguments),2757150158:t=>iT.FromTape(t.ID,t.type,t.arguments),3136571912:t=>rT.FromTape(t.ID,t.type,t.arguments),1807405624:t=>oT.FromTape(t.ID,t.type,t.arguments),2162789131:t=>nT.FromTape(t.ID,t.type,t.arguments),385403989:t=>aT.FromTape(t.ID,t.type,t.arguments),3478079324:t=>hT.FromTape(t.ID,t.type,t.arguments),1252848954:t=>lT.FromTape(t.ID,t.type,t.arguments),1595516126:t=>uT.FromTape(t.ID,t.type,t.arguments),609421318:t=>pT.FromTape(t.ID,t.type,t.arguments),2668620305:t=>cT.FromTape(t.ID,t.type,t.arguments),2473145415:t=>dT.FromTape(t.ID,t.type,t.arguments),1973038258:t=>mT.FromTape(t.ID,t.type,t.arguments),1597423693:t=>fT.FromTape(t.ID,t.type,t.arguments),1190533807:t=>gT.FromTape(t.ID,t.type,t.arguments),2525727697:t=>_T.FromTape(t.ID,t.type,t.arguments),3408363356:t=>yT.FromTape(t.ID,t.type,t.arguments),530289379:t=>vT.FromTape(t.ID,t.type,t.arguments),1621171031:t=>bT.FromTape(t.ID,t.type,t.arguments),2082059205:t=>PT.FromTape(t.ID,t.type,t.arguments),734778138:t=>TT.FromTape(t.ID,t.type,t.arguments),1235345126:t=>wT.FromTape(t.ID,t.type,t.arguments),3689010777:t=>xT.FromTape(t.ID,t.type,t.arguments),2986769608:t=>MT.FromTape(t.ID,t.type,t.arguments),3657597509:t=>DT.FromTape(t.ID,t.type,t.arguments),1975003073:t=>ET.FromTape(t.ID,t.type,t.arguments),3979015343:t=>IT.FromTape(t.ID,t.type,t.arguments),2218152070:t=>ST.FromTape(t.ID,t.type,t.arguments),603775116:t=>AT.FromTape(t.ID,t.type,t.arguments),2830218821:t=>CT.FromTape(t.ID,t.type,t.arguments),3958052878:t=>FT.FromTape(t.ID,t.type,t.arguments),3049322572:t=>OT.FromTape(t.ID,t.type,t.arguments),148013059:t=>RT.FromTape(t.ID,t.type,t.arguments),4095615324:t=>LT.FromTape(t.ID,t.type,t.arguments),2233826070:t=>NT.FromTape(t.ID,t.type,t.arguments),2513912981:t=>BT.FromTape(t.ID,t.type,t.arguments),699246055:t=>kT.FromTape(t.ID,t.type,t.arguments),2028607225:t=>jT.FromTape(t.ID,t.type,t.arguments),3101698114:t=>GT.FromTape(t.ID,t.type,t.arguments),2809605785:t=>HT.FromTape(t.ID,t.type,t.arguments),4124788165:t=>VT.FromTape(t.ID,t.type,t.arguments),2934153892:t=>zT.FromTape(t.ID,t.type,t.arguments),1300840506:t=>UT.FromTape(t.ID,t.type,t.arguments),3303107099:t=>XT.FromTape(t.ID,t.type,t.arguments),1607154358:t=>WT.FromTape(t.ID,t.type,t.arguments),1878645084:t=>YT.FromTape(t.ID,t.type,t.arguments),846575682:t=>KT.FromTape(t.ID,t.type,t.arguments),1351298697:t=>ZT.FromTape(t.ID,t.type,t.arguments),626085974:t=>qT.FromTape(t.ID,t.type,t.arguments),2247615214:t=>$T.FromTape(t.ID,t.type,t.arguments),1260650574:t=>QT.FromTape(t.ID,t.type,t.arguments),1096409881:t=>JT.FromTape(t.ID,t.type,t.arguments),230924584:t=>tw.FromTape(t.ID,t.type,t.arguments),1162798199:t=>ew.FromTape(t.ID,t.type,t.arguments),2315554128:t=>sw.FromTape(t.ID,t.type,t.arguments),2254336722:t=>iw.FromTape(t.ID,t.type,t.arguments),413509423:t=>rw.FromTape(t.ID,t.type,t.arguments),1580310250:t=>ow.FromTape(t.ID,t.type,t.arguments),3071757647:t=>nw.FromTape(t.ID,t.type,t.arguments),985171141:t=>aw.FromTape(t.ID,t.type,t.arguments),2043862942:t=>hw.FromTape(t.ID,t.type,t.arguments),531007025:t=>lw.FromTape(t.ID,t.type,t.arguments),812556717:t=>uw.FromTape(t.ID,t.type,t.arguments),5716631:t=>pw.FromTape(t.ID,t.type,t.arguments),3473067441:t=>cw.FromTape(t.ID,t.type,t.arguments),1549132990:t=>dw.FromTape(t.ID,t.type,t.arguments),2771591690:t=>mw.FromTape(t.ID,t.type,t.arguments),3206491090:t=>fw.FromTape(t.ID,t.type,t.arguments),912023232:t=>gw.FromTape(t.ID,t.type,t.arguments),3824725483:t=>_w.FromTape(t.ID,t.type,t.arguments),2347447852:t=>yw.FromTape(t.ID,t.type,t.arguments),3081323446:t=>vw.FromTape(t.ID,t.type,t.arguments),3663046924:t=>bw.FromTape(t.ID,t.type,t.arguments),2281632017:t=>Pw.FromTape(t.ID,t.type,t.arguments),2415094496:t=>Tw.FromTape(t.ID,t.type,t.arguments),2387106220:t=>ww.FromTape(t.ID,t.type,t.arguments),901063453:t=>xw.FromTape(t.ID,t.type,t.arguments),4282788508:t=>Mw.FromTape(t.ID,t.type,t.arguments),3124975700:t=>Dw.FromTape(t.ID,t.type,t.arguments),1447204868:t=>Ew.FromTape(t.ID,t.type,t.arguments),1983826977:t=>Iw.FromTape(t.ID,t.type,t.arguments),2636378356:t=>Sw.FromTape(t.ID,t.type,t.arguments),1640371178:t=>Aw.FromTape(t.ID,t.type,t.arguments),280115917:t=>Cw.FromTape(t.ID,t.type,t.arguments),1742049831:t=>Fw.FromTape(t.ID,t.type,t.arguments),2552916305:t=>Ow.FromTape(t.ID,t.type,t.arguments),1210645708:t=>Rw.FromTape(t.ID,t.type,t.arguments),3611470254:t=>Lw.FromTape(t.ID,t.type,t.arguments),1199560280:t=>Nw.FromTape(t.ID,t.type,t.arguments),3101149627:t=>Bw.FromTape(t.ID,t.type,t.arguments),581633288:t=>kw.FromTape(t.ID,t.type,t.arguments),1377556343:t=>jw.FromTape(t.ID,t.type,t.arguments),1735638870:t=>Gw.FromTape(t.ID,t.type,t.arguments),1935646853:t=>Hw.FromTape(t.ID,t.type,t.arguments),3825984169:t=>Vw.FromTape(t.ID,t.type,t.arguments),1692211062:t=>zw.FromTape(t.ID,t.type,t.arguments),2595432518:t=>Uw.FromTape(t.ID,t.type,t.arguments),1620046519:t=>Xw.FromTape(t.ID,t.type,t.arguments),2097647324:t=>Ww.FromTape(t.ID,t.type,t.arguments),2715220739:t=>Yw.FromTape(t.ID,t.type,t.arguments),2916149573:t=>Kw.FromTape(t.ID,t.type,t.arguments),1229763772:t=>Zw.FromTape(t.ID,t.type,t.arguments),3593883385:t=>qw.FromTape(t.ID,t.type,t.arguments),3026737570:t=>$w.FromTape(t.ID,t.type,t.arguments),1600972822:t=>Qw.FromTape(t.ID,t.type,t.arguments),1628702193:t=>Jw.FromTape(t.ID,t.type,t.arguments),3736923433:t=>tx.FromTape(t.ID,t.type,t.arguments),2347495698:t=>ex.FromTape(t.ID,t.type,t.arguments),3698973494:t=>sx.FromTape(t.ID,t.type,t.arguments),427810014:t=>ix.FromTape(t.ID,t.type,t.arguments),180925521:t=>rx.FromTape(t.ID,t.type,t.arguments),630975310:t=>ox.FromTape(t.ID,t.type,t.arguments),3179687236:t=>nx.FromTape(t.ID,t.type,t.arguments),4292641817:t=>ax.FromTape(t.ID,t.type,t.arguments),1911125066:t=>hx.FromTape(t.ID,t.type,t.arguments),4207607924:t=>lx.FromTape(t.ID,t.type,t.arguments),728799441:t=>ux.FromTape(t.ID,t.type,t.arguments),1417489154:t=>px.FromTape(t.ID,t.type,t.arguments),2799835756:t=>cx.FromTape(t.ID,t.type,t.arguments),2759199220:t=>dx.FromTape(t.ID,t.type,t.arguments),1907098498:t=>mx.FromTape(t.ID,t.type,t.arguments),1530820697:t=>fx.FromTape(t.ID,t.type,t.arguments),3956297820:t=>gx.FromTape(t.ID,t.type,t.arguments),2391383451:t=>_x.FromTape(t.ID,t.type,t.arguments),3313531582:t=>yx.FromTape(t.ID,t.type,t.arguments),2769231204:t=>vx.FromTape(t.ID,t.type,t.arguments),891718957:t=>bx.FromTape(t.ID,t.type,t.arguments),926996030:t=>Px.FromTape(t.ID,t.type,t.arguments),2391406946:t=>Tx.FromTape(t.ID,t.type,t.arguments),4156078855:t=>wx.FromTape(t.ID,t.type,t.arguments),3512223829:t=>xx.FromTape(t.ID,t.type,t.arguments),1898987631:t=>Mx.FromTape(t.ID,t.type,t.arguments),4237592921:t=>Dx.FromTape(t.ID,t.type,t.arguments),1133259667:t=>Ex.FromTape(t.ID,t.type,t.arguments),3304561284:t=>Ix.FromTape(t.ID,t.type,t.arguments),336235671:t=>Sx.FromTape(t.ID,t.type,t.arguments),512836454:t=>Ax.FromTape(t.ID,t.type,t.arguments),486154966:t=>Cx.FromTape(t.ID,t.type,t.arguments),1299126871:t=>Fx.FromTape(t.ID,t.type,t.arguments),4009809668:t=>Ox.FromTape(t.ID,t.type,t.arguments),4088093105:t=>Rx.FromTape(t.ID,t.type,t.arguments),1028945134:t=>Lx.FromTape(t.ID,t.type,t.arguments),4218914973:t=>Nx.FromTape(t.ID,t.type,t.arguments),3342526732:t=>Bx.FromTape(t.ID,t.type,t.arguments),1236880293:t=>kx.FromTape(t.ID,t.type,t.arguments),2543172580:t=>jx.FromTape(t.ID,t.type,t.arguments),1033361043:t=>Gx.FromTape(t.ID,t.type,t.arguments)},Rl=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.LongDescription=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Rl(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.PredefinedType),t.push(this.Status),t.push(this.LongDescription),t}},Ll=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.TheActor=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Ll(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.TheActor),t}},Nl=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Role=s,this.UserDefinedRole=i,this.Description=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Nl(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Role),t.push(this.UserDefinedRole),t.push(this.Description),t}},Bl=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Bl(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},kl=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new kl(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},jl=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Purpose=s,this.Description=i,this.UserDefinedPurpose=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new jl(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Purpose),t.push(this.Description),t.push(this.UserDefinedPurpose),t}},Gl=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Outer=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Gl(t,e,r)}ToTape(){let t=[];return t.push(this.Outer),t}},Hl=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Outer=s,this.Voids=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Hl(t,e,r,o)}ToTape(){let t=[];return t.push(this.Outer),t.push(this.Voids),t}},Vl=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Bounds=s,this.FaceSurface=i,this.SameSense=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Vl(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Bounds),t.push(this.FaceSurface),t.push(this.SameSense),t}},zl=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new zl(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Ul=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ul(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Xl=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Xl(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Wl=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Wl(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Yl=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Yl(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Kl=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Kl(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Zl=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Zl(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ql=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ql(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},$l=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Axis=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new $l(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Axis),t.push(this.PredefinedType),t}},Ql=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.StartDistAlong=s,this.Segments=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Ql(t,e,r,o)}ToTape(){let t=[];return t.push(this.StartDistAlong),t.push(this.Segments),t}},Jl=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.CurveGeometry=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Jl(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.TangentialContinuity),t.push(this.StartTag),t.push(this.EndTag),t.push(this.CurveGeometry),t}},tu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new tu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.TangentialContinuity),t.push(this.StartTag),t.push(this.EndTag),t}},eu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h,this.Radius=l,this.IsConvex=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new eu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.TangentialContinuity),t.push(this.StartTag),t.push(this.EndTag),t.push(this.StartDistAlong),t.push(this.HorizontalLength),t.push(this.StartHeight),t.push(this.StartGradient),t.push(this.Radius),t.push(this.IsConvex),t}},su=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new su(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.TangentialContinuity),t.push(this.StartTag),t.push(this.EndTag),t.push(this.StartDistAlong),t.push(this.HorizontalLength),t.push(this.StartHeight),t.push(this.StartGradient),t}},iu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h,this.ParabolaConstant=l,this.IsConvex=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new iu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.TangentialContinuity),t.push(this.StartTag),t.push(this.EndTag),t.push(this.StartDistAlong),t.push(this.HorizontalLength),t.push(this.StartHeight),t.push(this.StartGradient),t.push(this.ParabolaConstant),t.push(this.IsConvex),t}},ru=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Segments=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ru(t,e,r)}ToTape(){let t=[];return t.push(this.Segments),t}},ou=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.TangentialContinuity=s,this.StartTag=i,this.EndTag=r,this.StartDistAlong=o,this.HorizontalLength=n,this.StartHeight=a,this.StartGradient=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new ou(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.TangentialContinuity),t.push(this.StartTag),t.push(this.EndTag),t.push(this.StartDistAlong),t.push(this.HorizontalLength),t.push(this.StartHeight),t.push(this.StartGradient),t}},nu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Horizontal=s,this.Vertical=i,this.Tag=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new nu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Horizontal),t.push(this.Vertical),t.push(this.Tag),t}},au=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new au(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t}},hu=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.OuterBoundary=s,this.InnerBoundaries=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new hu(t,e,r,o)}ToTape(){let t=[];return t.push(this.OuterBoundary),t.push(this.InnerBoundaries),t}},lu=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ApplicationDeveloper=s,this.Version=i,this.ApplicationFullName=r,this.ApplicationIdentifier=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new lu(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ApplicationDeveloper),t.push(this.Version),t.push(this.ApplicationFullName),t.push(this.ApplicationIdentifier),t}},uu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.AppliedValue=r,this.UnitBasis=o,this.ApplicableDate=n,this.FixedUntilDate=a,this.Category=h,this.Condition=l,this.ArithmeticOperator=u,this.Components=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new uu(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.AppliedValue),t.push(this.UnitBasis),t.push(this.ApplicableDate),t.push(this.FixedUntilDate),t.push(this.Category),t.push(this.Condition),t.push(this.ArithmeticOperator),t.push(this.Components),t}},pu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.Identifier=s,this.Name=i,this.Description=r,this.TimeOfApproval=o,this.Status=n,this.Level=a,this.Qualifier=h,this.RequestingApproval=l,this.GivingApproval=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new pu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.Identifier),t.push(this.Name),t.push(this.Description),t.push(this.TimeOfApproval),t.push(this.Status),t.push(this.Level),t.push(this.Qualifier),t.push(this.RequestingApproval),t.push(this.GivingApproval),t}},cu=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingApproval=r,this.RelatedApprovals=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new cu(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingApproval),t.push(this.RelatedApprovals),t}},du=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.OuterCurve=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new du(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.OuterCurve),t}},mu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Curve=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new mu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Curve),t}},fu=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.OuterCurve=r,this.InnerCurves=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new fu(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.OuterCurve),t.push(this.InnerCurves),t}},gu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.OriginalValue=h,this.CurrentValue=l,this.TotalReplacementCost=u,this.Owner=p,this.User=c,this.ResponsiblePerson=d,this.IncorporationDate=m,this.DepreciatedValue=f}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new gu(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.OriginalValue),t.push(this.CurrentValue),t.push(this.TotalReplacementCost),t.push(this.Owner),t.push(this.User),t.push(this.ResponsiblePerson),t.push(this.IncorporationDate),t.push(this.DepreciatedValue),t}},_u=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.BottomFlangeWidth=o,this.OverallDepth=n,this.WebThickness=a,this.BottomFlangeThickness=h,this.BottomFlangeFilletRadius=l,this.TopFlangeWidth=u,this.TopFlangeThickness=p,this.TopFlangeFilletRadius=c,this.BottomFlangeEdgeRadius=d,this.BottomFlangeSlope=m,this.TopFlangeEdgeRadius=f,this.TopFlangeSlope=g}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++];return new _u(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.BottomFlangeWidth),t.push(this.OverallDepth),t.push(this.WebThickness),t.push(this.BottomFlangeThickness),t.push(this.BottomFlangeFilletRadius),t.push(this.TopFlangeWidth),t.push(this.TopFlangeThickness),t.push(this.TopFlangeFilletRadius),t.push(this.BottomFlangeEdgeRadius),t.push(this.BottomFlangeSlope),t.push(this.TopFlangeEdgeRadius),t.push(this.TopFlangeSlope),t}},yu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new yu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},vu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new vu(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},bu=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Location=s,this.Axis=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new bu(t,e,r,o)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Axis),t}},Pu=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Location=s,this.RefDirection=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Pu(t,e,r,o)}ToTape(){let t=[];return t.push(this.Location),t.push(this.RefDirection),t}},Tu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Location=s,this.Axis=i,this.RefDirection=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Tu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Axis),t.push(this.RefDirection),t}},wu=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Degree=s,this.ControlPointsList=i,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new wu(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Degree),t.push(this.ControlPointsList),t.push(this.CurveForm),t.push(this.ClosedCurve),t.push(this.SelfIntersect),t}},xu=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Degree=s,this.ControlPointsList=i,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=n,this.KnotMultiplicities=a,this.Knots=h,this.KnotSpec=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new xu(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Degree),t.push(this.ControlPointsList),t.push(this.CurveForm),t.push(this.ClosedCurve),t.push(this.SelfIntersect),t.push(this.KnotMultiplicities),t.push(this.Knots),t.push(this.KnotSpec),t}},Mu=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.UDegree=s,this.VDegree=i,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=n,this.VClosed=a,this.SelfIntersect=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Mu(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.UDegree),t.push(this.VDegree),t.push(this.ControlPointsList),t.push(this.SurfaceForm),t.push(this.UClosed),t.push(this.VClosed),t.push(this.SelfIntersect),t}},Du=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.UDegree=s,this.VDegree=i,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=n,this.VClosed=a,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=u,this.UKnots=p,this.VKnots=c,this.KnotSpec=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Du(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.UDegree),t.push(this.VDegree),t.push(this.ControlPointsList),t.push(this.SurfaceForm),t.push(this.UClosed),t.push(this.VClosed),t.push(this.SelfIntersect),t.push(this.UMultiplicities),t.push(this.VMultiplicities),t.push(this.UKnots),t.push(this.VKnots),t.push(this.KnotSpec),t}},Eu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Eu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Iu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Iu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Su=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Su(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Au=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Au(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Cu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Cu(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Fu=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n,this.RasterFormat=a,this.RasterCode=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Fu(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.RepeatS),t.push(this.RepeatT),t.push(this.Mode),t.push(this.TextureTransform),t.push(this.Parameter),t.push(this.RasterFormat),t.push(this.RasterCode),t}},Ou=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Position=s,this.XLength=i,this.YLength=r,this.ZLength=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Ou(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Position),t.push(this.XLength),t.push(this.YLength),t.push(this.ZLength),t}},Ru=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ru(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Lu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Lu(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Nu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Operator=s,this.FirstOperand=i,this.SecondOperand=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Nu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Operator),t.push(this.FirstOperand),t.push(this.SecondOperand),t}},Bu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Operator=s,this.FirstOperand=i,this.SecondOperand=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Bu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Operator),t.push(this.FirstOperand),t.push(this.SecondOperand),t}},ku=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ku(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},ju=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Segments=s,this.SelfIntersect=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new ju(t,e,r,o)}ToTape(){let t=[];return t.push(this.Segments),t.push(this.SelfIntersect),t}},Gu=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.TranslationalStiffnessByLengthX=i,this.TranslationalStiffnessByLengthY=r,this.TranslationalStiffnessByLengthZ=o,this.RotationalStiffnessByLengthX=n,this.RotationalStiffnessByLengthY=a,this.RotationalStiffnessByLengthZ=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Gu(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.TranslationalStiffnessByLengthX),t.push(this.TranslationalStiffnessByLengthY),t.push(this.TranslationalStiffnessByLengthZ),t.push(this.RotationalStiffnessByLengthX),t.push(this.RotationalStiffnessByLengthY),t.push(this.RotationalStiffnessByLengthZ),t}},Hu=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.TranslationalStiffnessByAreaX=i,this.TranslationalStiffnessByAreaY=r,this.TranslationalStiffnessByAreaZ=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Hu(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.TranslationalStiffnessByAreaX),t.push(this.TranslationalStiffnessByAreaY),t.push(this.TranslationalStiffnessByAreaZ),t}},Vu=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.TranslationalStiffnessX=i,this.TranslationalStiffnessY=r,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=n,this.RotationalStiffnessY=a,this.RotationalStiffnessZ=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Vu(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.TranslationalStiffnessX),t.push(this.TranslationalStiffnessY),t.push(this.TranslationalStiffnessZ),t.push(this.RotationalStiffnessX),t.push(this.RotationalStiffnessY),t.push(this.RotationalStiffnessZ),t}},zu=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Name=s,this.TranslationalStiffnessX=i,this.TranslationalStiffnessY=r,this.TranslationalStiffnessZ=o,this.RotationalStiffnessX=n,this.RotationalStiffnessY=a,this.RotationalStiffnessZ=h,this.WarpingStiffness=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new zu(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Name),t.push(this.TranslationalStiffnessX),t.push(this.TranslationalStiffnessY),t.push(this.TranslationalStiffnessZ),t.push(this.RotationalStiffnessX),t.push(this.RotationalStiffnessY),t.push(this.RotationalStiffnessZ),t.push(this.WarpingStiffness),t}},Uu=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Uu(t,e)}ToTape(){return[]}},Xu=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Xu(t,e)}ToTape(){return[]}},Wu=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Corner=s,this.XDim=i,this.YDim=r,this.ZDim=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Wu(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Corner),t.push(this.XDim),t.push(this.YDim),t.push(this.ZDim),t}},Yu=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.BaseSurface=s,this.AgreementFlag=i,this.Enclosure=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Yu(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.BaseSurface),t.push(this.AgreementFlag),t.push(this.Enclosure),t}},Ku=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ku(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t.push(this.PredefinedType),t}},Zu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Zu(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t.push(this.PredefinedType),t}},qu=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.ElevationOfRefHeight=p,this.ElevationOfTerrain=c,this.BuildingAddress=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new qu(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t.push(this.ElevationOfRefHeight),t.push(this.ElevationOfTerrain),t.push(this.BuildingAddress),t}},$u=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new $u(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Qu=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Qu(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Ju=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ju(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},tp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new tp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ep=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ep(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},sp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new sp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},ip=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.Elevation=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ip(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t.push(this.Elevation),t}},rp=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.LongName=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new rp(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.PredefinedType),t.push(this.LongName),t}},op=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new op(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},np=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new np(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},ap=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.Width=n,this.WallThickness=a,this.Girth=h,this.InternalFilletRadius=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new ap(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Depth),t.push(this.Width),t.push(this.WallThickness),t.push(this.Girth),t.push(this.InternalFilletRadius),t}},hp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new hp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},lp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new lp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},up=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new up(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},pp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new pp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},cp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new cp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},dp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new dp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},mp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new mp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},fp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new fp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},gp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new gp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},_p=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new _p(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},yp=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Coordinates=s}static FromTape(t,e,s){let i=0,r=s[i++];return new yp(t,e,r)}ToTape(){let t=[];return t.push(this.Coordinates),t}},vp=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new vp(t,e)}ToTape(){return[]}},bp=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.CoordList=s,this.TagList=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new bp(t,e,r,o)}ToTape(){let t=[];return t.push(this.CoordList),t.push(this.TagList),t}},Pp=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.CoordList=s,this.TagList=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Pp(t,e,r,o)}ToTape(){let t=[];return t.push(this.CoordList),t.push(this.TagList),t}},Tp=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Tp(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Axis1),t.push(this.Axis2),t.push(this.LocalOrigin),t.push(this.Scale),t}},wp=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new wp(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Axis1),t.push(this.Axis2),t.push(this.LocalOrigin),t.push(this.Scale),t}},xp=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o,this.Scale2=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new xp(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Axis1),t.push(this.Axis2),t.push(this.LocalOrigin),t.push(this.Scale),t.push(this.Scale2),t}},Mp=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o,this.Axis3=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Mp(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Axis1),t.push(this.Axis2),t.push(this.LocalOrigin),t.push(this.Scale),t.push(this.Axis3),t}},Dp=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Axis1=s,this.Axis2=i,this.LocalOrigin=r,this.Scale=o,this.Axis3=n,this.Scale2=a,this.Scale3=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Dp(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Axis1),t.push(this.Axis2),t.push(this.LocalOrigin),t.push(this.Scale),t.push(this.Axis3),t.push(this.Scale2),t.push(this.Scale3),t}},Ep=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Curve=r,this.Thickness=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Ep(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Curve),t.push(this.Thickness),t}},Ip=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ip(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Sp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Sp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Ap=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ap(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Cp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Cp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Fp=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Position=s,this.Radius=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Fp(t,e,r,o)}ToTape(){let t=[];return t.push(this.Position),t.push(this.Radius),t}},Op=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Radius=o,this.WallThickness=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Op(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Radius),t.push(this.WallThickness),t}},Rp=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Radius=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Rp(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Radius),t}},Lp=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r,this.Radius=o,this.IsCCW=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Lp(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.StartPoint),t.push(this.StartDirection),t.push(this.SegmentLength),t.push(this.Radius),t.push(this.IsCCW),t}},Np=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Np(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Bp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Bp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},kp=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Source=s,this.Edition=i,this.EditionDate=r,this.Name=o,this.Description=n,this.Location=a,this.ReferenceTokens=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new kp(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Source),t.push(this.Edition),t.push(this.EditionDate),t.push(this.Name),t.push(this.Description),t.push(this.Location),t.push(this.ReferenceTokens),t}},jp=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r,this.ReferencedSource=o,this.Description=n,this.Sort=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new jp(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t.push(this.ReferencedSource),t.push(this.Description),t.push(this.Sort),t}},Gp=class{constructor(t,e,s){this.expressID=t,this.type=e,this.CfsFaces=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Gp(t,e,r)}ToTape(){let t=[];return t.push(this.CfsFaces),t}},Hp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Hp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Vp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Vp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},zp=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Red=i,this.Green=r,this.Blue=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new zp(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Red),t.push(this.Green),t.push(this.Blue),t}},Up=class{constructor(t,e,s){this.expressID=t,this.type=e,this.ColourList=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Up(t,e,r)}ToTape(){let t=[];return t.push(this.ColourList),t}},Xp=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Xp(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},Wp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Wp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Yp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Yp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Kp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Kp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Zp=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Zp(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},qp=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new qp(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},$p=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.UsageName=r,this.HasProperties=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new $p(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.UsageName),t.push(this.HasProperties),t}},Qp=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.UsageName=n,this.TemplateType=a,this.HasPropertyTemplates=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Qp(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.UsageName),t.push(this.TemplateType),t.push(this.HasPropertyTemplates),t}},Jp=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Segments=s,this.SelfIntersect=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Jp(t,e,r,o)}ToTape(){let t=[];return t.push(this.Segments),t.push(this.SelfIntersect),t}},tc=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Segments=s,this.SelfIntersect=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new tc(t,e,r,o)}ToTape(){let t=[];return t.push(this.Segments),t.push(this.SelfIntersect),t}},ec=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Transition=s,this.SameSense=i,this.ParentCurve=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new ec(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Transition),t.push(this.SameSense),t.push(this.ParentCurve),t}},sc=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Profiles=r,this.Label=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new sc(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Profiles),t.push(this.Label),t}},ic=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ic(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},rc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new rc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},oc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new oc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},nc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new nc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},ac=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Position=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ac(t,e,r)}ToTape(){let t=[];return t.push(this.Position),t}},hc=class{constructor(t,e,s){this.expressID=t,this.type=e,this.CfsFaces=s}static FromTape(t,e,s){let i=0,r=s[i++];return new hc(t,e,r)}ToTape(){let t=[];return t.push(this.CfsFaces),t}},lc=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.CurveOnRelatingElement=s,this.CurveOnRelatedElement=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new lc(t,e,r,o)}ToTape(){let t=[];return t.push(this.CurveOnRelatingElement),t.push(this.CurveOnRelatedElement),t}},uc=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new uc(t,e)}ToTape(){return[]}},pc=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.PointOnRelatingElement=s,this.PointOnRelatedElement=i,this.EccentricityInX=r,this.EccentricityInY=o,this.EccentricityInZ=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new pc(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.PointOnRelatingElement),t.push(this.PointOnRelatedElement),t.push(this.EccentricityInX),t.push(this.EccentricityInY),t.push(this.EccentricityInZ),t}},cc=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.PointOnRelatingElement=s,this.PointOnRelatedElement=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new cc(t,e,r,o)}ToTape(){let t=[];return t.push(this.PointOnRelatingElement),t.push(this.PointOnRelatedElement),t}},dc=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.SurfaceOnRelatingElement=s,this.SurfaceOnRelatedElement=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new dc(t,e,r,o)}ToTape(){let t=[];return t.push(this.SurfaceOnRelatingElement),t.push(this.SurfaceOnRelatedElement),t}},mc=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.VolumeOnRelatingElement=s,this.VolumeOnRelatedElement=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new mc(t,e,r,o)}ToTape(){let t=[];return t.push(this.VolumeOnRelatingElement),t.push(this.VolumeOnRelatedElement),t}},fc=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=n,this.CreationTime=a,this.UserDefinedGrade=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new fc(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.ConstraintGrade),t.push(this.ConstraintSource),t.push(this.CreatingActor),t.push(this.CreationTime),t.push(this.UserDefinedGrade),t}},gc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new gc(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},_c=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new _c(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},yc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new yc(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},vc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new vc(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},bc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new bc(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},Pc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Pc(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},Tc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Tc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t}},wc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new wc(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t}},xc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.LongName),t.push(this.Phase),t.push(this.RepresentationContexts),t.push(this.UnitsInContext),t}},Mc=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Dimensions=s,this.UnitType=i,this.Name=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Mc(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Dimensions),t.push(this.UnitType),t.push(this.Name),t}},Dc=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Dc(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t}},Ec=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ec(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Ic=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ic(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Sc=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Dimensions=s,this.UnitType=i,this.Name=r,this.ConversionFactor=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Sc(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Dimensions),t.push(this.UnitType),t.push(this.Name),t.push(this.ConversionFactor),t}},Ac=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Dimensions=s,this.UnitType=i,this.Name=r,this.ConversionFactor=o,this.ConversionOffset=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Ac(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Dimensions),t.push(this.UnitType),t.push(this.Name),t.push(this.ConversionFactor),t.push(this.ConversionOffset),t}},Cc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Cc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Fc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Fc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Oc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Oc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Rc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Rc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Lc=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.SourceCRS=s,this.TargetCRS=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Lc(t,e,r,o)}ToTape(){let t=[];return t.push(this.SourceCRS),t.push(this.TargetCRS),t}},Nc=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.GeodeticDatum=r,this.VerticalDatum=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Nc(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.GeodeticDatum),t.push(this.VerticalDatum),t}},Bc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.CostValues=l,this.CostQuantities=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Bc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.PredefinedType),t.push(this.CostValues),t.push(this.CostQuantities),t}},kc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.SubmittedOn=u,this.UpdateDate=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new kc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.PredefinedType),t.push(this.Status),t.push(this.SubmittedOn),t.push(this.UpdateDate),t}},jc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.AppliedValue=r,this.UnitBasis=o,this.ApplicableDate=n,this.FixedUntilDate=a,this.Category=h,this.Condition=l,this.ArithmeticOperator=u,this.Components=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new jc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.AppliedValue),t.push(this.UnitBasis),t.push(this.ApplicableDate),t.push(this.FixedUntilDate),t.push(this.Category),t.push(this.Condition),t.push(this.ArithmeticOperator),t.push(this.Components),t}},Gc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Gc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Hc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Hc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Vc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new Vc(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},zc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new zc(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},Uc=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Position=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Uc(t,e,r)}ToTape(){let t=[];return t.push(this.Position),t}},Xc=class{constructor(t,e,s){this.expressID=t,this.type=e,this.TreeRootExpression=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Xc(t,e,r)}ToTape(){let t=[];return t.push(this.TreeRootExpression),t}},Wc=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingMonetaryUnit=r,this.RelatedMonetaryUnit=o,this.ExchangeRate=n,this.RateDateTime=a,this.RateSource=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Wc(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingMonetaryUnit),t.push(this.RelatedMonetaryUnit),t.push(this.ExchangeRate),t.push(this.RateDateTime),t.push(this.RateSource),t}},Yc=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Yc(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Kc=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Kc(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Zc=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Zc(t,e)}ToTape(){return[]}},qc=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.BasisSurface=s,this.OuterBoundary=i,this.InnerBoundaries=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new qc(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.BasisSurface),t.push(this.OuterBoundary),t.push(this.InnerBoundaries),t}},$c=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.BasisSurface=s,this.Boundaries=i,this.ImplicitOuter=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new $c(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.BasisSurface),t.push(this.Boundaries),t.push(this.ImplicitOuter),t}},Qc=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Qc(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.StartPoint),t.push(this.StartDirection),t.push(this.SegmentLength),t}},Jc=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.CurveFont=i,this.CurveWidth=r,this.CurveColour=o,this.ModelOrDraughting=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Jc(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.CurveFont),t.push(this.CurveWidth),t.push(this.CurveColour),t.push(this.ModelOrDraughting),t}},td=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Name=s,this.PatternList=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new td(t,e,r,o)}ToTape(){let t=[];return t.push(this.Name),t.push(this.PatternList),t}},ed=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.CurveFont=i,this.CurveFontScaling=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new ed(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.CurveFont),t.push(this.CurveFontScaling),t}},sd=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.VisibleSegmentLength=s,this.InvisibleSegmentLength=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new sd(t,e,r,o)}ToTape(){let t=[];return t.push(this.VisibleSegmentLength),t.push(this.InvisibleSegmentLength),t}},id=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Position=s,this.Radius=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new id(t,e,r,o)}ToTape(){let t=[];return t.push(this.Position),t.push(this.Radius),t}},rd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new rd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},od=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new od(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},nd=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new nd(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},ad=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ad(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},hd=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.ParentProfile=r,this.Operator=o,this.Label=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new hd(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.ParentProfile),t.push(this.Operator),t.push(this.Label),t}},ld=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Elements=s,this.UnitType=i,this.UserDefinedType=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new ld(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Elements),t.push(this.UnitType),t.push(this.UserDefinedType),t}},ud=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Unit=s,this.Exponent=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new ud(t,e,r,o)}ToTape(){let t=[];return t.push(this.Unit),t.push(this.Exponent),t}},pd=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.LengthExponent=s,this.MassExponent=i,this.TimeExponent=r,this.ElectricCurrentExponent=o,this.ThermodynamicTemperatureExponent=n,this.AmountOfSubstanceExponent=a,this.LuminousIntensityExponent=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new pd(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.LengthExponent),t.push(this.MassExponent),t.push(this.TimeExponent),t.push(this.ElectricCurrentExponent),t.push(this.ThermodynamicTemperatureExponent),t.push(this.AmountOfSubstanceExponent),t.push(this.LuminousIntensityExponent),t}},cd=class{constructor(t,e,s){this.expressID=t,this.type=e,this.DirectionRatios=s}static FromTape(t,e,s){let i=0,r=s[i++];return new cd(t,e,r)}ToTape(){let t=[];return t.push(this.DirectionRatios),t}},dd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new dd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},md=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new md(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},fd=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.DistanceAlong=s,this.OffsetLateral=i,this.OffsetVertical=r,this.OffsetLongitudinal=o,this.AlongHorizontal=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new fd(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.DistanceAlong),t.push(this.OffsetLateral),t.push(this.OffsetVertical),t.push(this.OffsetLongitudinal),t.push(this.AlongHorizontal),t}},gd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new gd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},_d=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new _d(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},yd=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.PredefinedType=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new yd(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.LongName),t.push(this.PredefinedType),t}},vd=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new vd(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},bd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new bd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Pd=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Pd(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Td=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Td(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},wd=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new wd(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},xd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Md=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.FlowDirection=l,this.PredefinedType=u,this.SystemType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Md(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.FlowDirection),t.push(this.PredefinedType),t.push(this.SystemType),t}},Dd=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.PredefinedType=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Dd(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.LongName),t.push(this.PredefinedType),t}},Ed=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y){this.expressID=t,this.type=e,this.Identification=s,this.Name=i,this.Description=r,this.Location=o,this.Purpose=n,this.IntendedUse=a,this.Scope=h,this.Revision=l,this.DocumentOwner=u,this.Editors=p,this.CreationTime=c,this.LastRevisionTime=d,this.ElectronicFormat=m,this.ValidFrom=f,this.ValidUntil=g,this.Confidentiality=_,this.Status=y}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++];return new Ed(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b)}ToTape(){let t=[];return t.push(this.Identification),t.push(this.Name),t.push(this.Description),t.push(this.Location),t.push(this.Purpose),t.push(this.IntendedUse),t.push(this.Scope),t.push(this.Revision),t.push(this.DocumentOwner),t.push(this.Editors),t.push(this.CreationTime),t.push(this.LastRevisionTime),t.push(this.ElectronicFormat),t.push(this.ValidFrom),t.push(this.ValidUntil),t.push(this.Confidentiality),t.push(this.Status),t}},Id=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingDocument=r,this.RelatedDocuments=o,this.RelationshipType=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Id(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingDocument),t.push(this.RelatedDocuments),t.push(this.RelationshipType),t}},Sd=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r,this.Description=o,this.ReferencedDocument=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Sd(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t.push(this.Description),t.push(this.ReferencedDocument),t}},Ad=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=p,this.PredefinedType=c,this.OperationType=d,this.UserDefinedOperationType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Ad(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.OverallHeight),t.push(this.OverallWidth),t.push(this.PredefinedType),t.push(this.OperationType),t.push(this.UserDefinedOperationType),t}},Cd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.LiningDepth=n,this.LiningThickness=a,this.ThresholdDepth=h,this.ThresholdThickness=l,this.TransomThickness=u,this.TransomOffset=p,this.LiningOffset=c,this.ThresholdOffset=d,this.CasingThickness=m,this.CasingDepth=f,this.ShapeAspectStyle=g,this.LiningToPanelOffsetX=_,this.LiningToPanelOffsetY=y}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++];return new Cd(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.LiningDepth),t.push(this.LiningThickness),t.push(this.ThresholdDepth),t.push(this.ThresholdThickness),t.push(this.TransomThickness),t.push(this.TransomOffset),t.push(this.LiningOffset),t.push(this.ThresholdOffset),t.push(this.CasingThickness),t.push(this.CasingDepth),t.push(this.ShapeAspectStyle),t.push(this.LiningToPanelOffsetX),t.push(this.LiningToPanelOffsetY),t}},Fd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.PanelDepth=n,this.PanelOperation=a,this.PanelWidth=h,this.PanelPosition=l,this.ShapeAspectStyle=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Fd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.PanelDepth),t.push(this.PanelOperation),t.push(this.PanelWidth),t.push(this.PanelPosition),t.push(this.ShapeAspectStyle),t}},Od=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=p,this.PredefinedType=c,this.OperationType=d,this.UserDefinedOperationType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Od(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.OverallHeight),t.push(this.OverallWidth),t.push(this.PredefinedType),t.push(this.OperationType),t.push(this.UserDefinedOperationType),t}},Rd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.OperationType=u,this.ConstructionType=p,this.ParameterTakesPrecedence=c,this.Sizeable=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Rd(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.OperationType),t.push(this.ConstructionType),t.push(this.ParameterTakesPrecedence),t.push(this.Sizeable),t}},Ld=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.OperationType=c,this.ParameterTakesPrecedence=d,this.UserDefinedOperationType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Ld(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.OperationType),t.push(this.ParameterTakesPrecedence),t.push(this.UserDefinedOperationType),t}},Nd=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Nd(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},Bd=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Bd(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},kd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new kd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},jd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new jd(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Gd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Gd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Hd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Hd(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Vd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Vd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},zd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new zd(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Ud=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.EdgeStart=s,this.EdgeEnd=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Ud(t,e,r,o)}ToTape(){let t=[];return t.push(this.EdgeStart),t.push(this.EdgeEnd),t}},Xd=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.EdgeStart=s,this.EdgeEnd=i,this.EdgeGeometry=r,this.SameSense=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Xd(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.EdgeStart),t.push(this.EdgeEnd),t.push(this.EdgeGeometry),t.push(this.SameSense),t}},Wd=class{constructor(t,e,s){this.expressID=t,this.type=e,this.EdgeList=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Wd(t,e,r)}ToTape(){let t=[];return t.push(this.EdgeList),t}},Yd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Yd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Kd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Kd(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Zd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Zd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},qd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new qd(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},$d=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new $d(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Qd=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Qd(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Jd=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Jd(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},tm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new tm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},em=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new em(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},sm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new sm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},im=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new im(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},rm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new rm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},om=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new om(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},nm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.AssemblyPlace=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new nm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.AssemblyPlace),t.push(this.PredefinedType),t}},am=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new am(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},hm=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new hm(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},lm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new lm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},um=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.MethodOfMeasurement=n,this.Quantities=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new um(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.MethodOfMeasurement),t.push(this.Quantities),t}},pm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new pm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},cm=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Position=s}static FromTape(t,e,s){let i=0,r=s[i++];return new cm(t,e,r)}ToTape(){let t=[];return t.push(this.Position),t}},dm=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Position=s,this.SemiAxis1=i,this.SemiAxis2=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new dm(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Position),t.push(this.SemiAxis1),t.push(this.SemiAxis2),t}},mm=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.SemiAxis1=o,this.SemiAxis2=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new mm(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.SemiAxis1),t.push(this.SemiAxis2),t}},fm=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new fm(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},gm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new gm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},_m=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new _m(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ym=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ym(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},vm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new vm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},bm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new bm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Pm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Pm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Tm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Tm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},wm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.PredefinedType=l,this.EventTriggerType=u,this.UserDefinedEventTriggerType=p,this.EventOccurenceTime=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new wm(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.PredefinedType),t.push(this.EventTriggerType),t.push(this.UserDefinedEventTriggerType),t.push(this.EventOccurenceTime),t}},xm=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.ActualDate=o,this.EarlyDate=n,this.LateDate=a,this.ScheduleDate=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new xm(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.ActualDate),t.push(this.EarlyDate),t.push(this.LateDate),t.push(this.ScheduleDate),t}},Mm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u,this.PredefinedType=p,this.EventTriggerType=c,this.UserDefinedEventTriggerType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Mm(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ProcessType),t.push(this.PredefinedType),t.push(this.EventTriggerType),t.push(this.UserDefinedEventTriggerType),t}},Dm=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Properties=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Dm(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Properties),t}},Em=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Em(t,e)}ToTape(){return[]}},Im=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Im(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t}},Sm=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingReference=r,this.RelatedResourceObjects=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Sm(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingReference),t.push(this.RelatedResourceObjects),t}},Am=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Am(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.PredefinedType),t}},Cm=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Cm(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t}},Fm=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Fm(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t}},Om=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Om(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t}},Rm=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Rm(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t}},Lm=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i,this.ExtrudedDirection=r,this.Depth=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Lm(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t.push(this.ExtrudedDirection),t.push(this.Depth),t}},Nm=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i,this.ExtrudedDirection=r,this.Depth=o,this.EndSweptArea=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Nm(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t.push(this.ExtrudedDirection),t.push(this.Depth),t.push(this.EndSweptArea),t}},Bm=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Bounds=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Bm(t,e,r)}ToTape(){let t=[];return t.push(this.Bounds),t}},km=class{constructor(t,e,s){this.expressID=t,this.type=e,this.FbsmFaces=s}static FromTape(t,e,s){let i=0,r=s[i++];return new km(t,e,r)}ToTape(){let t=[];return t.push(this.FbsmFaces),t}},jm=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Bound=s,this.Orientation=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new jm(t,e,r,o)}ToTape(){let t=[];return t.push(this.Bound),t.push(this.Orientation),t}},Gm=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Bound=s,this.Orientation=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Gm(t,e,r,o)}ToTape(){let t=[];return t.push(this.Bound),t.push(this.Orientation),t}},Hm=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Bounds=s,this.FaceSurface=i,this.SameSense=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Hm(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Bounds),t.push(this.FaceSurface),t.push(this.SameSense),t}},Vm=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Outer=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Vm(t,e,r)}ToTape(){let t=[];return t.push(this.Outer),t}},zm=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Outer=s,this.Voids=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new zm(t,e,r,o)}ToTape(){let t=[];return t.push(this.Outer),t.push(this.Voids),t}},Um=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Um(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t}},Xm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Xm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t}},Wm=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.TensionFailureX=i,this.TensionFailureY=r,this.TensionFailureZ=o,this.CompressionFailureX=n,this.CompressionFailureY=a,this.CompressionFailureZ=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Wm(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.TensionFailureX),t.push(this.TensionFailureY),t.push(this.TensionFailureZ),t.push(this.CompressionFailureX),t.push(this.CompressionFailureY),t.push(this.CompressionFailureZ),t}},Ym=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ym(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Km=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Km(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Zm=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Zm(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},qm=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new qm(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},$m=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new $m(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Qm=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Qm(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Jm=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Jm(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},tf=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.FillStyles=i,this.ModelorDraughting=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new tf(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.FillStyles),t.push(this.ModelorDraughting),t}},ef=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.HatchLineAppearance=s,this.StartOfNextHatchLine=i,this.PointOfReferenceHatchLine=r,this.PatternStart=o,this.HatchLineAngle=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new ef(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.HatchLineAppearance),t.push(this.StartOfNextHatchLine),t.push(this.PointOfReferenceHatchLine),t.push(this.PatternStart),t.push(this.HatchLineAngle),t}},sf=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.TilingPattern=s,this.Tiles=i,this.TilingScale=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new sf(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.TilingPattern),t.push(this.Tiles),t.push(this.TilingScale),t}},rf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new rf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},of=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new of(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},nf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new nf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},af=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new af(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},hf=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i,this.Directrix=r,this.StartParam=o,this.EndParam=n,this.FixedReference=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new hf(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t.push(this.Directrix),t.push(this.StartParam),t.push(this.EndParam),t.push(this.FixedReference),t}},lf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new lf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},uf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new uf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},pf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new pf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},cf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new cf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},df=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new df(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},mf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new mf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},ff=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ff(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},gf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new gf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},_f=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new _f(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},yf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new yf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},vf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new vf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},bf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new bf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Pf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Pf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Tf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Tf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},wf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new wf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},xf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Mf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Mf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Df=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Df(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Ef=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ef(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},If=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new If(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Sf=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Sf(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},Af=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Af(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Cf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Cf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Ff=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.AssemblyPlace=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new Ff(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.AssemblyPlace),t.push(this.PredefinedType),t}},Of=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Of(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Rf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Rf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Lf=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Elements=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Lf(t,e,r)}ToTape(){let t=[];return t.push(this.Elements),t}},Nf=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.ContextIdentifier=s,this.ContextType=i,this.CoordinateSpaceDimension=r,this.Precision=o,this.WorldCoordinateSystem=n,this.TrueNorth=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Nf(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.ContextIdentifier),t.push(this.ContextType),t.push(this.CoordinateSpaceDimension),t.push(this.Precision),t.push(this.WorldCoordinateSystem),t.push(this.TrueNorth),t}},Bf=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Bf(t,e)}ToTape(){return[]}},kf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.ContextIdentifier=s,this.ContextType=i,this.CoordinateSpaceDimension=r,this.Precision=o,this.WorldCoordinateSystem=n,this.TrueNorth=a,this.ParentContext=h,this.TargetScale=l,this.TargetView=u,this.UserDefinedTargetView=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new kf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.ContextIdentifier),t.push(this.ContextType),t.push(this.CoordinateSpaceDimension),t.push(this.Precision),t.push(this.WorldCoordinateSystem),t.push(this.TrueNorth),t.push(this.ParentContext),t.push(this.TargetScale),t.push(this.TargetView),t.push(this.UserDefinedTargetView),t}},jf=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Elements=s}static FromTape(t,e,s){let i=0,r=s[i++];return new jf(t,e,r)}ToTape(){let t=[];return t.push(this.Elements),t}},Gf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.UAxes=l,this.VAxes=u,this.WAxes=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new Gf(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.UAxes),t.push(this.VAxes),t.push(this.WAxes),t.push(this.PredefinedType),t}},Hf=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.AxisTag=s,this.AxisCurve=i,this.SameSense=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Hf(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.AxisTag),t.push(this.AxisCurve),t.push(this.SameSense),t}},Vf=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.PlacementRelTo=s,this.PlacementLocation=i,this.PlacementRefDirection=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Vf(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.PlacementRelTo),t.push(this.PlacementLocation),t.push(this.PlacementRefDirection),t}},zf=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new zf(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t}},Uf=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.BaseSurface=s,this.AgreementFlag=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Uf(t,e,r,o)}ToTape(){let t=[];return t.push(this.BaseSurface),t.push(this.AgreementFlag),t}},Xf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Xf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Wf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Wf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Yf=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Yf(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Kf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Kf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Zf=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.OverallWidth=o,this.OverallDepth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=u,this.FlangeSlope=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Zf(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.OverallWidth),t.push(this.OverallDepth),t.push(this.WebThickness),t.push(this.FlangeThickness),t.push(this.FilletRadius),t.push(this.FlangeEdgeRadius),t.push(this.FlangeSlope),t}},qf=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n,this.URLReference=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new qf(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.RepeatS),t.push(this.RepeatT),t.push(this.Mode),t.push(this.TextureTransform),t.push(this.Parameter),t.push(this.URLReference),t}},$f=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.MappedTo=s,this.Opacity=i,this.Colours=r,this.ColourIndex=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new $f(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.MappedTo),t.push(this.Opacity),t.push(this.Colours),t.push(this.ColourIndex),t}},Qf=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Points=s,this.Segments=i,this.SelfIntersect=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Qf(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Points),t.push(this.Segments),t.push(this.SelfIntersect),t}},Jf=class{constructor(t,e,s){this.expressID=t,this.type=e,this.CoordIndex=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Jf(t,e,r)}ToTape(){let t=[];return t.push(this.CoordIndex),t}},tg=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.CoordIndex=s,this.InnerCoordIndices=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new tg(t,e,r,o)}ToTape(){let t=[];return t.push(this.CoordIndex),t.push(this.InnerCoordIndices),t}},eg=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Maps=s,this.MappedTo=i,this.TexCoords=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new eg(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Maps),t.push(this.MappedTo),t.push(this.TexCoords),t}},sg=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Maps=s,this.MappedTo=i,this.TexCoords=r,this.TexCoordIndex=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new sg(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Maps),t.push(this.MappedTo),t.push(this.TexCoords),t.push(this.TexCoordIndex),t}},ig=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ig(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},rg=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new rg(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},og=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Curve3D=s,this.AssociatedGeometry=i,this.MasterRepresentation=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new og(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Curve3D),t.push(this.AssociatedGeometry),t.push(this.MasterRepresentation),t}},ng=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.Jurisdiction=h,this.ResponsiblePersons=l,this.LastUpdateDate=u,this.CurrentValue=p,this.OriginalValue=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new ng(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.PredefinedType),t.push(this.Jurisdiction),t.push(this.ResponsiblePersons),t.push(this.LastUpdateDate),t.push(this.CurrentValue),t.push(this.OriginalValue),t}},ag=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=n,this.DataOrigin=a,this.UserDefinedDataOrigin=h,this.Unit=l,this.Values=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ag(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.StartTime),t.push(this.EndTime),t.push(this.TimeSeriesDataType),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.Unit),t.push(this.Values),t}},hg=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.TimeStamp=s,this.ListValues=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new hg(t,e,r,o)}ToTape(){let t=[];return t.push(this.TimeStamp),t.push(this.ListValues),t}},lg=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new lg(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ug=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ug(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},pg=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.Width=n,this.Thickness=a,this.FilletRadius=h,this.EdgeRadius=l,this.LegSlope=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new pg(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Depth),t.push(this.Width),t.push(this.Thickness),t.push(this.FilletRadius),t.push(this.EdgeRadius),t.push(this.LegSlope),t}},cg=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new cg(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},dg=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new dg(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},mg=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.LagValue=o,this.DurationType=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new mg(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.LagValue),t.push(this.DurationType),t}},fg=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new fg(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},gg=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new gg(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},_g=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Name=s,this.Version=i,this.Publisher=r,this.VersionDate=o,this.Location=n,this.Description=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new _g(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Version),t.push(this.Publisher),t.push(this.VersionDate),t.push(this.Location),t.push(this.Description),t}},yg=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Location=s,this.Identification=i,this.Name=r,this.Description=o,this.Language=n,this.ReferencedLibrary=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new yg(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Location),t.push(this.Identification),t.push(this.Name),t.push(this.Description),t.push(this.Language),t.push(this.ReferencedLibrary),t}},vg=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.MainPlaneAngle=s,this.SecondaryPlaneAngle=i,this.LuminousIntensity=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new vg(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.MainPlaneAngle),t.push(this.SecondaryPlaneAngle),t.push(this.LuminousIntensity),t}},bg=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new bg(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Pg=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Pg(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Tg=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.LightDistributionCurve=s,this.DistributionData=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Tg(t,e,r,o)}ToTape(){let t=[];return t.push(this.LightDistributionCurve),t.push(this.DistributionData),t}},wg=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new wg(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LightColour),t.push(this.AmbientIntensity),t.push(this.Intensity),t}},xg=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new xg(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LightColour),t.push(this.AmbientIntensity),t.push(this.Intensity),t}},Mg=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Orientation=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Mg(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LightColour),t.push(this.AmbientIntensity),t.push(this.Intensity),t.push(this.Orientation),t}},Dg=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Position=n,this.ColourAppearance=a,this.ColourTemperature=h,this.LuminousFlux=l,this.LightEmissionSource=u,this.LightDistributionDataSource=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Dg(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LightColour),t.push(this.AmbientIntensity),t.push(this.Intensity),t.push(this.Position),t.push(this.ColourAppearance),t.push(this.ColourTemperature),t.push(this.LuminousFlux),t.push(this.LightEmissionSource),t.push(this.LightDistributionDataSource),t}},Eg=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Position=n,this.Radius=a,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Eg(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LightColour),t.push(this.AmbientIntensity),t.push(this.Intensity),t.push(this.Position),t.push(this.Radius),t.push(this.ConstantAttenuation),t.push(this.DistanceAttenuation),t.push(this.QuadricAttenuation),t}},Ig=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.Name=s,this.LightColour=i,this.AmbientIntensity=r,this.Intensity=o,this.Position=n,this.Radius=a,this.ConstantAttenuation=h,this.DistanceAttenuation=l,this.QuadricAttenuation=u,this.Orientation=p,this.ConcentrationExponent=c,this.SpreadAngle=d,this.BeamWidthAngle=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Ig(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LightColour),t.push(this.AmbientIntensity),t.push(this.Intensity),t.push(this.Position),t.push(this.Radius),t.push(this.ConstantAttenuation),t.push(this.DistanceAttenuation),t.push(this.QuadricAttenuation),t.push(this.Orientation),t.push(this.ConcentrationExponent),t.push(this.SpreadAngle),t.push(this.BeamWidthAngle),t}},Sg=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Pnt=s,this.Dir=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Sg(t,e,r,o)}ToTape(){let t=[];return t.push(this.Pnt),t.push(this.Dir),t}},Ag=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Ag(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.StartPoint),t.push(this.StartDirection),t.push(this.SegmentLength),t}},Cg=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.PlacementRelTo=s,this.PlacementMeasuredAlong=i,this.Distance=r,this.Orientation=o,this.CartesianPosition=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Cg(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.PlacementRelTo),t.push(this.PlacementMeasuredAlong),t.push(this.Distance),t.push(this.Orientation),t.push(this.CartesianPosition),t}},Fg=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Axis=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Fg(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Axis),t}},Og=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.PlacementRelTo=s,this.RelativePlacement=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Og(t,e,r,o)}ToTape(){let t=[];return t.push(this.PlacementRelTo),t.push(this.RelativePlacement),t}},Rg=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Rg(t,e)}ToTape(){return[]}},Lg=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Outer=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Lg(t,e,r)}ToTape(){let t=[];return t.push(this.Outer),t}},Ng=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.SourceCRS=s,this.TargetCRS=i,this.Eastings=r,this.Northings=o,this.OrthogonalHeight=n,this.XAxisAbscissa=a,this.XAxisOrdinate=h,this.Scale=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Ng(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.SourceCRS),t.push(this.TargetCRS),t.push(this.Eastings),t.push(this.Northings),t.push(this.OrthogonalHeight),t.push(this.XAxisAbscissa),t.push(this.XAxisOrdinate),t.push(this.Scale),t}},Bg=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.MappingSource=s,this.MappingTarget=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Bg(t,e,r,o)}ToTape(){let t=[];return t.push(this.MappingSource),t.push(this.MappingTarget),t}},kg=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Category=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new kg(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Category),t}},jg=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.MaterialClassifications=s,this.ClassifiedMaterial=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new jg(t,e,r,o)}ToTape(){let t=[];return t.push(this.MaterialClassifications),t.push(this.ClassifiedMaterial),t}},Gg=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Material=r,this.Fraction=o,this.Category=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Gg(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Material),t.push(this.Fraction),t.push(this.Category),t}},Hg=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.MaterialConstituents=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Hg(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.MaterialConstituents),t}},Vg=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Vg(t,e)}ToTape(){return[]}},zg=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Representations=r,this.RepresentedMaterial=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new zg(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Representations),t.push(this.RepresentedMaterial),t}},Ug=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Material=s,this.LayerThickness=i,this.IsVentilated=r,this.Name=o,this.Description=n,this.Category=a,this.Priority=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Ug(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Material),t.push(this.LayerThickness),t.push(this.IsVentilated),t.push(this.Name),t.push(this.Description),t.push(this.Category),t.push(this.Priority),t}},Xg=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.MaterialLayers=s,this.LayerSetName=i,this.Description=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Xg(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.MaterialLayers),t.push(this.LayerSetName),t.push(this.Description),t}},Wg=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ForLayerSet=s,this.LayerSetDirection=i,this.DirectionSense=r,this.OffsetFromReferenceLine=o,this.ReferenceExtent=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Wg(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ForLayerSet),t.push(this.LayerSetDirection),t.push(this.DirectionSense),t.push(this.OffsetFromReferenceLine),t.push(this.ReferenceExtent),t}},Yg=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.Material=s,this.LayerThickness=i,this.IsVentilated=r,this.Name=o,this.Description=n,this.Category=a,this.Priority=h,this.OffsetDirection=l,this.OffsetValues=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Yg(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.Material),t.push(this.LayerThickness),t.push(this.IsVentilated),t.push(this.Name),t.push(this.Description),t.push(this.Category),t.push(this.Priority),t.push(this.OffsetDirection),t.push(this.OffsetValues),t}},Kg=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Materials=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Kg(t,e,r)}ToTape(){let t=[];return t.push(this.Materials),t}},Zg=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Material=r,this.Profile=o,this.Priority=n,this.Category=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Zg(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Material),t.push(this.Profile),t.push(this.Priority),t.push(this.Category),t}},qg=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.MaterialProfiles=r,this.CompositeProfile=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new qg(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.MaterialProfiles),t.push(this.CompositeProfile),t}},$g=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.ForProfileSet=s,this.CardinalPoint=i,this.ReferenceExtent=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new $g(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.ForProfileSet),t.push(this.CardinalPoint),t.push(this.ReferenceExtent),t}},Qg=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ForProfileSet=s,this.CardinalPoint=i,this.ReferenceExtent=r,this.ForProfileEndSet=o,this.CardinalEndPoint=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Qg(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ForProfileSet),t.push(this.CardinalPoint),t.push(this.ReferenceExtent),t.push(this.ForProfileEndSet),t.push(this.CardinalEndPoint),t}},Jg=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Material=r,this.Profile=o,this.Priority=n,this.Category=a,this.OffsetValues=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Jg(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Material),t.push(this.Profile),t.push(this.Priority),t.push(this.Category),t.push(this.OffsetValues),t}},t_=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Properties=r,this.Material=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new t_(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Properties),t.push(this.Material),t}},e_=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingMaterial=r,this.RelatedMaterials=o,this.Expression=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new e_(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingMaterial),t.push(this.RelatedMaterials),t.push(this.Expression),t}},s_=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new s_(t,e)}ToTape(){return[]}},i_=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.ValueComponent=s,this.UnitComponent=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new i_(t,e,r,o)}ToTape(){let t=[];return t.push(this.ValueComponent),t.push(this.UnitComponent),t}},r_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.NominalDiameter=u,this.NominalLength=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new r_(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.NominalDiameter),t.push(this.NominalLength),t.push(this.PredefinedType),t}},o_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.NominalDiameter=c,this.NominalLength=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new o_(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.NominalDiameter),t.push(this.NominalLength),t}},n_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new n_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},a_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new a_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},h_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new h_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},l_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new l_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},u_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new u_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},p_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=n,this.CreationTime=a,this.UserDefinedGrade=h,this.Benchmark=l,this.ValueSource=u,this.DataValue=p,this.ReferencePath=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new p_(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.ConstraintGrade),t.push(this.ConstraintSource),t.push(this.CreatingActor),t.push(this.CreationTime),t.push(this.UserDefinedGrade),t.push(this.Benchmark),t.push(this.ValueSource),t.push(this.DataValue),t.push(this.ReferencePath),t}},c_=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.ParentProfile=r,this.Operator=o,this.Label=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new c_(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.ParentProfile),t.push(this.Operator),t.push(this.Label),t}},d_=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Currency=s}static FromTape(t,e,s){let i=0,r=s[i++];return new d_(t,e,r)}ToTape(){let t=[];return t.push(this.Currency),t}},m_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new m_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},f_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new f_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},g_=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Dimensions=s,this.UnitType=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new g_(t,e,r,o)}ToTape(){let t=[];return t.push(this.Dimensions),t.push(this.UnitType),t}},__=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new __(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t}},y_=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new y_(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},v_=class{constructor(t,e,s){this.expressID=t,this.type=e,this.PlacementRelTo=s}static FromTape(t,e,s){let i=0,r=s[i++];return new v_(t,e,r)}ToTape(){let t=[];return t.push(this.PlacementRelTo),t}},b_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.ConstraintGrade=r,this.ConstraintSource=o,this.CreatingActor=n,this.CreationTime=a,this.UserDefinedGrade=h,this.BenchmarkValues=l,this.LogicalAggregator=u,this.ObjectiveQualifier=p,this.UserDefinedQualifier=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new b_(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.ConstraintGrade),t.push(this.ConstraintSource),t.push(this.CreatingActor),t.push(this.CreationTime),t.push(this.UserDefinedGrade),t.push(this.BenchmarkValues),t.push(this.LogicalAggregator),t.push(this.ObjectiveQualifier),t.push(this.UserDefinedQualifier),t}},P_=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.TheActor=a,this.PredefinedType=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new P_(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.TheActor),t.push(this.PredefinedType),t}},T_=class{constructor(t,e,s){this.expressID=t,this.type=e,this.BasisCurve=s}static FromTape(t,e,s){let i=0,r=s[i++];return new T_(t,e,r)}ToTape(){let t=[];return t.push(this.BasisCurve),t}},w_=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.BasisCurve=s,this.Distance=i,this.SelfIntersect=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new w_(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.BasisCurve),t.push(this.Distance),t.push(this.SelfIntersect),t}},x_=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.BasisCurve=s,this.Distance=i,this.SelfIntersect=r,this.RefDirection=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new x_(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.BasisCurve),t.push(this.Distance),t.push(this.SelfIntersect),t.push(this.RefDirection),t}},M_=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.BasisCurve=s,this.OffsetValues=i,this.Tag=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new M_(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.BasisCurve),t.push(this.OffsetValues),t.push(this.Tag),t}},D_=class{constructor(t,e,s){this.expressID=t,this.type=e,this.CfsFaces=s}static FromTape(t,e,s){let i=0,r=s[i++];return new D_(t,e,r)}ToTape(){let t=[];return t.push(this.CfsFaces),t}},E_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new E_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},I_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new I_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},S_=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Identification=s,this.Name=i,this.Description=r,this.Roles=o,this.Addresses=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new S_(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Identification),t.push(this.Name),t.push(this.Description),t.push(this.Roles),t.push(this.Addresses),t}},A_=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingOrganization=r,this.RelatedOrganizations=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new A_(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingOrganization),t.push(this.RelatedOrganizations),t}},C_=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.LateralAxisDirection=s,this.VerticalAxisDirection=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new C_(t,e,r,o)}ToTape(){let t=[];return t.push(this.LateralAxisDirection),t.push(this.VerticalAxisDirection),t}},F_=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.EdgeStart=s,this.EdgeEnd=i,this.EdgeElement=r,this.Orientation=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new F_(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.EdgeStart),t.push(this.EdgeEnd),t.push(this.EdgeElement),t.push(this.Orientation),t}},O_=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Segments=s,this.SelfIntersect=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new O_(t,e,r,o)}ToTape(){let t=[];return t.push(this.Segments),t.push(this.SelfIntersect),t}},R_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new R_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},L_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new L_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},N_=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.OwningUser=s,this.OwningApplication=i,this.State=r,this.ChangeAction=o,this.LastModifiedDate=n,this.LastModifyingUser=a,this.LastModifyingApplication=h,this.CreationDate=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new N_(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.OwningUser),t.push(this.OwningApplication),t.push(this.State),t.push(this.ChangeAction),t.push(this.LastModifiedDate),t.push(this.LastModifyingUser),t.push(this.LastModifyingApplication),t.push(this.CreationDate),t}},B_=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new B_(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t}},k_=class{constructor(t,e,s){this.expressID=t,this.type=e,this.EdgeList=s}static FromTape(t,e,s){let i=0,r=s[i++];return new k_(t,e,r)}ToTape(){let t=[];return t.push(this.EdgeList),t}},j_=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.BasisSurface=s,this.ReferenceCurve=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new j_(t,e,r,o)}ToTape(){let t=[];return t.push(this.BasisSurface),t.push(this.ReferenceCurve),t}},G_=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LifeCyclePhase=h,this.PredefinedType=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new G_(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LifeCyclePhase),t.push(this.PredefinedType),t}},H_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.OperationType=n,this.PanelPosition=a,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new H_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.OperationType),t.push(this.PanelPosition),t.push(this.FrameDepth),t.push(this.FrameThickness),t.push(this.ShapeAspectStyle),t}},V_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.LongDescription=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new V_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.PredefinedType),t.push(this.Status),t.push(this.LongDescription),t}},z_=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Identification=s,this.FamilyName=i,this.GivenName=r,this.MiddleNames=o,this.PrefixTitles=n,this.SuffixTitles=a,this.Roles=h,this.Addresses=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new z_(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Identification),t.push(this.FamilyName),t.push(this.GivenName),t.push(this.MiddleNames),t.push(this.PrefixTitles),t.push(this.SuffixTitles),t.push(this.Roles),t.push(this.Addresses),t}},U_=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.ThePerson=s,this.TheOrganization=i,this.Roles=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new U_(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.ThePerson),t.push(this.TheOrganization),t.push(this.Roles),t}},X_=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.HasQuantities=r,this.Discrimination=o,this.Quality=n,this.Usage=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new X_(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.HasQuantities),t.push(this.Discrimination),t.push(this.Quality),t.push(this.Usage),t}},W_=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Name=s,this.Description=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new W_(t,e,r,o)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t}},Y_=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Y_(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t}},K_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u,this.ConstructionType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new K_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t.push(this.ConstructionType),t}},Z_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Z_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},q_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new q_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},$_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new $_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Q_=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Q_(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},J_=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new J_(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},ty=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n,this.Width=a,this.Height=h,this.ColourComponents=l,this.Pixel=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ty(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.RepeatS),t.push(this.RepeatT),t.push(this.Mode),t.push(this.TextureTransform),t.push(this.Parameter),t.push(this.Width),t.push(this.Height),t.push(this.ColourComponents),t.push(this.Pixel),t}},ey=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Location=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ey(t,e,r)}ToTape(){let t=[];return t.push(this.Location),t}},sy=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.SizeInX=s,this.SizeInY=i,this.Placement=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new sy(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.SizeInX),t.push(this.SizeInY),t.push(this.Placement),t}},iy=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.SizeInX=s,this.SizeInY=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new iy(t,e,r,o)}ToTape(){let t=[];return t.push(this.SizeInX),t.push(this.SizeInY),t}},ry=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Position=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ry(t,e,r)}ToTape(){let t=[];return t.push(this.Position),t}},oy=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new oy(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ny=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ny(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ay=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ay(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},hy=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new hy(t,e)}ToTape(){return[]}},ly=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.BasisCurve=s,this.PointParameter=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new ly(t,e,r,o)}ToTape(){let t=[];return t.push(this.BasisCurve),t.push(this.PointParameter),t}},uy=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.BasisSurface=s,this.PointParameterU=i,this.PointParameterV=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new uy(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.BasisSurface),t.push(this.PointParameterU),t.push(this.PointParameterV),t}},py=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Polygon=s}static FromTape(t,e,s){let i=0,r=s[i++];return new py(t,e,r)}ToTape(){let t=[];return t.push(this.Polygon),t}},cy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.BaseSurface=s,this.AgreementFlag=i,this.Position=r,this.PolygonalBoundary=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new cy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.BaseSurface),t.push(this.AgreementFlag),t.push(this.Position),t.push(this.PolygonalBoundary),t}},dy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Coordinates=s,this.Closed=i,this.Faces=r,this.PnIndex=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new dy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Coordinates),t.push(this.Closed),t.push(this.Faces),t.push(this.PnIndex),t}},my=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Points=s}static FromTape(t,e,s){let i=0,r=s[i++];return new my(t,e,r)}ToTape(){let t=[];return t.push(this.Points),t}},fy=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new fy(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t}},gy=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new gy(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t}},_y=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.Purpose=s,this.Description=i,this.UserDefinedPurpose=r,this.InternalLocation=o,this.AddressLines=n,this.PostalBox=a,this.Town=h,this.Region=l,this.PostalCode=u,this.Country=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new _y(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.Purpose),t.push(this.Description),t.push(this.UserDefinedPurpose),t.push(this.InternalLocation),t.push(this.AddressLines),t.push(this.PostalBox),t.push(this.Town),t.push(this.Region),t.push(this.PostalCode),t.push(this.Country),t}},yy=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new yy(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},vy=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new vy(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},by=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new by(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},Py=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Py(t,e)}ToTape(){return[]}},Ty=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Ty(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},wy=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new wy(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},xy=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new xy(t,e)}ToTape(){return[]}},My=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.AssignedItems=r,this.Identifier=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new My(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.AssignedItems),t.push(this.Identifier),t}},Dy=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.AssignedItems=r,this.Identifier=o,this.LayerOn=n,this.LayerFrozen=a,this.LayerBlocked=h,this.LayerStyles=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Dy(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.AssignedItems),t.push(this.Identifier),t.push(this.LayerOn),t.push(this.LayerFrozen),t.push(this.LayerBlocked),t.push(this.LayerStyles),t}},Ey=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Ey(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},Iy=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Styles=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Iy(t,e,r)}ToTape(){let t=[];return t.push(this.Styles),t}},Sy=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.PredefinedType=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Sy(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.PredefinedType),t}},Ay=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ay(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ProcessType),t.push(this.PredefinedType),t}},Cy=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Cy(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t}},Fy=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Fy(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t}},Oy=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Representations=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Oy(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Representations),t}},Ry=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Representations=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Ry(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Representations),t}},Ly=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Ly(t,e,r,o)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t}},Ny=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Properties=r,this.ProfileDefinition=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Ny(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Properties),t.push(this.ProfileDefinition),t}},By=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new By(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.LongName),t.push(this.Phase),t.push(this.RepresentationContexts),t.push(this.UnitsInContext),t}},ky=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a,this.Phase=h,this.RepresentationContexts=l,this.UnitsInContext=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ky(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.LongName),t.push(this.Phase),t.push(this.RepresentationContexts),t.push(this.UnitsInContext),t}},jy=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.PredefinedType=h,this.Status=l,this.LongDescription=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new jy(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.PredefinedType),t.push(this.Status),t.push(this.LongDescription),t}},Gy=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.GeodeticDatum=r,this.VerticalDatum=o,this.MapProjection=n,this.MapZone=a,this.MapUnit=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Gy(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.GeodeticDatum),t.push(this.VerticalDatum),t.push(this.MapProjection),t.push(this.MapZone),t.push(this.MapUnit),t}},Hy=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Hy(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Vy=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Name=s,this.Description=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Vy(t,e,r,o)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t}},zy=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new zy(t,e)}ToTape(){return[]}},Uy=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.UpperBoundValue=r,this.LowerBoundValue=o,this.Unit=n,this.SetPointValue=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Uy(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.UpperBoundValue),t.push(this.LowerBoundValue),t.push(this.Unit),t.push(this.SetPointValue),t}},Xy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Xy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},Wy=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.DependingProperty=r,this.DependantProperty=o,this.Expression=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Wy(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.DependingProperty),t.push(this.DependantProperty),t.push(this.Expression),t}},Yy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.EnumerationValues=r,this.EnumerationReference=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Yy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.EnumerationValues),t.push(this.EnumerationReference),t}},Ky=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.EnumerationValues=i,this.Unit=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Ky(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.EnumerationValues),t.push(this.Unit),t}},Zy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.ListValues=r,this.Unit=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Zy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.ListValues),t.push(this.Unit),t}},qy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.UsageName=r,this.PropertyReference=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new qy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.UsageName),t.push(this.PropertyReference),t}},$y=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.HasProperties=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new $y(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.HasProperties),t}},Qy=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Qy(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},Jy=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.TemplateType=n,this.ApplicableEntity=a,this.HasPropertyTemplates=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Jy(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.TemplateType),t.push(this.ApplicableEntity),t.push(this.HasPropertyTemplates),t}},tv=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.NominalValue=r,this.Unit=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new tv(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.NominalValue),t.push(this.Unit),t}},ev=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.DefiningValues=r,this.DefinedValues=o,this.Expression=n,this.DefiningUnit=a,this.DefinedUnit=h,this.CurveInterpolation=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new ev(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.DefiningValues),t.push(this.DefinedValues),t.push(this.Expression),t.push(this.DefiningUnit),t.push(this.DefinedUnit),t.push(this.CurveInterpolation),t}},sv=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new sv(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},iv=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new iv(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},rv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new rv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ov=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ov(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},nv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new nv(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},av=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new av(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},hv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.ProxyType=l,this.Tag=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new hv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.ProxyType),t.push(this.Tag),t}},lv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new lv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},uv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new uv(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},pv=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r,this.AreaValue=o,this.Formula=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new pv(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.AreaValue),t.push(this.Formula),t}},cv=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r,this.CountValue=o,this.Formula=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new cv(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.CountValue),t.push(this.Formula),t}},dv=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r,this.LengthValue=o,this.Formula=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new dv(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.LengthValue),t.push(this.Formula),t}},mv=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new mv(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},fv=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r,this.TimeValue=o,this.Formula=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new fv(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.TimeValue),t.push(this.Formula),t}},gv=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r,this.VolumeValue=o,this.Formula=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new gv(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.VolumeValue),t.push(this.Formula),t}},_v=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.Unit=r,this.WeightValue=o,this.Formula=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new _v(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.WeightValue),t.push(this.Formula),t}},yv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new yv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},vv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new vv(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},bv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new bv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Pv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Pv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Tv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Tv(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},wv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new wv(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},xv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.Degree=s,this.ControlPointsList=i,this.CurveForm=r,this.ClosedCurve=o,this.SelfIntersect=n,this.KnotMultiplicities=a,this.Knots=h,this.KnotSpec=l,this.WeightsData=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.Degree),t.push(this.ControlPointsList),t.push(this.CurveForm),t.push(this.ClosedCurve),t.push(this.SelfIntersect),t.push(this.KnotMultiplicities),t.push(this.Knots),t.push(this.KnotSpec),t.push(this.WeightsData),t}},Mv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.UDegree=s,this.VDegree=i,this.ControlPointsList=r,this.SurfaceForm=o,this.UClosed=n,this.VClosed=a,this.SelfIntersect=h,this.UMultiplicities=l,this.VMultiplicities=u,this.UKnots=p,this.VKnots=c,this.KnotSpec=d,this.WeightsData=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Mv(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.UDegree),t.push(this.VDegree),t.push(this.ControlPointsList),t.push(this.SurfaceForm),t.push(this.UClosed),t.push(this.VClosed),t.push(this.SelfIntersect),t.push(this.UMultiplicities),t.push(this.VMultiplicities),t.push(this.UKnots),t.push(this.VKnots),t.push(this.KnotSpec),t.push(this.WeightsData),t}},Dv=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.XDim=o,this.YDim=n,this.WallThickness=a,this.InnerFilletRadius=h,this.OuterFilletRadius=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Dv(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.XDim),t.push(this.YDim),t.push(this.WallThickness),t.push(this.InnerFilletRadius),t.push(this.OuterFilletRadius),t}},Ev=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.XDim=o,this.YDim=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Ev(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.XDim),t.push(this.YDim),t}},Iv=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Position=s,this.XLength=i,this.YLength=r,this.Height=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Iv(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Position),t.push(this.XLength),t.push(this.YLength),t.push(this.Height),t}},Sv=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.BasisSurface=s,this.U1=i,this.V1=r,this.U2=o,this.V2=n,this.Usense=a,this.Vsense=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Sv(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.BasisSurface),t.push(this.U1),t.push(this.V1),t.push(this.U2),t.push(this.V2),t.push(this.Usense),t.push(this.Vsense),t}},Av=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.RecurrenceType=s,this.DayComponent=i,this.WeekdayComponent=r,this.MonthComponent=o,this.Position=n,this.Interval=a,this.Occurrences=h,this.TimePeriods=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Av(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.RecurrenceType),t.push(this.DayComponent),t.push(this.WeekdayComponent),t.push(this.MonthComponent),t.push(this.Position),t.push(this.Interval),t.push(this.Occurrences),t.push(this.TimePeriods),t}},Cv=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.TypeIdentifier=s,this.AttributeIdentifier=i,this.InstanceName=r,this.ListPositions=o,this.InnerReference=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Cv(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.TypeIdentifier),t.push(this.AttributeIdentifier),t.push(this.InstanceName),t.push(this.ListPositions),t.push(this.InnerReference),t}},Fv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.RestartDistance=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Fv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.PredefinedType),t.push(this.RestartDistance),t}},Ov=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=n,this.DataOrigin=a,this.UserDefinedDataOrigin=h,this.Unit=l,this.TimeStep=u,this.Values=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ov(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.StartTime),t.push(this.EndTime),t.push(this.TimeSeriesDataType),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.Unit),t.push(this.TimeStep),t.push(this.Values),t}},Rv=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.TotalCrossSectionArea=s,this.SteelGrade=i,this.BarSurface=r,this.EffectiveDepth=o,this.NominalBarDiameter=n,this.BarCount=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Rv(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.TotalCrossSectionArea),t.push(this.SteelGrade),t.push(this.BarSurface),t.push(this.EffectiveDepth),t.push(this.NominalBarDiameter),t.push(this.BarCount),t}},Lv=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.DefinitionType=n,this.ReinforcementSectionDefinitions=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Lv(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.DefinitionType),t.push(this.ReinforcementSectionDefinitions),t}},Nv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.NominalDiameter=p,this.CrossSectionArea=c,this.BarLength=d,this.PredefinedType=m,this.BarSurface=f}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new Nv(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.SteelGrade),t.push(this.NominalDiameter),t.push(this.CrossSectionArea),t.push(this.BarLength),t.push(this.PredefinedType),t.push(this.BarSurface),t}},Bv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.NominalDiameter=c,this.CrossSectionArea=d,this.BarLength=m,this.BarSurface=f,this.BendingShapeCode=g,this.BendingParameters=_}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++];return new Bv(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.NominalDiameter),t.push(this.CrossSectionArea),t.push(this.BarLength),t.push(this.BarSurface),t.push(this.BendingShapeCode),t.push(this.BendingParameters),t}},kv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new kv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.SteelGrade),t}},jv=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new jv(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},Gv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.MeshLength=p,this.MeshWidth=c,this.LongitudinalBarNominalDiameter=d,this.TransverseBarNominalDiameter=m,this.LongitudinalBarCrossSectionArea=f,this.TransverseBarCrossSectionArea=g,this.LongitudinalBarSpacing=_,this.TransverseBarSpacing=y,this.PredefinedType=v}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],P=s[i++];return new Gv(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.SteelGrade),t.push(this.MeshLength),t.push(this.MeshWidth),t.push(this.LongitudinalBarNominalDiameter),t.push(this.TransverseBarNominalDiameter),t.push(this.LongitudinalBarCrossSectionArea),t.push(this.TransverseBarCrossSectionArea),t.push(this.LongitudinalBarSpacing),t.push(this.TransverseBarSpacing),t.push(this.PredefinedType),t}},Hv=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.MeshLength=c,this.MeshWidth=d,this.LongitudinalBarNominalDiameter=m,this.TransverseBarNominalDiameter=f,this.LongitudinalBarCrossSectionArea=g,this.TransverseBarCrossSectionArea=_,this.LongitudinalBarSpacing=y,this.TransverseBarSpacing=v,this.BendingShapeCode=b,this.BendingParameters=P}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],P=s[i++],T=s[i++],w=s[i++];return new Hv(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P,T,w)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.MeshLength),t.push(this.MeshWidth),t.push(this.LongitudinalBarNominalDiameter),t.push(this.TransverseBarNominalDiameter),t.push(this.LongitudinalBarCrossSectionArea),t.push(this.TransverseBarCrossSectionArea),t.push(this.LongitudinalBarSpacing),t.push(this.TransverseBarSpacing),t.push(this.BendingShapeCode),t.push(this.BendingParameters),t}},Vv=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingObject=n,this.RelatedObjects=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Vv(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingObject),t.push(this.RelatedObjects),t}},zv=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new zv(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t}},Uv=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingActor=h,this.ActingRole=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Uv(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingActor),t.push(this.ActingRole),t}},Xv=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingControl=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Xv(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingControl),t}},Wv=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingGroup=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Wv(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingGroup),t}},Yv=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingGroup=h,this.Factor=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Yv(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingGroup),t.push(this.Factor),t}},Kv=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingProcess=h,this.QuantityInProcess=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Kv(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingProcess),t.push(this.QuantityInProcess),t}},Zv=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingProduct=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Zv(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingProduct),t}},qv=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatedObjectsType=a,this.RelatingResource=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new qv(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatedObjectsType),t.push(this.RelatingResource),t}},$v=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new $v(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t}},Qv=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingApproval=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Qv(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingApproval),t}},Jv=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingClassification=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Jv(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingClassification),t}},tb=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.Intent=a,this.RelatingConstraint=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new tb(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.Intent),t.push(this.RelatingConstraint),t}},eb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingDocument=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new eb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingDocument),t}},sb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingLibrary=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new sb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingLibrary),t}},ib=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingMaterial=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new ib(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingMaterial),t}},rb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new rb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},ob=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ConnectionGeometry=n,this.RelatingElement=a,this.RelatedElement=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new ob(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ConnectionGeometry),t.push(this.RelatingElement),t.push(this.RelatedElement),t}},nb=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ConnectionGeometry=n,this.RelatingElement=a,this.RelatedElement=h,this.RelatingPriorities=l,this.RelatedPriorities=u,this.RelatedConnectionType=p,this.RelatingConnectionType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new nb(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ConnectionGeometry),t.push(this.RelatingElement),t.push(this.RelatedElement),t.push(this.RelatingPriorities),t.push(this.RelatedPriorities),t.push(this.RelatedConnectionType),t.push(this.RelatingConnectionType),t}},ab=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingPort=n,this.RelatedElement=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new ab(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingPort),t.push(this.RelatedElement),t}},hb=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingPort=n,this.RelatedPort=a,this.RealizingElement=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new hb(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingPort),t.push(this.RelatedPort),t.push(this.RealizingElement),t}},lb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingElement=n,this.RelatedStructuralActivity=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new lb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingElement),t.push(this.RelatedStructuralActivity),t}},ub=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingStructuralMember=n,this.RelatedStructuralConnection=a,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=u,this.ConditionCoordinateSystem=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ub(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingStructuralMember),t.push(this.RelatedStructuralConnection),t.push(this.AppliedCondition),t.push(this.AdditionalConditions),t.push(this.SupportedLength),t.push(this.ConditionCoordinateSystem),t}},pb=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingStructuralMember=n,this.RelatedStructuralConnection=a,this.AppliedCondition=h,this.AdditionalConditions=l,this.SupportedLength=u,this.ConditionCoordinateSystem=p,this.ConnectionConstraint=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new pb(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingStructuralMember),t.push(this.RelatedStructuralConnection),t.push(this.AppliedCondition),t.push(this.AdditionalConditions),t.push(this.SupportedLength),t.push(this.ConditionCoordinateSystem),t.push(this.ConnectionConstraint),t}},cb=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ConnectionGeometry=n,this.RelatingElement=a,this.RelatedElement=h,this.RealizingElements=l,this.ConnectionType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new cb(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ConnectionGeometry),t.push(this.RelatingElement),t.push(this.RelatedElement),t.push(this.RealizingElements),t.push(this.ConnectionType),t}},db=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedElements=n,this.RelatingStructure=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new db(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedElements),t.push(this.RelatingStructure),t}},mb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingBuildingElement=n,this.RelatedCoverings=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new mb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingBuildingElement),t.push(this.RelatedCoverings),t}},fb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedCoverings=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new fb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingSpace),t.push(this.RelatedCoverings),t}},gb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingContext=n,this.RelatedDefinitions=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new gb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingContext),t.push(this.RelatedDefinitions),t}},_b=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new _b(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},yb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new yb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},vb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingObject=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new vb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingObject),t}},bb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingPropertyDefinition=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new bb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingPropertyDefinition),t}},Pb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedPropertySets=n,this.RelatingTemplate=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Pb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedPropertySets),t.push(this.RelatingTemplate),t}},Tb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedObjects=n,this.RelatingType=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Tb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedObjects),t.push(this.RelatingType),t}},wb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingOpeningElement=n,this.RelatedBuildingElement=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new wb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingOpeningElement),t.push(this.RelatedBuildingElement),t}},xb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedControlElements=n,this.RelatingFlowElement=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new xb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedControlElements),t.push(this.RelatingFlowElement),t}},Mb=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingElement=n,this.RelatedElement=a,this.InterferenceGeometry=h,this.InterferenceType=l,this.ImpliedOrder=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Mb(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingElement),t.push(this.RelatedElement),t.push(this.InterferenceGeometry),t.push(this.InterferenceType),t.push(this.ImpliedOrder),t}},Db=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingObject=n,this.RelatedObjects=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Db(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingObject),t.push(this.RelatedObjects),t}},Eb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingPositioningElement=n,this.RelatedProducts=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Eb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingPositioningElement),t.push(this.RelatedProducts),t}},Ib=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingElement=n,this.RelatedFeatureElement=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Ib(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingElement),t.push(this.RelatedFeatureElement),t}},Sb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatedElements=n,this.RelatingStructure=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Sb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatedElements),t.push(this.RelatingStructure),t}},Ab=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingProcess=n,this.RelatedProcess=a,this.TimeLag=h,this.SequenceType=l,this.UserDefinedSequenceType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ab(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingProcess),t.push(this.RelatedProcess),t.push(this.TimeLag),t.push(this.SequenceType),t.push(this.UserDefinedSequenceType),t}},Cb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSystem=n,this.RelatedBuildings=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Cb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingSystem),t.push(this.RelatedBuildings),t}},Fb=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedBuildingElement=a,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Fb(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingSpace),t.push(this.RelatedBuildingElement),t.push(this.ConnectionGeometry),t.push(this.PhysicalOrVirtualBoundary),t.push(this.InternalOrExternalBoundary),t}},Ob=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedBuildingElement=a,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=u,this.ParentBoundary=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ob(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingSpace),t.push(this.RelatedBuildingElement),t.push(this.ConnectionGeometry),t.push(this.PhysicalOrVirtualBoundary),t.push(this.InternalOrExternalBoundary),t.push(this.ParentBoundary),t}},Rb=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingSpace=n,this.RelatedBuildingElement=a,this.ConnectionGeometry=h,this.PhysicalOrVirtualBoundary=l,this.InternalOrExternalBoundary=u,this.ParentBoundary=p,this.CorrespondingBoundary=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new Rb(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingSpace),t.push(this.RelatedBuildingElement),t.push(this.ConnectionGeometry),t.push(this.PhysicalOrVirtualBoundary),t.push(this.InternalOrExternalBoundary),t.push(this.ParentBoundary),t.push(this.CorrespondingBoundary),t}},Lb=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.RelatingBuildingElement=n,this.RelatedOpeningElement=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Lb(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.RelatingBuildingElement),t.push(this.RelatedOpeningElement),t}},Nb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Nb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},Bb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Transition=s,this.SameSense=i,this.ParentCurve=r,this.ParamLength=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Bb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Transition),t.push(this.SameSense),t.push(this.ParentCurve),t.push(this.ParamLength),t}},kb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new kb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ContextOfItems),t.push(this.RepresentationIdentifier),t.push(this.RepresentationType),t.push(this.Items),t}},jb=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.ContextIdentifier=s,this.ContextType=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new jb(t,e,r,o)}ToTape(){let t=[];return t.push(this.ContextIdentifier),t.push(this.ContextType),t}},Gb=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new Gb(t,e)}ToTape(){return[]}},Hb=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.MappingOrigin=s,this.MappedRepresentation=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Hb(t,e,r,o)}ToTape(){let t=[];return t.push(this.MappingOrigin),t.push(this.MappedRepresentation),t}},Vb=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Vb(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t}},zb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatedResourceObjects=r,this.RelatingApproval=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new zb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatedResourceObjects),t.push(this.RelatingApproval),t}},Ub=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.RelatingConstraint=r,this.RelatedResourceObjects=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Ub(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.RelatingConstraint),t.push(this.RelatedResourceObjects),t}},Xb=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Name=s,this.Description=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Xb(t,e,r,o)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t}},Wb=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.ScheduleWork=o,this.ScheduleUsage=n,this.ScheduleStart=a,this.ScheduleFinish=h,this.ScheduleContour=l,this.LevelingDelay=u,this.IsOverAllocated=p,this.StatusTime=c,this.ActualWork=d,this.ActualUsage=m,this.ActualStart=f,this.ActualFinish=g,this.RemainingWork=_,this.RemainingUsage=y,this.Completion=v}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],P=s[i++];return new Wb(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.ScheduleWork),t.push(this.ScheduleUsage),t.push(this.ScheduleStart),t.push(this.ScheduleFinish),t.push(this.ScheduleContour),t.push(this.LevelingDelay),t.push(this.IsOverAllocated),t.push(this.StatusTime),t.push(this.ActualWork),t.push(this.ActualUsage),t.push(this.ActualStart),t.push(this.ActualFinish),t.push(this.RemainingWork),t.push(this.RemainingUsage),t.push(this.Completion),t}},Yb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i,this.Axis=r,this.Angle=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Yb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t.push(this.Axis),t.push(this.Angle),t}},Kb=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i,this.Axis=r,this.Angle=o,this.EndSweptArea=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Kb(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t.push(this.Axis),t.push(this.Angle),t.push(this.EndSweptArea),t}},Zb=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Position=s,this.Height=i,this.BottomRadius=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Zb(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Position),t.push(this.Height),t.push(this.BottomRadius),t}},qb=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Position=s,this.Height=i,this.Radius=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new qb(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Position),t.push(this.Height),t.push(this.Radius),t}},$b=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new $b(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Qb=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Qb(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Jb=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Jb(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t}},tP=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.XDim=o,this.YDim=n,this.RoundingRadius=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new tP(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.XDim),t.push(this.YDim),t.push(this.RoundingRadius),t}},eP=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Dimensions=s,this.UnitType=i,this.Prefix=r,this.Name=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new eP(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Dimensions),t.push(this.UnitType),t.push(this.Prefix),t.push(this.Name),t}},sP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new sP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},iP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new iP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},rP=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new rP(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t}},oP=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Curve3D=s,this.AssociatedGeometry=i,this.MasterRepresentation=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new oP(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Curve3D),t.push(this.AssociatedGeometry),t.push(this.MasterRepresentation),t}},nP=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.SectionType=s,this.StartProfile=i,this.EndProfile=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new nP(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.SectionType),t.push(this.StartProfile),t.push(this.EndProfile),t}},aP=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.LongitudinalStartPosition=s,this.LongitudinalEndPosition=i,this.TransversePosition=r,this.ReinforcementRole=o,this.SectionDefinition=n,this.CrossSectionReinforcementDefinitions=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new aP(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.LongitudinalStartPosition),t.push(this.LongitudinalEndPosition),t.push(this.TransversePosition),t.push(this.ReinforcementRole),t.push(this.SectionDefinition),t.push(this.CrossSectionReinforcementDefinitions),t}},hP=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Directrix=s,this.CrossSections=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new hP(t,e,r,o)}ToTape(){let t=[];return t.push(this.Directrix),t.push(this.CrossSections),t}},lP=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Directrix=s,this.CrossSections=i,this.CrossSectionPositions=r,this.FixedAxisVertical=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new lP(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Directrix),t.push(this.CrossSections),t.push(this.CrossSectionPositions),t.push(this.FixedAxisVertical),t}},uP=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.SpineCurve=s,this.CrossSections=i,this.CrossSectionPositions=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new uP(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.SpineCurve),t.push(this.CrossSections),t.push(this.CrossSectionPositions),t}},pP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new pP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},cP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new cP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},dP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new dP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},mP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new mP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},fP=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.ShapeRepresentations=s,this.Name=i,this.Description=r,this.ProductDefinitional=o,this.PartOfProductDefinitionShape=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new fP(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.ShapeRepresentations),t.push(this.Name),t.push(this.Description),t.push(this.ProductDefinitional),t.push(this.PartOfProductDefinitionShape),t}},gP=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new gP(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ContextOfItems),t.push(this.RepresentationIdentifier),t.push(this.RepresentationType),t.push(this.Items),t}},_P=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new _P(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ContextOfItems),t.push(this.RepresentationIdentifier),t.push(this.RepresentationType),t.push(this.Items),t}},yP=class{constructor(t,e,s){this.expressID=t,this.type=e,this.SbsmBoundary=s}static FromTape(t,e,s){let i=0,r=s[i++];return new yP(t,e,r)}ToTape(){let t=[];return t.push(this.SbsmBoundary),t}},vP=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Name=s,this.Description=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new vP(t,e,r,o)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t}},bP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.TemplateType=n,this.PrimaryMeasureType=a,this.SecondaryMeasureType=h,this.Enumerators=l,this.PrimaryUnit=u,this.SecondaryUnit=p,this.Expression=c,this.AccessState=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new bP(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.TemplateType),t.push(this.PrimaryMeasureType),t.push(this.SecondaryMeasureType),t.push(this.Enumerators),t.push(this.PrimaryUnit),t.push(this.SecondaryUnit),t.push(this.Expression),t.push(this.AccessState),t}},PP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.RefLatitude=p,this.RefLongitude=c,this.RefElevation=d,this.LandTitleNumber=m,this.SiteAddress=f}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new PP(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t.push(this.RefLatitude),t.push(this.RefLongitude),t.push(this.RefElevation),t.push(this.LandTitleNumber),t.push(this.SiteAddress),t}},TP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new TP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},wP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new wP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},xP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},MP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new MP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},DP=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.SlippageX=i,this.SlippageY=r,this.SlippageZ=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new DP(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.SlippageX),t.push(this.SlippageY),t.push(this.SlippageZ),t}},EP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new EP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},IP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new IP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},SP=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new SP(t,e)}ToTape(){return[]}},AP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u,this.PredefinedType=p,this.ElevationWithFlooring=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new AP(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t.push(this.PredefinedType),t.push(this.ElevationWithFlooring),t}},CP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new CP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},FP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new FP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},OP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.LongName=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new OP(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.LongName),t}},RP=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new RP(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t}},LP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new LP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},NP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.CompositionType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new NP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.CompositionType),t}},BP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new BP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t}},kP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.LongName=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new kP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.LongName),t.push(this.PredefinedType),t}},jP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.LongName=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new jP(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.LongName),t}},GP=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Position=s,this.Radius=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new GP(t,e,r,o)}ToTape(){let t=[];return t.push(this.Position),t.push(this.Radius),t}},HP=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Position=s,this.Radius=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new HP(t,e,r,o)}ToTape(){let t=[];return t.push(this.Position),t.push(this.Radius),t}},VP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new VP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},zP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new zP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},UP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new UP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},XP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.NumberOfRisers=u,this.NumberOfTreads=p,this.RiserHeight=c,this.TreadLength=d,this.PredefinedType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new XP(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.NumberOfRisers),t.push(this.NumberOfTreads),t.push(this.RiserHeight),t.push(this.TreadLength),t.push(this.PredefinedType),t}},WP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new WP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},YP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new YP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},KP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new KP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.DestabilizingLoad),t}},ZP=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ZP(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t}},qP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.OrientationOf2DPlane=h,this.LoadedBy=l,this.HasResults=u,this.SharedPlacement=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new qP(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.PredefinedType),t.push(this.OrientationOf2DPlane),t.push(this.LoadedBy),t.push(this.HasResults),t.push(this.SharedPlacement),t}},$P=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new $P(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedCondition),t}},QP=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new QP(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},JP=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=p,this.ProjectedOrTrue=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new JP(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.DestabilizingLoad),t.push(this.ProjectedOrTrue),t.push(this.PredefinedType),t}},tT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l,this.Axis=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new tT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedCondition),t.push(this.Axis),t}},eT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Axis=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new eT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.PredefinedType),t.push(this.Axis),t}},sT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Axis=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new sT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.PredefinedType),t.push(this.Axis),t}},iT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new iT(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.PredefinedType),t}},rT=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new rT(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t}},oT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=p,this.ProjectedOrTrue=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new oT(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.DestabilizingLoad),t.push(this.ProjectedOrTrue),t.push(this.PredefinedType),t}},nT=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new nT(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},aT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.ActionType=h,this.ActionSource=l,this.Coefficient=u,this.Purpose=p,this.SelfWeightCoefficients=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new aT(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.PredefinedType),t.push(this.ActionType),t.push(this.ActionSource),t.push(this.Coefficient),t.push(this.Purpose),t.push(this.SelfWeightCoefficients),t}},hT=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Values=i,this.Locations=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new hT(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Values),t.push(this.Locations),t}},lT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.PredefinedType=a,this.ActionType=h,this.ActionSource=l,this.Coefficient=u,this.Purpose=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new lT(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.PredefinedType),t.push(this.ActionType),t.push(this.ActionSource),t.push(this.Coefficient),t.push(this.Purpose),t}},uT=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.LinearForceX=i,this.LinearForceY=r,this.LinearForceZ=o,this.LinearMomentX=n,this.LinearMomentY=a,this.LinearMomentZ=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new uT(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.LinearForceX),t.push(this.LinearForceY),t.push(this.LinearForceZ),t.push(this.LinearMomentX),t.push(this.LinearMomentY),t.push(this.LinearMomentZ),t}},pT=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new pT(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},cT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.PlanarForceX=i,this.PlanarForceY=r,this.PlanarForceZ=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new cT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.PlanarForceX),t.push(this.PlanarForceY),t.push(this.PlanarForceZ),t}},dT=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.DisplacementX=i,this.DisplacementY=r,this.DisplacementZ=o,this.RotationalDisplacementRX=n,this.RotationalDisplacementRY=a,this.RotationalDisplacementRZ=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new dT(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DisplacementX),t.push(this.DisplacementY),t.push(this.DisplacementZ),t.push(this.RotationalDisplacementRX),t.push(this.RotationalDisplacementRY),t.push(this.RotationalDisplacementRZ),t}},mT=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Name=s,this.DisplacementX=i,this.DisplacementY=r,this.DisplacementZ=o,this.RotationalDisplacementRX=n,this.RotationalDisplacementRY=a,this.RotationalDisplacementRZ=h,this.Distortion=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new mT(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DisplacementX),t.push(this.DisplacementY),t.push(this.DisplacementZ),t.push(this.RotationalDisplacementRX),t.push(this.RotationalDisplacementRY),t.push(this.RotationalDisplacementRZ),t.push(this.Distortion),t}},fT=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.Name=s,this.ForceX=i,this.ForceY=r,this.ForceZ=o,this.MomentX=n,this.MomentY=a,this.MomentZ=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new fT(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.Name),t.push(this.ForceX),t.push(this.ForceY),t.push(this.ForceZ),t.push(this.MomentX),t.push(this.MomentY),t.push(this.MomentZ),t}},gT=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Name=s,this.ForceX=i,this.ForceY=r,this.ForceZ=o,this.MomentX=n,this.MomentY=a,this.MomentZ=h,this.WarpingMoment=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new gT(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Name),t.push(this.ForceX),t.push(this.ForceY),t.push(this.ForceZ),t.push(this.MomentX),t.push(this.MomentY),t.push(this.MomentZ),t.push(this.WarpingMoment),t}},_T=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Name=s}static FromTape(t,e,s){let i=0,r=s[i++];return new _T(t,e,r)}ToTape(){let t=[];return t.push(this.Name),t}},yT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.DeltaTConstant=i,this.DeltaTY=r,this.DeltaTZ=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new yT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DeltaTConstant),t.push(this.DeltaTY),t.push(this.DeltaTZ),t}},vT=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new vT(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t}},bT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=p,this.ProjectedOrTrue=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new bT(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.DestabilizingLoad),t.push(this.ProjectedOrTrue),t.push(this.PredefinedType),t}},PT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new PT(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.DestabilizingLoad),t}},TT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l,this.ConditionCoordinateSystem=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new TT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedCondition),t.push(this.ConditionCoordinateSystem),t}},wT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new wT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t}},xT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t}},MT=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.TheoryType=a,this.ResultForLoadGroup=h,this.IsLinear=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new MT(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.TheoryType),t.push(this.ResultForLoadGroup),t.push(this.IsLinear),t}},DT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.DestabilizingLoad=p,this.ProjectedOrTrue=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new DT(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.DestabilizingLoad),t.push(this.ProjectedOrTrue),t.push(this.PredefinedType),t}},ET=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedCondition=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new ET(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedCondition),t}},IT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Thickness=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new IT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.PredefinedType),t.push(this.Thickness),t}},ST=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.PredefinedType=l,this.Thickness=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ST(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.PredefinedType),t.push(this.Thickness),t}},AT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.AppliedLoad=l,this.GlobalOrLocal=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new AT(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.AppliedLoad),t.push(this.GlobalOrLocal),t.push(this.PredefinedType),t}},CT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new CT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ContextOfItems),t.push(this.RepresentationIdentifier),t.push(this.RepresentationType),t.push(this.Items),t}},FT=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Item=s,this.Styles=i,this.Name=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new FT(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Item),t.push(this.Styles),t.push(this.Name),t}},OT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new OT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ContextOfItems),t.push(this.RepresentationIdentifier),t.push(this.RepresentationType),t.push(this.Items),t}},RT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Usage=l,this.BaseCosts=u,this.BaseQuantity=p,this.PredefinedType=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new RT(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Usage),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},LT=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u,this.BaseCosts=p,this.BaseQuantity=c,this.PredefinedType=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new LT(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t.push(this.BaseCosts),t.push(this.BaseQuantity),t.push(this.PredefinedType),t}},NT=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.EdgeStart=s,this.EdgeEnd=i,this.ParentEdge=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new NT(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.EdgeStart),t.push(this.EdgeEnd),t.push(this.ParentEdge),t}},BT=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new BT(t,e)}ToTape(){return[]}},kT=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Curve3D=s,this.AssociatedGeometry=i,this.MasterRepresentation=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new kT(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Curve3D),t.push(this.AssociatedGeometry),t.push(this.MasterRepresentation),t}},jT=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i,this.Directrix=r,this.StartParam=o,this.EndParam=n,this.ReferenceSurface=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new jT(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t.push(this.Directrix),t.push(this.StartParam),t.push(this.EndParam),t.push(this.ReferenceSurface),t}},GT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new GT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},HT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.SweptCurve=s,this.Position=i,this.ExtrudedDirection=r,this.Depth=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new HT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.SweptCurve),t.push(this.Position),t.push(this.ExtrudedDirection),t.push(this.Depth),t}},VT=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.SweptCurve=s,this.Position=i,this.AxisPosition=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new VT(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.SweptCurve),t.push(this.Position),t.push(this.AxisPosition),t}},zT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.Name=s,this.SurfaceReinforcement1=i,this.SurfaceReinforcement2=r,this.ShearReinforcement=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new zT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.Name),t.push(this.SurfaceReinforcement1),t.push(this.SurfaceReinforcement2),t.push(this.ShearReinforcement),t}},UT=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Side=i,this.Styles=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new UT(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Side),t.push(this.Styles),t}},XT=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.DiffuseTransmissionColour=s,this.DiffuseReflectionColour=i,this.TransmissionColour=r,this.ReflectanceColour=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new XT(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.DiffuseTransmissionColour),t.push(this.DiffuseReflectionColour),t.push(this.TransmissionColour),t.push(this.ReflectanceColour),t}},WT=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.RefractionIndex=s,this.DispersionFactor=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new WT(t,e,r,o)}ToTape(){let t=[];return t.push(this.RefractionIndex),t.push(this.DispersionFactor),t}},YT=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.SurfaceColour=s,this.Transparency=i,this.DiffuseColour=r,this.TransmissionColour=o,this.DiffuseTransmissionColour=n,this.ReflectionColour=a,this.SpecularColour=h,this.SpecularHighlight=l,this.ReflectanceMethod=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new YT(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.SurfaceColour),t.push(this.Transparency),t.push(this.DiffuseColour),t.push(this.TransmissionColour),t.push(this.DiffuseTransmissionColour),t.push(this.ReflectionColour),t.push(this.SpecularColour),t.push(this.SpecularHighlight),t.push(this.ReflectanceMethod),t}},KT=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.SurfaceColour=s,this.Transparency=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new KT(t,e,r,o)}ToTape(){let t=[];return t.push(this.SurfaceColour),t.push(this.Transparency),t}},ZT=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Textures=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ZT(t,e,r)}ToTape(){let t=[];return t.push(this.Textures),t}},qT=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.RepeatS=s,this.RepeatT=i,this.Mode=r,this.TextureTransform=o,this.Parameter=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new qT(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.RepeatS),t.push(this.RepeatT),t.push(this.Mode),t.push(this.TextureTransform),t.push(this.Parameter),t}},$T=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.SweptArea=s,this.Position=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new $T(t,e,r,o)}ToTape(){let t=[];return t.push(this.SweptArea),t.push(this.Position),t}},QT=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Directrix=s,this.Radius=i,this.InnerRadius=r,this.StartParam=o,this.EndParam=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new QT(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Directrix),t.push(this.Radius),t.push(this.InnerRadius),t.push(this.StartParam),t.push(this.EndParam),t}},JT=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Directrix=s,this.Radius=i,this.InnerRadius=r,this.StartParam=o,this.EndParam=n,this.FilletRadius=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new JT(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Directrix),t.push(this.Radius),t.push(this.InnerRadius),t.push(this.StartParam),t.push(this.EndParam),t.push(this.FilletRadius),t}},tw=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.SweptCurve=s,this.Position=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new tw(t,e,r,o)}ToTape(){let t=[];return t.push(this.SweptCurve),t.push(this.Position),t}},ew=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ew(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},sw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new sw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},iw=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new iw(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t}},rw=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new rw(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ow=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ow(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},nw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.FlangeWidth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.FlangeEdgeRadius=u,this.WebEdgeRadius=p,this.WebSlope=c,this.FlangeSlope=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new nw(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Depth),t.push(this.FlangeWidth),t.push(this.WebThickness),t.push(this.FlangeThickness),t.push(this.FilletRadius),t.push(this.FlangeEdgeRadius),t.push(this.WebEdgeRadius),t.push(this.WebSlope),t.push(this.FlangeSlope),t}},aw=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Name=s,this.Rows=i,this.Columns=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new aw(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Rows),t.push(this.Columns),t}},hw=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Identifier=s,this.Name=i,this.Description=r,this.Unit=o,this.ReferencePath=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new hw(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Identifier),t.push(this.Name),t.push(this.Description),t.push(this.Unit),t.push(this.ReferencePath),t}},lw=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.RowCells=s,this.IsHeading=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new lw(t,e,r,o)}ToTape(){let t=[];return t.push(this.RowCells),t.push(this.IsHeading),t}},uw=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new uw(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},pw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new pw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},cw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.LongDescription=h,this.Status=l,this.WorkMethod=u,this.IsMilestone=p,this.Priority=c,this.TaskTime=d,this.PredefinedType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new cw(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.LongDescription),t.push(this.Status),t.push(this.WorkMethod),t.push(this.IsMilestone),t.push(this.Priority),t.push(this.TaskTime),t.push(this.PredefinedType),t}},dw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.DurationType=o,this.ScheduleDuration=n,this.ScheduleStart=a,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=u,this.LateStart=p,this.LateFinish=c,this.FreeFloat=d,this.TotalFloat=m,this.IsCritical=f,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=v,this.RemainingTime=b,this.Completion=P}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],P=s[i++],T=s[i++],w=s[i++];return new dw(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P,T,w)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.DurationType),t.push(this.ScheduleDuration),t.push(this.ScheduleStart),t.push(this.ScheduleFinish),t.push(this.EarlyStart),t.push(this.EarlyFinish),t.push(this.LateStart),t.push(this.LateFinish),t.push(this.FreeFloat),t.push(this.TotalFloat),t.push(this.IsCritical),t.push(this.StatusTime),t.push(this.ActualDuration),t.push(this.ActualStart),t.push(this.ActualFinish),t.push(this.RemainingTime),t.push(this.Completion),t}},mw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P,T){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.DurationType=o,this.ScheduleDuration=n,this.ScheduleStart=a,this.ScheduleFinish=h,this.EarlyStart=l,this.EarlyFinish=u,this.LateStart=p,this.LateFinish=c,this.FreeFloat=d,this.TotalFloat=m,this.IsCritical=f,this.StatusTime=g,this.ActualDuration=_,this.ActualStart=y,this.ActualFinish=v,this.RemainingTime=b,this.Completion=P,this.Recurrence=T}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++],P=s[i++],T=s[i++],w=s[i++],x=s[i++];return new mw(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b,P,T,w,x)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.DurationType),t.push(this.ScheduleDuration),t.push(this.ScheduleStart),t.push(this.ScheduleFinish),t.push(this.EarlyStart),t.push(this.EarlyFinish),t.push(this.LateStart),t.push(this.LateFinish),t.push(this.FreeFloat),t.push(this.TotalFloat),t.push(this.IsCritical),t.push(this.StatusTime),t.push(this.ActualDuration),t.push(this.ActualStart),t.push(this.ActualFinish),t.push(this.RemainingTime),t.push(this.Completion),t.push(this.Recurrence),t}},fw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u,this.PredefinedType=p,this.WorkMethod=c}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++];return new fw(t,e,r,o,n,a,h,l,u,p,c,d,m)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ProcessType),t.push(this.PredefinedType),t.push(this.WorkMethod),t}},gw=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.Purpose=s,this.Description=i,this.UserDefinedPurpose=r,this.TelephoneNumbers=o,this.FacsimileNumbers=n,this.PagerNumber=a,this.ElectronicMailAddresses=h,this.WWWHomePageURL=l,this.MessagingIDs=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new gw(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.Purpose),t.push(this.Description),t.push(this.UserDefinedPurpose),t.push(this.TelephoneNumbers),t.push(this.FacsimileNumbers),t.push(this.PagerNumber),t.push(this.ElectronicMailAddresses),t.push(this.WWWHomePageURL),t.push(this.MessagingIDs),t}},_w=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.PredefinedType=p,this.NominalDiameter=c,this.CrossSectionArea=d,this.TensionForce=m,this.PreStress=f,this.FrictionCoefficient=g,this.AnchorageSlip=_,this.MinCurvatureRadius=y}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++],b=s[i++];return new _w(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v,b)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.SteelGrade),t.push(this.PredefinedType),t.push(this.NominalDiameter),t.push(this.CrossSectionArea),t.push(this.TensionForce),t.push(this.PreStress),t.push(this.FrictionCoefficient),t.push(this.AnchorageSlip),t.push(this.MinCurvatureRadius),t}},yw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new yw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.SteelGrade),t.push(this.PredefinedType),t}},vw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new vw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},bw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.SteelGrade=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new bw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.SteelGrade),t.push(this.PredefinedType),t}},Pw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Pw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Tw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.NominalDiameter=c,this.CrossSectionArea=d,this.SheathDiameter=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Tw(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.NominalDiameter),t.push(this.CrossSectionArea),t.push(this.SheathDiameter),t}},ww=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Coordinates=s}static FromTape(t,e,s){let i=0,r=s[i++];return new ww(t,e,r)}ToTape(){let t=[];return t.push(this.Coordinates),t}},xw=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new xw(t,e)}ToTape(){return[]}},Mw=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Literal=s,this.Placement=i,this.Path=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Mw(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Literal),t.push(this.Placement),t.push(this.Path),t}},Dw=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Literal=s,this.Placement=i,this.Path=r,this.Extent=o,this.BoxAlignment=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Dw(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Literal),t.push(this.Placement),t.push(this.Path),t.push(this.Extent),t.push(this.BoxAlignment),t}},Ew=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Name=s,this.TextCharacterAppearance=i,this.TextStyle=r,this.TextFontStyle=o,this.ModelOrDraughting=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Ew(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Name),t.push(this.TextCharacterAppearance),t.push(this.TextStyle),t.push(this.TextFontStyle),t.push(this.ModelOrDraughting),t}},Iw=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Name=s,this.FontFamily=i,this.FontStyle=r,this.FontVariant=o,this.FontWeight=n,this.FontSize=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Iw(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Name),t.push(this.FontFamily),t.push(this.FontStyle),t.push(this.FontVariant),t.push(this.FontWeight),t.push(this.FontSize),t}},Sw=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Colour=s,this.BackgroundColour=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Sw(t,e,r,o)}ToTape(){let t=[];return t.push(this.Colour),t.push(this.BackgroundColour),t}},Aw=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.TextIndent=s,this.TextAlign=i,this.TextDecoration=r,this.LetterSpacing=o,this.WordSpacing=n,this.TextTransform=a,this.LineHeight=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Aw(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.TextIndent),t.push(this.TextAlign),t.push(this.TextDecoration),t.push(this.LetterSpacing),t.push(this.WordSpacing),t.push(this.TextTransform),t.push(this.LineHeight),t}},Cw=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Maps=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Cw(t,e,r)}ToTape(){let t=[];return t.push(this.Maps),t}},Fw=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Maps=s,this.Mode=i,this.Parameter=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Fw(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Maps),t.push(this.Mode),t.push(this.Parameter),t}},Ow=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Maps=s,this.Vertices=i,this.MappedTo=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Ow(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Maps),t.push(this.Vertices),t.push(this.MappedTo),t}},Rw=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Coordinates=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Rw(t,e,r)}ToTape(){let t=[];return t.push(this.Coordinates),t}},Lw=class{constructor(t,e,s){this.expressID=t,this.type=e,this.TexCoordsList=s}static FromTape(t,e,s){let i=0,r=s[i++];return new Lw(t,e,r)}ToTape(){let t=[];return t.push(this.TexCoordsList),t}},Nw=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.StartTime=s,this.EndTime=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new Nw(t,e,r,o)}ToTape(){let t=[];return t.push(this.StartTime),t.push(this.EndTime),t}},Bw=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.Name=s,this.Description=i,this.StartTime=r,this.EndTime=o,this.TimeSeriesDataType=n,this.DataOrigin=a,this.UserDefinedDataOrigin=h,this.Unit=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Bw(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.Name),t.push(this.Description),t.push(this.StartTime),t.push(this.EndTime),t.push(this.TimeSeriesDataType),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.Unit),t}},kw=class{constructor(t,e,s){this.expressID=t,this.type=e,this.ListValues=s}static FromTape(t,e,s){let i=0,r=s[i++];return new kw(t,e,r)}ToTape(){let t=[];return t.push(this.ListValues),t}},jw=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new jw(t,e)}ToTape(){return[]}},Gw=class{constructor(t,e,s,i,r,o){this.expressID=t,this.type=e,this.ContextOfItems=s,this.RepresentationIdentifier=i,this.RepresentationType=r,this.Items=o}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++];return new Gw(t,e,r,o,n,a)}ToTape(){let t=[];return t.push(this.ContextOfItems),t.push(this.RepresentationIdentifier),t.push(this.RepresentationType),t.push(this.Items),t}},Hw=class{constructor(t,e,s,i,r){this.expressID=t,this.type=e,this.Position=s,this.MajorRadius=i,this.MinorRadius=r}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++];return new Hw(t,e,r,o,n)}ToTape(){let t=[];return t.push(this.Position),t.push(this.MajorRadius),t.push(this.MinorRadius),t}},Vw=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Vw(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},zw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new zw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Uw=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.StartPoint=s,this.StartDirection=i,this.SegmentLength=r,this.StartRadius=o,this.EndRadius=n,this.IsStartRadiusCCW=a,this.IsEndRadiusCCW=h,this.TransitionCurveType=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new Uw(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.StartPoint),t.push(this.StartDirection),t.push(this.SegmentLength),t.push(this.StartRadius),t.push(this.EndRadius),t.push(this.IsStartRadiusCCW),t.push(this.IsEndRadiusCCW),t.push(this.TransitionCurveType),t}},Xw=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Xw(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Ww=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ww(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Yw=class{constructor(t,e,s,i,r,o,n,a,h){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.BottomXDim=o,this.TopXDim=n,this.YDim=a,this.TopXOffset=h}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++];return new Yw(t,e,r,o,n,a,h,l,u)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.BottomXDim),t.push(this.TopXDim),t.push(this.YDim),t.push(this.TopXOffset),t}},Kw=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.Coordinates=s,this.Normals=i,this.Closed=r,this.CoordIndex=o,this.PnIndex=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new Kw(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.Coordinates),t.push(this.Normals),t.push(this.Closed),t.push(this.CoordIndex),t.push(this.PnIndex),t}},Zw=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Coordinates=s,this.Normals=i,this.Closed=r,this.CoordIndex=o,this.PnIndex=n,this.Flags=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Zw(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Coordinates),t.push(this.Normals),t.push(this.Closed),t.push(this.CoordIndex),t.push(this.PnIndex),t.push(this.Flags),t}},qw=class{constructor(t,e,s,i,r,o,n){this.expressID=t,this.type=e,this.BasisCurve=s,this.Trim1=i,this.Trim2=r,this.SenseAgreement=o,this.MasterRepresentation=n}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++];return new qw(t,e,r,o,n,a,h)}ToTape(){let t=[];return t.push(this.BasisCurve),t.push(this.Trim1),t.push(this.Trim2),t.push(this.SenseAgreement),t.push(this.MasterRepresentation),t}},$w=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new $w(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Qw=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Qw(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Jw=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Jw(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t}},tx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ProcessType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new tx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ProcessType),t}},ex=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new ex(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t}},sx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.Identification=h,this.LongDescription=l,this.ResourceType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new sx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.Identification),t.push(this.LongDescription),t.push(this.ResourceType),t}},ix=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.FlangeWidth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=u,this.FlangeSlope=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ix(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Depth),t.push(this.FlangeWidth),t.push(this.WebThickness),t.push(this.FlangeThickness),t.push(this.FilletRadius),t.push(this.EdgeRadius),t.push(this.FlangeSlope),t}},rx=class{constructor(t,e,s){this.expressID=t,this.type=e,this.Units=s}static FromTape(t,e,s){let i=0,r=s[i++];return new rx(t,e,r)}ToTape(){let t=[];return t.push(this.Units),t}},ox=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ox(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},nx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new nx(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},ax=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new ax(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},hx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new hx(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},lx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new lx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},ux=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new ux(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},px=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.Orientation=s,this.Magnitude=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new px(t,e,r,o)}ToTape(){let t=[];return t.push(this.Orientation),t.push(this.Magnitude),t}},cx=class{constructor(t,e){this.expressID=t,this.type=e}static FromTape(t,e,s){return new cx(t,e)}ToTape(){return[]}},dx=class{constructor(t,e,s){this.expressID=t,this.type=e,this.LoopVertex=s}static FromTape(t,e,s){let i=0,r=s[i++];return new dx(t,e,r)}ToTape(){let t=[];return t.push(this.LoopVertex),t}},mx=class{constructor(t,e,s){this.expressID=t,this.type=e,this.VertexGeometry=s}static FromTape(t,e,s){let i=0,r=s[i++];return new mx(t,e,r)}ToTape(){let t=[];return t.push(this.VertexGeometry),t}},fx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new fx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},gx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new gx(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},_x=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new _x(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},yx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new yx(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},vx=class{constructor(t,e,s,i,r,o,n,a,h,l){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++];return new vx(t,e,r,o,n,a,h,l,u,p)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t}},bx=class{constructor(t,e,s,i){this.expressID=t,this.type=e,this.IntersectingAxes=s,this.OffsetDistances=i}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++];return new bx(t,e,r,o)}ToTape(){let t=[];return t.push(this.IntersectingAxes),t.push(this.OffsetDistances),t}},Px=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Px(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Tx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Tx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},wx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new wx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},xx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new xx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Mx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Mx(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Dx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Dx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.PredefinedType),t}},Ex=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++];return new Ex(t,e,r,o,n,a,h,l,u,p,c,d)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t}},Ix=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=p,this.PredefinedType=c,this.PartitioningType=d,this.UserDefinedPartitioningType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Ix(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.OverallHeight),t.push(this.OverallWidth),t.push(this.PredefinedType),t.push(this.PartitioningType),t.push(this.UserDefinedPartitioningType),t}},Sx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f,g,_){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.LiningDepth=n,this.LiningThickness=a,this.TransomThickness=h,this.MullionThickness=l,this.FirstTransomOffset=u,this.SecondTransomOffset=p,this.FirstMullionOffset=c,this.SecondMullionOffset=d,this.ShapeAspectStyle=m,this.LiningOffset=f,this.LiningToPanelOffsetX=g,this.LiningToPanelOffsetY=_}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++],y=s[i++],v=s[i++];return new Sx(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_,y,v)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.LiningDepth),t.push(this.LiningThickness),t.push(this.TransomThickness),t.push(this.MullionThickness),t.push(this.FirstTransomOffset),t.push(this.SecondTransomOffset),t.push(this.FirstMullionOffset),t.push(this.SecondMullionOffset),t.push(this.ShapeAspectStyle),t.push(this.LiningOffset),t.push(this.LiningToPanelOffsetX),t.push(this.LiningToPanelOffsetY),t}},Ax=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.OperationType=n,this.PanelPosition=a,this.FrameDepth=h,this.FrameThickness=l,this.ShapeAspectStyle=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Ax(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.OperationType),t.push(this.PanelPosition),t.push(this.FrameDepth),t.push(this.FrameThickness),t.push(this.ShapeAspectStyle),t}},Cx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.ObjectPlacement=a,this.Representation=h,this.Tag=l,this.OverallHeight=u,this.OverallWidth=p,this.PredefinedType=c,this.PartitioningType=d,this.UserDefinedPartitioningType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Cx(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.ObjectPlacement),t.push(this.Representation),t.push(this.Tag),t.push(this.OverallHeight),t.push(this.OverallWidth),t.push(this.PredefinedType),t.push(this.PartitioningType),t.push(this.UserDefinedPartitioningType),t}},Fx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ConstructionType=u,this.OperationType=p,this.ParameterTakesPrecedence=c,this.Sizeable=d}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++];return new Fx(t,e,r,o,n,a,h,l,u,p,c,d,m,f)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ConstructionType),t.push(this.OperationType),t.push(this.ParameterTakesPrecedence),t.push(this.Sizeable),t}},Ox=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ApplicableOccurrence=n,this.HasPropertySets=a,this.RepresentationMaps=h,this.Tag=l,this.ElementType=u,this.PredefinedType=p,this.PartitioningType=c,this.ParameterTakesPrecedence=d,this.UserDefinedPartitioningType=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Ox(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ApplicableOccurrence),t.push(this.HasPropertySets),t.push(this.RepresentationMaps),t.push(this.Tag),t.push(this.ElementType),t.push(this.PredefinedType),t.push(this.PartitioningType),t.push(this.ParameterTakesPrecedence),t.push(this.UserDefinedPartitioningType),t}},Rx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.WorkingTimes=h,this.ExceptionTimes=l,this.PredefinedType=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new Rx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.WorkingTimes),t.push(this.ExceptionTimes),t.push(this.PredefinedType),t}},Lx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.CreationDate=h,this.Creators=l,this.Purpose=u,this.Duration=p,this.TotalFloat=c,this.StartTime=d,this.FinishTime=m}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++];return new Lx(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.CreationDate),t.push(this.Creators),t.push(this.Purpose),t.push(this.Duration),t.push(this.TotalFloat),t.push(this.StartTime),t.push(this.FinishTime),t}},Nx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.CreationDate=h,this.Creators=l,this.Purpose=u,this.Duration=p,this.TotalFloat=c,this.StartTime=d,this.FinishTime=m,this.PredefinedType=f}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new Nx(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.CreationDate),t.push(this.Creators),t.push(this.Purpose),t.push(this.Duration),t.push(this.TotalFloat),t.push(this.StartTime),t.push(this.FinishTime),t.push(this.PredefinedType),t}},Bx=class{constructor(t,e,s,i,r,o,n,a,h,l,u,p,c,d,m,f){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.Identification=a,this.CreationDate=h,this.Creators=l,this.Purpose=u,this.Duration=p,this.TotalFloat=c,this.StartTime=d,this.FinishTime=m,this.PredefinedType=f}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++],d=s[i++],m=s[i++],f=s[i++],g=s[i++],_=s[i++];return new Bx(t,e,r,o,n,a,h,l,u,p,c,d,m,f,g,_)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.Identification),t.push(this.CreationDate),t.push(this.Creators),t.push(this.Purpose),t.push(this.Duration),t.push(this.TotalFloat),t.push(this.StartTime),t.push(this.FinishTime),t.push(this.PredefinedType),t}},kx=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.Name=s,this.DataOrigin=i,this.UserDefinedDataOrigin=r,this.RecurrencePattern=o,this.Start=n,this.Finish=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new kx(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.Name),t.push(this.DataOrigin),t.push(this.UserDefinedDataOrigin),t.push(this.RecurrencePattern),t.push(this.Start),t.push(this.Finish),t}},jx=class{constructor(t,e,s,i,r,o,n,a,h,l,u){this.expressID=t,this.type=e,this.ProfileType=s,this.ProfileName=i,this.Position=r,this.Depth=o,this.FlangeWidth=n,this.WebThickness=a,this.FlangeThickness=h,this.FilletRadius=l,this.EdgeRadius=u}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++],u=s[i++],p=s[i++],c=s[i++];return new jx(t,e,r,o,n,a,h,l,u,p,c)}ToTape(){let t=[];return t.push(this.ProfileType),t.push(this.ProfileName),t.push(this.Position),t.push(this.Depth),t.push(this.FlangeWidth),t.push(this.WebThickness),t.push(this.FlangeThickness),t.push(this.FilletRadius),t.push(this.EdgeRadius),t}},Gx=class{constructor(t,e,s,i,r,o,n,a){this.expressID=t,this.type=e,this.GlobalId=s,this.OwnerHistory=i,this.Name=r,this.Description=o,this.ObjectType=n,this.LongName=a}static FromTape(t,e,s){let i=0,r=s[i++],o=s[i++],n=s[i++],a=s[i++],h=s[i++],l=s[i++];return new Gx(t,e,r,o,n,a,h,l)}ToTape(){let t=[];return t.push(this.GlobalId),t.push(this.OwnerHistory),t.push(this.Name),t.push(this.Description),t.push(this.ObjectType),t.push(this.LongName),t}},Hx=Cl();class Vx{constructor(){}getIFC(t,e,s){var i=()=>{};e=e||i,s=s||i;const r=t.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const t=!!r[2];var o=r[3];o=window.decodeURIComponent(o),t&&(o=window.atob(o));try{const t=new ArrayBuffer(o.length),s=new Uint8Array(t);for(var n=0;n<o.length;n++)s[n]=o.charCodeAt(n);e(t)}catch(t){s(t)}}else{const i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?e(i.response):s("getXKT error : "+i.response))},i.send(null)}}}class zx{constructor(t={}){this._eventSubIDMap=null,this._eventSubEvents=null,this._eventSubs=null,this._events=null,this._locale="en",this._messages={},this._locales=[],this._locale="en",this.messages=t.messages,this.locale=t.locale}set messages(t){this._messages=t||{},this._locales=Object.keys(this._messages),this.fire("updated",this)}loadMessages(t={}){for(let e in t)this._messages[e]=t[e];this.messages=this._messages}clearMessages(){this.messages={}}get locales(){return this._locales}set locale(t){t=t||"de",this._locale!==t&&(this._locale=t,this.fire("updated",t))}get locale(){return this._locale}translate(t,e){const s=this._messages[this._locale];if(!s)return null;const i=Ux(t,s);return i?e?Xx(i,e):i:null}translatePlurals(t,e,s){const i=this._messages[this._locale];if(!i)return null;let r=Ux(t,i);return r=0===(e=parseInt(""+e,10))?r.zero:e>1?r.other:r.one,r?(r=Xx(r,[e]),s&&(r=Xx(r,s)),r):null}fire(t,e,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={}),!0!==s&&(this._events[t]=e||!0);const i=this._eventSubs[t];if(i)for(const t in i)if(i.hasOwnProperty(t)){i[t].callback(e)}}on(e,s){this._events||(this._events={}),this._eventSubIDMap||(this._eventSubIDMap=new t),this._eventSubEvents||(this._eventSubEvents={}),this._eventSubs||(this._eventSubs={});let i=this._eventSubs[e];i||(i={},this._eventSubs[e]=i);const r=this._eventSubIDMap.addItem();i[r]={callback:s},this._eventSubEvents[r]=e;const o=this._events[e];return void 0!==o&&s(o),r}off(t){if(null==t)return;if(!this._eventSubEvents)return;const e=this._eventSubEvents[t];if(e){delete this._eventSubEvents[t];const s=this._eventSubs[e];s&&delete s[t],this._eventSubIDMap.removeItem(t)}}}function Ux(t,e){if(e[t])return e[t];const s=t.split(".");let i=e;for(let t=0,e=s.length;i&&t<e;t++){i=i[s[t]]}return i}function Xx(t,e=[]){return t.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(t,s){return"{{"===t?"{":"}}"===t?"}":e[s]}))}class Wx extends A{constructor(t,e={}){super(t,e),this.t=e.t}set t(t){t=t||0,this._t=t<0?0:t>1?1:t}get t(){return this._t}get tangent(){return this.getTangent(this._t)}get length(){var t=this._getLengths();return t[t.length-1]}getTangent(t){var e=1e-4;void 0===t&&(t=this._t);var s=t-e,i=t+e;s<0&&(s=0),i>1&&(i=1);var r=this.getPoint(s),o=this.getPoint(i),n=c.subVec3(o,r,[]);return c.normalizeVec3(n,[])}getPointAt(t){var e=this.getUToTMapping(t);return this.getPoint(e)}getPoints(t){t||(t=5);var e,s=[];for(e=0;e<=t;e++)s.push(this.getPoint(e/t));return s}_getLengths(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var e,s,i=[],r=this.getPoint(0),o=0;for(i.push(0),s=1;s<=t;s++)e=this.getPoint(s/t),o+=c.lenVec3(c.subVec3(e,r,[])),i.push(o),r=e;return this.cacheArcLengths=i,i}_updateArcLengths(){this.needsUpdate=!0,this._getLengths()}getUToTMapping(t,e){var s,i=this._getLengths(),r=0,o=i.length;s=e||t*i[o-1];for(var n,a=0,h=o-1;a<=h;)if((n=i[r=Math.floor(a+(h-a)/2)]-s)<0)a=r+1;else{if(!(n>0)){h=r;break}h=r-1}if(i[r=h]===s)return r/(o-1);var l=i[r];return(r+(s-l)/(i[r+1]-l))/(o-1)}}class Yx extends Wx{constructor(t,e={}){super(t,e),this.points=e.points,this.t=e.t}set points(t){this._points=t||[]}get points(){return this._points}set t(t){t=t||0,this._t=t<0?0:t>1?1:t}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(t){var e=this.points;if(!(e.length<3)){var s=(e.length-1)*t,i=Math.floor(s),r=s-i,o=e[0===i?i:i-1],n=e[i],a=e[i>e.length-2?e.length-1:i+1],h=e[i>e.length-3?e.length-1:i+2],l=c.vec3();return l[0]=c.catmullRomInterpolate(o[0],n[0],a[0],h[0],r),l[1]=c.catmullRomInterpolate(o[1],n[1],a[1],h[1],r),l[2]=c.catmullRomInterpolate(o[2],n[2],a[2],h[2],r),l}this.error("Can't sample point from SplineCurve - not enough points on curve - returning [0,0,0].")}getJSON(){return{points:points,t:this._t}}}const Kx=c.vec3();class Zx extends A{get type(){return"CameraPath"}constructor(t,e={}){super(t,e),this._frames=[],this._eyeCurve=new Yx(this),this._lookCurve=new Yx(this),this._upCurve=new Yx(this),e.frames&&(this.addFrames(e.frames),this.smoothFrameTimes(1))}get frames(){return this._frames}get eyeCurve(){return this._eyeCurve}get lookCurve(){return this._lookCurve}get upCurve(){return this._upCurve}saveFrame(t){const e=this.scene.camera;this.addFrame(t,e.eye,e.look,e.up)}addFrame(t,e,s,i){const r={t:t,eye:e.slice(0),look:s.slice(0),up:i.slice(0)};this._frames.push(r),this._eyeCurve.points.push(r.eye),this._lookCurve.points.push(r.look),this._upCurve.points.push(r.up)}addFrames(t){let e;for(let s=0,i=t.length;s<i;s++)e=t[s],this.addFrame(e.t||0,e.eye,e.look,e.up)}loadFrame(t){const e=this.scene.camera;t=(t/=this._frames[this._frames.length-1].t-this._frames[0].t)<0?0:t>1?1:t,e.eye=this._eyeCurve.getPoint(t,Kx),e.look=this._lookCurve.getPoint(t,Kx),e.up=this._upCurve.getPoint(t,Kx)}sampleFrame(t,e,s,i){t=t<0?0:t>1?1:t,this._eyeCurve.getPoint(t,e),this._lookCurve.getPoint(t,s),this._upCurve.getPoint(t,i)}smoothFrameTimes(t){if(0===this._frames.length)return;const e=c.vec3();var s=0;this._frames[0].t=0;const i=[];for(let t=1,o=this._frames.length;t<o;t++){var r=c.lenVec3(c.subVec3(this._frames[t].eye,this._frames[t-1].eye,e));i[t]=r,s+=r}for(let e=1,r=this._frames.length;e<r;e++){const r=i[e]/s*t;this._frames[e].t=this._frames[e-1].t+r}}clearFrames(){this._frames=[],this._eyeCurve.points=[],this._lookCurve.points=[],this._upCurve.points=[]}}const qx=c.vec3(),$x=c.vec3(),Qx=c.vec3(),Jx=c.vec3(),tM=c.vec3();class eM extends A{get type(){return"CameraFlightAnimation"}constructor(t,e={}){super(t,e),this._look1=c.vec3(),this._eye1=c.vec3(),this._up1=c.vec3(),this._look2=c.vec3(),this._eye2=c.vec3(),this._up2=c.vec3(),this._orthoScale1=1,this._orthoScale2=1,this._flying=!1,this._flyEyeLookUp=!1,this._flyingEye=!1,this._flyingLook=!1,this._callback=null,this._callbackScope=null,this._time1=null,this._time2=null,this.easing=!1!==e.easing,this.duration=e.duration,this.fit=e.fit,this.fitFOV=e.fitFOV,this.trail=e.trail}flyTo(t,e,s){t=t||this.scene,this._flying&&this.stop(),this._flying=!1,this._flyingEye=!1,this._flyingLook=!1,this._flyingEyeLookUp=!1,this._callback=e,this._callbackScope=s;const i=this.scene.camera,r=!!t.projection&&t.projection!==i.projection;let o,n,a,h,l;if(this._eye1[0]=i.eye[0],this._eye1[1]=i.eye[1],this._eye1[2]=i.eye[2],this._look1[0]=i.look[0],this._look1[1]=i.look[1],this._look1[2]=i.look[2],this._up1[0]=i.up[0],this._up1[1]=i.up[1],this._up1[2]=i.up[2],this._orthoScale1=i.ortho.scale,this._orthoScale2=t.orthoScale||this._orthoScale1,t.aabb)o=t.aabb;else if(6===t.length)o=t;else if(t.eye&&t.look||t.up)n=t.eye,a=t.look,h=t.up;else if(t.eye)n=t.eye;else if(t.look)a=t.look;else{let i=t;if((_.isNumeric(i)||_.isString(i))&&(l=i,i=this.scene.components[l],!i))return this.error("Component not found: "+_.inQuotes(l)),void(e&&(s?e.call(s):e()));r||(o=i.aabb||this.scene.aabb)}const u=t.poi;if(o){if(o[3]<o[0]||o[4]<o[1]||o[5]<o[2])return;if(o[3]===o[0]&&o[4]===o[1]&&o[5]===o[2])return;o=o.slice();const e=c.getAABB3Center(o);this._look2=u||e;const s=c.subVec3(this._eye1,this._look1,qx),i=c.normalizeVec3(s),r=u?c.getAABB3DiagPoint(o,u):c.getAABB3Diag(o),n=t.fitFOV||this._fitFOV,a=Math.abs(r/Math.tan(n*c.DEGTORAD));this._orthoScale2=1.1*r,this._eye2[0]=this._look2[0]+i[0]*a,this._eye2[1]=this._look2[1]+i[1]*a,this._eye2[2]=this._look2[2]+i[2]*a,this._up2[0]=this._up1[0],this._up2[1]=this._up1[1],this._up2[2]=this._up1[2],this._flyingEyeLookUp=!0}else(n||a||h)&&(this._flyingEyeLookUp=!!n&&!!a&&!!h,this._flyingEye=!!n&&!a,this._flyingLook=!!a&&!n,n&&(this._eye2[0]=n[0],this._eye2[1]=n[1],this._eye2[2]=n[2]),a&&(this._look2[0]=a[0],this._look2[1]=a[1],this._look2[2]=a[2]),h&&(this._up2[0]=h[0],this._up2[1]=h[1],this._up2[2]=h[2]));r?("ortho"===t.projection&&"ortho"!==i.projection&&(this._projection2="ortho",this._projMatrix1=i.projMatrix.slice(),this._projMatrix2=i.ortho.matrix.slice(),i.projection="customProjection"),"perspective"===t.projection&&"perspective"!==i.projection&&(this._projection2="perspective",this._projMatrix1=i.projMatrix.slice(),this._projMatrix2=i.perspective.matrix.slice(),i.projection="customProjection")):this._projection2=null,this.fire("started",t,!0),this._time1=Date.now(),this._time2=this._time1+(t.duration?1e3*t.duration:this._duration),this._flying=!0,I.scheduleTask(this._update,this)}jumpTo(t){this._jumpTo(t)}_jumpTo(t){this._flying&&this.stop();const e=this.scene.camera;var s,i,r,o,n;if(t.aabb)s=t.aabb;else if(6===t.length)s=t;else if(t.eye||t.look||t.up)r=t.eye,o=t.look,n=t.up;else{let e=t;if((_.isNumeric(e)||_.isString(e))&&(i=e,e=this.scene.components[i],!e))return void this.error("Component not found: "+_.inQuotes(i));s=e.aabb||this.scene.aabb}const a=t.poi;if(s){if(s[3]<=s[0]||s[4]<=s[1]||s[5]<=s[2])return;var h=a?c.getAABB3DiagPoint(s,a):c.getAABB3Diag(s);let i;o=a||c.getAABB3Center(s,o),this._trail?c.subVec3(e.look,o,tM):c.subVec3(e.eye,e.look,tM),c.normalizeVec3(tM);i=(void 0!==t.fit?t.fit:this._fit)?Math.abs(h/Math.tan((t.fitFOV||this._fitFOV)*c.DEGTORAD)):c.lenVec3(c.subVec3(e.eye,e.look,qx)),c.mulVec3Scalar(tM,i),e.eye=c.addVec3(o,tM,qx),e.look=o,this.scene.camera.ortho.scale=1.1*h}else(r||o||n)&&(r&&(e.eye=r),o&&(e.look=o),n&&(e.up=n));t.projection&&(e.projection=t.projection)}_update(){if(!this._flying)return;let t=(Date.now()-this._time1)/(this._time2-this._time1);const e=t>=1;t>1&&(t=1);const s=this.easing?eM._ease(t,0,1,1):t,i=this.scene.camera;if(this._flyingEye||this._flyingLook?this._flyingEye?(c.subVec3(i.eye,i.look,tM),i.eye=c.lerpVec3(s,0,1,this._eye1,this._eye2,Qx),i.look=c.subVec3(Qx,tM,$x)):this._flyingLook&&(i.look=c.lerpVec3(s,0,1,this._look1,this._look2,$x),i.up=c.lerpVec3(s,0,1,this._up1,this._up2,Jx)):this._flyingEyeLookUp&&(i.eye=c.lerpVec3(s,0,1,this._eye1,this._eye2,Qx),i.look=c.lerpVec3(s,0,1,this._look1,this._look2,$x),i.up=c.lerpVec3(s,0,1,this._up1,this._up2,Jx)),this._projection2){const e="ortho"===this._projection2?eM._easeOutExpo(t,0,1,1):eM._easeInCubic(t,0,1,1);i.customProjection.matrix=c.lerpMat4(e,0,1,this._projMatrix1,this._projMatrix2)}else i.ortho.scale=this._orthoScale1+t*(this._orthoScale2-this._orthoScale1);if(e)return i.ortho.scale=this._orthoScale2,void this.stop();I.scheduleTask(this._update,this)}static _ease(t,e,s,i){return-s*(t/=i)*(t-2)+e}static _easeInCubic(t,e,s,i){return s*(t/=i)*t*t+e}static _easeOutExpo(t,e,s,i){return s*(1-Math.pow(2,-10*t/i))+e}stop(){if(!this._flying)return;this._flying=!1,this._time1=null,this._time2=null,this._projection2&&(this.scene.camera.projection=this._projection2);const t=this._callback;t&&(this._callback=null,this._callbackScope?t.call(this._callbackScope):t()),this.fire("stopped",!0,!0)}cancel(){this._flying&&(this._flying=!1,this._time1=null,this._time2=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}set duration(t){this._duration=t?1e3*t:500,this.stop()}get duration(){return this._duration/1e3}set fit(t){this._fit=!1!==t}get fit(){return this._fit}set fitFOV(t){this._fitFOV=t||45}get fitFOV(){return this._fitFOV}set trail(t){this._trail=!!t}get trail(){return this._trail}destroy(){this.stop(),super.destroy()}}class sM extends A{get type(){return"CameraPathAnimation"}constructor(t,e={}){super(t,e),this._cameraFlightAnimation=new eM(this),this._t=0,this.state=sM.SCRUBBING,this._playingFromT=0,this._playingToT=0,this._playingRate=e.playingRate||1,this._playingDir=1,this._lastTime=null,this.cameraPath=e.cameraPath,this._tick=this.scene.on("tick",this._updateT,this)}_updateT(){const t=this._cameraPath;if(!t)return;let e,s;const i=performance.now(),r=this._lastTime?.001*(i-this._lastTime):0;if(this._lastTime=i,0!==r)switch(this.state){case sM.SCRUBBING:return;case sM.PLAYING:if(this._t+=this._playingRate*r,e=this._cameraPath.frames.length,0===e||this._playingDir<0&&this._t<=0||this._playingDir>0&&this._t>=this._cameraPath.frames[e-1].t)return this.state=sM.SCRUBBING,this._t=this._cameraPath.frames[e-1].t,void this.fire("stopped");t.loadFrame(this._t);break;case sM.PLAYING_TO:s=this._t+this._playingRate*r*this._playingDir,(this._playingDir<0&&s<=this._playingToT||this._playingDir>0&&s>=this._playingToT)&&(s=this._playingToT,this.state=sM.SCRUBBING,this.fire("stopped")),this._t=s,t.loadFrame(this._t)}}_ease(t,e,s,i){return-s*(t/=i)*(t-2)+e}set cameraPath(t){this._cameraPath=t}get cameraPath(){return this._cameraPath}set rate(t){this._playingRate=t}get rate(){return this._playingRate}play(){this._cameraPath&&(this._lastTime=null,this.state=sM.PLAYING)}playToT(t){this._cameraPath&&(this._playingFromT=this._t,this._playingToT=t,this._playingDir=this._playingToT-this._playingFromT<0?-1:1,this._lastTime=null,this.state=sM.PLAYING_TO)}playToFrame(t){const e=this._cameraPath;if(!e)return;const s=e.frames[t];s?this.playToT(s.t):this.error("playToFrame - frame index out of range: "+t)}flyToFrame(t,e){const s=this._cameraPath;if(!s)return;const i=s.frames[t];i?(this.state=sM.SCRUBBING,this._cameraFlightAnimation.flyTo(i,e)):this.error("flyToFrame - frame index out of range: "+t)}scrubToT(t){const e=this._cameraPath;if(!e)return;this.scene.camera&&(this._t=t,e.loadFrame(this._t),this.state=sM.SCRUBBING)}scrubToFrame(t){const e=this._cameraPath;if(!e)return;if(!this.scene.camera)return;e.frames[t]?(e.loadFrame(this._t),this.state=sM.SCRUBBING):this.error("playToFrame - frame index out of range: "+t)}stop(){this.state=sM.SCRUBBING,this.fire("stopped")}destroy(){super.destroy(),this.scene.off(this._tick)}}sM.STOPPED=0,sM.SCRUBBING=1,sM.PLAYING=2,sM.PLAYING_TO=3;var iM={};function rM(t,e={}){return new Promise((function(s,i){e.src||(console.error("load3DSGeometry: Parameter expected: src"),i());var r=t.canvas.spinner;r.processes++,_.loadArraybuffer(e.src,(function(t){t.byteLength||(console.error("load3DSGeometry: no data loaded"),r.processes--,i());var o=iM.parse.from3DS(t).edit.objects[0].mesh,n=o.vertices,a=o.uvt,h=o.indices;r.processes--,s(_.apply(e,{primitive:"triangles",positions:n,normals:null,uv:a,indices:h}))}),(function(t){console.error("load3DSGeometry: "+t),r.processes--,i()}))}))}function oM(t,e={}){return new Promise((function(s,i){e.src||(console.error("loadOBJGeometry: Parameter expected: src"),i());var r=t.canvas.spinner;r.processes++,_.loadArraybuffer(e.src,(function(t){t.byteLength||(console.error("loadOBJGeometry: no data loaded"),r.processes--,i());for(var o=iM.parse.fromOBJ(t),n=iM.edit.unwrap(o.i_verts,o.c_verts,3),a=iM.edit.unwrap(o.i_norms,o.c_norms,3),h=iM.edit.unwrap(o.i_uvt,o.c_uvt,2),l=new Int32Array(o.i_verts.length),u=0;u<o.i_verts.length;u++)l[u]=u;r.processes--,s(_.apply(e,{primitive:"triangles",positions:n,normals:a.length>0?a:null,autoNormals:0===a.length,uv:h,indices:l}))}),(function(t){console.error("loadOBJGeometry: "+t),r.processes--,i()}))}))}function nM(t={}){let e=t.xSize||1;e<0&&(console.error("negative xSize not allowed - will invert"),e*=-1);let s=t.ySize||1;s<0&&(console.error("negative ySize not allowed - will invert"),s*=-1);let i=t.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);const r=t.center,o=r?r[0]:0,n=r?r[1]:0,a=r?r[2]:0,h=-e+o,l=-s+n,u=-i+a,p=e+o,c=s+n,d=i+a;return _.apply(t,{primitive:"lines",positions:[h,l,u,h,l,d,h,c,u,h,c,d,p,l,u,p,l,d,p,c,u,p,c,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})}function aM(t={}){let e=t.size||1;e<0&&(console.error("negative size not allowed - will invert"),e*=-1);let s=t.divisions||1;s<0&&(console.error("negative divisions not allowed - will invert"),s*=-1),s<1&&(s=1),e=e||10,s=s||10;const i=e/s,r=e/2,o=[],n=[];let a=0;for(let t=0,e=-r;t<=s;t++,e+=i)o.push(-r),o.push(0),o.push(e),o.push(r),o.push(0),o.push(e),o.push(e),o.push(0),o.push(-r),o.push(e),o.push(0),o.push(r),n.push(a++),n.push(a++),n.push(a++),n.push(a++);return _.apply(t,{primitive:"lines",positions:o,indices:n})}function hM(t={}){let e=t.xSize||1;e<0&&(console.error("negative xSize not allowed - will invert"),e*=-1);let s=t.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);let i=t.xSegments||1;i<0&&(console.error("negative xSegments not allowed - will invert"),i*=-1),i<1&&(i=1);let r=t.xSegments||1;r<0&&(console.error("negative zSegments not allowed - will invert"),r*=-1),r<1&&(r=1);const o=t.center,n=o?o[0]:0,a=o?o[1]:0,h=o?o[2]:0,l=e/2,u=s/2,p=Math.floor(i)||1,c=Math.floor(r)||1,d=p+1,m=c+1,f=e/p,g=s/c,y=new Float32Array(d*m*3),v=new Float32Array(d*m*3),b=new Float32Array(d*m*2);let P,T,w,x,M,D,E,I=0,S=0;for(P=0;P<m;P++){const t=P*g-u;for(T=0;T<d;T++)w=T*f-l,y[I]=w+n,y[I+1]=a,y[I+2]=-t+h,v[I+2]=-1,b[S]=T/p,b[S+1]=(c-P)/c,I+=3,S+=2}I=0;const A=new(y.length/3>65535?Uint32Array:Uint16Array)(p*c*6);for(P=0;P<c;P++)for(T=0;T<p;T++)x=T+d*P,M=T+d*(P+1),D=T+1+d*(P+1),E=T+1+d*P,A[I]=E,A[I+1]=M,A[I+2]=x,A[I+3]=E,A[I+4]=D,A[I+5]=M,I+=6;return _.apply(t,{positions:y,normals:v,uv:b,indices:A})}iM.load=function(t,e){var s=new XMLHttpRequest;s.open("GET",t,!0),s.responseType="arraybuffer",s.onload=function(t){e(t.target.response)},s.send()},iM.save=function(t,e){var s="data:application/octet-stream;base64,"+btoa(iM.parse._buffToStr(t));window.location.href=s},iM.clone=function(t){return JSON.parse(JSON.stringify(t))},iM.bin={},iM.bin.f=new Float32Array(1),iM.bin.fb=new Uint8Array(iM.bin.f.buffer),iM.bin.rf=function(t,e){for(var s=iM.bin.f,i=iM.bin.fb,r=0;r<4;r++)i[r]=t[e+r];return s[0]},iM.bin.rsl=function(t,e){return t[e]|t[e+1]<<8},iM.bin.ril=function(t,e){return t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24},iM.bin.rASCII0=function(t,e){for(var s="";0!=t[e];)s+=String.fromCharCode(t[e++]);return s},iM.bin.wf=function(t,e,s){new Float32Array(t.buffer,e,1)[0]=s},iM.bin.wsl=function(t,e,s){t[e]=s,t[e+1]=s>>8},iM.bin.wil=function(t,e,s){t[e]=s,t[e+1]=s>>8,t[e+2]=s>>16,t[e+3]},iM.parse={},iM.parse._buffToStr=function(t){for(var e=new Uint8Array(t),s="",i=0;i<e.length;i++)s=s.concat(String.fromCharCode(e[i]));return s},iM.parse._strToBuff=function(t){for(var e=new ArrayBuffer(t.length),s=new Uint8Array(e),i=0;i<t.length;i++)s[i]=t.charCodeAt(i);return e},iM.parse._readLine=function(t,e){for(var s="";10!=t[e];)s+=String.fromCharCode(t[e++]);return s},iM.parse.fromJSON=function(t){return JSON.parse(iM.parse._buffToStr(t))},iM.parse.toJSON=function(t){var e=JSON.stringify(t);return iM.parse._strToBuff(e)},iM.parse.fromOBJ=function(t){for(var e={groups:{},c_verts:[],c_uvt:[],c_norms:[],i_verts:[],i_uvt:[],i_norms:[]},s={from:0,to:0},i=0,r=new Uint8Array(t);i<r.length;){var o=iM.parse._readLine(r,i);i+=o.length+1;var n=(o=(o=o.replace(/ +(?= )/g,"")).replace(/(^\s+|\s+$)/g,"")).split(" ");if("g"==n[0]&&(s.to=e.i_verts.length,null==e.groups[n[1]]&&(e.groups[n[1]]={from:e.i_verts.length,to:0}),s=e.groups[n[1]]),"v"==n[0]){var a=parseFloat(n[1]),h=parseFloat(n[2]),l=parseFloat(n[3]);e.c_verts.push(a,h,l)}if("vt"==n[0]){a=parseFloat(n[1]),h=1-parseFloat(n[2]);e.c_uvt.push(a,h)}if("vn"==n[0]){a=parseFloat(n[1]),h=parseFloat(n[2]),l=parseFloat(n[3]);e.c_norms.push(a,h,l)}if("f"==n[0]){var u=n[1].split("/"),p=n[2].split("/"),c=n[3].split("/"),d=parseInt(u[0])-1,m=parseInt(p[0])-1,f=parseInt(c[0])-1,g=parseInt(u[1])-1,_=parseInt(p[1])-1,y=parseInt(c[1])-1,v=parseInt(u[2])-1,b=parseInt(p[2])-1,P=parseInt(c[2])-1,T=e.c_verts.length/3,w=e.c_uvt.length/2,x=e.c_norms.length/3;if(d<0&&(d=T+d+1),m<0&&(m=T+m+1),f<0&&(f=T+f+1),g<0&&(g=w+g+1),_<0&&(_=w+_+1),y<0&&(y=w+y+1),v<0&&(v=x+v+1),b<0&&(b=x+b+1),P<0&&(P=x+P+1),e.i_verts.push(d,m,f),e.i_uvt.push(g,_,y),e.i_norms.push(v,b,P),5==n.length){var M=n[4].split("/"),D=parseInt(M[0])-1,E=parseInt(M[1])-1,I=parseInt(M[2])-1;D<0&&(D=T+D+1),E<0&&(E=w+E+1),I<0&&(I=x+I+1),e.i_verts.push(d,f,D),e.i_uvt.push(g,y,E),e.i_norms.push(v,P,I)}}}return s.to=e.i_verts.length,e},iM.parse.fromMD2=function(t){t=new Uint8Array(t);var e={},s={};s.ident=iM.bin.ril(t,0),s.version=iM.bin.ril(t,4),s.skinwidth=iM.bin.ril(t,8),s.skinheight=iM.bin.ril(t,12),s.framesize=iM.bin.ril(t,16),s.num_skins=iM.bin.ril(t,20),s.num_vertices=iM.bin.ril(t,24),s.num_st=iM.bin.ril(t,28),s.num_tris=iM.bin.ril(t,32),s.num_glcmds=iM.bin.ril(t,36),s.num_frames=iM.bin.ril(t,40),s.offset_skins=iM.bin.ril(t,44),s.offset_st=iM.bin.ril(t,48),s.offset_tris=iM.bin.ril(t,52),s.offset_frames=iM.bin.ril(t,56),s.offset_glcmds=iM.bin.ril(t,60),s.offset_end=iM.bin.ril(t,64);var i=s.offset_st;e.c_uvt=[];for(var r=0;r<s.num_st;r++){var o=iM.bin.rsl(t,i)/s.skinwidth,n=iM.bin.rsl(t,i+2)/s.skinheight;e.c_uvt.push(o,n),i+=4}i=s.offset_tris;var a=[],h=[];e.i_verts=a,e.i_uvt=h;for(r=0;r<s.num_tris;r++)a.push(iM.bin.rsl(t,i),iM.bin.rsl(t,i+2),iM.bin.rsl(t,i+4)),h.push(iM.bin.rsl(t,i+6),iM.bin.rsl(t,i+8),iM.bin.rsl(t,i+10)),i+=12;i=s.offset_skins;e.skins=[];for(r=0;r<s.num_skins;r++)e.skins.push(iM.bin.rASCII0(t,i)),i+=64;i=s.offset_frames;e.frames=[];var l=iM.parse.fromMD2._normals;for(r=0;r<s.num_frames;r++){var u={},p=iM.bin.rf(t,i),c=iM.bin.rf(t,i+4),d=iM.bin.rf(t,i+8);i+=12;var m=iM.bin.rf(t,i),f=iM.bin.rf(t,i+4),g=iM.bin.rf(t,i+8);i+=12,u.name=iM.bin.rASCII0(t,i),i+=16,u.verts=[],u.norms=[];for(var _=0;_<s.num_vertices;_++)u.verts.push(t[i]*p+m,t[i+1]*c+f,t[i+2]*d+g),u.norms.push(l[3*t[i+3]],l[3*t[i+3]+1],l[3*t[i+3]+2]),i+=4;e.frames.push(u)}return e},iM.parse.fromMD2._normals=[-.525731,0,.850651,-.442863,.238856,.864188,-.295242,0,.955423,-.309017,.5,.809017,-.16246,.262866,.951056,0,0,1,0,.850651,.525731,-.147621,.716567,.681718,.147621,.716567,.681718,0,.525731,.850651,.309017,.5,.809017,.525731,0,.850651,.295242,0,.955423,.442863,.238856,.864188,.16246,.262866,.951056,-.681718,.147621,.716567,-.809017,.309017,.5,-.587785,.425325,.688191,-.850651,.525731,0,-.864188,.442863,.238856,-.716567,.681718,.147621,-.688191,.587785,.425325,-.5,.809017,.309017,-.238856,.864188,.442863,-.425325,.688191,.587785,-.716567,.681718,-.147621,-.5,.809017,-.309017,-.525731,.850651,0,0,.850651,-.525731,-.238856,.864188,-.442863,0,.955423,-.295242,-.262866,.951056,-.16246,0,1,0,0,.955423,.295242,-.262866,.951056,.16246,.238856,.864188,.442863,.262866,.951056,.16246,.5,.809017,.309017,.238856,.864188,-.442863,.262866,.951056,-.16246,.5,.809017,-.309017,.850651,.525731,0,.716567,.681718,.147621,.716567,.681718,-.147621,.525731,.850651,0,.425325,.688191,.587785,.864188,.442863,.238856,.688191,.587785,.425325,.809017,.309017,.5,.681718,.147621,.716567,.587785,.425325,.688191,.955423,.295242,0,1,0,0,.951056,.16246,.262866,.850651,-.525731,0,.955423,-.295242,0,.864188,-.442863,.238856,.951056,-.16246,.262866,.809017,-.309017,.5,.681718,-.147621,.716567,.850651,0,.525731,.864188,.442863,-.238856,.809017,.309017,-.5,.951056,.16246,-.262866,.525731,0,-.850651,.681718,.147621,-.716567,.681718,-.147621,-.716567,.850651,0,-.525731,.809017,-.309017,-.5,.864188,-.442863,-.238856,.951056,-.16246,-.262866,.147621,.716567,-.681718,.309017,.5,-.809017,.425325,.688191,-.587785,.442863,.238856,-.864188,.587785,.425325,-.688191,.688191,.587785,-.425325,-.147621,.716567,-.681718,-.309017,.5,-.809017,0,.525731,-.850651,-.525731,0,-.850651,-.442863,.238856,-.864188,-.295242,0,-.955423,-.16246,.262866,-.951056,0,0,-1,.295242,0,-.955423,.16246,.262866,-.951056,-.442863,-.238856,-.864188,-.309017,-.5,-.809017,-.16246,-.262866,-.951056,0,-.850651,-.525731,-.147621,-.716567,-.681718,.147621,-.716567,-.681718,0,-.525731,-.850651,.309017,-.5,-.809017,.442863,-.238856,-.864188,.16246,-.262866,-.951056,.238856,-.864188,-.442863,.5,-.809017,-.309017,.425325,-.688191,-.587785,.716567,-.681718,-.147621,.688191,-.587785,-.425325,.587785,-.425325,-.688191,0,-.955423,-.295242,0,-1,0,.262866,-.951056,-.16246,0,-.850651,.525731,0,-.955423,.295242,.238856,-.864188,.442863,.262866,-.951056,.16246,.5,-.809017,.309017,.716567,-.681718,.147621,.525731,-.850651,0,-.238856,-.864188,-.442863,-.5,-.809017,-.309017,-.262866,-.951056,-.16246,-.850651,-.525731,0,-.716567,-.681718,-.147621,-.716567,-.681718,.147621,-.525731,-.850651,0,-.5,-.809017,.309017,-.238856,-.864188,.442863,-.262866,-.951056,.16246,-.864188,-.442863,.238856,-.809017,-.309017,.5,-.688191,-.587785,.425325,-.681718,-.147621,.716567,-.442863,-.238856,.864188,-.587785,-.425325,.688191,-.309017,-.5,.809017,-.147621,-.716567,.681718,-.425325,-.688191,.587785,-.16246,-.262866,.951056,.442863,-.238856,.864188,.16246,-.262866,.951056,.309017,-.5,.809017,.147621,-.716567,.681718,0,-.525731,.850651,.425325,-.688191,.587785,.587785,-.425325,.688191,.688191,-.587785,.425325,-.955423,.295242,0,-.951056,.16246,.262866,-1,0,0,-.850651,0,.525731,-.955423,-.295242,0,-.951056,-.16246,.262866,-.864188,.442863,-.238856,-.951056,.16246,-.262866,-.809017,.309017,-.5,-.864188,-.442863,-.238856,-.951056,-.16246,-.262866,-.809017,-.309017,-.5,-.681718,.147621,-.716567,-.681718,-.147621,-.716567,-.850651,0,-.525731,-.688191,.587785,-.425325,-.587785,.425325,-.688191,-.425325,.688191,-.587785,-.425325,-.688191,-.587785,-.587785,-.425325,-.688191,-.688191,-.587785,-.425325],iM.parse.fromCollada=function(t){var e=iM.parse._buffToStr(t),s=(new DOMParser).parseFromString(e,"text/xml"),i={},r=(s=s.childNodes[0]).getElementsByTagName("asset")[0],o=s.getElementsByTagName("library_geometries")[0],n=s.getElementsByTagName("library_images")[0],a=s.getElementsByTagName("library_materials")[0],h=s.getElementsByTagName("library_effects")[0];return r&&(i.asset=iM.parse.fromCollada._asset(r)),o&&(i.geometries=iM.parse.fromCollada._libGeometries(o)),n&&(i.images=iM.parse.fromCollada._libImages(n)),a&&(i.materials=iM.parse.fromCollada._libMaterials(a)),h&&(i.effects=iM.parse.fromCollada._libEffects(h)),i},iM.parse.fromCollada._asset=function(t){return{created:t.getElementsByTagName("created")[0].textContent,modified:t.getElementsByTagName("modified")[0].textContent,up_axis:t.getElementsByTagName("up_axis")[0].textContent}},iM.parse.fromCollada._libGeometries=function(t){t=t.getElementsByTagName("geometry");for(var e=[],s=0;s<t.length;s++){var i=t[s],r=iM.parse.fromCollada._getMesh(i.getElementsByTagName("mesh")[0]);e.push(r)}return e},iM.parse.fromCollada._getMesh=function(t){for(var e={},s=t.getElementsByTagName("source"),i=e.sources={},r=0;r<s.length;r++){for(var o=s[r].getElementsByTagName("float_array")[0].textContent.split(" "),n=o.length-(""==o[o.length-1]?1:0),a=new Array(n),h=0;h<n;h++)a[h]=parseFloat(o[h]);i[s[r].getAttribute("id")]=a}e.triangles=[];var l=t.getElementsByTagName("triangles");if(null==l)return e;for(r=0;r<l.length;r++){var u={},p=l[r];u.material=p.getAttribute("material");var c=p.getElementsByTagName("input"),d=[];for(h=0;h<c.length;h++){var m=c[h];a=[];d[parseInt(m.getAttribute("offset"))]=a;var f=m.getAttribute("semantic");u["s_"+f]="VERTEX"==f?t.getElementsByTagName("vertices")[0].getElementsByTagName("input")[0].getAttribute("source").substring(1):m.getAttribute("source").substring(1),u["i_"+f]=a,i[u["s_"+f]]}var g=p.getElementsByTagName("p")[0].textContent.split(" "),_=3*Math.floor(g.length/3);for(h=0;h<_;h++)d[h%c.length].push(parseInt(g[h]));e.triangles.push(u)}return e},iM.parse.fromCollada._libImages=function(t){t=t.getElementsByTagName("image");for(var e={},s=0;s<t.length;s++)e[t[s].getAttribute("id")]=t[s].getElementsByTagName("init_from")[0].textContent;return e},iM.parse.fromCollada._libMaterials=function(t){t=t.getElementsByTagName("material");for(var e={},s=0;s<t.length;s++)e[t[s].getAttribute("name")]=t[s].getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1);return e},iM.parse.fromCollada._libEffects=function(t){t=t.getElementsByTagName("effect");for(var e={},s=0;s<t.length;s++){for(var i={},r=t[s].getElementsByTagName("newparam"),o=0;o<r.length;o++){var n=r[o].getElementsByTagName("surface")[0];n&&(i.surface=n.getElementsByTagName("init_from")[0].textContent)}e[t[s].getAttribute("id")]=i}return e},iM.parse.from3DS=function(t){t=new Uint8Array(t);var e={};if(19789!=iM.bin.rsl(t,0))return null;for(var s=iM.bin.ril(t,2),i=6;i<s;){var r=iM.bin.rsl(t,i),o=iM.bin.ril(t,i+2);15677==r&&(e.edit=iM.parse.from3DS._edit3ds(t,i,o)),45056==r&&(e.keyf=iM.parse.from3DS._keyf3ds(t,i,o)),i+=o}return e},iM.parse.from3DS._edit3ds=function(t,e,s){for(var i={},r=e+6;r<e+s;){var o=iM.bin.rsl(t,r),n=iM.bin.ril(t,r+2);16384==o&&(null==i.objects&&(i.objects=[]),i.objects.push(iM.parse.from3DS._edit_object(t,r,n))),r+=n}return i},iM.parse.from3DS._keyf3ds=function(t,e,s){for(var i={},r=e+6;r<e+s;){var o=iM.bin.rsl(t,r),n=iM.bin.ril(t,r+2);45058==o&&(null==i.desc&&(i.desc=[]),i.desc.push(iM.parse.from3DS._keyf_objdes(t,r,n))),r+=n}return i},iM.parse.from3DS._keyf_objdes=function(t,e,s){for(var i={},r=e+6;r<e+s;){var o=iM.bin.rsl(t,r),n=iM.bin.ril(t,r+2);45072==o&&(i.hierarchy=iM.parse.from3DS._keyf_objhierarch(t,r,n)),45073==o&&(i.dummy_name=iM.bin.rASCII0(t,r+6)),r+=n}return i},iM.parse.from3DS._keyf_objhierarch=function(t,e,s){var i={},r=e+6;return i.name=iM.bin.rASCII0(t,r),r+=i.name.length+1,i.hierarchy=iM.bin.rsl(t,r+4),i},iM.parse.from3DS._edit_object=function(t,e,s){var i={},r=e+6;for(i.name=iM.bin.rASCII0(t,r),r+=i.name.length+1;r<e+s;){var o=iM.bin.rsl(t,r),n=iM.bin.ril(t,r+2);16640==o&&(i.mesh=iM.parse.from3DS._obj_trimesh(t,r,n)),r+=n}return i},iM.parse.from3DS._obj_trimesh=function(t,e,s){for(var i={},r=e+6;r<e+s;){var o=iM.bin.rsl(t,r),n=iM.bin.ril(t,r+2);16656==o&&(i.vertices=iM.parse.from3DS._tri_vertexl(t,r,n)),16672==o&&(i.indices=iM.parse.from3DS._tri_facel1(t,r,n)),16704==o&&(i.uvt=iM.parse.from3DS._tri_mappingcoors(t,r,n)),16736==o&&(i.local=iM.parse.from3DS._tri_local(t,r,n)),r+=n}return i},iM.parse.from3DS._tri_vertexl=function(t,e,s){var i=[],r=e+6,o=iM.bin.rsl(t,r);r+=2;for(var n=0;n<o;n++)i.push(iM.bin.rf(t,r)),i.push(iM.bin.rf(t,r+4)),i.push(iM.bin.rf(t,r+8)),r+=12;return i},iM.parse.from3DS._tri_facel1=function(t,e,s){var i=[],r=e+6,o=iM.bin.rsl(t,r);r+=2;for(var n=0;n<o;n++)i.push(iM.bin.rsl(t,r)),i.push(iM.bin.rsl(t,r+2)),i.push(iM.bin.rsl(t,r+4)),r+=8;return i},iM.parse.from3DS._tri_mappingcoors=function(t,e,s){var i=[],r=e+6,o=iM.bin.rsl(t,r);r+=2;for(var n=0;n<o;n++)i.push(iM.bin.rf(t,r)),i.push(1-iM.bin.rf(t,r+4)),r+=8;return i},iM.parse.from3DS._tri_local=function(t,e,s){var i={},r=e+6;return i.X=[iM.bin.rf(t,r),iM.bin.rf(t,r+4),iM.bin.rf(t,r+8)],r+=12,i.Y=[iM.bin.rf(t,r),iM.bin.rf(t,r+4),iM.bin.rf(t,r+8)],r+=12,i.Z=[iM.bin.rf(t,r),iM.bin.rf(t,r+4),iM.bin.rf(t,r+8)],r+=12,i.C=[iM.bin.rf(t,r),iM.bin.rf(t,r+4),iM.bin.rf(t,r+8)],r+=12,i},iM.parse.fromBIV=function(t){t=new Uint8Array(t);var e={},s={};return s.id=iM.bin.ril(t,0),s.verS=iM.bin.ril(t,4),s.texS=iM.bin.ril(t,8),s.indS=iM.bin.ril(t,12),s.verO=iM.bin.ril(t,16),s.verL=iM.bin.ril(t,20),s.texO=iM.bin.ril(t,24),s.texL=iM.bin.ril(t,28),s.indO=iM.bin.ril(t,32),s.indL=iM.bin.ril(t,36),0!=s.verO&&(e.vertices=iM.parse.fromBIV._readFloats(t,s.verO,s.verL)),0!=s.texO&&(e.uvt=iM.parse.fromBIV._readFloats(t,s.texO,s.texL)),0!=s.indO&&(e.indices=iM.parse.fromBIV._readInts(t,s.indO,s.indL,s.indS)),e},iM.parse.toBIV=function(t){for(var e=0,s=0;s<t.indices.length;s++)e=Math.max(e,t.indices[s]);var i=32;e<=65535&&(i=16);var r=40;t.vertices&&(r+=4*t.vertices.length),t.uvt&&(r+=4*t.uvt.length),t.indices&&(r+=t.indices.length*i/8);var o=new Uint8Array(r);iM.bin.wil(o,0,1769365870),iM.bin.wil(o,4,32),iM.bin.wil(o,8,32),iM.bin.wil(o,12,i);var n=40;return t.vertices&&(iM.bin.wil(o,16,n),iM.bin.wil(o,20,4*t.vertices.length),iM.parse.fromBIV._writeFloats(o,n,t.vertices),n+=4*t.vertices.length),t.uvt&&(iM.bin.wil(o,24,n),iM.bin.wil(o,28,4*t.uvt.length),iM.parse.fromBIV._writeFloats(o,n,t.uvt),n+=4*t.uvt.length),t.indices&&(iM.bin.wil(o,32,n),iM.bin.wil(o,36,4*t.indices.length),iM.parse.fromBIV._writeInts(o,n,t.indices,i)),o.buffer},iM.parse.fromBIV._readFloats=function(t,e,s){for(var i=[],r=0;r<s/4;r++)i.push(iM.bin.rf(t,e+4*r));return i},iM.parse.fromBIV._writeFloats=function(t,e,s){for(var i=0;i<s.length;i++)iM.bin.wf(t,e+4*i,s[i])},iM.parse.fromBIV._readInts=function(t,e,s,i){for(var r=[],o=0;o<s/4;o++)16==i&&r.push(iM.bin.rsl(t,e+2*o)),32==i&&r.push(iM.bin.ril(t,e+4*o));return r},iM.parse.fromBIV._writeInts=function(t,e,s,i){for(var r=0;r<s.length;r++)16==i&&iM.bin.wsl(t,e+2*r,s[r]),32==i&&iM.bin.wil(t,e+4*r,s[r])},iM.gen={},iM.gen.Plane=function(t,e,s,i){s||(s=1),i||(i=1);for(var r={verts:[],inds:[],uvt:[]},o=t+1,n=e+1,a=0;a<n;a++)for(var h=0;h<o;h++){var l=h*(2/t)-1,u=a*(2/e)-1;r.verts.push(l,u,0),r.uvt.push(s*h/t,i*a/e),a<e&&h<t&&r.inds.push(a*o+h,a*o+h+1,(a+1)*o+h,a*o+h+1,(a+1)*o+h,(a+1)*o+h+1)}return r},iM.gen.Cube=function(){return{verts:[-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],inds:[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11,12,13,14,13,14,15,16,17,18,17,18,19,20,21,22,21,22,23],uvt:[1/4,1/4,.5,1/4,1/4,.5,.5,.5,1,1/4,3/4,1/4,1,.5,3/4,.5,0,1/4,1/4,1/4,0,.5,1/4,.5,3/4,1/4,.5,1/4,3/4,.5,.5,.5,1/4,1/4,.5,1/4,1/4,0,.5,0,1/4,.5,.5,.5,1/4,3/4,.5,3/4]}},iM.gen.Sphere=function(t,e){for(var s={verts:[],inds:[],uvt:[]},i=t+1,r=e+1,o=0;o<r;o++)for(var n=0;n<i;n++){var a=-Math.PI/2+o*Math.PI/e,h=2*n*Math.PI/t,l=Math.cos(a)*Math.cos(h),u=Math.sin(a),p=Math.cos(a)*Math.sin(h);s.verts.push(l,u,p),s.uvt.push(n/t,o/e),o<e&&n<t&&s.inds.push(i*o+n,i*o+n+1,i*(o+1)+n,i*o+n+1,i*(o+1)+n,i*(o+1)+n+1)}return s},iM.mat={},iM.mat.scale=function(t,e,s){return[t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1]},iM.mat.translate=function(t,e,s){return[1,0,0,0,0,1,0,0,0,0,1,0,t,e,s,1]},iM.mat.rotateDeg=function(t,e,s){var i=Math.PI/180;return iM.mat.rotate(t*i,e*i,s*i)},iM.mat.rotate=function(t,e,s){var i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=t,o=e,n=s,a=Math.cos(r),h=Math.cos(o),l=Math.cos(n),u=Math.sin(r),p=Math.sin(o),c=Math.sin(n);return i[0]=h*l,i[1]=-h*c,i[2]=p,i[4]=a*c+u*p*l,i[5]=a*l-u*p*c,i[6]=-u*h,i[8]=u*c-a*p*l,i[9]=u*l+a*p*c,i[10]=a*h,i},iM.edit={},iM.edit.interpolate=function(t,e,s,i){for(var r=0;r<t.length;r++)s[r]=t[r]+i*(e[r]-t[r])},iM.edit.transform=function(t,e){for(var s=0;s<t.length;s+=3){var i=t[s],r=t[s+1],o=t[s+2];t[s+0]=e[0]*i+e[4]*r+e[8]*o+e[12],t[s+1]=e[1]*i+e[5]*r+e[9]*o+e[13],t[s+2]=e[2]*i+e[6]*r+e[10]*o+e[14]}},iM.edit.unwrap=function(t,e,s){for(var i=new Array(Math.floor(t.length/3)*s),r=0;r<t.length;r++)for(var o=0;o<s;o++)i[r*s+o]=e[t[r]*s+o];return i},iM.edit.remap=function(t,e,s,i){for(var r=new Array(s.length),o=0;o<t.length;o++)for(var n=0;n<i;n++)r[e[o]*i+n]=s[t[o]*i+n];return r},iM.utils={},iM.utils.getAABB=function(t){var e,s,i,r,o,n;r=o=n=-(e=s=i=999999999);for(var a=0;a<t.length;a+=3){var h=t[a+0],l=t[a+1],u=t[a+2];h<e&&(e=h),h>r&&(r=h),l<s&&(s=l),l>o&&(o=l),u<i&&(i=u),l>n&&(n=u)}return{min:{x:e,y:s,z:i},max:{x:r,y:o,z:n}}};const lM=c.vec3(),uM=c.vec3();c.vec3();const pM=c.vec3([0,-1,0]),cM=c.vec4([0,0,0,1]);class dM extends A{constructor(t,e={}){super(t,e),this._src=null,this._image=null,this._pos=c.vec3(),this._origin=c.vec3(),this._rtcPos=c.vec3(),this._dir=c.vec3(),this._size=1,this._imageSize=c.vec2(),this._texture=new _a(this),this._plane=new Os(this,{geometry:new xe(this,hM({center:[0,0,0],xSize:1,zSize:1,xSegments:10,zSegments:10})),material:new Se(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:this._texture,emissiveMap:this._texture,backfaces:!0}),clippable:e.clippable}),this._grid=new Os(this,{geometry:new xe(this,aM({size:1,divisions:10})),material:new Se(this,{diffuse:[0,0,0],ambient:[0,0,0],emissive:[.2,.8,.2]}),position:[0,.001,0],clippable:e.clippable}),this._node=new Qn(this,{rotation:[0,0,0],position:[0,0,0],scale:[1,1,1],clippable:!1,children:[this._plane,this._grid]}),this._gridVisible=!1,this.visible=!0,this.gridVisible=e.gridVisible,this.position=e.position,this.rotation=e.rotation,this.dir=e.dir,this.size=e.size,this.collidable=e.collidable,this.clippable=e.clippable,this.pickable=e.pickable,this.opacity=e.opacity,e.image?this.image=e.image:this.src=e.src}set visible(t){this._plane.visible=t,this._grid.visible=this._gridVisible&&t}get visible(){return this._plane.visible}set gridVisible(t){t=!1!==t,this._gridVisible=t,this._grid.visible=this._gridVisible&&this.visible}get gridVisible(){return this._gridVisible}set image(t){this._image=t,this._image&&(this._imageSize[0]=t.width,this._imageSize[1]=t.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(t){if(this._src=t,this._src){this._image=null;const t=new Image;t.onload=()=>{this._texture.image=t,this._imageSize[0]=t.width,this._imageSize[1]=t.height,this._updatePlaneSizeFromImage()},t.src=this._src}}get src(){return this._src}set position(t){this._pos.set(t||[0,0,0]),X(this._pos,this._origin,this._rtcPos),this._node.origin=this._origin,this._node.position=this._rtcPos}get position(){return this._pos}set rotation(t){this._node.rotation=t}get rotation(){return this._node.rotation}set size(t){this._size=null==t?1:t,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set dir(t){if(this._dir.set(t||[0,0,-1]),t){const e=this.scene.center,s=[-this._dir[0],-this._dir[1],-this._dir[2]];c.subVec3(e,this.position,lM);const i=-c.dotVec3(s,lM);c.normalizeVec3(s),c.mulVec3Scalar(s,i,uM),c.vec3PairToQuaternion(pM,t,cM),this._node.quaternion=cM}}get dir(){return this._dir}set collidable(t){this._node.collidable=!1!==t}get collidable(){return this._node.collidable}set clippable(t){this._node.clippable=!1!==t}get clippable(){return this._node.clippable}set pickable(t){this._node.pickable=!1!==t}get pickable(){return this._node.pickable}set opacity(t){this._node.opacity=t}get opacity(){return this._node.opacity}destroy(){super.destroy()}_updatePlaneSizeFromImage(){const t=this._size,e=this._imageSize[0],s=this._imageSize[1],i=s/e;this._node.scale=e>s?[t,1,t*i]:[t*i,1,t]}}class mM extends he{get type(){return"PointLight"}constructor(t,e={}){super(t,e);const s=this;this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const i=this.scene.camera,r=this.scene.canvas;this._onCameraViewMatrix=i.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=i.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=r.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new zt({type:"point",pos:c.vec3([1,1,1]),color:c.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:e.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(s._shadowViewMatrixDirty){s._shadowViewMatrix||(s._shadowViewMatrix=c.identityMat4());const t=s._state.pos,e=i.look,r=i.up;c.lookAtMat4v(t,e,r,s._shadowViewMatrix),s._shadowViewMatrixDirty=!1}return s._shadowViewMatrix},getShadowProjMatrix:()=>{if(s._shadowProjMatrixDirty){s._shadowProjMatrix||(s._shadowProjMatrix=c.identityMat4());const t=s.scene.canvas.canvas;c.perspectiveMat4(Math.PI/180*70,t.clientWidth/t.clientHeight,.1,500,s._shadowProjMatrix),s._shadowProjMatrixDirty=!1}return s._shadowProjMatrix},getShadowRenderBuf:()=>(s._shadowRenderBuf||(s._shadowRenderBuf=new _t(s.scene.canvas.canvas,s.scene.canvas.gl,{size:[1024,1024]})),s._shadowRenderBuf)}),this.pos=e.pos,this.color=e.color,this.intensity=e.intensity,this.constantAttenuation=e.constantAttenuation,this.linearAttenuation=e.linearAttenuation,this.quadraticAttenuation=e.quadraticAttenuation,this.castsShadow=e.castsShadow,this.scene._lightCreated(this)}set pos(t){this._state.pos.set(t||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get pos(){return this._state.pos}set color(t){this._state.color.set(t||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(t){t=void 0!==t?t:1,this._state.intensity=t,this.glRedraw()}get intensity(){return this._state.intensity}set constantAttenuation(t){this._state.attenuation[0]=t||0,this.glRedraw()}get constantAttenuation(){return this._state.attenuation[0]}set linearAttenuation(t){this._state.attenuation[1]=t||0,this.glRedraw()}get linearAttenuation(){return this._state.attenuation[1]}set quadraticAttenuation(t){this._state.attenuation[2]=t||0,this.glRedraw()}get quadraticAttenuation(){return this._state.attenuation[2]}set castsShadow(t){t=!!t,this._state.castsShadow!==t&&(this._state.castsShadow=t,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const t=this.scene.camera,e=this.scene.canvas;t.off(this._onCameraViewMatrix),t.off(this._onCameraProjMatrix),e.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}function fM(t){if(!gM(t.width)||!gM(t.height)){const e=document.createElement("canvas");e.width=_M(t.width),e.height=_M(t.height);e.getContext("2d").drawImage(t,0,0,t.width,t.height,0,0,e.width,e.height),t=e}return t}function gM(t){return 0==(t&t-1)}function _M(t){--t;for(let e=1;e<32;e<<=1)t|=t>>e;return t+1}class yM extends A{get type(){return"CubeTexture"}constructor(t,e={}){super(t,e);const s=this.scene.canvas.gl;this._state=new zt({texture:new da(s,s.TEXTURE_CUBE_MAP),flipY:this._checkFlipY(e.minFilter),encoding:this._checkEncoding(e.encoding),minFilter:"linearMipmapLinear",magFilter:"linear",wrapS:"clampToEdge",wrapT:"clampToEdge",mipmaps:!0}),this._src=e.src,this._images=[],this._loadSrc(e.src),m.memory.textures++}_checkFlipY(t){return!!t}_checkEncoding(t){return"linear"!==(t=t||"linear")&&"sRGB"!==t&&"gamma"!==t&&(this.error("Unsupported value for 'encoding': '"+t+"' - supported values are 'linear', 'sRGB', 'gamma'. Defaulting to 'linear'."),t="linear"),t}_webglContextRestored(){this.scene.canvas.gl,this._state.texture=null,this._src&&this._loadSrc(this._src)}_loadSrc(t){const e=this,s=this.scene.canvas.gl;this._images=[];let i=!1,r=0;for(let o=0;o<t.length;o++){const n=new Image;n.onload=function(){let t=n;const a=o;return function(){if(!i&&(t=fM(t),e._images[a]=t,r++,6===r)){let t=e._state.texture;t||(t=new da(s,s.TEXTURE_CUBE_MAP),e._state.texture=t),t.setImage(e._images,e._state),t.setProps(e._state),e.fire("loaded",e._src,!1),e.glRedraw()}}}(),n.onerror=function(){i=!0},n.src=t[o]}}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),m.memory.textures--,this._state.destroy()}}class vM extends yM{get type(){return"ReflectionMap"}constructor(t,e={}){super(t,e),this.scene._lightsState.addReflectionMap(this._state),this.scene._reflectionMapCreated(this)}destroy(){super.destroy(),this.scene._reflectionMapDestroyed(this)}}class bM extends yM{get type(){return"LightMap"}constructor(t,e={}){super(t,e),this.scene._lightMapCreated(this)}destroy(){super.destroy(),this.scene._lightMapDestroyed(this)}}class PM extends A{get type(){return"Fresnel"}constructor(t,e={}){super(t,e),this._state=new zt({edgeColor:c.vec3([0,0,0]),centerColor:c.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1}),this.edgeColor=e.edgeColor,this.centerColor=e.centerColor,this.edgeBias=e.edgeBias,this.centerBias=e.centerBias,this.power=e.power}set edgeColor(t){this._state.edgeColor.set(t||[0,0,0]),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set centerColor(t){this._state.centerColor.set(t||[1,1,1]),this.glRedraw()}get centerColor(){return this._state.centerColor}set edgeBias(t){this._state.edgeBias=t||0,this.glRedraw()}get edgeBias(){return this._state.edgeBias}set centerBias(t){this._state.centerBias=null!=t?t:1,this.glRedraw()}get centerBias(){return this._state.centerBias}set power(t){this._state.power=null!=t?t:1,this.glRedraw()}get power(){return this._state.power}destroy(){super.destroy(),this._state.destroy()}}class TM extends q{constructor(t,e={}){super(t,{entity:e.entity,occludable:e.occludable,worldPos:e.worldPos}),this._occluded=!1,this._visible=!0,this._src=null,this._image=null,this._pos=c.vec3(),this._origin=c.vec3(),this._rtcPos=c.vec3(),this._dir=c.vec3(),this._size=1,this._imageSize=c.vec2(),this._texture=new _a(this,{src:e.src}),this._geometry=new xe(this,{primitive:"triangles",positions:[3,3,0,-3,3,0,-3,-3,0,3,-3,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,-1,0,-1,0,0,1,0],indices:[0,1,2,0,2,3]}),this._mesh=new Os(this,{geometry:this._geometry,material:new Se(this,{ambient:[.9,.3,.9],shininess:30,diffuseMap:this._texture,backfaces:!0}),scale:[1,1,1],position:e.worldPos,rotation:[90,0,0],billboard:"spherical",occluder:!1}),this.visible=!0,this.collidable=e.collidable,this.clippable=e.clippable,this.pickable=e.pickable,this.opacity=e.opacity,this.size=e.size,e.image?this.image=e.image:this.src=e.src}_setVisible(t){this._occluded=!t,this._mesh.visible=this._visible&&!this._occluded,super._setVisible(t)}set visible(t){this._visible=null==t||t,this._mesh.visible=this._visible&&!this._occluded}get visible(){return this._visible}set image(t){this._image=t,this._image&&(this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(t){if(this._src=t,this._src){this._image=null;const t=new Image;t.onload=()=>{this._texture.image=t,this._imageSize[0]=t.width,this._imageSize[1]=t.height,this._updatePlaneSizeFromImage()},t.src=this._src}}get src(){return this._src}set size(t){this._size=null==t?1:t,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set collidable(t){this._mesh.collidable=!1!==t}get collidable(){return this._mesh.collidable}set clippable(t){this._mesh.clippable=!1!==t}get clippable(){return this._mesh.clippable}set pickable(t){this._mesh.pickable=!1!==t}get pickable(){return this._mesh.pickable}set opacity(t){this._mesh.opacity=t}get opacity(){return this._mesh.opacity}_updatePlaneSizeFromImage(){const t=.5*this._size,e=this._imageSize[0],s=this._imageSize[1],i=s/e;this._geometry.positions=e>s?[t,t*i,0,-t,t*i,0,-t,-t*i,0,t,-t*i,0]:[t/i,t,0,-t/i,t,0,-t/i,-t,0,t/i,-t,0]}}const wM=c.vec3();class xM{constructor(t){if(this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsOpacity=[],this.numObjects=0,t){const e=t.metaScene.scene;this.saveObjects(e,t)}}saveObjects(t,e,s){const i=e.rootMetaObject;if(!i)return;const r=i.getObjectIDsInSubtree();this.numObjects=0,this._mask=s?_.apply(s,{}):null;const o=t.objects,n=!s||s.visible,a=!s||s.edges,h=!s||s.xrayed,l=!s||s.highlighted,u=!s||s.selected,p=!s||s.clippable,c=!s||s.pickable,d=!s||s.colorize,m=!s||s.opacity;for(var f=0,g=r.length;f<g;f++){const t=o[r[f]];if(t){if(n&&(this.objectsVisible[f]=t.visible),a&&(this.objectsEdges[f]=t.edges),h&&(this.objectsXrayed[f]=t.xrayed),l&&(this.objectsHighlighted[f]=t.highlighted),u&&(this.objectsSelected[f]=t.selected),p&&(this.objectsClippable[f]=t.clippable),c&&(this.objectsPickable[f]=t.pickable),d){const e=t.colorize;this.objectsColorize[3*f+0]=e[0],this.objectsColorize[3*f+1]=e[1],this.objectsColorize[3*f+2]=e[2]}m&&(this.objectsOpacity[f]=t.opacity),this.numObjects++}}}restoreObjects(t,e){const s=e.rootMetaObject;if(!s)return;const i=s.getObjectIDsInSubtree(),r=this._mask,o=!r||r.visible,n=!r||r.edges,a=!r||r.xrayed,h=!r||r.highlighted,l=!r||r.selected,u=!r||r.clippable,p=!r||r.pickable,c=!r||r.colorize,d=!r||r.opacity,m=t.objects;for(var f=0,g=i.length;f<g;f++){const t=m[i[f]];t&&(o&&(t.visible=this.objectsVisible[f]),n&&(t.edges=this.objectsEdges[f]),a&&(t.xrayed=this.objectsXrayed[f]),h&&(t.highlighted=this.objectsHighlighted[f]),l&&(t.selected=this.objectsSelected[f]),u&&(t.clippable=this.objectsClippable[f]),p&&(t.pickable=this.objectsPickable[f]),c&&(wM[0]=this.objectsColorize[3*f+0],wM[1]=this.objectsColorize[3*f+1],wM[2]=this.objectsColorize[3*f+2],t.colorize=wM),d&&(t.opacity=this.objectsOpacity[f]))}}}class MM extends Wx{constructor(t,e={}){super(t,e),this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.v3=e.v3,this.t=e.t}set v0(t){this._v0=t||c.vec3([0,0,0])}get v0(){return this._v0}set v1(t){this._v1=t||c.vec3([0,0,0])}get v1(){return this._v1}set v2(t){this._v2=t||c.vec3([0,0,0])}get v2(){return this._v2}set v3(t){this.fire("v3",this._v3=t||c.vec3([0,0,0]))}get v3(){return this._v3}set t(t){t=t||0,this._t=t<0?0:t>1?1:t}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(t){var e=c.vec3();return e[0]=c.b3(t,this._v0[0],this._v1[0],this._v2[0],this._v3[0]),e[1]=c.b3(t,this._v0[1],this._v1[1],this._v2[1],this._v3[1]),e[2]=c.b3(t,this._v0[2],this._v1[2],this._v2[2],this._v3[2]),e}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,v3:this._v3,t:this._t}}}class DM extends Wx{constructor(t,e={}){super(t,e),this._cachedLengths=[],this._dirty=!0,this._curves=[],this._t=0,this._dirtySubs=[],this._destroyedSubs=[],this.curves=e.curves||[],this.t=e.t}addCurve(t){this._curves.push(t),this._dirty=!0}set curves(t){var e,s,i;for(t=t||[],s=0,i=this._curves.length;s<i;s++)(e=this._curves[s]).off(this._dirtySubs[s]),e.off(this._destroyedSubs[s]);this._curves=[],this._dirtySubs=[],this._destroyedSubs=[];var r=this;function o(){r._dirty=!0}function n(){var t=this.id;for(s=0,i=r._curves.length;s<i;s++)if(r._curves[s].id===t)return r._curves=r._curves.slice(s,s+1),r._dirtySubs=r._dirtySubs.slice(s,s+1),r._destroyedSubs=r._destroyedSubs.slice(s,s+1),void(r._dirty=!0)}for(s=0,i=t.length;s<i;s++){if(e=t[s],_.isNumeric(e)||_.isString(e)){var a=e;if(!(e=this.scene.components[a])){this.error("Component not found: "+_inQuotes(a));continue}}var h=e.type;"xeokit.SplineCurve"===h||"xeokit.Path"===h||"xeokit.CubicBezierCurve"===h||"xeokit.QuadraticBezierCurve"===h?(this._curves.push(e),this._dirtySubs.push(e.on("dirty",o)),this._destroyedSubs.push(e.once("destroyed",n))):this.error("Component "+_inQuotes(e.id)+" is not a xeokit.SplineCurve, xeokit.Path or xeokit.QuadraticBezierCurve")}this._dirty=!0}get curves(){return this._curves}set t(t){t=t||0,this._t=t<0?0:t>1?1:t}get t(){return this._t}get point(){return this.getPoint(this._t)}get length(){var t=this._getCurveLengths();return t[t.length-1]}getPoint(t){for(var e,s=t*this.length,i=this._getCurveLengths(),r=0;r<i.length;){if(i[r]>=s){var o=1-(i[r]-s)/(e=this._curves[r]).length;return e.getPointAt(o)}r++}return null}_getCurveLengths(){if(!this._dirty)return this._cachedLengths;var t,e=[],s=0,i=this._curves.length;for(t=0;t<i;t++)s+=this._curves[t].length,e.push(s);return this._cachedLengths=e,this._dirty=!1,e}_getJSON(){for(var t=[],e=0,s=this._curves.length;e<s;e++)t.push(this._curves[e].id);return{curves:t,t:this._t}}destroy(){var t,e,s;for(super.destroy(),t=0,e=this._curves.length;t<e;t++)(s=this._curves[t]).off(this._dirtySubs[t]),s.off(this._destroyedSubs[t])}}class EM extends Wx{constructor(t,e={}){super(t,e),this.v0=e.v0,this.v1=e.v1,this.v2=e.v2,this.t=e.t}set v0(t){this._v0=t||c.vec3([0,0,0])}get v0(){return this._v0}set v1(t){this._v1=t||c.vec3([0,0,0])}get v1(){return this._v1}set v2(t){this._v2=t||c.vec3([0,0,0])}get v2(){return this._v2}set t(t){t=t||0,this._t=t<0?0:t>1?1:t}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(t){var e=c.vec3();return e[0]=c.b2(t,this._v0[0],this._v1[0],this._v2[0]),e[1]=c.b2(t,this._v0[1],this._v1[1],this._v2[1]),e[2]=c.b2(t,this._v0[2],this._v1[2],this._v2[2]),e}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,t:this._t}}}const IM=c.vec4(),SM=c.vec4(),AM=c.vec3(),CM=c.vec3(),FM=c.vec3(),OM=c.vec4(),RM=c.vec4(),LM=c.vec4();class NM{constructor(t){this._scene=t}dollyToCanvasPos(t,e,s){let i=!1;const r=this._scene.camera;if(t){const e=c.subVec3(t,r.eye,AM);i=c.lenVec3(e)<s}if("perspective"===r.projection){r.ortho.scale=r.ortho.scale-s;const i=this._unproject(e,OM),o=c.subVec3(i,r.eye,LM),n=c.mulVec3Scalar(c.normalizeVec3(o),-s,[]);if(r.eye=[r.eye[0]-n[0],r.eye[1]-n[1],r.eye[2]-n[2]],r.look=[r.look[0]-n[0],r.look[1]-n[1],r.look[2]-n[2]],t){const e=c.subVec3(t,r.eye,AM),s=c.lenVec3(e),i=c.mulVec3Scalar(c.normalizeVec3(c.subVec3(r.look,r.eye,CM)),s);r.look=[r.eye[0]+i[0],r.eye[1]+i[1],r.eye[2]+i[2]]}}else if("ortho"===r.projection){const t=this._unproject(e,OM);r.ortho.scale=r.ortho.scale-s,r.ortho._update();const i=this._unproject(e,RM),o=c.subVec3(i,t,LM),n=c.mulVec3Scalar(c.normalizeVec3(c.subVec3(r.look,r.eye,AM)),-s,CM),a=c.addVec3(o,n,FM);r.eye=[r.eye[0]-a[0],r.eye[1]-a[1],r.eye[2]-a[2]],r.look=[r.look[0]-a[0],r.look[1]-a[1],r.look[2]-a[2]]}return i}_unproject(t,e){const s=this._scene.camera,i=s.project.transposedMatrix,r=i.subarray(8,12),o=i.subarray(12),n=[0,0,-1,1],a=c.dotVec4(n,r)/c.dotVec4(n,o);return s.project.unproject(t,a,IM,SM,e),e}destroy(){}}const BM=c.vec3(),kM=c.vec3(),jM=c.vec3(),GM=c.vec4(),HM=c.vec4(),VM=c.vec4();class zM{constructor(t,e){this._scene=t,this._configs=e,this._pivotWorldPos=c.vec3(),this._cameraOffset=c.vec3(),this._azimuth=0,this._polar=0,this._radius=0,this._pivotPosSet=!1,this._pivoting=!1,this._shown=!1,this._pivotViewPos=c.vec4(),this._pivotProjPos=c.vec4(),this._pivotCanvasPos=c.vec2(),this._cameraDirty=!0,this._onViewMatrix=this._scene.camera.on("viewMatrix",(()=>{this._cameraDirty=!0})),this._onProjMatrix=this._scene.camera.on("projMatrix",(()=>{this._cameraDirty=!0})),this._onTick=this._scene.on("tick",(()=>{this.updatePivotElement()}))}updatePivotElement(){const t=this._scene.camera,e=this._scene.canvas;if(this._pivoting&&this._cameraDirty){c.transformPoint3(t.viewMatrix,this.getPivotPos(),this._pivotViewPos),this._pivotViewPos[3]=1,c.transformPoint4(t.projMatrix,this._pivotViewPos,this._pivotProjPos);const s=e.boundary,i=s[2],r=s[3];this._pivotCanvasPos[0]=Math.floor((1+this._pivotProjPos[0]/this._pivotProjPos[3])*i/2),this._pivotCanvasPos[1]=Math.floor((1-this._pivotProjPos[1]/this._pivotProjPos[3])*r/2);const o=e.canvas.getBoundingClientRect();this._pivotElement&&(this._pivotElement.style.left=Math.floor(o.left+this._pivotCanvasPos[0])-this._pivotElement.clientWidth/2+window.scrollX+"px",this._pivotElement.style.top=Math.floor(o.top+this._pivotCanvasPos[1])-this._pivotElement.clientHeight/2+window.scrollY+"px"),this._cameraDirty=!1}}setPivotElement(t){this._pivotElement=t}startPivot(){if(this._cameraLookingDownwards())return this._pivoting=!1,!1;const t=this._scene.camera;let e=c.lookAtMat4v(t.eye,t.look,t.worldUp);c.transformPoint3(e,this.getPivotPos(),this._cameraOffset);const s=this.getPivotPos();this._cameraOffset[2]+=c.distVec3(t.eye,s),e=c.inverseMat4(e);const i=c.transformVec3(e,this._cameraOffset),r=c.vec3();if(c.subVec3(t.eye,s,r),c.addVec3(r,i),t.zUp){const t=r[1];r[1]=r[2],r[2]=t}this._radius=c.lenVec3(r),this._polar=Math.acos(r[1]/this._radius),this._azimuth=Math.atan2(r[0],r[2]),this._pivoting=!0}_cameraLookingDownwards(){const t=this._scene.camera,e=c.normalizeVec3(c.subVec3(t.look,t.eye,BM)),s=c.cross3Vec3(e,t.worldUp,kM);return c.sqLenVec3(s)<=1e-4}getPivoting(){return this._pivoting}setPivotPos(t){this._pivotWorldPos.set(t),this._pivotPosSet=!0}setCanvasPivotPos(t){const e=this._scene.camera,s=Math.abs(c.distVec3(this._scene.center,e.eye)),i=e.project.transposedMatrix,r=i.subarray(8,12),o=i.subarray(12),n=[0,0,-1,1],a=c.dotVec4(n,r)/c.dotVec4(n,o),h=GM;e.project.unproject(t,a,HM,VM,h);const l=c.normalizeVec3(c.subVec3(h,e.eye,BM)),u=c.addVec3(e.eye,c.mulVec3Scalar(l,s,kM),jM);this.setPivotPos(u)}getPivotPos(){return this._pivotPosSet?this._pivotWorldPos:this._scene.camera.look}continuePivot(t,e){if(!this._pivoting)return;if(0===t&&0===e)return;const s=this._scene.camera;var i=-t;const r=-e;1===s.worldUp[2]&&(i=-i),this._azimuth+=.01*-i,this._polar+=.01*r,this._polar=c.clamp(this._polar,.001,Math.PI-.001);const o=[this._radius*Math.sin(this._polar)*Math.sin(this._azimuth),this._radius*Math.cos(this._polar),this._radius*Math.sin(this._polar)*Math.cos(this._azimuth)];if(1===s.worldUp[2]){const t=o[1];o[1]=o[2],o[2]=t}const n=c.lenVec3(c.subVec3(s.look,s.eye,c.vec3())),a=this.getPivotPos();c.addVec3(o,a);let h=c.lookAtMat4v(o,a,s.worldUp);h=c.inverseMat4(h);const l=c.transformVec3(h,this._cameraOffset);h[12]-=l[0],h[13]-=l[1],h[14]-=l[2];const u=[h[8],h[9],h[10]];s.eye=[h[12],h[13],h[14]],c.subVec3(s.eye,c.mulVec3Scalar(u,n),s.look),s.up=[h[4],h[5],h[6]],this.showPivot()}showPivot(){this._shown||(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this.updatePivotElement(),this._pivotElement.style.visibility="visible",this._shown=!0,this._hideTimeout=window.setTimeout((()=>{this.hidePivot()}),1e3)))}hidePivot(){this._shown&&(null!==this._hideTimeout&&(window.clearTimeout(this._hideTimeout),this._hideTimeout=null),this._pivotElement&&(this._pivotElement.style.visibility="hidden"),this._shown=!1)}endPivot(){this._pivoting=!1}destroy(){this._scene.camera.off(this._onViewMatrix),this._scene.camera.off(this._onProjMatrix),this._scene.off(this._onTick)}}class UM{constructor(t,e){this._scene=t.scene,this._cameraControl=t,this._scene.canvas.canvas.oncontextmenu=function(t){t.preventDefault()},this._configs=e,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.pickCursorPos=c.vec2(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,this._lastPickedEntityId=null,this._needFireEvents=!1}update(){if(!this._configs.pointerEnabled)return;if(!this.schedulePickEntity&&!this.schedulePickSurface)return;this.picked=!1,this.pickedSurface=!1,this._needFireEvents=!1;const t=this._cameraControl.hasSubs("hoverSurface");if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){const e=this.pickResult.canvasPos;if(e[0]===this.pickCursorPos[0]&&e[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,this._needFireEvents=t,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}if(this.schedulePickEntity&&this.pickResult){const t=this.pickResult.canvasPos;if(t[0]===this.pickCursorPos[0]&&t[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickSurface?(this.pickResult=this._scene.pick({pickSurface:!0,pickSurfaceNormal:!1,canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!0,this._needFireEvents=!0)):(this.pickResult=this._scene.pick({canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!1,this._needFireEvents=!0)),this.schedulePickEntity=!1,this.schedulePickSurface=!1}fireEvents(){if(this._needFireEvents){if(this.picked&&this.pickResult&&this.pickResult.entity){const t=this.pickResult.entity.id;this._lastPickedEntityId!==t&&(void 0!==this._lastPickedEntityId&&this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._cameraControl.fire("hoverEnter",this.pickResult,!0),this._lastPickedEntityId=t),this._cameraControl.fire("hover",this.pickResult,!0),this.pickResult.worldPos&&(this.pickedSurface=!0,this._cameraControl.fire("hoverSurface",this.pickResult,!0))}else void 0!==this._lastPickedEntityId&&(this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),this._cameraControl.fire("hoverOff",{canvasPos:this.pickCursorPos},!0);this.pickResult=null,this._needFireEvents=!1}}destroy(){}}const XM=c.vec2();class WM{constructor(t,e,s,i,r){this._scene=t;const o=e.pickController;let n,a,h,l=0,u=0,p=0,d=0,m=!1;const f=c.vec3();let g=!0;const _=this._scene.canvas.canvas,y=[];function v(t=!0){_.style.cursor="move",l=i.pointerCanvasPos[0],u=i.pointerCanvasPos[1],p=i.pointerCanvasPos[0],d=i.pointerCanvasPos[1],t&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(m=!0,f.set(o.pickResult.worldPos)):m=!1)}document.addEventListener("keydown",this._documentKeyDownHandler=e=>{if(!s.active||!s.pointerEnabled||!t.input.keyboardEnabled)return;const i=e.keyCode;y[i]=!0}),document.addEventListener("keyup",this._documentKeyUpHandler=e=>{if(!s.active||!s.pointerEnabled||!t.input.keyboardEnabled)return;const i=e.keyCode;y[i]=!1}),_.addEventListener("mousedown",this._mouseDownHandler=e=>{if(s.active&&s.pointerEnabled)switch(e.which){case 1:y[t.input.KEY_SHIFT]||s.planView?(n=!0,v()):(n=!0,v(!1));break;case 2:a=!0,v();break;case 3:h=!0,s.panRightClick&&v()}}),document.addEventListener("mousemove",this._documentMouseMoveHandler=()=>{if(!s.active||!s.pointerEnabled)return;if(!n&&!a&&!h)return;const e=t.canvas.boundary,o=e[2]-e[0],p=e[3]-e[1],d=i.pointerCanvasPos[0],g=i.pointerCanvasPos[1];if(y[t.input.KEY_SHIFT]||s.planView||!s.panRightClick&&a||s.panRightClick&&h){const e=d-l,s=g-u,i=t.camera;if("perspective"===i.projection){const o=Math.abs(m?c.lenVec3(c.subVec3(f,t.camera.eye,[])):t.camera.eyeLookDist)*Math.tan(i.perspective.fov/2*Math.PI/180);r.panDeltaX+=1.5*e*o/p,r.panDeltaY+=1.5*s*o/p}else r.panDeltaX+=.5*i.ortho.scale*(e/p),r.panDeltaY+=.5*i.ortho.scale*(s/p)}else!n||a||h||s.planView||(s.firstPerson?(r.rotateDeltaY-=(d-l)/o*s.dragRotationRate/2,r.rotateDeltaX+=(g-u)/p*(s.dragRotationRate/4)):(r.rotateDeltaY-=(d-l)/o*(1.5*s.dragRotationRate),r.rotateDeltaX+=(g-u)/p*(1.5*s.dragRotationRate)));l=d,u=g}),_.addEventListener("mousemove",this._canvasMouseMoveHandler=t=>{s.active&&s.pointerEnabled&&i.mouseover&&(g=!0)}),document.addEventListener("mouseup",this._documentMouseUpHandler=t=>{if(s.active&&s.pointerEnabled)switch(t.which){case 1:case 2:case 3:n=!1,a=!1,h=!1}}),_.addEventListener("mouseup",this._mouseUpHandler=t=>{if(s.active&&s.pointerEnabled){if(3===t.which){!function(t,e){if(t){let s=t.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;e[0]=t.pageX-i,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y}(t,XM);const s=XM[0],i=XM[1];Math.abs(s-p)<3&&Math.abs(i-d)<3&&e.cameraControl.fire("rightClick",{pagePos:[Math.round(t.pageX),Math.round(t.pageY)],canvasPos:XM,event:t},!0)}_.style.removeProperty("cursor")}}),_.addEventListener("mouseenter",this._mouseEnterHandler=()=>{s.active&&s.pointerEnabled});const b=1/60;let P=null;_.addEventListener("wheel",this._mouseWheelHandler=t=>{if(!s.active||!s.pointerEnabled)return;const e=performance.now()/1e3;var o=null!==P?e-P:0;P=e,o>.05&&(o=.05),o<b&&(o=b);const n=Math.max(-1,Math.min(1,40*-t.deltaY));if(0===n)return;const a=n/Math.abs(n);r.dollyDelta+=-a*o*s.mouseWheelDollyRate,g&&(i.followPointerDirty=!0,g=!1),t.preventDefault()},{passive:!0})}reset(){}destroy(){const t=this._scene.canvas.canvas;document.removeEventListener("keydown",this._documentKeyDownHandler),document.removeEventListener("keyup",this._documentKeyUpHandler),t.removeEventListener("mousedown",this._mouseDownHandler),document.removeEventListener("mousemove",this._documentMouseMoveHandler),t.removeEventListener("mousemove",this._canvasMouseMoveHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),t.removeEventListener("mouseup",this._mouseUpHandler),t.removeEventListener("mouseenter",this._mouseEnterHandler),t.removeEventListener("wheel",this._mouseWheelHandler)}}const YM=c.vec3(),KM=c.vec3(),ZM=c.vec3(),qM=c.vec3(),$M=c.vec3(),QM={eye:c.vec3(),look:c.vec3(),up:c.vec3()};class JM{constructor(t,e,s,i){this._scene=t;const r=e.cameraControl,o=t.camera;this._onSceneKeyDown=t.input.on("keydown",(()=>{if(!s.active||!s.pointerEnabled||!t.input.keyboardEnabled)return;if(!i.mouseover)return;const n=r._isKeyDownForAction(r.AXIS_VIEW_RIGHT),a=r._isKeyDownForAction(r.AXIS_VIEW_BACK),h=r._isKeyDownForAction(r.AXIS_VIEW_LEFT),l=r._isKeyDownForAction(r.AXIS_VIEW_FRONT),u=r._isKeyDownForAction(r.AXIS_VIEW_TOP),p=r._isKeyDownForAction(r.AXIS_VIEW_BOTTOM);if(!(n||a||h||l||u||p))return;const d=t.aabb,m=c.getAABB3Diag(d);c.getAABB3Center(d,YM);const f=Math.abs(m/Math.tan(e.cameraFlight.fitFOV*c.DEGTORAD)),g=1.1*m;QM.orthoScale=g,n?(QM.eye.set(c.addVec3(YM,c.mulVec3Scalar(o.worldRight,f,KM),$M)),QM.look.set(YM),QM.up.set(o.worldUp)):a?(QM.eye.set(c.addVec3(YM,c.mulVec3Scalar(o.worldForward,f,KM),$M)),QM.look.set(YM),QM.up.set(o.worldUp)):h?(QM.eye.set(c.addVec3(YM,c.mulVec3Scalar(o.worldRight,-f,KM),$M)),QM.look.set(YM),QM.up.set(o.worldUp)):l?(QM.eye.set(c.addVec3(YM,c.mulVec3Scalar(o.worldForward,-f,KM),$M)),QM.look.set(YM),QM.up.set(o.worldUp)):u?(QM.eye.set(c.addVec3(YM,c.mulVec3Scalar(o.worldUp,f,KM),$M)),QM.look.set(YM),QM.up.set(c.normalizeVec3(c.mulVec3Scalar(o.worldForward,1,ZM),qM))):p&&(QM.eye.set(c.addVec3(YM,c.mulVec3Scalar(o.worldUp,-f,KM),$M)),QM.look.set(YM),QM.up.set(c.normalizeVec3(c.mulVec3Scalar(o.worldForward,-1,ZM)))),!s.firstPerson&&s.followPointer&&e.pivotController.setPivotPos(YM),e.cameraFlight.duration>0?e.cameraFlight.flyTo(QM,(()=>{e.pivotController.getPivoting()&&s.followPointer&&e.pivotController.showPivot()})):(e.cameraFlight.jumpTo(QM),e.pivotController.getPivoting()&&s.followPointer&&e.pivotController.showPivot())}))}reset(){}destroy(){this._scene.input.off(this._onSceneKeyDown)}}class tD{constructor(t,e,s,i,r){this._scene=t;const o=e.pickController,n=e.pivotController,a=e.cameraControl;this._clicks=0,this._timeout=null,this._lastPickedEntityId=null;let h=!1,l=!1;const u=this._scene.canvas.canvas,p=s=>{let i;s&&s.worldPos&&(i=s.worldPos);const r=s&&s.entity?s.entity.aabb:t.aabb;if(i){const s=t.camera;c.subVec3(s.eye,s.look,[]),e.cameraFlight.flyTo({aabb:r})}else e.cameraFlight.flyTo({aabb:r})};u.addEventListener("mousemove",this._canvasMouseMoveHandler=e=>{if(!s.active||!s.pointerEnabled)return;if(h||l)return;const r=a.hasSubs("hover"),n=a.hasSubs("hoverOut"),u=a.hasSubs("hoverOff"),p=a.hasSubs("hoverSurface");if(r||n||u||p)if(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=p,o.update(),o.pickResult){const e=o.pickResult.entity.id;this._lastPickedEntityId!==e&&(void 0!==this._lastPickedEntityId&&a.fire("hoverOut",{entity:t.objects[this._lastPickedEntityId]},!0),a.fire("hoverEnter",o.pickResult,!0),this._lastPickedEntityId=e),a.fire("hover",o.pickResult,!0),o.pickResult.worldPos&&a.fire("hoverSurface",o.pickResult,!0)}else void 0!==this._lastPickedEntityId&&(a.fire("hoverOut",{entity:t.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),a.fire("hoverOff",{canvasPos:o.pickCursorPos},!0)}),u.addEventListener("mousedown",this._canvasMouseDownHandler=e=>{1===e.which&&(h=!0),3===e.which&&(l=!0);if(1===e.which&&s.active&&s.pointerEnabled&&(i.mouseDownClientX=e.clientX,i.mouseDownClientY=e.clientY,i.mouseDownCursorX=i.pointerCanvasPos[0],i.mouseDownCursorY=i.pointerCanvasPos[1],!s.firstPerson&&s.followPointer&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickSurface=!0,o.update(),1===e.which))){const e=o.pickResult;e&&e.worldPos?(n.setPivotPos(e.worldPos),n.startPivot()):(s.smartPivot?n.setCanvasPivotPos(i.pointerCanvasPos):n.setPivotPos(t.camera.look),n.startPivot())}}),document.addEventListener("mouseup",this._documentMouseUpHandler=t=>{1===t.which&&(h=!1),3===t.which&&(l=!1)}),u.addEventListener("mouseup",this._canvasMouseUpHandler=r=>{if(!s.active||!s.pointerEnabled)return;if(!(1===r.which))return;if(n.hidePivot(),Math.abs(r.clientX-i.mouseDownClientX)>3||Math.abs(r.clientY-i.mouseDownClientY)>3)return;const h=a.hasSubs("picked"),l=a.hasSubs("pickedNothing"),u=a.hasSubs("pickedSurface"),d=a.hasSubs("doublePicked"),m=a.hasSubs("doublePickedSurface"),f=a.hasSubs("doublePickedNothing");if(!(s.doublePickFlyTo||d||m||f))return(h||l||u)&&(o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=!0,o.schedulePickSurface=u,o.update(),o.pickResult?(a.fire("picked",o.pickResult,!0),o.pickedSurface&&a.fire("pickedSurface",o.pickResult,!0)):a.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0)),void(this._clicks=0);if(this._clicks++,1===this._clicks)this._timeout=setTimeout((()=>{o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=s.doublePickFlyTo,o.schedulePickSurface=u,o.update(),o.pickResult?(a.fire("picked",o.pickResult,!0),o.pickedSurface&&(a.fire("pickedSurface",o.pickResult,!0),!s.firstPerson&&s.followPointer&&(e.pivotController.setPivotPos(o.pickResult.worldPos),e.pivotController.startPivot()&&e.pivotController.showPivot()))):a.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0),this._clicks=0}),250);else{if(null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),o.pickCursorPos=i.pointerCanvasPos,o.schedulePickEntity=s.doublePickFlyTo||d||m,o.schedulePickSurface=o.schedulePickEntity&&m,o.update(),o.pickResult){if(a.fire("doublePicked",o.pickResult,!0),o.pickedSurface&&a.fire("doublePickedSurface",o.pickResult,!0),s.doublePickFlyTo&&(p(o.pickResult),!s.firstPerson&&s.followPointer)){const t=o.pickResult.entity.aabb,s=c.getAABB3Center(t);e.pivotController.setPivotPos(s),e.pivotController.startPivot()&&e.pivotController.showPivot()}}else if(a.fire("doublePickedNothing",{canvasPos:i.pointerCanvasPos},!0),s.doublePickFlyTo&&(p(),!s.firstPerson&&s.followPointer)){const s=t.aabb,i=c.getAABB3Center(s);e.pivotController.setPivotPos(i),e.pivotController.startPivot()&&e.pivotController.showPivot()}this._clicks=0}},!1)}reset(){this._clicks=0,this._lastPickedEntityId=null,this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}destroy(){const t=this._scene.canvas.canvas;t.removeEventListener("mousemove",this._canvasMouseMoveHandler),t.removeEventListener("mousedown",this._canvasMouseDownHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),t.removeEventListener("mouseup",this._canvasMouseUpHandler),this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}}class eD{constructor(t,e,s,i,r){this._scene=t;const o=t.input,n=[],a=t.canvas.canvas;let h=!0;this._onSceneMouseMove=o.on("mousemove",(()=>{h=!0})),this._onSceneKeyDown=o.on("keydown",(e=>{s.active&&s.pointerEnabled&&t.input.keyboardEnabled&&i.mouseover&&(n[e]=!0,e===o.KEY_SHIFT&&(a.style.cursor="move"))})),this._onSceneKeyUp=o.on("keyup",(e=>{s.active&&s.pointerEnabled&&t.input.keyboardEnabled&&i.mouseover&&(n[e]=!1,e===o.KEY_SHIFT&&(a.style.cursor=null))})),this._onTick=t.on("tick",(a=>{if(!s.active||!s.pointerEnabled||!t.input.keyboardEnabled)return;if(!i.mouseover)return;const l=e.cameraControl,u=a.deltaTime/1e3;if(!s.planView){const t=l._isKeyDownForAction(l.ROTATE_Y_POS,n),i=l._isKeyDownForAction(l.ROTATE_Y_NEG,n),o=l._isKeyDownForAction(l.ROTATE_X_POS,n),a=l._isKeyDownForAction(l.ROTATE_X_NEG,n),h=u*s.keyboardRotationRate;(t||i||o||a)&&(!s.firstPerson&&s.followPointer&&e.pivotController.startPivot(),t?r.rotateDeltaY+=h:i&&(r.rotateDeltaY-=h),o?r.rotateDeltaX+=h:a&&(r.rotateDeltaX-=h),!s.firstPerson&&s.followPointer&&e.pivotController.startPivot())}if(!n[o.KEY_CTRL]&&!n[o.KEY_ALT]){const t=l._isKeyDownForAction(l.DOLLY_BACKWARDS,n),o=l._isKeyDownForAction(l.DOLLY_FORWARDS,n);if(t||o){const n=u*s.keyboardDollyRate;!s.firstPerson&&s.followPointer&&e.pivotController.startPivot(),o?r.dollyDelta-=n:t&&(r.dollyDelta+=n),h&&(i.followPointerDirty=!0,h=!1)}}const p=l._isKeyDownForAction(l.PAN_FORWARDS,n),c=l._isKeyDownForAction(l.PAN_BACKWARDS,n),d=l._isKeyDownForAction(l.PAN_LEFT,n),m=l._isKeyDownForAction(l.PAN_RIGHT,n),f=l._isKeyDownForAction(l.PAN_UP,n),g=l._isKeyDownForAction(l.PAN_DOWN,n),_=(n[o.KEY_ALT]?.3:1)*u*s.keyboardPanRate;(p||c||d||m||f||g)&&(!s.firstPerson&&s.followPointer&&e.pivotController.startPivot(),g?r.panDeltaY+=_:f&&(r.panDeltaY+=-_),m?r.panDeltaX+=-_:d&&(r.panDeltaX+=_),c?r.panDeltaZ+=_:p&&(r.panDeltaZ+=-_))}))}reset(){}destroy(){this._scene.off(this._onTick),this._scene.input.off(this._onSceneMouseMove),this._scene.input.off(this._onSceneKeyDown),this._scene.input.off(this._onSceneKeyUp)}}const sD=c.vec3();class iD{constructor(t,e,s,i,r){this._scene=t;const o=t.camera,n=e.pickController,a=e.pivotController,h=e.panController;let l=1,u=1,p=null;this._onTick=t.on("tick",(()=>{if(!s.active||!s.pointerEnabled)return;let e="default";if(Math.abs(r.dollyDelta)<.001&&(r.dollyDelta=0),Math.abs(r.rotateDeltaX)<.001&&(r.rotateDeltaX=0),Math.abs(r.rotateDeltaY)<.001&&(r.rotateDeltaY=0),0===r.rotateDeltaX&&0===r.rotateDeltaY||(r.dollyDelta=0),s.followPointer&&--l<=0&&(l=1,0!==r.dollyDelta)){if(0===r.rotateDeltaY&&0===r.rotateDeltaX&&s.followPointer&&i.followPointerDirty&&(n.pickCursorPos=i.pointerCanvasPos,n.schedulePickSurface=!0,n.update(),n.pickResult&&n.pickResult.worldPos?p=n.pickResult.worldPos:(u=1,p=null),i.followPointerDirty=!1),p){const e=Math.abs(c.lenVec3(c.subVec3(p,t.camera.eye,sD)));u=e/s.dollyProximityThreshold}u<s.dollyMinSpeed&&(u=s.dollyMinSpeed)}const d=r.dollyDelta*u;if(0===r.rotateDeltaY&&0===r.rotateDeltaX||(!s.firstPerson&&s.followPointer&&a.getPivoting()?(a.continuePivot(r.rotateDeltaY,r.rotateDeltaX),a.showPivot()):(0!==r.rotateDeltaX&&(s.firstPerson?o.pitch(-r.rotateDeltaX):o.orbitPitch(r.rotateDeltaX)),0!==r.rotateDeltaY&&(s.firstPerson?o.yaw(r.rotateDeltaY):o.orbitYaw(r.rotateDeltaY))),r.rotateDeltaX*=s.rotationInertia,r.rotateDeltaY*=s.rotationInertia,e="grabbing"),Math.abs(r.panDeltaX)<.001&&(r.panDeltaX=0),Math.abs(r.panDeltaY)<.001&&(r.panDeltaY=0),Math.abs(r.panDeltaZ)<.001&&(r.panDeltaZ=0),0!==r.panDeltaX||0!==r.panDeltaY||0!==r.panDeltaZ){const t=c.vec3();let i,n;if(t[0]=r.panDeltaX,t[1]=r.panDeltaY,t[2]=r.panDeltaZ,s.constrainVertical){o.xUp?(i=o.eye[0],n=o.look[0]):o.yUp?(i=o.eye[1],n=o.look[1]):o.zUp&&(i=o.eye[2],n=o.look[2]),o.pan(t);const e=o.eye,s=o.look;o.xUp?(e[0]=i,s[0]=n):o.yUp?(e[1]=i,s[1]=n):o.zUp&&(e[2]=i,s[2]=n),o.eye=e,o.look=s}else o.pan(t);e="grabbing"}if(r.panDeltaX*=s.panInertia,r.panDeltaY*=s.panInertia,r.panDeltaZ*=s.panInertia,0!==d){if(e=d<0?"zoom-in":"zoom-out",s.firstPerson){let t,e;if(s.constrainVertical&&(o.xUp?(t=o.eye[0],e=o.look[0]):o.yUp?(t=o.eye[1],e=o.look[1]):o.zUp&&(t=o.eye[2],e=o.look[2])),s.followPointer){h.dollyToCanvasPos(p,i.pointerCanvasPos,-d)&&(i.followPointerDirty=!0)}else o.pan([0,0,d]),o.ortho.scale=o.ortho.scale-d;if(s.constrainVertical){const s=o.eye,i=o.look;o.xUp?(s[0]=t,i[0]=e):o.yUp?(s[1]=t,i[1]=e):o.zUp&&(s[2]=t,i[2]=e),o.eye=s,o.look=i}}else if(s.planView)if(s.followPointer){h.dollyToCanvasPos(p,i.pointerCanvasPos,-d)&&(i.followPointerDirty=!0)}else o.ortho.scale=o.ortho.scale+d,o.zoom(d);else if(s.followPointer){h.dollyToCanvasPos(p,i.pointerCanvasPos,-d)&&(i.followPointerDirty=!0)}else o.ortho.scale=o.ortho.scale+d,o.zoom(d);r.dollyDelta*=s.dollyInertia}n.fireEvents(),document.body.style.cursor=e}))}destroy(){this._scene.off(this._onTick)}}class rD{constructor(t,e,s,i,r){this._scene=t;const o=this._scene.canvas.canvas;o.addEventListener("mouseenter",this._mouseEnterHandler=()=>{i.mouseover=!0}),o.addEventListener("mouseleave",this._mouseLeaveHandler=()=>{i.mouseover=!1,o.style.cursor=null}),document.addEventListener("mousemove",this._mouseMoveHandler=t=>{oD(t,o,i.pointerCanvasPos)}),o.addEventListener("mousedown",this._mouseDownHandler=t=>{s.active&&s.pointerEnabled&&(oD(t,o,i.pointerCanvasPos),i.mouseover=!0)}),o.addEventListener("mouseup",this._mouseUpHandler=t=>{s.active&&s.pointerEnabled})}reset(){}destroy(){const t=this._scene.canvas.canvas;document.removeEventListener("mousemove",this._mouseMoveHandler),t.removeEventListener("mouseenter",this._mouseEnterHandler),t.removeEventListener("mouseleave",this._mouseLeaveHandler),t.removeEventListener("mousedown",this._mouseDownHandler),t.removeEventListener("mouseup",this._mouseUpHandler)}}function oD(t,e,s){if(t){const{x:i,y:r}=e.getBoundingClientRect();s[0]=t.clientX-i,s[1]=t.clientY-r}else t=window.event,s[0]=t.x,s[1]=t.y;return s}const nD=function(t,e){if(t){let s=t.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;e[0]=t.pageX-i,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e};class aD{constructor(t,e,s,i,r){this._scene=t;const o=e.pickController,n=e.pivotController,a=c.vec2(),h=c.vec2(),l=c.vec2(),u=c.vec2(),p=[],d=this._scene.canvas.canvas;let m=0,f=!1;this._onTick=t.on("tick",(()=>{f=!1})),d.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{if(!s.active||!s.pointerEnabled)return;e.preventDefault();const r=e.touches,h=e.changedTouches;for(i.touchStartTime=Date.now(),1===r.length&&1===h.length&&(i.touchStartTime,nD(r[0],a),s.followPointer&&(o.pickCursorPos=a,o.schedulePickSurface=!0,o.update(),s.planView||(o.picked&&o.pickedSurface&&o.pickResult&&o.pickResult.worldPos?(n.setPivotPos(o.pickResult.worldPos),!s.firstPerson&&n.startPivot()&&n.showPivot()):(s.smartPivot?n.setCanvasPivotPos(i.pointerCanvasPos):n.setPivotPos(t.camera.look),!s.firstPerson&&n.startPivot()&&n.showPivot()))));p.length<r.length;)p.push(c.vec2());for(let t=0,e=r.length;t<e;++t)nD(r[t],p[t]);m=r.length}),d.addEventListener("touchmove",this._canvasTouchMoveHandler=e=>{if(!s.active||!s.pointerEnabled)return;if(e.stopPropagation(),e.preventDefault(),f)return;f=!0;const n=t.canvas.boundary,a=n[2]-n[0],d=n[3]-n[1],g=e.touches;if(e.touches.length===m){if(1===m){nD(g[0],h),c.subVec2(h,p[0],u);const e=u[0],o=u[1];if(null!==i.longTouchTimeout&&(Math.abs(e)>s.longTapRadius||Math.abs(o)>s.longTapRadius)&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),s.planView){const i=t.camera;if("perspective"===i.projection){const n=Math.abs(t.camera.eyeLookDist)*Math.tan(i.perspective.fov/2*Math.PI/180);r.panDeltaX+=e*n/d*s.touchPanRate,r.panDeltaY+=o*n/d*s.touchPanRate}else r.panDeltaX+=.5*i.ortho.scale*(e/d)*s.touchPanRate,r.panDeltaY+=.5*i.ortho.scale*(o/d)*s.touchPanRate}else r.rotateDeltaY-=e/a*(1*s.dragRotationRate),r.rotateDeltaX+=o/d*(1.5*s.dragRotationRate)}else if(2===m){const e=g[0],n=g[1];nD(e,h),nD(n,l);const a=c.geometricMeanVec2(p[0],p[1]),u=c.geometricMeanVec2(h,l),m=c.vec2();c.subVec2(a,u,m);const f=m[0],_=m[1],y=t.camera,v=c.distVec2([e.pageX,e.pageY],[n.pageX,n.pageY]),b=(c.distVec2(p[0],p[1])-v)*s.touchDollyRate;if(r.dollyDelta=b,Math.abs(b)<1)if("perspective"===y.projection){const e=o.pickResult?o.pickResult.worldPos:t.center,i=Math.abs(c.lenVec3(c.subVec3(e,t.camera.eye,[])))*Math.tan(y.perspective.fov/2*Math.PI/180);r.panDeltaX-=f*i/d*s.touchPanRate,r.panDeltaY-=_*i/d*s.touchPanRate}else r.panDeltaX-=.5*y.ortho.scale*(f/d)*s.touchPanRate,r.panDeltaY-=.5*y.ortho.scale*(_/d)*s.touchPanRate;i.pointerCanvasPos=u}for(let t=0;t<m;++t)nD(g[t],p[t])}})}reset(){}destroy(){const t=this._scene.canvas.canvas;t.removeEventListener("touchstart",this._canvasTouchStartHandler),t.removeEventListener("touchmove",this._canvasTouchMoveHandler),this._scene.off(this._onTick)}}const hD=function(t,e){if(t){let s=t.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;e[0]=t.pageX-i,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e};class lD{constructor(t,e,s,i,r){this._scene=t;const o=e.pickController,n=e.cameraControl;let a;const h=[],l=new Float32Array(2);let u=-1,p=-1;const d=this._scene.canvas.canvas,m=s=>{let i;s&&s.worldPos&&(i=s.worldPos);const r=s?s.entity.aabb:t.aabb;if(i){const s=t.camera;c.subVec3(s.eye,s.look,[]),e.cameraFlight.flyTo({aabb:r})}else e.cameraFlight.flyTo({aabb:r})};d.addEventListener("touchstart",this._canvasTouchStartHandler=t=>{if(!s.active||!s.pointerEnabled)return;null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null);const r=t.touches,o=t.changedTouches;if(a=Date.now(),1===r.length&&1===o.length){u=a,hD(r[0],l);const o=l[0],n=l[1],h=r[0].pageX,p=r[0].pageY;i.longTouchTimeout=setTimeout((()=>{e.cameraControl.fire("rightClick",{pagePos:[Math.round(h),Math.round(p)],canvasPos:[Math.round(o),Math.round(n)],event:t},!0),i.longTouchTimeout=null}),s.longTapTimeout)}else u=-1;for(;h.length<r.length;)h.push(new Float32Array(2));for(let t=0,e=r.length;t<e;++t)hD(r[t],h[t]);h.length=r.length},{passive:!0}),d.addEventListener("touchend",this._canvasTouchEndHandler=t=>{if(!s.active||!s.pointerEnabled)return;const e=Date.now(),r=t.touches,a=t.changedTouches,d=n.hasSubs("pickedSurface");null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),0===r.length&&1===a.length&&u>-1&&e-u<150&&(p>-1&&u-p<325?(hD(a[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=d,o.update(),o.pickResult?(n.fire("doublePicked",o.pickResult),o.pickedSurface&&n.fire("doublePickedSurface",o.pickResult),s.doublePickFlyTo&&m(o.pickResult)):(n.fire("doublePickedNothing"),s.doublePickFlyTo&&m()),p=-1):c.distVec2(h[0],l)<4&&(hD(a[0],o.pickCursorPos),o.schedulePickEntity=!0,o.schedulePickSurface=d,o.update(),o.pickResult?(n.fire("picked",o.pickResult),o.pickedSurface&&n.fire("pickedSurface",o.pickResult)):n.fire("pickedNothing"),p=e),u=-1),h.length=r.length;for(let t=0,e=r.length;t<e;++t)h[t][0]=r[t].pageX,h[t][1]=r[t].pageY;t.stopPropagation()},{passive:!0})}reset(){}destroy(){const t=this._scene.canvas.canvas;t.removeEventListener("touchstart",this._canvasTouchStartHandler),t.removeEventListener("touchend",this._canvasTouchEndHandler)}}class uD extends A{constructor(t,e={}){super(t,e),this.PAN_LEFT=0,this.PAN_RIGHT=1,this.PAN_UP=2,this.PAN_DOWN=3,this.PAN_FORWARDS=4,this.PAN_BACKWARDS=5,this.ROTATE_X_POS=6,this.ROTATE_X_NEG=7,this.ROTATE_Y_POS=8,this.ROTATE_Y_NEG=9,this.DOLLY_FORWARDS=10,this.DOLLY_BACKWARDS=11,this.AXIS_VIEW_RIGHT=12,this.AXIS_VIEW_BACK=13,this.AXIS_VIEW_LEFT=14,this.AXIS_VIEW_FRONT=15,this.AXIS_VIEW_TOP=16,this.AXIS_VIEW_BOTTOM=17,this._keyMap={},this.scene.canvas.canvas.oncontextmenu=t=>{t.preventDefault()},this._configs={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04},this._states={pointerCanvasPos:c.vec2(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:c.vec2(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null},this._updates={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0};const s=this.scene;this._controllers={cameraControl:this,pickController:new UM(this,this._configs),pivotController:new zM(s,this._configs),panController:new NM(s),cameraFlight:new eM(this,{duration:.5})},this._handlers=[new rD(this.scene,this._controllers,this._configs,this._states,this._updates),new aD(this.scene,this._controllers,this._configs,this._states,this._updates),new WM(this.scene,this._controllers,this._configs,this._states,this._updates),new JM(this.scene,this._controllers,this._configs,this._states,this._updates),new tD(this.scene,this._controllers,this._configs,this._states,this._updates),new lD(this.scene,this._controllers,this._configs,this._states,this._updates),new eD(this.scene,this._controllers,this._configs,this._states,this._updates)],this._cameraUpdater=new iD(this.scene,this._controllers,this._configs,this._states,this._updates),this.navMode=e.navMode,e.planView&&(this.planView=e.planView),this.constrainVertical=e.constrainVertical,e.keyboardLayout?this.keyboardLayout=e.keyboardLayout:this.keyMap=e.keyMap,this.doublePickFlyTo=e.doublePickFlyTo,this.panRightClick=e.panRightClick,this.active=e.active,this.followPointer=e.followPointer,this.rotationInertia=e.rotationInertia,this.keyboardPanRate=e.keyboardPanRate,this.touchPanRate=e.touchPanRate,this.keyboardRotationRate=e.keyboardRotationRate,this.dragRotationRate=e.dragRotationRate,this.touchDollyRate=e.touchDollyRate,this.dollyInertia=e.dollyInertia,this.dollyProximityThreshold=e.dollyProximityThreshold,this.dollyMinSpeed=e.dollyMinSpeed,this.panInertia=e.panInertia,this.pointerEnabled=!0,this.keyboardDollyRate=e.keyboardDollyRate,this.mouseWheelDollyRate=e.mouseWheelDollyRate}set keyMap(t){if(t=t||"qwerty",_.isString(t)){const e=this.scene.input,s={};switch(t){default:this.error("Unsupported value for 'keyMap': "+t+" defaulting to 'qwerty'");case"qwerty":s[this.PAN_LEFT]=[e.KEY_A],s[this.PAN_RIGHT]=[e.KEY_D],s[this.PAN_UP]=[e.KEY_Z],s[this.PAN_DOWN]=[e.KEY_X],s[this.PAN_BACKWARDS]=[],s[this.PAN_FORWARDS]=[],s[this.DOLLY_FORWARDS]=[e.KEY_W,e.KEY_ADD],s[this.DOLLY_BACKWARDS]=[e.KEY_S,e.KEY_SUBTRACT],s[this.ROTATE_X_POS]=[e.KEY_DOWN_ARROW],s[this.ROTATE_X_NEG]=[e.KEY_UP_ARROW],s[this.ROTATE_Y_POS]=[e.KEY_Q,e.KEY_LEFT_ARROW],s[this.ROTATE_Y_NEG]=[e.KEY_E,e.KEY_RIGHT_ARROW],s[this.AXIS_VIEW_RIGHT]=[e.KEY_NUM_1],s[this.AXIS_VIEW_BACK]=[e.KEY_NUM_2],s[this.AXIS_VIEW_LEFT]=[e.KEY_NUM_3],s[this.AXIS_VIEW_FRONT]=[e.KEY_NUM_4],s[this.AXIS_VIEW_TOP]=[e.KEY_NUM_5],s[this.AXIS_VIEW_BOTTOM]=[e.KEY_NUM_6];break;case"azerty":s[this.PAN_LEFT]=[e.KEY_Q],s[this.PAN_RIGHT]=[e.KEY_D],s[this.PAN_UP]=[e.KEY_W],s[this.PAN_DOWN]=[e.KEY_X],s[this.PAN_BACKWARDS]=[],s[this.PAN_FORWARDS]=[],s[this.DOLLY_FORWARDS]=[e.KEY_Z,e.KEY_ADD],s[this.DOLLY_BACKWARDS]=[e.KEY_S,e.KEY_SUBTRACT],s[this.ROTATE_X_POS]=[e.KEY_DOWN_ARROW],s[this.ROTATE_X_NEG]=[e.KEY_UP_ARROW],s[this.ROTATE_Y_POS]=[e.KEY_A,e.KEY_LEFT_ARROW],s[this.ROTATE_Y_NEG]=[e.KEY_E,e.KEY_RIGHT_ARROW],s[this.AXIS_VIEW_RIGHT]=[e.KEY_NUM_1],s[this.AXIS_VIEW_BACK]=[e.KEY_NUM_2],s[this.AXIS_VIEW_LEFT]=[e.KEY_NUM_3],s[this.AXIS_VIEW_FRONT]=[e.KEY_NUM_4],s[this.AXIS_VIEW_TOP]=[e.KEY_NUM_5],s[this.AXIS_VIEW_BOTTOM]=[e.KEY_NUM_6]}this._keyMap=s}else{const e=t;this._keyMap=e}}get keyMap(){return this._keyMap}_isKeyDownForAction(t,e){const s=this._keyMap[t];if(!s)return!1;e||(e=this.scene.input.keyDown);for(let t=0,i=s.length;t<i;t++){if(e[s[t]])return!0}return!1}set pivotElement(t){this._controllers.pivotController.setPivotElement(t)}set active(t){this._configs.active=!1!==t}get active(){return this._configs.active}set navMode(t){"firstPerson"!==(t=t||"orbit")&&"orbit"!==t&&"planView"!==t&&(this.error("Unsupported value for navMode: "+t+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),t="orbit"),this._configs.firstPerson="firstPerson"===t,this._configs.planView="planView"===t,(this._configs.firstPerson||this._configs.planView)&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this._configs.navMode=t}get navMode(){return this._configs.navMode}set pointerEnabled(t){this._reset(),this._configs.pointerEnabled=!!t}_reset(){for(let t=0,e=this._handlers.length;t<e;t++){const e=this._handlers[t];e.reset&&e.reset()}this._updates.panDeltaX=0,this._updates.panDeltaY=0,this._updates.rotateDeltaX=0,this._updates.rotateDeltaY=0,this._updates.dolyDelta=0}get pointerEnabled(){return this._configs.pointerEnabled}set followPointer(t){this._configs.followPointer=!1!==t}get followPointer(){return this._configs.followPointer}set pivotPos(t){this._controllers.pivotController.setPivotPos(t)}get pivotPos(){return this._controllers.pivotController.getPivotPos()}set dollyToPointer(t){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=t}get dollyToPointer(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer}set panToPointer(t){this.warn("panToPointer property is deprecated - replaced with followPointer")}get panToPointer(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1}set planView(t){this._configs.planView=!!t,this._configs.firstPerson=!1,this._configs.planView&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}get planView(){return this.warn("planView property is deprecated - replaced with navMode"),this._configs.planView}set firstPerson(t){this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson=!!t,this._configs.planView=!1,this._configs.firstPerson&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot())}get firstPerson(){return this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson}set constrainVertical(t){this._configs.constrainVertical=!!t}get constrainVertical(){return this._configs.constrainVertical}set doublePickFlyTo(t){this._configs.doublePickFlyTo=!1!==t}get doublePickFlyTo(){return this._configs.doublePickFlyTo}set panRightClick(t){this._configs.panRightClick=!1!==t}get panRightClick(){return this._configs.panRightClick}set rotationInertia(t){this._configs.rotationInertia=null!=t?t:0}get rotationInertia(){return this._configs.rotationInertia}set keyboardPanRate(t){this._configs.keyboardPanRate=null!=t?t:5}set touchPanRate(t){this._configs.touchPanRate=null!=t?t:1}get touchPanRate(){return this._configs.touchPanRate}get keyboardPanRate(){return this._configs.keyboardPanRate}set keyboardRotationRate(t){this._configs.keyboardRotationRate=null!=t?t:90}get keyboardRotationRate(){return this._configs.keyboardRotationRate}set dragRotationRate(t){this._configs.dragRotationRate=null!=t?t:360}get dragRotationRate(){return this._configs.dragRotationRate}set keyboardDollyRate(t){this._configs.keyboardDollyRate=null!=t?t:15}get keyboardDollyRate(){return this._configs.keyboardDollyRate}set touchDollyRate(t){this._configs.touchDollyRate=null!=t?t:.2}get touchDollyRate(){return this._configs.touchDollyRate}set mouseWheelDollyRate(t){this._configs.mouseWheelDollyRate=null!=t?t:100}get mouseWheelDollyRate(){return this._configs.mouseWheelDollyRate}set dollyInertia(t){this._configs.dollyInertia=null!=t?t:0}get dollyInertia(){return this._configs.dollyInertia}set dollyProximityThreshold(t){this._configs.dollyProximityThreshold=null!=t?t:35}get dollyProximityThreshold(){return this._configs.dollyProximityThreshold}set dollyMinSpeed(t){this._configs.dollyMinSpeed=null!=t?t:.04}get dollyMinSpeed(){return this._configs.dollyMinSpeed}set panInertia(t){this._configs.panInertia=null!=t?t:.5}get panInertia(){return this._configs.panInertia}set keyboardLayout(t){"qwerty"!==(t=t||"qwerty")&&"azerty"!==t&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),t="qwerty"),this._configs.keyboardLayout=t,this.keyMap=this._configs.keyboardLayout}get keyboardLayout(){return this._configs.keyboardLayout}set smartPivot(t){this._configs.smartPivot=!1!==t}get smartPivot(){return this._configs.smartPivot}destroy(){this._destroyHandlers(),this._destroyControllers(),this._cameraUpdater.destroy(),super.destroy()}_destroyHandlers(){for(let t=0,e=this._handlers.length;t<e;t++){const e=this._handlers[t];e.destroy&&e.destroy()}}_destroyControllers(){for(let t=0,e=this._controllers.length;t<e;t++){const e=this._controllers[t];e.destroy&&e.destroy()}}}class pD{constructor(t,e,s,i,r,o,n,a,h,l){this.id=e,this.projectId=s,this.revisionId=i,this.author=r,this.createdAt=o,this.creatingApplication=n,this.schema=a,this.metaScene=t,this.propertySets=h,this.rootMetaObject=l}getJSON(){const t=[];!function e(s){const i={id:s.id,extId:s.extId,type:s.type,name:s.name};s.parent&&(i.parent=s.parent.id),t.push(i);const r=s.children;if(r)for(let t=0,s=r.length;t<s;t++)e(r[t])}(this.rootMetaObject);return{id:this.id,projectId:this.projectId,revisionId:this.revisionId,metaObjects:t}}}class cD{constructor(t,e,s,i,r,o,n,a,h){this.metaModel=t,this.id=e,this.originalSystemId=s,this.name=i,this.type=r,this.propertySets=o,null!=n&&(this.parent=n),null!=a&&(this.children=a),null!=h&&(this.external=h)}getObjectIDsInSubtree(){const t=[];return function e(s){if(!s)return;t.push(s.id);const i=s.children;if(i)for(var r=0,o=i.length;r<o;r++)e(i[r])}(this),t}withMetaObjectsInSubtree(t){!function e(s){if(!s)return;t(s);const i=s.children;if(i)for(var r=0,o=i.length;r<o;r++)e(i[r])}(this)}getObjectIDsInSubtreeByType(t){const e={};for(var s=0,i=t.length;s<i;s++)e[t[s]]=t[s];const r=[];return function t(s){if(!s)return;e[s.type]&&r.push(s.id);const i=s.children;if(i)for(var o=0,n=i.length;o<n;o++)t(i[o])}(this),r}getJSON(){var t={id:this.id,type:this.type,name:this.name};return this.parent&&(t.parent=this.parent.id),t}}class dD{constructor(t,e,s,i,r){this.name=t,this.type=s,this.value=e,this.valueType=i,this.description=r}}class mD{constructor(t,e,s,i,r){if(this.id=t,this.originalSystemId=e,this.name=s,this.type=i,this.properties=[],r)for(let t=0,e=r.length;t<e;t++){const e=r[t];this.properties.push(new dD(e.name,e.value,e.type,e.valueType,e.description))}}}class fD{constructor(t,e){this.viewer=t,this.scene=e,this.metaModels={},this.propertySets={},this.metaObjects={},this.metaObjectsByType={},this._typeCounts={},this._eventSubs={}}on(t,e){let s=this._eventSubs[t];s||(s=[],this._eventSubs[t]=s),s.push(e)}fire(t,e){const s=this._eventSubs[t];if(s)for(let t=0,i=s.length;t<i;t++)s[t](e)}off(t){}createMetaModel(t,e,s={}){const i=e.projectId||"none",r=e.revisionId||"none",o=e.propertySets||[],n=e.metaObjects||[],a=e.author,h=e.createdAt,l=e.creatingApplication,u=e.schema,p=new pD(this,t,i,r,a,h,l,u,[],null);this.metaModels[t]=p;for(let t=0,e=o.length;t<e;t++){const e=o[t],s=e.id,i=new mD(s,e.originalSystemId,e.name,e.type,e.properties);p.propertySets[s]=i,this.propertySets[s]=i}const d=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];void 0!==e.parent&&null!==e.parent||d.push(e)}if(0===d.length){this.scene.error("Cyclic containment hierarchy found in metamodel - will flatten the hierarchy and insert fake 'Model' root");const e={id:t+".fakeRoot",name:t,type:"Model",parent:null};for(let t=0,s=n.length;t<s;t++)n[t].parent=e.id;n.push(e)}if(d.length>1){this.scene.error("Multiple containment hierarchy root found in metamodel - will insert fake 'Model' root");const e={id:t+".fakeRoot",name:t,type:"Model",parent:null};n.push(e);for(let t=0,s=d.length;t<s;t++)d[t].parent=e.id}for(let e=0,i=n.length;e<i;e++){const i=n[e],r=i.type,o=s.globalizeObjectIds?c.globalizeObjectId(t,i.id):i.id,a=i.id,h=i.name,l=[];if(i.propertySetIds&&i.propertySetIds.length>0)for(let t=0,e=i.propertySetIds.length;t<e;t++){const e=i.propertySetIds[t],s=p.propertySets[e];s&&l.push(s)}const u=null,d=null,m=i.external,f=new cD(p,o,a,h,r,l,u,d,m);this.metaObjects[o]=f,(this.metaObjectsByType[r]||(this.metaObjectsByType[r]={}))[o]=f,void 0===this._typeCounts[r]?this._typeCounts[r]=1:this._typeCounts[r]++}for(let e=0,i=n.length;e<i;e++){const i=n[e],r=s.globalizeObjectIds?c.globalizeObjectId(t,i.id):i.id,o=this.metaObjects[r];if(o)if(void 0===i.parent||null===i.parent)p.rootMetaObject=o;else if(i.parent){const e=s.globalizeObjectIds?c.globalizeObjectId(t,i.parent):i.parent;let r=this.metaObjects[e];r&&(o.parent=r,r.children=r.children||[],r.children.push(o))}}return this.fire("metaModelCreated",t),p}destroyMetaModel(t){const e=this.metaModels[t];e&&(this._removeMetaModel(e),this.fire("metaModelDestroyed",t))}_removeMetaModel(t){const e=this.metaObjects,s=this.metaObjectsByType;let i=t=>{delete e[t.id];const r=s[t.type];r&&r[t.id]&&(delete r[t.id],0==--this._typeCounts[t.type]&&(delete this._typeCounts[t.type],delete s[t.type]));const o=t.children;if(o)for(let t=0,e=o.length;t<e;t++){const e=o[t];i(e)}};i(t.rootMetaObject);for(let e in t.propertySets)t.propertySets.hasOwnProperty(e)&&delete this.propertySets[e];delete this.metaModels[t.id]}getObjectIDsByType(t){const e=this.metaObjectsByType[t];return e?Object.keys(e):[]}getObjectIDsInSubtree(t,e,s){const i=[],r=this.metaObjects[t],o=e&&e.length>0?gD(e):null,n=s&&s.length>0?gD(s):null;return function t(e){if(!e)return;var s=!0;(n&&n[e.type]||o&&!o[e.type])&&(s=!1),s&&i.push(e.id);const r=e.children;if(r)for(var a=0,h=r.length;a<h;a++)t(r[a])}(r),i}withMetaObjectsInSubtree(t,e){const s=this.metaObjects[t];s&&s.withMetaObjectsInSubtree(e)}}function gD(t){const e={};for(var s=0,i=t.length;s<i;s++)e[t[s]]=!0;return e}class _D{constructor(t){this.language="en",this.localeService=t.localeService||new zx,this.scene=new Ve(this,{canvasId:t.canvasId,canvasElement:t.canvasElement,keyboardEventsElement:t.keyboardEventsElement,webgl2:!1,contextAttr:{preserveDrawingBuffer:!1!==t.preserveDrawingBuffer,premultipliedAlpha:!!t.premultipliedAlpha,antialias:!1!==t.antialias},spinnerElementId:t.spinnerElementId,transparent:!1!==t.transparent,gammaInput:!0,gammaOutput:!1,backgroundColor:t.backgroundColor,backgroundColorFromAmbientLight:t.backgroundColorFromAmbientLight,ticksPerRender:1,ticksPerOcclusionTest:20,units:t.units,scale:t.scale,origin:t.origin,saoEnabled:t.saoEnabled,alphaDepthMask:!1!==t.alphaDepthMask,entityOffsetsEnabled:!!t.entityOffsetsEnabled,pickSurfacePrecisionEnabled:!!t.pickSurfacePrecisionEnabled,logarithmicDepthBufferEnabled:!!t.logarithmicDepthBufferEnabled,pbrEnabled:!!t.pbrEnabled}),this.metaScene=new fD(this,this.scene),this.id=t.id||this.scene.id,this.camera=this.scene.camera,this.cameraFlight=new eM(this.scene,{duration:.5}),this.cameraControl=new uD(this.scene,{doublePickFlyTo:!0}),this._plugins=[],this._eventSubs={}}on(t,e){let s=this._eventSubs[t];s||(s=[],this._eventSubs[t]=s),s.push(e)}fire(t,e){const s=this._eventSubs[t];if(s)for(let t=0,i=s.length;t<i;t++)s[t](e)}off(t){}log(t){console.log(`[xeokit viewer ${this.id}]: ${t}`)}error(t){console.error(`[xeokit viewer ${this.id}]: ${t}`)}addPlugin(t){this._plugins.push(t)}removePlugin(t){for(let e=0,s=this._plugins.length;e<s;e++){const s=this._plugins[e];if(s===t)return s.clear&&s.clear(),void this._plugins.splice(e,1)}}sendToPlugins(t,e){for(let s=0,i=this._plugins.length;s<i;s++){const i=this._plugins[s];i.send&&i.send(t,e)}}clear(){throw'Viewer#clear() no longer implemented - use \'#sendToPlugins("clear") instead'}resetView(){throw"Viewer#resetView() no longer implemented - use CameraMemento & ObjectsMemento classes instead"}beginSnapshot(){this._snapshotBegun||(this.scene._renderer.beginSnapshot(),this._snapshotBegun=!0)}getSnapshot(t={}){const e=!this._snapshotBegun;this._snapshotBegun||this.beginSnapshot(),t.includeGizmos||this.sendToPlugins("snapshotStarting");const s=void 0!==t.width&&void 0!==t.height,i=this.scene.canvas.canvas,r=i.clientWidth,o=i.clientHeight,n=i.style.width,a=i.style.height,h=t.width?Math.floor(t.width):i.width,l=t.height?Math.floor(t.height):i.height;s&&(i.style.width=h+"px",i.style.height=l+"px"),this.scene._renderer.renderSnapshot();const u=this.scene._renderer.readSnapshot(t);return s&&(i.style.width=n,i.style.height=a,i.width=r,i.height=o,this.scene.glRedraw()),t.includeGizmos||this.sendToPlugins("snapshotFinished"),e&&this.endSnapshot(),u}endSnapshot(){this._snapshotBegun&&(this.scene._renderer.endSnapshot(),this.scene._renderer.render({force:!0}),this._snapshotBegun=!1)}destroy(){const t=this._plugins.slice();for(let e=0,s=t.length;e<s;e++){t[e].destroy()}this.scene.destroy()}}class yD{constructor(){}set doublePrecisionEnabled(t){c.setDoublePrecisionEnabled(t)}get doublePrecisionEnabled(){return c.getDoublePrecisionEnabled()}set rafEnabled(t){I.setRAFEnabled(t)}get rafEnabled(){return I.getRAFEnabled()}}class vD extends n{constructor(t,e={}){super("ifcLoader",t,e),this._maxGeometryBatchSize=e.maxGeometryBatchSize,this.dataSource=e.dataSource,this.objectDefaults=e.objectDefaults,this.includeTypes=e.includeTypes,this.excludeTypes=e.excludeTypes,this.excludeUnclassifiedObjects=e.excludeUnclassifiedObjects,this._ifcAPI=new class{constructor(){this.wasmModule=void 0,this.fs=void 0,this.wasmPath="",this.ifcGuidMap=new Map}Init(t){return e=this,s=null,i=function*(){if(Hx){let e=(t,e)=>t.endsWith(".wasm")?e+this.wasmPath+t:e+t;this.wasmModule=yield Hx({noInitialRun:!0,locateFile:t||e}),this.fs=this.wasmModule.FS}else console.error("Could not find wasm module at './web-ifc' from web-ifc-api.ts")},new Promise(((t,r)=>{var o=t=>{try{a(i.next(t))}catch(t){r(t)}},n=t=>{try{a(i.throw(t))}catch(t){r(t)}},a=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,n);a((i=i.apply(e,s)).next())}));var e,s,i}OpenModel(t,e){this.wasmModule.FS_createDataFile("/","filename",t,!0,!0,!0);let s=El({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},e),i=this.wasmModule.OpenModel(s);return this.wasmModule.FS_unlink("/filename"),i}CreateModel(t){let e=El({COORDINATE_TO_ORIGIN:!1,USE_FAST_BOOLS:!1,CIRCLE_SEGMENTS_LOW:5,CIRCLE_SEGMENTS_MEDIUM:8,CIRCLE_SEGMENTS_HIGH:12,BOOL_ABORT_THRESHOLD:1e4},t);return this.wasmModule.CreateModel(e)}ExportFileAsIFC(t){this.wasmModule.ExportFileAsIFC(t);let e=this.fs.readFile("/export.ifc");return this.wasmModule.FS_unlink("/export.ifc"),e}GetGeometry(t,e){return this.wasmModule.GetGeometry(t,e)}GetLine(t,e,s=!1){let i=this.GetRawLineData(t,e),r=Ol[i.type](i);return s&&this.FlattenLine(t,r),r}GetAndClearErrors(t){return this.wasmModule.GetAndClearErrors(t)}WriteLine(t,e){Object.keys(e).forEach((s=>{let i=e[s];if(i&&void 0!==i.expressID)this.WriteLine(t,i),e[s]={type:5,value:i.expressID};else if(Array.isArray(i)&&i.length>0)for(let r=0;r<i.length;r++)void 0!==i[r].expressID&&(this.WriteLine(t,i[r]),e[s][r]={type:5,value:i[r].expressID})}));let s={ID:e.expressID,type:e.type,arguments:e.ToTape()};this.WriteRawLineData(t,s)}FlattenLine(t,e){Object.keys(e).forEach((s=>{let i=e[s];if(i&&5===i.type)e[s]=this.GetLine(t,i.value,!0);else if(Array.isArray(i)&&i.length>0&&5===i[0].type)for(let r=0;r<i.length;r++)e[s][r]=this.GetLine(t,i[r].value,!0)}))}GetRawLineData(t,e){return this.wasmModule.GetLine(t,e)}WriteRawLineData(t,e){return this.wasmModule.WriteLine(t,e.ID,e.type,e.arguments)}GetLineIDsWithType(t,e){return this.wasmModule.GetLineIDsWithType(t,e)}GetAllLines(t){return this.wasmModule.GetAllLines(t)}SetGeometryTransformation(t,e){16==e.length?this.wasmModule.SetGeometryTransformation(t,e):console.log(`Bad transformation matrix size: ${e.length}`)}GetCoordinationMatrix(t){return this.wasmModule.GetCoordinationMatrix(t)}GetVertexArray(t,e){return this.getSubArray(this.wasmModule.HEAPF32,t,e)}GetIndexArray(t,e){return this.getSubArray(this.wasmModule.HEAPU32,t,e)}getSubArray(t,e,s){return t.subarray(e/4,e/4+s).slice(0)}CloseModel(t){this.ifcGuidMap.delete(t),this.wasmModule.CloseModel(t)}StreamAllMeshes(t,e){this.wasmModule.StreamAllMeshes(t,e)}StreamAllMeshesWithTypes(t,e,s){this.wasmModule.StreamAllMeshesWithTypes(t,e,s)}IsModelOpen(t){return this.wasmModule.IsModelOpen(t)}LoadAllGeometry(t){return this.wasmModule.LoadAllGeometry(t)}GetFlatMesh(t,e){return this.wasmModule.GetFlatMesh(t,e)}CreateIfcGuidToExpressIdMapping(t){const e=new Map;for(let s=0;s<Fl.length;s++){const i=Fl[s],r=this.GetLineIDsWithType(t,i),o=r.size();for(let s=0;s<o;s++){const i=r.get(s),o=this.GetLine(t,i).GlobalId.value;e.set(i,o),e.set(o,i)}}this.ifcGuidMap.set(t,e)}SetWasmPath(t){this.wasmPath=t}},e.wasmPath&&this._ifcAPI.SetWasmPath(e.wasmPath),this._ifcAPI.Init().then((()=>{this.fire("initialized",!0,!1)})).catch((t=>{this.error(t)}))}get supportedVersions(){return["2x3","4"]}get dataSource(){return this._dataSource}set dataSource(t){this._dataSource=t||new Vx}get objectDefaults(){return this._objectDefaults}set objectDefaults(t){this._objectDefaults=t||xa}get includeTypes(){return this._includeTypes}set includeTypes(t){this._includeTypes=t}get excludeTypes(){return this._excludeTypes}set excludeTypes(t){this._excludeTypes=t}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(t){this._excludeUnclassifiedObjects=!!t}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(t){this._globalizeObjectIds=!!t}load(t={}){t.id&&this.viewer.scene.components[t.id]&&(this.error("Component with this ID already exists in viewer: "+t.id+" - will autogenerate this ID"),delete t.id);const e=new Vn(this.viewer.scene,_.apply(t,{isModel:!0,maxGeometryBatchSize:this._maxGeometryBatchSize}));if(!t.src&&!t.ifc)return this.error("load() param expected: src or IFC"),e;const s={autoNormals:!0};if(!1!==t.loadMetadata){const e=t.includeTypes||this._includeTypes,i=t.excludeTypes||this._excludeTypes,r=t.objectDefaults||this._objectDefaults;if(e){s.includeTypesMap={};for(let t=0,i=e.length;t<i;t++)s.includeTypesMap[e[t]]=!0}if(i){s.excludeTypesMap={};for(let t=0,e=i.length;t<e;t++)s.excludeTypesMap[i[t]]=!0}r&&(s.objectDefaults=r),s.excludeUnclassifiedObjects=void 0!==t.excludeUnclassifiedObjects?!!t.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,s.globalizeObjectIds=void 0!==t.globalizeObjectIds?!!t.globalizeObjectIds:this._globalizeObjectIds}return this.on("initialized",(()=>{t.src?this._loadModel(t.src,t,s,e):this._parseModel(t.ifc,t,s,e)})),e}_loadModel(t,e,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getIFC(e.src,(t=>{this._parseModel(t,e,s,i),r.processes--}),(t=>{r.processes--,this.error(t),i.fire("error",t)}))}_parseModel(t,e,s,i){if(i.destroyed)return;const r=e.stats||{};r.sourceFormat="IFC",r.schemaVersion="",r.title="",r.author="",r.created="",r.numMetaObjects=0,r.numPropertySets=0,r.numObjects=0,r.numGeometries=0,r.numTriangles=0,r.numVertices=0,s.wasmPath&&this._ifcAPI.SetWasmPath(s.wasmPath);const o=new Uint8Array(t),n=this._ifcAPI.OpenModel(o),a=this._ifcAPI.GetLineIDsWithType(n,103090709).get(0),h=!1!==e.loadMetadata,l={modelID:n,performanceModel:i,loadMetadata:h,metaData:h?{id:"1601",projectId:""+a,author:"",createdAt:"2017-01-19T01:36:20",schema:"IFC2X3",creatingApplication:"20161117_1200(x64) - Exporter 17.2.0.0 - Interface alternative d'export 17.2.0.0",metaObjects:[],propertySets:[]}:null,metaObjects:{},options:s,log:function(t){},nextId:0,stats:r};if(h){if(s.includeTypes){l.includeTypes={};for(let t=0,e=s.includeTypes.length;t<e;t++)l.includeTypes[s.includeTypes[t]]=!0}if(s.excludeTypes){l.excludeTypes={};for(let t=0,e=s.excludeTypes.length;t<e;t++)l.excludeTypes[s.excludeTypes[t]]=!0}this._parseMetaObjects(l),this._parsePropertySets(l)}if(this._parseGeometry(l),i.finalize(),h){const t=i.id;this.viewer.metaScene.createMetaModel(t,l.metaData,s)}i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_parseMetaObjects(t){const e=this._ifcAPI.GetLineIDsWithType(t.modelID,103090709).get(0),s=this._ifcAPI.GetLine(t.modelID,e);this._parseSpatialChildren(t,s)}_parseSpatialChildren(t,e,s){const i=e.__proto__.constructor.name;if(t.includeTypes&&!t.includeTypes[i])return;if(t.excludeTypes&&t.excludeTypes[i])return;this._createMetaObject(t,e,s);const r=e.GlobalId.value;this._parseRelatedItemsOfType(t,e.expressID,"RelatingObject","RelatedObjects",160246688,r),this._parseRelatedItemsOfType(t,e.expressID,"RelatingStructure","RelatedElements",3242617779,r)}_createMetaObject(t,e,s){const i=e.GlobalId.value,r=e.__proto__.constructor.name,o={id:i,name:r,type:e.Name&&""!==e.Name.value?e.Name.value:r,parent:s};t.metaData.metaObjects.push(o),t.metaObjects[i]=o,t.stats.numMetaObjects++}_parseRelatedItemsOfType(t,e,s,i,r,o){const n=this._ifcAPI.GetLineIDsWithType(t.modelID,r);for(let r=0;r<n.size();r++){const a=n.get(r),h=this._ifcAPI.GetLine(t.modelID,a),l=h[s];let u=!1;if(Array.isArray(l)){u=l.map((t=>t.value)).includes(e)}else u=l.value===e;if(u){const e=h[i];if(Array.isArray(e))e.forEach((e=>{const s=this._ifcAPI.GetLine(t.modelID,e.value);this._parseSpatialChildren(t,s,o)}));else{const s=this._ifcAPI.GetLine(t.modelID,e.value);this._parseSpatialChildren(t,s,o)}}}}_parsePropertySets(t){const e=this._ifcAPI.GetLineIDsWithType(t.modelID,4186316022);for(let s=0;s<e.size();s++){let i=e.get(s),r=this._ifcAPI.GetLine(t.modelID,i,!0);if(r){const e=r.RelatingPropertyDefinition;if(!e)continue;const s=e.GlobalId.value,i=e.HasProperties;if(i&&i.length>0){const o="Default",n=e.Name.value,a=[];for(let t=0,e=i.length;t<e;t++){const e=i[t],s=e.Name,r=e.NominalValue;if(s&&r){const t={name:s.value,type:r.type,value:r.value,valueType:r.valueType};e.Description?t.description=e.Description.value:r.description&&(t.description=r.description),a.push(t)}}const h={id:s,type:o,name:n,properties:a};t.metaData.propertySets.push(h),t.stats.numPropertySets++;const l=r.RelatedObjects;if(!l||0===l.length)for(let e=0,i=l.length;e<i;e++){const i=l[e].GlobalId.value,r=t.metaObjects[i];r&&(r.propertySetIds||(r.propertySetIds=[]),r.propertySetIds.push(s))}}}}}_parseGeometry(t){this._ifcAPI.StreamAllMeshes(t.modelID,(e=>{const s=e.expressID,i=e.geometries,r=[],o=this._ifcAPI.GetLine(t.modelID,s).GlobalId.value;if(t.loadMetadata){const e=o,s=t.metaObjects[e];if(t.includeTypes&&(!s||!t.includeTypes[s.type]))return;if(t.excludeTypes&&(!s||t.excludeTypes[s.type]))return}const n=c.mat4(),a=c.vec3();for(let e=0,s=i.size();e<s;e++){const s=i.get(e),o=this._ifcAPI.GetGeometry(t.modelID,s.geometryExpressID),h=this._ifcAPI.GetVertexArray(o.GetVertexData(),o.GetVertexDataSize()),l=this._ifcAPI.GetIndexArray(o.GetIndexData(),o.GetIndexDataSize()),u=[],p=[];for(let t=0,e=h.length/6;t<e;t++)u.push(h[6*t+0]),u.push(h[6*t+1]),u.push(h[6*t+2]);n.set(s.flatTransformation),c.transformPositions3(n,u);const d=W(u,u,a);if(!t.options.autoNormals)for(let t=0,e=h.length/6;t<e;t++)p.push(h[6*t+3]),p.push(h[6*t+4]),p.push(h[6*t+5]);t.stats.numGeometries++,t.stats.numVertices+=u.length/3,t.stats.numTriangles+=l.length/3;const m="mesh"+t.nextId++;t.performanceModel.createMesh({id:m,primitive:"triangles",origin:d?a:null,positions:u,normals:t.options.autoNormals?null:p,indices:l,color:[s.color.x,s.color.y,s.color.z],opacity:s.color.w}),r.push(m)}const h=t.options.globalizeObjectIds?c.globalizeObjectId(t.performanceModel.id,o):o;t.performanceModel.createEntity({id:h,meshIds:r,isObject:!0}),t.stats.numObjects++}))}}export{ue as AmbientLight,rt as AngleMeasurementsPlugin,lt as AnnotationsPlugin,js as AxisGizmoPlugin,Vs as BCFViewpointsPlugin,hh as CameraMemento,Zx as CameraPath,sM as CameraPathAnimation,A as Component,yD as Configs,o as ContextMenu,MM as CubicBezierCurve,Wx as Curve,le as DirLight,$s as DistanceMeasurementsPlugin,Oe as EdgeMaterial,Ce as EmphasisMaterial,Qs as FastNavPlugin,PM as Fresnel,ti as GLTFDefaultDataSource,Ma as GLTFLoaderPlugin,vD as IFCLoaderPlugin,dM as ImagePlane,nl as LambertMaterial,bM as LightMap,zx as LocaleService,t as Map,q as Marker,Os as Mesh,na as MetallicMaterial,xM as ModelMemento,Ea as NavCubePlugin,Qn as Node,Na as OBJLoaderPlugin,ah as ObjectsMemento,DM as Path,Vn as PerformanceModel,Se as PhongMaterial,n as Plugin,mM as PointLight,EM as QuadraticBezierCurve,d as Queue,xe as ReadableGeometry,vM as ReflectionMap,Ka as STLDefaultDataSource,ih as STLLoaderPlugin,Gs as SectionPlane,Xa as SectionPlanesPlugin,Wa as Skybox,Ya as SkyboxesPlugin,la as SpecularMaterial,Yx as SplineCurve,TM as SpriteMarker,ch as StoreyViewsPlugin,_a as Texture,_h as TreeViewPlugin,ia as VBOGeometry,Dh as ViewCullPlugin,_D as Viewer,Eh as XKTDefaultDataSource,ol as XKTLoaderPlugin,Pl as XML3DLoaderPlugin,Me as buildBoxGeometry,nM as buildBoxLinesGeometry,Ls as buildCylinderGeometry,aM as buildGridGeometry,hM as buildPlaneGeometry,Ns as buildSphereGeometry,Ba as buildTorusGeometry,ks as buildVectorTextGeometry,rM as load3DSGeometry,oM as loadOBJGeometry,c as math,_ as utils};
