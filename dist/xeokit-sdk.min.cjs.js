/**
 * xeokit-sdk v2.6.90-renderers-refactor-v6
 *  Commit: de3093b72ade98201241d223bf55cb0d481bda3d
 *  Built: 2025-09-12T19:48:44.506Z
 */

"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e{constructor(e,t){this.items=e||[],this._lastUniqueId=(t||0)+1}addItem(){let e;if(2===arguments.length){const t=arguments[0];if(e=arguments[1],this.items[t])throw"ID clash: '"+t+"'";return this.items[t]=e,t}for(e=arguments[0]||{};;){const t=this._lastUniqueId++;if(!this.items[t])return this.items[t]=e,t}}removeItem(e){const t=this.items[e];return delete this.items[e],t}}const t=new e;class s{constructor(e){this.id=e,this.parentItem=null,this.groups=[],this.menuElement=null,this.shown=!1,this.mouseOver=0}}class i{constructor(){this.items=[]}}class r{constructor(e,t,s,i,r){this.id=e,this.getTitle=t,this.doAction=s,this.getEnabled=i,this.getShown=r,this.itemElement=null,this.subMenu=null,this.enabled=!0}}let n=!0,A=n?Float64Array:Float32Array;const o=new A(3),a=new A(16),l=new A(16),c=new A(4),h={setDoublePrecisionEnabled(e){n=e,A=n?Float64Array:Float32Array},getDoublePrecisionEnabled:()=>n,MIN_DOUBLE:-Number.MAX_SAFE_INTEGER,MAX_DOUBLE:Number.MAX_SAFE_INTEGER,MAX_INT:1e7,DEGTORAD:.0174532925,RADTODEG:57.295779513,unglobalizeObjectId(e,t){const s=t.indexOf("#");return s===e.length&&t.startsWith(e)?t.substring(s+1):t},globalizeObjectId:(e,t)=>e+"#"+t,safeInv(e){const t=1/e;return isNaN(t)||!isFinite(t)?1:t},vec2:e=>new A(e||2),vec3:e=>new A(e||3),vec4:e=>new A(e||4),mat3:e=>new A(e||9),mat3ToMat4:(e,t=new A(16))=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=0,t[4]=e[3],t[5]=e[4],t[6]=e[5],t[7]=0,t[8]=e[6],t[9]=e[7],t[10]=e[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t),mat4:e=>new A(e||16),mat4ToMat3:(e,t=new A(9))=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t),doublesToFloats(e,t,s){const i=new A(2);for(let r=0,n=e.length;r<n;r++)h.splitDouble(e[r],i),t[r]=i[0],s[r]=i[1]},splitDouble(e,t){const s=A.from([e])[0],i=e-s;t[0]=s,t[1]=i},createUUID:(()=>{const e=[];for(let t=0;t<256;t++)e[t]=(t<16?"0":"")+t.toString(16);return()=>{const t=4294967295*Math.random()|0,s=4294967295*Math.random()|0,i=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return`${e[255&t]+e[t>>8&255]+e[t>>16&255]+e[t>>24&255]}-${e[255&s]}${e[s>>8&255]}-${e[s>>16&15|64]}${e[s>>24&255]}-${e[63&i|128]}${e[i>>8&255]}-${e[i>>16&255]}${e[i>>24&255]}${e[255&r]}${e[r>>8&255]}${e[r>>16&255]}${e[r>>24&255]}`}})(),clamp:(e,t,s)=>Math.max(t,Math.min(s,e)),fmod(e,t){if(e<t)return console.error("math.fmod : Attempting to find modulus within negative range - would be infinite loop - ignoring"),e;for(;t<=e;)e-=t;return e},compareVec3:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2],compareVec4:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3],negateVec3:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t),negateVec4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t),addVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s[3]=e[3]+t[3],s),addVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s[3]=e[3]+t,s),addVec3:(e,t,s)=>(s||(s=e),s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s),addVec3Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s),subVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s[3]=e[3]-t[3],s),subVec3:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s),subVec2:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s),geometricMeanVec2(...e){const t=new A(e[0]);for(let s=1;s<e.length;s++)t[0]+=e[s][0],t[1]+=e[s][1];return t[0]/=e.length,t[1]/=e.length,t},subVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]-t,s[1]=e[1]-t,s[2]=e[2]-t,s[3]=e[3]-t,s),subScalarVec4:(e,t,s)=>(s||(s=e),s[0]=t-e[0],s[1]=t-e[1],s[2]=t-e[2],s[3]=t-e[3],s),mulVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]*t[0],s[1]=e[1]*t[1],s[2]=e[2]*t[2],s[3]=e[3]*t[3],s),mulVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s[3]=e[3]*t,s),mulVec3Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s),mulVec2Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s),divVec3:(e,t,s)=>(s||(s=e),s[0]=e[0]/t[0],s[1]=e[1]/t[1],s[2]=e[2]/t[2],s),divVec4:(e,t,s)=>(s||(s=e),s[0]=e[0]/t[0],s[1]=e[1]/t[1],s[2]=e[2]/t[2],s[3]=e[3]/t[3],s),divScalarVec3:(e,t,s)=>(s||(s=t),s[0]=e/t[0],s[1]=e/t[1],s[2]=e/t[2],s),divVec3Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]/t,s[1]=e[1]/t,s[2]=e[2]/t,s),divVec4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]/t,s[1]=e[1]/t,s[2]=e[2]/t,s[3]=e[3]/t,s),divScalarVec4:(e,t,s)=>(s||(s=t),s[0]=e/t[0],s[1]=e/t[1],s[2]=e/t[2],s[3]=e/t[3],s),dotVec4:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3],cross3Vec4(e,t){const s=e[0],i=e[1],r=e[2],n=t[0],A=t[1],o=t[2];return[i*o-r*A,r*n-s*o,s*A-i*n,0]},cross3Vec3(e,t,s){s||(s=e);const i=e[0],r=e[1],n=e[2],A=t[0],o=t[1],a=t[2];return s[0]=r*a-n*o,s[1]=n*A-i*a,s[2]=i*o-r*A,s},sqLenVec4:e=>h.dotVec4(e,e),lenVec4:e=>Math.sqrt(h.sqLenVec4(e)),dotVec3:(e,t)=>e[0]*t[0]+e[1]*t[1]+e[2]*t[2],dotVec2:(e,t)=>e[0]*t[0]+e[1]*t[1],sqLenVec3:e=>h.dotVec3(e,e),sqLenVec2:e=>h.dotVec2(e,e),lenVec3:e=>Math.sqrt(h.sqLenVec3(e)),distVec3:(()=>{const e=new A(3);return(t,s)=>h.lenVec3(h.subVec3(t,s,e))})(),lenVec2:e=>Math.sqrt(h.sqLenVec2(e)),distVec2:(()=>{const e=new A(2);return(t,s)=>h.lenVec2(h.subVec2(t,s,e))})(),rcpVec3:(e,t)=>h.divScalarVec3(1,e,t),normalizeVec4(e,t){const s=1/h.lenVec4(e);return h.mulVec4Scalar(e,s,t)},normalizeVec3(e,t){const s=1/h.lenVec3(e);return h.mulVec3Scalar(e,s,t)},normalizeVec2(e,t){const s=1/h.lenVec2(e);return h.mulVec2Scalar(e,s,t)},angleVec3(e,t){let s=h.dotVec3(e,t)/Math.sqrt(h.sqLenVec3(e)*h.sqLenVec3(t));return s=s<-1?-1:s>1?1:s,Math.acos(s)},vec3FromMat4Scale:(()=>{const e=new A(3);return(t,s)=>(e[0]=t[0],e[1]=t[1],e[2]=t[2],s[0]=h.lenVec3(e),e[0]=t[4],e[1]=t[5],e[2]=t[6],s[1]=h.lenVec3(e),e[0]=t[8],e[1]=t[9],e[2]=t[10],s[2]=h.lenVec3(e),s)})(),vecToArray:(()=>{function e(e){return Math.round(1e5*e)/1e5}return t=>{for(let s=0,i=(t=Array.prototype.slice.call(t)).length;s<i;s++)t[s]=e(t[s]);return t}})(),xyzArrayToObject:e=>({x:e[0],y:e[1],z:e[2]}),xyzObjectToArray:(e,t)=>((t=t||h.vec3())[0]=e.x,t[1]=e.y,t[2]=e.z,t),dupMat4:e=>e.slice(0,16),mat4To3:e=>[e[0],e[1],e[2],e[4],e[5],e[6],e[8],e[9],e[10]],m4s:e=>[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e],setMat4ToZeroes:()=>h.m4s(0),setMat4ToOnes:()=>h.m4s(1),diagonalMat4v:e=>new A([e[0],0,0,0,0,e[1],0,0,0,0,e[2],0,0,0,0,e[3]]),diagonalMat4c:(e,t,s,i)=>h.diagonalMat4v([e,t,s,i]),diagonalMat4s:e=>h.diagonalMat4c(e,e,e,e),identityMat4:(e=new A(16))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e),identityMat3:(e=new A(9))=>(e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e),isIdentityMat4:e=>1===e[0]&&0===e[1]&&0===e[2]&&0===e[3]&&0===e[4]&&1===e[5]&&0===e[6]&&0===e[7]&&0===e[8]&&0===e[9]&&1===e[10]&&0===e[11]&&0===e[12]&&0===e[13]&&0===e[14]&&1===e[15],negateMat4:(e,t)=>(t||(t=e),t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t),addMat4:(e,t,s)=>(s||(s=e),s[0]=e[0]+t[0],s[1]=e[1]+t[1],s[2]=e[2]+t[2],s[3]=e[3]+t[3],s[4]=e[4]+t[4],s[5]=e[5]+t[5],s[6]=e[6]+t[6],s[7]=e[7]+t[7],s[8]=e[8]+t[8],s[9]=e[9]+t[9],s[10]=e[10]+t[10],s[11]=e[11]+t[11],s[12]=e[12]+t[12],s[13]=e[13]+t[13],s[14]=e[14]+t[14],s[15]=e[15]+t[15],s),addMat4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]+t,s[1]=e[1]+t,s[2]=e[2]+t,s[3]=e[3]+t,s[4]=e[4]+t,s[5]=e[5]+t,s[6]=e[6]+t,s[7]=e[7]+t,s[8]=e[8]+t,s[9]=e[9]+t,s[10]=e[10]+t,s[11]=e[11]+t,s[12]=e[12]+t,s[13]=e[13]+t,s[14]=e[14]+t,s[15]=e[15]+t,s),addScalarMat4:(e,t,s)=>h.addMat4Scalar(t,e,s),subMat4:(e,t,s)=>(s||(s=e),s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],s[3]=e[3]-t[3],s[4]=e[4]-t[4],s[5]=e[5]-t[5],s[6]=e[6]-t[6],s[7]=e[7]-t[7],s[8]=e[8]-t[8],s[9]=e[9]-t[9],s[10]=e[10]-t[10],s[11]=e[11]-t[11],s[12]=e[12]-t[12],s[13]=e[13]-t[13],s[14]=e[14]-t[14],s[15]=e[15]-t[15],s),subMat4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]-t,s[1]=e[1]-t,s[2]=e[2]-t,s[3]=e[3]-t,s[4]=e[4]-t,s[5]=e[5]-t,s[6]=e[6]-t,s[7]=e[7]-t,s[8]=e[8]-t,s[9]=e[9]-t,s[10]=e[10]-t,s[11]=e[11]-t,s[12]=e[12]-t,s[13]=e[13]-t,s[14]=e[14]-t,s[15]=e[15]-t,s),subScalarMat4:(e,t,s)=>(s||(s=t),s[0]=e-t[0],s[1]=e-t[1],s[2]=e-t[2],s[3]=e-t[3],s[4]=e-t[4],s[5]=e-t[5],s[6]=e-t[6],s[7]=e-t[7],s[8]=e-t[8],s[9]=e-t[9],s[10]=e-t[10],s[11]=e-t[11],s[12]=e-t[12],s[13]=e-t[13],s[14]=e-t[14],s[15]=e-t[15],s),mulMat4(e,t,s){s||(s=e);const i=e[0],r=e[1],n=e[2],A=e[3],o=e[4],a=e[5],l=e[6],c=e[7],h=e[8],u=e[9],d=e[10],p=e[11],f=e[12],g=e[13],m=e[14],_=e[15],b=t[0],B=t[1],y=t[2],w=t[3],v=t[4],C=t[5],M=t[6],E=t[7],F=t[8],x=t[9],U=t[10],I=t[11],T=t[12],P=t[13],S=t[14],D=t[15];return s[0]=b*i+B*o+y*h+w*f,s[1]=b*r+B*a+y*u+w*g,s[2]=b*n+B*l+y*d+w*m,s[3]=b*A+B*c+y*p+w*_,s[4]=v*i+C*o+M*h+E*f,s[5]=v*r+C*a+M*u+E*g,s[6]=v*n+C*l+M*d+E*m,s[7]=v*A+C*c+M*p+E*_,s[8]=F*i+x*o+U*h+I*f,s[9]=F*r+x*a+U*u+I*g,s[10]=F*n+x*l+U*d+I*m,s[11]=F*A+x*c+U*p+I*_,s[12]=T*i+P*o+S*h+D*f,s[13]=T*r+P*a+S*u+D*g,s[14]=T*n+P*l+S*d+D*m,s[15]=T*A+P*c+S*p+D*_,s},mulMat3(e,t,s){s||(s=new A(9));const i=e[0],r=e[3],n=e[6],o=e[1],a=e[4],l=e[7],c=e[2],h=e[5],u=e[8],d=t[0],p=t[3],f=t[6],g=t[1],m=t[4],_=t[7],b=t[2],B=t[5],y=t[8];return s[0]=i*d+r*g+n*b,s[3]=i*p+r*m+n*B,s[6]=i*f+r*_+n*y,s[1]=o*d+a*g+l*b,s[4]=o*p+a*m+l*B,s[7]=o*f+a*_+l*y,s[2]=c*d+h*g+u*b,s[5]=c*p+h*m+u*B,s[8]=c*f+h*_+u*y,s},mulMat4Scalar:(e,t,s)=>(s||(s=e),s[0]=e[0]*t,s[1]=e[1]*t,s[2]=e[2]*t,s[3]=e[3]*t,s[4]=e[4]*t,s[5]=e[5]*t,s[6]=e[6]*t,s[7]=e[7]*t,s[8]=e[8]*t,s[9]=e[9]*t,s[10]=e[10]*t,s[11]=e[11]*t,s[12]=e[12]*t,s[13]=e[13]*t,s[14]=e[14]*t,s[15]=e[15]*t,s),mulMat4v4(e,t,s=h.vec4()){const i=t[0],r=t[1],n=t[2],A=t[3];return s[0]=e[0]*i+e[4]*r+e[8]*n+e[12]*A,s[1]=e[1]*i+e[5]*r+e[9]*n+e[13]*A,s[2]=e[2]*i+e[6]*r+e[10]*n+e[14]*A,s[3]=e[3]*i+e[7]*r+e[11]*n+e[15]*A,s},transposeMat4(e,t){const s=e[4],i=e[14],r=e[8],n=e[13],A=e[12],o=e[9];if(!t||e===t){const t=e[1],a=e[2],l=e[3],c=e[6],h=e[7],u=e[11];return e[1]=s,e[2]=r,e[3]=A,e[4]=t,e[6]=o,e[7]=n,e[8]=a,e[9]=c,e[11]=i,e[12]=l,e[13]=h,e[14]=u,e}return t[0]=e[0],t[1]=s,t[2]=r,t[3]=A,t[4]=e[1],t[5]=e[5],t[6]=o,t[7]=n,t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=i,t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15],t},transposeMat3(e,t){if(t===e){const s=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=s,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},determinantMat4(e){const t=e[0],s=e[1],i=e[2],r=e[3],n=e[4],A=e[5],o=e[6],a=e[7],l=e[8],c=e[9],h=e[10],u=e[11],d=e[12],p=e[13],f=e[14],g=e[15];return d*c*o*r-l*p*o*r-d*A*h*r+n*p*h*r+l*A*f*r-n*c*f*r-d*c*i*a+l*p*i*a+d*s*h*a-t*p*h*a-l*s*f*a+t*c*f*a+d*A*i*u-n*p*i*u-d*s*o*u+t*p*o*u+n*s*f*u-t*A*f*u-l*A*i*g+n*c*i*g+l*s*o*g-t*c*o*g-n*s*h*g+t*A*h*g},inverseMat4(e,t){t||(t=e);const s=e[0],i=e[1],r=e[2],n=e[3],A=e[4],o=e[5],a=e[6],l=e[7],c=e[8],h=e[9],u=e[10],d=e[11],p=e[12],f=e[13],g=e[14],m=e[15],_=s*o-i*A,b=s*a-r*A,B=s*l-n*A,y=i*a-r*o,w=i*l-n*o,v=r*l-n*a,C=c*f-h*p,M=c*g-u*p,E=c*m-d*p,F=h*g-u*f,x=h*m-d*f,U=u*m-d*g,I=1/(_*U-b*x+B*F+y*E-w*M+v*C);return t[0]=(o*U-a*x+l*F)*I,t[1]=(-i*U+r*x-n*F)*I,t[2]=(f*v-g*w+m*y)*I,t[3]=(-h*v+u*w-d*y)*I,t[4]=(-A*U+a*E-l*M)*I,t[5]=(s*U-r*E+n*M)*I,t[6]=(-p*v+g*B-m*b)*I,t[7]=(c*v-u*B+d*b)*I,t[8]=(A*x-o*E+l*C)*I,t[9]=(-s*x+i*E-n*C)*I,t[10]=(p*w-f*B+m*_)*I,t[11]=(-c*w+h*B-d*_)*I,t[12]=(-A*F+o*M-a*C)*I,t[13]=(s*F-i*M+r*C)*I,t[14]=(-p*y+f*b-g*_)*I,t[15]=(c*y-h*b+u*_)*I,t},traceMat4:e=>e[0]+e[5]+e[10]+e[15],translationMat4v(e,t){const s=t||h.identityMat4();return s[12]=e[0],s[13]=e[1],s[14]=e[2],s},translationMat3v(e,t){const s=t||h.identityMat3();return s[6]=e[0],s[7]=e[1],s},translationMat4c:(()=>{const e=new A(3);return(t,s,i,r)=>(e[0]=t,e[1]=s,e[2]=i,h.translationMat4v(e,r))})(),translationMat4s:(e,t)=>h.translationMat4c(e,e,e,t),translateMat4v:(e,t)=>h.translateMat4c(e[0],e[1],e[2],t),translateMat4c(e,t,s,i){const r=i[3];i[0]+=r*e,i[1]+=r*t,i[2]+=r*s;const n=i[7];i[4]+=n*e,i[5]+=n*t,i[6]+=n*s;const A=i[11];i[8]+=A*e,i[9]+=A*t,i[10]+=A*s;const o=i[15];return i[12]+=o*e,i[13]+=o*t,i[14]+=o*s,i},setMat4Translation:(e,t,s)=>(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=e[15],s),rotationMat4v(e,t,s){const i=h.normalizeVec4([t[0],t[1],t[2],0],[]),r=Math.sin(e),n=Math.cos(e),A=1-n,o=i[0],a=i[1],l=i[2];let c,u,d,p,f,g;return c=o*a,u=a*l,d=l*o,p=o*r,f=a*r,g=l*r,(s=s||h.mat4())[0]=A*o*o+n,s[1]=A*c+g,s[2]=A*d-f,s[3]=0,s[4]=A*c-g,s[5]=A*a*a+n,s[6]=A*u+p,s[7]=0,s[8]=A*d+f,s[9]=A*u-p,s[10]=A*l*l+n,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},rotationMat4c:(e,t,s,i,r)=>h.rotationMat4v(e,[t,s,i],r),scalingMat4v:(e,t=h.identityMat4())=>(t[0]=e[0],t[5]=e[1],t[10]=e[2],t),scalingMat3v:(e,t=h.identityMat3())=>(t[0]=e[0],t[4]=e[1],t),scalingMat4c:(()=>{const e=new A(3);return(t,s,i,r)=>(e[0]=t,e[1]=s,e[2]=i,h.scalingMat4v(e,r))})(),scaleMat4c:(e,t,s,i)=>(i[0]*=e,i[4]*=t,i[8]*=s,i[1]*=e,i[5]*=t,i[9]*=s,i[2]*=e,i[6]*=t,i[10]*=s,i[3]*=e,i[7]*=t,i[11]*=s,i),scaleMat4v(e,t){const s=e[0],i=e[1],r=e[2];return t[0]*=s,t[4]*=i,t[8]*=r,t[1]*=s,t[5]*=i,t[9]*=r,t[2]*=s,t[6]*=i,t[10]*=r,t[3]*=s,t[7]*=i,t[11]*=r,t},scalingMat4s:e=>h.scalingMat4c(e,e,e),rotationTranslationMat4(e,t,s=h.mat4()){const i=e[0],r=e[1],n=e[2],A=e[3],o=i+i,a=r+r,l=n+n,c=i*o,u=i*a,d=i*l,p=r*a,f=r*l,g=n*l,m=A*o,_=A*a,b=A*l;return s[0]=1-(p+g),s[1]=u+b,s[2]=d-_,s[3]=0,s[4]=u-b,s[5]=1-(c+g),s[6]=f+m,s[7]=0,s[8]=d+_,s[9]=f-m,s[10]=1-(c+p),s[11]=0,s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=1,s},mat4ToEuler(e,t,s=h.vec4()){const i=h.clamp,r=e[0],n=e[4],A=e[8],o=e[1],a=e[5],l=e[9],c=e[2],u=e[6],d=e[10];return"XYZ"===t?(s[1]=Math.asin(i(A,-1,1)),Math.abs(A)<.99999?(s[0]=Math.atan2(-l,d),s[2]=Math.atan2(-n,r)):(s[0]=Math.atan2(u,a),s[2]=0)):"YXZ"===t?(s[0]=Math.asin(-i(l,-1,1)),Math.abs(l)<.99999?(s[1]=Math.atan2(A,d),s[2]=Math.atan2(o,a)):(s[1]=Math.atan2(-c,r),s[2]=0)):"ZXY"===t?(s[0]=Math.asin(i(u,-1,1)),Math.abs(u)<.99999?(s[1]=Math.atan2(-c,d),s[2]=Math.atan2(-n,a)):(s[1]=0,s[2]=Math.atan2(o,r))):"ZYX"===t?(s[1]=Math.asin(-i(c,-1,1)),Math.abs(c)<.99999?(s[0]=Math.atan2(u,d),s[2]=Math.atan2(o,r)):(s[0]=0,s[2]=Math.atan2(-n,a))):"YZX"===t?(s[2]=Math.asin(i(o,-1,1)),Math.abs(o)<.99999?(s[0]=Math.atan2(-l,a),s[1]=Math.atan2(-c,r)):(s[0]=0,s[1]=Math.atan2(A,d))):"XZY"===t&&(s[2]=Math.asin(-i(n,-1,1)),Math.abs(n)<.99999?(s[0]=Math.atan2(u,a),s[1]=Math.atan2(A,r)):(s[0]=Math.atan2(-l,d),s[1]=0)),s[0]*=h.RADTODEG,s[1]*=h.RADTODEG,s[2]*=h.RADTODEG,s},composeMat4:(e,t,s,i=h.mat4())=>(h.quaternionToRotationMat4(t,i),h.scaleMat4v(s,i),h.translateMat4v(e,i),i),decomposeMat4:(()=>{const e=new A(3),t=new A(16);return function(s,i,r,n){e[0]=s[0],e[1]=s[1],e[2]=s[2];let A=h.lenVec3(e);e[0]=s[4],e[1]=s[5],e[2]=s[6];const o=h.lenVec3(e);e[8]=s[8],e[9]=s[9],e[10]=s[10];const a=h.lenVec3(e);h.determinantMat4(s)<0&&(A=-A),i[0]=s[12],i[1]=s[13],i[2]=s[14],t.set(s);const l=1/A,c=1/o,u=1/a;return t[0]*=l,t[1]*=l,t[2]*=l,t[4]*=c,t[5]*=c,t[6]*=c,t[8]*=u,t[9]*=u,t[10]*=u,h.mat4ToQuaternion(t,r),n[0]=A,n[1]=o,n[2]=a,this}})(),getColMat4(e,t){const s=4*t;return[e[s],e[s+1],e[s+2],e[s+3]]},setRowMat4(e,t,s){e[t]=s[0],e[t+4]=s[1],e[t+8]=s[2],e[t+12]=s[3]},lookAtMat4v(e,t,s,i){i||(i=h.mat4());const r=e[0],n=e[1],A=e[2],o=s[0],a=s[1],l=s[2],c=t[0],u=t[1],d=t[2];if(r===c&&n===u&&A===d)return h.identityMat4();let p,f,g,m,_,b,B,y,w,v;return p=r-c,f=n-u,g=A-d,v=1/Math.sqrt(p*p+f*f+g*g),p*=v,f*=v,g*=v,m=a*g-l*f,_=l*p-o*g,b=o*f-a*p,v=Math.sqrt(m*m+_*_+b*b),v?(v=1/v,m*=v,_*=v,b*=v):(m=0,_=0,b=0),B=f*b-g*_,y=g*m-p*b,w=p*_-f*m,v=Math.sqrt(B*B+y*y+w*w),v?(v=1/v,B*=v,y*=v,w*=v):(B=0,y=0,w=0),i[0]=m,i[1]=B,i[2]=p,i[3]=0,i[4]=_,i[5]=y,i[6]=f,i[7]=0,i[8]=b,i[9]=w,i[10]=g,i[11]=0,i[12]=-(m*r+_*n+b*A),i[13]=-(B*r+y*n+w*A),i[14]=-(p*r+f*n+g*A),i[15]=1,i},lookAtMat4c:(e,t,s,i,r,n,A,o,a)=>h.lookAtMat4v([e,t,s],[i,r,n],[A,o,a],[]),orthoMat4c(e,t,s,i,r,n,A){A||(A=h.mat4());const o=t-e,a=i-s,l=n-r;return A[0]=2/o,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=2/a,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=-2/l,A[11]=0,A[12]=-(e+t)/o,A[13]=-(i+s)/a,A[14]=-(n+r)/l,A[15]=1,A},frustumMat4v(e,t,s){s||(s=h.mat4());const i=[e[0],e[1],e[2],0],r=[t[0],t[1],t[2],0];h.addVec4(r,i,a),h.subVec4(r,i,l);const n=2*i[2],A=l[0],o=l[1],c=l[2];return s[0]=n/A,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=n/o,s[6]=0,s[7]=0,s[8]=a[0]/A,s[9]=a[1]/o,s[10]=-a[2]/c,s[11]=-1,s[12]=0,s[13]=0,s[14]=-n*r[2]/c,s[15]=0,s},frustumMat4(e,t,s,i,r,n,A){A||(A=h.mat4());const o=t-e,a=i-s,l=n-r;return A[0]=2*r/o,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=2*r/a,A[6]=0,A[7]=0,A[8]=(t+e)/o,A[9]=(i+s)/a,A[10]=-(n+r)/l,A[11]=-1,A[12]=0,A[13]=0,A[14]=-n*r*2/l,A[15]=0,A},perspectiveMat4(e,t,s,i,r){const n=[],A=[];return n[2]=s,A[2]=i,A[1]=n[2]*Math.tan(e/2),n[1]=-A[1],A[0]=A[1]*t,n[0]=-A[0],h.frustumMat4v(n,A,r)},compareMat4:(e,t)=>e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15],transformPoint3(e,t,s=h.vec3()){const i=t[0],r=t[1],n=t[2];return s[0]=e[0]*i+e[4]*r+e[8]*n+e[12],s[1]=e[1]*i+e[5]*r+e[9]*n+e[13],s[2]=e[2]*i+e[6]*r+e[10]*n+e[14],s},transformPoint4:(e,t,s=h.vec4())=>(s[0]=e[0]*t[0]+e[4]*t[1]+e[8]*t[2]+e[12]*t[3],s[1]=e[1]*t[0]+e[5]*t[1]+e[9]*t[2]+e[13]*t[3],s[2]=e[2]*t[0]+e[6]*t[1]+e[10]*t[2]+e[14]*t[3],s[3]=e[3]*t[0]+e[7]*t[1]+e[11]*t[2]+e[15]*t[3],s),transformPoints3(e,t,s){const i=s||[],r=t.length;let n,A,o,a;const l=e[0],c=e[1],h=e[2],u=e[3],d=e[4],p=e[5],f=e[6],g=e[7],m=e[8],_=e[9],b=e[10],B=e[11],y=e[12],w=e[13],v=e[14],C=e[15];let M;for(let e=0;e<r;++e)a=t[e],n=a[0],A=a[1],o=a[2],M=i[e]||(i[e]=[0,0,0]),M[0]=l*n+d*A+m*o+y,M[1]=c*n+p*A+_*o+w,M[2]=h*n+f*A+b*o+v,M[3]=u*n+g*A+B*o+C;return i.length=r,i},transformPositions3(e,t,s=t){let i;const r=t.length;let n,A,o;const a=e[0],l=e[1],c=e[2];e[3];const h=e[4],u=e[5],d=e[6];e[7];const p=e[8],f=e[9],g=e[10];e[11];const m=e[12],_=e[13],b=e[14];for(e[15],i=0;i<r;i+=3)n=t[i+0],A=t[i+1],o=t[i+2],s[i+0]=a*n+h*A+p*o+m,s[i+1]=l*n+u*A+f*o+_,s[i+2]=c*n+d*A+g*o+b;return s},transformPositions4(e,t,s=t){let i;const r=t.length;let n,A,o;const a=e[0],l=e[1],c=e[2],h=e[3],u=e[4],d=e[5],p=e[6],f=e[7],g=e[8],m=e[9],_=e[10],b=e[11],B=e[12],y=e[13],w=e[14],v=e[15];for(i=0;i<r;i+=4)n=t[i+0],A=t[i+1],o=t[i+2],s[i+0]=a*n+u*A+g*o+B,s[i+1]=l*n+d*A+m*o+y,s[i+2]=c*n+p*A+_*o+w,s[i+3]=h*n+f*A+b*o+v;return s},transformVec3(e,t,s){const i=t[0],r=t[1],n=t[2];return(s=s||this.vec3())[0]=e[0]*i+e[4]*r+e[8]*n,s[1]=e[1]*i+e[5]*r+e[9]*n,s[2]=e[2]*i+e[6]*r+e[10]*n,s},transformVec4(e,t,s){const i=t[0],r=t[1],n=t[2],A=t[3];return(s=s||h.vec4())[0]=e[0]*i+e[4]*r+e[8]*n+e[12]*A,s[1]=e[1]*i+e[5]*r+e[9]*n+e[13]*A,s[2]=e[2]*i+e[6]*r+e[10]*n+e[14]*A,s[3]=e[3]*i+e[7]*r+e[11]*n+e[15]*A,s},rotateVec2(e,t,s,i=e){const r=Math.cos(s),n=Math.sin(s),A=e[0]-t[0],o=e[1]-t[1];return i[0]=A*r-o*n+t[0],i[1]=A*n+o*r+t[1],e},rotateVec3X(e,t,s,i){const r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[0],n[1]=r[1]*Math.cos(s)-r[2]*Math.sin(s),n[2]=r[1]*Math.sin(s)+r[2]*Math.cos(s),i[0]=n[0]+t[0],i[1]=n[1]+t[1],i[2]=n[2]+t[2],i},rotateVec3Y(e,t,s,i){const r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[2]*Math.sin(s)+r[0]*Math.cos(s),n[1]=r[1],n[2]=r[2]*Math.cos(s)-r[0]*Math.sin(s),i[0]=n[0]+t[0],i[1]=n[1]+t[1],i[2]=n[2]+t[2],i},rotateVec3Z(e,t,s,i){const r=[],n=[];return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],n[0]=r[0]*Math.cos(s)-r[1]*Math.sin(s),n[1]=r[0]*Math.sin(s)+r[1]*Math.cos(s),n[2]=r[2],i[0]=n[0]+t[0],i[1]=n[1]+t[1],i[2]=n[2]+t[2],i},projectVec4(e,t){const s=1/e[3];return(t=t||h.vec2())[0]=e[0]*s,t[1]=e[1]*s,t},unprojectVec3:(()=>{const e=new A(16),t=new A(16),s=new A(16);return function(i,r,n,A){return this.transformVec3(this.mulMat4(this.inverseMat4(r,e),this.inverseMat4(n,t),s),i,A)}})(),lerpVec3(e,t,s,i,r,n){const A=n||h.vec3(),o=(e-t)/(s-t);return A[0]=i[0]+o*(r[0]-i[0]),A[1]=i[1]+o*(r[1]-i[1]),A[2]=i[2]+o*(r[2]-i[2]),A},lerpMat4(e,t,s,i,r,n){const A=n||h.mat4(),o=(e-t)/(s-t);return A[0]=i[0]+o*(r[0]-i[0]),A[1]=i[1]+o*(r[1]-i[1]),A[2]=i[2]+o*(r[2]-i[2]),A[3]=i[3]+o*(r[3]-i[3]),A[4]=i[4]+o*(r[4]-i[4]),A[5]=i[5]+o*(r[5]-i[5]),A[6]=i[6]+o*(r[6]-i[6]),A[7]=i[7]+o*(r[7]-i[7]),A[8]=i[8]+o*(r[8]-i[8]),A[9]=i[9]+o*(r[9]-i[9]),A[10]=i[10]+o*(r[10]-i[10]),A[11]=i[11]+o*(r[11]-i[11]),A[12]=i[12]+o*(r[12]-i[12]),A[13]=i[13]+o*(r[13]-i[13]),A[14]=i[14]+o*(r[14]-i[14]),A[15]=i[15]+o*(r[15]-i[15]),A},flatten(e){const t=[];let s,i,r,n,A;for(s=0,i=e.length;s<i;s++)for(A=e[s],r=0,n=A.length;r<n;r++)t.push(A[r]);return t},identityQuaternion:(e=h.vec4())=>(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e),eulerToQuaternion(e,t,s=h.vec4()){const i=e[0]*h.DEGTORAD/2,r=e[1]*h.DEGTORAD/2,n=e[2]*h.DEGTORAD/2,A=Math.cos(i),o=Math.cos(r),a=Math.cos(n),l=Math.sin(i),c=Math.sin(r),u=Math.sin(n);return"XYZ"===t?(s[0]=l*o*a+A*c*u,s[1]=A*c*a-l*o*u,s[2]=A*o*u+l*c*a,s[3]=A*o*a-l*c*u):"YXZ"===t?(s[0]=l*o*a+A*c*u,s[1]=A*c*a-l*o*u,s[2]=A*o*u-l*c*a,s[3]=A*o*a+l*c*u):"ZXY"===t?(s[0]=l*o*a-A*c*u,s[1]=A*c*a+l*o*u,s[2]=A*o*u+l*c*a,s[3]=A*o*a-l*c*u):"ZYX"===t?(s[0]=l*o*a-A*c*u,s[1]=A*c*a+l*o*u,s[2]=A*o*u-l*c*a,s[3]=A*o*a+l*c*u):"YZX"===t?(s[0]=l*o*a+A*c*u,s[1]=A*c*a+l*o*u,s[2]=A*o*u-l*c*a,s[3]=A*o*a-l*c*u):"XZY"===t&&(s[0]=l*o*a-A*c*u,s[1]=A*c*a-l*o*u,s[2]=A*o*u+l*c*a,s[3]=A*o*a+l*c*u),s},mat4ToQuaternion(e,t=h.vec4()){const s=e[0],i=e[4],r=e[8],n=e[1],A=e[5],o=e[9],a=e[2],l=e[6],c=e[10];let u;const d=s+A+c;return d>0?(u=.5/Math.sqrt(d+1),t[3]=.25/u,t[0]=(l-o)*u,t[1]=(r-a)*u,t[2]=(n-i)*u):s>A&&s>c?(u=2*Math.sqrt(1+s-A-c),t[3]=(l-o)/u,t[0]=.25*u,t[1]=(i+n)/u,t[2]=(r+a)/u):A>c?(u=2*Math.sqrt(1+A-s-c),t[3]=(r-a)/u,t[0]=(i+n)/u,t[1]=.25*u,t[2]=(o+l)/u):(u=2*Math.sqrt(1+c-s-A),t[3]=(n-i)/u,t[0]=(r+a)/u,t[1]=(o+l)/u,t[2]=.25*u),t},vec3PairToQuaternion(e,t,s=h.vec4()){const i=Math.sqrt(h.dotVec3(e,e)*h.dotVec3(t,t));let r=i+h.dotVec3(e,t);return r<1e-8*i?(r=0,Math.abs(e[0])>Math.abs(e[2])?(s[0]=-e[1],s[1]=e[0],s[2]=0):(s[0]=0,s[1]=-e[2],s[2]=e[1])):h.cross3Vec3(e,t,s),s[3]=r,h.normalizeQuaternion(s)},angleAxisToQuaternion(e,t=h.vec4()){const s=e[3]/2,i=Math.sin(s);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(s),t},quaternionToEuler:(()=>{const e=new A(16);return(t,s,i)=>(i=i||h.vec3(),h.quaternionToRotationMat4(t,e),h.mat4ToEuler(e,s,i),i)})(),mulQuaternions(e,t,s=h.vec4()){const i=e[0],r=e[1],n=e[2],A=e[3],o=t[0],a=t[1],l=t[2],c=t[3];return s[0]=A*o+i*c+r*l-n*a,s[1]=A*a+r*c+n*o-i*l,s[2]=A*l+n*c+i*a-r*o,s[3]=A*c-i*o-r*a-n*l,s},vec3ApplyQuaternion(e,t,s=h.vec3()){const i=t[0],r=t[1],n=t[2],A=e[0],o=e[1],a=e[2],l=e[3],c=l*i+o*n-a*r,u=l*r+a*i-A*n,d=l*n+A*r-o*i,p=-A*i-o*r-a*n;return s[0]=c*l+p*-A+u*-a-d*-o,s[1]=u*l+p*-o+d*-A-c*-a,s[2]=d*l+p*-a+c*-o-u*-A,s},quaternionToMat4(e,t){t=h.identityMat4(t);const s=e[0],i=e[1],r=e[2],n=e[3],A=2*s,o=2*i,a=2*r,l=A*n,c=o*n,u=a*n,d=A*s,p=o*s,f=a*s,g=o*i,m=a*i,_=a*r;return t[0]=1-(g+_),t[1]=p+u,t[2]=f-c,t[4]=p-u,t[5]=1-(d+_),t[6]=m+l,t[8]=f+c,t[9]=m-l,t[10]=1-(d+g),t},quaternionToRotationMat4(e,t){const s=e[0],i=e[1],r=e[2],n=e[3],A=s+s,o=i+i,a=r+r,l=s*A,c=s*o,h=s*a,u=i*o,d=i*a,p=r*a,f=n*A,g=n*o,m=n*a;return t[0]=1-(u+p),t[4]=c-m,t[8]=h+g,t[1]=c+m,t[5]=1-(l+p),t[9]=d-f,t[2]=h-g,t[6]=d+f,t[10]=1-(l+u),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},normalizeQuaternion(e,t=e){const s=h.lenVec4([e[0],e[1],e[2],e[3]]);return t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s,t[3]=e[3]/s,t},conjugateQuaternion:(e,t=e)=>(t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t),inverseQuaternion:(e,t)=>h.normalizeQuaternion(h.conjugateQuaternion(e,t)),quaternionToAngleAxis(e,t=h.vec4()){const s=(e=h.normalizeQuaternion(e,c))[3],i=2*Math.acos(s),r=Math.sqrt(1-s*s);return r<.001?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r),t[3]=i,t},AABB3:e=>new A(e||6),AABB2:e=>new A(e||4),OBB3:e=>new A(e||32),OBB2:e=>new A(e||16),Sphere3:(e,t,s,i)=>new A([e,t,s,i]),transformOBB3(e,t,s=t){let i;const r=t.length;let n,A,o;const a=e[0],l=e[1],c=e[2],h=e[3],u=e[4],d=e[5],p=e[6],f=e[7],g=e[8],m=e[9],_=e[10],b=e[11],B=e[12],y=e[13],w=e[14],v=e[15];for(i=0;i<r;i+=4)n=t[i+0],A=t[i+1],o=t[i+2],s[i+0]=a*n+u*A+g*o+B,s[i+1]=l*n+d*A+m*o+y,s[i+2]=c*n+p*A+_*o+w,s[i+3]=h*n+f*A+b*o+v;return s},containsAABB3:function(e,t){return e[0]<=t[0]&&t[3]<=e[3]&&e[1]<=t[1]&&t[4]<=e[4]&&e[2]<=t[2]&&t[5]<=e[5]},getAABB3Diag:(()=>{const e=new A(3),t=new A(3),s=new A(3);return i=>(e[0]=i[0],e[1]=i[1],e[2]=i[2],t[0]=i[3],t[1]=i[4],t[2]=i[5],h.subVec3(t,e,s),Math.abs(h.lenVec3(s)))})(),getAABB3DiagPoint:(()=>{const e=new A(3),t=new A(3),s=new A(3);return(i,r)=>{e[0]=i[0],e[1]=i[1],e[2]=i[2],t[0]=i[3],t[1]=i[4],t[2]=i[5];const n=h.subVec3(t,e,s),A=r[0]-i[0],o=i[3]-r[0],a=r[1]-i[1],l=i[4]-r[1],c=r[2]-i[2],u=i[5]-r[2];return n[0]+=A>o?A:o,n[1]+=a>l?a:l,n[2]+=c>u?c:u,Math.abs(h.lenVec3(n))}})(),getAABB3Area:e=>(e[3]-e[0])*(e[4]-e[1])*(e[5]-e[2]),getAABB3Center(e,t){const s=t||h.vec3();return s[0]=(e[0]+e[3])/2,s[1]=(e[1]+e[4])/2,s[2]=(e[2]+e[5])/2,s},getAABB2Center(e,t){const s=t||h.vec2();return s[0]=(e[2]+e[0])/2,s[1]=(e[3]+e[1])/2,s},collapseAABB3:(e=h.AABB3())=>(e[0]=h.MAX_DOUBLE,e[1]=h.MAX_DOUBLE,e[2]=h.MAX_DOUBLE,e[3]=h.MIN_DOUBLE,e[4]=h.MIN_DOUBLE,e[5]=h.MIN_DOUBLE,e),AABB3ToOBB3:(e,t=h.OBB3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,t[4]=e[3],t[5]=e[1],t[6]=e[2],t[7]=1,t[8]=e[3],t[9]=e[4],t[10]=e[2],t[11]=1,t[12]=e[0],t[13]=e[4],t[14]=e[2],t[15]=1,t[16]=e[0],t[17]=e[1],t[18]=e[5],t[19]=1,t[20]=e[3],t[21]=e[1],t[22]=e[5],t[23]=1,t[24]=e[3],t[25]=e[4],t[26]=e[5],t[27]=1,t[28]=e[0],t[29]=e[4],t[30]=e[5],t[31]=1,t),positions3ToAABB3:(()=>{const e=new A(3);return(t,s,i)=>{s=s||h.AABB3();let r,n,A,o=h.MAX_DOUBLE,a=h.MAX_DOUBLE,l=h.MAX_DOUBLE,c=h.MIN_DOUBLE,u=h.MIN_DOUBLE,d=h.MIN_DOUBLE;for(let s=0,p=t.length;s<p;s+=3)i?(e[0]=t[s+0],e[1]=t[s+1],e[2]=t[s+2],h.decompressPosition(e,i,e),r=e[0],n=e[1],A=e[2]):(r=t[s+0],n=t[s+1],A=t[s+2]),r<o&&(o=r),n<a&&(a=n),A<l&&(l=A),r>c&&(c=r),n>u&&(u=n),A>d&&(d=A);return s[0]=o,s[1]=a,s[2]=l,s[3]=c,s[4]=u,s[5]=d,s}})(),OBB3ToAABB3(e,t=h.AABB3()){let s,i,r,n=h.MAX_DOUBLE,A=h.MAX_DOUBLE,o=h.MAX_DOUBLE,a=h.MIN_DOUBLE,l=h.MIN_DOUBLE,c=h.MIN_DOUBLE;for(let t=0,h=e.length;t<h;t+=4)s=e[t+0],i=e[t+1],r=e[t+2],s<n&&(n=s),i<A&&(A=i),r<o&&(o=r),s>a&&(a=s),i>l&&(l=i),r>c&&(c=r);return t[0]=n,t[1]=A,t[2]=o,t[3]=a,t[4]=l,t[5]=c,t},points3ToAABB3(e,t=h.AABB3()){let s,i,r,n=h.MAX_DOUBLE,A=h.MAX_DOUBLE,o=h.MAX_DOUBLE,a=h.MIN_DOUBLE,l=h.MIN_DOUBLE,c=h.MIN_DOUBLE;for(let t=0,h=e.length;t<h;t++)s=e[t][0],i=e[t][1],r=e[t][2],s<n&&(n=s),i<A&&(A=i),r<o&&(o=r),s>a&&(a=s),i>l&&(l=i),r>c&&(c=r);return t[0]=n,t[1]=A,t[2]=o,t[3]=a,t[4]=l,t[5]=c,t},points3ToSphere3:(()=>{const e=new A(3);return(t,s)=>{s=s||h.vec4();let i,r=0,n=0,A=0;const o=t.length;for(i=0;i<o;i++)r+=t[i][0],n+=t[i][1],A+=t[i][2];s[0]=r/o,s[1]=n/o,s[2]=A/o;let a,l=0;for(i=0;i<o;i++)a=Math.abs(h.lenVec3(h.subVec3(t[i],s,e))),a>l&&(l=a);return s[3]=l,s}})(),positions3ToSphere3:(()=>{const e=new A(3),t=new A(3);return(s,i)=>{i=i||h.vec4();let r,n=0,A=0,o=0;const a=s.length;let l=0;for(r=0;r<a;r+=3)n+=s[r],A+=s[r+1],o+=s[r+2];const c=a/3;let u;for(i[0]=n/c,i[1]=A/c,i[2]=o/c,r=0;r<a;r+=3)e[0]=s[r],e[1]=s[r+1],e[2]=s[r+2],u=Math.abs(h.lenVec3(h.subVec3(e,i,t))),u>l&&(l=u);return i[3]=l,i}})(),OBB3ToSphere3:(()=>{const e=new A(3),t=new A(3);return(s,i)=>{i=i||h.vec4();let r,n=0,A=0,o=0;const a=s.length,l=a/4;for(r=0;r<a;r+=4)n+=s[r+0],A+=s[r+1],o+=s[r+2];i[0]=n/l,i[1]=A/l,i[2]=o/l;let c,u=0;for(r=0;r<a;r+=4)e[0]=s[r+0],e[1]=s[r+1],e[2]=s[r+2],c=Math.abs(h.lenVec3(h.subVec3(e,i,t))),c>u&&(u=c);return i[3]=u,i}})(),getSphere3Center:(e,t=h.vec3())=>(t[0]=e[0],t[1]=e[1],t[2]=e[2],t),getPositionsCenter(e,t=h.vec3()){let s=0,i=0,r=0;for(var n=0,A=e.length;n<A;n+=3)s+=e[n+0],i+=e[n+1],r+=e[n+2];const o=e.length/3;return t[0]=s/o,t[1]=i/o,t[2]=r/o,t},expandAABB3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e[4]<t[4]&&(e[4]=t[4]),e[5]<t[5]&&(e[5]=t[5]),e),expandAABB3Point3:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]>t[2]&&(e[2]=t[2]),e[3]<t[0]&&(e[3]=t[0]),e[4]<t[1]&&(e[4]=t[1]),e[5]<t[2]&&(e[5]=t[2]),e),expandAABB3Points3(e,t){for(var s,i,r,n=0,A=t.length;n<A;n+=3)s=t[n],i=t[n+1],r=t[n+2],e[0]>s&&(e[0]=s),e[1]>i&&(e[1]=i),e[2]>r&&(e[2]=r),e[3]<s&&(e[3]=s),e[4]<i&&(e[4]=i),e[5]<r&&(e[5]=r);return e},collapseAABB2:(e=h.AABB2())=>(e[0]=h.MAX_DOUBLE,e[1]=h.MAX_DOUBLE,e[2]=h.MIN_DOUBLE,e[3]=h.MIN_DOUBLE,e),point3AABB3Intersect:(e,t)=>e[0]>t[0]||e[3]<t[0]||e[1]>t[1]||e[4]<t[1]||e[2]>t[2]||e[5]<t[2],point3AABB3AbsoluteIntersect:(e,t)=>e[0]<=t[0]&&e[3]>=t[0]&&e[1]<=t[1]&&e[4]>=t[1]&&e[2]<=t[2]&&e[5]>=t[2],planeAABB3Intersect(e,t,s){let i,r;e[0]>0?(i=e[0]*s[0],r=e[0]*s[3]):(i=e[0]*s[3],r=e[0]*s[0]),e[1]>0?(i+=e[1]*s[1],r+=e[1]*s[4]):(i+=e[1]*s[4],r+=e[1]*s[1]),e[2]>0?(i+=e[2]*s[2],r+=e[2]*s[5]):(i+=e[2]*s[5],r+=e[2]*s[2]);if(i<=-t&&r<=-t)return-1;return i>=-t&&r>=-t?1:0},OBB3ToAABB2(e,t=h.AABB2()){let s,i,r,n,A=h.MAX_DOUBLE,o=h.MAX_DOUBLE,a=h.MIN_DOUBLE,l=h.MIN_DOUBLE;for(let t=0,c=e.length;t<c;t+=4)s=e[t+0],i=e[t+1],r=e[t+3]||1,n=1/r,s*=n,i*=n,s<A&&(A=s),i<o&&(o=i),s>a&&(a=s),i>l&&(l=i);return t[0]=A,t[1]=o,t[2]=a,t[3]=l,t},expandAABB2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[2]&&(e[2]=t[2]),e[3]<t[3]&&(e[3]=t[3]),e),expandAABB2Point2:(e,t)=>(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1]),e),AABB2ToCanvas(e,t,s,i=e){const r=.5*(e[0]+1),n=.5*(e[1]+1),A=.5*(e[2]+1),o=.5*(e[3]+1);return i[0]=Math.floor(r*t),i[1]=s-Math.floor(o*s),i[2]=Math.floor(A*t),i[3]=s-Math.floor(n*s),i},tangentQuadraticBezier:(e,t,s,i)=>2*(1-e)*(s-t)+2*e*(i-s),tangentQuadraticBezier3:(e,t,s,i,r)=>-3*t*(1-e)*(1-e)+3*s*(1-e)*(1-e)-6*e*s*(1-e)+6*e*i*(1-e)-3*e*e*i+3*e*e*r,tangentSpline:e=>6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e),catmullRomInterpolate(e,t,s,i,r){const n=.5*(s-e),A=.5*(i-t),o=r*r;return(2*t-2*s+n+A)*(r*o)+(-3*t+3*s-2*n-A)*o+n*r+t},b2p0(e,t){const s=1-e;return s*s*t},b2p1:(e,t)=>2*(1-e)*e*t,b2p2:(e,t)=>e*e*t,b2(e,t,s,i){return this.b2p0(e,t)+this.b2p1(e,s)+this.b2p2(e,i)},b3p0(e,t){const s=1-e;return s*s*s*t},b3p1(e,t){const s=1-e;return 3*s*s*e*t},b3p2:(e,t)=>3*(1-e)*e*e*t,b3p3:(e,t)=>e*e*e*t,b3(e,t,s,i,r){return this.b3p0(e,t)+this.b3p1(e,s)+this.b3p2(e,i)+this.b3p3(e,r)},triangleNormal(e,t,s,i=h.vec3()){const r=t[0]-e[0],n=t[1]-e[1],A=t[2]-e[2],o=s[0]-e[0],a=s[1]-e[1],l=s[2]-e[2],c=n*l-A*a,u=A*o-r*l,d=r*a-n*o,p=Math.sqrt(c*c+u*u+d*d);return 0===p?(i[0]=0,i[1]=0,i[2]=0):(i[0]=c/p,i[1]=u/p,i[2]=d/p),i},rayTriangleIntersect:(()=>{const e=new A(3),t=new A(3),s=new A(3),i=new A(3),r=new A(3);return(n,A,o,a,l,c)=>{c=c||h.vec3();const u=h.subVec3(a,o,e),d=h.subVec3(l,o,t),p=h.cross3Vec3(A,d,s),f=h.dotVec3(u,p);if(f<1e-6)return null;const g=h.subVec3(n,o,i),m=h.dotVec3(g,p);if(m<0||m>f)return null;const _=h.cross3Vec3(g,u,r),b=h.dotVec3(A,_);if(b<0||m+b>f)return null;const B=h.dotVec3(d,_)/f;return c[0]=n[0]+B*A[0],c[1]=n[1]+B*A[1],c[2]=n[2]+B*A[2],c}})(),rayPlaneIntersect:(()=>{const e=new A(3),t=new A(3),s=new A(3),i=new A(3);return(r,n,A,o,a,l)=>{l=l||h.vec3(),n=h.normalizeVec3(n,e);const c=h.subVec3(o,A,t),u=h.subVec3(a,A,s),d=h.cross3Vec3(c,u,i);h.normalizeVec3(d,d);const p=-h.dotVec3(A,d),f=-(h.dotVec3(r,d)+p)/h.dotVec3(n,d);return l[0]=r[0]+f*n[0],l[1]=r[1]+f*n[1],l[2]=r[2]+f*n[2],l}})(),cartesianToBarycentric:(()=>{const e=new A(3),t=new A(3),s=new A(3);return(i,r,n,A,o)=>{const a=h.subVec3(A,r,e),l=h.subVec3(n,r,t),c=h.subVec3(i,r,s),u=h.dotVec3(a,a),d=h.dotVec3(a,l),p=h.dotVec3(a,c),f=h.dotVec3(l,l),g=h.dotVec3(l,c),m=u*f-d*d;if(0===m)return null;const _=1/m,b=(f*p-d*g)*_,B=(u*g-d*p)*_;return o[0]=1-b-B,o[1]=B,o[2]=b,o}})(),barycentricInsideTriangle(e){const t=e[1],s=e[2];return s>=0&&t>=0&&s+t<1},barycentricToCartesian(e,t,s,i,r=h.vec3()){const n=e[0],A=e[1],o=e[2];return r[0]=t[0]*n+s[0]*A+i[0]*o,r[1]=t[1]*n+s[1]*A+i[1]*o,r[2]=t[2]*n+s[2]*A+i[2]*o,r},mergeVertices(e,t,s,i){const r={},n=[],A=[],o=t?[]:null,a=s?[]:null,l=[];let c,h,u,d;const p=1e4;let f,g,m=0;for(f=0,g=e.length;f<g;f+=3)c=e[f],h=e[f+1],u=e[f+2],d=`${Math.round(c*p)}_${Math.round(h*p)}_${Math.round(u*p)}`,void 0===r[d]&&(r[d]=A.length/3,A.push(c),A.push(h),A.push(u),t&&(o.push(t[f]),o.push(t[f+1]),o.push(t[f+2])),s&&(a.push(s[m]),a.push(s[m+1]))),n[f/3]=r[d],m+=2;for(f=0,g=i.length;f<g;f++)l[f]=n[i[f]];const _={positions:A,indices:l};return o&&(_.normals=o),a&&(_.uv=a),_},buildNormals:(()=>{const e=new A(3),t=new A(3),s=new A(3),i=new A(3),r=new A(3),n=new A(3);return(A,o,a)=>{let l,c;const u=new Array(A.length/3);let d,p,f,g,m,_,b;for(l=0,c=o.length;l<c;l+=3){d=o[l],p=o[l+1],f=o[l+2],e[0]=A[3*d],e[1]=A[3*d+1],e[2]=A[3*d+2],t[0]=A[3*p],t[1]=A[3*p+1],t[2]=A[3*p+2],s[0]=A[3*f],s[1]=A[3*f+1],s[2]=A[3*f+2],h.subVec3(t,e,i),h.subVec3(s,e,r);const a=h.vec3();h.normalizeVec3(h.cross3Vec3(i,r,n),a),u[d]||(u[d]=[]),u[p]||(u[p]=[]),u[f]||(u[f]=[]),u[d].push(a),u[p].push(a),u[f].push(a)}for(a=a&&a.length===A.length?a:new Float32Array(A.length),l=0,c=u.length;l<c;l++){g=u[l].length,m=0,_=0,b=0;for(let e=0;e<g;e++)m+=u[l][e][0],_+=u[l][e][1],b+=u[l][e][2];a[3*l]=m/g,a[3*l+1]=_/g,a[3*l+2]=b/g}return a}})(),buildTangents:(()=>{const e=new A(3),t=new A(3),s=new A(3),i=new A(3),r=new A(3),n=new A(3),o=new A(3);return(A,a,l)=>{const c=new Float32Array(A.length);for(let u=0;u<a.length;u+=3){let d=a[u];const p=A.subarray(3*d,3*d+3),f=l.subarray(2*d,2*d+2);d=a[u+1];const g=A.subarray(3*d,3*d+3),m=l.subarray(2*d,2*d+2);d=a[u+2];const _=A.subarray(3*d,3*d+3),b=l.subarray(2*d,2*d+2),B=h.subVec3(g,p,e),y=h.subVec3(_,p,t),w=h.subVec2(m,f,s),v=h.subVec2(b,f,i),C=1/(w[0]*v[1]-w[1]*v[0]),M=h.mulVec3Scalar(h.subVec3(h.mulVec3Scalar(B,v[1],r),h.mulVec3Scalar(y,w[1],n),o),C,n);let E;for(let e=0;e<3;e++)E=3*a[u+e],c[E]+=M[0],c[E+1]+=M[1],c[E+2]+=M[2]}return c}})(),buildPickTriangles(e,t,s){const i=t.length,r=s?new Uint16Array(9*i):new Float32Array(9*i),n=new Uint8Array(12*i);let A,o,a,l,c,h,u=0,d=0,p=0;for(let s=0;s<i;s+=3)h=u>>24&255,c=u>>16&255,l=u>>8&255,a=255&u,o=t[s],A=3*o,r[d++]=e[A],r[d++]=e[A+1],r[d++]=e[A+2],n[p++]=a,n[p++]=l,n[p++]=c,n[p++]=h,o=t[s+1],A=3*o,r[d++]=e[A],r[d++]=e[A+1],r[d++]=e[A+2],n[p++]=a,n[p++]=l,n[p++]=c,n[p++]=h,o=t[s+2],A=3*o,r[d++]=e[A],r[d++]=e[A+1],r[d++]=e[A+2],n[p++]=a,n[p++]=l,n[p++]=c,n[p++]=h,u++;return{positions:r,colors:n}},faceToVertexNormals(e,t,s={}){const i=s.smoothNormalsAngleThreshold||20,r={},n=[],A={};let o,a,l,c,u;const d=1e4;let p,f,g,m,_,b;for(f=0,m=e.length;f<m;f+=3){p=f/3,a=e[f],l=e[f+1],c=e[f+2],u=`${Math.round(a*d)}_${Math.round(l*d)}_${Math.round(c*d)}`,void 0===r[u]?r[u]=[p]:r[u].push(p);const s=h.normalizeVec3([t[f],t[f+1],t[f+2]]);n[p]=s,o=h.vec4([s[0],s[1],s[2],1]),A[p]=o}for(u in r)if(r.hasOwnProperty(u)){const e=r[u],t=e.length;for(f=0;f<t;f++){const s=e[f];for(o=A[s],g=0;g<t;g++){if(f===g)continue;const t=e[g];_=n[s],b=n[t];Math.abs(h.angleVec3(_,b)/h.DEGTORAD)<i&&(o[0]+=b[0],o[1]+=b[1],o[2]+=b[2],o[3]+=1)}}}for(f=0,m=t.length;f<m;f+=3)o=A[f/3],t[f+0]=o[0]/o[3],t[f+1]=o[1]/o[3],t[f+2]=o[2]/o[3]},transformRay:(()=>{const e=new A(4),t=new A(4);return(s,i,r,n,A)=>{e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=1,h.transformVec4(s,e,t),n[0]=t[0],n[1]=t[1],n[2]=t[2],e[0]=r[0],e[1]=r[1],e[2]=r[2],h.transformVec3(s,e,t),h.normalizeVec3(t),A[0]=t[0],A[1]=t[1],A[2]=t[2]}})(),canvasPosToWorldRay:(()=>{const e=new A(16),t=new A(4),s=new A(4),i=(t,s,i,r,n)=>{n[0]=t,n[1]=s,n[2]=i,n[3]=1,h.transformVec4(e,n,n),r||h.mulVec4Scalar(n,1/n[3])};return(r,n,A,o,a,l,c)=>{const u="ortho"===o;h.mulMat4(A,n,e),h.inverseMat4(e,e);const d=2*a[0]/r.clientWidth-1,p=1-2*a[1]/r.clientHeight;i(d,p,-1,u,t),i(d,p,1,u,s),l[0]=t[0],l[1]=t[1],l[2]=t[2],h.subVec3(s,t,c),h.normalizeVec3(c)}})(),canvasPosToLocalRay:(()=>{const e=new A(3),t=new A(3);return(s,i,r,n,A,o,a,l)=>{h.canvasPosToWorldRay(s,i,r,n,o,e,t),h.worldRayToLocalRay(A,e,t,a,l)}})(),worldRayToLocalRay:(()=>{const e=new A(16),t=new A(4),s=new A(4);return(i,r,n,A,o)=>{const a=h.inverseMat4(i,e);t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,h.transformVec4(a,t,s),A[0]=s[0],A[1]=s[1],A[2]=s[2],h.transformVec3(a,n,o)}})(),buildKDTree:(()=>{const e=new Float32Array;function t(s,i,r,n){const o=new A(6),a={triangles:null,left:null,right:null,leaf:!1,splitDim:0,aabb:o};let l,c;for(o[0]=o[1]=o[2]=Number.POSITIVE_INFINITY,o[3]=o[4]=o[5]=Number.NEGATIVE_INFINITY,l=0,c=s.length;l<c;++l){var h=3*s[l];for(let e=0;e<3;++e){const t=3*i[h+e];r[t]<o[0]&&(o[0]=r[t]),r[t]>o[3]&&(o[3]=r[t]),r[t+1]<o[1]&&(o[1]=r[t+1]),r[t+1]>o[4]&&(o[4]=r[t+1]),r[t+2]<o[2]&&(o[2]=r[t+2]),r[t+2]>o[5]&&(o[5]=r[t+2])}}if(s.length<20||n>10)return a.triangles=s,a.leaf=!0,a;e[0]=o[3]-o[0],e[1]=o[4]-o[1],e[2]=o[5]-o[2];let u=0;e[1]>e[u]&&(u=1),e[2]>e[u]&&(u=2),a.splitDim=u;const d=(o[u]+o[u+3])/2,p=new Array(s.length);let f=0;const g=new Array(s.length);let m=0;for(l=0,c=s.length;l<c;++l){const e=i[h=3*s[l]],t=3*i[h+1],n=3*i[h+2];r[3*e+u]<=d||r[t+u]<=d||r[n+u]<=d?p[f++]=s[l]:g[m++]=s[l]}return p.length=f,g.length=m,a.left=t(p,i,r,n+1),a.right=t(g,i,r,n+1),a}return(e,s)=>{const i=e.length/3,r=new Array(i);for(let e=0;e<i;++e)r[e]=e;return t(r,e,s,0)}})(),decompressPosition(e,t,s){(s=s||e)[0]=e[0]*t[0]+t[12],s[1]=e[1]*t[5]+t[13],s[2]=e[2]*t[10]+t[14]},decompressPositions(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[12],s[i+1]=e[i+1]*t[5]+t[13],s[i+2]=e[i+2]*t[10]+t[14];return s},decompressUV(e,t,s){s[0]=e[0]*t[0]+t[6],s[1]=e[1]*t[4]+t[7]},decompressUVs(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[6],s[i+1]=e[i+1]*t[4]+t[7];return s},octDecodeVec2(e,t){let s=e[0],i=e[1];s=(2*s+1)/255,i=(2*i+1)/255;const r=1-Math.abs(s)-Math.abs(i);r<0&&(s=(1-Math.abs(i))*(s>=0?1:-1),i=(1-Math.abs(s))*(i>=0?1:-1));const n=Math.sqrt(s*s+i*i+r*r);return t[0]=s/n,t[1]=i/n,t[2]=r/n,t},octDecodeVec2s(e,t){for(let s=0,i=0,r=e.length;s<r;s+=2){let r=e[s+0],n=e[s+1];r=(2*r+1)/255,n=(2*n+1)/255;const A=1-Math.abs(r)-Math.abs(n);A<0&&(r=(1-Math.abs(n))*(r>=0?1:-1),n=(1-Math.abs(r))*(n>=0?1:-1));const o=Math.sqrt(r*r+n*n+A*A);t[i+0]=r/o,t[i+1]=n/o,t[i+2]=A/o,i+=3}return t}};h.buildEdgeIndices=function(){const e=[],t=[],s=[],i=[],r=[];let n=0;const A=new Uint16Array(3),o=new Uint16Array(3),a=new Uint16Array(3),l=h.vec3(),c=h.vec3(),u=h.vec3(),d=h.vec3(),p=h.vec3(),f=h.vec3(),g=h.vec3();return function(m,_,b,B){!function(r,n){const A={};let o,a,l,c;const h=Math.pow(10,4);let u,d,p=0;for(u=0,d=r.length;u<d;u+=3)o=r[u],a=r[u+1],l=r[u+2],c=Math.round(o*h)+"_"+Math.round(a*h)+"_"+Math.round(l*h),void 0===A[c]&&(A[c]=p/3,e[p++]=o,e[p++]=a,e[p++]=l),t[u/3]=A[c];for(u=0,d=n.length;u<d;u++)i[u]=t[n[u]],s[i[u]]=n[u]}(m,_),function(t,s){n=0;for(let m=0,_=t;m<_;m+=3){const t=3*i[m],_=3*i[m+1],b=3*i[m+2];s?(A[0]=e[t],A[1]=e[t+1],A[2]=e[t+2],o[0]=e[_],o[1]=e[_+1],o[2]=e[_+2],a[0]=e[b],a[1]=e[b+1],a[2]=e[b+2],h.decompressPosition(A,s,l),h.decompressPosition(o,s,c),h.decompressPosition(a,s,u)):(l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],c[0]=e[_],c[1]=e[_+1],c[2]=e[_+2],u[0]=e[b],u[1]=e[b+1],u[2]=e[b+2]),h.subVec3(u,c,d),h.subVec3(l,c,p),h.cross3Vec3(d,p,f),h.normalizeVec3(f,g);const B=r[n]||(r[n]={normal:h.vec3()});B.normal[0]=g[0],B.normal[1]=g[1],B.normal[2]=g[2],n++}}(_.length,b);const y=[],w=Math.cos(h.DEGTORAD*B),v={};let C,M,E,F,x,U,I,T,P,S,D,k=!1;for(let e=0,t=_.length;e<t;e+=3){const t=e/3;for(let s=0;s<3;s++)C=i[e+s],M=i[e+(s+1)%3],E=Math.min(C,M),F=Math.max(C,M),x=E+","+F,void 0===v[x]?v[x]={index1:E,index2:F,face1:t,face2:void 0}:v[x].face2=t}for(x in v)U=v[x],void 0!==U.face2&&(I=r[U.face1].normal,T=r[U.face2].normal,P=h.dotVec3(I,T),P>w)||(S=s[U.index1],D=s[U.index2],(!k&&S>65535||D>65535)&&(k=!0),y.push(S),y.push(D));return k?new Uint32Array(y):new Uint16Array(y)}}(),h.planeClipsPositions3=function(e,t,s,i=3){for(let r=0,n=s.length;r<n;r+=i){if(o[0]=s[r+0]-e[0],o[1]=s[r+1]-e[1],o[2]=s[r+2]-e[2],o[0]*t[0]+o[1]*t[1]+o[2]*t[2]<0)return!0}return!1};const u=new Float32Array(3);class d{constructor(){this._head=[],this._headLength=0,this._tail=[],this._index=0,this._length=0}get length(){return this._length}shift(){if(this._index>=this._headLength){const e=this._head;if(e.length=0,this._head=this._tail,this._tail=e,this._index=0,this._headLength=this._head.length,!this._headLength)return}const e=this._head[this._index];return this._index<0?delete this._head[this._index++]:this._head[this._index++]=void 0,this._length--,e}push(e){return this._length++,this._tail.push(e),this}unshift(e){return this._head[--this._index]=e,this._length++,this}}const p={build:{version:"0.8"},client:{browser:navigator&&navigator.userAgent?navigator.userAgent:"n/a"},components:{scenes:0,models:0,meshes:0,objects:0},memory:{meshes:0,positions:0,colors:0,normals:0,uvs:0,indices:0,textures:0,transforms:0,materials:0,programs:0},frame:{frameCount:0,fps:0,useProgram:0,bindTexture:0,bindArray:0,drawElements:0,drawArrays:0,tasksRun:0,tasksScheduled:0}};var f=[["0",10],["A",26],["a",26],["_",1],["$",1]].map((function(e){for(var t=[],s=e[0].charCodeAt(0),i=s+e[1],r=s;r<i;++r)t.push(r);return String.fromCharCode.apply(null,t)})).join("");function g(e,t){return(t&&4!==t?[0,6]:[0,6,12,18]).map((function(t){return f.substr(parseInt(e/(1<<t))%64,1)})).reverse().join("")}const m=function(){for(var e={},t=window.location.search.substring(1).split("&"),s=0;s<t.length;s++){var i=t[s].split("=");if(void 0===e[i[0]])e[i[0]]=decodeURIComponent(i[1]);else if("string"==typeof e[i[0]]){var r=[e[i[0]],decodeURIComponent(i[1])];e[i[0]]=r}else e[i[0]].push(decodeURIComponent(i[1]))}return e}();const _={xmlToJson:function e(t,s){if(t.nodeType===t.TEXT_NODE){var i=t.nodeValue;if(null===i.match(/^\s+$/))return i}else if(t.nodeType===t.ELEMENT_NODE||t.nodeType===t.DOCUMENT_NODE){var r={type:t.nodeName,children:[]};if(t.nodeType===t.ELEMENT_NODE)for(var n=0;n<t.attributes.length;n++){var A=t.attributes[n];r[s[A.nodeName]||A.nodeName]=A.nodeValue}for(var o=0;o<t.childNodes.length;o++){(n=e(t.childNodes[o],s))&&r.children.push(n)}return r}},clone:function(e){return JSON.parse(JSON.stringify(e))},compressGuid:function(e){var t=[0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30].map((function(t){return parseInt(e.substr(t,2),16)}));return g(t[0],2)+[1,4,7,10,13].map((function(e){return g((t[e]<<16)+(t[e+1]<<8)+t[e+2])})).join("")},findNodeOfType:function(e,t){var s=[],i=function(e){e.type===t&&s.push(e),(e.children||[]).forEach((function(e){i(e)}))};return i(e),s},timeout:function(e){return new Promise((function(t,s){setTimeout(t,e)}))},httpRequest:function(e){return new Promise((function(t,s){var i=new XMLHttpRequest;i.open(e.method||"GET",e.url,!0),i.onload=function(e){4===i.readyState&&(200===i.status?t(i.responseXML):s(i.statusText))},i.send(null)}))},loadJSON:function(e,t,s){var i=e=>{};t=t||i,s=s||i;var r=new XMLHttpRequest;r.overrideMimeType("application/json"),r.open("GET",e,!0),r.addEventListener("load",(function(e){var i=e.target.response;if(200===this.status){var r;try{r=JSON.parse(i)}catch(e){s(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}t(r)}else if(0===this.status){console.warn("loadFile: HTTP Status 0 received.");try{t(JSON.parse(i))}catch(e){s(`utils.loadJSON(): Failed to parse JSON response - ${e}`)}}else s(e)}),!1),r.addEventListener("error",(function(e){s(e)}),!1),r.send(null)},loadArraybuffer:function(e,t,s){var i=e=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var n=r[3];n=window.decodeURIComponent(n),e&&(n=window.atob(n));try{const e=new ArrayBuffer(n.length),s=new Uint8Array(e);for(var A=0;A<n.length;A++)s[A]=n.charCodeAt(A);F.scheduleTask((()=>{t(e)}))}catch(e){F.scheduleTask((()=>{s(e)}))}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("loadArrayBuffer error : "+i.response))},i.send(null)}},queryString:m,isArray:function(e){return e&&!e.propertyIsEnumerable("length")&&"object"==typeof e&&"number"==typeof e.length},isString:function(e){return"string"==typeof e||e instanceof String},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},isID:function(e){return _.isString(e)||_.isNumeric(e)},isSameComponent:function(e,t){return!(!e||!t)&&(_.isNumeric(e)||_.isString(e)?`${e}`:e.id)===(_.isNumeric(t)||_.isString(t)?`${t}`:t.id)},isFunction:function(e){return"function"==typeof e},isObject:function(e){const t={}.constructor;return!!e&&e.constructor===t},copy:function(e){return _.apply(e,{})},apply:function(e,t){for(const s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},apply2:function(e,t){for(const s in e)e.hasOwnProperty(s)&&void 0!==e[s]&&null!==e[s]&&(t[s]=e[s]);return t},applyIf:function(e,t){for(const s in e)e.hasOwnProperty(s)&&(void 0!==t[s]&&null!==t[s]||(t[s]=e[s]));return t},isEmptyObject:function(e){for(const t in e)if(e.hasOwnProperty(t))return!1;return!0},inQuotes:function(e){return _.isNumeric(e)?`${e}`:`'${e}'`},concat:function(e,t){const s=new e.constructor(e.length+t.length);return s.set(e),s.set(t,e.length),s},flattenParentChildHierarchy:function(e){var t=[];return function e(s){s.id=s.uuid,delete s.oid,t.push(s);var i=s.children;if(i)for(var r=0,n=i.length;r<n;r++){i[r].parent=s.id,e(i[r])}s.children=[]}(e),t}},b={},B=new e,y=new d,w={sceneId:null,time:null,startTime:null,prevTime:null,deltaTime:null},v=[];let C,M=0,E=0;const F=new function(){this.version="1.0.0",this.scenes={},this._superTypes={},this._addScene=function(e){if(e.id){if(F.scenes[e.id])return void console.error(`[ERROR] Scene ${_.inQuotes(e.id)} already exists`)}else e.id=B.addItem({});F.scenes[e.id]=e;const t=e.ticksPerOcclusionTest,s=e.ticksPerRender;b[e.id]={ticksPerOcclusionTest:t,ticksPerRender:s,renderCountdown:s},p.components.scenes++,e.once("destroyed",(()=>{B.removeItem(e.id),delete F.scenes[e.id],delete b[e.id],p.components.scenes--}))},this.clear=function(){let e;for(const t in F.scenes)F.scenes.hasOwnProperty(t)&&(e=F.scenes[t],"default.scene"===t?e.clear():(e.destroy(),delete F.scenes[e.id]))},this.scheduleTask=function(e,t=null){y.push(e),y.push(t)},this.runTasks=function(e=-1){let t,s,i=(new Date).getTime(),r=0;for(;y.length>0&&(e<0||i<e);)t=y.shift(),s=y.shift(),s?t.call(s):t(),i=(new Date).getTime(),r++;return r},this.getNumTasks=function(){return y.length}},x=function(){let e=Date.now();if(C=e-M,M>0&&C>0){var t=1e3/C;E+=t,v.push(t),v.length>=30&&(E-=v.shift()),p.frame.fps=Math.round(E/v.length)}for(let e in F.scenes)F.scenes[e].compile();I(e),M=e};!function(e,t){let s=Date.now()+t;(function i(){const r=Date.now()-s;e(),s+=t,setTimeout(i,Math.max(0,t-r))})()}((()=>{x()}),100);const U=function(){let e=Date.now();if(C=e-M,M>0&&C>0){var t=1e3/C;E+=t,v.push(t),v.length>=30&&(E-=v.shift()),p.frame.fps=Math.round(E/v.length)}I(e),function(e){for(var t in w.time=e,F.scenes)if(F.scenes.hasOwnProperty(t)){var s=F.scenes[t];w.sceneId=t,w.startTime=s.startTime,w.deltaTime=null!=w.prevTime?w.time-w.prevTime:0,s.fire("tick",w,!0)}w.prevTime=e}(e),function(){const e=F.scenes,t=!1;let s,i,r,n,A;for(A in e)e.hasOwnProperty(A)&&(s=e[A],i=b[A],i||(i=b[A]={}),r=s.ticksPerOcclusionTest,i.ticksPerOcclusionTest!==r&&(i.ticksPerOcclusionTest=r,i.renderCountdown=r),--s.occlusionTestCountdown<=0&&(s.doOcclusionTest(),s.occlusionTestCountdown=r),n=s.ticksPerRender,i.ticksPerRender!==n&&(i.ticksPerRender=n,i.renderCountdown=n),0==--i.renderCountdown&&(s.render(t),i.renderCountdown=n))}(),void 0!==window.requestPostAnimationFrame?window.requestPostAnimationFrame(x):requestAnimationFrame(U)};function I(e){const t=F.runTasks(e+10),s=F.getNumTasks();p.frame.tasksRun=t,p.frame.tasksScheduled=s,p.frame.tasksBudget=10}U();class T{get type(){return"Component"}get isComponent(){return!0}constructor(e=null,t={}){if(this.scene=null,"Scene"===this.type)this.scene=this,this.viewer=t.viewer;else{if("Scene"===e.type)this.scene=e;else{if(!(e instanceof T))throw"Invalid param: owner must be a Component";this.scene=e.scene}this._owner=e}this._dontClear=!!t.dontClear,this._renderer=this.scene._renderer,this.meta=t.meta||{},this.id=t.id,this.destroyed=!1,this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this!==this.scene&&this.scene._addComponent(this),this._updateScheduled=!1,e&&e._own(this)}glRedraw(){this._renderer&&(this._renderer.imageDirty(),this.castsShadow&&this._renderer.shadowsDirty())}glResort(){this._renderer&&this._renderer.needStateSort()}get owner(){return this._owner}isType(e){return this.type===e}fire(e,t,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==s&&(this._events[e]=t||!0);const i=this._eventSubs[e];let r;if(i)for(const s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(t,s,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new e),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[t];r?this._eventSubsNum[t]++:(r={},this._eventSubs[t]=r,this._eventSubsNum[t]=1);const n=this._subIdMap.addItem();r[n]={callback:s,scope:i||this},this._subIdEvents[n]=t;const A=this._events[t];return void 0!==A&&s.call(i||this,A),n}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const s=this._eventSubs[t];s&&(delete s[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,s){const i=this,r=this.on(e,(function(e){i.off(r),t.call(s||this,e)}),s)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){e="[LOG]"+this._message(e),window.console.log(e),this.scene.fire("log",e)}_message(e){return" ["+this.type+" "+_.inQuotes(this.id)+"]: "+e}warn(e){e="[WARN]"+this._message(e),window.console.warn(e),this.scene.fire("warn",e)}error(e){e="[ERROR]"+this._message(e),window.console.error(e),this.scene.fire("error",e)}_attach(e){const t=e.name;if(!t)return void this.error("Component 'name' expected");let s=e.component;const i=e.sceneDefault,r=e.sceneSingleton,n=e.type,A=e.on,o=!1!==e.recompiles;if(s&&(_.isNumeric(s)||_.isString(s))){const e=s;if(s=this.scene.components[e],!s)return void this.error("Component not found: "+_.inQuotes(e))}if(!s)if(!0===r){const e=this.scene.types[n];for(const t in e)if(e.hasOwnProperty){s=e[t];break}if(!s)return this.error("Scene has no default component for '"+t+"'"),null}else if(!0===i&&(s=this.scene[t],!s))return this.error("Scene has no default component for '"+t+"'"),null;if(s){if(s.scene.id!==this.scene.id)return void this.error("Not in same scene: "+s.type+" "+_.inQuotes(s.id));if(n&&!s.isType(n))return void this.error("Expected a "+n+" type or subtype: "+s.type+" "+_.inQuotes(s.id))}this._attachments||(this._attachments={});const a=this._attached[t];let l,c,h;if(a){if(s&&a.id===s.id)return;const e=this._attachments[a.id];for(l=e.subs,c=0,h=l.length;c<h;c++)a.off(l[c]);delete this._attached[t],delete this._attachments[a.id];const i=e.params.onDetached;i&&(_.isFunction(i)?i(a):i.scope?i.callback.call(i.scope,a):i.callback(a)),e.managingLifecycle&&a.destroy()}if(s){const i={params:e,component:s,subs:[],managingLifecycle:false};i.subs.push(s.once("destroyed",(function(){i.params.component=null,this._attach(i.params)}),this)),o&&i.subs.push(s.on("dirty",(function(){this.fire("dirty",this)}),this)),this._attached[t]=s,this._attachments[s.id]=i;const r=e.onAttached;if(r&&(_.isFunction(r)?r(s):r.scope?r.callback.call(r.scope,s):r.callback(s)),A){let e,t,r,n;for(e in A)if(A.hasOwnProperty(e)){if(t=A[e],_.isFunction(t)?(r=t,n=null):(r=t.callback,n=t.scope),!r)continue;i.subs.push(s.on(e,r,n))}}}return o&&this.fire("dirty",this),this.fire(t,s),s}_checkComponent(e,t){if(!t.isComponent){if(!_.isID(t))return void this.error("Expected a Component or ID");{const e=t;if(!(t=this.scene.components[e]))return void this.error("Component not found: "+e)}}if(e===t.type){if(t.scene.id===this.scene.id)return t;this.error("Not in same scene: "+t.type)}else this.error("Expected a "+e+" Component")}_checkComponent2(e,t){if(!t.isComponent){if(!_.isID(t))return void this.error("Expected a Component or ID");{const e=t;if(!(t=this.scene.components[e]))return void this.error("Component not found: "+e)}}if(t.scene.id===this.scene.id){for(var s=0,i=e.length;s<i;s++)if(e[s]===t.type)return t;return this.error("Expected component types: "+e),null}this.error("Not in same scene: "+t.type)}_own(e){this._ownedComponents||(this._ownedComponents={}),this._ownedComponents[e.id]||(this._ownedComponents[e.id]=e),e.once("destroyed",(()=>{delete this._ownedComponents[e.id]}),this)}_needUpdate(e){this._updateScheduled||(this._updateScheduled=!0,0===e?this._doUpdate():F.scheduleTask(this._doUpdate,this))}_doUpdate(){this._updateScheduled&&(this._updateScheduled=!1,this._update&&this._update())}scheduleTask(e){F.scheduleTask(e,null)}_update(){}clear(){if(this._ownedComponents)for(var e in this._ownedComponents)if(this._ownedComponents.hasOwnProperty(e)){this._ownedComponents[e].destroy(),delete this._ownedComponents[e]}}destroy(){if(this.destroyed)return;let e,t,s,i,r,n;if(this.fire("destroyed",this.destroyed=!0),this._attachments)for(e in this._attachments)if(this._attachments.hasOwnProperty(e)){for(t=this._attachments[e],s=t.component,i=t.subs,r=0,n=i.length;r<n;r++)s.off(i[r]);t.managingLifecycle&&s.destroy()}if(this._ownedComponents)for(e in this._ownedComponents)this._ownedComponents.hasOwnProperty(e)&&(s=this._ownedComponents[e],s.destroy(),delete this._ownedComponents[e]);this.scene._removeComponent(this),this._attached={},this._attachments=null,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._events=null,this._eventCallDepth=0,this._ownedComponents=null,this._updateScheduled=!1}}const P=h.vec3(),S=h.vec3(),D=h.mat4();class k{constructor(){this.normal=h.vec3(),this.offset=0,this.testVertex=h.vec3()}set(e,t,s,i){const r=1/Math.sqrt(e*e+t*t+s*s);this.normal[0]=e*r,this.normal[1]=t*r,this.normal[2]=s*r,this.offset=i*r,this.testVertex[0]=this.normal[0]>=0?1:0,this.testVertex[1]=this.normal[1]>=0?1:0,this.testVertex[2]=this.normal[2]>=0?1:0}}class Q{constructor(){this.planes=[new k,new k,new k,new k,new k,new k]}}function R(e,t,s){const i=h.mulMat4(s,t,D),r=i[0],n=i[1],A=i[2],o=i[3],a=i[4],l=i[5],c=i[6],u=i[7],d=i[8],p=i[9],f=i[10],g=i[11],m=i[12],_=i[13],b=i[14],B=i[15];e.planes[0].set(o-r,u-a,g-d,B-m),e.planes[1].set(o+r,u+a,g+d,B+m),e.planes[2].set(o-n,u-l,g-p,B-_),e.planes[3].set(o+n,u+l,g+p,B+_),e.planes[4].set(o-A,u-c,g-f,B-b),e.planes[5].set(o+A,u+c,g+f,B+b)}function O(e,t){let s=Q.INSIDE;const i=P,r=S;i[0]=t[0],i[1]=t[1],i[2]=t[2],r[0]=t[3],r[1]=t[4],r[2]=t[5];const n=[i,r];for(let t=0;t<6;++t){const i=e.planes[t];if(i.normal[0]*n[i.testVertex[0]][0]+i.normal[1]*n[i.testVertex[1]][1]+i.normal[2]*n[i.testVertex[2]][2]+i.offset<0)return Q.OUTSIDE;i.normal[0]*n[1-i.testVertex[0]][0]+i.normal[1]*n[1-i.testVertex[1]][1]+i.normal[2]*n[1-i.testVertex[2]][2]+i.offset<0&&(s=Q.INTERSECT)}return s}Q.INSIDE=0,Q.INTERSECT=1,Q.OUTSIDE=2;class V extends T{constructor(e={}){if(!e.viewer)throw"[MarqueePicker] Missing config: viewer";if(!e.objectsKdTree3)throw"[MarqueePicker] Missing config: objectsKdTree3";super(e.viewer.scene,e),this.viewer=e.viewer,this._objectsKdTree3=e.objectsKdTree3,this._canvasMarqueeCorner1=h.vec2(),this._canvasMarqueeCorner2=h.vec2(),this._canvasMarquee=h.AABB2(),this._marqueeFrustum=new Q,this._marqueeFrustumProjMat=h.mat4(),this._pickMode=!1,this._marqueeElement=document.createElement("div"),document.body.appendChild(this._marqueeElement),this._marqueeElement.style.position="absolute",this._marqueeElement.style["z-index"]="40000005",this._marqueeElement.style.width="8px",this._marqueeElement.style.height="8px",this._marqueeElement.style.visibility="hidden",this._marqueeElement.style.top="0px",this._marqueeElement.style.left="0px",this._marqueeElement.style["box-shadow"]="0 2px 5px 0 #182A3D;",this._marqueeElement.style.opacity=1,this._marqueeElement.style["pointer-events"]="none"}setMarqueeCorner1(e){this._canvasMarqueeCorner1.set(e),this._canvasMarqueeCorner2.set(e),this._updateMarquee()}setMarqueeCorner2(e){this._canvasMarqueeCorner2.set(e),this._updateMarquee()}setMarquee(e,t){this._canvasMarqueeCorner1.set(e),this._canvasMarqueeCorner2.set(t),this._updateMarquee()}setMarqueeVisible(e){this._marqueVisible=e,this._marqueeElement.style.visibility=e?"visible":"hidden"}getMarqueeVisible(){return this._marqueVisible}setPickMode(e){if(e!==V.PICK_MODE_INSIDE&&e!==V.PICK_MODE_INTERSECTS)throw"Illegal MarqueePicker pickMode: must be MarqueePicker.PICK_MODE_INSIDE or MarqueePicker.PICK_MODE_INTERSECTS";e!==this._pickMode&&(this._marqueeElement.style["background-image"]=e===V.PICK_MODE_INSIDE?"url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='6' ry='6' stroke='%23333' stroke-width='4'/%3e%3c/svg%3e\")":"url(\"data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='6' ry='6' stroke='%23333' stroke-width='4' stroke-dasharray='6%2c 14' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e\")",this._pickMode=e)}getPickMode(){return this._pickMode}clear(){this.fire("clear",{})}pick(){this._updateMarquee(),this._buildMarqueeFrustum();const e=[],t=(s,i=Q.INTERSECT)=>{if(i===Q.INTERSECT&&(i=O(this._marqueeFrustum,s.aabb)),i!==Q.OUTSIDE){if(s.entities){const t=s.entities;for(let s=0,i=t.length;s<i;s++){const i=t[s];if(!i.visible)continue;const r=i.aabb;if(this._pickMode===V.PICK_MODE_INSIDE){O(this._marqueeFrustum,r)===Q.INSIDE&&e.push(i.id)}else{O(this._marqueeFrustum,r)!==Q.OUTSIDE&&e.push(i.id)}}}s.left&&t(s.left,i),s.right&&t(s.right,i)}};return(this._canvasMarquee[2]-this._canvasMarquee[0]>3||this._canvasMarquee[3]-this._canvasMarquee[1]>3)&&t(this._objectsKdTree3.root),this.fire("picked",e),e}_updateMarquee(){this._canvasMarquee[0]=Math.min(this._canvasMarqueeCorner1[0],this._canvasMarqueeCorner2[0]),this._canvasMarquee[1]=Math.min(this._canvasMarqueeCorner1[1],this._canvasMarqueeCorner2[1]),this._canvasMarquee[2]=Math.max(this._canvasMarqueeCorner1[0],this._canvasMarqueeCorner2[0]),this._canvasMarquee[3]=Math.max(this._canvasMarqueeCorner1[1],this._canvasMarqueeCorner2[1]),this._marqueeElement.style.width=this._canvasMarquee[2]-this._canvasMarquee[0]+"px",this._marqueeElement.style.height=this._canvasMarquee[3]-this._canvasMarquee[1]+"px",this._marqueeElement.style.left=`${this._canvasMarquee[0]}px`,this._marqueeElement.style.top=`${this._canvasMarquee[1]}px`}_buildMarqueeFrustum(){const e=this.viewer.scene.canvas.canvas,t=e.clientWidth,s=e.clientHeight,i=e.clientLeft,r=e.clientTop,n=2/t,A=2/s,o=e.clientHeight/e.clientWidth,a=(this._canvasMarquee[0]-i)*n-1,l=(this._canvasMarquee[2]-i)*n-1,c=-(this._canvasMarquee[3]-r)*A+1,u=-(this._canvasMarquee[1]-r)*A+1,d=this.viewer.scene.camera.frustum.near*(17*o);h.frustumMat4(a,l,c*o,u*o,d,1e4,this._marqueeFrustumProjMat),R(this._marqueeFrustum,this.viewer.scene.camera.viewMatrix,this._marqueeFrustumProjMat)}destroy(){super.destroy(),this._marqueeElement.parentElement&&(this._marqueeElement.parentElement.removeChild(this._marqueeElement),this._marqueeElement=null,this._objectsKdTree3=null)}}V.PICK_MODE_INTERSECTS=0,V.PICK_MODE_INSIDE=1;class L{constructor(e,t={}){this.viewer=e,this.scene=this.viewer.scene,this._circleDiv=document.createElement("div"),this.viewer.scene.canvas.canvas.parentNode.insertBefore(this._circleDiv,this.viewer.scene.canvas.canvas),this._circleDiv.style.backgroundColor="transparent",this._circleDiv.style.border="2px solid green",this._circleDiv.style.borderRadius="50px",this._circleDiv.style.width="50px",this._circleDiv.style.height="50px",this._circleDiv.style.margin="-200px -200px",this._circleDiv.style.zIndex="100000",this._circleDiv.style.position="absolute",this._circleDiv.style.pointerEvents="none",this._circlePos=null,this._circleMaxRadius=200,this._circleMinRadius=2,this._active=!1!==t.active,this._visible=!1,this._running=!1,this._destroyed=!1}start(e){if(this._destroyed)return;this._circlePos=e,this._running=!1,this._circleRadius=this._circleMaxRadius,this._circleDiv.style.borderRadius=`${this._circleRadius}px`,this._circleDiv.style.marginLeft=this._circlePos[0]-this._circleRadius+"px",this._circleDiv.style.marginTop=this._circlePos[1]-this._circleRadius+"px";const t=this._circleMaxRadius;let s;const i=e=>{if(!this._running)return;s||(s=e);const r=e-s,n=Math.min(r/300,1),A=t+(2-t)*n;this._circleRadius=A,this._circleDiv.style.width=`${this._circleRadius}px`,this._circleDiv.style.height=`${this._circleRadius}px`,this._circleDiv.style.marginLeft=this._circlePos[0]-this._circleRadius/2+"px",this._circleDiv.style.marginTop=this._circlePos[1]-this._circleRadius/2+"px",n<1&&requestAnimationFrame(i)};this._running=!0,requestAnimationFrame(i),this._circleDiv.style.visibility="visible"}stop(){this._destroyed||(this._running=!1,this._circleRadius=this._circleMaxRadius,this._circleDiv.style.borderRadius=`${this._circleRadius}px`,this._circleDiv.style.visibility="hidden")}set durationMs(e){this.stop(),this._durationMs=e}get durationMs(){return this._durationMs}destroy(){this._destroyed||(this.stop(),this._circleDiv.parentElement.removeChild(this._circleDiv),this._destroyed=!0)}}class H{constructor(e={}){this._eventSubIDMap=null,this._eventSubEvents=null,this._eventSubs=null,this._events=null,this._locale="en",this._messages={},this._locales=[],this._locale="en",this.messages=e.messages,this.locale=e.locale}set messages(e){this._messages=e||{},this._locales=Object.keys(this._messages),this.fire("updated",this)}loadMessages(e={}){for(let t in e)this._messages[t]=e[t];this.messages=this._messages}clearMessages(){this.messages={}}get locales(){return this._locales}set locale(e){e=e||"de",this._locale!==e&&(this._locale=e,this.fire("updated",e))}get locale(){return this._locale}translate(e,t){const s=this._messages[this._locale];if(!s)return null;const i=N(e,s);return i?t?G(i,t):i:null}translatePlurals(e,t,s){const i=this._messages[this._locale];if(!i)return null;let r=N(e,i);return r=0===(t=parseInt(""+t,10))?r.zero:t>1?r.other:r.one,r?(r=G(r,[t]),s&&(r=G(r,s)),r):null}fire(e,t,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={}),!0!==s&&(this._events[e]=t||!0);const i=this._eventSubs[e];if(i)for(const e in i)if(i.hasOwnProperty(e)){i[e].callback(t)}}on(t,s){this._events||(this._events={}),this._eventSubIDMap||(this._eventSubIDMap=new e),this._eventSubEvents||(this._eventSubEvents={}),this._eventSubs||(this._eventSubs={});let i=this._eventSubs[t];i||(i={},this._eventSubs[t]=i);const r=this._eventSubIDMap.addItem();i[r]={callback:s},this._eventSubEvents[r]=t;const n=this._events[t];return void 0!==n&&s(n),r}off(e){if(null==e)return;if(!this._eventSubEvents)return;const t=this._eventSubEvents[e];if(t){delete this._eventSubEvents[e];const s=this._eventSubs[t];s&&delete s[e],this._eventSubIDMap.removeItem(e)}}}function N(e,t){if(t[e])return t[e];const s=e.split(".");let i=t;for(let e=0,t=s.length;i&&e<t;e++){i=i[s[e]]}return i}function G(e,t=[]){return e.replace(/\{\{|\}\}|\{(\d+)\}/g,(function(e,s){return"{{"===e?"{":"}}"===e?"}":t[s]}))}class j extends T{constructor(e,t={}){super(e,t),this.t=t.t}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get tangent(){return this.getTangent(this._t)}get length(){var e=this._getLengths();return e[e.length-1]}getTangent(e){var t=1e-4;void 0===e&&(e=this._t);var s=e-t,i=e+t;s<0&&(s=0),i>1&&(i=1);var r=this.getPoint(s),n=this.getPoint(i),A=h.subVec3(n,r,[]);return h.normalizeVec3(A,[])}getPointAt(e){var t=this.getUToTMapping(e);return this.getPoint(t)}getPoints(e){e||(e=5);var t,s=[];for(t=0;t<=e;t++)s.push(this.getPoint(t/e));return s}_getLengths(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,s,i=[],r=this.getPoint(0),n=0;for(i.push(0),s=1;s<=e;s++)t=this.getPoint(s/e),n+=h.lenVec3(h.subVec3(t,r,[])),i.push(n),r=t;return this.cacheArcLengths=i,i}_updateArcLengths(){this.needsUpdate=!0,this._getLengths()}getUToTMapping(e,t){var s,i=this._getLengths(),r=0,n=i.length;s=t||e*i[n-1];for(var A,o=0,a=n-1;o<=a;)if((A=i[r=Math.floor(o+(a-o)/2)]-s)<0)o=r+1;else{if(!(A>0)){a=r;break}a=r-1}if(i[r=a]===s)return r/(n-1);var l=i[r];return(r+(s-l)/(i[r+1]-l))/(n-1)}}class W extends j{constructor(e,t={}){super(e,t),this.points=t.points,this.t=t.t}set points(e){this._points=e||[]}get points(){return this._points}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=this.points;if(!(t.length<3)){var s=(t.length-1)*e,i=Math.floor(s),r=s-i,n=t[0===i?i:i-1],A=t[i],o=t[i>t.length-2?t.length-1:i+1],a=t[i>t.length-3?t.length-1:i+2],l=h.vec3();return l[0]=h.catmullRomInterpolate(n[0],A[0],o[0],a[0],r),l[1]=h.catmullRomInterpolate(n[1],A[1],o[1],a[1],r),l[2]=h.catmullRomInterpolate(n[2],A[2],o[2],a[2],r),l}this.error("Can't sample point from SplineCurve - not enough points on curve - returning [0,0,0].")}getJSON(){return{points:points,t:this._t}}}const z=h.vec3();const X=h.vec3(),K=h.vec3(),Z=h.vec3(),J=h.vec3(),Y=h.vec3();class $ extends T{get type(){return"CameraFlightAnimation"}constructor(e,t={}){super(e,t),this._look1=h.vec3(),this._eye1=h.vec3(),this._up1=h.vec3(),this._look2=h.vec3(),this._eye2=h.vec3(),this._up2=h.vec3(),this._orthoScale1=1,this._orthoScale2=1,this._flying=!1,this._flyEyeLookUp=!1,this._flyingEye=!1,this._flyingLook=!1,this._callback=null,this._callbackScope=null,this._time1=null,this._time2=null,this.easing=!1!==t.easing,this.duration=t.duration,this.fit=t.fit,this.fitFOV=t.fitFOV,this.trail=t.trail}flyTo(e,t,s){e=e||this.scene,this._flying&&this.stop(),this._flying=!1,this._flyingEye=!1,this._flyingLook=!1,this._flyingEyeLookUp=!1,this._callback=t,this._callbackScope=s;const i=this.scene.camera,r=!!e.projection&&e.projection!==i.projection;let n,A,o,a,l;if(this._eye1[0]=i.eye[0],this._eye1[1]=i.eye[1],this._eye1[2]=i.eye[2],this._look1[0]=i.look[0],this._look1[1]=i.look[1],this._look1[2]=i.look[2],this._up1[0]=i.up[0],this._up1[1]=i.up[1],this._up1[2]=i.up[2],this._orthoScale1=i.ortho.scale,this._orthoScale2=e.orthoScale||this._orthoScale1,e.aabb)n=e.aabb;else if(6===e.length)n=e;else if(e.eye&&e.look||e.up)A=e.eye,o=e.look,a=e.up;else if(e.eye)A=e.eye;else if(e.look)o=e.look;else{let i=e;if((_.isNumeric(i)||_.isString(i))&&(l=i,i=this.scene.components[l],!i))return this.error("Component not found: "+_.inQuotes(l)),void(t&&(s?t.call(s):t()));r||(n=i.aabb||this.scene.aabb)}const c=e.poi;if(n){if(n[3]<n[0]||n[4]<n[1]||n[5]<n[2])return;if(n[3]===n[0]&&n[4]===n[1]&&n[5]===n[2])return;n=n.slice();const t=h.getAABB3Center(n);this._look2=c||t;const s=h.subVec3(this._eye1,this._look1,X),i=h.normalizeVec3(s),r=c?h.getAABB3DiagPoint(n,c):h.getAABB3Diag(n),A=e.fitFOV||this._fitFOV,o=Math.abs(r/Math.tan(A*h.DEGTORAD));this._orthoScale2=1.1*r,this._eye2[0]=this._look2[0]+i[0]*o,this._eye2[1]=this._look2[1]+i[1]*o,this._eye2[2]=this._look2[2]+i[2]*o,this._up2[0]=this._up1[0],this._up2[1]=this._up1[1],this._up2[2]=this._up1[2],this._flyingEyeLookUp=!0}else(A||o||a)&&(this._flyingEyeLookUp=!!A&&!!o&&!!a,this._flyingEye=!!A&&!o,this._flyingLook=!!o&&!A,A&&(this._eye2[0]=A[0],this._eye2[1]=A[1],this._eye2[2]=A[2]),o&&(this._look2[0]=o[0],this._look2[1]=o[1],this._look2[2]=o[2]),a&&(this._up2[0]=a[0],this._up2[1]=a[1],this._up2[2]=a[2]));r?("ortho"===e.projection&&"ortho"!==i.projection&&(this._projection2="ortho",this._projMatrix1=i.projMatrix.slice(),this._projMatrix2=i.ortho.matrix.slice(),i.projection="customProjection"),"perspective"===e.projection&&"perspective"!==i.projection&&(this._projection2="perspective",this._projMatrix1=i.projMatrix.slice(),this._projMatrix2=i.perspective.matrix.slice(),i.projection="customProjection")):this._projection2=null,this.fire("started",e,!0),this._time1=Date.now(),this._time2=this._time1+(Number.isFinite(e.duration)?1e3*e.duration:this._duration),this._flying=!0,F.scheduleTask(this._update,this)}jumpTo(e){this._jumpTo(e)}_jumpTo(e){this._flying&&this.stop();const t=this.scene.camera;var s,i,r,n,A;if(e.aabb)s=e.aabb;else if(6===e.length)s=e;else if(e.eye||e.look||e.up)r=e.eye,n=e.look,A=e.up;else{let t=e;if((_.isNumeric(t)||_.isString(t))&&(i=t,t=this.scene.components[i],!t))return void this.error("Component not found: "+_.inQuotes(i));s=t.aabb||this.scene.aabb}const o=e.poi;if(s){if(s[3]<=s[0]||s[4]<=s[1]||s[5]<=s[2])return;var a=o?h.getAABB3DiagPoint(s,o):h.getAABB3Diag(s);let i;n=o||h.getAABB3Center(s,n),this._trail?h.subVec3(t.look,n,Y):h.subVec3(t.eye,t.look,Y),h.normalizeVec3(Y);i=(void 0!==e.fit?e.fit:this._fit)?Math.abs(a/Math.tan((e.fitFOV||this._fitFOV)*h.DEGTORAD)):h.lenVec3(h.subVec3(t.eye,t.look,X)),h.mulVec3Scalar(Y,i),t.eye=h.addVec3(n,Y,X),t.look=n,this.scene.camera.ortho.scale=1.1*a}else(r||n||A)&&(r&&(t.eye=r),n&&(t.look=n),A&&(t.up=A));e.projection&&(t.projection=e.projection)}_update(){if(!this._flying)return;let e=(Date.now()-this._time1)/(this._time2-this._time1);const t=e>=1;e>1&&(e=1);const s=this.easing?$._ease(e,0,1,1):e,i=this.scene.camera;if(this._flyingEye||this._flyingLook?this._flyingEye?(h.subVec3(i.eye,i.look,Y),i.eye=h.lerpVec3(s,0,1,this._eye1,this._eye2,Z),i.look=h.subVec3(Z,Y,K)):this._flyingLook&&(i.look=h.lerpVec3(s,0,1,this._look1,this._look2,K),i.up=h.lerpVec3(s,0,1,this._up1,this._up2,J)):this._flyingEyeLookUp&&(i.eye=h.lerpVec3(s,0,1,this._eye1,this._eye2,Z),i.look=h.lerpVec3(s,0,1,this._look1,this._look2,K),i.up=h.lerpVec3(s,0,1,this._up1,this._up2,J)),this._projection2){const t="ortho"===this._projection2?$._easeOutExpo(e,0,1,1):$._easeInCubic(e,0,1,1);i.customProjection.matrix=h.lerpMat4(t,0,1,this._projMatrix1,this._projMatrix2)}else i.ortho.scale=this._orthoScale1+e*(this._orthoScale2-this._orthoScale1);if(t)return i.ortho.scale=this._orthoScale2,void this.stop();F.scheduleTask(this._update,this)}static _ease(e,t,s,i){return-s*(e/=i)*(e-2)+t}static _easeInCubic(e,t,s,i){return s*(e/=i)*e*e+t}static _easeOutExpo(e,t,s,i){return s*(1-Math.pow(2,-10*e/i))+t}stop(){if(!this._flying)return;this._flying=!1,this._time1=null,this._time2=null,this._projection2&&(this.scene.camera.projection=this._projection2);const e=this._callback;e&&(this._callback=null,this._callbackScope?e.call(this._callbackScope):e()),this.fire("stopped",!0,!0)}cancel(){this._flying&&(this._flying=!1,this._time1=null,this._time2=null,this._callback&&(this._callback=null),this.fire("canceled",!0,!0))}set duration(e){this._duration=Number.isFinite(e)?1e3*e:500,this.stop()}get duration(){return this._duration/1e3}set fit(e){this._fit=!1!==e}get fit(){return this._fit}set fitFOV(e){this._fitFOV=e||45}get fitFOV(){return this._fitFOV}set trail(e){this._trail=!!e}get trail(){return this._trail}destroy(){this.stop(),super.destroy()}}class q extends T{get type(){return"CameraPathAnimation"}constructor(e,t={}){super(e,t),this._cameraFlightAnimation=new $(this),this._t=0,this.state=q.SCRUBBING,this._playingFromT=0,this._playingToT=0,this._playingRate=t.playingRate||1,this._playingDir=1,this._lastTime=null,this.cameraPath=t.cameraPath,this._tick=this.scene.on("tick",this._updateT,this)}_updateT(){const e=this._cameraPath;if(!e)return;let t,s;const i=performance.now(),r=this._lastTime?.001*(i-this._lastTime):0;if(this._lastTime=i,0!==r)switch(this.state){case q.SCRUBBING:return;case q.PLAYING:if(this._t+=this._playingRate*r,t=this._cameraPath.frames.length,0===t||this._playingDir<0&&this._t<=0||this._playingDir>0&&this._t>=this._cameraPath.frames[t-1].t)return this.state=q.SCRUBBING,this._t=this._cameraPath.frames[t-1].t,void this.fire("stopped");e.loadFrame(this._t);break;case q.PLAYING_TO:s=this._t+this._playingRate*r*this._playingDir,(this._playingDir<0&&s<=this._playingToT||this._playingDir>0&&s>=this._playingToT)&&(s=this._playingToT,this.state=q.SCRUBBING,this.fire("stopped")),this._t=s,e.loadFrame(this._t)}}_ease(e,t,s,i){return-s*(e/=i)*(e-2)+t}set cameraPath(e){this._cameraPath=e}get cameraPath(){return this._cameraPath}set rate(e){this._playingRate=e}get rate(){return this._playingRate}play(){this._cameraPath&&(this._lastTime=null,this.state=q.PLAYING)}playToT(e){this._cameraPath&&(this._playingFromT=this._t,this._playingToT=e,this._playingDir=this._playingToT-this._playingFromT<0?-1:1,this._lastTime=null,this.state=q.PLAYING_TO)}playToFrame(e){const t=this._cameraPath;if(!t)return;const s=t.frames[e];s?this.playToT(s.t):this.error("playToFrame - frame index out of range: "+e)}flyToFrame(e,t){const s=this._cameraPath;if(!s)return;const i=s.frames[e];i?(this.state=q.SCRUBBING,this._cameraFlightAnimation.flyTo(i,t)):this.error("flyToFrame - frame index out of range: "+e)}scrubToT(e){const t=this._cameraPath;if(!t)return;this.scene.camera&&(this._t=e,t.loadFrame(this._t),this.state=q.SCRUBBING)}scrubToFrame(e){const t=this._cameraPath;if(!t)return;if(!this.scene.camera)return;t.frames[e]?(t.loadFrame(this._t),this.state=q.SCRUBBING):this.error("playToFrame - frame index out of range: "+e)}stop(){this.state=q.SCRUBBING,this.fire("stopped")}destroy(){super.destroy(),this.scene.off(this._tick)}}q.STOPPED=0,q.SCRUBBING=1,q.PLAYING=2,q.PLAYING_TO=3;class ee extends T{get type(){return"Geometry"}get isGeometry(){return!0}constructor(e,t={}){super(e,t),p.memory.meshes++}destroy(){super.destroy(),p.memory.meshes--}}const te=new e({});class se{constructor(e){this.id=te.addItem({});for(const t in e)e.hasOwnProperty(t)&&(this[t]=e[t])}destroy(){te.removeItem(this.id)}}class ie{constructor(e,t,s,i,r,n,A,o,a){switch(this._gl=e,this.type=t,this.allocated=!1,s.constructor){case Uint8Array:this.itemType=e.UNSIGNED_BYTE,this.itemByteSize=1;break;case Int8Array:this.itemType=e.BYTE,this.itemByteSize=1;break;case Uint16Array:this.itemType=e.UNSIGNED_SHORT,this.itemByteSize=2;break;case Int16Array:this.itemType=e.SHORT,this.itemByteSize=2;break;case Uint32Array:this.itemType=e.UNSIGNED_INT,this.itemByteSize=4;break;case Int32Array:this.itemType=e.INT,this.itemByteSize=4;break;default:this.itemType=e.FLOAT,this.itemByteSize=4}this.usage=n,this.length=0,this.dataLength=i,this.numItems=0,this.itemSize=r,this.normalized=!!A,this.stride=o||0,this.offset=a||0,this._allocate(s)}_allocate(e){if(this.allocated=!1,this._handle=this._gl.createBuffer(),!this._handle)throw"Failed to allocate WebGL ArrayBuffer";this._handle&&(this._gl.bindBuffer(this.type,this._handle),this._gl.bufferData(this.type,e.length>this.dataLength?e.slice(0,this.dataLength):e,this.usage),this._gl.bindBuffer(this.type,null),this.length=e.length,this.numItems=this.length/this.itemSize,this.allocated=!0)}setData(e,t){this.allocated&&(e.length+(t||0)>this.length?(this.destroy(),this._allocate(e)):(this._gl.bindBuffer(this.type,this._handle),t||0===t?this._gl.bufferSubData(this.type,t*this.itemByteSize,e):this._gl.bufferData(this.type,e,this.usage),this._gl.bindBuffer(this.type,null)))}bind(){this.allocated&&this._gl.bindBuffer(this.type,this._handle)}unbind(){this.allocated&&this._gl.bindBuffer(this.type,null)}bindAtLocation(e){this.bind(),this._gl.vertexAttribPointer(e,this.itemSize,this.itemType,this.normalized,0,0)}destroy(){this.allocated&&(this._gl.deleteBuffer(this._handle),this._handle=null,this.allocated=!1)}}var re=function(){const e=[],t=[],s=[],i=[],r=[];let n=0;const A=new Uint16Array(3),o=new Uint16Array(3),a=new Uint16Array(3),l=h.vec3(),c=h.vec3(),u=h.vec3(),d=h.vec3(),p=h.vec3(),f=h.vec3(),g=h.vec3();return function(m,_,b,B){!function(r,n){const A={};let o,a,l,c;const h=Math.pow(10,4);let u,d,p=0;for(u=0,d=r.length;u<d;u+=3)o=r[u],a=r[u+1],l=r[u+2],c=Math.round(o*h)+"_"+Math.round(a*h)+"_"+Math.round(l*h),void 0===A[c]&&(A[c]=p/3,e[p++]=o,e[p++]=a,e[p++]=l),t[u/3]=A[c];for(u=0,d=n.length;u<d;u++)i[u]=t[n[u]],s[i[u]]=n[u]}(m,_),function(t,s){n=0;for(let m=0,_=t;m<_;m+=3){const t=3*i[m],_=3*i[m+1],b=3*i[m+2];s?(A[0]=e[t],A[1]=e[t+1],A[2]=e[t+2],o[0]=e[_],o[1]=e[_+1],o[2]=e[_+2],a[0]=e[b],a[1]=e[b+1],a[2]=e[b+2],h.decompressPosition(A,s,l),h.decompressPosition(o,s,c),h.decompressPosition(a,s,u)):(l[0]=e[t],l[1]=e[t+1],l[2]=e[t+2],c[0]=e[_],c[1]=e[_+1],c[2]=e[_+2],u[0]=e[b],u[1]=e[b+1],u[2]=e[b+2]),h.subVec3(u,c,d),h.subVec3(l,c,p),h.cross3Vec3(d,p,f),h.normalizeVec3(f,g);const B=r[n]||(r[n]={normal:h.vec3()});B.normal[0]=g[0],B.normal[1]=g[1],B.normal[2]=g[2],n++}}(_.length,b);const y=[],w=Math.cos(h.DEGTORAD*B),v={};let C,M,E,F,x,U,I,T,P,S,D,k=!1;for(let e=0,t=_.length;e<t;e+=3){const t=e/3;for(let s=0;s<3;s++)C=i[e+s],M=i[e+(s+1)%3],E=Math.min(C,M),F=Math.max(C,M),x=E+","+F,void 0===v[x]?v[x]={index1:E,index2:F,face1:t,face2:void 0}:v[x].face2=t}for(x in v)U=v[x],void 0!==U.face2&&(I=r[U.face1].normal,T=r[U.face2].normal,P=h.dotVec3(I,T),P>w)||(S=s[U.index1],D=s[U.index2],(!k&&S>65535||D>65535)&&(k=!0),y.push(S),y.push(D));return k?new Uint32Array(y):new Uint16Array(y)}}();const ne=function(){const e=h.mat4(),t=h.mat4();return function(s,i){i=i||h.mat4();const r=s[0],n=s[1],A=s[2],o=s[3]-r,a=s[4]-n,l=s[5]-A,c=65535;return h.identityMat4(e),h.translationMat4v(s,e),h.identityMat4(t),h.scalingMat4v([o/c,a/c,l/c],t),h.mulMat4(e,t,i),i}}();var Ae=function(){const e=h.mat4(),t=h.mat4();return function(s,i,r){const n=new Uint16Array(s.length),A=new Float32Array([r[0]!==i[0]?65535/(r[0]-i[0]):0,r[1]!==i[1]?65535/(r[1]-i[1]):0,r[2]!==i[2]?65535/(r[2]-i[2]):0]);let o;for(o=0;o<s.length;o+=3)n[o+0]=Math.max(0,Math.min(65535,Math.floor((s[o+0]-i[0])*A[0]))),n[o+1]=Math.max(0,Math.min(65535,Math.floor((s[o+1]-i[1])*A[1]))),n[o+2]=Math.max(0,Math.min(65535,Math.floor((s[o+2]-i[2])*A[2])));h.identityMat4(e),h.translationMat4v(i,e),h.identityMat4(t),h.scalingMat4v([(r[0]-i[0])/65535,(r[1]-i[1])/65535,(r[2]-i[2])/65535],t);return{quantized:n,decodeMatrix:h.mulMat4(e,t,h.identityMat4())}}}();var oe=function(){const e=h.mat3(),t=h.mat3();return function(s,i,r){const n=new Uint16Array(s.length),A=new Float32Array([65535/(r[0]-i[0]),65535/(r[1]-i[1])]);let o;for(o=0;o<s.length;o+=2)n[o+0]=Math.max(0,Math.min(65535,Math.floor((s[o+0]-i[0])*A[0]))),n[o+1]=Math.max(0,Math.min(65535,Math.floor((s[o+1]-i[1])*A[1])));h.identityMat3(e),h.translationMat3v(i,e),h.identityMat3(t),h.scalingMat3v([(r[0]-i[0])/65535,(r[1]-i[1])/65535],t);return{quantized:n,decodeMatrix:h.mulMat3(e,t,h.identityMat3())}}}();function ae(e,t,s,i){let r=e[t]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2])),n=e[t+1]/(Math.abs(e[t])+Math.abs(e[t+1])+Math.abs(e[t+2]));if(e[t+2]<0){let e=(1-Math.abs(n))*(r>=0?1:-1),t=(1-Math.abs(r))*(n>=0?1:-1);r=e,n=t}return new Int8Array([Math[s](127.5*r+(r<0?-1:0)),Math[i](127.5*n+(n<0?-1:0))])}function le(e){let t=e[0],s=e[1];t/=t<0?127:128,s/=s<0?127:128;const i=1-Math.abs(t)-Math.abs(s);i<0&&(t=(1-Math.abs(s))*(t>=0?1:-1),s=(1-Math.abs(t))*(s>=0?1:-1));const r=Math.sqrt(t*t+s*s+i*i);return[t/r,s/r,i/r]}function ce(e,t,s){return e[t]*s[0]+e[t+1]*s[1]+e[t+2]*s[2]}const he={getPositionsBounds:function(e){const t=new Float32Array(3),s=new Float32Array(3);let i,r;for(i=0;i<3;i++)t[i]=Number.MAX_VALUE,s[i]=-Number.MAX_VALUE;for(i=0;i<e.length;i+=3)for(r=0;r<3;r++)t[r]=Math.min(t[r],e[i+r]),s[r]=Math.max(s[r],e[i+r]);return{min:t,max:s}},createPositionsDecodeMatrix:ne,compressPositions:Ae,compressPosition:function(e,t,s){const i=new Float32Array([t[3]!==t[0]?65535/(t[3]-t[0]):0,t[4]!==t[1]?65535/(t[4]-t[1]):0,t[5]!==t[2]?65535/(t[5]-t[2]):0]);s[0]=Math.max(0,Math.min(65535,Math.floor((e[0]-t[0])*i[0]))),s[1]=Math.max(0,Math.min(65535,Math.floor((e[1]-t[1])*i[1]))),s[2]=Math.max(0,Math.min(65535,Math.floor((e[2]-t[2])*i[2])))},decompressPositions:function(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[12],s[i+1]=e[i+1]*t[5]+t[13],s[i+2]=e[i+2]*t[10]+t[14];return s},decompressPosition:function(e,t,s){return s[0]=e[0]*t[0]+t[12],s[1]=e[1]*t[5]+t[13],s[2]=e[2]*t[10]+t[14],s},decompressAABB:function(e,t,s=e){return s[0]=e[0]*t[0]+t[12],s[1]=e[1]*t[5]+t[13],s[2]=e[2]*t[10]+t[14],s[3]=e[3]*t[0]+t[12],s[4]=e[4]*t[5]+t[13],s[5]=e[5]*t[10]+t[14],s},getUVBounds:function(e){const t=new Float32Array(2),s=new Float32Array(2);let i,r;for(i=0;i<2;i++)t[i]=Number.MAX_VALUE,s[i]=-Number.MAX_VALUE;for(i=0;i<e.length;i+=2)for(r=0;r<2;r++)t[r]=Math.min(t[r],e[i+r]),s[r]=Math.max(s[r],e[i+r]);return{min:t,max:s}},compressUVs:oe,decompressUVs:function(e,t,s=new Float32Array(e.length)){for(let i=0,r=e.length;i<r;i+=3)s[i+0]=e[i+0]*t[0]+t[6],s[i+1]=e[i+1]*t[4]+t[7];return s},decompressUV:function(e,t,s){s[0]=e[0]*t[0]+t[6],s[1]=e[1]*t[4]+t[7]},compressNormals:function(e){const t=new Int8Array(e.length);let s,i,r,n,A;for(let o=0;o<e.length;o+=3)r=s=ae(e,o,"floor","floor"),i=le(s),n=A=ce(e,o,i),s=ae(e,o,"ceil","floor"),i=le(s),n=ce(e,o,i),n>A&&(r=s,A=n),s=ae(e,o,"floor","ceil"),i=le(s),n=ce(e,o,i),n>A&&(r=s,A=n),s=ae(e,o,"ceil","ceil"),i=le(s),n=ce(e,o,i),n>A&&(r=s,A=n),t[o]=r[0],t[o+1]=r[1];return t},decompressNormals:function(e,t){for(let s=0,i=0,r=e.length;s<r;s+=2){let r=e[s+0],n=e[s+1];r=(2*r+1)/255,n=(2*n+1)/255;const A=1-Math.abs(r)-Math.abs(n);A<0&&(r=(1-Math.abs(n))*(r>=0?1:-1),n=(1-Math.abs(r))*(n>=0?1:-1));const o=Math.sqrt(r*r+n*n+A*A);t[i+0]=r/o,t[i+1]=n/o,t[i+2]=A/o,i+=3}return t},decompressNormal:function(e,t){let s=e[0],i=e[1];s=(2*s+1)/255,i=(2*i+1)/255;const r=1-Math.abs(s)-Math.abs(i);r<0&&(s=(1-Math.abs(i))*(s>=0?1:-1),i=(1-Math.abs(s))*(i>=0?1:-1));const n=Math.sqrt(s*s+i*i+r*r);return t[0]=s/n,t[1]=i/n,t[2]=r/n,t}},ue=p.memory,de=h.AABB3();class pe extends ee{get type(){return"ReadableGeometry"}get isReadableGeometry(){return!0}constructor(e,t={}){super(e,t),this._state=new se({compressGeometry:!!t.compressGeometry,primitive:null,primitiveName:null,positions:null,normals:null,colors:null,uv:null,indices:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this._edgeIndicesBuf=null,this._pickTrianglePositionsBuf=null,this._pickTriangleColorsBuf=null,this._aabbDirty=!0,this._boundingSphere=!0,this._aabb=null,this._aabbDirty=!0,this._obb=null,this._obbDirty=!0;const s=this._state,i=this.scene.canvas.gl;switch(t.primitive=t.primitive||"triangles",t.primitive){case"points":s.primitive=i.POINTS,s.primitiveName=t.primitive;break;case"lines":s.primitive=i.LINES,s.primitiveName=t.primitive;break;case"line-loop":s.primitive=i.LINE_LOOP,s.primitiveName=t.primitive;break;case"line-strip":s.primitive=i.LINE_STRIP,s.primitiveName=t.primitive;break;case"triangles":s.primitive=i.TRIANGLES,s.primitiveName=t.primitive;break;case"triangle-strip":s.primitive=i.TRIANGLE_STRIP,s.primitiveName=t.primitive;break;case"triangle-fan":s.primitive=i.TRIANGLE_FAN,s.primitiveName=t.primitive;break;default:this.error("Unsupported value for 'primitive': '"+t.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=i.TRIANGLES,s.primitiveName=t.primitive}if(t.positions)if(this._state.compressGeometry){const e=he.getPositionsBounds(t.positions),i=he.compressPositions(t.positions,e.min,e.max);s.positions=i.quantized,s.positionsDecodeMatrix=i.decodeMatrix}else s.positions=t.positions.constructor===Float32Array?t.positions:new Float32Array(t.positions);if(t.colors&&(s.colors=t.colors.constructor===Float32Array?t.colors:new Float32Array(t.colors)),t.uv)if(this._state.compressGeometry){const e=he.getUVBounds(t.uv),i=he.compressUVs(t.uv,e.min,e.max);s.uv=i.quantized,s.uvDecodeMatrix=i.decodeMatrix}else s.uv=t.uv.constructor===Float32Array?t.uv:new Float32Array(t.uv);if(t.normals&&(this._state.compressGeometry?s.normals=he.compressNormals(t.normals):s.normals=t.normals.constructor===Float32Array?t.normals:new Float32Array(t.normals)),t.indices&&(s.indices=t.indices.constructor===Uint32Array||t.indices.constructor===Uint16Array?t.indices:new Uint32Array(t.indices),"triangles"===this._state.primitiveName&&(this._numTriangles=t.indices.length/3)),this._buildHash(),ue.meshes++,s.indices&&(s.indicesBuf=new ie(i,i.ELEMENT_ARRAY_BUFFER,s.indices,s.indices.length,1,i.STATIC_DRAW),ue.indices+=s.indicesBuf.numItems),s.positions&&(s.positionsBuf=new ie(i,i.ARRAY_BUFFER,s.positions,s.positions.length,3,i.STATIC_DRAW),ue.positions+=s.positionsBuf.numItems),s.normals){let e=s.compressGeometry;s.normalsBuf=new ie(i,i.ARRAY_BUFFER,s.normals,s.normals.length,3,i.STATIC_DRAW,e),ue.normals+=s.normalsBuf.numItems}s.colors&&(s.colorsBuf=new ie(i,i.ARRAY_BUFFER,s.colors,s.colors.length,4,i.STATIC_DRAW),ue.colors+=s.colorsBuf.numItems),s.uv&&(s.uvBuf=new ie(i,i.ARRAY_BUFFER,s.uv,s.uv.length,2,i.STATIC_DRAW),ue.uvs+=s.uvBuf.numItems)}_buildHash(){const e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positions&&t.push("p"),e.colors&&t.push("c"),(e.normals||e.autoVertexNormals)&&t.push("n"),e.uv&&t.push("u"),e.compressGeometry&&t.push("cp"),t.push(";"),e.hash=t.join("")}_getEdgeIndices(){return this._edgeIndicesBuf||this._buildEdgeIndices(),this._edgeIndicesBuf}_getPickTrianglePositions(){return this._pickTrianglePositionsBuf||this._buildPickTriangleVBOs(),this._pickTrianglePositionsBuf}_getPickTriangleColors(){return this._pickTriangleColorsBuf||this._buildPickTriangleVBOs(),this._pickTriangleColorsBuf}_buildEdgeIndices(){const e=this._state;if(!e.positions||!e.indices)return;const t=this.scene.canvas.gl,s=re(e.positions,e.indices,e.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new ie(t,t.ELEMENT_ARRAY_BUFFER,s,s.length,1,t.STATIC_DRAW),ue.indices+=this._edgeIndicesBuf.numItems}_buildPickTriangleVBOs(){const e=this._state;if(!e.positions||!e.indices)return;const t=this.scene.canvas.gl,s=h.buildPickTriangles(e.positions,e.indices,e.compressGeometry),i=s.positions,r=s.colors;this._pickTrianglePositionsBuf=new ie(t,t.ARRAY_BUFFER,i,i.length,3,t.STATIC_DRAW),this._pickTriangleColorsBuf=new ie(t,t.ARRAY_BUFFER,r,r.length,4,t.STATIC_DRAW,!0),ue.positions+=this._pickTrianglePositionsBuf.numItems,ue.colors+=this._pickTriangleColorsBuf.numItems}_buildPickVertexVBOs(){}get primitive(){return this._state.primitiveName}get compressGeometry(){return this._state.compressGeometry}get positions(){return this._state.positions?this._state.compressGeometry?(this._decompressedPositions||(this._decompressedPositions=new Float32Array(this._state.positions.length),he.decompressPositions(this._state.positions,this._state.positionsDecodeMatrix,this._decompressedPositions)),this._decompressedPositions):this._state.positions:null}set positions(e){const t=this._state,s=t.positions;if(s)if(s.length===e.length){if(this._state.compressGeometry){const s=he.getPositionsBounds(e),i=he.compressPositions(e,s.min,s.max);e=i.quantized,t.positionsDecodeMatrix=i.decodeMatrix}s.set(e),t.positionsBuf&&t.positionsBuf.setData(s),this._setAABBDirty(),this.glRedraw()}else this.error("can't update geometry positions - new positions are wrong length");else this.error("can't update geometry positions - geometry has no positions")}get normals(){if(this._state.normals){if(!this._state.compressGeometry)return this._state.normals;if(!this._decompressedNormals){const e=this._state.normals.length,t=e+e/2;this._decompressedNormals=new Float32Array(t),he.decompressNormals(this._state.normals,this._decompressedNormals)}return this._decompressedNormals}}set normals(e){if(this._state.compressGeometry)return void this.error("can't update geometry normals - quantized geometry is immutable");const t=this._state,s=t.normals;s?s.length===e.length?(s.set(e),t.normalsBuf&&t.normalsBuf.setData(s),this.glRedraw()):this.error("can't update geometry normals - new normals are wrong length"):this.error("can't update geometry normals - geometry has no normals")}get uv(){return this._state.uv?this._state.compressGeometry?(this._decompressedUV||(this._decompressedUV=new Float32Array(this._state.uv.length),he.decompressUVs(this._state.uv,this._state.uvDecodeMatrix,this._decompressedUV)),this._decompressedUV):this._state.uv:null}set uv(e){if(this._state.compressGeometry)return void this.error("can't update geometry UVs - quantized geometry is immutable");const t=this._state,s=t.uv;s?s.length===e.length?(s.set(e),t.uvBuf&&t.uvBuf.setData(s),this.glRedraw()):this.error("can't update geometry UVs - new UVs are wrong length"):this.error("can't update geometry UVs - geometry has no UVs")}get colors(){return this._state.colors}set colors(e){if(this._state.compressGeometry)return void this.error("can't update geometry colors - quantized geometry is immutable");const t=this._state,s=t.colors;s?s.length===e.length?(s.set(e),t.colorsBuf&&t.colorsBuf.setData(s),this.glRedraw()):this.error("can't update geometry colors - new colors are wrong length"):this.error("can't update geometry colors - geometry has no colors")}get indices(){return this._state.indices}get aabb(){return this._aabbDirty&&(this._aabb||(this._aabb=h.AABB3()),h.positions3ToAABB3(this._state.positions,this._aabb,this._state.positionsDecodeMatrix),this._aabbDirty=!1),this._aabb}get obb(){return this._obbDirty&&(this._obb||(this._obb=h.OBB3()),h.positions3ToAABB3(this._state.positions,de,this._state.positionsDecodeMatrix),h.AABB3ToOBB3(de,this._obb),this._obbDirty=!1),this._obb}_getMetrics(){if(!("_metrics"in this))switch(this._state.primitiveName){case"solid":case"surface":case"triangles":{const e=this._state.indices,t=this._state.positions,s=(s,i)=>{const r=3*e[s];for(let e=0;e<3;++e)i[e]=t[r+e];return i},i=[h.vec3(),h.vec3(),h.vec3(),h.vec3()];let r=0;const n=h.vec3([0,0,0]);for(let t=0;t<e.length;t+=3){const e=s(t,i[0]),A=s(t+1,i[1]),o=s(t+2,i[2]);h.addVec3(e,A,i[3]),h.addVec3(o,i[3],i[3]);const a=h.lenVec3(h.cross3Vec3(h.subVec3(A,e,i[1]),h.subVec3(o,e,i[2]),i[0]))/2;r+=a,h.mulVec3Scalar(i[3],a,i[3]),h.addVec3(n,i[3],n)}this._metrics={surfaceArea:r,centroid:h.mulVec3Scalar(n,1/r/3,n)};break}default:this._metrics={surfaceArea:0}}return this._metrics}get surfaceArea(){return this._getMetrics().surfaceArea}get centroid(){return this._getMetrics().centroid}get numTriangles(){return this._numTriangles}_setAABBDirty(){this._aabbDirty||(this._aabbDirty=!0,this._aabbDirty=!0,this._obbDirty=!0)}_getState(){return this._state}destroy(){super.destroy();const e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),this._pickTrianglePositionsBuf&&this._pickTrianglePositionsBuf.destroy(),this._pickTriangleColorsBuf&&this._pickTriangleColorsBuf.destroy(),this._pickVertexPositionsBuf&&this._pickVertexPositionsBuf.destroy(),this._pickVertexColorsBuf&&this._pickVertexColorsBuf.destroy(),e.destroy(),ue.meshes--}}const fe=p.memory,ge=h.AABB3();class me extends ee{get type(){return"VBOGeometry"}get isVBOGeometry(){return!0}constructor(e,t={}){super(e,t),this._state=new se({compressGeometry:!0,primitive:null,primitiveName:null,positionsDecodeMatrix:null,uvDecodeMatrix:null,positionsBuf:null,normalsBuf:null,colorsbuf:null,uvBuf:null,indicesBuf:null,hash:""}),this._numTriangles=0,this._edgeThreshold=t.edgeThreshold||10,this._aabb=null,this._obb=h.OBB3();const s=this._state,i=this.scene.canvas.gl;switch(t.primitive=t.primitive||"triangles",t.primitive){case"points":s.primitive=i.POINTS,s.primitiveName=t.primitive;break;case"lines":s.primitive=i.LINES,s.primitiveName=t.primitive;break;case"line-loop":s.primitive=i.LINE_LOOP,s.primitiveName=t.primitive;break;case"line-strip":s.primitive=i.LINE_STRIP,s.primitiveName=t.primitive;break;case"triangles":s.primitive=i.TRIANGLES,s.primitiveName=t.primitive;break;case"triangle-strip":s.primitive=i.TRIANGLE_STRIP,s.primitiveName=t.primitive;break;case"triangle-fan":s.primitive=i.TRIANGLE_FAN,s.primitiveName=t.primitive;break;default:this.error("Unsupported value for 'primitive': '"+t.primitive+"' - supported values are 'points', 'lines', 'line-loop', 'line-strip', 'triangles', 'triangle-strip' and 'triangle-fan'. Defaulting to 'triangles'."),s.primitive=i.TRIANGLES,s.primitiveName=t.primitive}if(t.positions)if(t.indices){var r;if(t.positionsDecodeMatrix);else{const e=he.getPositionsBounds(t.positions),n=he.compressPositions(t.positions,e.min,e.max);r=n.quantized,s.positionsDecodeMatrix=n.decodeMatrix,s.positionsBuf=new ie(i,i.ARRAY_BUFFER,r,r.length,3,i.STATIC_DRAW),fe.positions+=s.positionsBuf.numItems,h.positions3ToAABB3(t.positions,this._aabb),h.positions3ToAABB3(r,ge,s.positionsDecodeMatrix),h.AABB3ToOBB3(ge,this._obb)}if(t.colors){const e=t.colors.constructor===Float32Array?t.colors:new Float32Array(t.colors);s.colorsBuf=new ie(i,i.ARRAY_BUFFER,e,e.length,4,i.STATIC_DRAW),fe.colors+=s.colorsBuf.numItems}if(t.uv){const e=he.getUVBounds(t.uv),r=he.compressUVs(t.uv,e.min,e.max),n=r.quantized;s.uvDecodeMatrix=r.decodeMatrix,s.uvBuf=new ie(i,i.ARRAY_BUFFER,n,n.length,2,i.STATIC_DRAW),fe.uvs+=s.uvBuf.numItems}if(t.normals){const e=he.compressNormals(t.normals);let r=s.compressGeometry;s.normalsBuf=new ie(i,i.ARRAY_BUFFER,e,e.length,3,i.STATIC_DRAW,r),fe.normals+=s.normalsBuf.numItems}{const e=t.indices.constructor===Uint32Array||t.indices.constructor===Uint16Array?t.indices:new Uint32Array(t.indices);s.indicesBuf=new ie(i,i.ELEMENT_ARRAY_BUFFER,e,e.length,1,i.STATIC_DRAW),fe.indices+=s.indicesBuf.numItems;const n=re(r,e,s.positionsDecodeMatrix,this._edgeThreshold);this._edgeIndicesBuf=new ie(i,i.ELEMENT_ARRAY_BUFFER,n,n.length,1,i.STATIC_DRAW),"triangles"===this._state.primitiveName&&(this._numTriangles=t.indices.length/3)}this._buildHash(),fe.meshes++}else this.error("Config expected: indices");else this.error("Config expected: positions")}_buildHash(){const e=this._state,t=["/g"];t.push("/"+e.primitive+";"),e.positionsBuf&&t.push("p"),e.colorsBuf&&t.push("c"),(e.normalsBuf||e.autoVertexNormals)&&t.push("n"),e.uvBuf&&t.push("u"),t.push("cp"),t.push(";"),e.hash=t.join("")}_getEdgeIndices(){return this._edgeIndicesBuf}get primitive(){return this._state.primitiveName}get aabb(){return this._aabb}get obb(){return this._obb}get numTriangles(){return this._numTriangles}_getState(){return this._state}destroy(){super.destroy();const e=this._state;e.indicesBuf&&e.indicesBuf.destroy(),e.positionsBuf&&e.positionsBuf.destroy(),e.normalsBuf&&e.normalsBuf.destroy(),e.uvBuf&&e.uvBuf.destroy(),e.colorsBuf&&e.colorsBuf.destroy(),this._edgeIndicesBuf&&this._edgeIndicesBuf.destroy(),e.destroy(),fe.meshes--}}var _e={};function be(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let s=e.ySize||1;s<0&&(console.error("negative ySize not allowed - will invert"),s*=-1);let i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);const r=e.center,n=r?r[0]:0,A=r?r[1]:0,o=r?r[2]:0,a=-t+n,l=-s+A,c=-i+o,h=t+n,u=s+A,d=i+o;return _.apply(e,{positions:[h,u,d,a,u,d,a,l,d,h,l,d,h,u,d,h,l,d,h,l,c,h,u,c,h,u,d,h,u,c,a,u,c,a,u,d,a,u,d,a,u,c,a,l,c,a,l,d,a,l,c,h,l,c,h,l,d,a,l,d,h,l,c,a,l,c,a,u,c,h,u,c],normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],uv:[1,0,0,0,0,1,1,1,0,0,0,1,1,1,1,0,1,1,1,0,0,0,0,1,1,0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0,1,1,1,1,0,0,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]})}function Be(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let s=e.ySize||1;s<0&&(console.error("negative ySize not allowed - will invert"),s*=-1);let i=e.zSize||1;i<0&&(console.error("negative zSize not allowed - will invert"),i*=-1);const r=e.center,n=r?r[0]:0,A=r?r[1]:0,o=r?r[2]:0,a=-t+n,l=-s+A,c=-i+o,h=t+n,u=s+A,d=i+o;return _.apply(e,{primitive:"lines",positions:[a,l,c,a,l,d,a,u,c,a,u,d,h,l,c,h,l,d,h,u,c,h,u,d],indices:[0,1,1,3,3,2,2,0,4,5,5,7,7,6,6,4,0,4,1,5,2,6,3,7]})}function ye(e={}){let t=e.radiusTop||1;t<0&&(console.error("negative radiusTop not allowed - will invert"),t*=-1);let s=e.radiusBottom||1;s<0&&(console.error("negative radiusBottom not allowed - will invert"),s*=-1);let i=e.height||1;i<0&&(console.error("negative height not allowed - will invert"),i*=-1);let r=e.radialSegments||32;r<0&&(console.error("negative radialSegments not allowed - will invert"),r*=-1),r<3&&(r=3);let n=e.heightSegments||1;n<0&&(console.error("negative heightSegments not allowed - will invert"),n*=-1),n<1&&(n=1);const A=!!e.openEnded;let o=e.center;const a=o?o[0]:0,l=o?o[1]:0,c=o?o[2]:0,h=i/2,u=i/n,d=2*Math.PI/r,p=1/r,f=(t-s)/n,g=[],m=[],b=[],B=[];let y,w,v,C,M,E,F,x,U,I,T;const P=(90-180*Math.atan(i/(s-t))/Math.PI)/90;for(y=0;y<=n;y++)for(M=t-y*f,E=h-y*u,w=0;w<=r;w++)v=Math.sin(w*d),C=Math.cos(w*d),m.push(M*v),m.push(P),m.push(M*C),b.push(w*p),b.push(1*y/n),g.push(M*v+a),g.push(E+l),g.push(M*C+c);for(y=0;y<n;y++)for(w=0;w<=r;w++)F=y*(r+1)+w,x=F+r,B.push(F),B.push(x),B.push(x+1),B.push(F),B.push(x+1),B.push(F+1);if(!A&&t>0){for(U=g.length/3,m.push(0),m.push(1),m.push(0),b.push(.5),b.push(.5),g.push(0+a),g.push(h+l),g.push(0+c),w=0;w<=r;w++)v=Math.sin(w*d),C=Math.cos(w*d),I=.5*Math.sin(w*d)+.5,T=.5*Math.cos(w*d)+.5,m.push(t*v),m.push(1),m.push(t*C),b.push(I),b.push(T),g.push(t*v+a),g.push(h+l),g.push(t*C+c);for(w=0;w<r;w++)o=U,F=U+1+w,B.push(F),B.push(F+1),B.push(o)}if(!A&&s>0){for(U=g.length/3,m.push(0),m.push(-1),m.push(0),b.push(.5),b.push(.5),g.push(0+a),g.push(0-h+l),g.push(0+c),w=0;w<=r;w++)v=Math.sin(w*d),C=Math.cos(w*d),I=.5*Math.sin(w*d)+.5,T=.5*Math.cos(w*d)+.5,m.push(s*v),m.push(-1),m.push(s*C),b.push(I),b.push(T),g.push(s*v+a),g.push(0-h+l),g.push(s*C+c);for(w=0;w<r;w++)o=U,F=U+1+w,B.push(o),B.push(F+1),B.push(F)}return _.apply(e,{positions:g,normals:m,uv:b,indices:B})}function we(e={}){let t=e.size||1;t<0&&(console.error("negative size not allowed - will invert"),t*=-1);let s=e.divisions||1;s<0&&(console.error("negative divisions not allowed - will invert"),s*=-1),s<1&&(s=1),t=t||10,s=s||10;const i=t/s,r=t/2,n=[],A=[];let o=0;for(let e=0,t=-r;e<=s;e++,t+=i)n.push(-r),n.push(0),n.push(t),n.push(r),n.push(0),n.push(t),n.push(t),n.push(0),n.push(-r),n.push(t),n.push(0),n.push(r),A.push(o++),A.push(o++),A.push(o++),A.push(o++);return _.apply(e,{primitive:"lines",positions:n,indices:A})}function ve(e={}){let t=e.xSize||1;t<0&&(console.error("negative xSize not allowed - will invert"),t*=-1);let s=e.zSize||1;s<0&&(console.error("negative zSize not allowed - will invert"),s*=-1);let i=e.xSegments||1;i<0&&(console.error("negative xSegments not allowed - will invert"),i*=-1),i<1&&(i=1);let r=e.xSegments||1;r<0&&(console.error("negative zSegments not allowed - will invert"),r*=-1),r<1&&(r=1);const n=e.center,A=n?n[0]:0,o=n?n[1]:0,a=n?n[2]:0,l=t/2,c=s/2,h=Math.floor(i)||1,u=Math.floor(r)||1,d=h+1,p=u+1,f=t/h,g=s/u,m=new Float32Array(d*p*3),b=new Float32Array(d*p*3),B=new Float32Array(d*p*2);let y,w,v,C,M,E,F,x=0,U=0;for(y=0;y<p;y++){const e=y*g-c;for(w=0;w<d;w++)v=w*f-l,m[x]=v+A,m[x+1]=o,m[x+2]=-e+a,b[x+1]=1,B[U]=w/h,B[U+1]=(u-y)/u,x+=3,U+=2}x=0;const I=new(m.length/3>65535?Uint32Array:Uint16Array)(h*u*6);for(y=0;y<u;y++)for(w=0;w<h;w++)C=w+d*y,M=w+d*(y+1),E=w+1+d*(y+1),F=w+1+d*y,I[x]=F,I[x+1]=M,I[x+2]=C,I[x+3]=F,I[x+4]=E,I[x+5]=M,x+=6;return _.apply(e,{positions:m,normals:b,uv:B,indices:I})}function Ce(e={}){const t=e.lod||1,s=e.center?e.center[0]:0,i=e.center?e.center[1]:0,r=e.center?e.center[2]:0;let n=e.radius||1;n<0&&(console.error("negative radius not allowed - will invert"),n*=-1);let A=e.heightSegments||18;A<0&&(console.error("negative heightSegments not allowed - will invert"),A*=-1),A=Math.floor(t*A),A<18&&(A=18);let o=e.widthSegments||18;o<0&&(console.error("negative widthSegments not allowed - will invert"),o*=-1),o=Math.floor(t*o),o<18&&(o=18);const a=[],l=[],c=[],h=[];let u,d,p,f,g,m,b,B,y,w,v,C,M,E,F;for(u=0;u<=A;u++)for(p=u*Math.PI/A,f=Math.sin(p),g=Math.cos(p),d=0;d<=o;d++)m=2*d*Math.PI/o,b=Math.sin(m),B=Math.cos(m),y=B*f,w=g,v=b*f,C=1-d/o,M=u/A,l.push(y),l.push(w),l.push(v),c.push(C),c.push(M),a.push(s+n*y),a.push(i+n*w),a.push(r+n*v);for(u=0;u<A;u++)for(d=0;d<o;d++)E=u*(o+1)+d,F=E+o+1,h.push(E+1),h.push(F+1),h.push(F),h.push(E+1),h.push(F),h.push(E);return _.apply(e,{positions:a,normals:l,uv:c,indices:h})}function Me(e={}){let t=e.radius||1;t<0&&(console.error("negative radius not allowed - will invert"),t*=-1),t*=.5;let s=e.tube||.3;s<0&&(console.error("negative tube not allowed - will invert"),s*=-1);let i=e.radialSegments||32;i<0&&(console.error("negative radialSegments not allowed - will invert"),i*=-1),i<4&&(i=4);let r=e.tubeSegments||24;r<0&&(console.error("negative tubeSegments not allowed - will invert"),r*=-1),r<4&&(r=4);let n=e.arc||2*Math.PI;n<0&&(console.warn("negative arc not allowed - will invert"),n*=-1),n>360&&(n=360);const A=e.center;let o=A?A[0]:0,a=A?A[1]:0;const l=A?A[2]:0,c=[],u=[],d=[],p=[];let f,g,m,b,B,y,w,v,C,M,E,F;for(v=0;v<=r;v++)for(w=0;w<=i;w++)f=w/i*n,g=.785398+v/r*Math.PI*2,o=t*Math.cos(f),a=t*Math.sin(f),m=(t+s*Math.cos(g))*Math.cos(f),b=(t+s*Math.cos(g))*Math.sin(f),B=s*Math.sin(g),c.push(m+o),c.push(b+a),c.push(B+l),d.push(1-w/i),d.push(v/r),y=h.normalizeVec3(h.subVec3([m,b,B],[o,a,l],[]),[]),u.push(y[0]),u.push(y[1]),u.push(y[2]);for(v=1;v<=r;v++)for(w=1;w<=i;w++)C=(i+1)*v+w-1,M=(i+1)*(v-1)+w-1,E=(i+1)*(v-1)+w,F=(i+1)*v+w,p.push(C),p.push(M),p.push(E),p.push(E),p.push(F),p.push(C);return _.apply(e,{positions:c,normals:u,uv:d,indices:p})}_e.load=function(e,t){var s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="arraybuffer",s.onload=function(e){t(e.target.response)},s.send()},_e.save=function(e,t){var s="data:application/octet-stream;base64,"+btoa(_e.parse._buffToStr(e));window.location.href=s},_e.clone=function(e){return JSON.parse(JSON.stringify(e))},_e.bin={},_e.bin.f=new Float32Array(1),_e.bin.fb=new Uint8Array(_e.bin.f.buffer),_e.bin.rf=function(e,t){for(var s=_e.bin.f,i=_e.bin.fb,r=0;r<4;r++)i[r]=e[t+r];return s[0]},_e.bin.rsl=function(e,t){return e[t]|e[t+1]<<8},_e.bin.ril=function(e,t){return e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24},_e.bin.rASCII0=function(e,t){for(var s="";0!=e[t];)s+=String.fromCharCode(e[t++]);return s},_e.bin.wf=function(e,t,s){new Float32Array(e.buffer,t,1)[0]=s},_e.bin.wsl=function(e,t,s){e[t]=s,e[t+1]=s>>8},_e.bin.wil=function(e,t,s){e[t]=s,e[t+1]=s>>8,e[t+2]=s>>16,e[t+3]},_e.parse={},_e.parse._buffToStr=function(e){for(var t=new Uint8Array(e),s="",i=0;i<t.length;i++)s=s.concat(String.fromCharCode(t[i]));return s},_e.parse._strToBuff=function(e){for(var t=new ArrayBuffer(e.length),s=new Uint8Array(t),i=0;i<e.length;i++)s[i]=e.charCodeAt(i);return t},_e.parse._readLine=function(e,t){for(var s="";10!=e[t];)s+=String.fromCharCode(e[t++]);return s},_e.parse.fromJSON=function(e){return JSON.parse(_e.parse._buffToStr(e))},_e.parse.toJSON=function(e){var t=JSON.stringify(e);return _e.parse._strToBuff(t)},_e.parse.fromOBJ=function(e){for(var t={groups:{},c_verts:[],c_uvt:[],c_norms:[],i_verts:[],i_uvt:[],i_norms:[]},s={from:0,to:0},i=0,r=new Uint8Array(e);i<r.length;){var n=_e.parse._readLine(r,i);i+=n.length+1;var A=(n=(n=n.replace(/ +(?= )/g,"")).replace(/(^\s+|\s+$)/g,"")).split(" ");if("g"==A[0]&&(s.to=t.i_verts.length,null==t.groups[A[1]]&&(t.groups[A[1]]={from:t.i_verts.length,to:0}),s=t.groups[A[1]]),"v"==A[0]){var o=parseFloat(A[1]),a=parseFloat(A[2]),l=parseFloat(A[3]);t.c_verts.push(o,a,l)}if("vt"==A[0]){o=parseFloat(A[1]),a=1-parseFloat(A[2]);t.c_uvt.push(o,a)}if("vn"==A[0]){o=parseFloat(A[1]),a=parseFloat(A[2]),l=parseFloat(A[3]);t.c_norms.push(o,a,l)}if("f"==A[0]){var c=A[1].split("/"),h=A[2].split("/"),u=A[3].split("/"),d=parseInt(c[0])-1,p=parseInt(h[0])-1,f=parseInt(u[0])-1,g=parseInt(c[1])-1,m=parseInt(h[1])-1,_=parseInt(u[1])-1,b=parseInt(c[2])-1,B=parseInt(h[2])-1,y=parseInt(u[2])-1,w=t.c_verts.length/3,v=t.c_uvt.length/2,C=t.c_norms.length/3;if(d<0&&(d=w+d+1),p<0&&(p=w+p+1),f<0&&(f=w+f+1),g<0&&(g=v+g+1),m<0&&(m=v+m+1),_<0&&(_=v+_+1),b<0&&(b=C+b+1),B<0&&(B=C+B+1),y<0&&(y=C+y+1),t.i_verts.push(d,p,f),t.i_uvt.push(g,m,_),t.i_norms.push(b,B,y),5==A.length){var M=A[4].split("/"),E=parseInt(M[0])-1,F=parseInt(M[1])-1,x=parseInt(M[2])-1;E<0&&(E=w+E+1),F<0&&(F=v+F+1),x<0&&(x=C+x+1),t.i_verts.push(d,f,E),t.i_uvt.push(g,_,F),t.i_norms.push(b,y,x)}}}return s.to=t.i_verts.length,t},_e.parse.fromMD2=function(e){e=new Uint8Array(e);var t={},s={};s.ident=_e.bin.ril(e,0),s.version=_e.bin.ril(e,4),s.skinwidth=_e.bin.ril(e,8),s.skinheight=_e.bin.ril(e,12),s.framesize=_e.bin.ril(e,16),s.num_skins=_e.bin.ril(e,20),s.num_vertices=_e.bin.ril(e,24),s.num_st=_e.bin.ril(e,28),s.num_tris=_e.bin.ril(e,32),s.num_glcmds=_e.bin.ril(e,36),s.num_frames=_e.bin.ril(e,40),s.offset_skins=_e.bin.ril(e,44),s.offset_st=_e.bin.ril(e,48),s.offset_tris=_e.bin.ril(e,52),s.offset_frames=_e.bin.ril(e,56),s.offset_glcmds=_e.bin.ril(e,60),s.offset_end=_e.bin.ril(e,64);var i=s.offset_st;t.c_uvt=[];for(var r=0;r<s.num_st;r++){var n=_e.bin.rsl(e,i)/s.skinwidth,A=_e.bin.rsl(e,i+2)/s.skinheight;t.c_uvt.push(n,A),i+=4}i=s.offset_tris;var o=[],a=[];t.i_verts=o,t.i_uvt=a;for(r=0;r<s.num_tris;r++)o.push(_e.bin.rsl(e,i),_e.bin.rsl(e,i+2),_e.bin.rsl(e,i+4)),a.push(_e.bin.rsl(e,i+6),_e.bin.rsl(e,i+8),_e.bin.rsl(e,i+10)),i+=12;i=s.offset_skins;t.skins=[];for(r=0;r<s.num_skins;r++)t.skins.push(_e.bin.rASCII0(e,i)),i+=64;i=s.offset_frames;t.frames=[];var l=_e.parse.fromMD2._normals;for(r=0;r<s.num_frames;r++){var c={},h=_e.bin.rf(e,i),u=_e.bin.rf(e,i+4),d=_e.bin.rf(e,i+8);i+=12;var p=_e.bin.rf(e,i),f=_e.bin.rf(e,i+4),g=_e.bin.rf(e,i+8);i+=12,c.name=_e.bin.rASCII0(e,i),i+=16,c.verts=[],c.norms=[];for(var m=0;m<s.num_vertices;m++)c.verts.push(e[i]*h+p,e[i+1]*u+f,e[i+2]*d+g),c.norms.push(l[3*e[i+3]],l[3*e[i+3]+1],l[3*e[i+3]+2]),i+=4;t.frames.push(c)}return t},_e.parse.fromMD2._normals=[-.525731,0,.850651,-.442863,.238856,.864188,-.295242,0,.955423,-.309017,.5,.809017,-.16246,.262866,.951056,0,0,1,0,.850651,.525731,-.147621,.716567,.681718,.147621,.716567,.681718,0,.525731,.850651,.309017,.5,.809017,.525731,0,.850651,.295242,0,.955423,.442863,.238856,.864188,.16246,.262866,.951056,-.681718,.147621,.716567,-.809017,.309017,.5,-.587785,.425325,.688191,-.850651,.525731,0,-.864188,.442863,.238856,-.716567,.681718,.147621,-.688191,.587785,.425325,-.5,.809017,.309017,-.238856,.864188,.442863,-.425325,.688191,.587785,-.716567,.681718,-.147621,-.5,.809017,-.309017,-.525731,.850651,0,0,.850651,-.525731,-.238856,.864188,-.442863,0,.955423,-.295242,-.262866,.951056,-.16246,0,1,0,0,.955423,.295242,-.262866,.951056,.16246,.238856,.864188,.442863,.262866,.951056,.16246,.5,.809017,.309017,.238856,.864188,-.442863,.262866,.951056,-.16246,.5,.809017,-.309017,.850651,.525731,0,.716567,.681718,.147621,.716567,.681718,-.147621,.525731,.850651,0,.425325,.688191,.587785,.864188,.442863,.238856,.688191,.587785,.425325,.809017,.309017,.5,.681718,.147621,.716567,.587785,.425325,.688191,.955423,.295242,0,1,0,0,.951056,.16246,.262866,.850651,-.525731,0,.955423,-.295242,0,.864188,-.442863,.238856,.951056,-.16246,.262866,.809017,-.309017,.5,.681718,-.147621,.716567,.850651,0,.525731,.864188,.442863,-.238856,.809017,.309017,-.5,.951056,.16246,-.262866,.525731,0,-.850651,.681718,.147621,-.716567,.681718,-.147621,-.716567,.850651,0,-.525731,.809017,-.309017,-.5,.864188,-.442863,-.238856,.951056,-.16246,-.262866,.147621,.716567,-.681718,.309017,.5,-.809017,.425325,.688191,-.587785,.442863,.238856,-.864188,.587785,.425325,-.688191,.688191,.587785,-.425325,-.147621,.716567,-.681718,-.309017,.5,-.809017,0,.525731,-.850651,-.525731,0,-.850651,-.442863,.238856,-.864188,-.295242,0,-.955423,-.16246,.262866,-.951056,0,0,-1,.295242,0,-.955423,.16246,.262866,-.951056,-.442863,-.238856,-.864188,-.309017,-.5,-.809017,-.16246,-.262866,-.951056,0,-.850651,-.525731,-.147621,-.716567,-.681718,.147621,-.716567,-.681718,0,-.525731,-.850651,.309017,-.5,-.809017,.442863,-.238856,-.864188,.16246,-.262866,-.951056,.238856,-.864188,-.442863,.5,-.809017,-.309017,.425325,-.688191,-.587785,.716567,-.681718,-.147621,.688191,-.587785,-.425325,.587785,-.425325,-.688191,0,-.955423,-.295242,0,-1,0,.262866,-.951056,-.16246,0,-.850651,.525731,0,-.955423,.295242,.238856,-.864188,.442863,.262866,-.951056,.16246,.5,-.809017,.309017,.716567,-.681718,.147621,.525731,-.850651,0,-.238856,-.864188,-.442863,-.5,-.809017,-.309017,-.262866,-.951056,-.16246,-.850651,-.525731,0,-.716567,-.681718,-.147621,-.716567,-.681718,.147621,-.525731,-.850651,0,-.5,-.809017,.309017,-.238856,-.864188,.442863,-.262866,-.951056,.16246,-.864188,-.442863,.238856,-.809017,-.309017,.5,-.688191,-.587785,.425325,-.681718,-.147621,.716567,-.442863,-.238856,.864188,-.587785,-.425325,.688191,-.309017,-.5,.809017,-.147621,-.716567,.681718,-.425325,-.688191,.587785,-.16246,-.262866,.951056,.442863,-.238856,.864188,.16246,-.262866,.951056,.309017,-.5,.809017,.147621,-.716567,.681718,0,-.525731,.850651,.425325,-.688191,.587785,.587785,-.425325,.688191,.688191,-.587785,.425325,-.955423,.295242,0,-.951056,.16246,.262866,-1,0,0,-.850651,0,.525731,-.955423,-.295242,0,-.951056,-.16246,.262866,-.864188,.442863,-.238856,-.951056,.16246,-.262866,-.809017,.309017,-.5,-.864188,-.442863,-.238856,-.951056,-.16246,-.262866,-.809017,-.309017,-.5,-.681718,.147621,-.716567,-.681718,-.147621,-.716567,-.850651,0,-.525731,-.688191,.587785,-.425325,-.587785,.425325,-.688191,-.425325,.688191,-.587785,-.425325,-.688191,-.587785,-.587785,-.425325,-.688191,-.688191,-.587785,-.425325],_e.parse.fromCollada=function(e){var t=_e.parse._buffToStr(e),s=(new DOMParser).parseFromString(t,"text/xml"),i={},r=(s=s.childNodes[0]).getElementsByTagName("asset")[0],n=s.getElementsByTagName("library_geometries")[0],A=s.getElementsByTagName("library_images")[0],o=s.getElementsByTagName("library_materials")[0],a=s.getElementsByTagName("library_effects")[0];return r&&(i.asset=_e.parse.fromCollada._asset(r)),n&&(i.geometries=_e.parse.fromCollada._libGeometries(n)),A&&(i.images=_e.parse.fromCollada._libImages(A)),o&&(i.materials=_e.parse.fromCollada._libMaterials(o)),a&&(i.effects=_e.parse.fromCollada._libEffects(a)),i},_e.parse.fromCollada._asset=function(e){return{created:e.getElementsByTagName("created")[0].textContent,modified:e.getElementsByTagName("modified")[0].textContent,up_axis:e.getElementsByTagName("up_axis")[0].textContent}},_e.parse.fromCollada._libGeometries=function(e){e=e.getElementsByTagName("geometry");for(var t=[],s=0;s<e.length;s++){var i=e[s],r=_e.parse.fromCollada._getMesh(i.getElementsByTagName("mesh")[0]);t.push(r)}return t},_e.parse.fromCollada._getMesh=function(e){for(var t={},s=e.getElementsByTagName("source"),i=t.sources={},r=0;r<s.length;r++){for(var n=s[r].getElementsByTagName("float_array")[0].textContent.split(" "),A=n.length-(""==n[n.length-1]?1:0),o=new Array(A),a=0;a<A;a++)o[a]=parseFloat(n[a]);i[s[r].getAttribute("id")]=o}t.triangles=[];var l=e.getElementsByTagName("triangles");if(null==l)return t;for(r=0;r<l.length;r++){var c={},h=l[r];c.material=h.getAttribute("material");var u=h.getElementsByTagName("input"),d=[];for(a=0;a<u.length;a++){var p=u[a];o=[];d[parseInt(p.getAttribute("offset"))]=o;var f=p.getAttribute("semantic");c["s_"+f]="VERTEX"==f?e.getElementsByTagName("vertices")[0].getElementsByTagName("input")[0].getAttribute("source").substring(1):p.getAttribute("source").substring(1),c["i_"+f]=o,i[c["s_"+f]]}var g=h.getElementsByTagName("p")[0].textContent.split(" "),m=3*Math.floor(g.length/3);for(a=0;a<m;a++)d[a%u.length].push(parseInt(g[a]));t.triangles.push(c)}return t},_e.parse.fromCollada._libImages=function(e){e=e.getElementsByTagName("image");for(var t={},s=0;s<e.length;s++)t[e[s].getAttribute("id")]=e[s].getElementsByTagName("init_from")[0].textContent;return t},_e.parse.fromCollada._libMaterials=function(e){e=e.getElementsByTagName("material");for(var t={},s=0;s<e.length;s++)t[e[s].getAttribute("name")]=e[s].getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1);return t},_e.parse.fromCollada._libEffects=function(e){e=e.getElementsByTagName("effect");for(var t={},s=0;s<e.length;s++){for(var i={},r=e[s].getElementsByTagName("newparam"),n=0;n<r.length;n++){var A=r[n].getElementsByTagName("surface")[0];A&&(i.surface=A.getElementsByTagName("init_from")[0].textContent)}t[e[s].getAttribute("id")]=i}return t},_e.parse.from3DS=function(e){e=new Uint8Array(e);var t={};if(19789!=_e.bin.rsl(e,0))return null;for(var s=_e.bin.ril(e,2),i=6;i<s;){var r=_e.bin.rsl(e,i),n=_e.bin.ril(e,i+2);15677==r&&(t.edit=_e.parse.from3DS._edit3ds(e,i,n)),45056==r&&(t.keyf=_e.parse.from3DS._keyf3ds(e,i,n)),i+=n}return t},_e.parse.from3DS._edit3ds=function(e,t,s){for(var i={},r=t+6;r<t+s;){var n=_e.bin.rsl(e,r),A=_e.bin.ril(e,r+2);16384==n&&(null==i.objects&&(i.objects=[]),i.objects.push(_e.parse.from3DS._edit_object(e,r,A))),r+=A}return i},_e.parse.from3DS._keyf3ds=function(e,t,s){for(var i={},r=t+6;r<t+s;){var n=_e.bin.rsl(e,r),A=_e.bin.ril(e,r+2);45058==n&&(null==i.desc&&(i.desc=[]),i.desc.push(_e.parse.from3DS._keyf_objdes(e,r,A))),r+=A}return i},_e.parse.from3DS._keyf_objdes=function(e,t,s){for(var i={},r=t+6;r<t+s;){var n=_e.bin.rsl(e,r),A=_e.bin.ril(e,r+2);45072==n&&(i.hierarchy=_e.parse.from3DS._keyf_objhierarch(e,r,A)),45073==n&&(i.dummy_name=_e.bin.rASCII0(e,r+6)),r+=A}return i},_e.parse.from3DS._keyf_objhierarch=function(e,t,s){var i={},r=t+6;return i.name=_e.bin.rASCII0(e,r),r+=i.name.length+1,i.hierarchy=_e.bin.rsl(e,r+4),i},_e.parse.from3DS._edit_object=function(e,t,s){var i={},r=t+6;for(i.name=_e.bin.rASCII0(e,r),r+=i.name.length+1;r<t+s;){var n=_e.bin.rsl(e,r),A=_e.bin.ril(e,r+2);16640==n&&(i.mesh=_e.parse.from3DS._obj_trimesh(e,r,A)),r+=A}return i},_e.parse.from3DS._obj_trimesh=function(e,t,s){for(var i={},r=t+6;r<t+s;){var n=_e.bin.rsl(e,r),A=_e.bin.ril(e,r+2);16656==n&&(i.vertices=_e.parse.from3DS._tri_vertexl(e,r,A)),16672==n&&(i.indices=_e.parse.from3DS._tri_facel1(e,r,A)),16704==n&&(i.uvt=_e.parse.from3DS._tri_mappingcoors(e,r,A)),16736==n&&(i.local=_e.parse.from3DS._tri_local(e,r,A)),r+=A}return i},_e.parse.from3DS._tri_vertexl=function(e,t,s){var i=[],r=t+6,n=_e.bin.rsl(e,r);r+=2;for(var A=0;A<n;A++)i.push(_e.bin.rf(e,r)),i.push(_e.bin.rf(e,r+4)),i.push(_e.bin.rf(e,r+8)),r+=12;return i},_e.parse.from3DS._tri_facel1=function(e,t,s){var i=[],r=t+6,n=_e.bin.rsl(e,r);r+=2;for(var A=0;A<n;A++)i.push(_e.bin.rsl(e,r)),i.push(_e.bin.rsl(e,r+2)),i.push(_e.bin.rsl(e,r+4)),r+=8;return i},_e.parse.from3DS._tri_mappingcoors=function(e,t,s){var i=[],r=t+6,n=_e.bin.rsl(e,r);r+=2;for(var A=0;A<n;A++)i.push(_e.bin.rf(e,r)),i.push(1-_e.bin.rf(e,r+4)),r+=8;return i},_e.parse.from3DS._tri_local=function(e,t,s){var i={},r=t+6;return i.X=[_e.bin.rf(e,r),_e.bin.rf(e,r+4),_e.bin.rf(e,r+8)],r+=12,i.Y=[_e.bin.rf(e,r),_e.bin.rf(e,r+4),_e.bin.rf(e,r+8)],r+=12,i.Z=[_e.bin.rf(e,r),_e.bin.rf(e,r+4),_e.bin.rf(e,r+8)],r+=12,i.C=[_e.bin.rf(e,r),_e.bin.rf(e,r+4),_e.bin.rf(e,r+8)],r+=12,i},_e.parse.fromBIV=function(e){e=new Uint8Array(e);var t={},s={};return s.id=_e.bin.ril(e,0),s.verS=_e.bin.ril(e,4),s.texS=_e.bin.ril(e,8),s.indS=_e.bin.ril(e,12),s.verO=_e.bin.ril(e,16),s.verL=_e.bin.ril(e,20),s.texO=_e.bin.ril(e,24),s.texL=_e.bin.ril(e,28),s.indO=_e.bin.ril(e,32),s.indL=_e.bin.ril(e,36),0!=s.verO&&(t.vertices=_e.parse.fromBIV._readFloats(e,s.verO,s.verL)),0!=s.texO&&(t.uvt=_e.parse.fromBIV._readFloats(e,s.texO,s.texL)),0!=s.indO&&(t.indices=_e.parse.fromBIV._readInts(e,s.indO,s.indL,s.indS)),t},_e.parse.toBIV=function(e){for(var t=0,s=0;s<e.indices.length;s++)t=Math.max(t,e.indices[s]);var i=32;t<=65535&&(i=16);var r=40;e.vertices&&(r+=4*e.vertices.length),e.uvt&&(r+=4*e.uvt.length),e.indices&&(r+=e.indices.length*i/8);var n=new Uint8Array(r);_e.bin.wil(n,0,1769365870),_e.bin.wil(n,4,32),_e.bin.wil(n,8,32),_e.bin.wil(n,12,i);var A=40;return e.vertices&&(_e.bin.wil(n,16,A),_e.bin.wil(n,20,4*e.vertices.length),_e.parse.fromBIV._writeFloats(n,A,e.vertices),A+=4*e.vertices.length),e.uvt&&(_e.bin.wil(n,24,A),_e.bin.wil(n,28,4*e.uvt.length),_e.parse.fromBIV._writeFloats(n,A,e.uvt),A+=4*e.uvt.length),e.indices&&(_e.bin.wil(n,32,A),_e.bin.wil(n,36,4*e.indices.length),_e.parse.fromBIV._writeInts(n,A,e.indices,i)),n.buffer},_e.parse.fromBIV._readFloats=function(e,t,s){for(var i=[],r=0;r<s/4;r++)i.push(_e.bin.rf(e,t+4*r));return i},_e.parse.fromBIV._writeFloats=function(e,t,s){for(var i=0;i<s.length;i++)_e.bin.wf(e,t+4*i,s[i])},_e.parse.fromBIV._readInts=function(e,t,s,i){for(var r=[],n=0;n<s/4;n++)16==i&&r.push(_e.bin.rsl(e,t+2*n)),32==i&&r.push(_e.bin.ril(e,t+4*n));return r},_e.parse.fromBIV._writeInts=function(e,t,s,i){for(var r=0;r<s.length;r++)16==i&&_e.bin.wsl(e,t+2*r,s[r]),32==i&&_e.bin.wil(e,t+4*r,s[r])},_e.gen={},_e.gen.Plane=function(e,t,s,i){s||(s=1),i||(i=1);for(var r={verts:[],inds:[],uvt:[]},n=e+1,A=t+1,o=0;o<A;o++)for(var a=0;a<n;a++){var l=a*(2/e)-1,c=o*(2/t)-1;r.verts.push(l,c,0),r.uvt.push(s*a/e,i*o/t),o<t&&a<e&&r.inds.push(o*n+a,o*n+a+1,(o+1)*n+a,o*n+a+1,(o+1)*n+a,(o+1)*n+a+1)}return r},_e.gen.Cube=function(){return{verts:[-1,1,-1,1,1,-1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,-1,1,1,1,1,1,-1,1,-1,1,1,-1,-1,-1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],inds:[0,1,2,1,2,3,4,5,6,5,6,7,8,9,10,9,10,11,12,13,14,13,14,15,16,17,18,17,18,19,20,21,22,21,22,23],uvt:[1/4,1/4,.5,1/4,1/4,.5,.5,.5,1,1/4,3/4,1/4,1,.5,3/4,.5,0,1/4,1/4,1/4,0,.5,1/4,.5,3/4,1/4,.5,1/4,3/4,.5,.5,.5,1/4,1/4,.5,1/4,1/4,0,.5,0,1/4,.5,.5,.5,1/4,3/4,.5,3/4]}},_e.gen.Sphere=function(e,t){for(var s={verts:[],inds:[],uvt:[]},i=e+1,r=t+1,n=0;n<r;n++)for(var A=0;A<i;A++){var o=-Math.PI/2+n*Math.PI/t,a=2*A*Math.PI/e,l=Math.cos(o)*Math.cos(a),c=Math.sin(o),h=Math.cos(o)*Math.sin(a);s.verts.push(l,c,h),s.uvt.push(A/e,n/t),n<t&&A<e&&s.inds.push(i*n+A,i*n+A+1,i*(n+1)+A,i*n+A+1,i*(n+1)+A,i*(n+1)+A+1)}return s},_e.mat={},_e.mat.scale=function(e,t,s){return[e,0,0,0,0,t,0,0,0,0,s,0,0,0,0,1]},_e.mat.translate=function(e,t,s){return[1,0,0,0,0,1,0,0,0,0,1,0,e,t,s,1]},_e.mat.rotateDeg=function(e,t,s){var i=Math.PI/180;return _e.mat.rotate(e*i,t*i,s*i)},_e.mat.rotate=function(e,t,s){var i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r=e,n=t,A=s,o=Math.cos(r),a=Math.cos(n),l=Math.cos(A),c=Math.sin(r),h=Math.sin(n),u=Math.sin(A);return i[0]=a*l,i[1]=-a*u,i[2]=h,i[4]=o*u+c*h*l,i[5]=o*l-c*h*u,i[6]=-c*a,i[8]=c*u-o*h*l,i[9]=c*l+o*h*u,i[10]=o*a,i},_e.edit={},_e.edit.interpolate=function(e,t,s,i){for(var r=0;r<e.length;r++)s[r]=e[r]+i*(t[r]-e[r])},_e.edit.transform=function(e,t){for(var s=0;s<e.length;s+=3){var i=e[s],r=e[s+1],n=e[s+2];e[s+0]=t[0]*i+t[4]*r+t[8]*n+t[12],e[s+1]=t[1]*i+t[5]*r+t[9]*n+t[13],e[s+2]=t[2]*i+t[6]*r+t[10]*n+t[14]}},_e.edit.unwrap=function(e,t,s){for(var i=new Array(Math.floor(e.length/3)*s),r=0;r<e.length;r++)for(var n=0;n<s;n++)i[r*s+n]=t[e[r]*s+n];return i},_e.edit.remap=function(e,t,s,i){for(var r=new Array(s.length),n=0;n<e.length;n++)for(var A=0;A<i;A++)r[t[n]*i+A]=s[e[n]*i+A];return r},_e.utils={},_e.utils.getAABB=function(e){var t,s,i,r,n,A;r=n=A=-(t=s=i=999999999);for(var o=0;o<e.length;o+=3){var a=e[o+0],l=e[o+1],c=e[o+2];a<t&&(t=a),a>r&&(r=a),l<s&&(s=l),l>n&&(n=l),c<i&&(i=c),l>A&&(A=c)}return{min:{x:t,y:s,z:i},max:{x:r,y:n,z:A}}};const Ee={" ":{width:16,points:[]},"!":{width:10,points:[[5,21],[5,7],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},'"':{width:16,points:[[4,21],[4,14],[-1,-1],[12,21],[12,14]]},"#":{width:21,points:[[11,25],[4,-7],[-1,-1],[17,25],[10,-7],[-1,-1],[4,12],[18,12],[-1,-1],[3,6],[17,6]]},$:{width:20,points:[[8,25],[8,-4],[-1,-1],[12,25],[12,-4],[-1,-1],[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},"%":{width:24,points:[[21,21],[3,0],[-1,-1],[8,21],[10,19],[10,17],[9,15],[7,14],[5,14],[3,16],[3,18],[4,20],[6,21],[8,21],[10,20],[13,19],[16,19],[19,20],[21,21],[-1,-1],[17,7],[15,6],[14,4],[14,2],[16,0],[18,0],[20,1],[21,3],[21,5],[19,7],[17,7]]},"&":{width:26,points:[[23,12],[23,13],[22,14],[21,14],[20,13],[19,11],[17,6],[15,3],[13,1],[11,0],[7,0],[5,1],[4,2],[3,4],[3,6],[4,8],[5,9],[12,13],[13,14],[14,16],[14,18],[13,20],[11,21],[9,20],[8,18],[8,16],[9,13],[11,10],[16,3],[18,1],[20,0],[22,0],[23,1],[23,2]]},"'":{width:10,points:[[5,19],[4,20],[5,21],[6,20],[6,18],[5,16],[4,15]]},"(":{width:14,points:[[11,25],[9,23],[7,20],[5,16],[4,11],[4,7],[5,2],[7,-2],[9,-5],[11,-7]]},")":{width:14,points:[[3,25],[5,23],[7,20],[9,16],[10,11],[10,7],[9,2],[7,-2],[5,-5],[3,-7]]},"*":{width:16,points:[[8,21],[8,9],[-1,-1],[3,18],[13,12],[-1,-1],[13,18],[3,12]]},"+":{width:26,points:[[13,18],[13,0],[-1,-1],[4,9],[22,9]]},",":{width:10,points:[[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"-":{width:26,points:[[4,9],[22,9]]},".":{width:10,points:[[5,2],[4,1],[5,0],[6,1],[5,2]]},"/":{width:22,points:[[20,25],[2,-7]]},0:{width:20,points:[[9,21],[6,20],[4,17],[3,12],[3,9],[4,4],[6,1],[9,0],[11,0],[14,1],[16,4],[17,9],[17,12],[16,17],[14,20],[11,21],[9,21]]},1:{width:20,points:[[6,17],[8,18],[11,21],[11,0]]},2:{width:20,points:[[4,16],[4,17],[5,19],[6,20],[8,21],[12,21],[14,20],[15,19],[16,17],[16,15],[15,13],[13,10],[3,0],[17,0]]},3:{width:20,points:[[5,21],[16,21],[10,13],[13,13],[15,12],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},4:{width:20,points:[[13,21],[3,7],[18,7],[-1,-1],[13,21],[13,0]]},5:{width:20,points:[[15,21],[5,21],[4,12],[5,13],[8,14],[11,14],[14,13],[16,11],[17,8],[17,6],[16,3],[14,1],[11,0],[8,0],[5,1],[4,2],[3,4]]},6:{width:20,points:[[16,18],[15,20],[12,21],[10,21],[7,20],[5,17],[4,12],[4,7],[5,3],[7,1],[10,0],[11,0],[14,1],[16,3],[17,6],[17,7],[16,10],[14,12],[11,13],[10,13],[7,12],[5,10],[4,7]]},7:{width:20,points:[[17,21],[7,0],[-1,-1],[3,21],[17,21]]},8:{width:20,points:[[8,21],[5,20],[4,18],[4,16],[5,14],[7,13],[11,12],[14,11],[16,9],[17,7],[17,4],[16,2],[15,1],[12,0],[8,0],[5,1],[4,2],[3,4],[3,7],[4,9],[6,11],[9,12],[13,13],[15,14],[16,16],[16,18],[15,20],[12,21],[8,21]]},9:{width:20,points:[[16,14],[15,11],[13,9],[10,8],[9,8],[6,9],[4,11],[3,14],[3,15],[4,18],[6,20],[9,21],[10,21],[13,20],[15,18],[16,14],[16,9],[15,4],[13,1],[10,0],[8,0],[5,1],[4,3]]},":":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[5,2],[4,1],[5,0],[6,1],[5,2]]},";":{width:10,points:[[5,14],[4,13],[5,12],[6,13],[5,14],[-1,-1],[6,1],[5,0],[4,1],[5,2],[6,1],[6,-1],[5,-3],[4,-4]]},"<":{width:24,points:[[20,18],[4,9],[20,0]]},"=":{width:26,points:[[4,12],[22,12],[-1,-1],[4,6],[22,6]]},">":{width:24,points:[[4,18],[20,9],[4,0]]},"?":{width:18,points:[[3,16],[3,17],[4,19],[5,20],[7,21],[11,21],[13,20],[14,19],[15,17],[15,15],[14,13],[13,12],[9,10],[9,7],[-1,-1],[9,2],[8,1],[9,0],[10,1],[9,2]]},"@":{width:27,points:[[18,13],[17,15],[15,16],[12,16],[10,15],[9,14],[8,11],[8,8],[9,6],[11,5],[14,5],[16,6],[17,8],[-1,-1],[12,16],[10,14],[9,11],[9,8],[10,6],[11,5],[-1,-1],[18,16],[17,8],[17,6],[19,5],[21,5],[23,7],[24,10],[24,12],[23,15],[22,17],[20,19],[18,20],[15,21],[12,21],[9,20],[7,19],[5,17],[4,15],[3,12],[3,9],[4,6],[5,4],[7,2],[9,1],[12,0],[15,0],[18,1],[20,2],[21,3],[-1,-1],[19,16],[18,8],[18,6],[19,5]]},A:{width:18,points:[[9,21],[1,0],[-1,-1],[9,21],[17,0],[-1,-1],[4,7],[14,7]]},B:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[-1,-1],[4,11],[13,11],[16,10],[17,9],[18,7],[18,4],[17,2],[16,1],[13,0],[4,0]]},C:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5]]},D:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[11,21],[14,20],[16,18],[17,16],[18,13],[18,8],[17,5],[16,3],[14,1],[11,0],[4,0]]},E:{width:19,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11],[-1,-1],[4,0],[17,0]]},F:{width:18,points:[[4,21],[4,0],[-1,-1],[4,21],[17,21],[-1,-1],[4,11],[12,11]]},G:{width:21,points:[[18,16],[17,18],[15,20],[13,21],[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[18,8],[-1,-1],[13,8],[18,8]]},H:{width:22,points:[[4,21],[4,0],[-1,-1],[18,21],[18,0],[-1,-1],[4,11],[18,11]]},I:{width:8,points:[[4,21],[4,0]]},J:{width:16,points:[[12,21],[12,5],[11,2],[10,1],[8,0],[6,0],[4,1],[3,2],[2,5],[2,7]]},K:{width:21,points:[[4,21],[4,0],[-1,-1],[18,21],[4,7],[-1,-1],[9,12],[18,0]]},L:{width:17,points:[[4,21],[4,0],[-1,-1],[4,0],[16,0]]},M:{width:24,points:[[4,21],[4,0],[-1,-1],[4,21],[12,0],[-1,-1],[20,21],[12,0],[-1,-1],[20,21],[20,0]]},N:{width:22,points:[[4,21],[4,0],[-1,-1],[4,21],[18,0],[-1,-1],[18,21],[18,0]]},O:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21]]},P:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,14],[17,12],[16,11],[13,10],[4,10]]},Q:{width:22,points:[[9,21],[7,20],[5,18],[4,16],[3,13],[3,8],[4,5],[5,3],[7,1],[9,0],[13,0],[15,1],[17,3],[18,5],[19,8],[19,13],[18,16],[17,18],[15,20],[13,21],[9,21],[-1,-1],[12,4],[18,-2]]},R:{width:21,points:[[4,21],[4,0],[-1,-1],[4,21],[13,21],[16,20],[17,19],[18,17],[18,15],[17,13],[16,12],[13,11],[4,11],[-1,-1],[11,11],[18,0]]},S:{width:20,points:[[17,18],[15,20],[12,21],[8,21],[5,20],[3,18],[3,16],[4,14],[5,13],[7,12],[13,10],[15,9],[16,8],[17,6],[17,3],[15,1],[12,0],[8,0],[5,1],[3,3]]},T:{width:16,points:[[8,21],[8,0],[-1,-1],[1,21],[15,21]]},U:{width:22,points:[[4,21],[4,6],[5,3],[7,1],[10,0],[12,0],[15,1],[17,3],[18,6],[18,21]]},V:{width:18,points:[[1,21],[9,0],[-1,-1],[17,21],[9,0]]},W:{width:24,points:[[2,21],[7,0],[-1,-1],[12,21],[7,0],[-1,-1],[12,21],[17,0],[-1,-1],[22,21],[17,0]]},X:{width:20,points:[[3,21],[17,0],[-1,-1],[17,21],[3,0]]},Y:{width:18,points:[[1,21],[9,11],[9,0],[-1,-1],[17,21],[9,11]]},Z:{width:20,points:[[17,21],[3,0],[-1,-1],[3,21],[17,21],[-1,-1],[3,0],[17,0]]},"[":{width:14,points:[[4,25],[4,-7],[-1,-1],[5,25],[5,-7],[-1,-1],[4,25],[11,25],[-1,-1],[4,-7],[11,-7]]},"\\":{width:14,points:[[0,21],[14,-3]]},"]":{width:14,points:[[9,25],[9,-7],[-1,-1],[10,25],[10,-7],[-1,-1],[3,25],[10,25],[-1,-1],[3,-7],[10,-7]]},"^":{width:16,points:[[6,15],[8,18],[10,15],[-1,-1],[3,12],[8,17],[13,12],[-1,-1],[8,17],[8,0]]},_:{width:16,points:[[0,-2],[16,-2]]},"`":{width:10,points:[[6,21],[5,20],[4,18],[4,16],[5,15],[6,16],[5,17]]},a:{width:19,points:[[15,14],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},b:{width:19,points:[[4,21],[4,0],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},c:{width:18,points:[[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},d:{width:19,points:[[15,21],[15,0],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},e:{width:18,points:[[3,8],[15,8],[15,10],[14,12],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},f:{width:12,points:[[10,21],[8,21],[6,20],[5,17],[5,0],[-1,-1],[2,14],[9,14]]},g:{width:19,points:[[15,14],[15,-2],[14,-5],[13,-6],[11,-7],[8,-7],[6,-6],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},h:{width:19,points:[[4,21],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},i:{width:8,points:[[3,21],[4,20],[5,21],[4,22],[3,21],[-1,-1],[4,14],[4,0]]},j:{width:10,points:[[5,21],[6,20],[7,21],[6,22],[5,21],[-1,-1],[6,14],[6,-3],[5,-6],[3,-7],[1,-7]]},k:{width:17,points:[[4,21],[4,0],[-1,-1],[14,14],[4,4],[-1,-1],[8,8],[15,0]]},l:{width:8,points:[[4,21],[4,0]]},m:{width:30,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0],[-1,-1],[15,10],[18,13],[20,14],[23,14],[25,13],[26,10],[26,0]]},n:{width:19,points:[[4,14],[4,0],[-1,-1],[4,10],[7,13],[9,14],[12,14],[14,13],[15,10],[15,0]]},o:{width:19,points:[[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3],[16,6],[16,8],[15,11],[13,13],[11,14],[8,14]]},p:{width:19,points:[[4,14],[4,-7],[-1,-1],[4,11],[6,13],[8,14],[11,14],[13,13],[15,11],[16,8],[16,6],[15,3],[13,1],[11,0],[8,0],[6,1],[4,3]]},q:{width:19,points:[[15,14],[15,-7],[-1,-1],[15,11],[13,13],[11,14],[8,14],[6,13],[4,11],[3,8],[3,6],[4,3],[6,1],[8,0],[11,0],[13,1],[15,3]]},r:{width:13,points:[[4,14],[4,0],[-1,-1],[4,8],[5,11],[7,13],[9,14],[12,14]]},s:{width:17,points:[[14,11],[13,13],[10,14],[7,14],[4,13],[3,11],[4,9],[6,8],[11,7],[13,6],[14,4],[14,3],[13,1],[10,0],[7,0],[4,1],[3,3]]},t:{width:12,points:[[5,21],[5,4],[6,1],[8,0],[10,0],[-1,-1],[2,14],[9,14]]},u:{width:19,points:[[4,14],[4,4],[5,1],[7,0],[10,0],[12,1],[15,4],[-1,-1],[15,14],[15,0]]},v:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0]]},w:{width:22,points:[[3,14],[7,0],[-1,-1],[11,14],[7,0],[-1,-1],[11,14],[15,0],[-1,-1],[19,14],[15,0]]},x:{width:17,points:[[3,14],[14,0],[-1,-1],[14,14],[3,0]]},y:{width:16,points:[[2,14],[8,0],[-1,-1],[14,14],[8,0],[6,-4],[4,-6],[2,-7],[1,-7]]},z:{width:17,points:[[14,14],[3,0],[-1,-1],[3,14],[14,14],[-1,-1],[3,0],[14,0]]},"{":{width:14,points:[[9,25],[7,24],[6,23],[5,21],[5,19],[6,17],[7,16],[8,14],[8,12],[6,10],[-1,-1],[7,24],[6,22],[6,20],[7,18],[8,17],[9,15],[9,13],[8,11],[4,9],[8,7],[9,5],[9,3],[8,1],[7,0],[6,-2],[6,-4],[7,-6],[-1,-1],[6,8],[8,6],[8,4],[7,2],[6,1],[5,-1],[5,-3],[6,-5],[7,-6],[9,-7]]},"|":{width:8,points:[[4,25],[4,-7]]},"}":{width:14,points:[[5,25],[7,24],[8,23],[9,21],[9,19],[8,17],[7,16],[6,14],[6,12],[8,10],[-1,-1],[7,24],[8,22],[8,20],[7,18],[6,17],[5,15],[5,13],[6,11],[10,9],[6,7],[5,5],[5,3],[6,1],[7,0],[8,-2],[8,-4],[7,-6],[-1,-1],[8,8],[6,6],[6,4],[7,2],[8,1],[9,-1],[9,-3],[8,-5],[7,-6],[5,-7]]},"~":{width:24,points:[[3,6],[3,8],[4,11],[6,12],[8,12],[10,11],[14,8],[16,7],[18,7],[20,8],[21,10],[-1,-1],[3,8],[4,10],[6,11],[8,11],[10,10],[14,7],[16,6],[18,6],[20,7],[21,10],[21,12]]}};function Fe(e={}){var t=e.origin||[0,0,0],s=t[0],i=t[1],r=t[2],n=e.size||1,A=[],o=[],a=e.text;_.isNumeric(a)&&(a=""+a);for(var l,c,h,u,d,p,f,g,m,b=(a||"").split("\n"),B=0,y=0,w=.04,v=0;v<b.length;v++){l=0,h=(c=b[v]).length;for(var C=0;C<h;C++)if(u=Ee[c.charAt(C)]){d=1,p=-1,f=-1,g=u.points.length;for(var M=0;M<g;M++)-1!==(m=u.points[M])[0]||-1!==m[1]?(A.push(l+m[0]*n*w+s),A.push(y+m[1]*n*w+i),A.push(0+r),-1===p?p=B:(-1===f||(p=f),f=B),B++,d?d=!1:(o.push(p),o.push(f))):d=1;l+=u.width*w*n}y-=35*w*n}return _.apply(e,{primitive:"lines",positions:A,indices:o})}function xe(e={}){if(e.points.length%3!=0)throw"Size of points array for given polyline should be divisible by 3";let t=e.points.length/3;if(t<2)throw"There should be at least 2 points to create a polyline";let s=[];for(let e=0;e<t-1;e++)s.push(e),s.push(e+1);return _.apply(e,{primitive:"lines",positions:e.points,indices:s})}function Ue(e={}){if(3!==e.startPoint.length)throw"Start point should contain 3 elements in array: x, y and z";if(3!==e.endPoint.length)throw"End point should contain 3 elements in array: x, y and z";let t=[],s=[],i=e.startPoint[0],r=e.startPoint[1],n=e.startPoint[2],A=e.endPoint[0],o=e.endPoint[1],a=e.endPoint[2],l=Math.sqrt((A-i)**2+(o-r)**2+(a-n)**2),c=[(A-i)/l,(o-r)/l,(a-n)/l];if(e.pattern){let h=e.pattern.length,u=!1,d=0,p=0,f=0,g=[i,r,n],m=e.pattern[p];for(s.push(g[0],g[1],g[2]);m<=l-d;){let i=[c[0]*m,c[1]*m,c[2]*m],r=[g[0]+i[0],g[1]+i[1],g[2]+i[2]];s.push(r[0],r[1],r[2]),u||(t.push(f),t.push(f+1)),u=!u,f+=1,g=r,p+=1,p>=h&&(p=0),d+=m,m=e.pattern[p]}e.extendToEnd&&(s.push(A,o,a),t.push(t.length-2),t.push(t.length-1))}else t.push(0),t.push(1),s.push(i,r,n,A,o,a);return _.apply(e,{primitive:"lines",positions:s,indices:t})}const Ie=h.vec4(4),Te=h.vec4(),Pe=h.vec4(),Se=h.vec3([1,0,0]),De=h.vec3([0,1,0]),ke=h.vec3([0,0,1]),Qe=h.vec3(3),Re=h.vec3(3),Oe=h.identityMat4();class Ve extends T{constructor(e,t={}){if(super(e,t),this._parentNode=null,this._children=[],this._aabb=null,this._aabbDirty=!0,this.scene._aabbDirty=!0,this._numTriangles=0,this._scale=h.vec3(),this._quaternion=h.identityQuaternion(),this._rotation=h.vec3(),this._position=h.vec3(),this._offset=h.vec3(),this._localMatrix=h.identityMat4(),this._worldMatrix=h.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._isObject=t.isObject,this._isObject&&this.scene._registerObject(this),this.origin=t.origin,this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.offset=t.offset,t.children){const e=t.children;for(let s=0,i=e.length;s<i;s++)this.addChild(e[s],t.inheritStates)}if(t.parentId){const e=this.scene.components[t.parentId];e?e.isNode?e.addChild(this):this.error("Parent is not a Node: '"+t.parentId+"'"):this.error("Parent not found: '"+t.parentId+"'")}else t.parent&&(t.parent.isNode||this.error("Parent is not a Node"),t.parent.addChild(this))}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}set origin(e){e?(this._origin||(this._origin=h.vec3()),this._origin.set(e)):this._origin&&(this._origin=null);for(let t=0,s=this._children.length;t<s;t++)this._children[t].origin=e;this.glRedraw()}get origin(){return this._origin}set rtcCenter(e){this.origin=e}get rtcCenter(){return this.origin}get numTriangles(){return this._numTriangles}set visible(e){e=!1!==e,this._visible=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].visible=e;this._isObject&&this.scene._objectVisibilityUpdated(this,e)}get visible(){return this._visible}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].xrayed=e;this._isObject&&this.scene._objectXRayedUpdated(this,e)}get xrayed(){return this._xrayed}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].highlighted=e;this._isObject&&this.scene._objectHighlightedUpdated(this,e)}get highlighted(){return this._highlighted}set selected(e){e=!!e,this._selected=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].selected=e;this._isObject&&this.scene._objectSelectedUpdated(this,e)}get selected(){return this._selected}set edges(e){e=!!e,this._edges=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].edges=e}get edges(){return this._edges}set culled(e){e=!!e,this._culled=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].culled=e}get culled(){return this._culled}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].clippable=e}get clippable(){return this._clippable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].collidable=e}get collidable(){return this._collidable}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].pickable=e}get pickable(){return this._pickable}set colorize(e){let t=this._colorize;t||(t=this._colorize=new Float32Array(4),t[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);for(let e=0,s=this._children.length;e<s;e++)this._children[e].colorize=t;if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t)}}get colorize(){return this._colorize.slice(0,3)}set opacity(e){let t=this._colorize;t||(t=this._colorize=new Float32Array(4),t[0]=1,t[1]=1,t[2]=1),t[3]=null!=e?e:1;for(let t=0,s=this._children.length;t<s;t++)this._children[t].opacity=e;if(this._isObject){const t=null!=e;this.scene._objectOpacityUpdated(this,t)}}get opacity(){return this._colorize[3]}set castsShadow(e){e=!!e,this._castsShadow=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].castsShadow=e}get castsShadow(){return this._castsShadow}set receivesShadow(e){e=!!e,this._receivesShadow=e;for(let t=0,s=this._children.length;t<s;t++)this._children[t].receivesShadow=e}get receivesShadow(){return this._receivesShadow}get saoEnabled(){return!1}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this._children.length;e<t;e++)this._children[e].offset=this._offset;this._isObject&&this.scene._objectOffsetUpdated(this,e)}get offset(){return this._offset}get isNode(){return!0}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0;for(let e=0,t=this._children.length;e<t;e++)this._children[e]._setWorldMatrixDirty()}_buildWorldMatrix(){const e=this.matrix;if(this._parentNode)h.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(let t=0,s=e.length;t<s;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_setSubtreeAABBsDirty(e){if(e._aabbDirty=!0,e._children)for(let t=0,s=e._children.length;t<s;t++)this._setSubtreeAABBsDirty(e._children[t])}_setAABBDirty(){if(this._setSubtreeAABBsDirty(this),this.collidable)for(let e=this;e;e=e._parentNode)e._aabbDirty=!0}_updateAABB(){if(this.scene._aabbDirty=!0,this._aabb||(this._aabb=h.AABB3()),this._buildAABB)this._buildAABB(this.worldMatrix,this._aabb);else{let e;h.collapseAABB3(this._aabb);for(let t=0,s=this._children.length;t<s;t++)e=this._children[t],e.collidable&&h.expandAABB3(this._aabb,e.aabb)}this._aabbDirty=!1}addChild(e,t){if(_.isNumeric(e)||_.isString(e)){const t=e;if(!(e=this.scene.component[t]))return void this.warn("Component not found: "+_.inQuotes(t));if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+t)}else{if(!e.isNode&&!e.isMesh)return void this.error("Not a Node or Mesh: "+e.id);if(e._parentNode){if(e._parentNode.id===this.id)return void this.warn("Already a child: "+e.id);e._parentNode.removeChild(e)}}if(e.id,e.scene.id===this.scene.id)return this._children.push(e),e._parentNode=this,t&&(e.visible=this.visible,e.culled=this.culled,e.xrayed=this.xrayed,e.highlited=this.highlighted,e.selected=this.selected,e.edges=this.edges,e.clippable=this.clippable,e.pickable=this.pickable,e.collidable=this.collidable,e.castsShadow=this.castsShadow,e.receivesShadow=this.receivesShadow,e.colorize=this.colorize,e.opacity=this.opacity,e.offset=this.offset),e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles+=e.numTriangles,e;this.error("Child not in same Scene: "+e.id)}removeChild(e){for(let t=0,s=this._children.length;t<s;t++)if(this._children[t].id===e.id)return e._parentNode=null,this._children=this._children.splice(t,1),e._setWorldMatrixDirty(),e._setAABBDirty(),this._setAABBDirty(),void(this._numTriangles-=e.numTriangles)}removeChildren(){let e;for(let t=0,s=this._children.length;t<s;t++)e=this._children[t],e._parentNode=null,e._setWorldMatrixDirty(),e._setAABBDirty(),this._numTriangles-=e.numTriangles;this._children=[],this._setAABBDirty()}get numChildren(){return this._children.length}get children(){return this._children}set parent(e){if(_.isNumeric(e)||_.isString(e)){const t=e;if(!(e=this.scene.components[t]))return void this.warn("Node not found: "+_.inQuotes(t));if(!e.isNode)return void this.error("Not a Node: "+e.id)}e.scene.id===this.scene.id?this._parentNode&&this._parentNode.id===e.id?this.warn("Already a child of Node: "+e.id):e.addChild(this):this.error("Node not in same Scene: "+e.id)}get parent(){return this._parentNode}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),h.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),h.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set matrix(e){this._localMatrix||(this._localMatrix=h.identityMat4()),this._localMatrix.set(e||Oe),h.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=h.identityMat4()),h.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}rotate(e,t){return Ie[0]=e[0],Ie[1]=e[1],Ie[2]=e[2],Ie[3]=t*h.DEGTORAD,h.angleAxisToQuaternion(Ie,Te),h.mulQuaternions(this.quaternion,Te,Pe),this.quaternion=Pe,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(e,t){return Ie[0]=e[0],Ie[1]=e[1],Ie[2]=e[2],Ie[3]=t*h.DEGTORAD,h.angleAxisToQuaternion(Ie,Te),h.mulQuaternions(Te,this.quaternion,Te),this}rotateX(e){return this.rotate(Se,e)}rotateY(e){return this.rotate(De,e)}rotateZ(e){return this.rotate(ke,e)}translate(e,t){return h.vec3ApplyQuaternion(this.quaternion,e,Qe),h.mulVec3Scalar(Qe,t,Re),h.addVec3(this.position,Re,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(e){return this.translate(Se,e)}translateY(e){return this.translate(De,e)}translateZ(e){return this.translate(ke,e)}get type(){return"Node"}destroy(){if(super.destroy(),this._parentNode&&this._parentNode.removeChild(this),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.offset.some((e=>0!==e))&&this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this._children.length){const e=this._children.splice(0);let t;for(let s=0,i=e.length;s<i;s++)t=e[s],t.destroy()}this._children=[],this._setAABBDirty(),this.scene._aabbDirty=!0}}const Le=h.vec3(),He=function(){const e=new Float64Array(16),t=new Float64Array(4),s=new Float64Array(4);return function(i,r,n){return n=n||e,t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=1,h.transformVec4(i,t,s),h.setMat4Translation(i,s,n),n.slice()}}();function Ne(e,t,s){const i=Float32Array.from([e[0]])[0],r=e[0]-i,n=Float32Array.from([e[1]])[0],A=e[1]-n,o=Float32Array.from([e[2]])[0],a=e[2]-o;t[0]=i,t[1]=n,t[2]=o,s[0]=r,s[1]=A,s[2]=a}function Ge(e,t,s,i=1e3){const r=h.getPositionsCenter(e,Le),n=Math.round(r[0]/i)*i,A=Math.round(r[1]/i)*i,o=Math.round(r[2]/i)*i;s[0]=n,s[1]=A,s[2]=o;const a=0!==s[0]||0!==s[1]||0!==s[2];if(a)for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]-n,t[s+1]=e[s+1]-A,t[s+2]=e[s+2]-o;return a}const je=new e({}),We=h.vec3(),ze=h.vec4(),Xe={3001:"sRGBToLinear"},Ke=function(){const e=[],t=[],s=[],i=[],r=[],n=[],A=[],o=(t,s)=>{let i=!1;return e.push((e=>i&&s(t,e))),{toString:()=>(i=!0,t)}},a={createAttribute:function(t,s){let i=!1;e.push((e=>i&&e.push(`in ${t} ${s};`)));const A={toString:()=>(i=!0,s)};return r.push((e=>{const t=i&&e(s);return t&&n.push(t.attributeHash),A.setInputValue=t,null})),A},createFragmentDefinition:(e,t)=>{let s=!1;return i.push((i=>s&&t(e,i))),{toString:()=>(s=!0,e)}},createOutput:(e,t,i)=>{let r=!1;return s.push((s=>r&&s.push(`layout(location = ${i||0}) out ${e} ${t};`))),{toString:()=>(r=!0,t)}},createUniform:(t,i,r)=>{let n=!1;const o=e=>n&&e.push(`uniform ${t} ${i};`);e.push(o),s.push(o);const a={toString:()=>(n=!0,i)};return A.push((e=>{const t=n&&e(i);return r?t&&(e=>r(t,e)):(a.setInputValue=t,null)})),a},createUniformArray:(t,i,r)=>{let n=!1;const o=e=>n&&e.push(`uniform ${t} ${i}[${r}];`);e.push(o),s.push(o);const a={toString:()=>(n=!0,i)};return A.push((e=>(a.setInputValue=n&&e(i),null))),a},createUniformBlock:(t,i,r)=>{let n=!1;const o=Object.keys(i),a=e=>{n&&(e.push(`uniform ${t} {`),o.forEach((t=>e.push(`    ${i[t]} ${t};`))),e.push("};"))};e.push(a),s.push(a);const l={};return o.forEach((e=>l[e]={toString:()=>(n=!0,e)})),A.push((e=>{const s=n&&e(t);return r?s&&(e=>r(s,e)):(l.setInputValue=s,null)})),l},createVarying:(i,r,n,A)=>{let o=!1;const a=A?A+" ":"";return e.push((e=>o&&e.push(`${a}out ${i} ${r};`))),t.push((e=>o&&e.push(`${r} = ${n()};`))),s.push((e=>o&&e.push(`${a}in  ${i} ${r};`))),{toString:()=>(o=!0,r)}},createVertexDefinition:o,commonLibrary:{octDecode:o("octDecode",((e,t)=>{t.push(`vec3 ${e}(vec2 oct) {`),t.push("    vec3 v = vec3(oct.xy, 1.0 - abs(oct.x) - abs(oct.y));"),t.push("    if (v.z < 0.0) {"),t.push("        v.xy = (1.0 - abs(v.yx)) * vec2(v.x >= 0.0 ? 1.0 : -1.0, v.y >= 0.0 ? 1.0 : -1.0);"),t.push("    }"),t.push("    return normalize(v);"),t.push("}")}))}};return{programVariables:a,buildProgram:(o,l,c)=>{const u=c.getLogDepth,d=c.clipPos,p=c.usePickClipPos&&function(){const e=a.createUniform("vec2","pickClipPos"),t=a.createUniform("vec2","pickClipPosInv");return{setClipPosInputValue:s=>{e.setInputValue(s.pickClipPos),t.setInputValue(s.pickClipPosInv)},transformedClipPos:()=>`vec4((${d}.xy / ${d}.w - ${e}) * ${t} * ${d}.w, ${d}.zw)`}}(),f=p?p.transformedClipPos():d,g=[],m=a.createVarying("float","isPerspective",(()=>`(${c.projMatrix}[2][3] == -1.0) ? 1.0 : 0.0`)),_=a.createUniform("float","logDepthBufFC",((e,t)=>e(2/(Math.log(t.view.far+1)/Math.LN2)))),b=a.createVarying("float","vFragDepth",(()=>"1.0 + clipPos.w"));u?g.push(`gl_FragDepth = ${c.testPerspectiveForGl_FragDepth?`${m} == 0.0 ? gl_FragCoord.z : `:""}log2(${u(b)}) * ${_} * 0.5;`):c.cleanerEdges&&g.push("gl_FragDepth = gl_FragCoord.z + length(vec2(dFdx(gl_FragCoord.z), dFdy(gl_FragCoord.z)));");const B=a.createFragmentDefinition("linearToGamma",((e,t)=>{t.push(`vec4 ${e}(in vec4 value, in float gammaFactor) {`),t.push("  return vec4(pow(value.xyz, vec3(1.0 / gammaFactor)), value.w);"),t.push("}")})),y=c.sectionPlanesState,w=y&&function(){const e=function(e){const t=[];for(let s=0;s<e;++s)t.push(s);return t}(y.getNumAllocatedSectionPlanes()).map((e=>{const t=(t,s,i)=>a.createUniform(t,`sectionPlane${s}${e}`,((t,s)=>{const r=y.sectionPlanes,n=r.length,A=(s.mesh.layerIndex||0)*n,o=e<n&&s.mesh.renderFlags.sectionPlanesActivePerLayer[A+e];return i(t,o,r[e],s.mesh.origin)}));return{act:t("bool","Active",((e,t)=>e(t?1:0))),dir:t("vec3","Dir",((e,t,s)=>t&&e(s.dir))),pos:t("vec3","Pos",((e,t,s,i)=>t&&e(i?h.mulVec3Scalar(h.normalizeVec3(s.dir,We),-(h.dotVec3(s.dir,i)+s.dist),We):s.pos)))}}));return e.length>0&&(t=>e.map((e=>`(${e.act} ? clamp(dot(-${e.dir}, ${t} - ${e.pos}), 0.0, 1000.0) : 0.0)`)).join(" + "))}(),v=c.crossSections,C=w?function(){const e=a.createUniform("vec4","sliceColor",(e=>e(v.sliceColor))),t=s=>(t.needed=!0,`(sliced ? ${e} : ${s})`);return t}():e=>e,M=c.getGammaFactor,E=a.createUniform("float","gammaFactor",(e=>e(M())));c.appendFragmentOutputs(g,M&&(e=>`${B}(${e}, ${E})`),"gl_FragCoord",C);const F=function(){const e=[],t=a.createUniform("float","sliceThickness",(e=>e(v.sliceThickness)));if(w){C.needed&&e.push("  bool sliced = false;"),e.push(`  if (${c.clippableTest()}) {`);const s=a.createVarying("highp vec3","vHighpWorldPosition",(()=>`${c.worldPositionAttribute}.xyz`));if(e.push(`    float dist = ${w(s)};`),c.clippingCaps){const t=a.createVarying("float","vClipPositionW",(()=>"gl_Position.w"));e.push(`    if (dist > (0.002 * ${t})) { discard; }`),e.push("    if (dist > 0.0) { "),e.push(`      ${c.clippingCaps} = vec4(1.0, 0.0, 0.0, 1.0);`),u&&e.push(`      gl_FragDepth = log2(${u(b)}) * ${_} * 0.5;`),e.push("      return;"),e.push("    }")}else e.push(`    if (dist > ${C.needed?t:"0.0"}) { discard; }`);C.needed&&e.push("    sliced = dist > 0.0;"),e.push("  }")}return e}(),x=function(){const e=[];return i.forEach((t=>t(e))),e}(),U=[...function(){const e=[];return s.forEach((t=>t(e))),e}(),...x,"void main(void) {",...c.discardPoints?["  vec2 cxy = 2.0 * gl_PointCoord - 1.0;","  if (dot(cxy, cxy) > 1.0) { discard; }"]:[],...F,...g,"}"],I=[`gl_Position = ${f};`,...c.getPointSize?[`gl_PointSize = ${c.getPointSize()};`]:[],...function(){const e=[];return t.forEach((t=>t(e))),e}()],T=c.getVertexData?c.getVertexData():[],P=[...function(){const t=[];return e.forEach((e=>e(t))),t}(),"void main(void) {",...T,...I,"}"],S=e=>["#version 300 es","// "+l+" "+e+" shader","#ifdef GL_FRAGMENT_PRECISION_HIGH","precision highp float;","precision highp int;","precision highp usampler2D;","precision highp isampler2D;","precision highp sampler2D;","#else","precision mediump float;","precision mediump int;","precision mediump usampler2D;","precision mediump isampler2D;","precision mediump sampler2D;","#endif"],D=S("vertex").concat(P),k=S("fragment").concat(["vec4 sRGBToLinear(in vec4 value) {","  return vec4(mix(pow(value.rgb * 0.9478672986 + 0.0521327014, vec3(2.4)), value.rgb * 0.0773993808, vec3(lessThanEqual(value.rgb, vec3(0.04045)))), value.w);","}"]).concat(U),Q=(e,t)=>{const s=t.join("\n"),i=o.createShader(e);return o.shaderSource(i,s),o.compileShader(i),o.getShaderParameter(i,o.COMPILE_STATUS)?[i]:[null,["Failed to compile",o.getShaderInfoLog(i),s.split("\n").map(((e,t)=>t+1+": "+e+"\n")).join("")]]},[R,O]=Q(o.VERTEX_SHADER,D),[V,L]=Q(o.FRAGMENT_SHADER,k),H=e=>(console.error(e.join("\n")),[null,e]);if(O)return H(["Vertex shader error"].concat(O));if(L)return H(["Fragment shader error"].concat(L));{const e=o.createProgram();if(e){if(o.attachShader(e,R),o.attachShader(e,V),o.linkProgram(e),o.getProgramParameter(e,o.LINK_STATUS)){const t=Ye(o,e);r.forEach((e=>e(t)));const s=A.map((e=>e(t))).filter((e=>e)),i=je.addItem({});return[{id:i,bind:()=>o.useProgram(e),inputSetters:{attributesHash:n.sort().join(", "),setUniforms:(e,t)=>{p&&p.setClipPosInputValue(e),s.forEach((e=>e(t)))}},destroy:()=>{je.removeItem(i),o.deleteProgram(e),o.deleteShader(R),o.deleteShader(V)}}]}return H(["",o.getProgramInfoLog(this.program),"","Vertex shader:","",...D,"","Fragment shader:","",...k])}return H(["Failed to allocate program"])}}}},Ze=function(e,t){const s=e.createUniform("vec4","lightAmbient",(e=>e(t.getAmbientColorAndIntensity()))),i=t.lights,r=i.map(((t,s)=>{const r={color:e.createUniform("vec4",`lightColor${s}`,(e=>{const t=i[s];ze[0]=t.color[0],ze[1]=t.color[1],ze[2]=t.color[2],ze[3]=t.intensity,e(ze)})),position:e.createUniform("vec3",`lightPos${s}`,(e=>e(i[s].pos))),direction:e.createUniform("vec3",`lightDir${s}`,(e=>e(i[s].dir))),shadowProjMatrix:e.createUniform("mat4",`shadowProjMatrix${s}`,(e=>e(i[s].getShadowViewMatrix()))),shadowViewMatrix:e.createUniform("mat4",`shadowViewMatrix${s}`,(e=>e(i[s].getShadowViewMatrix()))),shadowMap:e.createUniform("sampler2D",`shadowMap${s}`,(e=>e(i[s].getShadowRenderBuf().colorTextures[0])))},n=e=>({glslLight:{isWorldSpace:"world"===t.space,getColor:()=>`${r.color}.rgb * ${r.color}.a`,getDirection:(t,s)=>`normalize(${e(t,s)})`,shadowParameters:t.castsShadow&&{getShadowProjMatrix:()=>r.shadowProjMatrix,getShadowViewMatrix:()=>r.shadowViewMatrix,getShadowMap:()=>r.shadowMap}},setupLightsInputs:()=>{const e=Object.values(r).map((e=>e.setupLightsInputs())).filter((e=>e));return()=>e.forEach((e=>e()))}});return"dir"===t.type?"view"===t.space?n(((e,t)=>`-${r.direction}`)):n(((e,t)=>`-(${e} * vec4(${r.direction}, 0.0)).xyz`)):"point"===t.type?"view"===t.space?n(((e,t)=>`${r.position} - ${t}`)):n(((e,t)=>`(${e} * vec4(${r.position}, 1.0)).xyz - ${t}`)):null})).filter((e=>e)),n=(t,s)=>{const i=()=>{const e=s();return e.length>0&&e[0]},r=i();return r&&Je(e,"samplerCube",t,r.encoding,(e=>{const t=i();t&&e(t.texture)}))},A=n("light",(()=>t.lightMaps)),o=n("reflection",(()=>t.reflectionMaps));return{getHash:()=>t.getHash(),getAmbientColor:()=>`${s}.rgb * ${s}.a`,directionalLights:r.map((e=>e.glslLight)),getIrradiance:A&&(e=>`${A(e)}.rgb`),getReflection:o&&((e,t)=>`${o(e,t)}.rgb`)}},Je=(e,t,s,i,r)=>{const n=e.createUniform(t,s+"Map",r);return(e,t)=>{const s=t?`texture(${n}, ${e}, ${t})`:`texture(${n}, ${e})`;return 3e3!==i?`${Xe[i]}(${s})`:s}},Ye=function(e,t){const s={},i=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let r=0;r<i;++r){const n=e.getActiveAttrib(t,r),A=e.getAttribLocation(t,n.name);s[n.name]=function(t){t.bindAtLocation(A),e.enableVertexAttribArray(A);const s=t.attributeDivisor;s&&e.vertexAttribDivisor(A,s)},s[n.name].attributeHash=`${A.toString().padStart(1+Math.floor(Math.log10(i)),"0")}:${n.name}`}const r=e.getProgramParameter(t,e.ACTIVE_UNIFORM_BLOCKS);for(let i=0;i<r;++i){const r=e.getActiveUniformBlockName(t,i),n=e.getUniformBlockIndex(t,r),A=i;e.uniformBlockBinding(t,n,A);const o=e.createBuffer();s[r]=function(t){e.bindBuffer(e.UNIFORM_BUFFER,o),e.bufferData(e.UNIFORM_BUFFER,t,e.DYNAMIC_DRAW),e.bindBufferBase(e.UNIFORM_BUFFER,A,o)}}const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);let A=0;for(let i=0;i<n;++i){const r=e.getActiveUniform(t,i);let n=r.name;n.endsWith("[0]")&&(n=n.substr(0,n.length-3)),"\0"===n[n.length-1]&&(n=n.substr(0,n.length-1));const o=e.getUniformLocation(t,n);if(function(){for(let t in e)if(r.type===e[t])return t}(),r.type===e.SAMPLER_2D||r.type===e.SAMPLER_CUBE||r.type===e.SAMPLER_2D_SHADOW||e instanceof window.WebGL2RenderingContext&&(r.type===e.UNSIGNED_INT_SAMPLER_2D||r.type===e.INT_SAMPLER_2D)){const t=A++;s[n]=function(s){const i=s.bind(t);return i&&e.uniform1i(o,t),i}}else s[n]=function(){if(1===r.size)switch(r.type){case e.BOOL:case e.INT:return t=>e.uniform1i(o,t);case e.FLOAT:return t=>e.uniform1f(o,t);case e.FLOAT_VEC2:return t=>e.uniform2fv(o,t);case e.FLOAT_VEC3:return t=>e.uniform3fv(o,t);case e.FLOAT_VEC4:return t=>e.uniform4fv(o,t);case e.FLOAT_MAT3:return t=>e.uniformMatrix3fv(o,!1,t);case e.FLOAT_MAT4:return t=>e.uniformMatrix4fv(o,!1,t)}else if(r.size>1)switch(r.type){case e.FLOAT:return t=>e.uniform1fv(o,t);case e.FLOAT_VEC2:return t=>e.uniform2fv(o,t);case e.FLOAT_VEC3:return t=>e.uniform3fv(o,t);case e.FLOAT_VEC4:return t=>e.uniform4fv(o,t)}throw`Unhandled uniform ${n}`}()}return function(e){const t=s[e];if(!t)throw`Missing input "${e}"`;return t}},$e=h.vec4(),qe=h.vec4();class et{constructor(){this.visibleLayers=[],this.sectionPlanesActivePerLayer=[],this.reset()}reset(){this.culled=!1,this.sectioned=!1,this.numLayers=0,this.numVisibleLayers=0,this.colorOpaque=!1,this.colorTransparent=!1,this.edgesOpaque=!1,this.edgesTransparent=!1,this.xrayedSilhouetteOpaque=!1,this.xrayedEdgesOpaque=!1,this.xrayedSilhouetteTransparent=!1,this.xrayedEdgesTransparent=!1,this.highlightedSilhouetteOpaque=!1,this.highlightedEdgesOpaque=!1,this.highlightedSilhouetteTransparent=!1,this.highlightedEdgesTransparent=!1,this.selectedSilhouetteOpaque=!1,this.selectedEdgesOpaque=!1,this.selectedSilhouetteTransparent=!1,this.selectedEdgesTransparent=!1}}const tt=h.OBB3(),st=h.vec4(),it=h.vec4(),rt=h.vec4(),nt=h.vec3([1,0,0]),At=h.vec3([0,1,0]),ot=h.vec3([0,0,1]),at=h.vec3(3),lt=h.vec3(3),ct=h.identityMat4(),ht=new e({}),ut={};class dt extends T{constructor(e,t={}){super(e,t),this.renderOrder=t.renderOrder||0,this.originalSystemId=t.originalSystemId||this.id,this.renderFlags=new et,this._state=new se({visible:!0,culled:!1,pickable:null,clippable:null,collidable:null,occluder:!1!==t.occluder,castsShadow:null,receivesShadow:null,xrayed:!1,highlighted:!1,selected:!1,edges:!1,stationary:!!t.stationary,background:!!t.background,billboard:this._checkBillboard(t.billboard),layer:null,colorize:null,pickID:this.scene._renderer.getPickID(this),drawHash:"",pickOcclusionHash:"",offset:h.vec3(),origin:null,originHash:null,isUI:t.isUI});const s=t.material?this._checkComponent2(["PhongMaterial","MetallicMaterial","SpecularMaterial","LambertMaterial"],t.material):this.scene.material,i=this,r=e=>{let t=null;const s=()=>{if(!t){const s=Ke(),r=s.programVariables.createAttribute,n=i._geometry._state,A={position:r("vec3","position"),color:n.colorsBuf&&r("vec4","color"),pickColor:r("vec4","pickColor"),uv:n.uvBuf&&r("vec2","uv"),normal:(n.autoVertexNormals||n.normalsBuf)&&["triangles","triangle-strip","triangle-fan"].includes(n.primitiveName)&&r("vec3","normal")},o=function(e){const t={toString:()=>(t.needed=!0,e)};return t},a=A.normal&&o("worldNormal"),l=a&&o("viewNormal"),c=A.uv&&o("decodedUv"),h=e(s.programVariables,{attributes:{position:{world:"worldPosition",view:"viewPosition"},color:A.color,pickColor:A.pickColor,uv:c,normal:A.normal&&{world:a,view:l}},viewMatrix:"viewMatrix2"}),u=[h.programName,i.scene.canvas.canvas.id,i.scene._sectionPlanesState.getHash(),i._geometry._state.hash].concat(h.getHash()).join(";");if(!(u in ut)){const e=ft(i,A,{decodedUv:c,worldNormal:a,viewNormal:l},h,s);if(e.errors)return void console.log(e.errors.join("\n"));const t=ht.addItem({});ut[u]={drawMesh:e.drawMesh,id:t,useCount:0,delete:()=>{ht.removeItem(t),e.destroy(),delete ut[u],p.memory.programs--}},p.memory.programs++}t=ut[u],t.useCount++}};return{get:s,getId:()=>t.id,put:()=>{t&&(0==--t.useCount&&t.delete(),t=null)},drawMesh:(e,i,r)=>{s(),t&&t.drawMesh(e,i,r)}}},n=i.scene,A=e=>(t,s)=>function(e,t,s,i,r){const n=r&&Ze(t,i._lightsState),A=t.createUniform("vec3","uColor",((e,t)=>e(r?t.material.fillColor:t.material.edgeColor))),o=t.createUniform("float","uAlpha",((e,t)=>e(r?t.material.fillAlpha:t.material.edgeAlpha))),a=t.createVarying("vec4","vColor",(()=>{const e=s.attributes,t=r&&[n.getAmbientColor()].concat(e.normal?n.directionalLights.map((t=>`(max(dot(${e.normal.view}, ${t.getDirection(s.viewMatrix,e.position.view)}), 0.0) * ${t.getColor()})`)):[]);return`vec4(${A}${t?` * (${t.join(" + ")})`:""}, ${o})`})),l=t.createOutput("vec4","outColor");return{getHash:()=>[e,i.gammaOutput?"go":"",n&&n.getHash()],programName:r?"EmphasisFill":"EmphasisEdges",dontSetFrontFace:!0,discardPoints:r,drawEdges:!r,appendFragmentOutputs:(e,t)=>e.push(`${l} = ${t?t(a):a};`)}}(i._state.hash,t,s,n,e);this._renderers={_drawRenderer:r(((e,t)=>"LambertMaterial"===s.type?function(e,t,s,i,r){const n=Ze(t,r._lightsState),A=t.createUniform("vec4","colorize",((e,t)=>e(t.meshColorize))),o=t.createUniform("float","materialAlpha",((e,t)=>e(t.material.alpha))),a=t.createUniform("vec3","materialColor",((e,t)=>e(t.material.color))),l=t.createUniform("vec3","materialEmissive",((e,t)=>e(t.material.emissive))),c=t.createVarying("vec4","vColor",(()=>{const e=s.attributes,t=[n.getAmbientColor()].concat(e.normal?n.directionalLights.map((t=>`(max(dot(${e.normal.view}, ${t.getDirection(s.viewMatrix,e.position.view)}), 0.0) * ${t.getColor()})`)):[]);return`${A} * vec4((${t.join(" + ")}) * ${a} + ${l}, ${o});`})),h=t.createOutput("vec4","outColor");return{getHash:()=>[e,r.gammaOutput?"go":"",n.getHash(),i._state.hash],programName:"Lambert",canActAsBackground:!0,discardPoints:!0,setupPointSize:!0,setsLineWidth:!0,appendFragmentOutputs:(e,t)=>e.push(`${h} = ${t?t(c):c};`)}}(i._state.drawHash,e,t,s,n):function(e,t,s,i,r){const n=i._state,A="PhongMaterial"===n.type,o="MetallicMaterial"===n.type,a="SpecularMaterial"===n.type,l=s.attributes,c=Ze(t,r._lightsState),h=t.createUniform("vec4","colorize",((e,t)=>e(t.meshColorize))),u=t.createFragmentDefinition("fresnel",((e,t)=>{t.push(`float ${e}(vec3 eyeDir, vec3 normal, float edgeBias, float centerBias, float power) {`),t.push("    float fr = abs(dot(eyeDir, normal));"),t.push("    float finalFr = clamp((fr - edgeBias) / (centerBias - edgeBias), 0.0, 1.0);"),t.push("    return pow(finalFr, power);"),t.push("}")})),d=(e,s,r)=>{const n=(s,i,n)=>t.createUniform(s,e+"Fresnel"+i,((e,t)=>e(n(r(t.material))))),A=n("float","EdgeBias",(e=>e.edgeBias)),o=n("float","CenterBias",(e=>e.centerBias)),a=n("float","Power",(e=>e.power)),l=n("vec3","EdgeColor",(e=>e.edgeColor)),c=n("vec3","CenterColor",(e=>e.centerColor));return r(i)&&((e,t)=>`mix(${l+s}, ${c+s}, ${u}(${e}, ${t}, ${A}, ${o}, ${a}))`)},p=d("diffuse","",(e=>e._diffuseFresnel)),f=d("specular","",(e=>e._specularFresnel)),g=d("emissive","",(e=>e._emissiveFresnel)),m=d("alpha",".r",(e=>e._alphaFresnel)),_=(e,s)=>{const r=l.uv&&s(i),n=r&&Je(t,"sampler2D",e,r.encoding,((e,t)=>e(s(t.material)._state.texture)));return n&&function(){const i=r._state.matrix&&t.createUniform("mat4",e+"MapMatrix",((e,t)=>e(s(t.material)._state.matrix))),A=i?e=>`(${i} * ${e}).st`:e=>`${e}.st`,o=(e,t)=>n(A(e));return o.getTexCoordExpression=A,o}()},b=_("ambient",(e=>e._ambientMap)),B=_("baseColor",(e=>e._baseColorMap)),y=_("diffuse",(e=>e._diffuseMap)),w=_("emissive",(e=>e._emissiveMap)),v=_("occlusion",(e=>e._occlusionMap)),C=_("alpha",(e=>e._alphaMap)),M=_("metallic",(e=>e._metallicMap)),E=_("roughness",(e=>e._roughnessMap)),F=_("metallicRoughness",(e=>e._metallicRoughnessMap)),x=_("specular",(e=>e._specularMap)),U=_("glossiness",(e=>e._glossinessMap)),I=_("specularGlossiness",(e=>e._specularGlossinessMap)),T=_("normal",(e=>e._normalMap)),P=(e,s,r)=>{const n=r(i);return("float"===s?null!=n:n)&&t.createUniform(s,e,((e,t)=>e(r(t.material))))},S=P("materialAmbient","vec3",(e=>e.ambient)),D=P("materialDiffuse","vec3",(e=>e.diffuse)),k=P("materialBaseColor","vec3",(e=>e.baseColor)),Q=P("materialEmissive","vec3",(e=>e.emissive)),R=P("materialSpecular","vec3",(e=>e.specular)),O=P("materialGlossiness","float",(e=>e.glossiness)),V=P("materialMetallic","float",(e=>e.metallic)),L=P("materialRoughness","float",(e=>e.roughness)),H=P("materialShininess","float",(e=>e.shininess)),N=P("materialSpecularF0","float",(e=>e.specularF0)),G=P("materialAlphaModeCutoff","vec4",(e=>{const t=e.alpha;return null!=t?($e[0]=t,$e[1]=1===e.alphaMode?1:0,$e[2]=e.alphaCutoff,$e):null})),j=t.createVarying("vec3","vViewPosition",(()=>`${l.position.view}.xyz`)),W=t.createVarying("vec4","texturePos",(()=>`vec4(${l.uv}, 1.0, 1.0)`)),z=l.color&&t.createVarying("vec4","vColor",(()=>l.color)),X=t.createVarying("vec3","vViewNormal",(()=>l.normal.view)),K=c.directionalLights.map(((e,i)=>({vViewLightReverseDir:t.createVarying("vec3",`vViewLightReverseDir${i}`,(()=>e.getDirection(s.viewMatrix,null))),vShadowPosFromLight:t.createVarying("vec3",`vShadowPosFromLight${i}`,(()=>`(mat4(0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.0, 0.0, 0.0, 0.5, 0.0, 0.5, 0.5, 0.5, 1.0) * ${e.shadowParameters.getShadowProjMatrix()} * (${e.shadowParameters.getShadowViewMatrix()} * ${l.position.world})).xyz`))}))),Z=t.createVarying("vec3","vWorldNormal",(()=>l.normal.world)),J=t.createOutput("vec4","outColor"),Y=t.createFragmentDefinition("saturate",((e,t)=>t.push(`float ${e}(const in float a) { return clamp(a, 0.0, 1.0); }`))),$=t.createFragmentDefinition("BRDF_Specular_GGX",((e,t)=>{t.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),t.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),t.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),t.push("}"),t.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   return 1.0 / ( gl * gv );"),t.push("}"),t.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   return 0.5 / max( gv + gl, 1e-6 );"),t.push("}"),t.push("float D_GGX(const in float alpha, const in float dotNH) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),t.push("   return 0.31830988618 * a2 / ( denom * denom);"),t.push("}"),t.push(`vec3 ${e}(const in vec3 incidentLightDirection, const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {`),t.push("   float alpha = ( roughness * roughness );"),t.push("   vec3 halfDir = normalize( incidentLightDirection + viewEyeDir );"),t.push(`   float dotNL = ${Y}( dot( viewNormal, incidentLightDirection ) );`),t.push(`   float dotNV = ${Y}( dot( viewNormal, viewEyeDir ) );`),t.push(`   float dotNH = ${Y}( dot( viewNormal, halfDir ) );`),t.push(`   float dotLH = ${Y}( dot( incidentLightDirection, halfDir ) );`),t.push("   vec3  F = F_Schlick( specularColor, dotLH );"),t.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),t.push("   float D = D_GGX( alpha, dotNH );"),t.push("   return F * (G * D);"),t.push("}")})),q=t.createFragmentDefinition("BRDF_Specular_GGX_Environment",((e,t)=>{t.push(`vec3 ${e}(const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {`),t.push(`   float dotNV = ${Y}(dot(viewNormal, viewEyeDir));`),t.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),t.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),t.push("   vec4 r = roughness * c0 + c1;"),t.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),t.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),t.push("   return specularColor * AB.x + AB.y;"),t.push("}")})),ee=t.createFragmentDefinition("perturbNormal2Arb",((e,t)=>{t.push(`vec3 ${e}( vec3 eye_pos, vec3 surf_norm, vec2 uv, vec4 texel ) {`),t.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),t.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),t.push("      vec2 st0 = dFdx( uv.st );"),t.push("      vec2 st1 = dFdy( uv.st );"),t.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),t.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),t.push("      vec3 N = normalize( surf_norm );"),t.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),t.push("      mat3 tsn = mat3( S, T, N );"),t.push("      return normalize( tsn * mapN );"),t.push("}")}));return{getHash:()=>[e,r.gammaOutput?"go":"",c.getHash(),i._state.hash],programName:"Draw",canActAsBackground:!0,discardPoints:!0,setupPointSize:!0,setsLineWidth:!0,appendFragmentOutputs:(e,t,i)=>{const r=l.normal&&(c.directionalLights.length>0||c.getIrradiance||c.getReflection);if(e.push(`vec3 diffuseColor = ${r&&(A||a)&&D||o&&k||"vec3(1.0)"};`),e.push(`vec4 alphaModeCutoff = ${(A||o||a)&&G||"vec4(1.0, 0.0, 0.0, 0.0)"};`),e.push("float alpha = alphaModeCutoff[0];"),(A||o||a)&&C&&e.push(`alpha *= ${C(W)}.r;`),z&&(e.push(`diffuseColor *= ${z}.rgb;`),e.push(`alpha *= ${z}.a;`)),o&&B&&(e.push("vec4 baseColorTexel = "+B(W)+";"),e.push("diffuseColor *= baseColorTexel.rgb;"),e.push("alpha *= baseColorTexel.a;")),(A||a)&&y&&(e.push("vec4 diffuseTexel = "+y(W)+";"),e.push("diffuseColor *= diffuseTexel.rgb;"),e.push("alpha *= diffuseTexel.a;")),e.push(`vec3 emissiveColor = ${(A||o||a)&&Q||"vec3(0.0)"};`),(A||o||a)&&w&&e.push(`emissiveColor = ${w(W)}.rgb;`),r){e.push(`vec3 specular    = ${(A||a)&&R||"vec3(1.0)"};`),e.push(`float glossiness = ${a&&O||"1.0"};`),e.push(`float metallic   = ${o&&V||"1.0"};`),e.push(`float roughness  = ${(o||a)&&L||"1.0"};`),e.push(`float shininess  = ${A&&H||"1.0"};`),e.push(`float specularF0 = ${o&&N||"1.0"};`),e.push(`float occlusion  = ${(A||o||a)&&v?`${v(W)}.r`:"1.0"};`),o&&M&&e.push(`metallic  *= ${M(W)}.r;`),o&&E&&e.push(`roughness *= ${E(W)}.r;`),o&&F&&(e.push("vec4 metalRoughTexel = "+F(W)+";"),e.push("metallic  *= metalRoughTexel.b;"),e.push("roughness *= metalRoughTexel.g;")),(A||a)&&x&&e.push(`specular *= ${x(W)}.rgb;`),a&&U&&e.push(`glossiness *= ${U(W)}.r;`),a&&I&&(e.push("vec4 specGlossTexel = "+I(W)+";"),e.push("specular   *= specGlossTexel.rgb;"),e.push("glossiness *= specGlossTexel.a;"));const t=`normalize(${X})`,i=(A||o||a)&&T?`${ee}(${j}, ${t}, ${T.getTexCoordExpression(W)}, ${T(W)})`:t;if(e.push(`vec3 viewNormal = ${i};`),e.push(`vec3 viewEyeDir = normalize(-${j});`),p&&e.push(`diffuseColor  *= ${p("viewEyeDir","viewNormal")};`),f&&e.push(`specular      *= ${f("viewEyeDir","viewNormal")};`),g&&e.push(`emissiveColor *= ${g("viewEyeDir","viewNormal")};`),m&&e.push(`alpha         *= ${m("viewEyeDir","viewNormal")};`),e.push("if (alphaModeCutoff[1] == 1.0 && alpha < alphaModeCutoff[2]) {"),e.push("   discard;"),e.push("}"),e.push("vec3 material_diffuseColor;"),A&&(e.push("material_diffuseColor = diffuseColor;"),e.push("roughness = 0.0;")),a&&(e.push("float oneMinusSpecularStrength = 1.0 - max(max(specular.r, specular.g ),specular.b);"),e.push("material_diffuseColor = diffuseColor * oneMinusSpecularStrength;"),e.push("roughness = clamp(1.0 - glossiness, 0.04, 1.0);")),o&&(e.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),e.push("material_diffuseColor = diffuseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),e.push("roughness = clamp(roughness, 0.04, 1.0);"),e.push("specular = mix(vec3(dielectricSpecular), diffuseColor, metallic);")),A||o||a){if(e.push("const float PI = 3.14159265359;"),e.push("vec3 reflDiff = vec3(0.0);"),e.push("vec3 reflSpec = vec3(0.0);"),c.getIrradiance&&e.push(`reflDiff += ${c.getIrradiance(`normalize(${Z})`)};`),c.getReflection){const t="reflect(-viewEyeDir, viewNormal)",i=A?`0.2 * PI * ${c.getReflection(t)}`:function(){const e=`${q}(viewNormal, viewEyeDir, specular, roughness)`,i=`normalize((vec4(${t}, 0.0) * ${s.viewMatrix}).xyz)`;return`${e} * ${c.getReflection(i,"clamp(4.0 - 0.39624 - 0.25 * log2(pow(2.0 / pow(roughness + 0.0001, 2.0) - 2.0, 2.0) + 1.0), 0.0, 4.0)")}`}();e.push(`reflSpec += ${i};`)}c.directionalLights.some((e=>e.shadowParameters))&&(e.push("const vec4 bitShift = vec4(1.0, 1.0/256.0, 1.0/(256.0 * 256.0), 1.0/(256.0*256.0*256.0));"),e.push("const float texelSize = 1.0 / 1024.0;"),e.push("float shadow;"),e.push("float fragmentDepth;")),c.directionalLights.forEach(((t,s)=>{if(t.shadowParameters){const i="0.007";e.push(`fragmentDepth = ${K[s].vShadowPosFromLight}.z - ${i};`),e.push("shadow = 0.0;"),e.push("for (int x = -3; x <= 3; x++) {"),e.push("  for (int y = -3; y <= 3; y++) {"),e.push(`      float texelDepth = dot(texture(${t.getShadowMap()}, ${K[s].vShadowPosFromLight}.xy + vec2(x, y) * texelSize), bitShift);`),e.push("      if (fragmentDepth < texelDepth) {"),e.push("          shadow += 1.0;"),e.push("      }"),e.push("  }"),e.push("}"),e.push("shadow /= 9.0;")}e.push(`vec3 lightColor${s} = ${t.getColor()}${t.shadowParameters?" * shadow":""};`),e.push(`vec3 lightDirection${s} = ${t.isWorldSpace?K[s].vViewLightReverseDir:t.getDirection(null,j)};`);const i=`${Y}(dot(viewNormal, lightDirection${s}))`;e.push(`vec3 irradiance${s} = ${i} * lightColor${s};`),e.push(`reflDiff += irradiance${s};`);const r=A?`lightColor${s} * specular * pow(max(dot(reflect(-lightDirection${s}, -viewNormal), viewEyeDir), 0.0), shininess)`:`irradiance${s} * PI * ${$}(lightDirection${s}, viewNormal, viewEyeDir, specular, roughness)`;e.push(`reflSpec += ${r};`)}))}const r=A&&`${c.getAmbientColor()} * diffuseColor`;e.push("vec3 outgoingLight = emissiveColor + occlusion * (reflDiff * material_diffuseColor + reflSpec)"+(r?" + "+r:"")+";")}else e.push(`vec3 ambientColor = ${A&&S||"vec3(1.0)"};`),A&&b&&e.push(`ambientColor *= ${b(W)}.rgb;`),e.push(`ambientColor *= ${c.getAmbientColor()};`),e.push("vec3 outgoingLight = emissiveColor + ambientColor;");e.push(`vec4 fragColor = ${h} * vec4(outgoingLight, alpha);`),e.push(`${J} = ${t?t("fragColor"):"fragColor"};`)}}}(i._state.drawHash,e,t,s,n))),_shadowRenderer:r((e=>function(e,t){const s=t.createFragmentDefinition("encodeFloat",((e,t)=>{t.push(`vec4 ${e}( const in float depth ) {`),t.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),t.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),t.push("  vec4 comp = fract(depth * bitShift);"),t.push("  comp -= comp.xxyz * bitMask;"),t.push("  return comp;"),t.push("}")})),i=t.createOutput("vec4","outColor");return{getHash:()=>[e],programName:"Shadow",setsLineWidth:!0,useShadowView:!0,dontBillboardAnything:!0,dontGetLogDepth:!0,appendFragmentOutputs:(e,t,r)=>e.push(`${i} = ${s}(${r}.z);`)}}(i._state.hash,e))),_emphasisEdgesRenderer:r(A(!1)),_emphasisFillRenderer:r(A(!0)),_pickMeshRenderer:r((e=>function(e,t){const s=t.createUniform("vec4","pickColor",((e,t)=>{var s=t.meshPickID;qe[0]=255&s,qe[1]=s>>8&255,qe[2]=s>>16&255,qe[3]=s>>24&255,h.mulVec4Scalar(qe,1/255,qe),e(qe)})),i=t.createOutput("vec4","outColor");return{getHash:()=>[e],programName:"PickMesh",isPick:!0,dontBillboardAnything:!0,appendFragmentOutputs:e=>e.push(`${i} = ${s};`)}}(i._state.hash,e))),_pickTriangleRenderer:r(((e,t)=>function(e,t,s){const i=t.createVarying("vec4","vColor",(()=>s.attributes.pickColor)),r=t.createOutput("vec4","outColor");return{getHash:()=>[e],programName:"PickTriangle",isPick:!0,trianglePick:!0,dontBillboardAnything:!0,appendFragmentOutputs:e=>e.push(`${r} = ${i};`)}}(i._state.hash,e,t))),_occlusionRenderer:r((e=>function(e,t){const s=t.createOutput("vec4","outColor");return{getHash:()=>[e],programName:"Occlusion",skipIfTransparent:!0,appendFragmentOutputs:e=>e.push(`${s} = vec4(0.0, 0.0, 1.0, 1.0);`)}}(i._state.pickOcclusionHash,e)))},this._geometry=t.geometry?this._checkComponent2(["ReadableGeometry","VBOGeometry"],t.geometry):this.scene.geometry,this._material=s,this._xrayMaterial=t.xrayMaterial?this._checkComponent("EmphasisMaterial",t.xrayMaterial):this.scene.xrayMaterial,this._highlightMaterial=t.highlightMaterial?this._checkComponent("EmphasisMaterial",t.highlightMaterial):this.scene.highlightMaterial,this._selectedMaterial=t.selectedMaterial?this._checkComponent("EmphasisMaterial",t.selectedMaterial):this.scene.selectedMaterial,this._edgeMaterial=t.edgeMaterial?this._checkComponent("EdgeMaterial",t.edgeMaterial):this.scene.edgeMaterial,this._parentNode=null,this._aabb=null,this._aabbDirty=!0,this._numTriangles=this._geometry?this._geometry.numTriangles:0,this.scene._aabbDirty=!0,this._scale=h.vec3(),this._quaternion=h.identityQuaternion(),this._rotation=h.vec3(),this._position=h.vec3(),this._worldMatrix=h.identityMat4(),this._worldNormalMatrix=h.identityMat4(),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0;const o=t.origin||t.rtcCenter;if(o&&(this._state.origin=h.vec3(o),this._state.originHash=o.join()),t.matrix?this.matrix=t.matrix:(this.scale=t.scale,this.position=t.position,t.quaternion||(this.rotation=t.rotation)),this._isObject=t.isObject,this._isObject&&this.scene._registerObject(this),this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.layer=t.layer,this.colorize=t.colorize,this.opacity=t.opacity,this.offset=t.offset,t.parentId){const e=this.scene.components[t.parentId];e?e.isNode?e.addChild(this):this.error("Parent is not a Node: '"+t.parentId+"'"):this.error("Parent not found: '"+t.parentId+"'"),this._parentNode=e}else t.parent&&(t.parent.isNode||this.error("Parent is not a Node"),t.parent.addChild(this),this._parentNode=t.parent);this.compile()}get type(){return"Mesh"}get isMesh(){return!0}get parent(){return this._parentNode}get geometry(){return this._geometry}get material(){return this._material}get position(){return this._position}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get rotation(){return this._rotation}set rotation(e){this._rotation.set(e||[0,0,0]),h.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),h.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get scale(){return this._scale}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get matrix(){return this._localMatrixDirty&&(this.__localMatrix||(this.__localMatrix=h.identityMat4()),h.composeMat4(this._position,this._quaternion,this._scale,this.__localMatrix),this._localMatrixDirty=!1),this.__localMatrix}set matrix(e){this.__localMatrix||(this.__localMatrix=h.identityMat4()),this.__localMatrix.set(e||ct),h.decomposeMat4(this.__localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._setWorldMatrixDirty(),this._setAABBDirty(),this.glRedraw()}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}get worldNormalMatrix(){return this._worldNormalMatrixDirty&&this._buildWorldNormalMatrix(),this._worldNormalMatrix}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return this._isObject}get isUI(){return this._state.isUI}get aabb(){return this._aabbDirty&&this._updateAABB(),this._aabb}get origin(){return this._state.origin}set origin(e){e?(this._state.origin||(this._state.origin=h.vec3()),this._state.origin.set(e),this._state.originHash=e.join(),this._setAABBDirty(),this.scene._aabbDirty=!0):this._state.origin&&(this._state.origin=null,this._state.originHash=null,this._setAABBDirty(),this.scene._aabbDirty=!0)}get rtcCenter(){return this.origin}set rtcCenter(e){this.origin=e}get numTriangles(){return this._numTriangles}get visible(){return this._state.visible}set visible(e){e=!1!==e,this._state.visible=e,this._isObject&&this.scene._objectVisibilityUpdated(this,e),this.glRedraw()}get xrayed(){return this._state.xrayed}set xrayed(e){e=!!e,this._state.xrayed!==e&&(this._state.xrayed=e,this._isObject&&this.scene._objectXRayedUpdated(this,e),this.glRedraw())}get highlighted(){return this._state.highlighted}set highlighted(e){(e=!!e)!==this._state.highlighted&&(this._state.highlighted=e,this._isObject&&this.scene._objectHighlightedUpdated(this,e),this.glRedraw())}get selected(){return this._state.selected}set selected(e){(e=!!e)!==this._state.selected&&(this._state.selected=e,this._isObject&&this.scene._objectSelectedUpdated(this,e),this.glRedraw())}get edges(){return this._state.edges}set edges(e){(e=!!e)!==this._state.edges&&(this._state.edges=e,this.glRedraw())}get culled(){return this._state.culled}set culled(e){this._state.culled=!!e,this.glRedraw()}get clippable(){return this._state.clippable}set clippable(e){e=!1!==e,this._state.clippable!==e&&(this._state.clippable=e,this.glRedraw())}get collidable(){return this._state.collidable}set collidable(e){(e=!1!==e)!==this._state.collidable&&(this._state.collidable=e,this._setAABBDirty(),this.scene._aabbDirty=!0)}get pickable(){return this._state.pickable}set pickable(e){e=!1!==e,this._state.pickable!==e&&(this._state.pickable=e)}get castsShadow(){return this._state.castsShadow}set castsShadow(e){(e=!1!==e)!==this._state.castsShadow&&(this._state.castsShadow=e,this.glRedraw())}get receivesShadow(){return this._state.receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._state.receivesShadow&&(this._state.receivesShadow=e,this._state.hash=e?"/mod/rs;":"/mod;",this.fire("dirty",this))}get saoEnabled(){return!1}get colorize(){return this._state.colorize}set colorize(e){let t=this._state.colorize;t||(t=this._state.colorize=new Float32Array(4),t[3]=1),e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1);const s=!!e;this.scene._objectColorizeUpdated(this,s),this.glRedraw()}get opacity(){return this._state.colorize[3]}set opacity(e){let t=this._state.colorize;t||(t=this._state.colorize=new Float32Array(4),t[0]=1,t[1]=1,t[2]=1);const s=null!=e;t[3]=s?e:1,this.scene._objectOpacityUpdated(this,s),this.glRedraw()}get transparent(){return 2===this._material.alphaMode||this._state.colorize[3]<1}get layer(){return this._state.layer}set layer(e){e=e||0,(e=Math.round(e))!==this._state.layer&&(this._state.layer=e,this._renderer.needStateSort())}get stationary(){return this._state.stationary}get billboard(){return this._state.billboard}get offset(){return this._state.offset}set offset(e){this._state.offset.set(e||[0,0,0]),this._setAABBDirty(),this.glRedraw()}get isDrawable(){return!0}get isStateSortable(){return!0}get xrayMaterial(){return this._xrayMaterial}get highlightMaterial(){return this._highlightMaterial}get selectedMaterial(){return this._selectedMaterial}get edgeMaterial(){return this._edgeMaterial}_checkBillboard(e){return"spherical"!==(e=e||"none")&&"cylindrical"!==e&&"none"!==e&&(this.error("Unsupported value for 'billboard': "+e+" - accepted values are 'spherical', 'cylindrical' and 'none' - defaulting to 'none'."),e="none"),e}compile(){const e=this.scene,t=this._state,s=[e.canvas.canvas.id,e._sectionPlanesState.getHash()];t.stationary&&s.push("/s"),"none"===t.billboard?s.push("/n"):"spherical"===t.billboard?s.push("/s"):"cylindrical"===t.billboard&&s.push("/c"),s.push(";");const i=s.concat([e.gammaOutput?"go":"",e._lightsState.getHash(),t.receivesShadow?"/rs":""]).join("");this._state.drawHash!==i&&(this._state.drawHash=i,this._renderers._drawRenderer.put(),this._renderers._shadowRenderer.put(),this._renderers._emphasisFillRenderer.put(),this._renderers._emphasisEdgesRenderer.put(),this._renderers._drawRenderer.get(),this._renderers._emphasisFillRenderer.get(),this._renderers._emphasisEdgesRenderer.get());const r=s.join("");this._state.pickOcclusionHash!==r&&(this._state.pickOcclusionHash=r,this._renderers._pickMeshRenderer.put(),this._renderers._pickTriangleRenderer.put(),this._renderers._pickMeshRenderer.get(),this._state.occluder&&(this._renderers._occlusionRenderer.put(),this._renderers._occlusionRenderer.get()))}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._setWorldMatrixDirty()}_setWorldMatrixDirty(){this._worldMatrixDirty=!0,this._worldNormalMatrixDirty=!0}_buildWorldMatrix(){const e=this.matrix;if(this._parentNode)h.mulMat4(this._parentNode.worldMatrix,e,this._worldMatrix);else for(let t=0,s=e.length;t<s;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_buildWorldNormalMatrix(){this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldNormalMatrix||(this._worldNormalMatrix=h.mat4()),h.transposeMat4(this._worldMatrix,this._worldNormalMatrix),h.inverseMat4(this._worldNormalMatrix),this._worldNormalMatrixDirty=!1}_setAABBDirty(){if(this.collidable)for(let e=this;e;e=e._parentNode)e._aabbDirty=!0}_updateAABB(){this.scene._aabbDirty=!0,this._aabb||(this._aabb=h.AABB3()),this._buildAABB(this.worldMatrix,this._aabb),this._aabbDirty=!1}_buildAABB(e,t){h.transformOBB3(e,this._geometry.obb,tt),h.OBB3ToAABB3(tt,t);const s=this._state.offset;if(t[0]+=s[0],t[1]+=s[1],t[2]+=s[2],t[3]+=s[0],t[4]+=s[1],t[5]+=s[2],this._state.origin){const e=this._state.origin;t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[0],t[4]+=e[1],t[5]+=e[2]}}rotate(e,t){return st[0]=e[0],st[1]=e[1],st[2]=e[2],st[3]=t*h.DEGTORAD,h.angleAxisToQuaternion(st,it),h.mulQuaternions(this.quaternion,it,rt),this.quaternion=rt,this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}rotateOnWorldAxis(e,t){return st[0]=e[0],st[1]=e[1],st[2]=e[2],st[3]=t*h.DEGTORAD,h.angleAxisToQuaternion(st,it),h.mulQuaternions(it,this.quaternion,it),this}rotateX(e){return this.rotate(nt,e)}rotateY(e){return this.rotate(At,e)}rotateZ(e){return this.rotate(ot,e)}translate(e,t){return h.vec3ApplyQuaternion(this.quaternion,e,at),h.mulVec3Scalar(at,t,lt),h.addVec3(this.position,lt,this.position),this._setLocalMatrixDirty(),this._setAABBDirty(),this.glRedraw(),this}translateX(e){return this.translate(nt,e)}translateY(e){return this.translate(At,e)}translateZ(e){return this.translate(ot,e)}stateSortCompare(e,t){return e._state.layer-t._state.layer||e._renderers._drawRenderer.getId()-t._renderers._drawRenderer.getId()||e._material._state.id-t._material._state.id||e._geometry._state.id-t._geometry._state.id}rebuildRenderFlags(){this.renderFlags.reset(),this._getActiveSectionPlanes()?(this.renderFlags.numLayers=1,this.renderFlags.numVisibleLayers=1,this.renderFlags.visibleLayers[0]=0,this._updateRenderFlags()):this.renderFlags.culled=!0}_updateRenderFlags(){const e=this.renderFlags,t=this._state;if(t.xrayed){const t=this._xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}else{if(this._material._state.alpha<1||t.colorize[3]<1?e.colorTransparent=!0:e.colorOpaque=!0,t.edges){this._edgeMaterial._state.alpha<1?e.edgesTransparent=!0:e.edgesOpaque=!0}if(t.selected){const t=this._selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}else if(t.highlighted){const t=this._highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}}_getActiveSectionPlanes(){if(this._state.clippable){const e=this.scene._sectionPlanesState.sectionPlanes,t=e.length;if(t>0)for(let s=0;s<t;s++){const t=e[s],i=this.renderFlags;if(t.active)if(this._state.origin){const e=h.planeAABB3Intersect(t.dir,t.dist,this.aabb);if(-1===e)return!1;const r=0===e;i.sectionPlanesActivePerLayer[s]=r}else i.sectionPlanesActivePerLayer[s]=!0;else i.sectionPlanesActivePerLayer[s]=!1}}return!0}drawColorOpaque(e){this._renderers._drawRenderer.drawMesh(e,this,this._material)}drawColorTransparent(e){this._renderers._drawRenderer.drawMesh(e,this,this._material)}drawSilhouetteXRayed(e){this._renderers._emphasisFillRenderer.drawMesh(e,this,this._xrayMaterial)}drawSilhouetteHighlighted(e){this._renderers._emphasisFillRenderer.drawMesh(e,this,this._highlightMaterial)}drawSilhouetteSelected(e){this._renderers._emphasisFillRenderer.drawMesh(e,this,this._selectedMaterial)}drawEdgesColorOpaque(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._edgeMaterial)}drawEdgesColorTransparent(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._edgeMaterial)}drawEdgesXRayed(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._xrayMaterial)}drawEdgesHighlighted(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._highlightMaterial)}drawEdgesSelected(e){this._renderers._emphasisEdgesRenderer.drawMesh(e,this,this._selectedMaterial)}drawOcclusion(e){this._renderers._occlusionRenderer.drawMesh(e,this,this._material)}drawShadow(e){this._renderers._shadowRenderer.drawMesh(e,this,this._material)}drawPickMesh(e){this._renderers._pickMeshRenderer.drawMesh(e,this,this._material)}canPickTriangle(){return this._geometry.isReadableGeometry}drawPickTriangles(e){this._renderers._pickTriangleRenderer.drawMesh(e,this,this._material)}pickTriangleSurface(e,t,s,i){pt(this,e,t,s,i)}drawPickVertices(e){}delegatePickedEntity(){return this}destroy(){super.destroy(),Object.values(this._renderers).forEach((e=>e.put())),this.scene._renderer.putPickID(this._state.pickID),this._isObject&&(this.scene._deregisterObject(this),this._visible&&this.scene._objectVisibilityUpdated(this,!1,!1),this._xrayed&&this.scene._objectXRayedUpdated(this,!1,!1),this._selected&&this.scene._objectSelectedUpdated(this,!1,!1),this._highlighted&&this.scene._objectHighlightedUpdated(this,!1,!1),this.scene._objectColorizeUpdated(this,!1),this.scene._objectOpacityUpdated(this,!1),this.offset.some((e=>0!==e))&&this.scene._objectOffsetUpdated(this,!1)),this._isModel&&this.scene._deregisterModel(this),this.glRedraw()}}const pt=function(){const e=h.vec3(),t=h.vec3(),s=h.vec3(),i=h.vec3(),r=h.vec3(),n=h.vec3(),A=h.vec4(),o=h.vec3(),a=h.vec3(),l=h.vec3(),c=h.vec3(),u=h.vec3(),d=h.vec3(),p=h.vec3(),f=h.vec3(),g=h.vec3(),m=h.vec4(),_=h.vec4(),b=h.vec4(),B=h.vec3(),y=h.vec3(),w=h.vec3(),v=h.vec3(),C=h.vec3(),M=h.vec3(),E=h.vec3(),F=h.vec3(),x=h.vec3(),U=h.vec3(),I=h.vec3();return function(T,P,S,D,k){var Q=k.primIndex;if(null!=Q&&Q>-1){const L=T.geometry._state,H=T.scene,N=H.camera,G=H.canvas;if("triangles"===L.primitiveName){k.primitive="triangle";const H=Q,j=L.indices,W=L.positions;let z,X,K;if(j){var R=j[H+0],O=j[H+1],V=j[H+2];n[0]=R,n[1]=O,n[2]=V,k.indices=n,z=3*R,X=3*O,K=3*V}else z=3*H,X=z+3,K=X+3;if(s[0]=W[z+0],s[1]=W[z+1],s[2]=W[z+2],i[0]=W[X+0],i[1]=W[X+1],i[2]=W[X+2],r[0]=W[K+0],r[1]=W[K+1],r[2]=W[K+2],L.compressGeometry){const e=L.positionsDecodeMatrix;e&&(he.decompressPosition(s,e,s),he.decompressPosition(i,e,i),he.decompressPosition(r,e,r))}k.canvasPos?h.canvasPosToLocalRay(G.canvas,T.origin?He(P,T.origin):P,S,D,T.worldMatrix,k.canvasPos,e,t):k.origin&&k.direction&&h.worldRayToLocalRay(T.worldMatrix,k.origin,k.direction,e,t),h.normalizeVec3(t),h.rayPlaneIntersect(e,t,s,i,r,A),k.localPos=A,k.position=A,m[0]=A[0],m[1]=A[1],m[2]=A[2],m[3]=1,h.transformVec4(T.worldMatrix,m,_),o[0]=_[0],o[1]=_[1],o[2]=_[2],k.canvasPos&&T.origin&&(o[0]+=T.origin[0],o[1]+=T.origin[1],o[2]+=T.origin[2]),k.worldPos=o,h.transformVec4(N.matrix,_,b),a[0]=b[0],a[1]=b[1],a[2]=b[2],k.viewPos=a,h.cartesianToBarycentric(A,s,i,r,l),k.bary=l;const Z=L.normals;if(Z){if(L.compressGeometry){const e=3*R,t=3*O,s=3*V;he.decompressNormal(Z.subarray(e,e+2),c),he.decompressNormal(Z.subarray(t,t+2),u),he.decompressNormal(Z.subarray(s,s+2),d)}else c[0]=Z[z],c[1]=Z[z+1],c[2]=Z[z+2],u[0]=Z[X],u[1]=Z[X+1],u[2]=Z[X+2],d[0]=Z[K],d[1]=Z[K+1],d[2]=Z[K+2];const e=h.addVec3(h.addVec3(h.mulVec3Scalar(c,l[0],B),h.mulVec3Scalar(u,l[1],y),w),h.mulVec3Scalar(d,l[2],v),C);k.worldNormal=h.normalizeVec3(h.transformVec3(T.worldNormalMatrix,e,M))}const J=L.uv;if(J){if(p[0]=J[2*R],p[1]=J[2*R+1],f[0]=J[2*O],f[1]=J[2*O+1],g[0]=J[2*V],g[1]=J[2*V+1],L.compressGeometry){const e=L.uvDecodeMatrix;e&&(he.decompressUV(p,e,p),he.decompressUV(f,e,f),he.decompressUV(g,e,g))}k.uv=h.addVec3(h.addVec3(h.mulVec2Scalar(p,l[0],E),h.mulVec2Scalar(f,l[1],F),x),h.mulVec2Scalar(g,l[2],U),I)}}}}}(),ft=(e,t,s,i,r)=>{const n=r.programVariables,A=s.decodedUv,o=s.worldNormal,a=s.viewNormal,l=e.scene,c=l.canvas.gl,h=e._state.background,u=e._geometry._state,d=u.compressGeometry,p="points"===u.primitiveName,f=n.createUniform("float","pointSize"),g=n.createUniform("mat4","modelMatrix"),m=n.createUniform("mat4","modelNormalMatrix"),_=n.createUniform("vec3","offset"),b=n.createUniform("vec3","scale"),B=n.createUniform("mat4","positionsDecodeMatrix"),y=n.createUniform("mat3","uvDecodeMatrix"),w=n.createUniform("mat4","viewMatrix"),v=n.createUniform("mat4","viewNormalMatrix"),C=n.createUniform("mat4","projMatrix"),M=e.billboard,E=!i.dontBillboardAnything&&("spherical"===M||"cylindrical"===M),F=e.stationary,x=E&&((e,t)=>[`mat4 ${e}(in mat4 matIn) {`,"   mat4 mat = matIn;",`   mat[0].xyz = vec3(${b}[0], 0.0, 0.0);`,..."spherical"===M?[`   mat[1].xyz = vec3(0.0, ${b}[1], 0.0);`]:[],"   mat[2].xyz = vec3(0.0, 0.0, 1.0);","   return mat;","}"].forEach((e=>t.push(e)))),U=function(){const e=x&&n.createVertexDefinition("billboard",x);return t=>e?`${e}(${t})`:t}(),I=function(){const e=x&&n.createFragmentDefinition("billboard",x);return t=>e?`${e}(${t})`:t}(),T=[];i.dontBillboardAnything?T.push(`mat4 viewMatrix2 = ${w};`):(T.push(`mat4 viewMatrix1 = ${w};`),F?T.push("viewMatrix1[3].xyz = vec3(0.0, 0.0, 0.0);"):h&&T.push("viewMatrix1[3]     = vec4(0.0, 0.0, 0.0, 1.0);"),T.push(`mat4 viewMatrix2 = ${I("viewMatrix1")};`));const P="clipPos",S=n.createUniform("bool","clippable"),[D,k]=r.buildProgram(c,i.programName,{appendFragmentOutputs:(e,t,s,r)=>{T.forEach((t=>e.push(t))),i.appendFragmentOutputs(e,t,s,r)},clippableTest:()=>S,clippingCaps:i.clippingCaps,clipPos:h?"clipPos.xyww":P,crossSections:l.crossSections,discardPoints:p&&i.discardPoints,getGammaFactor:l.gammaOutput&&(()=>l.gammaFactor),getLogDepth:!i.dontGetLogDepth&&l.logarithmicDepthBufferEnabled&&(e=>e),getPointSize:i.setupPointSize&&p&&(()=>f),getVertexData:function(){const e=a&&a.needed&&`vec3 ${a} = normalize((${U(v)} * vec4(${o}, 0.0)).xyz);`,s=[];if(s.push(`vec4 localPosition = vec4(${t.position}, 1.0);`),d&&s.push(`localPosition = ${B} * localPosition;`),s.push(`vec4 worldPosition = ${U(g)} * localPosition;`),s.push(`worldPosition.xyz = worldPosition.xyz + ${_};`),i.dontBillboardAnything?s.push(`vec4 viewPosition = ${w} * worldPosition;`):(s.push(`mat4 viewMatrix1 = ${w};`),F?s.push("viewMatrix1[3].xyz = vec3(0.0, 0.0, 0.0);"):h&&s.push("viewMatrix1[3]     = vec4(0.0, 0.0, 0.0, 1.0);"),s.push(`mat4 viewMatrix2 = ${U("viewMatrix1")};`),s.push(`vec4 viewPosition = ${E?`${U(`viewMatrix1 * ${g}`)} * localPosition`:"viewMatrix2 * worldPosition"};`)),A&&A.needed&&s.push(`vec2 ${A} = ${d?`(${y} * vec3(${t.uv}, 1.0)).xy`:t.uv};`),o&&o.needed){const e=d?`${n.commonLibrary.octDecode}(${t.normal}.xy)`:t.normal;s.push(`vec3 ${o} = (${U(m)} * vec4(${e}, 0.0)).xyz;`)}return e&&s.push(e),s.push(`vec4 clipPos = ${C} * viewPosition;`),s},projMatrix:C,sectionPlanesState:l._sectionPlanesState,testPerspectiveForGl_FragDepth:!0,usePickClipPos:i.isPick,worldPositionAttribute:"worldPosition"});if(k)return{errors:k};{const e=D.inputSetters;let s=null,r=null;return{destroy:()=>D.destroy(),drawMesh:(n,A,o)=>{if(i.skipIfTransparent&&o.alpha<1)return;const a=o._state,l=A._state,u=A._geometry,d=u._state,p=n.viewParams,M=i.canActAsBackground&&h;n.lastProgramId!==D.id&&(n.lastProgramId=D.id,D.bind(),n.useProgram++,s=null,r=null,M&&c.depthFunc(c.LEQUAL)),a.id!==s&&(n.backfaces!==a.backfaces&&(a.backfaces?c.disable(c.CULL_FACE):c.enable(c.CULL_FACE),n.backfaces=a.backfaces),i.dontSetFrontFace||n.frontface===a.frontface||(c.frontFace(a.frontface?c.CCW:c.CW),n.frontface=a.frontface),i.drawEdges&&n.lineWidth!==a.edgeWidth&&(c.lineWidth(a.edgeWidth),n.lineWidth=a.edgeWidth),i.setsLineWidth&&n.lineWidth!==a.lineWidth&&(c.lineWidth(a.lineWidth),n.lineWidth=a.lineWidth),s=a.id);const E=!i.useShadowView&&A.origin;((t,s)=>{const i=(e,t)=>e.setInputValue&&e.setInputValue(t);i(f,o.pointSize),i(g,A.worldMatrix),i(m,A.worldNormalMatrix),i(_,A.offset),i(b,A.scale),i(B,d.positionsDecodeMatrix),i(y,d.uvDecodeMatrix),i(w,s),i(v,p.viewNormalMatrix),i(C,t),i(S,A.clippable),e.setUniforms(n,{material:o,meshColorize:A.colorize,meshPickID:A._state.pickID,mesh:{origin:A.origin,renderFlags:{sectionPlanesActivePerLayer:A.renderFlags.sectionPlanesActivePerLayer}},view:{far:p.far}})})(p.projMatrix,E?n.getRTCViewMatrix(l.originHash,E):p.viewMatrix);const F=e=>{const s=(e,t)=>{e&&e.setInputValue&&t&&(e.setInputValue(t),n.bindArray++)};s(t.position,(e||d).positionsBuf),s(t.color,d.colorsBuf),s(t.pickColor,e&&e.pickColorsBuf),s(t.uv,d.uvBuf),s(t.normal,d.normalsBuf)};if(i.trianglePick){const e=u._getPickTrianglePositions();d.id!==r&&(F({positionsBuf:e,pickColorsBuf:u._getPickTriangleColors()}),r=d.id),c.drawArrays(d.primitive,0,e.numItems/3)}else if(i.drawEdges){const e=d.primitive===c.TRIANGLES?u._getEdgeIndices():d.primitive===c.LINES&&d.indicesBuf;e&&(d.id!==r&&(F(),e.bind(),n.bindArray++,r=d.id),c.drawElements(c.LINES,e.numItems,e.itemType,0),n.drawElements++)}else d.id!==r&&(F(),d.indicesBuf&&(d.indicesBuf.bind(),n.bindArray++),r=d.id),d.indicesBuf?(c.drawElements(d.primitive,d.indicesBuf.numItems,d.indicesBuf.itemType,0),n.drawElements++):d.positionsBuf&&(c.drawArrays(c.TRIANGLES,0,d.positionsBuf.numItems),n.drawArrays++);M&&c.depthFunc(c.LESS)}}}};class gt extends T{get type(){return"Material"}constructor(e,t={}){super(e,t),p.memory.materials++}destroy(){super.destroy(),p.memory.materials--}}const mt={opaque:0,mask:1,blend:2},_t=["opaque","mask","blend"];class bt extends gt{get type(){return"PhongMaterial"}constructor(e,t={}){super(e,t),this._state=new se({type:"PhongMaterial",ambient:h.vec3([1,1,1]),diffuse:h.vec3([1,1,1]),specular:h.vec3([1,1,1]),emissive:h.vec3([0,0,0]),alpha:null,shininess:null,reflectivity:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.ambient=t.ambient,this.diffuse=t.diffuse,this.specular=t.specular,this.emissive=t.emissive,this.alpha=t.alpha,this.shininess=t.shininess,this.reflectivity=t.reflectivity,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,t.ambientMap&&(this._ambientMap=this._checkComponent("Texture",t.ambientMap)),t.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",t.diffuseMap)),t.specularMap&&(this._specularMap=this._checkComponent("Texture",t.specularMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.reflectivityMap&&(this._reflectivityMap=this._checkComponent("Texture",t.reflectivityMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.diffuseFresnel&&(this._diffuseFresnel=this._checkComponent("Fresnel",t.diffuseFresnel)),t.specularFresnel&&(this._specularFresnel=this._checkComponent("Fresnel",t.specularFresnel)),t.emissiveFresnel&&(this._emissiveFresnel=this._checkComponent("Fresnel",t.emissiveFresnel)),t.alphaFresnel&&(this._alphaFresnel=this._checkComponent("Fresnel",t.alphaFresnel)),t.reflectivityFresnel&&(this._reflectivityFresnel=this._checkComponent("Fresnel",t.reflectivityFresnel)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this._makeHash()}_makeHash(){const e=this._state,t=["/p"];this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._ambientMap&&(t.push("/am"),this._ambientMap.hasMatrix&&t.push("/mat"),t.push("/"+this._ambientMap.encoding)),this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat"),t.push("/"+this._emissiveMap.encoding)),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),this._reflectivityMap&&(t.push("/rm"),this._reflectivityMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._diffuseFresnel&&t.push("/df"),this._specularFresnel&&t.push("/sf"),this._emissiveFresnel&&t.push("/ef"),this._alphaFresnel&&t.push("/of"),this._reflectivityFresnel&&t.push("/rf"),t.push(";"),e.hash=t.join("")}set ambient(e){let t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set diffuse(e){let t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}set specular(e){let t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get specular(){return this._state.specular}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}set shininess(e){this._state.shininess=void 0!==e?e:80,this.glRedraw()}get shininess(){return this._state.shininess}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set reflectivity(e){this._state.reflectivity=void 0!==e?e:1,this.glRedraw()}get reflectivity(){return this._state.reflectivity}get normalMap(){return this._normalMap}get ambientMap(){return this._ambientMap}get diffuseMap(){return this._diffuseMap}get specularMap(){return this._specularMap}get emissiveMap(){return this._emissiveMap}get alphaMap(){return this._alphaMap}get reflectivityMap(){return this._reflectivityMap}get occlusionMap(){return this._occlusionMap}get diffuseFresnel(){return this._diffuseFresnel}get specularFresnel(){return this._specularFresnel}get emissiveFresnel(){return this._emissiveFresnel}get alphaFresnel(){return this._alphaFresnel}get reflectivityFresnel(){return this._reflectivityFresnel}set alphaMode(e){let t=mt[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" - defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return _t[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}destroy(){super.destroy(),this._state.destroy()}}function Bt(e,t){if(void 0===e._cachedExtensions&&(e._cachedExtensions={}),void 0!==e._cachedExtensions[t])return e._cachedExtensions[t];let s;switch(t){case"WEBGL_depth_texture":s=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=e.getExtension(t)}return e._cachedExtensions[t]=s,s}function yt(e,t,s=null){let i;const r=t;if(1009===r)return e.UNSIGNED_BYTE;if(1017===r)return e.UNSIGNED_SHORT_4_4_4_4;if(1018===r)return e.UNSIGNED_SHORT_5_5_5_1;if(1010===r)return e.BYTE;if(1011===r)return e.SHORT;if(1012===r)return e.UNSIGNED_SHORT;if(1013===r)return e.INT;if(1014===r)return e.UNSIGNED_INT;if(1015===r)return e.FLOAT;if(1016===r)return e.HALF_FLOAT;if(1021===r)return e.ALPHA;if(1023===r)return e.RGBA;if(1024===r)return e.LUMINANCE;if(1025===r)return e.LUMINANCE_ALPHA;if(1026===r)return e.DEPTH_COMPONENT;if(1027===r)return e.DEPTH_STENCIL;if(1028===r)return e.RED;if(1022===r)return e.RGBA;if(1029===r)return e.RED_INTEGER;if(1030===r)return e.RG;if(1031===r)return e.RG_INTEGER;if(1033===r)return e.RGBA_INTEGER;if(33776===r||33777===r||33778===r||33779===r)if(3001===s){const t=Bt(e,"WEBGL_compressed_texture_s3tc_srgb");if(null===t)return null;if(33776===r)return t.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===r)return t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===r)return t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===r)return t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(i=Bt(e,"WEBGL_compressed_texture_s3tc"),null===i)return null;if(33776===r)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===r)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===r)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===r)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===r||35841===r||35842===r||35843===r){const t=Bt(e,"WEBGL_compressed_texture_pvrtc");if(null===t)return null;if(35840===r)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===r)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===r)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===r)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===r){const t=Bt(e,"WEBGL_compressed_texture_etc1");return null!==t?t.COMPRESSED_RGB_ETC1_WEBGL:null}if(37492===r||37496===r){const t=Bt(e,"WEBGL_compressed_texture_etc");if(null===t)return null;if(37492===r)return 3001===s?t.COMPRESSED_SRGB8_ETC2:t.COMPRESSED_RGB8_ETC2;if(37496===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:t.COMPRESSED_RGBA8_ETC2_EAC}if(37808===r||37809===r||37810===r||37811===r||37812===r||37813===r||37814===r||37815===r||37816===r||37817===r||37818===r||37819===r||37820===r||37821===r){const t=Bt(e,"WEBGL_compressed_texture_astc");if(null===t)return null;if(37808===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:t.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:t.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:t.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:t.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:t.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:t.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:t.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:t.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:t.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:t.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:t.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:t.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:t.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===r)return 3001===s?t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:t.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===r){const t=Bt(e,"EXT_texture_compression_bptc");if(null===t)return null;if(36492===r)return 3001===s?t.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:t.COMPRESSED_RGBA_BPTC_UNORM_EXT}return 1020===r?e.UNSIGNED_INT_24_8:1e3===r?e.REPEAT:1001===r?e.CLAMP_TO_EDGE:1004===r||1005===r?e.NEAREST_MIPMAP_LINEAR:1007===r?e.LINEAR_MIPMAP_NEAREST:1008===r?e.LINEAR_MIPMAP_LINEAR:1003===r?e.NEAREST:1006===r?e.LINEAR:null}const wt=new Uint8Array([0,0,0,1]);class vt{constructor({gl:e,target:t,format:s,type:i,wrapS:r,wrapT:n,wrapR:A,encoding:o,preloadColor:a,premultiplyAlpha:l,flipY:c}){this.gl=e,this.target=t||e.TEXTURE_2D,this.format=s||1023,this.type=i||1009,this.internalFormat=null,this.premultiplyAlpha=!!l,this.flipY=!!c,this.unpackAlignment=4,this.wrapS=r||1e3,this.wrapT=n||1e3,this.wrapR=A||1e3,this.encoding=o||3001,this.texture=e.createTexture(),a&&this.setPreloadColor(a),this.allocated=!0}setPreloadColor(e){e?(wt[0]=Math.floor(255*e[0]),wt[1]=Math.floor(255*e[1]),wt[2]=Math.floor(255*e[2]),wt[3]=Math.floor(255*(void 0!==e[3]?e[3]:1))):(wt[0]=0,wt[1]=0,wt[2]=0,wt[3]=255);const t=this.gl;if(t.bindTexture(this.target,this.texture),this.target===t.TEXTURE_CUBE_MAP){const e=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let s=0,i=e.length;s<i;s++)t.texImage2D(e[s],0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,wt)}else t.texImage2D(this.target,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,wt);t.bindTexture(this.target,null)}setTarget(e){this.target=e||this.gl.TEXTURE_2D}setImage(e,t={}){const s=this.gl;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR);let i=!1;s.bindTexture(this.target,this.texture);const r=s.getParameter(s.UNPACK_FLIP_Y_WEBGL);s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flipY);const n=s.getParameter(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL);s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha);const A=s.getParameter(s.UNPACK_ALIGNMENT);s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment);const o=s.getParameter(s.UNPACK_COLORSPACE_CONVERSION_WEBGL);s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const a=yt(s,this.minFilter);s.texParameteri(this.target,s.TEXTURE_MIN_FILTER,a),a!==s.NEAREST_MIPMAP_NEAREST&&a!==s.LINEAR_MIPMAP_NEAREST&&a!==s.NEAREST_MIPMAP_LINEAR&&a!==s.LINEAR_MIPMAP_LINEAR||(i=!0);const l=yt(s,this.magFilter);l&&s.texParameteri(this.target,s.TEXTURE_MAG_FILTER,l);const c=yt(s,this.wrapS);c&&s.texParameteri(this.target,s.TEXTURE_WRAP_S,c);const h=yt(s,this.wrapT);h&&s.texParameteri(this.target,s.TEXTURE_WRAP_T,h);const u=yt(s,this.format,this.encoding),d=yt(s,this.type),p=Ct(s,this.internalFormat,u,d,this.encoding,!1);if(this.target===s.TEXTURE_CUBE_MAP){if(_.isArray(e)){const t=e,i=[s.TEXTURE_CUBE_MAP_POSITIVE_X,s.TEXTURE_CUBE_MAP_NEGATIVE_X,s.TEXTURE_CUBE_MAP_POSITIVE_Y,s.TEXTURE_CUBE_MAP_NEGATIVE_Y,s.TEXTURE_CUBE_MAP_POSITIVE_Z,s.TEXTURE_CUBE_MAP_NEGATIVE_Z];for(let e=0,r=i.length;e<r;e++)s.texImage2D(i[e],0,p,u,d,t[e])}}else s.texImage2D(s.TEXTURE_2D,0,p,u,d,e);i&&s.generateMipmap(this.target),s.bindTexture(this.target,null),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,r),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n),s.pixelStorei(s.UNPACK_ALIGNMENT,A),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,o)}setCompressedData({mipmaps:e,props:t={}}){const s=this.gl,i=e.length;void 0!==t.format&&(this.format=t.format),void 0!==t.internalFormat&&(this.internalFormat=t.internalFormat),void 0!==t.encoding&&(this.encoding=t.encoding),void 0!==t.type&&(this.type=t.type),void 0!==t.flipY&&(this.flipY=t.flipY),void 0!==t.premultiplyAlpha&&(this.premultiplyAlpha=t.premultiplyAlpha),void 0!==t.unpackAlignment&&(this.unpackAlignment=t.unpackAlignment),void 0!==t.minFilter&&(this.minFilter=t.minFilter),void 0!==t.magFilter&&(this.magFilter=t.magFilter),void 0!==t.wrapS&&(this.wrapS=t.wrapS),void 0!==t.wrapT&&(this.wrapT=t.wrapT),void 0!==t.wrapR&&(this.wrapR=t.wrapR),s.activeTexture(s.TEXTURE0+0),s.bindTexture(this.target,this.texture);let r=e.length>1;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,this.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,this.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE);const n=yt(s,this.wrapS);n&&s.texParameteri(this.target,s.TEXTURE_WRAP_S,n);const A=yt(s,this.wrapT);if(A&&s.texParameteri(this.target,s.TEXTURE_WRAP_T,A),this.type===s.TEXTURE_3D||this.type===s.TEXTURE_2D_ARRAY){const e=yt(s,this.wrapR);e&&s.texParameteri(this.target,s.TEXTURE_WRAP_R,e),s.texParameteri(this.type,s.TEXTURE_WRAP_R,e)}r?(s.texParameteri(this.target,s.TEXTURE_MIN_FILTER,Mt(s,this.minFilter)),s.texParameteri(this.target,s.TEXTURE_MAG_FILTER,Mt(s,this.magFilter))):(s.texParameteri(this.target,s.TEXTURE_MIN_FILTER,yt(s,this.minFilter)),s.texParameteri(this.target,s.TEXTURE_MAG_FILTER,yt(s,this.magFilter)));const o=yt(s,this.format,this.encoding),a=yt(s,this.type),l=Ct(s,this.internalFormat,o,a,this.encoding,!1);s.texStorage2D(s.TEXTURE_2D,i,l,e[0].width,e[0].height);for(let t=0,i=e.length;t<i;t++){const i=e[t];1023!==this.format?null!==o?s.compressedTexSubImage2D(s.TEXTURE_2D,t,0,0,i.width,i.height,o,i.data):console.warn("Attempt to load unsupported compressed texture format in .setCompressedData()"):s.texSubImage2D(s.TEXTURE_2D,t,0,0,i.width,i.height,o,a,i.data)}s.bindTexture(this.target,null)}setProps(e){const t=this.gl;t.bindTexture(this.target,this.texture),this._uploadProps(e),t.bindTexture(this.target,null)}_uploadProps(e){const t=this.gl;if(void 0!==e.format&&(this.format=e.format),void 0!==e.internalFormat&&(this.internalFormat=e.internalFormat),void 0!==e.encoding&&(this.encoding=e.encoding),void 0!==e.type&&(this.type=e.type),void 0!==e.minFilter){const s=yt(t,e.minFilter);s&&(this.minFilter=e.minFilter,t.texParameteri(this.target,t.TEXTURE_MIN_FILTER,s),s!==t.NEAREST_MIPMAP_NEAREST&&s!==t.LINEAR_MIPMAP_NEAREST&&s!==t.NEAREST_MIPMAP_LINEAR&&s!==t.LINEAR_MIPMAP_LINEAR||t.generateMipmap(this.target))}if(void 0!==e.magFilter){const s=yt(t,e.magFilter);s&&(this.magFilter=e.magFilter,t.texParameteri(this.target,t.TEXTURE_MAG_FILTER,s))}if(void 0!==e.wrapS){const s=yt(t,e.wrapS);s&&(this.wrapS=e.wrapS,t.texParameteri(this.target,t.TEXTURE_WRAP_S,s))}if(void 0!==e.wrapT){const s=yt(t,e.wrapT);s&&(this.wrapT=e.wrapT,t.texParameteri(this.target,t.TEXTURE_WRAP_T,s))}}bind(e){if(this.allocated){if(this.texture){const t=this.gl;return t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,this.texture),!0}return!1}}unbind(e){if(this.allocated&&this.texture){const t=this.gl;t.activeTexture(t["TEXTURE"+e]),t.bindTexture(this.target,null)}}destroy(){this.allocated&&this.texture&&(this.gl.deleteTexture(this.texture),this.texture=null)}}function Ct(e,t,s,i,r,n=!1){if(null!==t){if(void 0!==e[t])return e[t];console.warn("Attempt to use non-existing WebGL internal format '"+t+"'")}let A=s;return s===e.RED&&(i===e.FLOAT&&(A=e.R32F),i===e.HALF_FLOAT&&(A=e.R16F),i===e.UNSIGNED_BYTE&&(A=e.R8)),s===e.RG&&(i===e.FLOAT&&(A=e.RG32F),i===e.HALF_FLOAT&&(A=e.RG16F),i===e.UNSIGNED_BYTE&&(A=e.RG8)),s===e.RGBA&&(i===e.FLOAT&&(A=e.RGBA32F),i===e.HALF_FLOAT&&(A=e.RGBA16F),i===e.UNSIGNED_BYTE&&(A=3001===r&&!1===n?e.SRGB8_ALPHA8:e.RGBA8),i===e.UNSIGNED_SHORT_4_4_4_4&&(A=e.RGBA4),i===e.UNSIGNED_SHORT_5_5_5_1&&(A=e.RGB5_A1)),A!==e.R16F&&A!==e.R32F&&A!==e.RG16F&&A!==e.RG32F&&A!==e.RGBA16F&&A!==e.RGBA32F||Bt(e,"EXT_color_buffer_float"),A}function Mt(e,t){return 1003===t||1004===t||1005===t?e.NEAREST:e.LINEAR}function Et(e){if(!Ft(e.width)||!Ft(e.height)){const t=document.createElement("canvas");t.width=xt(e.width),t.height=xt(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function Ft(e){return 0==(e&e-1)}function xt(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}class Ut extends T{get type(){return"Texture"}constructor(e,t={}){super(e,t),this._state=new se({texture:new vt({gl:this.scene.canvas.gl}),matrix:h.identityMat4(),hasMatrix:t.translate&&(0!==t.translate[0]||0!==t.translate[1])||!!t.rotate||t.scale&&(0!==t.scale[0]||0!==t.scale[1]),minFilter:this._checkMinFilter(t.minFilter),magFilter:this._checkMagFilter(t.magFilter),wrapS:this._checkWrapS(t.wrapS),wrapT:this._checkWrapT(t.wrapT),flipY:this._checkFlipY(t.flipY),encoding:this._checkEncoding(t.encoding)}),this._src=null,this._image=null,this._translate=h.vec2([0,0]),this._scale=h.vec2([1,1]),this._rotate=h.vec2([0,0]),this._matrixDirty=!1,this.translate=t.translate,this.scale=t.scale,this.rotate=t.rotate,t.src?this.src=t.src:t.image&&(this.image=t.image),p.memory.textures++}_checkMinFilter(e){return 1006!==(e=e||1008)&&1007!==e&&1008!==e&&1005!==e&&1004!==e&&(this.error("Unsupported value for 'minFilter' - supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, NearestMipMapLinearFilter and LinearMipMapLinearFilter. Defaulting to LinearMipMapLinearFilter."),e=1008),e}_checkMagFilter(e){return 1006!==(e=e||1006)&&1003!==e&&(this.error("Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),e=1006),e}_checkWrapS(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}_checkWrapT(e){return 1001!==(e=e||1e3)&&1002!==e&&1e3!==e&&(this.error("Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),e=1e3),e}_checkFlipY(e){return!!e}_checkEncoding(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}_update(){const e=this._state;if(this._matrixDirty){let t,s;0===this._translate[0]&&0===this._translate[1]||(t=h.translationMat4v([this._translate[0],this._translate[1],0],this._state.matrix)),1===this._scale[0]&&1===this._scale[1]||(s=h.scalingMat4v([this._scale[0],this._scale[1],1]),t=t?h.mulMat4(t,s):s),0!==this._rotate&&(s=h.rotationMat4v(.0174532925*this._rotate,[0,0,1]),t=t?h.mulMat4(t,s):s),t&&(e.matrix=t),this._matrixDirty=!1}this.glRedraw()}set image(e){this._image=Et(e),this._image.crossOrigin="Anonymous",this._state.texture.setImage(this._image,this._state),this._src=null,this.glRedraw()}get image(){return this._image}set src(e){this.scene.loading++,this.scene.canvas.spinner.processes++;const t=this;let s=new Image;s.onload=function(){s=Et(s),t._state.texture.setImage(s,t._state),t.scene.loading--,t.glRedraw(),t.scene.canvas.spinner.processes--},s.src=e,this._src=e,this._image=null}get src(){return this._src}set translate(e){this._translate.set(e||[0,0]),this._matrixDirty=!0,this._needUpdate()}get translate(){return this._translate}set scale(e){this._scale.set(e||[1,1]),this._matrixDirty=!0,this._needUpdate()}get scale(){return this._scale}set rotate(e){e=e||0,this._rotate!==e&&(this._rotate=e,this._matrixDirty=!0,this._needUpdate())}get rotate(){return this._rotate}get minFilter(){return this._state.minFilter}get magFilter(){return this._state.magFilter}get wrapS(){return this._state.wrapS}get wrapT(){return this._state.wrapT}get flipY(){return this._state.flipY}get encoding(){return this._state.encoding}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),this._state.destroy(),p.memory.textures--}}const It=h.vec3(),Tt=h.vec3();h.vec3();const Pt=h.vec3([0,-1,0]),St=h.vec4([0,0,0,1]);class Dt extends gt{get type(){return"LambertMaterial"}constructor(e,t={}){super(e,t),this._state=new se({type:"LambertMaterial",ambient:h.vec3([1,1,1]),color:h.vec3([1,1,1]),emissive:h.vec3([0,0,0]),alpha:null,alphaMode:0,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:"/lam;"}),this.ambient=t.ambient,this.color=t.color,this.emissive=t.emissive,this.alpha=t.alpha,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this.backfaces=t.backfaces,this.frontface=t.frontface}set ambient(e){let t=this._state.ambient;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.ambient=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get ambient(){return this._state.ambient}set color(e){let t=this._state.color;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.color=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get color(){return this._state.color}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this._state.alphaMode=e<1?2:0,this.glRedraw())}get alpha(){return this._state.alpha}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}const kt={opaque:0,mask:1,blend:2},Qt=["opaque","mask","blend"];class Rt extends gt{get type(){return"MetallicMaterial"}constructor(e,t={}){super(e,t),this._state=new se({type:"MetallicMaterial",baseColor:h.vec4([1,1,1]),emissive:h.vec4([0,0,0]),metallic:null,roughness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.baseColor=t.baseColor,this.metallic=t.metallic,this.roughness=t.roughness,this.specularF0=t.specularF0,this.emissive=t.emissive,this.alpha=t.alpha,t.baseColorMap&&(this._baseColorMap=this._checkComponent("Texture",t.baseColorMap)),t.metallicMap&&(this._metallicMap=this._checkComponent("Texture",t.metallicMap)),t.roughnessMap&&(this._roughnessMap=this._checkComponent("Texture",t.roughnessMap)),t.metallicRoughnessMap&&(this._metallicRoughnessMap=this._checkComponent("Texture",t.metallicRoughnessMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this._makeHash()}_makeHash(){const e=this._state,t=["/met"];this._baseColorMap&&(t.push("/bm"),this._baseColorMap._state.hasMatrix&&t.push("/mat"),t.push("/"+this._baseColorMap._state.encoding)),this._metallicMap&&(t.push("/mm"),this._metallicMap._state.hasMatrix&&t.push("/mat")),this._roughnessMap&&(t.push("/rm"),this._roughnessMap._state.hasMatrix&&t.push("/mat")),this._metallicRoughnessMap&&(t.push("/mrm"),this._metallicRoughnessMap._state.hasMatrix&&t.push("/mat")),this._emissiveMap&&(t.push("/em"),this._emissiveMap._state.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap._state.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/am"),this._alphaMap._state.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap._state.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}set baseColor(e){let t=this._state.baseColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.baseColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get baseColor(){return this._state.baseColor}get baseColorMap(){return this._baseColorMap}set metallic(e){e=null!=e?e:1,this._state.metallic!==e&&(this._state.metallic=e,this.glRedraw())}get metallic(){return this._state.metallic}get metallicMap(){return this._attached.metallicMap}set roughness(e){e=null!=e?e:1,this._state.roughness!==e&&(this._state.roughness=e,this.glRedraw())}get roughness(){return this._state.roughness}get roughnessMap(){return this._attached.roughnessMap}get metallicRoughnessMap(){return this._attached.metallicRoughnessMap}set specularF0(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._attached.emissiveMap}get occlusionMap(){return this._attached.occlusionMap}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._attached.alphaMap}get normalMap(){return this._attached.normalMap}set alphaMode(e){let t=kt[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return Qt[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}const Ot={opaque:0,mask:1,blend:2},Vt=["opaque","mask","blend"];class Lt extends gt{get type(){return"SpecularMaterial"}constructor(e,t={}){super(e,t),this._state=new se({type:"SpecularMaterial",diffuse:h.vec3([1,1,1]),emissive:h.vec3([0,0,0]),specular:h.vec3([1,1,1]),glossiness:null,specularF0:null,alpha:null,alphaMode:null,alphaCutoff:null,lineWidth:null,pointSize:null,backfaces:null,frontface:null,hash:null}),this.diffuse=t.diffuse,this.specular=t.specular,this.glossiness=t.glossiness,this.specularF0=t.specularF0,this.emissive=t.emissive,this.alpha=t.alpha,t.diffuseMap&&(this._diffuseMap=this._checkComponent("Texture",t.diffuseMap)),t.emissiveMap&&(this._emissiveMap=this._checkComponent("Texture",t.emissiveMap)),t.specularMap&&(this._specularMap=this._checkComponent("Texture",t.specularMap)),t.glossinessMap&&(this._glossinessMap=this._checkComponent("Texture",t.glossinessMap)),t.specularGlossinessMap&&(this._specularGlossinessMap=this._checkComponent("Texture",t.specularGlossinessMap)),t.occlusionMap&&(this._occlusionMap=this._checkComponent("Texture",t.occlusionMap)),t.alphaMap&&(this._alphaMap=this._checkComponent("Texture",t.alphaMap)),t.normalMap&&(this._normalMap=this._checkComponent("Texture",t.normalMap)),this.alphaMode=t.alphaMode,this.alphaCutoff=t.alphaCutoff,this.backfaces=t.backfaces,this.frontface=t.frontface,this.lineWidth=t.lineWidth,this.pointSize=t.pointSize,this._makeHash()}_makeHash(){const e=this._state,t=["/spe"];this._diffuseMap&&(t.push("/dm"),this._diffuseMap.hasMatrix&&t.push("/mat"),t.push("/"+this._diffuseMap.encoding)),this._emissiveMap&&(t.push("/em"),this._emissiveMap.hasMatrix&&t.push("/mat")),this._glossinessMap&&(t.push("/gm"),this._glossinessMap.hasMatrix&&t.push("/mat")),this._specularMap&&(t.push("/sm"),this._specularMap.hasMatrix&&t.push("/mat")),this._specularGlossinessMap&&(t.push("/sgm"),this._specularGlossinessMap.hasMatrix&&t.push("/mat")),this._occlusionMap&&(t.push("/ocm"),this._occlusionMap.hasMatrix&&t.push("/mat")),this._normalMap&&(t.push("/nm"),this._normalMap.hasMatrix&&t.push("/mat")),this._alphaMap&&(t.push("/opm"),this._alphaMap.hasMatrix&&t.push("/mat")),t.push(";"),e.hash=t.join("")}set diffuse(e){let t=this._state.diffuse;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.diffuse=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get diffuse(){return this._state.diffuse}get diffuseMap(){return this._diffuseMap}set specular(e){let t=this._state.specular;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.specular=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=1,t[1]=1,t[2]=1),this.glRedraw()}get specular(){return this._state.specular}get specularMap(){return this._specularMap}get specularGlossinessMap(){return this._specularGlossinessMap}set glossiness(e){e=null!=e?e:1,this._state.glossiness!==e&&(this._state.glossiness=e,this.glRedraw())}get glossiness(){return this._state.glossiness}get glossinessMap(){return this._glossinessMap}set specularF0(e){e=null!=e?e:0,this._state.specularF0!==e&&(this._state.specularF0=e,this.glRedraw())}get specularF0(){return this._state.specularF0}set emissive(e){let t=this._state.emissive;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.emissive=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=0,t[1]=0,t[2]=0),this.glRedraw()}get emissive(){return this._state.emissive}get emissiveMap(){return this._emissiveMap}set alpha(e){e=null!=e?e:1,this._state.alpha!==e&&(this._state.alpha=e,this.glRedraw())}get alpha(){return this._state.alpha}get alphaMap(){return this._alphaMap}get normalMap(){return this._normalMap}get occlusionMap(){return this._occlusionMap}set alphaMode(e){let t=Ot[e=e||"opaque"];void 0===t&&(this.error("Unsupported value for 'alphaMode': "+e+" defaulting to 'opaque'"),t="opaque"),this._state.alphaMode!==t&&(this._state.alphaMode=t,this.glRedraw())}get alphaMode(){return Vt[this._state.alphaMode]}set alphaCutoff(e){null==e&&(e=.5),this._state.alphaCutoff!==e&&(this._state.alphaCutoff=e)}get alphaCutoff(){return this._state.alphaCutoff}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set frontface(e){e="cw"!==e,this._state.frontface!==e&&(this._state.frontface=e,this.glRedraw())}get frontface(){return this._state.frontface?"ccw":"cw"}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set pointSize(e){this._state.pointSize=e||1,this.glRedraw()}get pointSize(){return this._state.pointSize}destroy(){super.destroy(),this._state.destroy()}}const Ht={default:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultWhiteBG:{fill:!0,fillColor:[1,1,1],fillAlpha:.6,edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1},defaultDarkBG:{fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.5,.5,.5],edgeAlpha:.5,edgeWidth:1},phosphorous:{fill:!0,fillColor:[0,0,0],fillAlpha:.4,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:2},sunset:{fill:!0,fillColor:[.9,.9,.6],fillAlpha:.2,edges:!0,edgeColor:[.9,.9,.9],edgeAlpha:.5,edgeWidth:1},vectorscope:{fill:!0,fillColor:[0,0,0],fillAlpha:.7,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:2},battlezone:{fill:!0,fillColor:[0,0,0],fillAlpha:1,edges:!0,edgeColor:[.2,1,.2],edgeAlpha:1,edgeWidth:3},sepia:{fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1},yellowHighlight:{fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1},greenSelected:{fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1},gamegrid:{fill:!0,fillColor:[.2,.2,.7],fillAlpha:.9,edges:!0,edgeColor:[.4,.4,1.6],edgeAlpha:.8,edgeWidth:3}};class Nt extends gt{get type(){return"EmphasisMaterial"}get presets(){return Ht}constructor(e,t={}){super(e,t),this._state=new se({type:"EmphasisMaterial",fill:null,fillColor:null,fillAlpha:null,edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null,backfaces:!0,glowThrough:!0}),this._preset="default",t.preset?(this.preset=t.preset,void 0!==t.fill&&(this.fill=t.fill),t.fillColor&&(this.fillColor=t.fillColor),void 0!==t.fillAlpha&&(this.fillAlpha=t.fillAlpha),void 0!==t.edges&&(this.edges=t.edges),t.edgeColor&&(this.edgeColor=t.edgeColor),void 0!==t.edgeAlpha&&(this.edgeAlpha=t.edgeAlpha),void 0!==t.edgeWidth&&(this.edgeWidth=t.edgeWidth),void 0!==t.backfaces&&(this.backfaces=t.backfaces),void 0!==t.glowThrough&&(this.glowThrough=t.glowThrough)):(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.backfaces=t.backfaces,this.glowThrough=t.glowThrough)}set fill(e){e=!1!==e,this._state.fill!==e&&(this._state.fill=e,this.glRedraw())}get fill(){return this._state.fill}set fillColor(e){let t=this._state.fillColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.fillColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.4,t[1]=.4,t[2]=.4),this.glRedraw()}get fillColor(){return this._state.fillColor}set fillAlpha(e){e=null!=e?e:.2,this._state.fillAlpha!==e&&(this._state.fillAlpha=e,this.glRedraw())}get fillAlpha(){return this._state.fillAlpha}set edges(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(e){let t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(e){e=null!=e?e:.5,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(e){this._state.edgeWidth=e||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set backfaces(e){e=!!e,this._state.backfaces!==e&&(this._state.backfaces=e,this.glRedraw())}get backfaces(){return this._state.backfaces}set glowThrough(e){e=!1!==e,this._state.glowThrough!==e&&(this._state.glowThrough=e,this.glRedraw())}get glowThrough(){return this._state.glowThrough}set preset(e){if(console.warn("EmphasisMaterial.preset is deprecated and will be removed in future versions."),e=e||"default",this._preset===e)return;const t=Ht[e];t?(this.fill=t.fill,this.fillColor=t.fillColor,this.fillAlpha=t.fillAlpha,this.edges=t.edges,this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this.glowThrough=t.glowThrough,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Ht).join(", "))}get preset(){return console.warn("EmphasisMaterial.preset is deprecated and will be removed in future versions."),this._preset}destroy(){super.destroy(),this._state.destroy()}}const Gt={default:{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1},defaultWhiteBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultLightBG:{edgeColor:[.2,.2,.2],edgeAlpha:1,edgeWidth:1},defaultDarkBG:{edgeColor:[.5,.5,.5],edgeAlpha:1,edgeWidth:1}};class jt extends gt{get type(){return"EdgeMaterial"}get presets(){return Gt}constructor(e,t={}){super(e,t),this._state=new se({type:"EdgeMaterial",edges:null,edgeColor:null,edgeAlpha:null,edgeWidth:null}),this._preset="default",t.preset?(this.preset=t.preset,t.edgeColor&&(this.edgeColor=t.edgeColor),void 0!==t.edgeAlpha&&(this.edgeAlpha=t.edgeAlpha),void 0!==t.edgeWidth&&(this.edgeWidth=t.edgeWidth)):(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth),this.edges=!1!==t.edges}set edges(e){e=!1!==e,this._state.edges!==e&&(this._state.edges=e,this.glRedraw())}get edges(){return this._state.edges}set edgeColor(e){let t=this._state.edgeColor;if(t){if(e&&t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2])return}else t=this._state.edgeColor=new Float32Array(3);e?(t[0]=e[0],t[1]=e[1],t[2]=e[2]):(t[0]=.2,t[1]=.2,t[2]=.2),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set edgeAlpha(e){e=null!=e?e:1,this._state.edgeAlpha!==e&&(this._state.edgeAlpha=e,this.glRedraw())}get edgeAlpha(){return this._state.edgeAlpha}set edgeWidth(e){this._state.edgeWidth=e||1,this.glRedraw()}get edgeWidth(){return this._state.edgeWidth}set preset(e){if(e=e||"default",this._preset===e)return;const t=Gt[e];t?(this.edgeColor=t.edgeColor,this.edgeAlpha=t.edgeAlpha,this.edgeWidth=t.edgeWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Gt).join(", "))}get preset(){return this._preset}destroy(){super.destroy(),this._state.destroy()}}class Wt extends T{constructor(e,t={}){super(e,t),this._type=t.type||(t.src?t.src.split(".").pop():null)||"jpg",this._pos=h.vec3(t.pos||[0,0,0]),this._up=h.vec3(t.up||[0,1,0]),this._normal=h.vec3(t.normal||[0,0,1]),this._height=t.height||1,this._origin=h.vec3(),this._rtcPos=h.vec3(),this._imageSize=h.vec2(),this._texture=new Ut(this,{flipY:!0}),this._image=new Image,"jpg"!==this._type&&"png"!==this._type&&(this.error('Unsupported type - defaulting to "jpg"'),this._type="jpg"),this._node=new Ve(this,{matrix:h.inverseMat4(h.lookAtMat4v(this._pos,h.subVec3(this._pos,this._normal,h.mat4()),this._up,h.mat4())),children:[this._bitmapMesh=new dt(this,{scale:[1,1,1],rotation:[-90,0,0],collidable:t.collidable,pickable:t.pickable,opacity:t.opacity,clippable:t.clippable,geometry:new pe(this,ve({center:[0,0,0],xSize:1,zSize:1,xSegments:2,zSegments:2})),material:new bt(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:this._texture,emissiveMap:this._texture,backfaces:!0})})]}),t.image?this.image=t.image:t.src?this.src=t.src:t.imageData&&(this.imageData=t.imageData),this.scene._bitmapCreated(this)}set visible(e){this._bitmapMesh.visible=e}get visible(){return this._bitmapMesh.visible}set image(e){this._image=e,this._image&&(this._texture.image=this._image,this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updateBitmapMeshScale())}get image(){return this._image}set src(e){if(e){this._image.onload=()=>{this._texture.image=this._image,this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updateBitmapMeshScale()},this._image.src=e;switch(e.split(".").pop()){case"jpeg":case"jpg":this._type="jpg";break;case"png":this._type="png"}}}get src(){return this._image.src}set imageData(e){this._image.onload=()=>{this._texture.image=image,this._imageSize[0]=image.width,this._imageSize[1]=image.height,this._updateBitmapMeshScale()},this._image.src=e}get imageData(){const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this._image.width,e.height=this._image.height,t.drawImage(this._image,0,0),e.toDataURL("jpg"===this._type?"image/jpeg":"image/png")}set type(e){"png"===(e=e||"jpg")&&"jpg"===e||(this.error("Unsupported value for `type` - supported types are `jpg` and `png` - defaulting to `jpg`"),e="jpg"),this._type=e}get type(){return this._type}get pos(){return this._pos}get normal(){return this._normal}get up(){return this._up}set height(e){this._height=null==e?1:e,this._image&&this._updateBitmapMeshScale()}get height(){return this._height}set collidable(e){this._bitmapMesh.collidable=!1!==e}get collidable(){return this._bitmapMesh.collidable}set clippable(e){this._bitmapMesh.clippable=!1!==e}get clippable(){return this._bitmapMesh.clippable}set pickable(e){this._bitmapMesh.pickable=!1!==e}get pickable(){return this._bitmapMesh.pickable}set opacity(e){this._bitmapMesh.opacity=e}get opacity(){return this._bitmapMesh.opacity}destroy(){super.destroy(),this.scene._bitmapDestroyed(this)}_updateBitmapMeshScale(){const e=this._imageSize[1]/this._imageSize[0];this._bitmapMesh.scale=[this._height/e,1,this._height]}}const zt=(e,t)=>{const s=[];let i=[];function r(e,s){let i,r;for(let n=0;n<3;n++)if(i=t[3*e+n],r=t[3*s+n],i!==r)return r-i;return 0}let n=e.slice().sort(r),A=null;for(let e=0,t=n.length;e<t;e++)0!==e&&0===r(n[e],n[e-1])||(A=n[e]),s[n[e]]=A;for(let t=0,r=e.length;t<r;t+=3){const r=s[e[t]],n=s[e[t+1]],A=s[e[t+2]];let o=r,a=n,l=A;if(r>n&&r>A?n>A?(o=r,a=n,l=A):(o=r,a=A,l=n):n>r&&n>A?r>A?(o=n,a=r,l=A):(o=n,a=A,l=r):A>r&&A>n&&(r>n?(o=A,a=r,l=n):(o=A,a=n,l=r)),i[t+0]=[o,a],i[t+1]=[a,l],o>l){const e=l;l=o,o=e}i[t+2]=[l,o]}function o(e,t){let s,i;for(let r=0;r<2;r++)if(s=e[r],i=t[r],i!==s)return i-s;return 0}i=i.slice(0,e.length),i.sort(o);let a=0;for(let e=0;e<i.length;e++)if(0===e||0!==o(i[e],i[e-1])){if(0!==e&&2!==a)return!1;a=1}else a++;return!(i.length>0&&2!==a)},Xt=h.vec3(),Kt=h.vec3(),Zt=h.vec3();class Jt{constructor(){this.vertices=[],this.indices=[],this.reset()}reset(){this.lenVertices=0,this.lenIndices=0,this.primitive=null}setPrimitive(e){this.primitive=e}addVertex(e){this.vertices[this.lenVertices++]=e[0],this.vertices[this.lenVertices++]=e[1],this.vertices[this.lenVertices++]=e[2]}addIndex(e){this.indices[this.lenIndices++]=e}get volume(){const e=this.vertices,t=this.indices;if("solid"!==this.primitive&&"surface"!==this.primitive&&"triangles"!==this.primitive)return-1;if("solid"!==this.primitive&&!zt(t,e))return-1;let s=0;for(let i=0;i<this.lenIndices;i+=3){const r=3*t[i],n=3*t[i+1],A=3*t[i+2];Xt[0]=e[r],Xt[1]=e[r+1],Xt[2]=e[r+2],Kt[0]=e[n],Kt[1]=e[n+1],Kt[2]=e[n+2],Zt[0]=e[A],Zt[1]=e[A+1],Zt[2]=e[A+2],h.cross3Vec3(Xt,Kt,Xt),s+=h.dotVec3(Xt,Zt)}return s/6}}const Yt=new Jt,$t=h.vec3(),qt=h.vec3(),es=h.vec3(),ts=h.vec3(),ss=h.vec3(),is=h.vec3();class rs{constructor(){this.vertices=[],this.indices=[],this.reset()}reset(){this.lenVertices=0,this.lenIndices=0}addVertex(e){this.vertices[this.lenVertices++]=e[0],this.vertices[this.lenVertices++]=e[1],this.vertices[this.lenVertices++]=e[2]}addIndex(e){this.indices[this.lenIndices++]=e}get surfaceArea(){const e=this.vertices,t=this.indices;let s=0;for(let i=0;i<this.lenIndices;i+=3){const r=3*t[i],n=3*t[i+1],A=3*t[i+2];$t[0]=e[r],$t[1]=e[r+1],$t[2]=e[r+2],qt[0]=e[n],qt[1]=e[n+1],qt[2]=e[n+2],es[0]=e[A],es[1]=e[A+1],es[2]=e[A+2],h.subVec3($t,qt,ts),h.subVec3(es,qt,ss),s+=.5*h.lenVec3(h.cross3Vec3(ts,ss,is))}return s}}const ns=new rs,As=h.OBB3(),os=h.OBB3(),as=h.OBB3();class ls{constructor(e,t,s,i,r,n,A=null,o=0){this.model=e,this.object=null,this.parent=null,this.transform=r,this.textureSet=n,this._matrixDirty=!1,this._matrixUpdateScheduled=!1,this.id=t,this.obb=null,this._aabbLocal=null,this._aabbWorld=h.AABB3(),this._aabbWorldDirty=!1,this.layer=A,this.portionId=o,this._color=new Uint8Array([s[0],s[1],s[2],i]),this._colorize=new Uint8Array([s[0],s[1],s[2],i]),this._colorizing=!1,this._transparent=i<255,this.numTriangles=0,this.origin=null,this.entity=null,r&&r._addMesh(this),this._volume=null,this._surfaceArea=null}_sceneModelDirty(){this._aabbWorldDirty=!0,this.layer.aabbChanged()}_transformDirty(){this._matrixDirty||this._matrixUpdateScheduled||(this.model._meshMatrixDirty(this),this._matrixDirty=!0,this._matrixUpdateScheduled=!0),this._aabbWorldDirty=!0,this.layer.aabbChanged(),this.entity&&this.entity._transformDirty()}_updateMatrix(){this.transform&&this._matrixDirty&&this.layer.setMatrix(this.portionId,this.transform.worldMatrix),this._matrixDirty=!1,this._matrixUpdateScheduled=!1}_finalize(e){this.layer.initFlags(this.portionId,e,this._transparent)}_finalize2(){this.layer.flushInitFlags&&this.layer.flushInitFlags()}_setVisible(e){this.layer.setVisible(this.portionId,e,this._transparent)}_setColor(e){this._color[0]=e[0],this._color[1]=e[1],this._color[2]=e[2],this._colorizing||this.layer.setColor(this.portionId,this._color,!1)}_setColorize(e){e?(this._colorize[0]=e[0],this._colorize[1]=e[1],this._colorize[2]=e[2],this.layer.setColor(this.portionId,this._colorize,false),this._colorizing=!0):(this.layer.setColor(this.portionId,this._color,false),this._colorizing=!1)}_setOpacity(e,t){const s=e<255,i=this._transparent!==s;this._color[3]=e,this._colorize[3]=e,this._transparent=s,this._colorizing?this.layer.setColor(this.portionId,this._colorize):this.layer.setColor(this.portionId,this._color),i&&this.layer.setTransparent(this.portionId,t,s)}_setOffset(e){this.layer.setOffset(this.portionId,e)}_setHighlighted(e){this.layer.setHighlighted(this.portionId,e,this._transparent)}_setXRayed(e){this.layer.setXRayed(this.portionId,e,this._transparent)}_setSelected(e){this.layer.setSelected(this.portionId,e,this._transparent)}_setEdges(e){this.layer.setEdges(this.portionId,e,this._transparent)}_setClippable(e){this.layer.setClippable(this.portionId,e,this._transparent)}_setCollidable(e){this.layer.setCollidable(this.portionId,e)}_setPickable(e){this.layer.setPickable(this.portionId,e,this._transparent)}_setCulled(e){this.layer.setCulled(this.portionId,e,this._transparent)}canPickTriangle(){return!1}drawPickTriangles(e,t){}pickTriangleSurface(e){}precisionRayPickSurface(e,t,s,i){return this.layer.precisionRayPickSurface(this.portionId,e,t,s,i)}canPickWorldPos(){return!0}drawPickDepths(e){this.model.drawPickDepths(e)}drawPickNormals(e){this.model.drawPickNormals(e)}delegatePickedEntity(){return this.parent}getEachVertex(e){this.layer.getEachVertex&&this.layer.getEachVertex(this.portionId,e)}getEachIndex(e){this.layer.getEachIndex&&this.layer.getEachIndex(this.portionId,e)}isSolid(){return this.layer.solid}get volume(){if(null!==this._volume)return this._volume;switch(this.layer.primitive){case"solid":case"surface":case"triangles":Yt.reset(),Yt.setPrimitive(this.layer.primitive),this.getEachVertex((e=>{Yt.addVertex(e)})),this.getEachIndex((e=>{Yt.addIndex(e)})),this._volume=Yt.volume;break;default:this._volume=0}return this._volume}get surfaceArea(){if(null!==this._surfaceArea)return this._surfaceArea;switch(this.layer.primitive){case"solid":case"surface":case"triangles":ns.reset(),this.getEachVertex((e=>{ns.addVertex(e)})),this.getEachIndex((e=>{ns.addIndex(e)})),this._surfaceArea=ns.surfaceArea;break;default:this._surfaceArea=0}return this._surfaceArea}set aabb(e){if(this._aabbLocal=e,this.origin){this._aabbLocal=e.slice(0);const t=this.origin;this._aabbLocal[0]+=t[0],this._aabbLocal[1]+=t[1],this._aabbLocal[2]+=t[2],this._aabbLocal[3]+=t[0],this._aabbLocal[4]+=t[1],this._aabbLocal[5]+=t[2]}}get aabb(){return this._aabbWorldDirty&&(h.AABB3ToOBB3(this._aabbLocal,As),this.transform?(h.transformOBB3(this.transform.worldMatrix,As,os),h.transformOBB3(this.model.worldMatrix,os,as),h.OBB3ToAABB3(as,this._aabbWorld)):(h.transformOBB3(this.model.worldMatrix,As,os),h.OBB3ToAABB3(os,this._aabbWorld)),this._aabbWorldDirty=!1),this._aabbWorld}_destroy(){this.model.scene._renderer.putPickID(this.pickId)}}const cs=1,hs=4,us=8,ds=16,ps=32,fs=256,gs=512,ms=1024,_s=2048,bs=function(e,t,s,i){const r=i&&e.createUniform("vec4","edgeColor",((e,t)=>e(t.legacyFrameCtx.programColor))),n=t.attributes.color,A=!i&&e.createVarying("vec4","vColor",(()=>`vec4(${n}.rgb * 0.5, ${n}.a)`)),o=e.createOutput("vec4","outColor");return{programName:i?"Edges":"EdgesColor",getLogDepth:s&&(e=>e),renderPassFlag:2,appendFragmentOutputs:e=>e.push(`${o} = ${r||A};`)}},Bs=function(e,t){const s=e.createOutput("vec4","outColor");return{programName:"Occlusion",getLogDepth:!1,renderPassFlag:0,appendFragmentOutputs:e=>e.push(`${s} = vec4(0.0, 0.0, 1.0, 1.0);`)}},ys=function(e,t,s,i){const r=e.createUniform("vec4","silhouetteColor",((e,t)=>e(t.legacyFrameCtx.programColor))),n=e.createVarying("float","vAlpha",(()=>`${t.attributes.color}.a`)),A=e.createOutput("vec4","outColor");return{programName:"Silhouette",getLogDepth:s&&(e=>e),renderPassFlag:1,appendFragmentOutputs:(e,t,s,o)=>{e.push(`${A} = ${i?r:o(`vec4(${r}.rgb, min(${r}.a, ${n}))`)};`)}}},ws=h.vec2(),vs=h.vec3(),Cs=h.vec4(),Ms=h.mat4(),Es=h.vec3([0,0,0]),Fs=0,xs=1,Us=2,Is=3,Ts=4,Ps=5,Ss=6,Ds=7,ks=8,Qs=9,Rs=10,Os=11,Vs=e=>[h.safeInv(e[0]),h.safeInv(e[1]),h.safeInv(e[2])],Ls=(e,t,s,i,r)=>{const n=!!(e&cs),A=!!(e&fs),o=!!(e&gs),a=!!(e&ms),l=!!(e&_s),c=!!(e&us),h=!!(e&hs);let u,d;u=!n||h||A||o&&!i.highlightMaterial.glowThrough||a&&!i.selectedMaterial.glowThrough?Fs:t?Us:xs,d=!n||h?Fs:a?Ts:o?Is:A?Ps:Fs;let p=0;p=s&&n&&!h?a?Qs:o?ks:A?Rs:l?t?Ds:Ss:Fs:Fs;const f=n&&!h&&c?Os:Fs;r[0]=u,r[1]=d,r[2]=p,r[3]=f},Hs=function(){const e={};return function(t,s,i,r,n,A,o,a){const l=[s,"points"===i||"lines"===i?i:"triangles",!!r,!!n,!!A,!!o].join(":");l in e||(e[l]={});const c=e[l],u=t.id;if(!(u in c)){const e=t.canvas.gl,l=function(r,n,A){const o=function(){const A=Ke(),o=A.programVariables,l=a(o,n);return r(o,l.geometryParameters,(function(r,a){const c=t.pointsMaterial,u="points"===i&&!n,d=()=>[t._sectionPlanesState.getHash()].concat(u?[c.hash]:[]).concat(r.getHash?r.getHash():[]).join(";"),p=d(),f=()=>p===d(),g=l.geometryParameters,m=r.incrementDrawState,_=r.isShadowProgram,b=g.attributes,B=b.position.world,y="clipPos",[w,v]=A.buildProgram(e,s+" "+i+" "+r.programName,{appendFragmentOutputs:r.appendFragmentOutputs,cleanerEdges:r.cleanerEdges,clipPos:y,clippableTest:function(){const e=o.createVarying("float","vClippable",(()=>`${b.clippable} ? 1.0 : 0.0`),"flat");return()=>`${e} > 0.0`}(),clippingCaps:r.clippingCaps,crossSections:t.crossSections,discardPoints:u&&c.roundPoints,getGammaFactor:t.gammaOutput&&(()=>t.gammaFactor),getLogDepth:r.getLogDepth,getPointSize:function(){const e=[];if(u){const t=o.createUniform("float","pointSize",(e=>e(c.pointSize)));if(c.perspectivePoints){const s=o.createUniform("float","nearPlaneHeight",((e,t)=>e(t.legacyFrameCtx.nearPlaneHeight))),i=`${Math.floor(c.minPerspectivePointSize)}.0`,r=`${Math.floor(c.maxPerspectivePointSize)}.0`;e.push(`clamp((${s} * ${t}) / gl_Position.w, ${i}, ${r})`)}else e.push(t)}else n&&n.vertices&&e.push("1.0");return r.incPointSizeBy10&&"points"===i&&e.push("10.0"),e.length>0&&(()=>e.join(" + "))}(),getVertexData:()=>{const e=b.color,t=b.flags[r.renderPassFlag],s=o.createUniform("int","renderPass",((e,t)=>e(t.renderPass))),n=[`if (${_?`(${t} <= 0) || (${e}.a < 1.0)`:`${t} != ${s}`}) {`,"   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);","   return;","}"].concat(l.dontCullOnAlphaZero||r.dontCullOnAlphaZero?[]:[`if (${e}.a == 0.0) {`,"   gl_Position = vec4(0.0, 0.0, 0.0, 1.0);","   return;","}"]).concat(r.filterIntensityRange&&"points"===i&&c.filterIntensity?function(){const t=o.createUniform("vec2","intensityRange",(e=>{ws[0]=c.minIntensity,ws[1]=c.maxIntensity,e(ws)}));return[`if ((${e}.a < ${t}[0]) || (${e}.a > ${t}[1])) {`,"   gl_Position = vec4(0.0, 0.0, 0.0, 0.0);","   return;","}"]}():[]),A=[];l.ensureColorAndFlagAvailable&&l.ensureColorAndFlagAvailable(A),n.forEach((e=>A.push(e))),l.appendVertexData(A);const a=g.attributes.position.view;return A.push(`vec4 ${a} = ${g.viewMatrix} * ${B};`),A.push(`vec4 clipPos = ${g.projMatrix} * ${a};`),A},projMatrix:g.projMatrix,sectionPlanesState:t._sectionPlanesState,testPerspectiveForGl_FragDepth:"points"!==i&&"lines"!==i||n,usePickClipPos:a,worldPositionAttribute:B});return v?(console.error(v),{getValid:f,destroy:()=>{},drawLayer:(e,t,s)=>{}}):{getValid:f,destroy:()=>w.destroy(),drawLayer:(e,t,s)=>{e.lastProgramId!==w.id&&(e.lastProgramId=w.id,w.bind());const i=t.origin,r=t.model,A=e.viewParams,o=vs;h.transformPoint3(r.matrix,i,o);const a=A.viewMatrix,c=A.projMatrix;e.snapPickOrigin&&(e.snapPickOrigin[0]=o[0],e.snapPickOrigin[1]=o[1],e.snapPickOrigin[2]=o[2]);const u={legacyFrameCtx:e,layerTextureSet:t.layerTextureSet,mesh:{layerIndex:t.layerIndex,origin:o,renderFlags:{sectionPlanesActivePerLayer:r.renderFlags.sectionPlanesActivePerLayer}},renderPass:s,view:{eye:A.eye,far:A.far,projMatrix:c,viewMatrix:h.compareVec3(o,Es)?a:He(a,o,Ms),viewNormalMatrix:A.viewNormalMatrix}};w.inputSetters.setUniforms(e,u),t.drawCalls[n?n.vertices?"drawVertices":"drawEdges":"drawSurface"](w.inputSetters.attributesHash,l.layerTypeInputs,{projMatrix:c,viewMatrix:h.compareVec3(o,Es)?a:He(a,o,Ms),viewNormalMatrix:A.viewNormalMatrix,eye:A.eye}),m&&e.drawElements++}}}))};let l=A&&o();return{drawLayer:(e,t,s)=>{l||(l=o()),l.drawLayer(e,t,s)},revalidate:e=>{!l||!e&&l.getValid()||(l.destroy(),l=A&&o())}}},d=(e,t)=>l(e,t,!0),p=(e,t)=>l(e,t,!1),f=(e,s,r,n)=>function(e,t,s,i,r,n){const A=e.createVarying("vec4","vColor",(()=>{const e=t.attributes,s="points"===n?`vec4(${e.color}.rgb, 1.0)`:`${e.color}`;return i?`vec4(${[i.getAmbientColor()].concat(i.directionalLights.map((s=>`max(dot(${e.normal.view}, ${s.getDirection(t.viewMatrix,e.position.view)}), 0.0) * ${s.getColor()}`))).join(" + ")}, 1) * ${s}`:s})),o=e.createOutput("vec4","outColor");return{programName:"Color",getHash:()=>[i?i.getHash():"-",r?"sao":"nosao"],cleanerEdges:!0,getLogDepth:s&&(e=>"points"!==n&&"lines"!==n?`${e} + length(vec2(dFdx(${e}), dFdy(${e})))`:e),renderPassFlag:0,appendFragmentOutputs:(e,t,s,i)=>{"points"===n||"lines"===n?e.push(`${o} = ${A};`):(e.push(`vec4 fragColor = ${i(A)};`),e.push(`${o} = ${r?`vec4(fragColor.rgb * ${r.getAmbient(s)}, fragColor.a)`:"fragColor"};`))},filterIntensityRange:!0,incrementDrawState:!0}}(e,s,t.logarithmicDepthBufferEnabled,r,n,i),g=(e,s,i)=>i(function(e,t,s){const i=e.createUniform("float","far",((e,t)=>e(t.legacyFrameCtx.viewParams.far))),r=e.createUniform("float","near",((e,t)=>e(t.legacyFrameCtx.viewParams.near))),n=e.createVarying("vec3","vViewPosition",(()=>`${t.attributes.position.view}.xyz`)),A=e.createOutput("vec4","outPackedDepth"),o=e.createFragmentDefinition("packDepth",((e,t)=>{t.push(`vec4 ${e}(const in float depth) {`),t.push("  const vec4 bitShift = vec4(256.0*256.0*256.0, 256.0*256.0, 256.0, 1.0);"),t.push("  const vec4 bitMask  = vec4(0.0, 1.0/256.0, 1.0/256.0, 1.0/256.0);"),t.push("  vec4 res = fract(depth * bitShift);"),t.push("  res -= res.xxyz * bitMask;"),t.push("  return res;"),t.push("}")}));return{programName:"PickDepth",getLogDepth:s&&(e=>e),renderPassFlag:3,incPointSizeBy10:!0,appendFragmentOutputs:e=>{e.push(`float zNormalizedDepth = abs((${r} + ${n}.z) / (${i} - ${r}));`),e.push(`${A} = ${o}(zNormalizedDepth);`)}}}(e,s,t.logarithmicDepthBufferEnabled),!0),m=(e,s,i)=>i(function(e,t,s){const i=e.createVarying("vec4","vPickColor",(()=>`${t.attributes.pickColor} / 255.0`)),r=e.createOutput("vec4","outPickColor");return{programName:"PickMesh",getLogDepth:s&&(e=>e),renderPassFlag:3,incPointSizeBy10:!0,dontCullOnAlphaZero:!0,appendFragmentOutputs:e=>e.push(`${r} = ${i};`)}}(e,s,t.logarithmicDepthBufferEnabled),!0),_=(e,s,i,r)=>i(function(e,t,s,i){const r=e.createVarying("vec3","vWorldPosition",(()=>`${t.attributes.position.world}.xyz`)),n=e.createVarying("vec3","vWorldNormal",(()=>t.attributes.normal.world)),A=e.createOutput("highp ivec4","outNormal");return{programName:i?"PickNormalsFlat":"PickNormals",getLogDepth:s&&(e=>e),renderPassFlag:3,appendFragmentOutputs:e=>{const t=i?`normalize(cross(dFdx(${r}), dFdy(${r})))`:n;e.push(`${A} = ivec4(${t} * float(${h.MAX_INT}), 1.0);`)}}}(e,s,t.logarithmicDepthBufferEnabled,r),!0),b=(e,t,s,i,r)=>s(function(e,t,s,i){const r=e.createUniform("int","layerNumber",((e,t)=>e(t.legacyFrameCtx.snapPickLayerParams.length))),n=e.createUniform("vec3","coordinateScaler",((e,t)=>e(t.legacyFrameCtx.snapPickCoordinateScale))),A=e.createVarying("vec3","vWorldPosition",(()=>`${t.attributes.position.world}.xyz`)),o=e.createVarying("vec4","vPickColor",(()=>t.attributes.pickColor),"flat"),a=e.createOutput("highp ivec4","outCoords",0),l=e.createOutput("highp ivec4","outNormal",1),c=e.createOutput("lowp uvec4","outPickColor",2);return{programName:s?"SnapInit":"Snap",getLogDepth:e=>s?`${e} + length(vec2(dFdx(${e}), dFdy(${e})))`:e,renderPassFlag:3,dontCullOnAlphaZero:!s,appendFragmentOutputs:e=>{e.push(`${a} = ivec4(${A} * ${n}.xyz, ${s?"-":""}${r});`),s&&(e.push(`${l} = ${i?"ivec4(1.0)":`ivec4(normalize(cross(dFdx(${A}), dFdy(${A}))) * float(${h.MAX_INT}), 1.0)`};`),e.push(`${c} = uvec4(${o});`))}}}(e,t,i,r),!0);c[u]="points"===i?{colorRenderers:{"sao-":{vertex:p(((e,t,s)=>s(f(e,t,null,null))))}},occlusionRenderer:p(((e,s,i)=>i(Bs(e,t.logarithmicDepthBufferEnabled)))),pickDepthRenderer:p(g),pickMeshRenderer:p(m),silhouetteRenderer:p(((e,s,i)=>i(ys(e,s,t.logarithmicDepthBufferEnabled,!0)))),snapInitRenderer:p(((e,t,s)=>b(e,t,s,!0,!0))),snapVertexRenderer:p(((e,t,s)=>b(e,t,s,!1,!0)),{vertices:!0})}:"lines"===i?{colorRenderers:{"sao-":{vertex:p(((e,t,s)=>s(f(e,t,null,null))))}},silhouetteRenderer:p(((e,s,i)=>i(ys(e,s,t.logarithmicDepthBufferEnabled,!0)))),snapInitRenderer:p(((e,t,s)=>b(e,t,s,!0,!1))),snapEdgeRenderer:p(((e,t,s)=>b(e,t,s,!1,!1)),{vertices:!1}),snapVertexRenderer:p(((e,t,s)=>b(e,t,s,!1,!1)),{vertices:!0})}:{colorRenderers:function(){const e=e=>Ze(e,t._lightsState),s=e=>{const t=e.createUniform("vec4","uSAOParams",((e,t)=>e(t.legacyFrameCtx.saoParams))),s=Je(e,"sampler2D","uOcclusionTexture",3e3,((e,t)=>e(t.legacyFrameCtx.occlusionTexture)));return{getAmbient:e=>{const i=`${t}.w`;return`(smoothstep(${`${t}.z`}, 1.0, dot(${s(`${e}.xy / ${t}.xy`)}, (255. / 256.) / vec4(256. * 256. * 256., 256. * 256., 256., 1.))) * ${i})`}}},i=function(i){const r=(r,n,A)=>function(e,t,s,i,r,n,A){const o=Je(e,"sampler2D","uColorMap",3001,((e,t)=>{const s=t.layerTextureSet.colorTexture;s&&e(s.texture)})),a=n&&e.createUniform("float","materialAlphaCutoff",((e,t)=>e(t.layerTextureSet.alphaCutoff))),l=t.attributes,c=e.createVarying("vec3","vViewPosition",(()=>`${l.position.view}.xyz`)),h=e.createVarying("vec2","vUV",(()=>l.uv)),u=e.createVarying("vec4","vColor",(()=>l.color)),d=e.createOutput("vec4","outColor");return{programName:"ColorTexture",getHash:()=>[i.getHash(),r?"sao":"nosao",!!A,n?"alphaCutoffYes":"alphaCutoffNo"],getLogDepth:s.logarithmicDepthBufferEnabled&&(e=>e),renderPassFlag:0,appendFragmentOutputs:(e,s,n,A)=>{e.push(`vec3 viewNormal = normalize(cross(dFdx(${c}), dFdy(${c})));`),e.push("vec3 reflectedColor = vec3(0.0, 0.0, 0.0);"),i.directionalLights.forEach((s=>{e.push(`reflectedColor += max(dot(viewNormal, ${s.getDirection(t.viewMatrix,c)}), 0.0) * ${s.getColor()};`)})),e.push(`vec4 color = vec4(${i.getAmbientColor()} + reflectedColor, 1) * ${A(u)};`),e.push(`vec4 sampleColor = ${o(h)};`),a&&e.push(`if (sampleColor.a < ${a}) { discard; }`),e.push("vec4 colorTexel = color * sampleColor;"),e.push(`${d} = vec4(colorTexel.rgb${r?" * "+r.getAmbient(n):""}, color.a);`),s&&e.push(`${d} = ${s(d)};`)},incrementDrawState:!0}}(r,n,t,e(r),i&&s(r),A,t.gammaOutput);return{PBR:n&&p(((r,n,A)=>A(function(e,t,s,i,r){const n=(t,s,i)=>Je(e,"sampler2D",t,s?3001:3e3,((e,t)=>{const s=i(t.layerTextureSet);s&&e(s.texture)})),A=t.attributes,o=i.getIrradiance,a=n("uColorMap",!0,(e=>e.colorTexture)),l=n("uMetallicRoughMap",!1,(e=>e.metallicRoughnessTexture)),c=n("uEmissiveMap",!0,(e=>e.emissiveTexture)),h=n("uNormalMap",!1,(e=>e.normalsTexture)),u=n("uAOMap",!1,(e=>e.occlusionTexture)),d=e.createVarying("vec3","vViewPosition",(()=>`${A.position.view}.xyz`)),p=e.createVarying("vec3","vViewNormal",(()=>A.normal.view)),f=e.createVarying("vec4","vColor",(()=>A.color)),g=e.createVarying("vec2","vUV",(()=>A.uv)),m=e.createVarying("vec2","vMetallicRoughness",(()=>A.metallicRoughness)),_=e.createVarying("vec3","vWorldNormal",(()=>`${A.normal.world}.xyz`)),b=e.createOutput("vec4","outColor"),B=e.createFragmentDefinition("saturate",((e,t)=>t.push(`float ${e}(const in float a) { return clamp(a, 0.0, 1.0); }`))),y=e.createFragmentDefinition("BRDF_Specular_GGX",((e,t)=>{t.push("vec3 F_Schlick(const in vec3 specularColor, const in float dotLH) {"),t.push("   float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );"),t.push("   return ( 1.0 - specularColor ) * fresnel + specularColor;"),t.push("}"),t.push("float G_GGX_Smith(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   return 1.0 / ( gl * gv );"),t.push("}"),t.push("float G_GGX_SmithCorrelated(const in float alpha, const in float dotNL, const in float dotNV) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * ( dotNV * dotNV ) );"),t.push("   float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * ( dotNL * dotNL ) );"),t.push("   return 0.5 / max( gv + gl, 1e-6 );"),t.push("}"),t.push("float D_GGX(const in float alpha, const in float dotNH) {"),t.push("   float a2 = ( alpha * alpha );"),t.push("   float denom = ( dotNH * dotNH) * ( a2 - 1.0 ) + 1.0;"),t.push("   return 0.31830988618 * a2 / ( denom * denom);"),t.push("}"),t.push(`vec3 ${e}(const in vec3 incidentLightDirection, const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {`),t.push("   float alpha = ( roughness * roughness );"),t.push("   vec3 halfDir = normalize( incidentLightDirection + viewEyeDir );"),t.push(`   float dotNL = ${B}( dot( viewNormal, incidentLightDirection ) );`),t.push(`   float dotNV = ${B}( dot( viewNormal, viewEyeDir ) );`),t.push(`   float dotNH = ${B}( dot( viewNormal, halfDir ) );`),t.push(`   float dotLH = ${B}( dot( incidentLightDirection, halfDir ) );`),t.push("   vec3  F = F_Schlick( specularColor, dotLH );"),t.push("   float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );"),t.push("   float D = D_GGX( alpha, dotNH );"),t.push("   return F * (G * D);"),t.push("}")})),w=e.createFragmentDefinition("BRDF_Specular_GGX_Environment",((e,t)=>{t.push(`vec3 ${e}(const in vec3 viewNormal, const in vec3 viewEyeDir, const in vec3 specularColor, const in float roughness) {`),t.push(`   float dotNV = ${B}(dot(viewNormal, viewEyeDir));`),t.push("   const vec4 c0 = vec4( -1, -0.0275, -0.572,  0.022);"),t.push("   const vec4 c1 = vec4(  1,  0.0425,   1.04, -0.04);"),t.push("   vec4 r = roughness * c0 + c1;"),t.push("   float a004 = min(r.x * r.x, exp2(-9.28 * dotNV)) * r.x + r.y;"),t.push("   vec2 AB    = vec2(-1.04, 1.04) * a004 + r.zw;"),t.push("   return specularColor * AB.x + AB.y;"),t.push("}")})),v=e.createFragmentDefinition("perturbNormal2Arb",((e,t)=>{t.push(`vec3 ${e}( vec3 eye_pos, vec3 surf_norm, vec2 uv, vec4 texel ) {`),t.push("      if (texel.r == 0.0 && texel.g == 0.0 && texel.b == 0.0) {"),t.push("             return surf_norm;"),t.push("      }"),t.push("      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );"),t.push("      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );"),t.push("      vec2 st0 = dFdx( uv.st );"),t.push("      vec2 st1 = dFdy( uv.st );"),t.push("      vec3 S = normalize( q0 * st1.t - q1 * st0.t );"),t.push("      vec3 T = normalize( -q0 * st1.s + q1 * st0.s );"),t.push("      vec3 N = normalize( surf_norm );"),t.push("      vec3 mapN = texel.xyz * 2.0 - 1.0;"),t.push("      mat3 tsn = mat3( S, T, N );"),t.push("      return normalize( tsn * mapN );"),t.push("}")}));return{programName:"PBR",getHash:()=>[i.getHash(),r?"sao":"nosao",!!s.gammaOutput],getLogDepth:s.logarithmicDepthBufferEnabled&&(e=>e),renderPassFlag:0,clippingCaps:s._sectionPlanesState.clippingCaps&&b,incrementDrawState:!0,appendFragmentOutputs:(e,s,n)=>{if(e.push("const float PI = 3.14159265359;"),e.push("vec3 reflDiff = vec3(0.0);"),e.push("vec3 reflSpec = vec3(0.0);"),e.push(`vec3 rgb = ${f}.rgb;`),e.push(`float opacity = ${f}.a;`),e.push("vec3  baseColor  = rgb;"),e.push("float specularF0 = 1.0;"),e.push(`float metallic   = float(${m}.r) / 255.0;`),e.push(`float roughness  = float(${m}.g) / 255.0;`),e.push("float dielectricSpecular = 0.16 * specularF0 * specularF0;"),e.push(`vec4 colorTexel = ${a(g)};`),e.push("baseColor *= colorTexel.rgb;"),e.push(`vec3 metalRoughTexel = ${l(g)}.rgb;`),e.push("metallic *= metalRoughTexel.b;"),e.push("roughness *= metalRoughTexel.g;"),e.push("vec3 diffuseColor       = baseColor * (1.0 - dielectricSpecular) * (1.0 - metallic);"),e.push("float specularRoughness = clamp(roughness, 0.04, 1.0);"),e.push("vec3 specularColor      = mix(vec3(dielectricSpecular), baseColor, metallic);"),e.push(`vec3 viewNormal = -${v}(${d}, normalize(${p}), ${g}, ${h(g)});`),e.push(`vec3 viewEyeDir = normalize(${d});`),o&&e.push(`reflDiff += ${o(`normalize(${_})`)};`),i.getReflection){const s=`normalize((vec4(reflect(viewEyeDir, viewNormal), 0.0) * ${t.viewMatrix}).xyz)`,r="8.0",n=`0.5 * clamp(${r} - 0.79248 - 0.5 * log2(pow((2.0 / pow(specularRoughness + 0.0001, 2.0) - 2.0), 2.0) + 1.0), 0.0, ${r})`,A=i.getReflection(s,n),o=`${w}(viewNormal, viewEyeDir, specularColor, specularRoughness)`;e.push(`reflSpec += ${A} * ${o};`)}i.directionalLights.forEach(((s,i)=>{e.push(`vec3 lightDirection${i} = -${s.getDirection(t.viewMatrix,d)};`);const r=`${B}(dot(viewNormal, lightDirection${i}))`;e.push(`vec3 irradiance${i} = ${r} * ${s.getColor()};`),e.push(`reflDiff += irradiance${i};`),e.push(`reflSpec += irradiance${i} * PI * ${y}(lightDirection${i}, viewNormal, viewEyeDir, specularColor, specularRoughness);`)})),e.push(`vec3 emissiveColor = ${c(g)}.rgb;`),e.push(`float aoFactor = ${u(g)}.r;`);const A=`${i.getAmbientColor()} * baseColor * opacity * rgb`;e.push(`vec3 outgoingLight = emissiveColor + reflDiff * diffuseColor + reflSpec + ${A};`),e.push(`${b} = vec4(outgoingLight * aoFactor${r?` * ${r.getAmbient(n)}`:""}, opacity);`),s&&e.push(`${b} = ${s(b)};`)}}}(r,n,t,e(r),i&&s(r))))),texture:A&&{"alphaCutoff-":p(((e,t,s)=>s(r(e,t,!1)))),"alphaCutoff+":p(((e,t,s)=>s(r(e,t,!0))))},vertex:p(o?(t,r,n)=>n(f(t,r,e(t),i&&s(t))):(r,n,A)=>A(function(e,t,s,i,r){const n=t.attributes,A=e.createVarying("vec3","vViewPosition",(()=>`${n.position.view}.xyz`)),o=e.createVarying("vec4","vColor",(()=>n.color)),a=e.createOutput("vec4","outColor");return{programName:"FlatColor",getHash:()=>[i.getHash(),r?"sao":"nosao"],cleanerEdges:!0,getLogDepth:s&&(e=>e),renderPassFlag:0,appendFragmentOutputs:(e,s,n,l)=>{e.push(`vec3 viewNormal = normalize(cross(dFdx(${A}), dFdy(${A})));`);const c=[i.getAmbientColor()].concat(i.directionalLights.map((e=>`max(dot(viewNormal, ${e.getDirection(t.viewMatrix,A)}), 0.0) * ${e.getColor()}`)));e.push(`vec4 fragColor = vec4(${c.join(" + ")}, 1) * ${l(o)};`),e.push(`${a} = ${r?`vec4(fragColor.rgb * ${r.getAmbient(n)}, fragColor.a)`:"fragColor"};`)}}}(r,n,t.logarithmicDepthBufferEnabled,e(r),i&&s(r))))}};return{"sao-":i(!1),"sao+":r&&i(!0)}}(),depthRenderer:p(((e,s,i)=>i(function(e,t,s){const i=e.createVarying("highp vec2","vHighPrecisionZW",(()=>`${t.attributes.position.clip}.zw`)),r=e.createOutput("vec4","outColor");return{programName:"Depth",getLogDepth:s&&(e=>e),renderPassFlag:0,appendFragmentOutputs:e=>e.push(`${r} = vec4(vec3((1.0 - ${i}[0] / ${i}[1]) / 2.0), 1.0);`)}}(e,s,t.logarithmicDepthBufferEnabled)))),edgesRenderers:{uniform:p(((e,s,i)=>i(bs(e,s,t.logarithmicDepthBufferEnabled,!0))),{vertices:!1}),vertex:p(((e,s,i)=>i(bs(e,s,t.logarithmicDepthBufferEnabled,!1))),{vertices:!1})},occlusionRenderer:p(((e,s,i)=>i(Bs(e,t.logarithmicDepthBufferEnabled)))),pickDepthRenderer:d(g),pickMeshRenderer:d(m),pickNormalsFlatRenderer:d(((e,t,s)=>_(e,t,s,!0))),pickNormalsRenderer:d(((e,t,s)=>_(e,t,s,!1))),shadowRenderer:p(((e,s,i)=>i(function(e,t){const s=e.createOutput("vec4","outColor"),i=e.createFragmentDefinition("encodeFloat",((e,t)=>{t.push(`vec4 ${e}(const in float v) {`),t.push("  const vec4 bitShift = vec4(256 * 256 * 256, 256 * 256, 256, 1.0);"),t.push("  const vec4 bitMask = vec4(0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);"),t.push("  vec4 comp = fract(v * bitShift);"),t.push("  comp -= comp.xxyz * bitMask;"),t.push("  return comp;"),t.push("}")}));return{programName:"Shadow",getLogDepth:t&&(e=>e),renderPassFlag:0,isShadowProgram:!0,appendFragmentOutputs:(e,t,r)=>e.push(`${s} = ${i}(${r}.z);`)}}(e,t)))),silhouetteRenderer:d(((e,s,i)=>i(ys(e,s,t.logarithmicDepthBufferEnabled,!1)))),snapInitRenderer:d(((e,t,s)=>b(e,t,s,!0,!1))),snapEdgeRenderer:d(((e,t,s)=>b(e,t,s,!1,!1)),{vertices:!1}),snapVertexRenderer:d(((e,t,s)=>b(e,t,s,!1,!1)),{vertices:!0})};const B=e=>{!function t(s){s.revalidate?s.revalidate(e):Object.values(s).forEach((e=>e&&t(e)))}(c[u])},y=()=>B(!1);y(),t.on("compile",y),t.on("destroyed",(()=>{delete c[u]}))}return c[u]}}();class Ns{constructor(e,t,s){this.model=e,this.primitive=t,this.origin=s,this._meshes=[],this._aabb=h.collapseAABB3(),this._aabbDirty=!0}finalize(){if(!this._compiledPortions){this._compiledPortions=this.compilePortions(),this.solid=this._compiledPortions.solid,this.sortId=this._compiledPortions.sortId,this.layerTextureSet=this._compiledPortions.layerTextureSet,this.drawCalls=this._compiledPortions.drawCalls,this._renderers=this._compiledPortions.renderers,this._setFlags=this._compiledPortions.setFlags,this.setColor=this._compiledPortions.setColor,this.setMatrix=this._compiledPortions.setMatrix,this.setOffset=this._compiledPortions.setOffset,this.getEachIndex=this._compiledPortions.getEachIndex,this.getEachVertex=this._compiledPortions.getEachVertex,this.readGeometryData=this._compiledPortions.readGeometryData,this.precisionRayPickSurface=this._compiledPortions.precisionRayPickSurface,this._countsByFlag={};const e=(e,t)=>{const s={count:0,fromFlags:(i,r)=>{i&e?(s.count++,this.model[t]++):r||(s.count--,this.model[t]--)}};this._countsByFlag[e]=s};e(cs,"numVisibleLayerPortions"),e(hs,"numCulledLayerPortions"),e(us,"numPickableLayerPortions"),e(ds,"numClippableLayerPortions"),e(fs,"numXRayedLayerPortions"),e(gs,"numHighlightedLayerPortions"),e(ms,"numSelectedLayerPortions"),this._renderers.edgesRenderers&&e(_s,"numEdgesLayerPortions"),this._countsByFlagArr=Object.values(this._countsByFlag),this._numTransparentLayerPortions=0}}aabbChanged(){this._aabbDirty=!0}__drawLayer(e,t,s,i){if(this._countsByFlag[hs].count<this._portions.length&&this._countsByFlag[cs].count>0){const e="points"!==this.primitive&&"lines"!==this.primitive&&[xs,Us,Os,Is,Ts,Ps];if(e&&e.includes(i)){const e=!0;if(t.backfaces!==e){const s=this.model.scene.canvas.gl;s.disable(s.CULL_FACE),t.backfaces=e}}t.textureUnit=0,s.drawLayer(t,this,i)}}__setVec4FromMaterialColorAlpha(e,t,s){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=t,s}__drawColor(e,t,s){if((s?this._numTransparentLayerPortions<this._portions.length:this._numTransparentLayerPortions>0)&&this._countsByFlag[fs].count<this._portions.length){const i=s&&t.withSAO&&this._renderers.colorRenderers["sao+"]||this._renderers.colorRenderers["sao-"],r=t.pbrEnabled&&i.PBR?i.PBR:t.colorTextureEnabled&&i.texture?i.texture[this.layerTextureSet&&"number"==typeof this.layerTextureSet.alphaCutoff?"alphaCutoff+":"alphaCutoff-"]:i.vertex,n=s?xs:Us;this.__drawLayer(e,t,r,n)}}drawColorOpaque(e,t){this.__drawColor(e,t,!0)}drawColorTransparent(e,t){this.__drawColor(e,t,!1)}drawDepth(e,t){const s=this._renderers.depthRenderer;s&&this._numTransparentLayerPortions<this._portions.length&&this._countsByFlag[fs].count<this._portions.length&&this.__drawLayer(e,t,s,xs)}__drawSilhouette(e,t,s,i){t.programColor=this.__setVec4FromMaterialColorAlpha(s.fillColor,s.fillAlpha,Cs),this.__drawLayer(e,t,this._renderers.silhouetteRenderer,i)}drawSilhouetteXRayed(e,t){this._countsByFlag[fs].count>0&&this.__drawSilhouette(e,t,this.model.scene.xrayMaterial,Ps)}drawSilhouetteHighlighted(e,t){this._countsByFlag[gs].count>0&&this.__drawSilhouette(e,t,this.model.scene.highlightMaterial,Is)}drawSilhouetteSelected(e,t){this._countsByFlag[ms].count>0&&this.__drawSilhouette(e,t,this.model.scene.selectedMaterial,Ts)}__drawVertexEdges(e,t,s){const i=this._renderers.edgesRenderers&&this._renderers.edgesRenderers.vertex;i&&this._countsByFlag[_s].count>0&&this.__drawLayer(e,t,i,s)}drawEdgesColorOpaque(e,t){this._compiledPortions.edgesColorOpaqueAllowed()&&this.__drawVertexEdges(e,t,Ss)}drawEdgesColorTransparent(e,t){this._numTransparentLayerPortions>0&&this.__drawVertexEdges(e,t,Ds)}__drawUniformEdges(e,t,s,i){const r=this._renderers.edgesRenderers&&this._renderers.edgesRenderers.uniform;r&&(t.programColor=this.__setVec4FromMaterialColorAlpha(s.edgeColor,s.edgeAlpha,Cs),this.__drawLayer(e,t,r,i))}drawEdgesHighlighted(e,t){this._countsByFlag[gs].count>0&&this.__drawUniformEdges(e,t,this.model.scene.highlightMaterial,ks)}drawEdgesSelected(e,t){this._countsByFlag[ms].count>0&&this.__drawUniformEdges(e,t,this.model.scene.selectedMaterial,Qs)}drawEdgesXRayed(e,t){this._countsByFlag[fs].count>0&&this.__drawUniformEdges(e,t,this.model.scene.xrayMaterial,Rs)}__drawPick(e,t,s){s&&this.__drawLayer(e,t,s,Os)}drawPickMesh(e,t){this.__drawPick(e,t,this._renderers.pickMeshRenderer)}drawPickDepths(e,t){this.__drawPick(e,t,this._renderers.pickDepthRenderer)}drawPickNormals(e,t){const s=this._renderers.pickNormalsFlatRenderer;this.__drawPick(e,t,s)}drawSnap(e,t,s){t.snapPickOrigin=[0,0,0],this._aabbDirty&&(h.collapseAABB3(this._aabb),this._meshes.forEach((e=>h.expandAABB3(this._aabb,e.aabb))),this._aabbDirty=!1);const i=this._aabb;t.snapPickCoordinateScale=h.mulVec3Scalar(Vs([i[3]-i[0],i[4]-i[1],i[5]-i[2]]),h.MAX_INT);const r=s?this._renderers.snapInitRenderer:"edge"===t.snapMode?this._renderers.snapEdgeRenderer:this._renderers.snapVertexRenderer;this.__drawPick(e,t,r),t.snapPickLayerParams.push({origin:t.snapPickOrigin.slice(),coordinateScale:Vs(t.snapPickCoordinateScale)})}drawOcclusion(e,t){const s=this._renderers.occlusionRenderer;s&&this.__drawLayer(e,t,s,xs)}drawShadow(e,t){const s=this._renderers.shadowRenderer;s&&this.__drawLayer(e,t,s,xs)}initFlags(e,t,s){this._countsByFlagArr.forEach((e=>e.fromFlags(t,!0))),s&&(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++);const i="points"!==this.primitive;this._setFlags(e,t,s,i),this._compiledPortions.setFlags2(e,t,i)}flushInitFlags(){this._compiledPortions.setDeferredFlags()}setVisible(e,t,s){this._countsByFlag[cs].fromFlags(t),this._setFlags(e,t,s)}setCulled(e,t,s){this._countsByFlag[hs].fromFlags(t),this._setFlags(e,t,s)}setPickable(e,t,s){this._countsByFlag[us].fromFlags(t),this._setFlags(e,t,s)}setClippable(e,t){this._countsByFlag[ds].fromFlags(t),this._compiledPortions.setClippableFlags(e,t)}setCollidable(e,t){}setXRayed(e,t,s){this._countsByFlag[fs].fromFlags(t),this._setFlags(e,t,s)}setHighlighted(e,t,s){this._countsByFlag[gs].fromFlags(t),this._setFlags(e,t,s)}setSelected(e,t,s){this._countsByFlag[ms].fromFlags(t),this._setFlags(e,t,s)}setEdges(e,t,s){this._countsByFlag[_s]&&(this._countsByFlag[_s].fromFlags(t),this._setFlags(e,t,s))}setTransparent(e,t,s){s?(this._numTransparentLayerPortions++,this.model.numTransparentLayerPortions++):(this._numTransparentLayerPortions--,this.model.numTransparentLayerPortions--),this._setFlags(e,t,s)}destroy(){this._compiledPortions&&this._compiledPortions.destroy()}}let Gs=65536,js=5e6;class Ws{constructor(){}set doublePrecisionEnabled(e){h.setDoublePrecisionEnabled(e)}get doublePrecisionEnabled(){return h.getDoublePrecisionEnabled()}set maxDataTextureHeight(e){(e=1024*Math.ceil(e/1024))>4096?e=4096:e<1024&&(e=1024),Gs=e}get maxDataTextureHeight(){return Gs}set maxGeometryBatchSize(e){e<1e5?e=1e5:e>5e6&&(e=5e6),js=e}get maxGeometryBatchSize(){return js}}const zs=e=>{const t=[];for(let s=0;s<e;++s)t.push(s);return t},Xs={sizeDataColorsAndFlags:0,sizeDataInstancesMatrices:0,sizeDataPositionDecodeMatrices:0,sizeDataTextureOffsets:0,sizeDataTexturePositions:0,sizeDataTextureIndices:0,sizeDataTextureEdgeIndices:0,sizeDataTexturePortionIds:0,numberOfGeometries:0,numberOfPortions:0,numberOfLayers:0,numberOfTextures:0,totalPolygons:0,totalPolygons8Bits:0,totalPolygons16Bits:0,totalPolygons32Bits:0,totalEdges:0,totalEdges8Bits:0,totalEdges16Bits:0,totalEdges32Bits:0,cannotCreatePortion:{because10BitsObjectId:0,becauseTextureSize:0},overheadSizeAlignementIndices:0,overheadSizeAlignementEdgeIndices:0};window.printDataTextureRamStats=function(){console.log(JSON.stringify(Xs,null,4));let e=0;Object.keys(Xs).forEach((t=>{t.startsWith("size")&&(e+=Xs[t])})),console.log(`Total size ${e} bytes (${(e/1e3/1e3).toFixed(2)} MB)`),console.log(`Avg bytes / triangle: ${(e/Xs.totalPolygons).toFixed(2)}`);let t={};Object.keys(Xs).forEach((s=>{s.startsWith("size")&&(t[s]=`${(Xs[s]/e*100).toFixed(2)} % of total`)})),console.log(JSON.stringify({percentualRamUsage:t},null,4))};const Ks=new Ws,Zs=Ks.maxDataTextureHeight,Js=h.vec3(),Ys=h.vec3(),$s=h.vec4();h.vec4();const qs=new Float32Array(16),ei=new Uint8Array(4),ti=h.identityMat4();class si extends Ns{constructor(e,t,s){super(e,t,s),Xs.numberOfLayers++,this._sortId=`TriDTX-${Xs.numberOfLayers}`;const i=e.scene.canvas.gl,r=(e,t)=>{const s=[];let r=0;const A=[];let o=0;const a=[];let l=0;const c=[];let h=0;return{len:()=>o,accumulateIndices:(i,u)=>{const d=i&&i.length>0&&function(){const t=r/3;r+=i.length,s.push(i);const a=i.length/3;return s=>{const i=o;o+=3*a,n.perObjectIndexBaseOffsets.push(i/3-t);for(let e=0;e<a;e+=8)A.push(s);Xs[e]+=a,Xs.totalPolygons+=a}}(),p=u&&function(){const e=l/2;l+=u.length,a.push(u);const s=u.length/2;return i=>{const r=h;h+=2*s,n.perObjectEdgeIndexBaseOffsets.push(r/2-e);for(let e=0;e<s;e+=8)c.push(i);Xs[t]+=s,Xs.totalEdges+=s}}();return Xs.numberOfGeometries++,{numTriangles:i?i.length/3:0,accumulateSubPortionId:e=>{d&&d(e),p&&p(e)}}},createDrawers:(e,t)=>{const n=function(t,s){return t.length>0?e([t],t.length,1,i.UNSIGNED_SHORT,"sizeDataTexturePortionIds"):s},u=n(A,{texture:null}),d=r>0&&e(s,r,3,t,"sizeDataTextureIndices"),p=n(c),f=l>0&&e(a,l,2,t,"sizeDataTextureEdgeIndices");return{indices:function(e,t){o>0&&(e.perPrimIndices.setInputValue(d),e.perPrimIdPorIds.setInputValue(u),i.drawArrays(t,0,o))},edges:function(e,t){h>0&&(e.perPrimIndices.setInputValue(f),e.perPrimIdPorIds.setInputValue(p),i.drawArrays(t,0,h))}}}}},n=this._buffer={positionsCompressed:[],lenPositionsCompressed:0,geometry8Bits:r("totalPolygons8Bits","totalEdges8Bits"),geometry16Bits:r("totalPolygons16Bits","totalEdges16Bits"),geometry32Bits:r("totalPolygons32Bits","totalEdges32Bits"),perObjectColors:[],perObjectPickColors:[],perObjectSolid:[],perObjectPositionsDecodeMatrices:[],perObjectInstancePositioningMatrices:[],perObjectVertexBases:[],perObjectIndexBaseOffsets:[],perObjectEdgeIndexBaseOffsets:[]};this._numVertices=0,this._portions=[],this._subPortionReadableGeometries=this.model.scene.readableGeometryEnabled&&{},this._portionToSubPortionsMap=[],this._bucketGeometries={},this._primitive=t}canCreatePortion(e){const t=e.buckets.length;this._portions.length+t>65536&&Xs.cannotCreatePortion.because10BitsObjectId++;let s=this._portions.length+t<=65536;const i=void 0!==e.geometryId&&null!==e.geometryId?`${e.geometryId}#0`:`${e.id}#0`;if(!this._bucketGeometries[i]){const t=this._buffer,i=Math.max(t.geometry8Bits.len(),t.geometry16Bits.len(),t.geometry32Bits.len());let r=0,n=0;e.buckets.forEach((e=>{r+=e.positionsCompressed.length/3,n+=e.indices.length/3})),(this._numVertices+r>4096*Zs||i+n>4096*Zs)&&Xs.cannotCreatePortion.becauseTextureSize++,s&&=this._numVertices+r<=4096*Zs&&i+n<=4096*Zs}return s}createPortion(e,t){const s=this._buffer,i=t.buckets.map(((e,i)=>{const r=(t.geometryId??t.id)+"#"+i;if(!(r in this._bucketGeometries)){const t=(e,t,s)=>{if(e){const i=8*Math.ceil(e.length/t/8)*t,r=new Uint32Array(i);return r.set(e),Xs[s]+=2*(r.length-e.length),r}return e};e.indices=t(e.indices,3,"overheadSizeAlignementIndices"),e.edgeIndices=t(e.edgeIndices,2,"overheadSizeAlignementEdgeIndices");const i=e.positionsCompressed;s.positionsCompressed.push(i);const n=i.length/3;this._numVertices+=n;const A=s.lenPositionsCompressed/3;s.lenPositionsCompressed+=i.length,this._bucketGeometries[r]={vertexBase:A,geometryData:function(){const t=e.indices,i=e.edgeIndices;return n<=256?s.geometry8Bits.accumulateIndices(t,i):n<=65536?s.geometry16Bits.accumulateIndices(t,i):s.geometry32Bits.accumulateIndices(t,i)}()}}const n=this._bucketGeometries[r];s.perObjectPositionsDecodeMatrices.push(t.positionsDecodeMatrix),s.perObjectInstancePositioningMatrices.push(t.meshMatrix||ti),s.perObjectSolid.push(!!t.solid),s.perObjectPickColors.push(t.pickColor),s.perObjectVertexBases.push(n.vertexBase);const A=t.colors,o=t.color;s.perObjectColors.push(A?[255*A[0],255*A[1],255*A[2],255]:[o[0],o[1],o[2],t.opacity]);const a=this._portions.length;return this._portions.push({}),n.geometryData.accumulateSubPortionId(a),this._subPortionReadableGeometries&&(this._subPortionReadableGeometries[a]={indices:e.indices,positionsCompressed:e.positionsCompressed,positionsDecodeMatrix:t.positionsDecodeMatrix}),Xs.numberOfPortions++,a})),r=this._portionToSubPortionsMap.length;return this._portionToSubPortionsMap.push(i),this.model.numPortions++,this._meshes.push(e),r}compilePortions(){const e=this._buffer,t=this.model,s=this._portions.length,i=this.origin,r=this._portionToSubPortionsMap,n=this._primitive,A=this._sortId,o=this._subPortionReadableGeometries,a=t.scene,l=a.canvas.gl,c=ii(l,s,32,l.UNSIGNED_BYTE,512,(t=>{const i=e=>[e>>24&255,e>>16&255,e>>8&255,255&e];for(let r=0;r<s;r++)t.set(e.perObjectColors[r],32*r+0),t.set(e.perObjectPickColors[r],32*r+4),t.set([0,0,0,0],32*r+8),t.set([0,0,0,0],32*r+12),t.set(i(e.perObjectVertexBases[r]),32*r+16),t.set(i(e.perObjectIndexBaseOffsets[r]),32*r+20),t.set(i(e.perObjectEdgeIndexBaseOffsets[r]),32*r+24),t.set([e.perObjectSolid[r]?1:0,0,0,0],32*r+28)}),"sizeDataColorsAndFlags",!0),u=c.textureData,d=function(e,t,s,i,r,n,A){return ii(l,t,s,i,r,(t=>{for(let s=0,i=0,r=e.length;s<r;s++){const r=e[s];t.set(r,i),i+=r.length}}),n,A)},p=function(e,t,s){const i=e.length;if(0===i)throw"num "+t+" matrices===0";return d(e,i,16,l.FLOAT,512,t,s)},f=p(e.perObjectInstancePositioningMatrices,"sizeDataInstancesMatrices",!0),g=f.textureData,m=p(e.perObjectPositionsDecodeMatrices,"sizeDataPositionDecodeMatrices",!1),_=function(e,t,s,i,r){return d(e,t/s,s,i,4096,r,!1)},b=_(e.positionsCompressed,e.lenPositionsCompressed,3,l.UNSIGNED_SHORT,"sizeDataTexturePositions"),B=e.geometry8Bits.createDrawers(_,l.UNSIGNED_BYTE),y=e.geometry16Bits.createDrawers(_,l.UNSIGNED_SHORT),w=e.geometry32Bits.createDrawers(_,l.UNSIGNED_INT);this._buffer=null;let v=!1,C=!1,M=!1,E=0;const F=()=>{v=!0},x=a.on("rendering",(()=>{C&&(v=!1,C=!1,u.reloadData()),E=0})),U=(e,s)=>{const i=r[e];if(i)for(let e=0,t=i.length;e<t;e++)s(i[e]);else t.error("portion not found: "+e)},I=(e,t,s,i)=>{const r=v||i;r?C=!0:++E>=10&&F(),u.setData(s,e,t,!r)},T=(e,t,s=!1)=>{ei.set([t&ds?255:0,0,1,2]),U(e,(e=>I(e,3,ei,s)))};return{edgesColorOpaqueAllowed:()=>!a.logarithmicDepthBufferEnabled||(a._loggedWarning||(console.log("Edge enhancement for SceneModel data texture layers currently disabled with logarithmic depth buffer"),a._loggedWarning=!0),!1),sortId:A,setClippableFlags:T,setFlags:(e,t,s,i=!1)=>{Ls(t,s,!0,a,ei),U(e,(e=>I(e,2,ei,i)))},setFlags2:T,setDeferredFlags:()=>{},setColor:(e,t)=>{ei.set(t),U(e,(e=>I(e,0,ei,!1)))},setMatrix:(e,t)=>{U(e,(e=>{const s=v;s?C=!0:++E>=10&&F(),qs.set(t),g.setData(qs,e,0,!s)}))},setOffset:(e,t)=>{},getEachIndex:(e,t)=>{o&&U(e,(e=>o[e].indices.forEach((e=>t(e)))))},getEachVertex:(e,s)=>{o&&U(e,(e=>{const r=o[e],n=r.positionsCompressed,A=r.positionsDecodeMatrix,a=$s;for(let e=0,r=n.length;e<r;e+=3)a[0]=n[e],a[1]=n[e+1],a[2]=n[e+2],a[3]=1,h.decompressPosition(a,A),h.mulMat4v4(t.worldMatrix,a,a),h.addVec3(i,a,a),s(a)}))},precisionRayPickSurface:(e,t,s,i,r)=>!1,renderers:Hs(a,"dtx",n,t.saoEnabled,!1,!1,!0,((e,t)=>ri(e,!t))),drawCalls:function(){const e=function(e){const s=(e,t)=>e.setInputValue&&e.setInputValue(t);return(r,n,A)=>{s(n.worldMatrix,t.rotationMatrix),s(n.viewMatrix,A.viewMatrix),s(n.projMatrix,A.projMatrix);const o=h.transformPoint3(t.matrix,i,Js);s(n.uCameraEyeRtc,h.subVec3(A.eye,o,Ys)),s(n.perObjPosDecode,m),s(n.perVertIdCoords,b),s(n.perObjColsFlags,c),s(n.perObjectMatrix,f),e(n)}},s=function(t){return e((e=>{B.edges(e,t),y.edges(e,t),w.edges(e,t)}))};return{drawVertices:s(l.POINTS),drawEdges:s(l.LINES),drawSurface:e((e=>{const t=l.TRIANGLES;B.indices(e,t),y.indices(e,t),w.indices(e,t)}))}}(),destroy:()=>{M||(a.off(x),M=!0)}}}}const ii=function(e,t,s,i,r,n,A,o){if(s>4&&s%4>0)throw"Unhandled data size "+s;const a=Math.ceil(s/4),l=s/a,[c,h,u]=function(){switch(i){case e.UNSIGNED_BYTE:return[Uint8Array,...1===l?[e.R8UI,e.RED_INTEGER]:2===l?[e.RG8UI,e.RG_INTEGER]:3===l?[e.RGB8UI,e.RGB_INTEGER]:[e.RGBA8UI,e.RGBA_INTEGER]];case e.UNSIGNED_SHORT:return[Uint16Array,...1===l?[e.R16UI,e.RED_INTEGER]:2===l?[e.RG16UI,e.RG_INTEGER]:3===l?[e.RGB16UI,e.RGB_INTEGER]:[e.RGBA16UI,e.RGBA_INTEGER]];case e.UNSIGNED_INT:return[Uint32Array,...1===l?[e.R32UI,e.RED_INTEGER]:2===l?[e.RG32UI,e.RG_INTEGER]:3===l?[e.RGB32UI,e.RGB_INTEGER]:[e.RGBA32UI,e.RGBA_INTEGER]];case e.FLOAT:return[Float32Array,...1===l?[e.R32F,e.RED]:2===l?[e.RG32F,e.RG]:3===l?[e.RGB32F,e.RGB]:[e.RGBA32F,e.RGBA]];default:throw"Unhandled data type "+i}}(),d=r*a,p=Math.ceil(t/r);if(0===p)throw"texture height===0";const f=new c(d*p*l);Xs[A]+=f.byteLength,Xs.numberOfTextures++,n(f);const g=e.createTexture();return e.bindTexture(e.TEXTURE_2D,g),e.texStorage2D(e.TEXTURE_2D,1,h,d,p),e.texSubImage2D(e.TEXTURE_2D,0,0,0,d,p,u,i,f),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.bindTexture(e.TEXTURE_2D,null),{bind:t=>(e.activeTexture(e["TEXTURE"+t]),e.bindTexture(e.TEXTURE_2D,g),!0),unbind(e){},textureData:o&&{setData(t,n,A=0,o=!1){if(f.set(t,n*s+A*l),o){e.bindTexture(e.TEXTURE_2D,g);const s=n%r*a+A,o=Math.floor(n/r),c=t.length/l;e.texSubImage2D(e.TEXTURE_2D,0,s,o,c,1,u,i,t)}},reloadData(){e.bindTexture(e.TEXTURE_2D,g),e.texSubImage2D(e.TEXTURE_2D,0,0,0,d,p,u,i,f)}}}},ri=function(e,t){const s=(t,s)=>{const i=e.createUniform(t,s),r=e=>`texelFetch(${i}, ${e}, 0)`;return r.map=i,r},i=s("highp   usampler2D","perPrimIndices"),r=s("mediump usampler2D","perPrimIdPorIds"),n=s("highp    sampler2D","perObjPosDecode"),A=s("mediump usampler2D","perVertIdCoords"),o=s("lowp    usampler2D","perObjColsFlags"),a=s("highp    sampler2D","perObjectMatrix"),l=e.createUniform("mat4","worldMatrix"),c=e.createUniform("mat4","viewMatrix"),h=e.createUniform("mat4","projMatrix"),u=e.createUniform("vec3","uCameraEyeRtc"),d=function(e){const t={toString:()=>(t.needed=!0,e)};return t},p=d("colorA"),f=d("pickColor"),g=d("worldNormal"),m=d("viewNormal"),_=e=>o(`ivec2(objectIndexCoords.x*8+${e}, objectIndexCoords.y)`);return{geometryParameters:{attributes:{clippable:"(flags2.r > 0u)",color:p,flags:zs(4).map((e=>`int(flags[${e}])`)),metallicRoughness:null,normal:{view:m,world:g},pickColor:f,position:{clip:"gl_Position",view:"viewPosition",world:"worldPosition"},uv:null},projMatrix:h,viewMatrix:c},ensureColorAndFlagAvailable:e=>{e.push("int primitiveIndex = gl_VertexID / "+(t?3:2)+";"),e.push("int h_packed_object_id_index = (primitiveIndex >> 3) & 4095;"),e.push("int v_packed_object_id_index = (primitiveIndex >> 3) >> 12;"),e.push(`int objectIndex = int(${r("ivec2(h_packed_object_id_index, v_packed_object_id_index)")}.r);`),e.push("ivec2 objectIndexCoords = ivec2(objectIndex % 512, objectIndex / 512);"),e.push(`uvec4 flags  = ${_(2)};`),e.push(`uvec4 flags2 = ${_(3)};`),p.needed&&e.push(`vec4 ${p} = vec4(${_(0)}) / 255.0;`)},appendVertexData:e=>{const s=e=>a(`ivec2(objectIndexCoords.x*4+${e}, objectIndexCoords.y)`);e.push(`mat4 objectInstanceMatrix = mat4(${s(0)}, ${s(1)}, ${s(2)}, ${s(3)});`);const r=e=>n(`ivec2(objectIndexCoords.x*4+${e}, objectIndexCoords.y)`);if(e.push(`mat4 objectDecodeAndInstanceMatrix = objectInstanceMatrix * mat4(${r(0)}, ${r(1)}, ${r(2)}, ${r(3)});`),e.push(`ivec4 packedVertexBase = ivec4(${_(4)});`),e.push(`ivec4 packedIndexBaseOffset = ivec4(${_(t?5:6)});`),e.push("int indexBaseOffset = (packedIndexBaseOffset.r << 24) + (packedIndexBaseOffset.g << 16) + (packedIndexBaseOffset.b << 8) + packedIndexBaseOffset.a;"),e.push("int h_index = (primitiveIndex - indexBaseOffset) & 4095;"),e.push("int v_index = (primitiveIndex - indexBaseOffset) >> 12;"),e.push(`ivec3 vertexIndices = ivec3(${i("ivec2(h_index, v_index)")});`),e.push("ivec3 uniqueVertexIndexes = vertexIndices + (packedVertexBase.r << 24) + (packedVertexBase.g << 16) + (packedVertexBase.b << 8) + packedVertexBase.a;"),t){e.push("ivec3 indexPositionH = uniqueVertexIndexes & 4095;"),e.push("ivec3 indexPositionV = uniqueVertexIndexes >> 12;"),e.push(`uint solid = ${_(7)}.r;`);const t=e=>`vec3(${A(`ivec2(indexPositionH[${e}], indexPositionV[${e}])`)})`;e.push(`vec3 positions[] = vec3[](${t(0)}, ${t(1)}, ${t(2)});`),e.push("vec3 normal = normalize(cross(positions[2] - positions[0], positions[1] - positions[0]));"),e.push("vec3 position = positions[gl_VertexID % 3];"),g.needed&&e.push(`vec3 worldNormal = -normalize((transpose(inverse(${l} * objectDecodeAndInstanceMatrix)) * vec4(normal,1)).xyz);`),m.needed&&e.push(`vec3 viewNormal = -normalize((transpose(inverse(${c} * objectDecodeAndInstanceMatrix)) * vec4(normal,1)).xyz);`),e.push("if (solid != 1u) {"),e.push(`  if (${o=h,`(${o}[2][3] == - 1.0)`}) {`),e.push(`      vec3 uCameraEyeRtcInQuantizedSpace = (inverse(${l} * objectDecodeAndInstanceMatrix) * vec4(${u}, 1)).xyz;`),e.push("      if (dot(position.xyz - uCameraEyeRtcInQuantizedSpace, normal) < 0.0) {"),e.push("          position = positions[2 - (gl_VertexID % 3)];"),g.needed&&e.push("          worldNormal = -worldNormal;"),m.needed&&e.push("          viewNormal = -viewNormal;"),e.push("      }"),e.push("  } else {"),m.needed||e.push(`      vec3 viewNormal = -normalize((transpose(inverse(${c} * objectDecodeAndInstanceMatrix)) * vec4(normal,1)).xyz);`),e.push("      if (viewNormal.z < 0.0) {"),e.push("          position = positions[2 - (gl_VertexID % 3)];"),g.needed&&e.push("          worldNormal = -worldNormal;"),m.needed&&e.push("          viewNormal = -viewNormal;"),e.push("      }"),e.push("  }"),e.push("}")}else e.push("int indexPositionH = uniqueVertexIndexes[gl_VertexID % 2] & 4095;"),e.push("int indexPositionV = uniqueVertexIndexes[gl_VertexID % 2] >> 12;"),e.push(`vec3 position = vec3(${A("ivec2(indexPositionH, indexPositionV)")});`);var o;f.needed&&e.push(`vec4 pickColor = vec4(${_(1)});`),e.push(`vec4 worldPosition = ${l} * (objectDecodeAndInstanceMatrix * vec4(position, 1.0));`)},layerTypeInputs:{perPrimIndices:i.map,perPrimIdPorIds:r.map,perObjPosDecode:n.map,perVertIdCoords:A.map,perObjColsFlags:o.map,perObjectMatrix:a.map,worldMatrix:l,viewMatrix:c,projMatrix:h,uCameraEyeRtc:u}}},ni=h.mat4(),Ai=h.mat4();function oi(e,t,s){const i=e.length,r=new Uint16Array(i),n=t[0],A=t[1],o=t[2],a=t[3]-n,l=t[4]-A,c=t[5]-o,u=65525,d=u/a,p=u/l,f=u/c,g=e=>e>=0?e:0;for(let t=0;t<i;t+=3)r[t+0]=Math.floor(g(e[t+0]-n)*d),r[t+1]=Math.floor(g(e[t+1]-A)*p),r[t+2]=Math.floor(g(e[t+2]-o)*f);return h.identityMat4(ni),h.translationMat4v(t,ni),h.identityMat4(Ai),h.scalingMat4v([a/u,l/u,c/u],Ai),h.mulMat4(ni,Ai,s),r}function ai(e,t){const s=e[0],i=e[1],r=e[2],n=e[3]-s,A=e[4]-i,o=e[5]-r,a=65525;return h.identityMat4(ni),h.translationMat4v(e,ni),h.identityMat4(Ai),h.scalingMat4v([n/a,A/a,o/a],Ai),h.mulMat4(ni,Ai,t),t}function li(e,t,s){let i=e[0]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2])),r=e[1]/(Math.abs(e[0])+Math.abs(e[1])+Math.abs(e[2]));if(e[2]<0){let e=i,t=r;e=(1-Math.abs(r))*(i>=0?1:-1),t=(1-Math.abs(i))*(r>=0?1:-1),i=e,r=t}return new Int8Array([Math[t](127.5*i+(i<0?-1:0)),Math[s](127.5*r+(r<0?-1:0))])}function ci(e){let t=e[0],s=e[1];t/=t<0?127:128,s/=s<0?127:128;const i=1-Math.abs(t)-Math.abs(s);i<0&&(t=(1-Math.abs(s))*(t>=0?1:-1),s=(1-Math.abs(t))*(s>=0?1:-1));const r=Math.sqrt(t*t+s*s+i*i);return[t/r,s/r,i/r]}const hi=new Float32Array(1),ui=new Float32Array(4),di=new Float32Array(3),pi=h.mat4(),fi=h.vec4([0,0,0,1]),gi=h.vec4(),mi=h.vec3(),_i=h.vec3(),bi=h.vec3(),Bi=h.vec3(),yi=h.vec3(),wi=h.vec3(),vi=h.vec3(),Ci=new Uint8Array(4),Mi=new Float32Array(96),Ei=function(e){const t=[];for(let s=0;s<e;++s)t.push(s);return t},Fi=function(e,t){e.set(t);let s=t.length;const i=e.length;for(;s<i;){const t=Math.min(s,i-s);e.set(e.subarray(0,t),s),s+=t}},xi=function(){let e=0;const t=new Map;return{acquire:()=>e++,release:()=>{e--,0===e&&t.clear()},getTypeArray:function(e,s){t.has(e)||t.set(e,{});const i=t.get(e);return s in i||(i[s]=new e(s)),i[s]}}}();class Ui extends Ns{constructor(e,t,s,i){super(e,t,s);const r=!!i.geometry;this._maxVerts=i.maxGeometryBatchSize;const n=r?i.geometry.positionsDecodeMatrix:i.positionsDecodeMatrix;this._positionsDecodeMatrix=n&&h.mat4(n),this._cfgUvDecodeMatrix=i.uvDecodeMatrix&&h.mat3(i.uvDecodeMatrix),this._instancedGeometry=i.geometry,this._textureSet=i.textureSet,this._modelAABB=!r&&h.collapseAABB3(),this._portions=[];const A=function(){let e=0;const t=[];return{length:()=>e,append:function(s,i=1,r=1,n=0){e+=i*s.length,t.push({data:s,times:i,denormalizeScale:r,increment:n})},compileBuffer:function(e){let s=0;t.forEach((e=>{s+=e.times*e.data.length}));const i=new e(s);let r=0;return t.forEach((e=>{const t=e.data,s=e.denormalizeScale,n=e.increment,A=i.subarray(r);if(1===s&&0===n)A.set(t);else for(let e=0;e<t.length;++e)A[e]=n+t[e]*s;let o=t.length;const a=e.times*t.length;for(;o<a;){const e=Math.min(o,a-o);A.set(A.subarray(0,e),o),o+=e}r+=o})),i}}};this._buffer={colors:A(),metallicRoughness:A(),pickColors:A(),...r?{modelMatrixCol:[A(),A(),A()],modelNormalMatrixCol:[A(),A(),A()]}:{positions:A(),indices:A(),uv:A(),normals:A(),edgeIndices:A()}}}canCreatePortion(e,t){return this._instancedGeometry||this._buffer.positions.length()+e<=3*this._maxVerts&&this._buffer.indices.length()+t<=3*this._maxVerts}createPortion(e,t){const s=this._buffer,i=this._instancedGeometry,r=this.model,n=this._portions.length,A=this.primitive,o=!!this._positionsDecodeMatrix,a=r.scene,l=t.meshMatrix,c=(i,o,l,c,u)=>{const d=this._portions.length>0&&this._portions[this._portions.length-1],p={indicesBaseIndex:d?d.indicesBaseIndex+d.numIndices:0,numIndices:l?l.length:0,portionBase:i,portionSize:o,retainedGeometry:a.readableGeometryEnabled&&"points"!==A&&"lines"!==A&&{indices:l,quantizedPositions:c,offset:a.entityOffsetsEnabled&&h.vec3(),matrix:u&&u.slice(),inverseMatrix:null,normalMatrix:null}};return"points"!==A&&"lines"!==A&&s.metallicRoughness.append([t.metallic??0,t.roughness??255],o),"lines"!==A&&s.pickColors.append(t.pickColor.slice(0,4),o),this._portions.push(p),r.numPortions++,this._meshes.push(e),n};if(i){if(s.modelMatrixCol.forEach(((e,t)=>e.append([l[t+0],l[t+4],l[t+8],l[t+12]]))),"points"!==A){const e=t.color;s.colors.append([e[0],e[1],e[2],t.opacity??255])}if("points"!==A&&"lines"!==A&&i.normals){const e=h.inverseMat4(h.transposeMat4(l,h.mat4()));s.modelNormalMatrixCol.forEach(((t,s)=>t.append([e[s+0],e[s+4],e[s+8],e[s+12]])))}return c(n,1,i.indices,i.positionsCompressed,l)}{const e=s.positions.length()/3,i=o?t.positionsCompressed:t.positions;if(!i)throw(o?"positionsCompressed":"positions")+" expected";s.positions.append(i);const r=i.length/3,n=t.indices;n&&s.indices.append(n,1,1,e);const a=t.normalsCompressed,u=t.normals;if(a&&a.length>0)s.normals.append(a);else if(u&&u.length>0){const e=pi;l?(h.transposeMat4(l,e),h.inverseMat4(e,e)):h.identityMat4(e);const t=[];!function(e,t,s,i,r){function n(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}let A,o,a,l,c,u,d=new Float32Array([0,0,0,0]),p=new Float32Array([0,0,0,0]);for(u=0;u<s;u+=3)d[0]=t[u],d[1]=t[u+1],d[2]=t[u+2],h.transformVec3(e,d,p),h.normalizeVec3(p,p),a=A=li(p,"floor","floor"),o=ci(A),l=c=n(p,o),A=li(p,"ceil","floor"),o=ci(A),l=n(p,o),l>c&&(a=A,c=l),A=li(p,"floor","ceil"),o=ci(A),l=n(p,o),l>c&&(a=A,c=l),A=li(p,"ceil","ceil"),o=ci(A),l=n(p,o),l>c&&(a=A,c=l),i[r+u+0]=a[0],i[r+u+1]=a[1],i[r+u+2]=0}(e,u,u.length,t,0),s.normals.append(t)}const d=t.colors,p=t.colorsCompressed,f=t.color;if(d)if("points"===A)s.colors.append(d,1,255);else{const e=[];for(let t=0,s=d.length;t<s;t+=3)e.push(255*d[t]),e.push(255*d[t+1]),e.push(255*d[t+2]),e.push(255);s.colors.append(e)}else if(p)if("points"===A)s.colors.append(p);else{const e=[];for(let t=0,s=p.length;t<s;t+=3)e.push(p[t]),e.push(p[t+1]),e.push(p[t+2]),e.push(255);s.colors.append(e)}else f&&s.colors.append([f[0],f[1],f[2],"points"===A?1:t.opacity],r);const g=e=>e&&e.length>0&&e,m=g(t.uv)||g(t.uvCompressed);m&&s.uv.append(m);const _=t.edgeIndices;return _&&s.edgeIndices.append(_,1,1,e),h.expandAABB3(this._modelAABB,t.aabb),c(e,r,n)}}compilePortions(){const e=this._buffer,t=this._instancedGeometry,s=this.model,i=this._modelAABB,r=this.origin,n=this._portions,A=this.primitive,o=this._textureSet;let a=this._positionsDecodeMatrix;const l=this._cfgUvDecodeMatrix,c=s.scene,u=c.canvas.gl,d=!!t,p=[],f=(e,t,s,i)=>{if(t.length>0){const r=t.constructor,[n,A]={[Uint8Array]:[1,u.UNSIGNED_BYTE],[Int8Array]:[1,u.BYTE],[Uint16Array]:[2,u.UNSIGNED_SHORT],[Int16Array]:[2,u.SHORT],[Uint32Array]:[4,u.UNSIGNED_INT],[Int32Array]:[4,u.INT],[Float32Array]:[4,u.FLOAT]}[r],o=u.createBuffer();p.push((()=>u.deleteBuffer(o)));const a=()=>u.bindBuffer(e,o),l=t=>{a(),u.bufferData(e,t,i)};l(t);const c=t.BYTES_PER_ELEMENT,h=t.length/s;return{bindBuffer:a,getData:(t=0,i=h-t)=>{a();const A=new r(i*s);return u.getBufferSubData(e,t*n*s,A,0,i*s),A},numItems:h,setData:l,setSubData:(t,s)=>{a(),u.bufferSubData(e,s*c,t)},type:A}}return null},g=(e,t,s,i=!1,r=!1)=>{const n=f(u.ARRAY_BUFFER,e,t,s);return n&&{getData:n.getData,numItems:n.numItems,setData:n.setData,setSubData:n.setSubData,attributeDivisor:i&&1,bindAtLocation:e=>{n.bindBuffer(),u.vertexAttribPointer(e,t,n.type,!!r,0,0)}}},m=e=>{const t=f(u.ELEMENT_ARRAY_BUFFER,e,1,u.STATIC_DRAW);return t&&{getData:t.getData,bindIndicesBuffer:t.bindBuffer,indicesCount:e.length,indicesType:t.type}},_=n.reduce(((e,t)=>e+t.portionSize),0),b=g(new Float32Array(_),1,u.DYNAMIC_DRAW,d),B=(e,t)=>g(e,4,t,d&&"points"!==A,!0),y=d&&t.colorsCompressed?B(new Uint8Array(t.colorsCompressed),u.STATIC_DRAW):B(e.colors.compileBuffer(Uint8Array),u.DYNAMIC_DRAW),w=c.entityOffsetsEnabled&&g(new Float32Array(3*_),3,u.DYNAMIC_DRAW,d),v=g(e.metallicRoughness.compileBuffer(Uint8Array),2,u.STATIC_DRAW,d),C=g(e.pickColors.compileBuffer(Uint8Array),4,u.STATIC_DRAW,d),M=m(d?new Uint32Array(t.edgeIndices):e.edgeIndices.compileBuffer(Uint32Array)),E=d?"points"!==A&&t.indices&&new Uint32Array(t.indices):e.indices.compileBuffer(Uint32Array),F=E&&m(E),x=d?t.positionsCompressed:a?e.positions.compileBuffer(Uint16Array):oi(e.positions.compileBuffer(Float64Array),i,a=h.mat4()),U=x&&g(x,3,u.STATIC_DRAW);d||n.forEach((e=>{if(e.retainedGeometry){const t=3*e.portionBase;e.retainedGeometry.quantizedPositions=x.subarray(t,t+3*e.portionSize)}}));const I=d&&e.modelMatrixCol.map((e=>g(e.compileBuffer(Float32Array),4,u.STATIC_DRAW,!0))),T=!d&&e.normals.compileBuffer(Int8Array),P=T&&g(T,3,u.STATIC_DRAW,!1,!0),S=I&&P&&e.modelNormalMatrixCol.map((e=>g(e.compileBuffer(Float32Array),4,u.STATIC_DRAW,!0))),D=d?"points"!==A&&"lines"!==A&&t.uvCompressed&&{buf:g(t.uvCompressed,2,u.STATIC_DRAW),mat:t.uvDecodeMatrix}:function(){const t=e.uv.compileBuffer(Float32Array);if(0===t.length)return null;if(l)return{buf:g(t,2,u.STATIC_DRAW),mat:l};{const e=he.getUVBounds(t),s=he.compressUVs(t,e.min,e.max);return{buf:g(s.quantized,2,u.STATIC_DRAW),mat:h.mat3(s.decodeMatrix)}}}();this._buffer=null,xi.acquire(),p.push((()=>xi.release()));let k=null;const Q=(e,s,i,r=!1)=>{Ls(s,i,"points"!==A&&"lines"!==A,c,Ci);const o=s&ds?1:0;let a=0;a|=Ci[0],a|=Ci[1]<<4,a|=Ci[2]<<8,a|=Ci[3]<<12,a|=o<<16,hi[0]=a;const l=n[e],h=l.portionBase,u=l.portionSize;if(r&&!t)k||(k=new Float32Array(_)),Fi(k.subarray(h,h+u),hi);else if(b){const e=xi.getTypeArray(Float32Array,u);Fi(e,hi),b.setSubData(e,h)}},R="solid"===A;return{edgesColorOpaqueAllowed:()=>!0,solid:R,sortId:("points"===A?"Points":"lines"===A?"Lines":"Triangles")+(d?"Instancing":"Batching")+"Layer"+("points"!==A&&"lines"!==A?(R?"-solid":"-surface")+"-autoNormals"+(d?"":(o&&o.colorTexture?"-colorTexture":"")+(o&&o.metallicRoughnessTexture?"-metallicRoughnessTexture":"")):""),setClippableFlags:Q,setFlags:Q,setFlags2:(e,t,s)=>{},setDeferredFlags:()=>{k&&(b.setData(k),k=null)},setColor:(e,t)=>{if(y){const s=n[e],i=xi.getTypeArray(Uint8Array,4*s.portionSize);Fi(i,t.slice(0,4)),y.setSubData(i,4*s.portionBase)}},setMatrix:(e,t)=>{I&&I.forEach(((s,i)=>{ui[0]=t[i+0],ui[1]=t[i+4],ui[2]=t[i+8],ui[3]=t[i+12],s.setSubData(ui,4*e)}))},setOffset:(e,t)=>{if(c.entityOffsetsEnabled){const s=n[e];if(w){di.set(t);const e=xi.getTypeArray(Float32Array,3*s.portionSize);Fi(e,di),w.setSubData(e,3*s.portionBase)}s.retainedGeometry&&s.retainedGeometry.offset.set(t)}else s.error("Entity#offset not enabled for this Viewer")},getEachIndex:(e,t)=>{const s=n[e].retainedGeometry;s&&s.indices.forEach((e=>t(e)))},getEachVertex:(e,t)=>{const i=n[e].retainedGeometry;if(i){const e=gi;r?e.set(r,0):e[0]=e[1]=e[2]=0,e[3]=1;const n=s.matrix;h.mulMat4v4(n,e,e);const A=i.quantizedPositions,o=fi;for(let s=0,r=A.length;s<r;s+=3)o[0]=A[s],o[1]=A[s+1],o[2]=A[s+2],h.decompressPosition(o,a),i.matrix&&h.transformPoint3(i.matrix,o,o),o[3]=1,h.mulMat4v4(n,o,o),h.addVec3(e,o,o),t(o)}},readGeometryData:"points"!==A&&"lines"!==A&&(e=>{const t=!d&&n[e],i=t?F.getData(t.indicesBaseIndex,t.numIndices).map((e=>e-t.portionBase)):F.getData(),A=s.matrix,o=h.vec4();o.set(r,0),o[3]=1,h.mulMat4v4(A,o,o);const l=I&&h.mat4();if(l){const t=I[0].getData(e,1),s=I[1].getData(e,1),i=I[2].getData(e,1);l.set([t[0],s[0],i[0],0,t[1],s[1],i[1],0,t[2],s[2],i[2],0,t[3],s[3],i[3],1])}const c=h.mat4();h.mulMat4(A,l?h.mulMat4(l,a,c):a,c),c[12]+=o[0],c[13]+=o[1],c[14]+=o[2];const u=t?U.getData(t.portionBase,t.portionSize):U.getData();return{indices:i,positions:h.transformPositions3(c,u,new Float64Array(u.length))}}),precisionRayPickSurface:(e,t,i,A,o)=>{const l=n[e].retainedGeometry;if(l){l.matrix&&!l.inverseMatrix&&(l.inverseMatrix=h.inverseMat4(l.matrix,h.mat4())),o&&l.inverseMatrix&&!l.normalMatrix&&(l.normalMatrix=h.transposeMat4(l.inverseMatrix,h.mat4()));const e=l.quantizedPositions,n=l.indices,c=l.offset,u=mi,d=_i;u.set(r?h.subVec3(t,r,bi):t),d.set(i),c&&h.subVec3(u,c),h.transformRay(s.worldNormalMatrix,u,d,u,d),l.inverseMatrix&&h.transformRay(l.inverseMatrix,u,d,u,d);const p=Bi,f=yi,g=wi;let m=!1,_=0;const b=vi;for(let i=0,B=n.length;i<B;i+=3){const B=3*n[i],y=3*n[i+1],w=3*n[i+2];if(p[0]=e[B],p[1]=e[B+1],p[2]=e[B+2],f[0]=e[y],f[1]=e[y+1],f[2]=e[y+2],g[0]=e[w],g[1]=e[w+1],g[2]=e[w+2],h.decompressPosition(p,a),h.decompressPosition(f,a),h.decompressPosition(g,a),h.rayTriangleIntersect(u,d,p,f,g,b)){l.matrix&&h.transformPoint3(l.matrix,b,b),h.transformPoint3(s.worldMatrix,b,b),c&&h.addVec3(b,c),r&&h.addVec3(b,r);const e=Math.abs(h.lenVec3(h.subVec3(b,t,[])));(!m||e>_)&&(_=e,A.set(b),o&&h.triangleNormal(p,f,g,o),m=!0)}}return m&&o&&(l.normalMatrix&&h.transformVec3(l.normalMatrix,o,o),h.transformVec3(s.worldNormalMatrix,o,o),h.normalizeVec3(o)),m}return!1},layerTextureSet:o,renderers:Hs(c,d?"instancing":"batching",A,s.saoEnabled,s.pbrEnabled&&D&&o&&o.colorTexture&&P&&v&&o.metallicRoughnessTexture,s.colorTextureEnabled&&D&&o&&o.colorTexture,!!P,(e=>Ti(e,d&&{hasModelNormalMat:!!S},c.entityOffsetsEnabled))),drawCalls:function(){const e={},t=t=>(i,r,o)=>{let l=0;Mi.set(s.rotationMatrix,0),Mi.set(o.viewMatrix,l+=16),Mi.set(o.projMatrix,l+=16),Mi.set(a,l+=16),r.needNormal()&&(Mi.set(s.worldNormalMatrix,l+=16),Mi.set(o.viewNormalMatrix,l+=16)),r.matrices.setInputValue(Mi),r.uvDecodeMatrix.setInputValue&&r.uvDecodeMatrix.setInputValue(D.mat),i in e||(e[i]=[null,null,null]);const c=e[i],h=t?t.vertices?0:1:2;if(!c[h]){const e=u.createVertexArray();u.bindVertexArray(e);const s=(e,t)=>{e&&e.setInputValue&&t&&e.setInputValue(t)},i=r.attributes;s(i.position,U),s(i.normal,P),s(i.color,y),s(i.pickColor,C),s(i.uV,D&&D.buf),s(i.metallicRoughness,v),s(i.flags,b),s(i.offset,w),i.modelMatrixCol&&i.modelMatrixCol.forEach(((e,t)=>s(e,I[t]))),i.modelNormalMatrixCol&&i.modelNormalMatrixCol.forEach(((e,t)=>s(e,S[t])));const o=function(){const e=()=>{d?u.drawArraysInstanced(u.POINTS,0,U.numItems,n.length):u.drawArrays(u.POINTS,0,U.numItems)},s=(e,t)=>{t.bindIndicesBuffer();const s=t.indicesCount,i=t.indicesType;return()=>{d?u.drawElementsInstanced(e,s,i,0,n.length):u.drawElements(e,s,i,0)}};return"points"===A?e:"lines"===A?t&&t.vertices?e:s(u.LINES,F):t&&t.vertices?e:t&&M?s(u.LINES,M):s(u.TRIANGLES,F)}();u.bindVertexArray(null),p.push((()=>u.deleteVertexArray(e))),c[h]=()=>{u.bindVertexArray(e),o(),u.bindVertexArray(null)}}c[h]()};return{drawVertices:t({vertices:!0}),drawEdges:t({}),drawSurface:t(null)}}(),destroy:()=>{p.forEach((e=>e())),p.length=0}}}}const Ii=function(e){const t={toString:()=>(t.needed=!0,e)};return t},Ti=function(e,t,s){const i=e.createAttribute,r={position:i("vec3","positionA"),normal:i("vec3","normalA"),color:i("vec4","colorA"),pickColor:i("vec4","pickColor"),uV:i("vec2","uvApremul"),metallicRoughness:i("vec2","metallicRoughness"),flags:i("float","flagsA"),offset:s&&i("vec3","offset"),modelMatrixCol:t&&Ei(3).map((e=>i("vec4","modelMatrixCol"+e))),modelNormalMatrixCol:t&&t.hasModelNormalMat&&Ei(3).map((e=>i("vec4","modelNormalMatrixCol"+e)))},n=Ii("aUv"),A=Ii("viewNormal"),o=Ii("worldNormal"),a=e.createUniform("mat3","uvDecodeMatrix"),l=()=>A.needed||o.needed,c=e.createUniformBlock("Matrices",{worldMatrix:"mat4",viewMatrix:"mat4",projMatrix:"mat4",positionsDecodeMatrix:"mat4",worldNormalMatrix:"mat4",viewNormalMatrix:"mat4"});return{dontCullOnAlphaZero:!0,geometryParameters:{attributes:{clippable:`((int(${r.flags}) >> 16 & 0xF) == 1)`,color:r.color,flags:Ei(4).map((e=>({toString:()=>`(int(${r.flags}) >> ${4*e} & 0xF)`}))),metallicRoughness:r.metallicRoughness,normal:{view:A,world:o},pickColor:r.pickColor,position:{clip:"gl_Position",view:"viewPosition",world:"worldPosition"},uv:n},projMatrix:c.projMatrix,viewMatrix:c.viewMatrix},appendVertexData:t=>{n.needed&&t.push(`vec2 ${n} = (${a} * vec3(${r.uV}, 1.0)).xy;`);const s=r.modelMatrixCol&&`mat4(${r.modelMatrixCol[0]}, ${r.modelMatrixCol[1]}, ${r.modelMatrixCol[2]}, vec4(0.0,0.0,0.0,1.0))`;if(t.push(`vec4 worldPosition = ${c.worldMatrix} * (${c.positionsDecodeMatrix} * vec4(${r.position}, 1.0)${s?" * "+s:""});`),r.offset&&t.push(`worldPosition.xyz = worldPosition.xyz + ${r.offset};`),l()){const s=r.modelNormalMatrixCol&&`* mat4(${r.modelNormalMatrixCol[0]}, ${r.modelNormalMatrixCol[1]}, ${r.modelNormalMatrixCol[2]}, vec4(0.0,0.0,0.0,1.0))`;t.push(`vec4 modelNormal = vec4(${e.commonLibrary.octDecode}(${r.normal}.xy), 0.0)${s||""};`),t.push(`vec3 ${o} = (${c.worldNormalMatrix} * modelNormal).xyz;`),A.needed&&t.push(`vec3 ${A} = normalize((${c.viewNormalMatrix} * vec4(${o}, 0.0)).xyz);`)}},layerTypeInputs:{attributes:r,matrices:c,uvDecodeMatrix:a,needNormal:l}}};class Pi{constructor(e){this.id=e.id,this.colorTexture=e.colorTexture,this.alphaCutoff=e.alphaCutoff,this.metallicRoughnessTexture=e.metallicRoughnessTexture,this.normalsTexture=e.normalsTexture,this.emissiveTexture=e.emissiveTexture,this.occlusionTexture=e.occlusionTexture}destroy(){}}class Si{constructor(e){this.id=e.id,this.texture=e.texture}destroy(){this.texture&&(this.texture.destroy(),this.texture=null)}}const Di={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class ki{constructor(e,t,s){this.isLoading=!1,this.itemsLoaded=0,this.itemsTotal=0,this.urlModifier=void 0,this.handlers=[],this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=s}itemStart(e){this.itemsTotal++,!1===this.isLoading&&void 0!==this.onStart&&this.onStart(e,this.itemsLoaded,this.itemsTotal),this.isLoading=!0}itemEnd(e){this.itemsLoaded++,void 0!==this.onProgress&&this.onProgress(e,this.itemsLoaded,this.itemsTotal),this.itemsLoaded===this.itemsTotal&&(this.isLoading=!1,void 0!==this.onLoad&&this.onLoad())}itemError(e){void 0!==this.onError&&this.onError(e)}resolveURL(e){return this.urlModifier?this.urlModifier(e):e}setURLModifier(e){return this.urlModifier=e,this}addHandler(e,t){return this.handlers.push(e,t),this}removeHandler(e){const t=this.handlers.indexOf(e);return-1!==t&&this.handlers.splice(t,2),this}getHandler(e){for(let t=0,s=this.handlers.length;t<s;t+=2){const s=this.handlers[t],i=this.handlers[t+1];if(s.global&&(s.lastIndex=0),s.test(e))return i}return null}}const Qi=new ki;class Ri{constructor(e){this.manager=void 0!==e?e:Qi,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const s=this;return new Promise((function(i,r){s.load(e,i,t,r)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const Oi={};class Vi extends Ri{constructor(e){super(e)}load(e,t,s,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const r=Di.get(e);if(void 0!==r)return this.manager.itemStart(e),F.scheduleTask((()=>{t&&t(r),this.manager.itemEnd(e)}),0),r;if(void 0!==Oi[e])return void Oi[e].push({onLoad:t,onProgress:s,onError:i});Oi[e]=[],Oi[e].push({onLoad:t,onProgress:s,onError:i});const n=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),A=this.mimeType,o=this.responseType;fetch(n).then((t=>{if(200===t.status||0===t.status){if(0===t.status&&console.warn("FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===t.body.getReader)return t;const s=Oi[e],i=t.body.getReader(),r=t.headers.get("Content-Length"),n=r?parseInt(r):0,A=0!==n;let o=0;const a=new ReadableStream({start(e){!function t(){i.read().then((({done:i,value:r})=>{if(i)e.close();else{o+=r.byteLength;const i=new ProgressEvent("progress",{lengthComputable:A,loaded:o,total:n});for(let e=0,t=s.length;e<t;e++){const t=s[e];t.onProgress&&t.onProgress(i)}e.enqueue(r),t()}}))}()}});return new Response(a)}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{switch(o){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((e=>(new DOMParser).parseFromString(e,A)));case"json":return e.json();default:if(void 0===A)return e.text();{const t=/charset="?([^;"\s]*)"?/i.exec(A),s=t&&t[1]?t[1].toLowerCase():void 0,i=new TextDecoder(s);return e.arrayBuffer().then((e=>i.decode(e)))}}})).then((t=>{Di.add(e,t);const s=Oi[e];delete Oi[e];for(let e=0,i=s.length;e<i;e++){const i=s[e];i.onLoad&&i.onLoad(t)}})).catch((t=>{const s=Oi[e];if(void 0===s)throw this.manager.itemError(e),t;delete Oi[e];for(let e=0,i=s.length;e<i;e++){const i=s[e];i.onError&&i.onError(t)}this.manager.itemError(e)})).finally((()=>{this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class Li{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){const t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return-1}_onMessage(e,t){const s=this.workersResolve[e];if(s&&s(t),this.queue.length){const{resolve:t,msg:s,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(s,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise((s=>{const i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=s,this.workers[i].postMessage(e,t)):this.queue.push({resolve:s,msg:e,transfer:t})}))}destroy(){this.workers.forEach((e=>e.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}let Hi=0;class Ni{constructor({viewer:e,transcoderPath:t,workerLimit:s}){this._transcoderPath=t||"https://cdn.jsdelivr.net/npm/@xeokit/xeokit-sdk/dist/basis/",this._transcoderBinary=null,this._transcoderPending=null,this._workerPool=new Li,this._workerSourceURL="",s&&this._workerPool.setWorkerLimit(s);const i=e.capabilities;this._workerConfig={astcSupported:i.astcSupported,etc1Supported:i.etc1Supported,etc2Supported:i.etc2Supported,dxtSupported:i.dxtSupported,bptcSupported:i.bptcSupported,pvrtcSupported:i.pvrtcSupported},this._supportedFileTypes=["xkt2"]}_init(){if(!this._transcoderPending){const e=new Vi;e.setPath(this._transcoderPath),e.setWithCredentials(this.withCredentials);const t=e.loadAsync("basis_transcoder.js"),s=new Vi;s.setPath(this._transcoderPath),s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials);const i=s.loadAsync("basis_transcoder.wasm");this._transcoderPending=Promise.all([t,i]).then((([e,t])=>{const s=Ni.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Ni.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Ni.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Ni.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",s.substring(s.indexOf("{")+1,s.lastIndexOf("}"))].join("\n");this._workerSourceURL=URL.createObjectURL(new Blob([i])),this._transcoderBinary=t,this._workerPool.setWorkerCreator((()=>{const e=new Worker(this._workerSourceURL),t=this._transcoderBinary.slice(0);return e.postMessage({type:"init",config:this._workerConfig,transcoderBinary:t},[t]),e}))})),Hi>0&&console.warn("KTX2TextureTranscoder: Multiple active KTX2TextureTranscoder may cause performance issues. Use a single KTX2TextureTranscoder instance, or call .dispose() on old instances."),Hi++}return this._transcoderPending}transcode(e,t,s={}){return new Promise(((i,r)=>{const n=s;this._init().then((()=>this._workerPool.postMessage({type:"transcode",buffers:e,taskConfig:n},e))).then((e=>{const s=e.data,{mipmaps:n,width:A,height:o,format:a,type:l,error:c,dfdTransferFn:h,dfdFlags:u}=s;if("error"===l)return r(c);t.setCompressedData({mipmaps:n,props:{format:a,minFilter:1===n.length?1006:1008,magFilter:1===n.length?1006:1008,encoding:2===h?3001:3e3,premultiplyAlpha:!!(1&u)}}),i()}))}))}destroy(){URL.revokeObjectURL(this._workerSourceURL),this._workerPool.destroy(),Hi--}}Ni.BasisFormat={ETC1S:0,UASTC_4x4:1},Ni.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},Ni.EngineFormat={RGBAFormat:1023,RGBA_ASTC_4x4_Format:37808,RGBA_BPTC_Format:36492,RGBA_ETC2_EAC_Format:37496,RGBA_PVRTC_4BPPV1_Format:35842,RGBA_S3TC_DXT5_Format:33779,RGB_ETC1_Format:36196,RGB_ETC2_Format:37492,RGB_PVRTC_4BPPV1_Format:35840,RGB_S3TC_DXT1_Format:33776},Ni.BasisWorker=function(){let e,t,s;const i=_EngineFormat,r=_TranscoderFormat,n=_BasisFormat;self.addEventListener("message",(function(A){const c=A.data;switch(c.type){case"init":e=c.config,h=c.transcoderBinary,t=new Promise((e=>{s={wasmBinary:h,onRuntimeInitialized:e},BASIS(s)})).then((()=>{s.initializeBasis(),void 0===s.KTX2File&&console.warn("KTX2TextureTranscoder: Please update Basis Universal transcoder.")}));break;case"transcode":t.then((()=>{try{const{width:t,height:A,hasAlpha:h,mipmaps:u,format:d,dfdTransferFn:p,dfdFlags:f}=function(t){const A=new s.KTX2File(new Uint8Array(t));function c(){A.close(),A.delete()}if(!A.isValid())throw c(),new Error("KTX2TextureTranscoder: Invalid or unsupported .ktx2 file");const h=A.isUASTC()?n.UASTC_4x4:n.ETC1S,u=A.getWidth(),d=A.getHeight(),p=A.getLevels(),f=A.getHasAlpha(),g=A.getDFDTransferFunc(),m=A.getDFDFlags(),{transcoderFormat:_,engineFormat:b}=function(t,s,A,c){let h,u;const d=t===n.ETC1S?o:a;for(let i=0;i<d.length;i++){const r=d[i];if(e[r.if]&&(r.basisFormat.includes(t)&&!(c&&r.transcoderFormat.length<2)&&(!r.needsPowerOfTwo||l(s)&&l(A))))return h=r.transcoderFormat[c?1:0],u=r.engineFormat[c?1:0],{transcoderFormat:h,engineFormat:u}}return console.warn("KTX2TextureTranscoder: No suitable compressed texture format found. Decoding to RGBA32."),h=r.RGBA32,u=i.RGBAFormat,{transcoderFormat:h,engineFormat:u}}(h,u,d,f);if(!u||!d||!p)throw c(),new Error("KTX2TextureTranscoder: Invalid texture");if(!A.startTranscoding())throw c(),new Error("KTX2TextureTranscoder: .startTranscoding failed");const B=[];for(let e=0;e<p;e++){const t=A.getImageLevelInfo(e,0,0),s=t.origWidth,i=t.origHeight,r=new Uint8Array(A.getImageTranscodedSizeInBytes(e,0,0,_));if(!A.transcodeImage(r,e,0,0,_,0,-1,-1))throw c(),new Error("KTX2TextureTranscoder: .transcodeImage failed.");B.push({data:r,width:s,height:i})}return c(),{width:u,height:d,hasAlpha:f,mipmaps:B,format:b,dfdTransferFn:g,dfdFlags:m}}(c.buffers[0]),g=[];for(let e=0;e<u.length;++e)g.push(u[e].data.buffer);self.postMessage({type:"transcode",id:c.id,width:t,height:A,hasAlpha:h,mipmaps:u,format:d,dfdTransferFn:p,dfdFlags:f},g)}catch(e){console.error(`[KTX2TextureTranscoder.BasisWorker]: ${e}`),self.postMessage({type:"error",id:c.id,error:e.message})}}))}var h}));const A=[{if:"astcSupported",basisFormat:[n.UASTC_4x4],transcoderFormat:[r.ASTC_4x4,r.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.BC7_M5,r.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.BC1,r.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.ETC1,r.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[n.ETC1S,n.UASTC_4x4],transcoderFormat:[r.PVRTC1_4_RGB,r.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],o=A.sort((function(e,t){return e.priorityETC1S-t.priorityETC1S})),a=A.sort((function(e,t){return e.priorityUASTC-t.priorityUASTC}));function l(e){return e<=2||0==(e&e-1)&&0!==e}};const Gi={};function ji(e){const t=e.scene.id;let s=Gi[t];return s||(s=new Ni({viewer:e}),Gi[t]=s,e.scene.on("destroyed",(()=>{delete Gi[t],s.destroy()}))),s}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 *
 * This file takes a geometry given by { positionsCompressed, indices }, and returns
 * equivalent { positionsCompressed, indices } arrays but which only contain unique
 * positionsCompressed.
 *
 * The time is O(N logN) with the number of positionsCompressed due to a pre-sorting
 * step, but is much more GC-friendly and actually faster than the classic O(N)
 * approach based in keeping a hash-based LUT to identify unique positionsCompressed.
 */let Wi=null;function zi(e,t){let s;for(let i=0;i<3;i++)if(0!=(s=Wi[3*e+i]-Wi[3*t+i]))return s;return 0}let Xi=null;function Ki(e){const t=e.positionsCompressed,s=e.indices,i=e.edgeIndices;!function(e){if(!(null!==Xi&&Xi.length>=e)){Xi=new Uint32Array(e);for(let t=0;t<e;t++)Xi[t]=t}}(t.length/3);const r=Xi.slice(0,t.length/3),n=Xi.slice(0,t.length/3);Wi=t,r.sort(zi);let A=0;n[r[0]]=0;for(let e=1,t=r.length;e<t;e++)0!==zi(r[e],r[e-1])&&A++,n[r[e]]=A;const o=new Uint16Array(3*(A+1));A=0,o[3*A+0]=t[3*r[0]+0],o[3*A+1]=t[3*r[0]+1],o[3*A+2]=t[3*r[0]+2];for(let e=1,s=r.length;e<s;e++)0!==zi(r[e],r[e-1])&&(A++,o[3*A+0]=t[3*r[e]+0],o[3*A+1]=t[3*r[e]+1],o[3*A+2]=t[3*r[e]+2]),n[r[e]]=A;Wi=null;const a=new Uint32Array(s.length);for(let e=0,t=s.length;e<t;e++)a[e]=n[s[e]];const l=new Uint32Array(i.length);for(let e=0,t=i.length;e<t;e++)l[e]=n[i[e]];return[o,a,l]}
/**
 * @author https://github.com/tmarti, with support from https://tribia.com/
 * @license MIT
 **/let Zi=null;function Ji(e,t){const s=3*e,i=3*t;let r,n,A,o,a,l;const c=Math.min(r=Zi[s],n=Zi[s+1],A=Zi[s+2]),h=Math.min(o=Zi[i],a=Zi[i+1],l=Zi[i+2]);if(c!==h)return c-h;const u=Math.max(r,n,A),d=Math.max(o,a,l);return u!==d?u-d:0}let Yi=null;function $i(e,t){let s=Yi[2*e]-Yi[2*t];return 0!==s?s:Yi[2*e+1]-Yi[2*t+1]}function qi(e,t,s=!1){const i=e.positionsCompressed||[],r=function(e,t){const s=new Int32Array(e.length/3);for(let e=0,t=s.length;e<t;e++)s[e]=e;Zi=new Int32Array(e.length);for(let s=0,i=e.length;s<i;s++)Zi[s]=e[s]>>t;s.sort(Ji);const i=new Int32Array(e.length);for(let t=0,r=s.length;t<r;t++)i[3*t+0]=e[3*s[t]+0],i[3*t+1]=e[3*s[t]+1],i[3*t+2]=e[3*s[t]+2];return i}(e.indices||[],t),n=function(e){if(0===(e||[]).length)return[];let t=new Int32Array(e.length/2);for(let e=0,s=t.length;e<s;e++)t[e]=e;for(let t=0,s=e.length;t<s;t+=2)if(e[t]>e[t+1]){let s=e[t];e[t]=e[t+1],e[t+1]=s}Yi=new Int32Array(e),t.sort($i);const s=new Int32Array(e.length);for(let i=0,r=t.length;i<r;i++)s[2*i+0]=e[2*t[i]+0],s[2*i+1]=e[2*t[i]+1];return s}(e.edgeIndices||[]);function A(e,t){if(e>t){let s=e;e=t,t=s}function s(s,i){return s!==e?e-s:i!==t?t-i:0}let i=0,r=(n.length>>1)-1;for(;i<=r;){const e=r+i>>1,t=s(n[2*e],n[2*e+1]);if(t>0)i=e+1;else{if(!(t<0))return e;r=e-1}}return-i-1}const o=new Int32Array(n.length/2);o.fill(0);const a=i.length/3;if(a>8*(1<<t))return[e];const l=new Int32Array(a);l.fill(-1);const c=[];function h(){l.fill(-1);const e={positionsCompressed:[],indices:[],edgeIndices:[],maxNumPositions:(1<<t)-t,numPositions:0,bucketNumber:c.length};return c.push(e),e}let u=h();for(let t=0,s=r.length;t<s;t+=3){let s=0;const a=r[t],c=r[t+1],d=r[t+2];if(-1===l[a]&&s++,-1===l[c]&&s++,-1===l[d]&&s++,s+u.numPositions>u.maxNumPositions&&(u=h()),u.bucketNumber>8)return[e];let p;-1===l[a]&&(l[a]=u.numPositions++,u.positionsCompressed.push(i[3*a]),u.positionsCompressed.push(i[3*a+1]),u.positionsCompressed.push(i[3*a+2])),-1===l[c]&&(l[c]=u.numPositions++,u.positionsCompressed.push(i[3*c]),u.positionsCompressed.push(i[3*c+1]),u.positionsCompressed.push(i[3*c+2])),-1===l[d]&&(l[d]=u.numPositions++,u.positionsCompressed.push(i[3*d]),u.positionsCompressed.push(i[3*d+1]),u.positionsCompressed.push(i[3*d+2])),u.indices.push(l[a]),u.indices.push(l[c]),u.indices.push(l[d]),(p=A(a,c))>=0&&0===o[p]&&(o[p]=1,u.edgeIndices.push(l[n[2*p]]),u.edgeIndices.push(l[n[2*p+1]])),(p=A(a,d))>=0&&0===o[p]&&(o[p]=1,u.edgeIndices.push(l[n[2*p]]),u.edgeIndices.push(l[n[2*p+1]])),(p=A(c,d))>=0&&0===o[p]&&(o[p]=1,u.edgeIndices.push(l[n[2*p]]),u.edgeIndices.push(l[n[2*p+1]]))}const d=t/8*2,p=t/8,f=2*i.length+(r.length+n.length)*d;let g=0,m=-i.length/3;return c.forEach((e=>{g+=2*e.positionsCompressed.length+(e.indices.length+e.edgeIndices.length)*p,m+=e.positionsCompressed.length/3})),g>f?[e]:(s&&function(e,t){const s={},i={};let r=0;e.forEach((e=>{const t=e.indices,n=e.edgeIndices,A=e.positionsCompressed;for(let e=0,i=t.length;e<i;e+=3){const i=A[3*t[e]]+"_"+A[3*t[e]+1]+"_"+A[3*t[e]+2]+"/"+A[3*t[e+1]]+"_"+A[3*t[e+1]+1]+"_"+A[3*t[e+1]+2]+"/"+A[3*t[e+2]]+"_"+A[3*t[e+2]+1]+"_"+A[3*t[e+2]+2];s[i]=!0}r+=e.edgeIndices.length/2;for(let e=0,t=n.length;e<t;e+=2){const t=A[3*n[e]]+"_"+A[3*n[e]+1]+"_"+A[3*n[e]+2]+"/"+A[3*n[e+1]]+"_"+A[3*n[e+1]+1]+"_"+A[3*n[e+1]+2]+"/";i[t]=!0}}));{const e=t.indices;t.edgeIndices;const i=t.positionsCompressed;for(let t=0,r=e.length;t<r;t+=3){const r=i[3*e[t]]+"_"+i[3*e[t]+1]+"_"+i[3*e[t]+2]+"/"+i[3*e[t+1]]+"_"+i[3*e[t+1]+1]+"_"+i[3*e[t+1]+2]+"/"+i[3*e[t+2]]+"_"+i[3*e[t+2]+1]+"_"+i[3*e[t+2]+2];if(!(r in s))throw console.log("Not found "+r),"Ohhhh!"}}}(c,e),c)}const er=new Float32Array([0,0,0]),tr=new Uint16Array([0,0,0]);h.OBB3();class sr{constructor(e,t,s,i,r,n){this._isObject=t,this.scene=e.scene,this.model=e,this.isSceneModelEntity=!0,this.meshes=i,this._numPrimitives=0,this._capMaterial=null;for(let e=0,t=this.meshes.length;e<t;e++){const t=this.meshes[e];t.parent=this,t.entity=this,this._numPrimitives+=t.numPrimitives}this.id=s,this.originalSystemId=h.unglobalizeObjectId(e.id,s),this._flags=r,this._aabb=h.AABB3(),this._aabbDirty=!0,this._offset=h.vec3(),this._colorizeUpdated=!1,this._opacityUpdated=!1,this._lodCullable=!!n,this._culled=!1,this._culledVFC=!1,this._culledLOD=!1,this._isObject&&e.scene._registerObject(this)}_transformDirty(){this._aabbDirty=!0,this.model._transformDirty()}_sceneModelDirty(){this._aabbDirty=!0;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._sceneModelDirty()}get aabb(){if(this._aabbDirty){h.collapseAABB3(this._aabb);for(let e=0,t=this.meshes.length;e<t;e++)h.expandAABB3(this._aabb,this.meshes[e].aabb);this._aabbDirty=!1}return this._aabb}get isEntity(){return!0}get isModel(){return!1}get isObject(){return this._isObject}get numPrimitives(){return this._numPrimitives}get numTriangles(){return this._numPrimitives}get visible(){return this._getFlag(cs)}set visible(e){if(!!(this._flags&cs)!==e){this._flags=e?this._flags|cs:this._flags&~cs;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setVisible(this._flags);this._isObject&&this.model.scene._objectVisibilityUpdated(this),this.model.glRedraw()}}get highlighted(){return this._getFlag(gs)}set highlighted(e){if(!!(this._flags&gs)!==e){this._flags=e?this._flags|gs:this._flags&~gs;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setHighlighted(this._flags);this._isObject&&this.model.scene._objectHighlightedUpdated(this),this.model.glRedraw()}}get xrayed(){return this._getFlag(fs)}set xrayed(e){if(!!(this._flags&fs)!==e){this._flags=e?this._flags|fs:this._flags&~fs;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setXRayed(this._flags);this._isObject&&this.model.scene._objectXRayedUpdated(this),this.model.glRedraw()}}get selected(){return this._getFlag(ms)}set selected(e){if(!!(this._flags&ms)!==e){this._flags=e?this._flags|ms:this._flags&~ms;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setSelected(this._flags);this._isObject&&this.model.scene._objectSelectedUpdated(this),this.model.glRedraw()}}get edges(){return this._getFlag(_s)}set edges(e){if(!!(this._flags&_s)!==e){this._flags=e?this._flags|_s:this._flags&~_s;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setEdges(this._flags);this.model.glRedraw()}}get culledVFC(){return!!this._culledVFC}set culledVFC(e){this._culledVFC=e,this._setCulled()}get culledLOD(){return!!this._culledLOD}set culledLOD(e){this._culledLOD=e,this._setCulled()}get culled(){return!!this._culled}set culled(e){this._culled=e,this._setCulled()}_setCulled(){let e=!!this._culled||!(!this._culledLOD||!this._lodCullable)||!!this._culledVFC;if(!!(this._flags&hs)!==e){this._flags=e?this._flags|hs:this._flags&~hs;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setCulled(this._flags);this.model.glRedraw()}}get clippable(){return this._getFlag(ds)}set clippable(e){if(!!(this._flags&ds)!==e){this._flags=e?this._flags|ds:this._flags&~ds;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setClippable(this._flags);this.model.glRedraw()}}get collidable(){return this._getFlag(ps)}set collidable(e){if(!!(this._flags&ps)!==e){this._flags=e?this._flags|ps:this._flags&~ps;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setCollidable(this._flags)}}get pickable(){return this._getFlag(us)}set pickable(e){if(!!(this._flags&us)!==e){this._flags=e?this._flags|us:this._flags&~us;for(var t=0,s=this.meshes.length;t<s;t++)this.meshes[t]._setPickable(this._flags)}}get colorize(){if(0===this.meshes.length)return null;const e=this.meshes[0]._colorize;return er[0]=e[0]/255,er[1]=e[1]/255,er[2]=e[2]/255,er}set colorize(e){if(e){tr[0]=Math.floor(255*e[0]),tr[1]=Math.floor(255*e[1]),tr[2]=Math.floor(255*e[2]);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(tr)}else for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setColorize(null);if(this._isObject){const t=!!e;this.scene._objectColorizeUpdated(this,t),this._colorizeUpdated=t}this.model.glRedraw()}get opacity(){return this.meshes.length>0?this.meshes[0]._colorize[3]/255:1}set opacity(e){if(0===this.meshes.length)return;const t=null!=e,s=this.meshes[0]._colorize[3];let i=255;if(t){if(e<0?e=0:e>1&&(e=1),i=Math.floor(255*e),s===i)return}else if(i=255,s===i)return;for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOpacity(i,this._flags);this._isObject&&(this.scene._objectOpacityUpdated(this,t),this._opacityUpdated=t),this.model.glRedraw()}get offset(){return this._offset}set offset(e){e?(this._offset[0]=e[0],this._offset[1]=e[1],this._offset[2]=e[2]):(this._offset[0]=0,this._offset[1]=0,this._offset[2]=0);for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._setOffset(this._offset);this._aabbDirty=!0,this.model._aabbDirty=!0,this.scene._aabbDirty=!0,this.scene._objectOffsetUpdated(this,e),this.model.glRedraw()}get saoEnabled(){return this.model.saoEnabled}set capMaterial(e){this.scene.readableGeometryEnabled&&(this._capMaterial=e instanceof gt?e:null,this.scene._capMaterialUpdated(this.id,this.model.id))}get capMaterial(){return this._capMaterial}getEachVertex(e){for(let t=0,s=this.meshes.length;t<s;t++)this.meshes[t].getEachVertex(e)}getEachIndex(e){for(let t=0,s=this.meshes.length;t<s;t++)this.meshes[t].getEachIndex(e)}getGeometryData(){let e=0;const t=[],s=[];for(let i=0,r=this.meshes.length;i<r;i++){const r=this.meshes[i];if(r.layer.readGeometryData){const i=r.layer.readGeometryData(r.portionId);for(let t=0,r=i.indices.length;t<r;t++)s.push(i.indices[t]+e);for(let e=0,s=i.positions.length;e<s;e++)t.push(i.positions[e]);e+=i.positions.length/3}}return{indices:s,positions:t}}get volume(){let e=0;for(let t=0,s=this.meshes.length;t<s;t++){const s=this.meshes[t].volume;if(s<0)return-1;e+=s}return e}get surfaceArea(){let e=0;for(let t=0,s=this.meshes.length;t<s;t++){const s=this.meshes[t].surfaceArea;s>=0&&(e+=s)}return e>0?e:-1}_getFlag(e){return!!(this._flags&e)}_finalize(){const e=this.model.scene;this._isObject&&(this.visible&&e._objectVisibilityUpdated(this),this.highlighted&&e._objectHighlightedUpdated(this),this.xrayed&&e._objectXRayedUpdated(this),this.selected&&e._objectSelectedUpdated(this));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize(this._flags)}_finalize2(){for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._finalize2()}_destroy(){const e=this.model.scene;this._isObject&&(e._deregisterObject(this),this.visible&&e._deRegisterVisibleObject(this),this.xrayed&&e._deRegisterXRayedObject(this),this.selected&&e._deRegisterSelectedObject(this),this.highlighted&&e._deRegisterHighlightedObject(this),this._colorizeUpdated&&this.scene._deRegisterColorizedObject(this),this._opacityUpdated&&this.scene._deRegisterOpacityObject(this),!this._offset||0===this._offset[0]&&0===this._offset[1]&&0===this._offset[2]||this.scene._deRegisterOffsetObject(this));for(let e=0,t=this.meshes.length;e<t;e++)this.meshes[e]._destroy();e._aabbDirty=!0}}const ir=h.vec4(4),rr=h.vec4(),nr=h.vec4(),Ar=h.vec3([1,0,0]),or=h.vec3([0,1,0]),ar=h.vec3([0,0,1]);h.vec3(3),h.vec3(3);const lr=h.identityMat4();class cr{constructor(e){this._model=e.model,this.id=e.id,this._parentTransform=e.parent,this._childTransforms=[],this._meshes=[],this._scale=new Float32Array([1,1,1]),this._quaternion=h.identityQuaternion(new Float32Array(4)),this._rotation=new Float32Array(3),this._position=new Float32Array(3),this._localMatrix=h.identityMat4(new Float32Array(16)),this._worldMatrix=h.identityMat4(new Float32Array(16)),this._localMatrixDirty=!0,this._worldMatrixDirty=!0,e.matrix?this.matrix=e.matrix:(this.scale=e.scale,this.position=e.position,e.quaternion||(this.rotation=e.rotation)),e.parent&&e.parent._addChildTransform(this)}_addChildTransform(e){this._childTransforms.push(e),e._parentTransform=this,e._transformDirty(),e._setSubtreeAABBsDirty(this)}_addMesh(e){this._meshes.push(e),e.transform=this}get parentTransform(){return this._parentTransform}get meshes(){return this._meshes}set position(e){this._position.set(e||[0,0,0]),this._setLocalMatrixDirty(),this._model.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),h.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setLocalMatrixDirty(),this._model.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),h.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setLocalMatrixDirty(),this._model.glRedraw()}get quaternion(){return this._quaternion}set scale(e){this._scale.set(e||[1,1,1]),this._setLocalMatrixDirty(),this._model.glRedraw()}get scale(){return this._scale}set matrix(e){this._localMatrix||(this._localMatrix=h.identityMat4()),this._localMatrix.set(e||lr),h.decomposeMat4(this._localMatrix,this._position,this._quaternion,this._scale),this._localMatrixDirty=!1,this._transformDirty(),this._model.glRedraw()}get matrix(){return this._localMatrixDirty&&(this._localMatrix||(this._localMatrix=h.identityMat4()),h.composeMat4(this._position,this._quaternion,this._scale,this._localMatrix),this._localMatrixDirty=!1),this._localMatrix}get worldMatrix(){return this._worldMatrixDirty&&this._buildWorldMatrix(),this._worldMatrix}rotate(e,t){return ir[0]=e[0],ir[1]=e[1],ir[2]=e[2],ir[3]=t*h.DEGTORAD,h.angleAxisToQuaternion(ir,rr),h.mulQuaternions(this.quaternion,rr,nr),this.quaternion=nr,this._setLocalMatrixDirty(),this._model.glRedraw(),this}rotateOnWorldAxis(e,t){return ir[0]=e[0],ir[1]=e[1],ir[2]=e[2],ir[3]=t*h.DEGTORAD,h.angleAxisToQuaternion(ir,rr),h.mulQuaternions(rr,this.quaternion,rr),this}rotateX(e){return this.rotate(Ar,e)}rotateY(e){return this.rotate(or,e)}rotateZ(e){return this.rotate(ar,e)}translate(e){return this._position[0]+=e[0],this._position[1]+=e[1],this._position[2]+=e[2],this._setLocalMatrixDirty(),this._model.glRedraw(),this}translateX(e){return this._position[0]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}translateY(e){return this._position[1]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}translateZ(e){return this._position[2]+=e,this._setLocalMatrixDirty(),this._model.glRedraw(),this}_setLocalMatrixDirty(){this._localMatrixDirty=!0,this._transformDirty()}_transformDirty(){this._worldMatrixDirty=!0;for(let e=0,t=this._childTransforms.length;e<t;e++){const t=this._childTransforms[e];if(t._transformDirty(),t._meshes&&t._meshes.length>0){const e=t._meshes;for(let t=0,s=e.length;t<s;t++)e[t]._transformDirty()}}if(this._meshes&&this._meshes.length>0){const e=this._meshes;for(let t=0,s=e.length;t<s;t++)e[t]._transformDirty()}}_buildWorldMatrix(){const e=this.matrix;if(this._parentTransform)h.mulMat4(this._parentTransform.worldMatrix,e,this._worldMatrix);else for(let t=0,s=e.length;t<s;t++)this._worldMatrix[t]=e[t];this._worldMatrixDirty=!1}_setSubtreeAABBsDirty(e){if(e._aabbDirty=!0,e._childTransforms)for(let t=0,s=e._childTransforms.length;t<s;t++)this._setSubtreeAABBsDirty(e._childTransforms[t])}}const hr=h.vec3(),ur=h.OBB3(),dr=h.vec4(),pr=h.vec3([1,1,1]),fr=h.vec3([0,0,0]);h.vec3([0,0,0]);const gr=h.identityQuaternion(),mr=h.identityMat4(),_r=new Uint8Array([255,255,255]);class br extends T{constructor(e,t={}){super(e,t),this.renderOrder=t.renderOrder||0,this._dtxEnabled=this.scene.dtxEnabled&&!1!==t.dtxEnabled,this._enableVertexWelding=!1,this._enableIndexBucketing=!1,this._textureTranscoder=t.textureTranscoder||ji(this.scene.viewer),this._maxGeometryBatchSize=t.maxGeometryBatchSize??5e6,this._aabb=h.collapseAABB3(),this._aabbDirty=!0,this._quantizationRanges={},this._vboLayers={},this._dtxLayers={},this._meshList=[],this.layerList=[],this._layersToFinalize=[],this._entityList=[],this._entitiesToFinalize=[],this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={},this._transforms={},this._meshes={},this._unusedMeshes={},this._entities={},this.renderFlags=new et,this.numGeometries=0,this.numPortions=0,this.numVisibleLayerPortions=0,this.numTransparentLayerPortions=0,this.numXRayedLayerPortions=0,this.numHighlightedLayerPortions=0,this.numSelectedLayerPortions=0,this.numEdgesLayerPortions=0,this.numPickableLayerPortions=0,this.numClippableLayerPortions=0,this.numCulledLayerPortions=0,this.numEntities=0,this._numTriangles=0,this._numLines=0,this._numPoints=0,this._layersFinalized=!1,this._edgeThreshold=t.edgeThreshold||10,this._origin=h.vec3(t.origin||[0,0,0]),this._position=h.vec3(t.position||[0,0,0]),this._rotation=h.vec3(t.rotation||[0,0,0]),this._quaternion=h.vec4(t.quaternion||[0,0,0,1]),this._conjugateQuaternion=h.vec4(t.quaternion||[0,0,0,1]),t.rotation&&h.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._scale=h.vec3(t.scale||[1,1,1]),this._worldRotationMatrix=h.mat4(),this._worldRotationMatrixConjugate=h.mat4(),this._matrix=h.mat4(),this._matrixDirty=!0,this._rebuildMatrices(),this._worldNormalMatrix=h.mat4(),h.inverseMat4(this._matrix,this._worldNormalMatrix),h.transposeMat4(this._worldNormalMatrix),(t.matrix||t.position||t.rotation||t.scale||t.quaternion)&&(this._viewMatrix=h.mat4(),this._viewNormalMatrix=h.mat4(),this._viewMatrixDirty=!0,this._matrixNonIdentity=!0),this._opacity=1,this._colorize=[1,1,1],this._saoEnabled=!1!==t.saoEnabled,this._pbrEnabled=!1!==t.pbrEnabled,this._colorTextureEnabled=!1!==t.colorTextureEnabled,this._isModel=t.isModel,this._isModel&&this.scene._registerModel(this),this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewMatrixDirty=!0})),this._meshesWithDirtyMatrices=[],this._numMeshesWithDirtyMatrices=0,this._onTick=this.scene.on("tick",(()=>{for(;this._numMeshesWithDirtyMatrices>0;)this._meshesWithDirtyMatrices[--this._numMeshesWithDirtyMatrices]._updateMatrix()}));const s=(e,t)=>this._textures[e]=new Si({id:e,texture:new vt({gl:this.scene.canvas.gl,preloadColor:t})});this._textureSets.defaultTextureSet=new Pi({id:"defaultTextureSet",colorTexture:s("defaultColorTexture",[1,1,1,1]),metallicRoughnessTexture:s("defaultMetalRoughTexture",[0,1,1,1]),normalsTexture:s("defaultNormalsTexture",[0,0,0,0]),emissiveTexture:s("defaultEmissiveTexture",[0,0,0,1]),occlusionTexture:s("defaultOcclusionTexture",[1,1,1,1])}),this.visible=t.visible,this.culled=t.culled,this.pickable=t.pickable,this.clippable=t.clippable,this.collidable=t.collidable,this.castsShadow=t.castsShadow,this.receivesShadow=t.receivesShadow,this.xrayed=t.xrayed,this.highlighted=t.highlighted,this.selected=t.selected,this.edges=t.edges,this.colorize=t.colorize,this.opacity=t.opacity,this.backfaces=t.backfaces}_meshMatrixDirty(e){this._meshesWithDirtyMatrices[this._numMeshesWithDirtyMatrices++]=e}get isPerformanceModel(){return!0}get transforms(){return this._transforms}get textures(){return this._textures}get textureSets(){return this._textureSets}get meshes(){return this._meshes}get objects(){return this._entities}get origin(){return this._origin}set position(e){this._position.set(e||[0,0,0]),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get position(){return this._position}set rotation(e){this._rotation.set(e||[0,0,0]),h.eulerToQuaternion(this._rotation,"XYZ",this._quaternion),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get rotation(){return this._rotation}set quaternion(e){this._quaternion.set(e||[0,0,0,1]),h.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get quaternion(){return this._quaternion}set scale(e){}get scale(){return this._scale}set matrix(e){this._matrix.set(e||mr),h.decomposeMat4(this._matrix,this._position,this._quaternion,this._scale),h.quaternionToEuler(this._quaternion,"XYZ",this._rotation),this._matrixDirty=!1,this._setWorldMatrixDirty(),this._sceneModelDirty(),this.glRedraw()}get matrix(){return this._rebuildMatrices(),this._matrix}get rotationMatrix(){return this._rebuildMatrices(),this._worldRotationMatrix}_rebuildMatrices(){this._matrixDirty&&(h.quaternionToRotationMat4(this._quaternion,this._worldRotationMatrix),h.conjugateQuaternion(this._quaternion,this._conjugateQuaternion),h.quaternionToRotationMat4(this._conjugateQuaternion,this._worldRotationMatrixConjugate),h.scaleMat4v(this._scale,this._worldRotationMatrix),h.scaleMat4v(this._scale,this._worldRotationMatrixConjugate),this._matrix.set(this._worldRotationMatrix),h.translateMat4v(this._position,this._matrix),this._matrixDirty=!1,this._viewMatrixDirty=!0)}get rotationMatrixConjugate(){return this._rebuildMatrices(),this._worldRotationMatrixConjugate}_setWorldMatrixDirty(){this._matrixDirty=!0,this._aabbDirty=!0}_transformDirty(){this._matrixDirty=!0,this._aabbDirty=!0,this.scene._aabbDirty=!0}_sceneModelDirty(){this.scene._aabbDirty=!0,this._aabbDirty=!0,this.scene._aabbDirty=!0,this._matrixDirty=!0;for(let e=0,t=this._entityList.length;e<t;e++)this._entityList[e]._sceneModelDirty()}get worldMatrix(){return this.matrix}get worldNormalMatrix(){return this._worldNormalMatrix}_rebuildViewMatrices(){this._rebuildMatrices(),this._viewMatrixDirty&&(h.mulMat4(this.scene.camera.viewMatrix,this._matrix,this._viewMatrix),h.inverseMat4(this._viewMatrix,this._viewNormalMatrix),h.transposeMat4(this._viewNormalMatrix),this._viewMatrixDirty=!1)}get viewMatrix(){return this._viewMatrix?(this._rebuildViewMatrices(),this._viewMatrix):this.scene.camera.viewMatrix}get viewNormalMatrix(){return this._viewNormalMatrix?(this._rebuildViewMatrices(),this._viewNormalMatrix):this.scene.camera.viewNormalMatrix}get backfaces(){return this._backfaces}set backfaces(e){e=!!e,this._backfaces=e,this.glRedraw()}get entityList(){return this._entityList}get isEntity(){return!0}get isModel(){return this._isModel}get isObject(){return!1}get aabb(){if(this._aabbDirty){h.collapseAABB3(this._aabb);for(let e=0,t=this._entityList.length;e<t;e++)h.expandAABB3(this._aabb,this._entityList[e].aabb);this._aabbDirty=!1}return this._aabb}get numTriangles(){return this._numTriangles}get numLines(){return this._numLines}get numPoints(){return this._numPoints}get visible(){return this.numVisibleLayerPortions>0}set visible(e){e=!1!==e,this._visible=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].visible=e;this.glRedraw()}get xrayed(){return this.numXRayedLayerPortions>0}set xrayed(e){e=!!e,this._xrayed=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].xrayed=e;this.glRedraw()}get highlighted(){return this.numHighlightedLayerPortions>0}set highlighted(e){e=!!e,this._highlighted=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].highlighted=e;this.glRedraw()}get selected(){return this.numSelectedLayerPortions>0}set selected(e){e=!!e,this._selected=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].selected=e;this.glRedraw()}get edges(){return this.numEdgesLayerPortions>0}set edges(e){e=!!e,this._edges=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].edges=e;this.glRedraw()}get culled(){return this._culled}set culled(e){e=!!e,this._culled=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].culled=e;this.glRedraw()}get clippable(){return this._clippable}set clippable(e){e=!1!==e,this._clippable=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].clippable=e;this.glRedraw()}get collidable(){return this._collidable}set collidable(e){e=!1!==e,this._collidable=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].collidable=e}get pickable(){return this.numPickableLayerPortions>0}set pickable(e){e=!1!==e,this._pickable=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].pickable=e}get colorize(){return this._colorize}set colorize(e){this._colorize=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].colorize=e}get opacity(){return this._opacity}set opacity(e){this._opacity=e;for(let t=0,s=this._entityList.length;t<s;t++)this._entityList[t].opacity=e}get castsShadow(){return this._castsShadow}set castsShadow(e){(e=!1!==e)!==this._castsShadow&&(this._castsShadow=e,this.glRedraw())}get receivesShadow(){return this._receivesShadow}set receivesShadow(e){(e=!1!==e)!==this._receivesShadow&&(this._receivesShadow=e,this.glRedraw())}get saoEnabled(){return this._saoEnabled}get pbrEnabled(){return this._pbrEnabled}get colorTextureEnabled(){return this._colorTextureEnabled}get isDrawable(){return!0}get isStateSortable(){return!1}get xrayMaterial(){return this.scene.xrayMaterial}get highlightMaterial(){return this.scene.highlightMaterial}get selectedMaterial(){return this.scene.selectedMaterial}get edgeMaterial(){return this.scene.edgeMaterial}getPickViewMatrix(e){return this._viewMatrix?this._viewMatrix:e}createQuantizationRange(e){void 0!==e.id&&null!==e.id?e.aabb?this.error("[createQuantizationRange] Config missing: aabb"):this._quantizationRanges[e.id]?this.error("[createQuantizationRange] QuantizationRange already created: "+e.id):this._quantizationRanges[e.id]={id:e.id,aabb:e.aabb,matrix:ai(e.aabb,h.mat4())}:this.error("[createQuantizationRange] Config missing: id")}_createDefaultIndices(e){const t=[];for(let s=0;s<e;s++)t.push(s);return t}createGeometry(e){if(void 0!==e.id&&null!==e.id)if(this._geometries[e.id])this.error("[createGeometry] Geometry already created: "+e.id);else if(void 0!==e.primitive&&null!==e.primitive||(e.primitive="triangles"),"points"===e.primitive||"lines"===e.primitive||"triangles"===e.primitive||"solid"===e.primitive||"surface"===e.primitive){if(!e.positions&&!e.positionsCompressed&&!e.buckets)return this.error("[createGeometry] Param expected: `positions`,  `positionsCompressed' or 'buckets"),null;if(e.positionsCompressed&&!e.positionsDecodeMatrix&&!e.positionsDecodeBoundary)return this.error("[createGeometry] Param expected: `positionsDecodeMatrix` or 'positionsDecodeBoundary' (required for `positionsCompressed')"),null;if(e.positionsDecodeMatrix&&e.positionsDecodeBoundary)return this.error("[createGeometry] Only one of these params expected: `positionsDecodeMatrix` or 'positionsDecodeBoundary' (required for `positionsCompressed')"),null;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("[createGeometry] Param expected: `uvDecodeMatrix` (required for `uvCompressed')"),null;if(e.buckets||e.indices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.indices=this._createDefaultIndices((e.positions||e.positionsCompressed).length/3)),!e.buckets&&!e.indices&&"points"!==e.primitive)return this.error(`[createGeometry] Param expected: indices (required for '${e.primitive}' primitive type)`),null;if(e.positionsDecodeBoundary&&(e.positionsDecodeMatrix=ai(e.positionsDecodeBoundary,h.mat4())),e.positions){const t=h.collapseAABB3();e.positionsDecodeMatrix=h.mat4(),h.expandAABB3Points3(t,e.positions),e.positionsCompressed=oi(e.positions,t,e.positionsDecodeMatrix),e.aabb=t}else if(e.positionsCompressed){const t=h.collapseAABB3();e.positionsDecodeMatrix=new Float64Array(e.positionsDecodeMatrix),e.positionsCompressed=new Uint16Array(e.positionsCompressed),h.expandAABB3Points3(t,e.positionsCompressed),he.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}else if(e.buckets){const t=h.collapseAABB3();this._dtxBuckets[e.id]=e.buckets;for(let s=0,i=e.buckets.length;s<i;s++){const i=e.buckets[s];i.positions?h.expandAABB3Points3(t,i.positions):i.positionsCompressed&&h.expandAABB3Points3(t,i.positionsCompressed)}e.positionsDecodeMatrix&&he.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}if(e.colorsCompressed&&e.colorsCompressed.length>0)e.colorsCompressed=new Uint8Array(e.colorsCompressed);else if(e.colors&&e.colors.length>0){const t=e.colors,s=new Uint8Array(t.length);for(let e=0,i=t.length;e<i;e++)s[e]=255*t[e];e.colorsCompressed=s}if(e.buckets||e.edgeIndices||"triangles"!==e.primitive&&"solid"!==e.primitive&&"surface"!==e.primitive||(e.positions?e.edgeIndices=re(e.positions,e.indices,null,5):e.edgeIndices=re(e.positionsCompressed,e.indices,e.positionsDecodeMatrix,2)),e.uv){const t=he.getUVBounds(e.uv),s=he.compressUVs(e.uv,t.min,t.max);e.uvCompressed=s.quantized,e.uvDecodeMatrix=s.decodeMatrix}else e.uvCompressed&&(e.uvCompressed=new Uint16Array(e.uvCompressed),e.uvDecodeMatrix=new Float64Array(e.uvDecodeMatrix));e.normals&&(e.normals=null),this._geometries[e.id]=e,this._numTriangles+=e.indices?Math.round(e.indices.length/3):0,this.numGeometries++}else this.error(`[createGeometry] Unsupported value for 'primitive': '${e.primitive}' - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'. Defaulting to 'triangles'.`);else this.error("[createGeometry] Config missing: id")}createTexture(e){const t=e.id;if(null==t)return void this.error("[createTexture] Config missing: id");if(this._textures[t])return void this.error("[createTexture] Texture already created: "+t);if(!e.src&&!e.image&&!e.buffers)return this.error("[createTexture] Param expected: `src`, `image' or 'buffers'"),null;let s=e.minFilter||1008;1006!==s&&1007!==s&&1008!==s&&1005!==s&&1004!==s&&(this.error("[createTexture] Unsupported value for 'minFilter' - \n            supported values are LinearFilter, LinearMipMapNearestFilter, NearestMipMapNearestFilter, \n            NearestMipMapLinearFilter and LinearMipmapLinearFilter. Defaulting to LinearMipmapLinearFilter."),s=1008);let i=e.magFilter||1006;1006!==i&&1003!==i&&(this.error("[createTexture] Unsupported value for 'magFilter' - supported values are LinearFilter and NearestFilter. Defaulting to LinearFilter."),i=1006);let r=e.wrapS||1e3;1001!==r&&1002!==r&&1e3!==r&&(this.error("[createTexture] Unsupported value for 'wrapS' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),r=1e3);let n=e.wrapT||1e3;1001!==n&&1002!==n&&1e3!==n&&(this.error("[createTexture] Unsupported value for 'wrapT' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),n=1e3);let A=e.wrapR||1e3;1001!==A&&1002!==A&&1e3!==A&&(this.error("[createTexture] Unsupported value for 'wrapR' - supported values are ClampToEdgeWrapping, MirroredRepeatWrapping and RepeatWrapping. Defaulting to RepeatWrapping."),A=1e3);let o=e.encoding||3e3;3e3!==o&&3001!==o&&(this.error("[createTexture] Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),o=3e3);const a=new vt({gl:this.scene.canvas.gl,minFilter:s,magFilter:i,wrapS:r,wrapT:n,wrapR:A,encoding:o});if(e.preloadColor&&a.setPreloadColor(e.preloadColor),e.image){const t=e.image;if(t.crossOrigin="Anonymous",t.compressed){const e=t.data;a.setCompressedData({mipmaps:e,props:{format:e[0].format,minFilter:s,magFilter:i}})}else a.setImage(t,{minFilter:s,magFilter:i,wrapS:r,wrapT:n,wrapR:A,flipY:e.flipY,encoding:o})}else if(e.src){const t=e.src.split(".").pop();switch(t){case"jpeg":case"jpg":case"png":case"gif":const l=new Image;l.onload=()=>{a.setImage(l,{minFilter:s,magFilter:i,wrapS:r,wrapT:n,wrapR:A,flipY:e.flipY,encoding:o}),this.glRedraw()},l.src=e.src;break;default:this._textureTranscoder?_.loadArraybuffer(e.src,(e=>{e.byteLength?this._textureTranscoder.transcode([e],a).then((()=>{this.glRedraw()})):this.error("[createTexture] Can't create texture from 'src': file data is zero length")}),(function(e){this.error(`[createTexture] Can't create texture from 'src': ${e}`)})):this.error(`[createTexture] Can't create texture from 'src' - SceneModel needs to be configured with a TextureTranscoder for this file type ('${t}')`)}}else e.buffers&&(this._textureTranscoder?this._textureTranscoder.transcode(e.buffers,a).then((()=>{this.glRedraw()})):this.error("[createTexture] Can't create texture from 'buffers' - SceneModel needs to be configured with a TextureTranscoder for this option"));this._textures[t]=new Si({id:t,texture:a})}createTextureSet(e){const t=e.id;if(null==t)return this.error("[createTextureSet] Config missing: id"),!1;if(this._textureSets[t])return this.error(`[createTextureSet] Texture set already created: ${t}`),!1;const s=(e,t)=>{const s=e??t;if(s in this._textures)return this._textures[s];throw e};try{const i=new Pi({id:t,model:this,alphaCutoff:e.alphaCutoff,colorTexture:s(e.colorTextureId,"defaultColorTexture"),metallicRoughnessTexture:s(e.metallicRoughnessTextureId,"defaultMetalRoughTexture"),normalsTexture:s(e.normalsTextureId,"defaultNormalsTexture"),emissiveTexture:s(e.emissiveTextureId,"defaultEmissiveTexture"),occlusionTexture:s(e.occlusionTextureId,"defaultOcclusionTexture")});return this._textureSets[t]=i,i}catch(e){return this.error(`[createTextureSet] Texture not found: ${e} - ensure that you create it first with createTexture()`),!1}}createTransform(e){if(void 0===e.id||null===e.id)return void this.error("[createTransform] SceneModel.createTransform() config missing: id");if(this._transforms[e.id])return void this.error(`[createTransform] SceneModel already has a transform with this ID: ${e.id}`);let t;if(e.parentTransformId&&(t=this._transforms[e.parentTransformId],!t))return void this.error("[createTransform] SceneModel.createTransform() config missing: id");const s=new cr({id:e.id,model:this,parent:t,matrix:e.matrix,position:e.position,scale:e.scale,rotation:e.rotation,quaternion:e.quaternion});return this._transforms[s.id]=s,s}createMesh(e){if(void 0===e.id||null===e.id)return this.error("[createMesh] SceneModel.createMesh() config missing: id"),!1;if(this._meshes[e.id])return this.error(`[createMesh] SceneModel already has a mesh with this ID: ${e.id}`),!1;const t=e.geometryId,s=void 0!==t;if(s){if(e.positions||e.positionsCompressed||e.indices||e.edgeIndices||e.normals||e.normalsCompressed||e.uv||e.uvCompressed||e.positionsDecodeMatrix)return this.error("Mesh geometry parameters not expected when instancing a geometry (not expected: positions, positionsCompressed, indices, edgeIndices, normals, normalsCompressed, uv, uvCompressed, positionsDecodeMatrix)"),!1;if(e.geometry=this._geometries[t],!e.geometry)return this.error(`[createMesh] Geometry not found: ${t} - ensure that you create it first with createGeometry()`),!1}else e.primitive??="triangles";const i=s?e.geometry.primitive:e.primitive,r="triangles"===i||"solid"===i||"surface"===i,n=e.textureSetId,A=this._dtxEnabled&&r&&!n;if(e.origin=e.origin?h.addVec3(this._origin,e.origin,h.vec3()):this._origin,s){e.positionsDecodeMatrix=e.geometry.positionsDecodeMatrix,e.aabb=h.AABB3(e.geometry.aabb);const t=e.transformId;if(t){if(e.transform=this._transforms[t],!e.transform)return this.error(`[createMesh] Transform not found: ${t} - ensure that you create it first with createTransform()`),!1}else if(e.matrix)e.meshMatrix=e.matrix;else if(e.scale||e.rotation||e.position||e.quaternion){const t=e.scale||pr,s=e.position||fr,i=e.rotation?h.eulerToQuaternion(e.rotation,"XYZ",dr):e.quaternion||gr;e.meshMatrix=h.composeMat4(s,i,t,h.mat4())}}else{if("points"!==i&&"lines"!==i&&"triangles"!==i&&"solid"!==i&&"surface"!==i)return this.error(`Unsupported value for 'primitive': '${i}'  ('geometryId' is absent) - supported values are 'points', 'lines', 'triangles', 'solid' and 'surface'.`),!1;if(!e.positions&&!e.positionsCompressed&&!e.buckets)return this.error("Param expected: 'positions',  'positionsCompressed' or `buckets`  ('geometryId' is absent)"),!1;if(e.positions&&(e.positionsDecodeMatrix||e.positionsDecodeBoundary))return this.error("Illegal params: 'positions' not expected with 'positionsDecodeMatrix'/'positionsDecodeBoundary' ('geometryId' is absent)"),!1;if(e.positionsCompressed&&!e.positionsDecodeMatrix&&!e.positionsDecodeBoundary)return this.error("Param expected: 'positionsCompressed' should be accompanied by 'positionsDecodeMatrix'/'positionsDecodeBoundary' ('geometryId' is absent)"),!1;if(e.uvCompressed&&!e.uvDecodeMatrix)return this.error("Param expected: 'uvCompressed' should be accompanied by `uvDecodeMatrix` ('geometryId' is absent)"),!1;if(!e.buckets&&!e.indices)if(r)e.indices=this._createDefaultIndices((e.positions||e.positionsCompressed).length/3);else if("lines"===i)return this.error(`Param expected: indices (required for '${i}' primitive type)`),!1;if((e.matrix||e.position||e.rotation||e.scale)&&(e.positionsCompressed||e.positionsDecodeBoundary))return this.error("Unexpected params: 'matrix', 'rotation', 'scale', 'position' not allowed with 'positionsCompressed'"),!1;if(e.matrix)e.meshMatrix=e.matrix;else if(e.scale||e.rotation||e.position||e.quaternion){const t=e.scale||pr,s=e.position||fr,i=e.rotation?h.eulerToQuaternion(e.rotation,"XYZ",dr):e.quaternion||gr;e.meshMatrix=h.composeMat4(s,i,t,h.mat4())}if(e.positionsDecodeBoundary&&(e.positionsDecodeMatrix=ai(e.positionsDecodeBoundary,h.mat4())),e.positions){const t=[];Ge(e.positions,t,hr)&&(e.positions=t,e.origin=h.addVec3(e.origin,hr,h.vec3()));const s=h.collapseAABB3();A?(e.positionsDecodeMatrix=h.mat4(),h.expandAABB3Points3(s,e.positions),e.positionsCompressed=oi(e.positions,s,e.positionsDecodeMatrix)):(e.meshMatrix&&(h.transformPositions3(e.meshMatrix,e.positions,e.positions),e.meshMatrix=null),h.expandAABB3Points3(s,e.positions)),e.aabb=s}else if(e.positionsCompressed){const t=h.collapseAABB3();h.expandAABB3Points3(t,e.positionsCompressed),he.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}if(A&&e.buckets){const t=h.collapseAABB3();e.buckets.forEach((e=>{const s=e.positions||e.positionsCompressed;s&&h.expandAABB3Points3(t,s)})),e.positionsDecodeMatrix&&he.decompressAABB(t,e.positionsDecodeMatrix),e.aabb=t}r&&!e.buckets&&(e.edgeIndices||=re(e.positions||e.positionsCompressed,e.indices,e.positions?null:e.positionsDecodeMatrix,2))}if(e.meshMatrix&&(h.AABB3ToOBB3(e.aabb,ur),h.transformOBB3(e.meshMatrix,ur,ur),h.OBB3ToAABB3(ur,e.aabb)),e.color=e.color?new Uint8Array(e.color.slice(0,3).map((e=>Math.floor(255*e)))):_r,e.opacity=Math.floor(255*(e.opacity??1)),A)e.type=2,s&&(e.buckets=this._dtxBuckets[t]),e.buckets||(e.buckets=function(e,t,s){let i,r,n,A;t||s?[i,r,n]=Ki({positionsCompressed:e.positionsCompressed,indices:e.indices,edgeIndices:e.edgeIndices}):(i=e.positionsCompressed,r=e.indices,n=e.edgeIndices);if(s){A=qi({positionsCompressed:i,indices:r,edgeIndices:n},i.length/3>65536?16:8)}else A=[{positionsCompressed:i,indices:r,edgeIndices:n}];return A}(s?e.geometry:e,this._enableVertexWelding,this._enableIndexBucketing),s&&(this._dtxBuckets[t]=e.buckets));else if(e.type=s?0:1,e.metallic=Math.floor(255*(e.metallic??0)),e.roughness=Math.floor(255*(e.roughness??1)),n&&(e.textureSet=this._textureSets[n],!s&&!e.textureSet))return this.error(`[createMesh] Texture set not found: ${n} - ensure that you create it first with createTextureSet()`),!1;e.numPrimitives=this._getNumPrimitives(e);const o=new ls(this,e.id,e.color,e.opacity,e.transform,e.textureSet),a=this.scene._renderer.getPickID(o);return o.pickId=a,o.origin=h.vec3(e.origin),o.layer=2===e.type?this._getDTXLayer(e):this._getVBOLayer(0===e.type,e),o.aabb=e.aabb,e.pickColor=new Uint8Array([255&a,a>>8&255,a>>16&255,a>>24&255]),e.solid="solid"===e.primitive,e.meshMatrix=e.transform?e.transform.worldMatrix:e.meshMatrix,o.portionId=o.layer.createPortion(o,e),o.numPrimitives=e.numPrimitives,this._meshes[e.id]=o,this._unusedMeshes[e.id]=o,this._meshList.push(o),o}_getNumPrimitives(e){let t=0;switch(e.geometry?e.geometry.primitive:e.primitive){case"triangles":case"solid":case"surface":switch(e.type){case 2:for(let s=0,i=e.buckets.length;s<i;s++)t+=e.buckets[s].indices.length;break;case 1:t+=e.indices.length;break;case 0:t+=e.geometry.indices.length}return Math.round(t/3);case"points":switch(e.type){case 2:for(let s=0,i=e.buckets.length;s<i;s++)t+=e.buckets[s].positionsCompressed.length;break;case 1:t+=e.positions?e.positions.length:e.positionsCompressed.length;break;case 0:const s=e.geometry;t+=s.positions?s.positions.length:s.positionsCompressed.length}return Math.round(t);case"lines":case"line-strip":switch(e.type){case 2:for(let s=0,i=e.buckets.length;s<i;s++)t+=e.buckets[s].indices.length;break;case 1:t+=e.indices.length;break;case 0:t+=e.geometry.indices.length}return Math.round(t/2)}return 0}_getDTXLayer(e){const t=e.origin,s=e.geometry?e.geometry.primitive:e.primitive,i=`.${s}.${Math.round(t[0])}.${Math.round(t[1])}.${Math.round(t[2])}`;let r=this._dtxLayers[i];if(r){if(r.canCreatePortion(e))return r;delete this._dtxLayers[i],r=null}switch(s){case"triangles":case"solid":case"surface":r=new si(this,s,t);break;default:return}return this._dtxLayers[i]=r,this.layerList.push(r),this._layersToFinalize.push(r),r}_getVBOLayer(e,t){const s=e&&t.geometry,i=e?s.primitive:t.primitive,r=t.origin,n=!e&&(t.positionsDecodeMatrix||t.positionsDecodeBoundary),A=n?this._createHashStringFromMatrix(n):"-",o=t.textureSetId||"-",a=e?t.geometryId:"-",l=(e?"instancing":"batching")+`.${Math.round(r[0])}.${Math.round(r[1])}.${Math.round(r[2])}.${i}.${A}.${o}.${a}`;if(!e&&l in this._vboLayers){const e=this._vboLayers[l],s=t.positionsCompressed?t.positionsCompressed.length:t.positions.length;e.canCreatePortion(s,"points"===i?0:t.indices.length)||(e.finalize(),delete this._vboLayers[l])}if(!(l in this._vboLayers)){const n=new Ui(this,i,r,{textureSet:t.textureSet,...e?{geometry:s}:{maxGeometryBatchSize:this._maxGeometryBatchSize,positionsDecodeMatrix:t.positionsDecodeMatrix,uvDecodeMatrix:t.uvDecodeMatrix}});this.layerList.push(n),this._layersToFinalize.push(n),this._vboLayers[l]=n}return this._vboLayers[l]}_createHashStringFromMatrix(e){const t=e.join(";");let s=0;for(let e=0;e<t.length;e++){s=(s<<5)-s+t.charCodeAt(e),s|=0}return(s>>>0).toString(16)}createEntity(e){if(void 0===e.id?e.id=h.createUUID():this.scene.components[e.id]&&(this.error(`Scene already has a Component with this ID: ${e.id} - will assign random ID`),e.id=h.createUUID()),void 0===e.meshIds)return this.error("Config missing: meshIds"),null;const t=e=>!1!==e;let s=0;s|=this._visible&&t(e.visible)&&cs,s|=this._pickable&&t(e.pickable)&&us,s|=this._culled&&t(e.culled)&&hs,s|=this._clippable&&t(e.clippable)&&ds,s|=this._collidable&&t(e.collidable)&&ps,s|=this._xrayed&&t(e.xrayed)&&fs,s|=this._highlighted&&t(e.highlighted)&&gs,s|=this._selected&&t(e.selected)&&ms,s|=this._edges&&t(e.edges)&&_s,e.flags=s;let i=[];for(let t=0,s=e.meshIds.length;t<s;t++){const s=e.meshIds[t];let r=this._meshes[s];r?r.parent?this.error(`Mesh with ID "${s}" already belongs to object with ID "${r.parent.id}" - ignoring this mesh`):(i.push(r),delete this._unusedMeshes[s]):this.error(`Mesh with this ID not found: "${s}" - ignoring this mesh`)}const r=new sr(this,e.isObject,e.id,i,e.flags,!0);return this._entityList.push(r),this._entities[e.id]=r,this._entitiesToFinalize.push(r),this.numEntities++,r}preFinalize(){if(this.destroyed)return!1;if(0===this._layersToFinalize.length)return!1;this._createDummyEntityForUnusedMeshes();for(let e=0,t=this._layersToFinalize.length;e<t;e++){this._layersToFinalize[e].finalize()}this._vboLayers={},this._dtxLayers={},this._layersToFinalize=[];for(let e=0,t=this._entitiesToFinalize.length;e<t;e++){this._entitiesToFinalize[e]._finalize()}for(let e=0,t=this._entitiesToFinalize.length;e<t;e++){this._entitiesToFinalize[e]._finalize2()}this._entitiesToFinalize=[],this.scene._aabbDirty=!0,this._viewMatrixDirty=!0,this._matrixDirty=!0,this._aabbDirty=!0,this._setWorldMatrixDirty(),this._sceneModelDirty(),this.position=this._position,this.layerList.sort(((e,t)=>e.sortId<t.sortId?-1:e.sortId>t.sortId?1:0));for(let e=0,t=this.layerList.length;e<t;e++){this.layerList[e].layerIndex=e}this.glRedraw(),this._layersFinalized=!0}finalize(){this.destroyed||(this.preFinalize(),this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={})}stateSortCompare(e,t){}rebuildRenderFlags(){this.renderFlags.reset(),this._updateRenderFlagsVisibleLayers(),this.renderFlags.numLayers>0&&0===this.renderFlags.numVisibleLayers?this.renderFlags.culled=!0:this._updateRenderFlags()}_updateRenderFlagsVisibleLayers(){const e=this.renderFlags;e.numLayers=this.layerList.length,e.numVisibleLayers=0;for(let t=0,s=this.layerList.length;t<s;t++){const s=this.layerList[t];this._getActiveSectionPlanesForLayer(s)&&(e.visibleLayers[e.numVisibleLayers++]=t)}}_createDummyEntityForUnusedMeshes(){const e=Object.keys(this._unusedMeshes);if(e.length>0){const t=`${this.id}-${h.createUUID()}`;this.warn(`Creating dummy SceneModelEntity "${t}" for unused SceneMeshes: [${e.join(",")}]`),this.createEntity({id:t,meshIds:e,isObject:!0})}this._unusedMeshes={}}_getActiveSectionPlanesForLayer(e){const t=this.renderFlags,s=this.scene._sectionPlanesState.sectionPlanes,i=s.length,r=e.layerIndex*i;if(i>0)for(let e=0;e<i;e++){s[e].active?(t.sectionPlanesActivePerLayer[r+e]=!0,t.sectioned=!0):t.sectionPlanesActivePerLayer[r+e]=!1}return!0}_updateRenderFlags(){if(0===this.numVisibleLayerPortions)return;if(this.numCulledLayerPortions===this.numPortions)return;const e=this.renderFlags;if(e.colorOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.colorTransparent=!0),this.numXRayedLayerPortions>0){const t=this.scene.xrayMaterial._state;t.fill&&(t.fillAlpha<1?e.xrayedSilhouetteTransparent=!0:e.xrayedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.xrayedEdgesTransparent=!0:e.xrayedEdgesOpaque=!0)}if(this.numEdgesLayerPortions>0){this.scene.edgeMaterial._state.edges&&(e.edgesOpaque=this.numTransparentLayerPortions<this.numPortions,this.numTransparentLayerPortions>0&&(e.edgesTransparent=!0))}if(this.numSelectedLayerPortions>0){const t=this.scene.selectedMaterial._state;t.fill&&(t.fillAlpha<1?e.selectedSilhouetteTransparent=!0:e.selectedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.selectedEdgesTransparent=!0:e.selectedEdgesOpaque=!0)}if(this.numHighlightedLayerPortions>0){const t=this.scene.highlightMaterial._state;t.fill&&(t.fillAlpha<1?e.highlightedSilhouetteTransparent=!0:e.highlightedSilhouetteOpaque=!0),t.edges&&(t.edgeAlpha<1?e.highlightedEdgesTransparent=!0:e.highlightedEdgesOpaque=!0)}}_withEachVisibleLayer(e,t){if(e&&0===this.numVisibleLayerPortions)return;const s=this.renderFlags;for(let e=0,i=s.visibleLayers.length;e<i;e++){const i=s.visibleLayers[e];t(this.layerList[i])}}drawColorOpaque(e){this._withEachVisibleLayer(!1,(t=>t.drawColorOpaque(this.renderFlags,e)))}drawColorTransparent(e){this._withEachVisibleLayer(!1,(t=>t.drawColorTransparent(this.renderFlags,e)))}drawDepth(e){this._withEachVisibleLayer(!1,(t=>t.drawDepth(this.renderFlags,e)))}drawSilhouetteXRayed(e){this._withEachVisibleLayer(!1,(t=>t.drawSilhouetteXRayed(this.renderFlags,e)))}drawSilhouetteHighlighted(e){this._withEachVisibleLayer(!1,(t=>t.drawSilhouetteHighlighted(this.renderFlags,e)))}drawSilhouetteSelected(e){this._withEachVisibleLayer(!1,(t=>t.drawSilhouetteSelected(this.renderFlags,e)))}drawEdgesColorOpaque(e){this._withEachVisibleLayer(!1,(t=>t.drawEdgesColorOpaque(this.renderFlags,e)))}drawEdgesColorTransparent(e){this._withEachVisibleLayer(!1,(t=>t.drawEdgesColorTransparent(this.renderFlags,e)))}drawEdgesXRayed(e){this._withEachVisibleLayer(!1,(t=>t.drawEdgesXRayed(this.renderFlags,e)))}drawEdgesHighlighted(e){this._withEachVisibleLayer(!1,(t=>t.drawEdgesHighlighted(this.renderFlags,e)))}drawEdgesSelected(e){this._withEachVisibleLayer(!1,(t=>t.drawEdgesSelected(this.renderFlags,e)))}drawOcclusion(e){this._withEachVisibleLayer(!0,(t=>t.drawOcclusion(this.renderFlags,e)))}drawShadow(e){this._withEachVisibleLayer(!0,(t=>t.drawShadow(this.renderFlags,e)))}drawPickMesh(e){this._withEachVisibleLayer(!0,(t=>t.drawPickMesh(this.renderFlags,e)))}drawPickDepths(e){this._withEachVisibleLayer(!0,(t=>t.drawPickDepths(this.renderFlags,e)))}drawPickNormals(e){this._withEachVisibleLayer(!0,(t=>t.drawPickNormals(this.renderFlags,e)))}_drawSnap(e,t){this._withEachVisibleLayer(!0,(s=>s.drawSnap(this.renderFlags,e,t)))}drawSnapInit(e){this._drawSnap(e,!0)}drawSnap(e){this._drawSnap(e,!1)}destroy(){Object.values(this._vboLayers).forEach((e=>e.destroy())),this._vboLayers={},this.scene.camera.off(this._onCameraViewMatrix),this.scene.off(this._onTick);for(let e=0,t=this.layerList.length;e<t;e++)this.layerList[e].destroy();this.layerList=[];for(let e=0,t=this._entityList.length;e<t;e++)this._entityList[e]._destroy();this._layersToFinalize=[],this._geometries={},this._dtxBuckets={},this._textures={},this._textureSets={},this._meshes={},this._entities={},this.scene._aabbDirty=!0,this._isModel&&this.scene._deregisterModel(this),super.destroy()}}class Br extends T{constructor(e,t={}){if(super(e,t),this._positions=t.positions||[],t.indices)this._indices=t.indices;else{this._indices=[];for(let e=0,t=this._positions.length/3-1;e<t;e+=2)this._indices.push(e),this._indices.push(e+1)}this._color=t.color||[1,1,1],this._opacity=t.opacity||1,this._sceneModel=new br(this,{isModel:!1}),this._sceneModel.createMesh({id:"linesMesh",primitive:"lines",positions:this._positions,indices:this._indices,color:this._color,opacity:this._opacity}),this._sceneModel.createEntity({meshIds:["linesMesh"],visible:t.visible,clippable:t.clippable,collidable:t.collidable}),this._sceneModel.finalize(),this.scene._lineSetCreated(this)}set visible(e){this._sceneModel.visible=e}get visible(){return this._sceneModel.visible}get positions(){return this._positions}get indices(){return this._indices}destroy(){super.destroy(),this.scene._lineSetDestroyed(this)}}class yr extends T{get type(){return"Light"}get isLight(){return!0}constructor(e,t={}){super(e,t)}}class wr extends yr{get type(){return"AmbientLight"}constructor(e,t={}){super(e,t),this._state={type:"ambient",color:h.vec3([.7,.7,.7]),intensity:1},this.color=t.color,this.intensity=t.intensity,this.scene._lightCreated(this)}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){this._state.intensity=void 0!==e?e:1,this.glRedraw()}get intensity(){return this._state.intensity}destroy(){super.destroy(),this.scene._lightDestroyed(this)}}class vr{constructor(e,t,s){this.gl=e,this.allocated=!1,this.buffer=null,this.bound=!1,this._colorFormats=t,this._hasDepthTexture=s}setSize(e){this.size=e}bind(){const e=this.size[0],t=this.size[1];if(!this.buffer||this.buffer.width===e&&this.buffer.height===t||(this.buffer.cleanup(),this.buffer=null),this.buffer||(this._allocateBuffer(e,t),this.bound=!1),!this.bound){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,this.buffer.framebuf),this.bound=!0}}_allocateBuffer(e,t){const s=this._colorFormats||[],i=this.gl,r=()=>{const e=i.createTexture();return i.bindTexture(i.TEXTURE_2D,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),e},n=(s.length>0?s:[null]).map((s=>{const n=r();return s?i.texStorage2D(i.TEXTURE_2D,1,s,e,t):i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e,t,0,i.RGBA,i.UNSIGNED_BYTE,null),n})),A=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,A),i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_COMPONENT32F,e,t);const o=i.createFramebuffer();i.bindFramebuffer(i.FRAMEBUFFER,o);for(let e=0;e<n.length;e++)i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+e,i.TEXTURE_2D,n[e],0);s.length>0&&i.drawBuffers(n.map(((e,t)=>i.COLOR_ATTACHMENT0+t)));const a=this._hasDepthTexture&&r();if(a?(i.texImage2D(i.TEXTURE_2D,0,i.DEPTH_COMPONENT32F,e,t,0,i.DEPTH_COMPONENT,i.FLOAT,null),i.framebufferTexture2D(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.TEXTURE_2D,a,0)):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_ATTACHMENT,i.RENDERBUFFER,A),i.bindTexture(i.TEXTURE_2D,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,o),!i.isFramebuffer(o))throw"Invalid framebuffer";i.bindFramebuffer(i.FRAMEBUFFER,null);const l=i.checkFramebufferStatus(i.FRAMEBUFFER);switch(l){case i.FRAMEBUFFER_COMPLETE:break;case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:throw"Incomplete framebuffer: FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case i.FRAMEBUFFER_UNSUPPORTED:throw"Incomplete framebuffer: FRAMEBUFFER_UNSUPPORTED";default:throw"Incomplete framebuffer: "+l}this.buffer={cleanup:()=>{n.forEach((e=>i.deleteTexture(e))),a&&i.deleteTexture(a),i.deleteFramebuffer(o),i.deleteRenderbuffer(A)},framebuf:o,width:e,height:t},this.colorTextures=n.map((e=>({bind:function(t){return i.activeTexture(i["TEXTURE"+t]),i.bindTexture(i.TEXTURE_2D,e),!0}}))),this.depthTexture=a&&{bind:function(e){return i.activeTexture(i["TEXTURE"+e]),i.bindTexture(i.TEXTURE_2D,a),!0}}}read(e,t,s=null,i=null,r=Uint8Array,n=4,A=0){const o=new r(n),a=this.gl;return a.readBuffer(a.COLOR_ATTACHMENT0+A),a.readPixels(e,this.buffer.height-t-1,1,1,s||a.RGBA,i||a.UNSIGNED_BYTE,o,0),o}unbind(){const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),this.bound=!1}destroy(){this.allocated&&(this.buffer.cleanup(),this.allocated=!1,this.buffer=null,this.bound=!1),this.colorTextures=null,this.depthTexture=null}}class Cr extends yr{get type(){return"DirLight"}constructor(e,t={}){super(e,t),this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const s=this.scene.camera,i=this.scene.canvas;this._onCameraViewMatrix=s.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=s.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=i.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new se({type:"dir",dir:h.vec3([1,1,1]),color:h.vec3([.7,.7,.8]),intensity:1,space:t.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(this._shadowViewMatrixDirty){this._shadowViewMatrix||(this._shadowViewMatrix=h.identityMat4());const e=this.scene.camera,t=this._state.dir,s=e.look,i=[s[0]-t[0],s[1]-t[1],s[2]-t[2]],r=[0,1,0];h.lookAtMat4v(i,s,r,this._shadowViewMatrix),this._shadowViewMatrixDirty=!1}return this._shadowViewMatrix},getShadowProjMatrix:()=>(this._shadowProjMatrixDirty&&(this._shadowProjMatrix||(this._shadowProjMatrix=h.identityMat4()),h.orthoMat4c(-40,40,-40,40,-40,80,this._shadowProjMatrix),this._shadowProjMatrixDirty=!1),this._shadowProjMatrix),getShadowRenderBuf:()=>(this._shadowRenderBuf||(this._shadowRenderBuf=new vr(this.scene.canvas.gl),this._shadowRenderBuf.setSize([1024,1024])),this._shadowRenderBuf)}),this.dir=t.dir,this.color=t.color,this.intensity=t.intensity,this.castsShadow=t.castsShadow,this.scene._lightCreated(this)}set dir(e){this._state.dir.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get dir(){return this._state.dir}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}get intensity(){return this._state.intensity}set castsShadow(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}}function Mr(e){if(!Er(e.width)||!Er(e.height)){const t=document.createElement("canvas");t.width=Fr(e.width),t.height=Fr(e.height);t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t.width,t.height),e=t}return e}function Er(e){return 0==(e&e-1)}function Fr(e){--e;for(let t=1;t<32;t<<=1)e|=e>>t;return e+1}class xr extends T{get type(){return"CubeTexture"}constructor(e,t={}){super(e,t);const s=this.scene.canvas.gl;this._state=new se({texture:new vt({gl:s,target:s.TEXTURE_CUBE_MAP}),flipY:this._checkFlipY(t.minFilter),encoding:this._checkEncoding(t.encoding),minFilter:1008,magFilter:1006,wrapS:1001,wrapT:1001,mipmaps:!0}),this._src=t.src,this._images=[],this._loadSrc(t.src),p.memory.textures++}_checkFlipY(e){return!!e}_checkEncoding(e){return 3e3!==(e=e||3e3)&&3001!==e&&(this.error("Unsupported value for 'encoding' - supported values are LinearEncoding and sRGBEncoding. Defaulting to LinearEncoding."),e=3e3),e}_loadSrc(e){const t=this,s=this.scene.canvas.gl;this._images=[];let i=!1,r=0;for(let n=0;n<e.length;n++){const A=new Image;A.onload=function(){let e=A;const o=n;return function(){if(!i&&(e=Mr(e),t._images[o]=e,r++,6===r)){let e=t._state.texture;e||(e=new vt({gl:s,target:s.TEXTURE_CUBE_MAP}),t._state.texture=e),e.setImage(t._images,t._state),t.fire("loaded",t._src,!1),t.glRedraw()}}}(),A.onerror=function(){i=!0},A.src=e[n]}}destroy(){super.destroy(),this._state.texture&&this._state.texture.destroy(),p.memory.textures--,this._state.destroy()}}const Ur=h.vec4(),Ir=h.vec4();class Tr extends T{constructor(e,t){super(e,t),this._entity=null,this._visible=null,this._worldPos=h.vec3(),this._origin=h.vec3(),this._rtcPos=h.vec3(),this._viewPos=h.vec3(),this._canvasPos=h.vec2(),this._occludable=!1,this._onCameraViewMatrix=this.scene.camera.on("matrix",(()=>{this._viewPosDirty=!0,this._needUpdate()})),this._onCameraProjMatrix=this.scene.camera.on("projMatrix",(()=>{this._canvasPosDirty=!0,this._needUpdate()})),this._onEntityDestroyed=null,this._onEntityModelDestroyed=null,this._renderer.addMarker(this),this.entity=t.entity,this.worldPos=t.worldPos,this.occludable=t.occludable}_update(){if(this._viewPosDirty&&(h.transformPoint3(this.scene.camera.viewMatrix,this._worldPos,this._viewPos),this._viewPosDirty=!1,this._canvasPosDirty=!0,this.fire("viewPos",this._viewPos)),this._canvasPosDirty){Ur.set(this._viewPos),Ur[3]=1,h.transformPoint4(this.scene.camera.projMatrix,Ur,Ir);const e=this.scene.canvas.boundary;this._canvasPos[0]=Math.floor((1+Ir[0]/Ir[3])*e[2]/2),this._canvasPos[1]=Math.floor((1-Ir[1]/Ir[3])*e[3]/2),this._canvasPosDirty=!1,this.fire("canvasPos",this._canvasPos)}}_setVisible(e){this._visible,this._visible=e,this.fire("visible",this._visible)}set entity(e){this._entity!==e&&(this._cleanupDestroyedHandlers(),this._entity=e,this._entity&&(this._entity.isSceneModelEntity?this._onEntityModelDestroyed=this._entity.model.on("destroyed",(()=>{this._entity=null,this._onEntityModelDestroyed=null})):this._onEntityDestroyed=this._entity.on("destroyed",(()=>{this._entity=null,this._onEntityDestroyed=null}))),this.fire("entity",this._entity,!0))}get entity(){return this._entity}set occludable(e){(e=!!e)!==this._occludable&&(this._occludable=e,this._occludable&&this._renderer.markerWorldPosUpdated(this))}get occludable(){return this._occludable}set worldPos(e){this._worldPos.set(e||[0,0,0]),Ne(this._worldPos,this._origin,this._rtcPos),this._occludable&&this._renderer.markerWorldPosUpdated(this),this._viewPosDirty=!0,this.fire("worldPos",this._worldPos),this._needUpdate()}get worldPos(){return this._worldPos}get origin(){return this._origin}get rtcPos(){return this._rtcPos}get viewPos(){return this._update(),this._viewPos}get canvasPos(){return this._update(),this._canvasPos}get visible(){return!!this._visible}destroy(){this.fire("destroyed",!0),this.scene.camera.off(this._onCameraViewMatrix),this.scene.camera.off(this._onCameraProjMatrix),this._cleanupDestroyedHandlers(),this._renderer.removeMarker(this),super.destroy()}_cleanupDestroyedHandlers(){this._entity&&(null!==this._onEntityDestroyed&&(this._entity.model?this._entity.model.off(this._onEntityDestroyed):this._entity.off(this._onEntityDestroyed),this._onEntityDestroyed=null),null!==this._onEntityModelDestroyed&&(this._entity.model&&this._entity.model.off(this._onEntityModelDestroyed),this._onEntityModelDestroyed=null))}}class Pr{constructor(e){this._eye=h.vec3(),this._look=h.vec3(),this._up=h.vec3(),this._projection={},e&&this.saveCamera(e)}saveCamera(e){const t=e.camera,s=t.project;switch(this._eye.set(t.eye),this._look.set(t.look),this._up.set(t.up),t.projection){case"perspective":this._projection={projection:"perspective",fov:s.fov,fovAxis:s.fovAxis,near:s.near,far:s.far};break;case"ortho":this._projection={projection:"ortho",scale:s.scale,near:s.near,far:s.far};break;case"frustum":this._projection={projection:"frustum",left:s.left,right:s.right,top:s.top,bottom:s.bottom,near:s.near,far:s.far};break;case"custom":this._projection={projection:"custom",matrix:s.matrix.slice()}}}restoreCamera(e,t){const s=e.camera,i=this._projection;function r(){switch(i.type){case"perspective":s.perspective.fov=i.fov,s.perspective.fovAxis=i.fovAxis,s.perspective.near=i.near,s.perspective.far=i.far;break;case"ortho":s.ortho.scale=i.scale,s.ortho.near=i.near,s.ortho.far=i.far;break;case"frustum":s.frustum.left=i.left,s.frustum.right=i.right,s.frustum.top=i.top,s.frustum.bottom=i.bottom,s.frustum.near=i.near,s.frustum.far=i.far;break;case"custom":s.customProjection.matrix=i.matrix}}t?e.viewer.cameraFlight.flyTo({eye:this._eye,look:this._look,up:this._up,orthoScale:i.scale,projection:i.projection},(()=>{r(),t()})):(s.eye=this._eye,s.look=this._look,s.up=this._up,r(),s.projection=i.projection)}}const Sr=h.vec3();const Dr=h.vec3();class kr{constructor(){this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsHasColorize=[],this.objectsOpacity=[],this.numObjects=0}saveObjects(e,t){this.numObjects=0,this._mask=t?_.apply(t,{}):null;const s=e.objects,i=!t||t.visible,r=!t||t.edges,n=!t||t.xrayed,A=!t||t.highlighted,o=!t||t.selected,a=!t||t.clippable,l=!t||t.pickable,c=!t||t.colorize,h=!t||t.opacity;for(let e in s)if(s.hasOwnProperty(e)){const t=s[e],u=this.numObjects;if(i&&(this.objectsVisible[u]=t.visible),r&&(this.objectsEdges[u]=t.edges),n&&(this.objectsXrayed[u]=t.xrayed),A&&(this.objectsHighlighted[u]=t.highlighted),o&&(this.objectsSelected[u]=t.selected),a&&(this.objectsClippable[u]=t.clippable),l&&(this.objectsPickable[u]=t.pickable),c){const e=t.colorize;e?(this.objectsColorize[3*u+0]=e[0],this.objectsColorize[3*u+1]=e[1],this.objectsColorize[3*u+2]=e[2],this.objectsHasColorize[u]=!0):this.objectsHasColorize[u]=!1}h&&(this.objectsOpacity[u]=t.opacity),this.numObjects++}}restoreObjects(e){const t=this._mask,s=!t||t.visible,i=!t||t.edges,r=!t||t.xrayed,n=!t||t.highlighted,A=!t||t.selected,o=!t||t.clippable,a=!t||t.pickable,l=!t||t.colorize,c=!t||t.opacity;var h=0;const u=e.objects;for(let e in u)if(u.hasOwnProperty(e)){const t=u[e];s&&(t.visible=this.objectsVisible[h]),i&&(t.edges=this.objectsEdges[h]),r&&(t.xrayed=this.objectsXrayed[h]),n&&(t.highlighted=this.objectsHighlighted[h]),A&&(t.selected=this.objectsSelected[h]),o&&(t.clippable=this.objectsClippable[h]),a&&(t.pickable=this.objectsPickable[h]),l&&(this.objectsHasColorize[h]?(Dr[0]=this.objectsColorize[3*h+0],Dr[1]=this.objectsColorize[3*h+1],Dr[2]=this.objectsColorize[3*h+2],t.colorize=Dr):t.colorize=null),c&&(t.opacity=this.objectsOpacity[h]),h++}}}const Qr=h.vec3(),Rr=h.vec3(),Or=h.vec4(),Vr=h.vec3([0,0,-1]),Lr=h.vec3([0,0,1]),Hr=h.vec3([0,1,0]);class Nr extends T{get type(){return"SectionPlane"}constructor(e,t={}){super(e,t),this._state=new se({active:!0,pos:h.vec3(),quaternion:h.vec4(),roll:0,dir:h.vec3(),dist:0}),this.active=t.active,this.pos=t.pos,this.dir=t.dir,this.scene._sectionPlaneCreated(this)}set active(e){this._state.active=!1!==e,this.glRedraw(),this.fire("active",this._state.active),this.scene.fire("sectionPlaneUpdated",this)}get active(){return this._state.active}set pos(e){this._state.pos.set(e||[0,0,0]),this._state.dist=-h.dotVec3(this._state.pos,this._state.dir),this.fire("pos",this._state.pos),this.scene.fire("sectionPlaneUpdated",this)}get pos(){return this._state.pos}set quaternion(e){this._state.quaternion.set(e||[0,0,0,-1]),h.vec3ApplyQuaternion(this._state.quaternion,Lr,this._state.dir);const t=h.vec3ApplyQuaternion(this._state.quaternion,Hr,Qr),s=h.vec3PairToQuaternion(Lr,this._state.dir,Or),i=h.vec3ApplyQuaternion(s,Hr,Rr),r=Math.acos(Math.min(1,h.dotVec3(t,i))),n=Math.sign(h.dotVec3(this._state.dir,h.cross3Vec3(t,i,Rr)));this._state.roll=n*r,this._onDirUpdated()}get quaternion(){return this._state.quaternion}set roll(e){this._state.roll=e||0,this._onDirRollUpdated()}get roll(){return this._state.roll}set dir(e){this._state.dir.set(e||Vr),this._onDirRollUpdated()}_onDirRollUpdated(){h.vec3PairToQuaternion(Lr,this._state.dir,this._state.quaternion),Or[0]=0,Or[1]=0,Or[2]=-1,Or[3]=this._state.roll,h.angleAxisToQuaternion(Or,Or),h.mulQuaternions(this._state.quaternion,Or,this._state.quaternion),this._onDirUpdated()}_onDirUpdated(){this._state.dist=-h.dotVec3(this._state.pos,this._state.dir),this.glRedraw(),this.fire("dir",this._state.dir),this.scene.fire("sectionPlaneUpdated",this)}get dir(){return this._state.dir}get dist(){return this._state.dist}flipDir(){h.mulVec3Scalar(this._state.dir,-1,this._state.dir),this.dir=this._state.dir}destroy(){this._state.destroy(),this.scene._sectionPlaneDestroyed(this),super.destroy()}}class Gr{constructor(){this.entity=null,this.primitive=null,this.primIndex=-1,this.pickSurfacePrecision=!1,this.touchInput=!1,this.snappedToEdge=!1,this.snappedToVertex=!1,this._origin=new Float64Array([0,0,0]),this._direction=new Float64Array([0,0,0]),this._indices=new Int32Array(3),this._localPos=new Float64Array([0,0,0]),this._worldPos=new Float64Array([0,0,0]),this._viewPos=new Float64Array([0,0,0]),this._canvasPos=new Int16Array([0,0]),this._snappedCanvasPos=new Int16Array([0,0]),this._bary=new Float64Array([0,0,0]),this._worldNormal=new Float64Array([0,0,0]),this._uv=new Float64Array([0,0]),this.reset()}get canvasPos(){return this._gotCanvasPos?this._canvasPos:null}set canvasPos(e){e?(this._canvasPos[0]=e[0],this._canvasPos[1]=e[1],this._gotCanvasPos=!0):this._gotCanvasPos=!1}get origin(){return this._gotOrigin?this._origin:null}set origin(e){e?(this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this._gotOrigin=!0):this._gotOrigin=!1}get direction(){return this._gotDirection?this._direction:null}set direction(e){e?(this._direction[0]=e[0],this._direction[1]=e[1],this._direction[2]=e[2],this._gotDirection=!0):this._gotDirection=!1}get indices(){return this.entity&&this._gotIndices?this._indices:null}set indices(e){e?(this._indices[0]=e[0],this._indices[1]=e[1],this._indices[2]=e[2],this._gotIndices=!0):this._gotIndices=!1}get localPos(){return this.entity&&this._gotLocalPos?this._localPos:null}set localPos(e){e?(this._localPos[0]=e[0],this._localPos[1]=e[1],this._localPos[2]=e[2],this._gotLocalPos=!0):this._gotLocalPos=!1}get snappedCanvasPos(){return this._gotSnappedCanvasPos?this._snappedCanvasPos:null}set snappedCanvasPos(e){e?(this._snappedCanvasPos[0]=e[0],this._snappedCanvasPos[1]=e[1],this._gotSnappedCanvasPos=!0):this._gotSnappedCanvasPos=!1}get worldPos(){return this._gotWorldPos?this._worldPos:null}set worldPos(e){e?(this._worldPos[0]=e[0],this._worldPos[1]=e[1],this._worldPos[2]=e[2],this._gotWorldPos=!0):this._gotWorldPos=!1}get viewPos(){return this.entity&&this._gotViewPos?this._viewPos:null}set viewPos(e){e?(this._viewPos[0]=e[0],this._viewPos[1]=e[1],this._viewPos[2]=e[2],this._gotViewPos=!0):this._gotViewPos=!1}get bary(){return this.entity&&this._gotBary?this._bary:null}set bary(e){e?(this._bary[0]=e[0],this._bary[1]=e[1],this._bary[2]=e[2],this._gotBary=!0):this._gotBary=!1}get worldNormal(){return this.entity&&this._gotWorldNormal?this._worldNormal:null}set worldNormal(e){e?(this._worldNormal[0]=e[0],this._worldNormal[1]=e[1],this._worldNormal[2]=e[2],this._gotWorldNormal=!0):this._gotWorldNormal=!1}get uv(){return this.entity&&this._gotUV?this._uv:null}set uv(e){e?(this._uv[0]=e[0],this._uv[1]=e[1],this._gotUV=!0):this._gotUV=!1}get snapped(){return this.snappedToEdge||this.snappedToVertex}reset(){this.entity=null,this.primIndex=-1,this.primitive=null,this.pickSurfacePrecision=!1,this._gotCanvasPos=!1,this._gotSnappedCanvasPos=!1,this._gotOrigin=!1,this._gotDirection=!1,this._gotIndices=!1,this._gotLocalPos=!1,this._gotWorldPos=!1,this._gotViewPos=!1,this._gotBary=!1,this._gotWorldNormal=!1,this._gotUV=!1,this.touchInput=!1,this.snappedToEdge=!1,this.snappedToVertex=!1}}const jr={isIphoneSafari(){const e=window.navigator.userAgent,t=/iPhone/i.test(e),s=/Safari/i.test(e)&&!/Chrome/i.test(e);return t&&s},isIphoneOrIpadSafari(){const e=window.navigator.userAgent,t=/iPhone|iPad/i.test(e)||/Macintosh/i.test(e)&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2,s=/Safari/i.test(e)&&!/Chrome/i.test(e);return t&&s},isTouchDevice:()=>"ontouchstart"in window||navigator.maxTouchPoints>0||navigator.mxMaxTouchPoints>0};class Wr{constructor(e,t,s){this.id=s&&s.id?s.id:e,this.viewer=t,this._subIdMap=null,this._subIdEvents=null,this._eventSubs=null,this._eventSubsNum=null,this._events=null,this._eventCallDepth=0,t.addPlugin(this)}scheduleTask(e){F.scheduleTask(e,null)}fire(e,t,s){this._events||(this._events={}),this._eventSubs||(this._eventSubs={},this._eventSubsNum={}),!0!==s&&(this._events[e]=t||!0);const i=this._eventSubs[e];let r;if(i)for(const s in i)i.hasOwnProperty(s)&&(r=i[s],this._eventCallDepth++,this._eventCallDepth<300?r.callback.call(r.scope,t):this.error("fire: potential stack overflow from recursive event '"+e+"' - dropping this event"),this._eventCallDepth--)}on(t,s,i){this._events||(this._events={}),this._subIdMap||(this._subIdMap=new e),this._subIdEvents||(this._subIdEvents={}),this._eventSubs||(this._eventSubs={}),this._eventSubsNum||(this._eventSubsNum={});let r=this._eventSubs[t];r?this._eventSubsNum[t]++:(r={},this._eventSubs[t]=r,this._eventSubsNum[t]=1);const n=this._subIdMap.addItem();r[n]={callback:s,scope:i||this},this._subIdEvents[n]=t;const A=this._events[t];return void 0!==A&&s.call(i||this,A),n}off(e){if(null==e)return;if(!this._subIdEvents)return;const t=this._subIdEvents[e];if(t){delete this._subIdEvents[e];const s=this._eventSubs[t];s&&(delete s[e],this._eventSubsNum[t]--),this._subIdMap.removeItem(e)}}once(e,t,s){const i=this,r=this.on(e,(function(e){i.off(r),t.call(s||this,e)}),s)}hasSubs(e){return this._eventSubsNum&&this._eventSubsNum[e]>0}log(e){console.log(`[xeokit plugin ${this.id}]: ${e}`)}warn(e){console.warn(`[xeokit plugin ${this.id}]: ${e}`)}error(e){console.error(`[xeokit plugin ${this.id}]: ${e}`)}send(e,t){}destroy(){this.viewer.removePlugin(this)}}class zr extends T{get type(){return"Spinner"}constructor(e,t={}){super(e,t),this._canvas=t.canvas,this._element=null,this._isCustom=!1,t.elementId&&(this._element=document.getElementById(t.elementId),this._element?this._adjustPosition():this.error("Can't find given Spinner HTML element: '"+t.elementId+"' - will automatically create default element")),this._element||this._createDefaultSpinner(),this.processes=0}_createDefaultSpinner(){this._injectDefaultCSS();const e=document.createElement("div"),t=e.style;t["z-index"]="9000",t.position="absolute",e.innerHTML='<div class="sk-fading-circle">                <div class="sk-circle1 sk-circle"></div>                <div class="sk-circle2 sk-circle"></div>                <div class="sk-circle3 sk-circle"></div>                <div class="sk-circle4 sk-circle"></div>                <div class="sk-circle5 sk-circle"></div>                <div class="sk-circle6 sk-circle"></div>                <div class="sk-circle7 sk-circle"></div>                <div class="sk-circle8 sk-circle"></div>                <div class="sk-circle9 sk-circle"></div>                <div class="sk-circle10 sk-circle"></div>                <div class="sk-circle11 sk-circle"></div>                <div class="sk-circle12 sk-circle"></div>                </div>',this._canvas.parentElement.appendChild(e),this._element=e,this._isCustom=!1,this._adjustPosition()}_injectDefaultCSS(){const e="xeokit-spinner-css";if(document.getElementById(e))return;const t=document.createElement("style");t.innerHTML=".sk-fading-circle {        background: transparent;        margin: 20px auto;        width: 50px;        height:50px;        position: relative;        }        .sk-fading-circle .sk-circle {        width: 120%;        height: 120%;        position: absolute;        left: 0;        top: 0;        }        .sk-fading-circle .sk-circle:before {        content: '';        display: block;        margin: 0 auto;        width: 15%;        height: 15%;        background-color: #ff8800;        border-radius: 100%;        -webkit-animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        animation: sk-circleFadeDelay 1.2s infinite ease-in-out both;        }        .sk-fading-circle .sk-circle2 {        -webkit-transform: rotate(30deg);        -ms-transform: rotate(30deg);        transform: rotate(30deg);    }    .sk-fading-circle .sk-circle3 {        -webkit-transform: rotate(60deg);        -ms-transform: rotate(60deg);        transform: rotate(60deg);    }    .sk-fading-circle .sk-circle4 {        -webkit-transform: rotate(90deg);        -ms-transform: rotate(90deg);        transform: rotate(90deg);    }    .sk-fading-circle .sk-circle5 {        -webkit-transform: rotate(120deg);        -ms-transform: rotate(120deg);        transform: rotate(120deg);    }    .sk-fading-circle .sk-circle6 {        -webkit-transform: rotate(150deg);        -ms-transform: rotate(150deg);        transform: rotate(150deg);    }    .sk-fading-circle .sk-circle7 {        -webkit-transform: rotate(180deg);        -ms-transform: rotate(180deg);        transform: rotate(180deg);    }    .sk-fading-circle .sk-circle8 {        -webkit-transform: rotate(210deg);        -ms-transform: rotate(210deg);        transform: rotate(210deg);    }    .sk-fading-circle .sk-circle9 {        -webkit-transform: rotate(240deg);        -ms-transform: rotate(240deg);        transform: rotate(240deg);    }    .sk-fading-circle .sk-circle10 {        -webkit-transform: rotate(270deg);        -ms-transform: rotate(270deg);        transform: rotate(270deg);    }    .sk-fading-circle .sk-circle11 {        -webkit-transform: rotate(300deg);        -ms-transform: rotate(300deg);        transform: rotate(300deg);    }    .sk-fading-circle .sk-circle12 {        -webkit-transform: rotate(330deg);        -ms-transform: rotate(330deg);        transform: rotate(330deg);    }    .sk-fading-circle .sk-circle2:before {        -webkit-animation-delay: -1.1s;        animation-delay: -1.1s;    }    .sk-fading-circle .sk-circle3:before {        -webkit-animation-delay: -1s;        animation-delay: -1s;    }    .sk-fading-circle .sk-circle4:before {        -webkit-animation-delay: -0.9s;        animation-delay: -0.9s;    }    .sk-fading-circle .sk-circle5:before {        -webkit-animation-delay: -0.8s;        animation-delay: -0.8s;    }    .sk-fading-circle .sk-circle6:before {        -webkit-animation-delay: -0.7s;        animation-delay: -0.7s;    }    .sk-fading-circle .sk-circle7:before {        -webkit-animation-delay: -0.6s;        animation-delay: -0.6s;    }    .sk-fading-circle .sk-circle8:before {        -webkit-animation-delay: -0.5s;        animation-delay: -0.5s;    }    .sk-fading-circle .sk-circle9:before {        -webkit-animation-delay: -0.4s;        animation-delay: -0.4s;    }    .sk-fading-circle .sk-circle10:before {        -webkit-animation-delay: -0.3s;        animation-delay: -0.3s;    }    .sk-fading-circle .sk-circle11:before {        -webkit-animation-delay: -0.2s;        animation-delay: -0.2s;    }    .sk-fading-circle .sk-circle12:before {        -webkit-animation-delay: -0.1s;        animation-delay: -0.1s;    }    @-webkit-keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }    @keyframes sk-circleFadeDelay {        0%, 39%, 100% { opacity: 0; }        40% { opacity: 1; }    }",t.id=e,document.body.appendChild(t)}_adjustPosition(){if(this._isCustom)return;const e=this._canvas,t=this._element,s=t.style;s.left=e.offsetLeft+.5*e.clientWidth-.5*t.clientWidth+"px",s.top=e.offsetTop+.5*e.clientHeight-.5*t.clientHeight+"px"}set processes(e){if(e=e||0,this._processes===e)return;if(e<0)return;const t=this._processes;this._processes=e;const s=this._element;s&&(s.style.visibility=this._processes>0?"visible":"hidden"),this.fire("processes",this._processes),0===this._processes&&this._processes!==t&&this.fire("zeroProcesses",this._processes)}get processes(){return this._processes}_destroy(){this._element&&!this._isCustom&&(this._element.parentNode.removeChild(this._element),this._element=null);const e=document.getElementById("xeokit-spinner-css");e&&e.parentNode.removeChild(e)}}const Xr=["webgl2","experimental-webgl","webkit-3d","moz-webgl","moz-glweb20"];class Kr extends T{constructor(e,t={}){super(e,t),this._backgroundColor=h.vec3([t.backgroundColor?t.backgroundColor[0]:1,t.backgroundColor?t.backgroundColor[1]:1,t.backgroundColor?t.backgroundColor[2]:1]),this._backgroundColorFromAmbientLight=!!t.backgroundColorFromAmbientLight,this.canvas=t.canvas,this.gl=null,this.webgl2=!1,this.transparent=!!t.transparent,this.contextAttr=t.contextAttr||{},this.contextAttr.alpha=this.transparent,this.contextAttr.preserveDrawingBuffer=!!this.contextAttr.preserveDrawingBuffer,this.contextAttr.stencil=!1,this.contextAttr.premultipliedAlpha=!!this.contextAttr.premultipliedAlpha,this.contextAttr.antialias=!1!==this.contextAttr.antialias,this.resolutionScale=t.resolutionScale,this.canvas.width=Math.round(this.canvas.clientWidth*this._resolutionScale),this.canvas.height=Math.round(this.canvas.clientHeight*this._resolutionScale),this.boundary=[this.canvas.offsetLeft,this.canvas.offsetTop,this.canvas.clientWidth,this.canvas.clientHeight],this._initWebGL(t);const s=this;let i=!0;new ResizeObserver((e=>{for(const t of e)t.contentBoxSize&&(i=!0)})).observe(this.canvas),this._tick=this.scene.on("tick",(()=>{i&&(i=!1,s.canvas.width=Math.round(s.canvas.clientWidth*s._resolutionScale),s.canvas.height=Math.round(s.canvas.clientHeight*s._resolutionScale),s.boundary[0]=s.canvas.offsetLeft,s.boundary[1]=s.canvas.offsetTop,s.boundary[2]=s.canvas.clientWidth,s.boundary[3]=s.canvas.clientHeight,s.fire("boundary",s.boundary))})),this._spinner=new zr(this.scene,{canvas:this.canvas,elementId:t.spinnerElementId})}get type(){return"Canvas"}get backgroundColorFromAmbientLight(){return this._backgroundColorFromAmbientLight}set backgroundColorFromAmbientLight(e){this._backgroundColorFromAmbientLight=!1!==e,this.glRedraw()}get backgroundColor(){return this._backgroundColor}set backgroundColor(e){e?(this._backgroundColor[0]=e[0],this._backgroundColor[1]=e[1],this._backgroundColor[2]=e[2]):(this._backgroundColor[0]=1,this._backgroundColor[1]=1,this._backgroundColor[2]=1),this.glRedraw()}get resolutionScale(){return this._resolutionScale}set resolutionScale(e){if((e=e||1)===this._resolutionScale)return;this._resolutionScale=e;const t=this.canvas;t.width=Math.round(t.clientWidth*this._resolutionScale),t.height=Math.round(t.clientHeight*this._resolutionScale),this.glRedraw()}get spinner(){return this._spinner}_createCanvas(){const e="xeokit-canvas-"+h.createUUID(),t=document.getElementsByTagName("body")[0],s=document.createElement("div"),i=s.style;i.height="100%",i.width="100%",i.padding="0",i.margin="0",i.background="rgba(0,0,0,0);",i.float="left",i.left="0",i.top="0",i.position="absolute",i.opacity="1.0",i["z-index"]="-10000",s.innerHTML+='<canvas id="'+e+'" style="width: 100%; height: 100%; float: left; margin: 0; padding: 0;"></canvas>',t.appendChild(s),this.canvas=document.getElementById(e)}_getElementXY(e){let t=0,s=0;for(;e;)t+=e.offsetLeft-e.scrollLeft,s+=e.offsetTop-e.scrollTop,e=e.offsetParent;return{x:t,y:s}}_initWebGL(){if(!this.gl)for(let e=0;!this.gl&&e<Xr.length;e++)try{this.gl=this.canvas.getContext(Xr[e],this.contextAttr)}catch(e){}this.gl||(this.error("Failed to get a WebGL context"),this.fire("webglContextFailed",!0,!0));{const e=this.gl;let t="__",s=e.activeTexture;e.activeTexture=function(e){t!==e&&(t=e,s.call(this,e))};let i={},r=e.bindTexture;e.bindTexture=function(e,s){i[t]!==s&&(i[t]=s,r.call(this,e,s))}}this.gl&&this.webgl2&&(this.gl.hint(this.gl.FRAGMENT_SHADER_DERIVATIVE_HINT,this.gl.FASTEST),this.gl,WebGL2RenderingContext)}getSnapshot(e){throw"Canvas#getSnapshot() has been replaced by Viewer#getSnapshot() - use that method instead."}readPixels(e,t,s){return this.scene._renderer.snapshot.readPixels(e,t,s)}loseWebGLContext(){this.canvas.loseContext&&this.canvas.loseContext()}destroy(){this.scene.off(this._tick),this._spinner._destroy(),this.gl=null,super.destroy()}}class Zr{constructor(e){this._matPool=[],this.reset()}reset(){this._matPoolNextFreeIndex=0,this._rtcViewMats={},this.lastProgramId=null,this.pbrEnabled=!1,this.colorTextureEnabled=!1,this.withSAO=!1,this.backfaces=!1,this.frontface=!0,this.textureUnit=0,this.drawElements=0,this.drawArrays=0,this.useProgram=0,this.bindTexture=0,this.bindArray=0,this.pass=0,this.viewParams={},this.viewParams.viewMatrix=null,this.viewParams.projMatrix=null,this.viewParams.near=.01,this.viewParams.far=5e3,this.pickInvisible=!1,this.lineWidth=1,this.snapPickLayerParams=[],this.snapPickCoordinateScale=h.vec3(),this.snapPickOrigin=h.vec3()}getRTCViewMatrix(e,t){let s=this._rtcViewMats[e];return s||(s=this._getNewMat(),He(this.viewParams.viewMatrix,t,s),this._rtcViewMats[e]=s),s}_getNewMat(){let e=this._matPool[this._matPoolNextFreeIndex];return e||(e=h.mat4(),this._matPool[this._matPoolNextFreeIndex]=e),this._matPoolNextFreeIndex++,e}}const Jr={WEBGL:!1,SUPPORTED_EXTENSIONS:{}},Yr=document.createElement("canvas");if(Yr){const e=Yr.getContext("webgl",{antialias:!0})||Yr.getContext("experimental-webgl",{antialias:!0});Jr.WEBGL=!!e,Jr.WEBGL&&(Jr.ANTIALIAS=e.getContextAttributes().antialias,e.getShaderPrecisionFormat?e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0?Jr.FS_MAX_FLOAT_PRECISION="highp":e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?Jr.FS_MAX_FLOAT_PRECISION="mediump":Jr.FS_MAX_FLOAT_PRECISION="lowp":Jr.FS_MAX_FLOAT_PRECISION="mediump",Jr.DEPTH_BUFFER_BITS=e.getParameter(e.DEPTH_BITS),Jr.MAX_TEXTURE_SIZE=e.getParameter(e.MAX_TEXTURE_SIZE),Jr.MAX_CUBE_MAP_SIZE=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),Jr.MAX_RENDERBUFFER_SIZE=e.getParameter(e.MAX_RENDERBUFFER_SIZE),Jr.MAX_TEXTURE_UNITS=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),Jr.MAX_TEXTURE_IMAGE_UNITS=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),Jr.MAX_VERTEX_ATTRIBS=e.getParameter(e.MAX_VERTEX_ATTRIBS),Jr.MAX_VERTEX_UNIFORM_VECTORS=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),Jr.MAX_FRAGMENT_UNIFORM_VECTORS=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),Jr.MAX_VARYING_VECTORS=e.getParameter(e.MAX_VARYING_VECTORS),e.getSupportedExtensions().forEach((function(e){Jr.SUPPORTED_EXTENSIONS[e]=!0})))}class $r{constructor(e){this.aabb=h.AABB3(),this.origin=h.vec3(e),this.originHash=this.origin.join(),this.numMarkers=0,this.markers={},this.markerList=[],this.markerIndices={},this.positions=[],this.indices=[],this.positionsBuf=null,this.lenPositionsBuf=0,this.indicesBuf=null,this.sectionPlanesActive=[],this.occlusionTestList=[],this.lenOcclusionTestList=0,this.pixels=[],this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!1}addMarker(e){this.markers[e.id]=e,this.markerListDirty=!0,this.numMarkers++}markerWorldPosUpdated(e){if(!this.markers[e.id])return;const t=this.markerIndices[e.id];this.positions[3*t+0]=e.worldPos[0],this.positions[3*t+1]=e.worldPos[1],this.positions[3*t+2]=e.worldPos[2],this.positionsDirty=!0}removeMarker(e){delete this.markers[e.id],this.markerListDirty=!0,this.numMarkers--}update(e,t){if(this.markerListDirty){for(var s in this.numMarkers=0,this.markers)this.markers.hasOwnProperty(s)&&(this.markerList[this.numMarkers]=this.markers[s],this.markerIndices[s]=this.numMarkers,this.numMarkers++);this.markerList.length=this.numMarkers,this.markerListDirty=!1,this.positionsDirty=!0,this.occlusionTestListDirty=!0}if(this.positionsDirty){let t=0;for(let e=0;e<this.numMarkers;e++)if(this.markerList[e]){const s=this.markerList[e].rtcPos;this.positions[t++]=s[0],this.positions[t++]=s[1],this.positions[t++]=s[2],this.indices[e]=e}this.positions.length=3*this.numMarkers,this.indices.length=this.numMarkers,this.positionsDirty=!1;const s=this.aabb;h.collapseAABB3(s),h.expandAABB3Points3(s,this.positions);const i=this.origin;s[0]+=i[0],s[1]+=i[1],s[2]+=i[2],s[3]+=i[0],s[4]+=i[1],s[5]+=i[2],this.positionsBuf&&this.lenPositionsBuf!==this.positions.length&&(this.positionsBuf.destroy(),this.positionsBuf=null,this.indicesBuf.destroy(),this.indicesBuf=null);const r=new Float32Array(this.positions);this.positionsBuf?this.positionsBuf.setData(r):(this.positionsBuf=new ie(e,e.ARRAY_BUFFER,r,r.length,3,e.STATIC_DRAW),this.indicesBuf=new ie(e,e.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indices),this.indices.length,1,e.STATIC_DRAW),this.lenPositionsBuf=this.positions.length)}if(this.occlusionTestListDirty){let e=0;this.lenOcclusionTestList=0;for(let s=0;s<this.numMarkers;s++){const i=this.markerList[s];i.entity&&!i.entity.visible||!t(i)?i._setVisible(!1):i.occludable?(this.occlusionTestList[this.lenOcclusionTestList++]=i,this.pixels[e++]=i.canvasPos[0],this.pixels[e++]=i.canvasPos[1]):i._setVisible(!0)}}}destroy(){this.markers={},this.markerList.length=0,this.positionsBuf&&this.positionsBuf.destroy(),this.indicesBuf&&this.indicesBuf.destroy()}}const qr=h.vec3([255,0,0]);h.vec3();class en{constructor(e){this._scene=e,this._occlusionLayers={},this._occlusionLayersList=[],this._occlusionLayersListDirty=!1,this._drawable=null,this._markersToOcclusionLayersMap={};const t=e.camera,s=()=>{this._occlusionTestListDirty=!0};this._onCameraViewMatrix=t.on("viewMatrix",s),this._onCameraProjMatrix=t.on("projMatrix",s),this._onCanvasBoundary=e.canvas.on("boundary",s)}_addMarker(e,t){this._occlusionLayers[t]||(this._occlusionLayers[t]=new $r(e.origin),this._occlusionLayersListDirty=!0);const s=this._occlusionLayers[t];s.addMarker(e),this._markersToOcclusionLayersMap[e.id]=s}_removeMarker(e,t){1===e.numMarkers?(e.destroy(),delete this._occlusionLayers[e.originHash],this._occlusionLayersListDirty=!0):e.removeMarker(t),delete this._markersToOcclusionLayersMap[t.id]}addMarker(e){const t=e.origin.join();this._addMarker(e,t),this._occlusionTestListDirty=!0}markerWorldPosUpdated(e){const t=this._markersToOcclusionLayersMap[e.id];if(t){const s=e.origin.join();s!==t.originHash?(this._removeMarker(t,e),this._addMarker(e,s)):t.markerWorldPosUpdated(e)}}removeMarker(e){const t=e.origin.join(),s=this._occlusionLayers[t];s&&this._removeMarker(s,e)}get needOcclusionTest(){return this._occlusionTestListDirty}drawMarkers(){const e=this._scene,t=e.canvas,s=t.gl,i=e._sectionPlanesState,r=[t.canvas.id,i.getHash()].join(";");if(!this._drawable||r!==this._drawable.shaderSourceHash){this._drawable&&this._drawable.destroy();const n=Ke(),A=n.programVariables,o=A.createUniform("mat4","viewMatrix"),a=A.createUniform("mat4","projMatrix"),l=A.createAttribute("vec3","position"),c=A.createOutput("vec4","outColor"),u="clipPos",[d,p]=n.buildProgram(s,"OcclusionTester",{sectionPlanesState:i,getLogDepth:e.logarithmicDepthBufferEnabled&&(e=>e),clippableTest:()=>"true",getVertexData:()=>{const t=[];return t.push(`vec4 worldPosition = vec4(${l}, 1.0);`),t.push(`vec4 ${u} = ${a} * ${o} * worldPosition;`),!e.logarithmicDepthBufferEnabled&&e.markerZOffset<0&&t.push(`${u}.z += ${e.markerZOffset};`),t},worldPositionAttribute:"worldPosition",getPointSize:()=>"20.0",clipPos:u,appendFragmentOutputs:e=>e.push(`${c} = vec4(1.0, 0.0, 0.0, 1.0);`)});if(p)throw console.error(p.join("\n")),p.join("\n");this._occlusionTestListDirty=!0,this._drawable={shaderSourceHash:r,destroy:()=>d.destroy(),drawCall:()=>{const r=e.camera,n=r.project;d.bind(),a.setInputValue(n.matrix);const A=t.boundary,c=A[2],u=A[3],p=r.perspective.near,f=e=>{const t=e.viewPos,s=e.canvasPos,i=s[0],r=s[1];return t[2]<=-p&&i>=-10&&r>=-10&&i<=c+10&&r<=u+10};this._occlusionLayersList.forEach((e=>{e.update(s,f);const t=i.sectionPlanes.some(((t,s)=>{const i=t.active?h.planeAABB3Intersect(t.dir,t.dist,e.aabb):1,r=-1===i;return e.sectionPlanesActive[s]=0===i,r}));if(!t){const t=e.origin;o.setInputValue(He(r.viewMatrix,t)),d.inputSetters.setUniforms(null,{view:{far:n.far},mesh:{origin:t,renderFlags:{sectionPlanesActivePerLayer:e.sectionPlanesActive}}}),l.setInputValue(e.positionsBuf);const i=e.indicesBuf;i.bind(),s.drawElements(s.POINTS,i.numItems,i.itemType,0)}}))}}}if(this._occlusionLayersListDirty){let e=0;for(let t in this._occlusionLayers)this._occlusionLayers.hasOwnProperty(t)&&(this._occlusionLayersList[e++]=this._occlusionLayers[t]);this._occlusionLayersList.length=e,this._occlusionLayersListDirty=!1}if(this._occlusionTestListDirty){for(let e=0,t=this._occlusionLayersList.length;e<t;e++){this._occlusionLayersList[e].occlusionTestListDirty=!0}this._occlusionTestListDirty=!1}this._drawable.drawCall()}doOcclusionTest(e){this._occlusionLayersList.forEach((t=>{for(let s=0;s<t.lenOcclusionTestList;s++){const i=2*s,r=e(t.pixels[i],t.pixels[i+1]);t.occlusionTestList[s]._setVisible(h.compareVec3(qr,r))}}))}destroy(){this.destroyed||(this._occlusionLayersList.forEach((e=>e.destroy())),this._drawable&&this._drawable.destroy(),this._scene.camera.off(this._onCameraViewMatrix),this._scene.camera.off(this._onCameraProjMatrix),this._scene.canvas.off(this._onCanvasBoundary),this.destroyed=!0)}}const tn=h.vec3([0,0,0]),sn=h.vec4([1/4294967296,1/16777216,1/65536,1/256]),rn=e=>e[0]+(e[1]<<8)+(e[2]<<16)+(e[3]<<24),nn=e=>h.normalizeVec3(h.divVec3Scalar(e,h.MAX_INT,h.vec3())),An=(e,t,s)=>h.vec3([e[0]*s[0]+t[0],e[1]*s[1]+t[1],e[2]*s[2]+t[2]]),on=function(t,s){s=s||{};const i=new Zr,r=t.canvas.canvas,n=t.canvas.gl,A=!!s.transparent,o=s.alphaDepthMask,a=new e({});let l={},c={},u=[],d=[],f=[],g=!0,m=!0,_=!0,b=!0,B=!0,y=!0,w=!0,v=!0;const C=function(){const e={},s={};return{getRenderBuffer:(i,r,A)=>{const o=1===t.canvas.resolutionScale?e:s;return o[i]||(o[i]=new vr(n,r,A)),o[i]},destroy:()=>{Object.values(e).forEach((e=>e.destroy())),Object.values(s).forEach((e=>e.destroy()))}}}(),M=(e,t,s,i)=>{const r=s.programVariables,n=r.createUniform("vec2","uViewportInv"),A=r.createUniform("float","uCameraNear"),o=r.createUniform("float","uCameraFar"),a=r.createUniform("sampler2D","uDepthTexture"),l=r.createAttribute("vec2","uv"),c=r.createVarying("vec2","vUV",(()=>l)),h=r.createOutput("vec4","outColor"),u=r.createFragmentDefinition("getOutColor",((e,t)=>{const s="getDepth";t.push(`\n                float getDepth(const in vec2 uv) {\n                    return texture(${a}, uv).r;\n                }\n            `),t.push(i(e,c,n,A,o,s))})),[d,p]=s.buildProgram(e,t,{clipPos:`vec4(2.0 * ${l} - 1.0, 0.0, 1.0)`,appendFragmentOutputs:e=>e.push(`${h} = ${u}();`)});if(p)throw console.error(p.join("\n")),p;{const t=new Float32Array([1,1,0,1,0,0,1,0]),s=new ie(e,e.ARRAY_BUFFER,t,t.length,2,e.STATIC_DRAW),i=new Uint32Array([0,1,2,0,2,3]),r=new ie(e,e.ELEMENT_ARRAY_BUFFER,i,i.length,1,e.STATIC_DRAW);return{destroy:d.destroy,bind:(e,t,i)=>{d.bind(),n.setInputValue([1/e[0],1/e[1]]),A.setInputValue(t.near),o.setInputValue(t.far),a.setInputValue(i),l.setInputValue(s)},draw:()=>{r.bind(),e.drawElements(e.TRIANGLES,r.numItems,r.itemType,0)}}}},E=function(){let e=null,t=null;return{destroy:()=>e&&e.destroy(),render:(s,i,r,A)=>{const o=Math.floor(r.numSamples);if(t!==o){e&&e.destroy();const s=Ke(),i=s.programVariables,r=i.createUniform("mat4","uProjectMatrix"),A=i.createUniform("mat4","uInvProjMatrix"),a=i.createUniform("bool","uPerspective"),l=i.createUniform("float","uScale"),c=i.createUniform("float","uIntensity"),h=i.createUniform("float","uBias"),u=i.createUniform("float","uKernelRadius"),d=i.createUniform("float","uMinResolution"),p=i.createUniform("float","uRandomSeed"),f=M(n,"SAOOcclusionRenderer",s,((e,t,s,i,n,f)=>`\n                                #define EPSILON 1e-6\n                                #define PI 3.14159265359\n                                #define PI2 6.28318530718\n                                #define NUM_SAMPLES ${o}\n                                #define NUM_RINGS 4\n\n                                const vec3 packFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\n                                vec4 packFloatToRGBA(const in float v) {\n                                    vec4 r = vec4(fract(v * packFactors), v);\n                                    r.yzw -= r.xyz / 256.;\n                                    return r * 256. / 255.;\n                                }\n\n                                highp float rand(const in vec2 uv) {\n                                    const highp float a = 12.9898, b = 78.233, c = 43758.5453;\n                                    return fract(sin(mod(dot(uv, vec2(a, b)), PI)) * c);\n                                }\n\n                                vec3 getViewPos(const in vec2 screenPos, const in float depth) {\n                                    float near = ${i};\n                                    float far  = ${n};\n                                    float viewZ = (${a}\n                                                   ? ((near * far) / ((far - near) * depth - far))\n                                                   : (depth * (near - far) - near));\n                                    float clipW = ${r}[2][3] * viewZ + ${r}[3][3];\n                                    return (${A} * (clipW * vec4((vec3(screenPos, depth) - 0.5) * 2.0, 1.0))).xyz;\n                                }\n\n                                vec4 ${e}() {\n                                    float centerDepth = ${f}(${t});\n                                    if (centerDepth >= (1.0 - EPSILON)) {\n                                        discard;\n                                    }\n\n                                    vec3 centerViewPosition = getViewPos(${t}, centerDepth);\n                                    float scaleDividedByCameraFar = ${l} / ${n};\n                                    float minResolutionMultipliedByCameraFar = ${d} * ${n};\n                                    vec3 centerViewNormal = normalize(cross(dFdx(centerViewPosition), dFdy(centerViewPosition)));\n\n                                    vec2 radiusStep = ${u} * ${s} / float(NUM_SAMPLES);\n                                    vec2 radius = radiusStep;\n                                    const float angleStep = PI2 * float(NUM_RINGS) / float(NUM_SAMPLES);\n                                    float angle = PI2 * rand(${t} + ${p});\n\n                                    float occlusionSum = 0.0;\n                                    float weightSum = 0.0;\n\n                                    for (int i = 0; i < NUM_SAMPLES; i++) {\n                                        vec2 sampleUv = ${t} + vec2(cos(angle), sin(angle)) * radius;\n                                        radius += radiusStep;\n                                        angle += angleStep;\n\n                                        float sampleDepth = ${f}(sampleUv);\n                                        if (sampleDepth >= (1.0 - EPSILON)) {\n                                            continue;\n                                        }\n\n                                        vec3 sampleViewPosition = getViewPos(sampleUv, sampleDepth);\n                                        vec3 viewDelta = sampleViewPosition - centerViewPosition;\n                                        float scaledScreenDistance = scaleDividedByCameraFar * length(viewDelta);\n                                        occlusionSum += max(0.0, (dot(centerViewNormal, viewDelta) - minResolutionMultipliedByCameraFar) / scaledScreenDistance - ${h}) / (1.0 + scaledScreenDistance * scaledScreenDistance );\n                                        weightSum += 1.0;\n                                    }\n\n                                    return packFloatToRGBA(1.0 - occlusionSum * ${c} / weightSum);\n                                }`));e={destroy:f.destroy,render:(e,t,s,i)=>{f.bind(e,t,i),r.setInputValue(t.matrix),A.setInputValue(t.inverseMatrix),a.setInputValue("Perspective"===t.type),l.setInputValue(s.scale*t.far/5),c.setInputValue(s.intensity),h.setInputValue(s.bias),u.setInputValue(s.kernelRadius),d.setInputValue(s.minResolution),p.setInputValue(Math.random()),f.draw()}},t=o}e.render(s,i,r,A)}}}(),F=function(){const e=e=>{const t=[];for(let s=0;s<=17;s++)t.push(e[0]*s),t.push(e[1]*s);return new Float32Array(t)},t=e([0,1]),s=e([1,0]),i=new Float32Array((e=>{const t=[];for(let s=0;s<e;++s)t.push(s);return t})(17).map((e=>((e,t)=>Math.exp(-e*e/(t*t*2))/(Math.sqrt(2*Math.PI)*t))(e,4)))),r=Ke(),A=r.programVariables,o=A.createUniform("float","uDepthCutoff"),a=A.createUniformArray("vec2","uSampleOffsets",17),l=A.createUniformArray("float","uSampleWeights",17),c=A.createUniform("sampler2D","uOcclusionTex"),h=M(n,"SAODepthLimitedBlurRenderer",r,((e,t,s,i,r,n)=>`\n                    #define EPSILON 1e-6\n\n                    const vec3 packFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\n                    vec4 packFloatToRGBA(const in float v) {\n                        vec4 r = vec4(fract(v * packFactors), v);\n                        r.yzw -= r.xyz / 256.;\n                        return r * 256. / 255.;\n                    }\n\n                    float getOcclusion(const in vec2 uv) {\n                        vec4 v = texture(${c}, uv);\n                        return dot(floor(v * 255.0 + 0.5) / 255.0, 255. / 256. / vec4(packFactors, 1.)); // unpackRGBAToFloat\n                    }\n\n                    float getViewZ(const in float depth) {\n                        return (${i} * ${r}) / ((${r} - ${i}) * depth - ${r});\n                    }\n\n                    vec4 ${e}() {\n                        float centerDepth = ${n}(${t});\n                        if (centerDepth >= (1.0 - EPSILON)) {\n                            discard;\n                        }\n\n                        float centerViewZ = getViewZ(centerDepth);\n                        bool rBreak = false;\n                        bool lBreak = false;\n\n                        float weightSum = ${l}[0];\n                        float occlusionSum = getOcclusion(${t}) * weightSum;\n\n                        for (int i = 1; i <= 16; i++) {\n                            float sampleWeight = ${l}[i];\n                            vec2 sampleUVOffset = ${a}[i] * ${s};\n\n                            if (! rBreak) {\n                                vec2 rSampleUV = ${t} + sampleUVOffset;\n                                if (abs(centerViewZ - getViewZ(${n}(rSampleUV))) > ${o}) {\n                                    rBreak = true;\n                                } else {\n                                    occlusionSum += getOcclusion(rSampleUV) * sampleWeight;\n                                    weightSum += sampleWeight;\n                                }\n                            }\n\n                            if (! lBreak) {\n                                vec2 lSampleUV = ${t} - sampleUVOffset;\n                                if (abs(centerViewZ - getViewZ(${n}(lSampleUV))) > ${o}) {\n                                    lBreak = true;\n                                } else {\n                                    occlusionSum += getOcclusion(lSampleUV) * sampleWeight;\n                                    weightSum += sampleWeight;\n                                }\n                            }\n                        }\n\n                        return packFloatToRGBA(occlusionSum / weightSum);\n                    }`));return{destroy:h.destroy,render:(e,r,n,A,u)=>{h.bind(e,r,A),o.setInputValue(.01),a.setInputValue(0===n?s:t),l.setInputValue(i),c.setInputValue(u),h.draw()}}}(),x=function(){let e=null;return function(){if(!e){const s=t.camera;e={get eye(){return s.eye},get far(){return s.project.far},get projMatrix(){return s.projMatrix},get viewMatrix(){return s.viewMatrix},get viewNormalMatrix(){return s.viewNormalMatrix}}}return e}}(),U=(e,t)=>"ortho"===e.projection?1:t/(2*Math.tan(.5*e.perspective.fov*Math.PI/180));function I(){if(g&&(Object.values(l).forEach((e=>{const t=e.drawableListPreCull;let s=0;Object.values(e.drawableMap).forEach((e=>{t[s++]=e})),t.length=s})),g=!1,m=!0),m){let e=0;Object.values(l).forEach((t=>{t.drawableListPreCull.forEach((t=>{u[e++]=t}))})),u.length=e,u.sort(((e,t)=>e.renderOrder-t.renderOrder)),m=!1,_=!0}if(_){let e=0,t=0;u.forEach((s=>{s.rebuildRenderFlags(),s.renderFlags.culled||(s.isUI?f[t++]=s:d[e++]=s)})),d.length=e,f.length=t}}this.scene=t,this._occlusionTester=null,this.capabilities={astcSupported:!!Bt(n,"WEBGL_compressed_texture_astc"),etc1Supported:!0,etc2Supported:!!Bt(n,"WEBGL_compressed_texture_etc"),dxtSupported:!!Bt(n,"WEBGL_compressed_texture_s3tc"),bptcSupported:!!Bt(n,"EXT_texture_compression_bptc"),pvrtcSupported:!(!Bt(n,"WEBGL_compressed_texture_pvrtc")&&!Bt(n,"WEBKIT_WEBGL_compressed_texture_pvrtc"))},this.setTransparentEnabled=function(e){b=e,_=!0},this.setEdgesEnabled=function(e){B=e,_=!0},this.setSAOEnabled=function(e){y=e,_=!0},this.setPBREnabled=function(e){w=e,_=!0},this.setColorTextureEnabled=function(e){v=e,_=!0},this.needStateSort=function(){m=!0},this.shadowsDirty=function(){},this.imageDirty=function(){_=!0},this.addDrawable=function(e,t){const s=t.type;if(!s)return void console.error("Renderer#addDrawable() : drawable with ID "+e+" has no 'type' - ignoring");let i=l[s];i||(i={type:t.type,count:0,isStateSortable:t.isStateSortable,stateSortCompare:t.stateSortCompare,drawableMap:{},drawableListPreCull:[],drawableList:[]},l[s]=i),i.count++,i.drawableMap[e]=t,c[e]=t,g=!0},this.removeDrawable=function(e){const t=c[e];if(!t)return void console.error("Renderer#removeDrawable() : drawable not found with ID "+e+" - ignoring");const s=t.type,i=l[s];--i.count<=0?delete l[s]:delete i.drawableMap[e],delete c[e],g=!0},this.getPickID=function(e){return a.addItem(e)},this.putPickID=function(e){a.removeItem(e)},this.clear=function(e){if(n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),A)n.clearColor(1,1,1,1);else{const e=t.canvas.backgroundColorFromAmbientLight?this.lights.getAmbientColorAndIntensity():t.canvas.backgroundColor;n.clearColor(e[0],e[1],e[2],1)}n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)},this.needsRender=function(){return _||g||m},this.render=function(e,s){I(),_&&(!function(e,s){const r=t.sao,a=y&&r.possible&&r.numSamples>=1&&function(e){const s=t.sao,r=[n.drawingBufferWidth,n.drawingBufferHeight],A=C.getRenderBuffer("saoDepth",[],!0);A.setSize(r),A.bind(),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),i.reset(),i.pass=e,i.viewParams=x(),i.nearPlaneHeight=U(t.camera,n.drawingBufferHeight),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.clearColor(0,0,0,0),n.enable(n.DEPTH_TEST),n.frontFace(n.CCW),n.enable(n.CULL_FACE),n.depthMask(!0),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),d.forEach((e=>{!e.culled&&e.visible&&e.drawDepth&&e.saoEnabled&&e.renderFlags.colorOpaque&&e.drawDepth(i)})),A.unbind();const o=A.depthTexture,a=C.getRenderBuffer("saoOcclusion");if(a.setSize(r),a.bind(),n.viewport(0,0,r[0],r[1]),n.clearColor(0,0,0,1),n.disable(n.DEPTH_TEST),n.disable(n.BLEND),n.frontFace(n.CCW),n.clear(n.COLOR_BUFFER_BIT),E.render(r,t.camera.project,s,o),a.unbind(),s.blur){const e=C.getRenderBuffer("saoOcclusion2");e.setSize(r);const s=(e,s,i)=>{s.bind(),n.viewport(0,0,r[0],r[1]),n.clearColor(0,0,0,1),n.enable(n.DEPTH_TEST),n.disable(n.BLEND),n.frontFace(n.CCW),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);const A=t.camera.project;F.render(r,A,i,o,e.colorTextures[0]),s.unbind()};s(a,e,0),s(e,a,1)}return a.colorTextures[0]}(e);t._lightsState.lights.forEach((e=>{if(e.castsShadow){const s=e.getShadowRenderBuf();s.bind(),i.reset(),i.backfaces=!0,i.frontface=!0,i.viewParams.viewMatrix=e.getShadowViewMatrix(),i.viewParams.projMatrix=e.getShadowProjMatrix(),i.nearPlaneHeight=U(t.camera,n.drawingBufferHeight),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.clearColor(0,0,0,1),n.enable(n.DEPTH_TEST),n.disable(n.BLEND),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),Object.values(l).forEach((e=>{e.drawableList.forEach((e=>{!1!==e.visible&&e.castsShadow&&e.drawShadow&&e.renderFlags.colorOpaque&&e.drawShadow(i)}))})),s.unbind()}})),function(e,s,r){const a=[],l=[],c=[],u=[],g=[],m=[],_=[],y=[],C=[],M=[],E=[],F=[],I=[],T=[],P=[],S=[],D=t._lightsState.getAmbientColorAndIntensity();if(i.reset(),i.pass=e,i.withSAO=!1,i.pbrEnabled=w&&!!t.pbrEnabled,i.colorTextureEnabled=v&&!!t.colorTextureEnabled,i.viewParams=x(),i.nearPlaneHeight=U(t.camera,n.drawingBufferHeight),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),A)n.clearColor(0,0,0,0);else{const e=t.canvas.backgroundColorFromAmbientLight?D:t.canvas.backgroundColor;n.clearColor(e[0],e[1],e[2],1)}let k,Q;n.enable(n.DEPTH_TEST),n.frontFace(n.CCW),n.enable(n.CULL_FACE),n.depthMask(!0),n.lineWidth(1),i.lineWidth=1,t.sao,i.saoParams=[n.drawingBufferWidth,n.drawingBufferHeight,t.sao.blendCutoff,t.sao.blendFactor],i.occlusionTexture=r;const R=Date.now();s&&n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);const O=function(e){let s=0,d=0,p=0,f=0,w=0,v=0,x=0,U=0,D=0,R=0,O=0,V=0,L=0,H=0,N=0,G=0;for(let t=0,n=e.length;t<n;t++){if(Q=e[t],!0===Q.culled||!1===Q.visible)continue;const n=Q.renderFlags;n.colorOpaque&&(Q.saoEnabled&&r?a[s++]=Q:Q.drawColorOpaque(i)),b&&n.colorTransparent&&(c[p++]=Q),n.xrayedSilhouetteTransparent&&(_[x++]=Q),n.xrayedSilhouetteOpaque&&(g[w++]=Q),n.highlightedSilhouetteTransparent&&(E[O++]=Q),n.highlightedSilhouetteOpaque&&(C[D++]=Q),n.selectedSilhouetteTransparent&&(P[N++]=Q),n.selectedSilhouetteOpaque&&(I[L++]=Q),Q.edges&&B&&(n.edgesOpaque&&(l[d++]=Q),n.edgesTransparent&&(u[f++]=Q),n.selectedEdgesTransparent&&(S[G++]=Q),n.selectedEdgesOpaque&&(T[H++]=Q),n.xrayedEdgesTransparent&&(y[U++]=Q),n.xrayedEdgesOpaque&&(m[v++]=Q),n.highlightedEdgesTransparent&&(F[V++]=Q),n.highlightedEdgesOpaque&&(M[R++]=Q))}if(s>0)for(i.withSAO=!0,k=0;k<s;k++)a[k].drawColorOpaque(i);if(d>0)for(k=0;k<d;k++)l[k].drawEdgesColorOpaque(i);if(w>0)for(k=0;k<w;k++)g[k].drawSilhouetteXRayed(i);if(v>0)for(k=0;k<v;k++)m[k].drawEdgesXRayed(i);if(x>0||U>0||p>0||f>0){if(n.enable(n.CULL_FACE),n.enable(n.BLEND),A?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):(n.blendEquation(n.FUNC_ADD),n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)),i.backfaces=!1,o||n.depthMask(!1),(p>0||f>0)&&n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),f>0)for(k=0;k<f;k++)Q=u[k],Q.drawEdgesColorTransparent(i);if(p>0){const e=i.viewParams.eye;c.length=p;const t=c.map((t=>({drawable:t,distSq:h.distVec3(t.origin||tn,e)})));for(t.sort(((e,t)=>t.distSq-e.distSq)),k=0;k<p;k++)t[k].drawable.drawColorTransparent(i)}if(U>0)for(k=0;k<U;k++)y[k].drawEdgesXRayed(i);if(x>0)for(k=0;k<x;k++)_[k].drawSilhouetteXRayed(i);n.disable(n.BLEND),o||n.depthMask(!0)}if(D>0||R>0){if(i.lastProgramId=null,t.highlightMaterial.glowThrough&&n.clear(n.DEPTH_BUFFER_BIT),R>0)for(k=0;k<R;k++)M[k].drawEdgesHighlighted(i);if(D>0)for(k=0;k<D;k++)C[k].drawSilhouetteHighlighted(i)}if(O>0||V>0||D>0){if(i.lastProgramId=null,t.selectedMaterial.glowThrough&&n.clear(n.DEPTH_BUFFER_BIT),n.enable(n.BLEND),A?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),n.enable(n.CULL_FACE),V>0)for(k=0;k<V;k++)F[k].drawEdgesHighlighted(i);if(O>0)for(k=0;k<O;k++)E[k].drawSilhouetteHighlighted(i);n.disable(n.BLEND)}if(L>0||H>0){if(i.lastProgramId=null,t.selectedMaterial.glowThrough&&n.clear(n.DEPTH_BUFFER_BIT),H>0)for(k=0;k<H;k++)T[k].drawEdgesSelected(i);if(L>0)for(k=0;k<L;k++)I[k].drawSilhouetteSelected(i)}if(N>0||G>0){if(i.lastProgramId=null,t.selectedMaterial.glowThrough&&n.clear(n.DEPTH_BUFFER_BIT),n.enable(n.CULL_FACE),n.enable(n.BLEND),A?(n.blendEquation(n.FUNC_ADD),n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA)):n.blendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA),G>0)for(k=0;k<G;k++)S[k].drawEdgesSelected(i);if(N>0)for(k=0;k<N;k++)P[k].drawSilhouetteSelected(i);n.disable(n.BLEND)}};O(d),f.length>0&&(n.clear(n.DEPTH_BUFFER_BIT),O(f));const V=Date.now(),L=p.frame;L.renderTime=(V-R)/1e3,L.drawElements=i.drawElements,L.drawArrays=i.drawArrays,L.useProgram=i.useProgram,L.bindTexture=i.bindTexture,L.bindArray=i.bindArray;const H=Jr.MAX_TEXTURE_IMAGE_UNITS;for(let e=0;e<H;e++)n.activeTexture(n.TEXTURE0+e);n.bindTexture(n.TEXTURE_CUBE_MAP,null),n.bindTexture(n.TEXTURE_2D,null);const N=Jr.MAX_VERTEX_ATTRIBS;for(let e=0;e<N;e++)n.disableVertexAttribArray(e)}(e,s,a)}(e,s),p.frame.frameCount++,_=!1)};const T=(e,s,i,r,A,o,a)=>{a.reset(),a.backfaces=!0,a.frontface=!0,a.viewParams.eye=r,a.viewParams.projMatrix=A,a.viewParams.viewMatrix=o,a.nearPlaneHeight=U(i,n.drawingBufferHeight);const l=t.canvas.resolutionScale;a.pickClipPos=[e?2*e[0]*l/n.drawingBufferWidth-1:0,e?1-2*e[1]*l/n.drawingBufferHeight:0],a.pickClipPosInv=[n.drawingBufferWidth/s,n.drawingBufferHeight/s]};this.pick=function(){const e=h.vec3(),s=h.vec3(),A=h.vec4(),o=h.vec4(),l=h.vec4(),c=h.vec4(),u=h.vec4(),p=h.mat4(),g=h.mat4(),m=h.mat4(),_=h.mat4(),b=h.vec3([0,1,0]),B=new Gr,y=h.vec2(),w=h.vec3(),v=h.vec3(),C=h.vec3();h.vec3(),h.vec3();const M=new vr(n);M.setSize([1,1]);const E=new vr(n,[n.RGBA32I]);return E.setSize([3,3]),function(F,x=B){x.reset(),I();let U=null,P=null,S=null;const D=t.camera;if(x.pickSurface=F.pickSurface,F.canvasPos)w[0]=F.canvasPos[0],w[1]=F.canvasPos[1],U=D.viewMatrix,P=D.projMatrix,S=D.projection,y[0]=D.project.near,y[1]=D.project.far,x.canvasPos=F.canvasPos;else{if(F.matrix)U=F.matrix,P=D.projMatrix,S=D.projection,y[0]=D.project.near,y[1]=D.project.far;else{v.set(F.origin||[0,0,0]),C.set(F.direction||[0,0,1]);const t=h.addVec3(v,C,e),i=s;Math.abs(h.dotVec3(C,b))>.999999?(i[0]=0,i[1]=0,i[2]=Math.sign(C[1])):(h.cross3Vec3(C,b,i),h.cross3Vec3(i,C,i),h.normalizeVec3(i,i)),U=h.lookAtMat4v(v,t,i,g),P=D.ortho.matrix,S="ortho",y[0]=D.ortho.near,y[1]=D.ortho.far,x.origin=v,x.direction=C}w[0]=.5*r.clientWidth,w[1]=.5*r.clientHeight}M.bind();const k=e=>T(w,e,D,x.origin||D.eye,P||D.projMatrix,U||D.viewMatrix,i);k(1),i.pickInvisible=!!F.pickInvisible,n.viewport(0,0,1,1),n.depthMask(!0),n.enable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.disable(n.BLEND),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT);const Q=F.includeEntityIds,R=F.excludeEntityIds,O=function(e){e.forEach((e=>{e.culled||!e.visible||!e.pickable||!e.drawPickMesh||Q&&!Q[e.id]||R&&R[e.id]||e.drawPickMesh(i)}))};O(d),f.length>0&&(n.clear(n.DEPTH_BUFFER_BIT),O(f));const V=rn(M.read(0,0)),L=V>=0&&a.items[V];if(!L)return M.unbind(),null;const H=L.delegatePickedEntity?L.delegatePickedEntity():L;if(!H)return M.unbind(),null;if(F.pickSurface)if(L.canPickTriangle&&L.canPickTriangle())L.drawPickTriangles&&(k(1),n.viewport(0,0,1,1),n.clearColor(0,0,0,0),n.enable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.disable(n.BLEND),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),L.drawPickTriangles(i),x.primIndex=3*rn(M.read(0,0))),L.pickTriangleSurface(U,P,S,x),x.pickSurfacePrecision=!1;else if(L.canPickWorldPos&&L.canPickWorldPos()){k(1),i.viewParams.near=y[0],i.viewParams.far=y[1],n.viewport(0,0,1,1),n.clearColor(0,0,0,0),n.depthMask(!0),n.enable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.disable(n.BLEND),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),L.drawPickDepths(i);const e=h.dotVec4(M.read(0,0),sn),t=(w[0]-r.clientWidth/2)/(r.clientWidth/2),s=-(w[1]-r.clientHeight/2)/(r.clientHeight/2),a=L.origin,d=h.inverseMat4(h.mulMat4(P,a?He(U,a,p):U,m),_),f=(e,i)=>(i[0]=t,i[1]=s,i[2]=e,i[3]=1,h.transformVec4(d,i,i),h.mulVec4Scalar(i,1/i[3])),g=f(-1,A),b=f(1,o),B=h.subVec3(b,g,l),v=h.addVec3(g,h.mulVec4Scalar(B,e,c),u);if(a&&h.addVec3(v,a),x.worldPos=v,!1!==F.pickSurfaceNormal){k(3),E.bind(),n.viewport(0,0,E.size[0],E.size[1]),n.enable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.disable(n.BLEND),n.clear(n.DEPTH_BUFFER_BIT),n.clearBufferiv(n.COLOR,0,new Int32Array([0,0,0,0])),L.drawPickNormals(i);const e=E.read(1,1,n.RGBA_INTEGER,n.INT,Int32Array,4);E.unbind(),x.worldNormal=nn(e)}x.pickSurfacePrecision=!1}return M.unbind(),x.entity=H,x}}(),this.snapPick=function(){const e=new Gr,s=function(){const e={};return t=>{if(!(t in e)){const s=new vr(n,[n.RGBA32I,n.RGBA32I,n.RGBA8UI],!0);s.setSize([2*t+1,2*t+1]),e[t]=s}return e[t]}}();return function(r,A=e){const{canvasPos:o,origin:l,direction:c,snapRadius:u,snapToVertex:p,snapToEdge:f}=r;if(!p&&!f)return this.pick({canvasPos:o,pickSurface:!0});const g=t.camera,m=u||30,_=o?g.viewMatrix:h.lookAtMat4v(l,h.addVec3(l,c,h.vec3()),h.vec3([0,1,0]),h.mat4());T(o,2*m,g,g.eye,g.projMatrix,_,i);const b=s(m);b.bind(),n.viewport(0,0,b.size[0],b.size[1]),n.enable(n.DEPTH_TEST),n.frontFace(n.CCW),n.disable(n.CULL_FACE),n.depthMask(!0),n.disable(n.BLEND),n.depthFunc(n.LEQUAL),n.clear(n.DEPTH_BUFFER_BIT),n.clearBufferiv(n.COLOR,0,new Int32Array([0,0,0,0])),n.clearBufferiv(n.COLOR,1,new Int32Array([0,0,0,0])),n.clearBufferuiv(n.COLOR,2,new Uint32Array([0,0,0,0])),n.drawBuffers([n.COLOR_ATTACHMENT0,n.COLOR_ATTACHMENT1,n.COLOR_ATTACHMENT2]),i.snapPickLayerParams=[],i.snapPickLayerParams.push(null),d.forEach((e=>{!e.culled&&e.visible&&e.pickable&&e.drawSnapInit&&e.drawSnapInit(i)}));const B=i.snapPickLayerParams;i.snapPickLayerParams=[],n.depthMask(!1),n.drawBuffers([n.COLOR_ATTACHMENT0]);const y=e=>{i.snapMode=e,i.snapPickLayerParams.push(null),d.forEach((e=>{!e.culled&&e.visible&&e.pickable&&e.drawSnap&&e.drawSnap(i)}))};f&&y("edge"),p&&y("vertex"),n.depthMask(!0);const w=i.snapPickLayerParams,v=(e,t,s)=>{const i=b.buffer.width,r=b.buffer.height,A=new t(4*i*r);return n.readBuffer(e),n.readPixels(0,0,i,r,n.RGBA_INTEGER,s,A,0),A},C=v(n.COLOR_ATTACHMENT0,Int32Array,n.INT),M=v(n.COLOR_ATTACHMENT1,Int32Array,n.INT),E=v(n.COLOR_ATTACHMENT2,Uint32Array,n.UNSIGNED_INT);b.unbind();let F=null,x=null,U=null;const I=4*m+m*b.size[0]*4,P=C.slice(I,I+4),S=M.slice(I,I+4),D=E.slice(I,I+4);if(0!==P[3]){const e=B[Math.abs(P[3])%B.length];F=An(P,e.origin,e.coordinateScale),x=nn(S),U=a.items[rn(D)]}const k=[];for(let e=0;e<C.length;e+=4){const t=C[e+3];if(t>0){const s=Math.floor(e/4),i=b.size[0],r=s%i-Math.floor(i/2),n=Math.floor(s/i)-Math.floor(i/2);k.push({dist:h.lenVec2([r,n]),isVertex:p&&f?t>w.length/2:p,result:C.subarray(e,e+4),normal:M.subarray(e,e+4),id:E.subarray(e,e+4)})}}const Q=e=>e&&e.delegatePickedEntity?e.delegatePickedEntity():e;if(k.length>0){const e=k.reduce(((e,t)=>(e.isVertex-t.isVertex||t.dist-e.dist)>0?e:t)),t=e.result,s=w[t[3]],i=An(t,s.origin,s.coordinateScale),r=g.projectWorldPos(i);return A.reset(),A.snappedToEdge=!e.isVertex,A.snappedToVertex=e.isVertex,A.worldPos=i,A.worldNormal=nn(e.normal),A.entity=Q(a.items[rn(e.id)]),A.canvasPos=o||F&&g.projectWorldPos(F)||r,A.snappedCanvasPos=r,A}return F?(A.reset(),A.snappedToEdge=!1,A.snappedToVertex=!1,A.worldPos=F,A.worldNormal=x,A.entity=Q(U),A.canvasPos=o||g.projectWorldPos(F),A.snappedCanvasPos=o,A):null}}(),this.addMarker=function(e){this._occlusionTester=this._occlusionTester||new en(t),this._occlusionTester.addMarker(e),t.occlusionTestCountdown=0},this.markerWorldPosUpdated=function(e){this._occlusionTester.markerWorldPosUpdated(e)},this.removeMarker=function(e){this._occlusionTester.removeMarker(e)},this.doOcclusionTest=function(){if(this._occlusionTester&&this._occlusionTester.needOcclusionTest){I();const e=C.getRenderBuffer("occlusionReadPix");if(e&&(e.setSize([n.drawingBufferWidth,n.drawingBufferHeight]),e.bind()),i.reset(),i.backfaces=!0,i.frontface=!0,i.viewParams=x(),i.nearPlaneHeight=U(t.camera,n.drawingBufferHeight),n.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),n.clearColor(0,0,0,0),n.enable(n.DEPTH_TEST),n.disable(n.CULL_FACE),n.disable(n.BLEND),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),d.forEach((e=>{!e.culled&&e.visible&&e.pickable&&e.drawOcclusion&&e.drawOcclusion(i)})),this._occlusionTester.drawMarkers(),e){const s=t.canvas.resolutionScale;this._occlusionTester.doOcclusionTest(((t,i)=>e.read(Math.round(s*t),Math.round(s*i)))),e.unbind()}}},this.snapshot=(()=>{let e=!1;const t=new vr(n);let s=null;return{readPixels:(e,s,i)=>{t.bind(),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),_=!0,this.render();for(let r=0;r<i;r++){const i=2*r,n=4*r,A=t.read(e[i],e[i+1]);s[n]=A[0],s[n+1]=A[1],s[n+2]=A[2],s[n+3]=A[3]}t.unbind(),_=!0},beginSnapshot:()=>{t.setSize([n.drawingBufferWidth,n.drawingBufferHeight]),t.bind(),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),e=!0},renderSnapshotToCanvas:()=>{const i=t.buffer.width,r=t.buffer.height;return s&&s.width===i&&s.height===r||(s=function(){const e=document.createElement("canvas"),t=e.getContext("2d");e.width=i,e.height=r;const s=new Uint8Array(i*r*4),A=t.createImageData(i,r);return{width:i,height:r,getUpdatedCanvas:()=>{n.readPixels(0,0,i,r,n.RGBA,n.UNSIGNED_BYTE,s);const o=Math.floor(r/2),a=4*i,l=new Uint8Array(a);for(let e=0;e<o;++e){const t=e*a,i=(r-e-1)*a;l.set(s.subarray(t,t+a)),s.copyWithin(t,i,i+a),s.set(l,i)}return A.data.set(s),t.resetTransform(),t.putImageData(A,0,0),e}}}()),e&&(n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),_=!0,this.render(),_=!0),s.getUpdatedCanvas()},endSnapshot:()=>{e&&(t.unbind(),e=!1),_=!0,this.render()}}})(),this.destroy=function(){l={},c={},C.destroy(),E.destroy(),F.destroy(),this._occlusionTester&&this._occlusionTester.destroy()}};class an extends T{constructor(e,t={}){super(e,t),this.KEY_BACKSPACE=8,this.KEY_TAB=9,this.KEY_ENTER=13,this.KEY_SHIFT=16,this.KEY_CTRL=17,this.KEY_ALT=18,this.KEY_PAUSE_BREAK=19,this.KEY_CAPS_LOCK=20,this.KEY_ESCAPE=27,this.KEY_PAGE_UP=33,this.KEY_PAGE_DOWN=34,this.KEY_END=35,this.KEY_HOME=36,this.KEY_LEFT_ARROW=37,this.KEY_UP_ARROW=38,this.KEY_RIGHT_ARROW=39,this.KEY_DOWN_ARROW=40,this.KEY_INSERT=45,this.KEY_DELETE=46,this.KEY_NUM_0=48,this.KEY_NUM_1=49,this.KEY_NUM_2=50,this.KEY_NUM_3=51,this.KEY_NUM_4=52,this.KEY_NUM_5=53,this.KEY_NUM_6=54,this.KEY_NUM_7=55,this.KEY_NUM_8=56,this.KEY_NUM_9=57,this.KEY_A=65,this.KEY_B=66,this.KEY_C=67,this.KEY_D=68,this.KEY_E=69,this.KEY_F=70,this.KEY_G=71,this.KEY_H=72,this.KEY_I=73,this.KEY_J=74,this.KEY_K=75,this.KEY_L=76,this.KEY_M=77,this.KEY_N=78,this.KEY_O=79,this.KEY_P=80,this.KEY_Q=81,this.KEY_R=82,this.KEY_S=83,this.KEY_T=84,this.KEY_U=85,this.KEY_V=86,this.KEY_W=87,this.KEY_X=88,this.KEY_Y=89,this.KEY_Z=90,this.KEY_LEFT_WINDOW=91,this.KEY_RIGHT_WINDOW=92,this.KEY_SELECT_KEY=93,this.KEY_NUMPAD_0=96,this.KEY_NUMPAD_1=97,this.KEY_NUMPAD_2=98,this.KEY_NUMPAD_3=99,this.KEY_NUMPAD_4=100,this.KEY_NUMPAD_5=101,this.KEY_NUMPAD_6=102,this.KEY_NUMPAD_7=103,this.KEY_NUMPAD_8=104,this.KEY_NUMPAD_9=105,this.KEY_MULTIPLY=106,this.KEY_ADD=107,this.KEY_SUBTRACT=109,this.KEY_DECIMAL_POINT=110,this.KEY_DIVIDE=111,this.KEY_F1=112,this.KEY_F2=113,this.KEY_F3=114,this.KEY_F4=115,this.KEY_F5=116,this.KEY_F6=117,this.KEY_F7=118,this.KEY_F8=119,this.KEY_F9=120,this.KEY_F10=121,this.KEY_F11=122,this.KEY_F12=123,this.KEY_NUM_LOCK=144,this.KEY_SCROLL_LOCK=145,this.KEY_SEMI_COLON=186,this.KEY_EQUAL_SIGN=187,this.KEY_COMMA=188,this.KEY_DASH=189,this.KEY_PERIOD=190,this.KEY_FORWARD_SLASH=191,this.KEY_GRAVE_ACCENT=192,this.KEY_OPEN_BRACKET=219,this.KEY_BACK_SLASH=220,this.KEY_CLOSE_BRACKET=221,this.KEY_SINGLE_QUOTE=222,this.KEY_SPACE=32,this.MOUSE_LEFT_BUTTON=260,this.MOUSE_MIDDLE_BUTTON=261,this.MOUSE_RIGHT_BUTTON=262,this.element=t.element,this.altDown=!1,this.ctrlDown=!1,this.mouseDownLeft=!1,this.mouseDownMiddle=!1,this.mouseDownRight=!1,this.keyDown=[],this.enabled=!0,this.keyboardEnabled=!0,this.mouseover=!1,this.mouseCanvasPos=h.vec2(),this._keyboardEventsElement=t.keyboardEventsElement||document,this._bindEvents()}_bindEvents(){if(this._eventsBound)return;this._keyboardEventsElement.addEventListener("keydown",this._keyDownListener=e=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.keyCode===this.KEY_CTRL?this.ctrlDown=!0:e.keyCode===this.KEY_ALT?this.altDown=!0:e.keyCode===this.KEY_SHIFT&&(this.shiftDown=!0),this.keyDown[e.keyCode]=!0,this.fire("keydown",e.keyCode,!0))},!1),this._keyboardEventsElement.addEventListener("keyup",this._keyUpListener=e=>{this.enabled&&this.keyboardEnabled&&"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&(e.keyCode===this.KEY_CTRL?this.ctrlDown=!1:e.keyCode===this.KEY_ALT?this.altDown=!1:e.keyCode===this.KEY_SHIFT&&(this.shiftDown=!1),this.keyDown[e.keyCode]=!1,this.fire("keyup",e.keyCode,!0))}),this.element.addEventListener("mouseenter",this._mouseEnterListener=e=>{this.enabled&&(this.mouseover=!0,this._getMouseCanvasPos(e),this.fire("mouseenter",this.mouseCanvasPos,!0))}),this.element.addEventListener("mouseleave",this._mouseLeaveListener=e=>{this.enabled&&(this.mouseover=!1,this._getMouseCanvasPos(e),this.fire("mouseleave",this.mouseCanvasPos,!0))}),this.element.addEventListener("mousedown",this._mouseDownListener=e=>{if(this.enabled){switch(e.which){case 1:this.mouseDownLeft=!0;break;case 2:this.mouseDownMiddle=!0;break;case 3:this.mouseDownRight=!0}this._getMouseCanvasPos(e),this.element.focus(),this.fire("mousedown",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),document.addEventListener("mouseup",this._mouseUpListener=e=>{if(this.enabled){switch(e.which){case 1:this.mouseDownLeft=!1;break;case 2:this.mouseDownMiddle=!1;break;case 3:this.mouseDownRight=!1}this.fire("mouseup",this.mouseCanvasPos,!0)}},!0),document.addEventListener("click",this._clickListener=e=>{if(this.enabled){switch(e.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(e),this.fire("click",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}}),document.addEventListener("dblclick",this._dblClickListener=e=>{if(this.enabled){switch(e.which){case 1:case 3:this.mouseDownLeft=!1,this.mouseDownRight=!1;break;case 2:this.mouseDownMiddle=!1}this._getMouseCanvasPos(e),this.fire("dblclick",this.mouseCanvasPos,!0),this.mouseover&&e.preventDefault()}});const e=this.scene.tickify((()=>this.fire("mousemove",this.mouseCanvasPos,!0)));this.element.addEventListener("mousemove",this._mouseMoveListener=t=>{this.enabled&&(this._getMouseCanvasPos(t),e(),this.mouseover&&t.preventDefault())}),this.element.addEventListener("contextmenu",this._contextmenuListener=e=>{this.enabled&&(this._getMouseCanvasPos(e),this.fire("contextmenu",this.mouseCanvasPos,!0))});const t=this.scene.tickify((e=>{this.fire("mousewheel",e,!0)}));this.element.addEventListener("wheel",this._mouseWheelListener=(e,s)=>{if(!this.enabled)return;const i=Math.max(-1,Math.min(1,40*-e.deltaY));t(i)},{passive:!0});{let e,t;const s=2;this.on("mousedown",(s=>{e=s[0],t=s[1]})),this.on("mouseup",(i=>{e>=i[0]-s&&e<=i[0]+s&&t>=i[1]-s&&t<=i[1]+s&&this.fire("mouseclicked",i,!0)}))}this.element.addEventListener("touchstart",this._touchstartListener=e=>{this.enabled&&[...e.changedTouches].forEach((e=>{this.fire("touchstart",[e.identifier,this._getTouchCanvasPos(e)],!0)}))}),this.element.addEventListener("touchend",this._touchendListener=e=>{this.enabled&&[...e.changedTouches].forEach((e=>{this.fire("touchend",[e.identifier,this._getTouchCanvasPos(e)],!0)}))}),this._eventsBound=!0}_unbindEvents(){this._eventsBound&&(this._keyboardEventsElement.removeEventListener("keydown",this._keyDownListener),this._keyboardEventsElement.removeEventListener("keyup",this._keyUpListener),this.element.removeEventListener("mouseenter",this._mouseEnterListener),this.element.removeEventListener("mouseleave",this._mouseLeaveListener),this.element.removeEventListener("mousedown",this._mouseDownListener),document.removeEventListener("mouseup",this._mouseDownListener),document.removeEventListener("click",this._clickListener),document.removeEventListener("dblclick",this._dblClickListener),this.element.removeEventListener("mousemove",this._mouseMoveListener),this.element.removeEventListener("contextmenu",this._contextmenuListener),this.element.removeEventListener("wheel",this._mouseWheelListener),this.element.removeEventListener("touchstart",this._touchstartListener),this.element.removeEventListener("touchend",this._touchendListener),window.OrientationChangeEvent&&window.removeEventListener("orientationchange",this._orientationchangedListener),window.DeviceMotionEvent&&window.removeEventListener("devicemotion",this._deviceMotionListener),window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this._deviceOrientListener),this._eventsBound=!1)}_getTouchCanvasPos(e){let t=e.target,s=0,i=0;for(;t.offsetParent;)s+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;return[e.pageX-s,e.pageY-i]}_getMouseCanvasPos(e){if(e){const t=e.target.getBoundingClientRect();this.mouseCanvasPos[0]=e.clientX-t.left,this.mouseCanvasPos[1]=e.clientY-t.top}else e=window.event,this.mouseCanvasPos[0]=e.x,this.mouseCanvasPos[1]=e.y}setEnabled(e){this.enabled!==e&&this.fire("enabled",this.enabled=e)}getEnabled(){return this.enabled}setKeyboardEnabled(e){this.keyboardEnabled=e}getKeyboardEnabled(){return this.keyboardEnabled}destroy(){super.destroy(),this._unbindEvents()}}class ln extends T{get type(){return"Viewport"}constructor(e,t={}){super(e,t),this._state=new se({boundary:[0,0,100,100]}),this.boundary=t.boundary,this.autoBoundary=t.autoBoundary}set boundary(e){if(!this._autoBoundary){if(!e){const t=this.scene.canvas.boundary;e=[0,0,t[2],t[3]]}this._state.boundary=e,this.glRedraw(),this.fire("boundary",this._state.boundary)}}get boundary(){return this._state.boundary}set autoBoundary(e){(e=!!e)!==this._autoBoundary&&(this._autoBoundary=e,this._autoBoundary?this._onCanvasSize=this.scene.canvas.on("boundary",(function(e){const t=e[2],s=e[3];this._state.boundary=[0,0,t,s],this.glRedraw(),this.fire("boundary",this._state.boundary)}),this):this._onCanvasSize&&(this.scene.canvas.off(this._onCanvasSize),this._onCanvasSize=null),this.fire("autoBoundary",this._autoBoundary))}get autoBoundary(){return this._autoBoundary}_getState(){return this._state}destroy(){super.destroy(),this._state.destroy()}}class cn extends T{get type(){return"Perspective"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new se({matrix:h.mat4(),inverseMatrix:h.mat4(),transposedMatrix:h.mat4(),near:.1,far:1e4}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this._fov=60,this._canvasResized=this.scene.canvas.on("boundary",this._needUpdate,this),this.fov=t.fov,this.fovAxis=t.fovAxis,this.near=t.near,this.far=t.far}_update(){const e=this.scene.canvas.boundary,t=e[2]/e[3],s=this._fovAxis;let i=this._fov;("x"===s||"min"===s&&t<1||"max"===s&&t>1)&&(i/=t),i=Math.min(i,120),h.perspectiveMat4(i*(Math.PI/180),t,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.camera._updateScheduled=!0,this.fire("matrix",this._state.matrix)}set fov(e){(e=null!=e?e:60)!==this._fov&&(this._fov=e,this._needUpdate(0),this.fire("fov",this._fov))}get fov(){return this._fov}set fovAxis(e){e=e||"min",this._fovAxis!==e&&("x"!==e&&"y"!==e&&"min"!==e&&(this.error("Unsupported value for 'fovAxis': "+e+" - defaulting to 'min'"),e="min"),this._fovAxis=e,this._needUpdate(0),this.fire("fovAxis",this._fovAxis))}get fovAxis(){return this._fovAxis}set near(e){const t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(e){const t=null!=e?e:1e4;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(h.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(h.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const n=this.scene.canvas.canvas,A=n.offsetWidth/2,o=n.offsetHeight/2;return s[0]=(e[0]-A)/A,s[1]=(e[1]-o)/o,s[2]=t,s[3]=1,h.mulMat4v4(this.inverseMatrix,s,i),h.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,h.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._canvasResized)}}class hn extends T{get type(){return"Ortho"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new se({matrix:h.mat4(),inverseMatrix:h.mat4(),transposedMatrix:h.mat4(),near:.1,far:1e4}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.scale=t.scale,this.near=t.near,this.far=t.far,this._onCanvasBoundary=this.scene.canvas.on("boundary",this._needUpdate,this)}_update(){const e=this.scene,t=.5*this._scale,s=e.canvas.boundary,i=s[2],r=s[3],n=i/r;let A,o,a,l;i>r?(A=-t,o=t,a=t/n,l=-t/n):(A=-t*n,o=t*n,a=t,l=-t),h.orthoMat4c(A,o,l,a,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set scale(e){null==e&&(e=1),e<=0&&(e=.01),this._scale=e,this._needUpdate(0),this.fire("scale",this._scale)}get scale(){return this._scale}set near(e){const t=null!=e?e:.1;this._state.near!==t&&(this._state.near=t,this._needUpdate(0),this.fire("near",this._state.near))}get near(){return this._state.near}set far(e){const t=null!=e?e:1e4;this._state.far!==t&&(this._state.far=t,this._needUpdate(0),this.fire("far",this._state.far))}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(h.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(h.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const n=this.scene.canvas.canvas,A=n.offsetWidth/2,o=n.offsetHeight/2;return s[0]=(e[0]-A)/A,s[1]=(e[1]-o)/o,s[2]=t,s[3]=1,h.mulMat4v4(this.inverseMatrix,s,i),h.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,h.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),this.scene.canvas.off(this._onCanvasBoundary)}}class un extends T{get type(){return"Frustum"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new se({matrix:h.mat4(),inverseMatrix:h.mat4(),transposedMatrix:h.mat4(),near:.1,far:1e4}),this._left=-1,this._right=1,this._bottom=-1,this._top=1,this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.left=t.left,this.right=t.right,this.bottom=t.bottom,this.top=t.top,this.near=t.near,this.far=t.far}_update(){h.frustumMat4(this._left,this._right,this._bottom,this._top,this._state.near,this._state.far,this._state.matrix),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}set left(e){this._left=null!=e?e:-1,this._needUpdate(0),this.fire("left",this._left)}get left(){return this._left}set right(e){this._right=null!=e?e:1,this._needUpdate(0),this.fire("right",this._right)}get right(){return this._right}set top(e){this._top=null!=e?e:1,this._needUpdate(0),this.fire("top",this._top)}get top(){return this._top}set bottom(e){this._bottom=null!=e?e:-1,this._needUpdate(0),this.fire("bottom",this._bottom)}get bottom(){return this._bottom}set near(e){this._state.near=null!=e?e:.1,this._needUpdate(0),this.fire("near",this._state.near)}get near(){return this._state.near}set far(e){this._state.far=null!=e?e:1e4,this._needUpdate(0),this.fire("far",this._state.far)}get far(){return this._state.far}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(h.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(h.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const n=this.scene.canvas.canvas,A=n.offsetWidth/2,o=n.offsetHeight/2;return s[0]=(e[0]-A)/A,s[1]=(e[1]-o)/o,s[2]=t,s[3]=1,h.mulMat4v4(this.inverseMatrix,s,i),h.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,h.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy(),super.destroy()}}class dn extends T{get type(){return"CustomProjection"}constructor(e,t={}){super(e,t),this.camera=e,this._state=new se({matrix:h.mat4(),inverseMatrix:h.mat4(),transposedMatrix:h.mat4()}),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!1,this.matrix=t.matrix}set matrix(e){this._state.matrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._inverseMatrixDirty=!0,this._transposedMatrixDirty=!0,this.glRedraw(),this.fire("matrix",this._state.matrix)}get matrix(){return this._state.matrix}get inverseMatrix(){return this._updateScheduled&&this._doUpdate(),this._inverseMatrixDirty&&(h.inverseMat4(this._state.matrix,this._state.inverseMatrix),this._inverseMatrixDirty=!1),this._state.inverseMatrix}get transposedMatrix(){return this._updateScheduled&&this._doUpdate(),this._transposedMatrixDirty&&(h.transposeMat4(this._state.matrix,this._state.transposedMatrix),this._transposedMatrixDirty=!1),this._state.transposedMatrix}unproject(e,t,s,i,r){const n=this.scene.canvas.canvas,A=n.offsetWidth/2,o=n.offsetHeight/2;return s[0]=(e[0]-A)/A,s[1]=(e[1]-o)/o,s[2]=t,s[3]=1,h.mulMat4v4(this.inverseMatrix,s,i),h.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1,h.mulMat4v4(this.camera.inverseViewMatrix,i,r),r}destroy(){super.destroy(),this._state.destroy()}}const pn=h.vec3(),fn=h.vec3(),gn=h.vec3(),mn=h.vec3(),_n=h.vec3(),bn=h.vec3(),Bn=h.vec4(),yn=h.vec4(),wn=h.vec4(),vn=h.mat4(),Cn=h.mat4(),Mn=h.vec3(),En=h.vec3(),Fn=h.vec3(),xn=h.vec3();class Un extends T{get type(){return"Camera"}constructor(e,t={}){super(e,t),this._state=new se({offsetEyeFromLook:!0,deviceMatrix:h.mat4(),hasDeviceMatrix:!1,matrix:h.mat4(),normalMatrix:h.mat4(),inverseMatrix:h.mat4()}),this._perspective=new cn(this),this._ortho=new hn(this),this._frustum=new un(this),this._customProjection=new dn(this),this._project=this._perspective,this._eye=h.vec3([0,0,10]),this._look=h.vec3([0,0,0]),this._up=h.vec3([0,1,0]),this._worldUp=h.vec3([0,1,0]),this._worldRight=h.vec3([1,0,0]),this._worldForward=h.vec3([0,0,-1]),this.deviceMatrix=t.deviceMatrix,this.eye=t.eye,this.look=t.look,this.up=t.up,this.worldAxis=t.worldAxis,this.gimbalLock=t.gimbalLock,this.constrainPitch=t.constrainPitch,this.projection=t.projection,this._perspective.on("matrix",(()=>{"perspective"===this._projectionType&&this.fire("projMatrix",this._perspective.matrix)})),this._ortho.on("matrix",(()=>{"ortho"===this._projectionType&&this.fire("projMatrix",this._ortho.matrix)})),this._frustum.on("matrix",(()=>{"frustum"===this._projectionType&&this.fire("projMatrix",this._frustum.matrix)})),this._customProjection.on("matrix",(()=>{"customProjection"===this._projectionType&&this.fire("projMatrix",this._customProjection.matrix)}))}_update(){const e=this._state;let t;"ortho"===this.projection&&this._state.offsetEyeFromLook?(h.subVec3(this._eye,this._look,Mn),h.normalizeVec3(Mn,En),h.mulVec3Scalar(En,1e3,Fn),h.addVec3(this._look,Fn,xn),t=xn):t=this._eye,e.hasDeviceMatrix?(h.lookAtMat4v(t,this._look,this._up,Cn),h.mulMat4(e.deviceMatrix,Cn,e.matrix)):h.lookAtMat4v(t,this._look,this._up,e.matrix),h.inverseMat4(this._state.matrix,this._state.inverseMatrix),h.transposeMat4(this._state.inverseMatrix,this._state.normalMatrix),this.glRedraw(),this.fire("matrix",this._state.matrix),this.fire("viewMatrix",this._state.matrix)}orbitYaw(e){let t=h.subVec3(this._eye,this._look,pn);h.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,vn),t=h.transformPoint3(vn,t,fn),this.eye=h.addVec3(this._look,t,gn),this.up=h.transformPoint3(vn,this._up,mn)}orbitPitch(e){if(this._constrainPitch&&(e=h.dotVec3(this._up,this._worldUp)/h.DEGTORAD)<1)return;let t=h.subVec3(this._eye,this._look,pn);const s=h.cross3Vec3(h.normalizeVec3(t,fn),h.normalizeVec3(this._up,gn));h.rotationMat4v(.0174532925*e,s,vn),t=h.transformPoint3(vn,t,mn),this.up=h.transformPoint3(vn,this._up,_n),this.eye=h.addVec3(t,this._look,bn)}yaw(e){let t=h.subVec3(this._look,this._eye,pn);h.rotationMat4v(.0174532925*e,this._gimbalLock?this._worldUp:this._up,vn),t=h.transformPoint3(vn,t,fn),this.look=h.addVec3(t,this._eye,gn),this._gimbalLock&&(this.up=h.transformPoint3(vn,this._up,mn))}pitch(e){if(this._constrainPitch&&(e=h.dotVec3(this._up,this._worldUp)/h.DEGTORAD)<1)return;let t=h.subVec3(this._look,this._eye,pn);const s=h.cross3Vec3(h.normalizeVec3(t,fn),h.normalizeVec3(this._up,gn));h.rotationMat4v(.0174532925*e,s,vn),this.up=h.transformPoint3(vn,this._up,bn),t=h.transformPoint3(vn,t,mn),this.look=h.addVec3(t,this._eye,_n)}pan(e){const t=h.subVec3(this._eye,this._look,pn),s=[0,0,0];let i;if(0!==e[0]){const r=h.cross3Vec3(h.normalizeVec3(t,[]),h.normalizeVec3(this._up,fn));i=h.mulVec3Scalar(r,e[0]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]}0!==e[1]&&(i=h.mulVec3Scalar(h.normalizeVec3(this._up,gn),e[1]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]),0!==e[2]&&(i=h.mulVec3Scalar(h.normalizeVec3(t,mn),e[2]),s[0]+=i[0],s[1]+=i[1],s[2]+=i[2]),this.eye=h.addVec3(this._eye,s,_n),this.look=h.addVec3(this._look,s,bn)}zoom(e){const t=h.subVec3(this._eye,this._look,pn),s=Math.abs(h.lenVec3(t,fn)),i=Math.abs(s+e);if(i<.5)return;const r=h.normalizeVec3(t,gn);this.eye=h.addVec3(this._look,h.mulVec3Scalar(r,i),mn)}set eye(e){this._eye.set(e||[0,0,10]),this._needUpdate(0),this.fire("eye",this._eye)}get eye(){return this._eye}set look(e){this._look.set(e||[0,0,0]),this._needUpdate(0),this.fire("look",this._look)}get look(){return this._look}set up(e){this._up.set(e||[0,1,0]),this._needUpdate(0),this.fire("up",this._up)}get up(){return this._up}set deviceMatrix(e){this._state.deviceMatrix.set(e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),this._state.hasDeviceMatrix=!!e,this._needUpdate(0),this.fire("deviceMatrix",this._state.deviceMatrix)}get deviceMatrix(){return this._state.deviceMatrix}set worldAxis(e){e=e||[1,0,0,0,1,0,0,0,1],this._worldAxis?this._worldAxis.set(e):this._worldAxis=h.vec3(e),this._worldRight[0]=this._worldAxis[0],this._worldRight[1]=this._worldAxis[1],this._worldRight[2]=this._worldAxis[2],this._worldUp[0]=this._worldAxis[3],this._worldUp[1]=this._worldAxis[4],this._worldUp[2]=this._worldAxis[5],this._worldForward[0]=this._worldAxis[6],this._worldForward[1]=this._worldAxis[7],this._worldForward[2]=this._worldAxis[8],this.fire("worldAxis",this._worldAxis)}get worldAxis(){return this._worldAxis}get worldUp(){return this._worldUp}get xUp(){return this._worldUp[0]>this._worldUp[1]&&this._worldUp[0]>this._worldUp[2]}get yUp(){return this._worldUp[1]>this._worldUp[0]&&this._worldUp[1]>this._worldUp[2]}get zUp(){return this._worldUp[2]>this._worldUp[0]&&this._worldUp[2]>this._worldUp[1]}get worldRight(){return this._worldRight}get worldForward(){return this._worldForward}set gimbalLock(e){this._gimbalLock=!1!==e,this.fire("gimbalLock",this._gimbalLock)}get gimbalLock(){return this._gimbalLock}set constrainPitch(e){this._constrainPitch=!!e,this.fire("constrainPitch",this._constrainPitch)}get eyeLookDist(){return h.lenVec3(h.subVec3(this._look,this._eye,pn))}get matrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get viewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.matrix}get normalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get viewNormalMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.normalMatrix}get inverseViewMatrix(){return this._updateScheduled&&this._doUpdate(),this._state.inverseMatrix}get projMatrix(){return this[this.projection].matrix}get perspective(){return this._perspective}get ortho(){return this._ortho}get frustum(){return this._frustum}get customProjection(){return this._customProjection}set projection(e){e=e||"perspective",this._projectionType!==e&&("perspective"===e?this._project=this._perspective:"ortho"===e?this._project=this._ortho:"frustum"===e?this._project=this._frustum:"customProjection"===e?this._project=this._customProjection:(this.error("Unsupported value for 'projection': "+e+" defaulting to 'perspective'"),this._project=this._perspective,e="perspective"),this._project._update(),this._projectionType=e,this.glRedraw(),this._update(),this.fire("dirty"),this.fire("projection",this._projectionType),this.fire("projMatrix",this._project.matrix))}get projection(){return this._projectionType}get project(){return this._project}get offsetEyeFromLook(){return this._state.offsetEyeFromLook}set offsetEyeFromLook(e){this._state.offsetEyeFromLook=e,this._needUpdate(0)}projectWorldPos(e){const t=Bn,s=yn,i=wn;t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1,h.mulMat4v4(this.viewMatrix,t,s),h.mulMat4v4(this.projMatrix,s,i),h.mulVec3Scalar(i,1/i[3]),i[3]=1,i[1]*=-1;const r=this.scene.canvas.canvas,n=r.offsetWidth/2,A=r.offsetHeight/2;return[i[0]*n+n,i[1]*A+A]}destroy(){super.destroy(),this._state.destroy()}}const In={meters:{abbrev:"m"},metres:{abbrev:"m"},centimeters:{abbrev:"cm"},centimetres:{abbrev:"cm"},millimeters:{abbrev:"mm"},millimetres:{abbrev:"mm"},yards:{abbrev:"yd"},feet:{abbrev:"ft"},inches:{abbrev:"in"}};class Tn extends T{constructor(e,t={}){super(e,t),this._units="meters",this._scale=1,this._origin=h.vec3([0,0,0]),this.units=t.units,this.scale=t.scale,this.origin=t.origin}get unitsInfo(){return In}set units(e){e||(e="meters");In[e]||(this.error("Unsupported value for 'units': "+e+" defaulting to 'meters'"),e="meters"),this._units=e,this.fire("units",this._units)}get units(){return this._units}set scale(e){(e=e||1)<=0?this.error("scale value should be larger than zero"):(this._scale=e,this.fire("scale",this._scale))}get scale(){return this._scale}set origin(e){if(!e)return this._origin[0]=0,this._origin[1]=0,void(this._origin[2]=0);this._origin[0]=e[0],this._origin[1]=e[1],this._origin[2]=e[2],this.fire("origin",this._origin)}get origin(){return this._origin}worldToRealPos(e,t=h.vec3(3)){t[0]=this._origin[0]+this._scale*e[0],t[1]=this._origin[1]+this._scale*e[1],t[2]=this._origin[2]+this._scale*e[2]}realToWorldPos(e,t=h.vec3(3)){return t[0]=(e[0]-this._origin[0])/this._scale,t[1]=(e[1]-this._origin[1])/this._scale,t[2]=(e[2]-this._origin[2])/this._scale,t}}class Pn extends T{constructor(e,t={}){super(e,t),this._supported=Jr.SUPPORTED_EXTENSIONS.OES_standard_derivatives,this.enabled=t.enabled,this.kernelRadius=t.kernelRadius,this.intensity=t.intensity,this.bias=t.bias,this.scale=t.scale,this.minResolution=t.minResolution,this.numSamples=t.numSamples,this.blur=t.blur,this.blendCutoff=t.blendCutoff,this.blendFactor=t.blendFactor}get supported(){return this._supported}set enabled(e){e=!!e,this._enabled!==e&&(this._enabled=e,this.glRedraw())}get enabled(){return this._enabled}get possible(){if(!this._supported)return!1;if(!this._enabled)return!1;const e=this.scene.camera.projection;return"customProjection"!==e&&"frustum"!==e}get active(){return this._active}set kernelRadius(e){null==e&&(e=100),this._kernelRadius!==e&&(this._kernelRadius=e,this.glRedraw())}get kernelRadius(){return this._kernelRadius}set intensity(e){null==e&&(e=.15),this._intensity!==e&&(this._intensity=e,this.glRedraw())}get intensity(){return this._intensity}set bias(e){null==e&&(e=.5),this._bias!==e&&(this._bias=e,this.glRedraw())}get bias(){return this._bias}set scale(e){null==e&&(e=1),this._scale!==e&&(this._scale=e,this.glRedraw())}get scale(){return this._scale}set minResolution(e){null==e&&(e=0),this._minResolution!==e&&(this._minResolution=e,this.glRedraw())}get minResolution(){return this._minResolution}set numSamples(e){null==e&&(e=10),this._numSamples!==e&&(this._numSamples=e,this.glRedraw())}get numSamples(){return this._numSamples}set blur(e){e=!1!==e,this._blur!==e&&(this._blur=e,this.glRedraw())}get blur(){return this._blur}set blendCutoff(e){null==e&&(e=.3),this._blendCutoff!==e&&(this._blendCutoff=e,this.glRedraw())}get blendCutoff(){return this._blendCutoff}set blendFactor(e){null==e&&(e=1),this._blendFactor!==e&&(this._blendFactor=e,this.glRedraw())}get blendFactor(){return this._blendFactor}destroy(){super.destroy()}}class Sn extends T{constructor(e,t={}){super(e,t),this.sliceColor=t.sliceColor,this.sliceThickness=t.sliceThickness}set sliceThickness(e){null==e&&(e=0),this._sliceThickness!==e&&(this._sliceThickness=e,this.glRedraw())}get sliceThickness(){return this._sliceThickness}set sliceColor(e){null==e&&(e=[0,0,0,1]),this._sliceColor!==e&&(this._sliceColor=e,this.glRedraw())}get sliceColor(){return this._sliceColor}destroy(){super.destroy()}}const Dn={default:{pointSize:4,roundPoints:!0,perspectivePoints:!0},square:{pointSize:4,roundPoints:!1,perspectivePoints:!0},round:{pointSize:4,roundPoints:!0,perspectivePoints:!0}};class kn extends gt{get type(){return"PointsMaterial"}get presets(){return Dn}constructor(e,t={}){super(e,t),this._state=new se({type:"PointsMaterial",pointSize:null,roundPoints:null,perspectivePoints:null,minPerspectivePointSize:null,maxPerspectivePointSize:null,filterIntensity:null,minIntensity:null,maxIntensity:null}),t.preset?(this.preset=t.preset,void 0!==t.pointSize&&(this.pointSize=t.pointSize),void 0!==t.roundPoints&&(this.roundPoints=t.roundPoints),void 0!==t.perspectivePoints&&(this.perspectivePoints=t.perspectivePoints),void 0!==t.minPerspectivePointSize&&(this.minPerspectivePointSize=t.minPerspectivePointSize),void 0!==t.maxPerspectivePointSize&&(this.maxPerspectivePointSize=t.minPerspectivePointSize)):(this._preset="default",this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize),this.filterIntensity=t.filterIntensity,this.minIntensity=t.minIntensity,this.maxIntensity=t.maxIntensity}set pointSize(e){this._state.pointSize=e||2,this.glRedraw()}get pointSize(){return this._state.pointSize}set roundPoints(e){e=!1!==e,this._state.roundPoints!==e&&(this._state.roundPoints=e,this.scene._needRecompile=!0,this.glRedraw())}get roundPoints(){return this._state.roundPoints}set perspectivePoints(e){e=!1!==e,this._state.perspectivePoints!==e&&(this._state.perspectivePoints=e,this.scene._needRecompile=!0,this.glRedraw())}get perspectivePoints(){return this._state.perspectivePoints}set minPerspectivePointSize(e){this._state.minPerspectivePointSize=e||1,this.scene._needRecompile=!0,this.glRedraw()}get minPerspectivePointSize(){return this._state.minPerspectivePointSize}set maxPerspectivePointSize(e){this._state.maxPerspectivePointSize=e||6,this.scene._needRecompile=!0,this.glRedraw()}get maxPerspectivePointSize(){return this._state.maxPerspectivePointSize}set filterIntensity(e){e=!1!==e,this._state.filterIntensity!==e&&(this._state.filterIntensity=e,this.scene._needRecompile=!0,this.glRedraw())}get filterIntensity(){return this._state.filterIntensity}set minIntensity(e){this._state.minIntensity=null!=e?e:0,this.glRedraw()}get minIntensity(){return this._state.minIntensity}set maxIntensity(e){this._state.maxIntensity=null!=e?e:1,this.glRedraw()}get maxIntensity(){return this._state.maxIntensity}set preset(e){if(e=e||"default",this._preset===e)return;const t=Dn[e];t?(this.pointSize=t.pointSize,this.roundPoints=t.roundPoints,this.perspectivePoints=t.perspectivePoints,this.minPerspectivePointSize=t.minPerspectivePointSize,this.maxPerspectivePointSize=t.maxPerspectivePointSize,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Dn).join(", "))}get preset(){return this._preset}get hash(){return[this.pointSize,this.roundPoints,this.perspectivePoints,this.minPerspectivePointSize,this.maxPerspectivePointSize,this.filterIntensity].join(";")}destroy(){super.destroy(),this._state.destroy()}}const Qn={default:{lineWidth:1},thick:{lineWidth:2},thicker:{lineWidth:4}};class Rn extends gt{get type(){return"LinesMaterial"}get presets(){return Qn}constructor(e,t={}){super(e,t),this._state=new se({type:"LinesMaterial",lineWidth:null}),t.preset?(this.preset=t.preset,void 0!==t.lineWidth&&(this.lineWidth=t.lineWidth)):(this._preset="default",this.lineWidth=t.lineWidth)}set lineWidth(e){this._state.lineWidth=e||1,this.glRedraw()}get lineWidth(){return this._state.lineWidth}set preset(e){if(e=e||"default",this._preset===e)return;const t=Qn[e];t?(this.lineWidth=t.lineWidth,this._preset=e):this.error("unsupported preset: '"+e+"' - supported values are "+Object.keys(Qn).join(", "))}get preset(){return this._preset}get hash(){return[""+this.lineWidth].join(";")}destroy(){super.destroy(),this._state.destroy()}}function On(e,t,s=2){const i=t&&t.length,r=i?t[0]*s:e.length;let n=Vn(e,0,r,s,!0);const A=[];if(!n||n.next===n.prev)return A;let o,a,l;if(i&&(n=function(e,t,s,i){const r=[];for(let s=0,n=t.length;s<n;s++){const A=Vn(e,t[s]*i,s<n-1?t[s+1]*i:e.length,i,!1);A===A.next&&(A.steiner=!0),r.push(Jn(A))}r.sort(zn);for(let e=0;e<r.length;e++)s=Xn(r[e],s);return s}(e,t,n,s)),e.length>80*s){o=1/0,a=1/0;let t=-1/0,i=-1/0;for(let n=s;n<r;n+=s){const s=e[n],r=e[n+1];s<o&&(o=s),r<a&&(a=r),s>t&&(t=s),r>i&&(i=r)}l=Math.max(t-o,i-a),l=0!==l?32767/l:0}return Hn(n,A,s,o,a,l,0),A}function Vn(e,t,s,i,r){let n;if(r===function(e,t,s,i){let r=0;for(let n=t,A=s-i;n<s;n+=i)r+=(e[A]-e[n])*(e[n+1]+e[A+1]),A=n;return r}(e,t,s,i)>0)for(let r=t;r<s;r+=i)n=oA(r/i|0,e[r],e[r+1],n);else for(let r=s-i;r>=t;r-=i)n=oA(r/i|0,e[r],e[r+1],n);return n&&tA(n,n.next)&&(aA(n),n=n.next),n}function Ln(e,t){if(!e)return e;t||(t=e);let s,i=e;do{if(s=!1,i.steiner||!tA(i,i.next)&&0!==eA(i.prev,i,i.next))i=i.next;else{if(aA(i),i=t=i.prev,i===i.next)break;s=!0}}while(s||i!==t);return t}function Hn(e,t,s,i,r,n,A){if(!e)return;!A&&n&&function(e,t,s,i){let r=e;do{0===r.z&&(r.z=Zn(r.x,r.y,t,s,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,function(e){let t,s=1;do{let i,r=e;e=null;let n=null;for(t=0;r;){t++;let A=r,o=0;for(let e=0;e<s&&(o++,A=A.nextZ,A);e++);let a=s;for(;o>0||a>0&&A;)0!==o&&(0===a||!A||r.z<=A.z)?(i=r,r=r.nextZ,o--):(i=A,A=A.nextZ,a--),n?n.nextZ=i:e=i,i.prevZ=n,n=i;r=A}n.nextZ=null,s*=2}while(t>1)}(r)}(e,i,r,n);let o=e;for(;e.prev!==e.next;){const a=e.prev,l=e.next;if(n?Gn(e,i,r,n):Nn(e))t.push(a.i,e.i,l.i),aA(e),e=l.next,o=l.next;else if((e=l)===o){A?1===A?Hn(e=jn(Ln(e),t),t,s,i,r,n,2):2===A&&Wn(e,t,s,i,r,n):Hn(Ln(e),t,s,i,r,n,1);break}}}function Nn(e){const t=e.prev,s=e,i=e.next;if(eA(t,s,i)>=0)return!1;const r=t.x,n=s.x,A=i.x,o=t.y,a=s.y,l=i.y,c=Math.min(r,n,A),h=Math.min(o,a,l),u=Math.max(r,n,A),d=Math.max(o,a,l);let p=i.next;for(;p!==t;){if(p.x>=c&&p.x<=u&&p.y>=h&&p.y<=d&&$n(r,o,n,a,A,l,p.x,p.y)&&eA(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Gn(e,t,s,i){const r=e.prev,n=e,A=e.next;if(eA(r,n,A)>=0)return!1;const o=r.x,a=n.x,l=A.x,c=r.y,h=n.y,u=A.y,d=Math.min(o,a,l),p=Math.min(c,h,u),f=Math.max(o,a,l),g=Math.max(c,h,u),m=Zn(d,p,t,s,i),_=Zn(f,g,t,s,i);let b=e.prevZ,B=e.nextZ;for(;b&&b.z>=m&&B&&B.z<=_;){if(b.x>=d&&b.x<=f&&b.y>=p&&b.y<=g&&b!==r&&b!==A&&$n(o,c,a,h,l,u,b.x,b.y)&&eA(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,B.x>=d&&B.x<=f&&B.y>=p&&B.y<=g&&B!==r&&B!==A&&$n(o,c,a,h,l,u,B.x,B.y)&&eA(B.prev,B,B.next)>=0)return!1;B=B.nextZ}for(;b&&b.z>=m;){if(b.x>=d&&b.x<=f&&b.y>=p&&b.y<=g&&b!==r&&b!==A&&$n(o,c,a,h,l,u,b.x,b.y)&&eA(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;B&&B.z<=_;){if(B.x>=d&&B.x<=f&&B.y>=p&&B.y<=g&&B!==r&&B!==A&&$n(o,c,a,h,l,u,B.x,B.y)&&eA(B.prev,B,B.next)>=0)return!1;B=B.nextZ}return!0}function jn(e,t){let s=e;do{const i=s.prev,r=s.next.next;!tA(i,r)&&sA(i,s,s.next,r)&&nA(i,r)&&nA(r,i)&&(t.push(i.i,s.i,r.i),aA(s),aA(s.next),s=e=r),s=s.next}while(s!==e);return Ln(s)}function Wn(e,t,s,i,r,n){let A=e;do{let e=A.next.next;for(;e!==A.prev;){if(A.i!==e.i&&qn(A,e)){let o=AA(A,e);return A=Ln(A,A.next),o=Ln(o,o.next),Hn(A,t,s,i,r,n,0),void Hn(o,t,s,i,r,n,0)}e=e.next}A=A.next}while(A!==e)}function zn(e,t){let s=e.x-t.x;if(0===s&&(s=e.y-t.y,0===s)){s=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)}return s}function Xn(e,t){const s=function(e,t){let s=t;const i=e.x,r=e.y;let n,A=-1/0;if(tA(e,s))return s;do{if(tA(e,s.next))return s.next;if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){const e=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(e<=i&&e>A&&(A=e,n=s.x<s.next.x?s:s.next,e===i))return n}s=s.next}while(s!==t);if(!n)return null;const o=n,a=n.x,l=n.y;let c=1/0;s=n;do{if(i>=s.x&&s.x>=a&&i!==s.x&&Yn(r<l?i:A,r,a,l,r<l?A:i,r,s.x,s.y)){const t=Math.abs(r-s.y)/(i-s.x);nA(s,e)&&(t<c||t===c&&(s.x>n.x||s.x===n.x&&Kn(n,s)))&&(n=s,c=t)}s=s.next}while(s!==o);return n}(e,t);if(!s)return t;const i=AA(s,e);return Ln(i,i.next),Ln(s,s.next)}function Kn(e,t){return eA(e.prev,e,t.prev)<0&&eA(t.next,e,e.next)<0}function Zn(e,t,s,i,r){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Jn(e){let t=e,s=e;do{(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next}while(t!==e);return s}function Yn(e,t,s,i,r,n,A,o){return(r-A)*(t-o)>=(e-A)*(n-o)&&(e-A)*(i-o)>=(s-A)*(t-o)&&(s-A)*(n-o)>=(r-A)*(i-o)}function $n(e,t,s,i,r,n,A,o){return!(e===A&&t===o)&&Yn(e,t,s,i,r,n,A,o)}function qn(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let s=e;do{if(s.i!==e.i&&s.next.i!==e.i&&s.i!==t.i&&s.next.i!==t.i&&sA(s,s.next,e,t))return!0;s=s.next}while(s!==e);return!1}(e,t)&&(nA(e,t)&&nA(t,e)&&function(e,t){let s=e,i=!1;const r=(e.x+t.x)/2,n=(e.y+t.y)/2;do{s.y>n!=s.next.y>n&&s.next.y!==s.y&&r<(s.next.x-s.x)*(n-s.y)/(s.next.y-s.y)+s.x&&(i=!i),s=s.next}while(s!==e);return i}(e,t)&&(eA(e.prev,e,t.prev)||eA(e,t.prev,t))||tA(e,t)&&eA(e.prev,e,e.next)>0&&eA(t.prev,t,t.next)>0)}function eA(e,t,s){return(t.y-e.y)*(s.x-t.x)-(t.x-e.x)*(s.y-t.y)}function tA(e,t){return e.x===t.x&&e.y===t.y}function sA(e,t,s,i){const r=rA(eA(e,t,s)),n=rA(eA(e,t,i)),A=rA(eA(s,i,e)),o=rA(eA(s,i,t));return r!==n&&A!==o||(!(0!==r||!iA(e,s,t))||(!(0!==n||!iA(e,i,t))||(!(0!==A||!iA(s,e,i))||!(0!==o||!iA(s,t,i)))))}function iA(e,t,s){return t.x<=Math.max(e.x,s.x)&&t.x>=Math.min(e.x,s.x)&&t.y<=Math.max(e.y,s.y)&&t.y>=Math.min(e.y,s.y)}function rA(e){return e>0?1:e<0?-1:0}function nA(e,t){return eA(e.prev,e,e.next)<0?eA(e,t,e.next)>=0&&eA(e,e.prev,t)>=0:eA(e,t,e.prev)<0||eA(e,e.next,t)<0}function AA(e,t){const s=lA(e.i,e.x,e.y),i=lA(t.i,t.x,t.y),r=e.next,n=t.prev;return e.next=t,t.prev=e,s.next=r,r.prev=s,i.next=s,s.prev=i,n.next=i,i.prev=n,i}function oA(e,t,s,i){const r=lA(e,t,s);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function aA(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function lA(e,t,s){return{i:e,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}const cA=[0,1,0],hA=[1,0,0],uA=h.vec3(),dA=h.vec3(),pA=h.vec3(),fA=h.vec3(),gA=h.vec3();function mA(e,t){return Math.abs(e[0]-t[0])<1e-6&&Math.abs(e[1]-t[1])<1e-6&&Math.abs(e[2]-t[2])<1e-6}class _A{constructor(e){this.scene=e,this._resourcesAllocated=!1}_onCapMaterialUpdated(e,t){if(!this._resourcesAllocated){this._resourcesAllocated=!0,this._sectionPlanes=[],this._sceneModelsData={},this._dirtyMap={},this._prevIntersectionModelsMap={},this._sectionPlaneTimeout=null,this._updateTimeout=null;const e=e=>{const t=()=>{this._setAllDirty(!0),this._update()};this._sectionPlanes.push(e),e.on("pos",t),e.on("dir",t),e.on("active",t),e.once("destroyed",(()=>{const t=e.id;t&&(this._sectionPlanes=this._sectionPlanes.filter((e=>e.id!==t)),this._update())}).bind(this))};for(const t in this.scene.sectionPlanes)e(this.scene.sectionPlanes[t]);this._onSectionPlaneCreated=this.scene.on("sectionPlaneCreated",e),this._onTick=this.scene.on("tick",(()=>{let e=!1;for(const t in this._sceneModelsData)this.scene.models[t]?this._sceneModelsData[t].visible!==!!this.scene.models[t].visible&&(this._sceneModelsData[t].visible=!!this.scene.models[t].visible,e=!0):(delete this._sceneModelsData[t],e=!0);e&&this._update()}))}this._dirtyMap[t]||(this._dirtyMap[t]=new Map),this._dirtyMap[t].set(e,!0),this._update()}_update(){clearTimeout(this._updateTimeout),this._deletePreviousModels(),this._updateTimeout=setTimeout((()=>{clearTimeout(this._updateTimeout);const e=Object.values(this.scene.models).filter((e=>e.visible));this._addHatches(e,this._sectionPlanes.filter((e=>e.active))),this._setAllDirty(!1)}),100)}_setAllDirty(e){for(const t in this._dirty)this._dirtyMap[t].forEach(((s,i)=>this._dirtyMap[t].set(i,e)))}_addHatches(e,t){t.forEach((t=>{e.forEach((e=>{if(!this._doesPlaneIntersectBoundingBox(e.aabb,t))return;if(!this._dirtyMap[e.id])return;const s=new Map,i=e.objects,r=[h.vec3(),h.vec3(),h.vec3()];this._dirtyMap[e.id].forEach(((n,A)=>{if(!n)return;const o=i[A];if(!this._doesPlaneIntersectBoundingBox(o.aabb,t))return;if(!this._sceneModelsData[e.id]){const t=e.aabb;this._sceneModelsData[e.id]={verticesMap:new Map,indicesMap:new Map,modelOrigin:h.vec3([(t[0]+t[3])/2,(t[1]+t[4])/2,(t[2]+t[5])/2])}}const a=this._sceneModelsData[e.id],l=a.modelOrigin;if(!a.verticesMap.has(A)){const e=o.meshes[0].isSolid(),t=[],s=[];e&&o.capMaterial&&(o.getEachVertex((e=>t.push(e[0]-l[0],e[1]-l[1],e[2]-l[2]))),o.getEachIndex((e=>s.push(e)))),a.verticesMap.set(A,t),a.indicesMap.set(A,s)}const c=a.verticesMap.get(A),u=a.indicesMap.get(A),d=-h.dotVec3(h.subVec3(t.pos,l,uA),t.dir),p=[],f=u.length;for(let e=0;e<f;e+=3){for(let t=0;t<3;t++){const s=3*u[e+t];r[t][0]=c[s],r[t][1]=c[s+1],r[t][2]=c[s+2]}if(!r[0][0]&&!r[0][1]&&!r[0][2])continue;const s=[];for(let e=0;e<3;e++){const i=r[e],n=r[(e+1)%3],A=d+h.dotVec3(t.dir,i),o=d+h.dotVec3(t.dir,n);if(A*o>0)continue;const a=-A/(o-A);s.push(h.lerpVec3(a,0,1,i,n,h.vec3()))}2===s.length&&p.push(s)}p.length>0&&s.set(A,p)}));const n=new Map;s.forEach(((e,t)=>{n.set(t,[[e[0]]]),e.splice(0,1);let i=0;for(;e.length>0;){const r=n.get(t)[i][n.get(t)[i].length-1][1];let A=!1;for(let s=0;s<e.length;s++){const[o,a]=e[s];if(mA(r,o)){n.get(t)[i].push(e[s]),e.splice(s,1),A=!0;break}if(mA(r,a)){n.get(t)[i].push([a,o]),e.splice(s,1),A=!0;break}}if(!A&&mA(r,n.get(t)[i][0][0])&&e.length>1)n.get(t).push([s.get(t)[0]]),e.splice(0,1),i++;else if(!A)break}}));const A=new Map;n.forEach(((e,s)=>{const i=[];for(let s=0;s<e.length;s++)i.push([]),e[s].forEach((e=>{i[s].push([this._projectTo2D(e[0],t.dir),this._projectTo2D(e[1],t.dir)])}));A.set(s,i)}));const o=new Map;let a;A.forEach(((s,i)=>{const r=this._sceneModelsData[e.id].modelOrigin;a=[];const n=s,A=[],l=new Set;for(let e=0;e<n.length;e++){if(l.has(e))continue;const t=[n[e]];l.add(e);for(let s=e+1;s<n.length;s++)l.has(s)||(this._isLoopInside(n[e],n[s])||this._isLoopInside(n[s],n[e]))&&(t.push(n[s]),l.add(s));A.push(t)}A.forEach((e=>{const s=[],i=[];let n=0;const A=e.map((e=>{let t=0;for(let s=0;s<e.length;s++){const i=(s+1)%e.length;t+=e[s][0][0]*e[i][0][1],t-=e[i][0][0]*e[s][0][1]}return Math.abs(t)/2})),o=A.indexOf(Math.max(...A));e[o].forEach((e=>{s.push(e[0][0],e[0][1]),n+=2}));for(let t=0;t<e.length;t++)t!==o&&(i.push(n/2),e[t].forEach((e=>{s.push(e[0][0],e[0][1]),n+=2})));const l=On(s,i),c=[];for(let e=0;e<l.length;e+=3){const i=[];for(let n=0;n<3;n++){const A=2*l[e+n],o=[s[A],s[A+1]],a=this._convertTo3D(o,t,r);i.push(a)}c.push(i)}a.push(c)})),o.set(i,a)}));const l=new Map;o.forEach(((e,t)=>{a=[],e.forEach((e=>{const t=new Map,s=[],i=[];let r=0;e.forEach((e=>{const n=[];e.forEach((e=>{const i=`${e[0].toFixed(6)},${e[1].toFixed(6)},${e[2].toFixed(6)}`;t.has(i)?n.push(t.get(i)):(s.push(e[0],e[1],e[2]),t.set(i,r),n.push(r),r++)})),i.push(...n)})),a.push({positions:s,indices:i})})),l.set(t,a)})),this._prevIntersectionModelsMap[e.id]||(this._prevIntersectionModelsMap[e.id]=new Map),h.mulVec3Scalar(t.dir,.001,gA),l.forEach(((s,i)=>{const r=this._sceneModelsData[e.id].modelOrigin,n=new Array(s.size);let A=0;s.forEach(((s,o)=>{const a=s.positions,l=s.indices;a.length;const c=h.buildNormals(a,l),u=this._createUVs(a,t,r);n[A++]=new dt(this.scene,{id:`${t.id}-${i}-${o}`,geometry:new pe(this.scene,{primitive:"triangles",positions:a,indices:l,normals:c,uv:u}),origin:h.addVec3(r,gA,uA),position:[0,0,0],rotation:[0,0,0],material:e.objects[i].capMaterial})})),this._prevIntersectionModelsMap[e.id].has(i)?this._prevIntersectionModelsMap[e.id].get(i).push(...n):this._prevIntersectionModelsMap[e.id].set(i,n)}))}))}))}_doesPlaneIntersectBoundingBox(e,t){const s=[e[0],e[1],e[2]],i=[e[3],e[4],e[5]],r=[[s[0],s[1],s[2]],[i[0],s[1],s[2]],[s[0],i[1],s[2]],[i[0],i[1],s[2]],[s[0],s[1],i[2]],[i[0],s[1],i[2]],[s[0],i[1],i[2]],[i[0],i[1],i[2]]];let n=!1,A=!1;for(const e of r){const s=t.dist+h.dotVec3(t.dir,e);if(s>0&&(n=!0),s<0&&(A=!0),n&&A)return!0}return!1}_buildLines(e){for(const t in e)for(let s=0;s<e[t].length;s++){const i=e[t][s];i.length<=0||i.forEach(((e,t)=>{new dt(this.scene,{clippable:!1,geometry:new pe(this.scene,Ue({startPoint:e[0],endPoint:e[1]})),material:new bt(this.scene,{emissive:[1,0,0]})})}))}}_projectTo2D(e,t){let s;s=Math.abs(t[0])>Math.abs(t[1])?[-t[2],0,t[0]]:[0,t[2],-t[1]],s=h.normalizeVec3(s);const i=h.vec3(t),r=h.cross3Vec3(i,s),n=h.normalizeVec3(r);return[h.dotVec3(e,s),h.dotVec3(e,n)]}_isLoopInside(e,t){const s=e[0][0];let i=!1;for(let e=0,r=t.length-1;e<t.length;r=e++){const n=t[e][0][0],A=t[e][0][1],o=t[r][0][0],a=t[r][0][1];A>s[1]!=a>s[1]&&s[0]<(o-n)*(s[1]-A)/(a-A)+n&&(i=!i)}return i}_convertTo3D(e,t,s){let i,r=t.dir,n=t.pos;i=Math.abs(r[0])>Math.abs(r[1])?[-r[2],0,r[0]]:[0,r[2],-r[1]],i=h.normalizeVec3(i);const A=h.vec3(r),o=h.cross3Vec3(A,i),a=h.normalizeVec3(o),l=e[0],c=e[1],u=[i[0]*l+a[0]*c,i[1]*l+a[1]*c,i[2]*l+a[2]*c],d=h.dotVec3(r,[n[0]-u[0]-s[0],n[1]-u[1]-s[1],n[2]-u[2]-s[2]]);return[u[0]+r[0]*d,u[1]+r[1]*d,u[2]+r[2]*d]}_deletePreviousModels(){for(const e in this._prevIntersectionModelsMap){this._prevIntersectionModelsMap[e].forEach(((t,s)=>{this._dirtyMap[e].get(s)&&(t.forEach((e=>{e.destroy()})),this._prevIntersectionModelsMap[e].delete(s))})),this._prevIntersectionModelsMap[e].size<=0&&delete this._prevIntersectionModelsMap[e]}}_createUVs(e,t,s){const i=t.pos,r=uA;r.set(t.dir),h.normalizeVec3(r);const n=dA,A=[];for(let t=0;t<e.length;t+=3){n[0]=e[t]+s[0],n[1]=e[t+1]+s[1],n[2]=e[t+2]+s[2];const o=h.subVec3(n,i,pA),a=h.dotVec3(o,r);h.subVec3(n,h.mulVec3Scalar(r,a,pA),n);const l=Math.abs(h.dotVec3(r,cA))<.999?h.cross3Vec3(r,cA,pA):hA,c=h.cross3Vec3(r,l,pA);h.normalizeVec3(c,c);const u=h.subVec3(n,i,n);A.push(h.dotVec3(u,h.normalizeVec3(h.cross3Vec3(c,r,fA))),h.dotVec3(u,c))}return A}destroy(){this._deletePreviousModels(),this._resourcesAllocated&&(this.scene.off(this._onModelLoaded),this.scene.off(this._onModelUnloaded),this.scene.off(this._onSectionPlaneCreated),this.scene.off(this._onTick))}}function bA(e,t){const s={};let i,r;for(let n=0,A=t.length;n<A;n++)i=t[n],r=e.components[i],r?r.isEntity?s[i]=!0:e.warn("pick(): Component is not an Entity: "+i):e.warn("pick(): Component not found: "+i);return s}class BA extends T{get type(){return"Scene"}constructor(e,t={}){super(null,t);const s=t.canvasElement||document.querySelector(`#${t.canvasId}`);if(!(s instanceof HTMLCanvasElement))throw"Mandatory config expected: valid canvasId or canvasElement";this._tickifiedFunctions={};const i=!!t.transparent,r=!!t.alphaDepthMask;this._aabbDirty=!0,this._readableGeometry=!!t.readableGeometryEnabled,this.viewer=e,this.occlusionTestCountdown=0,this.loading=0,this.startTime=(new Date).getTime(),this.models={},this.objects={},this._numObjects=0,this.visibleObjects={},this._numVisibleObjects=0,this.xrayedObjects={},this._numXRayedObjects=0,this.highlightedObjects={},this._numHighlightedObjects=0,this.selectedObjects={},this._numSelectedObjects=0,this.colorizedObjects={},this._numColorizedObjects=0,this.opacityObjects={},this._numOpacityObjects=0,this.offsetObjects={},this._numOffsetObjects=0,this._modelIds=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this._opacityObjectIds=null,this._offsetObjectIds=null,this._collidables={},this._compilables={},this._needRecompile=!1,this.types={},this.components={},this.sectionPlanes={},this.lights={},this.lightMaps={},this.reflectionMaps={},this.bitmaps={},this.lineSets={},this.realWorldOffset=t.realWorldOffset||new Float64Array([0,0,0]),this.canvas=new Kr(this,{dontClear:!0,canvas:s,spinnerElementId:t.spinnerElementId,transparent:i,webgl2:!1!==t.webgl2,contextAttr:t.contextAttr||{},backgroundColor:t.backgroundColor,backgroundColorFromAmbientLight:t.backgroundColorFromAmbientLight,premultipliedAlpha:t.premultipliedAlpha});const n=e=>this.viewer.destroy();s.addEventListener("webglcontextlost",n,!1),this._removeWebglcontextlostListener=()=>s.removeEventListener("webglcontextlost",n,!1),this.canvas.on("boundary",(()=>{this.glRedraw()})),this.canvas.on("webglContextFailed",(()=>{alert("xeokit failed to find WebGL!")})),this._renderer=new on(this,{transparent:i,alphaDepthMask:r}),this._sectionPlanesState=new function(){this.sectionPlanes=[],this.clippingCaps=!1,this._numCachedSectionPlanes=0;let e=null;this.getHash=function(){if(e)return e;const t=this.getNumAllocatedSectionPlanes();if(this.sectionPlanes,0===t)return this.hash=";";const s=[];for(let e=0,i=t;e<i;e++)s.push("cp");return s.push(";"),e=s.join(""),e},this.addSectionPlane=function(t){this.sectionPlanes.push(t),e=null},this.removeSectionPlane=function(t){for(let s=0,i=this.sectionPlanes.length;s<i;s++)if(this.sectionPlanes[s].id===t.id)return this.sectionPlanes.splice(s,1),void(e=null)},this.setNumCachedSectionPlanes=function(t){this._numCachedSectionPlanes=t,e=null},this.getNumCachedSectionPlanes=function(){return this._numCachedSectionPlanes},this.getNumAllocatedSectionPlanes=function(){const e=this.sectionPlanes.length;return e>this._numCachedSectionPlanes?e:this._numCachedSectionPlanes}},this._sectionPlanesState.setNumCachedSectionPlanes(t.numCachedSectionPlanes||0),this._lightsState=new function(){const e=h.vec4([0,0,0,0]),t=h.vec4();this.lights=[],this.reflectionMaps=[],this.lightMaps=[];let s=null,i=null;this.getHash=function(){if(s)return s;const e=[],t=this.lights;let i;for(let s=0,r=t.length;s<r;s++)i=t[s],e.push("/"),e.push(i.type),e.push("world"===i.space?"w":"v"),i.castsShadow&&e.push("sh");return this.lightMaps.length>0&&e.push("/lm"),this.reflectionMaps.length>0&&e.push("/rm"),e.push(";"),s=e.join(""),s},this.addLight=function(e){this.lights.push(e),i=null,s=null},this.removeLight=function(e){for(let t=0,r=this.lights.length;t<r;t++){if(this.lights[t].id===e.id)return this.lights.splice(t,1),i&&i.id===e.id&&(i=null),void(s=null)}},this.addReflectionMap=function(e){this.reflectionMaps.push(e),s=null},this.removeReflectionMap=function(e){for(let t=0,i=this.reflectionMaps.length;t<i;t++)if(this.reflectionMaps[t].id===e.id)return this.reflectionMaps.splice(t,1),void(s=null)},this.addLightMap=function(e){this.lightMaps.push(e),s=null},this.removeLightMap=function(e){for(let t=0,i=this.lightMaps.length;t<i;t++)if(this.lightMaps[t].id===e.id)return this.lightMaps.splice(t,1),void(s=null)},this.getAmbientColorAndIntensity=function(){if(!i)for(let e=0,t=this.lights.length;e<t;e++){const t=this.lights[e];if("ambient"===t.type){i=t;break}}if(i){const e=i.color,s=i.intensity;return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=s,t}return e}},this.input=new an(this,{dontClear:!0,element:this.canvas.canvas,keyboardEventsElement:t.keyboardEventsElement}),this.metrics=new Tn(this,{units:t.units,scale:t.scale,origin:t.origin}),this.sao=new Pn(this,{enabled:t.saoEnabled}),this.crossSections=new Sn(this,{}),this.ticksPerRender=t.ticksPerRender,this.ticksPerOcclusionTest=t.ticksPerOcclusionTest,this.passes=t.passes,this.clearEachPass=t.clearEachPass,this.gammaInput=t.gammaInput,this.gammaOutput=t.gammaOutput,this.gammaFactor=t.gammaFactor,this._entityOffsetsEnabled=!!t.entityOffsetsEnabled,this._logarithmicDepthBufferEnabled=!!t.logarithmicDepthBufferEnabled,this._dtxEnabled=!1!==t.dtxEnabled,this._pbrEnabled=!!t.pbrEnabled,this._colorTextureEnabled=!1!==t.colorTextureEnabled,this._dtxEnabled=!!t.dtxEnabled,this._markerZOffset=t.markerZOffset,F._addScene(this),this._initDefaults(),this._viewport=new ln(this,{id:"default.viewport",autoBoundary:!0,dontClear:!0}),this._camera=new Un(this,{id:"default.camera",dontClear:!0}),this._sectionCaps=new _A(this),new wr(this,{color:[1,1,1],intensity:.7}),new Cr(this,{dir:[.8,-.5,-.5],color:[.67,.67,1],intensity:.7,space:"world"}),new Cr(this,{dir:[-.8,-1,.5],color:[1,1,.9],intensity:.9,space:"world"}),this._camera.on("dirty",(()=>{this._renderer.imageDirty()}))}_initDefaults(){}_addComponent(e){if(e.id&&this.components[e.id]&&(this.error("Component "+_.inQuotes(e.id)+" already exists in Scene - ignoring ID, will randomly-generate instead"),e.id=null),!e.id)for(void 0===window.nextID&&(window.nextID=0),e.id="__"+window.nextID++;this.components[e.id];)e.id=h.createUUID();this.components[e.id]=e;const t=e.type;let s=this.types[e.type];s||(s=this.types[t]={}),s[e.id]=e,e.compile&&(this._compilables[e.id]=e),e.isDrawable&&(this._renderer.addDrawable(e.id,e),this._collidables[e.id]=e)}_removeComponent(e){var t=e.id,s=e.type;delete this.components[t];const i=this.types[s];i&&(delete i[t],_.isEmptyObject(i)&&delete this.types[s]),e.compile&&delete this._compilables[e.id],e.isDrawable&&(this._renderer.removeDrawable(e.id),delete this._collidables[e.id])}_capMaterialUpdated(e,t){this._sectionCaps._onCapMaterialUpdated(e,t)}_sectionPlaneCreated(e){this.sectionPlanes[e.id]=e,this.scene._sectionPlanesState.addSectionPlane(e._state),this.scene.fire("sectionPlaneCreated",e,!0),this._needRecompile=!0}_bitmapCreated(e){this.bitmaps[e.id]=e,this.scene.fire("bitmapCreated",e,!0)}_lineSetCreated(e){this.lineSets[e.id]=e,this.scene.fire("lineSetCreated",e,!0)}_lightCreated(e){this.lights[e.id]=e,this.scene._lightsState.addLight(e._state),this._needRecompile=!0}_lightMapCreated(e){this.lightMaps[e.id]=e,this.scene._lightsState.addLightMap(e._state),this._needRecompile=!0}_reflectionMapCreated(e){this.reflectionMaps[e.id]=e,this.scene._lightsState.addReflectionMap(e._state),this._needRecompile=!0}_sectionPlaneDestroyed(e){delete this.sectionPlanes[e.id],this.scene._sectionPlanesState.removeSectionPlane(e._state),this.scene.fire("sectionPlaneDestroyed",e,!0),this._needRecompile=!0}_bitmapDestroyed(e){delete this.bitmaps[e.id],this.scene.fire("bitmapDestroyed",e,!0)}_lineSetDestroyed(e){delete this.lineSets[e.id],this.scene.fire("lineSetDestroyed",e,!0)}_lightDestroyed(e){delete this.lights[e.id],this.scene._lightsState.removeLight(e._state),this._needRecompile=!0}_lightMapDestroyed(e){delete this.lightMaps[e.id],this.scene._lightsState.removeLightMap(e._state),this._needRecompile=!0}_reflectionMapDestroyed(e){delete this.reflectionMaps[e.id],this.scene._lightsState.removeReflectionMap(e._state),this._needRecompile=!0}_registerModel(e){this.models[e.id]=e,this._modelIds=null}_deregisterModel(e){const t=e.id;delete this.models[t],this._modelIds=null,this.fire("modelUnloaded",t)}_registerObject(e){this.objects[e.id]=e,this._numObjects++,this._objectIds=null}_deregisterObject(e){delete this.objects[e.id],this._numObjects--,this._objectIds=null}_objectVisibilityUpdated(e,t=!0){e.visible?(this.visibleObjects[e.id]=e,this._numVisibleObjects++):(delete this.visibleObjects[e.id],this._numVisibleObjects--),this._visibleObjectIds=null,t&&this.fire("objectVisibility",e,!0)}_deRegisterVisibleObject(e){delete this.visibleObjects[e.id],this._numVisibleObjects--,this._visibleObjectIds=null}_objectXRayedUpdated(e,t=!0){e.xrayed?(this.xrayedObjects[e.id]=e,this._numXRayedObjects++):(delete this.xrayedObjects[e.id],this._numXRayedObjects--),this._xrayedObjectIds=null,t&&this.fire("objectXRayed",e,!0)}_deRegisterXRayedObject(e){delete this.xrayedObjects[e.id],this._numXRayedObjects--,this._xrayedObjectIds=null}_objectHighlightedUpdated(e){e.highlighted?(this.highlightedObjects[e.id]=e,this._numHighlightedObjects++):(delete this.highlightedObjects[e.id],this._numHighlightedObjects--),this._highlightedObjectIds=null}_deRegisterHighlightedObject(e){delete this.highlightedObjects[e.id],this._numHighlightedObjects--,this._highlightedObjectIds=null}_objectSelectedUpdated(e,t=!0){e.selected?(this.selectedObjects[e.id]=e,this._numSelectedObjects++):(delete this.selectedObjects[e.id],this._numSelectedObjects--),this._selectedObjectIds=null,t&&this.fire("objectSelected",e,!0)}_deRegisterSelectedObject(e){delete this.selectedObjects[e.id],this._numSelectedObjects--,this._selectedObjectIds=null}_objectColorizeUpdated(e,t){t?(this.colorizedObjects[e.id]=e,this._numColorizedObjects++):(delete this.colorizedObjects[e.id],this._numColorizedObjects--),this._colorizedObjectIds=null}_deRegisterColorizedObject(e){delete this.colorizedObjects[e.id],this._numColorizedObjects--,this._colorizedObjectIds=null}_objectOpacityUpdated(e,t){t?(this.opacityObjects[e.id]=e,this._numOpacityObjects++):(delete this.opacityObjects[e.id],this._numOpacityObjects--),this._opacityObjectIds=null}_deRegisterOpacityObject(e){delete this.opacityObjects[e.id],this._numOpacityObjects--,this._opacityObjectIds=null}_objectOffsetUpdated(e,t){!t||0===t[0]&&0===t[1]&&0===t[2]?(this.offsetObjects[e.id]=e,this._numOffsetObjects++):(delete this.offsetObjects[e.id],this._numOffsetObjects--),this._offsetObjectIds=null}_deRegisterOffsetObject(e){delete this.offsetObjects[e.id],this._numOffsetObjects--,this._offsetObjectIds=null}get capabilities(){return this._renderer.capabilities}get entityOffsetsEnabled(){return this._entityOffsetsEnabled}get readableGeometryEnabled(){return this._readableGeometry}get pickSurfacePrecisionEnabled(){return this._readableGeometry}get logarithmicDepthBufferEnabled(){return this._logarithmicDepthBufferEnabled}set numCachedSectionPlanes(e){e=e||0,this._sectionPlanesState.getNumCachedSectionPlanes()!==e&&(this._sectionPlanesState.setNumCachedSectionPlanes(e),this._needRecompile=!0,this.glRedraw())}get numCachedSectionPlanes(){return this._sectionPlanesState.getNumCachedSectionPlanes()}set pbrEnabled(e){this._pbrEnabled=!!e,this.glRedraw()}get pbrEnabled(){return this._pbrEnabled}set dtxEnabled(e){e=!!e,this._dtxEnabled!==e&&(this._dtxEnabled=e)}get dtxEnabled(){return this._dtxEnabled}set colorTextureEnabled(e){this._colorTextureEnabled=!!e,this.glRedraw()}get colorTextureEnabled(){return this._colorTextureEnabled}get markerZOffset(){return null==this._markerZOffset?-.001:this._markerZOffset}doOcclusionTest(){this._needRecompile&&(this._recompile(),this._needRecompile=!1),this._renderer.doOcclusionTest()}render(e){e&&F.runTasks();const t={sceneId:null,pass:0};if(this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),e||this._renderer.needsRender()){t.sceneId=this.id;for(let s=0;s<this._passes;s++)t.pass=s,this.fire("rendering",t,!0),e&&this._renderer.imageDirty(),this._renderer.render(s,this._clearEachPass||0===s),this.fire("rendered",t,!0);this._saveAmbientColor()}}compile(){this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1)}_recompile(){for(const e in this._compilables)this._compilables.hasOwnProperty(e)&&this._compilables[e].compile();this._renderer.shadowsDirty(),this.fire("compile",this,!0)}_saveAmbientColor(){const e=this.canvas;if(e.transparent||e.backgroundImage||e.backgroundColor)this._lastAmbientColor=null;else{const t=this._lightsState.getAmbientColorAndIntensity();this._lastAmbientColor&&this._lastAmbientColor[0]===t[0]&&this._lastAmbientColor[1]===t[1]&&this._lastAmbientColor[2]===t[2]&&this._lastAmbientColor[3]===t[3]||(e.backgroundColor=t,this._lastAmbientColor||(this._lastAmbientColor=h.vec4([0,0,0,1])),this._lastAmbientColor.set(t))}}get modelIds(){return this._modelIds||(this._modelIds=Object.keys(this.models)),this._modelIds}get numObjects(){return this._numObjects}get objectIds(){return this._objectIds||(this._objectIds=Object.keys(this.objects)),this._objectIds}get numVisibleObjects(){return this._numVisibleObjects}get visibleObjectIds(){return this._visibleObjectIds||(this._visibleObjectIds=Object.keys(this.visibleObjects)),this._visibleObjectIds}get numXRayedObjects(){return this._numXRayedObjects}get xrayedObjectIds(){return this._xrayedObjectIds||(this._xrayedObjectIds=Object.keys(this.xrayedObjects)),this._xrayedObjectIds}get numHighlightedObjects(){return this._numHighlightedObjects}get highlightedObjectIds(){return this._highlightedObjectIds||(this._highlightedObjectIds=Object.keys(this.highlightedObjects)),this._highlightedObjectIds}get numSelectedObjects(){return this._numSelectedObjects}get selectedObjectIds(){return this._selectedObjectIds||(this._selectedObjectIds=Object.keys(this.selectedObjects)),this._selectedObjectIds}get numColorizedObjects(){return this._numColorizedObjects}get colorizedObjectIds(){return this._colorizedObjectIds||(this._colorizedObjectIds=Object.keys(this.colorizedObjects)),this._colorizedObjectIds}get opacityObjectIds(){return this._opacityObjectIds||(this._opacityObjectIds=Object.keys(this.opacityObjects)),this._opacityObjectIds}get offsetObjectIds(){return this._offsetObjectIds||(this._offsetObjectIds=Object.keys(this.offsetObjects)),this._offsetObjectIds}set ticksPerRender(e){null==e?e=1:(!_.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerRender': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._ticksPerRender&&(this._ticksPerRender=e)}get ticksPerRender(){return this._ticksPerRender}set ticksPerOcclusionTest(e){null==e?e=20:(!_.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'ticksPerOcclusionTest': '"+e+"' - should be an integer greater than zero."),e=20),e!==this._ticksPerOcclusionTest&&(this._ticksPerOcclusionTest=e)}get ticksPerOcclusionTest(){return this._ticksPerOcclusionTest}set passes(e){null==e?e=1:(!_.isNumeric(e)||e<=0)&&(this.error("Unsupported value for 'passes': '"+e+"' - should be an integer greater than zero."),e=1),e!==this._passes&&(this._passes=e,this.glRedraw())}get passes(){return this._passes}set clearEachPass(e){(e=!!e)!==this._clearEachPass&&(this._clearEachPass=e,this.glRedraw())}get clearEachPass(){return this._clearEachPass}set gammaInput(e){(e=!1!==e)!==this._renderer.gammaInput&&(this._renderer.gammaInput=e,this._needRecompile=!0,this.glRedraw())}get gammaInput(){return this._renderer.gammaInput}set gammaOutput(e){(e=!!e)!==this._renderer.gammaOutput&&(this._renderer.gammaOutput=e,this._needRecompile=!0,this.glRedraw())}get gammaOutput(){return this._renderer.gammaOutput}set gammaFactor(e){(e=null==e?2.2:e)!==this._renderer.gammaFactor&&(this._renderer.gammaFactor=e,this.glRedraw())}get gammaFactor(){return this._renderer.gammaFactor}get geometry(){return this.components["default.geometry"]||be(pe)}get material(){return this.components["default.material"]||new bt(this,{id:"default.material",emissive:[.4,.4,.4],dontClear:!0})}get xrayMaterial(){return this.components["default.xrayMaterial"]||new Nt(this,{id:"default.xrayMaterial",fill:!0,fillColor:[.970588207244873,.7965892553329468,.6660899519920349],fillAlpha:.4,edges:!0,edgeColor:[.529411792755127,.4577854573726654,.4100345969200134],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get highlightMaterial(){return this.components["default.highlightMaterial"]||new Nt(this,{id:"default.highlightMaterial",fill:!0,fillColor:[1,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get selectedMaterial(){return this.components["default.selectedMaterial"]||new Nt(this,{id:"default.selectedMaterial",fill:!0,fillColor:[0,1,0],fillAlpha:.5,edges:!0,edgeColor:[1,1,1],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get edgeMaterial(){return this.components["default.edgeMaterial"]||new jt(this,{id:"default.edgeMaterial",fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1,dontClear:!0})}get pointsMaterial(){return this.components["default.pointsMaterial"]||new kn(this,{id:"default.pointsMaterial",fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1,dontClear:!0})}get linesMaterial(){return this.components["default.linesMaterial"]||new Rn(this,{id:"default.linesMaterial",fill:!0,fillColor:[.4,.4,.4],fillAlpha:.2,edges:!0,edgeColor:[.2,.2,.2],edgeAlpha:.5,edgeWidth:1,dontClear:!0})}get viewport(){return this._viewport}get camera(){return this._camera}get center(){if(this._aabbDirty||!this._center){const e=this.aabb;this._center||(this._center=h.vec3()),this._center[0]=(e[0]+e[3])/2,this._center[1]=(e[1]+e[4])/2,this._center[2]=(e[2]+e[5])/2}return this._center}get aabb(){if(this._aabbDirty){this._aabb||(this._aabb=h.AABB3());let e,t=h.MAX_DOUBLE,s=h.MAX_DOUBLE,i=h.MAX_DOUBLE,r=h.MIN_DOUBLE,n=h.MIN_DOUBLE,A=h.MIN_DOUBLE;const o=this._collidables;let a,l=!1;for(const c in o)if(o.hasOwnProperty(c)){if(a=o[c],!1===a.collidable)continue;e=a.aabb,e[0]<t&&(t=e[0]),e[1]<s&&(s=e[1]),e[2]<i&&(i=e[2]),e[3]>r&&(r=e[3]),e[4]>n&&(n=e[4]),e[5]>A&&(A=e[5]),l=!0}l||(t=-100,s=-100,i=-100,r=100,n=100,A=100),this._aabb[0]=t,this._aabb[1]=s,this._aabb[2]=i,this._aabb[3]=r,this._aabb[4]=n,this._aabb[5]=A,this._aabbDirty=!1,this._center=null}return this._aabb}_setAABBDirty(){this._aabbDirty=!0,this.fire("boundary")}pick(e,t){if(!this.canvas)return this.error("Picking not allowed on a destroyed Scene"),null;if(0===this.canvas.boundary[2]||0===this.canvas.boundary[3])return this.error("Picking not allowed while canvas has zero width or height"),null;(e=e||{}).pickSurface=e.pickSurface||e.rayPick,e.canvasPos||e.matrix||e.origin&&e.direction||this.warn("picking without canvasPos, matrix, or ray origin and direction");const s=e.includeEntities||e.include;s&&(e.includeEntityIds=bA(this,s));const i=e.excludeEntities||e.exclude;return i&&(e.excludeEntityIds=bA(this,i)),this._needRecompile&&(this._recompile(),this._renderer.imageDirty(),this._needRecompile=!1),(t=e.snapToEdge||e.snapToVertex?this._renderer.snapPick(e,t):this._renderer.pick(e,t))&&t.entity&&t.entity.fire&&t.entity.fire("picked",t),t}snapPick(e){return this.canvas?(void 0===this._warnSnapPickDeprecated&&(this._warnSnapPickDeprecated=!0,this.warn("Scene.snapPick() is deprecated since v2.4.2 - use Scene.pick() instead")),e.canvasPos?this._renderer.snapPick(e):void this.error("Scene.snapPick() canvasPos parameter expected")):(this.error("Picking not allowed on a destroyed Scene"),null)}clear(){var e;for(const t in this.components)this.components.hasOwnProperty(t)&&((e=this.components[t])._dontClear||e.destroy())}clearLights(){const e=Object.keys(this.lights);for(let t=0,s=e.length;t<s;t++)this.lights[e[t]].destroy()}clearSectionPlanes(){const e=Object.keys(this.sectionPlanes);for(let t=0,s=e.length;t<s;t++)this.sectionPlanes[e[t]].destroy()}clearBitmaps(){const e=Object.keys(this.bitmaps);for(let t=0,s=e.length;t<s;t++)this.bitmaps[e[t]].destroy()}clearLines(){const e=Object.keys(this.lineSets);for(let t=0,s=e.length;t<s;t++)this.lineSets[e[t]].destroy()}getAABB(e){if(void 0===e)return this.aabb;if(_.isString(e)){const t=this.objects[e];if(t&&t.aabb)return t.aabb;e=[e]}if(0===e.length)return this.aabb;let t,s=h.MAX_DOUBLE,i=h.MAX_DOUBLE,r=h.MAX_DOUBLE,n=h.MIN_DOUBLE,A=h.MIN_DOUBLE,o=h.MIN_DOUBLE;if(this.withObjects(e,(e=>{if(e.collidable){const a=e.aabb;a[0]<s&&(s=a[0]),a[1]<i&&(i=a[1]),a[2]<r&&(r=a[2]),a[3]>n&&(n=a[3]),a[4]>A&&(A=a[4]),a[5]>o&&(o=a[5]),t=!0}})),t){const e=h.AABB3();return e[0]=s,e[1]=i,e[2]=r,e[3]=n,e[4]=A,e[5]=o,e}return this.aabb}setObjectsVisible(e,t){return this.withObjects(e,(e=>{const s=e.visible!==t;return e.visible=t,s}))}setObjectsCollidable(e,t){return this.withObjects(e,(e=>{const s=e.collidable!==t;return e.collidable=t,s}))}setObjectsCulled(e,t){return this.withObjects(e,(e=>{const s=e.culled!==t;return e.culled=t,s}))}setObjectsSelected(e,t){return this.withObjects(e,(e=>{const s=e.selected!==t;return e.selected=t,s}))}setObjectsHighlighted(e,t){return this.withObjects(e,(e=>{const s=e.highlighted!==t;return e.highlighted=t,s}))}setObjectsXRayed(e,t){return this.withObjects(e,(e=>{const s=e.xrayed!==t;return e.xrayed=t,s}))}setObjectsEdges(e,t){return this.withObjects(e,(e=>{const s=e.edges!==t;return e.edges=t,s}))}setObjectsColorized(e,t){return this.withObjects(e,(e=>{e.colorize=t}))}setObjectsOpacity(e,t){return this.withObjects(e,(e=>{const s=e.opacity!==t;return e.opacity=t,s}))}setObjectsPickable(e,t){return this.withObjects(e,(e=>{const s=e.pickable!==t;return e.pickable=t,s}))}setObjectsOffset(e,t){this.withObjects(e,(e=>{e.offset=t}))}withObjects(e,t){_.isString(e)&&(e=[e]);let s=!1;for(let i=0,r=e.length;i<r;i++){const r=e[i];let n=this.objects[r];if(n)s=t(n)||s;else{const e=this.modelIds;for(let i=0,A=e.length;i<A;i++){const A=e[i],o=h.globalizeObjectId(A,r);n=this.objects[o],n&&(s=t(n)||s)}}}return s}tickify(e){const t=e.toString();if(t in this._tickifiedFunctions)return this._tickifiedFunctions[t].wrapperFunc;let s,i=0,r=0;const n=function(...e){s=e,r++},A=this.on("tick",(()=>{r>i&&(i=r,e(...s))}));return this._tickifiedFunctions[t]={tickSubId:A,wrapperFunc:n},n}destroy(){super.destroy(),this._removeWebglcontextlostListener();for(const e in this.components)this.components.hasOwnProperty(e)&&this.components[e].destroy();this._sectionCaps.destroy(),this.canvas.gl=null,this.components=null,this.models=null,this.objects=null,this.visibleObjects=null,this.xrayedObjects=null,this.highlightedObjects=null,this.selectedObjects=null,this.colorizedObjects=null,this.opacityObjects=null,this.sectionPlanes=null,this.lights=null,this.lightMaps=null,this.reflectionMaps=null,this._objectIds=null,this._visibleObjectIds=null,this._xrayedObjectIds=null,this._highlightedObjectIds=null,this._selectedObjectIds=null,this._colorizedObjectIds=null,this._sectionCaps=null,this.types=null,this.components=null,this.canvas=null,this._renderer=null,this.input=null,this._viewport=null,this._camera=null}}const yA=h.vec4(),wA=h.vec4(),vA=h.vec3(),CA=h.vec3(),MA=h.vec3(),EA=h.vec4(),FA=h.vec4(),xA=h.vec4();class UA{constructor(e){this._scene=e}dollyToCanvasPos(e,t,s){let i=!1;const r=this._scene.camera;if(e){const t=h.subVec3(e,r.eye,vA);i=h.lenVec3(t)<s}if("perspective"===r.projection){r.ortho.scale=r.ortho.scale-s;const i=this._unproject(t,EA),n=h.subVec3(i,r.eye,xA),A=h.mulVec3Scalar(h.normalizeVec3(n),-s,[]);if(r.eye=[r.eye[0]-A[0],r.eye[1]-A[1],r.eye[2]-A[2]],r.look=[r.look[0]-A[0],r.look[1]-A[1],r.look[2]-A[2]],e){const t=h.subVec3(e,r.eye,vA),s=h.lenVec3(t),i=h.mulVec3Scalar(h.normalizeVec3(h.subVec3(r.look,r.eye,CA)),s);r.look=[r.eye[0]+i[0],r.eye[1]+i[1],r.eye[2]+i[2]]}}else if("ortho"===r.projection){const e=this._unproject(t,EA);r.ortho.scale=r.ortho.scale-s,r.ortho._update();const i=this._unproject(t,FA),n=h.subVec3(i,e,xA),A=h.mulVec3Scalar(h.normalizeVec3(h.subVec3(r.look,r.eye,vA)),-s,CA),o=h.addVec3(n,A,MA);r.eye=[r.eye[0]-o[0],r.eye[1]-o[1],r.eye[2]-o[2]],r.look=[r.look[0]-o[0],r.look[1]-o[1],r.look[2]-o[2]]}return i}_unproject(e,t){const s=this._scene.camera,i=s.project.transposedMatrix,r=i.subarray(8,12),n=i.subarray(12),A=[0,0,-1,1],o=h.dotVec4(A,r)/h.dotVec4(A,n);return s.project.unproject(e,o,yA,wA,t),t}destroy(){}}const IA=h.vec3(),TA=h.vec3(),PA=h.vec3(),SA=h.vec4(),DA=h.vec4(),kA=h.vec4(),QA=Math.PI-.001;class RA{constructor(e,t){this._scene=e,this._configs=t,this._pivotWorldPos=h.vec3(),this._cameraOffset=h.vec3(),this._azimuth=0,this._polar=0,this._radius=0,this._pivotPosSet=!1,this._pivoting=!1,this._shown=!1,this._pivotSphereEnabled=!1,this._pivotSphere=null,this._pivotSphereSize=1,this._pivotSphereGeometry=null,this._pivotSphereMaterial=null,this._rtcCenter=h.vec3(),this._rtcPos=h.vec3(),this._pivotViewPos=h.vec4(),this._pivotProjPos=h.vec4(),this._pivotCanvasPos=h.vec2(),this._cameraDirty=!0,this._onViewMatrix=this._scene.camera.on("viewMatrix",(()=>{this._cameraDirty=!0})),this._onProjMatrix=this._scene.camera.on("projMatrix",(()=>{this._cameraDirty=!0})),this._onTick=this._scene.on("tick",(()=>{this.updatePivotElement(),this.updatePivotSphere()}))}createPivotSphere(){const e=this.getPivotPos(),t=h.vec3();h.decomposeMat4(h.inverseMat4(this._scene.viewer.camera.viewMatrix,h.mat4()),t,h.vec4(),h.vec3());const s=h.distVec3(t,e);let i=Math.tan(Math.PI/500)*s*this._pivotSphereSize;"ortho"==this._scene.camera.projection&&(i/=this._scene.camera.ortho.scale/2),Ne(e,this._rtcCenter,this._rtcPos),this._pivotSphereGeometry=new me(this._scene,Ce({radius:i})),this._pivotSphere=new dt(this._scene,{geometry:this._pivotSphereGeometry,material:this._pivotSphereMaterial,pickable:!1,position:this._rtcPos,rtcCenter:this._rtcCenter})}destroyPivotSphere(){this._pivotSphere&&(this._pivotSphere.destroy(),this._pivotSphere=null),this._pivotSphereGeometry&&(this._pivotSphereGeometry.destroy(),this._pivotSphereGeometry=null)}updatePivotElement(){const e=this._scene.camera,t=this._scene.canvas;if(this._pivoting&&this._cameraDirty){h.transformPoint3(e.viewMatrix,this.getPivotPos(),this._pivotViewPos),this._pivotViewPos[3]=1,h.transformPoint4(e.projMatrix,this._pivotViewPos,this._pivotProjPos);const s=t.boundary,i=s[2],r=s[3];this._pivotCanvasPos[0]=Math.floor((1+this._pivotProjPos[0]/this._pivotProjPos[3])*i/2),this._pivotCanvasPos[1]=Math.floor((1-this._pivotProjPos[1]/this._pivotProjPos[3])*r/2);let n=t._lastBoundingClientRect;if(!n||t._canvasSizeChanged){const e=t.canvas;n=t._lastBoundingClientRect=e.getBoundingClientRect()}this._pivotElement&&(this._pivotElement.style.left=Math.floor(n.left+this._pivotCanvasPos[0])-this._pivotElement.clientWidth/2+window.scrollX+"px",this._pivotElement.style.top=Math.floor(n.top+this._pivotCanvasPos[1])-this._pivotElement.clientHeight/2+window.scrollY+"px"),this._cameraDirty=!1}}updatePivotSphere(){this._pivoting&&this._pivotSphere&&(Ne(this.getPivotPos(),this._rtcCenter,this._rtcPos),h.compareVec3(this._rtcPos,this._pivotSphere.position)||(this.destroyPivotSphere(),this.createPivotSphere()))}setPivotElement(e){this._pivotElement=e}enablePivotSphere(e={}){this.destroyPivotSphere(),this._pivotSphereEnabled=!0,e.size&&(this._pivotSphereSize=e.size);const t=e.color||[1,0,0];this._pivotSphereMaterial=new bt(this._scene,{emissive:t,ambient:t,specular:[0,0,0],diffuse:[0,0,0]})}disablePivotSphere(){this.destroyPivotSphere(),this._pivotSphereEnabled=!1}startPivot(){const e=this._scene.camera;let t=h.lookAtMat4v(e.eye,e.look,e.up);h.transformPoint3(t,this.getPivotPos(),this._cameraOffset);const s=this.getPivotPos();this._cameraOffset[2]+=h.distVec3(e.eye,s),t=h.inverseMat4(t);const i=h.transformVec3(t,this._cameraOffset),r=h.vec3();if(h.subVec3(e.eye,s,r),h.addVec3(r,i),e.zUp){const e=r[1];r[1]=r[2],r[2]=e}this._radius=h.lenVec3(r),this._polar=Math.acos(r[1]/this._radius),this._azimuth=Math.atan2(r[0],r[2]),this._pivoting=!0}_cameraLookingDownwards(){const e=this._scene.camera,t=h.normalizeVec3(h.subVec3(e.look,e.eye,IA)),s=h.cross3Vec3(t,e.worldUp,TA);return h.sqLenVec3(s)<=1e-4}getPivoting(){return this._pivoting}setPivotPos(e){this._pivotWorldPos.set(e),this._pivotPosSet=!0}setCanvasPivotPos(e){const t=this._scene.camera,s=Math.abs(h.distVec3(this._scene.center,t.eye)),i=t.project.transposedMatrix,r=i.subarray(8,12),n=i.subarray(12),A=[0,0,-1,1],o=h.dotVec4(A,r)/h.dotVec4(A,n),a=SA;t.project.unproject(e,o,DA,kA,a);const l=h.normalizeVec3(h.subVec3(a,t.eye,IA)),c=h.addVec3(t.eye,h.mulVec3Scalar(l,s,TA),PA);this.setPivotPos(c)}getPivotPos(){return this._pivotPosSet?this._pivotWorldPos:this._scene.camera.look}continuePivot(e,t){if(!this._pivoting)return;if(0===e&&0===t)return;const s=this._scene.camera;var i=-e;const r=-t;1===s.worldUp[2]&&(i=-i),this._azimuth+=.01*-i;const n=r<0,A=r>0,o=Math.abs(this._polar-.001)<.005,a=Math.abs(this._polar-QA)<.005;let l=this._polar+.01*r;l=o&&n?.001:a&&A?QA:h.clamp(l,.001,QA),this._polar=l;const c=[this._radius*Math.sin(this._polar)*Math.sin(this._azimuth),this._radius*Math.cos(this._polar),this._radius*Math.sin(this._polar)*Math.cos(this._azimuth)];if(1===s.worldUp[2]){const e=c[1];c[1]=c[2],c[2]=e}const u=h.lenVec3(h.subVec3(s.look,s.eye,h.vec3())),d=this.getPivotPos();h.addVec3(c,d);let p=h.lookAtMat4v(c,d,s.worldUp);p=h.inverseMat4(p);const f=h.transformVec3(p,this._cameraOffset);p[12]-=f[0],p[13]-=f[1],p[14]-=f[2];const g=[p[8],p[9],p[10]];s.eye=[p[12],p[13],p[14]],h.subVec3(s.eye,h.mulVec3Scalar(g,u),s.look),s.up=[p[4],p[5],p[6]],this.showPivot()}showPivot(){this._shown||(this._pivotElement&&(this.updatePivotElement(),this._pivotElement.style.visibility="visible"),this._pivotSphereEnabled&&(this.destroyPivotSphere(),this.createPivotSphere()),this._shown=!0)}hidePivot(){this._shown&&(this._pivotElement&&(this._pivotElement.style.visibility="hidden"),this._pivotSphereEnabled&&this.destroyPivotSphere(),this._shown=!1)}endPivot(){this._pivoting=!1}destroy(){this.destroyPivotSphere(),this._scene.camera.off(this._onViewMatrix),this._scene.camera.off(this._onProjMatrix),this._scene.off(this._onTick)}}class OA{constructor(e,t){this._scene=e.scene,this._cameraControl=e,this._scene.canvas.canvas.oncontextmenu=function(e){e.preventDefault()},this._configs=t,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.scheduleSnapOrPick=!1,this.pickCursorPos=h.vec2(),this.picked=!1,this.pickedSurface=!1,this.pickResult=null,this._lastPickedEntityId=null,this._lastHash=null,this._needFireEvents=0}update(){if(!this._configs.pointerEnabled)return;if(!this.schedulePickEntity&&!this.schedulePickSurface)return;const e=`${~~this.pickCursorPos[0]}-${~~this.pickCursorPos[1]}-${this.scheduleSnapOrPick}-${this.schedulePickSurface}-${this.schedulePickEntity}`;if(this._lastHash===e)return;this.picked=!1,this.pickedSurface=!1,this.snappedOrPicked=!1,this.hoveredSnappedOrSurfaceOff=!1;const t=this._cameraControl.hasSubs("hoverSurface");if(this.scheduleSnapOrPick){const e=this._scene.pick({canvasPos:this.pickCursorPos,snapRadius:this._configs.snapRadius,snapToVertex:this._configs.snapToVertex,snapToEdge:this._configs.snapToEdge});e&&(e.snappedToEdge||e.snappedToVertex)?(this.snapPickResult=e,this.snappedOrPicked=!0,this._needFireEvents++):(this.schedulePickSurface=!0,this.snapPickResult=null)}if(this.schedulePickSurface&&this.pickResult&&this.pickResult.worldPos){const e=this.pickResult.canvasPos;if(e[0]===this.pickCursorPos[0]&&e[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!0,this._needFireEvents+=t?1:0,this.schedulePickEntity=!1,this.schedulePickSurface=!1,this.scheduleSnapOrPick?this.snappedOrPicked=!0:this.hoveredSnappedOrSurfaceOff=!0,void(this.scheduleSnapOrPick=!1)}if(this.schedulePickEntity&&this.pickResult&&(this.pickResult.canvasPos||this.pickResult.snappedCanvasPos)){const e=this.pickResult.canvasPos||this.pickResult.snappedCanvasPos;if(e[0]===this.pickCursorPos[0]&&e[1]===this.pickCursorPos[1])return this.picked=!0,this.pickedSurface=!1,this.schedulePickEntity=!1,void(this.schedulePickSurface=!1)}this.schedulePickSurface||this.scheduleSnapOrPick&&!this.snapPickResult?(this.pickResult=this._scene.pick({pickSurface:!0,pickSurfaceNormal:!1,canvasPos:this.pickCursorPos}),this.pickResult?(this.picked=!0,this.scheduleSnapOrPick?this.snappedOrPicked=!0:this.pickedSurface=!0,this._needFireEvents++):this.scheduleSnapOrPick&&(this.hoveredSnappedOrSurfaceOff=!0,this._needFireEvents++)):(this.pickResult=this._scene.pick({canvasPos:this.pickCursorPos}),this.pickResult&&(this.picked=!0,this.pickedSurface=!1,this._needFireEvents++)),this.scheduleSnapOrPick=!1,this.schedulePickEntity=!1,this.schedulePickSurface=!1}fireEvents(){if(0!==this._needFireEvents){if(this.hoveredSnappedOrSurfaceOff&&this._cameraControl.fire("hoverSnapOrSurfaceOff",{canvasPos:this.pickCursorPos,pointerPos:this.pickCursorPos},!0),this.snappedOrPicked)if(this.snapPickResult){const e=new Gr;e.entity=this.snapPickResult.entity,e.snappedToVertex=this.snapPickResult.snappedToVertex,e.snappedToEdge=this.snapPickResult.snappedToEdge,e.worldPos=this.snapPickResult.worldPos,e.canvasPos=this.pickCursorPos,e.snappedCanvasPos=this.snapPickResult.snappedCanvasPos,this._cameraControl.fire("hoverSnapOrSurface",e,!0),this.snapPickResult=null}else this._cameraControl.fire("hoverSnapOrSurface",this.pickResult,!0);if(this.picked&&this.pickResult&&(this.pickResult.entity||this.pickResult.worldPos)){if(this.pickResult.entity){const e=this.pickResult.entity.id;this._lastPickedEntityId!==e&&(void 0!==this._lastPickedEntityId&&this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._cameraControl.fire("hoverEnter",this.pickResult,!0),this._lastPickedEntityId=e)}this._cameraControl.fire("hover",this.pickResult,!0),this.pickResult.worldPos&&(this.pickedSurface=!0,this._cameraControl.fire("hoverSurface",this.pickResult,!0))}else void 0!==this._lastPickedEntityId&&(this._cameraControl.fire("hoverOut",{entity:this._scene.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),this._cameraControl.fire("hoverOff",{canvasPos:this.pickCursorPos},!0);this.pickResult=null,this._needFireEvents=0}}}const VA=h.vec2();class LA{constructor(e,t,s,i,r){this._scene=e;const n=t.pickController,A=t.cameraControl;let o,a,l,c=0,u=0,d=0,p=0,f=!1;const g=h.vec3();let m=!0;const _=this._scene.canvas.canvas,b=[];function B(e=!0){c=i.pointerCanvasPos[0],u=i.pointerCanvasPos[1],d=i.pointerCanvasPos[0],p=i.pointerCanvasPos[1],e&&(n.pickCursorPos=i.pointerCanvasPos,n.schedulePickSurface=!0,n.update(),n.picked&&n.pickedSurface&&n.pickResult&&n.pickResult.worldPos?(f=!0,g.set(n.pickResult.worldPos)):f=!1)}document.addEventListener("keydown",this._documentKeyDownHandler=t=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;const i=t.keyCode;b[i]=!0}),document.addEventListener("keyup",this._documentKeyUpHandler=t=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;const i=t.keyCode;b[i]=!1}),document.addEventListener("visibilitychange",this._onVisibilityChange=()=>{b.splice(0)}),window.addEventListener("blur",this._onBlur=()=>{b.splice(0)}),_.addEventListener("mousedown",this._mouseDownHandler=t=>{if(s.active&&s.pointerEnabled)switch(t.which){case 1:b[e.input.KEY_SHIFT]||s.planView?(o=!0,b[e.input.MOUSE_LEFT_BUTTON]=!0,B()):(o=!0,b[e.input.MOUSE_LEFT_BUTTON]=!0,B(!1));break;case 2:a=!0,b[e.input.MOUSE_MIDDLE_BUTTON]=!0,B();break;case 3:l=!0,b[e.input.MOUSE_RIGHT_BUTTON]=!0,s.panRightClick&&B()}}),document.addEventListener("mousemove",this._documentMouseMoveHandler=t=>{if(!s.active||!s.pointerEnabled)return;if(!o&&!a&&!l)return;const n=e.canvas.boundary,d=n[2],p=n[3],m=i.pointerCanvasPos[0],_=i.pointerCanvasPos[1],B=s.planView||A._isKeyDownForAction(A.MOUSE_PAN,b),y=A._isKeyDownForAction(A.MOUSE_ROTATE,b),w=document.pointerLockElement?t.movementX:m-c,v=document.pointerLockElement?t.movementY:_-u;if(B){const t=e.camera;if("perspective"===t.projection){const s=Math.abs(f?h.lenVec3(h.subVec3(g,e.camera.eye,[])):e.camera.eyeLookDist)*Math.tan(t.perspective.fov/2*Math.PI/180);r.panDeltaX+=1.5*w*s/p,r.panDeltaY+=1.5*v*s/p}else r.panDeltaX+=.5*t.ortho.scale*(w/p),r.panDeltaY+=.5*t.ortho.scale*(v/p)}else y&&(s.planView||(s.firstPerson?(r.rotateDeltaY-=w/d*s.dragRotationRate/2,r.rotateDeltaX+=v/p*(s.dragRotationRate/4)):(r.rotateDeltaY-=w/d*(1.5*s.dragRotationRate),r.rotateDeltaX+=v/p*(1.5*s.dragRotationRate))));c=m,u=_}),_.addEventListener("mousemove",this._canvasMouseMoveHandler=e=>{s.active&&s.pointerEnabled&&i.mouseover&&(m=!0)}),document.addEventListener("mouseup",this._documentMouseUpHandler=t=>{if(s.active&&s.pointerEnabled)switch(t.which){case 1:case 2:case 3:o=!1,a=!1,l=!1,b[e.input.MOUSE_LEFT_BUTTON]=!1,b[e.input.MOUSE_MIDDLE_BUTTON]=!1,b[e.input.MOUSE_RIGHT_BUTTON]=!1}}),_.addEventListener("mouseup",this._mouseUpHandler=e=>{if(s.active&&s.pointerEnabled){if(3===e.which){!function(e,t){if(e){let s=e.target,i=0,r=0,n=0,A=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,n+=s.scrollLeft,A+=s.scrollTop,s=s.offsetParent;t[0]=e.pageX+n-i,t[1]=e.pageY+A-r}else e=window.event,t[0]=e.x,t[1]=e.y}(e,VA);const s=VA[0],i=VA[1];Math.abs(s-d)<3&&Math.abs(i-p)<3&&t.cameraControl.fire("rightClick",{pagePos:[Math.round(e.pageX),Math.round(e.pageY)],canvasPos:VA,event:e},!0)}_.style.removeProperty("cursor")}}),_.addEventListener("mouseenter",this._mouseEnterHandler=()=>{s.active&&s.pointerEnabled});const y=1/60;let w=null;_.addEventListener("wheel",this._mouseWheelHandler=e=>{if(!(s.active&&s.pointerEnabled&&s.zoomOnMouseWheel&&A._isKeyDownForAction(A.MOUSE_DOLLY,b)))return;const t=performance.now()/1e3;var n=null!==w?t-w:0;w=t,n>.05&&(n=.05),n<y&&(n=y);const o=Math.max(-1,Math.min(1,40*-e.deltaY));if(0===o)return;const a=o/Math.abs(o);r.dollyDelta+=-a*n*s.mouseWheelDollyRate,m&&(i.followPointerDirty=!0,m=!1)},{passive:!0})}reset(){}destroy(){const e=this._scene.canvas.canvas;document.removeEventListener("keydown",this._documentKeyDownHandler),document.removeEventListener("keyup",this._documentKeyUpHandler),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("blur",this._onBlur),e.removeEventListener("mousedown",this._mouseDownHandler),document.removeEventListener("mousemove",this._documentMouseMoveHandler),e.removeEventListener("mousemove",this._canvasMouseMoveHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._mouseUpHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("wheel",this._mouseWheelHandler)}}const HA=h.vec3(),NA=h.vec3(),GA=h.vec3(),jA=h.vec3(),WA=h.vec3(),zA={eye:h.vec3(),look:h.vec3(),up:h.vec3()};class XA{constructor(e,t,s,i){this._scene=e;const r=t.cameraControl,n=e.camera;this._onSceneKeyDown=e.input.on("keydown",(()=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;if(s.keyboardEnabledOnlyIfMouseover&&!i.mouseover)return;const A=r._isKeyDownForAction(r.AXIS_VIEW_RIGHT),o=r._isKeyDownForAction(r.AXIS_VIEW_BACK),a=r._isKeyDownForAction(r.AXIS_VIEW_LEFT),l=r._isKeyDownForAction(r.AXIS_VIEW_FRONT),c=r._isKeyDownForAction(r.AXIS_VIEW_TOP),u=r._isKeyDownForAction(r.AXIS_VIEW_BOTTOM);if(!(A||o||a||l||c||u))return;const d=e.aabb,p=h.getAABB3Diag(d);h.getAABB3Center(d,HA);const f=Math.abs(p/Math.tan(t.cameraFlight.fitFOV*h.DEGTORAD)),g=1.1*p;zA.orthoScale=g,A?(zA.eye.set(h.addVec3(HA,h.mulVec3Scalar(n.worldRight,f,NA),WA)),zA.look.set(HA),zA.up.set(n.worldUp)):o?(zA.eye.set(h.addVec3(HA,h.mulVec3Scalar(n.worldForward,f,NA),WA)),zA.look.set(HA),zA.up.set(n.worldUp)):a?(zA.eye.set(h.addVec3(HA,h.mulVec3Scalar(n.worldRight,-f,NA),WA)),zA.look.set(HA),zA.up.set(n.worldUp)):l?(zA.eye.set(h.addVec3(HA,h.mulVec3Scalar(n.worldForward,-f,NA),WA)),zA.look.set(HA),zA.up.set(n.worldUp)):c?(zA.eye.set(h.addVec3(HA,h.mulVec3Scalar(n.worldUp,f,NA),WA)),zA.look.set(HA),zA.up.set(h.normalizeVec3(h.mulVec3Scalar(n.worldForward,1,GA),jA))):u&&(zA.eye.set(h.addVec3(HA,h.mulVec3Scalar(n.worldUp,-f,NA),WA)),zA.look.set(HA),zA.up.set(h.normalizeVec3(h.mulVec3Scalar(n.worldForward,-1,GA)))),!s.firstPerson&&s.followPointer&&t.pivotController.setPivotPos(HA),t.cameraFlight.duration>0?t.cameraFlight.flyTo(zA,(()=>{t.pivotController.getPivoting()&&s.followPointer&&t.pivotController.showPivot()})):(t.cameraFlight.jumpTo(zA),t.pivotController.getPivoting()&&s.followPointer&&t.pivotController.showPivot())}))}reset(){}destroy(){this._scene.input.off(this._onSceneKeyDown)}}class KA{constructor(e,t,s,i,r){this._scene=e;const n=t.pickController,A=t.pivotController,o=t.cameraControl;this._clicks=0,this._timeout=null,this._lastPickedEntityId=null,this._lastClickedWorldPos=null;let a=!1,l=!1;const c=this._scene.canvas.canvas,u=s=>{let i;s&&s.worldPos&&(i=s.worldPos);const r=s&&s.entity?s.entity.aabb:e.aabb;if(i){const s=e.camera;h.subVec3(s.eye,s.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})},d=e.tickify(this._canvasMouseMoveHandler=t=>{if(!s.active||!s.pointerEnabled)return;if(a||l)return;if(o.hasSubs("rayMove")){const t=h.vec3(),s=h.vec3();h.canvasPosToWorldRay(e.canvas.canvas,e.camera.viewMatrix,e.camera.projMatrix,e.camera.projection,i.pointerCanvasPos,t,s),o.fire("rayMove",{canvasPos:i.pointerCanvasPos,ray:{origin:t,direction:s,canvasPos:i.pointerCanvasPos}},!0)}const r=o.hasSubs("hover"),A=o.hasSubs("hoverEnter"),c=o.hasSubs("hoverOut"),u=o.hasSubs("hoverOff"),d=o.hasSubs("hoverSurface"),p=o.hasSubs("hoverSnapOrSurface");if(r||A||c||u||d||p)if(n.pickCursorPos=i.pointerCanvasPos,n.schedulePickEntity=!0,n.schedulePickSurface=d,n.scheduleSnapOrPick=p,n.update(),n.pickResult){if(n.pickResult.entity){const t=n.pickResult.entity.id;this._lastPickedEntityId!==t&&(void 0!==this._lastPickedEntityId&&o.fire("hoverOut",{entity:e.objects[this._lastPickedEntityId]},!0),o.fire("hoverEnter",n.pickResult,!0),this._lastPickedEntityId=t)}o.fire("hover",n.pickResult,!0),(n.pickResult.worldPos||n.pickResult.snappedWorldPos)&&o.fire("hoverSurface",n.pickResult,!0)}else void 0!==this._lastPickedEntityId&&(o.fire("hoverOut",{entity:e.objects[this._lastPickedEntityId]},!0),this._lastPickedEntityId=void 0),o.fire("hoverOff",{canvasPos:n.pickCursorPos},!0)});c.addEventListener("mousemove",d),c.addEventListener("mousedown",this._canvasMouseDownHandler=t=>{1===t.which&&(a=!0),3===t.which&&(l=!0);if(1===t.which&&s.active&&s.pointerEnabled&&(i.mouseDownClientX=t.clientX,i.mouseDownClientY=t.clientY,i.mouseDownCursorX=i.pointerCanvasPos[0],i.mouseDownCursorY=i.pointerCanvasPos[1],!s.firstPerson&&s.followPointer&&(n.pickCursorPos=i.pointerCanvasPos,n.schedulePickSurface=!0,n.update(),1===t.which))){const t=n.pickResult;t&&t.worldPos?(A.setPivotPos(t.worldPos),A.startPivot(),this._lastClickedWorldPos=t.worldPos.slice()):(s.smartPivot?A.setCanvasPivotPos(i.pointerCanvasPos):this._lastClickedWorldPos?A.setPivotPos(this._lastClickedWorldPos):A.setPivotPos(e.camera.look),A.startPivot())}}),document.addEventListener("mouseup",this._documentMouseUpHandler=e=>{1===e.which&&(a=!1),3===e.which&&(l=!1),A.getPivoting()&&A.endPivot()}),c.addEventListener("mouseup",this._canvasMouseUpHandler=r=>{if(!s.active||!s.pointerEnabled)return;if(!(1===r.which))return;if(A.hidePivot(),Math.abs(r.clientX-i.mouseDownClientX)>3||Math.abs(r.clientY-i.mouseDownClientY)>3)return;const a=o.hasSubs("picked"),l=o.hasSubs("pickedNothing"),c=o.hasSubs("pickedSurface"),d=o.hasSubs("doublePicked"),p=o.hasSubs("doublePickedSurface"),f=o.hasSubs("doublePickedNothing");if(!(s.doublePickFlyTo||d||p||f))return(a||l||c)&&(n.pickCursorPos=i.pointerCanvasPos,n.schedulePickEntity=!0,n.schedulePickSurface=c,n.update(),n.pickResult?(o.fire("picked",n.pickResult,!0),n.pickedSurface&&o.fire("pickedSurface",n.pickResult,!0)):o.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0)),void(this._clicks=0);if(this._clicks++,1===this._clicks){n.pickCursorPos=i.pointerCanvasPos,n.schedulePickEntity=s.doublePickFlyTo,n.schedulePickSurface=c,n.update();const e=n.pickResult,r=n.pickedSurface;this._timeout=setTimeout((()=>{e?(o.fire("picked",e,!0),r&&(o.fire("pickedSurface",e,!0),!s.firstPerson&&s.followPointer&&(t.pivotController.setPivotPos(e.worldPos),t.pivotController.startPivot()&&t.pivotController.showPivot()))):o.fire("pickedNothing",{canvasPos:i.pointerCanvasPos},!0),this._clicks=0}),s.doubleClickTimeFrame)}else{if(null!==this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null),n.pickCursorPos=i.pointerCanvasPos,n.schedulePickEntity=s.doublePickFlyTo||d||p,n.schedulePickSurface=n.schedulePickEntity&&p,n.update(),n.pickResult){if(o.fire("doublePicked",n.pickResult,!0),n.pickedSurface&&o.fire("doublePickedSurface",n.pickResult,!0),s.doublePickFlyTo&&(u(n.pickResult),!s.firstPerson&&s.followPointer)){const e=n.pickResult.entity.aabb,s=h.getAABB3Center(e);t.pivotController.setPivotPos(s),t.pivotController.startPivot()&&t.pivotController.showPivot()}}else if(o.fire("doublePickedNothing",{canvasPos:i.pointerCanvasPos},!0),s.doublePickFlyTo&&(u(),!s.firstPerson&&s.followPointer)){const s=e.aabb,i=h.getAABB3Center(s);t.pivotController.setPivotPos(i),t.pivotController.startPivot()&&t.pivotController.showPivot()}this._clicks=0}},!1)}reset(){this._clicks=0,this._lastPickedEntityId=null,this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("mousemove",this._canvasMouseMoveHandler),e.removeEventListener("mousedown",this._canvasMouseDownHandler),document.removeEventListener("mouseup",this._documentMouseUpHandler),e.removeEventListener("mouseup",this._canvasMouseUpHandler),this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)}}class ZA{constructor(e,t,s,i,r){this._scene=e;const n=e.input,A=[];e.canvas.canvas;let o=!0;this._onSceneMouseMove=n.on("mousemove",(()=>{o=!0})),this._onSceneKeyDown=n.on("keydown",(t=>{s.active&&s.pointerEnabled&&e.input.keyboardEnabled&&(s.keyboardEnabledOnlyIfMouseover&&!i.mouseover||(A[t]=!0))})),this._onSceneKeyUp=n.on("keyup",(i=>{s.active&&s.pointerEnabled&&e.input.keyboardEnabled&&(A[i]=!1,t.pivotController.getPivoting()&&t.pivotController.endPivot())})),document.addEventListener("visibilitychange",this._onVisibilityChange=()=>{A.splice(0)}),window.addEventListener("blur",this._onBlur=()=>{A.splice(0)}),this._onTick=e.on("tick",(a=>{if(!s.active||!s.pointerEnabled||!e.input.keyboardEnabled)return;if(s.keyboardEnabledOnlyIfMouseover&&!i.mouseover)return;const l=t.cameraControl,c=a.deltaTime/1e3;if(!s.planView){const e=l._isKeyDownForAction(l.ROTATE_Y_POS,A),i=l._isKeyDownForAction(l.ROTATE_Y_NEG,A),n=l._isKeyDownForAction(l.ROTATE_X_POS,A),o=l._isKeyDownForAction(l.ROTATE_X_NEG,A),a=c*s.keyboardRotationRate;(e||i||n||o)&&(!s.firstPerson&&s.followPointer&&t.pivotController.startPivot(),e?r.rotateDeltaY+=a:i&&(r.rotateDeltaY-=a),n?r.rotateDeltaX+=a:o&&(r.rotateDeltaX-=a),!s.firstPerson&&s.followPointer&&t.pivotController.startPivot())}if(!A[n.KEY_CTRL]&&!A[n.KEY_ALT]){const e=l._isKeyDownForAction(l.DOLLY_BACKWARDS,A),n=l._isKeyDownForAction(l.DOLLY_FORWARDS,A);if(e||n){const A=c*s.keyboardDollyRate;!s.firstPerson&&s.followPointer&&t.pivotController.startPivot(),n?r.dollyDelta-=A:e&&(r.dollyDelta+=A),o&&(i.followPointerDirty=!0,o=!1)}}const h=l._isKeyDownForAction(l.PAN_FORWARDS,A),u=l._isKeyDownForAction(l.PAN_BACKWARDS,A),d=l._isKeyDownForAction(l.PAN_LEFT,A),p=l._isKeyDownForAction(l.PAN_RIGHT,A),f=l._isKeyDownForAction(l.PAN_UP,A),g=l._isKeyDownForAction(l.PAN_DOWN,A),m=(A[n.KEY_ALT]?.3:1)*c*s.keyboardPanRate;(h||u||d||p||f||g)&&(!s.firstPerson&&s.followPointer&&t.pivotController.startPivot(),g?r.panDeltaY+=m:f&&(r.panDeltaY+=-m),p?r.panDeltaX+=-m:d&&(r.panDeltaX+=m),u?r.panDeltaZ+=m:h&&(r.panDeltaZ+=-m))}))}reset(){}destroy(){this._scene.off(this._onTick),this._scene.input.off(this._onSceneMouseMove),this._scene.input.off(this._onSceneKeyDown),document.removeEventListener("visibilitychange",this._onVisibilityChange),window.removeEventListener("blur",this._onBlur),this._scene.input.off(this._onSceneKeyUp)}}const JA=h.vec3();class YA{constructor(e,t,s,i,r){this._scene=e;const n=e.camera,A=t.pickController,o=t.pivotController,a=t.panController,l=t.cameraControl;let c=1,u=1,d=null;this._onTick=e.on("tick",(()=>{if(!s.active||!s.pointerEnabled)return;let t="default";if(Math.abs(r.dollyDelta)<.001&&(r.dollyDelta=0),Math.abs(r.rotateDeltaX)<.001&&(r.rotateDeltaX=0),Math.abs(r.rotateDeltaY)<.001&&(r.rotateDeltaY=0),0===r.rotateDeltaX&&0===r.rotateDeltaY||(r.dollyDelta=0),s.followPointer){if(--c<=0&&(c=1,0!==r.dollyDelta)){if(0===r.rotateDeltaY&&0===r.rotateDeltaX&&s.followPointer&&i.followPointerDirty&&(A.pickCursorPos=i.pointerCanvasPos,A.schedulePickSurface=!0,A.update(),A.pickResult&&A.pickResult.worldPos?d=A.pickResult.worldPos:(u=1,d=null),i.followPointerDirty=!1),d){const t=Math.abs(h.lenVec3(h.subVec3(d,e.camera.eye,JA)));u=t/s.dollyProximityThreshold}u<s.dollyMinSpeed&&(u=s.dollyMinSpeed)}}else u=1,d=null;const p=r.dollyDelta*u;if(0===r.rotateDeltaY&&0===r.rotateDeltaX||(!s.firstPerson&&s.followPointer&&o.getPivoting()?(o.continuePivot(r.rotateDeltaY,r.rotateDeltaX),o.showPivot()):(0!==r.rotateDeltaX&&(s.firstPerson?n.pitch(-r.rotateDeltaX):n.orbitPitch(r.rotateDeltaX)),0!==r.rotateDeltaY&&(s.firstPerson?n.yaw(r.rotateDeltaY):n.orbitYaw(r.rotateDeltaY))),r.rotateDeltaX*=s.rotationInertia,r.rotateDeltaY*=s.rotationInertia,t=l._cursors.rotate),Math.abs(r.panDeltaX)<.001&&(r.panDeltaX=0),Math.abs(r.panDeltaY)<.001&&(r.panDeltaY=0),Math.abs(r.panDeltaZ)<.001&&(r.panDeltaZ=0),0!==r.panDeltaX||0!==r.panDeltaY||0!==r.panDeltaZ){const e=h.vec3();let i,A;if(e[0]=r.panDeltaX,e[1]=r.panDeltaY,e[2]=r.panDeltaZ,s.constrainVertical){n.xUp?(i=n.eye[0],A=n.look[0]):n.yUp?(i=n.eye[1],A=n.look[1]):n.zUp&&(i=n.eye[2],A=n.look[2]),n.pan(e);const t=n.eye,s=n.look;n.xUp?(t[0]=i,s[0]=A):n.yUp?(t[1]=i,s[1]=A):n.zUp&&(t[2]=i,s[2]=A),n.eye=t,n.look=s}else n.pan(e);t=l._cursors.pan}if(r.panDeltaX*=s.panInertia,r.panDeltaY*=s.panInertia,r.panDeltaZ*=s.panInertia,0!==p){if(t=p<0?l._cursors.dollyForward:l._cursors.dollyBackward,s.firstPerson){let e,t;if(s.constrainVertical&&(n.xUp?(e=n.eye[0],t=n.look[0]):n.yUp?(e=n.eye[1],t=n.look[1]):n.zUp&&(e=n.eye[2],t=n.look[2])),s.followPointer){a.dollyToCanvasPos(d,i.pointerCanvasPos,-p)&&(i.followPointerDirty=!0)}else n.pan([0,0,p]),n.ortho.scale=n.ortho.scale-p;if(s.constrainVertical){const s=n.eye,i=n.look;n.xUp?(s[0]=e,i[0]=t):n.yUp?(s[1]=e,i[1]=t):n.zUp&&(s[2]=e,i[2]=t),n.eye=s,n.look=i}}else if(s.planView)if(s.followPointer){a.dollyToCanvasPos(d,i.pointerCanvasPos,-p)&&(i.followPointerDirty=!0)}else n.ortho.scale=n.ortho.scale+p,n.zoom(p);else if(s.followPointer){a.dollyToCanvasPos(d,i.pointerCanvasPos,-p)&&(i.followPointerDirty=!0)}else n.ortho.scale=n.ortho.scale+p,n.zoom(p);r.dollyDelta*=s.dollyInertia}A.fireEvents(),document.body.style.cursor=t}))}destroy(){this._scene.off(this._onTick)}}class $A{constructor(e,t,s,i,r){this._scene=e;const n=this._scene.canvas.canvas;n.addEventListener("mouseenter",this._mouseEnterHandler=()=>{i.mouseover=!0}),n.addEventListener("mouseleave",this._mouseLeaveHandler=()=>{i.mouseover=!1,n.style.cursor=null}),document.addEventListener("mousemove",this._mouseMoveHandler=e=>{qA(e,n,i.pointerCanvasPos)}),n.addEventListener("mousedown",this._mouseDownHandler=e=>{s.active&&s.pointerEnabled&&(qA(e,n,i.pointerCanvasPos),i.mouseover=!0)}),n.addEventListener("mouseup",this._mouseUpHandler=e=>{s.active&&s.pointerEnabled})}reset(){}destroy(){const e=this._scene.canvas.canvas;document.removeEventListener("mousemove",this._mouseMoveHandler),e.removeEventListener("mouseenter",this._mouseEnterHandler),e.removeEventListener("mouseleave",this._mouseLeaveHandler),e.removeEventListener("mousedown",this._mouseDownHandler),e.removeEventListener("mouseup",this._mouseUpHandler)}}function qA(e,t,s){if(e){const{left:i,top:r}=t.getBoundingClientRect();s[0]=e.clientX-i,s[1]=e.clientY-r}else e=window.event,s[0]=e.x,s[1]=e.y;return s}const eo=function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class to{constructor(e,t,s,i,r){this._scene=e;const n=t.pickController,A=t.pivotController,o=h.vec2(),a=h.vec2(),l=h.vec2(),c=h.vec2(),u=[],d=this._scene.canvas.canvas;let p=0,f=!1;this._onTick=e.on("tick",(()=>{f=!1})),d.addEventListener("touchstart",this._canvasTouchStartHandler=t=>{if(!s.active||!s.pointerEnabled)return;t.preventDefault();const r=t.touches,a=t.changedTouches;for(i.touchStartTime=Date.now(),1===r.length&&1===a.length&&(eo(r[0],o),s.followPointer&&(n.pickCursorPos=o,n.schedulePickSurface=!0,n.update(),s.planView||(n.picked&&n.pickedSurface&&n.pickResult&&n.pickResult.worldPos?(A.setPivotPos(n.pickResult.worldPos),!s.firstPerson&&A.startPivot()&&A.showPivot()):(s.smartPivot?A.setCanvasPivotPos(i.pointerCanvasPos):A.setPivotPos(e.camera.look),!s.firstPerson&&A.startPivot()&&A.showPivot()))));u.length<r.length;)u.push(h.vec2());for(let e=0,t=r.length;e<t;++e)eo(r[e],u[e]);p=r.length}),d.addEventListener("touchend",this._canvasTouchEndHandler=()=>{A.getPivoting()&&(A.endPivot(),A.hidePivot())}),d.addEventListener("touchmove",this._canvasTouchMoveHandler=t=>{if(!s.active||!s.pointerEnabled)return;if(t.stopPropagation(),t.preventDefault(),f)return;f=!0;const A=e.canvas.boundary,o=A[2],d=A[3],g=t.touches;if(t.touches.length===p){if(1===p){eo(g[0],a),h.subVec2(a,u[0],c);const t=c[0],n=c[1];if(null!==i.longTouchTimeout&&(Math.abs(t)>s.longTapRadius||Math.abs(n)>s.longTapRadius)&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),s.planView){const i=e.camera;if("perspective"===i.projection){const A=Math.abs(e.camera.eyeLookDist)*Math.tan(i.perspective.fov/2*Math.PI/180);r.panDeltaX+=t*A/d*s.touchPanRate,r.panDeltaY+=n*A/d*s.touchPanRate}else r.panDeltaX+=.5*i.ortho.scale*(t/d)*s.touchPanRate,r.panDeltaY+=.5*i.ortho.scale*(n/d)*s.touchPanRate}else r.rotateDeltaY-=t/o*(1*s.dragRotationRate),r.rotateDeltaX+=n/d*(1.5*s.dragRotationRate)}else if(2===p){const t=g[0],A=g[1];eo(t,a),eo(A,l);const o=h.geometricMeanVec2(u[0],u[1]),c=h.geometricMeanVec2(a,l),p=h.vec2();h.subVec2(o,c,p);const f=p[0],m=p[1],_=e.camera,b=h.distVec2([t.pageX,t.pageY],[A.pageX,A.pageY]),B=(h.distVec2(u[0],u[1])-b)*s.touchDollyRate;if(r.dollyDelta=B,Math.abs(B)<1)if("perspective"===_.projection){const t=n.pickResult?n.pickResult.worldPos:e.center,i=Math.abs(h.lenVec3(h.subVec3(t,e.camera.eye,[])))*Math.tan(_.perspective.fov/2*Math.PI/180);r.panDeltaX-=f*i/d*s.touchPanRate,r.panDeltaY-=m*i/d*s.touchPanRate}else r.panDeltaX-=.5*_.ortho.scale*(f/d)*s.touchPanRate,r.panDeltaY-=.5*_.ortho.scale*(m/d)*s.touchPanRate;i.pointerCanvasPos=c}for(let e=0;e<p;++e)eo(g[e],u[e])}})}reset(){}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler),e.removeEventListener("touchmove",this._canvasTouchMoveHandler),this._scene.off(this._onTick)}}const so=function(e,t){if(e){let s=e.target,i=0,r=0;for(;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;t[0]=e.pageX-i,t[1]=e.pageY-r}else e=window.event,t[0]=e.x,t[1]=e.y;return t};class io{constructor(e,t,s,i,r){this._scene=e;const n=t.pickController,A=t.cameraControl;let o;const a=[],l=new Float32Array(2);let c=-1,u=-1;const d=this._scene.canvas.canvas,p=s=>{let i;s&&s.worldPos&&(i=s.worldPos);const r=s?s.entity.aabb:e.aabb;if(i){const s=e.camera;h.subVec3(s.eye,s.look,[]),t.cameraFlight.flyTo({aabb:r})}else t.cameraFlight.flyTo({aabb:r})};d.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{if(!s.active||!s.pointerEnabled)return;null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null);const r=e.touches,n=e.changedTouches;if(o=Date.now(),1===r.length&&1===n.length){c=o,so(r[0],l);const n=l[0],A=l[1],a=r[0].pageX,h=r[0].pageY;i.longTouchTimeout=setTimeout((()=>{s.active&&s.pointerEnabled&&t.cameraControl.fire("rightClick",{pagePos:[Math.round(a),Math.round(h)],canvasPos:[Math.round(n),Math.round(A)],event:e},!0),i.longTouchTimeout=null}),s.longTapTimeout)}else c=-1;for(;a.length<r.length;)a.push(new Float32Array(2));for(let e=0,t=r.length;e<t;++e)so(r[e],a[e]);a.length=r.length},{passive:!0}),d.addEventListener("touchend",this._canvasTouchEndHandler=e=>{if(!s.active||!s.pointerEnabled)return;const t=Date.now(),r=e.touches,o=e.changedTouches,d=A.hasSubs("pickedSurface");null!==i.longTouchTimeout&&(clearTimeout(i.longTouchTimeout),i.longTouchTimeout=null),0===r.length&&1===o.length&&c>-1&&t-c<150&&(u>-1&&c-u<325?(so(o[0],n.pickCursorPos),n.schedulePickEntity=!0,n.schedulePickSurface=d,n.update(),n.pickResult?(n.pickResult.touchInput=!0,A.fire("doublePicked",n.pickResult),n.pickedSurface&&A.fire("doublePickedSurface",n.pickResult),s.doublePickFlyTo&&p(n.pickResult)):(A.fire("doublePickedNothing"),s.doublePickFlyTo&&p()),u=-1):h.distVec2(a[0],l)<4&&(so(o[0],n.pickCursorPos),n.schedulePickEntity=!0,n.schedulePickSurface=d,n.update(),n.pickResult?(n.pickResult.touchInput=!0,A.fire("picked",n.pickResult),n.pickedSurface&&A.fire("pickedSurface",n.pickResult)):A.fire("pickedNothing"),u=t),c=-1),a.length=r.length;for(let e=0,t=r.length;e<t;++e)a[e][0]=r[e].pageX,a[e][1]=r[e].pageY},{passive:!0})}reset(){}destroy(){const e=this._scene.canvas.canvas;e.removeEventListener("touchstart",this._canvasTouchStartHandler),e.removeEventListener("touchend",this._canvasTouchEndHandler)}}class ro extends T{constructor(e,t={}){super(e,t),this.PAN_LEFT=0,this.PAN_RIGHT=1,this.PAN_UP=2,this.PAN_DOWN=3,this.PAN_FORWARDS=4,this.PAN_BACKWARDS=5,this.ROTATE_X_POS=6,this.ROTATE_X_NEG=7,this.ROTATE_Y_POS=8,this.ROTATE_Y_NEG=9,this.DOLLY_FORWARDS=10,this.DOLLY_BACKWARDS=11,this.AXIS_VIEW_RIGHT=12,this.AXIS_VIEW_BACK=13,this.AXIS_VIEW_LEFT=14,this.AXIS_VIEW_FRONT=15,this.AXIS_VIEW_TOP=16,this.AXIS_VIEW_BOTTOM=17,this.MOUSE_PAN=18,this.MOUSE_ROTATE=19,this.MOUSE_DOLLY=20,this._keyMap={},this.scene.canvas.canvas.oncontextmenu=e=>{e.preventDefault()},this._configs={longTapTimeout:600,longTapRadius:5,active:!0,keyboardLayout:"qwerty",navMode:"orbit",planView:!1,firstPerson:!1,followPointer:!0,doublePickFlyTo:!0,panRightClick:!0,showPivot:!1,pointerEnabled:!0,constrainVertical:!1,smartPivot:!1,doubleClickTimeFrame:250,zoomOnMouseWheel:!0,snapToVertex:true,snapToEdge:true,snapRadius:30,keyboardEnabledOnlyIfMouseover:!0,dragRotationRate:360,keyboardRotationRate:90,rotationInertia:0,keyboardPanRate:1,touchPanRate:1,panInertia:.5,keyboardDollyRate:10,mouseWheelDollyRate:100,touchDollyRate:.2,dollyInertia:0,dollyProximityThreshold:30,dollyMinSpeed:.04},this._states={pointerCanvasPos:h.vec2(),mouseover:!1,followPointerDirty:!0,mouseDownClientX:0,mouseDownClientY:0,mouseDownCursorX:0,mouseDownCursorY:0,touchStartTime:null,activeTouches:[],tapStartPos:h.vec2(),tapStartTime:-1,lastTapTime:-1,longTouchTimeout:null},this._updates={rotateDeltaX:0,rotateDeltaY:0,panDeltaX:0,panDeltaY:0,panDeltaZ:0,dollyDelta:0};const s=this.scene;this._controllers={cameraControl:this,pickController:new OA(this,this._configs),pivotController:new RA(s,this._configs),panController:new UA(s),cameraFlight:new $(this,{duration:.5})},this._handlers=[new $A(this.scene,this._controllers,this._configs,this._states,this._updates),new to(this.scene,this._controllers,this._configs,this._states,this._updates),new LA(this.scene,this._controllers,this._configs,this._states,this._updates),new XA(this.scene,this._controllers,this._configs,this._states,this._updates),new KA(this.scene,this._controllers,this._configs,this._states,this._updates),new io(this.scene,this._controllers,this._configs,this._states,this._updates),new ZA(this.scene,this._controllers,this._configs,this._states,this._updates)],this._cursors={dollyForward:"zoom-in",dollyBackward:"zoom-out",rotate:"grabbing",pan:"move"},this._cameraUpdater=new YA(this.scene,this._controllers,this._configs,this._states,this._updates),this.navMode=t.navMode,t.planView&&(this.planView=t.planView),this.constrainVertical=t.constrainVertical,t.keyboardLayout?this.keyboardLayout=t.keyboardLayout:this.keyMap=t.keyMap,this.doublePickFlyTo=t.doublePickFlyTo,this.panRightClick=t.panRightClick,this.active=t.active,this.followPointer=t.followPointer,this.rotationInertia=t.rotationInertia,this.keyboardPanRate=t.keyboardPanRate,this.touchPanRate=t.touchPanRate,this.keyboardRotationRate=t.keyboardRotationRate,this.dragRotationRate=t.dragRotationRate,this.touchDollyRate=t.touchDollyRate,this.dollyInertia=t.dollyInertia,this.dollyProximityThreshold=t.dollyProximityThreshold,this.dollyMinSpeed=t.dollyMinSpeed,this.panInertia=t.panInertia,this.pointerEnabled=!0,this.keyboardDollyRate=t.keyboardDollyRate,this.mouseWheelDollyRate=t.mouseWheelDollyRate}set keyMap(e){if(e=e||"qwerty",_.isString(e)){const t=this.scene.input,s={};switch(e){default:this.error("Unsupported value for 'keyMap': "+e+" defaulting to 'qwerty'");case"qwerty":s[this.PAN_LEFT]=[t.KEY_A],s[this.PAN_RIGHT]=[t.KEY_D],s[this.PAN_UP]=[t.KEY_Z],s[this.PAN_DOWN]=[t.KEY_X],s[this.PAN_BACKWARDS]=[],s[this.PAN_FORWARDS]=[],s[this.DOLLY_FORWARDS]=[t.KEY_W,t.KEY_ADD],s[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],s[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],s[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],s[this.ROTATE_Y_POS]=[t.KEY_Q,t.KEY_LEFT_ARROW],s[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],s[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],s[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],s[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],s[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],s[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],s[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6],s[this.MOUSE_PAN]=[[t.MOUSE_LEFT_BUTTON,t.KEY_SHIFT],this._configs.panRightClick?t.MOUSE_RIGHT_BUTTON:t.MOUSE_MIDDLE_BUTTON],s[this.MOUSE_ROTATE]=[t.MOUSE_LEFT_BUTTON],s[this.MOUSE_DOLLY]=[];break;case"azerty":s[this.PAN_LEFT]=[t.KEY_Q],s[this.PAN_RIGHT]=[t.KEY_D],s[this.PAN_UP]=[t.KEY_W],s[this.PAN_DOWN]=[t.KEY_X],s[this.PAN_BACKWARDS]=[],s[this.PAN_FORWARDS]=[],s[this.DOLLY_FORWARDS]=[t.KEY_Z,t.KEY_ADD],s[this.DOLLY_BACKWARDS]=[t.KEY_S,t.KEY_SUBTRACT],s[this.ROTATE_X_POS]=[t.KEY_DOWN_ARROW],s[this.ROTATE_X_NEG]=[t.KEY_UP_ARROW],s[this.ROTATE_Y_POS]=[t.KEY_A,t.KEY_LEFT_ARROW],s[this.ROTATE_Y_NEG]=[t.KEY_E,t.KEY_RIGHT_ARROW],s[this.AXIS_VIEW_RIGHT]=[t.KEY_NUM_1],s[this.AXIS_VIEW_BACK]=[t.KEY_NUM_2],s[this.AXIS_VIEW_LEFT]=[t.KEY_NUM_3],s[this.AXIS_VIEW_FRONT]=[t.KEY_NUM_4],s[this.AXIS_VIEW_TOP]=[t.KEY_NUM_5],s[this.AXIS_VIEW_BOTTOM]=[t.KEY_NUM_6],s[this.MOUSE_PAN]=[[t.MOUSE_LEFT_BUTTON,t.KEY_SHIFT],this._configs.panRightClick?t.MOUSE_RIGHT_BUTTON:t.MOUSE_MIDDLE_BUTTON],s[this.MOUSE_ROTATE]=[t.MOUSE_LEFT_BUTTON],s[this.MOUSE_DOLLY]=[]}this._keyMap=s}else{const t=e;this._keyMap=t}}get keyMap(){return this._keyMap}_areAllKeysDown(e,t){if(!t||t.length<=0)return!0;if(!e)return!1;for(let s=0,i=t.length;s<i;s++){if(!e[t[s]])return!1}return!0}_isAnyOtherKeyDown(e,t){for(let s=0,i=e.length;s<i;s++)if(e[s])if(Array.isArray(t)){if(t.indexOf(s)<0)return!0}else if(s!==t)return!0;return!1}_isMouseAction(e){switch(e){case this.MOUSE_ROTATE:case this.MOUSE_DOLLY:case this.MOUSE_PAN:return!0;default:return!1}}_isKeyDownForAction(e,t){const s=this._keyMap[e];if(!s)return!1;if(0===s.length&&this._isMouseAction(e))return!0;t||(t=this.scene.input.keyDown);for(let e=0,i=s.length;e<i;e++){const i=s[e];if(Array.isArray(i)){if(this._areAllKeysDown(t,i)&&!this._isAnyOtherKeyDown(t,i))return!0}else if(t[i]&&!this._isAnyOtherKeyDown(t,i))return!0}return!1}set pivotElement(e){this._controllers.pivotController.setPivotElement(e)}set active(e){e=!1!==e,this._configs.active=e,this._handlers[1]._active=e,this._handlers[5]._active=e}get active(){return this._configs.active}set snapToVertex(e){this._configs.snapToVertex=!!e}get snapToVertex(){return this._configs.snapToVertex}set snapToEdge(e){this._configs.snapToEdge=!!e}get snapToEdge(){return this._configs.snapToEdge}set snapRadius(e){e=e||30,this._configs.snapRadius=e}get snapRadius(){return this._configs.snapRadius}set keyboardEnabledOnlyIfMouseover(e){this._configs.keyboardEnabledOnlyIfMouseover=!!e}get keyboardEnabledOnlyIfMouseover(){return this._configs.keyboardEnabledOnlyIfMouseover}set navMode(e){"firstPerson"!==(e=e||"orbit")&&"orbit"!==e&&"planView"!==e&&(this.error("Unsupported value for navMode: "+e+" - supported values are 'orbit', 'firstPerson' and 'planView' - defaulting to 'orbit'"),e="orbit"),this._configs.firstPerson="firstPerson"===e,this._configs.planView="planView"===e,(this._configs.firstPerson||this._configs.planView)&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this._configs.navMode=e}get navMode(){return this._configs.navMode}set pointerEnabled(e){this._reset(),this._configs.pointerEnabled=!!e}setCursorStyle(e,t){Object.prototype.hasOwnProperty.call(this._cursors,e)?this._cursors={...this._cursors,[e]:t}:console.warn(`Action '${e}' is not valid for cursor styles.`)}getCursorStyle(e){return this._cursors[e]||null}_reset(){for(let e=0,t=this._handlers.length;e<t;e++){const t=this._handlers[e];t.reset&&t.reset()}this._updates.panDeltaX=0,this._updates.panDeltaY=0,this._updates.rotateDeltaX=0,this._updates.rotateDeltaY=0,this._updates.dolyDelta=0}get pointerEnabled(){return this._configs.pointerEnabled}set followPointer(e){this._configs.followPointer=!1!==e}get followPointer(){return this._configs.followPointer}set pivotPos(e){this._controllers.pivotController.setPivotPos(e)}get pivotPos(){return this._controllers.pivotController.getPivotPos()}set dollyToPointer(e){this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer=e}get dollyToPointer(){return this.warn("dollyToPointer property is deprecated - replaced with followPointer"),this.followPointer}set panToPointer(e){this.warn("panToPointer property is deprecated - replaced with followPointer")}get panToPointer(){return this.warn("panToPointer property is deprecated - replaced with followPointer"),!1}set planView(e){this._configs.planView=!!e,this._configs.firstPerson=!1,this._configs.planView&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot()),this.warn("planView property is deprecated - replaced with navMode")}get planView(){return this.warn("planView property is deprecated - replaced with navMode"),this._configs.planView}set firstPerson(e){this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson=!!e,this._configs.planView=!1,this._configs.firstPerson&&(this._controllers.pivotController.hidePivot(),this._controllers.pivotController.endPivot())}get firstPerson(){return this.warn("firstPerson property is deprecated - replaced with navMode"),this._configs.firstPerson}set constrainVertical(e){this._configs.constrainVertical=!!e}get constrainVertical(){return this._configs.constrainVertical}set doublePickFlyTo(e){this._configs.doublePickFlyTo=!1!==e}get doublePickFlyTo(){return this._configs.doublePickFlyTo}set panRightClick(e){this._configs.panRightClick=!1!==e;const t=this._keyMap[this.MOUSE_PAN];if(t&&t.length>0){const e=this.scene.input;for(let s=0,i=t.length;s<i;s++)this._configs.panRightClick&&t[s]===e.MOUSE_MIDDLE_BUTTON?this._keyMap[this.MOUSE_PAN][s]=e.MOUSE_RIGHT_BUTTON:this._configs.panRightClick||t[s]!==e.MOUSE_RIGHT_BUTTON||(this._keyMap[this.MOUSE_PAN][s]=e.MOUSE_MIDDLE_BUTTON)}}get panRightClick(){return this._configs.panRightClick}set rotationInertia(e){this._configs.rotationInertia=null!=e?e:0}get rotationInertia(){return this._configs.rotationInertia}set keyboardPanRate(e){this._configs.keyboardPanRate=null!=e?e:5}set touchPanRate(e){this._configs.touchPanRate=null!=e?e:1}get touchPanRate(){return this._configs.touchPanRate}get keyboardPanRate(){return this._configs.keyboardPanRate}set keyboardRotationRate(e){this._configs.keyboardRotationRate=null!=e?e:90}get keyboardRotationRate(){return this._configs.keyboardRotationRate}set dragRotationRate(e){this._configs.dragRotationRate=null!=e?e:360}get dragRotationRate(){return this._configs.dragRotationRate}set keyboardDollyRate(e){this._configs.keyboardDollyRate=null!=e?e:15}get keyboardDollyRate(){return this._configs.keyboardDollyRate}set touchDollyRate(e){this._configs.touchDollyRate=null!=e?e:.2}get touchDollyRate(){return this._configs.touchDollyRate}set mouseWheelDollyRate(e){this._configs.mouseWheelDollyRate=null!=e?e:100}get mouseWheelDollyRate(){return this._configs.mouseWheelDollyRate}set dollyInertia(e){this._configs.dollyInertia=null!=e?e:0}get dollyInertia(){return this._configs.dollyInertia}set dollyProximityThreshold(e){this._configs.dollyProximityThreshold=null!=e?e:35}get dollyProximityThreshold(){return this._configs.dollyProximityThreshold}set dollyMinSpeed(e){this._configs.dollyMinSpeed=null!=e?e:.04}get dollyMinSpeed(){return this._configs.dollyMinSpeed}set panInertia(e){this._configs.panInertia=null!=e?e:.5}get panInertia(){return this._configs.panInertia}set keyboardLayout(e){"qwerty"!==(e=e||"qwerty")&&"azerty"!==e&&(this.error("Unsupported value for keyboardLayout - defaulting to 'qwerty'"),e="qwerty"),this._configs.keyboardLayout=e,this.keyMap=this._configs.keyboardLayout}get keyboardLayout(){return this._configs.keyboardLayout}enablePivotSphere(e={}){this._controllers.pivotController.enablePivotSphere(e)}disablePivotSphere(){this._controllers.pivotController.disablePivotSphere()}set smartPivot(e){this._configs.smartPivot=!1!==e}get smartPivot(){return this._configs.smartPivot}set doubleClickTimeFrame(e){this._configs.doubleClickTimeFrame=null!=e?e:250}get doubleClickTimeFrame(){return this._configs.doubleClickTimeFrame}set zoomOnMouseWheel(e){this._configs.zoomOnMouseWheel=!!e}get zoomOnMouseWheel(){return this._configs.zoomOnMouseWheel}destroy(){this._destroyHandlers(),this._destroyControllers(),this._cameraUpdater.destroy(),super.destroy()}_destroyHandlers(){for(let e=0,t=this._handlers.length;e<t;e++){const t=this._handlers[e];t.destroy&&t.destroy()}}_destroyControllers(){for(let e=0,t=this._controllers.length;e<t;e++){const t=this._controllers[e];t.destroy&&t.destroy()}}}class no{constructor(e,t,s,i,r){this.name=e,this.type=s,this.value=t,this.valueType=i,this.description=r}}class Ao{constructor(e){if(this.id=e.id,this.originalSystemId=e.originalSystemId,this.metaModels=[],this.name=e.name,this.type=e.type,this.properties=[],e.properties){const t=e.properties;for(let e=0,s=t.length;e<s;e++){const s=t[e];Number.isInteger(s)?this.properties.push(s):this.properties.push(new no(s.name,s.value,s.type,s.valueType,s.description))}}}}class oo{constructor(e){this.metaModels=[],this.id=e.id,this.parentId=e.parentId,this.parent=null,this.originalSystemId=e.originalSystemId,this.name=e.name,this.type=e.type,this.propertySetIds=e.propertySetIds,this.propertySets=[],this.attributes=e.attributes||{},void 0!==e.external&&null!==e.external&&(this.external=e.external)}get metaModel(){return 1==this.metaModels.length?this.metaModels[0]:null}getObjectIDsInSubtree(){const e=[];return function t(s){if(!s)return;e.push(s.id);const i=s.children;if(i)for(var r=0,n=i.length;r<n;r++)t(i[r])}(this),e}withMetaObjectsInSubtree(e){!function t(s){if(!s)return;e(s);const i=s.children;if(i)for(var r=0,n=i.length;r<n;r++)t(i[r])}(this)}getObjectIDsInSubtreeByType(e){const t={};for(var s=0,i=e.length;s<i;s++)t[e[s]]=e[s];const r=[];return function e(s){if(!s)return;t[s.type]&&r.push(s.id);const i=s.children;if(i)for(var n=0,A=i.length;n<A;n++)e(i[n])}(this),r}getJSON(){var e={id:this.id,type:this.type,name:this.name};return this.parent&&(e.parent=this.parent.id),e}}class ao{constructor(e){this.id=e.id,this.projectId=e.projectId,this.revisionId=e.revisionId,this.author=e.author,this.createdAt=e.createdAt,this.creatingApplication=e.creatingApplication,this.schema=e.schema,this.metaScene=e.metaScene,this.propertySets=[],this.rootMetaObjects=[],this.metaObjects={},this.graph=e.graph||{},this.metaScene.metaModels[this.id]=this,this._propertyLookup=[],this.finalized=!1}get rootMetaObject(){return 1===this.rootMetaObjects.length?this.rootMetaObjects[0]:null}loadData(e,t={}){if(this.finalized)throw"MetaScene already finalized - can't add more data";this._globalizeIDs(e,t);const s=this.metaScene,i=e.properties;if(i)for(let e=0,t=i.length;e<t;e++)this._propertyLookup.push(i[e]);if(e.propertySets)for(let t=0,i=e.propertySets.length;t<i;t++){const i=e.propertySets[t];i.properties||(i.properties=[]);let r=s.propertySets[i.id];r||(r=new Ao({id:i.id,originalSystemId:i.originalSystemId||i.id,type:i.type,name:i.name,properties:i.properties}),s.propertySets[r.id]=r),r.metaModels.push(this),this.propertySets.push(r)}if(e.metaObjects)for(let t=0,i=e.metaObjects.length;t<i;t++){const i=e.metaObjects[t],r=i.id;let n=s.metaObjects[r];if(!n){const e=i.type,t=i.originalSystemId,s=i.propertySets||i.propertySetIds;n=new oo({id:r,originalSystemId:t,parentId:i.parent,type:e,name:i.name,attributes:i.attributes,propertySetIds:s,external:i.external}),this.metaScene.metaObjects[r]=n,n.metaModels=[]}this.metaObjects[r]=n,i.parent||(this.rootMetaObjects.push(n),s.rootMetaObjects[r]=n),n.metaModels.push(this)}}_decompressProperties(e,t){const s=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];if(Number.isInteger(r)){const n=e[r];n?t[i]=n:s.push(r)}}s.length>0&&console.error(`[MetaModel._decompressProperties] Properties not found: ${s}`)}finalize(){if(this.finalized)throw"MetaScene already finalized - can't re-finalize";const e=this.metaScene;for(let t in e.metaObjects){const s=e.metaObjects[t];if(s.children&&(s.children=[]),s.propertySets&&(s.propertySets=[]),s.propertySetIds)for(let t=0,i=s.propertySetIds.length;t<i;t++){const i=s.propertySetIds[t],r=e.propertySets[i];s.propertySets.push(r)}}for(let t in e.metaObjects){const s=e.metaObjects[t];if(s.parentId){const t=e.metaObjects[s.parentId];t&&(s.parent=t,(t.children||(t.children=[])).push(s))}}for(let t in e.metaObjects){e.metaObjects[t].metaModels=[]}for(let t in e.metaModels){const s=e.metaModels[t];for(let e in s.metaObjects){s.metaObjects[e].metaModels.push(s)}}e.metaObjectsByType={};for(let t in e.metaObjects){const s=e.metaObjects[t],i=s.type;(e.metaObjectsByType[i]||(e.metaObjectsByType[i]={}))[t]=s}if(this.propertySets)for(let e=0,t=this.propertySets.length;e<t;e++){const t=this.propertySets[e];this._decompressProperties(this._propertyLookup,t.properties)}this._propertyLookup=[],this.finalized=!0,this.metaScene.fire("metaModelCreated",this.id)}getJSON(){const e={id:this.id,projectId:this.projectId,author:this.author,createdAt:this.createdAt,schema:this.schema,creatingApplication:this.creatingApplication,metaObjects:[],propertySets:[]},t=Object.values(this.metaObjects);for(let s=0,i=t.length;s<i;s++){const i=t[s],r={id:i.id,originalSystemId:i.originalSystemId,extId:i.extId,type:i.type,name:i.name};i.parent&&(r.parent=i.parent.id),i.attributes&&(r.attributes=i.attributes),i.propertySetIds&&(r.propertySetIds=i.propertySetIds),e.metaObjects.push(r)}for(let t=0,s=this.propertySets.length;t<s;t++){const s=this.propertySets[t],i={id:s.id,originalSystemId:s.originalSystemId,extId:s.extId,type:s.type,name:s.name,propertyies:[]};for(let e=0,t=s.properties.length;e<t;e++){const t=s.properties[e],r={id:t.id,description:t.description,type:t.type,name:t.name,value:t.value,valueType:t.valueType};i.properties.push(r)}e.propertySets.push(i)}return e}_globalizeIDs(e,t){const s=!!t.globalizeObjectIds;if(e.metaObjects)for(let t=0,i=e.metaObjects.length;t<i;t++){const i=e.metaObjects[t];if(i.originalSystemId=i.id,i.parent&&(i.originalParentSystemId=i.parent),s&&(i.id=h.globalizeObjectId(this.id,i.id),i.parent&&(i.parent=h.globalizeObjectId(this.id,i.parent))),s){const e=i.propertySetIds;if(e){const t=[];for(let s=0,i=e.length;s<i;s++)t.push(h.globalizeObjectId(this.id,e[s]));i.propertySetIds=t,i.originalSystemPropertySetIds=e}}else i.originalSystemPropertySetIds=i.propertySetIds}if(e.propertySets)for(let t=0,i=e.propertySets.length;t<i;t++){const i=e.propertySets[t];i.originalSystemId=i.id,s&&(i.id=h.globalizeObjectId(this.id,i.id))}}}class lo{constructor(e,t){this.viewer=e,this.scene=t,this.metaModels={},this.propertySets={},this.metaObjects={},this.metaObjectsByType={},this.rootMetaObjects={},this._eventSubs={}}on(e,t){let s=this._eventSubs[e];s||(s=[],this._eventSubs[e]=s),s.push(t)}fire(e,t){const s=this._eventSubs[e];if(s)for(let e=0,i=s.length;e<i;e++)s[e](t)}off(e){}createMetaModel(e,t,s={}){const i=new ao({metaScene:this,id:e,projectId:t.projectId||"none",revisionId:t.revisionId||"none",author:t.author||"none",createdAt:t.createdAt||"none",creatingApplication:t.creatingApplication||"none",schema:t.schema||"none",propertySets:[]});return i.loadData(t),i.finalize(),i}destroyMetaModel(e){const t=this.metaModels[e];if(t){if(t.propertySets)for(let s=0,i=t.propertySets.length;s<i;s++){const i=t.propertySets[s];if(1===i.metaModels.length&&i.metaModels[0].id===e)delete this.propertySets[i.id];else{const t=[];for(let s=0,r=i.metaModels.length;s<r;s++)i.metaModels[s].id!==e&&t.push(i.metaModels[s]);i.metaModels=t}}if(t.metaObjects)for(let s in t.metaObjects){const i=t.metaObjects[s];1===i.metaModels.length&&i.metaModels[0].id===e?(delete this.metaObjects[s],i.parent||delete this.rootMetaObjects[s]):i.metaModels=i.metaModels.filter((t=>t.id!==e))}for(let e in this.metaObjects){const t=this.metaObjects[e];if(t.children&&(t.children=[]),t.propertySets&&(t.propertySets=[]),t.propertySetIds)for(let e=0,s=t.propertySetIds.length;e<s;e++){const s=t.propertySetIds[e],i=this.propertySets[s];t.propertySets.push(i)}}this.metaObjectsByType={};for(let e in this.metaObjects){const t=this.metaObjects[e],s=t.type;t.children&&(t.children=null),(this.metaObjectsByType[s]||(this.metaObjectsByType[s]={}))[e]=t}for(let e in this.metaObjects){const t=this.metaObjects[e];if(t.parentId){const e=this.metaObjects[t.parentId];e&&(t.parent=e,(e.children||(e.children=[])).push(t))}}delete this.metaModels[e];for(let e in this.metaObjects){this.metaObjects[e].metaModels=[]}for(let e in this.metaModels){const t=this.metaModels[e];for(let e in t.metaObjects){t.metaObjects[e].metaModels.push(t)}}this.fire("metaModelDestroyed",e)}}getObjectIDsByType(e){const t=this.metaObjectsByType[e];return t?Object.keys(t):[]}getObjectIDsInSubtree(e,t,s){const i=[],r=this.metaObjects[e],n=t&&t.length>0?co(t):null,A=s&&s.length>0?co(s):null,o=e=>{if(!e)return;var t=!0;(A&&A[e.type]||n&&!n[e.type])&&(t=!1),t&&i.push(e.id);const s=e.children;if(s)for(var r=0,a=s.length;r<a;r++)o(s[r])};return o(r),i}withMetaObjectsInSubtree(e,t){const s=this.metaObjects[e];s&&s.withMetaObjectsInSubtree(t)}}function co(e){const t={};for(var s=0,i=e.length;s<i;s++)t[e[s]]=!0;return t}
/*!
 * html2canvas 1.4.1 <https://html2canvas.hertzen.com>
 * Copyright (c) 2022 Niklas von Hertzen <https://hertzen.com>
 * Released under MIT License
 */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ho=function(e,t){return ho=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])},ho(e,t)};function uo(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function s(){this.constructor=e}ho(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}var po=function(){return po=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var r in t=arguments[s])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},po.apply(this,arguments)};function fo(e,t,s,i){return new(s||(s=Promise))((function(r,n){function A(e){try{a(i.next(e))}catch(e){n(e)}}function o(e){try{a(i.throw(e))}catch(e){n(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(A,o)}a((i=i.apply(e,t||[])).next())}))}function go(e,t){var s,i,r,n,A={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(s)throw new TypeError("Generator is already executing.");for(;A;)try{if(s=1,i&&(r=2&n[0]?i.return:n[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,n[1])).done)return r;switch(i=0,r&&(n=[2&n[0],r.value]),n[0]){case 0:case 1:r=n;break;case 4:return A.label++,{value:n[1],done:!1};case 5:A.label++,i=n[1],n=[0];continue;case 7:n=A.ops.pop(),A.trys.pop();continue;default:if(!(r=A.trys,(r=r.length>0&&r[r.length-1])||6!==n[0]&&2!==n[0])){A=0;continue}if(3===n[0]&&(!r||n[1]>r[0]&&n[1]<r[3])){A.label=n[1];break}if(6===n[0]&&A.label<r[1]){A.label=r[1],r=n;break}if(r&&A.label<r[2]){A.label=r[2],A.ops.push(n);break}r[2]&&A.ops.pop(),A.trys.pop();continue}n=t.call(e,A)}catch(e){n=[6,e],i=0}finally{s=r=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}function mo(e,t,s){if(s||2===arguments.length)for(var i,r=0,n=t.length;r<n;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||t)}for(var _o=function(){function e(e,t,s,i){this.left=e,this.top=t,this.width=s,this.height=i}return e.prototype.add=function(t,s,i,r){return new e(this.left+t,this.top+s,this.width+i,this.height+r)},e.fromClientRect=function(t,s){return new e(s.left+t.windowBounds.left,s.top+t.windowBounds.top,s.width,s.height)},e.fromDOMRectList=function(t,s){var i=Array.from(s).find((function(e){return 0!==e.width}));return i?new e(i.left+t.windowBounds.left,i.top+t.windowBounds.top,i.width,i.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),bo=function(e,t){return _o.fromClientRect(e,t.getBoundingClientRect())},Bo=function(e){for(var t=[],s=0,i=e.length;s<i;){var r=e.charCodeAt(s++);if(r>=55296&&r<=56319&&s<i){var n=e.charCodeAt(s++);56320==(64512&n)?t.push(((1023&r)<<10)+(1023&n)+65536):(t.push(r),s--)}else t.push(r)}return t},yo=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var s=e.length;if(!s)return"";for(var i=[],r=-1,n="";++r<s;){var A=e[r];A<=65535?i.push(A):(A-=65536,i.push(55296+(A>>10),A%1024+56320)),(r+1===s||i.length>16384)&&(n+=String.fromCharCode.apply(String,i),i.length=0)}return n},wo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",vo="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Co=0;Co<wo.length;Co++)vo[wo.charCodeAt(Co)]=Co;for(var Mo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Eo="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Fo=0;Fo<Mo.length;Fo++)Eo[Mo.charCodeAt(Fo)]=Fo;for(var xo=function(e,t,s){return e.slice?e.slice(t,s):new Uint16Array(Array.prototype.slice.call(e,t,s))},Uo=function(){function e(e,t,s,i,r,n){this.initialValue=e,this.errorValue=t,this.highStart=s,this.highValueIndex=i,this.index=r,this.data=n}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Io="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",To="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Po=0;Po<Io.length;Po++)To[Io.charCodeAt(Po)]=Po;var So=10,Do=13,ko=15,Qo=17,Ro=18,Oo=19,Vo=20,Lo=21,Ho=22,No=24,Go=25,jo=26,Wo=27,zo=28,Xo=30,Ko=32,Zo=33,Jo=34,Yo=35,$o=37,qo=38,ea=39,ta=40,sa=42,ia=[9001,65288],ra=function(e,t){var s,i,r,n=function(e){var t,s,i,r,n,A=.75*e.length,o=e.length,a=0;"="===e[e.length-1]&&(A--,"="===e[e.length-2]&&A--);var l="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(A):new Array(A),c=Array.isArray(l)?l:new Uint8Array(l);for(t=0;t<o;t+=4)s=Eo[e.charCodeAt(t)],i=Eo[e.charCodeAt(t+1)],r=Eo[e.charCodeAt(t+2)],n=Eo[e.charCodeAt(t+3)],c[a++]=s<<2|i>>4,c[a++]=(15&i)<<4|r>>2,c[a++]=(3&r)<<6|63&n;return l}(e),A=Array.isArray(n)?function(e){for(var t=e.length,s=[],i=0;i<t;i+=4)s.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return s}(n):new Uint32Array(n),o=Array.isArray(n)?function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s.push(e[i+1]<<8|e[i]);return s}(n):new Uint16Array(n),a=xo(o,12,A[4]/2),l=2===A[5]?xo(o,(24+A[4])/2):(s=A,i=Math.ceil((24+A[4])/4),s.slice?s.slice(i,r):new Uint32Array(Array.prototype.slice.call(s,i,r)));return new Uo(A[0],A[1],A[2],A[3],a,l)}("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),na=[Xo,36],Aa=[1,2,3,5],oa=[So,8],aa=[Wo,jo],la=Aa.concat(oa),ca=[qo,ea,ta,Jo,Yo],ha=[ko,Do],ua=function(e,t,s,i){var r=i[s];if(Array.isArray(e)?-1!==e.indexOf(r):e===r)for(var n=s;n<=i.length;){if((a=i[++n])===t)return!0;if(a!==So)break}if(r===So)for(n=s;n>0;){var A=i[--n];if(Array.isArray(e)?-1!==e.indexOf(A):e===A)for(var o=s;o<=i.length;){var a;if((a=i[++o])===t)return!0;if(a!==So)break}if(A!==So)break}return!1},da=function(e,t){for(var s=e;s>=0;){var i=t[s];if(i!==So)return i;s--}return 0},pa=function(e,t,s,i,r){if(0===s[i])return"";var n=i-1;if(Array.isArray(r)&&!0===r[n])return"";var A=n-1,o=n+1,a=t[n],l=A>=0?t[A]:0,c=t[o];if(2===a&&3===c)return"";if(-1!==Aa.indexOf(a))return"!";if(-1!==Aa.indexOf(c))return"";if(-1!==oa.indexOf(c))return"";if(8===da(n,t))return"";if(11===ra.get(e[n]))return"";if((a===Ko||a===Zo)&&11===ra.get(e[o]))return"";if(7===a||7===c)return"";if(9===a)return"";if(-1===[So,Do,ko].indexOf(a)&&9===c)return"";if(-1!==[Qo,Ro,Oo,No,zo].indexOf(c))return"";if(da(n,t)===Ho)return"";if(ua(23,Ho,n,t))return"";if(ua([Qo,Ro],Lo,n,t))return"";if(ua(12,12,n,t))return"";if(a===So)return"";if(23===a||23===c)return"";if(16===c||16===a)return"";if(-1!==[Do,ko,Lo].indexOf(c)||14===a)return"";if(36===l&&-1!==ha.indexOf(a))return"";if(a===zo&&36===c)return"";if(c===Vo)return"";if(-1!==na.indexOf(c)&&a===Go||-1!==na.indexOf(a)&&c===Go)return"";if(a===Wo&&-1!==[$o,Ko,Zo].indexOf(c)||-1!==[$o,Ko,Zo].indexOf(a)&&c===jo)return"";if(-1!==na.indexOf(a)&&-1!==aa.indexOf(c)||-1!==aa.indexOf(a)&&-1!==na.indexOf(c))return"";if(-1!==[Wo,jo].indexOf(a)&&(c===Go||-1!==[Ho,ko].indexOf(c)&&t[o+1]===Go)||-1!==[Ho,ko].indexOf(a)&&c===Go||a===Go&&-1!==[Go,zo,No].indexOf(c))return"";if(-1!==[Go,zo,No,Qo,Ro].indexOf(c))for(var h=n;h>=0;){if((u=t[h])===Go)return"";if(-1===[zo,No].indexOf(u))break;h--}if(-1!==[Wo,jo].indexOf(c))for(h=-1!==[Qo,Ro].indexOf(a)?A:n;h>=0;){var u;if((u=t[h])===Go)return"";if(-1===[zo,No].indexOf(u))break;h--}if(qo===a&&-1!==[qo,ea,Jo,Yo].indexOf(c)||-1!==[ea,Jo].indexOf(a)&&-1!==[ea,ta].indexOf(c)||-1!==[ta,Yo].indexOf(a)&&c===ta)return"";if(-1!==ca.indexOf(a)&&-1!==[Vo,jo].indexOf(c)||-1!==ca.indexOf(c)&&a===Wo)return"";if(-1!==na.indexOf(a)&&-1!==na.indexOf(c))return"";if(a===No&&-1!==na.indexOf(c))return"";if(-1!==na.concat(Go).indexOf(a)&&c===Ho&&-1===ia.indexOf(e[o])||-1!==na.concat(Go).indexOf(c)&&a===Ro)return"";if(41===a&&41===c){for(var d=s[n],p=1;d>0&&41===t[--d];)p++;if(p%2!=0)return""}return a===Ko&&c===Zo?"":""},fa=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var s=function(e,t){void 0===t&&(t="strict");var s=[],i=[],r=[];return e.forEach((function(e,n){var A=ra.get(e);if(A>50?(r.push(!0),A-=50):r.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return i.push(n),s.push(16);if(4===A||11===A){if(0===n)return i.push(n),s.push(Xo);var o=s[n-1];return-1===la.indexOf(o)?(i.push(i[n-1]),s.push(o)):(i.push(n),s.push(Xo))}return i.push(n),31===A?s.push("strict"===t?Lo:$o):A===sa||29===A?s.push(Xo):43===A?e>=131072&&e<=196605||e>=196608&&e<=262141?s.push($o):s.push(Xo):void s.push(A)})),[i,s,r]}(e,t.lineBreak),i=s[0],r=s[1],n=s[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(r=r.map((function(e){return-1!==[Go,Xo,sa].indexOf(e)?$o:e})));var A="keep-all"===t.wordBreak?n.map((function(t,s){return t&&e[s]>=19968&&e[s]<=40959})):void 0;return[i,r,A]},ga=function(){function e(e,t,s,i){this.codePoints=e,this.required="!"===t,this.start=s,this.end=i}return e.prototype.slice=function(){return yo.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),ma=function(e){return e>=48&&e<=57},_a=function(e){return ma(e)||e>=65&&e<=70||e>=97&&e<=102},ba=function(e){return 10===e||9===e||32===e},Ba=function(e){return function(e){return function(e){return e>=97&&e<=122}(e)||function(e){return e>=65&&e<=90}(e)}(e)||function(e){return e>=128}(e)||95===e},ya=function(e){return Ba(e)||ma(e)||45===e},wa=function(e){return e>=0&&e<=8||11===e||e>=14&&e<=31||127===e},va=function(e,t){return 92===e&&10!==t},Ca=function(e,t,s){return 45===e?Ba(t)||va(t,s):!!Ba(e)||!(92!==e||!va(e,t))},Ma=function(e,t,s){return 43===e||45===e?!!ma(t)||46===t&&ma(s):ma(46===e?t:e)},Ea=function(e){var t=0,s=1;43!==e[t]&&45!==e[t]||(45===e[t]&&(s=-1),t++);for(var i=[];ma(e[t]);)i.push(e[t++]);var r=i.length?parseInt(yo.apply(void 0,i),10):0;46===e[t]&&t++;for(var n=[];ma(e[t]);)n.push(e[t++]);var A=n.length,o=A?parseInt(yo.apply(void 0,n),10):0;69!==e[t]&&101!==e[t]||t++;var a=1;43!==e[t]&&45!==e[t]||(45===e[t]&&(a=-1),t++);for(var l=[];ma(e[t]);)l.push(e[t++]);var c=l.length?parseInt(yo.apply(void 0,l),10):0;return s*(r+o*Math.pow(10,-A))*Math.pow(10,a*c)},Fa={type:2},xa={type:3},Ua={type:4},Ia={type:13},Ta={type:8},Pa={type:21},Sa={type:9},Da={type:10},ka={type:11},Qa={type:12},Ra={type:14},Oa={type:23},Va={type:1},La={type:25},Ha={type:24},Na={type:26},Ga={type:27},ja={type:28},Wa={type:29},za={type:31},Xa={type:32},Ka=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(Bo(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Xa;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case 34:return this.consumeStringToken(34);case 35:var t=this.peekCodePoint(0),s=this.peekCodePoint(1),i=this.peekCodePoint(2);if(ya(t)||va(s,i)){var r=Ca(t,s,i)?2:1;return{type:5,value:this.consumeName(),flags:r}}break;case 36:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ia;break;case 39:return this.consumeStringToken(39);case 40:return Fa;case 41:return xa;case 42:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ra;break;case 43:if(Ma(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 44:return Ua;case 45:var n=e,A=this.peekCodePoint(0),o=this.peekCodePoint(1);if(Ma(n,A,o))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(Ca(n,A,o))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(45===A&&62===o)return this.consumeCodePoint(),this.consumeCodePoint(),Ha;break;case 46:if(Ma(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case 47:if(42===this.peekCodePoint(0))for(this.consumeCodePoint();;){var a=this.consumeCodePoint();if(42===a&&47===(a=this.consumeCodePoint()))return this.consumeToken();if(-1===a)return this.consumeToken()}break;case 58:return Na;case 59:return Ga;case 60:if(33===this.peekCodePoint(0)&&45===this.peekCodePoint(1)&&45===this.peekCodePoint(2))return this.consumeCodePoint(),this.consumeCodePoint(),La;break;case 64:var l=this.peekCodePoint(0),c=this.peekCodePoint(1),h=this.peekCodePoint(2);if(Ca(l,c,h))return{type:7,value:this.consumeName()};break;case 91:return ja;case 92:if(va(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case 93:return Wa;case 61:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Ta;break;case 123:return ka;case 125:return Qa;case 117:case 85:var u=this.peekCodePoint(0),d=this.peekCodePoint(1);return 43!==u||!_a(d)&&63!==d||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case 124:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Sa;if(124===this.peekCodePoint(0))return this.consumeCodePoint(),Pa;break;case 126:if(61===this.peekCodePoint(0))return this.consumeCodePoint(),Da;break;case-1:return Xa}return ba(e)?(this.consumeWhiteSpace(),za):ma(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):Ba(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:yo(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return void 0===e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();_a(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var s=!1;63===t&&e.length<6;)e.push(t),t=this.consumeCodePoint(),s=!0;if(s)return{type:30,start:parseInt(yo.apply(void 0,e.map((function(e){return 63===e?48:e}))),16),end:parseInt(yo.apply(void 0,e.map((function(e){return 63===e?70:e}))),16)};var i=parseInt(yo.apply(void 0,e),16);if(45===this.peekCodePoint(0)&&_a(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var r=[];_a(t)&&r.length<6;)r.push(t),t=this.consumeCodePoint();return{type:30,start:i,end:parseInt(yo.apply(void 0,r),16)}}return{type:30,start:i,end:i}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&40===this.peekCodePoint(0)?(this.consumeCodePoint(),this.consumeUrlToken()):40===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),-1===this.peekCodePoint(0))return{type:22,value:""};var t=this.peekCodePoint(0);if(39===t||34===t){var s=this.consumeStringToken(this.consumeCodePoint());return 0===s.type&&(this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0))?(this.consumeCodePoint(),{type:22,value:s.value}):(this.consumeBadUrlRemnants(),Oa)}for(;;){var i=this.consumeCodePoint();if(-1===i||41===i)return{type:22,value:yo.apply(void 0,e)};if(ba(i))return this.consumeWhiteSpace(),-1===this.peekCodePoint(0)||41===this.peekCodePoint(0)?(this.consumeCodePoint(),{type:22,value:yo.apply(void 0,e)}):(this.consumeBadUrlRemnants(),Oa);if(34===i||39===i||40===i||wa(i))return this.consumeBadUrlRemnants(),Oa;if(92===i){if(!va(i,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),Oa;e.push(this.consumeEscapedCodePoint())}else e.push(i)}},e.prototype.consumeWhiteSpace=function(){for(;ba(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(41===e||-1===e)return;va(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t="";e>0;){var s=Math.min(5e4,e);t+=yo.apply(void 0,this._value.splice(0,s)),e-=s}return this._value.shift(),t},e.prototype.consumeStringToken=function(e){for(var t="",s=0;;){var i=this._value[s];if(-1===i||void 0===i||i===e)return{type:0,value:t+=this.consumeStringSlice(s)};if(10===i)return this._value.splice(0,s),Va;if(92===i){var r=this._value[s+1];-1!==r&&void 0!==r&&(10===r?(t+=this.consumeStringSlice(s),s=-1,this._value.shift()):va(i,r)&&(t+=this.consumeStringSlice(s),t+=yo(this.consumeEscapedCodePoint()),s=-1))}s++}},e.prototype.consumeNumber=function(){var e=[],t=4,s=this.peekCodePoint(0);for(43!==s&&45!==s||e.push(this.consumeCodePoint());ma(this.peekCodePoint(0));)e.push(this.consumeCodePoint());s=this.peekCodePoint(0);var i=this.peekCodePoint(1);if(46===s&&ma(i))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;ma(this.peekCodePoint(0));)e.push(this.consumeCodePoint());s=this.peekCodePoint(0),i=this.peekCodePoint(1);var r=this.peekCodePoint(2);if((69===s||101===s)&&((43===i||45===i)&&ma(r)||ma(i)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=8;ma(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[Ea(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],s=e[1],i=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);return Ca(i,r,n)?{type:15,number:t,flags:s,unit:this.consumeName()}:37===i?(this.consumeCodePoint(),{type:16,number:t,flags:s}):{type:17,number:t,flags:s}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(_a(e)){for(var t=yo(e);_a(this.peekCodePoint(0))&&t.length<6;)t+=yo(this.consumeCodePoint());ba(this.peekCodePoint(0))&&this.consumeCodePoint();var s=parseInt(t,16);return 0===s||function(e){return e>=55296&&e<=57343}(s)||s>1114111?65533:s}return-1===e?65533:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(ya(t))e+=yo(t);else{if(!va(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=yo(this.consumeEscapedCodePoint())}}},e}(),Za=function(){function e(e){this._tokens=e}return e.create=function(t){var s=new Ka;return s.write(t),new e(s.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},s=this.consumeToken();;){if(32===s.type||rl(s,e))return t;this.reconsumeToken(s),t.values.push(this.consumeComponentValue()),s=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var s=this.consumeToken();if(32===s.type||3===s.type)return t;this.reconsumeToken(s),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return void 0===e?Xa:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Ja=function(e){return 15===e.type},Ya=function(e){return 17===e.type},$a=function(e){return 20===e.type},qa=function(e){return 0===e.type},el=function(e,t){return $a(e)&&e.value===t},tl=function(e){return 31!==e.type},sl=function(e){return 31!==e.type&&4!==e.type},il=function(e){var t=[],s=[];return e.forEach((function(e){if(4===e.type){if(0===s.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(s),void(s=[])}31!==e.type&&s.push(e)})),s.length&&t.push(s),t},rl=function(e,t){return 11===t&&12===e.type||(28===t&&29===e.type||2===t&&3===e.type)},nl=function(e){return 17===e.type||15===e.type},Al=function(e){return 16===e.type||nl(e)},ol=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},al={type:17,number:0,flags:4},ll={type:16,number:50,flags:4},cl={type:16,number:100,flags:4},hl=function(e,t,s){var i=e[0],r=e[1];return[ul(i,t),ul(void 0!==r?r:i,s)]},ul=function(e,t){if(16===e.type)return e.number/100*t;if(Ja(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},dl=function(e,t){if(15===t.type)switch(t.unit){case"deg":return Math.PI*t.number/180;case"grad":return Math.PI/200*t.number;case"rad":return t.number;case"turn":return 2*Math.PI*t.number}throw new Error("Unsupported angle type")},pl=function(e){return 15===e.type&&("deg"===e.unit||"grad"===e.unit||"rad"===e.unit||"turn"===e.unit)},fl=function(e){switch(e.filter($a).map((function(e){return e.value})).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[al,al];case"to top":case"bottom":return gl(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[al,cl];case"to right":case"left":return gl(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[cl,cl];case"to bottom":case"top":return gl(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[cl,al];case"to left":case"right":return gl(270)}return 0},gl=function(e){return Math.PI*e/180},ml=function(e,t){if(18===t.type){var s=Ml[t.name];if(void 0===s)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return s(e,t.values)}if(5===t.type){if(3===t.value.length){var i=t.value.substring(0,1),r=t.value.substring(1,2),n=t.value.substring(2,3);return Bl(parseInt(i+i,16),parseInt(r+r,16),parseInt(n+n,16),1)}if(4===t.value.length){i=t.value.substring(0,1),r=t.value.substring(1,2),n=t.value.substring(2,3);var A=t.value.substring(3,4);return Bl(parseInt(i+i,16),parseInt(r+r,16),parseInt(n+n,16),parseInt(A+A,16)/255)}if(6===t.value.length){i=t.value.substring(0,2),r=t.value.substring(2,4),n=t.value.substring(4,6);return Bl(parseInt(i,16),parseInt(r,16),parseInt(n,16),1)}if(8===t.value.length){i=t.value.substring(0,2),r=t.value.substring(2,4),n=t.value.substring(4,6),A=t.value.substring(6,8);return Bl(parseInt(i,16),parseInt(r,16),parseInt(n,16),parseInt(A,16)/255)}}if(20===t.type){var o=Fl[t.value.toUpperCase()];if(void 0!==o)return o}return Fl.TRANSPARENT},_l=function(e){return 0==(255&e)},bl=function(e){var t=255&e,s=255&e>>8,i=255&e>>16,r=255&e>>24;return t<255?"rgba("+r+","+i+","+s+","+t/255+")":"rgb("+r+","+i+","+s+")"},Bl=function(e,t,s,i){return(e<<24|t<<16|s<<8|Math.round(255*i)<<0)>>>0},yl=function(e,t){if(17===e.type)return e.number;if(16===e.type){var s=3===t?1:255;return 3===t?e.number/100*s:Math.round(e.number/100*s)}return 0},wl=function(e,t){var s=t.filter(sl);if(3===s.length){var i=s.map(yl),r=i[0],n=i[1],A=i[2];return Bl(r,n,A,1)}if(4===s.length){var o=s.map(yl),a=(r=o[0],n=o[1],A=o[2],o[3]);return Bl(r,n,A,a)}return 0};function vl(e,t,s){return s<0&&(s+=1),s>=1&&(s-=1),s<1/6?(t-e)*s*6+e:s<.5?t:s<2/3?6*(t-e)*(2/3-s)+e:e}var Cl=function(e,t){var s=t.filter(sl),i=s[0],r=s[1],n=s[2],A=s[3],o=(17===i.type?gl(i.number):dl(e,i))/(2*Math.PI),a=Al(r)?r.number/100:0,l=Al(n)?n.number/100:0,c=void 0!==A&&Al(A)?ul(A,1):1;if(0===a)return Bl(255*l,255*l,255*l,1);var h=l<=.5?l*(a+1):l+a-l*a,u=2*l-h,d=vl(u,h,o+1/3),p=vl(u,h,o),f=vl(u,h,o-1/3);return Bl(255*d,255*p,255*f,c)},Ml={hsl:Cl,hsla:Cl,rgb:wl,rgba:wl},El=function(e,t){return ml(e,Za.create(t).parseComponentValue())},Fl={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},xl={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if($a(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Ul={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Il=function(e,t){var s=ml(e,t[0]),i=t[1];return i&&Al(i)?{color:s,stop:i}:{color:s,stop:null}},Tl=function(e,t){var s=e[0],i=e[e.length-1];null===s.stop&&(s.stop=al),null===i.stop&&(i.stop=cl);for(var r=[],n=0,A=0;A<e.length;A++){var o=e[A].stop;if(null!==o){var a=ul(o,t);a>n?r.push(a):r.push(n),n=a}else r.push(null)}var l=null;for(A=0;A<r.length;A++){var c=r[A];if(null===c)null===l&&(l=A);else if(null!==l){for(var h=A-l,u=(c-r[l-1])/(h+1),d=1;d<=h;d++)r[l+d-1]=u*d;l=null}}return e.map((function(e,s){return{color:e.color,stop:Math.max(Math.min(1,r[s]/t),0)}}))},Pl=function(e,t,s){var i="number"==typeof e?e:function(e,t,s){var i=t/2,r=s/2,n=ul(e[0],t)-i,A=r-ul(e[1],s);return(Math.atan2(A,n)+2*Math.PI)%(2*Math.PI)}(e,t,s),r=Math.abs(t*Math.sin(i))+Math.abs(s*Math.cos(i)),n=t/2,A=s/2,o=r/2,a=Math.sin(i-Math.PI/2)*o,l=Math.cos(i-Math.PI/2)*o;return[r,n-l,n+l,A-a,A+a]},Sl=function(e,t){return Math.sqrt(e*e+t*t)},Dl=function(e,t,s,i,r){return[[0,0],[0,t],[e,0],[e,t]].reduce((function(e,t){var n=t[0],A=t[1],o=Sl(s-n,i-A);return(r?o<e.optimumDistance:o>e.optimumDistance)?{optimumCorner:t,optimumDistance:o}:e}),{optimumDistance:r?1/0:-1/0,optimumCorner:null}).optimumCorner},kl=function(e,t){var s=gl(180),i=[];return il(t).forEach((function(t,r){if(0===r){var n=t[0];if(20===n.type&&-1!==["top","left","right","bottom"].indexOf(n.value))return void(s=fl(t));if(pl(n))return void(s=(dl(e,n)+gl(270))%gl(360))}var A=Il(e,t);i.push(A)})),{angle:s,stops:i,type:1}},Ql=function(e,t){var s=0,i=3,r=[],n=[];return il(t).forEach((function(t,A){var o=!0;if(0===A?o=t.reduce((function(e,t){if($a(t))switch(t.value){case"center":return n.push(ll),!1;case"top":case"left":return n.push(al),!1;case"right":case"bottom":return n.push(cl),!1}else if(Al(t)||nl(t))return n.push(t),!1;return e}),o):1===A&&(o=t.reduce((function(e,t){if($a(t))switch(t.value){case"circle":return s=0,!1;case"ellipse":return s=1,!1;case"contain":case"closest-side":return i=0,!1;case"farthest-side":return i=1,!1;case"closest-corner":return i=2,!1;case"cover":case"farthest-corner":return i=3,!1}else if(nl(t)||Al(t))return Array.isArray(i)||(i=[]),i.push(t),!1;return e}),o)),o){var a=Il(e,t);r.push(a)}})),{size:i,shape:s,stops:r,position:n,type:2}},Rl=function(e,t){if(22===t.type){var s={url:t.value,type:0};return e.cache.addImage(t.value),s}if(18===t.type){var i=Vl[t.name];if(void 0===i)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return i(e,t.values)}throw new Error("Unsupported image type "+t.type)};var Ol,Vl={"linear-gradient":function(e,t){var s=gl(180),i=[];return il(t).forEach((function(t,r){if(0===r){var n=t[0];if(20===n.type&&"to"===n.value)return void(s=fl(t));if(pl(n))return void(s=dl(e,n))}var A=Il(e,t);i.push(A)})),{angle:s,stops:i,type:1}},"-moz-linear-gradient":kl,"-ms-linear-gradient":kl,"-o-linear-gradient":kl,"-webkit-linear-gradient":kl,"radial-gradient":function(e,t){var s=0,i=3,r=[],n=[];return il(t).forEach((function(t,A){var o=!0;if(0===A){var a=!1;o=t.reduce((function(e,t){if(a)if($a(t))switch(t.value){case"center":return n.push(ll),e;case"top":case"left":return n.push(al),e;case"right":case"bottom":return n.push(cl),e}else(Al(t)||nl(t))&&n.push(t);else if($a(t))switch(t.value){case"circle":return s=0,!1;case"ellipse":return s=1,!1;case"at":return a=!0,!1;case"closest-side":return i=0,!1;case"cover":case"farthest-side":return i=1,!1;case"contain":case"closest-corner":return i=2,!1;case"farthest-corner":return i=3,!1}else if(nl(t)||Al(t))return Array.isArray(i)||(i=[]),i.push(t),!1;return e}),o)}if(o){var l=Il(e,t);r.push(l)}})),{size:i,shape:s,stops:r,position:n,type:2}},"-moz-radial-gradient":Ql,"-ms-radial-gradient":Ql,"-o-radial-gradient":Ql,"-webkit-radial-gradient":Ql,"-webkit-gradient":function(e,t){var s=gl(180),i=[],r=1;return il(t).forEach((function(t,s){var n=t[0];if(0===s){if($a(n)&&"linear"===n.value)return void(r=1);if($a(n)&&"radial"===n.value)return void(r=2)}if(18===n.type)if("from"===n.name){var A=ml(e,n.values[0]);i.push({stop:al,color:A})}else if("to"===n.name){A=ml(e,n.values[0]);i.push({stop:cl,color:A})}else if("color-stop"===n.name){var o=n.values.filter(sl);if(2===o.length){A=ml(e,o[1]);var a=o[0];Ya(a)&&i.push({stop:{type:16,number:100*a.number,flags:a.flags},color:A})}}})),1===r?{angle:(s+gl(180))%gl(360),stops:i,type:r}:{size:3,shape:0,stops:i,position:[],type:r}}},Ll={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var s=t[0];return 20===s.type&&"none"===s.value?[]:t.filter((function(e){return sl(e)&&function(e){return!(20===e.type&&"none"===e.value||18===e.type&&!Vl[e.name])}(e)})).map((function(t){return Rl(e,t)}))}},Hl={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map((function(e){if($a(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0}))}},Nl={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return il(t).map((function(e){return e.filter(Al)})).map(ol)}},Gl={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return il(t).map((function(e){return e.filter($a).map((function(e){return e.value})).join(" ")})).map(jl)}},jl=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Ol||(Ol={}));var Wl,zl={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return il(t).map((function(e){return e.filter(Xl)}))}},Xl=function(e){return $a(e)||Al(e)},Kl=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Zl=Kl("top"),Jl=Kl("right"),Yl=Kl("bottom"),$l=Kl("left"),ql=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return ol(t.filter(Al))}}},ec=ql("top-left"),tc=ql("top-right"),sc=ql("bottom-right"),ic=ql("bottom-left"),rc=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},nc=rc("top"),Ac=rc("right"),oc=rc("bottom"),ac=rc("left"),lc=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ja(t)?t.number:0}}},cc=lc("top"),hc=lc("right"),uc=lc("bottom"),dc=lc("left"),pc={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},fc={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},gc={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter($a).reduce((function(e,t){return e|mc(t.value)}),0)}},mc=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},_c={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},bc={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Wl||(Wl={}));var Bc,yc={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Wl.STRICT:Wl.NORMAL}},wc={name:"line-height",initialValue:"normal",prefix:!1,type:4},vc=function(e,t){return $a(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:Al(e)?ul(e,t):t},Cc={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:Rl(e,t)}},Mc={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},Ec={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Fc=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},xc=Fc("top"),Uc=Fc("right"),Ic=Fc("bottom"),Tc=Fc("left"),Pc={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter($a).map((function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}}))}},Sc={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Dc=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},kc=Dc("top"),Qc=Dc("right"),Rc=Dc("bottom"),Oc=Dc("left"),Vc={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Lc={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},Hc={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&el(t[0],"none")?[]:il(t).map((function(t){for(var s={color:Fl.TRANSPARENT,offsetX:al,offsetY:al,blur:al},i=0,r=0;r<t.length;r++){var n=t[r];nl(n)?(0===i?s.offsetX=n:1===i?s.offsetY=n:s.blur=n,i++):s.color=ml(e,n)}return s}))}},Nc={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},Gc={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var s=jc[t.name];if(void 0===s)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return s(t.values)}return null}},jc={matrix:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number}));return 6===t.length?t:null},matrix3d:function(e){var t=e.filter((function(e){return 17===e.type})).map((function(e){return e.number})),s=t[0],i=t[1];t[2],t[3];var r=t[4],n=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var A=t[12],o=t[13];return t[14],t[15],16===t.length?[s,i,r,n,A,o]:null}},Wc={type:16,number:50,flags:4},zc=[Wc,Wc],Xc={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var s=t.filter(Al);return 2!==s.length?zc:[s[0],s[1]]}},Kc={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(Bc||(Bc={}));for(var Zc={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return Bc.BREAK_ALL;case"keep-all":return Bc.KEEP_ALL;default:return Bc.NORMAL}}},Jc={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(Ya(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Yc=function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")},$c={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return Ya(t)?t.number:1}},qc={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},eh={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter($a).map((function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0})).filter((function(e){return 0!==e}))}},th={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var s=[],i=[];return t.forEach((function(e){switch(e.type){case 20:case 0:s.push(e.value);break;case 17:s.push(e.number.toString());break;case 4:i.push(s.join(" ")),s.length=0}})),s.length&&i.push(s.join(" ")),i.map((function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"}))}},sh={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},ih={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return Ya(t)?t.number:$a(t)&&"bold"===t.value?700:400}},rh={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter($a).map((function(e){return e.value}))}},nh={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},Ah=function(e,t){return 0!=(e&t)},oh={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var s=t[0];return 20===s.type&&"none"===s.value?[]:t}},ah={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var s=t[0];if(20===s.type&&"none"===s.value)return null;for(var i=[],r=t.filter(tl),n=0;n<r.length;n++){var A=r[n],o=r[n+1];if(20===A.type){var a=o&&Ya(o)?o.number:1;i.push({counter:A.value,increment:a})}}return i}},lh={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var s=[],i=t.filter(tl),r=0;r<i.length;r++){var n=i[r],A=i[r+1];if($a(n)&&"none"!==n.value){var o=A&&Ya(A)?A.number:0;s.push({counter:n.value,reset:o})}}return s}},ch={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Ja).map((function(t){return Yc(e,t)}))}},hh={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var s=t[0];if(20===s.type&&"none"===s.value)return null;var i=[],r=t.filter(qa);if(r.length%2!=0)return null;for(var n=0;n<r.length;n+=2){var A=r[n].value,o=r[n+1].value;i.push({open:A,close:o})}return i}},uh=function(e,t,s){if(!e)return"";var i=e[Math.min(t,e.length-1)];return i?s?i.open:i.close:""},dh={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&el(t[0],"none")?[]:il(t).map((function(t){for(var s={color:255,offsetX:al,offsetY:al,blur:al,spread:al,inset:!1},i=0,r=0;r<t.length;r++){var n=t[r];el(n,"inset")?s.inset=!0:nl(n)?(0===i?s.offsetX=n:1===i?s.offsetY=n:2===i?s.blur=n:s.spread=n,i++):s.color=ml(e,n)}return s}))}},ph={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var s=[];return t.filter($a).forEach((function(e){switch(e.value){case"stroke":s.push(1);break;case"fill":s.push(0);break;case"markers":s.push(2)}})),[0,1,2].forEach((function(e){-1===s.indexOf(e)&&s.push(e)})),s}},fh={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},gh={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Ja(t)?t.number:0}},mh=function(){function e(e,t){var s,i;this.animationDuration=Bh(e,ch,t.animationDuration),this.backgroundClip=Bh(e,xl,t.backgroundClip),this.backgroundColor=Bh(e,Ul,t.backgroundColor),this.backgroundImage=Bh(e,Ll,t.backgroundImage),this.backgroundOrigin=Bh(e,Hl,t.backgroundOrigin),this.backgroundPosition=Bh(e,Nl,t.backgroundPosition),this.backgroundRepeat=Bh(e,Gl,t.backgroundRepeat),this.backgroundSize=Bh(e,zl,t.backgroundSize),this.borderTopColor=Bh(e,Zl,t.borderTopColor),this.borderRightColor=Bh(e,Jl,t.borderRightColor),this.borderBottomColor=Bh(e,Yl,t.borderBottomColor),this.borderLeftColor=Bh(e,$l,t.borderLeftColor),this.borderTopLeftRadius=Bh(e,ec,t.borderTopLeftRadius),this.borderTopRightRadius=Bh(e,tc,t.borderTopRightRadius),this.borderBottomRightRadius=Bh(e,sc,t.borderBottomRightRadius),this.borderBottomLeftRadius=Bh(e,ic,t.borderBottomLeftRadius),this.borderTopStyle=Bh(e,nc,t.borderTopStyle),this.borderRightStyle=Bh(e,Ac,t.borderRightStyle),this.borderBottomStyle=Bh(e,oc,t.borderBottomStyle),this.borderLeftStyle=Bh(e,ac,t.borderLeftStyle),this.borderTopWidth=Bh(e,cc,t.borderTopWidth),this.borderRightWidth=Bh(e,hc,t.borderRightWidth),this.borderBottomWidth=Bh(e,uc,t.borderBottomWidth),this.borderLeftWidth=Bh(e,dc,t.borderLeftWidth),this.boxShadow=Bh(e,dh,t.boxShadow),this.color=Bh(e,pc,t.color),this.direction=Bh(e,fc,t.direction),this.display=Bh(e,gc,t.display),this.float=Bh(e,_c,t.cssFloat),this.fontFamily=Bh(e,th,t.fontFamily),this.fontSize=Bh(e,sh,t.fontSize),this.fontStyle=Bh(e,nh,t.fontStyle),this.fontVariant=Bh(e,rh,t.fontVariant),this.fontWeight=Bh(e,ih,t.fontWeight),this.letterSpacing=Bh(e,bc,t.letterSpacing),this.lineBreak=Bh(e,yc,t.lineBreak),this.lineHeight=Bh(e,wc,t.lineHeight),this.listStyleImage=Bh(e,Cc,t.listStyleImage),this.listStylePosition=Bh(e,Mc,t.listStylePosition),this.listStyleType=Bh(e,Ec,t.listStyleType),this.marginTop=Bh(e,xc,t.marginTop),this.marginRight=Bh(e,Uc,t.marginRight),this.marginBottom=Bh(e,Ic,t.marginBottom),this.marginLeft=Bh(e,Tc,t.marginLeft),this.opacity=Bh(e,$c,t.opacity);var r=Bh(e,Pc,t.overflow);this.overflowX=r[0],this.overflowY=r[r.length>1?1:0],this.overflowWrap=Bh(e,Sc,t.overflowWrap),this.paddingTop=Bh(e,kc,t.paddingTop),this.paddingRight=Bh(e,Qc,t.paddingRight),this.paddingBottom=Bh(e,Rc,t.paddingBottom),this.paddingLeft=Bh(e,Oc,t.paddingLeft),this.paintOrder=Bh(e,ph,t.paintOrder),this.position=Bh(e,Lc,t.position),this.textAlign=Bh(e,Vc,t.textAlign),this.textDecorationColor=Bh(e,qc,null!==(s=t.textDecorationColor)&&void 0!==s?s:t.color),this.textDecorationLine=Bh(e,eh,null!==(i=t.textDecorationLine)&&void 0!==i?i:t.textDecoration),this.textShadow=Bh(e,Hc,t.textShadow),this.textTransform=Bh(e,Nc,t.textTransform),this.transform=Bh(e,Gc,t.transform),this.transformOrigin=Bh(e,Xc,t.transformOrigin),this.visibility=Bh(e,Kc,t.visibility),this.webkitTextStrokeColor=Bh(e,fh,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=Bh(e,gh,t.webkitTextStrokeWidth),this.wordBreak=Bh(e,Zc,t.wordBreak),this.zIndex=Bh(e,Jc,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return _l(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return Ah(this.display,4)||Ah(this.display,33554432)||Ah(this.display,268435456)||Ah(this.display,536870912)||Ah(this.display,67108864)||Ah(this.display,134217728)},e}(),_h=function(e,t){this.content=Bh(e,oh,t.content),this.quotes=Bh(e,hh,t.quotes)},bh=function(e,t){this.counterIncrement=Bh(e,ah,t.counterIncrement),this.counterReset=Bh(e,lh,t.counterReset)},Bh=function(e,t,s){var i=new Ka,r=null!=s?s.toString():t.initialValue;i.write(r);var n=new Za(i.read());switch(t.type){case 2:var A=n.parseComponentValue();return t.parse(e,$a(A)?A.value:t.initialValue);case 0:return t.parse(e,n.parseComponentValue());case 1:return t.parse(e,n.parseComponentValues());case 4:return n.parseComponentValue();case 3:switch(t.format){case"angle":return dl(e,n.parseComponentValue());case"color":return ml(e,n.parseComponentValue());case"image":return Rl(e,n.parseComponentValue());case"length":var o=n.parseComponentValue();return nl(o)?o:al;case"length-percentage":var a=n.parseComponentValue();return Al(a)?a:al;case"time":return Yc(e,n.parseComponentValue())}}},yh=function(e,t){var s=function(e){switch(e.getAttribute("data-html2canvas-debug")){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}}(e);return 1===s||t===s},wh=function(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,yh(t,3),this.styles=new mh(e,window.getComputedStyle(t,null)),wu(t)&&(this.styles.animationDuration.some((function(e){return e>0}))&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=bo(this.context,t),yh(t,4)&&(this.flags|=16)},vh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ch="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Mh=0;Mh<vh.length;Mh++)Ch[vh.charCodeAt(Mh)]=Mh;for(var Eh=function(e,t,s){return e.slice?e.slice(t,s):new Uint16Array(Array.prototype.slice.call(e,t,s))},Fh=function(){function e(e,t,s,i,r,n){this.initialValue=e,this.errorValue=t,this.highStart=s,this.highValueIndex=i,this.index=r,this.data=n}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>5])<<2)+(31&e),this.data[t];if(e<=65535)return t=((t=this.index[2048+(e-55296>>5)])<<2)+(31&e),this.data[t];if(e<this.highStart)return t=2080+(e>>11),t=this.index[t],t+=e>>5&63,t=((t=this.index[t])<<2)+(31&e),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),xh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Uh="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Ih=0;Ih<xh.length;Ih++)Uh[xh.charCodeAt(Ih)]=Ih;var Th,Ph=8,Sh=9,Dh=11,kh=12,Qh=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var s=e.length;if(!s)return"";for(var i=[],r=-1,n="";++r<s;){var A=e[r];A<=65535?i.push(A):(A-=65536,i.push(55296+(A>>10),A%1024+56320)),(r+1===s||i.length>16384)&&(n+=String.fromCharCode.apply(String,i),i.length=0)}return n},Rh=function(e,t){var s,i,r,n=function(e){var t,s,i,r,n,A=.75*e.length,o=e.length,a=0;"="===e[e.length-1]&&(A--,"="===e[e.length-2]&&A--);var l="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array&&void 0!==Uint8Array.prototype.slice?new ArrayBuffer(A):new Array(A),c=Array.isArray(l)?l:new Uint8Array(l);for(t=0;t<o;t+=4)s=Ch[e.charCodeAt(t)],i=Ch[e.charCodeAt(t+1)],r=Ch[e.charCodeAt(t+2)],n=Ch[e.charCodeAt(t+3)],c[a++]=s<<2|i>>4,c[a++]=(15&i)<<4|r>>2,c[a++]=(3&r)<<6|63&n;return l}(e),A=Array.isArray(n)?function(e){for(var t=e.length,s=[],i=0;i<t;i+=4)s.push(e[i+3]<<24|e[i+2]<<16|e[i+1]<<8|e[i]);return s}(n):new Uint32Array(n),o=Array.isArray(n)?function(e){for(var t=e.length,s=[],i=0;i<t;i+=2)s.push(e[i+1]<<8|e[i]);return s}(n):new Uint16Array(n),a=Eh(o,12,A[4]/2),l=2===A[5]?Eh(o,(24+A[4])/2):(s=A,i=Math.ceil((24+A[4])/4),s.slice?s.slice(i,r):new Uint32Array(Array.prototype.slice.call(s,i,r)));return new Fh(A[0],A[1],A[2],A[3],a,l)}("AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA="),Oh=function(e){return Rh.get(e)},Vh=function(e,t,s){var i=s-2,r=t[i],n=t[s-1],A=t[s];if(2===n&&3===A)return"";if(2===n||3===n||4===n)return"";if(2===A||3===A||4===A)return"";if(n===Ph&&-1!==[Ph,Sh,Dh,kh].indexOf(A))return"";if(!(n!==Dh&&n!==Sh||A!==Sh&&10!==A))return"";if((n===kh||10===n)&&10===A)return"";if(13===A||5===A)return"";if(7===A)return"";if(1===n)return"";if(13===n&&14===A){for(;5===r;)r=t[--i];if(14===r)return""}if(15===n&&15===A){for(var o=0;15===r;)o++,r=t[--i];if(o%2==0)return""}return""},Lh=function(e){var t=function(e){for(var t=[],s=0,i=e.length;s<i;){var r=e.charCodeAt(s++);if(r>=55296&&r<=56319&&s<i){var n=e.charCodeAt(s++);56320==(64512&n)?t.push(((1023&r)<<10)+(1023&n)+65536):(t.push(r),s--)}else t.push(r)}return t}(e),s=t.length,i=0,r=0,n=t.map(Oh);return{next:function(){if(i>=s)return{done:!0,value:null};for(var e="";i<s&&""===(e=Vh(0,n,++i)););if(""!==e||i===s){var A=Qh.apply(null,t.slice(r,i));return r=i,{value:A,done:!1}}return{done:!0,value:null}}}},Hh=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},Nh=function(e,t,s,i,r){var n="http://www.w3.org/2000/svg",A=document.createElementNS(n,"svg"),o=document.createElementNS(n,"foreignObject");return A.setAttributeNS(null,"width",e.toString()),A.setAttributeNS(null,"height",t.toString()),o.setAttributeNS(null,"width","100%"),o.setAttributeNS(null,"height","100%"),o.setAttributeNS(null,"x",s.toString()),o.setAttributeNS(null,"y",i.toString()),o.setAttributeNS(null,"externalResourcesRequired","true"),A.appendChild(o),o.appendChild(r),A},Gh=function(e){return new Promise((function(t,s){var i=new Image;i.onload=function(){return t(i)},i.onerror=s,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},jh={get SUPPORT_RANGE_BOUNDS(){var e=function(e){if(e.createRange){var t=e.createRange();if(t.getBoundingClientRect){var s=e.createElement("boundtest");s.style.height="123px",s.style.display="block",e.body.appendChild(s),t.selectNode(s);var i=t.getBoundingClientRect(),r=Math.round(i.height);if(e.body.removeChild(s),123===r)return!0}}return!1}(document);return Object.defineProperty(jh,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=jh.SUPPORT_RANGE_BOUNDS&&function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var s=e.createRange();t.innerHTML="function"==typeof"".repeat?"&#128104;".repeat(10):"";var i=t.firstChild,r=Bo(i.data).map((function(e){return yo(e)})),n=0,A={},o=r.every((function(e,t){s.setStart(i,n),s.setEnd(i,n+e.length);var r=s.getBoundingClientRect();n+=e.length;var o=r.x>A.x||r.y>A.y;return A=r,0===t||o}));return e.body.removeChild(t),o}(document);return Object.defineProperty(jh,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=function(e){var t=new Image,s=e.createElement("canvas"),i=s.getContext("2d");if(!i)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{i.drawImage(t,0,0),s.toDataURL()}catch(e){return!1}return!0}(document);return Object.defineProperty(jh,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"==typeof Array.from&&"function"==typeof window.fetch?function(e){var t=e.createElement("canvas"),s=100;t.width=s,t.height=s;var i=t.getContext("2d");if(!i)return Promise.reject(!1);i.fillStyle="rgb(0, 255, 0)",i.fillRect(0,0,s,s);var r=new Image,n=t.toDataURL();r.src=n;var A=Nh(s,s,0,0,r);return i.fillStyle="red",i.fillRect(0,0,s,s),Gh(A).then((function(t){i.drawImage(t,0,0);var r=i.getImageData(0,0,s,s).data;i.fillStyle="red",i.fillRect(0,0,s,s);var A=e.createElement("div");return A.style.backgroundImage="url("+n+")",A.style.height="100px",Hh(r)?Gh(Nh(s,s,0,0,A)):Promise.reject(!1)})).then((function(e){return i.drawImage(e,0,0),Hh(i.getImageData(0,0,s,s).data)})).catch((function(){return!1}))}(document):Promise.resolve(!1);return Object.defineProperty(jh,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=void 0!==(new Image).crossOrigin;return Object.defineProperty(jh,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e="string"==typeof(new XMLHttpRequest).responseType;return Object.defineProperty(jh,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(jh,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"==typeof Intl||!Intl.Segmenter);return Object.defineProperty(jh,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Wh=function(e,t){this.text=e,this.bounds=t},zh=function(e,t){var s=t.ownerDocument;if(s){var i=s.createElement("html2canvaswrapper");i.appendChild(t.cloneNode(!0));var r=t.parentNode;if(r){r.replaceChild(i,t);var n=bo(e,i);return i.firstChild&&r.replaceChild(i.firstChild,i),n}}return _o.EMPTY},Xh=function(e,t,s){var i=e.ownerDocument;if(!i)throw new Error("Node has no owner document");var r=i.createRange();return r.setStart(e,t),r.setEnd(e,t+s),r},Kh=function(e){if(jh.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map((function(e){return e.segment}))}return function(e){for(var t,s=Lh(e),i=[];!(t=s.next()).done;)t.value&&i.push(t.value.slice());return i}(e)},Zh=function(e,t){return 0!==t.letterSpacing?Kh(e):function(e,t){if(jh.SUPPORT_NATIVE_TEXT_SEGMENTATION){var s=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(s.segment(e)).map((function(e){return e.segment}))}return Yh(e,t)}(e,t)},Jh=[32,160,4961,65792,65793,4153,4241],Yh=function(e,t){for(var s,i=function(e,t){var s=Bo(e),i=fa(s,t),r=i[0],n=i[1],A=i[2],o=s.length,a=0,l=0;return{next:function(){if(l>=o)return{done:!0,value:null};for(var e="";l<o&&""===(e=pa(s,n,r,++l,A)););if(""!==e||l===o){var t=new ga(s,e,a,l);return a=l,{value:t,done:!1}}return{done:!0,value:null}}}}(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),r=[],n=function(){if(s.value){var e=s.value.slice(),t=Bo(e),i="";t.forEach((function(e){-1===Jh.indexOf(e)?i+=yo(e):(i.length&&r.push(i),r.push(yo(e)),i="")})),i.length&&r.push(i)}};!(s=i.next()).done;)n();return r},$h=function(e,t,s){this.text=qh(t.data,s.textTransform),this.textBounds=function(e,t,s,i){var r=Zh(t,s),n=[],A=0;return r.forEach((function(t){if(s.textDecorationLine.length||t.trim().length>0)if(jh.SUPPORT_RANGE_BOUNDS){var r=Xh(i,A,t.length).getClientRects();if(r.length>1){var o=Kh(t),a=0;o.forEach((function(t){n.push(new Wh(t,_o.fromDOMRectList(e,Xh(i,a+A,t.length).getClientRects()))),a+=t.length}))}else n.push(new Wh(t,_o.fromDOMRectList(e,r)))}else{var l=i.splitText(t.length);n.push(new Wh(t,zh(e,i))),i=l}else jh.SUPPORT_RANGE_BOUNDS||(i=i.splitText(t.length));A+=t.length})),n}(e,this.text,s,t)},qh=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(eu,tu);case 2:return e.toUpperCase();default:return e}},eu=/(^|\s|:|-|\(|\))([a-z])/g,tu=function(e,t,s){return e.length>0?t+s.toUpperCase():e},su=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i.src=s.currentSrc||s.src,i.intrinsicWidth=s.naturalWidth,i.intrinsicHeight=s.naturalHeight,i.context.cache.addImage(i.src),i}return uo(t,e),t}(wh),iu=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i.canvas=s,i.intrinsicWidth=s.width,i.intrinsicHeight=s.height,i}return uo(t,e),t}(wh),ru=function(e){function t(t,s){var i=e.call(this,t,s)||this,r=new XMLSerializer,n=bo(t,s);return s.setAttribute("width",n.width+"px"),s.setAttribute("height",n.height+"px"),i.svg="data:image/svg+xml,"+encodeURIComponent(r.serializeToString(s)),i.intrinsicWidth=s.width.baseVal.value,i.intrinsicHeight=s.height.baseVal.value,i.context.cache.addImage(i.svg),i}return uo(t,e),t}(wh),nu=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i.value=s.value,i}return uo(t,e),t}(wh),Au=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i.start=s.start,i.reversed="boolean"==typeof s.reversed&&!0===s.reversed,i}return uo(t,e),t}(wh),ou=[{type:15,flags:0,unit:"px",number:3}],au=[{type:16,flags:0,number:50}],lu="password",cu=function(e){function t(t,s){var i,r,n,A=e.call(this,t,s)||this;switch(A.type=s.type.toLowerCase(),A.checked=s.checked,A.value=0===(r=(i=s).type===lu?new Array(i.value.length+1).join(""):i.value).length?i.placeholder||"":r,"checkbox"!==A.type&&"radio"!==A.type||(A.styles.backgroundColor=3739148031,A.styles.borderTopColor=A.styles.borderRightColor=A.styles.borderBottomColor=A.styles.borderLeftColor=2779096575,A.styles.borderTopWidth=A.styles.borderRightWidth=A.styles.borderBottomWidth=A.styles.borderLeftWidth=1,A.styles.borderTopStyle=A.styles.borderRightStyle=A.styles.borderBottomStyle=A.styles.borderLeftStyle=1,A.styles.backgroundClip=[0],A.styles.backgroundOrigin=[0],A.bounds=(n=A.bounds).width>n.height?new _o(n.left+(n.width-n.height)/2,n.top,n.height,n.height):n.width<n.height?new _o(n.left,n.top+(n.height-n.width)/2,n.width,n.width):n),A.type){case"checkbox":A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=ou;break;case"radio":A.styles.borderTopRightRadius=A.styles.borderTopLeftRadius=A.styles.borderBottomRightRadius=A.styles.borderBottomLeftRadius=au}return A}return uo(t,e),t}(wh),hu=function(e){function t(t,s){var i=e.call(this,t,s)||this,r=s.options[s.selectedIndex||0];return i.value=r&&r.text||"",i}return uo(t,e),t}(wh),uu=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i.value=s.value,i}return uo(t,e),t}(wh),du=function(e){function t(t,s){var i=e.call(this,t,s)||this;i.src=s.src,i.width=parseInt(s.width,10)||0,i.height=parseInt(s.height,10)||0,i.backgroundColor=i.styles.backgroundColor;try{if(s.contentWindow&&s.contentWindow.document&&s.contentWindow.document.documentElement){i.tree=mu(t,s.contentWindow.document.documentElement);var r=s.contentWindow.document.documentElement?El(t,getComputedStyle(s.contentWindow.document.documentElement).backgroundColor):Fl.TRANSPARENT,n=s.contentWindow.document.body?El(t,getComputedStyle(s.contentWindow.document.body).backgroundColor):Fl.TRANSPARENT;i.backgroundColor=_l(r)?_l(n)?i.styles.backgroundColor:n:r}}catch(e){}return i}return uo(t,e),t}(wh),pu=["OL","UL","MENU"],fu=function(e,t,s,i){for(var r=t.firstChild,n=void 0;r;r=n)if(n=r.nextSibling,Bu(r)&&r.data.trim().length>0)s.textNodes.push(new $h(e,r,s.styles));else if(yu(r))if(Qu(r)&&r.assignedNodes)r.assignedNodes().forEach((function(t){return fu(e,t,s,i)}));else{var A=gu(e,r);A.styles.isVisible()&&(_u(r,A,i)?A.flags|=4:bu(A.styles)&&(A.flags|=2),-1!==pu.indexOf(r.tagName)&&(A.flags|=8),s.elements.push(A),r.slot,r.shadowRoot?fu(e,r.shadowRoot,A,i):Du(r)||Fu(r)||ku(r)||fu(e,r,A,i))}},gu=function(e,t){return Tu(t)?new su(e,t):Uu(t)?new iu(e,t):Fu(t)?new ru(e,t):Cu(t)?new nu(e,t):Mu(t)?new Au(e,t):Eu(t)?new cu(e,t):ku(t)?new hu(e,t):Du(t)?new uu(e,t):Pu(t)?new du(e,t):new wh(e,t)},mu=function(e,t){var s=gu(e,t);return s.flags|=4,fu(e,t,s,s),s},_u=function(e,t,s){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||xu(e)&&s.styles.isTransparent()},bu=function(e){return e.isPositioned()||e.isFloating()},Bu=function(e){return e.nodeType===Node.TEXT_NODE},yu=function(e){return e.nodeType===Node.ELEMENT_NODE},wu=function(e){return yu(e)&&void 0!==e.style&&!vu(e)},vu=function(e){return"object"==typeof e.className},Cu=function(e){return"LI"===e.tagName},Mu=function(e){return"OL"===e.tagName},Eu=function(e){return"INPUT"===e.tagName},Fu=function(e){return"svg"===e.tagName},xu=function(e){return"BODY"===e.tagName},Uu=function(e){return"CANVAS"===e.tagName},Iu=function(e){return"VIDEO"===e.tagName},Tu=function(e){return"IMG"===e.tagName},Pu=function(e){return"IFRAME"===e.tagName},Su=function(e){return"STYLE"===e.tagName},Du=function(e){return"TEXTAREA"===e.tagName},ku=function(e){return"SELECT"===e.tagName},Qu=function(e){return"SLOT"===e.tagName},Ru=function(e){return e.tagName.indexOf("-")>0},Ou=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach((function(e){return t.counters[e].pop()}))},e.prototype.parse=function(e){var t=this,s=e.counterIncrement,i=e.counterReset,r=!0;null!==s&&s.forEach((function(e){var s=t.counters[e.counter];s&&0!==e.increment&&(r=!1,s.length||s.push(1),s[Math.max(0,s.length-1)]+=e.increment)}));var n=[];return r&&i.forEach((function(e){var s=t.counters[e.counter];n.push(e.counter),s||(s=t.counters[e.counter]=[]),s.push(e.reset)})),n},e}(),Vu={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Lu={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Hu={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Nu={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""]},Gu=function(e,t,s,i,r,n){return e<t||e>s?Ku(e,r,n.length>0):i.integers.reduce((function(t,s,r){for(;e>=s;)e-=s,t+=i.values[r];return t}),"")+n},ju=function(e,t,s,i){var r="";do{s||e--,r=i(e)+r,e/=t}while(e*t>=t);return r},Wu=function(e,t,s,i,r){var n=s-t+1;return(e<0?"-":"")+(ju(Math.abs(e),n,i,(function(e){return yo(Math.floor(e%n)+t)}))+r)},zu=function(e,t,s){void 0===s&&(s=". ");var i=t.length;return ju(Math.abs(e),i,!1,(function(e){return t[Math.floor(e%i)]}))+s},Xu=function(e,t,s,i,r,n){if(e<-9999||e>9999)return Ku(e,4,r.length>0);var A=Math.abs(e),o=r;if(0===A)return t[0]+o;for(var a=0;A>0&&a<=4;a++){var l=A%10;0===l&&Ah(n,1)&&""!==o?o=t[l]+o:l>1||1===l&&0===a||1===l&&1===a&&Ah(n,2)||1===l&&1===a&&Ah(n,4)&&e>100||1===l&&a>1&&Ah(n,8)?o=t[l]+(a>0?s[a-1]:"")+o:1===l&&a>0&&(o=s[a-1]+o),A=Math.floor(A/10)}return(e<0?i:"")+o},Ku=function(e,t,s){var i=s?". ":"",r=s?"":"",n=s?", ":"",A=s?" ":"";switch(t){case 0:return""+A;case 1:return""+A;case 2:return""+A;case 5:var o=Wu(e,48,57,!0,i);return o.length<4?"0"+o:o;case 4:return zu(e,"",r);case 6:return Gu(e,1,3999,Vu,3,i).toLowerCase();case 7:return Gu(e,1,3999,Vu,3,i);case 8:return Wu(e,945,969,!1,i);case 9:return Wu(e,97,122,!1,i);case 10:return Wu(e,65,90,!1,i);case 11:return Wu(e,1632,1641,!0,i);case 12:case 49:return Gu(e,1,9999,Lu,3,i);case 35:return Gu(e,1,9999,Lu,3,i).toLowerCase();case 13:return Wu(e,2534,2543,!0,i);case 14:case 30:return Wu(e,6112,6121,!0,i);case 15:return zu(e,"",r);case 16:return zu(e,"",r);case 17:case 48:return Xu(e,"","","",r,14);case 47:return Xu(e,"","","",r,15);case 42:return Xu(e,"","","",r,14);case 41:return Xu(e,"","","",r,15);case 26:return Xu(e,"","","",r,0);case 25:return Xu(e,"","","",r,7);case 31:return Xu(e,"","","",n,7);case 33:return Xu(e,"","","",n,0);case 32:return Xu(e,"","","",n,7);case 18:return Wu(e,2406,2415,!0,i);case 20:return Gu(e,1,19999,Nu,3,i);case 21:return Wu(e,2790,2799,!0,i);case 22:return Wu(e,2662,2671,!0,i);case 22:return Gu(e,1,10999,Hu,3,i);case 23:return zu(e,"");case 24:return zu(e,"");case 27:return Wu(e,3302,3311,!0,i);case 28:return zu(e,"",r);case 29:return zu(e,"",r);case 34:return Wu(e,3792,3801,!0,i);case 37:return Wu(e,6160,6169,!0,i);case 38:return Wu(e,4160,4169,!0,i);case 39:return Wu(e,2918,2927,!0,i);case 40:return Wu(e,1776,1785,!0,i);case 43:return Wu(e,3046,3055,!0,i);case 44:return Wu(e,3174,3183,!0,i);case 45:return Wu(e,3664,3673,!0,i);case 46:return Wu(e,3872,3881,!0,i);default:return Wu(e,48,57,!0,i)}},Zu=function(){function e(e,t,s){if(this.context=e,this.options=s,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ou,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var s=this,i=Yu(e,t);if(!i.contentWindow)return Promise.reject("Unable to find iframe window");var r=e.defaultView.pageXOffset,n=e.defaultView.pageYOffset,A=i.contentWindow,o=A.document,a=ed(i).then((function(){return fo(s,void 0,void 0,(function(){var e,s;return go(this,(function(r){switch(r.label){case 0:return this.scrolledElements.forEach(nd),A&&(A.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||A.scrollY===t.top&&A.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(A.scrollX-t.left,A.scrollY-t.top,0,0))),e=this.options.onclone,void 0===(s=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:o.fonts&&o.fonts.ready?[4,o.fonts.ready]:[3,2];case 1:r.sent(),r.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,qu(o)]:[3,4];case 3:r.sent(),r.label=4;case 4:return"function"==typeof e?[2,Promise.resolve().then((function(){return e(o,s)})).then((function(){return i}))]:[2,i]}}))}))}));return o.open(),o.write(id(document.doctype)+"<html></html>"),rd(this.referenceElement.ownerDocument,r,n),o.replaceChild(o.adoptNode(this.documentElement),o.documentElement),o.close(),a},e.prototype.createElementClone=function(e){if(yh(e,2),Uu(e))return this.createCanvasClone(e);if(Iu(e))return this.createVideoClone(e);if(Su(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return Tu(t)&&(Tu(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),Ru(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return sd(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var s=[].slice.call(t.cssRules,0).reduce((function(e,t){return t&&"string"==typeof t.cssText?e+t.cssText:e}),""),i=e.cloneNode(!1);return i.textContent=s,i}}catch(e){if(this.context.logger.error("Unable to access cssRules property",e),"SecurityError"!==e.name)throw e}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var s=e.ownerDocument.createElement("img");try{return s.src=e.toDataURL(),s}catch(t){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var i=e.cloneNode(!1);try{i.width=e.width,i.height=e.height;var r=e.getContext("2d"),n=i.getContext("2d");if(n)if(!this.options.allowTaint&&r)n.putImageData(r.getImageData(0,0,e.width,e.height),0,0);else{var A=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(A){var o=A.getContextAttributes();!1===(null==o?void 0:o.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}n.drawImage(e,0,0)}return i}catch(t){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return i},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var s=t.getContext("2d");try{return s&&(s.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||s.getImageData(0,0,t.width,t.height)),t}catch(t){this.context.logger.info("Unable to clone video as it is tainted",e)}var i=e.ownerDocument.createElement("canvas");return i.width=e.offsetWidth,i.height=e.offsetHeight,i},e.prototype.appendChildNode=function(e,t,s){yu(t)&&("SCRIPT"===t.tagName||t.hasAttribute("data-html2canvas-ignore")||"function"==typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&yu(t)&&Su(t)||e.appendChild(this.cloneNode(t,s))},e.prototype.cloneChildNodes=function(e,t,s){for(var i=this,r=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;r;r=r.nextSibling)if(yu(r)&&Qu(r)&&"function"==typeof r.assignedNodes){var n=r.assignedNodes();n.length&&n.forEach((function(e){return i.appendChildNode(t,e,s)}))}else this.appendChildNode(t,r,s)},e.prototype.cloneNode=function(e,t){if(Bu(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var s=e.ownerDocument.defaultView;if(s&&yu(e)&&(wu(e)||vu(e))){var i=this.createElementClone(e);i.style.transitionProperty="none";var r=s.getComputedStyle(e),n=s.getComputedStyle(e,":before"),A=s.getComputedStyle(e,":after");this.referenceElement===e&&wu(i)&&(this.clonedReferenceElement=i),xu(i)&&ad(i);var o=this.counters.parse(new bh(this.context,r)),a=this.resolvePseudoContent(e,i,n,Th.BEFORE);Ru(e)&&(t=!0),Iu(e)||this.cloneChildNodes(e,i,t),a&&i.insertBefore(a,i.firstChild);var l=this.resolvePseudoContent(e,i,A,Th.AFTER);return l&&i.appendChild(l),this.counters.pop(o),(r&&(this.options.copyStyles||vu(e))&&!Pu(e)||t)&&sd(r,i),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([i,e.scrollLeft,e.scrollTop]),(Du(e)||ku(e))&&(Du(i)||ku(i))&&(i.value=e.value),i}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,s,i){var r=this;if(s){var n=s.content,A=t.ownerDocument;if(A&&n&&"none"!==n&&"-moz-alt-content"!==n&&"none"!==s.display){this.counters.parse(new bh(this.context,s));var o=new _h(this.context,s),a=A.createElement("html2canvaspseudoelement");sd(s,a),o.content.forEach((function(t){if(0===t.type)a.appendChild(A.createTextNode(t.value));else if(22===t.type){var s=A.createElement("img");s.src=t.value,s.style.opacity="1",a.appendChild(s)}else if(18===t.type){if("attr"===t.name){var i=t.values.filter($a);i.length&&a.appendChild(A.createTextNode(e.getAttribute(i[0].value)||""))}else if("counter"===t.name){var n=t.values.filter(sl),l=n[0],c=n[1];if(l&&$a(l)){var h=r.counters.getCounterValue(l.value),u=c&&$a(c)?Ec.parse(r.context,c.value):3;a.appendChild(A.createTextNode(Ku(h,u,!1)))}}else if("counters"===t.name){var d=t.values.filter(sl),p=(l=d[0],d[1]);c=d[2];if(l&&$a(l)){var f=r.counters.getCounterValues(l.value),g=c&&$a(c)?Ec.parse(r.context,c.value):3,m=p&&0===p.type?p.value:"",_=f.map((function(e){return Ku(e,g,!1)})).join(m);a.appendChild(A.createTextNode(_))}}}else if(20===t.type)switch(t.value){case"open-quote":a.appendChild(A.createTextNode(uh(o.quotes,r.quoteDepth++,!0)));break;case"close-quote":a.appendChild(A.createTextNode(uh(o.quotes,--r.quoteDepth,!1)));break;default:a.appendChild(A.createTextNode(t.value))}})),a.className=Ad+" "+od;var l=i===Th.BEFORE?" "+Ad:" "+od;return vu(t)?t.className.baseValue+=l:t.className+=l,a}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Th||(Th={}));var Ju,Yu=function(e,t){var s=e.createElement("iframe");return s.className="html2canvas-container",s.style.visibility="hidden",s.style.position="fixed",s.style.left="-10000px",s.style.top="0px",s.style.border="0",s.width=t.width.toString(),s.height=t.height.toString(),s.scrolling="no",s.setAttribute("data-html2canvas-ignore","true"),e.body.appendChild(s),s},$u=function(e){return new Promise((function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()}))},qu=function(e){return Promise.all([].slice.call(e.images,0).map($u))},ed=function(e){return new Promise((function(t,s){var i=e.contentWindow;if(!i)return s("No window assigned for iframe");var r=i.document;i.onload=e.onload=function(){i.onload=e.onload=null;var s=setInterval((function(){r.body.childNodes.length>0&&"complete"===r.readyState&&(clearInterval(s),t(e))}),50)}}))},td=["all","d","content"],sd=function(e,t){for(var s=e.length-1;s>=0;s--){var i=e.item(s);-1===td.indexOf(i)&&t.style.setProperty(i,e.getPropertyValue(i))}return t},id=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},rd=function(e,t,s){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||s!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,s)},nd=function(e){var t=e[0],s=e[1],i=e[2];t.scrollLeft=s,t.scrollTop=i},Ad="___html2canvas___pseudoelement_before",od="___html2canvas___pseudoelement_after",ad=function(e){ld(e,"."+Ad+':before{\n    content: "" !important;\n    display: none !important;\n}\n         .'+od+':after{\n    content: "" !important;\n    display: none !important;\n}')},ld=function(e,t){var s=e.ownerDocument;if(s){var i=s.createElement("style");i.textContent=t,e.appendChild(i)}},cd=function(){function e(){}return e.getOrigin=function(t){var s=e._link;return s?(s.href=t,s.href=s.href,s.protocol+s.hostname+s.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),hd=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:_d(e)||fd(e)?((this._cache[e]=this.loadImage(e)).catch((function(){})),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return fo(this,void 0,void 0,(function(){var t,s,i,r,n=this;return go(this,(function(A){switch(A.label){case 0:return t=cd.isSameOrigin(e),s=!gd(e)&&!0===this._options.useCORS&&jh.SUPPORT_CORS_IMAGES&&!t,i=!gd(e)&&!t&&!_d(e)&&"string"==typeof this._options.proxy&&jh.SUPPORT_CORS_XHR&&!s,t||!1!==this._options.allowTaint||gd(e)||_d(e)||i||s?(r=e,i?[4,this.proxy(r)]:[3,2]):[2];case 1:r=A.sent(),A.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise((function(e,t){var i=new Image;i.onload=function(){return e(i)},i.onerror=t,(md(r)||s)&&(i.crossOrigin="anonymous"),i.src=r,!0===i.complete&&setTimeout((function(){return e(i)}),500),n._options.imageTimeout>0&&setTimeout((function(){return t("Timed out ("+n._options.imageTimeout+"ms) loading image")}),n._options.imageTimeout)}))];case 3:return[2,A.sent()]}}))}))},e.prototype.has=function(e){return void 0!==this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,s=this._options.proxy;if(!s)throw new Error("No proxy defined");var i=e.substring(0,256);return new Promise((function(r,n){var A=jh.SUPPORT_RESPONSE_TYPE?"blob":"text",o=new XMLHttpRequest;o.onload=function(){if(200===o.status)if("text"===A)r(o.response);else{var e=new FileReader;e.addEventListener("load",(function(){return r(e.result)}),!1),e.addEventListener("error",(function(e){return n(e)}),!1),e.readAsDataURL(o.response)}else n("Failed to proxy resource "+i+" with status code "+o.status)},o.onerror=n;var a=s.indexOf("?")>-1?"&":"?";if(o.open("GET",""+s+a+"url="+encodeURIComponent(e)+"&responseType="+A),"text"!==A&&o instanceof XMLHttpRequest&&(o.responseType=A),t._options.imageTimeout){var l=t._options.imageTimeout;o.timeout=l,o.ontimeout=function(){return n("Timed out ("+l+"ms) proxying "+i)}}o.send()}))},e}(),ud=/^data:image\/svg\+xml/i,dd=/^data:image\/.*;base64,/i,pd=/^data:image\/.*/i,fd=function(e){return jh.SUPPORT_SVG_DRAWING||!bd(e)},gd=function(e){return pd.test(e)},md=function(e){return dd.test(e)},_d=function(e){return"blob"===e.substr(0,4)},bd=function(e){return"svg"===e.substr(-3).toLowerCase()||ud.test(e)},Bd=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,s){return new e(this.x+t,this.y+s)},e}(),yd=function(e,t,s){return new Bd(e.x+(t.x-e.x)*s,e.y+(t.y-e.y)*s)},wd=function(){function e(e,t,s,i){this.type=1,this.start=e,this.startControl=t,this.endControl=s,this.end=i}return e.prototype.subdivide=function(t,s){var i=yd(this.start,this.startControl,t),r=yd(this.startControl,this.endControl,t),n=yd(this.endControl,this.end,t),A=yd(i,r,t),o=yd(r,n,t),a=yd(A,o,t);return s?new e(this.start,i,A,a):new e(a,o,n,this.end)},e.prototype.add=function(t,s){return new e(this.start.add(t,s),this.startControl.add(t,s),this.endControl.add(t,s),this.end.add(t,s))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),vd=function(e){return 1===e.type},Cd=function(e){var t=e.styles,s=e.bounds,i=hl(t.borderTopLeftRadius,s.width,s.height),r=i[0],n=i[1],A=hl(t.borderTopRightRadius,s.width,s.height),o=A[0],a=A[1],l=hl(t.borderBottomRightRadius,s.width,s.height),c=l[0],h=l[1],u=hl(t.borderBottomLeftRadius,s.width,s.height),d=u[0],p=u[1],f=[];f.push((r+o)/s.width),f.push((d+c)/s.width),f.push((n+p)/s.height),f.push((a+h)/s.height);var g=Math.max.apply(Math,f);g>1&&(r/=g,n/=g,o/=g,a/=g,c/=g,h/=g,d/=g,p/=g);var m=s.width-o,_=s.height-h,b=s.width-c,B=s.height-p,y=t.borderTopWidth,w=t.borderRightWidth,v=t.borderBottomWidth,C=t.borderLeftWidth,M=ul(t.paddingTop,e.bounds.width),E=ul(t.paddingRight,e.bounds.width),F=ul(t.paddingBottom,e.bounds.width),x=ul(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=r>0||n>0?Md(s.left+C/3,s.top+y/3,r-C/3,n-y/3,Ju.TOP_LEFT):new Bd(s.left+C/3,s.top+y/3),this.topRightBorderDoubleOuterBox=r>0||n>0?Md(s.left+m,s.top+y/3,o-w/3,a-y/3,Ju.TOP_RIGHT):new Bd(s.left+s.width-w/3,s.top+y/3),this.bottomRightBorderDoubleOuterBox=c>0||h>0?Md(s.left+b,s.top+_,c-w/3,h-v/3,Ju.BOTTOM_RIGHT):new Bd(s.left+s.width-w/3,s.top+s.height-v/3),this.bottomLeftBorderDoubleOuterBox=d>0||p>0?Md(s.left+C/3,s.top+B,d-C/3,p-v/3,Ju.BOTTOM_LEFT):new Bd(s.left+C/3,s.top+s.height-v/3),this.topLeftBorderDoubleInnerBox=r>0||n>0?Md(s.left+2*C/3,s.top+2*y/3,r-2*C/3,n-2*y/3,Ju.TOP_LEFT):new Bd(s.left+2*C/3,s.top+2*y/3),this.topRightBorderDoubleInnerBox=r>0||n>0?Md(s.left+m,s.top+2*y/3,o-2*w/3,a-2*y/3,Ju.TOP_RIGHT):new Bd(s.left+s.width-2*w/3,s.top+2*y/3),this.bottomRightBorderDoubleInnerBox=c>0||h>0?Md(s.left+b,s.top+_,c-2*w/3,h-2*v/3,Ju.BOTTOM_RIGHT):new Bd(s.left+s.width-2*w/3,s.top+s.height-2*v/3),this.bottomLeftBorderDoubleInnerBox=d>0||p>0?Md(s.left+2*C/3,s.top+B,d-2*C/3,p-2*v/3,Ju.BOTTOM_LEFT):new Bd(s.left+2*C/3,s.top+s.height-2*v/3),this.topLeftBorderStroke=r>0||n>0?Md(s.left+C/2,s.top+y/2,r-C/2,n-y/2,Ju.TOP_LEFT):new Bd(s.left+C/2,s.top+y/2),this.topRightBorderStroke=r>0||n>0?Md(s.left+m,s.top+y/2,o-w/2,a-y/2,Ju.TOP_RIGHT):new Bd(s.left+s.width-w/2,s.top+y/2),this.bottomRightBorderStroke=c>0||h>0?Md(s.left+b,s.top+_,c-w/2,h-v/2,Ju.BOTTOM_RIGHT):new Bd(s.left+s.width-w/2,s.top+s.height-v/2),this.bottomLeftBorderStroke=d>0||p>0?Md(s.left+C/2,s.top+B,d-C/2,p-v/2,Ju.BOTTOM_LEFT):new Bd(s.left+C/2,s.top+s.height-v/2),this.topLeftBorderBox=r>0||n>0?Md(s.left,s.top,r,n,Ju.TOP_LEFT):new Bd(s.left,s.top),this.topRightBorderBox=o>0||a>0?Md(s.left+m,s.top,o,a,Ju.TOP_RIGHT):new Bd(s.left+s.width,s.top),this.bottomRightBorderBox=c>0||h>0?Md(s.left+b,s.top+_,c,h,Ju.BOTTOM_RIGHT):new Bd(s.left+s.width,s.top+s.height),this.bottomLeftBorderBox=d>0||p>0?Md(s.left,s.top+B,d,p,Ju.BOTTOM_LEFT):new Bd(s.left,s.top+s.height),this.topLeftPaddingBox=r>0||n>0?Md(s.left+C,s.top+y,Math.max(0,r-C),Math.max(0,n-y),Ju.TOP_LEFT):new Bd(s.left+C,s.top+y),this.topRightPaddingBox=o>0||a>0?Md(s.left+Math.min(m,s.width-w),s.top+y,m>s.width+w?0:Math.max(0,o-w),Math.max(0,a-y),Ju.TOP_RIGHT):new Bd(s.left+s.width-w,s.top+y),this.bottomRightPaddingBox=c>0||h>0?Md(s.left+Math.min(b,s.width-C),s.top+Math.min(_,s.height-v),Math.max(0,c-w),Math.max(0,h-v),Ju.BOTTOM_RIGHT):new Bd(s.left+s.width-w,s.top+s.height-v),this.bottomLeftPaddingBox=d>0||p>0?Md(s.left+C,s.top+Math.min(B,s.height-v),Math.max(0,d-C),Math.max(0,p-v),Ju.BOTTOM_LEFT):new Bd(s.left+C,s.top+s.height-v),this.topLeftContentBox=r>0||n>0?Md(s.left+C+x,s.top+y+M,Math.max(0,r-(C+x)),Math.max(0,n-(y+M)),Ju.TOP_LEFT):new Bd(s.left+C+x,s.top+y+M),this.topRightContentBox=o>0||a>0?Md(s.left+Math.min(m,s.width+C+x),s.top+y+M,m>s.width+C+x?0:o-C+x,a-(y+M),Ju.TOP_RIGHT):new Bd(s.left+s.width-(w+E),s.top+y+M),this.bottomRightContentBox=c>0||h>0?Md(s.left+Math.min(b,s.width-(C+x)),s.top+Math.min(_,s.height+y+M),Math.max(0,c-(w+E)),h-(v+F),Ju.BOTTOM_RIGHT):new Bd(s.left+s.width-(w+E),s.top+s.height-(v+F)),this.bottomLeftContentBox=d>0||p>0?Md(s.left+C+x,s.top+B,Math.max(0,d-(C+x)),p-(v+F),Ju.BOTTOM_LEFT):new Bd(s.left+C+x,s.top+s.height-(v+F))};!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Ju||(Ju={}));var Md=function(e,t,s,i,r){var n=(Math.sqrt(2)-1)/3*4,A=s*n,o=i*n,a=e+s,l=t+i;switch(r){case Ju.TOP_LEFT:return new wd(new Bd(e,l),new Bd(e,l-o),new Bd(a-A,t),new Bd(a,t));case Ju.TOP_RIGHT:return new wd(new Bd(e,t),new Bd(e+A,t),new Bd(a,l-o),new Bd(a,l));case Ju.BOTTOM_RIGHT:return new wd(new Bd(a,t),new Bd(a,t+o),new Bd(e+A,l),new Bd(e,l));case Ju.BOTTOM_LEFT:default:return new wd(new Bd(a,l),new Bd(a-A,l),new Bd(e,t+o),new Bd(e,t))}},Ed=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},Fd=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},xd=function(e,t,s){this.offsetX=e,this.offsetY=t,this.matrix=s,this.type=0,this.target=6},Ud=function(e,t){this.path=e,this.target=t,this.type=1},Id=function(e){this.opacity=e,this.type=2,this.target=6},Td=function(e){return 1===e.type},Pd=function(e,t){return e.length===t.length&&e.some((function(e,s){return e===t[s]}))},Sd=function(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]},Dd=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new Cd(this.container),this.container.styles.opacity<1&&this.effects.push(new Id(this.container.styles.opacity)),null!==this.container.styles.transform){var s=this.container.bounds.left+this.container.styles.transformOrigin[0].number,i=this.container.bounds.top+this.container.styles.transformOrigin[1].number,r=this.container.styles.transform;this.effects.push(new xd(s,i,r))}if(0!==this.container.styles.overflowX){var n=Ed(this.curves),A=Fd(this.curves);Pd(n,A)?this.effects.push(new Ud(n,6)):(this.effects.push(new Ud(n,2)),this.effects.push(new Ud(A,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),s=this.parent,i=this.effects.slice(0);s;){var r=s.effects.filter((function(e){return!Td(e)}));if(t||0!==s.container.styles.position||!s.parent){if(i.unshift.apply(i,r),t=-1===[2,3].indexOf(s.container.styles.position),0!==s.container.styles.overflowX){var n=Ed(s.curves),A=Fd(s.curves);Pd(n,A)||i.unshift(new Ud(A,6))}}else i.unshift.apply(i,r);s=s.parent}return i.filter((function(t){return Ah(t.target,e)}))},e}(),kd=function(e,t,s,i){e.container.elements.forEach((function(r){var n=Ah(r.flags,4),A=Ah(r.flags,2),o=new Dd(r,e);Ah(r.styles.display,2048)&&i.push(o);var a=Ah(r.flags,8)?[]:i;if(n||A){var l=n||r.styles.isPositioned()?s:t,c=new Sd(o);if(r.styles.isPositioned()||r.styles.opacity<1||r.styles.isTransformed()){var h=r.styles.zIndex.order;if(h<0){var u=0;l.negativeZIndex.some((function(e,t){return h>e.element.container.styles.zIndex.order?(u=t,!1):u>0})),l.negativeZIndex.splice(u,0,c)}else if(h>0){var d=0;l.positiveZIndex.some((function(e,t){return h>=e.element.container.styles.zIndex.order?(d=t+1,!1):d>0})),l.positiveZIndex.splice(d,0,c)}else l.zeroOrAutoZIndexOrTransformedOrOpacity.push(c)}else r.styles.isFloating()?l.nonPositionedFloats.push(c):l.nonPositionedInlineLevel.push(c);kd(o,c,n?c:s,a)}else r.styles.isInlineLevel()?t.inlineLevel.push(o):t.nonInlineLevel.push(o),kd(o,t,s,a);Ah(r.flags,8)&&Qd(r,a)}))},Qd=function(e,t){for(var s=e instanceof Au?e.start:1,i=e instanceof Au&&e.reversed,r=0;r<t.length;r++){var n=t[r];n.container instanceof nu&&"number"==typeof n.container.value&&0!==n.container.value&&(s=n.container.value),n.listValue=Ku(s,n.container.styles.listStyleType,!0),s+=i?-1:1}},Rd=function(e,t){switch(t){case 0:return Vd(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Vd(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Vd(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return Vd(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},Od=function(e,t){var s=[];return vd(e)?s.push(e.subdivide(.5,!1)):s.push(e),vd(t)?s.push(t.subdivide(.5,!0)):s.push(t),s},Vd=function(e,t,s,i){var r=[];return vd(e)?r.push(e.subdivide(.5,!1)):r.push(e),vd(s)?r.push(s.subdivide(.5,!0)):r.push(s),vd(i)?r.push(i.subdivide(.5,!0).reverse()):r.push(i),vd(t)?r.push(t.subdivide(.5,!1).reverse()):r.push(t),r},Ld=function(e){var t=e.bounds,s=e.styles;return t.add(s.borderLeftWidth,s.borderTopWidth,-(s.borderRightWidth+s.borderLeftWidth),-(s.borderTopWidth+s.borderBottomWidth))},Hd=function(e){var t=e.styles,s=e.bounds,i=ul(t.paddingLeft,s.width),r=ul(t.paddingRight,s.width),n=ul(t.paddingTop,s.width),A=ul(t.paddingBottom,s.width);return s.add(i+t.borderLeftWidth,n+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+i+r),-(t.borderTopWidth+t.borderBottomWidth+n+A))},Nd=function(e,t,s){var i=function(e,t){return 0===e?t.bounds:2===e?Hd(t):Ld(t)}(zd(e.styles.backgroundOrigin,t),e),r=function(e,t){return 0===e?t.bounds:2===e?Hd(t):Ld(t)}(zd(e.styles.backgroundClip,t),e),n=Wd(zd(e.styles.backgroundSize,t),s,i),A=n[0],o=n[1],a=hl(zd(e.styles.backgroundPosition,t),i.width-A,i.height-o);return[Xd(zd(e.styles.backgroundRepeat,t),a,n,i,r),Math.round(i.left+a[0]),Math.round(i.top+a[1]),A,o]},Gd=function(e){return $a(e)&&e.value===Ol.AUTO},jd=function(e){return"number"==typeof e},Wd=function(e,t,s){var i=t[0],r=t[1],n=t[2],A=e[0],o=e[1];if(!A)return[0,0];if(Al(A)&&o&&Al(o))return[ul(A,s.width),ul(o,s.height)];var a=jd(n);if($a(A)&&(A.value===Ol.CONTAIN||A.value===Ol.COVER))return jd(n)?s.width/s.height<n!=(A.value===Ol.COVER)?[s.width,s.width/n]:[s.height*n,s.height]:[s.width,s.height];var l=jd(i),c=jd(r),h=l||c;if(Gd(A)&&(!o||Gd(o)))return l&&c?[i,r]:a||h?h&&a?[l?i:r*n,c?r:i/n]:[l?i:s.width,c?r:s.height]:[s.width,s.height];if(a){var u=0,d=0;return Al(A)?u=ul(A,s.width):Al(o)&&(d=ul(o,s.height)),Gd(A)?u=d*n:o&&!Gd(o)||(d=u/n),[u,d]}var p=null,f=null;if(Al(A)?p=ul(A,s.width):o&&Al(o)&&(f=ul(o,s.height)),null===p||o&&!Gd(o)||(f=l&&c?p/i*r:s.height),null!==f&&Gd(A)&&(p=l&&c?f/r*i:s.width),null!==p&&null!==f)return[p,f];throw new Error("Unable to calculate background-size for element")},zd=function(e,t){var s=e[t];return void 0===s?e[0]:s},Xd=function(e,t,s,i,r){var n=t[0],A=t[1],o=s[0],a=s[1];switch(e){case 2:return[new Bd(Math.round(i.left),Math.round(i.top+A)),new Bd(Math.round(i.left+i.width),Math.round(i.top+A)),new Bd(Math.round(i.left+i.width),Math.round(a+i.top+A)),new Bd(Math.round(i.left),Math.round(a+i.top+A))];case 3:return[new Bd(Math.round(i.left+n),Math.round(i.top)),new Bd(Math.round(i.left+n+o),Math.round(i.top)),new Bd(Math.round(i.left+n+o),Math.round(i.height+i.top)),new Bd(Math.round(i.left+n),Math.round(i.height+i.top))];case 1:return[new Bd(Math.round(i.left+n),Math.round(i.top+A)),new Bd(Math.round(i.left+n+o),Math.round(i.top+A)),new Bd(Math.round(i.left+n+o),Math.round(i.top+A+a)),new Bd(Math.round(i.left+n),Math.round(i.top+A+a))];default:return[new Bd(Math.round(r.left),Math.round(r.top)),new Bd(Math.round(r.left+r.width),Math.round(r.top)),new Bd(Math.round(r.left+r.width),Math.round(r.height+r.top)),new Bd(Math.round(r.left),Math.round(r.height+r.top))]}},Kd=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var s=this._document.createElement("div"),i=this._document.createElement("img"),r=this._document.createElement("span"),n=this._document.body;s.style.visibility="hidden",s.style.fontFamily=e,s.style.fontSize=t,s.style.margin="0",s.style.padding="0",s.style.whiteSpace="nowrap",n.appendChild(s),i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",i.width=1,i.height=1,i.style.margin="0",i.style.padding="0",i.style.verticalAlign="baseline",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.appendChild(this._document.createTextNode("Hidden Text")),s.appendChild(r),s.appendChild(i);var A=i.offsetTop-r.offsetTop+2;s.removeChild(r),s.appendChild(this._document.createTextNode("Hidden Text")),s.style.lineHeight="normal",i.style.verticalAlign="super";var o=i.offsetTop-s.offsetTop+2;return n.removeChild(s),{baseline:A,middle:o}},e.prototype.getMetrics=function(e,t){var s=e+" "+t;return void 0===this._data[s]&&(this._data[s]=this.parseMetrics(e,t)),this._data[s]},e}(),Zd=function(e,t){this.context=e,this.options=t},Jd=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i._activeEffects=[],i.canvas=s.canvas?s.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),s.canvas||(i.canvas.width=Math.floor(s.width*s.scale),i.canvas.height=Math.floor(s.height*s.scale),i.canvas.style.width=s.width+"px",i.canvas.style.height=s.height+"px"),i.fontMetrics=new Kd(document),i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-s.x,-s.y),i.ctx.textBaseline="bottom",i._activeEffects=[],i.context.logger.debug("Canvas renderer initialized ("+s.width+"x"+s.height+") with scale "+s.scale),i}return uo(t,e),t.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach((function(e){return t.applyEffect(e)}))},t.prototype.applyEffect=function(e){this.ctx.save(),function(e){return 2===e.type}(e)&&(this.ctx.globalAlpha=e.opacity),function(e){return 0===e.type}(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Td(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},t.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},t.prototype.renderStack=function(e){return fo(this,void 0,void 0,(function(){return go(this,(function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.renderNode=function(e){return fo(this,void 0,void 0,(function(){return go(this,(function(t){switch(t.label){case 0:return Ah(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},t.prototype.renderTextWithLetterSpacing=function(e,t,s){var i=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+s):Kh(e.text).reduce((function(t,r){return i.ctx.fillText(r,t,e.bounds.top+s),t+i.ctx.measureText(r).width}),e.bounds.left)},t.prototype.createFontStyle=function(e){var t=e.fontVariant.filter((function(e){return"normal"===e||"small-caps"===e})).join(""),s=tp(e.fontFamily).join(", "),i=Ja(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,i,s].join(" "),s,i]},t.prototype.renderTextNode=function(e,t){return fo(this,void 0,void 0,(function(){var s,i,r,n,A,o,a,l,c=this;return go(this,(function(h){return s=this.createFontStyle(t),i=s[0],r=s[1],n=s[2],this.ctx.font=i,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",A=this.fontMetrics.getMetrics(r,n),o=A.baseline,a=A.middle,l=t.paintOrder,e.textBounds.forEach((function(e){l.forEach((function(s){switch(s){case 0:c.ctx.fillStyle=bl(t.color),c.renderTextWithLetterSpacing(e,t.letterSpacing,o);var i=t.textShadow;i.length&&e.text.trim().length&&(i.slice(0).reverse().forEach((function(s){c.ctx.shadowColor=bl(s.color),c.ctx.shadowOffsetX=s.offsetX.number*c.options.scale,c.ctx.shadowOffsetY=s.offsetY.number*c.options.scale,c.ctx.shadowBlur=s.blur.number,c.renderTextWithLetterSpacing(e,t.letterSpacing,o)})),c.ctx.shadowColor="",c.ctx.shadowOffsetX=0,c.ctx.shadowOffsetY=0,c.ctx.shadowBlur=0),t.textDecorationLine.length&&(c.ctx.fillStyle=bl(t.textDecorationColor||t.color),t.textDecorationLine.forEach((function(t){switch(t){case 1:c.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+o),e.bounds.width,1);break;case 2:c.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:c.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+a),e.bounds.width,1)}})));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(c.ctx.strokeStyle=bl(t.webkitTextStrokeColor),c.ctx.lineWidth=t.webkitTextStrokeWidth,c.ctx.lineJoin=window.chrome?"miter":"round",c.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+o)),c.ctx.strokeStyle="",c.ctx.lineWidth=0,c.ctx.lineJoin="miter"}}))})),[2]}))}))},t.prototype.renderReplacedElement=function(e,t,s){if(s&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var i=Hd(e),r=Fd(t);this.path(r),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(s,0,0,e.intrinsicWidth,e.intrinsicHeight,i.left,i.top,i.width,i.height),this.ctx.restore()}},t.prototype.renderNodeContent=function(e){return fo(this,void 0,void 0,(function(){var s,i,r,n,A,o,a,l,c,h,u,d,p,f,g,m,_,b;return go(this,(function(B){switch(B.label){case 0:this.applyEffects(e.getEffects(4)),s=e.container,i=e.curves,r=s.styles,n=0,A=s.textNodes,B.label=1;case 1:return n<A.length?(o=A[n],[4,this.renderTextNode(o,r)]):[3,4];case 2:B.sent(),B.label=3;case 3:return n++,[3,1];case 4:if(!(s instanceof su))return[3,8];B.label=5;case 5:return B.trys.push([5,7,,8]),[4,this.context.cache.match(s.src)];case 6:return g=B.sent(),this.renderReplacedElement(s,i,g),[3,8];case 7:return B.sent(),this.context.logger.error("Error loading image "+s.src),[3,8];case 8:if(s instanceof iu&&this.renderReplacedElement(s,i,s.canvas),!(s instanceof ru))return[3,12];B.label=9;case 9:return B.trys.push([9,11,,12]),[4,this.context.cache.match(s.svg)];case 10:return g=B.sent(),this.renderReplacedElement(s,i,g),[3,12];case 11:return B.sent(),this.context.logger.error("Error loading svg "+s.svg.substring(0,255)),[3,12];case 12:return s instanceof du&&s.tree?[4,new t(this.context,{scale:this.options.scale,backgroundColor:s.backgroundColor,x:0,y:0,width:s.width,height:s.height}).render(s.tree)]:[3,14];case 13:a=B.sent(),s.width&&s.height&&this.ctx.drawImage(a,0,0,s.width,s.height,s.bounds.left,s.bounds.top,s.bounds.width,s.bounds.height),B.label=14;case 14:if(s instanceof cu&&(l=Math.min(s.bounds.width,s.bounds.height),"checkbox"===s.type?s.checked&&(this.ctx.save(),this.path([new Bd(s.bounds.left+.39363*l,s.bounds.top+.79*l),new Bd(s.bounds.left+.16*l,s.bounds.top+.5549*l),new Bd(s.bounds.left+.27347*l,s.bounds.top+.44071*l),new Bd(s.bounds.left+.39694*l,s.bounds.top+.5649*l),new Bd(s.bounds.left+.72983*l,s.bounds.top+.23*l),new Bd(s.bounds.left+.84*l,s.bounds.top+.34085*l),new Bd(s.bounds.left+.39363*l,s.bounds.top+.79*l)]),this.ctx.fillStyle=bl(707406591),this.ctx.fill(),this.ctx.restore()):"radio"===s.type&&s.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(s.bounds.left+l/2,s.bounds.top+l/2,l/4,0,2*Math.PI,!0),this.ctx.fillStyle=bl(707406591),this.ctx.fill(),this.ctx.restore())),Yd(s)&&s.value.length){switch(c=this.createFontStyle(r),_=c[0],h=c[1],u=this.fontMetrics.getMetrics(_,h).baseline,this.ctx.font=_,this.ctx.fillStyle=bl(r.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=qd(s.styles.textAlign),b=Hd(s),d=0,s.styles.textAlign){case 1:d+=b.width/2;break;case 2:d+=b.width}p=b.add(d,0,0,-b.height/2+1),this.ctx.save(),this.path([new Bd(b.left,b.top),new Bd(b.left+b.width,b.top),new Bd(b.left+b.width,b.top+b.height),new Bd(b.left,b.top+b.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Wh(s.value,p),r.letterSpacing,u),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!Ah(s.styles.display,2048))return[3,20];if(null===s.styles.listStyleImage)return[3,19];if(0!==(f=s.styles.listStyleImage).type)return[3,18];g=void 0,m=f.url,B.label=15;case 15:return B.trys.push([15,17,,18]),[4,this.context.cache.match(m)];case 16:return g=B.sent(),this.ctx.drawImage(g,s.bounds.left-(g.width+10),s.bounds.top),[3,18];case 17:return B.sent(),this.context.logger.error("Error loading list-style-image "+m),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==s.styles.listStyleType&&(_=this.createFontStyle(r)[0],this.ctx.font=_,this.ctx.fillStyle=bl(r.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",b=new _o(s.bounds.left,s.bounds.top+ul(s.styles.paddingTop,s.bounds.width),s.bounds.width,vc(r.lineHeight,r.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Wh(e.listValue,b),r.letterSpacing,vc(r.lineHeight,r.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),B.label=20;case 20:return[2]}}))}))},t.prototype.renderStackContent=function(e){return fo(this,void 0,void 0,(function(){var t,s,i,r,n,A,o,a,l,c,h,u,d,p,f;return go(this,(function(g){switch(g.label){case 0:return Ah(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:g.sent(),t=0,s=e.negativeZIndex,g.label=2;case 2:return t<s.length?(f=s[t],[4,this.renderStack(f)]):[3,5];case 3:g.sent(),g.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:g.sent(),i=0,r=e.nonInlineLevel,g.label=7;case 7:return i<r.length?(f=r[i],[4,this.renderNode(f)]):[3,10];case 8:g.sent(),g.label=9;case 9:return i++,[3,7];case 10:n=0,A=e.nonPositionedFloats,g.label=11;case 11:return n<A.length?(f=A[n],[4,this.renderStack(f)]):[3,14];case 12:g.sent(),g.label=13;case 13:return n++,[3,11];case 14:o=0,a=e.nonPositionedInlineLevel,g.label=15;case 15:return o<a.length?(f=a[o],[4,this.renderStack(f)]):[3,18];case 16:g.sent(),g.label=17;case 17:return o++,[3,15];case 18:l=0,c=e.inlineLevel,g.label=19;case 19:return l<c.length?(f=c[l],[4,this.renderNode(f)]):[3,22];case 20:g.sent(),g.label=21;case 21:return l++,[3,19];case 22:h=0,u=e.zeroOrAutoZIndexOrTransformedOrOpacity,g.label=23;case 23:return h<u.length?(f=u[h],[4,this.renderStack(f)]):[3,26];case 24:g.sent(),g.label=25;case 25:return h++,[3,23];case 26:d=0,p=e.positiveZIndex,g.label=27;case 27:return d<p.length?(f=p[d],[4,this.renderStack(f)]):[3,30];case 28:g.sent(),g.label=29;case 29:return d++,[3,27];case 30:return[2]}}))}))},t.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},t.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},t.prototype.formatPath=function(e){var t=this;e.forEach((function(e,s){var i=vd(e)?e.start:e;0===s?t.ctx.moveTo(i.x,i.y):t.ctx.lineTo(i.x,i.y),vd(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)}))},t.prototype.renderRepeat=function(e,t,s,i){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(s,i),this.ctx.fill(),this.ctx.translate(-s,-i)},t.prototype.resizeImage=function(e,t,s){var i;if(e.width===t&&e.height===s)return e;var r=(null!==(i=this.canvas.ownerDocument)&&void 0!==i?i:document).createElement("canvas");return r.width=Math.max(1,t),r.height=Math.max(1,s),r.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,s),r},t.prototype.renderBackgroundImage=function(e){return fo(this,void 0,void 0,(function(){var t,s,i,r,n,A;return go(this,(function(o){switch(o.label){case 0:t=e.styles.backgroundImage.length-1,s=function(s){var r,n,A,o,a,l,c,h,u,d,p,f,g,m,_,b,B,y,w,v,C,M,E,F,x,U,I,T,P,S,D;return go(this,(function(k){switch(k.label){case 0:if(0!==s.type)return[3,5];r=void 0,n=s.url,k.label=1;case 1:return k.trys.push([1,3,,4]),[4,i.context.cache.match(n)];case 2:return r=k.sent(),[3,4];case 3:return k.sent(),i.context.logger.error("Error loading background-image "+n),[3,4];case 4:return r&&(A=Nd(e,t,[r.width,r.height,r.width/r.height]),b=A[0],M=A[1],E=A[2],w=A[3],v=A[4],m=i.ctx.createPattern(i.resizeImage(r,w,v),"repeat"),i.renderRepeat(b,m,M,E)),[3,6];case 5:1===s.type?(o=Nd(e,t,[null,null,null]),b=o[0],M=o[1],E=o[2],w=o[3],v=o[4],a=Pl(s.angle,w,v),l=a[0],c=a[1],h=a[2],u=a[3],d=a[4],(p=document.createElement("canvas")).width=w,p.height=v,f=p.getContext("2d"),g=f.createLinearGradient(c,u,h,d),Tl(s.stops,l).forEach((function(e){return g.addColorStop(e.stop,bl(e.color))})),f.fillStyle=g,f.fillRect(0,0,w,v),w>0&&v>0&&(m=i.ctx.createPattern(p,"repeat"),i.renderRepeat(b,m,M,E))):function(e){return 2===e.type}(s)&&(_=Nd(e,t,[null,null,null]),b=_[0],B=_[1],y=_[2],w=_[3],v=_[4],C=0===s.position.length?[ll]:s.position,M=ul(C[0],w),E=ul(C[C.length-1],v),F=function(e,t,s,i,r){var n=0,A=0;switch(e.size){case 0:0===e.shape?n=A=Math.min(Math.abs(t),Math.abs(t-i),Math.abs(s),Math.abs(s-r)):1===e.shape&&(n=Math.min(Math.abs(t),Math.abs(t-i)),A=Math.min(Math.abs(s),Math.abs(s-r)));break;case 2:if(0===e.shape)n=A=Math.min(Sl(t,s),Sl(t,s-r),Sl(t-i,s),Sl(t-i,s-r));else if(1===e.shape){var o=Math.min(Math.abs(s),Math.abs(s-r))/Math.min(Math.abs(t),Math.abs(t-i)),a=Dl(i,r,t,s,!0),l=a[0],c=a[1];A=o*(n=Sl(l-t,(c-s)/o))}break;case 1:0===e.shape?n=A=Math.max(Math.abs(t),Math.abs(t-i),Math.abs(s),Math.abs(s-r)):1===e.shape&&(n=Math.max(Math.abs(t),Math.abs(t-i)),A=Math.max(Math.abs(s),Math.abs(s-r)));break;case 3:if(0===e.shape)n=A=Math.max(Sl(t,s),Sl(t,s-r),Sl(t-i,s),Sl(t-i,s-r));else if(1===e.shape){o=Math.max(Math.abs(s),Math.abs(s-r))/Math.max(Math.abs(t),Math.abs(t-i));var h=Dl(i,r,t,s,!1);l=h[0],c=h[1],A=o*(n=Sl(l-t,(c-s)/o))}}return Array.isArray(e.size)&&(n=ul(e.size[0],i),A=2===e.size.length?ul(e.size[1],r):n),[n,A]}(s,M,E,w,v),x=F[0],U=F[1],x>0&&U>0&&(I=i.ctx.createRadialGradient(B+M,y+E,0,B+M,y+E,x),Tl(s.stops,2*x).forEach((function(e){return I.addColorStop(e.stop,bl(e.color))})),i.path(b),i.ctx.fillStyle=I,x!==U?(T=e.bounds.left+.5*e.bounds.width,P=e.bounds.top+.5*e.bounds.height,D=1/(S=U/x),i.ctx.save(),i.ctx.translate(T,P),i.ctx.transform(1,0,0,S,0,0),i.ctx.translate(-T,-P),i.ctx.fillRect(B,D*(y-P)+P,w,v*D),i.ctx.restore()):i.ctx.fill())),k.label=6;case 6:return t--,[2]}}))},i=this,r=0,n=e.styles.backgroundImage.slice(0).reverse(),o.label=1;case 1:return r<n.length?(A=n[r],[5,s(A)]):[3,4];case 2:o.sent(),o.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))},t.prototype.renderSolidBorder=function(e,t,s){return fo(this,void 0,void 0,(function(){return go(this,(function(i){return this.path(Rd(s,t)),this.ctx.fillStyle=bl(e),this.ctx.fill(),[2]}))}))},t.prototype.renderDoubleBorder=function(e,t,s,i){return fo(this,void 0,void 0,(function(){var r,n;return go(this,(function(A){switch(A.label){case 0:return t<3?[4,this.renderSolidBorder(e,s,i)]:[3,2];case 1:return A.sent(),[2];case 2:return r=function(e,t){switch(t){case 0:return Vd(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Vd(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Vd(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return Vd(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}}(i,s),this.path(r),this.ctx.fillStyle=bl(e),this.ctx.fill(),n=function(e,t){switch(t){case 0:return Vd(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Vd(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Vd(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return Vd(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}}(i,s),this.path(n),this.ctx.fill(),[2]}}))}))},t.prototype.renderNodeBackgroundAndBorders=function(e){return fo(this,void 0,void 0,(function(){var t,s,i,r,n,A,o,a,l=this;return go(this,(function(c){switch(c.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,s=!_l(t.backgroundColor)||t.backgroundImage.length,i=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],r=$d(zd(t.backgroundClip,0),e.curves),s||t.boxShadow.length?(this.ctx.save(),this.path(r),this.ctx.clip(),_l(t.backgroundColor)||(this.ctx.fillStyle=bl(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:c.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach((function(t){l.ctx.save();var s,i,r,n,A,o=Ed(e.curves),a=t.inset?0:1e4,c=(s=o,i=-a+(t.inset?1:-1)*t.spread.number,r=(t.inset?1:-1)*t.spread.number,n=t.spread.number*(t.inset?-2:2),A=t.spread.number*(t.inset?-2:2),s.map((function(e,t){switch(t){case 0:return e.add(i,r);case 1:return e.add(i+n,r);case 2:return e.add(i+n,r+A);case 3:return e.add(i,r+A)}return e})));t.inset?(l.path(o),l.ctx.clip(),l.mask(c)):(l.mask(o),l.ctx.clip(),l.path(c)),l.ctx.shadowOffsetX=t.offsetX.number+a,l.ctx.shadowOffsetY=t.offsetY.number,l.ctx.shadowColor=bl(t.color),l.ctx.shadowBlur=t.blur.number,l.ctx.fillStyle=t.inset?bl(t.color):"rgba(0,0,0,1)",l.ctx.fill(),l.ctx.restore()})),c.label=2;case 2:n=0,A=0,o=i,c.label=3;case 3:return A<o.length?0!==(a=o[A]).style&&!_l(a.color)&&a.width>0?2!==a.style?[3,5]:[4,this.renderDashedDottedBorder(a.color,a.width,n,e.curves,2)]:[3,11]:[3,13];case 4:return c.sent(),[3,11];case 5:return 3!==a.style?[3,7]:[4,this.renderDashedDottedBorder(a.color,a.width,n,e.curves,3)];case 6:return c.sent(),[3,11];case 7:return 4!==a.style?[3,9]:[4,this.renderDoubleBorder(a.color,a.width,n,e.curves)];case 8:return c.sent(),[3,11];case 9:return[4,this.renderSolidBorder(a.color,n,e.curves)];case 10:c.sent(),c.label=11;case 11:n++,c.label=12;case 12:return A++,[3,3];case 13:return[2]}}))}))},t.prototype.renderDashedDottedBorder=function(e,t,s,i,r){return fo(this,void 0,void 0,(function(){var n,A,o,a,l,c,h,u,d,p,f,g,m,_,b,B;return go(this,(function(y){return this.ctx.save(),n=function(e,t){switch(t){case 0:return Od(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return Od(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return Od(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return Od(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}}(i,s),A=Rd(i,s),2===r&&(this.path(A),this.ctx.clip()),vd(A[0])?(o=A[0].start.x,a=A[0].start.y):(o=A[0].x,a=A[0].y),vd(A[1])?(l=A[1].end.x,c=A[1].end.y):(l=A[1].x,c=A[1].y),h=0===s||2===s?Math.abs(o-l):Math.abs(a-c),this.ctx.beginPath(),3===r?this.formatPath(n):this.formatPath(A.slice(0,2)),u=t<3?3*t:2*t,d=t<3?2*t:t,3===r&&(u=t,d=t),p=!0,h<=2*u?p=!1:h<=2*u+d?(u*=f=h/(2*u+d),d*=f):(g=Math.floor((h+d)/(u+d)),m=(h-g*u)/(g-1),d=(_=(h-(g+1)*u)/g)<=0||Math.abs(d-m)<Math.abs(d-_)?m:_),p&&(3===r?this.ctx.setLineDash([0,u+d]):this.ctx.setLineDash([u,d])),3===r?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=bl(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===r&&(vd(A[0])&&(b=A[3],B=A[0],this.ctx.beginPath(),this.formatPath([new Bd(b.end.x,b.end.y),new Bd(B.start.x,B.start.y)]),this.ctx.stroke()),vd(A[1])&&(b=A[1],B=A[2],this.ctx.beginPath(),this.formatPath([new Bd(b.end.x,b.end.y),new Bd(B.start.x,B.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]}))}))},t.prototype.render=function(e){return fo(this,void 0,void 0,(function(){var t;return go(this,(function(s){switch(s.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=bl(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),i=new Dd(e,null),r=new Sd(i),kd(i,r,r,n=[]),Qd(i.container,n),t=r,[4,this.renderStack(t)];case 1:return s.sent(),this.applyEffects([]),[2,this.canvas]}var i,r,n}))}))},t}(Zd),Yd=function(e){return e instanceof uu||(e instanceof hu||e instanceof cu&&"radio"!==e.type&&"checkbox"!==e.type)},$d=function(e,t){switch(e){case 0:return Ed(t);case 2:return function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]}(t);default:return Fd(t)}},qd=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},ep=["-apple-system","system-ui"],tp=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter((function(e){return-1===ep.indexOf(e)})):e},sp=function(e){function t(t,s){var i=e.call(this,t,s)||this;return i.canvas=s.canvas?s.canvas:document.createElement("canvas"),i.ctx=i.canvas.getContext("2d"),i.options=s,i.canvas.width=Math.floor(s.width*s.scale),i.canvas.height=Math.floor(s.height*s.scale),i.canvas.style.width=s.width+"px",i.canvas.style.height=s.height+"px",i.ctx.scale(i.options.scale,i.options.scale),i.ctx.translate(-s.x,-s.y),i.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+s.width+"x"+s.height+" at "+s.x+","+s.y+") with scale "+s.scale),i}return uo(t,e),t.prototype.render=function(e){return fo(this,void 0,void 0,(function(){var t,s;return go(this,(function(i){switch(i.label){case 0:return t=Nh(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,ip(t)];case 1:return s=i.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=bl(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(s,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}}))}))},t}(Zd),ip=function(e){return new Promise((function(t,s){var i=new Image;i.onload=function(){t(i)},i.onerror=s,i.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))}))},rp=function(){function e(e){var t=e.id,s=e.enabled;this.id=t,this.enabled=s,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.debug?console.debug.apply(console,mo([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!=typeof window&&window.console&&"function"==typeof console.info&&console.info.apply(console,mo([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.warn?console.warn.apply(console,mo([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!=typeof window&&window.console&&"function"==typeof console.error?console.error.apply(console,mo([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),np=function(){function e(t,s){var i;this.windowBounds=s,this.instanceName="#"+e.instanceCount++,this.logger=new rp({id:this.instanceName,enabled:t.logging}),this.cache=null!==(i=t.cache)&&void 0!==i?i:new hd(this,t)}return e.instanceCount=1,e}();"undefined"!=typeof window&&cd.setContext(window);var Ap=function(e,t){return fo(void 0,void 0,void 0,(function(){var s,i,r,n,A,o,a,l,c,h,u,d,p,f,g,m,_,b,B,y,w,v,C,M,E,F,x,U,I,T,P,S,D,k,Q,R,O,V;return go(this,(function(L){switch(L.label){case 0:if(!e||"object"!=typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(s=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(i=s.defaultView))throw new Error("Document is not attached to a Window");return r={allowTaint:null!==(v=t.allowTaint)&&void 0!==v&&v,imageTimeout:null!==(C=t.imageTimeout)&&void 0!==C?C:15e3,proxy:t.proxy,useCORS:null!==(M=t.useCORS)&&void 0!==M&&M},n=po({logging:null===(E=t.logging)||void 0===E||E,cache:t.cache},r),A={windowWidth:null!==(F=t.windowWidth)&&void 0!==F?F:i.innerWidth,windowHeight:null!==(x=t.windowHeight)&&void 0!==x?x:i.innerHeight,scrollX:null!==(U=t.scrollX)&&void 0!==U?U:i.pageXOffset,scrollY:null!==(I=t.scrollY)&&void 0!==I?I:i.pageYOffset},o=new _o(A.scrollX,A.scrollY,A.windowWidth,A.windowHeight),a=new np(n,o),l=null!==(T=t.foreignObjectRendering)&&void 0!==T&&T,c={allowTaint:null!==(P=t.allowTaint)&&void 0!==P&&P,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:l,copyStyles:l},a.logger.debug("Starting document clone with size "+o.width+"x"+o.height+" scrolled to "+-o.left+","+-o.top),h=new Zu(a,e,c),(u=h.clonedReferenceElement)?[4,h.toIFrame(s,o)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return d=L.sent(),p=xu(u)||"HTML"===u.tagName?function(e){var t=e.body,s=e.documentElement;if(!t||!s)throw new Error("Unable to get document size");var i=Math.max(Math.max(t.scrollWidth,s.scrollWidth),Math.max(t.offsetWidth,s.offsetWidth),Math.max(t.clientWidth,s.clientWidth)),r=Math.max(Math.max(t.scrollHeight,s.scrollHeight),Math.max(t.offsetHeight,s.offsetHeight),Math.max(t.clientHeight,s.clientHeight));return new _o(0,0,i,r)}(u.ownerDocument):bo(a,u),f=p.width,g=p.height,m=p.left,_=p.top,b=op(a,u,t.backgroundColor),B={canvas:t.canvas,backgroundColor:b,scale:null!==(D=null!==(S=t.scale)&&void 0!==S?S:i.devicePixelRatio)&&void 0!==D?D:1,x:(null!==(k=t.x)&&void 0!==k?k:0)+m,y:(null!==(Q=t.y)&&void 0!==Q?Q:0)+_,width:null!==(R=t.width)&&void 0!==R?R:Math.ceil(f),height:null!==(O=t.height)&&void 0!==O?O:Math.ceil(g)},l?(a.logger.debug("Document cloned, using foreign object rendering"),[4,new sp(a,B).render(u)]):[3,3];case 2:return y=L.sent(),[3,5];case 3:return a.logger.debug("Document cloned, element located at "+m+","+_+" with size "+f+"x"+g+" using computed rendering"),a.logger.debug("Starting DOM parsing"),w=mu(a,u),b===w.styles.backgroundColor&&(w.styles.backgroundColor=Fl.TRANSPARENT),a.logger.debug("Starting renderer for element at "+B.x+","+B.y+" with size "+B.width+"x"+B.height),[4,new Jd(a,B).render(w)];case 4:y=L.sent(),L.label=5;case 5:return(null===(V=t.removeContainer)||void 0===V||V)&&(Zu.destroy(d)||a.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),a.logger.debug("Finished rendering"),[2,y]}}))}))},op=function(e,t,s){var i=t.ownerDocument,r=i.documentElement?El(e,getComputedStyle(i.documentElement).backgroundColor):Fl.TRANSPARENT,n=i.body?El(e,getComputedStyle(i.body).backgroundColor):Fl.TRANSPARENT,A="string"==typeof s?El(e,s):null===s?Fl.TRANSPARENT:4294967295;return t===i.documentElement?_l(r)?_l(n)?A:n:r:A};function ap(e,t,s=(()=>{})){if(!e||!t)return;let i=null;let r,n;const A=e=>{if(e.preventDefault(),i&&(clearTimeout(i),i=null),e.touches.length>1)return;const s=e.touches[0];r=s.clientX,n=s.clientY,i=setTimeout((()=>{e.clientX=s.clientX,e.clientY=s.clientY,t(e),clearTimeout(i),i=null}),500)},o=e=>{e.touches.length>1&&i&&(clearTimeout(i),i=null)},a=e=>{if(!i)return;const t=e.touches[0],s=Math.abs(t.clientX-r),A=Math.abs(t.clientY-n);(s>3||A>3)&&(clearTimeout(i),i=null)},l=e=>{e.preventDefault(),i&&(s(e),clearTimeout(i),i=null)},c=e=>{t(e),e.preventDefault(),e.stopPropagation()};return jr.isIphoneOrIpadSafari()?(e.addEventListener("touchstart",A),e.addEventListener("touchmove",a),e.addEventListener("touchend",l),window.addEventListener("touchstart",o)):e.addEventListener("contextmenu",c),function(){jr.isIphoneOrIpadSafari()?(e.removeEventListener("touchstart",A),e.removeEventListener("touchmove",a),e.removeEventListener("touchend",l),window.removeEventListener("touchstart",o)):e.removeEventListener("contextmenu",c)}}class lp{constructor(e,t={}){this._highlightClass="viewer-ruler-dot-highlighted",this._x=0,this._y=0,this._dot=document.createElement("div"),this._dot.className+=this._dot.className?" viewer-ruler-dot":"viewer-ruler-dot",this._dotClickable=document.createElement("div"),this._dotClickable.className+=this._dotClickable.className?" viewer-ruler-dot-clickable":"viewer-ruler-dot-clickable",this._visible=!1!==t.visible,this._culled=!1;var s=this._dot,i=s.style;i["border-radius"]="25px",i.border="solid 2px white",i.background="lightgreen",i.position="absolute",i["z-index"]=void 0===t.zIndex?"40000005":t.zIndex,i.width="8px",i.height="8px",i.visibility=this._visible?"visible":"hidden",i.top="0px",i.left="0px",i["box-shadow"]="0 2px 5px 0 #182A3D;",i.opacity=1,i["pointer-events"]="none",t.onContextMenu,e.appendChild(s);var r=this._dotClickable,n=r.style;if(n["border-radius"]="35px",n.border="solid 10px white",n.position="absolute",n["z-index"]=void 0===t.zIndex?"40000007":t.zIndex+1,n.width="8px",n.height="8px",n.visibility="visible",n.top="0px",n.left="0px",n.opacity=0,n["pointer-events"]="none",t.onContextMenu,e.appendChild(r),r.addEventListener("click",(t=>{e.dispatchEvent(new MouseEvent("mouseover",t))})),t.onMouseOver&&r.addEventListener("mouseover",(s=>{t.onMouseOver(s,this),e.dispatchEvent(new MouseEvent("mouseover",s))})),t.onMouseLeave&&r.addEventListener("mouseleave",(e=>{t.onMouseLeave(e,this)})),t.onMouseWheel&&r.addEventListener("wheel",(e=>{t.onMouseWheel(e,this)})),t.onMouseDown&&r.addEventListener("mousedown",(e=>{t.onMouseDown(e,this)})),t.onMouseUp&&r.addEventListener("mouseup",(e=>{t.onMouseUp(e,this)})),t.onMouseMove&&r.addEventListener("mousemove",(e=>{t.onMouseMove(e,this)})),t.onTouchstart&&r.addEventListener("touchstart",(e=>{t.onTouchstart(e,this)})),t.onTouchmove&&r.addEventListener("touchmove",(e=>{t.onTouchmove(e,this)})),t.onTouchend&&r.addEventListener("touchend",(e=>{t.onTouchend(e,this)})),t.onContextMenu){ap(r,(e=>{t.onContextMenu(e,this)}))}this.setPos(t.x||0,t.y||0),this.setFillColor(t.fillColor),this.setBorderColor(t.borderColor)}setPos(e,t){this._x=e,this._y=t;var s=this._dot.style;s.left=Math.round(e)-6+"px",s.top=Math.round(t)-6+"px";var i=this._dotClickable.style;i.left=Math.round(e)-14+"px",i.top=Math.round(t)-14+"px"}setFillColor(e){this._dot.style.background=e||"lightgreen"}setBorderColor(e){this._dot.style.border="solid 2px"+(e||"black")}setOpacity(e){this._dot.style.opacity=e}_updateVisibility(){this._dot.style.visibility=this._dotClickable.style.visibility=this._visible&&!this._culled?"visible":"hidden"}setVisible(e){this._visible!==e&&(this._visible=!!e,this._updateVisibility())}setCulled(e){this._culled!==e&&(this._culled=!!e,this._updateVisibility())}setClickable(e){this._dotClickable.style["pointer-events"]=e?"all":"none"}setHighlighted(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._dot.classList.add(this._highlightClass):this._dot.classList.remove(this._highlightClass))}destroy(){this.setVisible(!1),this._dot.parentElement&&this._dot.parentElement.removeChild(this._dot),this._dotClickable.parentElement&&this._dotClickable.parentElement.removeChild(this._dotClickable)}}class cp{constructor(e,t={}){this._highlightClass="viewer-ruler-label-highlighted",this._prefix=t.prefix||"",this._x=0,this._y=0,this._visible=!0,this._culled=!1,this._label=document.createElement("div"),this._label.className+=this._label.className?" viewer-ruler-label":"viewer-ruler-label",this._timeout=null;var s=this._label,i=s.style;if(i["border-radius"]="5px",i.color="white",i.padding="4px",i.border="solid 1px",i.background="lightgreen",i.position="absolute",i["z-index"]=void 0===t.zIndex?"5000005":t.zIndex,i.width="auto",i.height="auto",i.visibility="visible",i.top="0px",i.left="0px",i["pointer-events"]="all",i.opacity=1,t.onContextMenu,s.innerText="",e.appendChild(s),this.setPos(t.x||0,t.y||0),this.setFillColor(t.fillColor),this.setBorderColor(t.fillColor),this.setText(t.text),t.onMouseOver&&s.addEventListener("mouseover",(e=>{t.onMouseOver(e,this),e.preventDefault()})),t.onMouseLeave&&s.addEventListener("mouseleave",(e=>{t.onMouseLeave(e,this),e.preventDefault()})),t.onMouseWheel&&s.addEventListener("wheel",(e=>{t.onMouseWheel(e,this)})),t.onMouseDown&&s.addEventListener("mousedown",(e=>{t.onMouseDown(e,this),e.stopPropagation()})),t.onMouseUp&&s.addEventListener("mouseup",(e=>{t.onMouseUp(e,this),e.stopPropagation()})),t.onMouseMove&&s.addEventListener("mousemove",(e=>{t.onMouseMove(e,this)})),t.onContextMenu){ap(s,(e=>{t.onContextMenu(e,this)}))}}setPos(e,t){this._x=e,this._y=t;var s=this._label.style;s.left=Math.round(e)-20+"px",s.top=Math.round(t)-12+"px"}setPosOnWire(e,t,s,i){var r=e+.5*(s-e),n=t+.5*(i-t),A=this._label.style;A.left=Math.round(r)-20+"px",A.top=Math.round(n)-12+"px"}setPosBetweenWires(e,t,s,i,r,n){var A=(e+s+r)/3,o=(t+i+n)/3,a=this._label.style;a.left=Math.round(A)-20+"px",a.top=Math.round(o)-12+"px"}setText(e){this._label.innerHTML=this._prefix+(e||"")}setFillColor(e){this._fillColor=e||"lightgreen",this._label.style.background=this._fillColor}setBorderColor(e){this._borderColor=e||"black",this._label.style.border="solid 1px "+this._borderColor}setOpacity(e){this._label.style.opacity=e}_updateVisibility(){this._label.style.visibility=this._visible&&!this._culled?"visible":"hidden"}setVisible(e){this._visible!==e&&(this._visible=!!e,this._updateVisibility())}setCulled(e){this._culled!==e&&(this._culled=!!e,this._updateVisibility())}setHighlighted(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._label.classList.add(this._highlightClass):this._label.classList.remove(this._highlightClass))}setClickable(e){this._label.style["pointer-events"]=e?"all":"none"}setPrefix(e){this._prefix!==e&&(this._prefix=e)}destroy(){this._label.parentElement&&this._label.parentElement.removeChild(this._label)}}class hp{constructor(e,t={}){this._color=t.color||"black",this._highlightClass="viewer-ruler-wire-highlighted",this._wire=document.createElement("div"),this._wire.className+=this._wire.className?" viewer-ruler-wire":"viewer-ruler-wire",this._wireClickable=document.createElement("div"),this._wireClickable.className+=this._wireClickable.className?" viewer-ruler-wire-clickable":"viewer-ruler-wire-clickable",this._thickness=t.thickness||1,this._thicknessClickable=t.thicknessClickable||6,this._visible=!0,this._culled=!1;var s=this._wire,i=s.style;i.border="solid "+this._thickness+"px "+this._color,i.position="absolute",i["z-index"]=void 0===t.zIndex?"2000001":t.zIndex,i.width="0px",i.height="0px",i.visibility="visible",i.top="0px",i.left="0px",i["-webkit-transform-origin"]="0 0",i["-moz-transform-origin"]="0 0",i["-ms-transform-origin"]="0 0",i["-o-transform-origin"]="0 0",i["transform-origin"]="0 0",i["-webkit-transform"]="rotate(0deg)",i["-moz-transform"]="rotate(0deg)",i["-ms-transform"]="rotate(0deg)",i["-o-transform"]="rotate(0deg)",i.transform="rotate(0deg)",i.opacity=1,i["pointer-events"]="none",t.onContextMenu,e.appendChild(s);var r=this._wireClickable,n=r.style;if(n.border="solid "+this._thicknessClickable+"px "+this._color,n.position="absolute",n["z-index"]=void 0===t.zIndex?"2000002":t.zIndex+1,n.width="0px",n.height="0px",n.visibility="visible",n.top="0px",n.left="0px",n["-webkit-transform-origin"]="0 0",n["-moz-transform-origin"]="0 0",n["-ms-transform-origin"]="0 0",n["-o-transform-origin"]="0 0",n["transform-origin"]="0 0",n["-webkit-transform"]="rotate(0deg)",n["-moz-transform"]="rotate(0deg)",n["-ms-transform"]="rotate(0deg)",n["-o-transform"]="rotate(0deg)",n.transform="rotate(0deg)",n.opacity=0,n["pointer-events"]="none",t.onContextMenu,e.appendChild(r),t.onMouseOver&&r.addEventListener("mouseover",(e=>{t.onMouseOver(e,this)})),t.onMouseLeave&&r.addEventListener("mouseleave",(e=>{t.onMouseLeave(e,this)})),t.onMouseWheel&&r.addEventListener("wheel",(e=>{t.onMouseWheel(e,this)})),t.onMouseDown&&r.addEventListener("mousedown",(e=>{t.onMouseDown(e,this)})),t.onMouseUp&&r.addEventListener("mouseup",(e=>{t.onMouseUp(e,this)})),t.onMouseMove&&r.addEventListener("mousemove",(e=>{t.onMouseMove(e,this)})),t.onContextMenu){ap(r,(e=>{t.onContextMenu(e,this)}))}this._x1=0,this._y1=0,this._x2=0,this._y2=0,this._update()}get visible(){return"visible"===this._wire.style.visibility}_update(){var e=Math.abs(Math.sqrt((this._x1-this._x2)*(this._x1-this._x2)+(this._y1-this._y2)*(this._y1-this._y2))),t=180*Math.atan2(this._y2-this._y1,this._x2-this._x1)/Math.PI,s=this._wire.style;s.width=Math.round(e)+"px",s.left=Math.round(this._x1)+"px",s.top=Math.round(this._y1)+"px",s["-webkit-transform"]=s["-moz-transform"]=s["-ms-transform"]=s["-o-transform"]=s.transform="rotate("+t+"deg) translate(-"+this._thickness+"px, -"+this._thickness+"px)";var i=this._wireClickable.style;i.width=Math.round(e)+"px",i.left=Math.round(this._x1)+"px",i.top=Math.round(this._y1)+"px",i["-webkit-transform"]=i["-moz-transform"]=i["-ms-transform"]=i["-o-transform"]=i.transform="rotate("+t+"deg) translate(-"+this._thicknessClickable+"px, -"+this._thicknessClickable+"px)"}setStartAndEnd(e,t,s,i){this._x1=e,this._y1=t,this._x2=s,this._y2=i,this._update()}setColor(e){this._color=e||"black",this._wire.style.border="solid "+this._thickness+"px "+this._color}setOpacity(e){this._wire.style.opacity=e}_updateVisibility(){this._wire.style.visibility=this._wireClickable.style.visibility=this._visible&&!this._culled?"visible":"hidden"}setVisible(e){this._visible!==e&&(this._visible=!!e,this._updateVisibility())}setCulled(e){this._culled!==e&&(this._culled=!!e,this._updateVisibility())}setClickable(e){this._wireClickable.style["pointer-events"]=e?"all":"none"}setHighlighted(e){this._highlighted!==e&&(this._highlighted=!!e,this._highlighted?this._wire.classList.add(this._highlightClass):this._wire.classList.remove(this._highlightClass))}destroy(e){this._wire.parentElement&&this._wire.parentElement.removeChild(this._wire),this._wireClickable.parentElement&&this._wireClickable.parentElement.removeChild(this._wireClickable)}}const up=h.vec2(),dp=h.vec2(),pp=h.vec2(),fp=h.vec2(),gp=h.vec3(),mp=h.vec3(),_p=h.vec4(),bp=h.vec4(),Bp=h.vec4(),yp=h.vec4(),wp=h.mat4(),vp={origin:h.vec3(),direction:h.vec3()},Cp=()=>{},Mp=function(e,t,s,i){const r=(e-h.dotVec3(s,t))/h.dotVec3(i,t);if(r<0)return null;{const e=h.vec3();return h.mulVec3Scalar(i,r,e),h.addVec3(s,e,e),e}};function Ep(e,t,s){const i=e.getBoundingClientRect(),r=t.getBoundingClientRect();s[0]+=i.left-r.left,s[1]+=i.top-r.top}const Fp=(e,t,s)=>{wp.set(e.viewMatrix),wp.set(e.projMatrix),s.set(t),s[3]=1,h.mulMat4v4(e.viewMatrix,s,s),h.mulMat4v4(e.projMatrix,s,s)},xp=(e,t,s,i)=>{i[0]=.5*(1+s[0])*e.offsetWidth,i[1]=.5*(1-s[1])*e.offsetHeight,Ep(e,t,i)},Up=(e,t,s,i,r,n)=>{const A=e.camera,o=e.canvas.canvas;if(h.distVec3(s,i)<.001)return!1;const a=h.subVec3(i,s,gp);let l=0,c=1;for(let t of e._sectionPlanesState.sectionPlanes){const e=h.dotVec3(t.dir,h.subVec3(t.pos,i,mp)),r=h.dotVec3(t.dir,h.subVec3(t.pos,s,mp));if(r>0&&e>0)return!1;if(r>0||e>0){const e=h.dotVec3(t.dir,a);if(Math.abs(e)>=1e-6){const s=h.dotVec3(t.dir,mp)/e;r>0?l=Math.max(l,s):c=Math.min(c,s)}}}const u=_p,d=bp;Fp(A,l>0?h.addVec3(s,h.mulVec3Scalar(a,l,mp),mp):s,u),Fp(A,c<1?h.addVec3(s,h.mulVec3Scalar(a,c,mp),mp):i,d);const p=u[2]/u[3]<-1||u[3]<0,f=d[2]/d[3]<-1||d[3]<0;if(p&&f)return!1;const g=(u[3]+u[2])/(u[3]+u[2]-(d[3]+d[2]));if(g>0&&g<1){const e=h.subVec4(d,u,Bp);h.mulVec4Scalar(e,g,e),h.addVec4(u,e,p?u:d)}h.mulVec4Scalar(u,1/u[3]),h.mulVec4Scalar(d,1/d[3]);let m=0,_=1;for(let e=0;e<2;++e){const t=d[e]-u[e],s=(-1-u[e])/t,i=(1-u[e])/t;t>0?(m=Math.max(m,s),_=Math.min(_,i)):t<0?(m=Math.max(m,i),_=Math.min(_,s)):u[0]<-1?m=-window.Infinity:u[0]>1&&(_=window.Infinity)}if(m>=_)return!1;const b=h.subVec4(d,u,Bp);return h.addVec4(u,h.mulVec4Scalar(b,_,yp),d),h.addVec4(u,h.mulVec4Scalar(b,m,yp),u),h.mulVec4Scalar(u,1/u[3]),h.mulVec4Scalar(d,1/d[3]),xp(o,t,u,r),xp(o,t,d,n),!0};class Ip extends Tr{constructor(e,t,s,i={}){const r=e.camera;super(e,t),this.__visible=!0;const n=(e,t)=>s=>{e&&e(s),this.fire(t,s,!0)};this._dot=new lp(s,{borderColor:i.borderColor,fillColor:i.fillColor,zIndex:i.zIndex,onMouseOver:n(i.onMouseOver,"mouseover"),onMouseLeave:n(i.onMouseLeave,"mouseleave"),onMouseWheel:n(i.onMouseWheel,"wheel"),onMouseDown:n(i.onMouseDown,"mousedown"),onMouseUp:n(i.onMouseUp,"mouseup"),onMouseMove:n(i.onMouseMove,"mousemove"),onTouchstart:n(i.onTouchstart,"touchstart"),onTouchmove:n(i.onTouchmove,"touchmove"),onTouchend:n(i.onTouchend,"touchend"),onContextMenu:n(i.onContextMenu,"contextmenu")});const A=()=>{if(!this.__visible)return;const t=Bp;((e,t)=>{t.set(e),t[3]=1,h.mulMat4v4(r.viewMatrix,t,t),h.mulMat4v4(r.projMatrix,t,t)})(this.worldPos,t),h.mulVec3Scalar(t,1/t[3]);const i=t[3]<0||t[0]<-1||t[0]>1||t[1]<-1||t[1]>1||t[2]<-1||t[2]>1||e._sectionPlanesState.sectionPlanes.some((e=>h.dotVec3(e.dir,h.subVec3(e.pos,this.worldPos,gp))>0));this._dot.setCulled(i),i||((t=>{const i=e.canvas.canvas;t[0]=.5*(1+t[0])*i.offsetWidth,t[1]=.5*(1-t[1])*i.offsetHeight,Ep(i,s,t)})(t),this._dot.setPos(t[0],t[1]))};this.on("worldPos",A);const o=r.on("viewMatrix",A),a=r.on("projMatrix",A),l=e.canvas.on("boundary",A),c=e.on("sectionPlaneUpdated",A),u=e.on("sectionPlaneCreated",A),d=e.on("sectionPlaneDestroyed",A);this._updatePosition=A,this._cleanup=()=>{r.off(o),r.off(a),e.canvas.off(l),e.off(c),e.off(u),e.off(d),this._dot.destroy()}}setClickable(e){this._dot.setClickable(e)}setFillColor(e){this._dot.setFillColor(e)}setBorderColor(e){this._dot.setBorderColor(e)}setHighlighted(e){this._dot.setHighlighted(e)}setOpacity(e){this._dot.setOpacity(e)}setVisible(e){this.__visible!=e&&(this.__visible=e,this._updatePosition(),this._dot.setVisible(e))}destroy(){this._cleanup(),super.destroy()}}class Tp{constructor(e,t,s){const i=e.camera;this._label=new cp(t,s),this._start=h.vec3(),this._mid=h.vec3(),this._end=h.vec3(),this._yOff=0,this.__visible=!0,this._updatePos=()=>{Fp(i,this._start,_p),h.mulVec4Scalar(_p,1/_p[3]),xp(e.canvas.canvas,t,_p,up),this._label.setPos(up[0],up[1])};const r=(e,t,s)=>{e[0]+=t[0],e[1]+=t[1],h.mulVec2Scalar(e,.5),this._label.setPos(e[0],e[1]+s)};this._updatePosBetween=()=>{const s=Up(e,t,this._start,this._mid,up,dp),i=Up(e,t,this._end,this._mid,pp,fp);this._label.setCulled(!(s||i)),s&&i?(dp[0]+=fp[0],dp[1]+=fp[1],h.mulVec2Scalar(dp,.5),dp[0]+=up[0]+pp[0],dp[1]+=up[1]+pp[1],h.mulVec2Scalar(dp,1/3),this._label.setPos(dp[0],dp[1])):s?r(up,dp,0):i&&r(pp,fp,0)},this._updatePosOnWire=()=>{const s=Up(e,t,this._start,this._end,up,dp)&&h.distVec2(up,dp)>=this._labelMinAxisLength;this._label.setCulled(!s),s&&r(up,dp,this._yOff)};let n=()=>{};this._setUpdatePositions=e=>{n=e,this._updatePositions()},this._updatePositions=()=>{this.__visible&&n()};const A=i.on("viewMatrix",this._updatePositions),o=i.on("projMatrix",this._updatePositions),a=e.canvas.on("boundary",this._updatePositions),l=e.on("sectionPlaneUpdated",this._updatePositions),c=e.on("sectionPlaneCreated",this._updatePositions),u=e.on("sectionPlaneDestroyed",this._updatePositions);this._cleanup=()=>{i.off(A),i.off(o),e.canvas.off(a),e.off(l),e.off(c),e.off(u),this._label.destroy()}}setPos(e){this._start.set(e),this._setUpdatePositions(this._updatePos)}setPosOnWire(e,t,s,i){this._start.set(e),this._end.set(t),this._yOff=s,this._labelMinAxisLength=i,this._setUpdatePositions(this._updatePosOnWire)}setPosBetween(e,t,s){this._start.set(e),this._mid.set(t),this._end.set(s),this._setUpdatePositions(this._updatePosBetween)}setFillColor(e){this._label.setFillColor(e)}setHighlighted(e){this._label.setHighlighted(e)}setText(e){this._label.setText(e)}setClickable(e){this._label.setClickable(e)}setVisible(e){this.__visible!=e&&(this.__visible=e,this._updatePositions(),this._label.setVisible(e))}destroy(){this._cleanup()}}class Pp{constructor(e,t,s){const i=e.camera;this._wire=new hp(t,s),this._start=h.vec3(),this._end=h.vec3(),this.__visible=!0,this._updatePositions=()=>{if(!this.__visible)return;const s=Up(e,t,this._start,this._end,up,dp);this._wire.setCulled(!s),s&&this._wire.setStartAndEnd(up[0],up[1],dp[0],dp[1])};const r=i.on("viewMatrix",this._updatePositions),n=i.on("projMatrix",this._updatePositions),A=e.canvas.on("boundary",this._updatePositions),o=e.on("sectionPlaneUpdated",this._updatePositions),a=e.on("sectionPlaneCreated",this._updatePositions),l=e.on("sectionPlaneDestroyed",this._updatePositions);this._cleanup=()=>{i.off(r),i.off(n),e.canvas.off(A),e.off(o),e.off(a),e.off(l),this._wire.destroy()}}setEnds(e,t){this._start.set(e),this._end.set(t),this._updatePositions()}setClickable(e){this._wire.setClickable(e)}setColor(e){this._wire.setColor(e)}setHighlighted(e){this._wire.setHighlighted(e)}setOpacity(e){this._wire.setOpacity(e)}setVisible(e){this.__visible!=e&&(this.__visible=e,this._updatePositions(),this._wire.setVisible(e))}destroy(){this._cleanup()}}const Sp=function(e,t){const s=new Ip(e,{},e.canvas.canvas.parentNode,{borderColor:"white",fillColor:t,zIndex:100});return{update:function(e){e&&(s.worldPos=e),s.setVisible(!!e)},setFillColor:e=>s.setFillColor(e),setHighlighted:e=>s.setHighlighted(e),getCanvasPos:()=>s.canvasPos,getWorldPos:()=>s.worldPos,destroy:()=>s.destroy()}},Dp=function(e,t){const s=new Pp(e,e.canvas.canvas.ownerDocument.body,{color:t,thickness:1,thicknessClickable:6});return s.setVisible(!1),{update:(e,t)=>{t&&s.setEnds(e,t),s.setVisible(!!t)},setColor:e=>s.setColor(e),destroy:()=>s.destroy()}};function kp(e,t){const s=function(e,s){if(e in t)return t[e];if(void 0!==s)return s;throw"config missing: "+e},i=s("viewer"),r=s("ray2WorldPos"),n=s("handleMouseEvents",!1),A=s("handleTouchEvents",!1),o=s("onStart",Cp),a=s("onMove",Cp),l=s("onEnd",Cp),c=i.scene,u=c.canvas.canvas,d=e=>{const t=h.vec2([e.clientX,e.clientY]);Ep(u.ownerDocument.documentElement,u,t),a(t,(e=>{const t=h.vec3(),s=h.vec3();return h.canvasPosToWorldRay(u,c.camera.viewMatrix,c.camera.projMatrix,c.camera.projection,e,t,s),r(t,s,e)})(t))};let p=null;const f=function(e){const t=p.matchesEvent(e);t&&d(t)},g=function(t){const s=p.matchesEvent(t);s&&(e.setOpacity(B),p.cleanup(),d(s),l())},m=function(t,s){p&&p.cleanup(),e.setOpacity(1),e.setClickable(!1),i.cameraControl.active=!1,p={matchesEvent:t,cleanup:function(){p=null,e.setClickable(!0),i.cameraControl.active=!0,s()}},o()},_=[],b=function(t,s){const i=e.on(t,s);_.push((()=>e.off(i)))};if(n&&(b("mouseover",(()=>!p&&e.setOpacity(1))),b("mouseleave",(()=>!p&&e.setOpacity(B))),b("mousedown",(e=>{1===e.which&&(u.addEventListener("mousemove",f),u.addEventListener("mouseup",g),m((e=>1===e.which&&e),(()=>{u.removeEventListener("mousemove",f),u.removeEventListener("mouseup",g)})))}))),A){let e;b("touchstart",(t=>{t.preventDefault(),1===t.touches.length&&(e=t.touches[0].identifier,m((t=>[...t.changedTouches].find((t=>t.identifier===e))),(()=>{e=null})))})),b("touchmove",(e=>{e.preventDefault(),f(e)})),b("touchend",(e=>{e.preventDefault(),g(e)}))}const B=.8;return e.setOpacity(B),function(){p&&p.cleanup(),_.forEach((e=>e())),e.setOpacity(1)}}function Qp(e){const t=function(t,s){if(t in e)return e[t];if(void 0!==s)return s;throw"config missing: "+t},s=t("viewer"),i=t("handleMouseEvents",!1),r=t("handleTouchEvents",!1),n=t("pointerLens",null),A=t("dots"),o=t("ray2WorldPos"),a=t("onEnd",Cp),l=n?function(e){n.visible=!!e,e&&(n.canvasPos=e)}:()=>{},c=A.map((e=>{let t;return kp(e,{handleMouseEvents:i,handleTouchEvents:r,viewer:s,ray2WorldPos:(e,s,i)=>o(e,s,i)||t,onStart:()=>{t=e.worldPos.slice(),h(!1,e)},onMove:(t,s)=>{l(t),e.worldPos=s},onEnd:()=>{a(t,e)||(e.worldPos=t),l(null),h(!0,e)}})})),h=(e,t)=>A.forEach((s=>s!==t&&s.setClickable(e)));return h(!0),function(){c.forEach((e=>e())),l(null)}}const Rp=function(e,t,s){return function(i,r,n){const A=e.scene,o=A.canvas.canvas,a=(e,t)=>(t[0]=e.clientX,t[1]=e.clientY,Ep(o.ownerDocument.documentElement,o,t),t),l=e=>{const t=h.vec3(),i=h.vec3();return h.canvasPosToWorldRay(o,A.camera.viewMatrix,A.camera.projMatrix,A.camera.projection,e,t,i),s(t,i)};let c=null;const u=()=>{};let d,p=u;const f=function(){t.stop(),clearTimeout(c),e.cameraControl.active=!0,p=u,d=null},g=function(){f(),o.removeEventListener("touchstart",m),o.removeEventListener("touchmove",_),o.removeEventListener("touchend",b)},m=function(s){const n=s.touches;if(1!==n.length)f(),i();else{const s=n[0],i=a(s,h.vec2());l(i)&&(d=s.identifier,p=e=>{h.distVec2(i,e)>20&&f()},c=setTimeout((function(){t.start(i),c=setTimeout((function(){t.stop(),e.cameraControl.active=!1,p=e=>{r(e,l(e))},p(i)}),300)}),250))}};o.addEventListener("touchstart",m,{passive:!0});const _=function(e){const t=[...e.changedTouches].find((e=>e.identifier===d));t&&p(a(t,h.vec2()))};o.addEventListener("touchmove",_,{passive:!0});const b=function(e){const t=[...e.changedTouches].find((e=>e.identifier===d));if(t){g();const e=a(t,h.vec2());n(e,l(e))}};return o.addEventListener("touchend",b,{passive:!0}),g}},Op=function(e){const t=[];for(let s=0;s<e.length;++s)t.push(s);const s=function(){const s=h.vec2(),i=h.vec2();let r=0;for(let n=0;n<t.length;++n){const A=e[t[n]],o=e[t[(n+1)%t.length]],a=e[t[(n+2)%t.length]];h.subVec2(A,o,s),h.subVec2(a,o,i);const l=h.dotVec2(s,i)/Math.sqrt(h.sqLenVec2(s)*h.sqLenVec2(i)),c=Math.acos(Math.max(-1,Math.min(l,1)));r+=s[0]*i[1]-s[1]*i[0]>=0?c:2*Math.PI-c}return r<t.length*Math.PI}(),i=function(){const e=(e,t,s)=>(e[0]-s[0])*(t[1]-s[1])-(t[0]-s[0])*(e[1]-s[1]);return(t,s,i,r)=>{const n=e(t,s,i),A=e(t,i,r),o=e(t,r,s);return!((n<0||A<0||o<0)&&(n>0||A>0||o>0))}}(),r=[],n=(s?t:t.slice(0).reverse()).map((e=>({idx:e})));n.forEach(((e,t)=>{e.prev=n[(t-1+n.length)%n.length],e.next=n[(t+1)%n.length]}));const A=h.vec2(),o=h.vec2();for(;n.length>2;){let t=0;for(;;){if(t>=n.length)throw`isCCW = ${s}; earIdx = ${t}; len = ${n.length}`;const r=n[t],a=e[r.prev.idx],l=e[r.idx],c=e[r.next.idx];if(h.subVec2(a,l,A),h.subVec2(c,l,o),A[0]*o[1]-A[1]*o[0]>=0&&n.every((t=>t===r||t===r.prev||t===r.next||!i(e[t.idx],a,l,c))))break;++t}const a=n[t];n.splice(t,1),r.push([a.idx,a.next.idx,a.prev.idx]);a.prev.next=a.next;a.next.prev=a.prev}return[e,r,s]};const Vp=h.vec3(),Lp=h.vec3();class Hp extends T{constructor(e,t={}){const s=e.viewer.scene;super(s,t),this.plugin=e;const i=t.container;if(!i)throw"config missing: container";this._color=t.color||e.defaultColor;const r=function(e){const t=[];let s=!1!==e;return{reg:e=>t.push(e),get:()=>s,set:e=>{s=!1!==e,t.forEach((e=>e(s)))}}};this._visible=r(t.visible),this._originVisible=r(t.originVisible),this._cornerVisible=r(t.cornerVisible),this._targetVisible=r(t.targetVisible),this._originWireVisible=r(t.originWireVisible),this._targetWireVisible=r(t.targetWireVisible),this._angleVisible=r(t.angleVisible),this._labelsVisible=r(),this.labelsVisible=t.labelsVisible,this._clickable=r(!1),this.approximate=t.approximate;const n=s.canvas.canvas,A=t.onMouseOver?e=>{t.onMouseOver(e,this),n.dispatchEvent(new MouseEvent("mouseover",e))}:null,o=t.onMouseLeave?e=>{t.onMouseLeave(e,this),n.dispatchEvent(new MouseEvent("mouseleave",e))}:null,a=t.onContextMenu?e=>{t.onContextMenu(e,this)}:null,l=e=>n.dispatchEvent(new MouseEvent("mousedown",e)),c=e=>n.dispatchEvent(new MouseEvent("mouseup",e)),h=e=>n.dispatchEvent(new MouseEvent("mousemove",e)),u=e=>n.dispatchEvent(new WheelEvent("wheel",e));this._cleanups=[],this._drawables=[];const d=(e,t)=>{const s=()=>e.setVisible(t.every((e=>e.get())));t.forEach((e=>e.reg(s))),this._drawables.push(e),this._cleanups.push((()=>e.destroy()))},p=(t,r,n)=>{const p=new Pp(s,i,{color:t,thickness:r,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:A,onMouseLeave:o,onMouseWheel:u,onMouseDown:l,onMouseUp:c,onMouseMove:h,onContextMenu:a});return d(p,n),{setEnds:(e,t)=>p.setEnds(e,t),setColor:e=>p.setColor(e)}};this._originWire=p(this._color||"blue",1,[this._visible,this._originWireVisible]),this._targetWire=p(this._color||"red",1,[this._visible,this._targetWireVisible]);this._angleLabel=((t,r,n)=>{const p=new Tp(s,i,{fillColor:t,zIndex:e.zIndex+r,onMouseOver:A,onMouseLeave:o,onMouseWheel:u,onMouseDown:l,onMouseUp:c,onMouseMove:h,onContextMenu:a});return d(p,n),{setFillColor:e=>p.setFillColor(e),setPosOnWire:(e,t,s)=>p.setPosOnWire(e,t,s),setPosBetween:(e,t,s)=>p.setPosBetween(e,t,s),setText:e=>p.setText(e)}})(this._color||"#00BBFF",2,[this._visible,this._angleVisible,this._labelsVisible]);const f=(t,r)=>{const n=new Ip(s,t,i,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:A,onMouseLeave:o,onMouseWheel:u,onMouseDown:l,onMouseUp:c,onMouseMove:h,onContextMenu:a});return n.on("worldPos",(()=>this._update())),d(n,r),n};this._originDot=f(t.origin,[this._visible,this._originVisible]),this._cornerDot=f(t.corner,[this._visible,this._cornerVisible]),this._targetDot=f(t.target,[this._visible,this._targetVisible]),this._update()}_update(){if(!this._targetDot)return;const e=this._originDot.worldPos,t=this._cornerDot.worldPos,s=this._targetDot.worldPos;this._originWire.setEnds(e,t),this._targetWire.setEnds(t,s),this._angleLabel.setPosBetween(e,t,s),h.subVec3(e,t,Vp),h.subVec3(s,t,Lp),h.lenVec3(Vp)>0&&h.lenVec3(Lp)>0?(h.normalizeVec3(Vp),h.normalizeVec3(Lp),this._angle=Math.abs(h.angleVec3(Vp,Lp))*h.RADTODEG,this._angleLabel.setText((this._approximate?" ~ ":" = ")+this._angle.toFixed(2)+"")):(this._angle=void 0,this._angleLabel.setText(""))}set approximate(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._update())}get approximate(){return this._approximate}get origin(){return this._originDot}get corner(){return this._cornerDot}get target(){return this._targetDot}get angle(){return this._angle}get color(){return this._color}set color(e){this._color=e,this._originDot.setFillColor(e),this._cornerDot.setFillColor(e),this._targetDot.setFillColor(e),this._originWire.setColor(e||"blue"),this._targetWire.setColor(e||"red"),this._angleLabel.setFillColor(e||"#00BBFF")}set visible(e){this._visible.set(e)}get visible(){return this._visible.get()}set originVisible(e){this._originVisible.set(e)}get originVisible(){return this._originVisible.get()}set cornerVisible(e){this._cornerVisible.set(e)}get cornerVisible(){return this._cornerVisible.get()}set targetVisible(e){this._targetVisible.set(e)}get targetVisible(){return this._targetVisible.get()}set originWireVisible(e){this._originWireVisible.set(e)}get originWireVisible(){return this._originWireVisible.get()}set targetWireVisible(e){this._targetWireVisible.set(e)}get targetWireVisible(){return this._targetWireVisible.get()}set angleVisible(e){this._angleVisible.set(e)}get angleVisible(){return this._angleVisible.get()}set labelsVisible(e){this._labelsVisible.set(void 0!==e?Boolean(e):this.plugin.defaultLabelsVisible)}get labelsVisible(){return this._labelsVisible.get()}setHighlighted(e){this._drawables.forEach((t=>t.setHighlighted(e)))}set clickable(e){this._clickable.set(!!e),this._drawables.forEach((e=>e.setClickable(this._clickable.get())))}get clickable(){return this._clickable.get()}destroy(){this._cleanups.forEach((e=>e())),super.destroy()}}class Np extends T{get active(){}set snapping(e){}get snapping(){return!0}activate(){}deactivate(){}reset(){}get currentMeasurement(){return null}destroy(){}}class Gp extends Np{constructor(e,t={}){super(e.viewer.scene),this._canvasToPagePos=t.canvasToPagePos,this.pointerLens=t.pointerLens,this._active=!1,this._currentAngleMeasurement=null,this._initMarkerDiv(),this._snapping=!1!==t.snapping,this._mouseState=0,this._attachPlugin(e,t)}_initMarkerDiv(){const e=document.createElement("div"),t=this.scene.canvas.canvas;t.parentNode.insertBefore(e,t),e.style.background="black",e.style.border="2px solid blue",e.style.borderRadius="10px",e.style.width="5px",e.style.height="5px",e.style.top="-200px",e.style.left="-200px",e.style.margin="0 0",e.style.zIndex="100",e.style.position="absolute",e.style.pointerEvents="none",this.markerDiv=e}_destroyMarkerDiv(){this.markerDiv&&(this.markerDiv.parentNode.removeChild(this.markerDiv),this.markerDiv=null)}_attachPlugin(e,t={}){this.angleMeasurementsPlugin=e,this.plugin=e}get active(){return this._active}set snapping(e){this._snapping=e}get snapping(){return this._snapping}activate(){if(this._active)return;this.markerDiv||this._initMarkerDiv(),this.angleMeasurementsPlugin;const e=this.scene;e.input;const t=e.canvas.canvas,s=this.angleMeasurementsPlugin.viewer.cameraControl,i=this.pointerLens;let r=!1,n=null,A=0,o=0;const a=h.vec3(),l=h.vec2();this._currentAngleMeasurement=null;const c=h.vec2(),u=e=>{e.snappedToVertex||e.snappedToEdge?(i&&(i.visible=!0,i.canvasPos=e.canvasPos,i.snappedCanvasPos=e.snappedCanvasPos||e.canvasPos,i.snapped=!0),this.markerDiv.style.background="greenyellow",this.markerDiv.style.border="2px solid green"):(i&&(i.visible=!0,i.canvasPos=e.canvasPos,i.snappedCanvasPos=e.canvasPos,i.snapped=!1),this.markerDiv.style.background="pink",this.markerDiv.style.border="2px solid red");const s=e.snappedCanvasPos||e.canvasPos;switch(r=!0,n=e.entity,a.set(e.worldPos),l.set(s),this._mouseState){case 0:if(this._canvasToPagePos)this._canvasToPagePos(t,s,c),this.markerDiv.style.left=c[0]-5+"px",this.markerDiv.style.top=c[1]-5+"px";else{const e=h.vec2(s);Ep(t,this.markerDiv.parentNode,e),this.markerDiv.style.left=e[0]-5+"px",this.markerDiv.style.top=e[1]-5+"px"}break;case 1:this._currentAngleMeasurement&&(this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.angleVisible=!1,this._currentAngleMeasurement.corner.worldPos=e.worldPos,this._currentAngleMeasurement.corner.entity=e.entity),this.markerDiv.style.left="-10000px",this.markerDiv.style.top="-10000px",t.style.cursor="pointer";break;case 2:this._currentAngleMeasurement&&(this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.target.entity=e.entity),this.markerDiv.style.left="-10000px",this.markerDiv.style.top="-10000px",t.style.cursor="pointer"}};this._onHoverSnapOrSurface=s.on("hoverSnapOrSurface",(e=>{this._snapping&&u(e)})),this._onHoverSurface=s.on("hoverSurface",(e=>{this._snapping||u(e)})),t.addEventListener("mousedown",this._onMouseDown=e=>{1===e.which&&(A=e.clientX,o=e.clientY)}),t.addEventListener("mouseup",this._onMouseUp=e=>{if(1===e.which&&!(e.clientX>A+20||e.clientX<A-20||e.clientY>o+20||e.clientY<o-20))switch(this._mouseState){case 0:r&&(this._currentAngleMeasurement=this.angleMeasurementsPlugin.createMeasurement({id:h.createUUID(),origin:{worldPos:a,entity:n},corner:{worldPos:a,entity:n},target:{worldPos:a,entity:n},approximate:!0}),this._currentAngleMeasurement.clickable=!1,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._currentAngleMeasurement.origin.entity=n,this._mouseState=1,this.angleMeasurementsPlugin.fire("measurementStart",this._currentAngleMeasurement));break;case 1:r?(this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.corner.entity=n,this._mouseState=2):this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,n=null,this._mouseState=0,this.angleMeasurementsPlugin.fire("measurementCancel",this._currentAngleMeasurement));break;case 2:r?(this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this._currentAngleMeasurement.target.entity=n,this._currentAngleMeasurement.clickable=!0,n=null,this.angleMeasurementsPlugin.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null,this._mouseState=0):this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null,n=null,this._mouseState=0,this.angleMeasurementsPlugin.fire("measurementCancel",this._currentAngleMeasurement))}});const d=e=>{if(r=!1,i&&(i.visible=!0,i.canvasPos=e.canvasPos,i.snappedCanvasPos=e.snappedCanvasPos||e.canvasPos,i.snapped=!1),this.markerDiv.style.left="-100px",this.markerDiv.style.top="-100px",this._currentAngleMeasurement){switch(this._mouseState){case 0:this._currentAngleMeasurement.originVisible=!1;break;case 1:this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.originWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1;break;case 2:this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1}t.style.cursor="default"}};this._onHoverSnapOrSurfaceOff=s.on("hoverSnapOrSurfaceOff",(e=>{this._snapping&&d(e)})),this._onHoverOff=s.on("hoverOff",(e=>{this._snapping||d(e)})),this._active=!0}deactivate(){if(!this._active)return;this.pointerLens&&(this.pointerLens.visible=!1),this.reset();const e=this.scene.canvas.canvas;e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp);const t=this.angleMeasurementsPlugin.viewer.cameraControl;t.off(this._onHoverSnapOrSurface),t.off(this._onHoverSurface),t.off(this._onHoverSnapOrSurfaceOff),t.off(this._onHoverOff),this._active=!1}reset(){this._active&&(this._destroyMarkerDiv(),this._initMarkerDiv(),this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._mouseState=0)}get currentMeasurement(){return this._currentAngleMeasurement}destroy(){this.deactivate(),super.destroy()}}const jp=h.vec2();class Wp extends T{constructor(e,t,s,i){const r=e.plugin.viewer;super(r.scene);const n=Qp({viewer:r,handleMouseEvents:s,handleTouchEvents:i,pointerLens:t.pointerLens,dots:[e.origin,e.corner,e.target],ray2WorldPos:(e,s,i)=>{const n=e=>{const t=r.scene.pick({canvasPos:i,snapToEdge:e,snapToVertex:e,pickSurface:!0});return t&&t.worldPos?t.worldPos:e&&n(!1)};return n(!!t.snapping)},onEnd:(e,t)=>{const s=!h.compareVec3(e,t.worldPos);return s&&this.fire("edited"),s}}),A=e.on("destroyed",n);this._deactivate=function(){e.off("destroyed",A),n()}}deactivate(){this._deactivate(),super.destroy()}}const zp=h.vec3(),Xp=h.vec3(),Kp=h.vec3(),Zp=e=>e+"px";class Jp extends Tr{constructor(e,t){if(super(e,t),this.plugin=t.plugin,this._container=t.container,!this._container)throw"config missing: container";if(!t.markerElement&&!t.markerHTML)throw"config missing: need either markerElement or markerHTML";if(!t.labelElement&&!t.labelHTML)throw"config missing: need either labelElement or labelHTML";this._htmlDirty=!1,this._curMarkerWidth=void 0,this._curLabelWidth=0,t.markerElement?(this._marker=t.markerElement,this._marker.addEventListener("click",this._onMouseClickedExternalMarker=()=>{this.plugin.fire("markerClicked",this)}),this._onContextMenuExternalMarker=()=>{this.plugin.fire("contextmenu",this)},this._onContextMenuExternalMarkerRemover=ap(this._marker,this._onContextMenuExternalMarker),this._marker.addEventListener("mouseenter",this._onMouseEnterExternalMarker=()=>{this.plugin.fire("markerMouseEnter",this)}),this._marker.addEventListener("mouseleave",this._onMouseLeaveExternalMarker=()=>{this.plugin.fire("markerMouseLeave",this)}),this._markerExternal=!0):(this._markerHTML=t.markerHTML,this._htmlDirty=!0,this._markerExternal=!1),t.labelElement?(this._label=t.labelElement,this._labelExternal=!0):(this._labelHTML=t.labelHTML,this._htmlDirty=!0,this._labelExternal=!1),this._markerShown=!!t.markerShown,this._labelShown=!!t.labelShown,this._values=t.values||{},this._layoutDirty=!0,this._visibilityDirty=!0,this._labelPosition=24,this._buildHTML(),this._onTick=this.scene.on("tick",(()=>{this._htmlDirty&&(this._buildHTML(),this._htmlDirty=!1,this._layoutDirty=!0,this._visibilityDirty=!0),(this._layoutDirty||this._visibilityDirty)&&(this._markerShown||this._labelShown)&&(this._updatePosition(),this._layoutDirty=!1),this._visibilityDirty&&(this._marker.style.visibility=this.visible&&this._markerShown?"visible":"hidden",this._label.style.visibility=this.visible&&this._markerShown&&this._labelShown?"visible":"hidden",this._visibilityDirty=!1)})),this.on("canvasPos",(()=>{this._layoutDirty=!0})),this.on("visible",(()=>{this._visibilityDirty=!0})),this.setMarkerShown(!1!==t.markerShown),this.setLabelShown(t.labelShown),this.eye=t.eye?t.eye.slice():null,this.look=t.look?t.look.slice():null,this.up=t.up?t.up.slice():null,this.projection=t.projection}_buildHTML(){if(!this._markerExternal){this._marker&&(this._container.removeChild(this._marker),this._marker=null);let e=this._markerHTML||"<p></p>";_.isArray(e)&&(e=e.join("")),e=this._renderTemplate(e.trim());const t=document.createRange().createContextualFragment(e);this._marker=t.firstChild,this._container.appendChild(this._marker),this._marker.style.visibility=this._markerShown?"visible":"hidden",this._marker.addEventListener("click",(()=>{this.plugin.fire("markerClicked",this)})),ap(this._marker,(e=>{e.preventDefault(),this.plugin.fire("contextmenu",this)}),(e=>{e.preventDefault(),this.plugin.fire("markerClicked",this)})),this._marker.addEventListener("mouseenter",(()=>{this.plugin.fire("markerMouseEnter",this)})),this._marker.addEventListener("mouseleave",(()=>{this.plugin.fire("markerMouseLeave",this)})),this._marker.addEventListener("wheel",(e=>{this.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))}))}if(!this._labelExternal){this._label&&(this._container.removeChild(this._label),this._label=null);let e=this._labelHTML||"<p></p>";_.isArray(e)&&(e=e.join("")),e=this._renderTemplate(e.trim());const t=document.createRange().createContextualFragment(e);this._label=t.firstChild,this._container.appendChild(this._label),this._label.style.visibility=this._markerShown&&this._labelShown?"visible":"hidden",this._label.addEventListener("wheel",(e=>{this.plugin.viewer.scene.canvas.canvas.dispatchEvent(new WheelEvent("wheel",e))}))}}_updateWithCurWidths(){const e=this.scene.canvas.boundary,t=e[0]+this.canvasPos[0],s=e[1]+this.canvasPos[1];if(this._marker.style.top=Zp(s-12),this._label.style.top=Zp(s-17),"legacy"===this._markerAlign)this._marker.style.left=Zp(t-12),this._label.style.left=Zp(t+40);else{const e=this._curMarkerWidth,s=t+("right"===this._markerAlign?-1:"center"===this._markerAlign?0:1)*(e/2-12);this._marker.style.left=Zp(s-e/2);const i=this._curLabelWidth,r=Math.sign(this._labelPosition);this._label.style.left=Zp(s+r*(e/2+Math.abs(this._labelPosition)+i/2)-i/2)}const i=90005+Math.floor(this._viewPos[2])+1;this._marker.style["z-index"]=i,this._label.style["z-index"]=i}_updateIfWidthsChanged(){let e=!1;const t=this._marker.getBoundingClientRect().width;this._curMarkerWidth!==t&&(this._curMarkerWidth=t,e=!0);if(1!==Math.sign(this._labelPosition)){const t=this._label.getBoundingClientRect().width;this._curLabelWidth!==t&&(this._curLabelWidth=t,e=!0)}e&&this._updateWithCurWidths()}_updatePosition(){const e="legacy"===this._markerAlign;e||void 0!==this._curMarkerWidth?(this._updateWithCurWidths(),window.clearTimeout(this._widthTimeout),e||(this._widthTimeout=window.setTimeout((()=>this._updateIfWidthsChanged()),500))):this._updateIfWidthsChanged()}_renderTemplate(e){for(var t in this._values)if(this._values.hasOwnProperty(t)){const s=this._values[t];e=e.replace(new RegExp("{{"+t+"}}","g"),s)}return e}setFromPickResult(e){if(e.worldPos&&e.worldNormal){const t=h.normalizeVec3(e.worldNormal,zp),s=this.plugin&&this.plugin.surfaceOffset||0,i=h.mulVec3Scalar(t,s,Xp),r=h.addVec3(e.worldPos,i,Kp);this.entity=e.entity,this.worldPos=r}else this.error("Param 'pickResult' does not have both worldPos and worldNormal")}setMarkerAlign(e){const t=["left","center","right","legacy"];t.includes(e)?(this._markerAlign=e,this._updatePosition()):this.error("Param 'align' should be one of: "+JSON.stringify(t))}setLabelPosition(e){"number"!=typeof e?this.error("Param 'position' is not a number"):0===e?this.error("Param 'position' is zero"):(this._labelPosition=e,this._updatePosition())}setMarkerShown(e){e=!!e,this._markerShown!==e&&(this._markerShown=e,this._visibilityDirty=!0)}getMarkerShown(){return this._markerShown}setLabelShown(e){e=!!e,this._labelShown!==e&&(this._labelShown=e,this._visibilityDirty=!0)}getLabelShown(){return this._labelShown}setField(e,t){this._values[e]=t||"",this._htmlDirty=!0}getField(e){return this._values[e]}setValues(e){for(var t in e)if(e.hasOwnProperty(t)){const s=e[t];this.setField(t,s)}}getValues(){return this._values}destroy(){window.clearTimeout(this._widthTimeout),this._marker&&(this._markerExternal?(this._marker.removeEventListener("click",this._onMouseClickedExternalMarker),this._onContextMenuExternalMarkerRemover(),this._marker.removeEventListener("mouseenter",this._onMouseEnterExternalMarker),this._marker.removeEventListener("mouseleave",this._onMouseLeaveExternalMarker),this._marker=null):(this._marker.parentNode.removeChild(this._marker),this._marker=null)),this._label&&(this._labelExternal||this._label.parentNode.removeChild(this._label),this._label=null),this.scene.off(this._onTick),super.destroy()}}const Yp=h.vec3(),$p=h.vec3(),qp=h.vec3(),ef=h.vec3();function tf(e){return{x:e[0],y:e[1],z:e[2]}}function sf(e,t){return(t=new Float64Array(3))[0]=e.x,t[1]=e.y,t[2]=e.z,t}function rf(e){return new Float64Array([e[0],-e[2],e[1]])}function nf(e){return new Float64Array([e[0],e[2],-e[1]])}const Af=h.vec3(),of=h.vec3(),af=h.vec3();h.vec4(),h.vec4(),h.vec4();class lf extends T{constructor(e,t={}){const s=e.viewer.scene;super(s,t),this.plugin=e;const i=t.container;if(!i)throw"config missing: container";this._color=t.color||e.defaultColor;const r=function(e,t){const s=[];let i=void 0!==e?Boolean(e):t;return{reg:e=>s.push(e),get:()=>i,set:e=>{i=void 0!==e?Boolean(e):t,s.forEach((e=>e(i)))}}};this._visible=r(t.visible,e.defaultVisible),this._originVisible=r(t.originVisible,e.defaultOriginVisible),this._targetVisible=r(t.targetVisible,e.defaultTargetVisible),this._axisVisible=r(t.axisVisible,e.defaultAxisVisible),this._xAxisVisible=r(t.xAxisVisible,e.defaultAxisVisible),this._yAxisVisible=r(t.yAxisVisible,e.defaultAxisVisible),this._zAxisVisible=r(t.zAxisVisible,e.defaultAxisVisible),this._axisEnabled=r(!0,e.defaultAxisVisible),this._wireVisible=r(t.wireVisible,e.defaultWireVisible),this._xLabelEnabled=r(t.xLabelEnabled,e.defaultXLabelEnabled),this._yLabelEnabled=r(t.yLabelEnabled,e.defaultYLabelEnabled),this._zLabelEnabled=r(t.zLabelEnabled,e.defaultZLabelEnabled),this._lengthLabelEnabled=r(t.lengthLabelEnabled,e.defaultLengthLabelEnabled),this._labelsVisible=r(t.labelsVisible,e.defaultLabelsVisible),this._clickable=r(!1,!1),this._labelsOnWires=r(t.labelsOnWires,e.defaultLabelsOnWires),this._useRotationAdjustment=r(t.useRotationAdjustment,e.useRotationAdjustment),this._axesBasis=h.identityMat4(),this.approximate=t.approximate;const n=s.canvas.canvas,A=t.onMouseOver?e=>{t.onMouseOver(e,this),n.dispatchEvent(new MouseEvent("mouseover",e))}:null,o=t.onMouseLeave?e=>{t.onMouseLeave(e,this),n.dispatchEvent(new MouseEvent("mouseleave",e))}:null,a=t.onContextMenu?e=>{t.onContextMenu(e,this)}:null,l=e=>n.dispatchEvent(new MouseEvent("mousedown",e)),c=e=>n.dispatchEvent(new MouseEvent("mouseup",e)),u=e=>n.dispatchEvent(new MouseEvent("mousemove",e)),d=e=>n.dispatchEvent(new WheelEvent("wheel",e));this._cleanups=[],["units","scale"].forEach((e=>{const t=s.metrics.on("units",(()=>this._update()));this._cleanups.push((()=>s.metrics.off(t)))})),this._drawables=[];const p=(e,t)=>{const s=()=>e.setVisible(t.every((e=>e.get())));t.forEach((e=>e.reg(s))),this._drawables.push(e),this._cleanups.push((()=>e.destroy()))},f=(t,r,n)=>{const h=new Pp(s,i,{color:t,thickness:r,thicknessClickable:6,zIndex:void 0!==e.zIndex?e.zIndex+1:void 0,onMouseOver:A,onMouseLeave:o,onMouseWheel:d,onMouseDown:l,onMouseUp:c,onMouseMove:u,onContextMenu:a});return p(h,n),{setEnds:(e,t)=>h.setEnds(e,t),setColor:e=>h.setColor(e)}};this._lengthWire=f(this._color,2,[this._visible,this._wireVisible]),this._xAxisWire=f("red",1,[this._visible,this._axisEnabled,this._axisVisible,this._xAxisVisible]),this._yAxisWire=f("green",1,[this._visible,this._axisEnabled,this._axisVisible,this._yAxisVisible]),this._zAxisWire=f("blue",1,[this._visible,this._axisEnabled,this._axisVisible,this._zAxisVisible]);const g=(t,r,n)=>{const h=new Tp(s,i,{fillColor:t,zIndex:void 0!==e.zIndex?e.zIndex+r:void 0,onMouseOver:A,onMouseLeave:o,onMouseWheel:d,onMouseDown:l,onMouseUp:c,onMouseMove:u,onContextMenu:a});return p(h,n),{setFillColor:e=>h.setFillColor(e),setPosOnWire:(e,t,s,i)=>h.setPosOnWire(e,t,s,i),setPosBetween:(e,t,s)=>h.setPosBetween(e,t,s),setText:e=>h.setText(e.replace(/ /g,"&nbsp;"))}};this._lengthLabel=g(this._color,4,[this._visible,this._wireVisible,this._labelsVisible,this._clickable,this._axisEnabled,this._lengthLabelEnabled]),this._xAxisLabel=g("red",3,[this._visible,this._axisEnabled,this._axisVisible,this._xAxisVisible,this._labelsVisible,this._clickable,this._xLabelEnabled]),this._yAxisLabel=g("green",3,[this._visible,this._axisEnabled,this._axisVisible,this._yAxisVisible,this._labelsVisible,this._clickable,this._yLabelEnabled]),this._zAxisLabel=g("blue",3,[this._visible,this._axisEnabled,this._axisVisible,this._zAxisVisible,this._labelsVisible,this._clickable,this._zLabelEnabled]);const m=(t,r)=>{const n=new Ip(s,t,i,{fillColor:this._color,zIndex:void 0!==e.zIndex?e.zIndex+2:void 0,onMouseOver:A,onMouseLeave:o,onMouseWheel:d,onMouseDown:l,onMouseUp:c,onMouseMove:u,onContextMenu:a});return n.on("worldPos",(()=>this._update())),p(n,r),n};this._originDot=m(t.origin,[this._visible,this._originVisible]),this._targetDot=m(t.target,[this._visible,this._targetVisible]),this._update()}_update(){if(!this._targetDot)return;const e=this._originDot.worldPos,t=this._targetDot.worldPos,s=this._axesBasis,i=h.subVec3(t,e,Af),r=h.transformVec3(s,i,i),n=this._useRotationAdjustment.get()&&Math.abs(i[1])>0,A=(s,i)=>{const r=this.plugin.viewer.scene.metrics,A=r.scale,o=r.unitsInfo[r.units].abbrev,a=(s,i,r,n)=>{this._labelsOnWires.get()?s.setPosOnWire(i,r,0,this.plugin.labelMinAxisLength):s.setPosOnWire(e,t,35*n,0)},l=e=>(this._approximate?" ~ ":" = ")+e.toFixed(2)+o;this._xAxisWire.setEnds(e,s),a(this._xAxisLabel,e,s,1),this._xAxisLabel.setText("X"+l(h.distVec3(e,s)*A)),this._yAxisWire.setEnds(s,i),a(this._yAxisLabel,s,i,2),this._yAxisLabel.setText("Y"+l(h.distVec3(s,i)*A)),this._zAxisWire.setEnds(i,t),a(this._zAxisLabel,i,t,3),this._zAxisLabel.setText((n?"":"Z")+l(h.distVec3(i,t)*A)),this._lengthWire.setEnds(e,t),a(this._lengthLabel,e,t,0),this._length=h.distVec3(e,t)*A,this._lengthLabel.setText(l(this._length))};n?(af[0]=e[0],af[1]=t[1],af[2]=e[2],A(e,af)):(of[0]=e[0]+s[0]*r[0],of[1]=e[1]+s[4]*r[0],of[2]=e[2]+s[8]*r[0],af[0]=of[0]+s[1]*r[1],af[1]=of[1]+s[5]*r[1],af[2]=of[2]+s[9]*r[1],A(of,af))}set axesBasis(e){this._axesBasis.set(e),this._update()}get axesBasis(){return this._axesBasis}set approximate(e){e=!1!==e,this._approximate!==e&&(this._approximate=e,this._update())}get approximate(){return this._approximate}get origin(){return this._originDot}get target(){return this._targetDot}get length(){return this._length}get color(){return this._color}set color(e){this._color=e,this._originDot.setFillColor(e),this._targetDot.setFillColor(e),this._lengthWire.setColor(e),this._lengthLabel.setFillColor(e)}set visible(e){this._visible.set(e)}get visible(){return this._visible.get()}set originVisible(e){this._originVisible.set(e)}get originVisible(){return this._originVisible.get()}set targetVisible(e){this._targetVisible.set(e)}get targetVisible(){return this._targetVisible.get()}set useRotationAdjustment(e){this._useRotationAdjustment.set(e),this._update()}get useRotationAdjustment(){return this._useRotationAdjustment.get()}set axisEnabled(e){this._axisEnabled.set(e)}get axisEnabled(){return this._axisEnabled.get()}set axisVisible(e){this._axisVisible.set(e)}get axisVisible(){return this._axisVisible.get()}set xAxisVisible(e){this._xAxisVisible.set(e)}get xAxisVisible(){return this._xAxisVisible.get()}set yAxisVisible(e){this._yAxisVisible.set(e)}get yAxisVisible(){return this._yAxisVisible.get()}set zAxisVisible(e){this._zAxisVisible.set(e)}get zAxisVisible(){return this._zAxisVisible.get()}set wireVisible(e){this._wireVisible.set(e)}get wireVisible(){return this._wireVisible.get()}set labelsVisible(e){this._labelsVisible.set(e)}get labelsVisible(){return this._labelsVisible.get()}set xLabelEnabled(e){this._xLabelEnabled.set(e)}get xLabelEnabled(){return this._xLabelEnabled.get()}set yLabelEnabled(e){this._yLabelEnabled.set(e)}get yLabelEnabled(){return this._yLabelEnabled.get()}set zLabelEnabled(e){this._zLabelEnabled.set(e)}get zLabelEnabled(){return this._zLabelEnabled.get()}set lengthLabelEnabled(e){this._lengthLabelEnabled.set(e)}get lengthLabelEnabled(){return this._lengthLabelEnabled.get()}set labelsOnWires(e){this._labelsOnWires.set(e),this._update()}get labelsOnWires(){return this._labelsOnWires.get()}setHighlighted(e){this._drawables.forEach((t=>t.setHighlighted(e)))}set clickable(e){this._clickable.set(!!e),this._drawables.forEach((e=>e.setClickable(this._clickable.get())))}get clickable(){return this._clickable.get()}destroy(){this._cleanups.forEach((e=>e())),super.destroy()}}class cf extends T{get active(){}set snapping(e){}get snapping(){return!0}activate(){}deactivate(){}reset(){}get currentMeasurement(){return null}destroy(){}}class hf extends cf{constructor(e,t={}){super(e.viewer.scene),this._canvasToPagePos=t.canvasToPagePos,this.pointerLens=t.pointerLens,this._active=!1,this._currentDistanceMeasurement=null,this._currentDistanceMeasurementInitState={wireVisible:null,axisVisible:null,xAxisVisible:null,yaxisVisible:null,zAxisVisible:null,targetVisible:null},this._initMarkerDiv(),this._snapping=!1!==t.snapping,this._mouseState=0,this._attachPlugin(e,t)}_initMarkerDiv(){const e=document.createElement("div"),t=this.scene.canvas.canvas;t.parentNode.insertBefore(e,t),e.style.background="black",e.style.border="2px solid blue",e.style.borderRadius="10px",e.style.width="5px",e.style.height="5px",e.style.top="-200px",e.style.left="-200px",e.style.margin="0 0",e.style.zIndex="100",e.style.position="absolute",e.style.pointerEvents="none",this._markerDiv=e}_destroyMarkerDiv(){this._markerDiv&&(this._markerDiv.parentNode.removeChild(this._markerDiv),this._markerDiv=null)}_attachPlugin(e,t={}){this.distanceMeasurementsPlugin=e,this.plugin=e}get active(){return this._active}set snapping(e){this._snapping=e}get snapping(){return this._snapping}activate(){if(this._active)return;this._markerDiv||this._initMarkerDiv(),this.fire("activated",!0);const e=this.distanceMeasurementsPlugin,t=this.scene,s=e.viewer.cameraControl,i=t.canvas.canvas;t.input;let r=!1;const n=h.vec3(),A=h.vec2();let o,a;let l=null;this._mouseState=0;const c=h.vec2(),u=e=>{const t=e.snappedCanvasPos||e.canvasPos;if(r=!0,n.set(e.worldPos),A.set(e.canvasPos),0===this._mouseState){if(this._canvasToPagePos)this._canvasToPagePos(i,t,c),this._markerDiv.style.left=c[0]-5+"px",this._markerDiv.style.top=c[1]-5+"px";else{const e=h.vec2(t);Ep(i,this._markerDiv.parentNode,e),this._markerDiv.style.left=e[0]-5+"px",this._markerDiv.style.top=e[1]-5+"px"}this._markerDiv.style.background="pink",e.snappedToVertex||e.snappedToEdge?(this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=e.canvasPos,this.pointerLens.snappedCanvasPos=e.snappedCanvasPos||e.canvasPos,this.pointerLens.snapped=!0),this._markerDiv.style.background="greenyellow",this._markerDiv.style.border="2px solid green"):(this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=e.canvasPos,this.pointerLens.snappedCanvasPos=e.canvasPos,this.pointerLens.snapped=!1),this._markerDiv.style.background="pink",this._markerDiv.style.border="2px solid red"),l=e.entity}else this._markerDiv.style.left="-10000px",this._markerDiv.style.top="-10000px";i.style.cursor="pointer",this._currentDistanceMeasurement&&(this._currentDistanceMeasurement.wireVisible=this._currentDistanceMeasurementInitState.wireVisible,this._currentDistanceMeasurement.axisVisible=this._currentDistanceMeasurementInitState.axisVisible&&this.distanceMeasurementsPlugin.defaultAxisVisible,this._currentDistanceMeasurement.xAxisVisible=this._currentDistanceMeasurementInitState.xAxisVisible&&this.distanceMeasurementsPlugin.defaultXAxisVisible,this._currentDistanceMeasurement.yAxisVisible=this._currentDistanceMeasurementInitState.yAxisVisible&&this.distanceMeasurementsPlugin.defaultYAxisVisible,this._currentDistanceMeasurement.zAxisVisible=this._currentDistanceMeasurementInitState.zAxisVisible&&this.distanceMeasurementsPlugin.defaultZAxisVisible,this._currentDistanceMeasurement.targetVisible=this._currentDistanceMeasurementInitState.targetVisible,this._currentDistanceMeasurement.target.worldPos=n.slice(),this._markerDiv.style.left="-10000px",this._markerDiv.style.top="-10000px")};this._onHoverSnapOrSurface=s.on("hoverSnapOrSurface",(e=>{this._snapping&&u(e)})),this._onHoverSurface=s.on("hoverSurface",(e=>{this._snapping||u(e)})),i.addEventListener("mousedown",this._onMouseDown=e=>{1===e.which&&(o=e.clientX,a=e.clientY)}),i.addEventListener("mouseup",this._onMouseUp=t=>{1===t.which&&(t.clientX>o+20||t.clientX<o-20||t.clientY>a+20||t.clientY<a-20||(this._currentDistanceMeasurement?r?(this._currentDistanceMeasurement.target.entity=l,l=null,this._currentDistanceMeasurement.clickable=!0,this.distanceMeasurementsPlugin.fire("measurementEnd",this._currentDistanceMeasurement),this._currentDistanceMeasurement=null):(this._currentDistanceMeasurement.destroy(),this.distanceMeasurementsPlugin.fire("measurementCancel",this._currentDistanceMeasurement),this._currentDistanceMeasurement=null,l=null):r&&(this._currentDistanceMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:n.slice(),entity:l},target:{worldPos:n.slice(),entity:l},approximate:!0}),this._currentDistanceMeasurementInitState.axisVisible=this._currentDistanceMeasurement.axisVisible&&this.distanceMeasurementsPlugin.defaultAxisVisible,this._currentDistanceMeasurementInitState.xAxisVisible=this._currentDistanceMeasurement.xAxisVisible&&this.distanceMeasurementsPlugin.defaultXAxisVisible,this._currentDistanceMeasurementInitState.yAxisVisible=this._currentDistanceMeasurement.yAxisVisible&&this.distanceMeasurementsPlugin.defaultYAxisVisible,this._currentDistanceMeasurementInitState.zAxisVisible=this._currentDistanceMeasurement.zAxisVisible&&this.distanceMeasurementsPlugin.defaultZAxisVisible,this._currentDistanceMeasurementInitState.wireVisible=this._currentDistanceMeasurement.wireVisible,this._currentDistanceMeasurementInitState.targetVisible=this._currentDistanceMeasurement.targetVisible,this._currentDistanceMeasurement.clickable=!1,this._currentDistanceMeasurement.origin.entity=l,l=null,this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement))))});const d=e=>{this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=e.canvasPos,this.pointerLens.snappedCanvasPos=e.snappedCanvasPos||e.canvasPos),r=!1,this._markerDiv.style.left="-100px",this._markerDiv.style.top="-100px",this._currentDistanceMeasurement&&(this._currentDistanceMeasurement.wireVisible=!1,this._currentDistanceMeasurement.targetVisible=!1,this._currentDistanceMeasurement.axisVisible=!1),i.style.cursor="default"};this._onHoverSnapOrSurfaceOff=s.on("hoverSnapOrSurfaceOff",(e=>{this._snapping&&d(e)})),this._onHoverOff=s.on("hoverOff",(e=>{this._snapping||d(e)})),this._active=!0}deactivate(){if(!this._active)return;this.fire("activated",!1),this.pointerLens&&(this.pointerLens.visible=!1),this.reset();const e=this.scene.canvas.canvas;e.removeEventListener("mousedown",this._onMouseDown),e.removeEventListener("mouseup",this._onMouseUp);const t=this.distanceMeasurementsPlugin.viewer.cameraControl;t.off(this._onHoverSnapOrSurface),t.off(this._onHoverSurface),t.off(this._onHoverSnapOrSurfaceOff),t.off(this._onHoverOff),this._active=!1}reset(){this._active&&(this._destroyMarkerDiv(),this._initMarkerDiv(),this._currentDistanceMeasurement&&(this.distanceMeasurementsPlugin.fire("measurementCancel",this._currentDistanceMeasurement),this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null),this._mouseState=0)}get currentMeasurement(){return this._currentDistanceMeasurement}destroy(){this.deactivate(),super.destroy()}}const uf=h.vec2();class df extends T{constructor(e,t,s,i){const r=e.plugin.viewer;super(r.scene);const n=Qp({viewer:r,handleMouseEvents:s,handleTouchEvents:i,pointerLens:t.pointerLens,dots:[e.origin,e.target],ray2WorldPos:(e,s,i)=>{const n=e=>{const t=r.scene.pick({canvasPos:i,snapToEdge:e,snapToVertex:e,pickSurface:!0});return t&&t.worldPos?t.worldPos:e&&n(!1)};return n(!!t.snapping)},onEnd:(e,t)=>{const s=!h.compareVec3(e,t.worldPos);return s&&this.fire("edited"),s}}),A=e.on("destroyed",n);this._deactivate=function(){e.off("destroyed",A),n()}}deactivate(){this._deactivate(),super.destroy()}}class pf{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getMetaModel(e,t,s){_.loadJSON(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}getGLTF(e,t,s){_.loadArraybuffer(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}getGLB(e,t,s){_.loadArraybuffer(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}getArrayBuffer(e,t,s,i){!function(e,t,s,i){var r=()=>{};s=s||r,i=i||r;const n=/^data:(.*?)(;base64)?,(.*)$/,A=t.match(n);if(A){const e=!!A[2];var o=A[3];o=window.decodeURIComponent(o),e&&(o=window.atob(o));try{const e=new ArrayBuffer(o.length),t=new Uint8Array(e);for(var a=0;a<o.length;a++)t[a]=o.charCodeAt(a);F.scheduleTask((function(){s(e)}))}catch(e){F.scheduleTask((function(){i(e)}))}}else{const r=function(e){var t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}(e),n=r+t,A=new XMLHttpRequest;A.open("GET",n,!0),A.responseType="arraybuffer",A.onreadystatechange=function(){4===A.readyState&&(200===A.status?s(A.response):i("loadArrayBuffer error : "+A.response))},A.send(null)}}(this._cacheBusterURL(e),t,(e=>{s(e)}),(function(e){i(e)}))}}async function ff(e,t,s,i){return i._parse(e,t,s,i)}function gf(e,t){if(!e)throw new Error(t||"loader assertion failed.")}const mf=Boolean("object"!=typeof process||"[object process]"!==String(process)||process.browser),_f="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);_f&&parseFloat(_f[1]);const bf=globalThis,Bf=globalThis.process||{};function yf(){return!("object"==typeof process&&"[object process]"===String(process)&&!process?.browser)||function(e){if("undefined"!=typeof window&&"renderer"===window.process?.type)return!0;if("undefined"!=typeof process&&Boolean(process.versions?.electron))return!0;const t="undefined"!=typeof navigator&&navigator.userAgent,s=e||t;return Boolean(s&&s.indexOf("Electron")>=0)}()}class wf{constructor(e,t,s="sessionStorage"){this.storage=function(e){try{const t=window[e],s="__storage_test__";return t.setItem(s,s),t.removeItem(s),t}catch(e){return null}}(s),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){const e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){const t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}var vf;!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(vf||(vf={}));function Cf(e){return"string"!=typeof e?e:(e=e.toUpperCase(),vf[e]||vf.WHITE)}function Mf(e,t){if(!e)throw new Error(t||"Assertion failed")}function Ef(){let e;if(yf()&&bf.performance)e=bf?.performance?.now?.();else if("hrtime"in Bf){const t=Bf?.hrtime?.();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}const Ff={debug:yf()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},xf={enabled:!0,level:0};function Uf(){}const If={},Tf={once:!0};class Pf{constructor({id:e}={id:""}){this.VERSION="4.1.0",this._startTs=Ef(),this._deltaTs=Ef(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new wf(`__probe-${this.id}__`,xf),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){const s=Object.getPrototypeOf(e),i=Object.getOwnPropertyNames(s),r=e;for(const s of i){const i=r[s];"function"==typeof i&&(t.find((e=>s===e))||(r[s]=i.bind(e)))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((Ef()-this._startTs).toPrecision(10))}getDelta(){return Number((Ef()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw new Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,Ff.warn,arguments,Tf)}error(e){return this._getLogFunction(0,e,Ff.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,Ff.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,Ff.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,Ff.debug||Ff.info,arguments,Tf)}table(e,t,s){return t?this._getLogFunction(e,t,console.table||Uf,s&&[s],{tag:kf(t)}):Uf}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||Uf)}group(e,t,s={collapsed:!1}){const i=Df({logLevel:e,message:t,opts:s}),{collapsed:r}=s;return i.method=(r?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,s={}){return this.group(e,t,Object.assign({},s,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||Uf)}withGroup(e,t,s){this.group(e,t)();try{s()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=Sf(e)}_getLogFunction(e,t,s,i,r){if(this._shouldLog(e)){r=Df({logLevel:e,message:t,args:i,opts:r}),Mf(s=s||r.method),r.total=this.getTotal(),r.delta=this.getDelta(),this._deltaTs=Ef();const n=r.tag||r.message;if(r.once&&n){if(If[n])return Uf;If[n]=Ef()}return t=function(e,t,s){if("string"==typeof t){const i=s.time?function(e,t=8){const s=Math.max(t-e.length,0);return`${" ".repeat(s)}${e}`}(function(e){let t;return t=e<10?`${e.toFixed(2)}ms`:e<100?`${e.toFixed(1)}ms`:e<1e3?`${e.toFixed(0)}ms`:`${(e/1e3).toFixed(2)}s`,t}(s.total)):"";t=s.time?`${e}: ${i}  ${t}`:`${e}: ${t}`,t=function(e,t,s){yf||"string"!=typeof e||(t&&(e=`[${Cf(t)}m${e}[39m`),s&&(e=`[${Cf(s)+10}m${e}[49m`));return e}(t,s.color,s.background)}return t}(this.id,r.message,r),s.bind(console,t,...r.args)}return Uf}}function Sf(e){if(!e)return 0;let t;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return Mf(Number.isFinite(t)&&t>=0),t}function Df(e){const{logLevel:t,message:s}=e;e.logLevel=Sf(t);const i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==s;);switch(typeof t){case"string":case"function":void 0!==s&&i.unshift(s),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());const r=typeof e.message;return Mf("string"===r||"object"===r),Object.assign(e,{args:i},e.opts)}function kf(e){for(const t in e)for(const s in e[t])return s||"untitled";return"empty"}Pf.VERSION="4.1.0";const Qf="4.3.2"[0]>="0"&&"4.3.2"[0]<="9"?"v4.3.2":"";const Rf=function(){const e=new Pf({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Qf,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();function Of(e,t){return Vf(e||{},t)}function Vf(e,t,s=0){if(s>3)return t;const i={...e};for(const[e,r]of Object.entries(t))r&&"object"==typeof r&&!Array.isArray(r)?i[e]=Vf(i[e]||{},t[e],s+1):i[e]=t[e];return i}const Lf=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version);function Hf(e,t){if(!e)throw new Error(t||"loaders.gl assertion failed.")}const Nf="object"!=typeof process||"[object process]"!==String(process)||process.browser,Gf="function"==typeof importScripts,jf="undefined"!=typeof window&&void 0!==window.orientation,Wf="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);Wf&&parseFloat(Wf[1]);class zf{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){Hf(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){Hf(this.isRunning),this.isRunning=!1,this._reject(e)}}class Xf{terminate(){}}const Kf=new Map;function Zf(e){Hf(e.source&&!e.url||!e.source&&e.url);let t=Kf.get(e.source||e.url);return t||(e.url&&(t=function(e){if(!e.startsWith("http"))return e;return Jf((t=e,`try {\n  importScripts('${t}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`));var t}(e.url),Kf.set(e.url,t)),e.source&&(t=Jf(e.source),Kf.set(e.source,t))),Hf(t),t}function Jf(e){const t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function Yf(e,t=!0,s){const i=s||new Set;if(e){if($f(e))i.add(e);else if($f(e.buffer))i.add(e.buffer);else if(ArrayBuffer.isView(e));else if(t&&"object"==typeof e)for(const s in e)Yf(e[s],t,i)}else;return void 0===s?Array.from(i):[]}function $f(e){return!!e&&(e instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&e instanceof MessagePort||("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)))}const qf=()=>{};class eg{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&Nf||void 0!==Xf&&!Nf}constructor(e){const{name:t,source:s,url:i}=e;Hf(s||i),this.name=t,this.source=s,this.url=i,this.onMessage=qf,this.onError=e=>console.log(e),this.worker=Nf?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=qf,this.onError=qf,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,t){t=t||Yf(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),new Error(t)}_createBrowserWorker(){this._loadableURL=Zf({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const t=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new Xf(t,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new Xf(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class tg{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return eg.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=((e,t,s)=>e.done(s)),s=((e,t)=>e.error(t))){const i=new Promise((i=>(this.jobQueue.push({name:e,onMessage:t,onError:s,onStart:i}),this)));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});const s=new zf(t.name,e);e.onMessage=e=>t.onMessage(s,e.type,e.payload),e.onError=e=>t.onError(s,e),t.onStart(s);try{await s.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!Nf||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new eg({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return jf?this.maxMobileConcurrency:this.maxConcurrency}}const sg={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class ig{props;workerPools=new Map;static _workerFarm;static isSupported(){return eg.isSupported()}static getWorkerFarm(e={}){return ig._workerFarm=ig._workerFarm||new ig({}),ig._workerFarm.setProps(e),ig._workerFarm}constructor(e){this.props={...sg},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:t,source:s,url:i}=e;let r=this.workerPools.get(t);return r||(r=new tg({name:t,source:s,url:i}),r.setProps(this._getWorkerPoolProps()),this.workerPools.set(t,r)),r}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}const rg={};async function ng(e,t=null,s={},i=null){return t&&(e=function(e,t,s={},i=null){if(!s.useLocalLibraries&&e.startsWith("http"))return e;i=i||e;const r=s.modules||{};if(r[i])return r[i];if(!Nf)return`modules/${t}/dist/libs/${i}`;if(s.CDN)return Hf(s.CDN.startsWith("http")),`${s.CDN}/${t}@${Lf}/dist/libs/${i}`;if(Gf)return`../src/libs/${i}`;return`modules/${t}/src/libs/${i}`}(e,t,s,i)),rg[e]=rg[e]||async function(e){if(e.endsWith("wasm"))return await async function(e){const{readFileAsArrayBuffer:t}=globalThis.loaders||{};if(Nf||!t||e.startsWith("http")){const t=await fetch(e);return await t.arrayBuffer()}return await t(e)}(e);if(!Nf)try{const{requireFromFile:t}=globalThis.loaders||{};return await(t?.(e))}catch(e){return console.error(e),null}if(Gf)return importScripts(e);return function(e,t){if(!Nf){const{requireFromString:s}=globalThis.loaders||{};return s?.(e,t)}if(Gf)return eval.call(globalThis,e),null;const s=document.createElement("script");s.id=t;try{s.appendChild(document.createTextNode(e))}catch(t){s.text=e}return document.body.appendChild(s),null}(await async function(e){const{readFileAsText:t}=globalThis.loaders||{};if(Nf||!t||e.startsWith("http")){const t=await fetch(e);return await t.text()}return await t(e)}(e),e)}(e),await rg[e]}async function Ag(e,t,s,i,r){const n=e.id,A=function(e,t={}){const s=t[e.id]||{},i=Nf?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let r=s.workerUrl;if(r||"compression"!==e.id||(r=t.workerUrl),"test"===t._workerType&&(r=Nf?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!r){let t=e.version;"latest"===t&&(t="latest");const s=t?`@${t}`:"";r=`https://unpkg.com/@loaders.gl/${e.module}${s}/dist/${i}`}return Hf(r),r}(e,s),o=ig.getWorkerFarm(s).getWorkerPool({name:n,url:A});s=JSON.parse(JSON.stringify(s)),i=JSON.parse(JSON.stringify(i||{}));const a=await o.startJob("process-on-worker",og.bind(null,r));a.postMessage("process",{input:t,options:s,context:i});const l=await a.result;return await l.result}async function og(e,t,s,i){switch(s){case"done":t.done(i);break;case"error":t.error(new Error(i.error));break;case"process":const{id:r,input:n,options:A}=i;try{const s=await e(n,A);t.postMessage("done",{id:r,result:s})}catch(e){const s=e instanceof Error?e.message:"unknown error";t.postMessage("error",{id:r,error:s})}break;default:console.warn(`parse-with-worker unknown message ${s}`)}}function ag(e,t,s){if(e.byteLength<=t+s)return"";const i=new DataView(e);let r="";for(let e=0;e<s;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}function lg(e){try{return JSON.parse(e)}catch(t){throw new Error(`Failed to parse JSON from data starting with "${function(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return ag(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer)return ag(e,0,t);return""}(e)}"`)}}function cg(...e){return function(e){const t=e.map((e=>e instanceof ArrayBuffer?new Uint8Array(e):e)),s=t.reduce(((e,t)=>e+t.byteLength),0),i=new Uint8Array(s);let r=0;for(const e of t)i.set(e,r),r+=e.byteLength;return i.buffer}(e)}function hg(e,t,s){const i=void 0!==s?new Uint8Array(e).subarray(t,t+s):new Uint8Array(e).subarray(t);return new Uint8Array(i).buffer}function ug(e,t){return gf(e>=0),gf(t>0),e+(t-1)&~(t-1)}function dg(e,t,s){let i;if(e instanceof ArrayBuffer)i=new Uint8Array(e);else{const t=e.byteOffset,s=e.byteLength;i=new Uint8Array(e.buffer||e.arrayBuffer,t,s)}return t.set(i,s),s+ug(i.byteLength,4)}const pg={};function fg(e){if((t=e)&&"object"==typeof t&&t.isBuffer)return e;var t;if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e){const t=e;return(new TextEncoder).encode(t).buffer}if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}function gg(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}const mg=e=>"function"==typeof e,_g=e=>null!==e&&"object"==typeof e,bg=e=>_g(e)&&e.constructor==={}.constructor,Bg=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,yg=e=>"undefined"!=typeof Blob&&e instanceof Blob,wg=e=>(e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||_g(e)&&mg(e.tee)&&mg(e.cancel)&&mg(e.getReader))(e)||(e=>_g(e)&&mg(e.read)&&mg(e.pipe)&&(e=>"boolean"==typeof e)(e.readable))(e);class vg extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}const Cg=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,Mg=/^([-\w.]+\/[-\w.+]+)/;function Eg(e,t){return e.toLowerCase()===t.toLowerCase()}function Fg(e){const t=Cg.exec(e);return t?t[1]:""}const xg=/\?.*/;function Ug(e){return e.replace(xg,"")}function Ig(e){if(Bg(e)){return e.url}if(yg(e)){return e.name||""}return"string"==typeof e?e:""}function Tg(e){if(Bg(e)){const t=e,s=t.headers.get("content-type")||"",i=Ug(t.url);return function(e){const t=Mg.exec(e);return t?t[1]:e}(s)||Fg(i)}if(yg(e)){return e.type||""}return"string"==typeof e?Fg(e):""}async function Pg(e){if(Bg(e))return e;const t={},s=function(e){if(Bg(e))return e.headers["content-length"]||-1;if(yg(e))return e.size;return"string"==typeof e?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}(e);s>=0&&(t["content-length"]=String(s));const i=Ig(e),r=Tg(e);r&&(t["content-type"]=r);const n=await async function(e){const t=5;if("string"==typeof e)return`data:,${e.slice(0,t)}`;if(e instanceof Blob){const t=e.slice(0,5);return await new Promise((e=>{const s=new FileReader;s.onload=t=>e(t?.target?.result),s.readAsDataURL(t)}))}if(e instanceof ArrayBuffer){const s=function(e){let t="";const s=new Uint8Array(e);for(let e=0;e<s.byteLength;e++)t+=String.fromCharCode(s[e]);return btoa(t)}(e.slice(0,t));return`data:base64,${s}`}return null}(e);n&&(t["x-first-bytes"]=n),"string"==typeof e&&(e=(new TextEncoder).encode(e));const A=new Response(e,{headers:t});return Object.defineProperty(A,"url",{value:i}),A}async function Sg(e){if(!e.ok){const t=await async function(e){const t=function(e){if(e.length<50)return e;const t=e.slice(e.length-15);return`${e.substr(0,32)}...${t}`}(e.url);let s=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;s=s.length>100?`${s.slice(0,100)}...`:s;const i={reason:e.statusText,url:e.url,response:e};try{const t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(e){}return new vg(s,i)}(e);throw t}}async function Dg(e,t){if("string"==typeof e){const s=function(e){for(const t in pg)if(e.startsWith(t)){const s=pg[t];e=e.replace(t,s)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return function(e){return!function(e){return e.startsWith("http:")||e.startsWith("https:")}(e)&&!function(e){return e.startsWith("data:")}(e)}(s)&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(s,t):await fetch(s,t)}return await Pg(e)}const kg=new Pf({id:"loaders.gl"});class Qg{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}const Rg={fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:mf,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},Og={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function Vg(){globalThis.loaders=globalThis.loaders||{};const{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function Lg(){const e=Vg();return e.globalOptions=e.globalOptions||{...Rg},e.globalOptions}function Hg(e,t,s,i){return s=s||[],function(e,t){Ng(e,null,Rg,Og,t);for(const s of t){const i=e&&e[s.id]||{},r=s.options&&s.options[s.id]||{},n=s.deprecatedOptions&&s.deprecatedOptions[s.id]||{};Ng(i,s.id,r,n,t)}}(e,s=Array.isArray(s)?s:[s]),function(e,t,s){const i={...e.options||{}};(function(e,t){t&&!("baseUri"in e)&&(e.baseUri=t)})(i,s),null===i.log&&(i.log=new Qg);return jg(i,Lg()),jg(i,t),i}(t,e,i)}function Ng(e,t,s,i,r){const n=t||"Top level",A=t?`${t}.`:"";for(const o in e){const a=!t&&_g(e[o]),l="baseUri"===o&&!t,c="workerUrl"===o&&t;if(!(o in s)&&!l&&!c)if(o in i)kg.warn(`${n} loader option '${A}${o}' no longer supported, use '${i[o]}'`)();else if(!a){const e=Gg(o,r);kg.warn(`${n} loader option '${A}${o}' not recognized. ${e}`)()}}}function Gg(e,t){const s=e.toLowerCase();let i="";for(const r of t)for(const t in r.options){if(e===t)return`Did you mean '${r.id}.${t}'?`;const n=t.toLowerCase();(s.startsWith(n)||n.startsWith(s))&&(i=i||`Did you mean '${r.id}.${t}'?`)}return i}function jg(e,t){for(const s in t)if(s in t){const i=t[s];bg(i)&&bg(e[s])?e[s]={...e[s],...t[s]}:e[s]=t[s]}}function Wg(e){if(!e)return!1;Array.isArray(e)&&(e=e[0]);return Array.isArray(e?.extensions)}function zg(e){let t;return gf(e,"null loader"),gf(Wg(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e=e[0],e={...e,options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}function Xg(){return(()=>{const e=Vg();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry})()}const Kg=/\.([^.]+)$/;function Zg(e,t=[],s,i){if(!Jg(e))return null;if(t&&!Array.isArray(t))return zg(t);let r=[];t&&(r=r.concat(t)),s?.ignoreRegisteredLoaders||r.push(...Xg()),function(e){for(const t of e)zg(t)}(r);const n=function(e,t,s,i){const r=Ig(e),n=Tg(e),A=Ug(r)||i?.url;let o=null,a="";s?.mimeType&&(o=$g(t,s?.mimeType),a=`match forced by supplied MIME type ${s?.mimeType}`);o=o||function(e,t){const s=t&&Kg.exec(t),i=s&&s[1];return i?function(e,t){t=t.toLowerCase();for(const s of e)for(const e of s.extensions)if(e.toLowerCase()===t)return s;return null}(e,i):null}(t,A),a=a||(o?`matched url ${A}`:""),o=o||$g(t,n),a=a||(o?`matched MIME type ${n}`:""),o=o||function(e,t){if(!t)return null;for(const s of e)if("string"==typeof t){if(qg(t,s))return s}else if(ArrayBuffer.isView(t)){if(em(t.buffer,t.byteOffset,s))return s}else if(t instanceof ArrayBuffer){if(em(t,0,s))return s}return null}(t,e),a=a||(o?`matched initial data ${tm(e)}`:""),s?.fallbackMimeType&&(o=o||$g(t,s?.fallbackMimeType),a=a||(o?`matched fallback MIME type ${n}`:""));a&&Rf.log(1,`selectLoader selected ${o?.name}: ${a}.`);return o}(e,r,s,i);if(!n&&!s?.nothrow)throw new Error(Yg(e));return n}function Jg(e){return!(e instanceof Response&&204===e.status)}function Yg(e){const t=Ig(e),s=Tg(e);let i="No valid loader found (";i+=t?`${gg(t)}, `:"no url provided, ",i+=`MIME type: ${s?`"${s}"`:"not provided"}, `;const r=e?tm(e):"";return i+=r?` first bytes: "${r}"`:"first bytes: not available",i+=")",i}function $g(e,t){for(const s of e){if(s.mimeTypes?.some((e=>Eg(t,e))))return s;if(Eg(t,`application/x.${s.id}`))return s}return null}function qg(e,t){if(t.testText)return t.testText(e);return(Array.isArray(t.tests)?t.tests:[t.tests]).some((t=>e.startsWith(t)))}function em(e,t,s){return(Array.isArray(s.tests)?s.tests:[s.tests]).some((s=>function(e,t,s,i){if(i instanceof ArrayBuffer)return function(e,t,s){if(s=s||e.byteLength,e.byteLength<s||t.byteLength<s)return!1;const i=new Uint8Array(e),r=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==r[e])return!1;return!0}(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":return i===sm(e,t,i.length);default:return!1}}(e,t,0,s)))}function tm(e,t=5){if("string"==typeof e)return e.slice(0,t);if(ArrayBuffer.isView(e))return sm(e.buffer,e.byteOffset,t);if(e instanceof ArrayBuffer){return sm(e,0,t)}return""}function sm(e,t,s){if(e.byteLength<t+s)return"";const i=new DataView(e);let r="";for(let e=0;e<s;e++)r+=String.fromCharCode(i.getUint8(t+e));return r}const im=262144;function rm(e,t){return mf?async function*(e,t){const s=e.getReader();let i;try{for(;;){const e=i||s.read();t?._streamReadAhead&&(i=s.read());const{done:r,value:n}=await e;if(r)return;yield fg(n)}}catch(e){s.releaseLock()}}(e,t):async function*(e,t){for await(const t of e)yield fg(t)}(e)}function nm(e,t){if("string"==typeof e)return function*(e,t){const s=t?.chunkSize||262144;let i=0;const r=new TextEncoder;for(;i<e.length;){const t=Math.min(e.length-i,s),n=e.slice(i,i+t);i+=t,yield r.encode(n)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){const{chunkSize:s=im}=t;let i=0;for(;i<e.byteLength;){const t=Math.min(e.byteLength-i,s),r=new ArrayBuffer(t),n=new Uint8Array(e,i,t);new Uint8Array(r).set(n),i+=t,yield r}}(e,t);if(yg(e))return async function*(e,t){const s=t?.chunkSize||1048576;let i=0;for(;i<e.size;){const t=i+s,r=await e.slice(i,t).arrayBuffer();i=t,yield r}}(e,t);if(wg(e))return rm(e,t);if(Bg(e)){return rm(e.body,t)}throw new Error("makeIterator")}const Am="Cannot convert supplied data type";async function om(e,t,s){const i=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||i)return function(e,t,s){if(t.text&&"string"==typeof e)return e;var i;if((i=e)&&"object"==typeof i&&i.isBuffer&&(e=e.buffer),e instanceof ArrayBuffer){const s=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(s):s}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let s=e.buffer;const i=e.byteLength||e.length;return 0===e.byteOffset&&i===s.byteLength||(s=s.slice(e.byteOffset,e.byteOffset+i)),s}throw new Error(Am)}(e,t);if(yg(e)&&(e=await Pg(e)),Bg(e)){const s=e;return await Sg(s),t.binary?await s.arrayBuffer():await s.text()}if(wg(e)&&(e=nm(e,s)),r=e,Boolean(r)&&"function"==typeof r[Symbol.iterator]||(e=>e&&"function"==typeof e[Symbol.asyncIterator])(e))return async function(e){const t=[];for await(const s of e)t.push(s);return cg(...t)}(e);var r;throw new Error(Am)}function am(e,t){const s=Lg(),i=e||s;return"function"==typeof i.fetch?i.fetch:_g(i.fetch)?e=>Dg(e,i.fetch):t?.fetch?t?.fetch:Dg}function lm(e,t,s){if(s)return s;const i={fetch:am(t,e),...e};if(i.url){const e=Ug(i.url);i.baseUrl=e,i.queryString=function(e){const t=e.match(xg);return t&&t[0]}(i.url),i.filename=gg(e),i.baseUrl=function(e){const t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}async function cm(e,t,s,i){!t||Array.isArray(t)||Wg(t)||(i=void 0,s=t,t=void 0),s=s||{};const r=Ig(e=await e),n=function(e,t){if(e&&!Array.isArray(e))return e;let s;if(e&&(s=Array.isArray(e)?e:[e]),t&&t.loaders){const e=Array.isArray(t.loaders)?t.loaders:[t.loaders];s=s?[...s,...e]:e}return s&&s.length?s:void 0}(t,i),A=await async function(e,t=[],s,i){if(!Jg(e))return null;let r=Zg(e,t,{...s,nothrow:!0},i);if(r)return r;if(yg(e)&&(r=Zg(e=await e.slice(0,10).arrayBuffer(),t,s,i)),!r&&!s?.nothrow)throw new Error(Yg(e));return r}(e,n,s);return A?(i=lm({url:r,_parse:cm,loaders:n},s=Hg(s,A,n,r),i||null),await async function(e,t,s,i){if(function(e,t=Lf){Hf(e,"no worker provided");const s=e.version}(e),s=Of(e.options,s),Bg(t)){const e=t,{ok:s,redirected:r,status:n,statusText:A,type:o,url:a}=e,l=Object.fromEntries(e.headers.entries());i.response={headers:l,ok:s,redirected:r,status:n,statusText:A,type:o,url:a}}t=await om(t,e,s);const r=e;if(r.parseTextSync&&"string"==typeof t)return r.parseTextSync(t,s,i);if(function(e,t){return!!ig.isSupported()&&!(!Nf&&!t?._nodeWorkers)&&e.worker&&t?.worker}(e,s))return await Ag(e,t,s,i,cm);if(r.parseText&&"string"==typeof t)return await r.parseText(t,s,i);if(r.parse)return await r.parse(t,s,i);throw Hf(!r.parseSync),new Error(`${e.id} loader - no parser found and worker is disabled`)}(A,e,s,i)):null}function hm(e){let t=1/0,s=1/0,i=1/0,r=-1/0,n=-1/0,A=-1/0;const o=e.POSITION?e.POSITION.value:[],a=o&&o.length;for(let e=0;e<a;e+=3){const a=o[e],l=o[e+1],c=o[e+2];t=a<t?a:t,s=l<s?l:s,i=c<i?c:i,r=a>r?a:r,n=l>n?l:n,A=c>A?c:A}return[[t,s,i],[r,n,A]]}function um(e,t={}){const s=function(e){const t=[];for(const s in e){const i=e[s];t.push(dm(s,i))}return t}(e);return{fields:s,metadata:t}}function dm(e,t,s){const i=function(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(t.value),r=s||function(e){const t={};"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10));"byteStride"in e&&(t.byteStride=e.byteStride.toString(10));"normalized"in e&&(t.normalized=e.normalized.toString());return t}(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:i}]},nullable:!1,metadata:r}}const pm=globalThis.loaders?.parseImageNode,fm="undefined"!=typeof Image,gm="undefined"!=typeof ImageBitmap,mm=Boolean(pm),_m=!!mf||mm;function bm(e){const t=function(e){if("undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap)return"imagebitmap";if("undefined"!=typeof Image&&e instanceof Image)return"image";if(e&&"object"==typeof e&&e.data&&e.width&&e.height)return"data";return null}(e);if(!t)throw new Error("Not an image");return t}function Bm(e){switch(bm(e)){case"data":return e;case"image":case"imagebitmap":const t=document.createElement("canvas"),s=t.getContext("2d");if(!s)throw new Error("getImageData");return t.width=e.width,t.height=e.height,s.drawImage(e,0,0),s.getImageData(0,0,e.width,e.height);default:throw new Error("getImageData")}}const ym=/^data:image\/svg\+xml/,wm=/\.svg((\?|#).*)?$/;function vm(e){return e&&(ym.test(e)||wm.test(e))}function Cm(e,t){if(vm(t))throw new Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function Mm(e,t,s){const i=function(e,t){if(vm(t)){let t=(new TextDecoder).decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw new Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return Cm(e,t)}(e,s),r=self.URL||self.webkitURL,n="string"!=typeof i&&r.createObjectURL(i);try{return await async function(e,t){const s=new Image;if(s.src=e,t.image&&t.image.decode&&s.decode)return await s.decode(),s;return await new Promise(((e,t)=>{try{s.onload=()=>e(s),s.onerror=e=>{const s=e instanceof Error?e.message:"error";t(new Error(s))}}catch(e){t(e)}}))}(n||i,t)}finally{n&&r.revokeObjectURL(n)}}const Em={};let Fm=!0;async function xm(e,t,s){let i;if(vm(s)){i=await Mm(e,t,s)}else i=Cm(e,s);const r=t&&t.imagebitmap;return await async function(e,t=null){!function(e){for(const t in e||Em)return!1;return!0}(t)&&Fm||(t=null);if(t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),Fm=!1}return await createImageBitmap(e)}(i,r)}function Um(e){return function(e,t,s=0){const i=(r=t,[...r].map((e=>e.charCodeAt(0))));var r;for(let t=0;t<i.length;++t)if(i[t]!==e[t+s])return!1;return!0}(e,"ftyp",4)?0==(96&e[8])?null:function(e){switch((t=e,s=8,i=12,String.fromCharCode(...t.slice(s,i))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}var t,s,i}(e):null}function Im(e){const t=Tm(e);return function(e){const t=Tm(e);if(!(t.byteLength>=24&&2303741511===t.getUint32(0,false)))return null;return{mimeType:"image/png",width:t.getUint32(16,false),height:t.getUint32(20,false)}}(t)||function(e){const t=Tm(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,false)&&255===t.getUint8(2)))return null;const{tableMarkers:s,sofMarkers:i}=function(){const e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);const t=new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502]);return{tableMarkers:e,sofMarkers:t}}();let r=2;for(;r+9<t.byteLength;){const e=t.getUint16(r,false);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(r+5,false),width:t.getUint16(r+7,false)};if(!s.has(e))return null;r+=2,r+=t.getUint16(r,false)}return null}(t)||function(e){const t=Tm(e);if(!(t.byteLength>=10&&1195984440===t.getUint32(0,false)))return null;return{mimeType:"image/gif",width:t.getUint16(6,true),height:t.getUint16(8,true)}}(t)||function(e){const t=Tm(e);if(!(t.byteLength>=14&&16973===t.getUint16(0,false)&&t.getUint32(2,true)===t.byteLength))return null;return{mimeType:"image/bmp",width:t.getUint32(18,true),height:t.getUint32(22,true)}}(t)||function(e){const t=Um(new Uint8Array(e instanceof DataView?e.buffer:e));if(!t)return null;return{mimeType:t.mimeType,width:0,height:0}}(t)}function Tm(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw new Error("toDataView")}const Pm={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.2",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function(e,t,s){const i=((t=t||{}).image||{}).type||"auto",{url:r}=s||{};let n;switch(function(e){switch(e){case"auto":case"data":return function(){if(gm)return"imagebitmap";if(fm)return"image";if(_m)return"data";throw new Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return function(e){switch(e){case"auto":return gm||fm||_m;case"imagebitmap":return gm;case"image":return fm;case"data":return _m;default:throw new Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(i)){case"imagebitmap":n=await xm(e,t,r);break;case"image":n=await Mm(e,t,r);break;case"data":n=await async function(e,t){const{mimeType:s}=Im(e)||{},i=globalThis.loaders?.parseImageNode;return gf(i),await i(e,s)}(e);break;default:gf(!1)}return"data"===i&&(n=Bm(n)),n},tests:[e=>Boolean(Im(new DataView(e)))],options:{image:{type:"auto",decode:!0}}},Sm={};function Dm(e){if(void 0===Sm[e]){const t=mf?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{const t=document.createElement("canvas");return 0===t.toDataURL(e).indexOf(`data:${e}`)}catch{return!1}}(e);default:return!0}}(e):function(e){const t=["image/png","image/jpeg","image/gif"],s=globalThis.loaders?.imageFormatsNode||t,i=globalThis.loaders?.parseImageNode;return Boolean(i)&&s.includes(e)}(e);Sm[e]=t}return Sm[e]}function km(e,t){if(!e)throw new Error(t||"assert failed: gltf")}const Qm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Rm={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Om=["SCALAR","VEC2","VEC3","VEC4"],Vm=[[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]],Lm=new Map(Vm),Hm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Nm={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},Gm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function jm(e){return Om[e-1]||Om[0]}function Wm(e){const t=Lm.get(e.constructor);if(!t)throw new Error("Illegal typed array");return t}function zm(e,t){const s=Gm[e.componentType],i=Hm[e.type],r=Nm[e.componentType],n=e.count*i,A=e.count*i*r;km(A>=0&&A<=t.byteLength);return{ArrayType:s,length:n,byteLength:A,componentByteSize:Rm[e.componentType],numberOfComponentsInElement:Qm[e.type]}}class Xm{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),s=this.getRequiredExtensions().find((t=>t===e));return"string"==typeof t||"string"==typeof s}getExtension(e){const t=this.getUsedExtensions().find((t=>t===e)),s=this.json.extensions||{};return t?s[e]:null}getRequiredExtension(e){const t=this.getRequiredExtensions().find((t=>t===e));return t?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;const s=this.json[e]&&this.json[e][t];if(!s)throw new Error(`glTF file error: Could not find ${e}[${t}]`);return s}getTypedArrayForBufferView(e){const t=(e=this.getBufferView(e)).buffer,s=this.gltf.buffers[t];km(s);const i=(e.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){const t=this.getAccessor(e);return function(e,t,s){const i="number"==typeof s?e.accessors?.[s]:s;if(!i)throw new Error(`No gltf accessor ${JSON.stringify(s)}`);const r=e.bufferViews?.[i.bufferView||0];if(!r)throw new Error(`No gltf buffer view for accessor ${r}`);const{arrayBuffer:n,byteOffset:A}=t[r.buffer],o=(A||0)+(i.byteOffset||0)+(r.byteOffset||0),{ArrayType:a,length:l,componentByteSize:c,numberOfComponentsInElement:h}=zm(i,r),u=c*h,d=r.byteStride||u;if(void 0===r.byteStride||r.byteStride===u)return new a(n,o,l);const p=new a(l);for(let e=0;e<i.count;e++){const t=new a(n,o+e*d,h);p.set(t,e*h)}return p}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);const t=this.getBufferView(e.bufferView),s=this.getBuffer(t.buffer).data,i=t.byteOffset||0;return new Uint8Array(s,i,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,s){return e.extensions=e.extensions||{},e.extensions[t]=s,this.registerUsedExtension(t),this}setObjectExtension(e,t,s){(e.extensions||{})[t]=s}removeObjectExtension(e,t){const s=e?.extensions||{};if(s[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}delete s[t]}addExtension(e,t={}){return km(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return km(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find((t=>t===e))||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find((t=>t===e))||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];const t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){const{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){const{meshIndex:t,matrix:s}=e;this.json.nodes=this.json.nodes||[];const i={mesh:t};return s&&(i.matrix=s),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){const{attributes:t,indices:s,material:i,mode:r=4}=e,n={primitives:[{attributes:this._addAttributes(t),mode:r}]};if(s){const e=this._addIndices(s);n.primitives[0].indices=e}return Number.isFinite(i)&&(n.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(e){const t={primitives:[{attributes:this._addAttributes(e),mode:0}]};return this.json.meshes=this.json.meshes||[],this.json.meshes.push(t),this.json.meshes.length-1}addImage(e,t){const s=Im(e),i=t||s?.mimeType,r={bufferView:this.addBufferView(e),mimeType:i};return this.json.images=this.json.images||[],this.json.images.push(r),this.json.images.length-1}addBufferView(e,t=0,s=this.byteLength){const i=e.byteLength;km(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e);const r={buffer:t,byteOffset:s,byteLength:i};return this.byteLength+=ug(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push(r),this.json.bufferViews.length-1}addAccessor(e,t){const s={bufferView:e,type:jm(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(s),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){const s=this.addBufferView(e);let i={min:t.min,max:t.max};i.min&&i.max||(i=this._getAccessorMinMax(e,t.size));const r={size:t.size,componentType:Wm(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(s,Object.assign(r,t))}addTexture(e){const{imageIndex:t}=e,s={source:t};return this.json.textures=this.json.textures||[],this.json.textures.push(s),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){const e=this.byteLength,t=new ArrayBuffer(e),s=new Uint8Array(t);let i=0;for(const e of this.sourceBuffers||[])i=dg(e,s,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let s=!0;for(;s;){const i=e.indexOf(t);i>-1?e.splice(i,1):s=!1}}_addAttributes(e={}){const t={};for(const s in e){const i=e[s],r=this._getGltfAttributeName(s),n=this.addBinaryBuffer(i.value,i);t[r]=n}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){const s={min:null,max:null};if(e.length<t)return s;s.min=[],s.max=[];const i=e.subarray(0,t);for(const e of i)s.min.push(e),s.max.push(e);for(let i=t;i<e.length;i+=t)for(let r=0;r<t;r++)s.min[0+r]=Math.min(s.min[0+r],e[i+r]),s.max[0+r]=Math.max(s.max[0+r],e[i+r]);return s}}function Km(e){return(e%1+1)%1}const Zm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},Jm={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},Ym={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function $m(e,t){return Ym[t]*Zm[e]}function qm(e,t,s,i){if("UINT8"!==s&&"UINT16"!==s&&"UINT32"!==s&&"UINT64"!==s)return null;const r=e_(e.getTypedArrayForBufferView(t),"SCALAR",s,i+1);return r instanceof BigInt64Array||r instanceof BigUint64Array?null:r}function e_(e,t,s,i=1){const r=Jm[s],n=Ym[s],A=i*Zm[t],o=A*n;let a=e.buffer,l=e.byteOffset;if(l%n!=0){a=new Uint8Array(a).slice(l,l+o).buffer,l=0}return new r(a,l,A)}function t_(e,t,s){const i=`TEXCOORD_${t.texCoord||0}`,r=s.attributes[i],n=e.getTypedArrayForAccessor(r),A=e.gltf.json,o=t.index,a=A.textures?.[o]?.source;if(void 0!==a){const s=A.images?.[a]?.mimeType,i=e.gltf.images?.[a];if(i&&void 0!==i.width){const e=[];for(let r=0;r<n.length;r+=2){const A=i_(i,s,n,r,t.channels);e.push(A)}return e}}return[]}function s_(e,t,s,i,r){if(!s?.length)return;const n=[];for(const e of s){let t=i.findIndex((t=>t===e));-1===t&&(t=i.push(e)-1),n.push(t)}const A=new Uint32Array(n),o=e.gltf.buffers.push({arrayBuffer:A.buffer,byteOffset:A.byteOffset,byteLength:A.byteLength})-1,a=e.addBufferView(A,o,0),l=e.addAccessor(a,{size:1,componentType:Wm(A),count:A.length});r.attributes[t]=l}function i_(e,t,s,i,r=[0]){const n={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},A=s[i],o=s[i+1];let a=1;!t||-1===t.indexOf("image/jpeg")&&-1===t.indexOf("image/png")||(a=4);const l=function(e,t,s,i=1){const r=s.width,n=Km(e)*(r-1),A=Math.round(n),o=s.height,a=Km(t)*(o-1),l=Math.round(a),c=s.components?s.components:i;return(l*r+A)*c}(A,o,e,a);let c=0;for(const t of r){const s="number"==typeof t?Object.values(n)[t]:n[t],i=l+s.offset,r=Bm(e);if(r.data.length<=i)throw new Error(`${r.data.length} <= ${i}`);c|=r.data[i]<<s.shift}return c}function r_(e,t,s,i,r){const n=[];for(let A=0;A<t;A++){const t=s[A],o=s[A+1]-s[A];if(o+t>i)break;const a=t/r,l=o/r;n.push(e.slice(a,a+l))}return n}function n_(e,t,s){const i=[];for(let r=0;r<t;r++){const t=r*s;i.push(e.slice(t,t+s))}return i}function A_(e,t,s,i){if(s)throw new Error("Not implemented - arrayOffsets for strings is specified");if(i){const s=[],r=new TextDecoder("utf8");let n=0;for(let A=0;A<e;A++){const e=i[A+1]-i[A];if(e+n<=t.length){const i=t.subarray(n,e+n),A=r.decode(i);s.push(A),n+=e}}return s}return[]}function o_(e,t,s){if(!s?.gltf?.loadBuffers)return;const i=t.extensions?.EXT_mesh_features,r=i?.featureIds;if(r)for(const i of r){let r;if(void 0!==i.attribute){const s=`_FEATURE_ID_${i.attribute}`,n=t.attributes[s];r=e.getTypedArrayForAccessor(n)}else r=void 0!==i.texture&&s?.gltf?.loadImages?t_(e,i.texture,t):[];i.data=r}}function a_(e,t){const s=t.extensions?.EXT_mesh_features;if(!s)return;const i=s.featureIds;i.forEach(((s,r)=>{if(s.data){const{accessorKey:n,index:A}=function(e){const t="_FEATURE_ID_",s=Object.keys(e).filter((e=>0===e.indexOf(t)));let i=-1;for(const e of s){const s=Number(e.substring(t.length));s>i&&(i=s)}i++;return{accessorKey:`${t}${i}`,index:i}}(t.attributes),o=new Uint32Array(s.data);i[r]={featureCount:o.length,propertyTable:s.propertyTable,attribute:A},e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength});const a=e.addBufferView(o),l=e.addAccessor(a,{size:1,componentType:Wm(o),count:o.length});t.attributes[n]=l}}))}var l_=Object.freeze({__proto__:null,name:"EXT_mesh_features",decode:async function(e,t){!function(e,t){const s=e.gltf.json;if(!s.meshes)return;for(const i of s.meshes)for(const s of i.primitives)o_(e,s,t)}(new Xm(e),t)},encode:function(e,t){const s=new Xm(e);return function(e,t){const s=e.gltf.json.meshes;if(!s)return;for(const t of s)for(const s of t.primitives)a_(e,s)}(s),s.createBinaryChunk(),s.gltf},createExtMeshFeatures:function(e,t,s,i){t.extensions||(t.extensions={});let r=t.extensions.EXT_mesh_features;r||(r={featureIds:[]},t.extensions.EXT_mesh_features=r);const{featureIds:n}=r,A={featureCount:s.length,propertyTable:i,data:s};n.push(A),e.addObjectExtension(t,"EXT_mesh_features",r)}});function c_(e,t){for(const s of e)if(s.class===t)return s;return null}function h_(e,t,s,i){if(!t)return;const r=s.extensions?.EXT_structural_metadata,n=r?.propertyTextures;if(n)for(const r of n){u_(e,t[r],s,i)}}function u_(e,t,s,i){if(!t.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);const r=t.class;for(const n in t.properties){const A=`${r}_${n}`,o=t.properties?.[n];if(!o)continue;o.data||(o.data=[]);const a=o.data,l=t_(e,o,s);null!==l&&(s_(e,A,l,a,s),o.data=a,i.dataAttributeNames.push(A))}}function d_(e,t,s){const i=t.classes?.[s.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${s.class}`);const r=s.count;for(const n in i.properties){const A=i.properties[n],o=s.properties?.[n];if(o){const s=p_(e,t,A,r,o);o.data=s}}}function p_(e,t,s,i,r){let n=[];const A=r.values,o=e.getTypedArrayForBufferView(A),a=function(e,t,s,i){if(t.array&&void 0===t.count&&void 0!==s.arrayOffsets)return qm(e,s.arrayOffsets,s.arrayOffsetType||"UINT32",i);return null}(e,s,r,i),l=function(e,t,s){if(void 0!==t.stringOffsets)return qm(e,t.stringOffsets,t.stringOffsetType||"UINT32",s);return null}(e,r,i);switch(s.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":n=function(e,t,s,i){const r=e.array,n=e.count,A=$m(e.type,e.componentType),o=s.byteLength/A;let a;a=e.componentType?e_(s,e.type,e.componentType,o):s;if(r)return i?r_(a,t,i,s.length,A):n?n_(a,t,n):[];return a}(s,i,o,a);break;case"BOOLEAN":throw new Error(`Not implemented - classProperty.type=${s.type}`);case"STRING":n=A_(i,o,a,l);break;case"ENUM":n=function(e,t,s,i,r){const n=t.enumType;if(!n)throw new Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");const A=e.enums?.[n];if(!A)throw new Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${n}`);const o=A.valueType||"UINT16",a=$m(t.type,o),l=i.byteLength/a;let c=e_(i,t.type,o,l);c||(c=i);if(t.array){if(r)return function(e){const{valuesData:t,numberOfElements:s,arrayOffsets:i,valuesDataBytesLength:r,elementSize:n,enumEntry:A}=e,o=[];for(let e=0;e<s;e++){const s=i[e],a=i[e+1]-i[e];if(a+s>r)break;const l=f_(t,s/n,a/n,A);o.push(l)}return o}({valuesData:c,numberOfElements:s,arrayOffsets:r,valuesDataBytesLength:i.length,elementSize:a,enumEntry:A});const e=t.count;return e?function(e,t,s,i){const r=[];for(let n=0;n<t;n++){const t=f_(e,s*n,s,i);r.push(t)}return r}(c,s,e,A):[]}return f_(c,0,s,A)}(t,s,i,o,a);break;default:throw new Error(`Unknown classProperty type ${s.type}`)}return n}function f_(e,t,s,i){const r=[];for(let n=0;n<s;n++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)r.push("");else{const s=g_(i,e[t+n]);s?r.push(s.name):r.push("")}return r}function g_(e,t){for(const s of e.values)if(s.value===t)return s;return null}function m_(e,t,s){for(const i in e.properties){const r=e.properties[i].data;if(r){const n=t.properties[i];if(n){const t=__(r,n,s);e.properties[i]=t}}}}function __(e,t,s){const i={values:0};if("STRING"===t.type){const{stringData:t,stringOffsets:r}=function(e){const t=new TextEncoder,s=[];let i=0;for(const r of e){const e=t.encode(r);i+=e.length,s.push(e)}const r=new Uint8Array(i),n=[];let A=0;for(const e of s)r.set(e,A),n.push(A),A+=e.length;n.push(A);const o=new Uint32Array(n);return{stringData:r,stringOffsets:o}}(e);i.stringOffsets=B_(r,s),i.values=B_(t,s)}else if("SCALAR"===t.type&&t.componentType){const r=function(e,t){const s=[];for(const t of e)s.push(Number(t));const i=b_[t];if(!i)throw new Error("Illegal component type");return new i(s)}(e,t.componentType);i.values=B_(r,s)}return i}const b_={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function B_(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}var y_=Object.freeze({__proto__:null,name:"EXT_structural_metadata",decode:async function(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;const s=e.getExtension("EXT_structural_metadata");if(!s)return;t.gltf?.loadImages&&function(e,t){const s=t.propertyTextures,i=e.gltf.json;if(s&&i.meshes)for(const r of i.meshes)for(const i of r.primitives)h_(e,s,i,t)}(e,s);!function(e,t){const s=t.schema;if(!s)return;const i=s.classes,r=t.propertyTables;if(i&&r)for(const t in i){const i=c_(r,t);i&&d_(e,s,i)}}(e,s)}(new Xm(e),t)},encode:function(e,t){const s=new Xm(e);return function(e,t){const s=e.getExtension("EXT_structural_metadata");if(!s)return;if(s.propertyTables)for(const t of s.propertyTables){const i=t.class,r=s.schema?.classes?.[i];t.properties&&r&&m_(t,r,e)}}(s),s.createBinaryChunk(),s.gltf},createExtStructuralMetadata:function(e,t,s="schemaClassId"){let i=e.getExtension("EXT_structural_metadata");i||(i=e.addExtension("EXT_structural_metadata")),i.schema=function(e,t,s){const i=s??{id:"schema_id"},r={properties:{}};for(const t of e){const e={type:t.elementType,componentType:t.componentType};r.properties[t.name]=e}return i.classes={},i.classes[t]=r,i}(t,s,i.schema);const r=function(e,t,s){const i={class:t,count:0};let r=0;const n=s.classes?.[t];for(const t of e){if(0===r&&(r=t.values.length),r!==t.values.length&&t.values.length)throw new Error("Illegal values in attributes");const e=n?.properties[t.name];e&&(i.properties||(i.properties={}),i.properties[t.name]={values:0,data:t.values})}return i.count=r,i}(t,s,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(r)-1}});function w_(e,t){for(const s in e){const i=e[s];if(i.class===t)return i}return null}function v_(e,t){for(const s in e){const i=e[s];if(i.class===t)return i}return null}function C_(e,t,s){if(!s.class)return;const i=t.classes?.[s.class];if(!i)throw new Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${s.class}`);const r=s.count;for(const n in i.properties){const A=i.properties[n],o=s.properties?.[n];if(o){const s=E_(e,t,A,r,o);o.data=s}}}function M_(e,t,s){const i=t.class;for(const r in s.properties){const s=t?.properties?.[r];if(s){const t=F_(e,s,i);s.data=t}}}function E_(e,t,s,i,r){let n=[];const A=r.bufferView,o=e.getTypedArrayForBufferView(A),a=function(e,t,s,i){if("ARRAY"===t.type&&void 0===t.componentCount&&void 0!==s.arrayOffsetBufferView)return qm(e,s.arrayOffsetBufferView,s.offsetType||"UINT32",i);return null}(e,s,r,i),l=function(e,t,s,i){if(void 0!==s.stringOffsetBufferView)return qm(e,s.stringOffsetBufferView,s.offsetType||"UINT32",i);return null}(e,0,r,i);return"STRING"===s.type||"STRING"===s.componentType?n=A_(i,o,a,l):function(e){const t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||void 0!==e.componentType&&t.includes(e.componentType)}(s)&&(n=function(e,t,s,i){const r="ARRAY"===e.type,n=e.componentCount,A="SCALAR",o=e.componentType||e.type,a=$m(A,o),l=s.byteLength/a,c=e_(s,A,o,l);if(r)return i?r_(c,t,i,s.length,a):n?n_(c,t,n):[];return c}(s,i,o,a)),n}function F_(e,t,s){const i=e.gltf.json;if(!i.meshes)return[];const r=[];for(const n of i.meshes)for(const i of n.primitives)x_(e,s,t,r,i);return r}function x_(e,t,s,i,r){const n=t_(e,{channels:s.channels,...s.texture},r);n&&s_(e,t,n,i,r)}var U_=Object.freeze({__proto__:null,name:"EXT_feature_metadata",decode:async function(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;const s=e.getExtension("EXT_feature_metadata");if(!s)return;t.gltf?.loadImages&&function(e,t){const s=t.schema;if(!s)return;const i=s.classes,{featureTextures:r}=t;if(i&&r)for(const t in i){const s=i[t],n=v_(r,t);n&&M_(e,n,s)}}(e,s);!function(e,t){const s=t.schema;if(!s)return;const i=s.classes,r=t.featureTables;if(i&&r)for(const t in i){const i=w_(r,t);i&&C_(e,s,i)}}(e,s)}(new Xm(e),t)}});const I_="basis_transcoder.js",T_="basis_transcoder.wasm",P_="basis_encoder.js",S_="basis_encoder.wasm";let D_,k_;async function Q_(e){var t;t=e.modules,globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t);const s=function(e){const t=globalThis.loaders?.modules?.[e];return t||null}("basis");return s||(D_||=async function(e){let t=null,s=null;return[t,s]=await Promise.all([await ng(I_,"textures",e),await ng(T_,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const s={};t&&(s.wasmBinary=t);return new Promise((t=>{e(s).then((e=>{const{BasisFile:s,initializeBasis:i}=e;i(),t({BasisFile:s})}))}))}(t,s)}(e),await D_)}async function R_(e){const t=e.modules||{};return t.basisEncoder?t.basisEncoder:(k_=k_||async function(e){let t=null,s=null;return[t,s]=await Promise.all([await ng(P_,"textures",e),await ng(S_,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){const s={};t&&(s.wasmBinary=t);return new Promise((t=>{e(s).then((e=>{const{BasisFile:s,KTX2File:i,initializeBasis:r,BasisEncoder:n}=e;r(),t({BasisFile:s,KTX2File:i,BasisEncoder:n})}))}))}(t,s)}(e),await k_)}const O_=["","WEBKIT_","MOZ_"],V_={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"};let L_=null;function H_(e){if(!L_){e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,L_=new Set;for(const t of O_)for(const s in V_)if(e&&e.getExtension(`${t}${s}`)){const e=V_[s];L_.add(e)}}return L_}const N_=[171,75,84,88,32,50,48,187,13,10,26,10];const G_={etc1:{basisFormat:0,compressed:!0,format:36196},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:33776},bc3:{basisFormat:3,compressed:!0,format:33779},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:35840},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:35842},"astc-4x4":{basisFormat:10,compressed:!0,format:37808},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function j_(e,t,s){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("Failed to start basis transcoding");const e=i.getNumImages(),t=[];for(let r=0;r<e;r++){const e=i.getNumLevels(r),n=[];for(let t=0;t<e;t++)n.push(W_(i,r,t,s));t.push(n)}return t}finally{i.close(),i.delete()}}function W_(e,t,s,i){const r=e.getImageWidth(t,s),n=e.getImageHeight(t,s),A=e.getHasAlpha(),{compressed:o,format:a,basisFormat:l}=K_(i,A),c=e.getImageTranscodedSizeInBytes(t,s,l),h=new Uint8Array(c);if(!e.transcodeImage(h,t,s,l,0,0))throw new Error("failed to start Basis transcoding");return{width:r,height:n,data:h,compressed:o,format:a,hasAlpha:A}}function z_(e,t,s){const i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw new Error("failed to start KTX2 transcoding");const e=i.getLevels(),t=[];for(let r=0;r<e;r++)t.push(X_(i,r,s));return[t]}finally{i.close(),i.delete()}}function X_(e,t,s){const{alphaFlag:i,height:r,width:n}=e.getImageLevelInfo(t,0,0),{compressed:A,format:o,basisFormat:a}=K_(s,i),l=e.getImageTranscodedSizeInBytes(t,0,0,a),c=new Uint8Array(l);if(!e.transcodeImage(c,t,0,0,a,0,-1,-1))throw new Error("Failed to transcode KTX2 image");return{width:n,height:r,data:c,compressed:A,levelSize:l,hasAlpha:i,format:o}}function K_(e,t){let s=e&&e.basis&&e.basis.format;return"auto"===s&&(s=Z_()),"object"==typeof s&&(s=t?s.alpha:s.noAlpha),s=s.toLowerCase(),G_[s]}function Z_(){const e=H_();return e.has("astc")?"astc-4x4":e.has("dxt")?{alpha:"bc3",noAlpha:"bc1"}:e.has("pvrtc")?{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"}:e.has("etc1")?"etc1":e.has("etc2")?"etc2":"rgb565"}const J_={...{dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:"4.3.2",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}}},parse:async function(e,t){if("auto"===t.basis.containerFormat){if(function(e){const t=new Uint8Array(e);return!(t.byteLength<N_.length||t[0]!==N_[0]||t[1]!==N_[1]||t[2]!==N_[2]||t[3]!==N_[3]||t[4]!==N_[4]||t[5]!==N_[5]||t[6]!==N_[6]||t[7]!==N_[7]||t[8]!==N_[8]||t[9]!==N_[9]||t[10]!==N_[10]||t[11]!==N_[11])}(e)){return z_((await R_(t)).KTX2File,e,t)}const{BasisFile:s}=await Q_(t);return j_(s,e,t)}if("encoder"===t.basis.module){const s=await R_(t);return"ktx2"===t.basis.containerFormat?z_(s.KTX2File,e,t):j_(s.BasisFile,e,t)}{const{BasisFile:s}=await Q_(t);return j_(s,e,t)}}},Y_=1735152710;function $_(e,t,s=0,i={}){const r=new DataView(t),n=function(e,t=0){return`${String.fromCharCode(e.getUint8(t+0))}${String.fromCharCode(e.getUint8(t+1))}${String.fromCharCode(e.getUint8(t+2))}${String.fromCharCode(e.getUint8(t+3))}`}(r,s+0),A=r.getUint32(s+4,true),o=r.getUint32(s+8,true);switch(Object.assign(e,{header:{byteOffset:s,byteLength:o,hasBinChunk:!1},type:n,version:A,json:{},binChunks:[]}),s+=12,e.version){case 1:return function(e,t,s){gf(e.header.byteLength>20);const i=t.getUint32(s+0,true),r=t.getUint32(s+4,true);return s+=8,gf(0===r),q_(e,t,s,i),s+=i,s+=eb(e,t,s,e.header.byteLength)}(e,r,s);case 2:return function(e,t,s,i){return gf(e.header.byteLength>20),function(e,t,s,i){for(;s+8<=e.header.byteLength;){const r=t.getUint32(s+0,true),n=t.getUint32(s+4,true);switch(s+=8,n){case 1313821514:q_(e,t,s,r);break;case 5130562:eb(e,t,s,r);break;case 0:i.strict||q_(e,t,s,r);break;case 1:i.strict||eb(e,t,s,r)}s+=ug(r,4)}}(e,t,s,i),s+e.header.byteLength}(e,r,s,{});default:throw new Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}function q_(e,t,s,i){const r=new Uint8Array(t.buffer,s,i),n=new TextDecoder("utf8").decode(r);return e.json=JSON.parse(n),ug(i,4)}function eb(e,t,s,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:s,byteLength:i,arrayBuffer:t.buffer}),ug(i,4)}function tb(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;const s=t.baseUri||t.uri;if(!s)throw new Error(`'baseUri' must be provided to resolve relative url ${e}`);return s.substr(0,s.lastIndexOf("/")+1)+e}const sb="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB",ib="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",rb=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),nb=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),Ab={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ob={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function ab(e,t,s,i,r,n="NONE"){const A=await async function(){lb||(lb=async function(){let e=sb;WebAssembly.validate(rb)&&(e=ib,console.log("Warning: meshopt_decoder is using experimental SIMD support"));const t=await WebAssembly.instantiate(function(e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;++s){const i=e.charCodeAt(s);t[s]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let s=0;for(let i=0;i<e.length;++i)t[s++]=t[i]<60?nb[t[i]]:64*(t[i]-60)+t[++i];return t.buffer.slice(0,s)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}());return lb}();!function(e,t,s,i,r,n,A){const o=e.exports.sbrk,a=i+3&-4,l=o(a*r),c=o(n.length),h=new Uint8Array(e.exports.memory.buffer);h.set(n,c);const u=t(l,i,r,c,n.length);0===u&&A&&A(l,a,r);if(s.set(h.subarray(l,l+i*r)),o(l-o(0)),0!==u)throw new Error(`Malformed buffer data: ${u}`)}(A,A.exports[ob[r]],e,t,s,i,A.exports[Ab[n||"NONE"]])}let lb;async function cb(e,t){const s=e.getObjectExtension(t,"EXT_meshopt_compression");if(s){const{byteOffset:i=0,byteLength:r=0,byteStride:n,count:A,mode:o,filter:a="NONE",buffer:l}=s,c=e.gltf.buffers[l],h=new Uint8Array(c.arrayBuffer,c.byteOffset+i,r),u=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await ab(u,A,n,h,o,a),e.removeObjectExtension(t,"EXT_meshopt_compression")}}var hb=Object.freeze({__proto__:null,name:"EXT_meshopt_compression",decode:async function(e,t){const s=new Xm(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;const i=[];for(const t of e.json.bufferViews||[])i.push(cb(s,t));await Promise.all(i),s.removeExtension("EXT_meshopt_compression")}});var ub=Object.freeze({__proto__:null,name:"EXT_texture_webp",preprocess:function(e,t){const s=new Xm(e);if(!Dm("image/webp")){if(s.getRequiredExtensions().includes("EXT_texture_webp"))throw new Error("gltf: Required extension EXT_texture_webp not supported by browser");return}const{json:i}=s;for(const e of i.textures||[]){const t=s.getObjectExtension(e,"EXT_texture_webp");t&&(e.source=t.source),s.removeObjectExtension(e,"EXT_texture_webp")}s.removeExtension("EXT_texture_webp")}});var db=Object.freeze({__proto__:null,name:"KHR_texture_basisu",preprocess:function(e,t){const s=new Xm(e),{json:i}=s;for(const e of i.textures||[]){const t=s.getObjectExtension(e,"KHR_texture_basisu");t&&(e.source=t.source,s.removeObjectExtension(e,"KHR_texture_basisu"))}s.removeExtension("KHR_texture_basisu")}});const pb={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.2",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function fb(e,t,s){return dm(e,t,s?gb(s.metadata):void 0)}function gb(e){const t={};for(const s in e)t[`${s}.string`]=JSON.stringify(e[s]);return t}const mb={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},_b={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class bb{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){const s=new this.draco.DecoderBuffer;s.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);const i=this.decoder.GetEncodedGeometryType(s),r=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(i){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(s,r);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(s,r);break;default:throw new Error("DRACO: Unknown geometry type.")}if(!e.ok()||!r.ptr){const t=`DRACO decompression failed: ${e.error_msg()}`;throw new Error(t)}const n=this._getDracoLoaderData(r,i,t),A=this._getMeshData(r,n,t),o=hm(A.attributes),a=function(e,t,s){const i=gb(t.metadata),r=[],n=function(e){const t={};for(const s in e){const i=e[s];t[i.name||"undefined"]=i}return t}(t.attributes);for(const t in e){const s=fb(t,e[t],n[t]);r.push(s)}if(s){const e=fb("indices",s);r.push(e)}return{fields:r,metadata:i}}(A.attributes,n,A.indices);return{loader:"draco",loaderData:n,header:{vertexCount:r.num_points(),boundingBox:o},...A,schema:a}}finally{this.draco.destroy(s),r&&this.draco.destroy(r)}}_getDracoLoaderData(e,t,s){const i=this._getTopLevelMetadata(e),r=this._getDracoAttributes(e,s);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:r}}_getDracoAttributes(e,t){const s={};for(let i=0;i<e.num_attributes();i++){const r=this.decoder.GetAttribute(e,i),n=this._getAttributeMetadata(e,i);s[r.unique_id()]={unique_id:r.unique_id(),attribute_type:r.attribute_type(),data_type:r.data_type(),num_components:r.num_components(),byte_offset:r.byte_offset(),byte_stride:r.byte_stride(),normalized:r.normalized(),attribute_index:i,metadata:n};const A=this._getQuantizationTransform(r,t);A&&(s[r.unique_id()].quantization_transform=A);const o=this._getOctahedronTransform(r,t);o&&(s[r.unique_id()].octahedron_transform=o)}return s}_getMeshData(e,t,s){const i=this._getMeshAttributes(t,e,s);if(!i.POSITION)throw new Error("DRACO: No position attribute found.");return e instanceof this.draco.Mesh?"triangle-strip"===s.topology?{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}}:{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,s){const i={};for(const r of Object.values(e.attributes)){const e=this._deduceAttributeName(r,s);r.name=e;const n=this._getAttributeValues(t,r);if(n){const{value:t,size:s}=n;i[e]={value:t,size:s,byteOffset:r.byte_offset,byteStride:r.byte_stride,normalized:r.normalized}}}return i}_getTriangleListIndices(e){const t=3*e.num_faces(),s=4*t,i=this.draco._malloc(s);try{return this.decoder.GetTrianglesUInt32Array(e,s,i),new Uint32Array(this.draco.HEAPF32.buffer,i,t).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){const t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){const t=e.size(),s=new Int32Array(t);for(let i=0;i<t;i++)s[i]=e.GetValue(i);return s}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){const s=_b[t.data_type];if(!s)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;const i=t.num_components,r=e.num_points()*i,n=r*s.BYTES_PER_ELEMENT,A=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,s);let o;const a=this.draco._malloc(n);try{const i=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,i,A,n,a),o=new s(this.draco.HEAPF32.buffer,a,r).slice()}finally{this.draco._free(a)}return{value:o,size:i}}_deduceAttributeName(e,t){const s=e.unique_id;for(const[e,i]of Object.entries(t.extraAttributes||{}))if(i===s)return e;const i=e.attribute_type;for(const e in mb){if(this.draco[e]===i)return mb[e]}const r=t.attributeNameEntry||"name";return e.metadata[r]?e.metadata[r].string:`CUSTOM_ATTRIBUTE_${s}`}_getTopLevelMetadata(e){const t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){const s=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(s)}_getDracoMetadata(e){if(!e||!e.ptr)return{};const t={},s=this.metadataQuerier.NumEntries(e);for(let i=0;i<s;i++){const s=this.metadataQuerier.GetEntryName(e,i);t[s]=this._getDracoMetadataField(e,s)}return t}_getDracoMetadataField(e,t){const s=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,s);const i=function(e){const t=e.size(),s=new Int32Array(t);for(let i=0;i<t;i++)s[i]=e.GetValue(i);return s}(s);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(s)}}_disableAttributeTransforms(e){const{quantizedAttributes:t=[],octahedronAttributes:s=[]}=e,i=[...t,...s];for(const e of i)this.decoder.SkipAttributeTransform(this.draco[e])}_getQuantizationTransform(e,t){const{quantizedAttributes:s=[]}=t,i=e.attribute_type();if(s.map((e=>this.decoder[e])).includes(i)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map((e=>t.min_value(e)))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){const{octahedronAttributes:s=[]}=t,i=e.attribute_type();if(s.map((e=>this.decoder[e])).includes(i)){const t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}const Bb="https://www.gstatic.com/draco/versioned/decoders/1.5.6",yb="draco_wasm_wrapper.js",wb="draco_decoder.wasm",vb="draco_decoder.js",Cb="draco_encoder.js",Mb={[yb]:`${Bb}/${yb}`,[wb]:`${Bb}/${wb}`,[vb]:`${Bb}/${vb}`,[Cb]:`https://raw.githubusercontent.com/google/draco/1.4.1/javascript/${Cb}`};let Eb;async function Fb(e){const t=e.modules||{};return t.draco3d?Eb||=t.draco3d.createDecoderModule({}).then((e=>({draco:e}))):Eb||=async function(e){let t,s;if("js"===(e.draco&&e.draco.decoderType))t=await ng(Mb[vb],"draco",e,vb);else[t,s]=await Promise.all([await ng(Mb[yb],"draco",e,yb),await ng(Mb[wb],"draco",e,wb)]);return t=t||globalThis.DracoDecoderModule,await function(e,t){const s={};t&&(s.wasmBinary=t);return new Promise((t=>{e({...s,onModuleLoaded:e=>t({draco:e})})}))}(t,s)}(e),await Eb}const xb={...pb,parse:async function(e,t){const{draco:s}=await Fb(t),i=new bb(s);try{return i.parseSync(e,t?.draco)}finally{i.destroy()}}};function Ub(e){const{buffer:t,size:s,count:i}=function(e){let t=e,s=1,i=0;e&&e.value&&(t=e.value,s=e.size||1);t&&(ArrayBuffer.isView(t)||(t=function(e,t,s=!1){if(!e)return null;if(Array.isArray(e))return new t(e);if(s&&!(e instanceof t))return new t(e);return e}(t,Float32Array)),i=t.length/s);return{buffer:t,size:s,count:i}}(e);return{value:t,size:s,byteOffset:0,count:i,type:jm(s),componentType:Wm(t)}}async function Ib(e,t,s,i){const r=e.getObjectExtension(t,"KHR_draco_mesh_compression");if(!r)return;const n=e.getTypedArrayForBufferView(r.bufferView),A=hg(n.buffer,n.byteOffset),o={...s};delete o["3d-tiles"];const a=await ff(A,xb,o,i),l=function(e){const t={};for(const s in e){const i=e[s];if("indices"!==s){const e=Ub(i);t[s]=e}}return t}(a.attributes);for(const[s,i]of Object.entries(l))if(s in t.attributes){const r=t.attributes[s],n=e.getAccessor(r);n?.min&&n?.max&&(i.min=n.min,i.max=n.max)}t.attributes=l,a.indices&&(t.indices=Ub(a.indices)),e.removeObjectExtension(t,"KHR_draco_mesh_compression"),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw new Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function Tb(e,t,s=4,i,r){if(!i.DracoWriter)throw new Error("options.gltf.DracoWriter not provided");const n=i.DracoWriter.encodeSync({attributes:e}),A=r?.parseSync?.({attributes:e}),o=i._addFauxAttributes(A.attributes);return{primitives:[{attributes:o,mode:s,extensions:{KHR_draco_mesh_compression:{bufferView:i.addBufferView(n),attributes:o}}}]}}function*Pb(e){for(const t of e.json.meshes||[])for(const e of t.primitives)yield e}var Sb=Object.freeze({__proto__:null,name:"KHR_draco_mesh_compression",preprocess:function(e,t,s){const i=new Xm(e);for(const e of Pb(i))i.getObjectExtension(e,"KHR_draco_mesh_compression")},decode:async function(e,t,s){if(!t?.gltf?.decompressMeshes)return;const i=new Xm(e),r=[];for(const e of Pb(i))i.getObjectExtension(e,"KHR_draco_mesh_compression")&&r.push(Ib(i,e,t,s));await Promise.all(r),i.removeExtension("KHR_draco_mesh_compression")},encode:function(e,t={}){const s=new Xm(e);for(const e of s.json.meshes||[])Tb(e),s.addRequiredExtension("KHR_draco_mesh_compression")}});globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};const Db=globalThis.mathgl.config;function kb(e,{precision:t=Db.precision}={}){return e=function(e){return Math.round(e/Db.EPSILON)*Db.EPSILON}(e),`${parseFloat(e.toPrecision(t))}`}function Qb(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function Rb(e,t,s){const i=Db.EPSILON;s&&(Db.EPSILON=s);try{if(e===t)return!0;if(Qb(e)&&Qb(t)){if(e.length!==t.length)return!1;for(let s=0;s<e.length;++s)if(!Rb(e[s],t[s]))return!1;return!0}return e&&e.equals?e.equals(t):t&&t.equals?t.equals(e):"number"==typeof e&&"number"==typeof t&&Math.abs(e-t)<=Db.EPSILON*Math.max(1,Math.abs(e),Math.abs(t))}finally{Db.EPSILON=i}}class Ob extends Array{clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){for(let s=0;s<this.ELEMENTS;++s)this[s]=e[s+t];return this.check()}toArray(e=[],t=0){for(let s=0;s<this.ELEMENTS;++s)e[t+s]=this[s];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:Qb(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(Db)}formatString(e){let t="";for(let s=0;s<this.ELEMENTS;++s)t+=(s>0?", ":"")+kb(this[s],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!Rb(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,s){if(void 0===s)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){const r=e[i],n="number"==typeof t?t:t[i];this[i]=r+s*(n-r)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e[s]),t[s]);return this.check()}add(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(Db.debug&&!this.validate())throw new Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let s=0;s<this.ELEMENTS;++s)this[s]=Math.min(Math.max(this[s],e),t);return this.check()}get elements(){return this}}function Vb(e){if(!Number.isFinite(e))throw new Error(`Invalid number ${JSON.stringify(e)}`);return e}function Lb(e,t,s=""){if(Db.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw new Error(`math.gl: ${s} some fields set to invalid numbers'`);return e}function Hb(e,t){if(!e)throw new Error(`math.gl assertion ${t}`)}class Nb extends Ob{get x(){return this[0]}set x(e){this[0]=Vb(e)}get y(){return this[1]}set y(e){this[1]=Vb(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let s=0;s<this.ELEMENTS;++s){const i=this[s]-e[s];t+=i*i}return Vb(t)}dot(e){let t=0;for(let s=0;s<this.ELEMENTS;++s)t+=this[s]*e[s];return Vb(t)}normalize(){const e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(const t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return Hb(e>=0&&e<this.ELEMENTS,"index is out of range"),Vb(this[e])}setComponent(e,t){return Hb(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}let Gb="undefined"!=typeof Float32Array?Float32Array:Array;function jb(e,t,s){const i=t[0],r=t[1],n=t[2];return e[0]=i*s[0]+r*s[3]+n*s[6],e[1]=i*s[1]+r*s[4]+n*s[7],e[2]=i*s[2]+r*s[5]+n*s[8],e}!function(){const e=function(){const e=new Gb(2);return Gb!=Float32Array&&(e[0]=0,e[1]=0),e}()}(),function(){const e=function(){const e=new Gb(3);return Gb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}()}();const Wb=[0,0,0];let zb;class Xb extends Nb{static get ZERO(){return zb||(zb=new Xb(0,0,0),Object.freeze(zb)),zb}constructor(e=0,t=0,s=0){super(-0,-0,-0),1===arguments.length&&Qb(e)?this.copy(e):(Db.debug&&(Vb(e),Vb(t),Vb(s)),this[0]=e,this[1]=t,this[2]=s)}set(e,t,s){return this[0]=e,this[1]=t,this[2]=s,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return Db.debug&&(Vb(e.x),Vb(e.y),Vb(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=Vb(e)}angle(e){return function(e,t){const s=e[0],i=e[1],r=e[2],n=t[0],A=t[1],o=t[2],a=Math.sqrt((s*s+i*i+r*r)*(n*n+A*A+o*o)),l=a&&function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}(e,t)/a;return Math.acos(Math.min(Math.max(l,-1),1))}(this,e)}cross(e){return function(e,t,s){const i=t[0],r=t[1],n=t[2],A=s[0],o=s[1],a=s[2];e[0]=r*a-n*o,e[1]=n*A-i*a,e[2]=i*o-r*A}(this,this,e),this.check()}rotateX({radians:e,origin:t=Wb}){return function(e,t,s,i){const r=[],n=[];r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0],n[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),n[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2]}(this,this,t,e),this.check()}rotateY({radians:e,origin:t=Wb}){return function(e,t,s,i){const r=[],n=[];r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),n[1]=r[1],n[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2]}(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=Wb}){return function(e,t,s,i){const r=[],n=[];r[0]=t[0]-s[0],r[1]=t[1]-s[1],r[2]=t[2]-s[2],n[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),n[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),n[2]=r[2],e[0]=n[0]+s[0],e[1]=n[1]+s[1],e[2]=n[2]+s[2]}(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return function(e,t,s){const i=t[0],r=t[1],n=t[2];let A=s[3]*i+s[7]*r+s[11]*n+s[15];A=A||1,e[0]=(s[0]*i+s[4]*r+s[8]*n+s[12])/A,e[1]=(s[1]*i+s[5]*r+s[9]*n+s[13])/A,e[2]=(s[2]*i+s[6]*r+s[10]*n+s[14])/A}(this,this,e),this.check()}transformAsVector(e){return function(e,t,s){const i=t[0],r=t[1],n=t[2],A=s[3]*i+s[7]*r+s[11]*n||1;e[0]=(s[0]*i+s[4]*r+s[8]*n)/A,e[1]=(s[1]*i+s[5]*r+s[9]*n)/A,e[2]=(s[2]*i+s[6]*r+s[10]*n)/A}(this,this,e),this.check()}transformByMatrix3(e){return jb(this,this,e),this.check()}transformByMatrix2(e){return function(e,t,s){const i=t[0],r=t[1];e[0]=s[0]*i+s[2]*r,e[1]=s[1]*i+s[3]*r,e[2]=t[2]}(this,this,e),this.check()}transformByQuaternion(e){return function(e,t,s){const i=s[0],r=s[1],n=s[2],A=s[3],o=t[0],a=t[1],l=t[2];let c=r*l-n*a,h=n*o-i*l,u=i*a-r*o,d=r*u-n*h,p=n*c-i*u,f=i*h-r*c;const g=2*A;c*=g,h*=g,u*=g,d*=2,p*=2,f*=2,e[0]=o+c+d,e[1]=a+h+p,e[2]=l+u+f}(this,this,e),this.check()}}class Kb extends Ob{toString(){let e="[";if(Db.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let s=0;s<this.RANK;++s)e+=` ${this[s*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+="]",e}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,s){return this[t*this.RANK+e]=Vb(s),this}getColumn(e,t=new Array(this.RANK).fill(-0)){const s=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[s+e];return t}setColumn(e,t){const s=e*this.RANK;for(let e=0;e<this.RANK;++e)this[s+e]=t[e];return this}}function Zb(e,t,s){const i=t[0],r=t[1],n=t[2],A=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=s[0],d=s[1],p=s[2],f=s[3],g=s[4],m=s[5],_=s[6],b=s[7],B=s[8];return e[0]=u*i+d*A+p*l,e[1]=u*r+d*o+p*c,e[2]=u*n+d*a+p*h,e[3]=f*i+g*A+m*l,e[4]=f*r+g*o+m*c,e[5]=f*n+g*a+m*h,e[6]=_*i+b*A+B*l,e[7]=_*r+b*o+B*c,e[8]=_*n+b*a+B*h,e}function Jb(e,t,s){const i=s[0],r=s[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}var Yb;!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(Yb||(Yb={}));const $b=Object.freeze([1,0,0,0,1,0,0,0,1]);class qb extends Kb{static get IDENTITY(){return function(){tB||(tB=new qb,Object.freeze(tB));return tB}()}static get ZERO(){return function(){eB||(eB=new qb([0,0,0,0,0,0,0,0,0]),Object.freeze(eB));return eB}()}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return Yb}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1===arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy($b)}fromObject(e){return this.check()}fromQuaternion(e){return function(e,t){const s=t[0],i=t[1],r=t[2],n=t[3],A=s+s,o=i+i,a=r+r,l=s*A,c=i*A,h=i*o,u=r*A,d=r*o,p=r*a,f=n*A,g=n*o,m=n*a;e[0]=1-h-p,e[3]=c-m,e[6]=u+g,e[1]=c+m,e[4]=1-l-p,e[7]=d-f,e[2]=u-g,e[5]=d+f,e[8]=1-l-h}(this,e),this.check()}set(e,t,s,i,r,n,A,o,a){return this[0]=e,this[1]=t,this[2]=s,this[3]=i,this[4]=r,this[5]=n,this[6]=A,this[7]=o,this[8]=a,this.check()}setRowMajor(e,t,s,i,r,n,A,o,a){return this[0]=e,this[1]=i,this[2]=A,this[3]=t,this[4]=r,this[5]=o,this[6]=s,this[7]=n,this[8]=a,this.check()}determinant(){return function(e){const t=e[0],s=e[1],i=e[2],r=e[3],n=e[4],A=e[5],o=e[6],a=e[7],l=e[8];return t*(l*n-A*a)+s*(-l*r+A*o)+i*(a*r-n*o)}(this)}transpose(){return function(e,t){if(e===t){const s=t[1],i=t[2],r=t[5];e[1]=t[3],e[2]=t[6],e[3]=s,e[5]=t[7],e[6]=i,e[7]=r}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return function(e,t){const s=t[0],i=t[1],r=t[2],n=t[3],A=t[4],o=t[5],a=t[6],l=t[7],c=t[8],h=c*A-o*l,u=-c*n+o*a,d=l*n-A*a;let p=s*h+i*u+r*d;p&&(p=1/p,e[0]=h*p,e[1]=(-c*i+r*l)*p,e[2]=(o*i-r*A)*p,e[3]=u*p,e[4]=(c*s-r*a)*p,e[5]=(-o*s+r*n)*p,e[6]=d*p,e[7]=(-l*s+i*a)*p,e[8]=(A*s-i*n)*p)}(this,this),this.check()}multiplyLeft(e){return Zb(this,e,this),this.check()}multiplyRight(e){return Zb(this,this,e),this.check()}rotate(e){return function(e,t,s){const i=t[0],r=t[1],n=t[2],A=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=Math.sin(s),d=Math.cos(s);e[0]=d*i+u*A,e[1]=d*r+u*o,e[2]=d*n+u*a,e[3]=d*A-u*i,e[4]=d*o-u*r,e[5]=d*a-u*n,e[6]=l,e[7]=c,e[8]=h}(this,this,e),this.check()}scale(e){return Array.isArray(e)?Jb(this,this,e):Jb(this,this,[e,e]),this.check()}translate(e){return function(e,t,s){const i=t[0],r=t[1],n=t[2],A=t[3],o=t[4],a=t[5],l=t[6],c=t[7],h=t[8],u=s[0],d=s[1];e[0]=i,e[1]=r,e[2]=n,e[3]=A,e[4]=o,e[5]=a,e[6]=u*i+d*A+l,e[7]=u*r+d*o+c,e[8]=u*n+d*a+h}(this,this,e),this.check()}transform(e,t){let s;switch(e.length){case 2:s=function(e,t,s){const i=t[0],r=t[1];return e[0]=s[0]*i+s[3]*r+s[6],e[1]=s[1]*i+s[4]*r+s[7],e}(t||[-0,-0],e,this);break;case 3:s=jb(t||[-0,-0,-0],e,this);break;case 4:s=function(e,t,s){const i=t[0],r=t[1],n=t[2];return e[0]=s[0]*i+s[3]*r+s[6]*n,e[1]=s[1]*i+s[4]*r+s[7]*n,e[2]=s[2]*i+s[5]*r+s[8]*n,e[3]=t[3],e}(t||[-0,-0,-0,-0],e,this);break;default:throw new Error("Illegal vector")}return Lb(s,e.length),s}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let eB,tB=null;const sB=new Xb,iB=new qb,rB=new qb;function nB(e,t){const s=t.json.materials?.[e],i=[s?.pbrMetallicRoughness?.baseColorTexture,s?.emissiveTexture,s?.normalTexture,s?.occlusionTexture,s?.pbrMetallicRoughness?.metallicRoughnessTexture],r=[];for(const s of i)s&&s?.extensions?.KHR_texture_transform&&AB(t,e,s,r)}function AB(e,t,s,i){const r=function(e,t){const s=e.extensions?.KHR_texture_transform,{texCoord:i=0}=e,{texCoord:r=i}=s;if(-1===t.findIndex((([e,t])=>e===i&&t===r))){const n=function(e){const{offset:t=[0,0],rotation:s=0,scale:i=[1,1]}=e,r=(new qb).set(1,0,0,0,1,0,t[0],t[1],1),n=iB.set(Math.cos(s),Math.sin(s),0,-Math.sin(s),Math.cos(s),0,0,0,1),A=rB.set(i[0],0,0,0,i[1],0,0,0,1);return r.multiplyRight(n).multiplyRight(A)}(s);return i!==r&&(e.texCoord=r),t.push([i,r]),{originalTexCoord:i,texCoord:r,matrix:n}}return null}(s,i);if(!r)return;const n=e.json.meshes||[];for(const s of n)for(const i of s.primitives){const s=i.material;Number.isFinite(s)&&t===s&&oB(e,i,r)}}function oB(e,t,s){const{originalTexCoord:i,texCoord:r,matrix:n}=s,A=t.attributes[`TEXCOORD_${i}`];if(Number.isFinite(A)){const s=e.json.accessors?.[A];if(s&&s.bufferView){const A=e.json.bufferViews?.[s.bufferView];if(A){const{arrayBuffer:o,byteOffset:a}=e.buffers[A.buffer],l=(a||0)+(s.byteOffset||0)+(A.byteOffset||0),{ArrayType:c,length:h}=zm(s,A),u=Rm[s.componentType],d=Qm[s.type],p=A.byteStride||u*d,f=new Float32Array(h);for(let e=0;e<s.count;e++){const t=new c(o,l+e*p,2);sB.set(t[0],t[1],1),sB.transformByMatrix3(n),f.set([sB[0],sB[1]],e*d)}i===r?function(e,t,s,i){e.componentType=5126,s.push({arrayBuffer:i.buffer,byteOffset:0,byteLength:i.buffer.byteLength}),t.buffer=s.length-1,t.byteLength=i.buffer.byteLength,t.byteOffset=0,delete t.byteStride}(s,A,e.buffers,f):function(e,t,s,i,r){i.buffers.push({arrayBuffer:r.buffer,byteOffset:0,byteLength:r.buffer.byteLength});const n=i.json.bufferViews;if(!n)return;n.push({buffer:i.buffers.length-1,byteLength:r.buffer.byteLength,byteOffset:0});const A=i.json.accessors;if(!A)return;A.push({bufferView:n?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),s.attributes[`TEXCOORD_${e}`]=A.length-1}(r,s,t,e,f)}}}}var aB=Object.freeze({__proto__:null,name:"KHR_texture_transform",decode:async function(e,t){if(!new Xm(e).hasExtension("KHR_texture_transform")||!t.gltf?.loadBuffers)return;const s=e.json.materials||[];for(let t=0;t<s.length;t++)nB(t,e)}});function lB(e,t){const s=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach((t=>{e.uniforms[t].value&&!(t in s)&&(s[t]=e.uniforms[t].value)})),Object.keys(s).forEach((e=>{"object"==typeof s[e]&&void 0!==s[e].index&&(s[e].texture=t.getTexture(s[e].index))})),s}const cB=[y_,l_,hb,ub,db,Sb,Object.freeze({__proto__:null,name:"KHR_lights_punctual",decode:async function(e){const t=new Xm(e),{json:s}=t,i=t.getExtension("KHR_lights_punctual");i&&(t.json.lights=i.lights,t.removeExtension("KHR_lights_punctual"));for(const e of s.nodes||[]){const s=t.getObjectExtension(e,"KHR_lights_punctual");s&&(e.light=s.light),t.removeObjectExtension(e,"KHR_lights_punctual")}},encode:async function(e){const t=new Xm(e),{json:s}=t;if(s.lights){const e=t.addExtension("KHR_lights_punctual");km(!e.lights),e.lights=s.lights,delete s.lights}if(t.json.lights){for(const e of t.json.lights){const s=e.node;t.addObjectExtension(s,"KHR_lights_punctual",e)}delete t.json.lights}}}),Object.freeze({__proto__:null,name:"KHR_materials_unlit",decode:async function(e){const t=new Xm(e),{json:s}=t;for(const e of s.materials||[]){e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),t.removeObjectExtension(e,"KHR_materials_unlit")}t.removeExtension("KHR_materials_unlit")},encode:function(e){const t=new Xm(e),{json:s}=t;if(t.materials)for(const e of s.materials||[])e.unlit&&(delete e.unlit,t.addObjectExtension(e,"KHR_materials_unlit",{}),t.addExtension("KHR_materials_unlit"))}}),Object.freeze({__proto__:null,name:"KHR_techniques_webgl",decode:async function(e){const t=new Xm(e),{json:s}=t,i=t.getExtension("KHR_techniques_webgl");if(i){const e=function(e,t){const{programs:s=[],shaders:i=[],techniques:r=[]}=e,n=new TextDecoder;return i.forEach((e=>{if(!Number.isFinite(e.bufferView))throw new Error("KHR_techniques_webgl: no shader code");e.code=n.decode(t.getTypedArrayForBufferView(e.bufferView))})),s.forEach((e=>{e.fragmentShader=i[e.fragmentShader],e.vertexShader=i[e.vertexShader]})),r.forEach((e=>{e.program=s[e.program]})),r}(i,t);for(const i of s.materials||[]){const s=t.getObjectExtension(i,"KHR_techniques_webgl");s&&(i.technique=Object.assign({},s,e[s.technique]),i.technique.values=lB(i.technique,t)),t.removeObjectExtension(i,"KHR_techniques_webgl")}t.removeExtension("KHR_techniques_webgl")}},encode:async function(e,t){}}),aB,U_];function hB(e,t){const s=t?.gltf?.excludeExtensions||{};return!(e in s&&!s[e])}const uB={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},dB={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class pB{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;const s=e.json;switch(s.asset&&s.asset.version){case"2.0":return;case void 0:case"1.0":break;default:return void console.warn(`glTF: Unknown version ${s.asset.version}`)}if(!t.normalize)throw new Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(s),this._convertTopLevelObjectsToArrays(s),function(e){const t=new Xm(e),{json:s}=t;for(const e of s.images||[]){const s=t.getObjectExtension(e,"KHR_binary_glTF");s&&Object.assign(e,s),t.removeObjectExtension(e,"KHR_binary_glTF")}s.buffers&&s.buffers[0]&&delete s.buffers[0].uri,t.removeExtension("KHR_binary_glTF")}(e),this._convertObjectIdsToArrayIndices(s),this._updateObjects(s),this._updateMaterial(s)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(const t in uB)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){const s=e[t];if(s&&!Array.isArray(s)){e[t]=[];for(const i in s){const r=s[i];r.id=r.id||i;const n=e[t].length;e[t].push(r),this.idToIndexMap[t][i]=n}}}_convertObjectIdsToArrayIndices(e){for(const t in uB)this._convertIdsToIndices(e,t);"scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene"));for(const t of e.textures)this._convertTextureIds(t);for(const t of e.meshes)this._convertMeshIds(t);for(const t of e.nodes)this._convertNodeIds(t);for(const t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(const t of e.primitives){const{attributes:e,indices:s,material:i}=t;for(const t in e)e[t]=this._convertIdToIndex(e[t],"accessor");s&&(t.indices=this._convertIdToIndex(s,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map((e=>this._convertIdToIndex(e,"node")))),e.meshes&&(e.meshes=e.meshes.map((e=>this._convertIdToIndex(e,"mesh"))))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map((e=>this._convertIdToIndex(e,"node"))))}_convertIdsToIndices(e,t){e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]);for(const s of e[t])for(const e in s){const t=s[e],i=this._convertIdToIndex(t,e);s[e]=i}}_convertIdToIndex(e,t){const s=dB[t];if(s in this.idToIndexMap){const i=this.idToIndexMap[s][e];if(!Number.isFinite(i))throw new Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(const e of this.json.buffers)delete e.type}_updateMaterial(e){for(const t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};const s=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,i=e.textures.findIndex((e=>e.id===s));-1!==i&&(t.pbrMetallicRoughness.baseColorTexture={index:i})}}}async function fB(e,t,s=0,i,r){return function(e,t,s,i){i.uri&&(e.baseUri=i.uri);if(t instanceof ArrayBuffer&&!function(e,t=0,s={}){const i=new DataView(e),{magic:r=Y_}=s,n=i.getUint32(t,!1);return n===r||n===Y_}(t,s,i)){t=(new TextDecoder).decode(t)}if("string"==typeof t)e.json=lg(t);else if(t instanceof ArrayBuffer){const r={};s=$_(r,t,s,i.glb),km("glTF"===r.type,`Invalid GLB magic string ${r.type}`),e._glb=r,e.json=r.json}else km(!1,"GLTF: must be ArrayBuffer or string");const r=e.json.buffers||[];if(e.buffers=new Array(r.length).fill(null),e._glb&&e._glb.header.hasBinChunk){const{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}const n=e.json.images||[];e.images=new Array(n.length).fill({})}(e,t,s,i),function(e,t={}){(new pB).normalize(e,t)}(e,{normalize:i?.gltf?.normalize}),function(e,t={},s){const i=cB.filter((e=>hB(e.name,t)));for(const r of i)r.preprocess?.(e,t,s)}(e,i,r),i?.gltf?.loadBuffers&&e.json.buffers&&await async function(e,t,s){const i=e.json.buffers||[];for(let r=0;r<i.length;++r){const n=i[r];if(n.uri){const{fetch:i}=s;km(i);const A=tb(n.uri,t),o=await(s?.fetch?.(A)),a=await(o?.arrayBuffer?.());e.buffers[r]={arrayBuffer:a,byteOffset:0,byteLength:a.byteLength},delete n.uri}else null===e.buffers[r]&&(e.buffers[r]={arrayBuffer:new ArrayBuffer(n.byteLength),byteOffset:0,byteLength:n.byteLength})}}(e,i,r),i?.gltf?.loadImages&&await async function(e,t,s){const i=function(e){const t=new Set,s=e.json.textures||[];for(const e of s)void 0!==e.source&&t.add(e.source);return Array.from(t).sort()}(e),r=e.json.images||[],n=[];for(const A of i)n.push(gB(e,r[A],A,t,s));return await Promise.all(n)}(e,i,r),await async function(e,t={},s){const i=cB.filter((e=>hB(e.name,t)));for(const r of i)await(r.decode?.(e,t,s))}(e,i,r),e}async function gB(e,t,s,i,r){let n;if(t.uri&&!t.hasOwnProperty("bufferView")){const e=tb(t.uri,i),{fetch:s}=r,A=await s(e);n=await A.arrayBuffer(),t.bufferView={data:n}}if(Number.isFinite(t.bufferView)){const s=function(e,t,s){const i=e.bufferViews[s];km(i);const r=t[i.buffer];km(r);const n=(i.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,n,i.byteLength)}(e.json,e.buffers,t.bufferView);n=hg(s.buffer,s.byteOffset,s.byteLength)}km(n,"glTF image has no data");let A=await ff(n,[Pm,J_],{...i,mimeType:t.mimeType,basis:i.basis||{format:Z_()}},r);A&&A[0]&&(A={compressed:!0,mipmaps:!1,width:A[0].width,height:A[0].height,data:A[0]}),e.images=e.images||[],e.images[s]=A}const mB={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:"4.3.2",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:async function(e,t={},s){(t={...mB.options,...t}).gltf={...mB.options.gltf,...t.gltf};const{byteOffset:i=0}=t;return await fB({},e,i,t,s)},options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};const _B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},bB={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},BB=10240,yB=10241,wB=10242,vB=10243,CB=10497,MB={magFilter:BB,minFilter:yB,wrapS:wB,wrapT:vB},EB={[BB]:9729,[yB]:9986,[wB]:CB,[vB]:CB};class FB{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,t={}){const{json:s,buffers:i=[],images:r=[]}=e,{baseUri:n=""}=e;return km(s),this.baseUri=n,this.buffers=i,this.images=r,this.jsonUnprocessed=s,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){const s={...e};return this.json=s,e.bufferViews&&(s.bufferViews=e.bufferViews.map(((e,t)=>this._resolveBufferView(e,t)))),e.images&&(s.images=e.images.map(((e,t)=>this._resolveImage(e,t)))),e.samplers&&(s.samplers=e.samplers.map(((e,t)=>this._resolveSampler(e,t)))),e.textures&&(s.textures=e.textures.map(((e,t)=>this._resolveTexture(e,t)))),e.accessors&&(s.accessors=e.accessors.map(((e,t)=>this._resolveAccessor(e,t)))),e.materials&&(s.materials=e.materials.map(((e,t)=>this._resolveMaterial(e,t)))),e.meshes&&(s.meshes=e.meshes.map(((e,t)=>this._resolveMesh(e,t)))),e.nodes&&(s.nodes=e.nodes.map(((e,t)=>this._resolveNode(e,t))),s.nodes=s.nodes.map(((e,t)=>this._resolveNodeChildren(e)))),e.skins&&(s.skins=e.skins.map(((e,t)=>this._resolveSkin(e,t)))),e.scenes&&(s.scenes=e.scenes.map(((e,t)=>this._resolveScene(e,t)))),"number"==typeof this.json.scene&&s.scenes&&(s.scene=s.scenes[this.json.scene]),s}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if("object"==typeof t)return t;const s=e&&e[t];return s||console.warn(`glTF file error: Could not find ${e}[${t}]`),s}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map((e=>this.getNode(e)))}}_resolveNode(e,t){const s={...e,id:e?.id||`node-${t}`};return void 0!==e.mesh&&(s.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(s.camera=this.getCamera(e.camera)),void 0!==e.skin&&(s.skin=this.getSkin(e.skin)),void 0!==e.meshes&&e.meshes.length&&(s.mesh=e.meshes.reduce(((e,t)=>{const s=this.getMesh(t);return e.id=s.id,e.primitives=e.primitives.concat(s.primitives),e}),{primitives:[]})),s}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map((e=>this.getNode(e)))),e}_resolveSkin(e,t){const s="number"==typeof e.inverseBindMatrices?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:s}}_resolveMesh(e,t){const s={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(s.primitives=e.primitives.map((e=>{const t={...e,attributes:{},indices:void 0,material:void 0},s=e.attributes;for(const e in s)t.attributes[e]=this.getAccessor(s[e]);return void 0!==e.indices&&(t.indices=this.getAccessor(e.indices)),void 0!==e.material&&(t.material=this.getMaterial(e.material)),t}))),s}_resolveMaterial(e,t){const s={...e,id:e.id||`material-${t}`};if(s.normalTexture&&(s.normalTexture={...s.normalTexture},s.normalTexture.texture=this.getTexture(s.normalTexture.index)),s.occlusionTexture&&(s.occlusionTexture={...s.occlusionTexture},s.occlusionTexture.texture=this.getTexture(s.occlusionTexture.index)),s.emissiveTexture&&(s.emissiveTexture={...s.emissiveTexture},s.emissiveTexture.texture=this.getTexture(s.emissiveTexture.index)),s.emissiveFactor||(s.emissiveFactor=s.emissiveTexture?[1,1,1]:[0,0,0]),s.pbrMetallicRoughness){s.pbrMetallicRoughness={...s.pbrMetallicRoughness};const e=s.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return s}_resolveAccessor(e,t){const s=(i=e.componentType,bB[i]);var i;const r=(n=e.type,_B[n]);var n;const A=s*r,o={...e,id:e.id||`accessor-${t}`,bytesPerComponent:s,components:r,bytesPerElement:A,value:void 0,bufferView:void 0,sparse:void 0};if(void 0!==e.bufferView&&(o.bufferView=this.getBufferView(e.bufferView)),o.bufferView){const e=o.bufferView.buffer,{ArrayType:t,byteLength:s}=zm(o,o.bufferView),i=(o.bufferView.byteOffset||0)+(o.byteOffset||0)+e.byteOffset;let r=e.arrayBuffer.slice(i,i+s);o.bufferView.byteStride&&(r=this._getValueFromInterleavedBuffer(e,i,o.bufferView.byteStride,o.bytesPerElement,o.count)),o.value=new t(r)}return o}_getValueFromInterleavedBuffer(e,t,s,i,r){const n=new Uint8Array(r*i);for(let A=0;A<r;A++){const r=t+A*s;n.set(new Uint8Array(e.arrayBuffer.slice(r,r+i)),A*i)}return n.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:"number"==typeof e.sampler?this.getSampler(e.sampler):{id:"default-sampler",parameters:EB},source:"number"==typeof e.source?this.getImage(e.source):void 0}}_resolveSampler(e,t){const s={id:e.id||`sampler-${t}`,...e,parameters:{}};for(const e in s){const t=this._enumSamplerParameter(e);void 0!==t&&(s.parameters[t]=s[e])}return s}_enumSamplerParameter(e){return MB[e]}_resolveImage(e,t){const s={...e,id:e.id||`image-${t}`,image:null,bufferView:void 0!==e.bufferView?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(s.image=i),s}_resolveBufferView(e,t){const s=e.buffer,i=this.buffers[s].arrayBuffer;let r=this.buffers[s].byteOffset||0;e.byteOffset&&(r+=e.byteOffset);return{id:`bufferView-${t}`,...e,buffer:this.buffers[s],data:new Uint8Array(i,r,e.byteLength)}}_resolveCamera(e,t){return{...e,id:e.id||`camera-${t}`}}}class xB{constructor(e){}load(e,t,s,i,r,n,A){!function(e,t,s,i,r,n,A){const o=e.viewer.scene.canvas.spinner;o.processes++;"glb"===t.split(".").pop()?e.dataSource.getGLB(t,(a=>{i.basePath=UB(t),IB(e,t,a,s,i,r,n,A),o.processes--}),(e=>{o.processes--,A(e)})):e.dataSource.getGLTF(t,(a=>{i.basePath=UB(t),IB(e,t,a,s,i,r,n,A),o.processes--}),(e=>{o.processes--,A(e)}))}(e,t,s,i=i||{},r,(function(){F.scheduleTask((function(){r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1)})),n&&n()}),(function(t){e.error(t),A&&A(t),r.fire("error",t)}))}parse(e,t,s,i,r,n,A){IB(e,"",t,s,i=i||{},r,(function(){r.scene.fire("modelLoaded",r.id),r.fire("loaded",!0,!1),n&&n()}),(function(e){r.error(e),r.fire("error",e),A&&A(e)}))}}function UB(e){const t=e.lastIndexOf("/");return 0!==t?e.substring(0,t+1):""}function IB(e,t,s,i,r,n,A,o){const a=e.viewer.scene.canvas.spinner;a.processes++,cm(s,mB,{baseUri:r.basePath}).then((s=>{const o=function(e,t){return(new FB).postProcess(e,t)}(s),l={src:t,entityId:r.entityId,metaModelJSON:i,autoMetaModel:r.autoMetaModel,globalizeObjectIds:r.globalizeObjectIds,metaObjects:[],loadBuffer:r.loadBuffer,basePath:r.basePath,handlenode:r.handlenode,backfaces:!!r.backfaces,gltfData:o,scene:n.scene,plugin:e,sceneModel:n,numObjects:0,nodes:[],nextId:0,log:t=>{e.log(t)}};!function(e){const t=e.gltfData.textures;if(t)for(let s=0,i=t.length;s<i;s++)TB(e,t[s])}(l),function(e){const t=e.gltfData.materials;if(t)for(let s=0,i=t.length;s<i;s++){const i=t[s];i._textureSetId=PB(e,i),i._attributes=SB(e,i)}}(l),r.autoMetaModel&&l.metaObjects.push({id:n.id,type:"Default",name:n.id}),DB(l),n.finalize(),r.autoMetaModel&&e.viewer.metaScene.createMetaModel(n.id,{metaObjects:l.metaObjects}),a.processes--,A()})).catch((e=>{o&&o(e)}))}function TB(e,t){if(!t.source||!t.source.image)return;const s="texture-"+e.nextId++;let i=1005;switch(t.sampler.minFilter){case 9728:i=1003;break;case 9729:i=1006;break;case 9984:i=1004;break;case 9985:i=1007;break;case 9986:i=1005;break;case 9987:i=1008}let r=1006;switch(t.sampler.magFilter){case 9728:r=1003;break;case 9729:r=1006}let n=1e3;switch(t.sampler.wrapS){case 33071:n=1001;break;case 33648:n=1002;break;case 10497:n=1e3}let A=1e3;switch(t.sampler.wrapT){case 33071:A=1001;break;case 33648:A=1002;break;case 10497:A=1e3}let o=1e3;switch(t.sampler.wrapR){case 33071:o=1001;break;case 33648:o=1002;break;case 10497:o=1e3}e.sceneModel.createTexture({id:s,image:t.source.image,flipY:!!t.flipY,minFilter:i,magFilter:r,wrapS:n,wrapT:A,wrapR:o,encoding:3001}),t._textureId=s}function PB(e,t){const s={};switch(t.normalTexture&&(s.normalTextureId=t.normalTexture.texture._textureId),t.occlusionTexture&&(s.occlusionTextureId=t.occlusionTexture.texture._textureId),t.emissiveTexture&&(s.emissiveTextureId=t.emissiveTexture.texture._textureId),t.alphaMode){case"OPAQUE":break;case"MASK":const e=t.alphaCutoff;s.alphaCutoff=void 0!==e?e:.5}const i=t.pbrMetallicRoughness;if(t.pbrMetallicRoughness){const r=t.pbrMetallicRoughness,n=r.baseColorTexture||r.colorTexture;n&&(n.texture?s.colorTextureId=n.texture._textureId:s.colorTextureId=e.gltfData.textures[n.index]._textureId),i.metallicRoughnessTexture&&(s.metallicRoughnessTextureId=i.metallicRoughnessTexture.texture._textureId)}const r=t.extensions;if(r){const t=r.KHR_materials_pbrSpecularGlossiness;if(t){t.specularTexture;const i=t.specularColorTexture;null!=i&&(s.colorTextureId=e.gltfData.textures[i.index]._textureId)}}return void 0!==s.normalTextureId||void 0!==s.occlusionTextureId||void 0!==s.emissiveTextureId||void 0!==s.colorTextureId||void 0!==s.metallicRoughnessTextureId?(s.id=`textureSet-${e.nextId++};`,e.sceneModel.createTextureSet(s),s.id):null}function SB(e,t){const s=t.extensions,i={color:new Float32Array([1,1,1,1]),opacity:1,metallic:0,roughness:1,doubleSided:!0};if(s){const e=s.KHR_materials_pbrSpecularGlossiness;if(e){const t=e.diffuseFactor;null!=t&&i.color.set(t)}const t=s.KHR_materials_common;if(t){const e=t.technique,s=t.values||{},r="BLINN"===e,n="PHONG"===e,A="LAMBERT"===e,o=s.diffuse;o&&(r||n||A)&&(_.isString(o)||i.color.set(o));const a=s.transparency;null!=a&&(i.opacity=a);const l=s.transparent;null!=l&&(i.opacity=l)}}const r=t.pbrMetallicRoughness;if(r){const e=r.baseColorFactor;e&&(i.color[0]=e[0],i.color[1]=e[1],i.color[2]=e[2],i.opacity=e[3]);const t=r.metallicFactor;null!=t&&(i.metallic=t);const s=r.roughnessFactor;null!=s&&(i.roughness=s)}return i.doubleSided=!1!==t.doubleSided,i}function DB(e){const t=e.gltfData,s=t.scene||t.scenes[0];if(!s)return void function(e,t){e.plugin.error(t)}(e,"glTF has no default scene");const i=s.nodes;if(!i)return;!function e(t){t.forEach((t=>{const s=t.mesh;s&&(s.instances||=0,s.instances+=1),t.children&&e(t.children)}))}(i);const r=[];let n=null;!function t(s,i,A){s.forEach((s=>{const o=s.name;let a=null!=o&&o||0===i&&"entity-"+e.nextId++;if(a){for(;e.sceneModel.objects[a];)a="entity-"+e.nextId++;r.push(n),n=[]}const l=function(e,t){let s;e.matrix&&(s=e.matrix,t=t?h.mulMat4(t,s,h.mat4()):s);e.translation&&(s=h.translationMat4v(e.translation),t=t?h.mulMat4(t,s,h.mat4()):s);e.rotation&&(s=h.quaternionToMat4(e.rotation),t=t?h.mulMat4(t,s,h.mat4()):s);e.scale&&(s=h.scalingMat4v(e.scale),t=t?h.mulMat4(t,s,h.mat4()):s);return t}(s,A);if(s.mesh&&function(e,t,s,i){const r=e.mesh;if(!r)return;const n=r.primitives.length;if(n>0)for(let e=0;e<n;e++){const n=r.primitives[e];if(n.mode<4)continue;const A={id:t.sceneModel.id+"."+t.numObjects++},o=n.material;o?(A.textureSetId=o._textureSetId,A.color=o._attributes.color,A.opacity=o._attributes.opacity,A.metallic=o._attributes.metallic,A.roughness=o._attributes.roughness):(A.color=new Float32Array([1,1,1]),A.opacity=1);const a=!1!==t.backfaces||o&&!1!==o.doubleSided;switch(n.mode){case 0:A.primitive="points";break;case 1:case 2:case 3:A.primitive="lines";break;default:A.primitive=a?"triangles":"solid"}const l=n.attributes.POSITION;if(!l)continue;A.localPositions=l.value,A.positions=new Float64Array(A.localPositions.length),n.attributes.NORMAL&&(A.normals=n.attributes.NORMAL.value),n.attributes.TEXCOORD_0&&(A.uv=n.attributes.TEXCOORD_0.value),n.indices&&(A.indices=n.indices.value),s?h.transformPositions3(s,A.localPositions,A.positions):A.positions.set(A.localPositions);const c=h.vec3();Ge(A.positions,A.positions,c)&&(A.origin=c),t.sceneModel.createMesh(A),i.push(A.id)}}(s,e,l,n),s.children&&t(s.children,i+1,l),a){if(n.length>0){const t=e.globalizeObjectIds?h.globalizeObjectId(e.sceneModel.id,a):a;e.sceneModel.createEntity({id:t,meshIds:n,isObject:!0}),e.autoMetaModel&&e.metaObjects.push({id:t,type:"Default",name:t,parent:e.sceneModel.id})}n=r.pop()}}))}(i,0,null)}const kB={DEFAULT:{}};class QB extends Wr{constructor(e,t={}){super("GLTFLoader",e,t),this._sceneModelLoader=new xB(this,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults}set dataSource(e){this._dataSource=e||new pf}get dataSource(){return this._dataSource}set objectDefaults(e){this._objectDefaults=e||kB}get objectDefaults(){return this._objectDefaults}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new br(this.viewer.scene,_.apply(e,{isModel:!0,dtxEnabled:e.dtxEnabled})),s=t.id;if(!e.src&&!e.gltf)return this.error("load() param expected: src or gltf"),t;if(e.metaModelSrc||e.metaModelJSON){const i=i=>{this.viewer.metaScene.createMetaModel(s,i,{}),this.viewer.scene.canvas.spinner.processes--,e.src?this._sceneModelLoader.load(this,e.src,i,e,t):this._sceneModelLoader.parse(this,e.gltf,i,e,t)};if(e.metaModelSrc){const t=e.metaModelSrc;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getMetaModel(t,(e=>{this.viewer.scene.canvas.spinner.processes--,i(e)}),(e=>{this.error(`load(): Failed to load model metadata for model '${s} from  '${t}' - ${e}`),this.viewer.scene.canvas.spinner.processes--}))}else e.metaModelJSON&&i(e.metaModelJSON)}else e.src?this._sceneModelLoader.load(this,e.src,null,e,t):this._sceneModelLoader.parse(this,e.gltf,null,e,t);return t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),t}destroy(){super.destroy()}}function RB(e,t,s={}){const i="lightgrey",r=s.hoverColor||"rgba(0,0,0,0.4)",n=s.textColor||"black",A=s.canvasElement||document.body,o=500,a=o+o/3,l=a/24,c=[{boundary:[6,6,6,6],color:s.frontColor||s.color||"#55FF55"},{boundary:[18,6,6,6],color:s.backColor||s.color||"#55FF55"},{boundary:[12,6,6,6],color:s.rightColor||s.color||"#FF5555"},{boundary:[0,6,6,6],color:s.leftColor||s.color||"#FF5555"},{boundary:[6,0,6,6],color:s.topColor||s.color||"#7777FF"},{boundary:[6,12,6,6],color:s.bottomColor||s.color||"#7777FF"}],u=[{label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,1,0],up:[0,0,1]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,-1,0],up:[0,0,1]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,0,1]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,0,1]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,0,1],up:[0,-1,0]},{boundaries:[[7,5,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,0,-1],up:[1,0,1]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-1,-1],up:[0,-1,1]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,0,-1],up:[-1,0,1]},{boundaries:[[7,11,4,2]],dir:[0,1,1],up:[0,-1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,0,1],up:[-1,0,1]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,-1,1],up:[0,1,1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,0,1],up:[1,0,1]},{boundaries:[[5,7,2,4]],dir:[1,1,0],up:[0,0,1]},{boundaries:[[11,7,2,4]],dir:[-1,1,0],up:[0,0,1]},{boundaries:[[17,7,2,4]],dir:[-1,-1,0],up:[0,0,1]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,-1,0],up:[0,0,1]},{boundaries:[[5,11,2,2]],dir:[1,1,1],up:[-1,-1,1]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[1,-1,1],up:[-1,1,1]},{boundaries:[[5,5,2,2]],dir:[1,1,-1],up:[1,1,1]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-1,-1,1],up:[1,1,1]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-1,-1,-1],up:[-1,-1,1]},{boundaries:[[11,11,2,2]],dir:[-1,1,1],up:[1,-1,1]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[1,-1,-1],up:[1,-1,1]},{boundaries:[[11,5,2,2]],dir:[-1,1,-1],up:[-1,1,1]}];s.frontColor||s.color,s.backColor||s.color,s.rightColor||s.color,s.leftColor||s.color,s.topColor||s.color,s.bottomColor||s.color;const d=[{yUp:"",label:"NavCube.front",boundaries:[[7,7,4,4]],dir:[0,0,-1],up:[0,1,0]},{label:"NavCube.back",boundaries:[[19,7,4,4]],dir:[0,0,1],up:[0,1,0]},{label:"NavCube.right",boundaries:[[13,7,4,4]],dir:[-1,0,0],up:[0,1,0]},{label:"NavCube.left",boundaries:[[1,7,4,4]],dir:[1,0,0],up:[0,1,0]},{label:"NavCube.top",boundaries:[[7,1,4,4]],dir:[0,-1,0],up:[0,0,-1]},{label:"NavCube.bottom",boundaries:[[7,13,4,4]],dir:[0,1,0],up:[0,0,1]},{boundaries:[[7,5,4,2]],dir:[0,-.7071,-.7071],up:[0,.7071,-.7071]},{boundaries:[[1,6,4,1],[6,1,1,4]],dir:[1,-1,0],up:[1,1,0]},{boundaries:[[7,0,4,1],[19,6,4,1]],dir:[0,-.7071,.7071],up:[0,.7071,.7071]},{boundaries:[[13,6,4,1],[11,1,1,4]],dir:[-1,-1,0],up:[-1,1,0]},{boundaries:[[7,11,4,2]],dir:[0,1,-1],up:[0,1,1]},{boundaries:[[1,11,4,1],[6,13,1,4]],dir:[1,1,0],up:[-1,1,0]},{boundaries:[[7,17,4,1],[19,11,4,1]],dir:[0,1,1],up:[0,1,-1]},{boundaries:[[13,11,4,1],[11,13,1,4]],dir:[-1,1,0],up:[1,1,0]},{boundaries:[[5,7,2,4]],dir:[1,0,-1],up:[0,1,0]},{boundaries:[[11,7,2,4]],dir:[-1,0,-1],up:[0,1,0]},{boundaries:[[17,7,2,4]],dir:[-1,0,1],up:[0,1,0]},{boundaries:[[0,7,1,4],[23,7,1,4]],dir:[1,0,1],up:[0,1,0]},{boundaries:[[5,11,2,2]],dir:[.5,.7071,-.5],up:[-.5,.7071,.5]},{boundaries:[[23,11,1,1],[6,17,1,1],[0,11,1,1]],dir:[.5,.7071,.5],up:[-.5,.7071,-.5]},{boundaries:[[5,5,2,2]],dir:[.5,-.7071,-.5],up:[.5,.7071,-.5]},{boundaries:[[11,17,1,1],[17,11,2,1]],dir:[-.5,.7071,.5],up:[.5,.7071,-.5]},{boundaries:[[17,6,2,1],[11,0,1,1]],dir:[-.5,-.7071,.5],up:[-.5,.7071,.5]},{boundaries:[[11,11,2,2]],dir:[-.5,.7071,-.5],up:[.5,.7071,.5]},{boundaries:[[0,6,1,1],[6,0,1,1],[23,6,1,1]],dir:[.5,-.7071,.5],up:[.5,.7071,.5]},{boundaries:[[11,5,2,2]],dir:[-.5,-.7071,-.5],up:[-.5,.7071,-.5]}];for(let e=0,t=u.length;e<t;e++)h.normalizeVec3(u[e].dir,u[e].dir),h.normalizeVec3(u[e].up,u[e].up);for(let e=0,t=d.length;e<t;e++)h.normalizeVec3(d[e].dir,d[e].dir),h.normalizeVec3(d[e].up,d[e].up);var p=d;this._textureCanvas=document.createElement("canvas"),this._textureCanvas.width=a,this._textureCanvas.height=o,this._textureCanvas.style.width=a+"px",this._textureCanvas.style.height="500px",this._textureCanvas.style.padding="0",this._textureCanvas.style.margin="0",this._textureCanvas.style.top="0",this._textureCanvas.style.background=i,this._textureCanvas.style.position="absolute",this._textureCanvas.style.opacity="1.0",this._textureCanvas.style.visibility="hidden",this._textureCanvas.style["z-index"]=2e6,A.appendChild(this._textureCanvas);const f=this._textureCanvas.getContext("2d");let g=!1;function m(){for(let e=0,t=c.length;e<t;e++){const t=c[e],s=t.boundary,i=Math.round(s[0]*l),r=Math.round(s[1]*l),n=Math.round(s[2]*l),A=Math.round(s[3]*l);f.fillStyle=t.color,f.fillRect(i,r,n,A)}for(let t=0,a=p.length;t<a;t++){let a,c,h,u;const d=p[t],g=d.boundaries;for(var e=0,s=g.length;e<s;e++){const t=g[e];a=Math.round(t[0]*l),c=Math.round(t[1]*l),h=Math.round(t[2]*l),u=Math.round(t[3]*l),d.highlighted&&(f.fillStyle=d.highlighted?r:d.color||i,f.fillRect(a,c,h,u))}if(d.label){f.fillStyle=n,f.font="60px sans-serif",f.textAlign="center";var A=a+.5*h,o=c+.7*u;f.fillText(_(d.label),A,o,80)}}t.glRedraw()}const _=function(){const t={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},s={"NavCube.front":"NavCube.front","NavCube.back":"NavCube.back","NavCube.right":"NavCube.right","NavCube.left":"NavCube.left","NavCube.top":"NavCube.top","NavCube.bottom":"NavCube.bottom"},i={"NavCube.front":"FRONT","NavCube.back":"BACK","NavCube.right":"RIGHT","NavCube.left":"LEFT","NavCube.top":"TOP","NavCube.bottom":"BOTTOM"};return function(r){const n=g?s:t,A=n?n[r]:null;return A?e.localeService.translate(A)||i[A]||A:r}}();this.setZUp=function(){g=!0,p=u,this.clear()},this.setYUp=function(){g=!1,p=d,this.clear()},this.clear=function(){f.fillStyle=i,f.fillRect(0,0,a,o);for(var e=0,t=p.length;e<t;e++){p[e].highlighted=!1}m()},this.getArea=function(e){const t=e[0]*a,s=o-e[1]*o;for(var i=0,r=p.length;i<r;i++){const e=p[i].boundaries;for(var n=0,A=e.length;n<A;n++){const r=e[n];if(t>=r[0]*l&&t<=(r[0]+r[2])*l&&s>=r[1]*l&&s<=(r[1]+r[3])*l)return i}}return-1},this.setAreaHighlighted=function(e,t){var s=p[e];if(!s)throw"Area not found: "+e;s.highlighted=!!t,m()},this.getAreaDir=function(e){var t=p[e];if(!t)throw"Unknown area: "+e;return t.dir},this.getAreaUp=function(e){var t=p[e];if(!t)throw"Unknown area: "+e;return t.up},this.getImage=function(){return this._textureCanvas},this.destroy=function(){this._textureCanvas&&(this._textureCanvas.parentNode.removeChild(this._textureCanvas),this._textureCanvas=null)}}const OB=h.vec3(),VB=h.vec3();h.mat4();const LB=h.vec3();class HB{load(e,t,s={}){var i=e.scene.canvas.spinner;i.processes++,NB(e,t,(function(t){!function(e,t,s){for(var i=t.basePath,r=Object.keys(t.materialLibraries),n=r.length,A=0,o=n;A<o;A++)jB(e,i,i+r[A],(function(){0==--n&&s()}))}(e,t,(function(){zB(e,t),i.processes--,F.scheduleTask((function(){e.fire("loaded",!0,!1)}))}))}))}parse(e,t,s,i){if(t){var r=GB(e,t,null);s&&WB(e,s,i),zB(e,r),e.src=null,e.fire("loaded",!0,!1)}else this.warn("load() param expected: objText")}}var NB=function(e,t,s){XB(t,(function(i){var r=GB(e,i,t);s(r)}),(function(t){e.error(t)}))},GB=function(){const e={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /};return function(s,i,r){var n,A,o={src:r=r||"",basePath:(n=r,A=n.lastIndexOf("/"),-1===A?n:n.substring(0,A+1)),objects:[],object:{},positions:[],normals:[],uv:[],materialLibraries:{}};t(o,"",!1),-1!==i.indexOf("\r\n")&&(i=i.replace("\r\n","\n"));for(var a=i.split("\n"),l="",u="",d="",p=[],f="function"==typeof"".trimLeft,g=0,m=a.length;g<m;g++)if(l=a[g],0!==(l=f?l.trimLeft():l.trim()).length&&"#"!==(u=l.charAt(0)))if("v"===u)if(" "===(d=l.charAt(1))&&null!==(p=e.vertex_pattern.exec(l)))o.positions.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));else if("n"===d&&null!==(p=e.normal_pattern.exec(l)))o.normals.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3]));else{if("t"!==d||null===(p=e.uv_pattern.exec(l)))return void s.error("Unexpected vertex/normal/uv line: '"+l+"'");o.uv.push(parseFloat(p[1]),parseFloat(p[2]))}else if("f"===u)if(null!==(p=e.face_vertex_uv_normal.exec(l)))c(o,p[1],p[4],p[7],p[10],p[2],p[5],p[8],p[11],p[3],p[6],p[9],p[12]);else if(null!==(p=e.face_vertex_uv.exec(l)))c(o,p[1],p[3],p[5],p[7],p[2],p[4],p[6],p[8]);else if(null!==(p=e.face_vertex_normal.exec(l)))c(o,p[1],p[3],p[5],p[7],void 0,void 0,void 0,void 0,p[2],p[4],p[6],p[8]);else{if(null===(p=e.face_vertex.exec(l)))return void s.error("Unexpected face line: '"+l+"'");c(o,p[1],p[2],p[3],p[4])}else if("l"===u){var _=l.substring(1).trim().split(" "),b=[],B=[];if(-1===l.indexOf("/"))b=_;else for(var y=0,w=_.length;y<w;y++){var v=_[y].split("/");""!==v[0]&&b.push(v[0]),""!==v[1]&&B.push(v[1])}h(o,b,B)}else if(null!==(p=e.object_pattern.exec(l))){t(o,C=p[0].substr(1).trim(),!0)}else if(e.material_use_pattern.test(l)){var C=l.substring(7).trim();o.object.material.id=C}else if(e.material_library_pattern.test(l))o.materialLibraries[l.substring(7).trim()]=!0;else{if(null===(p=e.smoothing_pattern.exec(l))){if("\0"===l)continue;return void s.error("Unexpected line: '"+l+"'")}var M=p[1].trim().toLowerCase();o.object.material.smooth="1"===M||"on"===M}return o};function t(e,t,s){if(e.object&&!1===e.object.fromDeclaration)return e.object.id=t,void(e.object.fromDeclaration=!1!==s);e.object={id:t||"",geometry:{positions:[],normals:[],uv:[]},material:{id:"",smooth:!0},fromDeclaration:!1!==s},e.objects.push(e.object)}function s(e,t){var s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)}function i(e,t){var s=parseInt(e,10);return 3*(s>=0?s-1:s+t/3)}function r(e,t){var s=parseInt(e,10);return 2*(s>=0?s-1:s+t/2)}function n(e,t,s,i){var r=e.positions,n=e.object.geometry.positions;n.push(r[t+0]),n.push(r[t+1]),n.push(r[t+2]),n.push(r[s+0]),n.push(r[s+1]),n.push(r[s+2]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[i+2])}function A(e,t){var s=e.positions,i=e.object.geometry.positions;i.push(s[t+0]),i.push(s[t+1]),i.push(s[t+2])}function o(e,t,s,i){var r=e.normals,n=e.object.geometry.normals;n.push(r[t+0]),n.push(r[t+1]),n.push(r[t+2]),n.push(r[s+0]),n.push(r[s+1]),n.push(r[s+2]),n.push(r[i+0]),n.push(r[i+1]),n.push(r[i+2])}function a(e,t,s,i){var r=e.uv,n=e.object.geometry.uv;n.push(r[t+0]),n.push(r[t+1]),n.push(r[s+0]),n.push(r[s+1]),n.push(r[i+0]),n.push(r[i+1])}function l(e,t){var s=e.uv,i=e.object.geometry.uv;i.push(s[t+0]),i.push(s[t+1])}function c(e,t,A,l,c,h,u,d,p,f,g,m,_){var b,B=e.positions.length,y=s(t,B),w=s(A,B),v=s(l,B);if(void 0===c?n(e,y,w,v):(n(e,y,w,b=s(c,B)),n(e,w,v,b)),void 0!==h){var C=e.uv.length;y=r(h,C),w=r(u,C),v=r(d,C),void 0===c?a(e,y,w,v):(a(e,y,w,b=r(p,C)),a(e,w,v,b))}if(void 0!==f){var M=e.normals.length;y=i(f,M),w=f===g?y:i(g,M),v=f===m?y:i(m,M),void 0===c?o(e,y,w,v):(o(e,y,w,b=i(_,M)),o(e,w,v,b))}}function h(e,t,i){e.object.geometry.type="Line";for(var n=e.positions.length,o=e.uv.length,a=0,c=t.length;a<c;a++)A(e,s(t[a],n));for(var h=0,u=i.length;h<u;h++)l(e,r(i[h],o))}}();var jB=function(e,t,s,i){XB(s,(function(s){WB(e,s,t),i()}),(function(t){e.error(t),i()}))},WB=function(){var e=/\s+/;return function(e,r,n){var A,o,a,l,c,h=r.split("\n"),u={id:"Default"},d=!1;n=n||"";for(var p=0;p<h.length;p++)if(0!==(A=h[p].trim()).length&&"#"!==A.charAt(0))switch(a=(a=(o=A.indexOf(" "))>=0?A.substring(0,o):A).toLowerCase(),l=(l=o>=0?A.substring(o+1):"").trim(),a.toLowerCase()){case"newmtl":s(e,u),u={id:l},d=!0;break;case"ka":u.ambient=i(l);break;case"kd":u.diffuse=i(l);break;case"ks":u.specular=i(l);break;case"map_kd":u.diffuseMap||(u.diffuseMap=t(e,n,l,"sRGB"));break;case"map_ks":u.specularMap||(u.specularMap=t(e,n,l,"linear"));break;case"map_bump":case"bump":u.normalMap||(u.normalMap=t(e,n,l));break;case"ns":u.shininess=parseFloat(l);break;case"d":(c=parseFloat(l))<1&&(u.alpha=c,u.alphaMode="blend");break;case"tr":(c=parseFloat(l))>0&&(u.alpha=1-c,u.alphaMode="blend")}d&&s(e,u)};function t(e,t,s,i){var r={},n=s.split(/\s+/),A=n.indexOf("-bm");return A>=0&&n.splice(A,2),(A=n.indexOf("-s"))>=0&&(r.scale=[parseFloat(n[A+1]),parseFloat(n[A+2])],n.splice(A,4)),(A=n.indexOf("-o"))>=0&&(r.translate=[parseFloat(n[A+1]),parseFloat(n[A+2])],n.splice(A,4)),r.src=t+n.join(" ").trim(),r.flipY=!0,r.encoding=i||"linear",new Ut(e,r).id}function s(e,t){new bt(e,t)}function i(t){var s=t.split(e,3);return[parseFloat(s[0]),parseFloat(s[1]),parseFloat(s[2])]}}();function zB(e,t){for(var s=0,i=t.objects.length;s<i;s++){var r=t.objects[s],n=r.geometry;if(n.type,0===n.positions.length)continue;var A={primitive:"triangles",compressGeometry:!1};A.positions=n.positions,n.normals.length>0&&(A.normals=n.normals),n.uv.length>0&&(A.uv=n.uv);for(var o=new Array(A.positions.length/3),a=0;a<o.length;a++)o[a]=a;A.indices=o;const i=LB;Ge(n.positions,n.positions,i);var l,c=new pe(e,A),h=r.material.id;h&&""!==h?(l=e.scene.components[h])||e.error("Material not found: "+h):l=new bt(e,{diffuse:[.6,.6,.6],backfaces:!0});var u=new dt(e,{id:e.id+"#"+r.id,origin:0!==i[0]||0!==i[1]||0!==i[2]?i:null,isObject:!0,geometry:c,material:l,pickable:!0});e.addChild(u)}}function XB(e,t,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.addEventListener("load",(function(e){var i=e.target.response;200===this.status?t&&t(i):0===this.status?(console.warn("loadFile: HTTP Status 0 received."),t&&t(i)):s&&s(e)}),!1),i.addEventListener("error",(function(e){s&&s(e)}),!1),i.send(null)}class KB{constructor(e){const t=e.cameraControl,s=e.scene,i=s.canvas.canvas,r=!1,n=.09,A=.01,o=new Ve(s,{position:[0,0,0],scale:[5,5,5],isObject:!1}),a=h.vec3();this._setPosition=function(){const e=h.vec3(),t=h.vec3();return function(s){a.set(s),Ne(s,e,t),o.origin=e,o.position=t}}(),this._setQuaternion=e=>{o.quaternion=e};const l=(e,t)=>new pe(o,ye({radiusTop:.001,radiusBottom:e,radialSegments:32,heightSegments:1,height:t,openEnded:!1})),c=(e,t,s)=>new pe(o,ye({radiusTop:e,radiusBottom:e,radialSegments:s,heightSegments:1,height:t,openEnded:!1})),u=(e,t,s)=>new pe(o,Me({radius:.8,tube:e,radialSegments:64,tubeSegments:s,arc:2*Math.PI*t})),d={curve:u(A,.25,14),curveHandle:u(n,.25,14),hoop:u(A,1,8),arrowHead:l(.07,.2),arrowHeadBig:l(.09,.25),arrowHeadHandle:c(n,.37,8),axis:c(A,1,20),axisHandle:c(n,1,20)},p=(e,t)=>new Nt(o,{edges:!1,fill:!0,fillColor:e,fillAlpha:t}),f=new bt(o,{diffuse:[1,1,0],alpha:0,alphaMode:"blend"}),g={},m=(e,t)=>{h.mulVec3Scalar(e,-1,h.vec3());const n=(e=>new bt(o,{diffuse:e,emissive:e,ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}))(e),A=h.quaternionToRotationMat4(t,h.identityMat4());h.mulMat4(h.rotationMat4v(Math.PI,[0,1,0],h.mat4()),A,A);const l=h.scaleMat4v([.6,.6,.6],h.identityMat4()),c=(e,t)=>{const s=h.translateMat4v(e,h.identityMat4()),i=h.identityMat4();return h.mulMat4(s,t,i),h.mulMat4(A,i,i),h.mulMat4(i,l,h.identityMat4())},u=o.addChild(new dt(o,{geometry:d.curve,material:n,matrix:A,pickable:!1,collidable:!0,clippable:!1,backfaces:!0,visible:!1,isUI:!0,isObject:!1}),r),m=o.addChild(new dt(o,{geometry:d.curveHandle,material:f,matrix:A,pickable:!0,collidable:!0,clippable:!1,backfaces:!0,visible:!1,isUI:!0,isObject:!1}),r),_=o.addChild(new dt(o,{geometry:d.arrowHead,material:n,matrix:c([.8,.07,0],h.rotationMat4v(180*h.DEGTORAD,[0,0,1],h.identityMat4())),pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),b=o.addChild(new dt(o,{geometry:d.arrowHead,material:n,matrix:c([.07,.8,0],h.rotationMat4v(90*h.DEGTORAD,[0,0,1],h.identityMat4())),pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),B=o.addChild(new dt(o,{geometry:d.hoop,material:n,highlighted:!0,highlightMaterial:p(e,.6),matrix:A,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),y=h.quaternionToRotationMat4(h.vec3PairToQuaternion([0,1,0],e),h.identityMat4());h.mulMat4(h.rotationMat4v(Math.PI,[0,1,0],h.mat4()),y,y);const w=e=>h.mulMat4(y,h.translateMat4c(0,e,0,h.identityMat4()),h.identityMat4()),v=w(1.1),C=w(.5),M=o.addChild(new dt(o,{geometry:d.arrowHead,material:n,matrix:v,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),E=o.addChild(new dt(o,{geometry:d.arrowHeadHandle,material:f,matrix:v,pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),F=o.addChild(new dt(o,{geometry:d.axis,material:n,matrix:C,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),x=o.addChild(new dt(o,{geometry:d.axisHandle,material:f,matrix:C,pickable:!0,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),U=o.addChild(new dt(o,{geometry:d.arrowHeadBig,material:n,matrix:v,pickable:!1,collidable:!0,clippable:!1,visible:!1,isUI:!0,isObject:!1}),r),I=(e,t)=>h.vec3ApplyQuaternion(o.quaternion,e,t),T=function(){const t=h.vec3(),r=h.vec3(),n=h.vec3();return(A,o)=>{I(e,t);const l=a,c=t;h.canvasPosToWorldRay(i,s.camera.viewMatrix,s.camera.projMatrix,s.camera.projection,A,r,n);const u=h.dotVec3(c,n),d=h.subVec3(r,l,o),p=h.dotVec3(d,c),f=h.dotVec3(d,n),g=1-u*u;if(Math.abs(g)>1e-10){const e=(p-u*f)/g;return h.addVec3(l,h.mulVec3Scalar(c,e,o),o),!0}return!1}}(),P=h.vec3(),S=h.vec3();g[E.id]=g[x.id]={setActivated:e=>U.visible=e,initDragAction:e=>T(e,P)&&h.subVec3(P,a,P)&&(e=>{T(e,S)&&(h.subVec3(S,P,S),this._setPosition(S),this._handlers&&this._handlers.onPosition(S))})},g[m.id]={setActivated:e=>B.visible=e,initDragAction:t=>{const i=function(){const t=s.camera.projectWorldPos(a);I(e,S),h.transformVec3(s.camera.normalMatrix,S,S);const i=Math.sign(S[2]);return e=>{const s=e[0]-t[0],r=e[1]-t[1];return i*Math.atan2(-r,s)}}();let r=i(t);return t=>{const s=i(t);o.rotate(e,180*(s-r)/Math.PI),this._handlers&&this._handlers.onQuaternion(o.quaternion),r=s}}};let D=!1,k=!1,Q=!1;const R=()=>{const e=Q&&D;E.visible=x.visible=M.visible=F.visible=!!e,e||(U.visible=!1)},O=()=>{const e=Q&&k;m.visible=u.visible=_.visible=b.visible=!!e,e||(B.visible=!1)};return{setPositionActive:e=>{D=e,R()},setRotationActive:e=>{k=e,O()},set visible(e){Q=e,R(),O()}}};this._displayMeshes={center:o.addChild(new dt(o,{geometry:new pe(o,Ce({radius:.05})),material:new bt(o,{diffuse:[0,0,0],emissive:[0,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80}),pickable:!1,collidable:!0,clippable:!1,visible:!1,isObject:!1}),r),x:m([1,0,0],h.vec3PairToQuaternion([1,0,0],[0,0,1])),y:m([0,1,0],h.eulerToQuaternion([90,0,0],"XYZ")),z:m([0,0,1],h.identityQuaternion())};const _=[];{let e=-1;const t=e=>{o.scale[0]!==e&&(o.scale=[e,e,e],this._handlers&&this._handlers.onScreenScale&&this._handlers.onScreenScale(o.scale))},i=s.on("tick",(()=>{const i=s.camera,r=Math.abs(h.distVec3(i.eye,a));"perspective"===i.projection?r!==e&&t(.07*r*Math.tan(i.perspective.fov*h.DEGTORAD)):"ortho"===i.projection&&t(i.ortho.scale/10),e=r}));_.push((()=>s.off(i)))}{let e=null,r=null;_.push((()=>{r&&r.cleanup()}));const n=h.vec2(),A=(e,t)=>{t[0]=e.pageX,t[1]=e.pageY,Ep(i.ownerDocument.documentElement,i,t)},o=e=>{A(e,n);const t=s.pick({canvasPos:n}),i=t&&t.entity,r=i&&i.id;return r in g&&g[r]},a=(e,s)=>{const i=o(s(e));if(i){r&&r.cleanup();const e=i.initDragAction(n);return e&&(t.pointerEnabled=!1,i.setActivated(!0),r={onChange:t=>{const i=s(t);i&&(A(i,n),e(n))},cleanup:function(){r=null,t.pointerEnabled=!0,i.setActivated(!1)}}),!!e}return!1},l=(e,t)=>{i.addEventListener(e,t),_.push((()=>i.removeEventListener(e,t)))},c=e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()};l("mousedown",(e=>{1===e.which&&a(e,(e=>1===e.which&&e))&&c(e)})),l("mousemove",(t=>{if(r)r.onChange(t),c(t);else{e&&e();const s=o(t);s?(s.setActivated(!0),e=()=>s.setActivated(!1)):e=null}})),l("mouseup",(e=>{r&&(r.onChange(e),r.cleanup())})),l("touchstart",(e=>{if(e.preventDefault(),1===e.touches.length){const t=e.touches[0].identifier;a(e,(e=>[...e.changedTouches].find((e=>e.identifier===t))))&&c(e)}})),l("touchmove",(e=>{r&&(r.onChange(e),c(e))})),l("touchend",(e=>{r&&(r.onChange(e),r.cleanup())}))}this.__destroy=()=>{_.forEach((e=>e())),o.destroy();for(let e in g)delete g[e]}}destroy(){this.__destroy()}setHandlers(e){Object.values(this._displayMeshes).forEach((t=>t.visible=!!e)),this._handlers=e,this._displayMeshes.x.setPositionActive(e&&e.onPosition),this._displayMeshes.y.setPositionActive(e&&e.onPosition),this._displayMeshes.z.setPositionActive(e&&e.onPosition),this._displayMeshes.x.setRotationActive(e&&e.onQuaternion),this._displayMeshes.y.setRotationActive(e&&e.onQuaternion),this._displayMeshes.z.setRotationActive(e&&e.onQuaternion)}setPosition(e){this._setPosition(e)}setQuaternion(e){this._setQuaternion(e)}}class ZB{constructor(e,t,s){this.id=s.id,this._sectionPlane=s,this._mesh=new dt(t,{id:s.id,geometry:new pe(t,be({xSize:.5,ySize:.5,zSize:.001})),material:new bt(t,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new jt(t,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Nt(t,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Nt(t,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});{const e=h.vec3([0,0,0]),t=h.vec3(),s=h.vec3([0,0,1]),i=h.vec4(4),r=h.vec3(),n=()=>{const n=this._sectionPlane.scene.center,A=[-this._sectionPlane.dir[0],-this._sectionPlane.dir[1],-this._sectionPlane.dir[2]];h.subVec3(n,this._sectionPlane.pos,e);const o=-h.dotVec3(A,e);h.normalizeVec3(A),h.mulVec3Scalar(A,o,t);const a=h.vec3PairToQuaternion(s,this._sectionPlane.dir,i);r[0]=.1*t[0],r[1]=.1*t[1],r[2]=.1*t[2],this._mesh.quaternion=a,this._mesh.position=r};this._onSectionPlanePos=this._sectionPlane.on("pos",n),this._onSectionPlaneDir=this._sectionPlane.on("dir",n)}this._highlighted=!1,this._selected=!1}setHighlighted(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}getHighlighted(){return this._highlighted}setSelected(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}getSelected(){return this._selected}destroy(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}class JB{constructor(e,t){if(!(t.onHoverEnterPlane&&t.onHoverLeavePlane&&t.onClickedNothing&&t.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=e,this._viewer=e.viewer,this._onHoverEnterPlane=t.onHoverEnterPlane,this._onHoverLeavePlane=t.onHoverLeavePlane,this._onClickedNothing=t.onClickedNothing,this._onClickedPlane=t.onClickedPlane,this._visible=!0,this._planes={},this._canvas=t.overviewCanvas,this._scene=new BA(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new Cr(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new Cr(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new Cr(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;{const e=this._scene.camera,t=h.rotationMat4c(-90*h.DEGTORAD,1,0,0),s=h.vec3(),i=h.vec3(),r=h.vec3();this._synchCamera=()=>{const n=this._viewer.camera.eye,A=this._viewer.camera.look,o=this._viewer.camera.up;h.mulVec3Scalar(h.normalizeVec3(h.subVec3(n,A,s)),7),this._zUp?(h.transformVec3(t,s,i),h.transformVec3(t,o,r),e.look=[0,0,0],e.eye=h.transformVec3(t,s,i),e.up=h.transformPoint3(t,o,r)):(e.look=[0,0,0],e.eye=s,e.up=o)}}this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(e=>{this._scene.camera.perspective.fov=e}));var s=null;this._onInputMouseMove=this._scene.input.on("mousemove",(e=>{const t=this._scene.pick({canvasPos:e});if(t){if(!s||t.entity.id!==s.id){if(s){this._planes[s.id]&&this._onHoverLeavePlane(s.id)}s=t.entity;this._planes[s.id]&&this._onHoverEnterPlane(s.id)}}else s&&(this._onHoverLeavePlane(s.id),s=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=()=>{if(s){this._planes[s.id]&&this._onClickedPlane(s.id)}else this._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=()=>{s&&(this._onHoverLeavePlane(s.id),s=null)}),this.setVisible(t.overviewVisible)}addSectionPlane(e){this._planes[e.id]=new ZB(this,this._scene,e)}setPlaneHighlighted(e,t){const s=this._planes[e];s&&s.setHighlighted(t)}setPlaneSelected(e,t){const s=this._planes[e];s&&s.setSelected(t)}removeSectionPlane(e){const t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}setVisible(e=!0){this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}getVisible(){return this._visible}destroy(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}const YB=h.AABB3(),$B=h.vec3();class qB{constructor(e,t,s,i,r,n){this.plugin=e,this.storeyId=r,this.modelId=i,this.storeyAABB=s.slice(),this.aabb=this.storeyAABB,this.modelAABB=t.slice(),this.numObjects=n}}class ey{constructor(e,t,s,i,r,n){this.storeyId=e,this.imageData=t,this.format=s,this.width=i,this.height=r}}const ty=h.vec3(),sy=h.mat4();const iy=new Float64Array([0,0,1]),ry=new Float64Array(4);class ny{constructor(e){this.id=null,this._viewer=e.viewer,this._plugin=e,this._visible=!1,this._pos=h.vec3(),this._origin=h.vec3(),this._rtcPos=h.vec3(),this._baseDir=h.vec3(),this._rootNode=null,this._displayMeshes=null,this._affordanceMeshes=null,this._ignoreNextSectionPlaneDirUpdate=!1,this._createNodes(),this._bindEvents()}_setSectionPlane(e){this._sectionPlane&&(this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._onSectionPlanePos=null,this._onSectionPlaneDir=null,this._sectionPlane=null),e&&(this.id=e.id,this._setPos(e.pos),this._setDir(e.dir),this._sectionPlane=e,this._onSectionPlanePos=e.on("pos",(()=>{this._setPos(this._sectionPlane.pos)})),this._onSectionPlaneDir=e.on("dir",(()=>{this._ignoreNextSectionPlaneDirUpdate?this._ignoreNextSectionPlaneDirUpdate=!1:this._setDir(this._sectionPlane.dir)})))}get sectionPlane(){return this._sectionPlane}_setPos(e){this._pos.set(e),Ne(this._pos,this._origin,this._rtcPos),this._rootNode.origin=this._origin,this._rootNode.position=this._rtcPos}_setDir(e){this._baseDir.set(e),this._rootNode.quaternion=h.vec3PairToQuaternion(iy,e,ry)}_setSectionPlaneDir(e){this._sectionPlane&&(this._ignoreNextSectionPlaneDirUpdate=!0,this._sectionPlane.dir=e)}setVisible(e=!0){if(this._visible!==e){var t;for(t in this._visible=e,this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].visible=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].visible=e)}}getVisible(){return this._visible}setCulled(e){var t;for(t in this._displayMeshes)this._displayMeshes.hasOwnProperty(t)&&(this._displayMeshes[t].culled=e);if(!e)for(t in this._affordanceMeshes)this._affordanceMeshes.hasOwnProperty(t)&&(this._affordanceMeshes[t].culled=e)}_createNodes(){const e=!1,t=this._viewer.scene,s=.01;this._rootNode=new Ve(t,{position:[0,0,0],scale:[5,5,5]});const i=this._rootNode,r={arrowHead:new pe(i,ye({radiusTop:.001,radiusBottom:.07,radialSegments:32,heightSegments:1,height:.2,openEnded:!1})),arrowHeadBig:new pe(i,ye({radiusTop:.001,radiusBottom:.09,radialSegments:32,heightSegments:1,height:.25,openEnded:!1})),axis:new pe(i,ye({radiusTop:s,radiusBottom:s,radialSegments:20,heightSegments:1,height:1,openEnded:!1}))},n={red:new bt(i,{diffuse:[1,0,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),green:new bt(i,{diffuse:[0,1,0],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),blue:new bt(i,{diffuse:[0,0,1],emissive:[1,0,0],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),highlightRed:new Nt(i,{edges:!1,fill:!0,fillColor:[1,0,0],fillAlpha:.6})};this._displayMeshes={plane:i.addChild(new dt(i,{geometry:new pe(i,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new bt(i,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1]}),e),planeFrame:i.addChild(new dt(i,{geometry:new pe(i,Me({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new bt(i,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45]}),e),center:i.addChild(new dt(i,{geometry:new pe(i,Ce({radius:.05})),material:n.center,pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zAxisArrow:i.addChild(new dt(i,{geometry:r.arrowHead,material:n.blue,matrix:function(){const e=h.translateMat4c(0,1.1,0,h.identityMat4()),t=h.rotationMat4v(-90*h.DEGTORAD,[.8,0,0],h.identityMat4());return h.mulMat4(t,e,h.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e),zShaft:i.addChild(new dt(i,{geometry:r.axis,material:n.blue,matrix:function(){const e=h.translateMat4c(0,.5,0,h.identityMat4()),t=h.rotationMat4v(-90*h.DEGTORAD,[1,0,0],h.identityMat4());return h.mulMat4(t,e,h.identityMat4())}(),clippable:!1,pickable:!1,collidable:!0,visible:!1}),e)},this._affordanceMeshes={planeFrame:i.addChild(new dt(i,{geometry:new pe(i,Me({center:[0,0,0],radius:2,tube:s,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new bt(i,{ambient:[1,1,1],diffuse:[0,0,0],emissive:[1,1,0]}),highlighted:!0,highlightMaterial:new Nt(i,{edges:!1,filled:!0,fillColor:[1,1,0],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,1],rotation:[0,0,45]}),e),zAxisArrow:i.addChild(new dt(i,{geometry:r.arrowHeadBig,material:n.blue,matrix:function(){const e=h.translateMat4c(0,1.1,0,h.identityMat4()),t=h.rotationMat4v(-90*h.DEGTORAD,[.8,0,0],h.identityMat4());return h.mulMat4(t,e,h.identityMat4())}(),pickable:!1,collidable:!0,clippable:!1,visible:!1}),e)}}_bindEvents(){const e=this._rootNode,t=h.vec2(),s=this._viewer.camera,i=this._viewer.scene;let r=0,n=!1;{const t=h.vec3([0,0,0]);let A=-1;this._onCameraViewMatrix=i.camera.on("viewMatrix",(()=>{})),this._onCameraProjMatrix=i.camera.on("projMatrix",(()=>{})),this._onSceneTick=i.on("tick",(()=>{n=!1;const a=Math.abs(h.lenVec3(h.subVec3(i.camera.eye,this._pos,t)));if(a!==A&&"perspective"===s.projection){const t=.07*(Math.tan(s.perspective.fov*h.DEGTORAD)*a);e.scale=[t,t,t],A=a}if("ortho"===s.projection){const t=s.ortho.scale/10;e.scale=[t,t,t],A=a}0!==r&&(o(r),r=0)}))}const A=function(){const e=new Float64Array(2);return function(t){if(t){for(var s=t.target,i=0,r=0;s.offsetParent;)i+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;e[0]=t.pageX-i,e[1]=t.pageY-r}else t=window.event,e[0]=t.x,e[1]=t.y;return e}}(),o=e=>{const t=this._sectionPlane.pos,s=this._sectionPlane.dir;h.addVec3(t,h.mulVec3Scalar(s,.1*e*this._plugin.getDragSensitivity(),h.vec3())),this._sectionPlane.pos=t};{let e=!1;this._plugin._controlElement.addEventListener("mousedown",this._canvasMouseDownListener=s=>{if(s.preventDefault(),this._visible&&(this._viewer.cameraControl.pointerEnabled=!1,1===s.which)){e=!0;var i=A(s);t[0]=i[0],t[1]=i[1]}}),this._plugin._controlElement.addEventListener("mousemove",this._canvasMouseMoveListener=s=>{if(!this._visible)return;if(!e)return;if(n)return;var i=A(s);const r=i[0],a=i[1];o(a-t[1]),t[0]=r,t[1]=a}),this._plugin._controlElement.addEventListener("mouseup",this._canvasMouseUpListener=t=>{this._visible&&(this._viewer.cameraControl.pointerEnabled=!0,e&&(t.which,e=!1))}),this._plugin._controlElement.addEventListener("wheel",this._canvasWheelListener=e=>{this._visible&&(r+=Math.max(-1,Math.min(1,40*-e.deltaY)))})}{let e,t,s=null;this._plugin._controlElement.addEventListener("touchstart",this._handleTouchStart=t=>{t.stopPropagation(),t.preventDefault(),this._visible&&(e=t.touches[0].clientY,s=e,r=0)}),this._plugin._controlElement.addEventListener("touchmove",this._handleTouchMove=e=>{e.stopPropagation(),e.preventDefault(),this._visible&&(n||(n=!0,t=e.touches[0].clientY,null!==s&&(r+=t-s),s=t))}),this._plugin._controlElement.addEventListener("touchend",this._handleTouchEnd=s=>{s.stopPropagation(),s.preventDefault(),this._visible&&(e=null,t=null,r=0)})}}_destroy(){this._unbindEvents(),this._destroyNodes()}_unbindEvents(){const e=this._viewer,t=e.scene,s=t.canvas.canvas,i=e.camera,r=this._plugin._controlElement;t.off(this._onSceneTick),s.removeEventListener("mousedown",this._canvasMouseDownListener),s.removeEventListener("mousemove",this._canvasMouseMoveListener),s.removeEventListener("mouseup",this._canvasMouseUpListener),s.removeEventListener("wheel",this._canvasWheelListener),r.removeEventListener("touchstart",this._handleTouchStart),r.removeEventListener("touchmove",this._handleTouchMove),r.removeEventListener("touchend",this._handleTouchEnd),i.off(this._onCameraViewMatrix),i.off(this._onCameraProjMatrix)}_destroyNodes(){this._setSectionPlane(null),this._rootNode.destroy(),this._displayMeshes={},this._affordanceMeshes={}}}class Ay{constructor(e,t,s){this.id=s.id,this._sectionPlane=s,this._mesh=new dt(t,{id:s.id,geometry:new pe(t,be({xSize:.5,ySize:.5,zSize:.001})),material:new bt(t,{emissive:[1,1,1],diffuse:[0,0,0],backfaces:!1}),edgeMaterial:new jt(t,{edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),highlightMaterial:new Nt(t,{fill:!0,fillColor:[.5,1,.5],fillAlpha:.7,edges:!0,edgeColor:[0,0,0],edgeAlpha:1,edgeWidth:1}),selectedMaterial:new Nt(t,{fill:!0,fillColor:[0,0,1],fillAlpha:.7,edges:!0,edgeColor:[1,0,0],edgeAlpha:1,edgeWidth:1}),highlighted:!0,scale:[3,3,3],position:[0,0,0],rotation:[0,0,0],opacity:.3,edges:!0});{const e=h.vec3([0,0,0]),t=h.vec3(),s=h.vec3([0,0,1]),i=h.vec4(4),r=h.vec3(),n=()=>{const n=this._sectionPlane.scene.center,A=[-this._sectionPlane.dir[0],-this._sectionPlane.dir[1],-this._sectionPlane.dir[2]];h.subVec3(n,this._sectionPlane.pos,e);const o=-h.dotVec3(A,e);h.normalizeVec3(A),h.mulVec3Scalar(A,o,t);const a=h.vec3PairToQuaternion(s,this._sectionPlane.dir,i);r[0]=.1*t[0],r[1]=.1*t[1],r[2]=.1*t[2],this._mesh.quaternion=a,this._mesh.position=r};this._onSectionPlanePos=this._sectionPlane.on("pos",n),this._onSectionPlaneDir=this._sectionPlane.on("dir",n)}this._highlighted=!1,this._selected=!1}setHighlighted(e){this._highlighted=!!e,this._mesh.highlighted=this._highlighted,this._mesh.highlightMaterial.fillColor=e?[0,.7,0]:[0,0,0]}getHighlighted(){return this._highlighted}setSelected(e){this._selected=!!e,this._mesh.edgeMaterial.edgeWidth=e?3:1,this._mesh.highlightMaterial.edgeWidth=e?3:1}getSelected(){return this._selected}destroy(){this._sectionPlane.off(this._onSectionPlanePos),this._sectionPlane.off(this._onSectionPlaneDir),this._mesh.destroy()}}class oy{constructor(e,t){if(!(t.onHoverEnterPlane&&t.onHoverLeavePlane&&t.onClickedNothing&&t.onClickedPlane))throw"Missing config(s): onHoverEnterPlane, onHoverLeavePlane, onClickedNothing || onClickedPlane";this.plugin=e,this._viewer=e.viewer,this._onHoverEnterPlane=t.onHoverEnterPlane,this._onHoverLeavePlane=t.onHoverLeavePlane,this._onClickedNothing=t.onClickedNothing,this._onClickedPlane=t.onClickedPlane,this._visible=!0,this._planes={},this._canvas=t.overviewCanvas,this._scene=new BA(this._viewer,{canvasId:this._canvas.id,transparent:!0}),this._scene.clearLights(),new Cr(this._scene,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new Cr(this._scene,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new Cr(this._scene,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._scene.camera,this._scene.camera.perspective.fov=70,this._zUp=!1;{const e=this._scene.camera,t=h.rotationMat4c(-90*h.DEGTORAD,1,0,0),s=h.vec3(),i=h.vec3(),r=h.vec3();this._synchCamera=()=>{const n=this._viewer.camera.eye,A=this._viewer.camera.look,o=this._viewer.camera.up;h.mulVec3Scalar(h.normalizeVec3(h.subVec3(n,A,s)),7),this._zUp?(h.transformVec3(t,s,i),h.transformVec3(t,o,r),e.look=[0,0,0],e.eye=h.transformVec3(t,s,i),e.up=h.transformPoint3(t,o,r)):(e.look=[0,0,0],e.eye=s,e.up=o)}}this._onViewerCameraMatrix=this._viewer.camera.on("matrix",this._synchCamera),this._onViewerCameraWorldAxis=this._viewer.camera.on("worldAxis",this._synchCamera),this._onViewerCameraFOV=this._viewer.camera.perspective.on("fov",(e=>{this._scene.camera.perspective.fov=e}));var s=null;this._onInputMouseMove=this._scene.input.on("mousemove",(e=>{const t=this._scene.pick({canvasPos:e});if(t){if(!s||t.entity.id!==s.id){if(s){this._planes[s.id]&&this._onHoverLeavePlane(s.id)}s=t.entity;this._planes[s.id]&&this._onHoverEnterPlane(s.id)}}else s&&(this._onHoverLeavePlane(s.id),s=null)})),this._scene.canvas.canvas.addEventListener("mouseup",this._onCanvasMouseUp=()=>{if(s){this._planes[s.id]&&this._onClickedPlane(s.id)}else this._onClickedNothing()}),this._scene.canvas.canvas.addEventListener("mouseout",this._onCanvasMouseOut=()=>{s&&(this._onHoverLeavePlane(s.id),s=null)}),this.setVisible(t.overviewVisible)}addSectionPlane(e){this._planes[e.id]=new Ay(this,this._scene,e)}setPlaneHighlighted(e,t){const s=this._planes[e];s&&s.setHighlighted(t)}setPlaneSelected(e,t){const s=this._planes[e];s&&s.setSelected(t)}removeSectionPlane(e){const t=this._planes[e.id];t&&(t.destroy(),delete this._planes[e.id])}setVisible(e=!0){this._visible=e,this._canvas.style.visibility=e?"visible":"hidden"}getVisible(){return this._visible}destroy(){this._viewer.camera.off(this._onViewerCameraMatrix),this._viewer.camera.off(this._onViewerCameraWorldAxis),this._viewer.camera.perspective.off(this._onViewerCameraFOV),this._scene.input.off(this._onInputMouseMove),this._scene.canvas.canvas.removeEventListener("mouseup",this._onCanvasMouseUp),this._scene.canvas.canvas.removeEventListener("mouseout",this._onCanvasMouseOut),this._scene.destroy()}}const ay=h.AABB3(),ly=h.vec3();class cy{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getSTL(e,t,s){e=this._cacheBusterURL(e);const i=new XMLHttpRequest;i.overrideMimeType("application/json"),i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s(i.statusText))},i.send(null)}}const hy=h.vec3();class uy{load(e,t,s,i,r,n){i=i||{};const A=e.viewer.scene.canvas.spinner;A.processes++,e.dataSource.getSTL(s,(function(s){!function(e,t,s,i){try{const r=_y(s);dy(r)?py(e,r,t,i):fy(e,my(s),t,i)}catch(e){t.fire("error",e)}}(e,t,s,i);try{const n=_y(s);dy(n)?py(e,n,t,i):fy(e,my(s),t,i),A.processes--,F.scheduleTask((function(){t.fire("loaded",!0,!1)})),r&&r()}catch(s){A.processes--,e.error(s),n&&n(s),t.fire("error",s)}}),(function(s){A.processes--,e.error(s),n&&n(s),t.fire("error",s)}))}parse(e,t,s,i){const r=e.viewer.scene.canvas.spinner;r.processes++;try{const n=_y(s);dy(n)?py(e,n,t,i):fy(e,my(s),t,i),r.processes--,F.scheduleTask((function(){t.fire("loaded",!0,!1)}))}catch(e){r.processes--,t.fire("error",e)}}}function dy(e){const t=new DataView(e);if(84+50*t.getUint32(80,!0)===t.byteLength)return!0;const s=[115,111,108,105,100];for(var i=0;i<5;i++)if(s[i]!==t.getUint8(i,!1))return!0;return!1}function py(e,t,s,i){const r=new DataView(t),n=r.getUint32(80,!0);let A,o,a,l,c,h,u,d=!1,p=null,f=null,g=null,m=!1;for(let e=0;e<70;e++)1129270351===r.getUint32(e,!1)&&82===r.getUint8(e+4)&&61===r.getUint8(e+5)&&(d=!0,l=[],c=r.getUint8(e+6)/255,h=r.getUint8(e+7)/255,u=r.getUint8(e+8)/255,r.getUint8(e+9));const _=new Rt(s,{roughness:.5});let b=[],B=[],y=i.splitMeshes;for(let e=0;e<n;e++){let t=84+50*e,n=r.getFloat32(t,!0),w=r.getFloat32(t+4,!0),v=r.getFloat32(t+8,!0);if(d){let e=r.getUint16(t+48,!0);0==(32768&e)?(A=(31&e)/31,o=(e>>5&31)/31,a=(e>>10&31)/31):(A=c,o=h,a=u),(y&&A!==p||o!==f||a!==g)&&(null!==p&&(m=!0),p=A,f=o,g=a)}for(let e=1;e<=3;e++){let s=t+12*e;b.push(r.getFloat32(s,!0)),b.push(r.getFloat32(s+4,!0)),b.push(r.getFloat32(s+8,!0)),B.push(n,w,v),d&&l.push(A,o,a,1)}y&&m&&(gy(s,b,B,l,_,i),b=[],B=[],l=l?[]:null,m=!1)}b.length>0&&gy(s,b,B,l,_,i)}function fy(e,t,s,i){const r=/facet([\s\S]*?)endfacet/g;let n=0;const A=/[\s]+([+-]?(?:\d+.\d+|\d+.|\d+|.\d+)(?:[eE][+-]?\d+)?)/.source,o=new RegExp("vertex"+A+A+A,"g"),a=new RegExp("normal"+A+A+A,"g"),l=[],c=[];let h,u,d,p,f,g,m;for(;null!==(p=r.exec(t));){for(f=0,g=0,m=p[0];null!==(p=a.exec(m));)h=parseFloat(p[1]),u=parseFloat(p[2]),d=parseFloat(p[3]),g++;for(;null!==(p=o.exec(m));)l.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),c.push(h,u,d),f++;1!==g&&e.error("Error in normal of face "+n),3!==f&&e.error("Error in positions of face "+n),n++}gy(s,l,c,null,new Rt(s,{roughness:.5}),i)}function gy(e,t,s,i,r,n){const A=new Int32Array(t.length/3);for(let e=0,t=A.length;e<t;e++)A[e]=e;s=s&&s.length>0?s:null,i=i&&i.length>0?i:null,n.smoothNormals&&h.faceToVertexNormals(t,s,n);const o=hy;Ge(t,t,o);const a=new pe(e,{primitive:"triangles",positions:t,normals:s,colors:i,indices:A}),l=new dt(e,{origin:0!==o[0]||0!==o[1]||0!==o[2]?o:null,geometry:a,material:r,edges:n.edges});e.addChild(l)}function my(e){return"string"!=typeof e?function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let s=0,i=e.length;s<i;s++)t+=String.fromCharCode(e[s]);return decodeURIComponent(escape(t))}(new Uint8Array(e)):e}function _y(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=255&e.charCodeAt(s);return t.buffer||t}return e}class by{constructor(e){this._treeViewContainer=e}createRootNode(){return document.createElement("ul")}createNodeElement(e,t,s,i,r){const n=document.createElement("li");if(n.id=e.nodeId,e.xrayed&&n.classList.add("xrayed-node"),e.children.length>0){const s=document.createElement("a");s.href="#",s.id=`switch-${e.nodeId}`,s.textContent="+",s.classList.add("plus"),t&&s.addEventListener("click",t),n.appendChild(s)}const A=document.createElement("input");A.id=`checkbox-${e.nodeId}`,A.type="checkbox",A.checked=e.checked,A.style["pointer-events"]="all",s&&A.addEventListener("change",s),n.appendChild(A);const o=document.createElement("span");return o.textContent=e.title,n.appendChild(o),i&&ap(o,i),r&&(o.onclick=r),n}createDisabledNodeElement(e){const t=document.createElement("li"),s=document.createElement("a");s.href="#",s.textContent="!",s.classList.add("warn"),s.classList.add("warning"),t.appendChild(s);const i=document.createElement("span");return i.textContent=e,t.appendChild(i),t}addChildren(e,t){const s=document.createElement("ul");t.forEach((e=>{s.appendChild(e)})),e.parentElement.appendChild(s)}expand(e,t,s){e.classList.remove("plus"),e.classList.add("minus"),e.textContent="-",e.removeEventListener("click",t),e.addEventListener("click",s)}collapse(e,t,s){if(!e)return;const i=e.parentElement;if(!i)return;const r=i.querySelector("ul");r&&(i.removeChild(r),e.classList.remove("minus"),e.classList.add("plus"),e.textContent="+",e.removeEventListener("click",s),e.addEventListener("click",t))}isExpanded(e){return void 0!==e.parentElement.getElementsByTagName("li")[0]}getId(e){return e.parentElement.id}getIdFromCheckbox(e){return e.id.replace("checkbox-","")}getSwitchElement(e){return this._treeViewContainer.querySelector(`[id="switch-${e}"]`)}isChecked(e){return e.checked}setCheckbox(e,t,s=!1){const i=this._treeViewContainer.querySelector(`[id="checkbox-${e}"]`);i&&(t!==i.checked&&(i.checked=t),s!==i.indeterminate&&(i.indeterminate=s,s&&(i.checked=!1)))}setXRayed(e,t){const s=this._treeViewContainer.querySelector(`[id="${e}"]`);s&&(t?s.classList.add("xrayed-node"):s.classList.remove("xrayed-node"))}setHighlighted(e,t){const s=this._treeViewContainer.querySelector(`[id="${e}"]`);s&&(t?(s.scrollIntoView({block:"center"}),s.classList.add("highlighted-node")):s.classList.remove("highlighted-node"))}}const By=[];class yy{constructor(e){this._scene=e,this._objects=[],this._objectsViewCulled=[],this._objectsDetailCulled=[],this._objectsChanged=[],this._objectsChangedList=[],this._modelInfos={},this._numObjects=0,this._lenObjectsChangedList=0,this._dirty=!0,this._onModelLoaded=e.on("modelLoaded",(t=>{const s=e.models[t];s&&this._addModel(s)})),this._onTick=e.on("tick",(()=>{this._dirty&&this._build(),this._applyChanges()}))}_addModel(e){const t={model:e,onDestroyed:e.on("destroyed",(()=>{this._removeModel(e)}))};this._modelInfos[e.id]=t,this._dirty=!0}_removeModel(e){const t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._dirty=!0)}_build(){if(!this._dirty)return;this._applyChanges();const e=this._scene.objects;for(let e=0;e<this._numObjects;e++)this._objects[e]=null;this._numObjects=0;for(let t in e){const s=e[t];this._objects[this._numObjects++]=s}this._lenObjectsChangedList=0,this._dirty=!1}_applyChanges(){if(this._lenObjectsChangedList>0){for(let e=0;e<this._lenObjectsChangedList;e++){const t=this._objectsChangedList[e],s=this._objects[t],i=this._objectsViewCulled[t],r=this._objectsDetailCulled[t],n=i||r;s.culled=n,this._objectsChanged[t]=!1}this._lenObjectsChangedList=0}}get objects(){return this._dirty&&this._build(),this._objects}get numObjects(){return this._dirty&&this._build(),this._numObjects}setObjectViewCulled(e,t){this._dirty&&this._build(),this._objectsViewCulled[e]!==t&&(this._objectsViewCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}setObjectDetailCulled(e,t){this._dirty&&this._build(),this._objectsDetailCulled[e]!==t&&(this._objectsDetailCulled[e]=t,this._objectsChanged[e]||(this._objectsChanged[e]=!0,this._objectsChangedList[this._lenObjectsChangedList++]=e))}_destroy(){this._clear(),this._scene.off(this._onModelLoaded),this._scene.off(this._onTick)}_clear(){for(let e in this._modelInfos){const t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._dirty=!0}}const wy={};const vy=new Float32Array(3);class Cy{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getManifest(e,t,s){_.loadJSON(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}getMetaModel(e,t,s){_.loadJSON(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}getXKT(e,t,s){var i=()=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var n=r[3];n=window.decodeURIComponent(n),e&&(n=window.atob(n));try{const e=new ArrayBuffer(n.length),s=new Uint8Array(e);for(var A=0;A<n.length;A++)s[A]=n.charCodeAt(A);t(e)}catch(e){s(e)}}else{const i=new XMLHttpRequest;i.open("GET",this._cacheBusterURL(e),!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("getXKT error : "+i.response))},i.send(null)}}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).pako={})}(void 0,(function(e){function t(e){let t=e.length;for(;--t>=0;)e[t]=0}const s=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),i=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),n=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),A=new Array(576);t(A);const o=new Array(60);t(o);const a=new Array(512);t(a);const l=new Array(256);t(l);const c=new Array(29);t(c);const h=new Array(30);function u(e,t,s,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=i,this.max_length=r,this.has_stree=e&&e.length}let d,p,f;function g(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}t(h);const m=e=>e<256?a[e]:a[256+(e>>>7)],_=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},b=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,_(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},B=(e,t,s)=>{b(e,s[2*t],s[2*t+1])},y=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},w=(e,t,s)=>{const i=new Array(16);let r,n,A=0;for(r=1;r<=15;r++)A=A+s[r-1]<<1,i[r]=A;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=y(i[t]++,t))}},v=e=>{let t;for(t=0;t<286;t++)e.dyn_ltree[2*t]=0;for(t=0;t<30;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},C=e=>{e.bi_valid>8?_(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},M=(e,t,s,i)=>{const r=2*t,n=2*s;return e[r]<e[n]||e[r]===e[n]&&i[t]<=i[s]},E=(e,t,s)=>{const i=e.heap[s];let r=s<<1;for(;r<=e.heap_len&&(r<e.heap_len&&M(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!M(t,i,e.heap[r],e.depth));)e.heap[s]=e.heap[r],s=r,r<<=1;e.heap[s]=i},F=(e,t,r)=>{let n,A,o,a,u=0;if(0!==e.sym_next)do{n=255&e.pending_buf[e.sym_buf+u++],n+=(255&e.pending_buf[e.sym_buf+u++])<<8,A=e.pending_buf[e.sym_buf+u++],0===n?B(e,A,t):(o=l[A],B(e,o+256+1,t),a=s[o],0!==a&&(A-=c[o],b(e,A,a)),n--,o=m(n),B(e,o,r),a=i[o],0!==a&&(n-=h[o],b(e,n,a)))}while(u<e.sym_next);B(e,256,t)},x=(e,t)=>{const s=t.dyn_tree,i=t.stat_desc.static_tree,r=t.stat_desc.has_stree,n=t.stat_desc.elems;let A,o,a,l=-1;for(e.heap_len=0,e.heap_max=573,A=0;A<n;A++)0!==s[2*A]?(e.heap[++e.heap_len]=l=A,e.depth[A]=0):s[2*A+1]=0;for(;e.heap_len<2;)a=e.heap[++e.heap_len]=l<2?++l:0,s[2*a]=1,e.depth[a]=0,e.opt_len--,r&&(e.static_len-=i[2*a+1]);for(t.max_code=l,A=e.heap_len>>1;A>=1;A--)E(e,s,A);a=n;do{A=e.heap[1],e.heap[1]=e.heap[e.heap_len--],E(e,s,1),o=e.heap[1],e.heap[--e.heap_max]=A,e.heap[--e.heap_max]=o,s[2*a]=s[2*A]+s[2*o],e.depth[a]=(e.depth[A]>=e.depth[o]?e.depth[A]:e.depth[o])+1,s[2*A+1]=s[2*o+1]=a,e.heap[1]=a++,E(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,i=t.max_code,r=t.stat_desc.static_tree,n=t.stat_desc.has_stree,A=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,a=t.stat_desc.max_length;let l,c,h,u,d,p,f=0;for(u=0;u<=15;u++)e.bl_count[u]=0;for(s[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<573;l++)c=e.heap[l],u=s[2*s[2*c+1]+1]+1,u>a&&(u=a,f++),s[2*c+1]=u,c>i||(e.bl_count[u]++,d=0,c>=o&&(d=A[c-o]),p=s[2*c],e.opt_len+=p*(u+d),n&&(e.static_len+=p*(r[2*c+1]+d)));if(0!==f){do{for(u=a-1;0===e.bl_count[u];)u--;e.bl_count[u]--,e.bl_count[u+1]+=2,e.bl_count[a]--,f-=2}while(f>0);for(u=a;0!==u;u--)for(c=e.bl_count[u];0!==c;)h=e.heap[--l],h>i||(s[2*h+1]!==u&&(e.opt_len+=(u-s[2*h+1])*s[2*h],s[2*h+1]=u),c--)}})(e,t),w(s,l,e.bl_count)},U=(e,t,s)=>{let i,r,n=-1,A=t[1],o=0,a=7,l=4;for(0===A&&(a=138,l=3),t[2*(s+1)+1]=65535,i=0;i<=s;i++)r=A,A=t[2*(i+1)+1],++o<a&&r===A||(o<l?e.bl_tree[2*r]+=o:0!==r?(r!==n&&e.bl_tree[2*r]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,n=r,0===A?(a=138,l=3):r===A?(a=6,l=3):(a=7,l=4))},I=(e,t,s)=>{let i,r,n=-1,A=t[1],o=0,a=7,l=4;for(0===A&&(a=138,l=3),i=0;i<=s;i++)if(r=A,A=t[2*(i+1)+1],!(++o<a&&r===A)){if(o<l)do{B(e,r,e.bl_tree)}while(0!=--o);else 0!==r?(r!==n&&(B(e,r,e.bl_tree),o--),B(e,16,e.bl_tree),b(e,o-3,2)):o<=10?(B(e,17,e.bl_tree),b(e,o-3,3)):(B(e,18,e.bl_tree),b(e,o-11,7));o=0,n=r,0===A?(a=138,l=3):r===A?(a=6,l=3):(a=7,l=4)}};let T=!1;const P=(e,t,s,i)=>{b(e,0+(i?1:0),3),C(e),_(e,s),_(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var S={_tr_init:e=>{T||((()=>{let e,t,n,g,m;const _=new Array(16);for(n=0,g=0;g<28;g++)for(c[g]=n,e=0;e<1<<s[g];e++)l[n++]=g;for(l[n-1]=g,m=0,g=0;g<16;g++)for(h[g]=m,e=0;e<1<<i[g];e++)a[m++]=g;for(m>>=7;g<30;g++)for(h[g]=m<<7,e=0;e<1<<i[g]-7;e++)a[256+m++]=g;for(t=0;t<=15;t++)_[t]=0;for(e=0;e<=143;)A[2*e+1]=8,e++,_[8]++;for(;e<=255;)A[2*e+1]=9,e++,_[9]++;for(;e<=279;)A[2*e+1]=7,e++,_[7]++;for(;e<=287;)A[2*e+1]=8,e++,_[8]++;for(w(A,287,_),e=0;e<30;e++)o[2*e+1]=5,o[2*e]=y(e,5);d=new u(A,s,257,286,15),p=new u(o,i,0,30,15),f=new u(new Array(0),r,0,19,7)})(),T=!0),e.l_desc=new g(e.dyn_ltree,d),e.d_desc=new g(e.dyn_dtree,p),e.bl_desc=new g(e.bl_tree,f),e.bi_buf=0,e.bi_valid=0,v(e)},_tr_stored_block:P,_tr_flush_block:(e,t,s,i)=>{let r,a,l=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<256;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),x(e,e.l_desc),x(e,e.d_desc),l=(e=>{let t;for(U(e,e.dyn_ltree,e.l_desc.max_code),U(e,e.dyn_dtree,e.d_desc.max_code),x(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*n[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),r=e.opt_len+3+7>>>3,a=e.static_len+3+7>>>3,a<=r&&(r=a)):r=a=s+5,s+4<=r&&-1!==t?P(e,t,s,i):4===e.strategy||a===r?(b(e,2+(i?1:0),3),F(e,A,o)):(b(e,4+(i?1:0),3),((e,t,s,i)=>{let r;for(b(e,t-257,5),b(e,s-1,5),b(e,i-4,4),r=0;r<i;r++)b(e,e.bl_tree[2*n[r]+1],3);I(e,e.dyn_ltree,t-1),I(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),F(e,e.dyn_ltree,e.dyn_dtree)),v(e),i&&C(e)},_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(l[s]+256+1)]++,e.dyn_dtree[2*m(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{b(e,2,3),B(e,256,A),(e=>{16===e.bi_valid?(_(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},D=(e,t,s,i)=>{let r=65535&e|0,n=e>>>16&65535|0,A=0;for(;0!==s;){A=s>2e3?2e3:s,s-=A;do{r=r+t[i++]|0,n=n+r|0}while(--A);r%=65521,n%=65521}return r|n<<16|0};const k=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var Q=(e,t,s,i)=>{const r=k,n=i+s;e^=-1;for(let s=i;s<n;s++)e=e>>>8^r[255&(e^t[s])];return-1^e},R={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},O={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:V,_tr_stored_block:L,_tr_flush_block:H,_tr_tally:N,_tr_align:G}=S,{Z_NO_FLUSH:j,Z_PARTIAL_FLUSH:W,Z_FULL_FLUSH:z,Z_FINISH:X,Z_BLOCK:K,Z_OK:Z,Z_STREAM_END:J,Z_STREAM_ERROR:Y,Z_DATA_ERROR:$,Z_BUF_ERROR:q,Z_DEFAULT_COMPRESSION:ee,Z_FILTERED:te,Z_HUFFMAN_ONLY:se,Z_RLE:ie,Z_FIXED:re,Z_DEFAULT_STRATEGY:ne,Z_UNKNOWN:Ae,Z_DEFLATED:oe}=O,ae=258,le=262,ce=42,he=113,ue=666,de=(e,t)=>(e.msg=R[t],t),pe=e=>2*e-(e>4?9:0),fe=e=>{let t=e.length;for(;--t>=0;)e[t]=0},ge=e=>{let t,s,i,r=e.w_size;t=e.hash_size,i=t;do{s=e.head[--i],e.head[i]=s>=r?s-r:0}while(--t);t=r,i=t;do{s=e.prev[--i],e.prev[i]=s>=r?s-r:0}while(--t)};let me=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const _e=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},be=(e,t)=>{H(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,_e(e.strm)},Be=(e,t)=>{e.pending_buf[e.pending++]=t},ye=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},we=(e,t,s,i)=>{let r=e.avail_in;return r>i&&(r=i),0===r?0:(e.avail_in-=r,t.set(e.input.subarray(e.next_in,e.next_in+r),s),1===e.state.wrap?e.adler=D(e.adler,t,r,s):2===e.state.wrap&&(e.adler=Q(e.adler,t,r,s)),e.next_in+=r,e.total_in+=r,r)},ve=(e,t)=>{let s,i,r=e.max_chain_length,n=e.strstart,A=e.prev_length,o=e.nice_match;const a=e.strstart>e.w_size-le?e.strstart-(e.w_size-le):0,l=e.window,c=e.w_mask,h=e.prev,u=e.strstart+ae;let d=l[n+A-1],p=l[n+A];e.prev_length>=e.good_match&&(r>>=2),o>e.lookahead&&(o=e.lookahead);do{if(s=t,l[s+A]===p&&l[s+A-1]===d&&l[s]===l[n]&&l[++s]===l[n+1]){n+=2,s++;do{}while(l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&l[++n]===l[++s]&&n<u);if(i=ae-(u-n),n=u-ae,i>A){if(e.match_start=t,A=i,i>=o)break;d=l[n+A-1],p=l[n+A]}}}while((t=h[t&c])>a&&0!=--r);return A<=e.lookahead?A:e.lookahead},Ce=e=>{const t=e.w_size;let s,i,r;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-le)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),ge(e),i+=t),0===e.strm.avail_in)break;if(s=we(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=s,e.lookahead+e.insert>=3)for(r=e.strstart-e.insert,e.ins_h=e.window[r],e.ins_h=me(e,e.ins_h,e.window[r+1]);e.insert&&(e.ins_h=me(e,e.ins_h,e.window[r+3-1]),e.prev[r&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=r,r++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<le&&0!==e.strm.avail_in)},Me=(e,t)=>{let s,i,r,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,A=0,o=e.strm.avail_in;do{if(s=65535,r=e.bi_valid+42>>3,e.strm.avail_out<r)break;if(r=e.strm.avail_out-r,i=e.strstart-e.block_start,s>i+e.strm.avail_in&&(s=i+e.strm.avail_in),s>r&&(s=r),s<n&&(0===s&&t!==X||t===j||s!==i+e.strm.avail_in))break;A=t===X&&s===i+e.strm.avail_in?1:0,L(e,0,0,A),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,_e(e.strm),i&&(i>s&&(i=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,s-=i),s&&(we(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===A);return o-=e.strm.avail_in,o&&(o>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=o&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-o,e.strm.next_in),e.strstart),e.strstart+=o,e.insert+=o>e.w_size-e.insert?e.w_size-e.insert:o),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),A?4:t!==j&&t!==X&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(r=e.window_size-e.strstart,e.strm.avail_in>r&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,r+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),r>e.strm.avail_in&&(r=e.strm.avail_in),r&&(we(e.strm,e.window,e.strstart,r),e.strstart+=r,e.insert+=r>e.w_size-e.insert?e.w_size-e.insert:r),e.high_water<e.strstart&&(e.high_water=e.strstart),r=e.bi_valid+42>>3,r=e.pending_buf_size-r>65535?65535:e.pending_buf_size-r,n=r>e.w_size?e.w_size:r,i=e.strstart-e.block_start,(i>=n||(i||t===X)&&t!==j&&0===e.strm.avail_in&&i<=r)&&(s=i>r?r:i,A=t===X&&0===e.strm.avail_in&&s===i?1:0,L(e,e.block_start,s,A),e.block_start+=s,_e(e.strm)),A?3:1)},Ee=(e,t)=>{let s,i;for(;;){if(e.lookahead<le){if(Ce(e),e.lookahead<le&&t===j)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=me(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-le&&(e.match_length=ve(e,s)),e.match_length>=3)if(i=N(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=me(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=me(e,e.ins_h,e.window[e.strstart+1]);else i=N(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2},Fe=(e,t)=>{let s,i,r;for(;;){if(e.lookahead<le){if(Ce(e),e.lookahead<le&&t===j)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=me(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-le&&(e.match_length=ve(e,s),e.match_length<=5&&(e.strategy===te||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){r=e.strstart+e.lookahead-3,i=N(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=r&&(e.ins_h=me(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(be(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=N(e,0,e.window[e.strstart-1]),i&&be(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=N(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2};function xe(e,t,s,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=i,this.func=r}const Ue=[new xe(0,0,0,0,Me),new xe(4,4,8,4,Ee),new xe(4,5,16,8,Ee),new xe(4,6,32,32,Ee),new xe(4,4,16,16,Fe),new xe(8,16,32,32,Fe),new xe(8,16,128,128,Fe),new xe(8,32,128,256,Fe),new xe(32,128,258,1024,Fe),new xe(32,258,258,4096,Fe)];function Ie(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=oe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),fe(this.dyn_ltree),fe(this.dyn_dtree),fe(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),fe(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),fe(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Te=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==ce&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==he&&t.status!==ue?1:0},Pe=e=>{if(Te(e))return de(e,Y);e.total_in=e.total_out=0,e.data_type=Ae;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?ce:he,e.adler=2===t.wrap?0:1,t.last_flush=-2,V(t),Z},Se=e=>{const t=Pe(e);var s;return t===Z&&((s=e.state).window_size=2*s.w_size,fe(s.head),s.max_lazy_match=Ue[s.level].max_lazy,s.good_match=Ue[s.level].good_length,s.nice_match=Ue[s.level].nice_length,s.max_chain_length=Ue[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},De=(e,t,s,i,r,n)=>{if(!e)return Y;let A=1;if(t===ee&&(t=6),i<0?(A=0,i=-i):i>15&&(A=2,i-=16),r<1||r>9||s!==oe||i<8||i>15||t<0||t>9||n<0||n>re||8===i&&1!==A)return de(e,Y);8===i&&(i=9);const o=new Ie;return e.state=o,o.strm=e,o.status=ce,o.wrap=A,o.gzhead=null,o.w_bits=i,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=r+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<r+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.sym_buf=o.lit_bufsize,o.sym_end=3*(o.lit_bufsize-1),o.level=t,o.strategy=n,o.method=s,Se(e)};var ke=De,Qe=(e,t)=>Te(e)||2!==e.state.wrap?Y:(e.state.gzhead=t,Z),Re=(e,t)=>{if(Te(e)||t>K||t<0)return e?de(e,Y):Y;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===ue&&t!==X)return de(e,0===e.avail_out?q:Y);const i=s.last_flush;if(s.last_flush=t,0!==s.pending){if(_e(e),0===e.avail_out)return s.last_flush=-1,Z}else if(0===e.avail_in&&pe(t)<=pe(i)&&t!==X)return de(e,q);if(s.status===ue&&0!==e.avail_in)return de(e,q);if(s.status===ce&&0===s.wrap&&(s.status=he),s.status===ce){let t=oe+(s.w_bits-8<<4)<<8,i=-1;if(i=s.strategy>=se||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=i<<6,0!==s.strstart&&(t|=32),t+=31-t%31,ye(s,t),0!==s.strstart&&(ye(s,e.adler>>>16),ye(s,65535&e.adler)),e.adler=1,s.status=he,_e(e),0!==s.pending)return s.last_flush=-1,Z}if(57===s.status)if(e.adler=0,Be(s,31),Be(s,139),Be(s,8),s.gzhead)Be(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),Be(s,255&s.gzhead.time),Be(s,s.gzhead.time>>8&255),Be(s,s.gzhead.time>>16&255),Be(s,s.gzhead.time>>24&255),Be(s,9===s.level?2:s.strategy>=se||s.level<2?4:0),Be(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(Be(s,255&s.gzhead.extra.length),Be(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=Q(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(Be(s,0),Be(s,0),Be(s,0),Be(s,0),Be(s,0),Be(s,9===s.level?2:s.strategy>=se||s.level<2?4:0),Be(s,3),s.status=he,_e(e),0!==s.pending)return s.last_flush=-1,Z;if(69===s.status){if(s.gzhead.extra){let t=s.pending,i=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+i>s.pending_buf_size;){let r=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+r),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=Q(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=r,_e(e),0!==s.pending)return s.last_flush=-1,Z;t=0,i-=r}let r=new Uint8Array(s.gzhead.extra);s.pending_buf.set(r.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending+=i,s.gzhead.hcrc&&s.pending>t&&(e.adler=Q(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=Q(e.adler,s.pending_buf,s.pending-i,i)),_e(e),0!==s.pending)return s.last_flush=-1,Z;i=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,Be(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=Q(e.adler,s.pending_buf,s.pending-i,i)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,i=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>i&&(e.adler=Q(e.adler,s.pending_buf,s.pending-i,i)),_e(e),0!==s.pending)return s.last_flush=-1,Z;i=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,Be(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>i&&(e.adler=Q(e.adler,s.pending_buf,s.pending-i,i))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(_e(e),0!==s.pending))return s.last_flush=-1,Z;Be(s,255&e.adler),Be(s,e.adler>>8&255),e.adler=0}if(s.status=he,_e(e),0!==s.pending)return s.last_flush=-1,Z}if(0!==e.avail_in||0!==s.lookahead||t!==j&&s.status!==ue){let i=0===s.level?Me(s,t):s.strategy===se?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(Ce(e),0===e.lookahead)){if(t===j)return 1;break}if(e.match_length=0,s=N(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===ie?((e,t)=>{let s,i,r,n;const A=e.window;for(;;){if(e.lookahead<=ae){if(Ce(e),e.lookahead<=ae&&t===j)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(r=e.strstart-1,i=A[r],i===A[++r]&&i===A[++r]&&i===A[++r])){n=e.strstart+ae;do{}while(i===A[++r]&&i===A[++r]&&i===A[++r]&&i===A[++r]&&i===A[++r]&&i===A[++r]&&i===A[++r]&&i===A[++r]&&r<n);e.match_length=ae-(n-r),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=N(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=N(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(be(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===X?(be(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(be(e,!1),0===e.strm.avail_out)?1:2})(s,t):Ue[s.level].func(s,t);if(3!==i&&4!==i||(s.status=ue),1===i||3===i)return 0===e.avail_out&&(s.last_flush=-1),Z;if(2===i&&(t===W?G(s):t!==K&&(L(s,0,0,!1),t===z&&(fe(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),_e(e),0===e.avail_out))return s.last_flush=-1,Z}return t!==X?Z:s.wrap<=0?J:(2===s.wrap?(Be(s,255&e.adler),Be(s,e.adler>>8&255),Be(s,e.adler>>16&255),Be(s,e.adler>>24&255),Be(s,255&e.total_in),Be(s,e.total_in>>8&255),Be(s,e.total_in>>16&255),Be(s,e.total_in>>24&255)):(ye(s,e.adler>>>16),ye(s,65535&e.adler)),_e(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Z:J)},Oe=e=>{if(Te(e))return Y;const t=e.state.status;return e.state=null,t===he?de(e,$):Z},Ve=(e,t)=>{let s=t.length;if(Te(e))return Y;const i=e.state,r=i.wrap;if(2===r||1===r&&i.status!==ce||i.lookahead)return Y;if(1===r&&(e.adler=D(e.adler,t,s,0)),i.wrap=0,s>=i.w_size){0===r&&(fe(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(s-i.w_size,s),0),t=e,s=i.w_size}const n=e.avail_in,A=e.next_in,o=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,Ce(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=me(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,Ce(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=A,e.input=o,e.avail_in=n,i.wrap=r,Z};const Le=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var He=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)Le(s,t)&&(e[t]=s[t])}}return e},Ne=e=>{let t=0;for(let s=0,i=e.length;s<i;s++)t+=e[s].length;const s=new Uint8Array(t);for(let t=0,i=0,r=e.length;t<r;t++){let r=e[t];s.set(r,i),i+=r.length}return s};let Ge=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){Ge=!1}const je=new Uint8Array(256);for(let e=0;e<256;e++)je[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;je[254]=je[254]=1;var We=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,i,r,n,A=e.length,o=0;for(r=0;r<A;r++)s=e.charCodeAt(r),55296==(64512&s)&&r+1<A&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),r++)),o+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(o),n=0,r=0;n<o;r++)s=e.charCodeAt(r),55296==(64512&s)&&r+1<A&&(i=e.charCodeAt(r+1),56320==(64512&i)&&(s=65536+(s-55296<<10)+(i-56320),r++)),s<128?t[n++]=s:s<2048?(t[n++]=192|s>>>6,t[n++]=128|63&s):s<65536?(t[n++]=224|s>>>12,t[n++]=128|s>>>6&63,t[n++]=128|63&s):(t[n++]=240|s>>>18,t[n++]=128|s>>>12&63,t[n++]=128|s>>>6&63,t[n++]=128|63&s);return t},ze=(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,r;const n=new Array(2*s);for(r=0,i=0;i<s;){let t=e[i++];if(t<128){n[r++]=t;continue}let A=je[t];if(A>4)n[r++]=65533,i+=A-1;else{for(t&=2===A?31:3===A?15:7;A>1&&i<s;)t=t<<6|63&e[i++],A--;A>1?n[r++]=65533:t<65536?n[r++]=t:(t-=65536,n[r++]=55296|t>>10&1023,n[r++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Ge)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let i=0;i<t;i++)s+=String.fromCharCode(e[i]);return s})(n,r)},Xe=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+je[e[s]]>t?s:t},Ke=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ze=Object.prototype.toString,{Z_NO_FLUSH:Je,Z_SYNC_FLUSH:Ye,Z_FULL_FLUSH:$e,Z_FINISH:qe,Z_OK:et,Z_STREAM_END:tt,Z_DEFAULT_COMPRESSION:st,Z_DEFAULT_STRATEGY:it,Z_DEFLATED:rt}=O;function nt(e){this.options=He({level:st,method:rt,chunkSize:16384,windowBits:15,memLevel:8,strategy:it},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ke,this.strm.avail_out=0;let s=ke(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==et)throw new Error(R[s]);if(t.header&&Qe(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?We(t.dictionary):"[object ArrayBuffer]"===Ze.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=Ve(this.strm,e),s!==et)throw new Error(R[s]);this._dict_set=!0}}function At(e,t){const s=new nt(t);if(s.push(e,!0),s.err)throw s.msg||R[s.err];return s.result}nt.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize;let r,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?qe:Je,"string"==typeof e?s.input=We(e):"[object ArrayBuffer]"===Ze.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),(n===Ye||n===$e)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(r=Re(s,n),r===tt)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),r=Oe(this.strm),this.onEnd(r),this.ended=!0,r===et;if(0!==s.avail_out){if(n>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},nt.prototype.onData=function(e){this.chunks.push(e)},nt.prototype.onEnd=function(e){e===et&&(this.result=Ne(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ot={Deflate:nt,deflate:At,deflateRaw:function(e,t){return(t=t||{}).raw=!0,At(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,At(e,t)},constants:O};const at=16209;var lt=function(e,t){let s,i,r,n,A,o,a,l,c,h,u,d,p,f,g,m,_,b,B,y,w,v,C,M;const E=e.state;s=e.next_in,C=e.input,i=s+(e.avail_in-5),r=e.next_out,M=e.output,n=r-(t-e.avail_out),A=r+(e.avail_out-257),o=E.dmax,a=E.wsize,l=E.whave,c=E.wnext,h=E.window,u=E.hold,d=E.bits,p=E.lencode,f=E.distcode,g=(1<<E.lenbits)-1,m=(1<<E.distbits)-1;e:do{d<15&&(u+=C[s++]<<d,d+=8,u+=C[s++]<<d,d+=8),_=p[u&g];t:for(;;){if(b=_>>>24,u>>>=b,d-=b,b=_>>>16&255,0===b)M[r++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=p[(65535&_)+(u&(1<<b)-1)];continue t}if(32&b){E.mode=16191;break e}e.msg="invalid literal/length code",E.mode=at;break e}B=65535&_,b&=15,b&&(d<b&&(u+=C[s++]<<d,d+=8),B+=u&(1<<b)-1,u>>>=b,d-=b),d<15&&(u+=C[s++]<<d,d+=8,u+=C[s++]<<d,d+=8),_=f[u&m];s:for(;;){if(b=_>>>24,u>>>=b,d-=b,b=_>>>16&255,!(16&b)){if(0==(64&b)){_=f[(65535&_)+(u&(1<<b)-1)];continue s}e.msg="invalid distance code",E.mode=at;break e}if(y=65535&_,b&=15,d<b&&(u+=C[s++]<<d,d+=8,d<b&&(u+=C[s++]<<d,d+=8)),y+=u&(1<<b)-1,y>o){e.msg="invalid distance too far back",E.mode=at;break e}if(u>>>=b,d-=b,b=r-n,y>b){if(b=y-b,b>l&&E.sane){e.msg="invalid distance too far back",E.mode=at;break e}if(w=0,v=h,0===c){if(w+=a-b,b<B){B-=b;do{M[r++]=h[w++]}while(--b);w=r-y,v=M}}else if(c<b){if(w+=a+c-b,b-=c,b<B){B-=b;do{M[r++]=h[w++]}while(--b);if(w=0,c<B){b=c,B-=b;do{M[r++]=h[w++]}while(--b);w=r-y,v=M}}}else if(w+=c-b,b<B){B-=b;do{M[r++]=h[w++]}while(--b);w=r-y,v=M}for(;B>2;)M[r++]=v[w++],M[r++]=v[w++],M[r++]=v[w++],B-=3;B&&(M[r++]=v[w++],B>1&&(M[r++]=v[w++]))}else{w=r-y;do{M[r++]=M[w++],M[r++]=M[w++],M[r++]=M[w++],B-=3}while(B>2);B&&(M[r++]=M[w++],B>1&&(M[r++]=M[w++]))}break}}break}}while(s<i&&r<A);B=d>>3,s-=B,d-=B<<3,u&=(1<<d)-1,e.next_in=s,e.next_out=r,e.avail_in=s<i?i-s+5:5-(s-i),e.avail_out=r<A?A-r+257:257-(r-A),E.hold=u,E.bits=d};const ct=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ht=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),ut=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var pt=(e,t,s,i,r,n,A,o)=>{const a=o.bits;let l,c,h,u,d,p,f=0,g=0,m=0,_=0,b=0,B=0,y=0,w=0,v=0,C=0,M=null;const E=new Uint16Array(16),F=new Uint16Array(16);let x,U,I,T=null;for(f=0;f<=15;f++)E[f]=0;for(g=0;g<i;g++)E[t[s+g]]++;for(b=a,_=15;_>=1&&0===E[_];_--);if(b>_&&(b=_),0===_)return r[n++]=20971520,r[n++]=20971520,o.bits=1,0;for(m=1;m<_&&0===E[m];m++);for(b<m&&(b=m),w=1,f=1;f<=15;f++)if(w<<=1,w-=E[f],w<0)return-1;if(w>0&&(0===e||1!==_))return-1;for(F[1]=0,f=1;f<15;f++)F[f+1]=F[f]+E[f];for(g=0;g<i;g++)0!==t[s+g]&&(A[F[t[s+g]]++]=g);if(0===e?(M=T=A,p=20):1===e?(M=ct,T=ht,p=257):(M=ut,T=dt,p=0),C=0,g=0,f=m,d=n,B=b,y=0,h=-1,v=1<<b,u=v-1,1===e&&v>852||2===e&&v>592)return 1;for(;;){x=f-y,A[g]+1<p?(U=0,I=A[g]):A[g]>=p?(U=T[A[g]-p],I=M[A[g]-p]):(U=96,I=0),l=1<<f-y,c=1<<B,m=c;do{c-=l,r[d+(C>>y)+c]=x<<24|U<<16|I|0}while(0!==c);for(l=1<<f-1;C&l;)l>>=1;if(0!==l?(C&=l-1,C+=l):C=0,g++,0==--E[f]){if(f===_)break;f=t[s+A[g]]}if(f>b&&(C&u)!==h){for(0===y&&(y=b),d+=m,B=f-y,w=1<<B;B+y<_&&(w-=E[B+y],!(w<=0));)B++,w<<=1;if(v+=1<<B,1===e&&v>852||2===e&&v>592)return 1;h=C&u,r[h]=b<<24|B<<16|d-n|0}}return 0!==C&&(r[d+C]=f-y<<24|64<<16|0),o.bits=b,0};const{Z_FINISH:ft,Z_BLOCK:gt,Z_TREES:mt,Z_OK:_t,Z_STREAM_END:bt,Z_NEED_DICT:Bt,Z_STREAM_ERROR:yt,Z_DATA_ERROR:wt,Z_MEM_ERROR:vt,Z_BUF_ERROR:Ct,Z_DEFLATED:Mt}=O,Et=16180,Ft=16190,xt=16191,Ut=16192,It=16194,Tt=16199,Pt=16200,St=16206,Dt=16209,kt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Qt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Rt=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Et||t.mode>16211?1:0},Ot=e=>{if(Rt(e))return yt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Et,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,_t},Vt=e=>{if(Rt(e))return yt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Ot(e)},Lt=(e,t)=>{let s;if(Rt(e))return yt;const i=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?yt:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=s,i.wbits=t,Vt(e))},Ht=(e,t)=>{if(!e)return yt;const s=new Qt;e.state=s,s.strm=e,s.window=null,s.mode=Et;const i=Lt(e,t);return i!==_t&&(e.state=null),i};let Nt,Gt,jt=!0;const Wt=e=>{if(jt){Nt=new Int32Array(512),Gt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(pt(1,e.lens,0,288,Nt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;pt(2,e.lens,0,32,Gt,0,e.work,{bits:5}),jt=!1}e.lencode=Nt,e.lenbits=9,e.distcode=Gt,e.distbits=5},zt=(e,t,s,i)=>{let r;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(s-n.wsize,s),0),n.wnext=0,n.whave=n.wsize):(r=n.wsize-n.wnext,r>i&&(r=i),n.window.set(t.subarray(s-i,s-i+r),n.wnext),(i-=r)?(n.window.set(t.subarray(s-i,s),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=r,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=r))),0};var Xt=Vt,Kt=Ht,Zt=(e,t)=>{let s,i,r,n,A,o,a,l,c,h,u,d,p,f,g,m,_,b,B,y,w,v,C=0;const M=new Uint8Array(4);let E,F;const x=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Rt(e)||!e.output||!e.input&&0!==e.avail_in)return yt;s=e.state,s.mode===xt&&(s.mode=Ut),A=e.next_out,r=e.output,a=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=s.hold,c=s.bits,h=o,u=a,v=_t;e:for(;;)switch(s.mode){case Et:if(0===s.wrap){s.mode=Ut;break}for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(2&s.wrap&&35615===l){0===s.wbits&&(s.wbits=15),s.check=0,M[0]=255&l,M[1]=l>>>8&255,s.check=Q(s.check,M,2,0),l=0,c=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",s.mode=Dt;break}if((15&l)!==Mt){e.msg="unknown compression method",s.mode=Dt;break}if(l>>>=4,c-=4,w=8+(15&l),0===s.wbits&&(s.wbits=w),w>15||w>s.wbits){e.msg="invalid window size",s.mode=Dt;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&l?16189:xt,l=0,c=0;break;case 16181:for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(s.flags=l,(255&s.flags)!==Mt){e.msg="unknown compression method",s.mode=Dt;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=Dt;break}s.head&&(s.head.text=l>>8&1),512&s.flags&&4&s.wrap&&(M[0]=255&l,M[1]=l>>>8&255,s.check=Q(s.check,M,2,0)),l=0,c=0,s.mode=16182;case 16182:for(;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}s.head&&(s.head.time=l),512&s.flags&&4&s.wrap&&(M[0]=255&l,M[1]=l>>>8&255,M[2]=l>>>16&255,M[3]=l>>>24&255,s.check=Q(s.check,M,4,0)),l=0,c=0,s.mode=16183;case 16183:for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}s.head&&(s.head.xflags=255&l,s.head.os=l>>8),512&s.flags&&4&s.wrap&&(M[0]=255&l,M[1]=l>>>8&255,s.check=Q(s.check,M,2,0)),l=0,c=0,s.mode=16184;case 16184:if(1024&s.flags){for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}s.length=l,s.head&&(s.head.extra_len=l),512&s.flags&&4&s.wrap&&(M[0]=255&l,M[1]=l>>>8&255,s.check=Q(s.check,M,2,0)),l=0,c=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(d=s.length,d>o&&(d=o),d&&(s.head&&(w=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(i.subarray(n,n+d),w)),512&s.flags&&4&s.wrap&&(s.check=Q(s.check,i,d,n)),o-=d,n+=d,s.length-=d),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===o)break e;d=0;do{w=i[n+d++],s.head&&w&&s.length<65536&&(s.head.name+=String.fromCharCode(w))}while(w&&d<o);if(512&s.flags&&4&s.wrap&&(s.check=Q(s.check,i,d,n)),o-=d,n+=d,w)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===o)break e;d=0;do{w=i[n+d++],s.head&&w&&s.length<65536&&(s.head.comment+=String.fromCharCode(w))}while(w&&d<o);if(512&s.flags&&4&s.wrap&&(s.check=Q(s.check,i,d,n)),o-=d,n+=d,w)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;c<16;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(4&s.wrap&&l!==(65535&s.check)){e.msg="header crc mismatch",s.mode=Dt;break}l=0,c=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=xt;break;case 16189:for(;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}e.adler=s.check=kt(l),l=0,c=0,s.mode=Ft;case Ft:if(0===s.havedict)return e.next_out=A,e.avail_out=a,e.next_in=n,e.avail_in=o,s.hold=l,s.bits=c,Bt;e.adler=s.check=1,s.mode=xt;case xt:if(t===gt||t===mt)break e;case Ut:if(s.last){l>>>=7&c,c-=7&c,s.mode=St;break}for(;c<3;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}switch(s.last=1&l,l>>>=1,c-=1,3&l){case 0:s.mode=16193;break;case 1:if(Wt(s),s.mode=Tt,t===mt){l>>>=2,c-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=Dt}l>>>=2,c-=2;break;case 16193:for(l>>>=7&c,c-=7&c;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if((65535&l)!=(l>>>16^65535)){e.msg="invalid stored block lengths",s.mode=Dt;break}if(s.length=65535&l,l=0,c=0,s.mode=It,t===mt)break e;case It:s.mode=16195;case 16195:if(d=s.length,d){if(d>o&&(d=o),d>a&&(d=a),0===d)break e;r.set(i.subarray(n,n+d),A),o-=d,n+=d,a-=d,A+=d,s.length-=d;break}s.mode=xt;break;case 16196:for(;c<14;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(s.nlen=257+(31&l),l>>>=5,c-=5,s.ndist=1+(31&l),l>>>=5,c-=5,s.ncode=4+(15&l),l>>>=4,c-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=Dt;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;c<3;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}s.lens[x[s.have++]]=7&l,l>>>=3,c-=3}for(;s.have<19;)s.lens[x[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,E={bits:s.lenbits},v=pt(0,s.lens,0,19,s.lencode,0,s.work,E),s.lenbits=E.bits,v){e.msg="invalid code lengths set",s.mode=Dt;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;C=s.lencode[l&(1<<s.lenbits)-1],g=C>>>24,m=C>>>16&255,_=65535&C,!(g<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(_<16)l>>>=g,c-=g,s.lens[s.have++]=_;else{if(16===_){for(F=g+2;c<F;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(l>>>=g,c-=g,0===s.have){e.msg="invalid bit length repeat",s.mode=Dt;break}w=s.lens[s.have-1],d=3+(3&l),l>>>=2,c-=2}else if(17===_){for(F=g+3;c<F;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}l>>>=g,c-=g,w=0,d=3+(7&l),l>>>=3,c-=3}else{for(F=g+7;c<F;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}l>>>=g,c-=g,w=0,d=11+(127&l),l>>>=7,c-=7}if(s.have+d>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=Dt;break}for(;d--;)s.lens[s.have++]=w}}if(s.mode===Dt)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=Dt;break}if(s.lenbits=9,E={bits:s.lenbits},v=pt(1,s.lens,0,s.nlen,s.lencode,0,s.work,E),s.lenbits=E.bits,v){e.msg="invalid literal/lengths set",s.mode=Dt;break}if(s.distbits=6,s.distcode=s.distdyn,E={bits:s.distbits},v=pt(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,E),s.distbits=E.bits,v){e.msg="invalid distances set",s.mode=Dt;break}if(s.mode=Tt,t===mt)break e;case Tt:s.mode=Pt;case Pt:if(o>=6&&a>=258){e.next_out=A,e.avail_out=a,e.next_in=n,e.avail_in=o,s.hold=l,s.bits=c,lt(e,u),A=e.next_out,r=e.output,a=e.avail_out,n=e.next_in,i=e.input,o=e.avail_in,l=s.hold,c=s.bits,s.mode===xt&&(s.back=-1);break}for(s.back=0;C=s.lencode[l&(1<<s.lenbits)-1],g=C>>>24,m=C>>>16&255,_=65535&C,!(g<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(m&&0==(240&m)){for(b=g,B=m,y=_;C=s.lencode[y+((l&(1<<b+B)-1)>>b)],g=C>>>24,m=C>>>16&255,_=65535&C,!(b+g<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}l>>>=b,c-=b,s.back+=b}if(l>>>=g,c-=g,s.back+=g,s.length=_,0===m){s.mode=16205;break}if(32&m){s.back=-1,s.mode=xt;break}if(64&m){e.msg="invalid literal/length code",s.mode=Dt;break}s.extra=15&m,s.mode=16201;case 16201:if(s.extra){for(F=s.extra;c<F;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}s.length+=l&(1<<s.extra)-1,l>>>=s.extra,c-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;C=s.distcode[l&(1<<s.distbits)-1],g=C>>>24,m=C>>>16&255,_=65535&C,!(g<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(0==(240&m)){for(b=g,B=m,y=_;C=s.distcode[y+((l&(1<<b+B)-1)>>b)],g=C>>>24,m=C>>>16&255,_=65535&C,!(b+g<=c);){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}l>>>=b,c-=b,s.back+=b}if(l>>>=g,c-=g,s.back+=g,64&m){e.msg="invalid distance code",s.mode=Dt;break}s.offset=_,s.extra=15&m,s.mode=16203;case 16203:if(s.extra){for(F=s.extra;c<F;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}s.offset+=l&(1<<s.extra)-1,l>>>=s.extra,c-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=Dt;break}s.mode=16204;case 16204:if(0===a)break e;if(d=u-a,s.offset>d){if(d=s.offset-d,d>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=Dt;break}d>s.wnext?(d-=s.wnext,p=s.wsize-d):p=s.wnext-d,d>s.length&&(d=s.length),f=s.window}else f=r,p=A-s.offset,d=s.length;d>a&&(d=a),a-=d,s.length-=d;do{r[A++]=f[p++]}while(--d);0===s.length&&(s.mode=Pt);break;case 16205:if(0===a)break e;r[A++]=s.length,a--,s.mode=Pt;break;case St:if(s.wrap){for(;c<32;){if(0===o)break e;o--,l|=i[n++]<<c,c+=8}if(u-=a,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?Q(s.check,r,u,A-u):D(s.check,r,u,A-u)),u=a,4&s.wrap&&(s.flags?l:kt(l))!==s.check){e.msg="incorrect data check",s.mode=Dt;break}l=0,c=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;c<32;){if(0===o)break e;o--,l+=i[n++]<<c,c+=8}if(4&s.wrap&&l!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=Dt;break}l=0,c=0}s.mode=16208;case 16208:v=bt;break e;case Dt:v=wt;break e;case 16210:return vt;default:return yt}return e.next_out=A,e.avail_out=a,e.next_in=n,e.avail_in=o,s.hold=l,s.bits=c,(s.wsize||u!==e.avail_out&&s.mode<Dt&&(s.mode<St||t!==ft))&&zt(e,e.output,e.next_out,u-e.avail_out),h-=e.avail_in,u-=e.avail_out,e.total_in+=h,e.total_out+=u,s.total+=u,4&s.wrap&&u&&(e.adler=s.check=s.flags?Q(s.check,r,u,e.next_out-u):D(s.check,r,u,e.next_out-u)),e.data_type=s.bits+(s.last?64:0)+(s.mode===xt?128:0)+(s.mode===Tt||s.mode===It?256:0),(0===h&&0===u||t===ft)&&v===_t&&(v=Ct),v},Jt=e=>{if(Rt(e))return yt;let t=e.state;return t.window&&(t.window=null),e.state=null,_t},Yt=(e,t)=>{if(Rt(e))return yt;const s=e.state;return 0==(2&s.wrap)?yt:(s.head=t,t.done=!1,_t)},$t=(e,t)=>{const s=t.length;let i,r,n;return Rt(e)?yt:(i=e.state,0!==i.wrap&&i.mode!==Ft?yt:i.mode===Ft&&(r=1,r=D(r,t,s,0),r!==i.check)?wt:(n=zt(e,t,s,s),n?(i.mode=16210,vt):(i.havedict=1,_t)))},qt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const es=Object.prototype.toString,{Z_NO_FLUSH:ts,Z_FINISH:ss,Z_OK:is,Z_STREAM_END:rs,Z_NEED_DICT:ns,Z_STREAM_ERROR:As,Z_DATA_ERROR:os,Z_MEM_ERROR:as}=O;function ls(e){this.options=He({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ke,this.strm.avail_out=0;let s=Kt(this.strm,t.windowBits);if(s!==is)throw new Error(R[s]);if(this.header=new qt,Yt(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=We(t.dictionary):"[object ArrayBuffer]"===es.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=$t(this.strm,t.dictionary),s!==is)))throw new Error(R[s])}function cs(e,t){const s=new ls(t);if(s.push(e),s.err)throw s.msg||R[s.err];return s.result}ls.prototype.push=function(e,t){const s=this.strm,i=this.options.chunkSize,r=this.options.dictionary;let n,A,o;if(this.ended)return!1;for(A=t===~~t?t:!0===t?ss:ts,"[object ArrayBuffer]"===es.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(i),s.next_out=0,s.avail_out=i),n=Zt(s,A),n===ns&&r&&(n=$t(s,r),n===is?n=Zt(s,A):n===os&&(n=ns));s.avail_in>0&&n===rs&&s.state.wrap>0&&0!==e[s.next_in];)Xt(s),n=Zt(s,A);switch(n){case As:case os:case ns:case as:return this.onEnd(n),this.ended=!0,!1}if(o=s.avail_out,s.next_out&&(0===s.avail_out||n===rs))if("string"===this.options.to){let e=Xe(s.output,s.next_out),t=s.next_out-e,r=ze(s.output,e);s.next_out=t,s.avail_out=i-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(r)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(n!==is||0!==o){if(n===rs)return n=Jt(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},ls.prototype.onData=function(e){this.chunks.push(e)},ls.prototype.onEnd=function(e){e===is&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Ne(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var hs={Inflate:ls,inflate:cs,inflateRaw:function(e,t){return(t=t||{}).raw=!0,cs(e,t)},ungzip:cs,constants:O};const{Deflate:us,deflate:ds,deflateRaw:ps,gzip:fs}=ot,{Inflate:gs,inflate:ms,inflateRaw:_s,ungzip:bs}=hs;var Bs=us,ys=ds,ws=ps,vs=fs,Cs=gs,Ms=ms,Es=_s,Fs=bs,xs=O,Us={Deflate:Bs,deflate:ys,deflateRaw:ws,gzip:vs,Inflate:Cs,inflate:Ms,inflateRaw:Es,ungzip:Fs,constants:xs};e.Deflate=Bs,e.Inflate=Cs,e.constants=xs,e.default=Us,e.deflate=ys,e.deflateRaw=ws,e.gzip=vs,e.inflate=Ms,e.inflateRaw=Es,e.ungzip=Fs,Object.defineProperty(e,"__esModule",{value:!0})}));var My=Object.freeze({__proto__:null});let Ey=window.pako||My;Ey.inflate||(Ey=Ey.default);const Fy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const xy={version:1,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11]}}(s),o=function(e){return{positions:new Uint16Array(Ey.inflate(e.positions).buffer),normals:new Int8Array(Ey.inflate(e.normals).buffer),indices:new Uint32Array(Ey.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Ey.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Ey.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Ey.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Ey.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Ey.inflate(e.meshColors).buffer),entityIDs:Ey.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Ey.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Ey.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Ey.inflate(e.positionsDecodeMatrix).buffer)}}(A);!function(e,t,s,i,r,n){n.getNextId(),i.positionsCompression="precompressed",i.normalsCompression="precompressed";const A=s.positions,o=s.normals,a=s.indices,l=s.edgeIndices,c=s.meshPositions,u=s.meshIndices,d=s.meshEdgesIndices,p=s.meshColors,f=JSON.parse(s.entityIDs),g=s.entityMeshes,m=s.entityIsObjects,b=c.length,B=g.length;for(let r=0;r<B;r++){const n=f[r],y=t.globalizeObjectIds?h.globalizeObjectId(i.id,n):n,w=e.metaScene.metaObjects[y],v={},C={};if(w){if(t.excludeTypesMap&&w.type&&t.excludeTypesMap[w.type])continue;if(t.includeTypesMap&&w.type&&!t.includeTypesMap[w.type])continue;const e=t.objectDefaults?t.objectDefaults[w.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(v.visible=!1),!1===e.pickable&&(v.pickable=!1),e.colorize&&(C.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(C.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const M=r===B-1,E=[];for(let e=g[r],t=M?g.length:g[r+1];e<t;e++){const t=e===b-1,r=y+".mesh."+e,n=Fy(p.subarray(4*e,4*e+3)),h=p[4*e+3]/255;i.createMesh(_.apply(C,{id:r,primitive:"triangles",positionsCompressed:A.subarray(c[e],t?A.length:c[e+1]),normalsCompressed:o.subarray(c[e],t?A.length:c[e+1]),indices:a.subarray(u[e],t?a.length:u[e+1]),edgeIndices:l.subarray(d[e],t?l.length:d[e+1]),positionsDecodeMatrix:s.positionsDecodeMatrix,color:n,opacity:h})),E.push(r)}i.createEntity(_.apply(v,{id:y,isObject:1===m[r],meshIds:E}))}}(e,t,o,i,0,n)}};let Uy=window.pako||My;Uy.inflate||(Uy=Uy.default);const Iy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Ty={version:2,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],positionsDecodeMatrix:e[11],entityMeshIds:e[12],entityMatrices:e[13],entityUsesInstancing:e[14]}}(s),o=function(e){return{positions:new Uint16Array(Uy.inflate(e.positions).buffer),normals:new Int8Array(Uy.inflate(e.normals).buffer),indices:new Uint32Array(Uy.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Uy.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Uy.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Uy.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Uy.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Uy.inflate(e.meshColors).buffer),entityIDs:Uy.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Uy.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Uy.inflate(e.entityIsObjects).buffer),positionsDecodeMatrix:new Float32Array(Uy.inflate(e.positionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Uy.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(Uy.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Uy.inflate(e.entityUsesInstancing).buffer)}}(A);!function(e,t,s,i,r,n){const A=n.getNextId();i.positionsCompression="precompressed",i.normalsCompression="precompressed";const o=s.positions,a=s.normals,l=s.indices,c=s.edgeIndices,u=s.meshPositions,d=s.meshIndices,p=s.meshEdgesIndices,f=s.meshColors,g=JSON.parse(s.entityIDs),m=s.entityMeshes,b=s.entityIsObjects,B=s.entityMeshIds,y=s.entityMatrices,w=s.entityUsesInstancing,v=u.length,C=m.length,M={};for(let r=0;r<C;r++){const E=g[r],F=t.globalizeObjectIds?h.globalizeObjectId(i.id,E):E,x=e.metaScene.metaObjects[F],U={},I={},T=y.subarray(16*r,16*r+16);if(x){if(t.excludeTypesMap&&x.type&&t.excludeTypesMap[x.type])continue;if(t.includeTypesMap&&x.type&&!t.includeTypesMap[x.type])continue;const e=t.objectDefaults?t.objectDefaults[x.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(U.visible=!1),!1===e.pickable&&(U.pickable=!1),e.colorize&&(I.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(I.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const P=r===C-1,S=[];for(let e=m[r],t=P?B.length:m[r+1];e<t;e++){const t=B[e],h=t===v-1,g=n.getNextId(),m=Iy(f.subarray(4*t,4*t+3)),b=f[4*t+3]/255,y=o.subarray(u[t],h?o.length:u[t+1]),C=a.subarray(u[t],h?o.length:u[t+1]),E=l.subarray(d[t],h?l.length:d[t+1]),F=c.subarray(p[t],h?c.length:p[t+1]);if(1===w[r]){const e=`${A}.geometry.${g}.${t}`;e in M||(i.createGeometry({id:e,positionsCompressed:y,normalsCompressed:C,indices:E,edgeIndices:F,primitive:"triangles",positionsDecodeMatrix:s.positionsDecodeMatrix}),M[e]=!0),i.createMesh(_.apply(I,{id:g,color:m,opacity:b,matrix:T,geometryId:e})),S.push(g)}else i.createMesh(_.apply(I,{id:g,primitive:"triangles",positionsCompressed:y,normalsCompressed:C,indices:E,edgeIndices:F,positionsDecodeMatrix:s.positionsDecodeMatrix,color:m,opacity:b})),S.push(g)}S.length&&i.createEntity(_.apply(U,{id:F,isObject:1===b[r],meshIds:S}))}}(e,t,o,i,0,n)}};let Py=window.pako||My;Py.inflate||(Py=Py.default);const Sy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Dy={version:3,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],meshPositions:e[4],meshIndices:e[5],meshEdgesIndices:e[6],meshColors:e[7],entityIDs:e[8],entityMeshes:e[9],entityIsObjects:e[10],instancedPositionsDecodeMatrix:e[11],batchedPositionsDecodeMatrix:e[12],entityMeshIds:e[13],entityMatrices:e[14],entityUsesInstancing:e[15]}}(s),o=function(e){return{positions:new Uint16Array(Py.inflate(e.positions).buffer),normals:new Int8Array(Py.inflate(e.normals).buffer),indices:new Uint32Array(Py.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Py.inflate(e.edgeIndices).buffer),meshPositions:new Uint32Array(Py.inflate(e.meshPositions).buffer),meshIndices:new Uint32Array(Py.inflate(e.meshIndices).buffer),meshEdgesIndices:new Uint32Array(Py.inflate(e.meshEdgesIndices).buffer),meshColors:new Uint8Array(Py.inflate(e.meshColors).buffer),entityIDs:Py.inflate(e.entityIDs,{to:"string"}),entityMeshes:new Uint32Array(Py.inflate(e.entityMeshes).buffer),entityIsObjects:new Uint8Array(Py.inflate(e.entityIsObjects).buffer),instancedPositionsDecodeMatrix:new Float32Array(Py.inflate(e.instancedPositionsDecodeMatrix).buffer),batchedPositionsDecodeMatrix:new Float32Array(Py.inflate(e.batchedPositionsDecodeMatrix).buffer),entityMeshIds:new Uint32Array(Py.inflate(e.entityMeshIds).buffer),entityMatrices:new Float32Array(Py.inflate(e.entityMatrices).buffer),entityUsesInstancing:new Uint8Array(Py.inflate(e.entityUsesInstancing).buffer)}}(A);!function(e,t,s,i,r,n){const A=n.getNextId();i.positionsCompression="precompressed",i.normalsCompression="precompressed";const o=s.positions,a=s.normals,l=s.indices,c=s.edgeIndices,u=s.meshPositions,d=s.meshIndices,p=s.meshEdgesIndices,f=s.meshColors,g=JSON.parse(s.entityIDs),m=s.entityMeshes,b=s.entityIsObjects,B=s.entityMeshIds,y=s.entityMatrices,w=s.entityUsesInstancing,v=u.length,C=m.length,M={};for(let r=0;r<C;r++){const n=g[r],T=t.globalizeObjectIds?h.globalizeObjectId(i.id,n):n,P=e.metaScene.metaObjects[T],S={},D={},k=y.subarray(16*r,16*r+16);if(P){if(t.excludeTypesMap&&P.type&&t.excludeTypesMap[P.type])continue;if(t.includeTypesMap&&P.type&&!t.includeTypesMap[P.type])continue;const e=t.objectDefaults?t.objectDefaults[P.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(S.visible=!1),!1===e.pickable&&(S.pickable=!1),e.colorize&&(D.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(D.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;const Q=r===C-1,R=[];for(let e=m[r],t=Q?B.length:m[r+1];e<t;e++){var E=B[e];const t=E===v-1,n=`${A}.${T}.mesh.${E}`,h=Sy(f.subarray(4*E,4*E+3)),g=f[4*E+3]/255;var F=o.subarray(u[E],t?o.length:u[E+1]),x=a.subarray(u[E],t?o.length:u[E+1]),U=l.subarray(d[E],t?l.length:d[E+1]),I=c.subarray(p[E],t?c.length:p[E+1]);if(1===w[r]){const e=`${A}.geometry.${n}.${E}`;e in M||(i.createGeometry({id:e,positionsCompressed:F,normalsCompressed:x,indices:U,edgeIndices:I,primitive:"triangles",positionsDecodeMatrix:s.instancedPositionsDecodeMatrix}),M[e]=!0),i.createMesh(_.apply(D,{id:n,color:h,opacity:g,matrix:k,geometryId:e})),R.push(n)}else i.createMesh(_.apply(D,{id:n,primitive:"triangles",positionsCompressed:F,normalsCompressed:x,indices:U,edgeIndices:I,positionsDecodeMatrix:s.batchedPositionsDecodeMatrix,color:h,opacity:g})),R.push(n)}R.length&&i.createEntity(_.apply(S,{id:T,isObject:1===b[r],meshIds:R}))}}(e,t,o,i,0,n)}};let ky=window.pako||My;ky.inflate||(ky=ky.default);const Qy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Ry={version:4,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],decodeMatrices:e[4],matrices:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveDecodeMatricesPortion:e[9],eachPrimitiveColor:e[10],primitiveInstances:e[11],eachEntityId:e[12],eachEntityPrimitiveInstancesPortion:e[13],eachEntityMatricesPortion:e[14],eachEntityMatrix:e[15]}}(s),o=function(e){return{positions:new Uint16Array(ky.inflate(e.positions).buffer),normals:new Int8Array(ky.inflate(e.normals).buffer),indices:new Uint32Array(ky.inflate(e.indices).buffer),edgeIndices:new Uint32Array(ky.inflate(e.edgeIndices).buffer),decodeMatrices:new Float32Array(ky.inflate(e.decodeMatrices).buffer),matrices:new Float32Array(ky.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(ky.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(ky.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(ky.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveDecodeMatricesPortion:new Uint32Array(ky.inflate(e.eachPrimitiveDecodeMatricesPortion).buffer),eachPrimitiveColor:new Uint8Array(ky.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(ky.inflate(e.primitiveInstances).buffer),eachEntityId:ky.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(ky.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(ky.inflate(e.eachEntityMatricesPortion).buffer)}}(A);!function(e,t,s,i,r,n){const A=n.getNextId();i.positionsCompression="precompressed",i.normalsCompression="precompressed";const o=s.positions,a=s.normals,l=s.indices,c=s.edgeIndices,h=s.decodeMatrices,u=s.matrices,d=s.eachPrimitivePositionsAndNormalsPortion,p=s.eachPrimitiveIndicesPortion,f=s.eachPrimitiveEdgeIndicesPortion,g=s.eachPrimitiveDecodeMatricesPortion,m=s.eachPrimitiveColor,b=s.primitiveInstances,B=JSON.parse(s.eachEntityId),y=s.eachEntityPrimitiveInstancesPortion,w=s.eachEntityMatricesPortion,v=d.length,C=b.length,M=new Uint8Array(v),E=new Uint32Array(v),F=B.length;for(let e=0;e<v;e++)E[e]=e;E.sort(((e,t)=>g[e]<g[t]?-1:g[e]>g[t]?1:0));for(let e=0;e<C;e++)M[b[e]]++;const x={};for(let e=0;e<F;e++){const t=F-1,s=e===t,i=y[e],r=s?y[t]:y[e+1];for(let t=i;t<r;t++){const s=b[t];M[s]>1||(x[s]=e)}}for(let e=0;e<v;e++){const t=E[e],s=t===v-1,r=M[t]>1,n=Qy(m.subarray(4*t,4*t+3)),u=m[4*t+3]/255,b=o.subarray(d[t],s?o.length:d[t+1]),y=a.subarray(d[t],s?a.length:d[t+1]),w=l.subarray(p[t],s?l.length:p[t+1]),C=c.subarray(f[t],s?c.length:f[t+1]),F=h.subarray(g[t],g[t]+16);if(r){const e=`${A}-geometry.${t}`;i.createGeometry({id:e,primitive:"triangles",positionsCompressed:b,normalsCompressed:y,indices:w,edgeIndices:C,positionsDecodeMatrix:F})}else{const e=`${A}-${t}`;B[x[t]];const s={};i.createMesh(_.apply(s,{id:e,primitive:"triangles",positionsCompressed:b,normalsCompressed:y,indices:w,edgeIndices:C,positionsDecodeMatrix:F,color:n,opacity:u}))}}let U=0;for(let e=0;e<F;e++){const t=F-1,s=e===t,r=B[e],n=y[e],o=s?y[t]:y[e+1],a=[];for(let t=n;t<o;t++){const s=b[t];if(M[s]>1){const t={},r=`${A}-instance.${U++}`,n=`${A}-geometry.${s}`,o=16*w[e],l=u.subarray(o,o+16);i.createMesh(_.apply(t,{id:r,geometryId:n,matrix:l})),a.push(r)}else a.push(s)}if(a.length>0){const e={};i.createEntity(_.apply(e,{id:r,isObject:!0,meshIds:a}))}}}(0,0,o,i,0,n)}};let Oy=window.pako||My;Oy.inflate||(Oy=Oy.default);const Vy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Ly={version:5,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],eachPrimitivePositionsAndNormalsPortion:e[5],eachPrimitiveIndicesPortion:e[6],eachPrimitiveEdgeIndicesPortion:e[7],eachPrimitiveColor:e[8],primitiveInstances:e[9],eachEntityId:e[10],eachEntityPrimitiveInstancesPortion:e[11],eachEntityMatricesPortion:e[12]}}(s),o=function(e){return{positions:new Float32Array(Oy.inflate(e.positions).buffer),normals:new Int8Array(Oy.inflate(e.normals).buffer),indices:new Uint32Array(Oy.inflate(e.indices).buffer),edgeIndices:new Uint32Array(Oy.inflate(e.edgeIndices).buffer),matrices:new Float32Array(Oy.inflate(e.matrices).buffer),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(Oy.inflate(e.eachPrimitivePositionsAndNormalsPortion).buffer),eachPrimitiveIndicesPortion:new Uint32Array(Oy.inflate(e.eachPrimitiveIndicesPortion).buffer),eachPrimitiveEdgeIndicesPortion:new Uint32Array(Oy.inflate(e.eachPrimitiveEdgeIndicesPortion).buffer),eachPrimitiveColor:new Uint8Array(Oy.inflate(e.eachPrimitiveColor).buffer),primitiveInstances:new Uint32Array(Oy.inflate(e.primitiveInstances).buffer),eachEntityId:Oy.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(Oy.inflate(e.eachEntityPrimitiveInstancesPortion).buffer),eachEntityMatricesPortion:new Uint32Array(Oy.inflate(e.eachEntityMatricesPortion).buffer)}}(A);!function(e,t,s,i,r,n){const A=n.getNextId();i.positionsCompression="disabled",i.normalsCompression="precompressed";const o=s.positions,a=s.normals,l=s.indices,c=s.edgeIndices,h=s.matrices,u=s.eachPrimitivePositionsAndNormalsPortion,d=s.eachPrimitiveIndicesPortion,p=s.eachPrimitiveEdgeIndicesPortion,f=s.eachPrimitiveColor,g=s.primitiveInstances,m=JSON.parse(s.eachEntityId),b=s.eachEntityPrimitiveInstancesPortion,B=s.eachEntityMatricesPortion,y=u.length,w=g.length,v=new Uint8Array(y),C=m.length;for(let e=0;e<w;e++)v[g[e]]++;const M={};for(let e=0;e<C;e++){const t=C-1,s=e===t,i=b[e],r=s?b[t]:b[e+1];for(let t=i;t<r;t++){const s=g[t];v[s]>1||(M[s]=e)}}for(let e=0;e<y;e++){const t=e===y-1,s=v[e]>1,r=Vy(f.subarray(4*e,4*e+3)),n=f[4*e+3]/255,h=o.subarray(u[e],t?o.length:u[e+1]),g=a.subarray(u[e],t?a.length:u[e+1]),b=l.subarray(d[e],t?l.length:d[e+1]),B=c.subarray(p[e],t?c.length:p[e+1]);if(s){const t=`${A}-geometry.${e}`;i.createGeometry({id:t,primitive:"triangles",positionsCompressed:h,normalsCompressed:g,indices:b,edgeIndices:B})}else{const t=e;m[M[e]];const s={};i.createMesh(_.apply(s,{id:t,primitive:"triangles",positionsCompressed:h,normalsCompressed:g,indices:b,edgeIndices:B,color:r,opacity:n}))}}let E=0;for(let e=0;e<C;e++){const t=C-1,s=e===t,r=m[e],n=b[e],A=s?b[t]:b[e+1],o=[];for(let t=n;t<A;t++){const s=g[t];if(v[s]>1){const t={},r="instance."+E++,n="geometry"+s,A=16*B[e],a=h.subarray(A,A+16);i.createMesh(_.apply(t,{id:r,geometryId:n,matrix:a})),o.push(r)}else o.push(s)}if(o.length>0){const e={};i.createEntity(_.apply(e,{id:r,isObject:!0,meshIds:o}))}}}(0,0,o,i,0,n)}};let Hy=window.pako||My;Hy.inflate||(Hy=Hy.default);const Ny=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const Gy={version:6,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],indices:e[2],edgeIndices:e[3],matrices:e[4],reusedPrimitivesDecodeMatrix:e[5],eachPrimitivePositionsAndNormalsPortion:e[6],eachPrimitiveIndicesPortion:e[7],eachPrimitiveEdgeIndicesPortion:e[8],eachPrimitiveColorAndOpacity:e[9],primitiveInstances:e[10],eachEntityId:e[11],eachEntityPrimitiveInstancesPortion:e[12],eachEntityMatricesPortion:e[13],eachTileAABB:e[14],eachTileEntitiesPortion:e[15]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:Hy.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedPrimitivesDecodeMatrix:new Float32Array(t(e.reusedPrimitivesDecodeMatrix)),eachPrimitivePositionsAndNormalsPortion:new Uint32Array(t(e.eachPrimitivePositionsAndNormalsPortion)),eachPrimitiveIndicesPortion:new Uint32Array(t(e.eachPrimitiveIndicesPortion)),eachPrimitiveEdgeIndicesPortion:new Uint32Array(t(e.eachPrimitiveEdgeIndicesPortion)),eachPrimitiveColorAndOpacity:new Uint8Array(t(e.eachPrimitiveColorAndOpacity)),primitiveInstances:new Uint32Array(t(e.primitiveInstances)),eachEntityId:Hy.inflate(e.eachEntityId,{to:"string"}),eachEntityPrimitiveInstancesPortion:new Uint32Array(t(e.eachEntityPrimitiveInstancesPortion)),eachEntityMatricesPortion:new Uint32Array(t(e.eachEntityMatricesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(A);!function(e,t,s,i,r,n){const A=n.getNextId(),o=s.positions,a=s.normals,l=s.indices,c=s.edgeIndices,u=s.matrices,d=s.reusedPrimitivesDecodeMatrix,p=s.eachPrimitivePositionsAndNormalsPortion,f=s.eachPrimitiveIndicesPortion,g=s.eachPrimitiveEdgeIndicesPortion,m=s.eachPrimitiveColorAndOpacity,b=s.primitiveInstances,B=JSON.parse(s.eachEntityId),y=s.eachEntityPrimitiveInstancesPortion,w=s.eachEntityMatricesPortion,v=s.eachTileAABB,C=s.eachTileEntitiesPortion,M=p.length,E=b.length,F=B.length,x=C.length,U=new Uint32Array(M);for(let e=0;e<E;e++){const t=b[e];void 0!==U[t]?U[t]++:U[t]=1}const I=h.vec3(),T=h.AABB3();for(let s=0;s<x;s++){const r=s===x-1,E=C[s],P=r?F:C[s+1],S=6*s,D=v.subarray(S,S+6);h.getAABB3Center(D,I),T[0]=D[0]-I[0],T[1]=D[1]-I[1],T[2]=D[2]-I[2],T[3]=D[3]-I[0],T[4]=D[4]-I[1],T[5]=D[5]-I[2];const k=he.createPositionsDecodeMatrix(T),Q={};for(let r=E;r<P;r++){const v=B[r],C=t.globalizeObjectIds?h.globalizeObjectId(i.id,v):v,E=w[r],x=u.slice(E,E+16),T=r===F-1,P=y[r],S=T?b.length:y[r+1],D=[],R=e.metaScene.metaObjects[C],O={},V={};if(R){if(t.excludeTypesMap&&R.type&&t.excludeTypesMap[R.type])continue;if(t.includeTypesMap&&R.type&&!t.includeTypesMap[R.type])continue;if(t.includeIdsMap&&R.id&&!t.includeIdsMap[R.id])continue;const e=t.objectDefaults?t.objectDefaults[R.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(O.visible=!1),!1===e.pickable&&(O.pickable=!1),e.colorize&&(V.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(V.opacity=e.opacity))}else if(t.excludeUnclassifiedObjects)continue;for(let e=P;e<S;e++){const t=b[e],r=U[t]>1,h=t===M-1,u=o.subarray(p[t],h?o.length:p[t+1]),B=a.subarray(p[t],h?a.length:p[t+1]),y=l.subarray(f[t],h?l.length:f[t+1]),w=c.subarray(g[t],h?c.length:g[t+1]),v=Ny(m.subarray(4*t,4*t+3)),C=m[4*t+3]/255,E=n.getNextId();if(r){const e=`${A}-geometry.${s}.${t}`;Q[e]||(i.createGeometry({id:e,primitive:"triangles",positionsCompressed:u,indices:y,edgeIndices:w,positionsDecodeMatrix:d}),Q[e]=!0),i.createMesh(_.apply(V,{id:E,geometryId:e,origin:I,matrix:x,color:v,opacity:C})),D.push(E)}else i.createMesh(_.apply(V,{id:E,origin:I,primitive:"triangles",positionsCompressed:u,normalsCompressed:B,indices:y,edgeIndices:w,positionsDecodeMatrix:k,color:v,opacity:C})),D.push(E)}D.length>0&&i.createEntity(_.apply(O,{id:C,isObject:!0,meshIds:D}))}}}(e,t,o,i,0,n)}};let jy=window.pako||My;jy.inflate||(jy=jy.default);const Wy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function zy(e){const t=[];for(let s=0,i=e.length;s<i;s+=3)t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(1);return t}const Xy={version:7,parse:function(e,t,s,i,r,n){const A=function(e){return{positions:e[0],normals:e[1],colors:e[2],indices:e[3],edgeIndices:e[4],matrices:e[5],reusedGeometriesDecodeMatrix:e[6],eachGeometryPrimitiveType:e[7],eachGeometryPositionsPortion:e[8],eachGeometryNormalsPortion:e[9],eachGeometryColorsPortion:e[10],eachGeometryIndicesPortion:e[11],eachGeometryEdgeIndicesPortion:e[12],eachMeshGeometriesPortion:e[13],eachMeshMatricesPortion:e[14],eachMeshMaterial:e[15],eachEntityId:e[16],eachEntityMeshesPortion:e[17],eachTileAABB:e[18],eachTileEntitiesPortion:e[19]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:jy.inflate(e,t).buffer}return{positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:jy.inflate(e.eachEntityId,{to:"string"}),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(A);!function(e,t,s,i,r,n){const A=n.getNextId(),o=s.positions,a=s.normals,l=s.colors,c=s.indices,u=s.edgeIndices,d=s.matrices,p=s.reusedGeometriesDecodeMatrix,f=s.eachGeometryPrimitiveType,g=s.eachGeometryPositionsPortion,m=s.eachGeometryNormalsPortion,b=s.eachGeometryColorsPortion,B=s.eachGeometryIndicesPortion,y=s.eachGeometryEdgeIndicesPortion,w=s.eachMeshGeometriesPortion,v=s.eachMeshMatricesPortion,C=s.eachMeshMaterial,M=JSON.parse(s.eachEntityId),E=s.eachEntityMeshesPortion,F=s.eachTileAABB,x=s.eachTileEntitiesPortion,U=g.length,I=w.length,T=M.length,P=x.length,S=new Uint32Array(U);for(let e=0;e<I;e++){const t=w[e];void 0!==S[t]?S[t]++:S[t]=1}const D=h.vec3(),k=h.AABB3();for(let s=0;s<P;s++){const r=s===P-1,I=x[s],Q=r?T:x[s+1],R=6*s,O=F.subarray(R,R+6);h.getAABB3Center(O,D),k[0]=O[0]-D[0],k[1]=O[1]-D[1],k[2]=O[2]-D[2],k[3]=O[3]-D[0],k[4]=O[4]-D[1],k[5]=O[5]-D[2];const V=he.createPositionsDecodeMatrix(k),L={};for(let r=I;r<Q;r++){const F=M[r],x=t.globalizeObjectIds?h.globalizeObjectId(i.id,F):F,I=r===T-1,P=E[r],k=I?w.length:E[r+1],Q=[],R=e.metaScene.metaObjects[x],O={},H={};if(R){if(t.excludeTypesMap&&R.type&&t.excludeTypesMap[R.type])continue;if(t.includeTypesMap&&R.type&&!t.includeTypesMap[R.type])continue;if(t.includeIdsMap&&R.id&&!t.includeIdsMap[R.id])continue;const e=t.objectDefaults?t.objectDefaults[R.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(O.visible=!1),!1===e.pickable&&(O.pickable=!1),e.colorize&&(H.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(H.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(H.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(H.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=P;e<k;e++){const t=w[e],r=S[t]>1,h=t===U-1,M=Wy(C.subarray(6*e,6*e+3)),E=C[6*e+3]/255,F=C[6*e+4]/255,x=C[6*e+5]/255,I=n.getNextId();if(r){const r=v[e],n=d.slice(r,r+16),w=`${A}-geometry.${s}.${t}`;if(!L[w]){let e,s,r,n,A,d;switch(f[t]){case 0:e="solid",s=o.subarray(g[t],h?o.length:g[t+1]),r=a.subarray(m[t],h?a.length:m[t+1]),A=c.subarray(B[t],h?c.length:B[t+1]),d=u.subarray(y[t],h?u.length:y[t+1]);break;case 1:e="surface",s=o.subarray(g[t],h?o.length:g[t+1]),r=a.subarray(m[t],h?a.length:m[t+1]),A=c.subarray(B[t],h?c.length:B[t+1]),d=u.subarray(y[t],h?u.length:y[t+1]);break;case 2:e="points",s=o.subarray(g[t],h?o.length:g[t+1]),n=zy(l.subarray(b[t],h?l.length:b[t+1]));break;case 3:e="lines",s=o.subarray(g[t],h?o.length:g[t+1]),A=c.subarray(B[t],h?c.length:B[t+1]);break;default:continue}i.createGeometry({id:w,primitive:e,positionsCompressed:s,normalsCompressed:r,colors:n,indices:A,edgeIndices:d,positionsDecodeMatrix:p}),L[w]=!0}i.createMesh(_.apply(H,{id:I,geometryId:w,origin:D,matrix:n,color:M,metallic:F,roughness:x,opacity:E})),Q.push(I)}else{let e,s,r,n,A,d;switch(f[t]){case 0:e="solid",s=o.subarray(g[t],h?o.length:g[t+1]),r=a.subarray(m[t],h?a.length:m[t+1]),A=c.subarray(B[t],h?c.length:B[t+1]),d=u.subarray(y[t],h?u.length:y[t+1]);break;case 1:e="surface",s=o.subarray(g[t],h?o.length:g[t+1]),r=a.subarray(m[t],h?a.length:m[t+1]),A=c.subarray(B[t],h?c.length:B[t+1]),d=u.subarray(y[t],h?u.length:y[t+1]);break;case 2:e="points",s=o.subarray(g[t],h?o.length:g[t+1]),n=zy(l.subarray(b[t],h?l.length:b[t+1]));break;case 3:e="lines",s=o.subarray(g[t],h?o.length:g[t+1]),A=c.subarray(B[t],h?c.length:B[t+1]);break;default:continue}i.createMesh(_.apply(H,{id:I,origin:D,primitive:e,positionsCompressed:s,normalsCompressed:r,colors:n,indices:A,edgeIndices:d,positionsDecodeMatrix:V,color:M,metallic:F,roughness:x,opacity:E})),Q.push(I)}}Q.length>0&&i.createEntity(_.apply(O,{id:x,isObject:!0,meshIds:Q}))}}}(e,t,o,i,0,n)}};let Ky=window.pako||My;Ky.inflate||(Ky=Ky.default);const Zy=h.vec4(),Jy=h.vec4();const Yy=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function $y(e){const t=[];for(let s=0,i=e.length;s<i;s+=3)t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]),t.push(1);return t}const qy={version:8,parse:function(e,t,s,i,r,n){const A=function(e){return{types:e[0],eachMetaObjectId:e[1],eachMetaObjectType:e[2],eachMetaObjectName:e[3],eachMetaObjectParent:e[4],positions:e[5],normals:e[6],colors:e[7],indices:e[8],edgeIndices:e[9],matrices:e[10],reusedGeometriesDecodeMatrix:e[11],eachGeometryPrimitiveType:e[12],eachGeometryPositionsPortion:e[13],eachGeometryNormalsPortion:e[14],eachGeometryColorsPortion:e[15],eachGeometryIndicesPortion:e[16],eachGeometryEdgeIndicesPortion:e[17],eachMeshGeometriesPortion:e[18],eachMeshMatricesPortion:e[19],eachMeshMaterial:e[20],eachEntityMetaObject:e[21],eachEntityMeshesPortion:e[22],eachTileAABB:e[23],eachTileEntitiesPortion:e[24]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:Ky.inflate(e,t).buffer}return{types:Ky.inflate(e.types,{to:"string"}),eachMetaObjectId:Ky.inflate(e.eachMetaObjectId,{to:"string"}),eachMetaObjectType:new Uint32Array(t(e.eachMetaObjectType)),eachMetaObjectName:Ky.inflate(e.eachMetaObjectName,{to:"string"}),eachMetaObjectParent:new Uint32Array(t(e.eachMetaObjectParent)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityMetaObject:new Uint32Array(t(e.eachEntityMetaObject)),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(A);!function(e,t,s,i,r,n){const A=n.getNextId(),o=JSON.parse(s.types),a=JSON.parse(s.eachMetaObjectId),l=s.eachMetaObjectType,c=JSON.parse(s.eachMetaObjectName),u=s.eachMetaObjectParent,d=s.positions,p=s.normals,f=s.colors,g=s.indices,m=s.edgeIndices,b=s.matrices,B=s.reusedGeometriesDecodeMatrix,y=s.eachGeometryPrimitiveType,w=s.eachGeometryPositionsPortion,v=s.eachGeometryNormalsPortion,C=s.eachGeometryColorsPortion,M=s.eachGeometryIndicesPortion,E=s.eachGeometryEdgeIndicesPortion,F=s.eachMeshGeometriesPortion,x=s.eachMeshMatricesPortion,U=s.eachMeshMaterial,I=s.eachEntityMetaObject,T=s.eachEntityMeshesPortion,P=s.eachTileAABB,S=s.eachTileEntitiesPortion,D=a.length,k=w.length,Q=F.length,R=I.length,O=S.length;if(r){const e={metaObjects:[]};for(let t=0;t<D;t++){const s=a[t],i=o[l[t]]||"default",r=c[t],n=u[t],A=n!==t?a[n]:null;e.metaObjects.push({id:s,type:i,name:r,parent:A})}r.loadData(e,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds})}const V=new Uint32Array(k);for(let e=0;e<Q;e++){const t=F[e];void 0!==V[t]?V[t]++:V[t]=1}const L=h.vec3(),H=h.AABB3(),N={};for(let s=0;s<O;s++){const r=s===O-1,o=S[s],l=r?R:S[s+1],c=6*s,u=P.subarray(c,c+6);h.getAABB3Center(u,L),H[0]=u[0]-L[0],H[1]=u[1]-L[1],H[2]=u[2]-L[2],H[3]=u[3]-L[0],H[4]=u[4]-L[1],H[5]=u[5]-L[2];const D=he.createPositionsDecodeMatrix(H),Q={};for(let r=o;r<l;r++){const o=a[I[r]],l=t.globalizeObjectIds?h.globalizeObjectId(i.id,o):o,c=r===R-1,u=T[r],P=c?F.length:T[r+1],S=[],O=e.metaScene.metaObjects[l],G={},j={};if(O){if(t.excludeTypesMap&&O.type&&t.excludeTypesMap[O.type])continue;if(t.includeTypesMap&&O.type&&!t.includeTypesMap[O.type])continue;if(t.includeIdsMap&&O.id&&!t.includeIdsMap[O.id])continue;const e=t.objectDefaults?t.objectDefaults[O.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(G.visible=!1),!1===e.pickable&&(G.pickable=!1),e.colorize&&(j.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(j.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(j.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(j.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=u;e<P;e++){const r=F[e],o=V[r]>1,a=r===k-1,l=Yy(U.subarray(6*e,6*e+3)),c=U[6*e+3]/255,u=U[6*e+4]/255,I=U[6*e+5]/255,T=n.getNextId();if(o){const n=x[e],o=b.slice(n,n+16),F=`${A}-geometry.${s}.${r}`;let U=N[F];if(!U){U={batchThisMesh:!t.reuseGeometries};let e=!1;switch(y[r]){case 0:U.primitiveName="solid",U.geometryPositions=d.subarray(w[r],a?d.length:w[r+1]),U.geometryNormals=p.subarray(v[r],a?p.length:v[r+1]),U.geometryIndices=g.subarray(M[r],a?g.length:M[r+1]),U.geometryEdgeIndices=m.subarray(E[r],a?m.length:E[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 1:U.primitiveName="surface",U.geometryPositions=d.subarray(w[r],a?d.length:w[r+1]),U.geometryNormals=p.subarray(v[r],a?p.length:v[r+1]),U.geometryIndices=g.subarray(M[r],a?g.length:M[r+1]),U.geometryEdgeIndices=m.subarray(E[r],a?m.length:E[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 2:U.primitiveName="points",U.geometryPositions=d.subarray(w[r],a?d.length:w[r+1]),U.geometryColors=$y(f.subarray(C[r],a?f.length:C[r+1])),e=U.geometryPositions.length>0;break;case 3:U.primitiveName="lines",U.geometryPositions=d.subarray(w[r],a?d.length:w[r+1]),U.geometryIndices=g.subarray(M[r],a?g.length:M[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;default:continue}if(e||(U=null),U&&(U.geometryPositions.length,U.batchThisMesh)){U.decompressedPositions=new Float32Array(U.geometryPositions.length);const e=U.geometryPositions,t=U.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*B[0]+B[12],t[s+1]=e[s+1]*B[5]+B[13],t[s+2]=e[s+2]*B[10]+B[14];U.geometryPositions=null,N[F]=U}}if(U)if(U.batchThisMesh){const e=U.decompressedPositions,t=new Uint16Array(e.length);for(let s=0,i=e.length;s<i;s+=3)Zy[0]=e[s+0],Zy[1]=e[s+1],Zy[2]=e[s+2],Zy[3]=1,h.transformVec4(o,Zy,Jy),he.compressPosition(Jy,H,Zy),t[s+0]=Zy[0],t[s+1]=Zy[1],t[s+2]=Zy[2];i.createMesh(_.apply(j,{id:T,origin:L,primitive:U.primitiveName,positionsCompressed:t,normalsCompressed:U.geometryNormals,colorsCompressed:U.geometryColors,indices:U.geometryIndices,edgeIndices:U.geometryEdgeIndices,positionsDecodeMatrix:D,color:l,metallic:u,roughness:I,opacity:c})),S.push(T)}else Q[F]||(i.createGeometry({id:F,primitive:U.primitiveName,positionsCompressed:U.geometryPositions,normalsCompressed:U.geometryNormals,colorsCompressed:U.geometryColors,indices:U.geometryIndices,edgeIndices:U.geometryEdgeIndices,positionsDecodeMatrix:B}),Q[F]=!0),i.createMesh(_.apply(j,{id:T,geometryId:F,origin:L,matrix:o,color:l,metallic:u,roughness:I,opacity:c})),S.push(T)}else{let e,t,s,n,A,o,h=!1;switch(y[r]){case 0:e="solid",t=d.subarray(w[r],a?d.length:w[r+1]),s=p.subarray(v[r],a?p.length:v[r+1]),A=g.subarray(M[r],a?g.length:M[r+1]),o=m.subarray(E[r],a?m.length:E[r+1]),h=t.length>0&&A.length>0;break;case 1:e="surface",t=d.subarray(w[r],a?d.length:w[r+1]),s=p.subarray(v[r],a?p.length:v[r+1]),A=g.subarray(M[r],a?g.length:M[r+1]),o=m.subarray(E[r],a?m.length:E[r+1]),h=t.length>0&&A.length>0;break;case 2:e="points",t=d.subarray(w[r],a?d.length:w[r+1]),n=$y(f.subarray(C[r],a?f.length:C[r+1])),h=t.length>0;break;case 3:e="lines",t=d.subarray(w[r],a?d.length:w[r+1]),A=g.subarray(M[r],a?g.length:M[r+1]),h=t.length>0&&A.length>0;break;default:continue}h&&(i.createMesh(_.apply(j,{id:T,origin:L,primitive:e,positionsCompressed:t,normalsCompressed:s,colorsCompressed:n,indices:A,edgeIndices:o,positionsDecodeMatrix:D,color:l,metallic:u,roughness:I,opacity:c})),S.push(T))}}S.length>0&&i.createEntity(_.apply(G,{id:l,isObject:!0,meshIds:S}))}}}(e,t,o,i,r,n)}};let ew=window.pako||My;ew.inflate||(ew=ew.default);const tw=h.vec4(),sw=h.vec4();const iw=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();const rw={version:9,parse:function(e,t,s,i,r,n){const A=function(e){return{metadata:e[0],positions:e[1],normals:e[2],colors:e[3],indices:e[4],edgeIndices:e[5],matrices:e[6],reusedGeometriesDecodeMatrix:e[7],eachGeometryPrimitiveType:e[8],eachGeometryPositionsPortion:e[9],eachGeometryNormalsPortion:e[10],eachGeometryColorsPortion:e[11],eachGeometryIndicesPortion:e[12],eachGeometryEdgeIndicesPortion:e[13],eachMeshGeometriesPortion:e[14],eachMeshMatricesPortion:e[15],eachMeshMaterial:e[16],eachEntityId:e[17],eachEntityMeshesPortion:e[18],eachTileAABB:e[19],eachTileEntitiesPortion:e[20]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:ew.inflate(e,t).buffer}return{metadata:JSON.parse(ew.inflate(e.metadata,{to:"string"})),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshMaterial:new Uint8Array(t(e.eachMeshMaterial)),eachEntityId:JSON.parse(ew.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(A);!function(e,t,s,i,r,n){const A=n.getNextId(),o=s.metadata,a=s.positions,l=s.normals,c=s.colors,u=s.indices,d=s.edgeIndices,p=s.matrices,f=s.reusedGeometriesDecodeMatrix,g=s.eachGeometryPrimitiveType,m=s.eachGeometryPositionsPortion,b=s.eachGeometryNormalsPortion,B=s.eachGeometryColorsPortion,y=s.eachGeometryIndicesPortion,w=s.eachGeometryEdgeIndicesPortion,v=s.eachMeshGeometriesPortion,C=s.eachMeshMatricesPortion,M=s.eachMeshMaterial,E=s.eachEntityId,F=s.eachEntityMeshesPortion,x=s.eachTileAABB,U=s.eachTileEntitiesPortion,I=m.length,T=v.length,P=F.length,S=U.length;r&&r.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});const D=new Uint32Array(I);for(let e=0;e<T;e++){const t=v[e];void 0!==D[t]?D[t]++:D[t]=1}const k=h.vec3(),Q=h.AABB3(),R={};for(let s=0;s<S;s++){const r=s===S-1,o=U[s],T=r?P-1:U[s+1]-1,O=6*s,V=x.subarray(O,O+6);h.getAABB3Center(V,k),Q[0]=V[0]-k[0],Q[1]=V[1]-k[1],Q[2]=V[2]-k[2],Q[3]=V[3]-k[0],Q[4]=V[4]-k[1],Q[5]=V[5]-k[2];const L=he.createPositionsDecodeMatrix(Q),H={};for(let r=o;r<=T;r++){const o=E[r],x=t.globalizeObjectIds?h.globalizeObjectId(i.id,o):o,U=r===P-1,T=F[r],S=U?v.length-1:F[r+1]-1,O=[],V=e.metaScene.metaObjects[x],N={},G={};if(V){if(t.excludeTypesMap&&V.type&&t.excludeTypesMap[V.type])continue;if(t.includeTypesMap&&V.type&&!t.includeTypesMap[V.type])continue;if(t.includeIdsMap&&V.id&&!t.includeIdsMap[V.id])continue;const e=t.objectDefaults?t.objectDefaults[V.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(N.visible=!1),!1===e.pickable&&(N.pickable=!1),e.colorize&&(G.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(G.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(G.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(G.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=T;e<=S;e++){const r=v[e],o=D[r]>1,E=r===I-1,F=iw(M.subarray(6*e,6*e+3)),x=M[6*e+3]/255,U=M[6*e+4]/255,T=M[6*e+5]/255,P=n.getNextId();if(o){const n=C[e],o=p.slice(n,n+16),v=`${A}-geometry.${s}.${r}`;let M=R[v];if(!M){M={batchThisMesh:!t.reuseGeometries};let e=!1;switch(g[r]){case 0:M.primitiveName="solid",M.geometryPositions=a.subarray(m[r],E?a.length:m[r+1]),M.geometryNormals=l.subarray(b[r],E?l.length:b[r+1]),M.geometryIndices=u.subarray(y[r],E?u.length:y[r+1]),M.geometryEdgeIndices=d.subarray(w[r],E?d.length:w[r+1]),e=M.geometryPositions.length>0&&M.geometryIndices.length>0;break;case 1:M.primitiveName="surface",M.geometryPositions=a.subarray(m[r],E?a.length:m[r+1]),M.geometryNormals=l.subarray(b[r],E?l.length:b[r+1]),M.geometryIndices=u.subarray(y[r],E?u.length:y[r+1]),M.geometryEdgeIndices=d.subarray(w[r],E?d.length:w[r+1]),e=M.geometryPositions.length>0&&M.geometryIndices.length>0;break;case 2:M.primitiveName="points",M.geometryPositions=a.subarray(m[r],E?a.length:m[r+1]),M.geometryColors=c.subarray(B[r],E?c.length:B[r+1]),e=M.geometryPositions.length>0;break;case 3:M.primitiveName="lines",M.geometryPositions=a.subarray(m[r],E?a.length:m[r+1]),M.geometryIndices=u.subarray(y[r],E?u.length:y[r+1]),e=M.geometryPositions.length>0&&M.geometryIndices.length>0;break;default:continue}if(e||(M=null),M&&(M.geometryPositions.length,M.batchThisMesh)){M.decompressedPositions=new Float32Array(M.geometryPositions.length),M.transformedAndRecompressedPositions=new Uint16Array(M.geometryPositions.length);const e=M.geometryPositions,t=M.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*f[0]+f[12],t[s+1]=e[s+1]*f[5]+f[13],t[s+2]=e[s+2]*f[10]+f[14];M.geometryPositions=null,R[v]=M}}if(M)if(M.batchThisMesh){const e=M.decompressedPositions,t=M.transformedAndRecompressedPositions;for(let s=0,i=e.length;s<i;s+=3)tw[0]=e[s+0],tw[1]=e[s+1],tw[2]=e[s+2],tw[3]=1,h.transformVec4(o,tw,sw),he.compressPosition(sw,Q,tw),t[s+0]=tw[0],t[s+1]=tw[1],t[s+2]=tw[2];i.createMesh(_.apply(G,{id:P,origin:k,primitive:M.primitiveName,positionsCompressed:t,normalsCompressed:M.geometryNormals,colorsCompressed:M.geometryColors,indices:M.geometryIndices,edgeIndices:M.geometryEdgeIndices,positionsDecodeMatrix:L,color:F,metallic:U,roughness:T,opacity:x})),O.push(P)}else H[v]||(i.createGeometry({id:v,primitive:M.primitiveName,positionsCompressed:M.geometryPositions,normalsCompressed:M.geometryNormals,colorsCompressed:M.geometryColors,indices:M.geometryIndices,edgeIndices:M.geometryEdgeIndices,positionsDecodeMatrix:f}),H[v]=!0),i.createMesh(_.apply(G,{id:P,geometryId:v,origin:k,matrix:o,color:F,metallic:U,roughness:T,opacity:x})),O.push(P)}else{let e,t,s,n,A,o,h=!1;switch(g[r]){case 0:e="solid",t=a.subarray(m[r],E?a.length:m[r+1]),s=l.subarray(b[r],E?l.length:b[r+1]),A=u.subarray(y[r],E?u.length:y[r+1]),o=d.subarray(w[r],E?d.length:w[r+1]),h=t.length>0&&A.length>0;break;case 1:e="surface",t=a.subarray(m[r],E?a.length:m[r+1]),s=l.subarray(b[r],E?l.length:b[r+1]),A=u.subarray(y[r],E?u.length:y[r+1]),o=d.subarray(w[r],E?d.length:w[r+1]),h=t.length>0&&A.length>0;break;case 2:e="points",t=a.subarray(m[r],E?a.length:m[r+1]),n=c.subarray(B[r],E?c.length:B[r+1]),h=t.length>0;break;case 3:e="lines",t=a.subarray(m[r],E?a.length:m[r+1]),A=u.subarray(y[r],E?u.length:y[r+1]),h=t.length>0&&A.length>0;break;default:continue}h&&(i.createMesh(_.apply(G,{id:P,origin:k,primitive:e,positionsCompressed:t,normalsCompressed:s,colorsCompressed:n,indices:A,edgeIndices:o,positionsDecodeMatrix:L,color:F,metallic:U,roughness:T,opacity:x})),O.push(P))}}O.length>0&&i.createEntity(_.apply(N,{id:x,isObject:!0,meshIds:O}))}}}(e,t,o,i,r,n)}};let nw=window.pako||My;nw.inflate||(nw=nw.default);const Aw=h.vec4(),ow=h.vec4();const aw=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function lw(e,t){const s=[];if(t.length>1)for(let e=0,i=t.length-1;e<i;e++)s.push(t[e]),s.push(t[e+1]);else if(e.length>1)for(let t=0,i=e.length/3-1;t<i;t++)s.push(t),s.push(t+1);return s}!function(){const e=document.createElement("canvas"),t=e.getContext("2d")}();const cw={version:10,parse:function(e,t,s,i,r,n){const A=function(e){let t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:nw.inflate(e,t).buffer}return{metadata:JSON.parse(nw.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(nw.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(A);!function(e,t,s,i,r,n){const A=n.getNextId(),o=s.metadata,a=s.textureData,l=s.eachTextureDataPortion,c=s.eachTextureAttributes,u=s.positions,d=s.normals,p=s.colors,f=s.uvs,g=s.indices,m=s.edgeIndices,b=s.eachTextureSetTextures,B=s.matrices,y=s.reusedGeometriesDecodeMatrix,w=s.eachGeometryPrimitiveType,v=s.eachGeometryPositionsPortion,C=s.eachGeometryNormalsPortion,M=s.eachGeometryColorsPortion,E=s.eachGeometryUVsPortion,F=s.eachGeometryIndicesPortion,x=s.eachGeometryEdgeIndicesPortion,U=s.eachMeshGeometriesPortion,I=s.eachMeshMatricesPortion,T=s.eachMeshTextureSet,P=s.eachMeshMaterialAttributes,S=s.eachEntityId,D=s.eachEntityMeshesPortion,k=s.eachTileAABB,Q=s.eachTileEntitiesPortion,R=l.length,O=b.length/5,V=v.length,L=U.length,H=D.length,N=Q.length;r&&r.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(let e=0;e<R;e++){const t=e===R-1,s=l[e],r=t?a.length:l[e+1],n=r-s>0,o=9*e,h=1===c[o+0],u=c[o+1];c[o+2],c[o+3];const d=c[o+4],p=c[o+5],f=c[o+6],g=c[o+7],m=c[o+8];if(n){const t=new Uint8Array(a.subarray(s,r)).buffer,n=`${A}-texture-${e}`;if(h)i.createTexture({id:n,buffers:[t],minFilter:d,magFilter:p,wrapS:f,wrapT:g,wrapR:m});else{const e=new Blob([t],{type:10001===u?"image/jpeg":10002===u?"image/png":"image/gif"}),s=(window.URL||window.webkitURL).createObjectURL(e),r=document.createElement("img");r.src=s,i.createTexture({id:n,image:r,minFilter:d,magFilter:p,wrapS:f,wrapT:g,wrapR:m})}}}for(let e=0;e<O;e++){const t=5*e,s=`${A}-textureSet-${e}`,r=b[t+0],n=b[t+1],o=b[t+2],a=b[t+3],l=b[t+4];i.createTextureSet({id:s,colorTextureId:r>=0?`${A}-texture-${r}`:null,normalsTextureId:o>=0?`${A}-texture-${o}`:null,metallicRoughnessTextureId:n>=0?`${A}-texture-${n}`:null,emissiveTextureId:a>=0?`${A}-texture-${a}`:null,occlusionTextureId:l>=0?`${A}-texture-${l}`:null})}const G=new Uint32Array(V);for(let e=0;e<L;e++){const t=U[e];void 0!==G[t]?G[t]++:G[t]=1}const j=h.vec3(),W=h.AABB3(),z={};for(let s=0;s<N;s++){const r=s===N-1,o=Q[s],a=r?H-1:Q[s+1]-1,l=6*s,c=k.subarray(l,l+6);h.getAABB3Center(c,j),W[0]=c[0]-j[0],W[1]=c[1]-j[1],W[2]=c[2]-j[2],W[3]=c[3]-j[0],W[4]=c[4]-j[1],W[5]=c[5]-j[2];const b=he.createPositionsDecodeMatrix(W),R={};for(let r=o;r<=a;r++){const o=S[r],a=t.globalizeObjectIds?h.globalizeObjectId(i.id,o):o,l=r===H-1,c=D[r],k=l?U.length-1:D[r+1]-1,Q=[],O=e.metaScene.metaObjects[a],L={},N={};if(O){if(t.excludeTypesMap&&O.type&&t.excludeTypesMap[O.type])continue;if(t.includeTypesMap&&O.type&&!t.includeTypesMap[O.type])continue;if(t.includeIdsMap&&O.id&&!t.includeIdsMap[O.id])continue;const e=t.objectDefaults?t.objectDefaults[O.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(L.visible=!1),!1===e.pickable&&(L.pickable=!1),e.colorize&&(N.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(N.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(N.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(N.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=c;e<=k;e++){const r=U[e],o=G[r]>1,a=r===V-1,l=T[e],c=l>=0?`${A}-textureSet-${l}`:null,S=aw(P.subarray(6*e,6*e+3)),D=P[6*e+3]/255,k=P[6*e+4]/255,O=P[6*e+5]/255,L=n.getNextId();if(o){const n=I[e],o=B.slice(n,n+16),l=`${A}-geometry.${s}.${r}`;let U=z[l];if(!U){U={batchThisMesh:!t.reuseGeometries};let e=!1;switch(w[r]){case 0:U.primitiveName="solid",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryNormals=d.subarray(C[r],a?d.length:C[r+1]),U.geometryUVs=f.subarray(E[r],a?f.length:E[r+1]),U.geometryIndices=g.subarray(F[r],a?g.length:F[r+1]),U.geometryEdgeIndices=m.subarray(x[r],a?m.length:x[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 1:U.primitiveName="surface",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryNormals=d.subarray(C[r],a?d.length:C[r+1]),U.geometryUVs=f.subarray(E[r],a?f.length:E[r+1]),U.geometryIndices=g.subarray(F[r],a?g.length:F[r+1]),U.geometryEdgeIndices=m.subarray(x[r],a?m.length:x[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 2:U.primitiveName="points",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryColors=p.subarray(M[r],a?p.length:M[r+1]),e=U.geometryPositions.length>0;break;case 3:U.primitiveName="lines",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryIndices=g.subarray(F[r],a?g.length:F[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 4:U.primitiveName="lines",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryIndices=lw(U.geometryPositions,g.subarray(F[r],a?g.length:F[r+1])),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;default:continue}if(e||(U=null),U&&(U.geometryPositions.length,U.batchThisMesh)){U.decompressedPositions=new Float32Array(U.geometryPositions.length),U.transformedAndRecompressedPositions=new Uint16Array(U.geometryPositions.length);const e=U.geometryPositions,t=U.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*y[0]+y[12],t[s+1]=e[s+1]*y[5]+y[13],t[s+2]=e[s+2]*y[10]+y[14];U.geometryPositions=null,z[l]=U}}if(U)if(U.batchThisMesh){const e=U.decompressedPositions,t=U.transformedAndRecompressedPositions;for(let s=0,i=e.length;s<i;s+=3)Aw[0]=e[s+0],Aw[1]=e[s+1],Aw[2]=e[s+2],Aw[3]=1,h.transformVec4(o,Aw,ow),he.compressPosition(ow,W,Aw),t[s+0]=Aw[0],t[s+1]=Aw[1],t[s+2]=Aw[2];i.createMesh(_.apply(N,{id:L,textureSetId:c,origin:j,primitive:U.primitiveName,positionsCompressed:t,normalsCompressed:U.geometryNormals,uv:U.geometryUVs,colorsCompressed:U.geometryColors,indices:U.geometryIndices,edgeIndices:U.geometryEdgeIndices,positionsDecodeMatrix:b,color:S,metallic:k,roughness:O,opacity:D})),Q.push(L)}else R[l]||(i.createGeometry({id:l,primitive:U.primitiveName,positionsCompressed:U.geometryPositions,normalsCompressed:U.geometryNormals,uv:U.geometryUVs,colorsCompressed:U.geometryColors,indices:U.geometryIndices,edgeIndices:U.geometryEdgeIndices,positionsDecodeMatrix:y}),R[l]=!0),i.createMesh(_.apply(N,{id:L,geometryId:l,textureSetId:c,matrix:o,color:S,metallic:k,roughness:O,opacity:D,origin:j})),Q.push(L)}else{let e,t,s,n,A,o,l,h=!1;switch(w[r]){case 0:e="solid",t=u.subarray(v[r],a?u.length:v[r+1]),s=d.subarray(C[r],a?d.length:C[r+1]),n=f.subarray(E[r],a?f.length:E[r+1]),o=g.subarray(F[r],a?g.length:F[r+1]),l=m.subarray(x[r],a?m.length:x[r+1]),h=t.length>0&&o.length>0;break;case 1:e="surface",t=u.subarray(v[r],a?u.length:v[r+1]),s=d.subarray(C[r],a?d.length:C[r+1]),n=f.subarray(E[r],a?f.length:E[r+1]),o=g.subarray(F[r],a?g.length:F[r+1]),l=m.subarray(x[r],a?m.length:x[r+1]),h=t.length>0&&o.length>0;break;case 2:e="points",t=u.subarray(v[r],a?u.length:v[r+1]),A=p.subarray(M[r],a?p.length:M[r+1]),h=t.length>0;break;case 3:e="lines",t=u.subarray(v[r],a?u.length:v[r+1]),o=g.subarray(F[r],a?g.length:F[r+1]),h=t.length>0&&o.length>0;break;case 4:e="lines",t=u.subarray(v[r],a?u.length:v[r+1]),o=lw(t,g.subarray(F[r],a?g.length:F[r+1])),h=t.length>0&&o.length>0;break;default:continue}h&&(i.createMesh(_.apply(N,{id:L,textureSetId:c,origin:j,primitive:e,positionsCompressed:t,normalsCompressed:s,uv:n&&n.length>0?n:null,colorsCompressed:A,indices:o,edgeIndices:l,positionsDecodeMatrix:b,color:S,metallic:k,roughness:O,opacity:D})),Q.push(L))}}Q.length>0&&i.createEntity(_.apply(L,{id:a,isObject:!0,meshIds:Q}))}}}(e,t,o,i,r,n)}},hw=h.vec4(),uw=h.vec4();const dw=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function pw(e,t){const s=[];if(t.length>1)for(let e=0,i=t.length-1;e<i;e++)s.push(t[e]),s.push(t[e+1]);else if(e.length>1)for(let t=0,i=e.length/3-1;t<i;t++)s.push(t),s.push(t+1);return s}!function(){const e=document.createElement("canvas"),t=e.getContext("2d")}();const fw={version:11,parseArrayBuffer:function(e,t,s,i,r,n){const A=function(e){const t=function(){const e=new ArrayBuffer(2);return new Uint16Array(e)[0]=1,1!==new Uint8Array(e)[0]}(),s=function(){let s=0;const i=new DataView(e);return function(r){const n=1+2*s++,A=i.getUint32(4*n,!0),o=i.getUint32(4*(n+1),!0),a=r.BYTES_PER_ELEMENT;if(t&&a>1){const t=new Uint8Array(e,A,o),s=a/2,i=t.length/a;for(let e=0;e<i;e++){const i=e*a;for(let e=0;e<s;e++){const s=i+e,r=i-e+a-1,n=t[s];t[s]=t[r],t[r]=n}}}return new r(e,A,o/a)}}(),i=function(){const e=new TextDecoder;return()=>JSON.parse(e.decode(s(Uint8Array)))}();return{metadata:i(),textureData:s(Uint8Array),eachTextureDataPortion:s(Uint32Array),eachTextureAttributes:s(Uint16Array),positions:s(Uint16Array),normals:s(Int8Array),colors:s(Uint8Array),uvs:s(Float32Array),indices:s(Uint32Array),edgeIndices:s(Uint32Array),eachTextureSetTextures:s(Int32Array),matrices:s(Float32Array),reusedGeometriesDecodeMatrix:s(Float32Array),eachGeometryPrimitiveType:s(Uint8Array),eachGeometryPositionsPortion:s(Uint32Array),eachGeometryNormalsPortion:s(Uint32Array),eachGeometryColorsPortion:s(Uint32Array),eachGeometryUVsPortion:s(Uint32Array),eachGeometryIndicesPortion:s(Uint32Array),eachGeometryEdgeIndicesPortion:s(Uint32Array),eachMeshGeometriesPortion:s(Uint32Array),eachMeshMatricesPortion:s(Uint32Array),eachMeshTextureSet:s(Int32Array),eachMeshMaterialAttributes:s(Uint8Array),eachEntityId:i(),eachEntityMeshesPortion:s(Uint32Array),eachTileAABB:s(Float64Array),eachTileEntitiesPortion:s(Uint32Array)}}(s);!function(e,t,s,i,r,n){const A=n.getNextId(),o=s.metadata,a=s.textureData,l=s.eachTextureDataPortion,c=s.eachTextureAttributes,u=s.positions,d=s.normals,p=s.colors,f=s.uvs,g=s.indices,m=s.edgeIndices,b=s.eachTextureSetTextures,B=s.matrices,y=s.reusedGeometriesDecodeMatrix,w=s.eachGeometryPrimitiveType,v=s.eachGeometryPositionsPortion,C=s.eachGeometryNormalsPortion,M=s.eachGeometryColorsPortion,E=s.eachGeometryUVsPortion,F=s.eachGeometryIndicesPortion,x=s.eachGeometryEdgeIndicesPortion,U=s.eachMeshGeometriesPortion,I=s.eachMeshMatricesPortion,T=s.eachMeshTextureSet,P=s.eachMeshMaterialAttributes,S=s.eachEntityId,D=s.eachEntityMeshesPortion,k=s.eachTileAABB,Q=s.eachTileEntitiesPortion,R=l.length,O=b.length/5,V=v.length,L=U.length,H=D.length,N=Q.length;r&&r.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(let e=0;e<R;e++){const t=e===R-1,s=l[e],r=t?a.length:l[e+1],n=r-s>0,o=9*e,h=1===c[o+0],u=c[o+1];c[o+2],c[o+3];const d=c[o+4],p=c[o+5],f=c[o+6],g=c[o+7],m=c[o+8];if(n){const t=new Uint8Array(a.subarray(s,r)).buffer,n=`${A}-texture-${e}`;if(h)i.createTexture({id:n,buffers:[t],minFilter:d,magFilter:p,wrapS:f,wrapT:g,wrapR:m});else{const e=new Blob([t],{type:10001===u?"image/jpeg":10002===u?"image/png":"image/gif"}),s=(window.URL||window.webkitURL).createObjectURL(e),r=document.createElement("img");r.src=s,i.createTexture({id:n,image:r,minFilter:d,magFilter:p,wrapS:f,wrapT:g,wrapR:m})}}}for(let e=0;e<O;e++){const t=5*e,s=`${A}-textureSet-${e}`,r=b[t+0],n=b[t+1],o=b[t+2],a=b[t+3],l=b[t+4];i.createTextureSet({id:s,colorTextureId:r>=0?`${A}-texture-${r}`:null,normalsTextureId:o>=0?`${A}-texture-${o}`:null,metallicRoughnessTextureId:n>=0?`${A}-texture-${n}`:null,emissiveTextureId:a>=0?`${A}-texture-${a}`:null,occlusionTextureId:l>=0?`${A}-texture-${l}`:null})}const G=new Uint32Array(V);for(let e=0;e<L;e++){const t=U[e];void 0!==G[t]?G[t]++:G[t]=1}const j=h.vec3(),W=h.AABB3(),z={};for(let s=0;s<N;s++){const r=s===N-1,o=Q[s],a=r?H-1:Q[s+1]-1,l=6*s,c=k.subarray(l,l+6);h.getAABB3Center(c,j),W[0]=c[0]-j[0],W[1]=c[1]-j[1],W[2]=c[2]-j[2],W[3]=c[3]-j[0],W[4]=c[4]-j[1],W[5]=c[5]-j[2];const b=he.createPositionsDecodeMatrix(W),R={};for(let r=o;r<=a;r++){const o=S[r],a=t.globalizeObjectIds?h.globalizeObjectId(i.id,o):o,l=r===H-1,c=D[r],k=l?U.length-1:D[r+1]-1,Q=[],O=e.metaScene.metaObjects[a],L={},N={};if(O){if(t.excludeTypesMap&&O.type&&t.excludeTypesMap[O.type])continue;if(t.includeTypesMap&&O.type&&!t.includeTypesMap[O.type])continue;if(t.includeIdsMap&&O.id&&!t.includeIdsMap[O.id])continue;const e=t.objectDefaults?t.objectDefaults[O.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(L.visible=!1),!1===e.pickable&&(L.pickable=!1),e.colorize&&(N.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(N.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(N.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(N.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=c;e<=k;e++){const r=U[e],o=G[r]>1,a=r===V-1,l=T[e],c=l>=0?`${A}-textureSet-${l}`:null,S=dw(P.subarray(6*e,6*e+3)),D=P[6*e+3]/255,k=P[6*e+4]/255,O=P[6*e+5]/255,L=n.getNextId();if(o){const n=I[e],o=B.slice(n,n+16),l=`${A}-geometry.${s}.${r}`;let U=z[l];if(!U){U={batchThisMesh:!t.reuseGeometries};let e=!1;switch(w[r]){case 0:U.primitiveName="solid",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryNormals=d.subarray(C[r],a?d.length:C[r+1]),U.geometryUVs=f.subarray(E[r],a?f.length:E[r+1]),U.geometryIndices=g.subarray(F[r],a?g.length:F[r+1]),U.geometryEdgeIndices=m.subarray(x[r],a?m.length:x[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 1:U.primitiveName="surface",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryNormals=d.subarray(C[r],a?d.length:C[r+1]),U.geometryUVs=f.subarray(E[r],a?f.length:E[r+1]),U.geometryIndices=g.subarray(F[r],a?g.length:F[r+1]),U.geometryEdgeIndices=m.subarray(x[r],a?m.length:x[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 2:U.primitiveName="points",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryColors=p.subarray(M[r],a?p.length:M[r+1]),e=U.geometryPositions.length>0;break;case 3:U.primitiveName="lines",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryIndices=g.subarray(F[r],a?g.length:F[r+1]),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;case 4:U.primitiveName="lines",U.geometryPositions=u.subarray(v[r],a?u.length:v[r+1]),U.geometryIndices=pw(U.geometryPositions,g.subarray(F[r],a?g.length:F[r+1])),e=U.geometryPositions.length>0&&U.geometryIndices.length>0;break;default:continue}if(e||(U=null),U&&(U.geometryPositions.length,U.batchThisMesh)){U.decompressedPositions=new Float32Array(U.geometryPositions.length),U.transformedAndRecompressedPositions=new Uint16Array(U.geometryPositions.length);const e=U.geometryPositions,t=U.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*y[0]+y[12],t[s+1]=e[s+1]*y[5]+y[13],t[s+2]=e[s+2]*y[10]+y[14];U.geometryPositions=null,z[l]=U}}if(U)if(U.batchThisMesh){const e=U.decompressedPositions,t=U.transformedAndRecompressedPositions;for(let s=0,i=e.length;s<i;s+=3)hw[0]=e[s+0],hw[1]=e[s+1],hw[2]=e[s+2],hw[3]=1,h.transformVec4(o,hw,uw),he.compressPosition(uw,W,hw),t[s+0]=hw[0],t[s+1]=hw[1],t[s+2]=hw[2];i.createMesh(_.apply(N,{id:L,textureSetId:c,origin:j,primitive:U.primitiveName,positionsCompressed:t,normalsCompressed:U.geometryNormals,uv:U.geometryUVs,colorsCompressed:U.geometryColors,indices:U.geometryIndices,edgeIndices:U.geometryEdgeIndices,positionsDecodeMatrix:b,color:S,metallic:k,roughness:O,opacity:D})),Q.push(L)}else R[l]||(i.createGeometry({id:l,primitive:U.primitiveName,positionsCompressed:U.geometryPositions,normalsCompressed:U.geometryNormals,uv:U.geometryUVs,colorsCompressed:U.geometryColors,indices:U.geometryIndices,edgeIndices:U.geometryEdgeIndices,positionsDecodeMatrix:y}),R[l]=!0),i.createMesh(_.apply(N,{id:L,geometryId:l,textureSetId:c,matrix:o,color:S,metallic:k,roughness:O,opacity:D,origin:j})),Q.push(L)}else{let e,t,s,n,A,o,l,h=!1;switch(w[r]){case 0:e="solid",t=u.subarray(v[r],a?u.length:v[r+1]),s=d.subarray(C[r],a?d.length:C[r+1]),n=f.subarray(E[r],a?f.length:E[r+1]),o=g.subarray(F[r],a?g.length:F[r+1]),l=m.subarray(x[r],a?m.length:x[r+1]),h=t.length>0&&o.length>0;break;case 1:e="surface",t=u.subarray(v[r],a?u.length:v[r+1]),s=d.subarray(C[r],a?d.length:C[r+1]),n=f.subarray(E[r],a?f.length:E[r+1]),o=g.subarray(F[r],a?g.length:F[r+1]),l=m.subarray(x[r],a?m.length:x[r+1]),h=t.length>0&&o.length>0;break;case 2:e="points",t=u.subarray(v[r],a?u.length:v[r+1]),A=p.subarray(M[r],a?p.length:M[r+1]),h=t.length>0;break;case 3:e="lines",t=u.subarray(v[r],a?u.length:v[r+1]),o=g.subarray(F[r],a?g.length:F[r+1]),h=t.length>0&&o.length>0;break;case 4:e="lines",t=u.subarray(v[r],a?u.length:v[r+1]),o=pw(t,g.subarray(F[r],a?g.length:F[r+1])),h=t.length>0&&o.length>0;break;default:continue}h&&(i.createMesh(_.apply(N,{id:L,textureSetId:c,origin:j,primitive:e,positionsCompressed:t,normalsCompressed:s,uv:n&&n.length>0?n:null,colorsCompressed:A,indices:o,edgeIndices:l,positionsDecodeMatrix:b,color:S,metallic:k,roughness:O,opacity:D})),Q.push(L))}}Q.length>0&&i.createEntity(_.apply(L,{id:a,isObject:!0,meshIds:Q}))}}}(e,t,A,i,r,n)}};let gw=window.pako||My;gw.inflate||(gw=gw.default);const mw=h.vec4(),_w=h.vec4();const bw=function(){const e=new Float32Array(3);return function(t){return e[0]=t[0]/255,e[1]=t[1]/255,e[2]=t[2]/255,e}}();function Bw(e,t,s,i,r,n){const A=n.getNextId(),o=s.metadata,a=s.textureData,l=s.eachTextureDataPortion,c=s.eachTextureAttributes,u=s.positions,d=s.normals,p=s.colors,f=s.uvs,g=s.indices,m=s.edgeIndices,b=s.eachTextureSetTextures,B=s.matrices,y=s.reusedGeometriesDecodeMatrix,w=s.eachGeometryPrimitiveType,v=s.eachGeometryAxisLabel,C=s.eachGeometryPositionsPortion,M=s.eachGeometryNormalsPortion,E=s.eachGeometryColorsPortion,F=s.eachGeometryUVsPortion,x=s.eachGeometryIndicesPortion,U=s.eachGeometryEdgeIndicesPortion,I=s.eachMeshGeometriesPortion,T=s.eachMeshMatricesPortion,P=s.eachMeshTextureSet,S=s.eachMeshMaterialAttributes,D=s.eachEntityId,k=s.eachEntityMeshesPortion,Q=s.eachTileAABB,R=s.eachTileEntitiesPortion,O=l.length,V=b.length/5,L=C.length,H=I.length,N=k.length,G=R.length;r&&r.loadData(o,{includeTypes:t.includeTypes,excludeTypes:t.excludeTypes,globalizeObjectIds:t.globalizeObjectIds});for(let e=0;e<O;e++){const t=e===O-1,s=l[e],r=t?a.length:l[e+1],n=r-s>0,o=9*e,h=1===c[o+0],u=c[o+1];c[o+2],c[o+3];const d=c[o+4],p=c[o+5],f=c[o+6],g=c[o+7],m=c[o+8];if(n){const t=new Uint8Array(a.subarray(s,r)).buffer,n=`${A}-texture-${e}`;if(h)i.createTexture({id:n,buffers:[t],minFilter:d,magFilter:p,wrapS:f,wrapT:g,wrapR:m});else{const e=new Blob([t],{type:10001===u?"image/jpeg":10002===u?"image/png":"image/gif"}),s=(window.URL||window.webkitURL).createObjectURL(e),r=document.createElement("img");r.src=s,i.createTexture({id:n,image:r,minFilter:d,magFilter:p,wrapS:f,wrapT:g,wrapR:m})}}}for(let e=0;e<V;e++){const t=5*e,s=`${A}-textureSet-${e}`,r=b[t+0],n=b[t+1],o=b[t+2],a=b[t+3],l=b[t+4];i.createTextureSet({id:s,colorTextureId:r>=0?`${A}-texture-${r}`:null,normalsTextureId:o>=0?`${A}-texture-${o}`:null,metallicRoughnessTextureId:n>=0?`${A}-texture-${n}`:null,emissiveTextureId:a>=0?`${A}-texture-${a}`:null,occlusionTextureId:l>=0?`${A}-texture-${l}`:null})}const j=new Uint32Array(L);for(let e=0;e<H;e++){const t=I[e];void 0!==j[t]?j[t]++:j[t]=1}const W=h.vec3(),z=h.AABB3(),X={};for(let s=0;s<G;s++){const r=s===G-1,o=R[s],a=r?N-1:R[s+1]-1,l=6*s,c=Q.subarray(l,l+6);h.getAABB3Center(c,W),z[0]=c[0]-W[0],z[1]=c[1]-W[1],z[2]=c[2]-W[2],z[3]=c[3]-W[0],z[4]=c[4]-W[1],z[5]=c[5]-W[2];const b=he.createPositionsDecodeMatrix(z),O={};for(let r=o;r<=a;r++){const o=D[r],a=t.globalizeObjectIds?h.globalizeObjectId(i.id,o):o,l=r===N-1,c=k[r],Q=l?I.length-1:k[r+1]-1,R=[],V=e.metaScene.metaObjects[a],H={},G={};if(V){if(t.excludeTypesMap&&V.type&&t.excludeTypesMap[V.type])continue;if(t.includeTypesMap&&V.type&&!t.includeTypesMap[V.type])continue;if(t.includeIdsMap&&V.id&&!t.includeIdsMap[V.id])continue;const e=t.objectDefaults?t.objectDefaults[V.type]||t.objectDefaults.DEFAULT:null;e&&(!1===e.visible&&(H.visible=!1),!1===e.pickable&&(H.pickable=!1),e.colorize&&(G.color=e.colorize),void 0!==e.opacity&&null!==e.opacity&&(G.opacity=e.opacity),void 0!==e.metallic&&null!==e.metallic&&(G.metallic=e.metallic),void 0!==e.roughness&&null!==e.roughness&&(G.roughness=e.roughness))}else if(t.excludeUnclassifiedObjects)continue;for(let e=c;e<=Q;e++){const r=I[e],o=j[r]>1,a=r===L-1,l=P[e],c=l>=0?`${A}-textureSet-${l}`:null,D=bw(S.subarray(6*e,6*e+3)),k=S[6*e+3]/255,Q=S[6*e+4]/255,V=S[6*e+5]/255,H=n.getNextId();if(o){const n=T[e],o=B.slice(n,n+16),l=`${A}-geometry.${s}.${r}`;let I=X[l];if(!I){I={batchThisMesh:!t.reuseGeometries};const e=w[r],s=v[r];let i,n=!1;switch(e){case 0:I.primitiveName="solid",I.geometryPositions=u.subarray(C[r],a?u.length:C[r+1]),I.geometryNormals=d.subarray(M[r],a?d.length:M[r+1]),I.geometryUVs=f.subarray(F[r],a?f.length:F[r+1]),I.geometryIndices=g.subarray(x[r],a?g.length:x[r+1]),I.geometryEdgeIndices=m.subarray(U[r],a?m.length:U[r+1]),n=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;case 1:I.primitiveName="surface",I.geometryPositions=u.subarray(C[r],a?u.length:C[r+1]),I.geometryNormals=d.subarray(M[r],a?d.length:M[r+1]),I.geometryUVs=f.subarray(F[r],a?f.length:F[r+1]),I.geometryIndices=g.subarray(x[r],a?g.length:x[r+1]),I.geometryEdgeIndices=m.subarray(U[r],a?m.length:U[r+1]),n=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;case 2:I.primitiveName="points",I.geometryPositions=u.subarray(C[r],a?u.length:C[r+1]),I.geometryColors=p.subarray(E[r],a?p.length:E[r+1]),n=I.geometryPositions.length>0;break;case 3:I.primitiveName="lines",I.geometryPositions=u.subarray(C[r],a?u.length:C[r+1]),I.geometryIndices=g.subarray(x[r],a?g.length:x[r+1]),n=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;case 4:I.primitiveName="lines",I.geometryPositions=u.subarray(C[r],a?u.length:C[r+1]),I.geometryIndices=yw(I.geometryPositions,g.subarray(x[r],a?g.length:x[r+1])),n=I.geometryPositions.length>0&&I.geometryIndices.length>0;break;case 7:I.primitiveName="lines",I.geometryPositions=u.subarray(C[r],a?u.length:C[r+1]),I.decompressedPositions=he.decompressPositions(I.geometryPositions,y),i=Fe({origin:I.decompressedPositions,text:s,size:2}),I.decompressedPositions=i.positions,I.geometryIndices=i.indices,I.geometryPositions=null,n=I.decompressedPositions.length>0&&I.geometryIndices.length>0;break;default:continue}if(n||(I=null),I&&(I.geometryPositions&&I.geometryPositions.length,I.batchThisMesh)){if(7===e)I.transformedAndRecompressedPositions=new Uint16Array(I.decompressedPositions.length);else{I.decompressedPositions=new Float32Array(I.geometryPositions.length),I.transformedAndRecompressedPositions=new Uint16Array(I.geometryPositions.length);const e=I.geometryPositions,t=I.decompressedPositions;for(let s=0,i=e.length;s<i;s+=3)t[s+0]=e[s+0]*y[0]+y[12],t[s+1]=e[s+1]*y[5]+y[13],t[s+2]=e[s+2]*y[10]+y[14];I.geometryPositions=null}X[l]=I}}if(I)if(I.batchThisMesh){const e=I.decompressedPositions,t=I.transformedAndRecompressedPositions;for(let s=0,i=e.length;s<i;s+=3)mw[0]=e[s+0],mw[1]=e[s+1],mw[2]=e[s+2],mw[3]=1,h.transformVec4(o,mw,_w),he.compressPosition(_w,z,mw),t[s+0]=mw[0],t[s+1]=mw[1],t[s+2]=mw[2];i.createMesh(_.apply(G,{id:H,textureSetId:c,origin:W,primitive:I.primitiveName,positionsCompressed:t,normalsCompressed:I.geometryNormals,uv:I.geometryUVs,colorsCompressed:I.geometryColors,indices:I.geometryIndices,edgeIndices:I.geometryEdgeIndices,positionsDecodeMatrix:b,color:D,metallic:Q,roughness:V,opacity:k})),R.push(H)}else{if(!O[l]){let e={id:l,primitive:I.primitiveName,normalsCompressed:I.geometryNormals,uv:I.geometryUVs,colorsCompressed:I.geometryColors,indices:I.geometryIndices,edgeIndices:I.geometryEdgeIndices};e=I.geometryPositions?{...e,positionsCompressed:I.geometryPositions,positionsDecodeMatrix:y}:{...e,positions:I.decompressedPositions},i.createGeometry(e),O[l]=!0}i.createMesh(_.apply(G,{id:H,geometryId:l,textureSetId:c,matrix:o,color:D,metallic:Q,roughness:V,opacity:k,origin:W})),R.push(H)}}else{const e=w[r],t=v[r];let s,n,A,o,l,h,B,y,I=!1;switch(e){case 0:s="solid",n=u.subarray(C[r],a?u.length:C[r+1]),A=d.subarray(M[r],a?d.length:M[r+1]),o=f.subarray(F[r],a?f.length:F[r+1]),h=g.subarray(x[r],a?g.length:x[r+1]),B=m.subarray(U[r],a?m.length:U[r+1]),I=n.length>0&&h.length>0;break;case 1:s="surface",n=u.subarray(C[r],a?u.length:C[r+1]),A=d.subarray(M[r],a?d.length:M[r+1]),o=f.subarray(F[r],a?f.length:F[r+1]),h=g.subarray(x[r],a?g.length:x[r+1]),B=m.subarray(U[r],a?m.length:U[r+1]),I=n.length>0&&h.length>0;break;case 2:s="points",n=u.subarray(C[r],a?u.length:C[r+1]),l=p.subarray(E[r],a?p.length:E[r+1]),I=n.length>0;break;case 3:s="lines",n=u.subarray(C[r],a?u.length:C[r+1]),h=g.subarray(x[r],a?g.length:x[r+1]),I=n.length>0&&h.length>0;break;case 4:s="lines",n=u.subarray(C[r],a?u.length:C[r+1]),h=yw(n,g.subarray(x[r],a?g.length:x[r+1])),I=n.length>0&&h.length>0;break;case 7:s="lines",n=u.subarray(C[r],a?u.length:C[r+1]),n=he.decompressPositions(n,b),y=Fe({origin:n,text:t,size:2}),n=y.positions,h=y.indices,I=n.length>0&&h.length>0;break;default:continue}if(I){let t=_.apply(G,{id:H,textureSetId:c,origin:W,primitive:s,normalsCompressed:A,uv:o&&o.length>0?o:null,colorsCompressed:l,indices:h,edgeIndices:B,color:D,metallic:Q,roughness:V,opacity:k});t=7!==e?{...t,positionsCompressed:n,positionsDecodeMatrix:b}:{...t,positions:n},i.createMesh(t),R.push(H)}}}R.length>0&&i.createEntity(_.apply(H,{id:a,isObject:!0,meshIds:R}))}}}function yw(e,t){const s=[];if(t.length>1)for(let e=0,i=t.length-1;e<i;e++)s.push(t[e]),s.push(t[e+1]);else if(e.length>1)for(let t=0,i=e.length/3-1;t<i;t++)s.push(t),s.push(t+1);return s}!function(){const e=document.createElement("canvas"),t=e.getContext("2d")}();const ww={version:12,parseArrayBuffer:function(e,t,s,i,r,n){const A=function(e){const t=function(){const e=new ArrayBuffer(2);return new Uint16Array(e)[0]=1,1!==new Uint8Array(e)[0]}(),s=function(){let s=0;const i=new DataView(e);return function(r){const n=1+2*s++,A=i.getUint32(4*n,!0),o=i.getUint32(4*(n+1),!0),a=r.BYTES_PER_ELEMENT;if(t&&a>1){const t=new Uint8Array(e,A,o),s=a/2,i=t.length/a;for(let e=0;e<i;e++){const i=e*a;for(let e=0;e<s;e++){const s=i+e,r=i-e+a-1,n=t[s];t[s]=t[r],t[r]=n}}}return new r(e,A,o/a)}}(),i=function(){const e=new TextDecoder;return()=>JSON.parse(e.decode(s(Uint8Array)))}();return{metadata:i(),textureData:s(Uint8Array),eachTextureDataPortion:s(Uint32Array),eachTextureAttributes:s(Uint16Array),positions:s(Uint16Array),normals:s(Int8Array),colors:s(Uint8Array),uvs:s(Float32Array),indices:s(Uint32Array),edgeIndices:s(Uint32Array),eachTextureSetTextures:s(Int32Array),matrices:s(Float32Array),reusedGeometriesDecodeMatrix:s(Float32Array),eachGeometryPrimitiveType:s(Uint8Array),eachGeometryAxisLabel:i(),eachGeometryPositionsPortion:s(Uint32Array),eachGeometryNormalsPortion:s(Uint32Array),eachGeometryColorsPortion:s(Uint32Array),eachGeometryUVsPortion:s(Uint32Array),eachGeometryIndicesPortion:s(Uint32Array),eachGeometryEdgeIndicesPortion:s(Uint32Array),eachMeshGeometriesPortion:s(Uint32Array),eachMeshMatricesPortion:s(Uint32Array),eachMeshTextureSet:s(Int32Array),eachMeshMaterialAttributes:s(Uint8Array),eachEntityId:i(),eachEntityMeshesPortion:s(Uint32Array),eachTileAABB:s(Float64Array),eachTileEntitiesPortion:s(Uint32Array)}}(s);Bw(e,t,A,i,r,n)},parse:function(e,t,s,i,r,n){const A=function(e){let t=0;return{metadata:e[t++],textureData:e[t++],eachTextureDataPortion:e[t++],eachTextureAttributes:e[t++],positions:e[t++],normals:e[t++],colors:e[t++],uvs:e[t++],indices:e[t++],edgeIndices:e[t++],eachTextureSetTextures:e[t++],matrices:e[t++],reusedGeometriesDecodeMatrix:e[t++],eachGeometryPrimitiveType:e[t++],eachGeometryAxisLabel:e[t++],eachGeometryPositionsPortion:e[t++],eachGeometryNormalsPortion:e[t++],eachGeometryColorsPortion:e[t++],eachGeometryUVsPortion:e[t++],eachGeometryIndicesPortion:e[t++],eachGeometryEdgeIndicesPortion:e[t++],eachMeshGeometriesPortion:e[t++],eachMeshMatricesPortion:e[t++],eachMeshTextureSet:e[t++],eachMeshMaterialAttributes:e[t++],eachEntityId:e[t++],eachEntityMeshesPortion:e[t++],eachTileAABB:e[t++],eachTileEntitiesPortion:e[t++]}}(s),o=function(e){function t(e,t){return 0===e.length?[]:gw.inflate(e,t).buffer}return{metadata:JSON.parse(gw.inflate(e.metadata,{to:"string"})),textureData:new Uint8Array(t(e.textureData)),eachTextureDataPortion:new Uint32Array(t(e.eachTextureDataPortion)),eachTextureAttributes:new Uint16Array(t(e.eachTextureAttributes)),positions:new Uint16Array(t(e.positions)),normals:new Int8Array(t(e.normals)),colors:new Uint8Array(t(e.colors)),uvs:new Float32Array(t(e.uvs)),indices:new Uint32Array(t(e.indices)),edgeIndices:new Uint32Array(t(e.edgeIndices)),eachTextureSetTextures:new Int32Array(t(e.eachTextureSetTextures)),matrices:new Float32Array(t(e.matrices)),reusedGeometriesDecodeMatrix:new Float32Array(t(e.reusedGeometriesDecodeMatrix)),eachGeometryPrimitiveType:new Uint8Array(t(e.eachGeometryPrimitiveType)),eachGeometryAxisLabel:JSON.parse(gw.inflate(e.eachGeometryAxisLabel,{to:"string"})),eachGeometryPositionsPortion:new Uint32Array(t(e.eachGeometryPositionsPortion)),eachGeometryNormalsPortion:new Uint32Array(t(e.eachGeometryNormalsPortion)),eachGeometryColorsPortion:new Uint32Array(t(e.eachGeometryColorsPortion)),eachGeometryUVsPortion:new Uint32Array(t(e.eachGeometryUVsPortion)),eachGeometryIndicesPortion:new Uint32Array(t(e.eachGeometryIndicesPortion)),eachGeometryEdgeIndicesPortion:new Uint32Array(t(e.eachGeometryEdgeIndicesPortion)),eachMeshGeometriesPortion:new Uint32Array(t(e.eachMeshGeometriesPortion)),eachMeshMatricesPortion:new Uint32Array(t(e.eachMeshMatricesPortion)),eachMeshTextureSet:new Int32Array(t(e.eachMeshTextureSet)),eachMeshMaterialAttributes:new Uint8Array(t(e.eachMeshMaterialAttributes)),eachEntityId:JSON.parse(gw.inflate(e.eachEntityId,{to:"string"})),eachEntityMeshesPortion:new Uint32Array(t(e.eachEntityMeshesPortion)),eachTileAABB:new Float64Array(t(e.eachTileAABB)),eachTileEntitiesPortion:new Uint32Array(t(e.eachTileEntitiesPortion))}}(A);Bw(e,t,o,i,r,n)}},vw={};vw[xy.version]=xy,vw[Ty.version]=Ty,vw[Dy.version]=Dy,vw[Ry.version]=Ry,vw[Ly.version]=Ly,vw[Gy.version]=Gy,vw[Xy.version]=Xy,vw[qy.version]=qy,vw[rw.version]=rw,vw[cw.version]=cw,vw[fw.version]=fw,vw[ww.version]=ww;var Cw={};!function(e){var t,s="File format is not recognized.",i="Error while reading zip file.",r="Error while reading file data.",n=524288,A="text/plain";try{t=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function o(){this.crc=-1}function a(){}function l(e,t){var s,i;return s=new ArrayBuffer(e),i=new Uint8Array(s),t&&i.set(t,0),{buffer:s,array:i,view:new DataView(s)}}function c(){}function h(e){var t,s=this;s.size=0,s.init=function(i,r){var n=new Blob([e],{type:A});(t=new d(n)).init((function(){s.size=t.size,i()}),r)},s.readUint8Array=function(e,s,i,r){t.readUint8Array(e,s,i,r)}}function u(t){var s,i=this;i.size=0,i.init=function(e){for(var r=t.length;"="==t.charAt(r-1);)r--;s=t.indexOf(",")+1,i.size=Math.floor(.75*(r-s)),e()},i.readUint8Array=function(i,r,n){var A,o=l(r),a=4*Math.floor(i/3),c=4*Math.ceil((i+r)/3),h=e.atob(t.substring(a+s,c+s)),u=i-3*Math.floor(a/4);for(A=u;A<u+r;A++)o.array[A-u]=h.charCodeAt(A);n(o.array)}}function d(e){var t=this;t.size=0,t.init=function(s){t.size=e.size,s()},t.readUint8Array=function(t,s,i,r){var n=new FileReader;n.onload=function(e){i(new Uint8Array(e.target.result))},n.onerror=r;try{n.readAsArrayBuffer(function(e,t,s){if(t<0||s<0||t+s>e.size)throw new RangeError("offset:"+t+", length:"+s+", size:"+e.size);return e.slice?e.slice(t,t+s):e.webkitSlice?e.webkitSlice(t,t+s):e.mozSlice?e.mozSlice(t,t+s):e.msSlice?e.msSlice(t,t+s):void 0}(e,t,s))}catch(e){r(e)}}}function p(){}function f(e){var s,i=this;i.init=function(e){s=new Blob([],{type:A}),e()},i.writeUint8Array=function(e,i){s=new Blob([s,t?e:e.buffer],{type:A}),i()},i.getData=function(t,i){var r=new FileReader;r.onload=function(e){t(e.target.result)},r.onerror=i,r.readAsText(s,e)}}function g(t){var s=this,i="",r="";s.init=function(e){i+="data:"+(t||"")+";base64,",e()},s.writeUint8Array=function(t,s){var n,A=r.length,o=r;for(r="",n=0;n<3*Math.floor((A+t.length)/3)-A;n++)o+=String.fromCharCode(t[n]);for(;n<t.length;n++)r+=String.fromCharCode(t[n]);o.length>2?i+=e.btoa(o):r=o,s()},s.getData=function(t){t(i+e.btoa(r))}}function m(e){var s,i=this;i.init=function(t){s=new Blob([],{type:e}),t()},i.writeUint8Array=function(i,r){s=new Blob([s,t?i:i.buffer],{type:e}),r()},i.getData=function(e){e(s)}}function _(e,t,s,i,r,A,o,a,l,c){var h,u,d,p=0,f=t.sn;function g(){e.removeEventListener("message",m,!1),a(u,d)}function m(t){var s=t.data,r=s.data,n=s.error;if(n)return n.toString=function(){return"Error: "+this.message},void l(n);if(s.sn===f)switch("number"==typeof s.codecTime&&(e.codecTime+=s.codecTime),"number"==typeof s.crcTime&&(e.crcTime+=s.crcTime),s.type){case"append":r?(u+=r.length,i.writeUint8Array(r,(function(){_()}),c)):_();break;case"flush":d=s.crc,r?(u+=r.length,i.writeUint8Array(r,(function(){g()}),c)):g();break;case"progress":o&&o(h+s.loaded,A);break;case"importScripts":case"newTask":case"echo":break;default:console.warn("zip.js:launchWorkerProcess: unknown message: ",s)}}function _(){(h=p*n)<=A?s.readUint8Array(r+h,Math.min(n,A-h),(function(s){o&&o(h,A);var i=0===h?t:{sn:f};i.type="append",i.data=s;try{e.postMessage(i,[s.buffer])}catch(t){e.postMessage(i)}p++}),l):e.postMessage({sn:f,type:"flush"})}u=0,e.addEventListener("message",m,!1),_()}function b(e,t,s,i,r,A,a,l,c,h){var u,d=0,p=0,f="input"===A,g="output"===A,m=new o;!function A(){var o;if((u=d*n)<r)t.readUint8Array(i+u,Math.min(n,r-u),(function(t){var i;try{i=e.append(t,(function(e){a&&a(u+e,r)}))}catch(e){return void c(e)}i?(p+=i.length,s.writeUint8Array(i,(function(){d++,setTimeout(A,1)}),h),g&&m.append(i)):(d++,setTimeout(A,1)),f&&m.append(t),a&&a(u,r)}),c);else{try{o=e.flush()}catch(e){return void c(e)}o?(g&&m.append(o),p+=o.length,s.writeUint8Array(o,(function(){l(p,m.get())}),h)):l(p,m.get())}}()}function B(t,s,i,r,n,A,o,l,c,h,u){var d="input";e.zip.useWebWorkers&&o?_(t,{sn:s,codecClass:"NOOP",crcType:d},i,r,n,A,c,l,h,u):b(new a,i,r,n,A,d,c,l,h,u)}function y(e){var t,s,i="",r=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","_","_","_","","","","","","","","","+","+","","","+","+","-","-","+","-","+","","","+","+","-","-","","-","+","","","","","","","i","","","","+","+","_","_","","","_","","","","","","","","","","","","","","","","","","","_","","","","","","","","","","","","_"," "];for(t=0;t<e.length;t++)i+=(s=255&e.charCodeAt(t))>127?r[s-128]:String.fromCharCode(s);return i}function w(e){return decodeURIComponent(escape(e))}function v(e){var t,s="";for(t=0;t<e.length;t++)s+=String.fromCharCode(e[t]);return s}function C(e,t,s,i,r){e.version=t.view.getUint16(s,!0),e.bitFlag=t.view.getUint16(s+2,!0),e.compressionMethod=t.view.getUint16(s+4,!0),e.lastModDateRaw=t.view.getUint32(s+6,!0),e.lastModDate=function(e){var t=(4294901760&e)>>16,s=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&s)>>11,(2016&s)>>5,2*(31&s),0)}catch(e){}}(e.lastModDateRaw),1!=(1&e.bitFlag)?((i||8!=(8&e.bitFlag))&&(e.crc32=t.view.getUint32(s+10,!0),e.compressedSize=t.view.getUint32(s+14,!0),e.uncompressedSize=t.view.getUint32(s+18,!0)),4294967295!==e.compressedSize&&4294967295!==e.uncompressedSize?(e.filenameLength=t.view.getUint16(s+22,!0),e.extraFieldLength=t.view.getUint16(s+24,!0)):r("File is using Zip64 (4gb+ file size).")):r("File contains encrypted entry.")}function M(t,n,A){var o=0;function a(){}a.prototype.getData=function(i,n,a,c){var h=this;function u(e,t){c&&!function(e){var t=l(4);return t.view.setUint32(0,e),h.crc32==t.view.getUint32(0)}(t)?A("CRC failed."):i.getData((function(e){n(e)}))}function d(e){A(e||r)}function p(e){A(e||"Error while writing file data.")}t.readUint8Array(h.offset,30,(function(r){var n,f=l(r.length,r);1347093252==f.view.getUint32(0)?(C(h,f,4,!1,A),n=h.offset+30+h.filenameLength+h.extraFieldLength,i.init((function(){0===h.compressionMethod?B(h._worker,o++,t,i,n,h.compressedSize,c,u,a,d,p):function(t,s,i,r,n,A,o,a,l,c,h){var u=o?"output":"none";e.zip.useWebWorkers?_(t,{sn:s,codecClass:"Inflater",crcType:u},i,r,n,A,l,a,c,h):b(new e.zip.Inflater,i,r,n,A,u,l,a,c,h)}(h._worker,o++,t,i,n,h.compressedSize,c,u,a,d,p)}),p)):A(s)}),d)};var c={getEntries:function(e){var r=this._worker;!function(e){t.size<22?A(s):r(22,(function(){r(Math.min(65558,t.size),(function(){A(s)}))}));function r(s,r){t.readUint8Array(t.size-s,s,(function(t){for(var s=t.length-22;s>=0;s--)if(80===t[s]&&75===t[s+1]&&5===t[s+2]&&6===t[s+3])return void e(new DataView(t.buffer,s,22));r()}),(function(){A(i)}))}}((function(n){var o,c;o=n.getUint32(16,!0),c=n.getUint16(8,!0),o<0||o>=t.size?A(s):t.readUint8Array(o,t.size-o,(function(t){var i,n,o,h,u=0,d=[],p=l(t.length,t);for(i=0;i<c;i++){if((n=new a)._worker=r,1347092738!=p.view.getUint32(u))return void A(s);C(n,p,u+6,!0,A),n.commentLength=p.view.getUint16(u+32,!0),n.directory=16==(16&p.view.getUint8(u+38)),n.offset=p.view.getUint32(u+42,!0),o=v(p.array.subarray(u+46,u+46+n.filenameLength)),n.filename=2048==(2048&n.bitFlag)?w(o):y(o),n.directory||"/"!=n.filename.charAt(n.filename.length-1)||(n.directory=!0),h=v(p.array.subarray(u+46+n.filenameLength+n.extraFieldLength,u+46+n.filenameLength+n.extraFieldLength+n.commentLength)),n.comment=2048==(2048&n.bitFlag)?w(h):y(h),d.push(n),u+=46+n.filenameLength+n.extraFieldLength+n.commentLength}e(d)}),(function(){A(i)}))}))},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null),e&&e()},_worker:null};e.zip.useWebWorkers?I("inflater",(function(e){c._worker=e,n(c)}),(function(e){A(e)})):n(c)}function E(e){return unescape(encodeURIComponent(e))}function F(e){var t,s=[];for(t=0;t<e.length;t++)s.push(e.charCodeAt(t));return s}function x(t,s,i,n){var A={},o=[],a=0,c=0;function h(e){i(e||"Error while writing zip file.")}function u(e){i(e||r)}var d={add:function(s,r,d,p,f){var g,m,y,w=this._worker;function v(e,s){var i=l(16);a+=e||0,i.view.setUint32(0,1347094280),void 0!==s&&(g.view.setUint32(10,s,!0),i.view.setUint32(4,s,!0)),r&&(i.view.setUint32(8,e,!0),g.view.setUint32(14,e,!0),i.view.setUint32(12,r.size,!0),g.view.setUint32(18,r.size,!0)),t.writeUint8Array(i.array,(function(){a+=16,d()}),h)}function C(){f=f||{},s=s.trim(),f.directory&&"/"!=s.charAt(s.length-1)&&(s+="/"),A.hasOwnProperty(s)?i("File already exists."):(m=F(E(s)),o.push(s),function(e){var i;y=f.lastModDate||new Date,g=l(26),A[s]={headerArray:g.array,directory:f.directory,filename:m,offset:a,comment:F(E(f.comment||""))},g.view.setUint32(0,335546376),f.version&&g.view.setUint8(0,f.version),n||0===f.level||f.directory||g.view.setUint16(4,2048),g.view.setUint16(6,(y.getHours()<<6|y.getMinutes())<<5|y.getSeconds()/2,!0),g.view.setUint16(8,(y.getFullYear()-1980<<4|y.getMonth()+1)<<5|y.getDate(),!0),g.view.setUint16(22,m.length,!0),(i=l(30+m.length)).view.setUint32(0,1347093252),i.array.set(g.array,4),i.array.set(m,30),a+=i.array.length,t.writeUint8Array(i.array,e,h)}((function(){r?n||0===f.level?B(w,c++,r,t,0,r.size,!0,v,p,u,h):function(t,s,i,r,n,A,o,a,l){var c="input";e.zip.useWebWorkers?_(t,{sn:s,options:{level:n},codecClass:"Deflater",crcType:c},i,r,0,i.size,o,A,a,l):b(new e.zip.Deflater,i,r,0,i.size,c,o,A,a,l)}(w,c++,r,t,f.level,v,p,u,h):v()})))}r?r.init(C,u):C()},close:function(e){this._worker&&(this._worker.terminate(),this._worker=null);var s,i,r,n=0,c=0;for(i=0;i<o.length;i++)n+=46+(r=A[o[i]]).filename.length+r.comment.length;for(s=l(n+22),i=0;i<o.length;i++)r=A[o[i]],s.view.setUint32(c,1347092738),s.view.setUint16(c+4,5120),s.array.set(r.headerArray,c+6),s.view.setUint16(c+32,r.comment.length,!0),r.directory&&s.view.setUint8(c+38,16),s.view.setUint32(c+42,r.offset,!0),s.array.set(r.filename,c+46),s.array.set(r.comment,c+46+r.filename.length),c+=46+r.filename.length+r.comment.length;s.view.setUint32(c,1347093766),s.view.setUint16(c+8,o.length,!0),s.view.setUint16(c+10,o.length,!0),s.view.setUint32(c+12,n,!0),s.view.setUint32(c+16,a,!0),t.writeUint8Array(s.array,(function(){t.getData(e)}),h)},_worker:null};e.zip.useWebWorkers?I("deflater",(function(e){d._worker=e,s(d)}),(function(e){i(e)})):s(d)}o.prototype.append=function(e){for(var t=0|this.crc,s=this.table,i=0,r=0|e.length;i<r;i++)t=t>>>8^s[255&(t^e[i])];this.crc=t},o.prototype.get=function(){return~this.crc},o.prototype.table=function(){var e,t,s,i=[];for(e=0;e<256;e++){for(s=e,t=0;t<8;t++)1&s?s=s>>>1^3988292384:s>>>=1;i[e]=s}return i}(),a.prototype.append=function(e,t){return e},a.prototype.flush=function(){},h.prototype=new c,h.prototype.constructor=h,u.prototype=new c,u.prototype.constructor=u,d.prototype=new c,d.prototype.constructor=d,p.prototype.getData=function(e){e(this.data)},f.prototype=new p,f.prototype.constructor=f,g.prototype=new p,g.prototype.constructor=g,m.prototype=new p,m.prototype.constructor=m;var U={deflater:["z-worker.js","deflate.js"],inflater:["z-worker.js","inflate.js"]};function I(t,s,i){if(null===e.zip.workerScripts||null===e.zip.workerScriptsPath){var r;if(e.zip.workerScripts){if(r=e.zip.workerScripts[t],!Array.isArray(r))return void i(new Error("zip.workerScripts."+t+" is not an array!"));r=function(e){var t=document.createElement("a");return e.map((function(e){return t.href=e,t.href}))}(r)}else(r=U[t].slice(0))[0]=(e.zip.workerScriptsPath||"")+r[0];var n=new Worker(r[0]);n.codecTime=n.crcTime=0,n.postMessage({type:"importScripts",scripts:r.slice(1)}),n.addEventListener("message",(function e(t){var r=t.data;if(r.error)return n.terminate(),void i(r.error);"importScripts"===r.type&&(n.removeEventListener("message",e),n.removeEventListener("error",A),s(n))})),n.addEventListener("error",A)}else i(new Error("Either zip.workerScripts or zip.workerScriptsPath may be set, not both."));function A(e){n.terminate(),i(e)}}function T(e){console.error(e)}e.zip={Reader:c,Writer:p,BlobReader:d,Data64URIReader:u,TextReader:h,BlobWriter:m,Data64URIWriter:g,TextWriter:f,createReader:function(e,t,s){s=s||T,e.init((function(){M(e,t,s)}),s)},createWriter:function(e,t,s,i){s=s||T,i=!!i,e.init((function(){x(e,t,s,i)}),s)},useWebWorkers:!0,workerScriptsPath:null,workerScripts:null}}(Cw);const Mw=Cw.zip;!function(e){var t,s,i=e.Reader,r=e.Writer;try{s=0===new Blob([new DataView(new ArrayBuffer(0))]).size}catch(e){}function n(e){var t=this;function s(s,i){var r;t.data?s():((r=new XMLHttpRequest).addEventListener("load",(function(){t.size||(t.size=Number(r.getResponseHeader("Content-Length"))||Number(r.response.byteLength)),t.data=new Uint8Array(r.response),s()}),!1),r.addEventListener("error",i,!1),r.open("GET",e),r.responseType="arraybuffer",r.send())}t.size=0,t.init=function(i,r){if(function(e){var t=document.createElement("a");return t.href=e,"http:"===t.protocol||"https:"===t.protocol}(e)){var n=new XMLHttpRequest;n.addEventListener("load",(function(){t.size=Number(n.getResponseHeader("Content-Length")),t.size?i():s(i,r)}),!1),n.addEventListener("error",r,!1),n.open("HEAD",e),n.send()}else s(i,r)},t.readUint8Array=function(e,i,r,n){s((function(){r(new Uint8Array(t.data.subarray(e,e+i)))}),n)}}function A(e){var t=this;t.size=0,t.init=function(s,i){var r=new XMLHttpRequest;r.addEventListener("load",(function(){t.size=Number(r.getResponseHeader("Content-Length")),"bytes"==r.getResponseHeader("Accept-Ranges")?s():i("HTTP Range not supported.")}),!1),r.addEventListener("error",i,!1),r.open("HEAD",e),r.send()},t.readUint8Array=function(t,s,i,r){!function(t,s,i,r){var n=new XMLHttpRequest;n.open("GET",e),n.responseType="arraybuffer",n.setRequestHeader("Range","bytes="+t+"-"+(t+s-1)),n.addEventListener("load",(function(){i(n.response)}),!1),n.addEventListener("error",r,!1),n.send()}(t,s,(function(e){i(new Uint8Array(e))}),r)}}function o(e){var t=this;t.size=0,t.init=function(s,i){t.size=e.byteLength,s()},t.readUint8Array=function(t,s,i,r){i(new Uint8Array(e.slice(t,t+s)))}}function a(){var e,t=this;t.init=function(t,s){e=new Uint8Array,t()},t.writeUint8Array=function(t,s,i){var r=new Uint8Array(e.length+t.length);r.set(e),r.set(t,e.length),e=r,s()},t.getData=function(t){t(e.buffer)}}function l(e,t){var i,r=this;r.init=function(t,s){e.createWriter((function(e){i=e,t()}),s)},r.writeUint8Array=function(e,r,n){var A=new Blob([s?e:e.buffer],{type:t});i.onwrite=function(){i.onwrite=null,r()},i.onerror=n,i.write(A)},r.getData=function(t){e.file(t)}}n.prototype=new i,n.prototype.constructor=n,A.prototype=new i,A.prototype.constructor=A,o.prototype=new i,o.prototype.constructor=o,a.prototype=new r,a.prototype.constructor=a,l.prototype=new r,l.prototype.constructor=l,e.FileWriter=l,e.HttpReader=n,e.HttpRangeReader=A,e.ArrayBufferReader=o,e.ArrayBufferWriter=a,e.fs&&((t=e.fs.ZipDirectoryEntry).prototype.addHttpContent=function(s,i,r){return function(s,i,r,n){if(s.directory)return n?new t(s.fs,i,r,s):new e.fs.ZipFileEntry(s.fs,i,r,s);throw"Parent entry is not a directory."}(this,s,{data:i,Reader:r?A:n})},t.prototype.importHttpContent=function(e,t,s,i){this.importZip(t?new A(e):new n(e),s,i)},e.fs.FS.prototype.importHttpContent=function(e,s,i,r){this.entries=[],this.root=new t(this),this.root.importHttpContent(e,s,i,r)})}(Mw);const Ew=["4.2"];class Fw{constructor(e,t={}){this.supportedSchemas=Ew,this._xrayOpacity=.7,this._src=null,this._options=t,this.viewpoint=null,t.workerScriptsPath?(Mw.workerScriptsPath=t.workerScriptsPath,this.src=t.src,this.xrayOpacity=.7,this.displayEffect=t.displayEffect,this.createMetaModel=t.createMetaModel):e.error("Config expected: workerScriptsPath")}load(e,t,s,i,r,n){switch(i.materialType){case"MetallicMaterial":t._defaultMaterial=new Rt(t,{baseColor:[1,1,1],metallic:.6,roughness:.6});break;case"SpecularMaterial":t._defaultMaterial=new Lt(t,{diffuse:[1,1,1],specular:h.vec3([1,1,1]),glossiness:.5});break;default:t._defaultMaterial=new bt(t,{reflectivity:.75,shiness:100,diffuse:[1,1,1]})}t._wireframeMaterial=new Dt(t,{color:[0,0,0],lineWidth:2});var A=t.scene.canvas.spinner;A.processes++,xw(e,t,s,i,(function(){A.processes--,r&&r(),t.fire("loaded",!0,!1)}),(function(e){A.processes--,t.error(e),n&&n(e),t.fire("error",e)}),(function(e){console.log("Error, Will Robinson: "+e)}))}}var xw=function(e,t,s,i,r,n){!function(e,t,s){var i=new Qw;i.load(e,(function(){t(i)}),(function(e){s("Error loading ZIP archive: "+e)}))}(s,(function(s){Uw(e,s,i,t,r,n)}),n)},Uw=function(){return function(t,s,i,r,n){var A={plugin:t,zip:s,edgeThreshold:30,materialType:i.materialType,scene:r.scene,modelNode:r,info:{references:{}},materials:{}};i.createMetaModel&&(A.metaModelData={modelId:r.id,metaObjects:[{name:r.id,type:"Default",id:r.id}]}),r.scene.loading++,function(t,s){t.zip.getFile("Manifest.xml",(function(i,r){for(var n=r.children,A=0,o=n.length;A<o;A++){var a=n[A];if("Manifest"===a.type)e(t,a,s)}}))}(A,(function(){A.metaModelData&&t.viewer.metaScene.createMetaModel(r.id,A.metaModelData),r.scene.loading--,n()}))};function e(e,s,i){for(var r=s.children,n=0,A=r.length;n<A;n++){var o=r[n];if("Root"===o.type){var a=o.children[0];e.zip.getFile(a,(function(s,r){t(e,r,i)}))}}}function t(e,t,i){for(var r=t.children,n=0,A=r.length;n<A;n++){var o=r[n];if("Model_3dxml"===o.type)s(e,o,i)}}function s(e,t,s){for(var r=t.children,o=0,a=r.length;o<a;o++){var l=r[o];switch(l.type){case"Header":i(e,l);break;case"ProductStructure":n(e,l,s);break;case"DefaultView":A(e,l)}}}function i(e,t){for(var s=t.children,i={},n=0,A=s.length;n<A;n++){var o=s[n];switch(o.type){case"SchemaVersion":i.schemaVersion=o.children[0],r(e,i.schemaVersion)||e.plugin.error("Schema version not supported: "+i.schemaVersion+" - supported versions are: "+Ew.join(","));break;case"Title":i.title=o.children[0];break;case"Author":i.author=o.children[0];break;case"Created":i.created=o.children[0]}}e.modelNode.meta=i}function r(e,t){for(var s=0,i=Ew.length;s<i;s++)if(t===Ew[s])return!0;return!1}function n(e,t,s){!function(e,t,s){for(var i={},r=t.children,n=0,A=0,a=r.length;A<a;A++){"ReferenceRep"===(l=r[A]).type&&n++}for(A=0,a=r.length;A<a;A++){var l;if("ReferenceRep"===(l=r[A]).type)if(l.associatedFile){var c=Rw(l.associatedFile);!function(){var t=l.id;e.zip.getFile(c,(function(r,A){var a=r.getElementsByTagName("MaterialId");Iw(e,a,(function(){var r={id:t};o(e,A,r),i[t]=r,0==--n&&s(i)}))}),(function(e){}))}()}}}(e,t,(function(i){for(var r=t.children,n={},A={},o={},a=0,l=r.length;a<l;a++){var c=r[a];switch(c.type){case"Reference3D":n[c.id]={type:"Reference3D",id:c.id,name:c.name,instance3Ds:{},instanceReps:{}};break;case"InstanceRep":for(var u=0,d=c.children.length;u<d;u++){switch((_=c.children[u]).type){case"IsAggregatedBy":p=_.children[0];break;case"IsInstanceOf":f=_.children[0]}}A[c.id]={type:"InstanceRep",id:c.id,name:c.name,isAggregatedBy:p,isInstanceOf:f,referenceReps:{}};break;case"Instance3D":var p,f,m;for(u=0,d=c.children.length;u<d;u++){var _;switch((_=c.children[u]).type){case"IsAggregatedBy":p=_.children[0];break;case"IsInstanceOf":f=_.children[0];break;case"RelativeMatrix":m=_.children[0]}}o[c.id]={type:"Instance3D",id:c.id,name:c.name,isAggregatedBy:p,isInstanceOf:f,relativeMatrix:m,reference3Ds:{}}}}for(var b in o){(y=n[(B=o[b]).isAggregatedBy])?y.instance3Ds[B.id]=B:alert("foo")}for(var b in o){var B,y=n[(B=o[b]).isInstanceOf];B.reference3Ds[y.id]=y,y.instance3D=B}for(var b in A){var w=i[(v=A[b]).isInstanceOf];w&&(v.referenceReps[w.id]=w)}for(var b in A){var v;(y=n[(v=A[b]).isAggregatedBy])&&(y.instanceReps[v.id]=v)}function C(e,t,s){for(var i in t.instance3Ds)M(e,t.instance3Ds[i],s);for(var i in t.instanceReps)E(e,t.instanceReps[i],s)}function M(e,t,s){if(t.relativeMatrix){var i=g(t.relativeMatrix,12),r=[i[9],i[10],i[11]],n=i.slice(0,9),A=h.mat3ToMat4(n,h.identityMat4()),o=new Ve(e.modelNode,{position:r});e.metaModelData&&e.metaModelData.metaObjects.push({id:o.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s?s.addChild(o,!0):e.modelNode.addChild(o,!0),s=o,o=new Ve(e.modelNode,{matrix:A}),e.metaModelData&&e.metaModelData.metaObjects.push({id:o.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s.addChild(o,!0),s=o}else{o=new Ve(e.modelNode,{});e.metaModelData&&e.metaModelData.metaObjects.push({id:o.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s?s.addChild(o,!0):e.modelNode.addChild(o,!0),s=o}for(var a in t.reference3Ds)C(e,t.reference3Ds[a],s)}function E(e,t,s){if(t.referenceReps)for(var i in t.referenceReps){var r=t.referenceReps[i];for(var n in r)if("id"!==n){var A=r[n],o="lines"===A.geometry.primitive?e.modelNode._wireframeMaterial:A.materialId?e.materials[A.materialId]:null,a=A.color,l=new dt(e.modelNode,{isObject:!0,geometry:A.geometry,material:o||e.modelNode._defaultMaterial,colorize:a,backfaces:!1});e.metaModelData&&e.metaModelData.metaObjects.push({id:l.id,type:"Default",name:t.name,parent:s?s.id:e.modelNode.id}),s?s.addChild(l,!0):e.modelNode.addChild(l,!0),l.colorize=a}}}for(var b in n){if(!(y=n[b]).instance3D)return C(e,y,null),void s()}alert("No root Reference3D element found in this modelNode - can't load."),s()}))}function A(e,t){for(var s=t.children,i=0,r=s.length;i<r;i++){var n=s[i];if("Viewpoint"===n.type){var A=n.children;e.modelNode.viewpoint={};for(var o=0,a=A.length;o<a;o++){var l=A[i];switch(l.type){case"Position":e.modelNode.viewpoint.eye=g(l.children[0],3);break;case"Sight":e.modelNode.viewpoint.look=g(l.children[0],3);break;case"Up":e.modelNode.viewpoint.up=g(l.children[0],3)}}}}}function o(e,t,s){for(var i=t.children,r=0,n=i.length;r<n;r++){var A=i[r];if("XMLRepresentation"===A.type)a(e,A,s)}}function a(e,t,s){for(var i=t.children,r=0,n=i.length;r<n;r++){var A=i[r];if("Root"===A.type)l(e,A,s)}}function l(e,t,s){t["xsi:type"];for(var i=t.children,r=0,n=i.length;r<n;r++){var A=i[r];if("Rep"===A.type)c(e,A,s)}}function c(e,t,s){t["xsi:type"];for(var i={edgeThreshold:e.edgeThreshold||30,compressGeometry:!0},r=t.children,n=0,A=r.length;n<A;n++){var o=r[n];switch(o.type){case"Rep":c(e,o,s);break;case"Edges":break;case"Faces":i.primitive="triangles",u(e,o,i);break;case"VertexBuffer":f(e,o,i);break;case"SurfaceAttributes":m(e,o,i)}}if(i.positions){var a=new pe(e.modelNode,i);s[a.id]={geometry:a,color:i.color||[1,1,1,1],materialId:i.materialId}}}function u(e,t,s){for(var i=t.children,r=0,n=i.length;r<n;r++){var A=i[r];if("Face"===A.type)d(e,A,s)}}function d(e,t,s){var i=t.strips;if(i){var r=function(e){for(var t=e.split(","),s=[],i=0,r=t.length;i<r;i++){var n=t[i].trim();if(n.length>0){for(var A=n.trim().split(" "),o=new Int16Array(A.length),a=0,l=0,c=A.length;l<c;l++)""!==A[l]&&(o[a++]=parseInt(A[l]));s.push(o)}}return s}(i);if(r.length>0){s.primitive="triangles";for(var n=[],A=0,o=r.length;A<o;A++)for(var a=p(r[A]),l=0,c=a.length;l<c;l++)n.push(a[l]);s.indices=n}}else{var h=t.triangles;h&&(s.primitive="triangles",s.indices=function(e){e=e.trim().split(" ");for(var t=new Int32Array(e.length),s=0,i=e.length;s<i;s++){var r=e[s];t[s]=parseInt(r)}return t}(h))}var u=t.children;for(A=0,o=u.length;A<o;A++){var d=u[A];if("SurfaceAttributes"===d.type)m(e,d,s)}}function p(e){for(var t=[],s=0,i=e.length;s<i-2;s++)1&s?(t.push(e[s]),t.push(e[s+2]),t.push(e[s+1])):(t.push(e[s]),t.push(e[s+1]),t.push(e[s+2]));return t}function f(e,t,s){for(var i=t.children,r=0,n=i.length;r<n;r++){var A=i[r];switch(A.type){case"Positions":s.positions=g(A.children[0],3);break;case"Normals":s.normals=g(A.children[0],3);break;case"TextureCoordinates":s.uv=g(A.children[0],2)}}}function g(e,t){e=e.split(",");for(var s=new Float32Array(e.length*t),i=0,r=0,n=e.length;r<n;r++)for(var A=e[r],o=0,a=(A=A.split(" ")).length;o<a;o++)""!==A[o]&&(s[i++]=parseFloat(A[o]));return s}function m(e,t,s){s.color=[1,1,1,1];for(var i,r,n=t.children,A=0,o=n.length;A<o;A++){var a=n[A];switch(a.type){case"Color":s.color[0]=a.red,s.color[1]=a.green,s.color[2]=a.blue,s.color[3]=a.alpha;break;case"MaterialApplication":for(var l=a.children,c=0,h=l.length;c<h;c++){var u=l[c];if("MaterialId"===u.type){var d=(i=u.id,r=void 0,-1!==(r=i.lastIndexOf("#"))?i.substring(r+1):i);e.materials[d]||e.plugin.error("material  not found: "+d),s.materialId=d}}}}}}();function Iw(e,t,s){var i={};!function r(n,A){if(n>=t.length)s();else{var o=t[n].id,a=o.lastIndexOf(":");a>0&&(o=o.substring(a+1));var l=o.lastIndexOf("#");l>0&&(o=o.substring(0,l)),i[o]?r(n+1):function(e,t,s){e.zip.getFile(t,(function(t,i){!function(e,t,s){for(var i,r=t.children,n=0,A=r.length;n<A;n++)"Model_3dxml"===(i=r[n]).type&&Tw(e,i,s)}(e,i,s)}))}(e,o,(function(){i[o]=!0,r(n+1)}))}}(0)}function Tw(e,t,s){for(var i,r=t.children,n=0,A=r.length;n<A;n++)"CATMaterialRef"===(i=r[n]).type&&Pw(e,i,s)}function Pw(e,t,s){for(var i={},r=t.children,n=0,A=0,o=r.length;A<o;A++){if("MaterialDomainInstance"===(d=r[A]).type){for(var a,l,c=0,h=d.children.length;c<h;c++){var u=d.children[c];switch(u.type){case"IsAggregatedBy":a=u.children[0];break;case"IsInstanceOf":l=u.children[0]}}i[l]=a}}for(A=0,o=r.length;A<o;A++){if("MaterialDomain"===(d=r[A]).type)n++}for(A=0,o=r.length;A<o;A++){var d;if("MaterialDomain"===(d=r[A]).type)d.associatedFile&&function(){var t=d.id,r=Rw(d.associatedFile);e.zip.getFile(r,(function(r,A){e.materials[i[t]]=Sw(e,A),0==--n&&s()}),(function(e){}))}()}}function Sw(e,t){for(var s=t.children,i=0,r=s.length;i<r;i++){var n=s[i];if("Osm"===n.type)return Dw(e,n)}}function Dw(e,t){for(var s=t.children,i=0,r=s.length;i<r;i++){var n=s[i];switch(n.type){case"RenderingRootFeature":break;case"Feature":if("RenderingFeature"===n.Alias){var A,o,a,l,c={},h={},u=n.children;for(A=0,o=u.length;A<o;A++)switch((a=u[A]).Name){case"AmbientCoef":c.ambient=parseFloat(a.Value);break;case"DiffuseCoef":c.diffuse=parseFloat(a.Value);break;case"EmissiveCoef":c.emissive=parseFloat(a.Value);break;case"SpecularExponent":c.specular=parseFloat(a.Value)}for(A=0,o=u.length;A<o;A++)switch((a=u[A]).Name){case"AmbientColor":h.ambient=kw(a.Value,c.ambient);break;case"DiffuseColor":h.diffuse=kw(a.Value,c.diffuse);break;case"EmissiveColor":h.emissive=kw(a.Value,c.emissive);break;case"SpecularColor":h.specular=kw(a.Value,c.specular);break;case"Transparency":var d=1-parseFloat(a.Value);d<1&&(h.alpha=d,h.alphaMode="blend")}switch(e.materialType){case"MetallicMaterial":l=new Rt(e.modelNode,{baseColor:h.diffuse,metallic:.7,roughness:.5,emissive:h.emissive,alpha:h.alpha,alphaMode:h.alphaMode});break;case"SpecularMaterial":l=new Lt(e.modelNode,{diffuse:h.diffuse,specular:h.specular,glossiness:.5,emissive:h.emissive,alpha:h.alpha,alphaMode:h.alphaMode});break;default:l=new bt(e.modelNode,{reflectivity:.5,ambient:h.ambient,diffuse:h.diffuse,specular:h.specular,emissive:h.emissive,alphaMode:h.alphaMode,alpha:t.alpha})}return l}}}}function kw(e,t){t=void 0!==t?t:.5;var s=e.indexOf("["),i=e.indexOf("]");e=(e=e.substring(s+1,i-s)).split(",");for(var r=new Float32Array(e.length),n=0,A=0,o=e.length;A<o;A++)for(var a=e[A],l=0,c=(a=a.trim().split(" ")).length;l<c;l++)""!==a[l]&&(r[n++]=parseFloat(a[l])*t);return r}var Qw=function(){var e={};function t(e,s){if(e.nodeType===e.TEXT_NODE){var i=e.nodeValue;if(null===i.match(/^\s+$/))return i}else if(e.nodeType===e.ELEMENT_NODE||e.nodeType===e.DOCUMENT_NODE){var r={type:e.nodeName,children:[]};if(e.nodeType===e.ELEMENT_NODE)for(var n=0;n<e.attributes.length;n++){var A=e.attributes[n];r[s[A.nodeName]||A.nodeName]=A.nodeValue}for(var o=0;o<e.childNodes.length;o++){(n=t(e.childNodes[o],s))&&r.children.push(n)}return r}}this.load=function(t,s,i){Mw.createReader(new Mw.HttpReader(t),(function(t){t.getEntries((function(t){if(t.length>0)for(var i=0,r=t.length;i<r;i++){var n=t[i];e[n.filename]=n}s()}))}),i)},this.getFile=function(s,i,r){var n=e[s];if(!n){var A="ZIP entry not found: "+s;return console.error(A),void(r&&r(A))}n.getData(new Mw.TextWriter,(function(e){var s=(new DOMParser).parseFromString(e,"text/xml"),r=t(s,{});i(s,r)}))},this.destroy=function(){undefined.close((function(){}))}};function Rw(e){var t="urn:3DXML:";return 0===e.indexOf(t)?e.substring(t.length):e}class Ow{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getIFC(e,t,s){e=this._cacheBusterURL(e);var i=()=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var n=r[3];n=window.decodeURIComponent(n),e&&(n=window.atob(n));try{const e=new ArrayBuffer(n.length),s=new Uint8Array(e);for(var A=0;A<n.length;A++)s[A]=n.charCodeAt(A);t(e)}catch(e){s(e)}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("getXKT error : "+i.response))},i.send(null)}}}class Vw{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getLAS(e,t,s){e=this._cacheBusterURL(e);var i=()=>{};t=t||i,s=s||i;const r=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(r){const e=!!r[2];var n=r[3];n=window.decodeURIComponent(n),e&&(n=window.atob(n));try{const e=new ArrayBuffer(n.length),s=new Uint8Array(e);for(var A=0;A<n.length;A++)s[A]=n.charCodeAt(A);t(e)}catch(e){s(e)}}else{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(i.response):s("getLAS error : "+i.response))},i.send(null)}}getManifest(e,t,s){_.loadJSON(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}}const Lw={dataType:null,batchType:null,name:"LAS",id:"las",module:"las",version:"4.3.2",worker:!0,extensions:["las","laz"],mimeTypes:["application/octet-stream"],text:!0,binary:!0,tests:["LAS"],options:{las:{shape:"mesh",fp64:!1,skip:1,colorDepth:8}}};function Hw(){var e,t=void 0!==t?t:{},s={};for(e in t)t.hasOwnProperty(e)&&(s[e]=t[e]);var i,r,n,A;i="object"==typeof window,r="function"==typeof importScripts,n="object"==typeof process&&"object"==typeof process.versions&&"string"==typeof process.versions.node,A=!i&&!n&&!r;var o,a,l,c,h,u="";if(n){if(r)u=require("path").dirname(u)+"/";else{const e="undefined"!=typeof __dirname?__dirname:"";u=e+"/"}o=function(e,t){var s=ht(e);return s?t?s:s.toString():(c||(c=require("fs")),h||(h=require("path")),e=h.normalize(e),c.readFileSync(e,t?null:"utf8"))},l=function(e){var t=o(e,!0);return t.buffer||(t=new Uint8Array(t)),m(t.buffer),t},process.argv.length>1&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),"undefined"!=typeof module&&(module.exports=t),process.on("uncaughtException",(function(e){if(!(e instanceof Et))throw e})),process.on("unhandledRejection",W),t.inspect=function(){return"[Emscripten Module object]"}}else A?("undefined"!=typeof read&&(o=function(e){var t=ht(e);return t?lt(t):read(e)}),l=function(e){var t;return(t=ht(e))?t:"function"==typeof readbuffer?new Uint8Array(readbuffer(e)):(m("object"==typeof(t=read(e,"binary"))),t)},"undefined"!=typeof scriptArgs&&scriptArgs,"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(i||r)&&(r?u=self.location.href:document.currentScript&&(u=document.currentScript.src),u=0!==u.indexOf("blob:")?u.substr(0,u.lastIndexOf("/")+1):"",o=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}catch(t){var s=ht(e);if(s)return lt(s);throw t}},r&&(l=function(e){try{var t=new XMLHttpRequest;return t.open("GET",e,!1),t.responseType="arraybuffer",t.send(null),new Uint8Array(t.response)}catch(t){var s=ht(e);if(s)return s;throw t}}),a=function(e,t,s){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){if(200==i.status||0==i.status&&i.response)t(i.response);else{var r=ht(e);r?t(r.buffer):s()}},i.onerror=s,i.send(null)});var d=t.print||console.log.bind(console),p=t.printErr||console.warn.bind(console);for(e in s)s.hasOwnProperty(e)&&(t[e]=s[e]);s=null,t.arguments,t.thisProgram,t.quit,new Array(0);var f=0;t.wasmBinary,t.noExitRuntime;var g=!1;function m(e,t){e||W("Assertion failed: "+t)}var _="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function b(e,t){return e?function(e,t,s){for(var i=t+s,r=t;e[r]&&!(r>=i);)++r;if(r-t>16&&e.subarray&&_)return _.decode(e.subarray(t,r));for(var n="";t<r;){var A=e[t++];if(128&A){var o=63&e[t++];if(192!=(224&A)){var a=63&e[t++];if((A=224==(240&A)?(15&A)<<12|o<<6|a:(7&A)<<18|o<<12|a<<6|63&e[t++])<65536)n+=String.fromCharCode(A);else{var l=A-65536;n+=String.fromCharCode(55296|l>>10,56320|1023&l)}}else n+=String.fromCharCode((31&A)<<6|o)}else n+=String.fromCharCode(A)}return n}(w,e,t):""}var B,y,w,v,C,M,E,F,x,U="undefined"!=typeof TextDecoder?new TextDecoder("utf-16le"):void 0;function I(e,t){for(var s=e,i=s>>1,r=i+t/2;!(i>=r)&&C[i];)++i;if((s=i<<1)-e>32&&U)return U.decode(w.subarray(e,s));for(var n=0,A="";;){var o=v[e+2*n>>1];if(0==o||n==t/2)return A;++n,A+=String.fromCharCode(o)}}function T(e,t,s){if(void 0===s&&(s=2147483647),s<2)return 0;for(var i=t,r=(s-=2)<2*e.length?s/2:e.length,n=0;n<r;++n){var A=e.charCodeAt(n);v[t>>1]=A,t+=2}return v[t>>1]=0,t-i}function P(e){return 2*e.length}function S(e,t){for(var s=0,i="";!(s>=t/4);){var r=M[e+4*s>>2];if(0==r)break;if(++s,r>=65536){var n=r-65536;i+=String.fromCharCode(55296|n>>10,56320|1023&n)}else i+=String.fromCharCode(r)}return i}function D(e,t,s){if(void 0===s&&(s=2147483647),s<4)return 0;for(var i=t,r=i+s-4,n=0;n<e.length;++n){var A=e.charCodeAt(n);if(A>=55296&&A<=57343)A=65536+((1023&A)<<10)|1023&e.charCodeAt(++n);if(M[t>>2]=A,(t+=4)+4>r)break}return M[t>>2]=0,t-i}function k(e){for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);i>=55296&&i<=57343&&++s,t+=4}return t}var Q,R=t.INITIAL_MEMORY||167772160;function O(e){for(;e.length>0;){var s=e.shift();if("function"!=typeof s){var i=s.func;"number"==typeof i?void 0===s.arg?t.dynCall_v(i):t.dynCall_vi(i,s.arg):i(void 0===s.arg?null:s.arg)}else s(t)}}R=(B=t.buffer?t.buffer:new ArrayBuffer(R)).byteLength,B=Q=B,t.HEAP8=y=new Int8Array(Q),t.HEAP16=v=new Int16Array(Q),t.HEAP32=M=new Int32Array(Q),t.HEAPU8=w=new Uint8Array(Q),t.HEAPU16=C=new Uint16Array(Q),t.HEAPU32=E=new Uint32Array(Q),t.HEAPF32=F=new Float32Array(Q),t.HEAPF64=x=new Float64Array(Q),M[5544]=5265264;var V=[],L=[],H=[],N=[];var G=0,j=null;function W(e){throw t.onAbort&&t.onAbort(e),d(e+=""),p(e),g=!0,e="abort("+e+"). Build with -s ASSERTIONS=1 for more info."}t.preloadedImages={},t.preloadedAudios={};var z=null;var X="data:application/octet-stream;base64,";function K(e){return t=e,s=X,String.prototype.startsWith?t.startsWith(s):0===t.indexOf(s);var t,s}L.push({func:function(){Bt()}}),z="data:application/octet-stream;base64,AAAAAAAAAAAPDg0MCwoJCA4AAQMGCgoJDQECBAcLCwoMAwQFCAwMCwsGBwgJDQ0MCgoLDA0ODg0JCgsMDQ4PDggJCgsMDQ4PAAECAwQFBgcBAAECAwQFBgIBAAECAwQFAwIBAAECAwQEAwIBAAECAwUEAwIBAAECBgUEAwIBAAEHBgUEAwIBAMgPAAAoDQAAEBAAACAQAADIDwAAUA0AABAQAAAgEAAAEQAKABEREQAAAAAFAAAAAAAACQAAAAALAAAAAAAAAAARAA8KERERAwoHAAEACQsLAAAJBgsAAAsABhEAAAAREREAAAAAAAAAAAAAAAAAAAAACwAAAAAAAAAAEQAKChEREQAKAAACAAkLAAAACQALAAALAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAwAAAAAAAAAAAAAAAwAAAAADAAAAAAJDAAAAAAADAAADAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAANAAAABA0AAAAACQ4AAAAAAA4AAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAADwAAAAAPAAAAAAkQAAAAAAAQAAAQAAASAAAAEhISAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABIAAAASEhIAAAAAAAAJAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALAAAAAAAAAAAAAAAKAAAAAAoAAAAACQsAAAAAAAsAAAsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAAAAAAAAAAAADAAAAAAMAAAAAAkMAAAAAAAMAAAMAAAwMTIzNDU2Nzg5QUJDREVGGRJEOwI/LEcUPTMwChsGRktFNw9JDo4XA0AdPGkrNh9KLRwBICUpIQgMFRYiLhA4Pgs0MRhkdHV2L0EJfzkRI0MyQomKiwUEJignDSoeNYwHGkiTE5SVAAAAAAAAAAAASWxsZWdhbCBieXRlIHNlcXVlbmNlAERvbWFpbiBlcnJvcgBSZXN1bHQgbm90IHJlcHJlc2VudGFibGUATm90IGEgdHR5AFBlcm1pc3Npb24gZGVuaWVkAE9wZXJhdGlvbiBub3QgcGVybWl0dGVkAE5vIHN1Y2ggZmlsZSBvciBkaXJlY3RvcnkATm8gc3VjaCBwcm9jZXNzAEZpbGUgZXhpc3RzAFZhbHVlIHRvbyBsYXJnZSBmb3IgZGF0YSB0eXBlAE5vIHNwYWNlIGxlZnQgb24gZGV2aWNlAE91dCBvZiBtZW1vcnkAUmVzb3VyY2UgYnVzeQBJbnRlcnJ1cHRlZCBzeXN0ZW0gY2FsbABSZXNvdXJjZSB0ZW1wb3JhcmlseSB1bmF2YWlsYWJsZQBJbnZhbGlkIHNlZWsAQ3Jvc3MtZGV2aWNlIGxpbmsAUmVhZC1vbmx5IGZpbGUgc3lzdGVtAERpcmVjdG9yeSBub3QgZW1wdHkAQ29ubmVjdGlvbiByZXNldCBieSBwZWVyAE9wZXJhdGlvbiB0aW1lZCBvdXQAQ29ubmVjdGlvbiByZWZ1c2VkAEhvc3QgaXMgZG93bgBIb3N0IGlzIHVucmVhY2hhYmxlAEFkZHJlc3MgaW4gdXNlAEJyb2tlbiBwaXBlAEkvTyBlcnJvcgBObyBzdWNoIGRldmljZSBvciBhZGRyZXNzAEJsb2NrIGRldmljZSByZXF1aXJlZABObyBzdWNoIGRldmljZQBOb3QgYSBkaXJlY3RvcnkASXMgYSBkaXJlY3RvcnkAVGV4dCBmaWxlIGJ1c3kARXhlYyBmb3JtYXQgZXJyb3IASW52YWxpZCBhcmd1bWVudABBcmd1bWVudCBsaXN0IHRvbyBsb25nAFN5bWJvbGljIGxpbmsgbG9vcABGaWxlbmFtZSB0b28gbG9uZwBUb28gbWFueSBvcGVuIGZpbGVzIGluIHN5c3RlbQBObyBmaWxlIGRlc2NyaXB0b3JzIGF2YWlsYWJsZQBCYWQgZmlsZSBkZXNjcmlwdG9yAE5vIGNoaWxkIHByb2Nlc3MAQmFkIGFkZHJlc3MARmlsZSB0b28gbGFyZ2UAVG9vIG1hbnkgbGlua3MATm8gbG9ja3MgYXZhaWxhYmxlAFJlc291cmNlIGRlYWRsb2NrIHdvdWxkIG9jY3VyAFN0YXRlIG5vdCByZWNvdmVyYWJsZQBQcmV2aW91cyBvd25lciBkaWVkAE9wZXJhdGlvbiBjYW5jZWxlZABGdW5jdGlvbiBub3QgaW1wbGVtZW50ZWQATm8gbWVzc2FnZSBvZiBkZXNpcmVkIHR5cGUASWRlbnRpZmllciByZW1vdmVkAERldmljZSBub3QgYSBzdHJlYW0ATm8gZGF0YSBhdmFpbGFibGUARGV2aWNlIHRpbWVvdXQAT3V0IG9mIHN0cmVhbXMgcmVzb3VyY2VzAExpbmsgaGFzIGJlZW4gc2V2ZXJlZABQcm90b2NvbCBlcnJvcgBCYWQgbWVzc2FnZQBGaWxlIGRlc2NyaXB0b3IgaW4gYmFkIHN0YXRlAE5vdCBhIHNvY2tldABEZXN0aW5hdGlvbiBhZGRyZXNzIHJlcXVpcmVkAE1lc3NhZ2UgdG9vIGxhcmdlAFByb3RvY29sIHdyb25nIHR5cGUgZm9yIHNvY2tldABQcm90b2NvbCBub3QgYXZhaWxhYmxlAFByb3RvY29sIG5vdCBzdXBwb3J0ZWQAU29ja2V0IHR5cGUgbm90IHN1cHBvcnRlZABOb3Qgc3VwcG9ydGVkAFByb3RvY29sIGZhbWlseSBub3Qgc3VwcG9ydGVkAEFkZHJlc3MgZmFtaWx5IG5vdCBzdXBwb3J0ZWQgYnkgcHJvdG9jb2wAQWRkcmVzcyBub3QgYXZhaWxhYmxlAE5ldHdvcmsgaXMgZG93bgBOZXR3b3JrIHVucmVhY2hhYmxlAENvbm5lY3Rpb24gcmVzZXQgYnkgbmV0d29yawBDb25uZWN0aW9uIGFib3J0ZWQATm8gYnVmZmVyIHNwYWNlIGF2YWlsYWJsZQBTb2NrZXQgaXMgY29ubmVjdGVkAFNvY2tldCBub3QgY29ubmVjdGVkAENhbm5vdCBzZW5kIGFmdGVyIHNvY2tldCBzaHV0ZG93bgBPcGVyYXRpb24gYWxyZWFkeSBpbiBwcm9ncmVzcwBPcGVyYXRpb24gaW4gcHJvZ3Jlc3MAU3RhbGUgZmlsZSBoYW5kbGUAUmVtb3RlIEkvTyBlcnJvcgBRdW90YSBleGNlZWRlZABObyBtZWRpdW0gZm91bmQAV3JvbmcgbWVkaXVtIHR5cGUATm8gZXJyb3IgaW5mb3JtYXRpb24AAAAAAADgFgAAmRgAAGAQAAAAAAAA4BYAAEIZAABgEAAAAAAAAOAWAAAqGgAASA8AAAAAAAC4FgAANBsAAOAWAACfGgAAMAoAAAAAAADgFgAAaRsAAEgPAAAAAAAA4BYAAIobAABIDwAAAAAAALgWAAAPHAAA4BYAAHwcAABIDwAAAAAAAOAWAACVHAAASA8AAAAAAADgFgAAHh0AAEgPAAAAAAAA4BYAAHcdAABIDwAAAAAAAOAWAACQHQAASA8AAAAAAADgFgAAQh4AAEgPAAAAAAAA4BYAAIceAABgEAAAAAAAAOAWAACkHwAASA8AAAAAAAC4FgAAZyAAAOAWAADkHwAA8AoAAAAAAADgFgAAjyAAAGAQAAAAAAAAuBYAAMMiAADgFgAAAiIAABgLAAAAAAAA4BYAAOEiAABgEAAAAAAAAOAWAADQJAAAGAsAAAAAAADgFgAAkSUAAGAQAAAAAAAA4BYAAIAnAAAYCwAAAAAAAOAWAAA9KAAAYBAAAAAAAADgFgAAJCoAABgLAAAAAAAA4BYAAOkqAABgEAAAAAAAAOAWAADgLAAA8AoAAAAAAADgFgAAui0AAGAQAAAAAAAA4BYAANsvAADwCgAAAAAAAOAWAADTMAAAYBAAAAAAAADgFgAAMDMAAPAKAAAAAAAA4BYAACQ0AABgEAAAAAAAAOAWAAB5NgAA8AoAAAAAAADgFgAAizcAAGAQAAAAAAAA4BYAABw6AABgEAAAAAAAAOAWAACdOgAAYBAAAAAAAADgFgAAXjsAAPAKAAAAAAAA4BYAALU7AABgEAAAAAAAAOAWAADMPAAAGAsAAAAAAADgFgAATz0AAGAQAAAAAAAA4BYAAL4+AAAYCwAAAAAAAOAWAABBPwAAYBAAAAAAAADgFgAAsEAAABgLAAAAAAAA4BYAADNBAABgEAAAAAAAAOAWAACiQgAAGAsAAAAAAADgFgAAJUMAAGAQAAAAAAAA4BYAAJREAAAYCwAAAAAAAOAWAAAXRQAAYBAAAAAAAADgFgAAhkYAABgLAAAAAAAA4BYAAAlHAABgEAAAAAAAALgWAAB4SAAAiBcAAIBIAAAAAAAAIA0AAIgXAACJSAAAAQAAACANAAC4FgAAqkgAAIgXAAC6SAAAAAAAAEgNAACIFwAAy0gAAAEAAABIDQAAuBYAABhMAAC4FgAAN0wAALgWAABWTAAAuBYAAHVMAAC4FgAAlEwAALgWAACzTAAAuBYAANJMAAC4FgAA8UwAALgWAAAQTQAAuBYAAC9NAAC4FgAATk0AALgWAABtTQAAuBYAAIxNAACkFwAAn00AAAAAAAABAAAA8A0AAAAAAAC4FgAA4U0AAKQXAAAHTgAAAAAAAAEAAADwDQAAAAAAAKQXAABJTgAAAAAAAAEAAADwDQAAAAAAAKQXAACITgAAAAAAAAEAAADwDQAAAAAAAKQXAADHTgAAAAAAAAEAAADwDQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAP//////AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAALgWAADNTwAA4BYAAC1QAAAADwAAAAAAAOAWAADaTwAAEA8AAAAAAAC4FgAA+08AAOAWAAAIUAAA8A4AAAAAAADgFgAAhlAAAOgOAAAAAAAA4BYAAJNQAADoDgAAAAAAAOAWAACjUAAA6A4AAAAAAADgFgAAtVAAADgPAAAAAAAA4BYAAMZQAAA4DwAAAAAAAOAWAADXUAAAAA8AAAAAAADgFgAA+VAAAHgPAAAAAAAA4BYAAB1RAAAADwAAAAAAAOAWAABCUQAAeA8AAAAAAADgFgAAjlEAAAAPAAAAAAAAbBcAALZRAABsFwAAuFEAAGwXAAC7UQAAbBcAAL1RAABsFwAAv1EAAGwXAADBUQAAbBcAAMNRAABsFwAAxVEAAGwXAADHUQAAbBcAAMlRAABsFwAAy1EAAGwXAADNUQAAbBcAAM9RAABsFwAA0VEAAOAWAADTUQAA8A4AAAAAAADgFgAARlIAAOgOAAAAAAAAuBYAAGJSAACkFwAAe1IAAAAAAAABAAAAWBAAAAAAAADgFgAA9FIAAIgQAAAAAAAA4BYAABdTAACYEAAAAAAAALgWAAAuUwAA4BYAAHBTAACIEAAAAAAAAOAWAACSUwAASA8AAAAAAAAAAAAAAAoAAAEAAAACAAAAAwAAAAEAAAAEAAAAAAAAABAKAAABAAAABQAAAAYAAAACAAAABwAAAAAAAAAgCgAACAAAAAkAAAABAAAAAAAAADgKAAAKAAAACwAAAAIAAAABAAAADAAAAA0AAAACAAAAAwAAAAMAAAAAAAAASAoAAAgAAAAOAAAAAQAAAAAAAABYCgAACAAAAA8AAAABAAAAAAAAAIAKAAAIAAAAEAAAAAEAAAAAAAAAcAoAAAgAAAARAAAAAQAAAAAAAACQCgAACAAAABIAAAABAAAAAAAAAKAKAAAIAAAAEwAAAAEAAAAAAAAAsAoAAAgAAAAUAAAAAQAAAAAAAADACgAACAAAABUAAAABAAAAAAAAANAKAAABAAAAFgAAABcAAAAEAAAAGAAAAAAAAADgCgAACAAAABkAAAABAAAAAAAAAPgKAAAFAAAAGgAAABsAAAAAAAAA8AoAAAEAAAAcAAAAHQAAAAAAAAAICwAAAQAAAB4AAAAfAAAABgAAACAAAAAAAAAAIAsAACEAAAAiAAAABwAAAAgAAAAAAAAAGAsAACMAAAAkAAAABwAAAAkAAAAAAAAAMAsAAAEAAAAlAAAAJgAAAAoAAAAnAAAAAAAAAEALAAAoAAAAKQAAAAcAAAALAAAAAAAAAFALAAABAAAAKgAAACsAAAAMAAAALAAAAAAAAABgCwAALQAAAC4AAAAHAAAADQAAAAAAAABwCwAAAQAAAC8AAAAwAAAADgAAADEAAAAAAAAAgAsAADIAAAAzAAAABwAAAA8AAAAAAAAAkAsAAAEAAAA0AAAANQAAABAAAAA2AAAAAAAAAKALAAARAAAANwAAADgAAAAAAAAAsAsAAAEAAAA5AAAAOgAAABIAAAA7AAAAAAAAAMALAAATAAAAPAAAAD0AAAAAAAAA0AsAAAEAAAA+AAAAPwAAABQAAABAAAAAAAAAAOALAAAVAAAAQQAAAEIAAAAAAAAA8AsAAAEAAABDAAAARAAAABYAAABFAAAAAAAAAAAMAAAXAAAARgAAAEcAAAAAAAAAEAwAAAEAAABIAAAASQAAABgAAABKAAAAAAAAACAMAAABAAAASwAAAEwAAAAZAAAATQAAAAAAAAAwDAAAAQAAAE4AAABPAAAAGgAAAFAAAAAAAAAAQAwAABsAAABRAAAAUgAAAAAAAABQDAAAAQAAAFMAAABUAAAAHAAAAFUAAAAAAAAAYAwAAFYAAABXAAAABwAAAB0AAAAAAAAAcAwAAAEAAABYAAAAWQAAAB4AAABaAAAAAAAAAIAMAABbAAAAXAAAAAcAAAAfAAAAAAAAAJAMAAABAAAAXQAAAF4AAAAgAAAAXwAAAAAAAACgDAAAYAAAAGEAAAAHAAAAIQAAAAAAAACwDAAAAQAAAGIAAABjAAAAIgAAAGQAAAAAAAAAwAwAAGUAAABmAAAABwAAACMAAAAAAAAA0AwAAAEAAABnAAAAaAAAACQAAABpAAAAAAAAAOAMAABqAAAAawAAAAcAAAAlAAAAAAAAAPAMAAABAAAAbAAAAG0AAAAmAAAAbgAAAAAAAAAADQAAbwAAAHAAAAAHAAAAJwAAAAAAAAAQDQAAAQAAAHEAAAByAAAAKAAAAHMAAAAoDQAAyA8AACgNAAAIEAAAEBAAACgNAABQDQAAyA8AAFANAAAgEAAAyA8AAFANAAAIEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABsVAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADwDgAAdAAAAHUAAAB2AAAAdwAAAAIAAAABAAAAAQAAAAEAAAAAAAAAGA8AAHQAAAB4AAAAdgAAAHcAAAACAAAAAgAAAAIAAAACAAAAAAAAACgPAAB5AAAAegAAAAQAAAAAAAAAOA8AAHsAAAB8AAAABQAAAAAAAABIDwAACAAAAH0AAAABAAAAAAAAAFgPAAB7AAAAfgAAAAUAAAAAAAAAaA8AAHsAAAB/AAAABQAAAAAAAAC4DwAAdAAAAIAAAAB2AAAAdwAAAAMAAAAAAAAAiA8AAHQAAACBAAAAdgAAAHcAAAAEAAAAAAAAADgQAAB0AAAAggAAAHYAAAB3AAAAAgAAAAMAAAADAAAAAwAAAAAAAABIEAAAgwAAAIQAAAAGAAAAAAAAAHgQAACFAAAAhgAAAAcAAAABAAAABQAAAAYAAAACAAAAAAAAAKAQAACFAAAAhwAAAAgAAAADAAAABQAAAAYAAAAEAAAA4BcAAAQYAAAAAAAAsBAAAIgAAACJAAAAAQAAAExBU1ppcABvcGVuAGdldFBvaW50AGdldENvdW50AER5bmFtaWNMQVNaaXAAYWRkRmllbGRGbG9hdGluZwBhZGRGaWVsZFNpZ25lZABhZGRGaWVsZFVuc2lnbmVkAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRU5TXzE0ZGVmYXVsdF9kZWxldGVJUzNfRUVOU185YWxsb2NhdG9ySVMzX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJUzdfRUVOU185YWxsb2NhdG9ySVM3X0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFAExBU0YATjZsYXN6aXAxM2ludmFsaWRfbWFnaWNFAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUARmlsZSBtYWdpYyBpcyBub3QgdmFsaWQATlN0M19fMjEwX19mdW5jdGlvbjZfX2Z1bmNJWk42bGFzemlwMmlvNnJlYWRlcjEwYmFzaWNfZmlsZUlOUzJfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRTExX3ZhbGlkYXRvcnNFdkVVbFJOUzNfNmhlYWRlckVFX05TXzlhbGxvY2F0b3JJU0JfRUVGdlNBX0VFRQBOU3QzX18yMTBfX2Z1bmN0aW9uNl9fYmFzZUlGdlJONmxhc3ppcDJpbzZoZWFkZXJFRUVFAE42bGFzemlwMjFvbGRfc3R5bGVfY29tcHJlc3Npb25FAE42bGFzemlwMTRub3RfY29tcHJlc3NlZEUAVGhlIGZpbGUgc2VlbXMgdG8gaGF2ZSBvbGQgc3R5bGUgY29tcHJlc3Npb24gd2hpY2ggaXMgbm90IHN1cHBvcnRlZABUaGUgZmlsZSBkb2Vzbid0IHNlZW0gdG8gYmUgY29tcHJlc3NlZABaTjZsYXN6aXAyaW82cmVhZGVyMTBiYXNpY19maWxlSU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUUxMV92YWxpZGF0b3JzRXZFVWxSTlMwXzZoZWFkZXJFRV8AbGFzemlwIGVuY29kZWQATjZsYXN6aXAxM25vX2xhc3ppcF92bHJFAE42bGFzemlwMjVsYXN6aXBfZm9ybWF0X3Vuc3VwcG9ydGVkRQBPbmx5IExBU3ppcCBQT0lOVFdJU0UgQ0hVTktFRCBkZWNvbXByZXNzb3IgaXMgc3VwcG9ydGVkAE5vIExBU3ppcCBWTFIgd2FzIGZvdW5kIGluIHRoZSBWTFJzIHNlY3Rpb24ATjZsYXN6aXAyMmNodW5rX3RhYmxlX3JlYWRfZXJyb3JFAENodW5rIHRhYmxlIG9mZnNldCA9PSAtMSBpcyBub3Qgc3VwcG9ydGVkIGF0IHRoaXMgdGltZQBONmxhc3ppcDEzbm90X3N1cHBvcnRlZEUATjZsYXN6aXAyNnVua25vd25fY2h1bmtfdGFibGVfZm9ybWF0RQBjaHVua19zaXplID09IHVpbnQubWF4IGlzIG5vdCBzdXBwb3J0ZWQgYXQgdGhpcyB0aW1lLgBUaGVyZSB3YXMgYSBwcm9ibGVtIHJlYWRpbmcgdGhlIGNodW5rIHRhYmxlAFRoZSBjaHVuayB0YWJsZSB2ZXJzaW9uIG51bWJlciBpcyB1bmtub3duAE42bGFzemlwMTFlbmRfb2ZfZmlsZUUAUmVhY2hlZCBFbmQgb2YgZmlsZQBJbnZhbGlkIG51bWJlciBvZiBzeW1ib2xzAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVM5X0VFTlNfOWFsbG9jYXRvcklTOV9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRUVFAE42bGFzemlwMTl1bmtub3duX3NjaGVtYV90eXBlRQBUaGUgTEFaIHNjaGVtYSBpcyBub3QgcmVjb2duaXplZABONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2ZpZWxkX2RlY29tcHJlc3NvcklOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyMGR5bmFtaWNfZGVjb21wcmVzc29yRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19maWVsZF9kZWNvbXByZXNzb3JJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU0NfRUVOU185YWxsb2NhdG9ySVNDX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19maWVsZF9kZWNvbXByZXNzb3JJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzVmaWVsZElOUzBfM2xhczdwb2ludDEwRU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNDX0VFRUVFRQBONmxhc3ppcDdmb3JtYXRzMTBiYXNlX2ZpZWxkRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTSV9FRU5TXzlhbGxvY2F0b3JJU0lfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl81ZmllbGRJTlMyXzNsYXM3cG9pbnQxMEVOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMF81ZmllbGRJTlMwXzNsYXM3Z3BzdGltZUVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczdncHN0aW1lRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNFX0VFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU0lfRUVOU185YWxsb2NhdG9ySVNJX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfNWZpZWxkSU5TMl8zbGFzN2dwc3RpbWVFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFRUUATjZsYXN6aXA3Zm9ybWF0czI2ZHluYW1pY19kZWNvbXByZXNzb3JfZmllbGRJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfNWZpZWxkSU5TMF8zbGFzM3JnYkVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczNyZ2JFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0VfRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTSV9FRU5TXzlhbGxvY2F0b3JJU0lfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl81ZmllbGRJTlMyXzNsYXMzcmdiRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNFX0VFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzVmaWVsZElOUzBfM2xhczEwZXh0cmFieXRlc0VOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTQ19FRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczEwZXh0cmFieXRlc0VOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVNJX0VFTlNfOWFsbG9jYXRvcklTSV9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzVmaWVsZElOUzJfM2xhczEwZXh0cmFieXRlc0VOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRV9FRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzBfNWZpZWxkSU5TMF8zbGFzN3BvaW50MTBFTlMwXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0RfRUVFRUVFRUVFAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTS19FRU5TXzlhbGxvY2F0b3JJU0tfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRUVFRUVFRUUATjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOU18yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOU183c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMwXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMwXzVmaWVsZElOUzBfM2xhczdwb2ludDEwRU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNEX0VFRUVOU0JfSU5TQ183Z3BzdGltZUVOU0VfSVNIX0VFRUVFRUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU05fRUVOU185YWxsb2NhdG9ySVNOX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyMWR5bmFtaWNfZGVjb21wcmVzc29yMUlOU184ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlNfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlNfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMF8xOXJlY29yZF9kZWNvbXByZXNzb3JJSk5TMF81ZmllbGRJTlMwXzNsYXM3cG9pbnQxMEVOUzBfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRF9FRUVFTlNCX0lOU0NfM3JnYkVOU0VfSVNIX0VFRUVFRUVFRQBOU3QzX18yMjBfX3NoYXJlZF9wdHJfcG9pbnRlcklQTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV8zcmdiRU5TR19JU0pfRUVFRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTTl9FRU5TXzlhbGxvY2F0b3JJU05fRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlMxXzhkZWNvZGVyczEwYXJpdGhtZXRpY0lOUzFfMmlvMThfX2lmc3RyZWFtX3dyYXBwZXJJTlMxXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzJfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzJfNWZpZWxkSU5TMl8zbGFzN3BvaW50MTBFTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0ZfRUVFRU5TRF9JTlNFXzNyZ2JFTlNHX0lTSl9FRUVFRUVFRUVFRQBONmxhc3ppcDdmb3JtYXRzMjFkeW5hbWljX2RlY29tcHJlc3NvcjFJTlNfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TXzdzdHJlYW1zMTNtZW1vcnlfc3RyZWFtRUVFRUVOUzBfMTlyZWNvcmRfZGVjb21wcmVzc29ySUpOUzBfNWZpZWxkSU5TMF8zbGFzN3BvaW50MTBFTlMwXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJU0RfRUVFRU5TQl9JTlNDXzdncHN0aW1lRU5TRV9JU0hfRUVFRU5TQl9JTlNDXzNyZ2JFTlNFX0lTS19FRUVFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyMWR5bmFtaWNfZGVjb21wcmVzc29yMUlOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSU5TMV8yaW8xOF9faWZzdHJlYW1fd3JhcHBlcklOUzFfN3N0cmVhbXMxM21lbW9yeV9zdHJlYW1FRUVFRU5TMl8xOXJlY29yZF9kZWNvbXByZXNzb3JJSk5TMl81ZmllbGRJTlMyXzNsYXM3cG9pbnQxMEVOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElTRl9FRUVFTlNEX0lOU0VfN2dwc3RpbWVFTlNHX0lTSl9FRUVFTlNEX0lOU0VfM3JnYkVOU0dfSVNNX0VFRUVFRUVFRU5TXzE0ZGVmYXVsdF9kZWxldGVJU1FfRUVOU185YWxsb2NhdG9ySVNRX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJTjZsYXN6aXA3Zm9ybWF0czIxZHluYW1pY19kZWNvbXByZXNzb3IxSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJTlMxXzJpbzE4X19pZnN0cmVhbV93cmFwcGVySU5TMV83c3RyZWFtczEzbWVtb3J5X3N0cmVhbUVFRUVFTlMyXzE5cmVjb3JkX2RlY29tcHJlc3NvcklKTlMyXzVmaWVsZElOUzJfM2xhczdwb2ludDEwRU5TMl8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSVNGX0VFRUVOU0RfSU5TRV83Z3BzdGltZUVOU0dfSVNKX0VFRUVOU0RfSU5TRV8zcmdiRU5TR19JU01fRUVFRUVFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUDEwYnVmX3N0cmVhbU5TXzE0ZGVmYXVsdF9kZWxldGVJUzFfRUVOU185YWxsb2NhdG9ySVMxX0VFRUUATlN0M19fMjE0ZGVmYXVsdF9kZWxldGVJMTBidWZfc3RyZWFtRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTNV9FRU5TXzlhbGxvY2F0b3JJUzVfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZmllbGRfZGVjb21wcmVzc29ySU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRUVFAE5TdDNfXzIyMF9fc2hhcmVkX3B0cl9wb2ludGVySVBONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2ZpZWxkX2RlY29tcHJlc3NvcklOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFRUVOU18xNGRlZmF1bHRfZGVsZXRlSVM4X0VFTlNfOWFsbG9jYXRvcklTOF9FRUVFAE5TdDNfXzIxNGRlZmF1bHRfZGVsZXRlSU42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZmllbGRfZGVjb21wcmVzc29ySU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJaU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWlFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWlOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElpRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElpTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJaUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJak5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWpFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWpOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElqRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElqTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJakVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJYU5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWFFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWFOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElhRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElhTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJYUVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJc05TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSXNFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSXNOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZElzRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZElzTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJc0VFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJaE5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSWhFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSWhOUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZEloRUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZEloTlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJaEVFRUVFRUVFAE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TXzhkZWNvZGVyczEwYXJpdGhtZXRpY0kxMGJ1Zl9zdHJlYW1FRU5TMF81ZmllbGRJdE5TMF8yMHN0YW5kYXJkX2RpZmZfbWV0aG9kSXRFRUVFRUUATlN0M19fMjIwX19zaGFyZWRfcHRyX3BvaW50ZXJJUE42bGFzemlwN2Zvcm1hdHMyNmR5bmFtaWNfZGVjb21wcmVzc29yX2ZpZWxkSU5TMV84ZGVjb2RlcnMxMGFyaXRobWV0aWNJMTBidWZfc3RyZWFtRUVOUzJfNWZpZWxkSXROUzJfMjBzdGFuZGFyZF9kaWZmX21ldGhvZEl0RUVFRUVFTlNfMTRkZWZhdWx0X2RlbGV0ZUlTQ19FRU5TXzlhbGxvY2F0b3JJU0NfRUVFRQBOU3QzX18yMTRkZWZhdWx0X2RlbGV0ZUlONmxhc3ppcDdmb3JtYXRzMjZkeW5hbWljX2RlY29tcHJlc3Nvcl9maWVsZElOUzFfOGRlY29kZXJzMTBhcml0aG1ldGljSTEwYnVmX3N0cmVhbUVFTlMyXzVmaWVsZEl0TlMyXzIwc3RhbmRhcmRfZGlmZl9tZXRob2RJdEVFRUVFRUVFADZMQVNaaXAAUDZMQVNaaXAAUEs2TEFTWmlwAGlpAHYAdmkAdmlpaWkAdmlpaQBpaWkAMTNEeW5hbWljTEFTWmlwAFAxM0R5bmFtaWNMQVNaaXAAUEsxM0R5bmFtaWNMQVNaaXAAdm9pZABib29sAGNoYXIAc2lnbmVkIGNoYXIAdW5zaWduZWQgY2hhcgBzaG9ydAB1bnNpZ25lZCBzaG9ydABpbnQAdW5zaWduZWQgaW50AGxvbmcAdW5zaWduZWQgbG9uZwBmbG9hdABkb3VibGUAc3RkOjpzdHJpbmcAc3RkOjpiYXNpY19zdHJpbmc8dW5zaWduZWQgY2hhcj4Ac3RkOjp3c3RyaW5nAHN0ZDo6dTE2c3RyaW5nAHN0ZDo6dTMyc3RyaW5nAGVtc2NyaXB0ZW46OnZhbABlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxjaGFyPgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxzaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgY2hhcj4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8c2hvcnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIHNob3J0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQ+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PHVuc2lnbmVkIGludD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8bG9uZz4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dW5zaWduZWQgbG9uZz4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50OF90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxpbnQxNl90PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzx1aW50MTZfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8aW50MzJfdD4AZW1zY3JpcHRlbjo6bWVtb3J5X3ZpZXc8dWludDMyX3Q+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGZsb2F0PgBlbXNjcmlwdGVuOjptZW1vcnlfdmlldzxkb3VibGU+AGVtc2NyaXB0ZW46Om1lbW9yeV92aWV3PGxvbmcgZG91YmxlPgBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0llRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJZEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWZFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0ltRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJbEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWpFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0lpRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJdEVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SXNFRQBOMTBlbXNjcmlwdGVuMTFtZW1vcnlfdmlld0loRUUATjEwZW1zY3JpcHRlbjExbWVtb3J5X3ZpZXdJYUVFAE4xMGVtc2NyaXB0ZW4xMW1lbW9yeV92aWV3SWNFRQBOMTBlbXNjcmlwdGVuM3ZhbEUATlN0M19fMjEyYmFzaWNfc3RyaW5nSURpTlNfMTFjaGFyX3RyYWl0c0lEaUVFTlNfOWFsbG9jYXRvcklEaUVFRUUATlN0M19fMjIxX19iYXNpY19zdHJpbmdfY29tbW9uSUxiMUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJRHNOU18xMWNoYXJfdHJhaXRzSURzRUVOU185YWxsb2NhdG9ySURzRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJd05TXzExY2hhcl90cmFpdHNJd0VFTlNfOWFsbG9jYXRvckl3RUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJaE5TXzExY2hhcl90cmFpdHNJaEVFTlNfOWFsbG9jYXRvckloRUVFRQBOU3QzX18yMTJiYXNpY19zdHJpbmdJY05TXzExY2hhcl90cmFpdHNJY0VFTlNfOWFsbG9jYXRvckljRUVFRQAtKyAgIDBYMHgAKG51bGwpAC0wWCswWCAwWC0weCsweCAweABpbmYASU5GAG5hbgBOQU4ALgB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzOiAlcwB0ZXJtaW5hdGluZyB3aXRoICVzIGV4Y2VwdGlvbiBvZiB0eXBlICVzAHRlcm1pbmF0aW5nIHdpdGggJXMgZm9yZWlnbiBleGNlcHRpb24AdGVybWluYXRpbmcAdW5jYXVnaHQAU3Q5ZXhjZXB0aW9uAE4xMF9fY3h4YWJpdjExNl9fc2hpbV90eXBlX2luZm9FAFN0OXR5cGVfaW5mbwBOMTBfX2N4eGFiaXYxMjBfX3NpX2NsYXNzX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE3X19jbGFzc190eXBlX2luZm9FAHRlcm1pbmF0ZV9oYW5kbGVyIHVuZXhwZWN0ZWRseSByZXR1cm5lZABzdGQ6OmJhZF9hbGxvYwBTdDliYWRfYWxsb2MAU3QxMWxvZ2ljX2Vycm9yAFN0MTNydW50aW1lX2Vycm9yAFN0MTJsZW5ndGhfZXJyb3IAU3QxMm91dF9vZl9yYW5nZQBOMTBfX2N4eGFiaXYxMTdfX3BiYXNlX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTE5X19wb2ludGVyX3R5cGVfaW5mb0UATjEwX19jeHhhYml2MTIwX19mdW5jdGlvbl90eXBlX2luZm9FAE4xMF9fY3h4YWJpdjEyOV9fcG9pbnRlcl90b19tZW1iZXJfdHlwZV9pbmZvRQBQdXJlIHZpcnR1YWwgZnVuY3Rpb24gY2FsbGVkIQBOMTBfX2N4eGFiaXYxMjNfX2Z1bmRhbWVudGFsX3R5cGVfaW5mb0UAdgBEbgBiAGMAaABhAHMAdABpAGoAbABtAGYAZABOMTBfX2N4eGFiaXYxMjFfX3ZtaV9jbGFzc190eXBlX2luZm9FAF9fY3hhX2d1YXJkX2FjcXVpcmUgZGV0ZWN0ZWQgcmVjdXJzaXZlIGluaXRpYWxpemF0aW9uAHN0ZDo6YmFkX2Z1bmN0aW9uX2NhbGwATlN0M19fMjE3YmFkX2Z1bmN0aW9uX2NhbGxFAE5TdDNfXzIxNF9fc2hhcmVkX2NvdW50RQBOU3QzX18yMTlfX3NoYXJlZF93ZWFrX2NvdW50RQBtdXRleCBsb2NrIGZhaWxlZABiYXNpY19zdHJpbmcAdW5zcGVjaWZpZWQgZ2VuZXJpY19jYXRlZ29yeSBlcnJvcgBVbmtub3duIGVycm9yICVkAGdlbmVyaWMATlN0M19fMjI0X19nZW5lcmljX2Vycm9yX2NhdGVnb3J5RQBOU3QzX18yMTJfX2RvX21lc3NhZ2VFAE5TdDNfXzIxNGVycm9yX2NhdGVnb3J5RQB1bnNwZWNpZmllZCBzeXN0ZW1fY2F0ZWdvcnkgZXJyb3IAc3lzdGVtAE5TdDNfXzIyM19fc3lzdGVtX2Vycm9yX2NhdGVnb3J5RQBOU3QzX18yMTJzeXN0ZW1fZXJyb3JFADogAHZlY3Rvcg==";var Z={};function J(e){e&&Z[e].refcount++}function Y(e){if(!e||Z[e])return e;for(var t in Z)for(var s=+t,i=Z[s].adjusted,r=i.length,n=0;n<r;n++)if(i[n]===e)return s;return e}function $(e){switch(e){case 1:return 0;case 2:return 1;case 4:return 2;case 8:return 3;default:throw new TypeError("Unknown type size: "+e)}}var q=void 0;function ee(e){for(var t="",s=e;w[s];)t+=q[w[s++]];return t}var te={},se={},ie={};function re(e){if(void 0===e)return"_unknown";var t=(e=e.replace(/[^a-zA-Z0-9_]/g,"$")).charCodeAt(0);return t>=48&&t<=57?"_"+e:e}function ne(e,t){return e=re(e),new Function("body","return function "+e+'() {\n    "use strict";    return body.apply(this, arguments);\n};\n')(t)}function Ae(e,t){var s=ne(t,(function(e){this.name=t,this.message=e;var s=new Error(e).stack;void 0!==s&&(this.stack=this.toString()+"\n"+s.replace(/^Error(:[^\n]*)?\n/,""))}));return s.prototype=Object.create(e.prototype),s.prototype.constructor=s,s.prototype.toString=function(){return void 0===this.message?this.name:this.name+": "+this.message},s}var oe=void 0;function ae(e){throw new oe(e)}var le=void 0;function ce(e){throw new le(e)}function he(e,t,s){function i(t){var i=s(t);i.length!==e.length&&ce("Mismatched type converter count");for(var r=0;r<e.length;++r)ue(e[r],i[r])}e.forEach((function(e){ie[e]=t}));var r=new Array(t.length),n=[],A=0;t.forEach((function(e,t){se.hasOwnProperty(e)?r[t]=se[e]:(n.push(e),te.hasOwnProperty(e)||(te[e]=[]),te[e].push((function(){r[t]=se[e],++A===n.length&&i(r)})))})),0===n.length&&i(r)}function ue(e,t,s){if(s=s||{},!("argPackAdvance"in t))throw new TypeError("registerType registeredInstance requires argPackAdvance");var i=t.name;if(e||ae('type "'+i+'" must have a positive integer typeid pointer'),se.hasOwnProperty(e)){if(s.ignoreDuplicateRegistrations)return;ae("Cannot register type '"+i+"' twice")}if(se[e]=t,delete ie[e],te.hasOwnProperty(e)){var r=te[e];delete te[e],r.forEach((function(e){e()}))}}function de(e){if(!(this instanceof Ee))return!1;if(!(e instanceof Ee))return!1;for(var t=this.$$.ptrType.registeredClass,s=this.$$.ptr,i=e.$$.ptrType.registeredClass,r=e.$$.ptr;t.baseClass;)s=t.upcast(s),t=t.baseClass;for(;i.baseClass;)r=i.upcast(r),i=i.baseClass;return t===i&&s===r}function pe(e){ae(e.$$.ptrType.registeredClass.name+" instance already deleted")}var fe=!1;function ge(e){}function me(e){e.count.value-=1,0===e.count.value&&function(e){e.smartPtr?e.smartPtrType.rawDestructor(e.smartPtr):e.ptrType.registeredClass.rawDestructor(e.ptr)}(e)}function _e(e){return"undefined"==typeof FinalizationGroup?(_e=function(e){return e},e):(fe=new FinalizationGroup((function(e){for(var t=e.next();!t.done;t=e.next()){var s=t.value;s.ptr?me(s):console.warn("object already deleted: "+s.ptr)}})),_e=function(e){return fe.register(e,e.$$,e.$$),e},ge=function(e){fe.unregister(e.$$)},_e(e))}function be(){if(this.$$.ptr||pe(this),this.$$.preservePointerOnDelete)return this.$$.count.value+=1,this;var e,t=_e(Object.create(Object.getPrototypeOf(this),{$$:{value:(e=this.$$,{count:e.count,deleteScheduled:e.deleteScheduled,preservePointerOnDelete:e.preservePointerOnDelete,ptr:e.ptr,ptrType:e.ptrType,smartPtr:e.smartPtr,smartPtrType:e.smartPtrType})}}));return t.$$.count.value+=1,t.$$.deleteScheduled=!1,t}function Be(){this.$$.ptr||pe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ae("Object already scheduled for deletion"),ge(this),me(this.$$),this.$$.preservePointerOnDelete||(this.$$.smartPtr=void 0,this.$$.ptr=void 0)}function ye(){return!this.$$.ptr}var we=void 0,ve=[];function Ce(){for(;ve.length;){var e=ve.pop();e.$$.deleteScheduled=!1,e.delete()}}function Me(){return this.$$.ptr||pe(this),this.$$.deleteScheduled&&!this.$$.preservePointerOnDelete&&ae("Object already scheduled for deletion"),ve.push(this),1===ve.length&&we&&we(Ce),this.$$.deleteScheduled=!0,this}function Ee(){}var Fe={};function xe(e,t,s){if(void 0===e[t].overloadTable){var i=e[t];e[t]=function(){return e[t].overloadTable.hasOwnProperty(arguments.length)||ae("Function '"+s+"' called with an invalid number of arguments ("+arguments.length+") - expects one of ("+e[t].overloadTable+")!"),e[t].overloadTable[arguments.length].apply(this,arguments)},e[t].overloadTable=[],e[t].overloadTable[i.argCount]=i}}function Ue(e,t,s,i,r,n,A,o){this.name=e,this.constructor=t,this.instancePrototype=s,this.rawDestructor=i,this.baseClass=r,this.getActualType=n,this.upcast=A,this.downcast=o,this.pureVirtualFunctions=[]}function Ie(e,t,s){for(;t!==s;)t.upcast||ae("Expected null or instance of "+s.name+", got an instance of "+t.name),e=t.upcast(e),t=t.baseClass;return e}function Te(e,t){if(null===t)return this.isReference&&ae("null is not a valid "+this.name),0;t.$$||ae('Cannot pass "'+At(t)+'" as a '+this.name),t.$$.ptr||ae("Cannot pass deleted object as a pointer of type "+this.name);var s=t.$$.ptrType.registeredClass;return Ie(t.$$.ptr,s,this.registeredClass)}function Pe(e,t){var s;if(null===t)return this.isReference&&ae("null is not a valid "+this.name),this.isSmartPointer?(s=this.rawConstructor(),null!==e&&e.push(this.rawDestructor,s),s):0;t.$$||ae('Cannot pass "'+At(t)+'" as a '+this.name),t.$$.ptr||ae("Cannot pass deleted object as a pointer of type "+this.name),!this.isConst&&t.$$.ptrType.isConst&&ae("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);var i=t.$$.ptrType.registeredClass;if(s=Ie(t.$$.ptr,i,this.registeredClass),this.isSmartPointer)switch(void 0===t.$$.smartPtr&&ae("Passing raw pointer to smart pointer is illegal"),this.sharingPolicy){case 0:t.$$.smartPtrType===this?s=t.$$.smartPtr:ae("Cannot convert argument of type "+(t.$$.smartPtrType?t.$$.smartPtrType.name:t.$$.ptrType.name)+" to parameter type "+this.name);break;case 1:s=t.$$.smartPtr;break;case 2:if(t.$$.smartPtrType===this)s=t.$$.smartPtr;else{var r=t.clone();s=this.rawShare(s,nt((function(){r.delete()}))),null!==e&&e.push(this.rawDestructor,s)}break;default:ae("Unsupporting sharing policy")}return s}function Se(e,t){if(null===t)return this.isReference&&ae("null is not a valid "+this.name),0;t.$$||ae('Cannot pass "'+At(t)+'" as a '+this.name),t.$$.ptr||ae("Cannot pass deleted object as a pointer of type "+this.name),t.$$.ptrType.isConst&&ae("Cannot convert argument of type "+t.$$.ptrType.name+" to parameter type "+this.name);var s=t.$$.ptrType.registeredClass;return Ie(t.$$.ptr,s,this.registeredClass)}function De(e){return this.fromWireType(E[e>>2])}function ke(e){return this.rawGetPointee&&(e=this.rawGetPointee(e)),e}function Qe(e){this.rawDestructor&&this.rawDestructor(e)}function Re(e){null!==e&&e.delete()}function Oe(e,t,s){if(t===s)return e;if(void 0===s.baseClass)return null;var i=Oe(e,t,s.baseClass);return null===i?null:s.downcast(i)}function Ve(){return Object.keys(Ne).length}function Le(){var e=[];for(var t in Ne)Ne.hasOwnProperty(t)&&e.push(Ne[t]);return e}function He(e){we=e,ve.length&&we&&we(Ce)}var Ne={};function Ge(e,t){return t=function(e,t){for(void 0===t&&ae("ptr should not be undefined");e.baseClass;)t=e.upcast(t),e=e.baseClass;return t}(e,t),Ne[t]}function je(e,t){return t.ptrType&&t.ptr||ce("makeClassHandle requires ptr and ptrType"),!!t.smartPtrType!==!!t.smartPtr&&ce("Both smartPtrType and smartPtr must be specified"),t.count={value:1},_e(Object.create(e,{$$:{value:t}}))}function We(e){var t=this.getPointee(e);if(!t)return this.destructor(e),null;var s=Ge(this.registeredClass,t);if(void 0!==s){if(0===s.$$.count.value)return s.$$.ptr=t,s.$$.smartPtr=e,s.clone();var i=s.clone();return this.destructor(e),i}function r(){return this.isSmartPointer?je(this.registeredClass.instancePrototype,{ptrType:this.pointeeType,ptr:t,smartPtrType:this,smartPtr:e}):je(this.registeredClass.instancePrototype,{ptrType:this,ptr:e})}var n,A=this.registeredClass.getActualType(t),o=Fe[A];if(!o)return r.call(this);n=this.isConst?o.constPointerType:o.pointerType;var a=Oe(t,this.registeredClass,n.registeredClass);return null===a?r.call(this):this.isSmartPointer?je(n.registeredClass.instancePrototype,{ptrType:n,ptr:a,smartPtrType:this,smartPtr:e}):je(n.registeredClass.instancePrototype,{ptrType:n,ptr:a})}function ze(e,t,s,i,r,n,A,o,a,l,c){this.name=e,this.registeredClass=t,this.isReference=s,this.isConst=i,this.isSmartPointer=r,this.pointeeType=n,this.sharingPolicy=A,this.rawGetPointee=o,this.rawConstructor=a,this.rawShare=l,this.rawDestructor=c,r||void 0!==t.baseClass?this.toWireType=Pe:i?(this.toWireType=Te,this.destructorFunction=null):(this.toWireType=Se,this.destructorFunction=null)}function Xe(e,s){e=ee(e);var i=function(t){for(var i=[],r=1;r<e.length;++r)i.push("a"+r);var n="return function "+("dynCall_"+e+"_"+s)+"("+i.join(", ")+") {\n";return n+="    return dynCall(rawFunction"+(i.length?", ":"")+i.join(", ")+");\n",n+="};\n",new Function("dynCall","rawFunction",n)(t,s)}(t["dynCall_"+e]);return"function"!=typeof i&&ae("unknown function pointer with signature "+e+": "+s),i}var Ke=void 0;function Ze(e){var t=ft(e),s=ee(t);return gt(t),s}function Je(e,t){var s=[],i={};throw t.forEach((function e(t){i[t]||se[t]||(ie[t]?ie[t].forEach(e):(s.push(t),i[t]=!0))})),new Ke(e+": "+s.map(Ze).join([", "]))}function Ye(e,t){for(var s=[],i=0;i<e;i++)s.push(M[(t>>2)+i]);return s}function $e(e){for(;e.length;){var t=e.pop();e.pop()(t)}}function qe(e,t,s,i,r){var n=t.length;n<2&&ae("argTypes array size mismatch! Must at least get return value and 'this' types!");for(var A=null!==t[1]&&null!==s,o=!1,a=1;a<t.length;++a)if(null!==t[a]&&void 0===t[a].destructorFunction){o=!0;break}var l="void"!==t[0].name,c="",h="";for(a=0;a<n-2;++a)c+=(0!==a?", ":"")+"arg"+a,h+=(0!==a?", ":"")+"arg"+a+"Wired";var u="return function "+re(e)+"("+c+") {\nif (arguments.length !== "+(n-2)+") {\nthrowBindingError('function "+e+" called with ' + arguments.length + ' arguments, expected "+(n-2)+" args!');\n}\n";o&&(u+="var destructors = [];\n");var d=o?"destructors":"null",p=["throwBindingError","invoker","fn","runDestructors","retType","classParam"],f=[ae,i,r,$e,t[0],t[1]];A&&(u+="var thisWired = classParam.toWireType("+d+", this);\n");for(a=0;a<n-2;++a)u+="var arg"+a+"Wired = argType"+a+".toWireType("+d+", arg"+a+"); // "+t[a+2].name+"\n",p.push("argType"+a),f.push(t[a+2]);if(A&&(h="thisWired"+(h.length>0?", ":"")+h),u+=(l?"var rv = ":"")+"invoker(fn"+(h.length>0?", ":"")+h+");\n",o)u+="runDestructors(destructors);\n";else for(a=A?1:2;a<t.length;++a){var g=1===a?"thisWired":"arg"+(a-2)+"Wired";null!==t[a].destructorFunction&&(u+=g+"_dtor("+g+"); // "+t[a].name+"\n",p.push(g+"_dtor"),f.push(t[a].destructorFunction))}return l&&(u+="var ret = retType.fromWireType(rv);\nreturn ret;\n"),u+="}\n",p.push(u),function(e,t){if(!(e instanceof Function))throw new TypeError("new_ called with constructor type "+typeof e+" which is not a function");var s=ne(e.name||"unknownFunctionName",(function(){}));s.prototype=e.prototype;var i=new s,r=e.apply(i,t);return r instanceof Object?r:i}(Function,p).apply(null,f)}var et=[],tt=[{},{value:void 0},{value:null},{value:!0},{value:!1}];function st(e){e>4&&0==--tt[e].refcount&&(tt[e]=void 0,et.push(e))}function it(){for(var e=0,t=5;t<tt.length;++t)void 0!==tt[t]&&++e;return e}function rt(){for(var e=5;e<tt.length;++e)if(void 0!==tt[e])return tt[e];return null}function nt(e){switch(e){case void 0:return 1;case null:return 2;case!0:return 3;case!1:return 4;default:var t=et.length?et.pop():tt.length;return tt[t]={refcount:1,value:e},t}}function At(e){if(null===e)return"null";var t=typeof e;return"object"===t||"array"===t||"function"===t?e.toString():""+e}function ot(e,t){switch(t){case 2:return function(e){return this.fromWireType(F[e>>2])};case 3:return function(e){return this.fromWireType(x[e>>3])};default:throw new TypeError("Unknown float type: "+e)}}function at(e,t,s){switch(t){case 0:return s?function(e){return y[e]}:function(e){return w[e]};case 1:return s?function(e){return v[e>>1]}:function(e){return C[e>>1]};case 2:return s?function(e){return M[e>>2]}:function(e){return E[e>>2]};default:throw new TypeError("Unknown integer type: "+e)}}function lt(e){for(var t=[],s=0;s<e.length;s++){var i=e[s];i>255&&(i&=255),t.push(String.fromCharCode(i))}return t.join("")}!function(){for(var e=new Array(256),t=0;t<256;++t)e[t]=String.fromCharCode(t);q=e}(),oe=t.BindingError=Ae(Error,"BindingError"),le=t.InternalError=Ae(Error,"InternalError"),Ee.prototype.isAliasOf=de,Ee.prototype.clone=be,Ee.prototype.delete=Be,Ee.prototype.isDeleted=ye,Ee.prototype.deleteLater=Me,ze.prototype.getPointee=ke,ze.prototype.destructor=Qe,ze.prototype.argPackAdvance=8,ze.prototype.readValueFromPointer=De,ze.prototype.deleteObject=Re,ze.prototype.fromWireType=We,t.getInheritedInstanceCount=Ve,t.getLiveInheritedInstances=Le,t.flushPendingDeletes=Ce,t.setDelayFunction=He,Ke=t.UnboundTypeError=Ae(Error,"UnboundTypeError"),t.count_emval_handles=it,t.get_first_emval=rt;var ct="function"==typeof atob?atob:function(e){var t,s,i,r,n,A,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="",l=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{t=o.indexOf(e.charAt(l++))<<2|(r=o.indexOf(e.charAt(l++)))>>4,s=(15&r)<<4|(n=o.indexOf(e.charAt(l++)))>>2,i=(3&n)<<6|(A=o.indexOf(e.charAt(l++))),a+=String.fromCharCode(t),64!==n&&(a+=String.fromCharCode(s)),64!==A&&(a+=String.fromCharCode(i))}while(l<e.length);return a};function ht(e){if(K(e))return function(e){if("boolean"==typeof n&&n){var t;try{t=Buffer.from(e,"base64")}catch(s){t=new Buffer(e,"base64")}return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}try{for(var s=ct(e),i=new Uint8Array(s.length),r=0;r<s.length;++r)i[r]=s.charCodeAt(r);return i}catch(e){throw new Error("Converting base64 string to bytes failed.")}}(e.slice(X.length))}var ut={A:function(e,t,s){w.copyWithin(e,t,t+s)},B:function(e){W("OOM")},C:function(){W("trap!")},D:22368,a:W,b:function(e){f=e},c:function(){return f},d:function(e){return mt(e)},e:function(e){var t=Z[e];return t&&!t.caught&&(t.caught=!0,pt.uncaught_exceptions--),t&&(t.rethrown=!1),J(Y(e)),e},f:function(e,t,s){throw Z[e]={ptr:e,adjusted:[e],type:t,destructor:s,refcount:0,caught:!1,rethrown:!1},"uncaught_exception"in pt?pt.uncaught_exceptions++:pt.uncaught_exceptions=1,e},g:function(){return pt.uncaught_exceptions},h:J,i:Y,j:function(){},k:function(e,t,s,i,r){var n=$(s);ue(e,{name:t=ee(t),fromWireType:function(e){return!!e},toWireType:function(e,t){return t?i:r},argPackAdvance:8,readValueFromPointer:function(e){var i;if(1===s)i=y;else if(2===s)i=v;else{if(4!==s)throw new TypeError("Unknown boolean type size: "+t);i=M}return this.fromWireType(i[e>>n])},destructorFunction:null})},l:function(e,s,i,r,n,A,o,a,l,c,h,u,d){h=ee(h),A=Xe(n,A),a&&(a=Xe(o,a)),c&&(c=Xe(l,c)),d=Xe(u,d);var p=re(h);!function(e,s,i){t.hasOwnProperty(e)?((void 0===i||void 0!==t[e].overloadTable&&void 0!==t[e].overloadTable[i])&&ae("Cannot register public name '"+e+"' twice"),xe(t,e,e),t.hasOwnProperty(i)&&ae("Cannot register multiple overloads of a function with the same number of arguments ("+i+")!"),t[e].overloadTable[i]=s):(t[e]=s,void 0!==i&&(t[e].numArguments=i))}(p,(function(){Je("Cannot construct "+h+" due to unbound types",[r])})),he([e,s,i],r?[r]:[],(function(s){var i,n;s=s[0],n=r?(i=s.registeredClass).instancePrototype:Ee.prototype;var o=ne(p,(function(){if(Object.getPrototypeOf(this)!==l)throw new oe("Use 'new' to construct "+h);if(void 0===u.constructor_body)throw new oe(h+" has no accessible constructor");var e=u.constructor_body[arguments.length];if(void 0===e)throw new oe("Tried to invoke ctor of "+h+" with invalid number of parameters ("+arguments.length+") - expected ("+Object.keys(u.constructor_body).toString()+") parameters instead!");return e.apply(this,arguments)})),l=Object.create(n,{constructor:{value:o}});o.prototype=l;var u=new Ue(h,o,l,d,i,A,a,c),f=new ze(h,u,!0,!1,!1),g=new ze(h+"*",u,!1,!1,!1),m=new ze(h+" const*",u,!1,!0,!1);return Fe[e]={pointerType:g,constPointerType:m},function(e,s,i){t.hasOwnProperty(e)||ce("Replacing nonexistant public symbol"),void 0!==t[e].overloadTable&&void 0!==i?t[e].overloadTable[i]=s:(t[e]=s,t[e].argCount=i)}(p,o),[f,g,m]}))},m:function(e,t,s,i,r,n){m(t>0);var A=Ye(t,s);r=Xe(i,r);var o=[n],a=[];he([],[e],(function(e){var s="constructor "+(e=e[0]).name;if(void 0===e.registeredClass.constructor_body&&(e.registeredClass.constructor_body=[]),void 0!==e.registeredClass.constructor_body[t-1])throw new oe("Cannot register multiple constructors with identical number of parameters ("+(t-1)+") for class '"+e.name+"'! Overload resolution is currently only performed using the parameter count, not actual type info!");return e.registeredClass.constructor_body[t-1]=function(){Je("Cannot construct "+e.name+" due to unbound types",A)},he([],A,(function(i){return e.registeredClass.constructor_body[t-1]=function(){arguments.length!==t-1&&ae(s+" called with "+arguments.length+" arguments, expected "+(t-1)),a.length=0,o.length=t;for(var e=1;e<t;++e)o[e]=i[e].toWireType(a,arguments[e-1]);var n=r.apply(null,o);return $e(a),i[0].fromWireType(n)},[]})),[]}))},n:function(e,t,s,i,r,n,A,o){var a=Ye(s,i);t=ee(t),n=Xe(r,n),he([],[e],(function(e){var i=(e=e[0]).name+"."+t;function r(){Je("Cannot call "+i+" due to unbound types",a)}o&&e.registeredClass.pureVirtualFunctions.push(t);var l=e.registeredClass.instancePrototype,c=l[t];return void 0===c||void 0===c.overloadTable&&c.className!==e.name&&c.argCount===s-2?(r.argCount=s-2,r.className=e.name,l[t]=r):(xe(l,t,i),l[t].overloadTable[s-2]=r),he([],a,(function(r){var o=qe(i,r,e,n,A);return void 0===l[t].overloadTable?(o.argCount=s-2,l[t]=o):l[t].overloadTable[s-2]=o,[]})),[]}))},o:function(e,t){ue(e,{name:t=ee(t),fromWireType:function(e){var t=tt[e].value;return st(e),t},toWireType:function(e,t){return nt(t)},argPackAdvance:8,readValueFromPointer:De,destructorFunction:null})},p:function(e,t,s){var i=$(s);ue(e,{name:t=ee(t),fromWireType:function(e){return e},toWireType:function(e,t){if("number"!=typeof t&&"boolean"!=typeof t)throw new TypeError('Cannot convert "'+At(t)+'" to '+this.name);return t},argPackAdvance:8,readValueFromPointer:ot(t,i),destructorFunction:null})},q:function(e,t,s,i,r){t=ee(t),-1===r&&(r=4294967295);var n=$(s),A=function(e){return e};if(0===i){var o=32-8*s;A=function(e){return e<<o>>>o}}var a=-1!=t.indexOf("unsigned");ue(e,{name:t,fromWireType:A,toWireType:function(e,s){if("number"!=typeof s&&"boolean"!=typeof s)throw new TypeError('Cannot convert "'+At(s)+'" to '+this.name);if(s<i||s>r)throw new TypeError('Passing a number "'+At(s)+'" from JS side to C/C++ side to an argument of type "'+t+'", which is outside the valid range ['+i+", "+r+"]!");return a?s>>>0:0|s},argPackAdvance:8,readValueFromPointer:at(t,n,0!==i),destructorFunction:null})},r:function(e,t,s){var i=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array][t];function r(e){var t=E,s=t[e>>=2],r=t[e+1];return new i(B,r,s)}ue(e,{name:s=ee(s),fromWireType:r,argPackAdvance:8,readValueFromPointer:r},{ignoreDuplicateRegistrations:!0})},s:function(e,t){var s="std::string"===(t=ee(t));ue(e,{name:t,fromWireType:function(e){var t,i=E[e>>2];if(s)for(var r=e+4,n=0;n<=i;++n){var A=e+4+n;if(0==w[A]||n==i){var o=b(r,A-r);void 0===t?t=o:(t+=String.fromCharCode(0),t+=o),r=A+1}}else{var a=new Array(i);for(n=0;n<i;++n)a[n]=String.fromCharCode(w[e+4+n]);t=a.join("")}return gt(e),t},toWireType:function(e,t){var i;t instanceof ArrayBuffer&&(t=new Uint8Array(t));var r="string"==typeof t;r||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int8Array||ae("Cannot pass non-string to std::string"),i=s&&r?function(){return function(e){for(var t=0,s=0;s<e.length;++s){var i=e.charCodeAt(s);i>=55296&&i<=57343&&(i=65536+((1023&i)<<10)|1023&e.charCodeAt(++s)),i<=127?++t:t+=i<=2047?2:i<=65535?3:4}return t}(t)}:function(){return t.length};var n=i(),A=mt(4+n+1);if(E[A>>2]=n,s&&r)(function(e,t,s,i){if(!(i>0))return 0;for(var r=s,n=s+i-1,A=0;A<e.length;++A){var o=e.charCodeAt(A);if(o>=55296&&o<=57343&&(o=65536+((1023&o)<<10)|1023&e.charCodeAt(++A)),o<=127){if(s>=n)break;t[s++]=o}else if(o<=2047){if(s+1>=n)break;t[s++]=192|o>>6,t[s++]=128|63&o}else if(o<=65535){if(s+2>=n)break;t[s++]=224|o>>12,t[s++]=128|o>>6&63,t[s++]=128|63&o}else{if(s+3>=n)break;t[s++]=240|o>>18,t[s++]=128|o>>12&63,t[s++]=128|o>>6&63,t[s++]=128|63&o}}t[s]=0})(t,w,A+4,n+1);else if(r)for(var o=0;o<n;++o){var a=t.charCodeAt(o);a>255&&(gt(A),ae("String has UTF-16 code units that do not fit in 8 bits")),w[A+4+o]=a}else for(o=0;o<n;++o)w[A+4+o]=t[o];return null!==e&&e.push(gt,A),A},argPackAdvance:8,readValueFromPointer:De,destructorFunction:function(e){gt(e)}})},t:function(e,t,s){var i,r,n,A,o;s=ee(s),2===t?(i=I,r=T,A=P,n=function(){return C},o=1):4===t&&(i=S,r=D,A=k,n=function(){return E},o=2),ue(e,{name:s,fromWireType:function(e){for(var s,r=E[e>>2],A=n(),a=e+4,l=0;l<=r;++l){var c=e+4+l*t;if(0==A[c>>o]||l==r){var h=i(a,c-a);void 0===s?s=h:(s+=String.fromCharCode(0),s+=h),a=c+t}}return gt(e),s},toWireType:function(e,i){"string"!=typeof i&&ae("Cannot pass non-string to C++ string type "+s);var n=A(i),a=mt(4+n+t);return E[a>>2]=n>>o,r(i,a+4,n+t),null!==e&&e.push(gt,a),a},argPackAdvance:8,readValueFromPointer:De,destructorFunction:function(e){gt(e)}})},u:function(e,t){ue(e,{isVoid:!0,name:t=ee(t),argPackAdvance:0,fromWireType:function(){},toWireType:function(e,t){}})},v:st,w:nt,x:function(){W()},y:At,z:function(){return w.length}},dt=function(e,t,s){"use asm";var i=new e.Int8Array(s),r=new e.Int16Array(s),n=new e.Int32Array(s),A=new e.Uint8Array(s),o=new e.Uint16Array(s),a=new e.Float32Array(s),l=new e.Float64Array(s),c=t.D|0,h=0,u=0,d=0,p=0,f=0,g=0,m=0,_=0.0,b=e.Math.imul,B=e.Math.clz32,y=t.a,w=t.b,v=t.c,C=t.d,M=t.e,E=t.f,F=t.g,x=t.h,U=t.i,I=t.j,T=t.k,P=t.l,S=t.m,D=t.n,k=t.o,Q=t.p,R=t.q,O=t.r,V=t.s,L=t.t,H=t.u,N=t.v,G=t.w,j=t.x,W=t.y,z=t.z,X=t.A,K=t.B,Z=t.C,J=22384,Y=5265264,$=0.0;function q(){Jh();Yh()}function ee(){te(0);return}function te(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0;e=J;J=J+16|0;t=e+8|0;s=e;dc();u=fc()|0;A=gc()|0;r=_c()|0;o=bc()|0;a=Bc()|0;l=yc()|0;c=Fc()|0;h=xc()|0;i=xc()|0;P(r|0,o|0,a|0,l|0,c|0,9,h|0,u|0,i|0,A|0,6204,Uc()|0,138);Tc(1);n[s>>2]=5;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];Oc(6211,t);n[s>>2]=3;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];Kc(6216,t);n[s>>2]=10;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];sh(6225,t);ch();A=uh()|0;i=dh()|0;u=fh()|0;h=gh()|0;c=mh()|0;l=yc()|0;a=Fc()|0;o=xc()|0;r=xc()|0;P(u|0,h|0,c|0,l|0,a|0,11,o|0,A|0,r|0,i|0,6234,Uc()|0,139);Ch(2);n[s>>2]=6;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];Th(6211,t);n[s>>2]=4;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];Oh(6248,t);n[s>>2]=5;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];Oh(6265,t);n[s>>2]=6;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];Oh(6280,t);n[s>>2]=7;n[s+4>>2]=0;n[t>>2]=n[s>>2];n[t+4>>2]=n[s+4>>2];jh(6216,t);J=e;return}function se(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0,a=0;i=J;J=J+32|0;o=i+16|0;r=i+8|0;a=i;A=Zf(20)|0;ce(A,t,s);n[a>>2]=0;n[o>>2]=n[a>>2];ue(r,A,o);t=n[r>>2]|0;n[r>>2]=n[e>>2];n[e>>2]=t;t=r+4|0;s=e+4|0;A=n[t>>2]|0;n[t>>2]=n[s>>2];n[s>>2]=A;de(r);s=Zf(352)|0;he(s,n[e>>2]|0);A=e+8|0;n[a>>2]=0;n[o>>2]=n[a>>2];we(r,s,o);s=n[r>>2]|0;n[r>>2]=n[A>>2];n[A>>2]=s;A=r+4|0;s=e+12|0;t=n[A>>2]|0;n[A>>2]=n[s>>2];n[s>>2]=t;ve(r);J=i;return}function ie(e,t){e=e|0;t=t|0;Ks(n[e+8>>2]|0,t);return}function re(e){e=e|0;e=(Do(n[e+8>>2]|0)|0)+107|0;return A[e>>0]|A[e+1>>0]<<8|A[e+2>>0]<<16|A[e+3>>0]<<24|0}function ne(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0,a=0;i=J;J=J+32|0;A=i+16|0;r=i+8|0;o=i;a=Zf(12)|0;ko(a,t,s);n[o>>2]=0;n[A>>2]=n[o>>2];Vo(r,a,A);a=n[r>>2]|0;n[r>>2]=n[e>>2];n[e>>2]=a;a=r+4|0;s=e+4|0;t=n[a>>2]|0;n[a>>2]=n[s>>2];n[s>>2]=t;Lo(r);s=e+8|0;t=Zf(12)|0;Qo(t,n[e>>2]|0);n[o>>2]=0;n[A>>2]=n[o>>2];zo(r,t,A);t=n[r>>2]|0;n[r>>2]=n[s>>2];n[s>>2]=t;t=r+4|0;o=e+12|0;a=n[t>>2]|0;n[t>>2]=n[o>>2];n[o>>2]=a;Xo(r);Ro(r,n[s>>2]|0);s=e+16|0;o=n[r>>2]|0;a=r+4|0;t=n[a>>2]|0;n[r>>2]=0;n[a>>2]=0;n[A>>2]=n[s>>2];n[s>>2]=o;s=e+20|0;n[A+4>>2]=n[s>>2];n[s>>2]=t;Oo(A);Oo(r);J=i;return}function Ae(e,t){e=e|0;t=t|0;var s=0;e=e+16|0;s=n[e>>2]|0;e:do{if(s|0)switch(t|0){case 4:{ua(s);break e}case 8:{da(s);da(n[e>>2]|0);break e}default:break e}}while(0);return}function oe(e,t){e=e|0;t=t|0;var s=0;s=e+16|0;e=n[s>>2]|0;e:do{if(e|0){switch(t|0){case 1:{qa(e);break e}case 2:{el(e);break e}case 8:{ua(e);e=n[s>>2]|0;break}case 4:break;default:break e}ua(e)}}while(0);return}function ae(e,t){e=e|0;t=t|0;var s=0;s=e+16|0;e=n[s>>2]|0;e:do{if(e|0){switch(t|0){case 1:{kl(e);break e}case 2:{Ql(e);break e}case 8:{da(e);e=n[s>>2]|0;break}case 4:break;default:break e}da(e)}}while(0);return}function le(e,t){e=e|0;t=t|0;e=n[e+16>>2]|0;if(e|0)Hm[n[n[e>>2]>>2]&63](e,t)|0;return}function ce(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;n[e+4>>2]=s;n[e+8>>2]=0;i[e+12>>0]=0;i[e+13>>0]=0;n[e+16>>2]=0;return}function he(e,t){e=e|0;t=t|0;n[e>>2]=t;Oe(e+4|0,t);Ve(e+247|0);n[e+288>>2]=0;n[e+292>>2]=0;n[e+296>>2]=0;Le(e+300|0);t=e+312|0;n[t>>2]=0;n[t+4>>2]=0;n[t+8>>2]=0;n[t+12>>2]=0;He(e+328|0);Ne(e);return}function ue(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4296;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;pe(e,i);J=s;return}function de(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function pe(e,t){e=e|0;t=t|0;return}function fe(e){e=e|0;M(e|0)|0;tf()}function ge(e){e=e|0;Ag(e);qp(e);return}function me(e){e=e|0;e=n[e+12>>2]|0;if(e|0)qp(e);return}function _e(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==6407?e+12|0:0)|0}function be(e){e=e|0;Be(e,16);return}function Be(e,t){e=e|0;t=t|0;ye(e);return}function ye(e){e=e|0;qp(e);return}function we(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4324;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Ce(e,i);J=s;return}function ve(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Ce(e,t){e=e|0;t=t|0;return}function Me(e){e=e|0;Ag(e);qp(e);return}function Ee(e){e=e|0;e=n[e+12>>2]|0;if(e|0){Ue(e);qp(e)}return}function Fe(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==6605?e+12|0:0)|0}function xe(e){e=e|0;Be(e,16);return}function Ue(e){e=e|0;Ie(e+320|0);Te(e+312|0);Pe(e+300|0);Qe(e+288|0);Se(e+247|0);De(e+4|0);return}function Ie(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Te(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Pe(e){e=e|0;ke(e);return}function Se(e){e=e|0;e=e+34|0;e=A[e>>0]|A[e+1>>0]<<8|A[e+2>>0]<<16|A[e+3>>0]<<24;if(e|0)Yf(e);return}function De(e){e=e|0;Re(n[e+12>>2]|0);return}function ke(e){e=e|0;var t=0,s=0;t=n[e>>2]|0;s=t;if(t|0){n[e+4>>2]=s;Be(t,(n[e+8>>2]|0)-s|0)}return}function Qe(e){e=e|0;var t=0,s=0;t=n[e>>2]|0;s=t;if(t|0){n[e+4>>2]=s;Be(t,(n[e+8>>2]|0)-s|0)}return}function Re(e){e=e|0;Zg(n[e+-4>>2]|0);return}function Oe(e,t){e=e|0;t=t|0;n[e>>2]=t;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=Ge(1048576)|0;return}function Ve(e){e=e|0;var t=0;t=e+32|0;i[t>>0]=0;i[t+1>>0]=0;e=e+34|0;i[e>>0]=0;i[e+1>>0]=0;i[e+2>>0]=0;i[e+3>>0]=0;return}function Le(e){e=e|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;return}function He(e){e=e|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=0;e=e+16|0;n[e>>2]=-1;n[e+4>>2]=-1;return}function Ne(e){e=e|0;var t=0,s=0,r=0,A=0,o=0,a=0;a=J;J=J+64|0;A=a+32|0;s=a+56|0;t=a+16|0;o=a;je(n[e>>2]|0,s,4);it(A,s,s+4|0);s=st(6693)|0;r=i[A+11>>0]|0;if((s|0)==((r<<24>>24<0?n[A+4>>2]|0:r&255)|0)){r=(Cg(A,0,-1,6693,s)|0)==0;bg(A);if(r){s=n[e>>2]|0;n[t>>2]=0;n[t+4>>2]=0;n[t+8>>2]=0;n[t+12>>2]=0;n[A>>2]=n[t>>2];n[A+4>>2]=n[t+4>>2];n[A+8>>2]=n[t+8>>2];n[A+12>>2]=n[t+12>>2];ze(s,A);s=e+20|0;je(n[e>>2]|0,s,227);Xe(e,s);r=Ke()|0;t=n[r>>2]|0;r=n[r+4>>2]|0;if((t|0)!=(r|0))do{Ze(A,t);Je(A,s);Ye(A);t=t+24|0}while((t|0)!=(r|0));$e(e);qe(e);et(n[e>>2]|0);r=n[e>>2]|0;t=(n[e+116>>2]|0)+8|0;s=o;n[s>>2]=0;n[s+4>>2]=0;s=o+8|0;n[s>>2]=t;n[s+4>>2]=0;n[A>>2]=n[o>>2];n[A+4>>2]=n[o+4>>2];n[A+8>>2]=n[o+8>>2];n[A+12>>2]=n[o+12>>2];ze(r,A);tt(e+4|0);J=a;return}}else bg(A);a=C(8)|0;We(a);E(a|0,2592,8)}function Ge(e){e=e|0;var t=0;t=Kg(e+68|0)|0;e=t+68&-64;n[e+-4>>2]=t;return e|0}function je(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0,l=0,c=0;a=e+13|0;if(!(i[a>>0]|0)){o=e+4|0;r=n[o>>2]|0;l=e+8|0;A=n[l>>2]|0;c=r-A|0;s=(c|0)<(s|0)?c:s;if(s){um(t|0,(n[e>>2]|0)+A|0,s|0)|0;A=n[l>>2]|0;r=n[o>>2]|0}c=A+s|0;n[l>>2]=c;n[e+16>>2]=s;if((c|0)>=(r|0))i[a>>0]=1}else i[e+12>>0]=1;return}function We(e){e=e|0;pg(e,6791);n[e>>2]=4352;return}function ze(e,t){e=e|0;t=t|0;var s=0,r=0,A=0;A=t+8|0;t=n[A>>2]|0;A=n[A+4>>2]|0;s=n[e+4>>2]|0;r=((s|0)<0)<<31>>31;if((A|0)<(r|0)|(A|0)==(r|0)&t>>>0<s>>>0)n[e+8>>2]=t;else i[e+12>>0]=1;return}function Xe(e,t){e=e|0;t=t|0;var s=0.0,r=0.0,n=0,A=0.0,o=0,a=0.0,h=0,u=0.0,d=0,p=0.0;d=t+179|0;i[c>>0]=i[d>>0];i[c+1>>0]=i[d+1>>0];i[c+2>>0]=i[d+2>>0];i[c+3>>0]=i[d+3>>0];i[c+4>>0]=i[d+4>>0];i[c+5>>0]=i[d+5>>0];i[c+6>>0]=i[d+6>>0];i[c+7>>0]=i[d+7>>0];u=+l[c>>3];o=t+187|0;i[c>>0]=i[o>>0];i[c+1>>0]=i[o+1>>0];i[c+2>>0]=i[o+2>>0];i[c+3>>0]=i[o+3>>0];i[c+4>>0]=i[o+4>>0];i[c+5>>0]=i[o+5>>0];i[c+6>>0]=i[o+6>>0];i[c+7>>0]=i[o+7>>0];p=+l[c>>3];e=t+195|0;i[c>>0]=i[e>>0];i[c+1>>0]=i[e+1>>0];i[c+2>>0]=i[e+2>>0];i[c+3>>0]=i[e+3>>0];i[c+4>>0]=i[e+4>>0];i[c+5>>0]=i[e+5>>0];i[c+6>>0]=i[e+6>>0];i[c+7>>0]=i[e+7>>0];A=+l[c>>3];h=t+203|0;i[c>>0]=i[h>>0];i[c+1>>0]=i[h+1>>0];i[c+2>>0]=i[h+2>>0];i[c+3>>0]=i[h+3>>0];i[c+4>>0]=i[h+4>>0];i[c+5>>0]=i[h+5>>0];i[c+6>>0]=i[h+6>>0];i[c+7>>0]=i[h+7>>0];a=+l[c>>3];n=t+211|0;i[c>>0]=i[n>>0];i[c+1>>0]=i[n+1>>0];i[c+2>>0]=i[n+2>>0];i[c+3>>0]=i[n+3>>0];i[c+4>>0]=i[n+4>>0];i[c+5>>0]=i[n+5>>0];i[c+6>>0]=i[n+6>>0];i[c+7>>0]=i[n+7>>0];s=+l[c>>3];t=t+219|0;i[c>>0]=i[t>>0];i[c+1>>0]=i[t+1>>0];i[c+2>>0]=i[t+2>>0];i[c+3>>0]=i[t+3>>0];i[c+4>>0]=i[t+4>>0];i[c+5>>0]=i[t+5>>0];i[c+6>>0]=i[t+6>>0];i[c+7>>0]=i[t+7>>0];r=+l[c>>3];l[c>>3]=p;i[d>>0]=i[c>>0];i[d+1>>0]=i[c+1>>0];i[d+2>>0]=i[c+2>>0];i[d+3>>0]=i[c+3>>0];i[d+4>>0]=i[c+4>>0];i[d+5>>0]=i[c+5>>0];i[d+6>>0]=i[c+6>>0];i[d+7>>0]=i[c+7>>0];l[c>>3]=u;i[h>>0]=i[c>>0];i[h+1>>0]=i[c+1>>0];i[h+2>>0]=i[c+2>>0];i[h+3>>0]=i[c+3>>0];i[h+4>>0]=i[c+4>>0];i[h+5>>0]=i[c+5>>0];i[h+6>>0]=i[c+6>>0];i[h+7>>0]=i[c+7>>0];l[c>>3]=a;i[o>>0]=i[c>>0];i[o+1>>0]=i[c+1>>0];i[o+2>>0]=i[c+2>>0];i[o+3>>0]=i[c+3>>0];i[o+4>>0]=i[c+4>>0];i[o+5>>0]=i[c+5>>0];i[o+6>>0]=i[c+6>>0];i[o+7>>0]=i[c+7>>0];l[c>>3]=A;i[n>>0]=i[c>>0];i[n+1>>0]=i[c+1>>0];i[n+2>>0]=i[c+2>>0];i[n+3>>0]=i[c+3>>0];i[n+4>>0]=i[c+4>>0];i[n+5>>0]=i[c+5>>0];i[n+6>>0]=i[c+6>>0];i[n+7>>0]=i[c+7>>0];l[c>>3]=r;i[e>>0]=i[c>>0];i[e+1>>0]=i[c+1>>0];i[e+2>>0]=i[c+2>>0];i[e+3>>0]=i[c+3>>0];i[e+4>>0]=i[c+4>>0];i[e+5>>0]=i[c+5>>0];i[e+6>>0]=i[c+6>>0];i[e+7>>0]=i[c+7>>0];l[c>>3]=s;i[t>>0]=i[c>>0];i[t+1>>0]=i[c+1>>0];i[t+2>>0]=i[c+2>>0];i[t+3>>0]=i[c+3>>0];i[t+4>>0]=i[c+4>>0];i[t+5>>0]=i[c+5>>0];i[t+6>>0]=i[c+6>>0];i[t+7>>0]=i[c+7>>0];return}function Ke(){var e=0,t=0,s=0,r=0,A=0,o=0,a=0,l=0;A=J;J=J+48|0;s=A+24|0;r=A;e=A+44|0;if((i[21440]|0)==0?Qf(21440)|0:0){n[5374]=0;n[5375]=0;n[5376]=0;jf(21440)}if((i[21448]|0)==0?Qf(21448)|0:0)jf(21448);if((n[5374]|0)==(n[5375]|0)){ag(21508);if((n[5374]|0)==(n[5375]|0)){i[s>>0]=i[e>>0]|0;At(r,s);e=n[5375]|0;do{if(e>>>0>=(n[5376]|0)>>>0){e=((e-(n[5374]|0)|0)/24|0)+1|0;t=pt(21496)|0;if(t>>>0<e>>>0)Xg(21496);else{o=n[5374]|0;l=((n[5376]|0)-o|0)/24|0;a=l<<1;ht(s,l>>>0<t>>>1>>>0?a>>>0<e>>>0?e:a:t,((n[5375]|0)-o|0)/24|0,21504);t=s+8|0;lt(n[t>>2]|0,r);n[t>>2]=(n[t>>2]|0)+24;ut(21496,s);dt(s);break}}else{ot(s,21496,1);l=s+4|0;lt(n[l>>2]|0,r);n[l>>2]=(n[l>>2]|0)+24;at(s)}}while(0);Ye(r)}lg(21508)}J=A;return 21496}function Ze(e,t){e=e|0;t=t|0;var s=0,i=0;s=t+16|0;i=n[s>>2]|0;do{if(i)if((t|0)==(i|0)){i=ct(e)|0;n[e+16>>2]=i;s=n[s>>2]|0;Wm[n[(n[s>>2]|0)+12>>2]&15](s,i);break}else{n[e+16>>2]=Vm[n[(n[i>>2]|0)+8>>2]&15](i)|0;break}else n[e+16>>2]=0}while(0);return}function Je(e,t){e=e|0;t=t|0;e=n[e+16>>2]|0;if(!e){t=C(4)|0;n[t>>2]=0;It(t);E(t|0,4168,131)}else{Wm[n[(n[e>>2]|0)+24>>2]&15](e,t);return}}function Ye(e){e=e|0;var t=0;t=n[e+16>>2]|0;if((e|0)!=(t|0)){if(t|0)jm[n[(n[t>>2]|0)+20>>2]&255](t)}else jm[n[(n[t>>2]|0)+16>>2]&255](t);return}function $e(e){e=e|0;var t=0,s=0,r=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;g=J;J=J+96|0;a=g+16|0;p=g;h=g+72|0;l=n[e>>2]|0;u=o[e+114>>1]|0;d=p;n[d>>2]=0;n[d+4>>2]=0;d=p+8|0;n[d>>2]=u;n[d+4>>2]=0;n[a>>2]=n[p>>2];n[a+4>>2]=n[p+4>>2];n[a+8>>2]=n[p+8>>2];n[a+12>>2]=n[p+12>>2];ze(l,a);l=e+120|0;e:do{if(n[l>>2]|0){c=a+2|0;u=a+16|0;d=a+20|0;p=a+18|0;s=0;while(1){if(!(Tt(n[e>>2]|0)|0))break e;if(Pt(n[e>>2]|0)|0)break e;je(n[e>>2]|0,a,54);t=7277;r=c;while(1){if((i[r>>0]|0)!=(i[t>>0]|0))break;r=r+1|0;if((r|0)==(u|0)){f=8;break}else t=t+1|0}if((f|0)==8?(f=0,(A[p>>0]|A[p+1>>0]<<8)<<16>>16==22204):0)break;Dt(n[e>>2]|0,(A[d>>0]|A[d+1>>0]<<8)&65535,0,1);s=s+1|0;if(s>>>0>=(n[l>>2]|0)>>>0)break e}p=(A[d>>0]|A[d+1>>0]<<8)&65535;f=Jf(p)|0;je(n[e>>2]|0,f,p);St(e,f);qp(f);f=e+125|0;Qt(h,e+247|0,(A[f>>0]|A[f+1>>0]<<8)&65535);Rt(e+300|0,h)|0;Pe(h);J=g;return}}while(0);g=C(8)|0;kt(g);E(g|0,2672,8)}function qe(e){e=e|0;var t=0,s=0,i=0,r=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;d=J;J=J+176|0;r=d+40|0;o=d+24|0;t=d+16|0;i=d;c=d+152|0;h=d+136|0;u=d+56|0;l=n[e>>2]|0;a=e+116|0;p=n[a>>2]|0;s=o;n[s>>2]=0;n[s+4>>2]=0;s=o+8|0;n[s>>2]=p;n[s+4>>2]=0;n[r>>2]=n[o>>2];n[r+4>>2]=n[o+4>>2];n[r+8>>2]=n[o+8>>2];n[r+12>>2]=n[o+12>>2];ze(l,r);l=t;n[l>>2]=0;n[l+4>>2]=0;je(n[e>>2]|0,t,8);if(!(Tt(n[e>>2]|0)|0)){p=C(8)|0;$t(p);E(p|0,2704,8)}s=t;t=n[s>>2]|0;s=n[s+4>>2]|0;if((t|0)==-1&(s|0)==-1){p=C(8)|0;qt(p,7488);E(p|0,2720,8)}p=n[e>>2]|0;l=i;n[l>>2]=0;n[l+4>>2]=0;l=i+8|0;n[l>>2]=t;n[l+4>>2]=s;n[r>>2]=n[i>>2];n[r+4>>2]=n[i+4>>2];n[r+8>>2]=n[i+8>>2];n[r+12>>2]=n[i+12>>2];ze(p,r);if(!(Tt(n[e>>2]|0)|0)){p=C(8)|0;$t(p);E(p|0,2704,8)}je(n[e>>2]|0,r,8);if(!(Tt(n[e>>2]|0)|0)){p=C(8)|0;$t(p);E(p|0,2704,8)}if(n[r>>2]|0){p=C(8)|0;es(p);E(p|0,2736,8)}o=e+288|0;l=e+292|0;n[l>>2]=n[o>>2];p=e+259|0;if((A[p>>0]|A[p+1>>0]<<8|A[p+2>>0]<<16|A[p+3>>0]<<24|0)==-1){p=C(8)|0;qt(p,7606);E(p|0,2720,8)}i=r+4|0;ts(o,(n[i>>2]|0)+1|0);p=n[o>>2]|0;n[p>>2]=(n[a>>2]|0)+8;n[p+4>>2]=0;if((n[i>>2]|0)>>>0>1){Oe(c,n[e>>2]|0);ss(h,c);is(u,32,2,8,0);rs(h);ns(u);if(!(n[i>>2]|0)){o=n[o>>2]|0;s=o}else{s=1;do{if(s>>>0>1)t=n[(n[o>>2]|0)+(s+-1<<3)>>2]|0;else t=0;a=As(u,h,t,1)|0;t=n[o>>2]|0;p=t+(s<<3)|0;n[p>>2]=a;n[p+4>>2]=((a|0)<0)<<31>>31;s=s+1|0}while(s>>>0<=(n[i>>2]|0)>>>0);s=t;o=t}t=n[l>>2]|0;if(t-s>>3>>>0>1){r=t-o>>3;i=o;t=1;s=n[i>>2]|0;i=n[i+4>>2]|0;do{p=o+(t<<3)|0;l=p;s=sm(n[l>>2]|0,n[l+4>>2]|0,s|0,i|0)|0;i=v()|0;n[p>>2]=s;n[p+4>>2]=i;t=t+1|0}while(t>>>0<r>>>0)}os(u);as(h);De(c)}J=d;return}function et(e){e=e|0;i[e+12>>0]=0;i[e+13>>0]=0;return}function tt(e){e=e|0;n[e+8>>2]=0;n[e+4>>2]=0;return}function st(e){e=e|0;return Zd(e)|0}function it(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0,l=0,c=0;a=J;J=J+16|0;A=t;o=a;r=s-A|0;if(r>>>0>4294967279)fg(e);if(r>>>0<11)i[e+11>>0]=r;else{c=r+16&-16;l=Zf(c)|0;n[e>>2]=l;n[e+8>>2]=c|-2147483648;n[e+4>>2]=r;e=l}if((t|0)!=(s|0)){A=s-A|0;r=e;while(1){rt(r,t);t=t+1|0;if((t|0)==(s|0))break;else r=r+1|0}e=e+A|0}i[o>>0]=0;rt(e,o);J=a;return}function rt(e,t){e=e|0;t=t|0;i[e>>0]=i[t>>0]|0;return}function nt(e){e=e|0;ff(e);qp(e);return}function At(e,t){e=e|0;t=t|0;n[e>>2]=4372;n[e+16>>2]=e;return}function ot(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;t=n[t+4>>2]|0;n[e+4>>2]=t;n[e+8>>2]=t+(s*24|0);return}function at(e){e=e|0;n[(n[e>>2]|0)+4>>2]=n[e+4>>2];return}function lt(e,t){e=e|0;t=t|0;var s=0,i=0;s=t+16|0;i=n[s>>2]|0;do{if(i)if((t|0)==(i|0)){i=ct(e)|0;n[e+16>>2]=i;s=n[s>>2]|0;Wm[n[(n[s>>2]|0)+12>>2]&15](s,i);break}else{n[e+16>>2]=i;n[s>>2]=0;break}else n[e+16>>2]=0}while(0);return}function ct(e){e=e|0;return e|0}function ht(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;r=e+12|0;n[r>>2]=0;n[e+16>>2]=i;do{if(t)if(t>>>0>178956970){r=C(8)|0;ug(r,6723);n[r>>2]=5956;E(r|0,3928,123)}else{i=Zf(t*24|0)|0;break}else i=0}while(0);n[e>>2]=i;s=i+(s*24|0)|0;n[e+8>>2]=s;n[e+4>>2]=s;n[r>>2]=i+(t*24|0);return}function ut(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0;a=n[e>>2]|0;l=e+4|0;s=n[l>>2]|0;o=t+4|0;if((s|0)==(a|0)){r=o;A=e;i=n[o>>2]|0;s=a}else{i=n[o>>2]|0;do{s=s+-24|0;lt(i+-24|0,s);i=(n[o>>2]|0)+-24|0;n[o>>2]=i}while((s|0)!=(a|0));r=o;A=e;s=n[e>>2]|0}n[A>>2]=i;n[r>>2]=s;a=t+8|0;o=n[l>>2]|0;n[l>>2]=n[a>>2];n[a>>2]=o;a=e+8|0;l=t+12|0;e=n[a>>2]|0;n[a>>2]=n[l>>2];n[l>>2]=e;n[t>>2]=n[r>>2];return}function dt(e){e=e|0;var t=0,s=0,i=0,r=0;s=n[e+4>>2]|0;i=e+8|0;t=n[i>>2]|0;if((t|0)!=(s|0))do{r=t+-24|0;n[i>>2]=r;Ye(r);t=n[i>>2]|0}while((t|0)!=(s|0));t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function pt(e){e=e|0;return 178956970}function ft(e){e=e|0;qp(e);return}function gt(e){e=e|0;e=Zf(8)|0;n[e>>2]=4372;return e|0}function mt(e,t){e=e|0;t=t|0;n[t>>2]=4372;return}function _t(e){e=e|0;return}function bt(e){e=e|0;Be(e,8);return}function Bt(e,t){e=e|0;t=t|0;Ct(e+4|0,t);return}function yt(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==7183?e+4|0:0)|0}function wt(e){e=e|0;return 2664}function vt(e){e=e|0;return}function Ct(e,t){e=e|0;t=t|0;Mt(e,t);return}function Mt(e,t){e=e|0;t=t|0;var s=0,r=0;e=t+104|0;t=A[e>>0]|0;s=t>>>7;r=t>>>6&1;if((s|0)==1&(r|0)!=0){r=C(8)|0;Et(r);E(r|0,2632,8)}if((s|0)==(r|0)){r=C(8)|0;Ft(r);E(r|0,2648,8)}else{i[e>>0]=t&63;return}}function Et(e){e=e|0;pg(e,7076);n[e>>2]=4416;return}function Ft(e){e=e|0;pg(e,7144);n[e>>2]=4436;return}function xt(e){e=e|0;ff(e);qp(e);return}function Ut(e){e=e|0;ff(e);qp(e);return}function It(e){e=e|0;n[e>>2]=6092;return}function Tt(e){e=e|0;var t=0;t=e+12|0;e=(i[t>>0]|0)==0;i[t>>0]=0;return e|0}function Pt(e){e=e|0;return(i[e+13>>0]|0)!=0|0}function St(e,t){e=e|0;t=t|0;e=e+247|0;Ot(e,t);if((A[e>>0]|A[e+1>>0]<<8)<<16>>16==2)return;else{t=C(8)|0;Vt(t);E(t|0,2688,8)}}function Dt(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;var A=0,o=0;switch(r|0){case 0:break;case 2:{r=n[e+4>>2]|0;t=sm(sm(t|0,s|0,-1,-1)|0,v()|0,r|0,((r|0)<0)<<31>>31|0)|0;s=v()|0;break}case 1:{r=n[e+8>>2]|0;t=sm(r|0,((r|0)<0)<<31>>31|0,t|0,s|0)|0;s=v()|0;break}default:{s=0;t=0}}A=n[e+4>>2]|0;o=((A|0)<0)<<31>>31;r=e+12|0;if((s|0)<0|((s|0)>(o|0)|(s|0)==(o|0)&t>>>0>=A>>>0))i[r>>0]=1;else{i[r>>0]=0;n[e+8>>2]=t}return}function kt(e){e=e|0;pg(e,7410);n[e>>2]=4476;return}function Qt(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,n=0,o=0,a=0,l=0,c=0;o=J;J=J+16|0;n=o;Le(e);r=t+32|0;if((A[r>>0]|A[r+1>>0]<<8)<<16>>16){i=t+34|0;t=0;do{l=A[i>>0]|A[i+1>>0]<<8|A[i+2>>0]<<16|A[i+3>>0]<<24;c=l+(t*6|0)|0;a=l+(t*6|0)+2|0;l=l+(t*6|0)+4|0;Gt(n,(A[c>>0]|A[c+1>>0]<<8)&65535,(A[a>>0]|A[a+1>>0]<<8)&65535,(A[l>>0]|A[l+1>>0]<<8)&65535);Nt(e,n);s=s-((A[a>>0]|A[a+1>>0]<<8)&65535)|0;t=t+1|0}while(t>>>0<((A[r>>0]|A[r+1>>0]<<8)&65535)>>>0)}if((s|0)<0){c=C(8)|0;Vt(c);E(c|0,2688,8)}if(s|0){Gt(n,0,s,2);Nt(e,n)}J=o;return}function Rt(e,t){e=e|0;t=t|0;var s=0,r=0;s=J;J=J+16|0;r=s+1|0;i[r>>0]=i[s>>0]|0;Jt(e,t,r);J=s;return e|0}function Ot(e,t){e=e|0;t=t|0;var s=0,r=0,n=0,o=0,a=0,l=0,c=0;r=t+2|0;o=A[t>>0]|A[t+1>>0]<<8;i[e>>0]=o;i[e+1>>0]=o>>8;o=e+2|0;r=A[r>>0]|A[r+1>>0]<<8;i[o>>0]=r;i[o+1>>0]=r>>8;i[e+4>>0]=i[t+4>>0]|0;o=t+6|0;i[e+5>>0]=i[t+5>>0]|0;r=t+8|0;s=e+6|0;o=A[o>>0]|A[o+1>>0]<<8;i[s>>0]=o;i[s+1>>0]=o>>8;s=t+12|0;o=e+8|0;r=A[r>>0]|A[r+1>>0]<<8|A[r+2>>0]<<16|A[r+3>>0]<<24;i[o>>0]=r;i[o+1>>0]=r>>8;i[o+2>>0]=r>>16;i[o+3>>0]=r>>24;o=e+12|0;s=A[s>>0]|A[s+1>>0]<<8|A[s+2>>0]<<16|A[s+3>>0]<<24;i[o>>0]=s;i[o+1>>0]=s>>8;i[o+2>>0]=s>>16;i[o+3>>0]=s>>24;o=t+16|0;s=o;s=A[s>>0]|A[s+1>>0]<<8|A[s+2>>0]<<16|A[s+3>>0]<<24;o=o+4|0;o=A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24;r=e+16|0;a=r;i[a>>0]=s;i[a+1>>0]=s>>8;i[a+2>>0]=s>>16;i[a+3>>0]=s>>24;r=r+4|0;i[r>>0]=o;i[r+1>>0]=o>>8;i[r+2>>0]=o>>16;i[r+3>>0]=o>>24;r=t+32|0;o=t+24|0;a=o;a=A[a>>0]|A[a+1>>0]<<8|A[a+2>>0]<<16|A[a+3>>0]<<24;o=o+4|0;o=A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24;s=e+24|0;n=s;i[n>>0]=a;i[n+1>>0]=a>>8;i[n+2>>0]=a>>16;i[n+3>>0]=a>>24;s=s+4|0;i[s>>0]=o;i[s+1>>0]=o>>8;i[s+2>>0]=o>>16;i[s+3>>0]=o>>24;s=t+34|0;o=e+32|0;r=A[r>>0]|A[r+1>>0]<<8;i[o>>0]=r;i[o+1>>0]=r>>8;n=e+34|0;e=A[n>>0]|A[n+1>>0]<<8|A[n+2>>0]<<16|A[n+3>>0]<<24;if(!e)e=r;else{Yf(e);e=A[o>>0]|A[o+1>>0]<<8}r=Jf((e&65535)*6|0)|0;i[n>>0]=r;i[n+1>>0]=r>>8;i[n+2>>0]=r>>16;i[n+3>>0]=r>>24;if(e<<16>>16?(e=t+36|0,a=A[s>>0]|A[s+1>>0]<<8,i[r>>0]=a,i[r+1>>0]=a>>8,t=t+38|0,a=r+2|0,e=A[e>>0]|A[e+1>>0]<<8,i[a>>0]=e,i[a+1>>0]=e>>8,a=r+4|0,t=A[t>>0]|A[t+1>>0]<<8,i[a>>0]=t,i[a+1>>0]=t>>8,((A[o>>0]|A[o+1>>0]<<8)&65535)>1):0){e=1;do{t=s;s=s+6|0;a=A[n>>0]|A[n+1>>0]<<8|A[n+2>>0]<<16|A[n+3>>0]<<24;l=t+8|0;r=a+(e*6|0)|0;c=A[s>>0]|A[s+1>>0]<<8;i[r>>0]=c;i[r+1>>0]=c>>8;t=t+10|0;r=a+(e*6|0)+2|0;l=A[l>>0]|A[l+1>>0]<<8;i[r>>0]=l;i[r+1>>0]=l>>8;a=a+(e*6|0)+4|0;t=A[t>>0]|A[t+1>>0]<<8;i[a>>0]=t;i[a+1>>0]=t>>8;e=e+1|0}while(e>>>0<((A[o>>0]|A[o+1>>0]<<8)&65535)>>>0)}return}function Vt(e){e=e|0;pg(e,7354);n[e>>2]=4456;return}function Lt(e){e=e|0;ff(e);qp(e);return}function Ht(e){e=e|0;ff(e);qp(e);return}function Nt(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0;a=J;J=J+32|0;r=a;A=e+4|0;s=n[A>>2]|0;o=e+8|0;do{if((s|0)==(n[o>>2]|0)){s=((s-(n[e>>2]|0)|0)/12|0)+1|0;i=Zt(e)|0;if(i>>>0<s>>>0)Xg(e);else{l=n[e>>2]|0;c=((n[o>>2]|0)-l|0)/12|0;o=c<<1;zt(r,c>>>0<i>>>1>>>0?o>>>0<s>>>0?s:o:i,((n[A>>2]|0)-l|0)/12|0,e+8|0);o=r+8|0;A=n[o>>2]|0;n[A>>2]=n[t>>2];n[A+4>>2]=n[t+4>>2];n[A+8>>2]=n[t+8>>2];n[o>>2]=(n[o>>2]|0)+12;Xt(e,r);Kt(r);break}}else{jt(r,e,1);c=r+4|0;l=n[c>>2]|0;n[l>>2]=n[t>>2];n[l+4>>2]=n[t+4>>2];n[l+8>>2]=n[t+8>>2];n[c>>2]=(n[c>>2]|0)+12;Wt(r)}}while(0);J=a;return}function Gt(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;n[e>>2]=t;n[e+4>>2]=s;n[e+8>>2]=i;return}function jt(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;t=n[t+4>>2]|0;n[e+4>>2]=t;n[e+8>>2]=t+(s*12|0);return}function Wt(e){e=e|0;n[(n[e>>2]|0)+4>>2]=n[e+4>>2];return}function zt(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;r=e+12|0;n[r>>2]=0;n[e+16>>2]=i;do{if(t)if(t>>>0>357913941){r=C(8)|0;ug(r,6723);n[r>>2]=5956;E(r|0,3928,123)}else{i=Zf(t*12|0)|0;break}else i=0}while(0);n[e>>2]=i;s=i+(s*12|0)|0;n[e+8>>2]=s;n[e+4>>2]=s;n[r>>2]=i+(t*12|0);return}function Xt(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;i=n[e>>2]|0;o=e+4|0;A=t+4|0;r=(n[o>>2]|0)-i|0;s=(n[A>>2]|0)+(((r|0)/-12|0)*12|0)|0;n[A>>2]=s;if((r|0)>0){hm(s|0,i|0,r|0)|0;i=A;s=n[A>>2]|0}else i=A;A=n[e>>2]|0;n[e>>2]=s;n[i>>2]=A;A=t+8|0;r=n[o>>2]|0;n[o>>2]=n[A>>2];n[A>>2]=r;A=e+8|0;o=t+12|0;e=n[A>>2]|0;n[A>>2]=n[o>>2];n[o>>2]=e;n[t>>2]=n[i>>2];return}function Kt(e){e=e|0;var t=0,s=0,i=0;t=n[e+4>>2]|0;s=e+8|0;i=n[s>>2]|0;if((i|0)!=(t|0))n[s>>2]=i+(~(((i+-12-t|0)>>>0)/12|0)*12|0);t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function Zt(e){e=e|0;return 357913941}function Jt(e,t,s){e=e|0;t=t|0;s=s|0;var i=0;Yt(e);n[e>>2]=n[t>>2];s=t+4|0;n[e+4>>2]=n[s>>2];i=t+8|0;n[e+8>>2]=n[i>>2];n[i>>2]=0;n[s>>2]=0;n[t>>2]=0;return}function Yt(e){e=e|0;var t=0,s=0,i=0,r=0;t=n[e>>2]|0;s=t;if(t|0){i=e+4|0;n[i>>2]=s;r=e+8|0;Be(t,(n[r>>2]|0)-s|0);n[r>>2]=0;n[i>>2]=0;n[e>>2]=0}return}function $t(e){e=e|0;pg(e,7660);n[e>>2]=4496;return}function qt(e,t){e=e|0;t=t|0;pg(e,t);n[e>>2]=4516;return}function es(e){e=e|0;pg(e,7704);n[e>>2]=4536;return}function ts(e,t){e=e|0;t=t|0;var s=0,i=0,r=0;s=e+4|0;r=n[e>>2]|0;i=(n[s>>2]|0)-r>>3;if(i>>>0>=t>>>0){if(i>>>0>t>>>0)n[s>>2]=r+(t<<3)}else us(e,t-i|0);return}function ss(e,t){e=e|0;t=t|0;n[e>>2]=t;n[e+4>>2]=0;n[e+8>>2]=-1;return}function is(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;var A=0;n[e+4>>2]=t;n[e+8>>2]=s;n[e+12>>2]=i;n[e+16>>2]=r;n[e+36>>2]=0;n[e+40>>2]=0;n[e+44>>2]=0;vs(e+48|0);n[e+68>>2]=0;n[e+72>>2]=0;n[e+76>>2]=0;do{if(!r){s=e+20|0;if((t+-1|0)>>>0<31){n[s>>2]=t;r=1<<t;n[e+24>>2]=r;s=r>>>1;n[e+28>>2]=0-s;s=r+-1-s|0;break}else{n[s>>2]=32;n[e+24>>2]=0;n[e+28>>2]=-2147483648;s=2147483647;break}}else{i=e+20|0;n[i>>2]=0;n[e+24>>2]=r;s=r;A=0;while(1){s=s>>>1;t=A+1|0;if(!s)break;else A=t}n[i>>2]=(1<<A|0)==(r|0)?A:t;s=r>>>1;n[e+28>>2]=0-s;s=r+-1-s|0}}while(0);n[e+32>>2]=s;n[e>>2]=0;return}function rs(e){e=e|0;var t=0;t=((Es(n[e>>2]|0)|0)&255)<<24;t=((Es(n[e>>2]|0)|0)&255)<<16|t;t=t|((Es(n[e>>2]|0)|0)&255)<<8;n[e+4>>2]=t|(Es(n[e>>2]|0)|0)&255;return}function ns(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0,m=0,_=0,b=0;g=J;J=J+64|0;p=g+44|0;f=g;c=e+36|0;h=e+40|0;e:do{if((n[c>>2]|0)==(n[h>>2]|0)){u=e+8|0;t:do{if(!(n[u>>2]|0))d=e+20|0;else{r=e+20|0;A=e+44|0;o=p+4|0;a=e+44|0;l=p+8|0;i=0;while(1){Ts(f,(n[r>>2]|0)+1|0,0,0);t=n[h>>2]|0;if(t>>>0<(n[A>>2]|0)>>>0){Ps(p,c,1);Ds(n[o>>2]|0,f);n[o>>2]=(n[o>>2]|0)+44;Ss(p)}else{t=((t-(n[c>>2]|0)|0)/44|0)+1|0;s=Os(c)|0;if(s>>>0<t>>>0)break;m=n[c>>2]|0;b=((n[A>>2]|0)-m|0)/44|0;_=b<<1;ks(p,b>>>0<s>>>1>>>0?_>>>0<t>>>0?t:_:s,((n[h>>2]|0)-m|0)/44|0,a);Ds(n[l>>2]|0,f);n[l>>2]=(n[l>>2]|0)+44;Qs(c,p);Rs(p)}Ms(f);i=i+1|0;if(i>>>0>=(n[u>>2]|0)>>>0){d=r;break t}}Xg(c)}}while(0);if(n[d>>2]|0){o=e+12|0;a=e+68|0;l=e+72|0;c=e+76|0;h=p+4|0;r=e+76|0;A=p+8|0;i=1;while(1){t=n[o>>2]|0;Ts(f,1<<(i>>>0>t>>>0?t:i),0,0);t=n[l>>2]|0;if(t>>>0<(n[c>>2]|0)>>>0){Ps(p,a,1);Ds(n[h>>2]|0,f);n[h>>2]=(n[h>>2]|0)+44;Ss(p)}else{t=((t-(n[a>>2]|0)|0)/44|0)+1|0;s=Os(a)|0;if(s>>>0<t>>>0)break;b=n[a>>2]|0;m=((n[c>>2]|0)-b|0)/44|0;_=m<<1;ks(p,m>>>0<s>>>1>>>0?_>>>0<t>>>0?t:_:s,((n[l>>2]|0)-b|0)/44|0,r);Ds(n[A>>2]|0,f);n[A>>2]=(n[A>>2]|0)+44;Qs(a,p);Rs(p)}Ms(f);i=i+1|0;if(i>>>0>(n[d>>2]|0)>>>0)break e}Xg(a)}}}while(0);J=g;return}function As(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;s=(Hs(e,t,(n[e+36>>2]|0)+(i*44|0)|0)|0)+s|0;t=n[e+24>>2]|0;if((s|0)<0)return s+t|0;else return s-(s>>>0<t>>>0?0:t)|0;return 0}function os(e){e=e|0;Cs(e+68|0);Cs(e+36|0);return}function as(e){e=e|0;return}function ls(e){e=e|0;ff(e);qp(e);return}function cs(e){e=e|0;ff(e);qp(e);return}function hs(e){e=e|0;ff(e);qp(e);return}function us(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0;a=J;J=J+32|0;r=a;A=e+8|0;o=e+4|0;s=n[o>>2]|0;do{if((n[A>>2]|0)-s>>3>>>0<t>>>0){s=(s-(n[e>>2]|0)>>3)+t|0;i=Bs(e)|0;if(i>>>0<s>>>0)Xg(e);else{l=n[e>>2]|0;c=(n[A>>2]|0)-l|0;A=c>>2;ps(r,c>>3>>>0<i>>>1>>>0?A>>>0<s>>>0?s:A:i,(n[o>>2]|0)-l>>3,e+8|0);fs(r,t);gs(e,r);ms(r);break}}else ds(e,t)}while(0);J=a;return}function ds(e,t){e=e|0;t=t|0;var s=0,i=0,r=0;r=J;J=J+16|0;i=r;_s(i,e,t);e=i+4|0;t=n[e>>2]|0;s=n[i+8>>2]|0;if((t|0)!=(s|0)){s=s+-8-t|0;dm(t|0,0,s+8&-8|0)|0;n[e>>2]=t+((s>>>3)+1<<3)}bs(i);J=r;return}function ps(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;r=e+12|0;n[r>>2]=0;n[e+16>>2]=i;do{if(t)if(t>>>0>536870911){r=C(8)|0;ug(r,6723);n[r>>2]=5956;E(r|0,3928,123)}else{i=Zf(t<<3)|0;break}else i=0}while(0);n[e>>2]=i;s=i+(s<<3)|0;n[e+8>>2]=s;n[e+4>>2]=s;n[r>>2]=i+(t<<3);return}function fs(e,t){e=e|0;t=t|0;var s=0,i=0;i=J;J=J+16|0;s=i;ys(s,e+8|0,t);e=n[s>>2]|0;t=n[s+4>>2]|0;if((e|0)!=(t|0)){t=t+-8-e|0;dm(e|0,0,t+8&-8|0)|0;n[s>>2]=e+((t>>>3)+1<<3)}ws(s);J=i;return}function gs(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;i=n[e>>2]|0;o=e+4|0;A=t+4|0;r=(n[o>>2]|0)-i|0;s=(n[A>>2]|0)+(0-(r>>3)<<3)|0;n[A>>2]=s;if((r|0)>0){hm(s|0,i|0,r|0)|0;i=A;s=n[A>>2]|0}else i=A;A=n[e>>2]|0;n[e>>2]=s;n[i>>2]=A;A=t+8|0;r=n[o>>2]|0;n[o>>2]=n[A>>2];n[A>>2]=r;A=e+8|0;o=t+12|0;e=n[A>>2]|0;n[A>>2]=n[o>>2];n[o>>2]=e;n[t>>2]=n[i>>2];return}function ms(e){e=e|0;var t=0,s=0,i=0;t=n[e+4>>2]|0;s=e+8|0;i=n[s>>2]|0;if((i|0)!=(t|0))n[s>>2]=i+(~((i+-8-t|0)>>>3)<<3);t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function _s(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;t=n[t+4>>2]|0;n[e+4>>2]=t;n[e+8>>2]=t+(s<<3);return}function bs(e){e=e|0;n[(n[e>>2]|0)+4>>2]=n[e+4>>2];return}function Bs(e){e=e|0;return 536870911}function ys(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=n[t>>2];n[e+4>>2]=(n[t>>2]|0)+(s<<3);n[e+8>>2]=t;return}function ws(e){e=e|0;n[n[e+8>>2]>>2]=n[e>>2];return}function vs(e){e=e|0;n[e+12>>2]=1;n[e+16>>2]=2;n[e+8>>2]=4096;n[e+4>>2]=4;n[e>>2]=4;return}function Cs(e){e=e|0;var t=0,s=0,i=0;s=n[e>>2]|0;if(s|0){i=e+4|0;t=n[i>>2]|0;if((t|0)==(s|0))t=s;else{do{t=t+-44|0;Ms(t)}while((t|0)!=(s|0));t=n[e>>2]|0}n[i>>2]=s;Be(t,(n[e+8>>2]|0)-t|0)}return}function Ms(e){e=e|0;var t=0;t=n[e+8>>2]|0;if(t|0)Re(t);t=n[e+12>>2]|0;if(t|0)Re(t);t=n[e+16>>2]|0;if(t|0)Re(t);return}function Es(e){e=e|0;var t=0,s=0;s=e+4|0;t=n[s>>2]|0;if((t|0)>=(n[e+8>>2]|0)){Fs(e);t=n[s>>2]|0}e=n[e+12>>2]|0;n[s>>2]=t+1;return i[e+t>>0]|0}function Fs(e){e=e|0;var t=0;n[e+4>>2]=0;je(n[e>>2]|0,n[e+12>>2]|0,1048576);t=xs(n[e>>2]|0)|0;n[e+8>>2]=t;if(!t){t=C(8)|0;Us(t);E(t|0,2752,8)}else return}function xs(e){e=e|0;return n[e+16>>2]|0}function Us(e){e=e|0;pg(e,7769);n[e>>2]=4556;return}function Is(e){e=e|0;ff(e);qp(e);return}function Ts(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;var A=0,o=0,a=0;n[e>>2]=t;i[e+4>>0]=s&1;o=e+8|0;n[o>>2]=0;a=e+12|0;n[a>>2]=0;A=e+16|0;n[A>>2]=0;if((t+-2|0)>>>0>2046){e=C(8)|0;pg(e,7789);E(e|0,3912,8)}n[e+32>>2]=t+-1;if(t>>>0>16&(s^1)){s=3;while(1)if(1<<s+2>>>0<t>>>0)s=s+1|0;else break;t=1<<s;n[e+36>>2]=t;n[e+40>>2]=15-s;n[A>>2]=Ge((t<<2)+8|0)|0;t=n[e>>2]|0}else{n[A>>2]=0;n[e+40>>2]=0;n[e+36>>2]=0}n[o>>2]=Ge(t<<2)|0;A=Ge(n[e>>2]<<2)|0;n[a>>2]=A;n[e+20>>2]=0;t=n[e>>2]|0;s=e+24|0;n[s>>2]=t;t=(t|0)!=0;if(!r){if(t){t=0;do{n[A+(t<<2)>>2]=1;t=t+1|0}while(t>>>0<(n[e>>2]|0)>>>0)}}else if(t){t=0;do{n[A+(t<<2)>>2]=n[r+(t<<2)>>2];t=t+1|0}while(t>>>0<(n[e>>2]|0)>>>0)}Ls(e);r=((n[e>>2]|0)+6|0)>>>1;n[s>>2]=r;n[e+28>>2]=r;return}function Ps(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;t=n[t+4>>2]|0;n[e+4>>2]=t;n[e+8>>2]=t+(s*44|0);return}function Ss(e){e=e|0;n[(n[e>>2]|0)+4>>2]=n[e+4>>2];return}function Ds(e,t){e=e|0;t=t|0;var s=0;n[e>>2]=n[t>>2];i[e+4>>0]=i[t+4>>0]|0;s=t+8|0;n[e+8>>2]=n[s>>2];n[e+12>>2]=n[t+12>>2];n[e+16>>2]=n[t+16>>2];n[e+20>>2]=n[t+20>>2];n[e+24>>2]=n[t+24>>2];n[e+28>>2]=n[t+28>>2];n[e+32>>2]=n[t+32>>2];n[e+36>>2]=n[t+36>>2];n[e+40>>2]=n[t+40>>2];n[s>>2]=0;n[s+4>>2]=0;n[s+8>>2]=0;return}function ks(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;r=e+12|0;n[r>>2]=0;n[e+16>>2]=i;do{if(t)if(t>>>0>97612893){r=C(8)|0;ug(r,6723);n[r>>2]=5956;E(r|0,3928,123)}else{i=Zf(t*44|0)|0;break}else i=0}while(0);n[e>>2]=i;s=i+(s*44|0)|0;n[e+8>>2]=s;n[e+4>>2]=s;n[r>>2]=i+(t*44|0);return}function Qs(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0;a=n[e>>2]|0;l=e+4|0;s=n[l>>2]|0;o=t+4|0;if((s|0)==(a|0)){r=o;A=e;i=n[o>>2]|0;s=a}else{i=n[o>>2]|0;do{s=s+-44|0;Vs(i+-44|0,s);i=(n[o>>2]|0)+-44|0;n[o>>2]=i}while((s|0)!=(a|0));r=o;A=e;s=n[e>>2]|0}n[A>>2]=i;n[r>>2]=s;a=t+8|0;o=n[l>>2]|0;n[l>>2]=n[a>>2];n[a>>2]=o;a=e+8|0;l=t+12|0;e=n[a>>2]|0;n[a>>2]=n[l>>2];n[l>>2]=e;n[t>>2]=n[r>>2];return}function Rs(e){e=e|0;var t=0,s=0,i=0,r=0;s=n[e+4>>2]|0;i=e+8|0;t=n[i>>2]|0;if((t|0)!=(s|0))do{r=t+-44|0;n[i>>2]=r;Ms(r);t=n[i>>2]|0}while((t|0)!=(s|0));t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function Os(e){e=e|0;return 97612893}function Vs(e,t){e=e|0;t=t|0;var s=0,r=0,A=0,o=0;s=n[t>>2]|0;n[e>>2]=s;i[e+4>>0]=i[t+4>>0]|0;n[e+20>>2]=n[t+20>>2];n[e+24>>2]=n[t+24>>2];n[e+28>>2]=n[t+28>>2];n[e+32>>2]=n[t+32>>2];o=e+36|0;n[o>>2]=n[t+36>>2];n[e+40>>2]=n[t+40>>2];s=s<<2;r=Ge(s)|0;n[e+8>>2]=r;A=n[e>>2]|0;if(A|0)um(r|0,n[t+8>>2]|0,A<<2|0)|0;s=Ge(s)|0;n[e+12>>2]=s;r=n[e>>2]|0;if(r|0)um(s|0,n[t+12>>2]|0,r<<2|0)|0;s=n[o>>2]|0;if(s){r=Ge((s<<2)+8|0)|0;n[e+16>>2]=r;s=(n[o>>2]<<2)+8|0;if(s|0)um(r|0,n[t+16>>2]|0,s|0)|0}else n[e+16>>2]=0;return}function Ls(e){e=e|0;var t=0,s=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;g=e+24|0;A=e+20|0;t=(n[A>>2]|0)+(n[g>>2]|0)|0;n[A>>2]=t;if(t>>>0>32768){n[A>>2]=0;if(!(n[e>>2]|0))t=0;else{r=n[e+12>>2]|0;s=0;do{d=r+(s<<2)|0;t=((n[d>>2]|0)+1|0)>>>1;n[d>>2]=t;t=(n[A>>2]|0)+t|0;n[A>>2]=t;s=s+1|0}while(s>>>0<(n[e>>2]|0)>>>0)}}d=2147483648/(t>>>0)|0;do{if((i[e+4>>0]|0)==0?(p=e+36|0,(n[p>>2]|0)!=0):0){if(n[e>>2]|0){l=n[e+8>>2]|0;c=n[e+12>>2]|0;h=e+40|0;u=e+16|0;t=0;o=0;a=0;do{s=(b(o,d)|0)>>>16;n[l+(a<<2)>>2]=s;o=(n[c+(a<<2)>>2]|0)+o|0;s=s>>>(n[h>>2]|0);if(t>>>0<s>>>0){r=a+-1|0;A=n[u>>2]|0;do{t=t+1|0;n[A+(t<<2)>>2]=r}while((t|0)!=(s|0));t=s}a=a+1|0}while(a>>>0<(n[e>>2]|0)>>>0);s=n[u>>2]|0;n[s>>2]=0;if(t>>>0>(n[p>>2]|0)>>>0){t=e;break}}else{s=n[e+16>>2]|0;n[s>>2]=0;t=0}do{t=t+1|0;n[s+(t<<2)>>2]=(n[e>>2]|0)+-1}while(t>>>0<=(n[p>>2]|0)>>>0);t=e}else f=7}while(0);if((f|0)==7)if(!(n[e>>2]|0))t=e;else{r=n[e+8>>2]|0;A=n[e+12>>2]|0;t=0;s=0;do{n[r+(t<<2)>>2]=(b(s,d)|0)>>>16;s=(n[A+(t<<2)>>2]|0)+s|0;t=t+1|0}while(t>>>0<(n[e>>2]|0)>>>0);t=e}f=((n[g>>2]|0)*5|0)>>>2;p=(n[t>>2]<<3)+48|0;f=f>>>0>p>>>0?p:f;n[g>>2]=f;n[e+28>>2]=f;return}function Hs(e,t,s){e=e|0;t=t|0;s=s|0;var i=0;s=Ns(t,s)|0;n[e>>2]=s;do{if(s){if(s>>>0>=32){s=n[e+28>>2]|0;break}i=n[e+12>>2]|0;if(s>>>0>i>>>0){i=s-i|0;s=Ns(t,(n[e+68>>2]|0)+((s+-1|0)*44|0)|0)|0;i=s<<i|(Gs(t,i)|0)}else i=Ns(t,(n[e+68>>2]|0)+((s+-1|0)*44|0)|0)|0;s=n[e>>2]|0;if((i|0)<(1<<s+-1|0)){s=i+1+(-1<<s)|0;break}else{s=i+1|0;break}}else s=js(t,e+48|0)|0}while(0);return s|0}function Ns(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;d=e+8|0;u=n[d>>2]|0;r=n[t+16>>2]|0;if(r){i=e+4|0;s=n[i>>2]|0;h=u>>>15;n[d>>2]=h;l=(s>>>0)/(h>>>0)|0;a=l>>>(n[t+40>>2]|0);A=n[r+(a<<2)>>2]|0;a=(n[r+(a+1<<2)>>2]|0)+1|0;o=A+1|0;c=n[t+8>>2]|0;if(a>>>0>o>>>0){r=A;A=a;do{o=(A+r|0)>>>1;a=(n[c+(o<<2)>>2]|0)>>>0>l>>>0;r=a?r:o;A=a?o:A;o=r+1|0}while(A>>>0>o>>>0);A=r}r=b(n[c+(A<<2)>>2]|0,h)|0;if((A|0)==(n[t+32>>2]|0))o=u;else o=b(n[c+(o<<2)>>2]|0,h)|0}else{c=u>>>15;n[d>>2]=c;a=n[t>>2]|0;h=n[t+8>>2]|0;i=e+4|0;s=n[i>>2]|0;l=a>>>1;r=0;o=u;A=0;do{p=b(n[h+(l<<2)>>2]|0,c)|0;u=p>>>0>s>>>0;o=u?p:o;r=u?r:p;A=u?A:l;a=u?l:a;l=(A+a|0)>>>1}while((l|0)!=(A|0))}n[i>>2]=s-r;p=o-r|0;n[d>>2]=p;if(p>>>0<16777216)Ws(e);d=(n[t+12>>2]|0)+(A<<2)|0;n[d>>2]=(n[d>>2]|0)+1;d=t+28|0;p=(n[d>>2]|0)+-1|0;n[d>>2]=p;if(!p)Ls(t);return A|0}function Gs(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;if(t>>>0>19){s=(zs(e)|0)&65535;return(Gs(e,t+-16|0)|0)<<16|s|0}i=e+4|0;r=n[i>>2]|0;A=e+8|0;s=(n[A>>2]|0)>>>t;n[A>>2]=s;t=(r>>>0)/(s>>>0)|0;n[i>>2]=r-(b(t,s)|0);if(s>>>0<16777216)Ws(e);return t|0}function js(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0;i=e+8|0;r=n[i>>2]|0;s=b(r>>>13,n[t+8>>2]|0)|0;A=e+4|0;o=n[A>>2]|0;a=o>>>0>=s>>>0;if(a){n[A>>2]=o-s;s=r-s|0;n[i>>2]=s}else{n[i>>2]=s;o=t+12|0;n[o>>2]=(n[o>>2]|0)+1}if(s>>>0<16777216)Ws(e);o=t+4|0;e=(n[o>>2]|0)+-1|0;n[o>>2]=e;if(!e)Xs(t);return a&1|0}function Ws(e){e=e|0;var t=0,s=0,i=0,r=0;t=e+4|0;s=e+8|0;i=n[t>>2]|0;do{i=i<<8|(Es(n[e>>2]|0)|0)&255;n[t>>2]=i;r=n[s>>2]<<8;n[s>>2]=r}while(r>>>0<16777216);return}function zs(e){e=e|0;var t=0,s=0,i=0,r=0;s=e+4|0;r=n[s>>2]|0;t=e+8|0;i=(n[t>>2]|0)>>>16;n[t>>2]=i;t=(r>>>0)/(i>>>0)|0;n[s>>2]=r-(b(t,i)|0);Ws(e);return t&65535|0}function Xs(e){e=e|0;var t=0,s=0,i=0,r=0,A=0;r=n[e>>2]|0;s=e+16|0;t=(n[s>>2]|0)+r|0;n[s>>2]=t;if(t>>>0>8192){i=(t+1|0)>>>1;n[s>>2]=i;A=e+12|0;t=((n[A>>2]|0)+1|0)>>>1;n[A>>2]=t;if((t|0)==(i|0)){t=i+1|0;n[s>>2]=t;s=t;t=i}else s=i}else{s=t;t=n[e+12>>2]|0}n[e+8>>2]=(b(t,2147483648/(s>>>0)|0)|0)>>>18;A=r*5|0;A=A>>>0>259?64:A>>>2;n[e>>2]=A;n[e+4>>2]=A;return}function Ks(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;u=J;J=J+32|0;o=u+16|0;a=u+8|0;l=u;c=e+336|0;i=c;r=e+259|0;if(!((n[i+4>>2]|0)==0?(n[i>>2]|0)==(A[r>>0]|A[r+1>>0]<<8|A[r+2>>0]<<16|A[r+3>>0]<<24|0):0)){i=e+320|0;s=n[i>>2]|0;r=s;if(!((s|0)!=0?(n[e+312>>2]|0)!=0:0)){s=r;h=5}}else{i=e+320|0;s=n[e+320>>2]|0;h=5}if((h|0)==5){h=e+320|0;n[o>>2]=s;n[h>>2]=0;s=e+324|0;n[o+4>>2]=n[s>>2];n[s>>2]=0;Ie(o);r=e+312|0;n[o>>2]=n[r>>2];n[r>>2]=0;d=e+316|0;n[o+4>>2]=n[d>>2];n[d>>2]=0;Te(o);p=Zf(12)|0;ss(p,e+4|0);n[l>>2]=0;n[o>>2]=n[l>>2];Js(a,p,o);p=n[a>>2]|0;n[a>>2]=n[r>>2];n[r>>2]=p;p=a+4|0;l=n[p>>2]|0;n[p>>2]=n[d>>2];n[d>>2]=l;Te(a);Zs(a,n[r>>2]|0,e+300|0);r=n[a>>2]|0;d=a+4|0;l=n[d>>2]|0;n[a>>2]=0;n[d>>2]=0;n[o>>2]=n[h>>2];n[h>>2]=r;n[o+4>>2]=n[s>>2];n[s>>2]=l;Ie(o);Ie(a);s=e+328|0;l=s;l=sm(n[l>>2]|0,n[l+4>>2]|0,1,0)|0;h=v()|0;n[s>>2]=l;n[s+4>>2]=h;s=c;n[s>>2]=0;n[s+4>>2]=0;s=n[i>>2]|0}Hm[n[n[s>>2]>>2]&63](s,t)|0;h=c;h=sm(n[h>>2]|0,n[h+4>>2]|0,1,0)|0;d=v()|0;p=c;n[p>>2]=h;n[p+4>>2]=d;J=u;return}function Zs(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0;o=J;J=J+64|0;i=o+56|0;r=o;A=si(s)|0;if((A|0)==-1){o=C(8)|0;ii(o);E(o|0,2784,8)}s=ri(s)|0;e:do{if(!s)switch(A|0){case 0:{A=Zf(4788)|0;pi(A);di(e,t,A);break e}case 1:{A=Zf(5116)|0;gi(A);fi(e,t,A);break e}case 2:{A=Zf(5104)|0;_i(A);mi(e,t,A);break e}case 3:{A=Zf(5432)|0;Bi(A);bi(e,t,A);break e}default:{n[e>>2]=0;n[e+4>>2]=0;break e}}else{ni(i,t);Ai(n[i>>2]|0);if((A|2|0)==3)oi(n[i>>2]|0);if((A|1|0)==3)ai(n[i>>2]|0);A=n[i>>2]|0;ci(r,s);li(A,r);hi(r);n[e>>2]=n[i>>2];A=i+4|0;n[e+4>>2]=n[A>>2];n[i>>2]=0;n[A>>2]=0;ui(i)}}while(0);J=o;return}function Js(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4576;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Ys(e,i);J=s;return}function Ys(e,t){e=e|0;t=t|0;return}function $s(e){e=e|0;Ag(e);qp(e);return}function qs(e){e=e|0;e=n[e+12>>2]|0;if(e|0){as(e);qp(e)}return}function ei(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==7983?e+12|0:0)|0}function ti(e){e=e|0;Be(e,16);return}function si(e){e=e|0;var t=0,s=0;t=(n[e+4>>2]|0)-(n[e>>2]|0)|0;e:do{if(((t|0)!=0?(s=((t|0)/12|0)+(((ri(e)|0)!=0)<<31>>31)|0,(s|0)!=0):0)?(t=n[e>>2]|0,!(yi(t,wi()|0)|0)):0){switch(s|0){case 1:{e=0;break e}case 2:{if(vi((n[e>>2]|0)+12|0,Ci()|0)|0){e=1;break e}if(vi((n[e>>2]|0)+12|0,Mi()|0)|0){e=2;break e}break}case 3:{if(vi((n[e>>2]|0)+12|0,Ci()|0)|0?(s=(n[e>>2]|0)+24|0,vi(s,Mi()|0)|0):0){e=3;break e}break}default:{}}e=-1}else e=-1}while(0);return e|0}function ii(e){e=e|0;pg(e,8131);n[e>>2]=4604;return}function ri(e){e=e|0;var t=0,s=0;t=n[e+4>>2]|0;if(((t|0)!=(n[e>>2]|0)?(s=t,(n[s+-12>>2]|0)==0):0)?(n[s+-4>>2]|0)==2:0)e=n[s+-8>>2]|0;else e=0;return e|0}function ni(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;s=J;J=J+16|0;i=s+4|0;A=s;r=Zf(24)|0;Fi(r,t);n[A>>2]=0;n[i>>2]=n[A>>2];xi(e,r,i);J=s;return}function Ai(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(4792)|0;Ni(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];Gi(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function oi(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(336)|0;Wr(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];zr(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function ai(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(324)|0;mn(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];_n(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function li(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;o=l+12|0;a=l;i=l+8|0;A=Zf(64)|0;Sn(A,n[e+4>>2]|0,t);r=e+8|0;n[i>>2]=0;n[o>>2]=n[i>>2];Dn(a,A,o);A=e+12|0;t=n[A>>2]|0;i=e+16|0;do{if(t>>>0>=(n[i>>2]|0)>>>0){t=(t-(n[r>>2]|0)>>3)+1|0;s=Zi(r)|0;if(s>>>0<t>>>0)Xg(r);else{c=n[r>>2]|0;h=(n[i>>2]|0)-c|0;i=h>>2;zi(o,h>>3>>>0<s>>>1>>>0?i>>>0<t>>>0?t:i:s,(n[A>>2]|0)-c>>3,e+16|0);e=o+8|0;A=n[e>>2]|0;n[A>>2]=n[a>>2];i=a+4|0;n[A+4>>2]=n[i>>2];n[a>>2]=0;n[i>>2]=0;n[e>>2]=A+8;Xi(r,o);Ki(o);break}}else{ji(o,r,1);h=o+4|0;c=n[h>>2]|0;n[c>>2]=n[a>>2];e=a+4|0;n[c+4>>2]=n[e>>2];n[a>>2]=0;n[e>>2]=0;n[h>>2]=c+8;Wi(o)}}while(0);ki(a);J=l;return}function ci(e,t){e=e|0;t=t|0;var s=0,r=0;s=J;J=J+48|0;r=s;n[e>>2]=t;i[e+4>>0]=0;EA(e+8|0,t);EA(e+20|0,t);Ts(r,256,0,0);FA(e+32|0,t,r);Ms(r);J=s;return}function hi(e){e=e|0;IA(e+32|0);Gn(e+20|0);Gn(e+8|0);return}function ui(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function di(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0;i=J;J=J+16|0;r=i+4|0;o=i;A=Zf(12)|0;TA(A,t,s);n[o>>2]=0;n[r>>2]=n[o>>2];PA(e,A,r);J=i;return}function pi(e){e=e|0;Yi(e);jA(e+4784|0);return}function fi(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0;i=J;J=J+16|0;r=i+4|0;o=i;A=Zf(12)|0;WA(A,t,s);n[o>>2]=0;n[r>>2]=n[o>>2];zA(e,A,r);J=i;return}function gi(e){e=e|0;Yi(e);ro(e+4784|0);return}function mi(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0;i=J;J=J+16|0;r=i+4|0;o=i;A=Zf(12)|0;no(A,t,s);n[o>>2]=0;n[r>>2]=n[o>>2];Ao(e,A,r);J=i;return}function _i(e){e=e|0;Yi(e);bo(e+4784|0);return}function bi(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0;i=J;J=J+16|0;r=i+4|0;o=i;A=Zf(12)|0;Bo(A,t,s);n[o>>2]=0;n[r>>2]=n[o>>2];yo(e,A,r);J=i;return}function Bi(e){e=e|0;Yi(e);So(e+4784|0);return}function yi(e,t){e=e|0;t=t|0;return(vi(e,t)|0)^1|0}function wi(){if((i[21456]|0)==0?Qf(21456)|0:0){Gt(21536,6,20,2);jf(21456)}return 21536}function vi(e,t){e=e|0;t=t|0;if((n[e>>2]|0)==(n[t>>2]|0)?(n[e+8>>2]|0)==(n[t+8>>2]|0):0)e=(n[e+4>>2]|0)==(n[t+4>>2]|0);else e=0;return e|0}function Ci(){if((i[21464]|0)==0?Qf(21464)|0:0){Gt(21548,7,8,2);jf(21464)}return 21548}function Mi(){if((i[21472]|0)==0?Qf(21472)|0:0){Gt(21560,8,6,2);jf(21472)}return 21560}function Ei(e){e=e|0;ff(e);qp(e);return}function Fi(e,t){e=e|0;t=t|0;Ui(e);n[e>>2]=4624;n[e+4>>2]=t;n[e+8>>2]=0;n[e+12>>2]=0;n[e+16>>2]=0;i[e+20>>0]=1;return}function xi(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4664;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Ri(e,i);J=s;return}function Ui(e){e=e|0;n[e>>2]=4644;return}function Ii(e,t){e=e|0;t=t|0;var s=0,r=0,A=0,o=0,a=0,l=0,c=0;c=J;J=J+16|0;o=c;s=n[e+8>>2]|0;a=n[e+12>>2]|0;if((s|0)!=(a|0)){l=o+4|0;do{r=n[s>>2]|0;n[o>>2]=r;A=n[s+4>>2]|0;n[l>>2]=A;if(A|0){A=A+4|0;n[A>>2]=(n[A>>2]|0)+1}t=Hm[n[(n[r>>2]|0)+12>>2]&63](r,t)|0;ki(o);s=s+8|0}while((s|0)!=(a|0))}s=e+20|0;if(i[s>>0]|0){i[s>>0]=0;rs(n[e+4>>2]|0)}J=c;return t|0}function Ti(e){e=e|0;n[e>>2]=4624;Qi(e+8|0);Si(e);return}function Pi(e){e=e|0;Ti(e);qp(e);return}function Si(e){e=e|0;return}function Di(e){e=e|0;Z()}function ki(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Qi(e){e=e|0;var t=0,s=0,i=0;s=n[e>>2]|0;if(s|0){i=e+4|0;t=n[i>>2]|0;if((t|0)==(s|0))t=s;else{do{t=t+-8|0;ki(t)}while((t|0)!=(s|0));t=n[e>>2]|0}n[i>>2]=s;Be(t,(n[e+8>>2]|0)-t|0)}return}function Ri(e,t){e=e|0;t=t|0;return}function Oi(e){e=e|0;Ag(e);qp(e);return}function Vi(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+8>>2]&255](e);return}function Li(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==8546?e+12|0:0)|0}function Hi(e){e=e|0;Be(e,16);return}function Ni(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=4692;n[e+4>>2]=t;Yi(e+8|0);return}function Gi(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4740;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function ji(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;t=n[t+4>>2]|0;n[e+4>>2]=t;n[e+8>>2]=t+(s<<3);return}function Wi(e){e=e|0;n[(n[e>>2]|0)+4>>2]=n[e+4>>2];return}function zi(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;r=e+12|0;n[r>>2]=0;n[e+16>>2]=i;do{if(t)if(t>>>0>536870911){r=C(8)|0;ug(r,6723);n[r>>2]=5956;E(r|0,3928,123)}else{i=Zf(t<<3)|0;break}else i=0}while(0);n[e>>2]=i;s=i+(s<<3)|0;n[e+8>>2]=s;n[e+4>>2]=s;n[r>>2]=i+(t<<3);return}function Xi(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0;a=n[e>>2]|0;l=e+4|0;s=n[l>>2]|0;o=t+4|0;if((s|0)==(a|0)){r=o;A=e;i=n[o>>2]|0;s=a}else{i=n[o>>2]|0;do{A=s;s=s+-8|0;n[i+-8>>2]=n[s>>2];A=A+-4|0;n[i+-4>>2]=n[A>>2];n[s>>2]=0;n[A>>2]=0;i=(n[o>>2]|0)+-8|0;n[o>>2]=i}while((s|0)!=(a|0));r=o;A=e;s=n[e>>2]|0}n[A>>2]=i;n[r>>2]=s;a=t+8|0;o=n[l>>2]|0;n[l>>2]=n[a>>2];n[a>>2]=o;a=e+8|0;l=t+12|0;e=n[a>>2]|0;n[a>>2]=n[l>>2];n[l>>2]=e;n[t>>2]=n[r>>2];return}function Ki(e){e=e|0;var t=0,s=0,i=0,r=0;s=n[e+4>>2]|0;i=e+8|0;t=n[i>>2]|0;if((t|0)!=(s|0))do{r=t+-8|0;n[i>>2]=r;ki(r);t=n[i>>2]|0}while((t|0)!=(s|0));t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function Zi(e){e=e|0;return 536870911}function Ji(e){e=e|0;n[e>>2]=4716;return}function Yi(e){e=e|0;nr(e);Ar(e+3980|0);or(e+4380|0);i[e+4780>>0]=0;i[e+4781>>0]=0;return}function $i(e){e=e|0;n[e>>2]=4692;gr(e+8|0);sr(e);return}function qi(e){e=e|0;$i(e);qp(e);return}function er(e,t){e=e|0;t=t|0;return t|0}function tr(e,t){e=e|0;t=t|0;return _r(e+8|0,n[e+4>>2]|0,t)|0}function sr(e){e=e|0;return}function ir(e){e=e|0;sr(e);qp(e);return}function rr(e,t){e=e|0;t=t|0;return t|0}function nr(e){e=e|0;var t=0,s=0;cr(e);hr(e+52|0);hr(e+436|0);Ts(e+852|0,64,0,0);i[e+3976>>0]=0;t=e+20|0;s=t+32|0;do{r[t>>1]=0;t=t+2|0}while((t|0)<(s|0));t=Zf(44)|0;Ts(t,256,0,0);n[e+896>>2]=t;t=Zf(44)|0;Ts(t,256,0,0);n[e+900>>2]=t;t=e+820|0;n[t>>2]=0;n[t+4>>2]=0;n[t+8>>2]=0;n[t+12>>2]=0;n[t+16>>2]=0;n[t+20>>2]=0;n[t+24>>2]=0;n[t+28>>2]=0;t=0;do{s=Zf(44)|0;Ts(s,256,0,0);n[e+904+(t<<2)>>2]=s;s=Zf(44)|0;Ts(s,256,0,0);n[e+1928+(t<<2)>>2]=s;s=Zf(44)|0;Ts(s,256,0,0);n[e+2952+(t<<2)>>2]=s;t=t+1|0}while(t>>>0<256);return}function Ar(e){e=e|0;pr(e,16,4,8,0);pr(e+80|0,16,1,8,0);pr(e+160|0,32,2,8,0);pr(e+240|0,32,22,8,0);pr(e+320|0,32,20,8,0);return}function or(e){e=e|0;is(e,16,4,8,0);is(e+80|0,16,1,8,0);is(e+160|0,32,2,8,0);is(e+240|0,32,22,8,0);is(e+320|0,32,20,8,0);return}function ar(e){e=e|0;fr(e+320|0);fr(e+240|0);fr(e+160|0);fr(e+80|0);fr(e);return}function lr(e){e=e|0;var t=0,s=0;t=n[e+896>>2]|0;if(t|0){Ms(t);qp(t)}t=n[e+900>>2]|0;if(t|0){Ms(t);qp(t)}s=0;do{t=n[e+904+(s<<2)>>2]|0;if(t|0){Ms(t);qp(t)}t=n[e+1928+(s<<2)>>2]|0;if(t|0){Ms(t);qp(t)}t=n[e+2952+(s<<2)>>2]|0;if(t|0){Ms(t);qp(t)}s=s+1|0}while((s|0)!=256);Ms(e+852|0);return}function cr(e){e=e|0;var t=0;i[e>>0]=0;i[e+1>>0]=0;i[e+2>>0]=0;i[e+3>>0]=0;t=e+4|0;i[t>>0]=0;i[t+1>>0]=0;i[t+2>>0]=0;i[t+3>>0]=0;e=e+12|0;t=e;i[t>>0]=0;i[t+1>>0]=0;i[t+2>>0]=0;i[t+3>>0]=0;e=e+4|0;i[e>>0]=0;i[e+1>>0]=0;i[e+2>>0]=0;i[e+3>>0]=0;return}function hr(e){e=e|0;var t=0;t=e+384|0;do{ur(e);e=e+24|0}while((e|0)!=(t|0));return}function ur(e){e=e|0;dr(e);return}function dr(e){e=e|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=0;n[e+16>>2]=0;i[e+20>>0]=1;return}function pr(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;var A=0;n[e+4>>2]=t;n[e+8>>2]=s;n[e+12>>2]=i;n[e+16>>2]=r;n[e+36>>2]=0;n[e+40>>2]=0;n[e+44>>2]=0;vs(e+48|0);n[e+68>>2]=0;n[e+72>>2]=0;n[e+76>>2]=0;do{if(!r){s=e+20|0;if((t+-1|0)>>>0<31){n[s>>2]=t;r=1<<t;n[e+24>>2]=r;s=r>>>1;n[e+28>>2]=0-s;s=r+-1-s|0;break}else{n[s>>2]=32;n[e+24>>2]=0;n[e+28>>2]=-2147483648;s=2147483647;break}}else{i=e+20|0;n[i>>2]=0;n[e+24>>2]=r;s=r;A=0;while(1){s=s>>>1;t=A+1|0;if(!s)break;else A=t}n[i>>2]=(1<<A|0)==(r|0)?A:t;s=r>>>1;n[e+28>>2]=0-s;s=r+-1-s|0}}while(0);n[e+32>>2]=s;n[e>>2]=0;return}function fr(e){e=e|0;var t=0,s=0,i=0,r=0,A=0;A=e+36|0;s=n[A>>2]|0;i=e+40|0;t=n[i>>2]|0;if((t|0)!=(s|0))do{t=t+-44|0;Ms(t)}while((t|0)!=(s|0));n[i>>2]=s;i=e+68|0;r=n[i>>2]|0;s=e+72|0;t=n[s>>2]|0;if((t|0)!=(r|0))do{t=t+-44|0;Ms(t)}while((t|0)!=(r|0));n[s>>2]=r;Cs(i);Cs(A);return}function gr(e){e=e|0;mr(e+4380|0);ar(e+3980|0);lr(e);return}function mr(e){e=e|0;os(e+320|0);os(e+240|0);os(e+160|0);os(e+80|0);os(e);return}function _r(e,t,s){e=e|0;t=t|0;s=s|0;var a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;f=J;J=J+32|0;p=f;a=e+4781|0;if(!(i[a>>0]|0)){br(e+4380|0);i[a>>0]=1}a=e+3976|0;if(!(i[a>>0]|0)){i[a>>0]=1;yr(Br(t)|0,s,20);wr(p,s);c=e;a=p;l=c+20|0;do{i[c>>0]=i[a>>0]|0;c=c+1|0;a=a+1|0}while((c|0)<(l|0));r[e+12>>1]=0}else{u=Ns(t,e+852|0)|0;if(u){if(u&32|0)Cr((Ns(t,n[e+904+(((vr(e)|0)&255)<<2)>>2]|0)|0)&255,e);d=e+14|0;c=i[d>>0]|0;a=c&7;c=(c&255)>>>3&7;l=A[16+(c<<3)+a>>0]|0;a=A[80+(c<<3)+a>>0]|0;if(!(u&16))h=r[e+20+(l<<1)>>1]|0;else{g=e+20+(l<<1)|0;h=(As(e+4380|0,t,o[g>>1]|0,l>>>0<3?l:3)|0)&65535;r[g>>1]=h}r[e+12>>1]=h;if(u&8|0){g=e+15|0;i[g>>0]=Ns(t,n[e+1928+(A[g>>0]<<2)>>2]|0)|0}if(u&4|0){d=Ns(t,n[e+896+(((A[d>>0]|0)>>>6&1)<<2)>>2]|0)|0;g=e+16|0;i[g>>0]=Mr(d+(i[g>>0]|0)|0)|0}if(u&2|0){g=e+17|0;i[g>>0]=Ns(t,n[e+2952+(A[g>>0]<<2)>>2]|0)|0}if(u&1){g=e+18|0;r[g>>1]=As(e+4460|0,t,o[g>>1]|0,0)|0}}else{g=i[e+14>>0]|0;a=g&7;g=(g&255)>>>3&7;c=g;l=A[16+(g<<3)+a>>0]|0;a=A[80+(g<<3)+a>>0]|0}h=e+52+(l*24|0)|0;u=e+4540|0;d=(c|0)==1&1;c=As(u,t,Er(h)|0,d)|0;n[p>>2]=c;n[e>>2]=(n[e>>2]|0)+c;Fr(h,p);h=e+436+(l*24|0)|0;c=Er(h)|0;l=xr(u)|0;g=e+4620|0;l=As(g,t,c,(l>>>0<20?l&-2:20)|d)|0;n[p>>2]=l;c=e+4|0;n[c>>2]=(n[c>>2]|0)+l;Fr(h,p);p=xr(u)|0;p=(xr(g)|0)+p|0;g=e+820+(a<<2)|0;p=As(e+4700|0,t,n[g>>2]|0,(p>>>0<36?p>>>1&2147483646:18)|d)|0;n[e+8>>2]=p;n[g>>2]=p;Ur(e,s)}J=f;return s+20|0}function br(e){e=e|0;ns(e);ns(e+80|0);ns(e+160|0);ns(e+240|0);ns(e+320|0);return}function Br(e){e=e|0;return n[e>>2]|0}function yr(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0,l=0,c=0;c=e+4|0;r=n[c>>2]|0;l=(n[e+8>>2]|0)-r|0;l=l>>>0>s>>>0?s:l;a=e+12|0;A=(n[a>>2]|0)+r|0;o=A+l|0;if(l){r=A;A=t;while(1){i[A>>0]=i[r>>0]|0;r=r+1|0;if((r|0)==(o|0))break;else A=A+1|0}r=n[c>>2]|0}n[c>>2]=r+l;s=s-l|0;if(s|0){Fs(e);A=(n[a>>2]|0)+(n[c>>2]|0)|0;o=A+s|0;r=t+l|0;while(1){i[r>>0]=i[A>>0]|0;A=A+1|0;if((A|0)==(o|0))break;else r=r+1|0}n[c>>2]=(n[c>>2]|0)+s}return}function wr(e,t){e=e|0;t=t|0;cr(e);n[e>>2]=Ir(t)|0;n[e+4>>2]=Ir(t+4|0)|0;n[e+8>>2]=Ir(t+8|0)|0;r[e+12>>1]=Tr(t+12|0)|0;Cr(Pr(t+14|0)|0,e);i[e+15>>0]=Pr(t+15|0)|0;i[e+16>>0]=Sr(t+16|0)|0;i[e+17>>0]=Sr(t+17|0)|0;r[e+18>>1]=Tr(t+18|0)|0;return}function vr(e){e=e|0;return i[e+14>>0]|0}function Cr(e,t){e=e|0;t=t|0;i[t+14>>0]=e;return}function Mr(e){e=e|0;return e&255|0}function Er(e){e=e|0;return n[e+8>>2]|0}function Fr(e,t){e=e|0;t=t|0;var s=0,r=0,A=0,o=0,a=0,l=0,c=0;c=e+20|0;do{if(!(i[c>>0]|0)){l=e+8|0;s=n[l>>2]|0;r=n[t>>2]|0;A=e+4|0;o=n[A>>2]|0;if((s|0)>=(r|0)){if((o|0)<(r|0)){n[e>>2]=o;n[A>>2]=n[t>>2]}else n[e>>2]=r;i[c>>0]=1;break}n[e>>2]=o;n[A>>2]=s;A=e+16|0;o=n[A>>2]|0;a=n[t>>2]|0;s=e+12|0;r=n[s>>2]|0;if((o|0)<(a|0)){n[l>>2]=r;n[s>>2]=o;n[A>>2]=n[t>>2];break}if((r|0)<(a|0)){n[l>>2]=r;n[s>>2]=n[t>>2];break}else{n[l>>2]=a;break}}else{A=n[t>>2]|0;a=e+8|0;s=n[a>>2]|0;o=e+12|0;r=n[o>>2]|0;if((A|0)>=(s|0)){s=e+16|0;if((A|0)<(r|0)){n[s>>2]=r;n[o>>2]=n[t>>2]}else n[s>>2]=A;i[c>>0]=0;break}n[e+16>>2]=r;n[o>>2]=s;s=n[t>>2]|0;r=n[e>>2]|0;A=e+4|0;o=n[A>>2]|0;if((s|0)<(r|0)){n[a>>2]=o;n[A>>2]=r;n[e>>2]=n[t>>2];break}if((s|0)<(o|0)){n[a>>2]=o;n[A>>2]=n[t>>2];break}else{n[a>>2]=s;break}}}while(0);return}function xr(e){e=e|0;return n[e>>2]|0}function Ur(e,t){e=e|0;t=t|0;var s=0;kr(A[e>>0]|A[e+1>>0]<<8|A[e+2>>0]<<16|A[e+3>>0]<<24,t);s=e+4|0;kr(A[s>>0]|A[s+1>>0]<<8|A[s+2>>0]<<16|A[s+3>>0]<<24,t+4|0);s=e+8|0;kr(A[s>>0]|A[s+1>>0]<<8|A[s+2>>0]<<16|A[s+3>>0]<<24,t+8|0);s=e+12|0;Qr(A[s>>0]|A[s+1>>0]<<8,t+12|0);Rr(vr(e)|0,t+14|0);Rr(i[e+15>>0]|0,t+15|0);Or(i[e+16>>0]|0,t+16|0);Or(i[e+17>>0]|0,t+17|0);e=e+18|0;Qr(A[e>>0]|A[e+1>>0]<<8,t+18|0);return}function Ir(e){e=e|0;return Dr(e)|0}function Tr(e){e=e|0;return(i[e+1>>0]<<8|A[e>>0])&65535|0}function Pr(e){e=e|0;return i[e>>0]|0}function Sr(e){e=e|0;return i[e>>0]|0}function Dr(e){e=e|0;return(A[e+1>>0]|0)<<8|(A[e>>0]|0)|(A[e+2>>0]|0)<<16|(A[e+3>>0]|0)<<24|0}function kr(e,t){e=e|0;t=t|0;Vr(e,t);return}function Qr(e,t){e=e|0;t=t|0;i[t+1>>0]=(e&65535)>>>8;i[t>>0]=e;return}function Rr(e,t){e=e|0;t=t|0;i[t>>0]=e;return}function Or(e,t){e=e|0;t=t|0;i[t>>0]=e;return}function Vr(e,t){e=e|0;t=t|0;i[t+3>>0]=e>>>24;i[t+2>>0]=e>>>16;i[t+1>>0]=e>>>8;i[t>>0]=e;return}function Lr(e,t){e=e|0;t=t|0;return}function Hr(e){e=e|0;Ag(e);qp(e);return}function Nr(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function Gr(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==9202?e+12|0:0)|0}function jr(e){e=e|0;Be(e,16);return}function Wr(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=4768;n[e+4>>2]=t;Xr(e+8|0);return}function zr(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4792;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function Xr(e){e=e|0;Yr(e);$r(e+164|0);qr(e+244|0);i[e+324>>0]=0;i[e+325>>0]=0;return}function Kr(e){e=e|0;n[e>>2]=4768;nn(e+8|0);sr(e);return}function Zr(e){e=e|0;Kr(e);qp(e);return}function Jr(e,t){e=e|0;t=t|0;return on(e+8|0,n[e+4>>2]|0,t)|0}function Yr(e){e=e|0;var t=0,s=0,r=0,A=0,o=0,a=0,l=0;o=J;J=J+16|0;r=o;i[e>>0]=0;Ts(e+4|0,516,0,0);Ts(e+48|0,6,0,0);n[e+92>>2]=0;n[e+96>>2]=0;s=e+100|0;sn(s);rn(r);A=n[r>>2]|0;r=n[r+4>>2]|0;t=4;while(1){a=s;l=a;i[l>>0]=A;i[l+1>>0]=A>>8;i[l+2>>0]=A>>16;i[l+3>>0]=A>>24;a=a+4|0;i[a>>0]=r;i[a+1>>0]=r>>8;i[a+2>>0]=r>>16;i[a+3>>0]=r>>24;t=t+-1|0;if(!t)break;else s=s+8|0}l=e+132|0;n[l>>2]=0;n[l+4>>2]=0;n[l+8>>2]=0;n[l+12>>2]=0;n[l+16>>2]=0;n[l+20>>2]=0;n[l+24>>2]=0;n[l+28>>2]=0;J=o;return}function $r(e){e=e|0;pr(e,32,9,8,0);return}function qr(e){e=e|0;is(e,32,9,8,0);return}function en(e){e=e|0;fr(e);return}function tn(e){e=e|0;Ms(e+48|0);Ms(e+4|0);return}function sn(e){e=e|0;var t=0;t=e+32|0;do{rn(e);e=e+8|0}while((e|0)!=(t|0));return}function rn(e){e=e|0;var t=0;t=e;i[t>>0]=0;i[t+1>>0]=0;i[t+2>>0]=0;i[t+3>>0]=0;e=e+4|0;i[e>>0]=0;i[e+1>>0]=0;i[e+2>>0]=0;i[e+3>>0]=0;return}function nn(e){e=e|0;An(e+244|0);en(e+164|0);tn(e);return}function An(e){e=e|0;os(e);return}function on(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,o=0,a=0,l=0,c=0;r=e+325|0;if(!(i[r>>0]|0)){an(e+244|0);i[r>>0]=1}if(!(i[e>>0]|0)){i[e>>0]=1;yr(Br(t)|0,s,8);a=ln(s)|0;l=v()|0;e=e+100|0;t=e;i[t>>0]=a;i[t+1>>0]=a>>8;i[t+2>>0]=a>>16;i[t+3>>0]=a>>24;e=e+4|0;i[e>>0]=l;i[e+1>>0]=l>>8;i[e+2>>0]=l>>16;i[e+3>>0]=l>>24}else{l=e+92|0;e:do{if(!(n[e+132+(n[l>>2]<<2)>>2]|0)){r=Ns(t,e+48|0)|0;switch(r|0){case 1:{t=As(e+244|0,t,0,0)|0;n[e+132+(n[l>>2]<<2)>>2]=t;t=n[l>>2]|0;c=n[e+132+(t<<2)>>2]|0;a=e+100+(t<<3)|0;o=a;r=o;o=o+4|0;c=sm(A[r>>0]|A[r+1>>0]<<8|A[r+2>>0]<<16|A[r+3>>0]<<24|0,A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24|0,c|0,((c|0)<0)<<31>>31|0)|0;o=v()|0;r=a;i[r>>0]=c;i[r+1>>0]=c>>8;i[r+2>>0]=c>>16;i[r+3>>0]=c>>24;a=a+4|0;i[a>>0]=o;i[a+1>>0]=o>>8;i[a+2>>0]=o>>16;i[a+3>>0]=o>>24;n[e+148+(t<<2)>>2]=0;break e}case 2:{c=e+96|0;n[c>>2]=(n[c>>2]|0)+1&3;a=e+100+(n[l>>2]<<3)+4|0;a=As(e+244|0,t,A[a>>0]|A[a+1>>0]<<8|A[a+2>>0]<<16|A[a+3>>0]<<24,8)|0;r=e+100+(n[c>>2]<<3)|0;o=r;i[o>>0]=0;i[o+1>>0]=0;i[o+2>>0]=0;i[o+3>>0]=0;r=r+4|0;i[r>>0]=a;i[r+1>>0]=a>>8;i[r+2>>0]=a>>16;i[r+3>>0]=a>>24;r=cn(t)|0;c=n[c>>2]|0;t=e+100+(c<<3)|0;a=t;o=a;a=a+4|0;a=A[a>>0]|A[a+1>>0]<<8|A[a+2>>0]<<16|A[a+3>>0]<<24;r=A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24|r;o=t;i[o>>0]=r;i[o+1>>0]=r>>8;i[o+2>>0]=r>>16;i[o+3>>0]=r>>24;t=t+4|0;i[t>>0]=a;i[t+1>>0]=a>>8;i[t+2>>0]=a>>16;i[t+3>>0]=a>>24;n[l>>2]=c;n[e+132+(c<<2)>>2]=0;n[e+148+(n[l>>2]<<2)>>2]=0;break e}default:{if((r|0)<=2)break e;n[l>>2]=r+2+(n[l>>2]|0)&3;on(e,t,s)|0;break e}}}else{a=Ns(t,e+4|0)|0;if((a|0)==1){r=As(e+244|0,t,n[e+132+(n[l>>2]<<2)>>2]|0,1)|0;c=n[l>>2]|0;t=e+100+(c<<3)|0;a=t;o=a;a=a+4|0;r=sm(A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24|0,A[a>>0]|A[a+1>>0]<<8|A[a+2>>0]<<16|A[a+3>>0]<<24|0,r|0,((r|0)<0)<<31>>31|0)|0;a=v()|0;o=t;i[o>>0]=r;i[o+1>>0]=r>>8;i[o+2>>0]=r>>16;i[o+3>>0]=r>>24;t=t+4|0;i[t>>0]=a;i[t+1>>0]=a>>8;i[t+2>>0]=a>>16;i[t+3>>0]=a>>24;n[e+148+(c<<2)>>2]=0;break}if((a|0)>=511){if((a|0)==512){c=e+96|0;n[c>>2]=(n[c>>2]|0)+1&3;a=e+100+(n[l>>2]<<3)+4|0;a=As(e+244|0,t,A[a>>0]|A[a+1>>0]<<8|A[a+2>>0]<<16|A[a+3>>0]<<24,8)|0;r=e+100+(n[c>>2]<<3)|0;o=r;i[o>>0]=0;i[o+1>>0]=0;i[o+2>>0]=0;i[o+3>>0]=0;r=r+4|0;i[r>>0]=a;i[r+1>>0]=a>>8;i[r+2>>0]=a>>16;i[r+3>>0]=a>>24;r=cn(t)|0;c=n[c>>2]|0;t=e+100+(c<<3)|0;a=t;o=a;a=a+4|0;a=A[a>>0]|A[a+1>>0]<<8|A[a+2>>0]<<16|A[a+3>>0]<<24;r=A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24|r;o=t;i[o>>0]=r;i[o+1>>0]=r>>8;i[o+2>>0]=r>>16;i[o+3>>0]=r>>24;t=t+4|0;i[t>>0]=a;i[t+1>>0]=a>>8;i[t+2>>0]=a>>16;i[t+3>>0]=a>>24;n[l>>2]=c;n[e+132+(c<<2)>>2]=0;n[e+148+(n[l>>2]<<2)>>2]=0;break}if((a|0)<=511)break;n[l>>2]=(n[l>>2]|0)+a&3;on(e,t,s)|0;break}do{if(!a){r=As(e+244|0,t,0,7)|0;o=e+148+(n[l>>2]<<2)|0;n[o>>2]=(n[o>>2]|0)+1;o=n[l>>2]|0;if((n[e+148+(o<<2)>>2]|0)>3){n[e+132+(o<<2)>>2]=r;n[e+148+(n[l>>2]<<2)>>2]=0}}else{if((a|0)<500){r=e+244|0;o=b(n[e+132+(n[l>>2]<<2)>>2]|0,a)|0;if((a|0)<10){r=As(r,t,o,2)|0;break}else{r=As(r,t,o,3)|0;break}}if((a|0)==500){r=As(e+244|0,t,(n[e+132+(n[l>>2]<<2)>>2]|0)*500|0,4)|0;o=e+148+(n[l>>2]<<2)|0;n[o>>2]=(n[o>>2]|0)+1;o=n[l>>2]|0;if((n[e+148+(o<<2)>>2]|0)<=3)break;n[e+132+(o<<2)>>2]=r;n[e+148+(n[l>>2]<<2)>>2]=0;break}r=500-a|0;o=e+244|0;a=n[e+132+(n[l>>2]<<2)>>2]|0;if((r|0)>-10){r=As(o,t,b(a,r)|0,5)|0;break}r=As(o,t,b(a,-10)|0,6)|0;o=e+148+(n[l>>2]<<2)|0;n[o>>2]=(n[o>>2]|0)+1;o=n[l>>2]|0;if((n[e+148+(o<<2)>>2]|0)>3){n[e+132+(o<<2)>>2]=r;n[e+148+(n[l>>2]<<2)>>2]=0}}}while(0);c=e+100+(n[l>>2]<<3)|0;o=c;t=o;o=o+4|0;o=sm(A[t>>0]|A[t+1>>0]<<8|A[t+2>>0]<<16|A[t+3>>0]<<24|0,A[o>>0]|A[o+1>>0]<<8|A[o+2>>0]<<16|A[o+3>>0]<<24|0,r|0,((r|0)<0)<<31>>31|0)|0;t=v()|0;a=c;i[a>>0]=o;i[a+1>>0]=o>>8;i[a+2>>0]=o>>16;i[a+3>>0]=o>>24;c=c+4|0;i[c>>0]=t;i[c+1>>0]=t>>8;i[c+2>>0]=t>>16;i[c+3>>0]=t>>24}}while(0);hn(e+100+(n[l>>2]<<3)|0,s)}return s+8|0}function an(e){e=e|0;ns(e);return}function ln(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;i=Dr(e)|0;un(s,i,Dr(e+4|0)|0);e=n[s>>2]|0;w(n[s+4>>2]|0);J=t;return e|0}function cn(e){e=e|0;var t=0;t=(zs(e)|0)&65535;return((zs(e)|0)&65535)<<16|t|0}function hn(e,t){e=e|0;t=t|0;var s=0;s=e;Vr(A[s>>0]|A[s+1>>0]<<8|A[s+2>>0]<<16|A[s+3>>0]<<24,t);e=e+4|0;Vr(A[e>>0]|A[e+1>>0]<<8|A[e+2>>0]<<16|A[e+3>>0]<<24,t+4|0);return}function un(e,t,s){e=e|0;t=t|0;s=s|0;var r=0;r=e;i[r>>0]=t;i[r+1>>0]=t>>8;i[r+2>>0]=t>>16;i[r+3>>0]=t>>24;t=e+4|0;i[t>>0]=s;i[t+1>>0]=s>>8;i[t+2>>0]=s>>16;i[t+3>>0]=s>>24;return}function dn(e){e=e|0;Ag(e);qp(e);return}function pn(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function fn(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==9890?e+12|0:0)|0}function gn(e){e=e|0;Be(e,16);return}function mn(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=4820;n[e+4>>2]=t;bn(e+8|0);return}function _n(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4844;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function bn(e){e=e|0;i[e>>0]=0;vn(e+1|0);Ts(e+8|0,128,0,0);Ts(e+52|0,256,0,0);Ts(e+96|0,256,0,0);Ts(e+140|0,256,0,0);Ts(e+184|0,256,0,0);Ts(e+228|0,256,0,0);Ts(e+272|0,256,0,0);return}function Bn(e){e=e|0;n[e>>2]=4820;Cn(e+8|0);sr(e);return}function yn(e){e=e|0;Bn(e);qp(e);return}function wn(e,t){e=e|0;t=t|0;return Mn(e+8|0,n[e+4>>2]|0,t)|0}function vn(e){e=e|0;var t=0;i[e>>0]=0;i[e+1>>0]=0;t=e+2|0;i[t>>0]=0;i[t+1>>0]=0;e=e+4|0;i[e>>0]=0;i[e+1>>0]=0;return}function Cn(e){e=e|0;Ms(e+272|0);Ms(e+228|0);Ms(e+184|0);Ms(e+140|0);Ms(e+96|0);Ms(e+52|0);Ms(e+8|0);return}function Mn(e,t,s){e=e|0;t=t|0;s=s|0;var n=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0;p=J;J=J+16|0;u=p;if(!(i[e>>0]|0)){i[e>>0]=1;yr(Br(t)|0,s,6);En(u,s);d=e+1|0;i[d>>0]=i[u>>0]|0;i[d+1>>0]=i[u+1>>0]|0;i[d+2>>0]=i[u+2>>0]|0;i[d+3>>0]=i[u+3>>0]|0;i[d+4>>0]=i[u+4>>0]|0;i[d+5>>0]=i[u+5>>0]|0}else{d=Ns(t,e+8|0)|0;vn(u);if(!(d&1)){n=e+1|0;n=(A[n>>0]|A[n+1>>0]<<8)&255}else{h=(Ns(t,e+52|0)|0)&255;n=e+1|0;n=(Mr(h+((A[n>>0]|A[n+1>>0]<<8)&255)|0)|0)&255}r[u>>1]=n;if(!(d&2)){h=e+1|0;n=n|(A[h>>0]|A[h+1>>0]<<8)&-256}else{n=(Ns(t,e+96|0)|0)&255;h=e+1|0;n=((Mr((((A[h>>0]|A[h+1>>0]<<8)&65535)>>>8)+n|0)|0)&255)<<8;n=(n|o[u>>1])&65535}r[u>>1]=n;do{if(d&64){c=e+1|0;a=(n&255)-((A[c>>0]|A[c+1>>0]<<8)&255)|0;if(!(d&4)){n=e+3|0;n=(A[n>>0]|A[n+1>>0]<<8)&255}else{n=(Ns(t,e+140|0)|0)&255;h=e+3|0;h=a+((A[h>>0]|A[h+1>>0]<<8)&255)|0;n=(Mr(((h|0)<1?0:(h|0)>254?255:h&255)+n|0)|0)&255}h=u+2|0;r[h>>1]=n;if(!(d&16)){n=e+5|0;n=(A[n>>0]|A[n+1>>0]<<8)&255}else{n=Ns(t,e+228|0)|0;f=e+3|0;l=e+5|0;l=((a+(r[h>>1]&255)-((A[f>>0]|A[f+1>>0]<<8)&255)|0)/2|0)+((A[l>>0]|A[l+1>>0]<<8)&255)|0;n=(Mr(((l|0)<1?0:(l|0)>254?255:l&255)+(n&255)|0)|0)&255}l=u+4|0;r[l>>1]=n;n=((o[u>>1]|0)>>>8)-(((A[c>>0]|A[c+1>>0]<<8)&65535)>>>8)|0;if(!(d&8)){a=e+3|0;a=r[h>>1]|(A[a>>0]|A[a+1>>0]<<8)&-256}else{a=(Ns(t,e+184|0)|0)&255;f=e+3|0;f=(((A[f>>0]|A[f+1>>0]<<8)&65535)>>>8)+n|0;a=((Mr(((f|0)<1?0:(f|0)>254?255:f&255)+a|0)|0)&255)<<8;a=(a|o[h>>1])&65535}r[h>>1]=a;if(!(d&32)){f=e+5|0;r[l>>1]=r[l>>1]|(A[f>>0]|A[f+1>>0]<<8)&-256;break}else{f=Ns(t,e+272|0)|0;t=e+3|0;d=e+5|0;d=((((o[h>>1]|0)>>>8)+n-(((A[t>>0]|A[t+1>>0]<<8)&65535)>>>8)|0)/2|0)+(((A[d>>0]|A[d+1>>0]<<8)&65535)>>>8)|0;f=((Mr(((d|0)<1?0:(d|0)>254?255:d&255)+(f&255)|0)|0)&255)<<8;r[l>>1]=f|o[l>>1];break}}else{r[u+2>>1]=n;r[u+4>>1]=n}}while(0);f=e+1|0;i[f>>0]=i[u>>0]|0;i[f+1>>0]=i[u+1>>0]|0;i[f+2>>0]=i[u+2>>0]|0;i[f+3>>0]=i[u+3>>0]|0;i[f+4>>0]=i[u+4>>0]|0;i[f+5>>0]=i[u+5>>0]|0;Fn(f,s)}J=p;return s+6|0}function En(e,t){e=e|0;t=t|0;var s=0,i=0;i=Tr(t)|0;s=Tr(t+2|0)|0;xn(e,i,s,Tr(t+4|0)|0);return}function Fn(e,t){e=e|0;t=t|0;var s=0;Qr(A[e>>0]|A[e+1>>0]<<8,t);s=e+2|0;Qr(A[s>>0]|A[s+1>>0]<<8,t+2|0);e=e+4|0;Qr(A[e>>0]|A[e+1>>0]<<8,t+4|0);return}function xn(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;i[e>>0]=t;i[e+1>>0]=t>>8;t=e+2|0;i[t>>0]=s;i[t+1>>0]=s>>8;s=e+4|0;i[s>>0]=r;i[s+1>>0]=r>>8;return}function Un(e){e=e|0;Ag(e);qp(e);return}function In(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function Tn(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==10570?e+12|0:0)|0}function Pn(e){e=e|0;Be(e,16);return}function Sn(e,t,s){e=e|0;t=t|0;s=s|0;Ji(e);n[e>>2]=4872;n[e+4>>2]=t;kn(e+8|0,s);return}function Dn(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4896;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function kn(e,t){e=e|0;t=t|0;n[e>>2]=n[t>>2];i[e+4>>0]=i[t+4>>0]|0;Vn(e+8|0,t+8|0);Vn(e+20|0,t+20|0);Ln(e+32|0,t+32|0);return}function Qn(e){e=e|0;n[e>>2]=4872;hi(e+8|0);sr(e);return}function Rn(e){e=e|0;Qn(e);qp(e);return}function On(e,t){e=e|0;t=t|0;return BA(e+8|0,n[e+4>>2]|0,t)|0}function Vn(e,t){e=e|0;t=t|0;var s=0,i=0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;s=t+4|0;i=(n[s>>2]|0)-(n[t>>2]|0)|0;if(i|0){Hn(e,i);Nn(e,n[t>>2]|0,n[s>>2]|0,i)}return}function Ln(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+32|0;i=s+24|0;r=s+16|0;o=s+8|0;A=s;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=0;n[e+16>>2]=0;n[e+20>>2]=0;gA(o,t);mA(A,t);n[r>>2]=n[o>>2];n[r+4>>2]=n[o+4>>2];n[i>>2]=n[A>>2];n[i+4>>2]=n[A+4>>2];Xn(e,r,i,0);J=s;return}function Hn(e,t){e=e|0;t=t|0;var s=0;if((jn(e)|0)>>>0<t>>>0)Xg(e);else{s=Zf(t)|0;n[e+4>>2]=s;n[e>>2]=s;n[e+8>>2]=s+t;return}}function Nn(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0;A=J;J=J+16|0;r=A;Wn(r,e,i);i=r+4|0;e=s-t|0;if((e|0)>0){hm(n[i>>2]|0,t|0,e|0)|0;n[i>>2]=(n[i>>2]|0)+e}zn(r);J=A;return}function Gn(e){e=e|0;var t=0,s=0;t=n[e>>2]|0;s=t;if(t|0){n[e+4>>2]=s;Be(t,(n[e+8>>2]|0)-s|0)}return}function jn(e){e=e|0;return 2147483647}function Wn(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;t=n[t+4>>2]|0;n[e+4>>2]=t;n[e+8>>2]=t+s;return}function zn(e){e=e|0;n[(n[e>>2]|0)+4>>2]=n[e+4>>2];return}function Xn(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;g=J;J=J+96|0;f=g+80|0;u=g+64|0;l=g+48|0;c=g+40|0;h=g+8|0;a=g;d=g+32|0;p=g+16|0;o=t;A=n[o>>2]|0;o=n[o+4>>2]|0;r=s;s=n[r>>2]|0;r=n[r+4>>2]|0;i=A;if((r|0)==(o|0))o=0;else o=((r-(n[s>>2]|0)|0)/44|0)+((s-A>>2)*93|0)+((o-(n[A>>2]|0)|0)/-44|0)|0;s=(n[e+8>>2]|0)-(n[e+4>>2]|0)|0;s=((s|0)==0?0:((s>>2)*93|0)+-1|0)-((n[e+20>>2]|0)+(n[e+16>>2]|0))|0;if(o>>>0>s>>>0)Zn(e,o-s|0);Jn(c,e);Jn(a,e);r=a;s=n[r>>2]|0;r=n[r+4>>2]|0;A=h;n[A>>2]=s;n[A+4>>2]=r;A=s;if(o|0){s=((r-(n[s>>2]|0)|0)/44|0)+o|0;if((s|0)>0){a=(s>>>0)/93|0;o=A+(a<<2)|0;n[h>>2]=o;s=(n[o>>2]|0)+((s-(a*93|0)|0)*44|0)|0}else{s=92-s|0;a=A+(((s|0)/-93|0)<<2)|0;n[h>>2]=a;s=(n[a>>2]|0)+((92-((s|0)%93|0)|0)*44|0)|0}n[h+4>>2]=s}n[u>>2]=n[c>>2];n[u+4>>2]=n[c+4>>2];n[f>>2]=n[h>>2];n[f+4>>2]=n[h+4>>2];Yn(l,u,f);$n(f,l);qn(u,l);if(eA(f,u)|0){A=p+4|0;o=t+4|0;do{tA(d,f);sA(p,e,d);s=n[p>>2]|0;if((s|0)!=(n[A>>2]|0)){r=n[o>>2]|0;do{Vs(s,r);s=(n[p>>2]|0)+44|0;n[p>>2]=s;r=r+44|0;n[o>>2]=r;if((r-(n[i>>2]|0)|0)==4092){i=i+4|0;n[t>>2]=i;r=n[i>>2]|0;n[o>>2]=r}}while((s|0)!=(n[A>>2]|0))}iA(p);rA(f)|0}while(eA(f,u)|0)}J=g;return}function Kn(e){e=e|0;var t=0,s=0,i=0;t=n[e+4>>2]|0;s=e+8|0;i=n[s>>2]|0;if((i|0)!=(t|0))n[s>>2]=i+(~((i+-4-t|0)>>>2)<<2);t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function Zn(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0,m=0,_=0,B=0,y=0,w=0,v=0,C=0,M=0,E=0,F=0,x=0;F=J;J=J+64|0;y=F+52|0;B=F+48|0;w=F+28|0;v=F+24|0;C=F+20|0;f=F;M=e+8|0;s=n[M>>2]|0;E=e+4|0;l=n[E>>2]|0;m=((s|0)==(l|0)&1)+t|0;o=(m>>>0)/93|0;o=o+((m-(o*93|0)|0)!=0&1)|0;m=e+16|0;i=n[m>>2]|0;a=(i>>>0)/93|0;g=o>>>0<a>>>0?o:a;t=o-g|0;A=s;e:do{if(!t){n[m>>2]=(b(g,-93)|0)+i;if(g|0){a=e+12|0;c=e+12|0;h=w+4|0;u=w+8|0;d=w+12|0;t=g;i=l;while(1){o=n[i>>2]|0;A=i+4|0;n[E>>2]=A;_=n[a>>2]|0;i=_;do{if((s|0)==(_|0)){_=n[e>>2]|0;s=_;if(A>>>0<=_>>>0){s=i-s|0;s=(s|0)==0?1:s>>1;oA(w,s,s>>>2,c);n[v>>2]=n[E>>2];n[C>>2]=n[M>>2];n[B>>2]=n[v>>2];n[y>>2]=n[C>>2];hA(w,B,y);s=n[e>>2]|0;n[e>>2]=n[w>>2];n[w>>2]=s;s=n[E>>2]|0;n[E>>2]=n[h>>2];n[h>>2]=s;s=n[M>>2]|0;n[M>>2]=n[u>>2];n[u>>2]=s;s=n[a>>2]|0;n[a>>2]=n[d>>2];n[d>>2]=s;cA(w);s=n[M>>2]|0;break}_=A;s=((_-s>>2)+1|0)/-2|0;r=A+(s<<2)|0;i=i-_|0;if(!i)s=r;else{um(r|0,A|0,i|0)|0;s=(n[E>>2]|0)+(s<<2)|0}_=r+(i>>2<<2)|0;n[M>>2]=_;n[E>>2]=s;s=_}}while(0);n[s>>2]=o;s=(n[M>>2]|0)+4|0;n[M>>2]=s;t=t+-1|0;if(!t)break e;i=n[E>>2]|0}}}else{_=e+12|0;i=n[_>>2]|0;r=i-(n[e>>2]|0)|0;s=A-l>>2;if(t>>>0>((r>>2)-s|0)>>>0){p=r>>1;d=s+t|0;oA(f,p>>>0<d>>>0?d:p,s-g|0,e+12|0);do{n[y>>2]=Zf(4092)|0;aA(f,y);t=t+-1|0}while((t|0)!=0);if(!g)s=n[E>>2]|0;else{a=f+8|0;l=f+12|0;c=f+4|0;h=f+16|0;u=w+4|0;d=w+8|0;p=w+12|0;o=g;t=n[a>>2]|0;s=n[E>>2]|0;do{A=n[l>>2]|0;i=A;do{if((t|0)==(A|0)){r=n[c>>2]|0;A=n[f>>2]|0;t=A;if(r>>>0<=A>>>0){t=i-t|0;t=(t|0)==0?1:t>>1;oA(w,t,t>>>2,n[h>>2]|0);n[v>>2]=n[c>>2];n[C>>2]=n[a>>2];n[B>>2]=n[v>>2];n[y>>2]=n[C>>2];hA(w,B,y);t=n[f>>2]|0;n[f>>2]=n[w>>2];n[w>>2]=t;t=n[c>>2]|0;n[c>>2]=n[u>>2];n[u>>2]=t;t=n[a>>2]|0;n[a>>2]=n[d>>2];n[d>>2]=t;t=n[l>>2]|0;n[l>>2]=n[p>>2];n[p>>2]=t;cA(w);t=n[a>>2]|0;break}x=r;t=((x-t>>2)+1|0)/-2|0;A=r+(t<<2)|0;i=i-x|0;if(!i)t=A;else{um(A|0,r|0,i|0)|0;t=(n[c>>2]|0)+(t<<2)|0}x=A+(i>>2<<2)|0;n[a>>2]=x;n[c>>2]=t;t=x}}while(0);n[t>>2]=n[s>>2];t=(n[a>>2]|0)+4|0;n[a>>2]=t;s=(n[E>>2]|0)+4|0;n[E>>2]=s;o=o+-1|0}while((o|0)!=0)}t=n[M>>2]|0;if((t|0)!=(s|0)){do{t=t+-4|0;lA(f,t);s=n[E>>2]|0}while((t|0)!=(s|0));t=n[M>>2]|0}x=n[e>>2]|0;n[e>>2]=n[f>>2];n[f>>2]=x;x=f+4|0;n[E>>2]=n[x>>2];n[x>>2]=s;x=f+8|0;n[M>>2]=n[x>>2];n[x>>2]=t;x=f+12|0;E=n[_>>2]|0;n[_>>2]=n[x>>2];n[x>>2]=E;n[m>>2]=(n[m>>2]|0)+(b(g,-93)|0);cA(f);break}else{t:do{if((i|0)==(A|0))c=18;else{while(1){n[y>>2]=Zf(4092)|0;nA(e,y);t=t+-1|0;if(!t)break;if((n[_>>2]|0)==(n[M>>2]|0)){c=18;break t}}s=g;t=n[m>>2]|0}}while(0);if((c|0)==18){i=~(o>>>0>a>>>0?a:o);s=t;do{n[y>>2]=Zf(4092)|0;AA(e,y);s=s+-1|0;r=(((n[M>>2]|0)-(n[E>>2]|0)|0)==4?92:93)+(n[m>>2]|0)|0;n[m>>2]=r}while((s|0)!=0);s=t+-1-i|0;t=r}n[m>>2]=t+(b(s,-93)|0);if(!s)break;a=e+12|0;l=w+4|0;c=w+8|0;h=w+12|0;t=n[M>>2]|0;do{A=n[E>>2]|0;o=n[A>>2]|0;A=A+4|0;n[E>>2]=A;x=n[_>>2]|0;i=x;do{if((t|0)==(x|0)){x=n[e>>2]|0;t=x;if(A>>>0<=x>>>0){t=i-t|0;t=(t|0)==0?1:t>>1;oA(w,t,t>>>2,a);n[v>>2]=n[E>>2];n[C>>2]=n[M>>2];n[B>>2]=n[v>>2];n[y>>2]=n[C>>2];hA(w,B,y);t=n[e>>2]|0;n[e>>2]=n[w>>2];n[w>>2]=t;t=n[E>>2]|0;n[E>>2]=n[l>>2];n[l>>2]=t;t=n[M>>2]|0;n[M>>2]=n[c>>2];n[c>>2]=t;t=n[_>>2]|0;n[_>>2]=n[h>>2];n[h>>2]=t;cA(w);t=n[M>>2]|0;break}x=A;t=((x-t>>2)+1|0)/-2|0;r=A+(t<<2)|0;i=i-x|0;if(!i)t=r;else{um(r|0,A|0,i|0)|0;t=(n[E>>2]|0)+(t<<2)|0}x=r+(i>>2<<2)|0;n[M>>2]=x;n[E>>2]=t;t=x}}while(0);n[t>>2]=o;t=(n[M>>2]|0)+4|0;n[M>>2]=t;s=s+-1|0}while((s|0)!=0)}}}while(0);J=F;return}function Jn(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;s=(n[t+16>>2]|0)+(n[t+20>>2]|0)|0;A=n[t+4>>2]|0;i=(s>>>0)/93|0;r=A+(i<<2)|0;if((n[t+8>>2]|0)==(A|0))t=0;else t=(n[r>>2]|0)+((s-(i*93|0)|0)*44|0)|0;n[e>>2]=r;n[e+4>>2]=t;return}function Yn(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;r=t;t=n[r+4>>2]|0;i=e;n[i>>2]=n[r>>2];n[i+4>>2]=t;i=s;t=n[i+4>>2]|0;s=e+8|0;n[s>>2]=n[i>>2];n[s+4>>2]=t;return}function $n(e,t){e=e|0;t=t|0;n[e>>2]=n[t>>2];n[e+4>>2]=n[t+4>>2];n[e+8>>2]=n[t+8>>2];n[e+12>>2]=n[t+12>>2];return}function qn(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0;s=J;J=J+32|0;i=s+24|0;r=s+16|0;o=s+8|0;A=s;a=t+8|0;l=n[a>>2]|0;a=n[a+4>>2]|0;t=o;n[t>>2]=l;n[t+4>>2]=a;t=A;n[t>>2]=l;n[t+4>>2]=a;n[r>>2]=n[o>>2];n[r+4>>2]=n[o+4>>2];n[i>>2]=n[A>>2];n[i+4>>2]=n[A+4>>2];Yn(e,r,i);J=s;return}function eA(e,t){e=e|0;t=t|0;return(pA(e,t)|0)^1|0}function tA(e,t){e=e|0;t=t|0;var s=0,i=0;s=n[t>>2]|0;i=n[t+4>>2]|0;if((s|0)==(n[t+8>>2]|0))fA(e,i,n[t+12>>2]|0);else fA(e,i,(n[s>>2]|0)+4092|0);return}function sA(e,t,s){e=e|0;t=t|0;s=s|0;var i=0;i=n[s>>2]|0;n[e>>2]=i;n[e+4>>2]=n[s+4>>2];n[e+8>>2]=i;n[e+12>>2]=t;return}function iA(e){e=e|0;var t=0;t=(n[e+12>>2]|0)+20|0;n[t>>2]=(n[t>>2]|0)+(((n[e>>2]|0)-(n[e+8>>2]|0)|0)/44|0);return}function rA(e){e=e|0;var t=0,s=0,i=0;t=n[e>>2]|0;s=e+8|0;if((t|0)==(n[s>>2]|0)){i=s;t=n[i+4>>2]|0;s=e;n[s>>2]=n[i>>2];n[s+4>>2]=t}else{i=t+4|0;n[e>>2]=i;n[e+4>>2]=n[i>>2]}return e|0}function nA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;f=J;J=J+48|0;r=f+32|0;i=f+28|0;a=f+8|0;l=f+4|0;c=f;p=e+8|0;s=n[p>>2]|0;h=e+12|0;d=n[h>>2]|0;A=d;do{if((s|0)==(d|0)){d=e+4|0;u=n[d>>2]|0;g=n[e>>2]|0;o=g;if(u>>>0<=g>>>0){s=A-o|0;s=(s|0)==0?1:s>>1;oA(a,s,s>>>2,e+12|0);n[l>>2]=n[d>>2];n[c>>2]=n[p>>2];n[i>>2]=n[l>>2];n[r>>2]=n[c>>2];hA(a,i,r);s=n[e>>2]|0;n[e>>2]=n[a>>2];n[a>>2]=s;s=a+4|0;g=n[d>>2]|0;n[d>>2]=n[s>>2];n[s>>2]=g;s=a+8|0;g=n[p>>2]|0;n[p>>2]=n[s>>2];n[s>>2]=g;s=a+12|0;g=n[h>>2]|0;n[h>>2]=n[s>>2];n[s>>2]=g;cA(a);s=n[p>>2]|0;break}r=u;i=((r-o>>2)+1|0)/-2|0;e=u+(i<<2)|0;r=s-r|0;if(!r)s=e;else{um(e|0,u|0,r|0)|0;s=(n[d>>2]|0)+(i<<2)|0}g=e+(r>>2<<2)|0;n[p>>2]=g;n[d>>2]=s;s=g}}while(0);n[s>>2]=n[t>>2];n[p>>2]=(n[p>>2]|0)+4;J=f;return}function AA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;f=J;J=J+48|0;i=f+32|0;s=f+28|0;o=f+8|0;a=f+4|0;l=f;p=e+4|0;u=n[p>>2]|0;d=n[e>>2]|0;c=d;do{if((u|0)==(d|0)){d=e+8|0;h=n[d>>2]|0;A=e+12|0;g=n[A>>2]|0;r=g;if(h>>>0>=g>>>0){g=r-c|0;g=(g|0)==0?1:g>>1;oA(o,g,(g+3|0)>>>2,e+12|0);n[a>>2]=n[p>>2];n[l>>2]=n[d>>2];n[s>>2]=n[a>>2];n[i>>2]=n[l>>2];hA(o,s,i);s=n[e>>2]|0;n[e>>2]=n[o>>2];n[o>>2]=s;s=o+4|0;g=n[p>>2]|0;n[p>>2]=n[s>>2];n[s>>2]=g;s=o+8|0;g=n[d>>2]|0;n[d>>2]=n[s>>2];n[s>>2]=g;s=o+12|0;g=n[A>>2]|0;n[A>>2]=n[s>>2];n[s>>2]=g;cA(o);s=n[p>>2]|0;break}i=h;e=((r-i>>2)+1|0)/2|0;r=h+(e<<2)|0;i=i-u|0;s=r+(0-(i>>2)<<2)|0;if(!i){s=r;i=r}else{um(s|0,u|0,i|0)|0;i=(n[d>>2]|0)+(e<<2)|0}n[p>>2]=s;n[d>>2]=i}else s=u}while(0);n[s+-4>>2]=n[t>>2];n[p>>2]=(n[p>>2]|0)+-4;J=f;return}function oA(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;r=e+12|0;n[r>>2]=0;n[e+16>>2]=i;do{if(t)if(t>>>0>1073741823){r=C(8)|0;ug(r,6723);n[r>>2]=5956;E(r|0,3928,123)}else{i=Zf(t<<2)|0;break}else i=0}while(0);n[e>>2]=i;s=i+(s<<2)|0;n[e+8>>2]=s;n[e+4>>2]=s;n[r>>2]=i+(t<<2);return}function aA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;f=J;J=J+48|0;r=f+32|0;i=f+28|0;a=f+8|0;l=f+4|0;c=f;p=e+8|0;s=n[p>>2]|0;h=e+12|0;d=n[h>>2]|0;A=d;do{if((s|0)==(d|0)){d=e+4|0;u=n[d>>2]|0;g=n[e>>2]|0;o=g;if(u>>>0<=g>>>0){s=A-o|0;s=(s|0)==0?1:s>>1;oA(a,s,s>>>2,n[e+16>>2]|0);n[l>>2]=n[d>>2];n[c>>2]=n[p>>2];n[i>>2]=n[l>>2];n[r>>2]=n[c>>2];hA(a,i,r);s=n[e>>2]|0;n[e>>2]=n[a>>2];n[a>>2]=s;s=a+4|0;g=n[d>>2]|0;n[d>>2]=n[s>>2];n[s>>2]=g;s=a+8|0;g=n[p>>2]|0;n[p>>2]=n[s>>2];n[s>>2]=g;s=a+12|0;g=n[h>>2]|0;n[h>>2]=n[s>>2];n[s>>2]=g;cA(a);s=n[p>>2]|0;break}r=u;i=((r-o>>2)+1|0)/-2|0;e=u+(i<<2)|0;r=s-r|0;if(!r)s=e;else{um(e|0,u|0,r|0)|0;s=(n[d>>2]|0)+(i<<2)|0}g=e+(r>>2<<2)|0;n[p>>2]=g;n[d>>2]=s;s=g}}while(0);n[s>>2]=n[t>>2];n[p>>2]=(n[p>>2]|0)+4;J=f;return}function lA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0;f=J;J=J+48|0;i=f+32|0;s=f+28|0;o=f+8|0;a=f+4|0;l=f;p=e+4|0;u=n[p>>2]|0;d=n[e>>2]|0;c=d;do{if((u|0)==(d|0)){d=e+8|0;h=n[d>>2]|0;A=e+12|0;g=n[A>>2]|0;r=g;if(h>>>0>=g>>>0){g=r-c|0;g=(g|0)==0?1:g>>1;oA(o,g,(g+3|0)>>>2,n[e+16>>2]|0);n[a>>2]=n[p>>2];n[l>>2]=n[d>>2];n[s>>2]=n[a>>2];n[i>>2]=n[l>>2];hA(o,s,i);s=n[e>>2]|0;n[e>>2]=n[o>>2];n[o>>2]=s;s=o+4|0;g=n[p>>2]|0;n[p>>2]=n[s>>2];n[s>>2]=g;s=o+8|0;g=n[d>>2]|0;n[d>>2]=n[s>>2];n[s>>2]=g;s=o+12|0;g=n[A>>2]|0;n[A>>2]=n[s>>2];n[s>>2]=g;cA(o);s=n[p>>2]|0;break}i=h;e=((r-i>>2)+1|0)/2|0;r=h+(e<<2)|0;i=i-u|0;s=r+(0-(i>>2)<<2)|0;if(!i){s=r;i=r}else{um(s|0,u|0,i|0)|0;i=(n[d>>2]|0)+(e<<2)|0}n[p>>2]=s;n[d>>2]=i}else s=u}while(0);n[s+-4>>2]=n[t>>2];n[p>>2]=(n[p>>2]|0)+-4;J=f;return}function cA(e){e=e|0;var t=0,s=0,i=0;t=n[e+4>>2]|0;s=e+8|0;i=n[s>>2]|0;if((i|0)!=(t|0))n[s>>2]=i+(~((i+-4-t|0)>>>2)<<2);t=n[e>>2]|0;if(t|0)Be(t,(n[e+12>>2]|0)-t|0);return}function hA(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0;o=J;J=J+16|0;A=o;r=n[t>>2]|0;uA(A,e+8|0,(n[s>>2]|0)-r>>2);e=n[A>>2]|0;i=A+4|0;if((e|0)!=(n[i>>2]|0)){s=r;do{n[e>>2]=n[s>>2];e=(n[A>>2]|0)+4|0;n[A>>2]=e;s=s+4|0}while((e|0)!=(n[i>>2]|0));n[t>>2]=s}dA(A);J=o;return}function uA(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=n[t>>2];n[e+4>>2]=(n[t>>2]|0)+(s<<2);n[e+8>>2]=t;return}function dA(e){e=e|0;n[n[e+8>>2]>>2]=n[e>>2];return}function pA(e,t){e=e|0;t=t|0;return(n[e+4>>2]|0)==(n[t+4>>2]|0)|0}function fA(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;n[e+4>>2]=s;return}function gA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;A=n[t+4>>2]|0;s=n[t+16>>2]|0;i=(s>>>0)/93|0;r=A+(i<<2)|0;if((n[t+8>>2]|0)==(A|0))t=0;else t=(n[r>>2]|0)+((s-(i*93|0)|0)*44|0)|0;n[e>>2]=r;n[e+4>>2]=t;return}function mA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;s=(n[t+16>>2]|0)+(n[t+20>>2]|0)|0;A=n[t+4>>2]|0;i=(s>>>0)/93|0;r=A+(i<<2)|0;if((n[t+8>>2]|0)==(A|0))t=0;else t=(n[r>>2]|0)+((s-(i*93|0)|0)*44|0)|0;n[e>>2]=r;n[e+4>>2]=t;return}function _A(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0;a=J;J=J+16|0;i=a+8|0;A=a;bA(i,e);Jn(A,e);r=i+4|0;t=n[r>>2]|0;A=A+4|0;if((t|0)!=(n[A>>2]|0))do{Ms(t);t=(n[r>>2]|0)+44|0;n[r>>2]=t;s=n[i>>2]|0;if((t-(n[s>>2]|0)|0)==4092){t=s+4|0;n[i>>2]=t;t=n[t>>2]|0;n[r>>2]=t}}while((t|0)!=(n[A>>2]|0));n[e+20>>2]=0;r=e+8|0;i=e+4|0;s=n[i>>2]|0;t=(n[r>>2]|0)-s>>2;if(t>>>0>2)do{Be(n[s>>2]|0,4092);s=(n[i>>2]|0)+4|0;n[i>>2]=s;t=(n[r>>2]|0)-s>>2}while(t>>>0>2);switch(t|0){case 1:{t=46;o=11;break}case 2:{t=93;o=11;break}default:{}}if((o|0)==11)n[e+16>>2]=t;J=a;return}function bA(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;A=n[t+4>>2]|0;s=n[t+16>>2]|0;i=(s>>>0)/93|0;r=A+(i<<2)|0;if((n[t+8>>2]|0)==(A|0))t=0;else t=(n[r>>2]|0)+((s-(i*93|0)|0)*44|0)|0;n[e>>2]=r;n[e+4>>2]=t;return}function BA(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,o=0,a=0,l=0,c=0,h=0,u=0;u=J;J=J+16|0;h=u;l=e+4|0;if(!(i[l>>0]|0)){h=Br(t)|0;yr(h,s,n[e>>2]|0);h=n[e>>2]|0;a=s+h|0;if(!h)r=0;else{r=s;o=n[e+8>>2]|0;while(1){i[o>>0]=i[r>>0]|0;r=r+1|0;if((r|0)==(a|0))break;else o=o+1|0}r=n[e>>2]|0}i[l>>0]=1;s=s+r|0}else{o=n[e+20>>2]|0;r=n[e+8>>2]|0;bA(h,e+32|0);e=e+12|0;if((r|0)!=(n[e>>2]|0)){c=h+4|0;l=r;a=o;r=n[c>>2]|0;while(1){o=A[l>>0]|0;o=yA((Ns(t,r)|0)+o|0)|0;i[a>>0]=o;i[s>>0]=o;i[l>>0]=o;l=l+1|0;s=s+1|0;o=n[h>>2]|0;r=(n[c>>2]|0)+44|0;n[c>>2]=r;if((r-(n[o>>2]|0)|0)==4092){r=o+4|0;n[h>>2]=r;r=n[r>>2]|0;n[c>>2]=r}if((l|0)==(n[e>>2]|0))break;else a=a+1|0}}}J=u;return s|0}function yA(e){e=e|0;return e&255|0}function wA(e){e=e|0;Ag(e);qp(e);return}function vA(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function CA(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==11262?e+12|0:0)|0}function MA(e){e=e|0;Be(e,16);return}function EA(e,t){e=e|0;t=t|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;if(t|0){Hn(e,t);xA(e,t)}return}function FA(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=0;n[e+16>>2]=0;n[e+20>>2]=0;if(t|0)UA(e,t,s);return}function xA(e,t){e=e|0;t=t|0;var s=0,r=0,A=0;A=J;J=J+16|0;r=A;Wn(r,e,t);t=r+4|0;e=n[t>>2]|0;s=r+8|0;if((e|0)!=(n[s>>2]|0))do{i[e>>0]=0;e=(n[t>>2]|0)+1|0;n[t>>2]=e}while((e|0)!=(n[s>>2]|0));zn(r);J=A;return}function UA(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;p=J;J=J+96|0;d=p+80|0;c=p+64|0;o=p+48|0;a=p+40|0;l=p+8|0;r=p;h=p+32|0;u=p+16|0;i=(n[e+8>>2]|0)-(n[e+4>>2]|0)|0;i=((i|0)==0?0:((i>>2)*93|0)+-1|0)-((n[e+20>>2]|0)+(n[e+16>>2]|0))|0;if(i>>>0<t>>>0)Zn(e,t-i|0);Jn(a,e);Jn(r,e);i=n[r>>2]|0;r=n[r+4>>2]|0;A=l;n[A>>2]=i;n[A+4>>2]=r;A=i;if(t|0){i=((r-(n[i>>2]|0)|0)/44|0)+t|0;if((i|0)>0){t=(i>>>0)/93|0;A=A+(t<<2)|0;n[l>>2]=A;i=(n[A>>2]|0)+((i-(t*93|0)|0)*44|0)|0}else{i=92-i|0;t=A+(((i|0)/-93|0)<<2)|0;n[l>>2]=t;i=(n[t>>2]|0)+((92-((i|0)%93|0)|0)*44|0)|0}n[l+4>>2]=i}n[c>>2]=n[a>>2];n[c+4>>2]=n[a+4>>2];n[d>>2]=n[l>>2];n[d+4>>2]=n[l+4>>2];Yn(o,c,d);$n(d,o);qn(c,o);if(eA(d,c)|0){r=u+4|0;do{tA(h,d);sA(u,e,h);i=n[u>>2]|0;if((i|0)!=(n[r>>2]|0))do{Vs(i,s);i=(n[u>>2]|0)+44|0;n[u>>2]=i}while((i|0)!=(n[r>>2]|0));iA(u);rA(d)|0}while(eA(d,c)|0)}J=p;return}function IA(e){e=e|0;var t=0,s=0;_A(e);t=n[e+4>>2]|0;s=n[e+8>>2]|0;if((t|0)!=(s|0))do{Be(n[t>>2]|0,4092);t=t+4|0}while((t|0)!=(s|0));Kn(e);return}function TA(e,t,s){e=e|0;t=t|0;s=s|0;Ui(e);n[e>>2]=4924;n[e+4>>2]=t;n[e+8>>2]=s;return}function PA(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4944;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;VA(e,i);J=s;return}function SA(e,t){e=e|0;t=t|0;return QA(n[e+8>>2]|0,n[e+4>>2]|0,t)|0}function DA(e){e=e|0;var t=0,s=0;n[e>>2]=4924;s=e+8|0;t=n[s>>2]|0;n[s>>2]=0;if(t|0){OA(t);qp(t)}Si(e);return}function kA(e){e=e|0;DA(e);qp(e);return}function QA(e,t,s){e=e|0;t=t|0;s=s|0;return RA(e+4784|0,t,_r(e,t,s)|0)|0}function RA(e,t,s){e=e|0;t=t|0;s=s|0;if(i[e>>0]|0){rs(t);i[e>>0]=0}return s|0}function OA(e){e=e|0;gr(e);return}function VA(e,t){e=e|0;t=t|0;return}function LA(e){e=e|0;Ag(e);qp(e);return}function HA(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+8>>2]&255](e);return}function NA(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==12004?e+12|0:0)|0}function GA(e){e=e|0;Be(e,16);return}function jA(e){e=e|0;i[e>>0]=1;return}function WA(e,t,s){e=e|0;t=t|0;s=s|0;Ui(e);n[e>>2]=4972;n[e+4>>2]=t;n[e+8>>2]=s;return}function zA(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=4992;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;VA(e,i);J=s;return}function XA(e,t){e=e|0;t=t|0;return JA(n[e+8>>2]|0,n[e+4>>2]|0,t)|0}function KA(e){e=e|0;var t=0,s=0;n[e>>2]=4972;s=e+8|0;t=n[s>>2]|0;n[s>>2]=0;if(t|0){$A(t);qp(t)}Si(e);return}function ZA(e){e=e|0;KA(e);qp(e);return}function JA(e,t,s){e=e|0;t=t|0;s=s|0;return YA(e+4784|0,t,_r(e,t,s)|0)|0}function YA(e,t,s){e=e|0;t=t|0;s=s|0;return RA(e+328|0,t,on(e,t,s)|0)|0}function $A(e){e=e|0;qA(e+4784|0);gr(e);return}function qA(e){e=e|0;nn(e);return}function eo(e){e=e|0;Ag(e);qp(e);return}function to(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+8>>2]&255](e);return}function so(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==12827?e+12|0:0)|0}function io(e){e=e|0;Be(e,16);return}function ro(e){e=e|0;Xr(e);jA(e+328|0);return}function no(e,t,s){e=e|0;t=t|0;s=s|0;Ui(e);n[e>>2]=5020;n[e+4>>2]=t;n[e+8>>2]=s;return}function Ao(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5040;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;VA(e,i);J=s;return}function oo(e,t){e=e|0;t=t|0;return co(n[e+8>>2]|0,n[e+4>>2]|0,t)|0}function ao(e){e=e|0;var t=0,s=0;n[e>>2]=5020;s=e+8|0;t=n[s>>2]|0;n[s>>2]=0;if(t|0){uo(t);qp(t)}Si(e);return}function lo(e){e=e|0;ao(e);qp(e);return}function co(e,t,s){e=e|0;t=t|0;s=s|0;return ho(e+4784|0,t,_r(e,t,s)|0)|0}function ho(e,t,s){e=e|0;t=t|0;s=s|0;return RA(e+316|0,t,Mn(e,t,s)|0)|0}function uo(e){e=e|0;po(e+4784|0);gr(e);return}function po(e){e=e|0;Cn(e);return}function fo(e){e=e|0;Ag(e);qp(e);return}function go(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+8>>2]&255](e);return}function mo(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==13672?e+12|0:0)|0}function _o(e){e=e|0;Be(e,16);return}function bo(e){e=e|0;bn(e);jA(e+316|0);return}function Bo(e,t,s){e=e|0;t=t|0;s=s|0;Ui(e);n[e>>2]=5068;n[e+4>>2]=t;n[e+8>>2]=s;return}function yo(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5088;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;VA(e,i);J=s;return}function wo(e,t){e=e|0;t=t|0;return Mo(n[e+8>>2]|0,n[e+4>>2]|0,t)|0}function vo(e){e=e|0;var t=0,s=0;n[e>>2]=5068;s=e+8|0;t=n[s>>2]|0;n[s>>2]=0;if(t|0){Fo(t);qp(t)}Si(e);return}function Co(e){e=e|0;vo(e);qp(e);return}function Mo(e,t,s){e=e|0;t=t|0;s=s|0;return Eo(e+4784|0,t,_r(e,t,s)|0)|0}function Eo(e,t,s){e=e|0;t=t|0;s=s|0;return ho(e+328|0,t,on(e,t,s)|0)|0}function Fo(e){e=e|0;xo(e+4784|0);gr(e);return}function xo(e){e=e|0;po(e+328|0);nn(e);return}function Uo(e){e=e|0;Ag(e);qp(e);return}function Io(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+8>>2]&255](e);return}function To(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==14573?e+12|0:0)|0}function Po(e){e=e|0;Be(e,16);return}function So(e){e=e|0;Xr(e);bo(e+328|0);return}function Do(e){e=e|0;return e+20|0}function ko(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=t;n[e+4>>2]=s;n[e+8>>2]=0;return}function Qo(e,t){e=e|0;t=t|0;n[e>>2]=t;n[e+4>>2]=0;n[e+8>>2]=-1;return}function Ro(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;s=J;J=J+16|0;i=s+4|0;A=s;r=Zf(24)|0;ea(r,t);n[A>>2]=0;n[i>>2]=n[A>>2];ta(e,r,i);J=s;return}function Oo(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Vo(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5116;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Ho(e,i);J=s;return}function Lo(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Ho(e,t){e=e|0;t=t|0;return}function No(e){e=e|0;Ag(e);qp(e);return}function Go(e){e=e|0;e=n[e+12>>2]|0;if(e|0)qp(e);return}function jo(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==14966?e+12|0:0)|0}function Wo(e){e=e|0;Be(e,16);return}function zo(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5144;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Ko(e,i);J=s;return}function Xo(e){e=e|0;var t=0,s=0;e=n[e+4>>2]|0;if(e|0?(s=e+4|0,t=n[s>>2]|0,n[s>>2]=t+-1,(t|0)==0):0){jm[n[(n[e>>2]|0)+8>>2]&255](e);og(e)}return}function Ko(e,t){e=e|0;t=t|0;return}function Zo(e){e=e|0;Ag(e);qp(e);return}function Jo(e){e=e|0;e=n[e+12>>2]|0;if(e|0){qo(e);qp(e)}return}function Yo(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==15127?e+12|0:0)|0}function $o(e){e=e|0;Be(e,16);return}function qo(e){e=e|0;return}function ea(e,t){e=e|0;t=t|0;Ui(e);n[e>>2]=5172;n[e+4>>2]=t;n[e+8>>2]=0;n[e+12>>2]=0;n[e+16>>2]=0;i[e+20>>0]=1;return}function ta(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5192;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;oa(e,i);J=s;return}function sa(e,t){e=e|0;t=t|0;var s=0,r=0,A=0,o=0,a=0,l=0,c=0;c=J;J=J+16|0;o=c;s=n[e+8>>2]|0;a=n[e+12>>2]|0;if((s|0)!=(a|0)){l=o+4|0;do{r=n[s>>2]|0;n[o>>2]=r;A=n[s+4>>2]|0;n[l>>2]=A;if(A|0){A=A+4|0;n[A>>2]=(n[A>>2]|0)+1}t=Hm[n[(n[r>>2]|0)+12>>2]&63](r,t)|0;ki(o);s=s+8|0}while((s|0)!=(a|0))}s=e+20|0;if(i[s>>0]|0){i[s>>0]=0;na(n[e+4>>2]|0)}J=c;return t|0}function ia(e){e=e|0;n[e>>2]=5172;Qi(e+8|0);Si(e);return}function ra(e){e=e|0;ia(e);qp(e);return}function na(e){e=e|0;var t=0;t=((Aa(n[e>>2]|0)|0)&255)<<24;t=((Aa(n[e>>2]|0)|0)&255)<<16|t;t=t|((Aa(n[e>>2]|0)|0)&255)<<8;n[e+4>>2]=t|(Aa(n[e>>2]|0)|0)&255;return}function Aa(e){e=e|0;var t=0,s=0;t=n[e>>2]|0;s=e+8|0;e=n[s>>2]|0;n[s>>2]=e+1;return i[t+e>>0]|0}function oa(e,t){e=e|0;t=t|0;return}function aa(e){e=e|0;Ag(e);qp(e);return}function la(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+8>>2]&255](e);return}function ca(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==15450?e+12|0:0)|0}function ha(e){e=e|0;Be(e,16);return}function ua(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(180)|0;pa(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];fa(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function da(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(180)|0;Oa(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];Va(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function pa(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=5220;n[e+4>>2]=t;ga(e+8|0);return}function fa(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5244;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function ga(e){e=e|0;pr(e,32,1,8,0);is(e+80|0,32,1,8,0);i[e+160>>0]=0;i[e+161>>0]=0;Ba(e+164|0);return}function ma(e){e=e|0;n[e>>2]=5220;ya(e+8|0);sr(e);return}function _a(e){e=e|0;ma(e);qp(e);return}function ba(e,t){e=e|0;t=t|0;return wa(e+8|0,n[e+4>>2]|0,t)|0}function Ba(e){e=e|0;i[e+4>>0]=0;return}function ya(e){e=e|0;os(e+80|0);fr(e);return}function wa(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0;o=J;J=J+16|0;r=o;if(!(i[e+161>>0]|0))ns(e+80|0);A=e+164|0;if(va(A)|0){t=Ca(e+80|0,t,n[A>>2]|0,0)|0;n[r>>2]=t;kr(t,s)}else{Ea(Ma(t)|0,s,4);n[r>>2]=Ir(s)|0}Fa(A,r);J=o;return s+4|0}function va(e){e=e|0;return(i[e+4>>0]|0)!=0|0}function Ca(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;s=(xa(e,t,(n[e+36>>2]|0)+(i*44|0)|0)|0)+s|0;t=n[e+24>>2]|0;if((s|0)<0)return s+t|0;else return s-(s>>>0<t>>>0?0:t)|0;return 0}function Ma(e){e=e|0;return n[e>>2]|0}function Ea(e,t,s){e=e|0;t=t|0;s=s|0;var r=0;if((s|0)>0){r=0;do{i[t+r>>0]=Aa(e)|0;r=r+1|0}while((r|0)!=(s|0))}return}function Fa(e,t){e=e|0;t=t|0;var s=0;s=e+4|0;if(!(i[s>>0]|0))i[s>>0]=1;n[e>>2]=n[t>>2];return}function xa(e,t,s){e=e|0;t=t|0;s=s|0;var i=0;s=Ua(t,s)|0;n[e>>2]=s;do{if(s){if(s>>>0>=32){s=n[e+28>>2]|0;break}i=n[e+12>>2]|0;if(s>>>0>i>>>0){i=s-i|0;s=Ua(t,(n[e+68>>2]|0)+((s+-1|0)*44|0)|0)|0;i=s<<i|(Ia(t,i)|0)}else i=Ua(t,(n[e+68>>2]|0)+((s+-1|0)*44|0)|0)|0;s=n[e>>2]|0;if((i|0)<(1<<s+-1|0)){s=i+1+(-1<<s)|0;break}else{s=i+1|0;break}}else s=Ta(t,e+48|0)|0}while(0);return s|0}function Ua(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;d=e+8|0;u=n[d>>2]|0;r=n[t+16>>2]|0;if(r){i=e+4|0;s=n[i>>2]|0;h=u>>>15;n[d>>2]=h;l=(s>>>0)/(h>>>0)|0;a=l>>>(n[t+40>>2]|0);A=n[r+(a<<2)>>2]|0;a=(n[r+(a+1<<2)>>2]|0)+1|0;o=A+1|0;c=n[t+8>>2]|0;if(a>>>0>o>>>0){r=A;A=a;do{o=(A+r|0)>>>1;a=(n[c+(o<<2)>>2]|0)>>>0>l>>>0;r=a?r:o;A=a?o:A;o=r+1|0}while(A>>>0>o>>>0);A=r}r=b(n[c+(A<<2)>>2]|0,h)|0;if((A|0)==(n[t+32>>2]|0))o=u;else o=b(n[c+(o<<2)>>2]|0,h)|0}else{c=u>>>15;n[d>>2]=c;a=n[t>>2]|0;h=n[t+8>>2]|0;i=e+4|0;s=n[i>>2]|0;l=a>>>1;r=0;o=u;A=0;do{p=b(n[h+(l<<2)>>2]|0,c)|0;u=p>>>0>s>>>0;o=u?p:o;r=u?r:p;A=u?A:l;a=u?l:a;l=(A+a|0)>>>1}while((l|0)!=(A|0))}n[i>>2]=s-r;p=o-r|0;n[d>>2]=p;if(p>>>0<16777216)Pa(e);d=(n[t+12>>2]|0)+(A<<2)|0;n[d>>2]=(n[d>>2]|0)+1;d=t+28|0;p=(n[d>>2]|0)+-1|0;n[d>>2]=p;if(!p)Ls(t);return A|0}function Ia(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;if(t>>>0>19){s=(Sa(e)|0)&65535;return(Ia(e,t+-16|0)|0)<<16|s|0}i=e+4|0;r=n[i>>2]|0;A=e+8|0;s=(n[A>>2]|0)>>>t;n[A>>2]=s;t=(r>>>0)/(s>>>0)|0;n[i>>2]=r-(b(t,s)|0);if(s>>>0<16777216)Pa(e);return t|0}function Ta(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0,a=0;i=e+8|0;r=n[i>>2]|0;s=b(r>>>13,n[t+8>>2]|0)|0;A=e+4|0;o=n[A>>2]|0;a=o>>>0>=s>>>0;if(a){n[A>>2]=o-s;s=r-s|0;n[i>>2]=s}else{n[i>>2]=s;o=t+12|0;n[o>>2]=(n[o>>2]|0)+1}if(s>>>0<16777216)Pa(e);o=t+4|0;e=(n[o>>2]|0)+-1|0;n[o>>2]=e;if(!e)Xs(t);return a&1|0}function Pa(e){e=e|0;var t=0,s=0,i=0,r=0;t=e+4|0;s=e+8|0;i=n[t>>2]|0;do{i=i<<8|(Aa(n[e>>2]|0)|0)&255;n[t>>2]=i;r=n[s>>2]<<8;n[s>>2]=r}while(r>>>0<16777216);return}function Sa(e){e=e|0;var t=0,s=0,i=0,r=0;s=e+4|0;r=n[s>>2]|0;t=e+8|0;i=(n[t>>2]|0)>>>16;n[t>>2]=i;t=(r>>>0)/(i>>>0)|0;n[s>>2]=r-(b(t,i)|0);Pa(e);return t&65535|0}function Da(e){e=e|0;Ag(e);qp(e);return}function ka(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function Qa(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==15904?e+12|0:0)|0}function Ra(e){e=e|0;Be(e,16);return}function Oa(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=5272;n[e+4>>2]=t;La(e+8|0);return}function Va(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5296;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function La(e){e=e|0;pr(e,32,1,8,0);is(e+80|0,32,1,8,0);i[e+160>>0]=0;i[e+161>>0]=0;ja(e+164|0);return}function Ha(e){e=e|0;n[e>>2]=5272;Wa(e+8|0);sr(e);return}function Na(e){e=e|0;Ha(e);qp(e);return}function Ga(e,t){e=e|0;t=t|0;return za(e+8|0,n[e+4>>2]|0,t)|0}function ja(e){e=e|0;i[e+4>>0]=0;return}function Wa(e){e=e|0;os(e+80|0);fr(e);return}function za(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0;o=J;J=J+16|0;r=o;if(!(i[e+161>>0]|0))ns(e+80|0);A=e+164|0;if(Xa(A)|0){t=Ca(e+80|0,t,n[A>>2]|0,0)|0;n[r>>2]=t;Vr(t,s)}else{Ea(Ma(t)|0,s,4);n[r>>2]=Dr(s)|0}Ka(A,r);J=o;return s+4|0}function Xa(e){e=e|0;return(i[e+4>>0]|0)!=0|0}function Ka(e,t){e=e|0;t=t|0;var s=0;s=e+4|0;if(!(i[s>>0]|0))i[s>>0]=1;n[e>>2]=n[t>>2];return}function Za(e){e=e|0;Ag(e);qp(e);return}function Ja(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function Ya(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==16402?e+12|0:0)|0}function $a(e){e=e|0;Be(e,16);return}function qa(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(172)|0;tl(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];sl(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function el(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(176)|0;_l(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];bl(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function tl(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=5324;n[e+4>>2]=t;il(e+8|0);return}function sl(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5348;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function il(e){e=e|0;pr(e,8,1,8,0);is(e+80|0,8,1,8,0);i[e+160>>0]=0;i[e+161>>0]=0;ol(e+162|0);return}function rl(e){e=e|0;n[e>>2]=5324;al(e+8|0);sr(e);return}function nl(e){e=e|0;rl(e);qp(e);return}function Al(e,t){e=e|0;t=t|0;return ll(e+8|0,n[e+4>>2]|0,t)|0}function ol(e){e=e|0;i[e+1>>0]=0;return}function al(e){e=e|0;os(e+80|0);fr(e);return}function ll(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,n=0,A=0;A=J;J=J+16|0;r=A;if(!(i[e+161>>0]|0))ns(e+80|0);n=e+162|0;if(cl(n)|0){t=(Ca(e+80|0,t,i[n>>0]|0,0)|0)&255;i[r>>0]=t;hl(t,s)}else{Ea(Ma(t)|0,s,1);i[r>>0]=ul(s)|0}dl(n,r);J=A;return s+1|0}function cl(e){e=e|0;return(i[e+1>>0]|0)!=0|0}function hl(e,t){e=e|0;t=t|0;i[t>>0]=e;return}function ul(e){e=e|0;return i[e>>0]|0}function dl(e,t){e=e|0;t=t|0;var s=0;s=e+1|0;if(!(i[s>>0]|0))i[s>>0]=1;i[e>>0]=i[t>>0]|0;return}function pl(e){e=e|0;Ag(e);qp(e);return}function fl(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function gl(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==16900?e+12|0:0)|0}function ml(e){e=e|0;Be(e,16);return}function _l(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=5376;n[e+4>>2]=t;Bl(e+8|0);return}function bl(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5400;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function Bl(e){e=e|0;pr(e,16,1,8,0);is(e+80|0,16,1,8,0);i[e+160>>0]=0;i[e+161>>0]=0;Cl(e+162|0);return}function yl(e){e=e|0;n[e>>2]=5376;Ml(e+8|0);sr(e);return}function wl(e){e=e|0;yl(e);qp(e);return}function vl(e,t){e=e|0;t=t|0;return El(e+8|0,n[e+4>>2]|0,t)|0}function Cl(e){e=e|0;i[e+2>>0]=0;return}function Ml(e){e=e|0;os(e+80|0);fr(e);return}function El(e,t,s){e=e|0;t=t|0;s=s|0;var n=0,A=0,o=0;o=J;J=J+16|0;n=o;if(!(i[e+161>>0]|0))ns(e+80|0);A=e+162|0;if(Fl(A)|0){t=(Ca(e+80|0,t,r[A>>1]|0,0)|0)&65535;r[n>>1]=t;xl(t,s)}else{Ea(Ma(t)|0,s,2);r[n>>1]=Ul(s)|0}Il(A,n);J=o;return s+2|0}function Fl(e){e=e|0;return(i[e+2>>0]|0)!=0|0}function xl(e,t){e=e|0;t=t|0;Qr(e,t);return}function Ul(e){e=e|0;return Tr(e)|0}function Il(e,t){e=e|0;t=t|0;var s=0;s=e+2|0;if(!(i[s>>0]|0))i[s>>0]=1;r[e>>1]=r[t>>1]|0;return}function Tl(e){e=e|0;Ag(e);qp(e);return}function Pl(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function Sl(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==17398?e+12|0:0)|0}function Dl(e){e=e|0;Be(e,16);return}function kl(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(172)|0;Rl(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];Ol(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function Ql(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0;l=J;J=J+32|0;i=l+12|0;r=l;t=l+8|0;o=Zf(176)|0;$l(o,n[e+4>>2]|0);A=e+8|0;n[t>>2]=0;n[i>>2]=n[t>>2];ql(r,o,i);o=e+12|0;t=n[o>>2]|0;a=e+16|0;do{if(t>>>0>=(n[a>>2]|0)>>>0){t=(t-(n[A>>2]|0)>>3)+1|0;s=Zi(A)|0;if(s>>>0<t>>>0)Xg(A);else{c=n[A>>2]|0;h=(n[a>>2]|0)-c|0;a=h>>2;zi(i,h>>3>>>0<s>>>1>>>0?a>>>0<t>>>0?t:a:s,(n[o>>2]|0)-c>>3,e+16|0);a=i+8|0;o=n[a>>2]|0;n[o>>2]=n[r>>2];e=r+4|0;n[o+4>>2]=n[e>>2];n[r>>2]=0;n[e>>2]=0;n[a>>2]=o+8;Xi(A,i);Ki(i);break}}else{ji(i,A,1);h=i+4|0;c=n[h>>2]|0;n[c>>2]=n[r>>2];a=r+4|0;n[c+4>>2]=n[a>>2];n[r>>2]=0;n[a>>2]=0;n[h>>2]=c+8;Wi(i)}}while(0);ki(r);J=l;return}function Rl(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=5428;n[e+4>>2]=t;Vl(e+8|0);return}function Ol(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5452;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function Vl(e){e=e|0;pr(e,8,1,8,0);is(e+80|0,8,1,8,0);i[e+160>>0]=0;i[e+161>>0]=0;Gl(e+162|0);return}function Ll(e){e=e|0;n[e>>2]=5428;jl(e+8|0);sr(e);return}function Hl(e){e=e|0;Ll(e);qp(e);return}function Nl(e,t){e=e|0;t=t|0;return Wl(e+8|0,n[e+4>>2]|0,t)|0}function Gl(e){e=e|0;i[e+1>>0]=0;return}function jl(e){e=e|0;os(e+80|0);fr(e);return}function Wl(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,n=0,o=0;o=J;J=J+16|0;r=o;if(!(i[e+161>>0]|0))ns(e+80|0);n=e+162|0;if(zl(n)|0){t=(Ca(e+80|0,t,A[n>>0]|0,0)|0)&255;i[r>>0]=t;Rr(t,s)}else{Ea(Ma(t)|0,s,1);i[r>>0]=Pr(s)|0}Xl(n,r);J=o;return s+1|0}function zl(e){e=e|0;return(i[e+1>>0]|0)!=0|0}function Xl(e,t){e=e|0;t=t|0;var s=0;s=e+1|0;if(!(i[s>>0]|0))i[s>>0]=1;i[e>>0]=i[t>>0]|0;return}function Kl(e){e=e|0;Ag(e);qp(e);return}function Zl(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function Jl(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==17896?e+12|0:0)|0}function Yl(e){e=e|0;Be(e,16);return}function $l(e,t){e=e|0;t=t|0;Ji(e);n[e>>2]=5480;n[e+4>>2]=t;ec(e+8|0);return}function ql(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;s=J;J=J+16|0;i=s;n[e>>2]=t;r=Zf(16)|0;n[r+4>>2]=0;n[r+8>>2]=0;n[r>>2]=5504;n[r+12>>2]=t;n[e+4>>2]=r;n[i>>2]=t;n[i+4>>2]=t;Lr(e,i);J=s;return}function ec(e){e=e|0;pr(e,16,1,8,0);is(e+80|0,16,1,8,0);i[e+160>>0]=0;i[e+161>>0]=0;rc(e+162|0);return}function tc(e){e=e|0;n[e>>2]=5480;nc(e+8|0);sr(e);return}function sc(e){e=e|0;tc(e);qp(e);return}function ic(e,t){e=e|0;t=t|0;return Ac(e+8|0,n[e+4>>2]|0,t)|0}function rc(e){e=e|0;i[e+2>>0]=0;return}function nc(e){e=e|0;os(e+80|0);fr(e);return}function Ac(e,t,s){e=e|0;t=t|0;s=s|0;var n=0,A=0,a=0;a=J;J=J+16|0;n=a;if(!(i[e+161>>0]|0))ns(e+80|0);A=e+162|0;if(oc(A)|0){t=(Ca(e+80|0,t,o[A>>1]|0,0)|0)&65535;r[n>>1]=t;Qr(t,s)}else{Ea(Ma(t)|0,s,2);r[n>>1]=Tr(s)|0}ac(A,n);J=a;return s+2|0}function oc(e){e=e|0;return(i[e+2>>0]|0)!=0|0}function ac(e,t){e=e|0;t=t|0;var s=0;s=e+2|0;if(!(i[s>>0]|0))i[s>>0]=1;r[e>>1]=r[t>>1]|0;return}function lc(e){e=e|0;Ag(e);qp(e);return}function cc(e){e=e|0;e=n[e+12>>2]|0;if(e|0)jm[n[(n[e>>2]|0)+4>>2]&255](e);return}function hc(e,t){e=e|0;t=t|0;return((n[t+4>>2]|0)==18394?e+12|0:0)|0}function uc(e){e=e|0;Be(e,16);return}function dc(){return}function pc(e){e=e|0;return wc(e)|0}function fc(){return 0}function gc(){return 0}function mc(e){e=e|0;if(e|0){vc(e);qp(e)}return}function _c(){return Cc()|0}function bc(){return Mc()|0}function Bc(){return Ec()|0}function yc(){return 0}function wc(e){e=e|0;return 3360}function vc(e){e=e|0;var t=0,s=0,i=0,r=0;t=J;J=J+16|0;i=t;n[i>>2]=n[e>>2];n[e>>2]=0;s=e+4|0;n[i+4>>2]=n[s>>2];n[s>>2]=0;de(i);s=e+8|0;n[i>>2]=n[s>>2];n[s>>2]=0;r=e+12|0;n[i+4>>2]=n[r>>2];n[r>>2]=0;ve(i);ve(s);de(e);J=t;return}function Cc(){return 3360}function Mc(){return 3368}function Ec(){return 3384}function Fc(){return 18579}function xc(){return 18582}function Uc(){return 18584}function Ic(){var e=0;e=Zf(16)|0;Rc(e);return e|0}function Tc(e){e=e|0;var t=0,s=0,i=0,r=0;t=J;J=J+16|0;s=t;r=_c()|0;i=Sc(s)|0;s=Dc(s)|0;S(r|0,i|0,s|0,Fc()|0,12,e|0);J=t;return}function Pc(e){e=e|0;return kc(Om[e&3]()|0)|0}function Sc(e){e=e|0;return 1}function Dc(e){e=e|0;return Qc()|0}function kc(e){e=e|0;return e|0}function Qc(){return 5524}function Rc(e){e=e|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=0;return}function Oc(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+16|0;i=s;r=s+8|0;o=n[t+4>>2]|0;n[i>>2]=n[t>>2];n[i+4>>2]=o;o=_c()|0;A=Lc(r)|0;r=Hc(r)|0;t=Xc()|0;D(o|0,e|0,A|0,r|0,t|0,4,Nc(i)|0,0);J=s;return}function Vc(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0;A=Gc(t)|0;t=n[e>>2]|0;r=n[e+4>>2]|0;e=A+(r>>1)|0;if(r&1)t=n[(n[e>>2]|0)+t>>2]|0;r=jc(s)|0;A=Wc(i)|0;zm[t&15](e,r,A);return}function Lc(e){e=e|0;return 4}function Hc(e){e=e|0;return zc()|0}function Nc(e){e=e|0;var t=0,s=0;t=Zf(8)|0;s=n[e+4>>2]|0;n[t>>2]=n[e>>2];n[t+4>>2]=s;return t|0}function Gc(e){e=e|0;return e|0}function jc(e){e=e|0;return e|0}function Wc(e){e=e|0;return e|0}function zc(){return 144}function Xc(){return 18587}function Kc(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+16|0;i=s;r=s+8|0;o=n[t+4>>2]|0;n[i>>2]=n[t>>2];n[i+4>>2]=o;o=_c()|0;A=Jc(r)|0;r=Yc(r)|0;t=th()|0;D(o|0,e|0,A|0,r|0,t|0,7,$c(i)|0,0);J=s;return}function Zc(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;r=Gc(t)|0;t=n[e>>2]|0;i=n[e+4>>2]|0;e=r+(i>>1)|0;if(i&1)t=n[(n[e>>2]|0)+t>>2]|0;r=qc(s)|0;Wm[t&15](e,r);return}function Jc(e){e=e|0;return 3}function Yc(e){e=e|0;return eh()|0}function $c(e){e=e|0;var t=0,s=0;t=Zf(8)|0;s=n[e+4>>2]|0;n[t>>2]=n[e>>2];n[t+4>>2]=s;return t|0}function qc(e){e=e|0;return e|0}function eh(){return 5528}function th(){return 18593}function sh(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+16|0;i=s;r=s+8|0;o=n[t+4>>2]|0;n[i>>2]=n[t>>2];n[i+4>>2]=o;o=_c()|0;A=rh(r)|0;r=nh(r)|0;t=lh()|0;D(o|0,e|0,A|0,r|0,t|0,41,Ah(i)|0,0);J=s;return}function ih(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0;i=J;J=J+16|0;s=i;A=Gc(t)|0;t=n[e>>2]|0;r=n[e+4>>2]|0;e=A+(r>>1)|0;if(r&1)t=n[(n[e>>2]|0)+t>>2]|0;n[s>>2]=Vm[t&15](e)|0;A=oh(s)|0;J=i;return A|0}function rh(e){e=e|0;return 2}function nh(e){e=e|0;return ah()|0}function Ah(e){e=e|0;var t=0,s=0;t=Zf(8)|0;s=n[e+4>>2]|0;n[t>>2]=n[e>>2];n[t+4>>2]=s;return t|0}function oh(e){e=e|0;return n[e>>2]|0}function ah(){return 5540}function lh(){return 18598}function ch(){return}function hh(e){e=e|0;return _h(e)|0}function uh(){return 0}function dh(){return 0}function ph(e){e=e|0;if(e|0){bh(e);qp(e)}return}function fh(){return Bh()|0}function gh(){return yh()|0}function mh(){return wh()|0}function _h(e){e=e|0;return 3400}function bh(e){e=e|0;var t=0,s=0,i=0,r=0;t=J;J=J+16|0;i=t;n[i>>2]=n[e>>2];n[e>>2]=0;s=e+4|0;n[i+4>>2]=n[s>>2];n[s>>2]=0;Lo(i);s=e+16|0;n[i>>2]=n[s>>2];n[s>>2]=0;r=e+20|0;n[i+4>>2]=n[r>>2];n[r>>2]=0;Oo(i);n[i>>2]=n[s>>2];n[s>>2]=0;n[i+4>>2]=n[r>>2];n[r>>2]=0;Oo(i);Oo(s);Xo(e+8|0);Lo(e);J=t;return}function Bh(){return 3400}function yh(){return 3408}function wh(){return 3424}function vh(){var e=0;e=Zf(24)|0;Ih(e);return e|0}function Ch(e){e=e|0;var t=0,s=0,i=0,r=0;t=J;J=J+16|0;s=t;r=fh()|0;i=Eh(s)|0;s=Fh(s)|0;S(r|0,i|0,s|0,Fc()|0,13,e|0);J=t;return}function Mh(e){e=e|0;return xh(Om[e&3]()|0)|0}function Eh(e){e=e|0;return 1}function Fh(e){e=e|0;return Uh()|0}function xh(e){e=e|0;return e|0}function Uh(){return 5548}function Ih(e){e=e|0;n[e>>2]=0;n[e+4>>2]=0;n[e+8>>2]=0;n[e+12>>2]=0;n[e+16>>2]=0;n[e+20>>2]=0;return}function Th(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+16|0;i=s;r=s+8|0;o=n[t+4>>2]|0;n[i>>2]=n[t>>2];n[i+4>>2]=o;o=fh()|0;A=Sh(r)|0;r=Dh(r)|0;t=Xc()|0;D(o|0,e|0,A|0,r|0,t|0,5,kh(i)|0,0);J=s;return}function Ph(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0;A=Qh(t)|0;t=n[e>>2]|0;r=n[e+4>>2]|0;e=A+(r>>1)|0;if(r&1)t=n[(n[e>>2]|0)+t>>2]|0;r=jc(s)|0;A=Wc(i)|0;zm[t&15](e,r,A);return}function Sh(e){e=e|0;return 4}function Dh(e){e=e|0;return Rh()|0}function kh(e){e=e|0;var t=0,s=0;t=Zf(8)|0;s=n[e+4>>2]|0;n[t>>2]=n[e>>2];n[t+4>>2]=s;return t|0}function Qh(e){e=e|0;return e|0}function Rh(){return 160}function Oh(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+16|0;i=s;r=s+8|0;o=n[t+4>>2]|0;n[i>>2]=n[t>>2];n[i+4>>2]=o;o=fh()|0;A=Lh(r)|0;r=Hh(r)|0;t=th()|0;D(o|0,e|0,A|0,r|0,t|0,8,Nh(i)|0,0);J=s;return}function Vh(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;r=Qh(t)|0;t=n[e>>2]|0;i=n[e+4>>2]|0;e=r+(i>>1)|0;if(i&1)t=n[(n[e>>2]|0)+t>>2]|0;r=Wc(s)|0;Wm[t&15](e,r);return}function Lh(e){e=e|0;return 3}function Hh(e){e=e|0;return Gh()|0}function Nh(e){e=e|0;var t=0,s=0;t=Zf(8)|0;s=n[e+4>>2]|0;n[t>>2]=n[e>>2];n[t+4>>2]=s;return t|0}function Gh(){return 5552}function jh(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;s=J;J=J+16|0;i=s;r=s+8|0;o=n[t+4>>2]|0;n[i>>2]=n[t>>2];n[i+4>>2]=o;o=fh()|0;A=zh(r)|0;r=Xh(r)|0;t=th()|0;D(o|0,e|0,A|0,r|0,t|0,9,Kh(i)|0,0);J=s;return}function Wh(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;r=Qh(t)|0;t=n[e>>2]|0;i=n[e+4>>2]|0;e=r+(i>>1)|0;if(i&1)t=n[(n[e>>2]|0)+t>>2]|0;r=qc(s)|0;Wm[t&15](e,r);return}function zh(e){e=e|0;return 3}function Xh(e){e=e|0;return Zh()|0}function Kh(e){e=e|0;var t=0,s=0;t=Zf(8)|0;s=n[e+4>>2]|0;n[t>>2]=n[e>>2];n[t+4>>2]=s;return t|0}function Zh(){return 5564}function Jh(){ee();return}function Yh(){$h();return}function $h(){qh(22144);return}function qh(e){e=e|0;var t=0;t=J;J=J+16|0;n[t>>2]=e;eu();J=t;return}function eu(){H(tu()|0,18653);T(su()|0,18658,1,1,0);iu(18663);ru(18668);nu(18680);Au(18694);ou(18700);au(18715);lu(18719);cu(18732);hu(18737);uu(18751);du(18757);V(pu()|0,18764);V(fu()|0,18776);L(gu()|0,4,18809);L(mu()|0,2,18822);L(_u()|0,4,18837);k(bu()|0,18852);Bu(18868);yu(18898);wu(18935);vu(18974);Cu(19005);Mu(19045);Eu(19074);Fu(19112);xu(19142);yu(19181);wu(19213);vu(19246);Cu(19279);Mu(19313);Eu(19346);Uu(19380);Iu(19411);Tu(19443);return}function tu(){return Gd()|0}function su(){return Nd()|0}function iu(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Ld()|0;R(e|0,n[s>>2]|0,1,-128<<24>>24|0,127<<24>>24|0);J=t;return}function ru(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Od()|0;R(e|0,n[s>>2]|0,1,-128<<24>>24|0,127<<24>>24|0);J=t;return}function nu(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Qd()|0;R(e|0,n[s>>2]|0,1,0,255);J=t;return}function Au(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Dd()|0;R(e|0,n[s>>2]|0,2,-32768<<16>>16|0,32767<<16>>16|0);J=t;return}function ou(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Pd()|0;R(e|0,n[s>>2]|0,2,0,65535);J=t;return}function au(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Id()|0;R(e|0,n[s>>2]|0,4,-2147483648,2147483647);J=t;return}function lu(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=xd()|0;R(e|0,n[s>>2]|0,4,0,-1);J=t;return}function cu(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Ed()|0;R(e|0,n[s>>2]|0,4,-2147483648,2147483647);J=t;return}function hu(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Cd()|0;R(e|0,n[s>>2]|0,4,0,-1);J=t;return}function uu(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=wd()|0;Q(e|0,n[s>>2]|0,4);J=t;return}function du(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;n[s>>2]=e;e=Bd()|0;Q(e|0,n[s>>2]|0,8);J=t;return}function pu(){return bd()|0}function fu(){return _d()|0}function gu(){return md()|0}function mu(){return gd()|0}function _u(){return fd()|0}function bu(){return pd()|0}function Bu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=hd()|0;e=ud()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function yu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=ad()|0;e=ld()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function wu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=nd()|0;e=Ad()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function vu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=sd()|0;e=id()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Cu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=qu()|0;e=ed()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Mu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=Ju()|0;e=Yu()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Eu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=Xu()|0;e=Ku()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Fu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=ju()|0;e=Wu()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function xu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=Hu()|0;e=Nu()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Uu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=Ou()|0;e=Vu()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Iu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=ku()|0;e=Qu()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Tu(e){e=e|0;var t=0,s=0,i=0;t=J;J=J+16|0;s=t;n[s>>2]=e;i=Pu()|0;e=Su()|0;O(i|0,e|0,n[s>>2]|0);J=t;return}function Pu(){return Du()|0}function Su(){return 7}function Du(){return 3440}function ku(){return Ru()|0}function Qu(){return 7}function Ru(){return 3448}function Ou(){return Lu()|0}function Vu(){return 6}function Lu(){return 3456}function Hu(){return Gu()|0}function Nu(){return 5}function Gu(){return 3464}function ju(){return zu()|0}function Wu(){return 4}function zu(){return 3472}function Xu(){return Zu()|0}function Ku(){return 5}function Zu(){return 3480}function Ju(){return $u()|0}function Yu(){return 4}function $u(){return 3488}function qu(){return td()|0}function ed(){return 3}function td(){return 3496}function sd(){return rd()|0}function id(){return 2}function rd(){return 3504}function nd(){return od()|0}function Ad(){return 1}function od(){return 3512}function ad(){return cd()|0}function ld(){return 0}function cd(){return 3520}function hd(){return dd()|0}function ud(){return 0}function dd(){return 3528}function pd(){return 3536}function fd(){return 3544}function gd(){return 3576}function md(){return 3600}function _d(){return 3624}function bd(){return 3648}function Bd(){return yd()|0}function yd(){return 4144}function wd(){return vd()|0}function vd(){return 4136}function Cd(){return Md()|0}function Md(){return 4128}function Ed(){return Fd()|0}function Fd(){return 4120}function xd(){return Ud()|0}function Ud(){return 4112}function Id(){return Td()|0}function Td(){return 4104}function Pd(){return Sd()|0}function Sd(){return 4096}function Dd(){return kd()|0}function kd(){return 4088}function Qd(){return Rd()|0}function Rd(){return 4072}function Od(){return Vd()|0}function Vd(){return 4080}function Ld(){return Hd()|0}function Hd(){return 4064}function Nd(){return 4056}function Gd(){return 4040}function jd(e){e=e|0;var t=0,s=0,i=0,r=0;t=J;J=J+16|0;s=t+8|0;i=t+4|0;r=t;n[r>>2]=e;n[i>>2]=n[r>>2];n[s>>2]=n[(n[i>>2]|0)+4>>2];e=Mp(n[s>>2]|0)|0;J=t;return e|0}function Wd(){return 21636}function zd(e){e=e|0;return(e+-48|0)>>>0<10|0}function Xd(){return 5576}function Kd(e,t){e=e|0;t=t|0;var s=0,r=0;s=i[e>>0]|0;r=i[t>>0]|0;if(s<<24>>24==0?1:s<<24>>24!=r<<24>>24)e=r;else{do{e=e+1|0;t=t+1|0;s=i[e>>0]|0;r=i[t>>0]|0}while(!(s<<24>>24==0?1:s<<24>>24!=r<<24>>24));e=r}return(s&255)-(e&255)|0}function Zd(e){e=e|0;var t=0,s=0,r=0;r=e;e:do{if(!(r&3))s=5;else{t=r;while(1){if(!(i[e>>0]|0)){e=t;break e}e=e+1|0;t=e;if(!(t&3)){s=5;break}}}}while(0);if((s|0)==5){while(1){t=n[e>>2]|0;if(!((t&-2139062144^-2139062144)&t+-16843009))e=e+4|0;else break}if((t&255)<<24>>24)do{e=e+1|0}while((i[e>>0]|0)!=0)}return e-r|0}function Jd(e){e=e|0;return}function Yd(e){e=e|0;return 1}function $d(e){e=e|0;var t=0,s=0;t=e+74|0;s=i[t>>0]|0;i[t>>0]=s+255|s;t=n[e>>2]|0;if(!(t&8)){n[e+8>>2]=0;n[e+4>>2]=0;s=n[e+44>>2]|0;n[e+28>>2]=s;n[e+20>>2]=s;n[e+16>>2]=s+(n[e+48>>2]|0);e=0}else{n[e>>2]=t|32;e=-1}return e|0}function qd(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0,l=0;r=s+16|0;A=n[r>>2]|0;if(!A)if(!($d(s)|0)){A=n[r>>2]|0;o=5}else r=0;else o=5;e:do{if((o|0)==5){l=s+20|0;a=n[l>>2]|0;r=a;if((A-a|0)>>>0<t>>>0){r=Nm[n[s+36>>2]&7](s,e,t)|0;break}t:do{if((i[s+75>>0]|0)<0|(t|0)==0){o=0;A=e}else{a=t;while(1){A=a+-1|0;if((i[e+A>>0]|0)==10)break;if(!A){o=0;A=e;break t}else a=A}r=Nm[n[s+36>>2]&7](s,e,a)|0;if(r>>>0<a>>>0)break e;o=a;A=e+a|0;t=t-a|0;r=n[l>>2]|0}}while(0);hm(r|0,A|0,t|0)|0;n[l>>2]=(n[l>>2]|0)+t;r=o+t|0}}while(0);return r|0}function ep(e,t){e=e|0;t=t|0;if(!t)t=0;else t=tp(n[t>>2]|0,n[t+4>>2]|0,e)|0;return((t|0)==0?e:t)|0}function tp(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0;p=(n[e>>2]|0)+1794895138|0;o=sp(n[e+8>>2]|0,p)|0;r=sp(n[e+12>>2]|0,p)|0;A=sp(n[e+16>>2]|0,p)|0;e:do{if((o>>>0<t>>>2>>>0?(d=t-(o<<2)|0,r>>>0<d>>>0&A>>>0<d>>>0):0)?((A|r)&3|0)==0:0){d=r>>>2;u=A>>>2;h=0;while(1){l=o>>>1;c=h+l|0;a=c<<1;A=a+d|0;r=sp(n[e+(A<<2)>>2]|0,p)|0;A=sp(n[e+(A+1<<2)>>2]|0,p)|0;if(!(A>>>0<t>>>0&r>>>0<(t-A|0)>>>0)){r=0;break e}if(i[e+(A+r)>>0]|0){r=0;break e}r=Kd(s,e+A|0)|0;if(!r)break;r=(r|0)<0;if((o|0)==1){r=0;break e}h=r?h:c;o=r?l:o-l|0}r=a+u|0;A=sp(n[e+(r<<2)>>2]|0,p)|0;r=sp(n[e+(r+1<<2)>>2]|0,p)|0;if(r>>>0<t>>>0&A>>>0<(t-r|0)>>>0)r=(i[e+(r+A)>>0]|0)==0?e+r|0:0;else r=0}else r=0}while(0);return r|0}function sp(e,t){e=e|0;t=t|0;var s=0;s=cm(e|0)|0;return((t|0)==0?e:s)|0}function ip(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0;o=t&255;r=(s|0)!=0;e:do{if(r&(e&3|0)!=0){A=t&255;while(1){if((i[e>>0]|0)==A<<24>>24){A=6;break e}e=e+1|0;s=s+-1|0;r=(s|0)!=0;if(!(r&(e&3|0)!=0)){A=5;break}}}else A=5}while(0);if((A|0)==5)if(r)A=6;else e=0;e:do{if((A|0)==6){if((i[e>>0]|0)!=(t&255)<<24>>24){r=b(o,16843009)|0;t:do{if(s>>>0>3)do{o=n[e>>2]^r;if((o&-2139062144^-2139062144)&o+-16843009|0)break t;e=e+4|0;s=s+-4|0}while(s>>>0>3)}while(0)}if(!s)e=0;else{r=t&255;while(1){if((i[e>>0]|0)==r<<24>>24)break e;s=s+-1|0;if(!s){e=0;break}else e=e+1|0}}}}while(0);return e|0}function rp(e,t,s){e=e|0;t=t|0;s=s|0;return op(e,t,s,1,8)|0}function np(e,t,s,r,o,a){e=e|0;t=+t;s=s|0;r=r|0;o=o|0;a=a|0;var l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0.0,m=0,_=0,B=0,y=0,w=0,C=0,M=0,E=0,F=0,x=0,U=0,I=0,T=0,P=0,S=0;S=J;J=J+560|0;h=S+32|0;y=S+536|0;P=S;T=P;u=S+540|0;n[y>>2]=0;I=u+12|0;bp(t)|0;l=v()|0;if((l|0)<0){t=-t;bp(t)|0;U=1;x=20247;l=v()|0}else{U=(o&2049|0)!=0&1;x=(o&2048|0)==0?(o&1|0)==0?20248:20253:20250}do{if(0==0&(l&2146435072|0)==2146435072){P=(a&32|0)!=0;l=U+3|0;fp(e,32,s,l,o&-65537);lp(e,x,U);lp(e,t!=t|0.0!=0.0?P?20274:20278:P?20266:20270,3);fp(e,32,s,l,o^8192)}else{g=+Bp(t,y)*2.0;l=g!=0.0;if(l)n[y>>2]=(n[y>>2]|0)+-1;B=a|32;if((B|0)==97){p=a&32;m=(p|0)==0?x:x+9|0;f=U|2;l=12-r|0;do{if(!(r>>>0>11|(l|0)==0)){t=8.0;do{l=l+-1|0;t=t*16.0}while((l|0)!=0);if((i[m>>0]|0)==45){t=-(t+(-g-t));break}else{t=g+t-t;break}}else t=g}while(0);c=n[y>>2]|0;l=(c|0)<0?0-c|0:c;l=pp(l,((l|0)<0)<<31>>31,I)|0;if((l|0)==(I|0)){l=u+11|0;i[l>>0]=48}i[l+-1>>0]=(c>>31&2)+43;d=l+-2|0;i[d>>0]=a+15;c=(r|0)<1;h=(o&8|0)==0;u=P;do{U=~~t;l=u+1|0;i[u>>0]=p|A[640+U>>0];t=(t-+(U|0))*16.0;if((l-T|0)==1?!(h&(c&t==0.0)):0){i[l>>0]=46;u=u+2|0}else u=l}while(t!=0.0);if((r|0)!=0?(-2-T+u|0)<(r|0):0){c=I;h=d;l=r+2+c-h|0}else{c=I;h=d;l=c-T-h+u|0}I=l+f|0;fp(e,32,s,I,o);lp(e,m,f);fp(e,48,s,I,o^65536);T=u-T|0;lp(e,P,T);P=c-h|0;fp(e,48,l-(T+P)|0,0,0);lp(e,d,P);fp(e,32,s,I,o^8192);l=I;break}c=(r|0)<0?6:r;if(l){l=(n[y>>2]|0)+-28|0;n[y>>2]=l;t=g*268435456.0}else{t=g;l=n[y>>2]|0}F=(l|0)<0?h:h+288|0;h=F;do{M=~~t>>>0;n[h>>2]=M;h=h+4|0;t=(t-+(M>>>0))*1.0e9}while(t!=0.0);M=F;if((l|0)>0){p=F;while(1){d=(l|0)<29?l:29;l=h+-4|0;if(l>>>0>=p>>>0){u=0;do{_=am(n[l>>2]|0,0,d|0)|0;_=sm(_|0,v()|0,u|0,0)|0;w=v()|0;u=Am(_|0,w|0,1e9,0)|0;C=tm(u|0,v()|0,1e9,0)|0;C=im(_|0,w|0,C|0,v()|0)|0;v()|0;n[l>>2]=C;l=l+-4|0}while(l>>>0>=p>>>0);if(u){C=p+-4|0;n[C>>2]=u;u=C}else u=p}else u=p;e:do{if(h>>>0>u>>>0){l=h;while(1){h=l+-4|0;if(n[h>>2]|0){h=l;break e}if(h>>>0>u>>>0)l=h;else break}}}while(0);l=(n[y>>2]|0)-d|0;n[y>>2]=l;if((l|0)>0)p=u;else break}}else u=F;if((l|0)<0){r=((c+25|0)/9|0)+1|0;_=(B|0)==102;do{m=0-l|0;m=(m|0)<9?m:9;if(u>>>0<h>>>0){d=(1<<m)+-1|0;p=1e9>>>m;f=0;l=u;do{C=n[l>>2]|0;n[l>>2]=(C>>>m)+f;f=b(C&d,p)|0;l=l+4|0}while(l>>>0<h>>>0);u=(n[u>>2]|0)==0?u+4|0:u;if(f){n[h>>2]=f;h=h+4|0}}else u=(n[u>>2]|0)==0?u+4|0:u;l=_?F:u;h=(h-l>>2|0)>(r|0)?l+(r<<2)|0:h;l=(n[y>>2]|0)+m|0;n[y>>2]=l}while((l|0)<0);_=u}else _=u;if(_>>>0<h>>>0){l=(M-_>>2)*9|0;d=n[_>>2]|0;if(d>>>0>=10){u=10;do{u=u*10|0;l=l+1|0}while(d>>>0>=u>>>0)}}else l=0;w=(B|0)==103;C=(c|0)!=0;u=c-((B|0)==102?0:l)+((C&w)<<31>>31)|0;if((u|0)<(((h-M>>2)*9|0)+-9|0)){y=u+9216|0;u=(y|0)/9|0;r=F+4+(u+-1024<<2)|0;u=y-(u*9|0)|0;if((u|0)<8){d=10;while(1){d=d*10|0;if((u|0)<7)u=u+1|0;else break}}else d=10;f=n[r>>2]|0;u=(f>>>0)/(d>>>0)|0;m=f-(b(u,d)|0)|0;p=(r+4|0)==(h|0);if(!(p&(m|0)==0)){g=(u&1|0)==0?9007199254740992.0:9007199254740994.0;y=d>>>1;t=m>>>0<y>>>0?0.5:p&(m|0)==(y|0)?1.0:1.5;if(U){y=(i[x>>0]|0)==45;t=y?-t:t;g=y?-g:g}u=f-m|0;n[r>>2]=u;if(g+t!=g){y=u+d|0;n[r>>2]=y;if(y>>>0>999999999){d=r;l=_;while(1){u=d+-4|0;n[d>>2]=0;if(u>>>0<l>>>0){l=l+-4|0;n[l>>2]=0}y=(n[u>>2]|0)+1|0;n[u>>2]=y;if(y>>>0>999999999)d=u;else{d=l;break}}}else{u=r;d=_}l=(M-d>>2)*9|0;f=n[d>>2]|0;if(f>>>0>=10){p=10;do{p=p*10|0;l=l+1|0}while(f>>>0>=p>>>0)}}else{u=r;d=_}}else{u=r;d=_}y=u+4|0;h=h>>>0>y>>>0?y:h}else d=_;r=0-l|0;e:do{if(h>>>0>d>>>0)while(1){u=h+-4|0;if(n[u>>2]|0){y=h;B=1;break e}if(u>>>0>d>>>0)h=u;else{y=u;B=0;break}}else{y=h;B=0}}while(0);do{if(w){c=c+((C^1)&1)|0;if((c|0)>(l|0)&(l|0)>-5){p=a+-1|0;c=c+-1-l|0}else{p=a+-2|0;c=c+-1|0}if(!(o&8)){if(B?(E=n[y+-4>>2]|0,(E|0)!=0):0)if(!((E>>>0)%10|0)){u=0;h=10;do{h=h*10|0;u=u+1|0}while(!((E>>>0)%(h>>>0)|0|0))}else u=0;else u=9;h=((y-M>>2)*9|0)+-9|0;if((p|32|0)==102){a=h-u|0;a=(a|0)>0?a:0;c=(c|0)<(a|0)?c:a;break}else{a=h+l-u|0;a=(a|0)>0?a:0;c=(c|0)<(a|0)?c:a;break}}}else p=a}while(0);_=(c|0)!=0;f=_?1:o>>>3&1;m=(p|32|0)==102;if(m){w=0;l=(l|0)>0?l:0}else{h=(l|0)<0?r:l;h=pp(h,((h|0)<0)<<31>>31,I)|0;u=I;if((u-h|0)<2)do{h=h+-1|0;i[h>>0]=48}while((u-h|0)<2);i[h+-1>>0]=(l>>31&2)+43;l=h+-2|0;i[l>>0]=p;w=l;l=u-l|0}l=U+1+c+f+l|0;fp(e,32,s,l,o);lp(e,x,U);fp(e,48,s,l,o^65536);if(m){f=d>>>0>F>>>0?F:d;m=P+9|0;d=m;p=P+8|0;u=f;do{h=pp(n[u>>2]|0,0,m)|0;if((u|0)==(f|0)){if((h|0)==(m|0)){i[p>>0]=48;h=p}}else if(h>>>0>P>>>0){dm(P|0,48,h-T|0)|0;do{h=h+-1|0}while(h>>>0>P>>>0)}lp(e,h,d-h|0);u=u+4|0}while(u>>>0<=F>>>0);if(!((o&8|0)==0&(_^1)))lp(e,20282,1);if(u>>>0<y>>>0&(c|0)>0)while(1){h=pp(n[u>>2]|0,0,m)|0;if(h>>>0>P>>>0){dm(P|0,48,h-T|0)|0;do{h=h+-1|0}while(h>>>0>P>>>0)}lp(e,h,(c|0)<9?c:9);u=u+4|0;h=c+-9|0;if(!(u>>>0<y>>>0&(c|0)>9)){c=h;break}else c=h}fp(e,48,c+9|0,9,0)}else{y=B?y:d+4|0;if(d>>>0<y>>>0&(c|0)>-1){r=P+9|0;_=(o&8|0)==0;B=r;f=0-T|0;m=P+8|0;p=d;do{h=pp(n[p>>2]|0,0,r)|0;if((h|0)==(r|0)){i[m>>0]=48;h=m}do{if((p|0)==(d|0)){u=h+1|0;lp(e,h,1);if(_&(c|0)<1){h=u;break}lp(e,20282,1);h=u}else{if(h>>>0<=P>>>0)break;dm(P|0,48,h+f|0)|0;do{h=h+-1|0}while(h>>>0>P>>>0)}}while(0);T=B-h|0;lp(e,h,(c|0)>(T|0)?T:c);c=c-T|0;p=p+4|0}while(p>>>0<y>>>0&(c|0)>-1)}fp(e,48,c+18|0,18,0);lp(e,w,I-w|0)}fp(e,32,s,l,o^8192)}}while(0);J=S;return((l|0)<(s|0)?s:l)|0}function Ap(e,t){e=e|0;t=t|0;var s=0.0,i=0;i=(n[t>>2]|0)+(8-1)&~(8-1);s=+l[i>>3];n[t>>2]=i+8;l[e>>3]=s;return}function op(e,t,s,r,A){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;var o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0,m=0,_=0,b=0;b=J;J=J+224|0;f=b+208|0;g=b+160|0;m=b+80|0;_=b;o=g;a=o+40|0;do{n[o>>2]=0;o=o+4|0}while((o|0)<(a|0));n[f>>2]=n[s>>2];if((ap(0,t,f,m,g,r,A)|0)<0)s=-1;else{if((n[e+76>>2]|0)>-1)p=Yd(e)|0;else p=0;s=n[e>>2]|0;d=s&32;if((i[e+74>>0]|0)<1)n[e>>2]=s&-33;o=e+48|0;if(!(n[o>>2]|0)){a=e+44|0;l=n[a>>2]|0;n[a>>2]=_;c=e+28|0;n[c>>2]=_;h=e+20|0;n[h>>2]=_;n[o>>2]=80;u=e+16|0;n[u>>2]=_+80;s=ap(e,t,f,m,g,r,A)|0;if(l){Nm[n[e+36>>2]&7](e,0,0)|0;s=(n[h>>2]|0)==0?-1:s;n[a>>2]=l;n[o>>2]=0;n[u>>2]=0;n[c>>2]=0;n[h>>2]=0}}else s=ap(e,t,f,m,g,r,A)|0;o=n[e>>2]|0;n[e>>2]=o|d;if(p|0)Jd(e);s=(o&32|0)==0?s:-1}J=b;return s|0}function ap(e,t,s,A,o,a,c){e=e|0;t=t|0;s=s|0;A=A|0;o=o|0;a=a|0;c=c|0;var h=0,u=0,d=0,p=0,f=0,g=0,m=0,_=0,b=0,B=0,y=0,w=0,C=0,M=0,E=0,F=0,x=0,U=0,I=0,T=0,P=0,S=0,D=0,k=0,Q=0;k=J;J=J+64|0;P=k+56|0;D=k+40|0;F=k;U=k+48|0;I=k+60|0;n[P>>2]=t;C=(e|0)!=0;M=F+40|0;E=M;F=F+39|0;x=U+4|0;h=0;t=0;d=0;e:while(1){do{do{if((t|0)>-1)if((h|0)>(2147483647-t|0)){n[(Wd()|0)>>2]=61;t=-1;break}else{t=h+t|0;break}}while(0);m=n[P>>2]|0;h=i[m>>0]|0;if(!(h<<24>>24)){w=92;break e}u=m;t:while(1){switch(h<<24>>24){case 37:{w=10;break t}case 0:{h=u;break t}default:{}}y=u+1|0;n[P>>2]=y;h=i[y>>0]|0;u=y}t:do{if((w|0)==10){w=0;h=u;do{if((i[u+1>>0]|0)!=37)break t;h=h+1|0;u=u+2|0;n[P>>2]=u}while((i[u>>0]|0)==37)}}while(0);h=h-m|0;if(C)lp(e,m,h)}while((h|0)!=0);y=(zd(i[(n[P>>2]|0)+1>>0]|0)|0)==0;u=n[P>>2]|0;if(!y?(i[u+2>>0]|0)==36:0){b=(i[u+1>>0]|0)+-48|0;f=1;h=3}else{b=-1;f=d;h=1}h=u+h|0;n[P>>2]=h;u=i[h>>0]|0;d=(u<<24>>24)+-32|0;if(d>>>0>31|(1<<d&75913|0)==0)p=0;else{p=0;do{p=1<<d|p;h=h+1|0;n[P>>2]=h;u=i[h>>0]|0;d=(u<<24>>24)+-32|0}while(!(d>>>0>31|(1<<d&75913|0)==0))}if(u<<24>>24==42){if((zd(i[h+1>>0]|0)|0)!=0?(S=n[P>>2]|0,(i[S+2>>0]|0)==36):0){h=S+1|0;n[o+((i[h>>0]|0)+-48<<2)>>2]=10;h=n[A+((i[h>>0]|0)+-48<<3)>>2]|0;d=1;u=S+3|0}else{if(f|0){t=-1;break}if(C){y=(n[s>>2]|0)+(4-1)&~(4-1);h=n[y>>2]|0;n[s>>2]=y+4}else h=0;d=0;u=(n[P>>2]|0)+1|0}n[P>>2]=u;y=(h|0)<0;B=y?0-h|0:h;p=y?p|8192:p;y=d}else{h=cp(P)|0;if((h|0)<0){t=-1;break}B=h;y=f;u=n[P>>2]|0}do{if((i[u>>0]|0)==46){h=u+1|0;if((i[h>>0]|0)!=42){n[P>>2]=h;h=cp(P)|0;u=n[P>>2]|0;break}if(zd(i[u+2>>0]|0)|0?(T=n[P>>2]|0,(i[T+3>>0]|0)==36):0){h=T+2|0;n[o+((i[h>>0]|0)+-48<<2)>>2]=10;h=n[A+((i[h>>0]|0)+-48<<3)>>2]|0;u=T+4|0;n[P>>2]=u;break}if(y|0){t=-1;break e}if(C){_=(n[s>>2]|0)+(4-1)&~(4-1);h=n[_>>2]|0;n[s>>2]=_+4}else h=0;u=(n[P>>2]|0)+2|0;n[P>>2]=u}else h=-1}while(0);_=0;while(1){if(((i[u>>0]|0)+-65|0)>>>0>57){t=-1;break e}d=u;u=u+1|0;n[P>>2]=u;d=i[(i[d>>0]|0)+-65+(176+(_*58|0))>>0]|0;f=d&255;if((f+-1|0)>>>0>=8)break;else _=f}if(!(d<<24>>24)){t=-1;break}g=(b|0)>-1;do{if(d<<24>>24==19)if(g){t=-1;break e}else w=54;else{if(g){n[o+(b<<2)>>2]=f;g=A+(b<<3)|0;b=n[g+4>>2]|0;w=D;n[w>>2]=n[g>>2];n[w+4>>2]=b;w=54;break}if(!C){t=0;break e}hp(D,f,s,c);u=n[P>>2]|0;w=55}}while(0);if((w|0)==54){w=0;if(C)w=55;else h=0}t:do{if((w|0)==55){w=0;u=i[u+-1>>0]|0;u=(_|0)!=0&(u&15|0)==3?u&-33:u;d=p&-65537;b=(p&8192|0)==0?p:d;s:do{switch(u|0){case 110:switch((_&255)<<24>>24){case 0:{n[n[D>>2]>>2]=t;h=0;break t}case 1:{n[n[D>>2]>>2]=t;h=0;break t}case 2:{h=n[D>>2]|0;n[h>>2]=t;n[h+4>>2]=((t|0)<0)<<31>>31;h=0;break t}case 3:{r[n[D>>2]>>1]=t;h=0;break t}case 4:{i[n[D>>2]>>0]=t;h=0;break t}case 6:{n[n[D>>2]>>2]=t;h=0;break t}case 7:{h=n[D>>2]|0;n[h>>2]=t;n[h+4>>2]=((t|0)<0)<<31>>31;h=0;break t}default:{h=0;break t}}case 112:{u=120;h=h>>>0>8?h:8;d=b|8;w=67;break}case 88:case 120:{d=b;w=67;break}case 111:{g=D;g=dp(n[g>>2]|0,n[g+4>>2]|0,M)|0;d=E-g|0;p=0;f=20230;h=(b&8|0)==0|(h|0)>(d|0)?h:d+1|0;d=b;w=73;break}case 105:case 100:{d=D;u=n[d>>2]|0;d=n[d+4>>2]|0;if((d|0)<0){u=im(0,0,u|0,d|0)|0;d=v()|0;p=D;n[p>>2]=u;n[p+4>>2]=d;p=1;f=20230;w=72;break s}else{p=(b&2049|0)!=0&1;f=(b&2048|0)==0?(b&1|0)==0?20230:20232:20231;w=72;break s}}case 117:{d=D;p=0;f=20230;u=n[d>>2]|0;d=n[d+4>>2]|0;w=72;break}case 99:{i[F>>0]=n[D>>2];m=F;p=0;f=20230;g=1;u=d;h=E;break}case 115:{_=n[D>>2]|0;_=(_|0)==0?20240:_;b=ip(_,0,h)|0;Q=(b|0)==0;m=_;p=0;f=20230;g=Q?h:b-_|0;u=d;h=Q?_+h|0:b;break}case 67:{n[U>>2]=n[D>>2];n[x>>2]=0;n[D>>2]=U;f=-1;w=79;break}case 83:{if(!h){fp(e,32,B,0,b);h=0;w=89}else{f=h;w=79}break}case 65:case 71:case 70:case 69:case 97:case 103:case 102:case 101:{h=Lm[a&1](e,+l[D>>3],B,h,b,u)|0;break t}default:{p=0;f=20230;g=h;u=b;h=E}}}while(0);s:do{if((w|0)==67){g=D;g=up(n[g>>2]|0,n[g+4>>2]|0,M,u&32)|0;f=D;f=(d&8|0)==0|(n[f>>2]|0)==0&(n[f+4>>2]|0)==0;p=f?0:2;f=f?20230:20230+(u>>>4)|0;w=73}else if((w|0)==72){g=pp(u,d,M)|0;d=b;w=73}else if((w|0)==79){w=0;p=n[D>>2]|0;h=0;while(1){u=n[p>>2]|0;if(!u)break;u=gp(I,u)|0;d=(u|0)<0;if(d|u>>>0>(f-h|0)>>>0){w=83;break}h=u+h|0;if(f>>>0>h>>>0)p=p+4|0;else break}if((w|0)==83){w=0;if(d){t=-1;break e}}fp(e,32,B,h,b);if(!h){h=0;w=89}else{d=n[D>>2]|0;p=0;while(1){u=n[d>>2]|0;if(!u){w=89;break s}u=gp(I,u)|0;p=u+p|0;if((p|0)>(h|0)){w=89;break s}lp(e,I,u);if(p>>>0>=h>>>0){w=89;break}else d=d+4|0}}}}while(0);if((w|0)==73){w=0;u=D;u=(n[u>>2]|0)!=0|(n[u+4>>2]|0)!=0;Q=(h|0)!=0|u;u=E-g+((u^1)&1)|0;m=Q?g:M;g=Q?(h|0)>(u|0)?h:u:0;u=(h|0)>-1?d&-65537:d;h=E}else if((w|0)==89){w=0;fp(e,32,B,h,b^8192);h=(B|0)>(h|0)?B:h;break}b=h-m|0;_=(g|0)<(b|0)?b:g;Q=_+p|0;h=(B|0)<(Q|0)?Q:B;fp(e,32,h,Q,u);lp(e,f,p);fp(e,48,h,Q,u^65536);fp(e,48,_,b,0);lp(e,m,b);fp(e,32,h,Q,u^8192)}}while(0);d=y}e:do{if((w|0)==92)if(!e)if(!d)t=0;else{t=1;while(1){h=n[o+(t<<2)>>2]|0;if(!h)break;hp(A+(t<<3)|0,h,s,c);t=t+1|0;if(t>>>0>=10){t=1;break e}}while(1){if(n[o+(t<<2)>>2]|0){t=-1;break e}t=t+1|0;if(t>>>0>=10){t=1;break}}}}while(0);J=k;return t|0}function lp(e,t,s){e=e|0;t=t|0;s=s|0;if(!(n[e>>2]&32))qd(t,s,e)|0;return}function cp(e){e=e|0;var t=0,s=0;if(!(zd(i[n[e>>2]>>0]|0)|0))t=0;else{t=0;do{s=n[e>>2]|0;t=(t*10|0)+-48+(i[s>>0]|0)|0;s=s+1|0;n[e>>2]=s}while((zd(i[s>>0]|0)|0)!=0)}return t|0}function hp(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0.0;e:do{if(t>>>0<=20)do{switch(t|0){case 9:{t=(n[s>>2]|0)+(4-1)&~(4-1);i=n[t>>2]|0;n[s>>2]=t+4;n[e>>2]=i;break e}case 10:{i=(n[s>>2]|0)+(4-1)&~(4-1);t=n[i>>2]|0;n[s>>2]=i+4;i=e;n[i>>2]=t;n[i+4>>2]=((t|0)<0)<<31>>31;break e}case 11:{i=(n[s>>2]|0)+(4-1)&~(4-1);t=n[i>>2]|0;n[s>>2]=i+4;i=e;n[i>>2]=t;n[i+4>>2]=0;break e}case 12:{i=(n[s>>2]|0)+(8-1)&~(8-1);t=i;r=n[t>>2]|0;t=n[t+4>>2]|0;n[s>>2]=i+8;i=e;n[i>>2]=r;n[i+4>>2]=t;break e}case 13:{r=(n[s>>2]|0)+(4-1)&~(4-1);i=n[r>>2]|0;n[s>>2]=r+4;i=(i&65535)<<16>>16;r=e;n[r>>2]=i;n[r+4>>2]=((i|0)<0)<<31>>31;break e}case 14:{r=(n[s>>2]|0)+(4-1)&~(4-1);i=n[r>>2]|0;n[s>>2]=r+4;r=e;n[r>>2]=i&65535;n[r+4>>2]=0;break e}case 15:{r=(n[s>>2]|0)+(4-1)&~(4-1);i=n[r>>2]|0;n[s>>2]=r+4;i=(i&255)<<24>>24;r=e;n[r>>2]=i;n[r+4>>2]=((i|0)<0)<<31>>31;break e}case 16:{r=(n[s>>2]|0)+(4-1)&~(4-1);i=n[r>>2]|0;n[s>>2]=r+4;r=e;n[r>>2]=i&255;n[r+4>>2]=0;break e}case 17:{r=(n[s>>2]|0)+(8-1)&~(8-1);A=+l[r>>3];n[s>>2]=r+8;l[e>>3]=A;break e}case 18:{Wm[i&15](e,s);break e}default:break e}}while(0)}while(0);return}function up(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;if(!((e|0)==0&(t|0)==0))do{s=s+-1|0;i[s>>0]=A[640+(e&15)>>0]|0|r;e=om(e|0,t|0,4)|0;t=v()|0}while(!((e|0)==0&(t|0)==0));return s|0}function dp(e,t,s){e=e|0;t=t|0;s=s|0;if(!((e|0)==0&(t|0)==0))do{s=s+-1|0;i[s>>0]=e&7|48;e=om(e|0,t|0,3)|0;t=v()|0}while(!((e|0)==0&(t|0)==0));return s|0}function pp(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,n=0,A=0;if(t>>>0>0|(t|0)==0&e>>>0>4294967295){do{r=e;e=Am(e|0,t|0,10,0)|0;n=t;t=v()|0;A=tm(e|0,t|0,10,0)|0;A=im(r|0,n|0,A|0,v()|0)|0;v()|0;s=s+-1|0;i[s>>0]=A&255|48}while(n>>>0>9|(n|0)==9&r>>>0>4294967295);t=e}else t=e;if(t)do{A=t;t=(t>>>0)/10|0;s=s+-1|0;i[s>>0]=A-(t*10|0)|48}while(A>>>0>=10);return s|0}function fp(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;var n=0,A=0;A=J;J=J+256|0;n=A;if((s|0)>(i|0)&(r&73728|0)==0){r=s-i|0;dm(n|0,t<<24>>24|0,(r>>>0<256?r:256)|0)|0;if(r>>>0>255){t=s-i|0;do{lp(e,n,256);r=r+-256|0}while(r>>>0>255);r=t&255}lp(e,n,r)}J=A;return}function gp(e,t){e=e|0;t=t|0;if(!e)e=0;else e=mp(e,t,0)|0;return e|0}function mp(e,t,s){e=e|0;t=t|0;s=s|0;do{if(e){if(t>>>0<128){i[e>>0]=t;e=1;break}if(!(n[n[(_p()|0)+176>>2]>>2]|0))if((t&-128|0)==57216){i[e>>0]=t;e=1;break}else{n[(Wd()|0)>>2]=25;e=-1;break}if(t>>>0<2048){i[e>>0]=t>>>6|192;i[e+1>>0]=t&63|128;e=2;break}if(t>>>0<55296|(t&-8192|0)==57344){i[e>>0]=t>>>12|224;i[e+1>>0]=t>>>6&63|128;i[e+2>>0]=t&63|128;e=3;break}if((t+-65536|0)>>>0<1048576){i[e>>0]=t>>>18|240;i[e+1>>0]=t>>>12&63|128;i[e+2>>0]=t>>>6&63|128;i[e+3>>0]=t&63|128;e=4;break}else{n[(Wd()|0)>>2]=25;e=-1;break}}else e=1}while(0);return e|0}function _p(){return Xd()|0}function bp(e){e=+e;var t=0;l[c>>3]=e;t=n[c>>2]|0;w(n[c+4>>2]|0);return t|0}function Bp(e,t){e=+e;t=t|0;var s=0,i=0,r=0;l[c>>3]=e;s=n[c>>2]|0;i=n[c+4>>2]|0;r=om(s|0,i|0,52)|0;v()|0;switch(r&2047){case 0:{if(e!=0.0){e=+Bp(e*18446744073709551616.0,t);s=(n[t>>2]|0)+-64|0}else s=0;n[t>>2]=s;break}case 2047:break;default:{n[t>>2]=(r&2047)+-1022;n[c>>2]=s;n[c+4>>2]=i&-2146435073|1071644672;e=+l[c>>3]}}return+e}function yp(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,n=0;e:do{if(!s)e=0;else{while(1){r=i[e>>0]|0;n=i[t>>0]|0;if(r<<24>>24!=n<<24>>24)break;s=s+-1|0;if(!s){e=0;break e}else{e=e+1|0;t=t+1|0}}e=(r&255)-(n&255)|0}}while(0);return e|0}function wp(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0;r=J;J=J+16|0;A=r;n[A>>2]=i;i=vp(e,t,s,A)|0;J=r;return i|0}function vp(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;var A=0,o=0,a=0,l=0;l=J;J=J+160|0;A=l+144|0;a=l;hm(a|0,3672,144)|0;if((t+-1|0)>>>0>2147483646)if(!t){e=A;t=1;o=4}else{n[(Wd()|0)>>2]=61;t=-1}else o=4;if((o|0)==4){o=-2-e|0;o=t>>>0>o>>>0?o:t;n[a+48>>2]=o;A=a+20|0;n[A>>2]=e;n[a+44>>2]=e;t=e+o|0;e=a+16|0;n[e>>2]=t;n[a+28>>2]=t;t=rp(a,s,r)|0;if(o){a=n[A>>2]|0;i[a+(((a|0)==(n[e>>2]|0))<<31>>31)>>0]=0}}J=l;return t|0}function Cp(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;i=e+20|0;r=n[i>>2]|0;e=(n[e+16>>2]|0)-r|0;e=e>>>0>s>>>0?s:e;hm(r|0,t|0,e|0)|0;n[i>>2]=(n[i>>2]|0)+e;return s|0}function Mp(e){e=e|0;var t=0,s=0;t=(Zd(e)|0)+1|0;s=Kg(t)|0;if(!s)e=0;else e=hm(s|0,e|0,t|0)|0;return e|0}function Ep(e,t){e=e|0;t=t|0;var s=0,r=0;s=0;while(1){if((A[656+s>>0]|0)==(e|0)){r=4;break}s=s+1|0;if((s|0)==87){e=87;r=5;break}}if((r|0)==4)if(!s)s=752;else{e=s;r=5}if((r|0)==5){s=752;do{do{r=s;s=s+1|0}while((i[r>>0]|0)!=0);e=e+-1|0}while((e|0)!=0)}return Fp(s,n[t+20>>2]|0)|0}function Fp(e,t){e=e|0;t=t|0;return ep(e,t)|0}function xp(e){e=e|0;return Ep(e,n[(Up()|0)+176>>2]|0)|0}function Up(){return Xd()|0}function Ip(e,t,s){e=e|0;t=t|0;s=s|0;var r=0;r=xp(e)|0;e=Zd(r)|0;if(e>>>0>=s>>>0){e=s+-1|0;if(!s)e=68;else{hm(t|0,r|0,e|0)|0;i[t+e>>0]=0;e=68}}else{hm(t|0,r|0,e+1|0)|0;e=0}return e|0}function Tp(){var e=0,t=0,s=0,i=0,r=0,A=0,o=0;i=J;J=J+48|0;A=i+32|0;t=i+24|0;o=i+16|0;r=i;i=i+36|0;e=Pp()|0;if(e|0?(s=n[e>>2]|0,s|0):0){e=s+48|0;if(!(Sp(e)|0)){n[t>>2]=20420;kp(20370,t)}t=Dp(e)|0;if((t|0)==1126902529&(v()|0)==1129074247)e=n[s+44>>2]|0;else e=s+80|0;n[i>>2]=e;s=n[s>>2]|0;e=n[s+4>>2]|0;if(Nm[n[(n[954]|0)+16>>2]&7](3816,s,i)|0){o=n[i>>2]|0;o=Vm[n[(n[o>>2]|0)+8>>2]&15](o)|0;n[r>>2]=20420;n[r+4>>2]=e;n[r+8>>2]=o;kp(20284,r)}else{n[o>>2]=20420;n[o+4>>2]=e;kp(20329,o)}}kp(20408,A)}function Pp(){return 21640}function Sp(e){e=e|0;e=Dp(e)|0;return(e&-256|0)==1126902528&(v()|0)==1129074247|0}function Dp(e){e=e|0;var t=0;t=e;e=n[t>>2]|0;w(n[t+4>>2]|0);return e|0}function kp(e,t){e=e|0;t=t|0;Z()}function Qp(e){e=e|0;return}function Rp(e){e=e|0;Qp(e);qp(e);return}function Op(e){e=e|0;return}function Vp(e){e=e|0;return}function Lp(e,t,s){e=e|0;t=t|0;s=s|0;var A=0,o=0,a=0,l=0,c=0,h=0;h=J;J=J+64|0;l=h;if(!(jp(e,t,0)|0))if((t|0)!=0?(c=Kp(t,3840,3824,0)|0,(c|0)!=0):0){n[l>>2]=c;n[l+4>>2]=0;n[l+8>>2]=e;n[l+12>>2]=-1;e=l+16|0;t=l+24|0;A=l+48|0;o=e;a=o+36|0;do{n[o>>2]=0;o=o+4|0}while((o|0)<(a|0));r[e+36>>1]=0;i[e+38>>0]=0;n[A>>2]=1;Xm[n[(n[c>>2]|0)+28>>2]&7](c,l,n[s>>2]|0,1);if((n[t>>2]|0)==1){n[s>>2]=n[e>>2];e=1}else e=0}else e=0;else e=1;J=h;return e|0}function Hp(e,t,s,i,r,A){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;A=A|0;if(jp(e,n[t+8>>2]|0,A)|0)Xp(0,t,s,i,r);return}function Np(e,t,s,r,A){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;var o=0;do{if(!(jp(e,n[t+8>>2]|0,A)|0)){if(jp(e,n[t>>2]|0,A)|0){if((n[t+16>>2]|0)!=(s|0)?(o=t+20|0,(n[o>>2]|0)!=(s|0)):0){n[t+32>>2]=r;n[o>>2]=s;A=t+40|0;n[A>>2]=(n[A>>2]|0)+1;if((n[t+36>>2]|0)==1?(n[t+24>>2]|0)==2:0)i[t+54>>0]=1;n[t+44>>2]=4;break}if((r|0)==1)n[t+32>>2]=1}}else zp(0,t,s,r)}while(0);return}function Gp(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;if(jp(e,n[t+8>>2]|0,0)|0)Wp(0,t,s,i);return}function jp(e,t,s){e=e|0;t=t|0;s=s|0;if(s)if((e|0)==(t|0))e=1;else e=(Kd(n[e+4>>2]|0,n[t+4>>2]|0)|0)==0;else e=(n[e+4>>2]|0)==(n[t+4>>2]|0);return e|0}function Wp(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;var A=0;e=t+16|0;A=n[e>>2]|0;do{if(A){if((A|0)!=(s|0)){r=t+36|0;n[r>>2]=(n[r>>2]|0)+1;n[t+24>>2]=2;i[t+54>>0]=1;break}e=t+24|0;if((n[e>>2]|0)==2)n[e>>2]=r}else{n[e>>2]=s;n[t+24>>2]=r;n[t+36>>2]=1}}while(0);return}function zp(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0;if((n[t+4>>2]|0)==(s|0)?(r=t+28|0,(n[r>>2]|0)!=1):0)n[r>>2]=i;return}function Xp(e,t,s,r,A){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;i[t+53>>0]=1;do{if((n[t+4>>2]|0)==(r|0)){i[t+52>>0]=1;e=t+16|0;r=n[e>>2]|0;if(!r){n[e>>2]=s;n[t+24>>2]=A;n[t+36>>2]=1;if(!((A|0)==1?(n[t+48>>2]|0)==1:0))break;i[t+54>>0]=1;break}if((r|0)!=(s|0)){A=t+36|0;n[A>>2]=(n[A>>2]|0)+1;i[t+54>>0]=1;break}r=t+24|0;e=n[r>>2]|0;if((e|0)==2){n[r>>2]=A;e=A}if((e|0)==1?(n[t+48>>2]|0)==1:0)i[t+54>>0]=1}}while(0);return}function Kp(e,t,s,A){e=e|0;t=t|0;s=s|0;A=A|0;var o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0;f=J;J=J+64|0;d=f;u=n[e>>2]|0;p=e+(n[u+-8>>2]|0)|0;u=n[u+-4>>2]|0;n[d>>2]=s;n[d+4>>2]=e;n[d+8>>2]=t;n[d+12>>2]=A;e=d+16|0;t=d+20|0;A=d+24|0;o=d+28|0;a=d+32|0;l=d+40|0;c=e;h=c+36|0;do{n[c>>2]=0;c=c+4|0}while((c|0)<(h|0));r[e+36>>1]=0;i[e+38>>0]=0;e:do{if(jp(u,s,0)|0){n[d+48>>2]=1;Zm[n[(n[u>>2]|0)+20>>2]&3](u,d,p,p,1,0);e=(n[A>>2]|0)==1?p:0}else{Km[n[(n[u>>2]|0)+24>>2]&3](u,d,p,1,0);switch(n[d+36>>2]|0){case 0:{e=(n[l>>2]|0)==1&(n[o>>2]|0)==1&(n[a>>2]|0)==1?n[t>>2]|0:0;break e}case 1:break;default:{e=0;break e}}if((n[A>>2]|0)!=1?!((n[l>>2]|0)==0&(n[o>>2]|0)==1&(n[a>>2]|0)==1):0){e=0;break}e=n[e>>2]|0}}while(0);J=f;return e|0}function Zp(e){e=e|0;Qp(e);qp(e);return}function Jp(e,t,s,i,r,A){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;A=A|0;if(jp(e,n[t+8>>2]|0,A)|0)Xp(0,t,s,i,r);else{e=n[e+8>>2]|0;Zm[n[(n[e>>2]|0)+20>>2]&3](e,t,s,i,r,A)}return}function Yp(e,t,s,r,A){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;var o=0,a=0,l=0;e:do{if(!(jp(e,n[t+8>>2]|0,A)|0)){if(!(jp(e,n[t>>2]|0,A)|0)){a=n[e+8>>2]|0;Km[n[(n[a>>2]|0)+24>>2]&3](a,t,s,r,A);break}if((n[t+16>>2]|0)!=(s|0)?(a=t+20|0,(n[a>>2]|0)!=(s|0)):0){n[t+32>>2]=r;r=t+44|0;do{if((n[r>>2]|0)!=4){o=t+52|0;i[o>>0]=0;l=t+53|0;i[l>>0]=0;e=n[e+8>>2]|0;Zm[n[(n[e>>2]|0)+20>>2]&3](e,t,s,s,1,A);if(i[l>>0]|0){l=(i[o>>0]|0)==0;n[r>>2]=3;if(l)break;else break e}else{n[r>>2]=4;break}}}while(0);n[a>>2]=s;l=t+40|0;n[l>>2]=(n[l>>2]|0)+1;if((n[t+36>>2]|0)!=1)break;if((n[t+24>>2]|0)!=2)break;i[t+54>>0]=1;break}if((r|0)==1)n[t+32>>2]=1}else zp(0,t,s,r)}while(0);return}function $p(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;if(jp(e,n[t+8>>2]|0,0)|0)Wp(0,t,s,i);else{e=n[e+8>>2]|0;Xm[n[(n[e>>2]|0)+28>>2]&7](e,t,s,i)}return}function qp(e){e=e|0;Zg(e);return}function ef(e){e=e|0;return}function tf(){var e=0,t=0;e=Pp()|0;if((e|0?(t=n[e>>2]|0,t|0):0)?Sp(t+48|0)|0:0)sf(n[t+12>>2]|0);sf(rf()|0)}function sf(e){e=e|0;var t=0;t=J;J=J+16|0;Gm[e&3]();kp(20559,t)}function rf(){return 2}function nf(e){e=e|0;return}function Af(e){e=e|0;qp(e);return}function of(e){e=e|0;return 20599}function af(e){e=e|0;n[e>>2]=5916;uf(e+4|0);return}function lf(e){e=e|0;af(e);qp(e);return}function cf(e){e=e|0;return hf(e+4|0)|0}function hf(e){e=e|0;return n[e>>2]|0}function uf(e){e=e|0;var t=0,s=0;if(df(e)|0?(t=pf(n[e>>2]|0)|0,s=t+8|0,e=n[s>>2]|0,n[s>>2]=e+-1,(e|0)<1):0)qp(t);return}function df(e){e=e|0;return 1}function pf(e){e=e|0;return e+-12|0}function ff(e){e=e|0;n[e>>2]=5936;uf(e+4|0);return}function gf(e){e=e|0;ff(e);qp(e);return}function mf(e){e=e|0;return hf(e+4|0)|0}function _f(e){e=e|0;af(e);qp(e);return}function bf(e){e=e|0;af(e);qp(e);return}function Bf(){var e=0;e=J;J=J+16|0;kp(20848,e)}function yf(e){e=e|0;Qp(e);qp(e);return}function wf(e,t,s){e=e|0;t=t|0;s=s|0;return jp(e,t,0)|0}function vf(e){e=e|0;Qp(e);qp(e);return}function Cf(e,t,s){e=e|0;t=t|0;s=s|0;var A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0;d=J;J=J+64|0;h=d;do{if(!(jp(t,4048,0)|0)){if(Mf(e,t,0)|0){t=n[s>>2]|0;if(!t){t=1;break}n[s>>2]=n[t>>2];t=1;break}if((t|0)!=0?(A=Kp(t,3840,3976,0)|0,(A|0)!=0):0){t=n[s>>2]|0;if(t|0)n[s>>2]=n[t>>2];t=n[A+8>>2]|0;a=e+8|0;o=n[a>>2]|0;if((t&7&(o^7)|0)==0?((t&96^96)&o|0)==0:0){o=e+12|0;e=n[o>>2]|0;A=A+12|0;t=n[A>>2]|0;if(!(jp(e,t,0)|0)){if(jp(e,4040,0)|0){if(!t){t=1;break}t=(Kp(t,3840,3992,0)|0)==0;break}if(e){t=Kp(e,3840,3976,0)|0;if(t|0){if(!(n[a>>2]&1)){t=0;break}t=Ef(t,n[A>>2]|0)|0;break}t=n[o>>2]|0;if(t){t=Kp(t,3840,4008,0)|0;if(t|0){if(!(n[a>>2]&1)){t=0;break}t=Ff(t,n[A>>2]|0)|0;break}t=n[o>>2]|0;if((((t|0)!=0?(l=Kp(t,3840,3824,0)|0,(l|0)!=0):0)?(c=n[A>>2]|0,(c|0)!=0):0)?(u=Kp(c,3840,3824,0)|0,(u|0)!=0):0){n[h>>2]=u;n[h+4>>2]=0;n[h+8>>2]=l;n[h+12>>2]=-1;t=h+16|0;e=h+24|0;A=h+48|0;o=t;a=o+36|0;do{n[o>>2]=0;o=o+4|0}while((o|0)<(a|0));r[t+36>>1]=0;i[t+38>>0]=0;n[A>>2]=1;Xm[n[(n[u>>2]|0)+28>>2]&7](u,h,n[s>>2]|0,1);do{if((n[e>>2]|0)==1){if(!(n[s>>2]|0)){t=1;break}n[s>>2]=n[t>>2];t=1}else t=0}while(0)}else t=0}else t=0}else t=0}else t=1}else t=0}else t=0}else{n[s>>2]=0;t=1}}while(0);J=d;return t|0}function Mf(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;if(!(n[e+8>>2]&24))if((t|0)!=0?(i=Kp(t,3840,3960,0)|0,(i|0)!=0):0){s=(n[i+8>>2]&24|0)!=0;r=5}else s=0;else{s=1;r=5}if((r|0)==5)s=jp(e,t,s)|0;return s|0}function Ef(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,A=0,o=0;while(1){if(!t){t=0;break}s=Kp(t,3840,3976,0)|0;if(!s){t=0;break}r=n[e+8>>2]|0;if(n[s+8>>2]&~r|0){t=0;break}i=e+12|0;t=n[i>>2]|0;s=s+12|0;if(jp(t,n[s>>2]|0,0)|0){t=1;break}if((r&1|0)==0|(t|0)==0){t=0;break}e=Kp(t,3840,3976,0)|0;if(!e){o=9;break}t=n[s>>2]|0}if((o|0)==9){t=n[i>>2]|0;if((t|0)!=0?(A=Kp(t,3840,4008,0)|0,(A|0)!=0):0)t=Ff(A,n[s>>2]|0)|0;else t=0}return t|0}function Ff(e,t){e=e|0;t=t|0;var s=0;if((((t|0)!=0?(s=Kp(t,3840,4008,0)|0,(s|0)!=0):0)?(n[s+8>>2]&~n[e+8>>2]|0)==0:0)?jp(n[e+12>>2]|0,n[s+12>>2]|0,0)|0:0)e=jp(n[e+16>>2]|0,n[s+16>>2]|0,0)|0;else e=0;return e|0}function xf(e){e=e|0;Qp(e);qp(e);return}function Uf(e,t,s,r,A,o){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;o=o|0;var a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0,m=0;if(jp(e,n[t+8>>2]|0,o)|0)Xp(0,t,s,r,A);else{m=t+52|0;l=i[m>>0]|0;g=t+53|0;a=i[g>>0]|0;f=n[e+12>>2]|0;u=e+16+(f<<3)|0;i[m>>0]=0;i[g>>0]=0;Sf(e+16|0,t,s,r,A,o);c=i[m>>0]|0;l=c|l;h=i[g>>0]|0;a=h|a;e:do{if((f|0)>1){d=t+24|0;p=e+8|0;f=t+54|0;e=e+24|0;do{a=a&1;l=l&1;if(i[f>>0]|0)break e;if(!(c<<24>>24)){if(h<<24>>24?(n[p>>2]&1|0)==0:0)break e}else{if((n[d>>2]|0)==1)break e;if(!(n[p>>2]&2))break e}i[m>>0]=0;i[g>>0]=0;Sf(e,t,s,r,A,o);c=i[m>>0]|0;l=c|l;h=i[g>>0]|0;a=h|a;e=e+8|0}while(e>>>0<u>>>0)}}while(0);i[m>>0]=l<<24>>24!=0&1;i[g>>0]=a<<24>>24!=0&1}return}function If(e,t,s,r,A){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;var o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0;e:do{if(!(jp(e,n[t+8>>2]|0,A)|0)){if(!(jp(e,n[t>>2]|0,A)|0)){f=n[e+12>>2]|0;c=e+16+(f<<3)|0;Df(e+16|0,t,s,r,A);o=e+24|0;if((f|0)<=1)break;e=n[e+8>>2]|0;if((e&2|0)==0?(l=t+36|0,(n[l>>2]|0)!=1):0){if(!(e&1)){e=t+54|0;while(1){if(i[e>>0]|0)break e;if((n[l>>2]|0)==1)break e;Df(o,t,s,r,A);o=o+8|0;if(o>>>0>=c>>>0)break e}}e=t+24|0;a=t+54|0;while(1){if(i[a>>0]|0)break e;if((n[l>>2]|0)==1?(n[e>>2]|0)==1:0)break e;Df(o,t,s,r,A);o=o+8|0;if(o>>>0>=c>>>0)break e}}e=t+54|0;while(1){if(i[e>>0]|0)break e;Df(o,t,s,r,A);o=o+8|0;if(o>>>0>=c>>>0)break e}}if((n[t+16>>2]|0)!=(s|0)?(f=t+20|0,(n[f>>2]|0)!=(s|0)):0){n[t+32>>2]=r;p=t+44|0;if((n[p>>2]|0)!=4){l=e+16+(n[e+12>>2]<<3)|0;c=t+52|0;r=t+53|0;h=t+54|0;u=e+8|0;d=t+24|0;o=0;a=e+16|0;e=0;t:while(1){if(a>>>0>=l>>>0){a=18;break}i[c>>0]=0;i[r>>0]=0;Sf(a,t,s,s,1,A);if(i[h>>0]|0){a=18;break}do{if(i[r>>0]|0){if(!(i[c>>0]|0))if(!(n[u>>2]&1)){a=19;break t}else{e=1;break}if((n[d>>2]|0)==1){o=1;a=19;break t}if(!(n[u>>2]&2)){o=1;a=19;break t}else{o=1;e=1}}}while(0);a=a+8|0}if((a|0)==18)if(e)a=19;else e=4;if((a|0)==19)e=3;n[p>>2]=e;if(o&1)break}n[f>>2]=s;s=t+40|0;n[s>>2]=(n[s>>2]|0)+1;if((n[t+36>>2]|0)!=1)break;if((n[t+24>>2]|0)!=2)break;i[t+54>>0]=1;break}if((r|0)==1)n[t+32>>2]=1}else zp(0,t,s,r)}while(0);return}function Tf(e,t,s,r){e=e|0;t=t|0;s=s|0;r=r|0;var A=0,o=0;e:do{if(!(jp(e,n[t+8>>2]|0,0)|0)){o=n[e+12>>2]|0;A=e+16+(o<<3)|0;Pf(e+16|0,t,s,r);if((o|0)>1){o=t+54|0;e=e+24|0;do{Pf(e,t,s,r);if(i[o>>0]|0)break e;e=e+8|0}while(e>>>0<A>>>0)}}else Wp(0,t,s,r)}while(0);return}function Pf(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,A=0;A=n[e+4>>2]|0;if(s){r=A>>8;if(A&1)r=n[(n[s>>2]|0)+r>>2]|0}else r=0;e=n[e>>2]|0;Xm[n[(n[e>>2]|0)+28>>2]&7](e,t,s+r|0,(A&2|0)==0?2:i);return}function Sf(e,t,s,i,r,A){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;A=A|0;var o=0,a=0;a=n[e+4>>2]|0;o=a>>8;if(a&1)o=n[(n[i>>2]|0)+o>>2]|0;e=n[e>>2]|0;Zm[n[(n[e>>2]|0)+20>>2]&3](e,t,s,i+o|0,(a&2|0)==0?2:r,A);return}function Df(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;var A=0,o=0;o=n[e+4>>2]|0;A=o>>8;if(o&1)A=n[(n[s>>2]|0)+A>>2]|0;e=n[e>>2]|0;Km[n[(n[e>>2]|0)+24>>2]&3](e,t,s+A|0,(o&2|0)==0?2:i,r);return}function kf(e){e=e|0;n[e>>2]=5896;return}function Qf(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;Rf(s,e);e=Of(s)|0;J=t;return e|0}function Rf(e,t){e=e|0;t=t|0;Gf(e,t);return}function Of(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;Vf(s,n[e+4>>2]|0);if(!((Lf(s)|0)<<24>>24))e=Nf(Hf(e)|0)|0;else e=0;J=t;return e|0}function Vf(e,t){e=e|0;t=t|0;n[e>>2]=t;return}function Lf(e){e=e|0;return i[n[e>>2]>>0]|0}function Hf(e){e=e|0;return e|0}function Nf(e){e=e|0;var t=0,s=0,r=0,A=0;A=J;J=J+16|0;r=A;e=n[e+8>>2]|0;t=i[e>>0]|0;do{if(t<<24>>24!=1)if(!(t&2)){i[e>>0]=2;s=1;break}else kp(20985,r);else s=0}while(0);J=A;return s|0}function Gf(e,t){e=e|0;t=t|0;n[e>>2]=t;n[e+4>>2]=t;n[e+8>>2]=t+1;n[e+12>>2]=0;return}function jf(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;Rf(s,e);Wf(s);J=t;return}function Wf(e){e=e|0;var t=0,s=0;t=J;J=J+16|0;s=t;Vf(s,n[e+4>>2]|0);zf(s);Xf(Hf(e)|0);J=t;return}function zf(e){e=e|0;i[n[e>>2]>>0]=1;return}function Xf(e){e=e|0;i[n[e+8>>2]>>0]=1;return}function Kf(){return 0}function Zf(e){e=e|0;var t=0,s=0;s=(e|0)==0?1:e;while(1){t=Kg(s)|0;if(t|0){e=6;break}e=Kf()|0;if(!e){e=5;break}Gm[e&3]()}if((e|0)==5){s=C(4)|0;kf(s);E(s|0,3880,121)}else if((e|0)==6)return t|0;return 0}function Jf(e){e=e|0;return Zf(e)|0}function Yf(e){e=e|0;qp(e);return}function $f(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;r=J;J=J+16|0;i=r;n[i>>2]=n[s>>2];e=Nm[n[(n[e>>2]|0)+16>>2]&7](e,t,i)|0;if(e)n[s>>2]=n[i>>2];J=r;return e&1|0}function qf(e){e=e|0;if(!e)e=0;else e=(Kp(e,3840,3976,0)|0)!=0&1;return e|0}function eg(e){e=e|0;return 0}function tg(){return(sg()|0)>0|0}function sg(){return F()|0}function ig(e){e=e|0;return}function rg(e){e=e|0;ig(e);qp(e);return}function ng(e){e=e|0;return 21039}function Ag(e){e=e|0;return}function og(e){e=e|0;var t=0,s=0;t=e+8|0;if(!((n[t>>2]|0)!=0?(s=n[t>>2]|0,n[t>>2]=s+-1,(s|0)!=0):0))jm[n[(n[e>>2]|0)+16>>2]&255](e);return}function ag(e){e=e|0;e=eg(e)|0;if(!e)return;else zg(e,21145)}function lg(e){e=e|0;return}function cg(e,t){e=e|0;t=t|0;var s=0,i=0;i=Zd(t)|0;s=Zf(i+13|0)|0;n[s>>2]=i;n[s+4>>2]=i;n[s+8>>2]=0;s=hg(s)|0;hm(s|0,t|0,i+1|0)|0;n[e>>2]=s;return}function hg(e){e=e|0;return e+12|0}function ug(e,t){e=e|0;t=t|0;n[e>>2]=5916;cg(e+4|0,t);return}function dg(e,t){e=e|0;t=t|0;n[e>>2]=5936;cg(e+4|0,(i[t+11>>0]|0)<0?n[t>>2]|0:t);return}function pg(e,t){e=e|0;t=t|0;n[e>>2]=5936;cg(e+4|0,t);return}function fg(e){e=e|0;e=C(8)|0;ug(e,21163);n[e>>2]=5956;E(e|0,3928,123)}function gg(e){e=e|0;e=C(8)|0;ug(e,21163);n[e>>2]=5976;E(e|0,3944,123)}function mg(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0;A=J;J=J+16|0;r=A;if(s>>>0>4294967279)fg(e);if(s>>>0<11)i[e+11>>0]=s;else{a=s+16&-16;o=Zf(a)|0;n[e>>2]=o;n[e+8>>2]=a|-2147483648;n[e+4>>2]=s;e=o}_g(e,t,s)|0;i[r>>0]=0;rt(e+s|0,r);J=A;return}function _g(e,t,s){e=e|0;t=t|0;s=s|0;if(s|0)hm(e|0,t|0,s|0)|0;return e|0}function bg(e){e=e|0;if((i[e+11>>0]|0)<0)Be(n[e>>2]|0,n[e+8>>2]&2147483647);return}function Bg(e,t,s,r,A,o,a,l){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;o=o|0;a=a|0;l=l|0;var c=0,h=0,u=0,d=0,p=0;p=J;J=J+16|0;d=p;if((-18-t|0)>>>0<s>>>0)fg(e);if((i[e+11>>0]|0)<0)u=n[e>>2]|0;else u=e;if(t>>>0<2147483623){c=s+t|0;h=t<<1;c=c>>>0<h>>>0?h:c;c=c>>>0<11?11:c+16&-16}else c=-17;h=Zf(c)|0;if(A|0)_g(h,u,A)|0;if(a|0)_g(h+A|0,l,a)|0;r=r-o|0;s=r-A|0;if(s|0)_g(h+A+a|0,u+A+o|0,s)|0;s=t+1|0;if((s|0)!=11)Be(u,s);n[e>>2]=h;n[e+8>>2]=c|-2147483648;a=r+a|0;n[e+4>>2]=a;i[d>>0]=0;rt(h+a|0,d);J=p;return}function yg(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0,l=0,c=0;c=J;J=J+16|0;a=c;l=e+11|0;r=i[l>>0]|0;o=r<<24>>24<0;if(o){A=(n[e+8>>2]&2147483647)+-1|0;r=n[e+4>>2]|0}else{A=10;r=r&255}if((A-r|0)>>>0>=s>>>0){if(s|0){if(o)A=n[e>>2]|0;else A=e;_g(A+r|0,t,s)|0;r=r+s|0;if((i[l>>0]|0)<0)n[e+4>>2]=r;else i[l>>0]=r;i[a>>0]=0;rt(A+r|0,a)}}else Bg(e,A,r+s-A|0,r,r,0,s,t);J=c;return e|0}function wg(e,t){e=e|0;t=t|0;return yg(e,t,st(t)|0)|0}function vg(e,t,s){e=e|0;t=t|0;s=s|0;if(!s)e=0;else e=yp(e,t,s)|0;return e|0}function Cg(e,t,s,r,A){e=e|0;t=t|0;s=s|0;r=r|0;A=A|0;var o=0,a=0;o=i[e+11>>0]|0;a=o<<24>>24<0;if(a)o=n[e+4>>2]|0;else o=o&255;if((A|0)==-1|o>>>0<t>>>0)gg(e);o=o-t|0;s=o>>>0<s>>>0?o:s;if(a)e=n[e>>2]|0;o=s>>>0>A>>>0;e=vg(e+t|0,r,o?A:s)|0;if(!e)return(s>>>0<A>>>0?-1:o&1)|0;else return e|0;return 0}function Mg(e){e=e|0;return}function Eg(e){e=e|0;qp(e);return}function Fg(e){e=e|0;return 21228}function xg(e,t,s){e=e|0;t=t|0;s=s|0;n[e>>2]=s;n[e+4>>2]=t;return}function Ug(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0;r=J;J=J+16|0;i=r;zm[n[(n[e>>2]|0)+12>>2]&15](i,e,t);if((n[i+4>>2]|0)==(n[s+4>>2]|0))e=(n[i>>2]|0)==(n[s>>2]|0);else e=0;J=r;return e|0}function Ig(e,t,s){e=e|0;t=t|0;s=s|0;return((n[t>>2]|0)==(s|0)?(n[t+4>>2]|0)==(e|0):0)|0}function Tg(e,t,s){e=e|0;t=t|0;s=s|0;if((s|0)>256)mg(e,21176,st(21176)|0);else Pg(e,0,s);return}function Pg(e,t,s){e=e|0;t=t|0;s=s|0;Sg(e,s);return}function Sg(e,t){e=e|0;t=t|0;var s=0,r=0,A=0,o=0,a=0;a=J;J=J+1040|0;A=a+1024|0;s=a;o=n[(Wd()|0)>>2]|0;r=Dg(Ip(t,s,1024)|0,s)|0;if(!(i[r>>0]|0)){n[A>>2]=t;wp(s,1024,21211,A)|0}else s=r;n[(Wd()|0)>>2]=o;mg(e,s,st(s)|0);J=a;return}function Dg(e,t){e=e|0;t=t|0;var s=0,i=0;switch(e|0){case 0:{s=t;break}case-1:{e=n[(Wd()|0)>>2]|0;i=3;break}default:i=3}if((i|0)==3)if((e|0)==28)s=22145;else j();return s|0}function kg(e){e=e|0;qp(e);return}function Qg(e){e=e|0;return 21353}function Rg(e,t,s){e=e|0;t=t|0;s=s|0;if((s|0)>256){Vg()|0;t=6180}else{Lg()|0;t=6176}n[e>>2]=s;n[e+4>>2]=t;return}function Og(e,t,s){e=e|0;t=t|0;s=s|0;if((s|0)>256)mg(e,21319,st(21319)|0);else Pg(e,0,s);return}function Vg(){if((i[21488]|0)==0?Qf(21488)|0:0)jf(21488);return 6180}function Lg(){if((i[21480]|0)==0?Qf(21480)|0:0)jf(21480);return 6176}function Hg(e){e=e|0;ff(e);return}function Ng(e){e=e|0;Hg(e);qp(e);return}function Gg(e,t){e=e|0;t=t|0;var s=0;s=n[t+4>>2]|0;zm[n[(n[s>>2]|0)+24>>2]&15](e,s,n[t>>2]|0);return}function jg(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0;o=J;J=J+16|0;A=o;if(n[t>>2]|0){r=i[s+11>>0]|0;if(r<<24>>24<0)r=n[s+4>>2]|0;else r=r&255;if(r|0)wg(s,21417)|0;Gg(A,t);t=i[A+11>>0]|0;r=t<<24>>24<0;yg(s,r?n[A>>2]|0:A,r?n[A+4>>2]|0:t&255)|0;bg(A)}n[e>>2]=n[s>>2];n[e+4>>2]=n[s+4>>2];n[e+8>>2]=n[s+8>>2];r=0;while(1){if((r|0)==3)break;n[s+(r<<2)>>2]=0;r=r+1|0}J=o;return}function Wg(e,t,s){e=e|0;t=t|0;s=s|0;var i=0,r=0,A=0;i=J;J=J+32|0;A=i+12|0;r=i;mg(r,s,st(s)|0);jg(A,t,r);dg(e,A);bg(A);bg(r);n[e>>2]=6192;r=t;t=n[r+4>>2]|0;s=e+8|0;n[s>>2]=n[r>>2];n[s+4>>2]=t;J=i;return}function zg(e,t){e=e|0;t=t|0;var s=0,i=0,r=0;r=J;J=J+16|0;i=r+8|0;s=C(16)|0;Vg()|0;n[r>>2]=e;n[r+4>>2]=6180;n[i>>2]=n[r>>2];n[i+4>>2]=n[r+4>>2];Wg(s,i,t);E(s|0,4272,136)}function Xg(e){e=e|0;e=C(8)|0;ug(e,21420);n[e>>2]=5956;E(e|0,3928,123)}function Kg(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0,g=0,m=0,_=0,b=0,B=0,y=0,w=0;w=J;J=J+16|0;d=w;do{if(e>>>0<245){c=e>>>0<11?16:e+11&-8;e=c>>>3;u=n[5412]|0;s=u>>>e;if(s&3|0){t=(s&1^1)+e|0;e=21688+(t<<1<<2)|0;s=e+8|0;i=n[s>>2]|0;r=i+8|0;A=n[r>>2]|0;if((A|0)==(e|0))n[5412]=u&~(1<<t);else{n[A+12>>2]=e;n[s>>2]=A}y=t<<3;n[i+4>>2]=y|3;y=i+y+4|0;n[y>>2]=n[y>>2]|1;y=r;J=w;return y|0}h=n[5414]|0;if(c>>>0>h>>>0){if(s|0){t=2<<e;t=s<<e&(t|0-t);t=(t&0-t)+-1|0;a=t>>>12&16;t=t>>>a;s=t>>>5&8;t=t>>>s;A=t>>>2&4;t=t>>>A;e=t>>>1&2;t=t>>>e;i=t>>>1&1;i=(s|a|A|e|i)+(t>>>i)|0;t=21688+(i<<1<<2)|0;e=t+8|0;A=n[e>>2]|0;a=A+8|0;s=n[a>>2]|0;if((s|0)==(t|0)){e=u&~(1<<i);n[5412]=e}else{n[s+12>>2]=t;n[e>>2]=s;e=u}y=i<<3;o=y-c|0;n[A+4>>2]=c|3;r=A+c|0;n[r+4>>2]=o|1;n[A+y>>2]=o;if(h|0){i=n[5417]|0;t=h>>>3;s=21688+(t<<1<<2)|0;t=1<<t;if(!(e&t)){n[5412]=e|t;t=s;e=s+8|0}else{e=s+8|0;t=n[e>>2]|0}n[e>>2]=i;n[t+12>>2]=i;n[i+8>>2]=t;n[i+12>>2]=s}n[5414]=o;n[5417]=r;y=a;J=w;return y|0}A=n[5413]|0;if(A){s=(A&0-A)+-1|0;r=s>>>12&16;s=s>>>r;i=s>>>5&8;s=s>>>i;o=s>>>2&4;s=s>>>o;a=s>>>1&2;s=s>>>a;l=s>>>1&1;l=n[21952+((i|r|o|a|l)+(s>>>l)<<2)>>2]|0;s=l;a=l;l=(n[l+4>>2]&-8)-c|0;while(1){e=n[s+16>>2]|0;if(!e){e=n[s+20>>2]|0;if(!e)break}o=(n[e+4>>2]&-8)-c|0;r=o>>>0<l>>>0;s=e;a=r?e:a;l=r?o:l}o=a+c|0;if(o>>>0>a>>>0){r=n[a+24>>2]|0;t=n[a+12>>2]|0;do{if((t|0)==(a|0)){e=a+20|0;t=n[e>>2]|0;if(!t){e=a+16|0;t=n[e>>2]|0;if(!t){s=0;break}}while(1){i=t+20|0;s=n[i>>2]|0;if(!s){i=t+16|0;s=n[i>>2]|0;if(!s)break;else{t=s;e=i}}else{t=s;e=i}}n[e>>2]=0;s=t}else{s=n[a+8>>2]|0;n[s+12>>2]=t;n[t+8>>2]=s;s=t}}while(0);do{if(r|0){t=n[a+28>>2]|0;e=21952+(t<<2)|0;if((a|0)==(n[e>>2]|0)){n[e>>2]=s;if(!s){n[5413]=A&~(1<<t);break}}else{y=r+16|0;n[((n[y>>2]|0)==(a|0)?y:r+20|0)>>2]=s;if(!s)break}n[s+24>>2]=r;t=n[a+16>>2]|0;if(t|0){n[s+16>>2]=t;n[t+24>>2]=s}t=n[a+20>>2]|0;if(t|0){n[s+20>>2]=t;n[t+24>>2]=s}}}while(0);if(l>>>0<16){y=l+c|0;n[a+4>>2]=y|3;y=a+y+4|0;n[y>>2]=n[y>>2]|1}else{n[a+4>>2]=c|3;n[o+4>>2]=l|1;n[o+l>>2]=l;if(h|0){i=n[5417]|0;t=h>>>3;s=21688+(t<<1<<2)|0;t=1<<t;if(!(t&u)){n[5412]=t|u;t=s;e=s+8|0}else{e=s+8|0;t=n[e>>2]|0}n[e>>2]=i;n[t+12>>2]=i;n[i+8>>2]=t;n[i+12>>2]=s}n[5414]=l;n[5417]=o}y=a+8|0;J=w;return y|0}else u=c}else u=c}else u=c}else if(e>>>0<=4294967231){e=e+11|0;c=e&-8;i=n[5413]|0;if(i){r=0-c|0;e=e>>>8;if(e)if(c>>>0>16777215)l=31;else{u=(e+1048320|0)>>>16&8;g=e<<u;a=(g+520192|0)>>>16&4;g=g<<a;l=(g+245760|0)>>>16&2;l=14-(a|u|l)+(g<<l>>>15)|0;l=c>>>(l+7|0)&1|l<<1}else l=0;s=n[21952+(l<<2)>>2]|0;e:do{if(!s){s=0;e=0;g=61}else{e=0;a=c<<((l|0)==31?0:25-(l>>>1)|0);A=0;while(1){o=(n[s+4>>2]&-8)-c|0;if(o>>>0<r>>>0)if(!o){e=s;r=0;g=65;break e}else{e=s;r=o}g=n[s+20>>2]|0;s=n[s+16+(a>>>31<<2)>>2]|0;A=(g|0)==0|(g|0)==(s|0)?A:g;if(!s){s=A;g=61;break}else a=a<<1}}}while(0);if((g|0)==61){if((s|0)==0&(e|0)==0){e=2<<l;e=(e|0-e)&i;if(!e){u=c;break}u=(e&0-e)+-1|0;o=u>>>12&16;u=u>>>o;A=u>>>5&8;u=u>>>A;a=u>>>2&4;u=u>>>a;l=u>>>1&2;u=u>>>l;s=u>>>1&1;e=0;s=n[21952+((A|o|a|l|s)+(u>>>s)<<2)>>2]|0}if(!s){a=e;o=r}else g=65}if((g|0)==65){A=s;while(1){u=(n[A+4>>2]&-8)-c|0;s=u>>>0<r>>>0;r=s?u:r;e=s?A:e;s=n[A+16>>2]|0;if(!s)s=n[A+20>>2]|0;if(!s){a=e;o=r;break}else A=s}}if(((a|0)!=0?o>>>0<((n[5414]|0)-c|0)>>>0:0)?(h=a+c|0,h>>>0>a>>>0):0){A=n[a+24>>2]|0;t=n[a+12>>2]|0;do{if((t|0)==(a|0)){e=a+20|0;t=n[e>>2]|0;if(!t){e=a+16|0;t=n[e>>2]|0;if(!t){t=0;break}}while(1){r=t+20|0;s=n[r>>2]|0;if(!s){r=t+16|0;s=n[r>>2]|0;if(!s)break;else{t=s;e=r}}else{t=s;e=r}}n[e>>2]=0}else{y=n[a+8>>2]|0;n[y+12>>2]=t;n[t+8>>2]=y}}while(0);do{if(A){e=n[a+28>>2]|0;s=21952+(e<<2)|0;if((a|0)==(n[s>>2]|0)){n[s>>2]=t;if(!t){i=i&~(1<<e);n[5413]=i;break}}else{y=A+16|0;n[((n[y>>2]|0)==(a|0)?y:A+20|0)>>2]=t;if(!t)break}n[t+24>>2]=A;e=n[a+16>>2]|0;if(e|0){n[t+16>>2]=e;n[e+24>>2]=t}e=n[a+20>>2]|0;if(e){n[t+20>>2]=e;n[e+24>>2]=t}}}while(0);e:do{if(o>>>0<16){y=o+c|0;n[a+4>>2]=y|3;y=a+y+4|0;n[y>>2]=n[y>>2]|1}else{n[a+4>>2]=c|3;n[h+4>>2]=o|1;n[h+o>>2]=o;t=o>>>3;if(o>>>0<256){s=21688+(t<<1<<2)|0;e=n[5412]|0;t=1<<t;if(!(e&t)){n[5412]=e|t;t=s;e=s+8|0}else{e=s+8|0;t=n[e>>2]|0}n[e>>2]=h;n[t+12>>2]=h;n[h+8>>2]=t;n[h+12>>2]=s;break}t=o>>>8;if(t)if(o>>>0>16777215)s=31;else{B=(t+1048320|0)>>>16&8;y=t<<B;b=(y+520192|0)>>>16&4;y=y<<b;s=(y+245760|0)>>>16&2;s=14-(b|B|s)+(y<<s>>>15)|0;s=o>>>(s+7|0)&1|s<<1}else s=0;t=21952+(s<<2)|0;n[h+28>>2]=s;e=h+16|0;n[e+4>>2]=0;n[e>>2]=0;e=1<<s;if(!(i&e)){n[5413]=i|e;n[t>>2]=h;n[h+24>>2]=t;n[h+12>>2]=h;n[h+8>>2]=h;break}t=n[t>>2]|0;t:do{if((n[t+4>>2]&-8|0)!=(o|0)){i=o<<((s|0)==31?0:25-(s>>>1)|0);while(1){s=t+16+(i>>>31<<2)|0;e=n[s>>2]|0;if(!e)break;if((n[e+4>>2]&-8|0)==(o|0)){t=e;break t}else{i=i<<1;t=e}}n[s>>2]=h;n[h+24>>2]=t;n[h+12>>2]=h;n[h+8>>2]=h;break e}}while(0);B=t+8|0;y=n[B>>2]|0;n[y+12>>2]=h;n[B>>2]=h;n[h+8>>2]=y;n[h+12>>2]=t;n[h+24>>2]=0}}while(0);y=a+8|0;J=w;return y|0}else u=c}else u=c}else u=-1}while(0);s=n[5414]|0;if(s>>>0>=u>>>0){t=s-u|0;e=n[5417]|0;if(t>>>0>15){y=e+u|0;n[5417]=y;n[5414]=t;n[y+4>>2]=t|1;n[e+s>>2]=t;n[e+4>>2]=u|3}else{n[5414]=0;n[5417]=0;n[e+4>>2]=s|3;y=e+s+4|0;n[y>>2]=n[y>>2]|1}y=e+8|0;J=w;return y|0}o=n[5415]|0;if(o>>>0>u>>>0){b=o-u|0;n[5415]=b;y=n[5418]|0;B=y+u|0;n[5418]=B;n[B+4>>2]=b|1;n[y+4>>2]=u|3;y=y+8|0;J=w;return y|0}if(!(n[5530]|0)){n[5532]=4096;n[5531]=4096;n[5533]=-1;n[5534]=-1;n[5535]=0;n[5523]=0;n[5530]=d&-16^1431655768;e=4096}else e=n[5532]|0;a=u+48|0;l=u+47|0;A=e+l|0;r=0-e|0;c=A&r;if(c>>>0<=u>>>0){y=0;J=w;return y|0}e=n[5522]|0;if(e|0?(h=n[5520]|0,d=h+c|0,d>>>0<=h>>>0|d>>>0>e>>>0):0){y=0;J=w;return y|0}e:do{if(!(n[5523]&4)){s=n[5418]|0;t:do{if(s){i=22096;while(1){d=n[i>>2]|0;if(d>>>0<=s>>>0?(d+(n[i+4>>2]|0)|0)>>>0>s>>>0:0)break;e=n[i+8>>2]|0;if(!e){g=128;break t}else i=e}t=A-o&r;if(t>>>0<2147483647){e=Jg(t)|0;if((e|0)==((n[i>>2]|0)+(n[i+4>>2]|0)|0)){if((e|0)!=(-1|0)){o=t;A=e;g=145;break e}}else{i=e;g=136}}else t=0}else g=128}while(0);do{if((g|0)==128){s=Jg(0)|0;if((s|0)!=(-1|0)?(t=s,p=n[5531]|0,f=p+-1|0,t=((f&t|0)==0?0:(f+t&0-p)-t|0)+c|0,p=n[5520]|0,f=t+p|0,t>>>0>u>>>0&t>>>0<2147483647):0){d=n[5522]|0;if(d|0?f>>>0<=p>>>0|f>>>0>d>>>0:0){t=0;break}e=Jg(t)|0;if((e|0)==(s|0)){o=t;A=s;g=145;break e}else{i=e;g=136}}else t=0}}while(0);do{if((g|0)==136){s=0-t|0;if(!(a>>>0>t>>>0&(t>>>0<2147483647&(i|0)!=(-1|0))))if((i|0)==(-1|0)){t=0;break}else{o=t;A=i;g=145;break e}e=n[5532]|0;e=l-t+e&0-e;if(e>>>0>=2147483647){o=t;A=i;g=145;break e}if((Jg(e)|0)==(-1|0)){Jg(s)|0;t=0;break}else{o=e+t|0;A=i;g=145;break e}}}while(0);n[5523]=n[5523]|4;g=143}else{t=0;g=143}}while(0);if(((g|0)==143?c>>>0<2147483647:0)?(b=Jg(c)|0,f=Jg(0)|0,m=f-b|0,_=m>>>0>(u+40|0)>>>0,!((b|0)==(-1|0)|_^1|b>>>0<f>>>0&((b|0)!=(-1|0)&(f|0)!=(-1|0))^1)):0){o=_?m:t;A=b;g=145}if((g|0)==145){t=(n[5520]|0)+o|0;n[5520]=t;if(t>>>0>(n[5521]|0)>>>0)n[5521]=t;l=n[5418]|0;e:do{if(l){t=22096;while(1){e=n[t>>2]|0;s=n[t+4>>2]|0;if((A|0)==(e+s|0)){g=154;break}i=n[t+8>>2]|0;if(!i)break;else t=i}if(((g|0)==154?(B=t+4|0,(n[t+12>>2]&8|0)==0):0)?A>>>0>l>>>0&e>>>0<=l>>>0:0){n[B>>2]=s+o;y=(n[5415]|0)+o|0;b=l+8|0;b=(b&7|0)==0?0:0-b&7;B=l+b|0;b=y-b|0;n[5418]=B;n[5415]=b;n[B+4>>2]=b|1;n[l+y+4>>2]=40;n[5419]=n[5534];break}if(A>>>0<(n[5416]|0)>>>0)n[5416]=A;s=A+o|0;t=22096;while(1){if((n[t>>2]|0)==(s|0)){g=162;break}e=n[t+8>>2]|0;if(!e)break;else t=e}if((g|0)==162?(n[t+12>>2]&8|0)==0:0){n[t>>2]=A;h=t+4|0;n[h>>2]=(n[h>>2]|0)+o;h=A+8|0;h=A+((h&7|0)==0?0:0-h&7)|0;t=s+8|0;t=s+((t&7|0)==0?0:0-t&7)|0;c=h+u|0;a=t-h-u|0;n[h+4>>2]=u|3;t:do{if((l|0)==(t|0)){y=(n[5415]|0)+a|0;n[5415]=y;n[5418]=c;n[c+4>>2]=y|1}else{if((n[5417]|0)==(t|0)){y=(n[5414]|0)+a|0;n[5414]=y;n[5417]=c;n[c+4>>2]=y|1;n[c+y>>2]=y;break}e=n[t+4>>2]|0;if((e&3|0)==1){o=e&-8;i=e>>>3;s:do{if(e>>>0<256){e=n[t+8>>2]|0;s=n[t+12>>2]|0;if((s|0)==(e|0)){n[5412]=n[5412]&~(1<<i);break}else{n[e+12>>2]=s;n[s+8>>2]=e;break}}else{A=n[t+24>>2]|0;e=n[t+12>>2]|0;do{if((e|0)==(t|0)){s=t+16|0;i=s+4|0;e=n[i>>2]|0;if(!e){e=n[s>>2]|0;if(!e){e=0;break}}else s=i;while(1){r=e+20|0;i=n[r>>2]|0;if(!i){r=e+16|0;i=n[r>>2]|0;if(!i)break;else{e=i;s=r}}else{e=i;s=r}}n[s>>2]=0}else{y=n[t+8>>2]|0;n[y+12>>2]=e;n[e+8>>2]=y}}while(0);if(!A)break;s=n[t+28>>2]|0;i=21952+(s<<2)|0;do{if((n[i>>2]|0)!=(t|0)){y=A+16|0;n[((n[y>>2]|0)==(t|0)?y:A+20|0)>>2]=e;if(!e)break s}else{n[i>>2]=e;if(e|0)break;n[5413]=n[5413]&~(1<<s);break s}}while(0);n[e+24>>2]=A;s=t+16|0;i=n[s>>2]|0;if(i|0){n[e+16>>2]=i;n[i+24>>2]=e}s=n[s+4>>2]|0;if(!s)break;n[e+20>>2]=s;n[s+24>>2]=e}}while(0);t=t+o|0;r=o+a|0}else r=a;t=t+4|0;n[t>>2]=n[t>>2]&-2;n[c+4>>2]=r|1;n[c+r>>2]=r;t=r>>>3;if(r>>>0<256){s=21688+(t<<1<<2)|0;e=n[5412]|0;t=1<<t;if(!(e&t)){n[5412]=e|t;t=s;e=s+8|0}else{e=s+8|0;t=n[e>>2]|0}n[e>>2]=c;n[t+12>>2]=c;n[c+8>>2]=t;n[c+12>>2]=s;break}t=r>>>8;do{if(!t)i=0;else{if(r>>>0>16777215){i=31;break}B=(t+1048320|0)>>>16&8;y=t<<B;b=(y+520192|0)>>>16&4;y=y<<b;i=(y+245760|0)>>>16&2;i=14-(b|B|i)+(y<<i>>>15)|0;i=r>>>(i+7|0)&1|i<<1}}while(0);t=21952+(i<<2)|0;n[c+28>>2]=i;e=c+16|0;n[e+4>>2]=0;n[e>>2]=0;e=n[5413]|0;s=1<<i;if(!(e&s)){n[5413]=e|s;n[t>>2]=c;n[c+24>>2]=t;n[c+12>>2]=c;n[c+8>>2]=c;break}t=n[t>>2]|0;s:do{if((n[t+4>>2]&-8|0)!=(r|0)){i=r<<((i|0)==31?0:25-(i>>>1)|0);while(1){s=t+16+(i>>>31<<2)|0;e=n[s>>2]|0;if(!e)break;if((n[e+4>>2]&-8|0)==(r|0)){t=e;break s}else{i=i<<1;t=e}}n[s>>2]=c;n[c+24>>2]=t;n[c+12>>2]=c;n[c+8>>2]=c;break t}}while(0);B=t+8|0;y=n[B>>2]|0;n[y+12>>2]=c;n[B>>2]=c;n[c+8>>2]=y;n[c+12>>2]=t;n[c+24>>2]=0}}while(0);y=h+8|0;J=w;return y|0}t=22096;while(1){e=n[t>>2]|0;if(e>>>0<=l>>>0?(y=e+(n[t+4>>2]|0)|0,y>>>0>l>>>0):0)break;t=n[t+8>>2]|0}r=y+-47|0;e=r+8|0;e=r+((e&7|0)==0?0:0-e&7)|0;r=l+16|0;e=e>>>0<r>>>0?l:e;t=e+8|0;s=o+-40|0;b=A+8|0;b=(b&7|0)==0?0:0-b&7;B=A+b|0;b=s-b|0;n[5418]=B;n[5415]=b;n[B+4>>2]=b|1;n[A+s+4>>2]=40;n[5419]=n[5534];s=e+4|0;n[s>>2]=27;n[t>>2]=n[5524];n[t+4>>2]=n[5525];n[t+8>>2]=n[5526];n[t+12>>2]=n[5527];n[5524]=A;n[5525]=o;n[5527]=0;n[5526]=t;t=e+24|0;do{B=t;t=t+4|0;n[t>>2]=7}while((B+8|0)>>>0<y>>>0);if((e|0)!=(l|0)){A=e-l|0;n[s>>2]=n[s>>2]&-2;n[l+4>>2]=A|1;n[e>>2]=A;t=A>>>3;if(A>>>0<256){s=21688+(t<<1<<2)|0;e=n[5412]|0;t=1<<t;if(!(e&t)){n[5412]=e|t;t=s;e=s+8|0}else{e=s+8|0;t=n[e>>2]|0}n[e>>2]=l;n[t+12>>2]=l;n[l+8>>2]=t;n[l+12>>2]=s;break}t=A>>>8;if(t)if(A>>>0>16777215)i=31;else{B=(t+1048320|0)>>>16&8;y=t<<B;b=(y+520192|0)>>>16&4;y=y<<b;i=(y+245760|0)>>>16&2;i=14-(b|B|i)+(y<<i>>>15)|0;i=A>>>(i+7|0)&1|i<<1}else i=0;s=21952+(i<<2)|0;n[l+28>>2]=i;n[l+20>>2]=0;n[r>>2]=0;t=n[5413]|0;e=1<<i;if(!(t&e)){n[5413]=t|e;n[s>>2]=l;n[l+24>>2]=s;n[l+12>>2]=l;n[l+8>>2]=l;break}t=n[s>>2]|0;t:do{if((n[t+4>>2]&-8|0)!=(A|0)){i=A<<((i|0)==31?0:25-(i>>>1)|0);while(1){s=t+16+(i>>>31<<2)|0;e=n[s>>2]|0;if(!e)break;if((n[e+4>>2]&-8|0)==(A|0)){t=e;break t}else{i=i<<1;t=e}}n[s>>2]=l;n[l+24>>2]=t;n[l+12>>2]=l;n[l+8>>2]=l;break e}}while(0);B=t+8|0;y=n[B>>2]|0;n[y+12>>2]=l;n[B>>2]=l;n[l+8>>2]=y;n[l+12>>2]=t;n[l+24>>2]=0}}else{y=n[5416]|0;if((y|0)==0|A>>>0<y>>>0)n[5416]=A;n[5524]=A;n[5525]=o;n[5527]=0;n[5421]=n[5530];n[5420]=-1;n[5425]=21688;n[5424]=21688;n[5427]=21696;n[5426]=21696;n[5429]=21704;n[5428]=21704;n[5431]=21712;n[5430]=21712;n[5433]=21720;n[5432]=21720;n[5435]=21728;n[5434]=21728;n[5437]=21736;n[5436]=21736;n[5439]=21744;n[5438]=21744;n[5441]=21752;n[5440]=21752;n[5443]=21760;n[5442]=21760;n[5445]=21768;n[5444]=21768;n[5447]=21776;n[5446]=21776;n[5449]=21784;n[5448]=21784;n[5451]=21792;n[5450]=21792;n[5453]=21800;n[5452]=21800;n[5455]=21808;n[5454]=21808;n[5457]=21816;n[5456]=21816;n[5459]=21824;n[5458]=21824;n[5461]=21832;n[5460]=21832;n[5463]=21840;n[5462]=21840;n[5465]=21848;n[5464]=21848;n[5467]=21856;n[5466]=21856;n[5469]=21864;n[5468]=21864;n[5471]=21872;n[5470]=21872;n[5473]=21880;n[5472]=21880;n[5475]=21888;n[5474]=21888;n[5477]=21896;n[5476]=21896;n[5479]=21904;n[5478]=21904;n[5481]=21912;n[5480]=21912;n[5483]=21920;n[5482]=21920;n[5485]=21928;n[5484]=21928;n[5487]=21936;n[5486]=21936;y=o+-40|0;b=A+8|0;b=(b&7|0)==0?0:0-b&7;B=A+b|0;b=y-b|0;n[5418]=B;n[5415]=b;n[B+4>>2]=b|1;n[A+y+4>>2]=40;n[5419]=n[5534]}}while(0);t=n[5415]|0;if(t>>>0>u>>>0){b=t-u|0;n[5415]=b;y=n[5418]|0;B=y+u|0;n[5418]=B;n[B+4>>2]=b|1;n[y+4>>2]=u|3;y=y+8|0;J=w;return y|0}}n[(Wd()|0)>>2]=48;y=0;J=w;return y|0}function Zg(e){e=e|0;var t=0,s=0,i=0,r=0,A=0,o=0,a=0,l=0;if(!e)return;s=e+-8|0;r=n[5416]|0;e=n[e+-4>>2]|0;t=e&-8;l=s+t|0;do{if(!(e&1)){i=n[s>>2]|0;if(!(e&3))return;o=s+(0-i)|0;A=i+t|0;if(o>>>0<r>>>0)return;if((n[5417]|0)==(o|0)){e=l+4|0;t=n[e>>2]|0;if((t&3|0)!=3){a=o;t=A;break}n[5414]=A;n[e>>2]=t&-2;n[o+4>>2]=A|1;n[o+A>>2]=A;return}s=i>>>3;if(i>>>0<256){e=n[o+8>>2]|0;t=n[o+12>>2]|0;if((t|0)==(e|0)){n[5412]=n[5412]&~(1<<s);a=o;t=A;break}else{n[e+12>>2]=t;n[t+8>>2]=e;a=o;t=A;break}}r=n[o+24>>2]|0;e=n[o+12>>2]|0;do{if((e|0)==(o|0)){t=o+16|0;s=t+4|0;e=n[s>>2]|0;if(!e){e=n[t>>2]|0;if(!e){e=0;break}}else t=s;while(1){i=e+20|0;s=n[i>>2]|0;if(!s){i=e+16|0;s=n[i>>2]|0;if(!s)break;else{e=s;t=i}}else{e=s;t=i}}n[t>>2]=0}else{a=n[o+8>>2]|0;n[a+12>>2]=e;n[e+8>>2]=a}}while(0);if(r){t=n[o+28>>2]|0;s=21952+(t<<2)|0;if((n[s>>2]|0)==(o|0)){n[s>>2]=e;if(!e){n[5413]=n[5413]&~(1<<t);a=o;t=A;break}}else{a=r+16|0;n[((n[a>>2]|0)==(o|0)?a:r+20|0)>>2]=e;if(!e){a=o;t=A;break}}n[e+24>>2]=r;t=o+16|0;s=n[t>>2]|0;if(s|0){n[e+16>>2]=s;n[s+24>>2]=e}t=n[t+4>>2]|0;if(t){n[e+20>>2]=t;n[t+24>>2]=e;a=o;t=A}else{a=o;t=A}}else{a=o;t=A}}else{a=s;o=s}}while(0);if(o>>>0>=l>>>0)return;e=l+4|0;i=n[e>>2]|0;if(!(i&1))return;if(!(i&2)){if((n[5418]|0)==(l|0)){l=(n[5415]|0)+t|0;n[5415]=l;n[5418]=a;n[a+4>>2]=l|1;if((a|0)!=(n[5417]|0))return;n[5417]=0;n[5414]=0;return}if((n[5417]|0)==(l|0)){l=(n[5414]|0)+t|0;n[5414]=l;n[5417]=o;n[a+4>>2]=l|1;n[o+l>>2]=l;return}r=(i&-8)+t|0;s=i>>>3;do{if(i>>>0<256){t=n[l+8>>2]|0;e=n[l+12>>2]|0;if((e|0)==(t|0)){n[5412]=n[5412]&~(1<<s);break}else{n[t+12>>2]=e;n[e+8>>2]=t;break}}else{A=n[l+24>>2]|0;e=n[l+12>>2]|0;do{if((e|0)==(l|0)){t=l+16|0;s=t+4|0;e=n[s>>2]|0;if(!e){e=n[t>>2]|0;if(!e){s=0;break}}else t=s;while(1){i=e+20|0;s=n[i>>2]|0;if(!s){i=e+16|0;s=n[i>>2]|0;if(!s)break;else{e=s;t=i}}else{e=s;t=i}}n[t>>2]=0;s=e}else{s=n[l+8>>2]|0;n[s+12>>2]=e;n[e+8>>2]=s;s=e}}while(0);if(A|0){e=n[l+28>>2]|0;t=21952+(e<<2)|0;if((n[t>>2]|0)==(l|0)){n[t>>2]=s;if(!s){n[5413]=n[5413]&~(1<<e);break}}else{i=A+16|0;n[((n[i>>2]|0)==(l|0)?i:A+20|0)>>2]=s;if(!s)break}n[s+24>>2]=A;e=l+16|0;t=n[e>>2]|0;if(t|0){n[s+16>>2]=t;n[t+24>>2]=s}e=n[e+4>>2]|0;if(e|0){n[s+20>>2]=e;n[e+24>>2]=s}}}}while(0);n[a+4>>2]=r|1;n[o+r>>2]=r;if((a|0)==(n[5417]|0)){n[5414]=r;return}}else{n[e>>2]=i&-2;n[a+4>>2]=t|1;n[o+t>>2]=t;r=t}e=r>>>3;if(r>>>0<256){s=21688+(e<<1<<2)|0;t=n[5412]|0;e=1<<e;if(!(t&e)){n[5412]=t|e;e=s;t=s+8|0}else{t=s+8|0;e=n[t>>2]|0}n[t>>2]=a;n[e+12>>2]=a;n[a+8>>2]=e;n[a+12>>2]=s;return}e=r>>>8;if(e)if(r>>>0>16777215)i=31;else{o=(e+1048320|0)>>>16&8;l=e<<o;A=(l+520192|0)>>>16&4;l=l<<A;i=(l+245760|0)>>>16&2;i=14-(A|o|i)+(l<<i>>>15)|0;i=r>>>(i+7|0)&1|i<<1}else i=0;e=21952+(i<<2)|0;n[a+28>>2]=i;n[a+20>>2]=0;n[a+16>>2]=0;t=n[5413]|0;s=1<<i;e:do{if(!(t&s)){n[5413]=t|s;n[e>>2]=a;n[a+24>>2]=e;n[a+12>>2]=a;n[a+8>>2]=a}else{e=n[e>>2]|0;t:do{if((n[e+4>>2]&-8|0)!=(r|0)){i=r<<((i|0)==31?0:25-(i>>>1)|0);while(1){s=e+16+(i>>>31<<2)|0;t=n[s>>2]|0;if(!t)break;if((n[t+4>>2]&-8|0)==(r|0)){e=t;break t}else{i=i<<1;e=t}}n[s>>2]=a;n[a+24>>2]=e;n[a+12>>2]=a;n[a+8>>2]=a;break e}}while(0);o=e+8|0;l=n[o>>2]|0;n[l+12>>2]=a;n[o>>2]=a;n[a+8>>2]=l;n[a+12>>2]=e;n[a+24>>2]=0}}while(0);l=(n[5420]|0)+-1|0;n[5420]=l;if(l|0)return;e=22104;while(1){e=n[e>>2]|0;if(!e)break;else e=e+8|0}n[5420]=-1;return}function Jg(e){e=e|0;var t=0,s=0,i=0;i=e+3&-4;e=lm()|0;t=n[e>>2]|0;s=t+i|0;do{if((i|0)<1|s>>>0>t>>>0){if(s>>>0>(z()|0)>>>0?(K(s|0)|0)==0:0)break;n[e>>2]=s;i=t;return i|0}}while(0);n[(Wd()|0)>>2]=48;i=-1;return i|0}function Yg(e){e=e|0;var t=0;t=J;J=J+e|0;J=J+15&-16;return t|0}function $g(e){e=e|0;J=e}function qg(){return J|0}function em(e,t){e=e|0;t=t|0;var s=0,i=0,r=0,n=0;n=e&65535;r=t&65535;s=b(r,n)|0;i=e>>>16;e=(s>>>16)+(b(r,i)|0)|0;r=t>>>16;t=b(r,n)|0;return(w((e>>>16)+(b(r,i)|0)+(((e&65535)+t|0)>>>16)|0),e+t<<16|s&65535|0)|0}function tm(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;var r=0,n=0;r=e;n=s;s=em(r,n)|0;e=v()|0;return(w((b(t,n)|0)+(b(i,r)|0)+e|e&0|0),s|0|0)|0}function sm(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;s=e+s>>>0;return(w(t+i+(s>>>0<e>>>0|0)>>>0|0),s|0)|0}function im(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;i=t-i-(s>>>0>e>>>0|0)>>>0;return(w(i|0),e-s>>>0|0)|0}function rm(e){e=e|0;return(e?31-(B(e^e-1)|0)|0:32)|0}function nm(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;var A=0,o=0,a=0,l=0,c=0,h=0,u=0,d=0,p=0,f=0;h=e;l=t;c=l;o=s;d=i;a=d;if(!c){A=(r|0)!=0;if(!a){if(A){n[r>>2]=(h>>>0)%(o>>>0);n[r+4>>2]=0}d=0;r=(h>>>0)/(o>>>0)>>>0;return(w(d|0),r)|0}else{if(!A){d=0;r=0;return(w(d|0),r)|0}n[r>>2]=e|0;n[r+4>>2]=t&0;d=0;r=0;return(w(d|0),r)|0}}A=(a|0)==0;do{if(o){if(!A){A=(B(a|0)|0)-(B(c|0)|0)|0;if(A>>>0<=31){u=A+1|0;a=31-A|0;t=A-31>>31;o=u;e=h>>>(u>>>0)&t|c<<a;t=c>>>(u>>>0)&t;A=0;a=h<<a;break}if(!r){d=0;r=0;return(w(d|0),r)|0}n[r>>2]=e|0;n[r+4>>2]=l|t&0;d=0;r=0;return(w(d|0),r)|0}A=o-1|0;if(A&o|0){a=(B(o|0)|0)+33-(B(c|0)|0)|0;f=64-a|0;u=32-a|0;l=u>>31;p=a-32|0;t=p>>31;o=a;e=u-1>>31&c>>>(p>>>0)|(c<<u|h>>>(a>>>0))&t;t=t&c>>>(a>>>0);A=h<<f&l;a=(c<<f|h>>>(p>>>0))&l|h<<u&a-33>>31;break}if(r|0){n[r>>2]=A&h;n[r+4>>2]=0}if((o|0)==1){p=l|t&0;f=e|0|0;return(w(p|0),f)|0}else{f=rm(o|0)|0;p=c>>>(f>>>0)|0;f=c<<32-f|h>>>(f>>>0)|0;return(w(p|0),f)|0}}else{if(A){if(r|0){n[r>>2]=(c>>>0)%(o>>>0);n[r+4>>2]=0}p=0;f=(c>>>0)/(o>>>0)>>>0;return(w(p|0),f)|0}if(!h){if(r|0){n[r>>2]=0;n[r+4>>2]=(c>>>0)%(a>>>0)}p=0;f=(c>>>0)/(a>>>0)>>>0;return(w(p|0),f)|0}A=a-1|0;if(!(A&a)){if(r|0){n[r>>2]=e|0;n[r+4>>2]=A&c|t&0}p=0;f=c>>>((rm(a|0)|0)>>>0);return(w(p|0),f)|0}A=(B(a|0)|0)-(B(c|0)|0)|0;if(A>>>0<=30){t=A+1|0;a=31-A|0;o=t;e=c<<a|h>>>(t>>>0);t=c>>>(t>>>0);A=0;a=h<<a;break}if(!r){p=0;f=0;return(w(p|0),f)|0}n[r>>2]=e|0;n[r+4>>2]=l|t&0;p=0;f=0;return(w(p|0),f)|0}}while(0);if(!o){c=a;l=0;a=0}else{u=s|0|0;h=d|i&0;c=sm(u|0,h|0,-1,-1)|0;s=v()|0;l=a;a=0;do{i=l;l=A>>>31|l<<1;A=a|A<<1;i=e<<1|i>>>31|0;d=e>>>31|t<<1|0;im(c|0,s|0,i|0,d|0)|0;f=v()|0;p=f>>31|((f|0)<0?-1:0)<<1;a=p&1;e=im(i|0,d|0,p&u|0,(((f|0)<0?-1:0)>>31|((f|0)<0?-1:0)<<1)&h|0)|0;t=v()|0;o=o-1|0}while((o|0)!=0);c=l;l=0}o=0;if(r|0){n[r>>2]=e;n[r+4>>2]=t}p=(A|0)>>>31|(c|o)<<1|(o<<1|A>>>31)&0|l;f=(A<<1|0>>>31)&-2|a;return(w(p|0),f)|0}function Am(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;return nm(e,t,s,i,0)|0}function om(e,t,s){e=e|0;t=t|0;s=s|0;if((s|0)<32){w(t>>>s|0);return e>>>s|(t&(1<<s)-1)<<32-s}w(0);return t>>>s-32|0}function am(e,t,s){e=e|0;t=t|0;s=s|0;if((s|0)<32){w(t<<s|(e&(1<<s)-1<<32-s)>>>32-s|0);return e<<s}w(e<<s-32|0);return 0}function lm(){return 22176}function cm(e){e=e|0;return(e&255)<<24|(e>>8&255)<<16|(e>>16&255)<<8|e>>>24|0}function hm(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0;if((s|0)>=512){X(e|0,t|0,s|0)|0;return e|0}o=e|0;A=e+s|0;if((e&3)==(t&3)){while(e&3){if(!s)return o|0;i[e>>0]=i[t>>0]|0;e=e+1|0;t=t+1|0;s=s-1|0}s=A&-4|0;r=s-64|0;while((e|0)<=(r|0)){n[e>>2]=n[t>>2];n[e+4>>2]=n[t+4>>2];n[e+8>>2]=n[t+8>>2];n[e+12>>2]=n[t+12>>2];n[e+16>>2]=n[t+16>>2];n[e+20>>2]=n[t+20>>2];n[e+24>>2]=n[t+24>>2];n[e+28>>2]=n[t+28>>2];n[e+32>>2]=n[t+32>>2];n[e+36>>2]=n[t+36>>2];n[e+40>>2]=n[t+40>>2];n[e+44>>2]=n[t+44>>2];n[e+48>>2]=n[t+48>>2];n[e+52>>2]=n[t+52>>2];n[e+56>>2]=n[t+56>>2];n[e+60>>2]=n[t+60>>2];e=e+64|0;t=t+64|0}while((e|0)<(s|0)){n[e>>2]=n[t>>2];e=e+4|0;t=t+4|0}}else{s=A-4|0;while((e|0)<(s|0)){i[e>>0]=i[t>>0]|0;i[e+1>>0]=i[t+1>>0]|0;i[e+2>>0]=i[t+2>>0]|0;i[e+3>>0]=i[t+3>>0]|0;e=e+4|0;t=t+4|0}}while((e|0)<(A|0)){i[e>>0]=i[t>>0]|0;e=e+1|0;t=t+1|0}return o|0}function um(e,t,s){e=e|0;t=t|0;s=s|0;var r=0;if((t|0)<(e|0)&(e|0)<(t+s|0)){r=e;t=t+s|0;e=e+s|0;while((s|0)>0){e=e-1|0;t=t-1|0;s=s-1|0;i[e>>0]=i[t>>0]|0}e=r}else hm(e,t,s)|0;return e|0}function dm(e,t,s){e=e|0;t=t|0;s=s|0;var r=0,A=0,o=0,a=0;o=e+s|0;t=t&255;if((s|0)>=67){while(e&3){i[e>>0]=t;e=e+1|0}r=o&-4|0;a=t|t<<8|t<<16|t<<24;A=r-64|0;while((e|0)<=(A|0)){n[e>>2]=a;n[e+4>>2]=a;n[e+8>>2]=a;n[e+12>>2]=a;n[e+16>>2]=a;n[e+20>>2]=a;n[e+24>>2]=a;n[e+28>>2]=a;n[e+32>>2]=a;n[e+36>>2]=a;n[e+40>>2]=a;n[e+44>>2]=a;n[e+48>>2]=a;n[e+52>>2]=a;n[e+56>>2]=a;n[e+60>>2]=a;e=e+64|0}while((e|0)<(r|0)){n[e>>2]=a;e=e+4|0}}while((e|0)<(o|0)){i[e>>0]=t;e=e+1|0}return o-s|0}function pm(e){e=e|0;return Om[e&3]()|0}function fm(e,t){e=e|0;t=t|0;return Vm[e&15](t|0)|0}function gm(e,t,s,i,r,n,A){e=e|0;t=t|0;s=+s;i=i|0;r=r|0;n=n|0;A=A|0;return Lm[e&1](t|0,+s,i|0,r|0,n|0,A|0)|0}function mm(e,t,s){e=e|0;t=t|0;s=s|0;return Hm[e&63](t|0,s|0)|0}function _m(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;return Nm[e&7](t|0,s|0,i|0)|0}function bm(e){e=e|0;Gm[e&3]()}function Bm(e,t){e=e|0;t=t|0;jm[e&255](t|0)}function ym(e,t,s){e=e|0;t=t|0;s=s|0;Wm[e&15](t|0,s|0)}function wm(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;zm[e&15](t|0,s|0,i|0)}function vm(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;Xm[e&7](t|0,s|0,i|0,r|0)}function Cm(e,t,s,i,r,n){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;n=n|0;Km[e&3](t|0,s|0,i|0,r|0,n|0)}function Mm(e,t,s,i,r,n,A){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;n=n|0;A=A|0;Zm[e&3](t|0,s|0,i|0,r|0,n|0,A|0)}function Em(){y(0);return 0}function Fm(e){e=e|0;y(1);return 0}function xm(e,t,s,i,r,n){e=e|0;t=+t;s=s|0;i=i|0;r=r|0;n=n|0;y(2);return 0}function Um(e,t){e=e|0;t=t|0;y(3);return 0}function Im(e,t,s){e=e|0;t=t|0;s=s|0;y(4);return 0}function Tm(){y(5)}function Pm(e){e=e|0;y(6)}function Sm(e,t){e=e|0;t=t|0;y(7)}function Dm(e,t,s){e=e|0;t=t|0;s=s|0;y(8)}function km(e,t,s,i){e=e|0;t=t|0;s=s|0;i=i|0;y(9)}function Qm(e,t,s,i,r){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;y(10)}function Rm(e,t,s,i,r,n){e=e|0;t=t|0;s=s|0;i=i|0;r=r|0;n=n|0;y(11)}var Om=[Em,Ic,vh,Em];var Vm=[Fm,mf,gt,wt,of,cf,ng,Fg,Qg,pc,re,hh,Pc,Mh,Fm,Fm];var Lm=[xm,np];var Hm=[Um,_e,Fe,yt,ei,Ii,Li,er,tr,rr,Gr,Jr,fn,wn,Tn,On,CA,SA,NA,XA,so,oo,mo,wo,To,jo,Yo,sa,ca,ba,Qa,Ga,Ya,Al,gl,vl,Sl,Nl,Jl,ic,hc,ih,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um,Um];var Nm=[Im,Cp,Lp,wf,Cf,Ug,Ig,Im];var Gm=[Tm,Bf,Tp,Tm];var jm=[Pm,Ag,ge,me,be,Me,Ee,xe,ff,nt,vt,ft,_t,bt,xt,Ut,Lt,Ht,ls,cs,hs,Is,$s,qs,ti,Ei,Ti,Pi,Si,Di,Oi,Vi,Hi,$i,qi,sr,ir,Hr,Nr,jr,Kr,Zr,dn,pn,gn,Bn,yn,Un,In,Pn,Qn,Rn,wA,vA,MA,DA,kA,LA,HA,GA,KA,ZA,eo,to,io,ao,lo,fo,go,_o,vo,Co,Uo,Io,Po,No,Go,Wo,Zo,Jo,$o,ia,ra,aa,la,ha,ma,_a,Da,ka,Ra,Ha,Na,Za,Ja,$a,rl,nl,pl,fl,ml,yl,wl,Tl,Pl,Dl,Ll,Hl,Kl,Zl,Yl,tc,sc,lc,cc,uc,Qp,Rp,Op,Vp,Zp,nf,Af,af,lf,gf,_f,bf,yf,vf,xf,ig,rg,Mg,Eg,kg,Hg,Ng,mc,ph,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm,Pm];var Wm=[Sm,mt,Bt,ie,Ae,oe,ae,le,Ap,Sm,Sm,Sm,Sm,Sm,Sm,Sm];var zm=[Dm,xg,Tg,Rg,Og,se,ne,Zc,Vh,Wh,Dm,Dm,Dm,Dm,Dm,Dm];var Xm=[km,Gp,$p,Tf,Vc,Ph,km,km];var Km=[Qm,Np,Yp,If];var Zm=[Rm,Hp,Jp,Uf];return{__ZSt18uncaught_exceptionv:tg,___cxa_can_catch:$f,___cxa_is_pointer_type:qf,___embind_register_native_and_builtin_types:eu,___errno_location:Wd,___getTypeName:jd,___muldi3:tm,___udivdi3:Am,_bitshift64Lshr:om,_bitshift64Shl:am,_emscripten_get_sbrk_ptr:lm,_free:Zg,_i64Add:sm,_i64Subtract:im,_llvm_bswap_i32:cm,_malloc:Kg,_memcpy:hm,_memmove:um,_memset:dm,dynCall_i:pm,dynCall_ii:fm,dynCall_iidiiii:gm,dynCall_iii:mm,dynCall_iiii:_m,dynCall_v:bm,dynCall_vi:Bm,dynCall_vii:ym,dynCall_viii:wm,dynCall_viiii:vm,dynCall_viiiii:Cm,dynCall_viiiiii:Mm,globalCtors:q,stackAlloc:Yg,stackRestore:$g,stackSave:qg}}({Math:Math,Int8Array:Int8Array,Int16Array:Int16Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array,Float32Array:Float32Array,Float64Array:Float64Array},ut,B),pt=t.__ZSt18uncaught_exceptionv=dt.__ZSt18uncaught_exceptionv;t.___cxa_can_catch=dt.___cxa_can_catch,t.___cxa_is_pointer_type=dt.___cxa_is_pointer_type,t.___embind_register_native_and_builtin_types=dt.___embind_register_native_and_builtin_types,t.___errno_location=dt.___errno_location;var ft=t.___getTypeName=dt.___getTypeName;t.___muldi3=dt.___muldi3,t.___udivdi3=dt.___udivdi3,t._bitshift64Lshr=dt._bitshift64Lshr,t._bitshift64Shl=dt._bitshift64Shl,t._emscripten_get_sbrk_ptr=dt._emscripten_get_sbrk_ptr;var gt=t._free=dt._free;t._i64Add=dt._i64Add,t._i64Subtract=dt._i64Subtract,t._llvm_bswap_i32=dt._llvm_bswap_i32;var mt=t._malloc=dt._malloc;t._memcpy=dt._memcpy,t._memmove=dt._memmove,t._memset=dt._memset;var _t,bt,Bt=t.globalCtors=dt.globalCtors;if(t.stackAlloc=dt.stackAlloc,t.stackRestore=dt.stackRestore,t.stackSave=dt.stackSave,t.dynCall_i=dt.dynCall_i,t.dynCall_ii=dt.dynCall_ii,t.dynCall_iidiiii=dt.dynCall_iidiiii,t.dynCall_iii=dt.dynCall_iii,t.dynCall_iiii=dt.dynCall_iiii,t.dynCall_v=dt.dynCall_v,t.dynCall_vi=dt.dynCall_vi,t.dynCall_vii=dt.dynCall_vii,t.dynCall_viii=dt.dynCall_viii,t.dynCall_viiii=dt.dynCall_viiii,t.dynCall_viiiii=dt.dynCall_viiiii,t.dynCall_viiiiii=dt.dynCall_viiiiii,t.asm=dt,z)if(K(z)||(_t=z,z=t.locateFile?t.locateFile(_t,u):u+_t),n||A){var yt=l(z);w.set(yt,8)}else{G++,t.monitorRunDependencies&&t.monitorRunDependencies(G);var wt=function(e){e.byteLength&&(e=new Uint8Array(e)),w.set(e,8),t.memoryInitializerRequest&&delete t.memoryInitializerRequest.response,function(e){if(G--,t.monitorRunDependencies&&t.monitorRunDependencies(G),0==G&&j){var s=j;j=null,s()}}()},vt=function(){a(z,wt,(function(){throw new Error("could not load memory initializer "+z)}))},Ct=ht(z);if(Ct)wt(Ct.buffer);else if(t.memoryInitializerRequest){var Mt=function(){var e=t.memoryInitializerRequest,s=e.response;if(200!==e.status&&0!==e.status){var i=ht(t.memoryInitializerRequestURL);if(!i)return console.warn("a problem seems to have happened with Module.memoryInitializerRequest, status: "+e.status+", retrying "+z),void vt();s=i.buffer}wt(s)};t.memoryInitializerRequest.response?setTimeout(Mt,0):t.memoryInitializerRequest.addEventListener("load",Mt)}else vt()}function Et(e){this.name="ExitStatus",this.message="Program terminated with exit("+e+")",this.status=e}function Ft(e){function s(){bt||(bt=!0,t.calledRun=!0,g||(O(L),O(H),t.onRuntimeInitialized&&t.onRuntimeInitialized(),function(){if(t.postRun)for("function"==typeof t.postRun&&(t.postRun=[t.postRun]);t.postRun.length;)e=t.postRun.shift(),N.unshift(e);var e;O(N)}()))}G>0||(!function(){if(t.preRun)for("function"==typeof t.preRun&&(t.preRun=[t.preRun]);t.preRun.length;)e=t.preRun.shift(),V.unshift(e);var e;O(V)}(),G>0||(t.setStatus?(t.setStatus("Running..."),setTimeout((function(){setTimeout((function(){t.setStatus("")}),1),s()}),1)):s()))}if(j=function e(){bt||Ft(),bt||(j=e)},t.run=Ft,t.preInit)for("function"==typeof t.preInit&&(t.preInit=[t.preInit]);t.preInit.length>0;)t.preInit.pop()();return Ft(),t}let Nw=null;const Gw={0:e=>({position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15)}),1:e=>({position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15)}),2:e=>({position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15),color:[e.getUint16(20,!0),e.getUint16(22,!0),e.getUint16(24,!0)]}),3:e=>({position:[e.getInt32(0,!0),e.getInt32(4,!0),e.getInt32(8,!0)],intensity:e.getUint16(12,!0),classification:e.getUint8(15),color:[e.getUint16(28,!0),e.getUint16(30,!0),e.getUint16(32,!0)]})};function jw(e,t={},s,i){i=void 0===i||0===i?1:i;const r=new t(e.slice(s,s+t.BYTES_PER_ELEMENT*i));if(1===i)return r[0];const n=[];for(let e=0;e<i;e++)n.push(r[e]);return n}function Ww(e){let t=131;const s={pointsOffset:jw(e,Uint32Array,96),pointsFormatId:jw(e,Uint8Array,104),pointsStructSize:jw(e,Uint16Array,105),pointsCount:jw(e,Uint32Array,107),scale:jw(e,Float64Array,t,3)};t+=24,s.offset=jw(e,Float64Array,t,3),t+=24;const i=jw(e,Float64Array,t,6);return t+=48,s.maxs=[i[0],i[2],i[4]],s.mins=[i[1],i[3],i[5]],s}class zw{arraybuffer;readOffset=0;header={pointsOffset:0,pointsFormatId:0,pointsStructSize:0,pointsCount:0,scale:[0,0,0],offset:[0,0,0],maxs:[0],mins:[0],totalToRead:0,totalRead:0,versionAsString:"",isCompressed:!0};constructor(e){this.arraybuffer=e}open(){return!0}getHeader(){return this.header=Ww(this.arraybuffer),this.header}readData(e,t){const{header:s,arraybuffer:i}=this;if(!s)throw new Error("Cannot start reading data till a header request is issued");let r,{readOffset:n}=this;if(t<=1){e=Math.min(e,s.pointsCount-n),r=s.pointsOffset+n*s.pointsStructSize;const t=r+e*s.pointsStructSize;return n+=e,this.readOffset=n,{buffer:i.slice(r,t),count:e,hasMoreData:n<s.pointsCount}}const A=Math.min(e*t,s.pointsCount-n),o=Math.ceil(A/t);let a=0;const l=new Uint8Array(o*s.pointsStructSize);for(let e=0;e<A;e++){if(e%t==0){r=s.pointsOffset+n*s.pointsStructSize;const e=new Uint8Array(i,r,s.pointsStructSize);l.set(e,a*s.pointsStructSize),a++}n++}return this.readOffset=n,{buffer:l.buffer,count:a,hasMoreData:n<s.pointsCount}}close(){return this.arraybuffer=null,!0}}class Xw{arraybuffer;instance=null;header=null;constructor(e){this.arraybuffer=e,Nw||(Nw=Hw())}open(){try{const{arraybuffer:e}=this;this.instance=new Nw.LASZip;const t=new Uint8Array(e),s=Nw._malloc(e.byteLength);return this.instance.arraybuffer=e,this.instance.buf=s,Nw.HEAPU8.set(t,s),this.instance.open(s,e.byteLength),this.instance.readOffset=0,!0}catch(e){throw new Error(`Failed to open file: ${e.message}`)}}getHeader(){if(!this.instance)throw new Error("You need to open the file before trying to read header");try{const e=Ww(this.instance.arraybuffer);return e.pointsFormatId&=63,this.header=e,e}catch(e){throw new Error(`Failed to get header: ${e.message}`)}}readData(e,t,s){if(!this.instance)throw new Error("You need to open the file before trying to read stuff");const{header:i,instance:r}=this;if(!i)throw new Error("You need to query header before reading, I maintain state that way, sorry :(");try{const t=Math.min(e*s,i.pointsCount-r.readOffset),n=Math.ceil(t/s);let A=0;const o=new Uint8Array(n*i.pointsStructSize),a=Nw._malloc(i.pointsStructSize);for(let e=0;e<t;e++){if(r.getPoint(a),e%s==0){const e=new Uint8Array(Nw.HEAPU8.buffer,a,i.pointsStructSize);o.set(e,A*i.pointsStructSize),A++}r.readOffset++}return Nw._free(a),{buffer:o.buffer,count:A,hasMoreData:r.readOffset<i.pointsCount}}catch(e){throw new Error(`Failed to read data: ${e.message}`)}}close(){try{return null!==this.instance&&(Nw._free(this.instance.buf),this.instance.delete(),this.instance=null),!0}catch(e){throw new Error(`Failed to close file: ${e.message}`)}}}class Kw{arrayb;decoder;pointsCount;pointSize;scale;offset;mins;maxs;constructor(e,t,s){this.arrayb=e,this.decoder=Gw[s.pointsFormatId],this.pointsCount=t,this.pointSize=s.pointsStructSize,this.scale=s.scale,this.offset=s.offset,this.mins=s.mins,this.maxs=s.maxs}getPoint(e){if(e<0||e>=this.pointsCount)throw new Error("Point index out of range");const t=new DataView(this.arrayb,e*this.pointSize,this.pointSize);return this.decoder(t)}}class Zw{arraybuffer;formatId=0;loader;isCompressed=!0;isOpen=!1;version=0;versionAsString="";constructor(e){if(this.arraybuffer=e,this.determineVersion()>13)throw new Error("Only file versions <= 1.3 are supported at this time");if(this.determineFormat(),void 0===Gw[this.formatId])throw new Error("The point format ID is not supported");this.loader=this.isCompressed?new Xw(this.arraybuffer):new zw(this.arraybuffer)}determineFormat(){const e=jw(this.arraybuffer,Uint8Array,104),t=(128&e)>>7,s=(64&e)>>6;if(1===t&&1===s)throw new Error("Old style compression not supported");this.formatId=63&e,this.isCompressed=1===t||1===s}determineVersion(){const e=new Int8Array(this.arraybuffer,24,2);return this.version=10*e[0]+e[1],this.versionAsString=`${e[0]}.${e[1]}`,this.version}open(){this.loader.open()&&(this.isOpen=!0)}getHeader(){return this.loader.getHeader()}readData(e,t,s){return this.loader.readData(e,t,s)}close(){this.loader.close()&&(this.isOpen=!1)}getUnpacker(){return Kw}}function Jw(e,t){const s=function(e){const t={};t.las_pointsOffset=e.pointsOffset.toString(10),t.las_pointsFormatId=e.pointsFormatId.toString(10),t.las_pointsStructSize=e.pointsStructSize.toString(10),t.las_pointsCount=e.pointsCount.toString(10),t.las_scale=JSON.stringify(e.scale),t.las_offset=JSON.stringify(e.offset),void 0!==e.maxs&&(t.las_maxs=JSON.stringify(e.maxs));void 0!==e.mins&&(t.las_mins=JSON.stringify(e.mins));t.las_totalToRead=e.totalToRead.toString(10),t.las_pointsFortotalReadmatId=e.totalRead.toString(10),void 0!==e.versionAsString&&(t.las_versionAsString=e.versionAsString);void 0!==e.isCompressed&&(t.las_isCompressed=e.isCompressed.toString());return t}(e);return um(t,s)}function Yw(e,t){return function(e,t={}){let s,i,r,n,A,o=0;const a={loader:"las",loaderData:{},schema:{fields:[],metadata:{}},header:{vertexCount:0,boundingBox:[[0,0,0],[0,0,0]]},attributes:{},topology:"point-list",mode:0};(function(e,t,s={}){const i=new Zw(e);try{i.open();const e=i.getHeader(),r=i.getUnpacker(),n=Math.ceil(e.pointsCount/Math.max(1,t));e.totalToRead=n;let A=0;for(;;){const o=i.readData(1e5,0,t);A+=o.count,e.totalRead=A,e.versionAsString=o.versionAsString,e.isCompressed=o.isCompressed;if(s(new r(o.buffer,o.count,e),e),!o.hasMoreData||A>=n)break}}catch(e){throw e}finally{i.close()}})(e,t.las?.skip,((e={},l)=>{if(!A){A=l;const e=l.totalToRead,o=t.las?.fp64?Float64Array:Float32Array;s=new o(3*e),i=l.pointsFormatId>=2?new Uint8Array(4*e):null,r=new Uint16Array(e),n=new Uint8Array(e),a.loaderData=l,a.attributes={POSITION:{value:s,size:3},intensity:{value:r,size:1},classification:{value:n,size:1}},i&&(a.attributes.COLOR_0={value:i,size:4})}const c=e.pointsCount,{scale:[h,u,d],offset:[p,f,g]}=l,m=function(e={},t,s){let i=!1;switch(s){case 8:i=!1;break;case 16:i=!0;break;case"auto":if(e.getPoint(0).color)for(let s=0;s<t;s++){const{color:t}=e.getPoint(s);(t[0]>255||t[1]>255||t[2]>255)&&(i=!0)}break;default:console.warn("las: illegal value for options.las.colorDepth")}return i}(e,c,t.las?.colorDepth);for(let t=0;t<c;t++){const{position:A,color:a,intensity:l,classification:c}=e.getPoint(t);s[3*o]=A[0]*h+p,s[3*o+1]=A[1]*u+f,s[3*o+2]=A[2]*d+g,a&&i&&(m?(i[4*o]=a[0]/256,i[4*o+1]=a[1]/256,i[4*o+2]=a[2]/256):(i[4*o]=a[0],i[4*o+1]=a[1],i[4*o+2]=a[2]),i[4*o+3]=255),r[o]=l,n[o]=c,o++}const _={...a,header:{vertexCount:l.totalRead},progress:l.totalRead/l.totalToRead};t?.onProgress?.(_)})),a.header={vertexCount:A.totalToRead,boundingBox:hm(a?.attributes||{})},a&&(a.schema=Jw(a.loaderData,a.attributes));return a}(e,t)}const $w={...Lw,parse:async(e,t)=>Yw(e,t),parseSync:(e,t)=>Yw(e,t)},qw=[{item:"FileSignature",format:"char",size:4},{item:"FileSoureceID",format:"uShort",size:2},{item:"GlobalEncoding",format:"uShort",size:2},{item:"ProjectID1",format:"notUsed",size:4},{item:"ProjectID2",format:"notUsed",size:2},{item:"ProjectID3",format:"notUsed",size:2},{item:"ProjectID4",format:"notUsed",size:8},{item:"VersionMajor",format:"uChar",size:1},{item:"VersionMinor",format:"uChar",size:1},{item:"SystemIdentifier",format:"char",size:32},{item:"GeneratingSoftware",format:"char",size:32},{item:"CreationDay",format:"uShort",size:2},{item:"CreationYear",format:"uShort",size:2},{item:"HeaderSize",format:"uShort",size:2},{item:"OffsetToPointData",format:"uLong",size:4},{item:"NumberOfVariableLengthRecords",format:"uLong",size:4},{item:"PointDataFormatID",format:"uChar",size:1},{item:"PointDataRecordLength",format:"uShort",size:2},{item:"NumberOfPoints",format:"uLong",size:4},{item:"NumberOfPointByReturn",format:"uLong",size:20},{item:"ScaleFactorX",format:"double",size:8},{item:"ScaleFactorY",format:"double",size:8},{item:"ScaleFactorZ",format:"double",size:8},{item:"OffsetX",format:"double",size:8},{item:"OffsetY",format:"double",size:8},{item:"OffsetZ",format:"double",size:8},{item:"MaxX",format:"double",size:8},{item:"MinX",format:"double",size:8},{item:"MaxY",format:"double",size:8},{item:"MinY",format:"double",size:8},{item:"MaxZ",format:"double",size:8},{item:"MinZ",format:"double",size:8}],ev=[{item:"Reserved",format:"uShort",size:2},{item:"UserId",format:"char",size:16},{item:"RecordId",format:"uShort",size:2},{item:"RecordLengthAfterHeader",format:"uShort",size:2},{item:"Description",format:"char",size:32}],tv=e=>{let t=0,s=0,i=0;const r=new DataView(e),n=new Uint8Array(6e3),A=({item:i,format:n,size:A})=>{let o,a;switch(n){case"char":return a=new Uint8Array(e,t,A),t+=A,o=iv(a),[i,o];case"uShort":return o=r.getUint16(t,!0),t+=A,[i,o];case"uLong":return o=r.getUint32(t,!0),"NumberOfVariableLengthRecords"===i&&(s=o),t+=A,[i,o];case"uChar":return o=r.getUint8(t),t+=A,[i,o];case"double":return o=r.getFloat64(t,!0),t+=A,[i,o];default:t+=A}};return(()=>{const e={};qw.forEach((t=>{const s=A({...t});if(void 0!==s){if("FileSignature"===s[0]&&"LASF"!==s[1])throw new Error("Ivalid FileSignature. Is this a LAS/LAZ file");e[s[0]]=s[1]}}));const r=[];let o=s;for(;o--;){const e={};ev.forEach((s=>{const r=A({...s});e[r[0]]=r[1],"UserId"===r[0]&&"LASF_Projection"===r[1]&&(i=t-18+54)})),r.push(e)}const a=(e=>{if(void 0===e)return;const t=i+e.RecordLengthAfterHeader,s=n.slice(i,t),r=sv(s),A=new DataView(r);let o=6,a=Number(A.getUint16(o,!0));const l=[];for(;a--;){const e={};e.key=A.getUint16(o+=2,!0),e.tiffTagLocation=A.getUint16(o+=2,!0),e.count=A.getUint16(o+=2,!0),e.valueOffset=A.getUint16(o+=2,!0),l.push(e)}const c=l.find((e=>3072===e.key));if(c&&c.hasOwnProperty("valueOffset"))return c.valueOffset})(r.find((e=>"LASF_Projection"===e.UserId)));return a&&(e.epsg=a),e})()},sv=e=>{let t=new ArrayBuffer(e.length),s=new Uint8Array(t);for(let t=0;t<e.length;++t)s[t]=e[t];return t},iv=e=>{let t="";return e.forEach((e=>{let s=String.fromCharCode(e);"\0"!==s&&(t+=s)})),t.trim()};function rv(e,t){if(t>=e.length)return[e];let s=[];for(let i=0;i<e.length;i+=t)s.push(e.slice(i,i+t));return s}class nv{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getCityJSON(e,t,s){_.loadJSON(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}}const Av=h.vec2(),ov=h.vec3(),av=h.vec3(),lv=h.vec3();class cv{constructor(e={}){this.cacheBuster=!1!==e.cacheBuster}_cacheBusterURL(e){if(!this.cacheBuster)return e;const t=(new Date).getTime();return e.indexOf("?")>-1?e+"&_="+t:e+"?_="+t}getDotBIM(e,t,s){_.loadJSON(this._cacheBusterURL(e),(e=>{t(e)}),(function(e){s(e)}))}}const hv=function(e){const t=t=>parseInt(e.substr(t+1,2),16)/255;return[t(0),t(2),t(4)]},uv=function(e,t,s){let i=null;const r=r=>{if(r){i&&i.destroy();try{const[n,A]=Op(r.map((e=>[e[0],e[2]]))),o=[].concat(...n.map((e=>[e[0],r[0][1],e[1]]))),a=[].concat(...A);i=new dt(e,{pickable:!1,geometry:new pe(e,{positions:o,indices:a,normals:h.buildNormals(o,a)}),material:new bt(e,{alpha:void 0!==s?s:.5,backfaces:!0,diffuse:hv(t)})})}catch(e){i=null}}i&&(i.visible=!!r)};return r(null),{updateBase:r,destroy:()=>i&&i.destroy()}},dv=function(e,t){return function(s,i,r){const n=e.scene,A=n.canvas.canvas,o=(e,t)=>(t[0]=e.clientX,t[1]=e.clientY,Ep(A.ownerDocument.documentElement,A,t),t),a=e=>{const s=h.vec3(),i=h.vec3();return h.canvasPosToWorldRay(A,n.camera.viewMatrix,n.camera.projMatrix,n.camera.projection,e,s,i),t(s,i)};let l=!1;const c=function(){l=!1},u=function(){c(),A.removeEventListener("mousedown",p),A.removeEventListener("mousemove",f),e.cameraControl.off(g),A.removeEventListener("mouseup",m)},d=h.vec2(),p=function(e){1===e.which&&(o(e,d),l=!0)};A.addEventListener("mousedown",p);const f=function(e){const t=o(e,h.vec2());l&&h.distVec2(d,t)>20&&(c(),s())};A.addEventListener("mousemove",f);const g=e.cameraControl.on("rayMove",(e=>{const t=e.canvasPos;i(t,a(t))})),m=function(e){if(1===e.which&&l){u();const t=o(e,h.vec2());r(t,a(t))}};return A.addEventListener("mouseup",m),u}},pv=function(e,t,s,i){const r=-(h.dotVec3(s,t)-e)/h.dotVec3(i,t);{const e=h.vec3();return h.mulVec3Scalar(i,r,e),h.addVec3(s,e,e),e}};class fv extends T{constructor(e,t={}){if(super(e.viewer.scene,t),this.plugin=e,this._container=t.container,!this._container)throw"config missing: container";this._eventSubs={},this.plugin.viewer.scene,this._geometry=t.geometry,t.onMouseOver,t.onMouseLeave,t.onContextMenu,this._alpha="alpha"in t&&void 0!==t.alpha?t.alpha:.5,this.color=t.color,this._visible=!0,this._rebuildMesh()}_rebuildMesh(){const e=this.plugin.viewer.scene,t=this._geometry.planeCoordinates.slice(),s=this._geometry.height<0,i=this._geometry.altitude+(s?this._geometry.height:0),r=this._geometry.height*(s?-1:1),[n,A,o]=Op(t),a=[],l=[],c=e=>{const t=a.length;for(let t of n)a.push([t[0],i+(e?r:0),t[1]]);for(let s of A)l.push(...(e?s:s.slice(0).reverse()).map((e=>e+t)))};c(!1),c(!0);for(let e=0;e<n.length;++e){const t=n[e],s=n[(n.length+e+(o?1:-1))%n.length],A=i,c=i+r,h=a.length;a.push([t[0],A,t[1]],[s[0],A,s[1]],[s[0],c,s[1]],[t[0],c,t[1]]),l.push(...[0,1,2,0,2,3].map((e=>e+h)))}this._zoneMesh&&this._zoneMesh.destroy();const u=e=>Math.min(...a.map((t=>t[e]))),d=e=>Math.max(...a.map((t=>t[e]))),p=u(0),f=u(1),g=u(2),m=d(0),_=d(1),b=d(2);this._center=h.vec3([(p+m)/2,(f+_)/2,(g+b)/2]);const B=[].concat(...a.map((e=>h.subVec3(e,this._center,e))));this._zoneMesh=new dt(e,{origin:this._center,edges:this._edges,geometry:new pe(e,{positions:B,indices:l,normals:h.buildNormals(B,l)}),material:new bt(e,{alpha:this._alpha,backfaces:!0,diffuse:hv(this._color)}),visible:this._visible}),this._zoneMesh.highlighted=this._highlighted,this._zoneMesh.zone=this;{const e=h.vec2(),t=h.vec2();let s=0;for(let i of A){const r=n[i[0]],A=n[i[1]],o=n[i[2]];h.subVec2(A,r,e),h.subVec2(o,r,t),s+=Math.abs(e[0]*t[1]-e[1]*t[0])}this._baseArea=s/2}this._metrics=null}get baseArea(){return this._baseArea}get area(){return this._getMetrics().area}get volume(){return this._getMetrics().volume}_getMetrics(){if(null===this._metrics){let e=0,t=0;const s=this._zoneMesh.geometry,i=[h.vec3(),h.vec3(),h.vec3()],r=h.vec3();for(let n=0;n<s.indices.length;n+=3){for(let e=0;e<3;++e){const t=i[e],r=3*s.indices[n+e];for(let e=0;e<3;++e)t[e]=s.positions[r+e]}e+=h.dotVec3(i[0],h.cross3Vec3(i[1],i[2],r)),h.subVec3(i[1],i[0],i[1]),h.subVec3(i[2],i[0],i[2]),t+=h.lenVec3(h.cross3Vec3(i[1],i[2],r))}this._metrics={area:t/2,volume:e/6}}return this._metrics}sectionedAverage(e){const t=this._geometry.planeCoordinates.slice();let s=[];{const e=this._geometry.height,i=this._geometry.altitude,r=i+Math.max(0,e),n=i+Math.min(0,e),A=e=>{const i=t.map((t=>[t[0],e?r:n,t[1]]));s.push(e?i:i.slice(0).reverse())};A(!0),A(!1);const o=(e,s)=>[t[e][0],s,t[e][1]];for(let e=0;e<t.length;++e){const i=(e+1)%t.length;s.push([o(e,n),o(i,n),o(i,r),o(e,r)])}}for(const t of e){const e=t.dir,r=t.dist,n=[];for(const t of s){const s=1e-5,A=0,o=1,a=2,l=3;let c=0;const u=[];for(let i=0;i<t.length;i++){const n=h.dotVec3(e,t[i])+r,l=n<-s?a:n>s?o:A;c|=l,u.push(l)}switch(c){case A:case o:n.push(t);break;case a:break;case l:const s=[];for(let n=0;n<t.length;n++){var i=(n+1)%t.length;const A=u[n],o=u[i],c=t[n],d=t[i];if(A!==a&&s.push(c),(A|o)===l){const t=h.vec3();h.subVec3(d,c,t);const i=-(r+h.dotVec3(e,c))/h.dotVec3(e,t),n=[0,0,0];h.lerpVec3(i,0,1,c,d,n),s.push(n)}}s.length>=3&&n.push(s)}}s=n}if(0===s.length)return null;{const e=h.vec3([0,0,0]),t=new Set;for(const i of s)for(const s of i){const i=s.map((e=>e.toFixed(3))).join(":");t.has(i)||(t.add(i),h.addVec3(e,s,e))}return h.mulVec3Scalar(e,1/t.size,e),e}}get center(){return this._center}get altitude(){return this._geometry.altitude}set altitude(e){this._geometry.altitude=e,this._rebuildMesh()}get height(){return this._geometry.height}set height(e){this._geometry.height=e,this._rebuildMesh()}get highlighted(){return this._highlighted}set highlighted(e){this._highlighted=e,this._zoneMesh&&(this._zoneMesh.highlighted=e)}set color(e){this._color=e,this._zoneMesh&&(this._zoneMesh.material.diffuse=hv(this._color))}get color(){return this._color}set alpha(e){this._alpha=e,this._zoneMesh&&(this._zoneMesh.material.alpha=this._alpha)}get alpha(){return this._alpha}get edges(){return this._edges}set edges(e){this._edges=e,this._zoneMesh&&(this._zoneMesh.edges=this._edges)}set visible(e){this._visible=!!e,this._zoneMesh.visible=this._visible,this._needUpdate()}get visible(){return this._visible}getJSON(){return{id:this.id,geometry:this._geometry,alpha:this._alpha,color:this._color}}duplicate(){return this.plugin.createZone({id:h.createUUID(),geometry:{planeCoordinates:this._geometry.planeCoordinates.map((e=>e.slice())),altitude:this._geometry.altitude,height:this._geometry.height},alpha:this._alpha,color:this._color})}destroy(){this._zoneMesh.destroy(),super.destroy()}}class gv extends T{constructor(e,t,s){super(e.viewer.scene),this.zonesPlugin=e,this.pointerLens=t.pointerLens,this.createSelect3dPoint=s,this._deactivate=null}get active(){return!!this._deactivate}activate(e,t,s,i){if(this._deactivate)return;if("object"==typeof e&&null!==e){const r=e,n=(e,t)=>{if(e in r)return r[e];if(void 0!==t)return t;throw"config missing: "+e};e=n("altitude"),t=n("height"),s=n("color","#008000"),i=n("alpha",.5)}const r=this.zonesPlugin,n=r.viewer,A=n.scene,o=this,a=this.createSelect3dPoint(n,((t,s)=>pv(e,h.vec3([0,1,0]),t,s)));!function n(){const l=uv(A,s,i),c=function(e,t,s,i,r,n){const A=Sp(e,t),o=Sp(e,t),a=s?function(e){s.visible=!!e,e&&(s.canvasPos=e)}:()=>{};let l=i((()=>{a(null),A.update(null)}),((e,t)=>{a(e),A.update(t)}),(function(e,t){A.update(t),l=i((function(){a(null),o.update(null),r(null)}),(function(e,s){a(e),o.update(s),r(h.distVec3(t,s)>.01&&[t,s])}),(function(e,s){o.update(s),A.destroy(),o.destroy(),a(null),n([t,s])}))}));return{deactivate:function(){l(),A.destroy(),o.destroy(),a(null)}}}(A,s,o.pointerLens,a,(e=>{if(e){const t=e[0],s=e[1],i=e=>Math.min(t[e],s[e]),r=e=>Math.max(t[e],s[e]),n=i(0),A=i(1),o=i(2),a=r(0);r(1);const c=r(2);l.updateBase([[n,A,c],[a,A,c],[a,A,o],[n,A,o]])}else l.updateBase(null)}),(A=>{l.destroy();const a=function(e,t,s,i,r,n,A){const o=s=>Math.min(e[s],t[s]),a=s=>Math.max(e[s],t[s]),l=o(0),c=o(2),u=a(0),d=a(2);return A.createZone({id:h.createUUID(),geometry:{planeCoordinates:[[l,d],[u,d],[u,c],[l,c]],altitude:s,height:i},alpha:n,color:r})}(A[0],A[1],e,t,s,i,r);let c=!0;o._deactivate=()=>{c=!1},o.fire("zoneEnd",a),c&&n()})).deactivate;o._deactivate=()=>{c(),l.destroy()}}()}deactivate(){this._deactivate&&(this._deactivate(),this._deactivate=null)}destroy(){this.deactivate(),super.destroy()}}const mv=function(e,t,s,i,r,n,A,o,a){const l=n?function(e){n.visible=!!e,e&&(n.canvasPos=e)}:()=>{};let c;const u=[()=>l(null)],d=uv(e,i,r);return u.push((()=>d.destroy())),function n(p){const f=Sp(e,i),g=p.length>0&&Dp(e,i),m=g&&p[p.length-1].getWorldPos();u.push((()=>{f.destroy(),g&&g.destroy()}));const _=p.length>0&&p[0],b=function(e){const t=_&&_.getCanvasPos();return t&&h.distVec2(t,e)<10&&{canvasPos:t,worldPos:_.getWorldPos()}},B=function(){const e=(e,t,s)=>t[0]<=Math.max(e[0],s[0])&&t[0]>=Math.min(e[0],s[0])&&t[1]<=Math.max(e[1],s[1])&&t[1]>=Math.min(e[1],s[1]),t=(e,t,s)=>{const i=(t[1]-e[1])*(s[0]-t[0])-(t[0]-e[0])*(s[1]-t[1]);return 0===i?0:i>0?1:2};return function(s,i){const r=s[s.length-2],n=s[s.length-1];for(let A=i?1:0;A<s.length-2-1;++A){const i=s[A],o=s[A+1],a=t(r,n,i),l=t(r,n,o),c=t(i,o,r),h=t(i,o,n);if(a!==l&&c!==h||0===a&&e(r,i,n)||0===l&&e(r,o,n)||0===c&&e(i,r,o)||0===h&&e(i,n,o))return!0}return!1}}();c=o((()=>{l(null),f.update(null),g&&g.update(m,null),d.updateBase(p.length>2?p.map((e=>e.getWorldPos())):null)}),((e,t)=>{const s=p.length>2&&b(e);if(_&&_.setHighlighted(!!s),l(s?s.canvasPos:e),f.update(!s&&t),g&&g.update(m,s?s.worldPos:t),p.length>=2){const e=p.map((e=>e.getWorldPos())).concat(s?[]:[t]),i=B(e.map((e=>[e[0],e[2]])),s);d.updateBase(i?null:e)}else d.updateBase(null)}),(function(e,o){const l=p.length>2&&b(e),c=p.map((e=>e.getWorldPos())).concat(l?[]:[o]);d.updateBase(c);const _=c.map((e=>[e[0],e[2]]));p.length>2&&B(_,l)?(u.pop()(),n(p)):l?(f.update(o),u.forEach((e=>e())),a(A.createZone({id:h.createUUID(),geometry:{planeCoordinates:_,altitude:t,height:s},alpha:r,color:i}))):(f.update(o),g&&g.update(m,o),n(p.concat(f)))}))}([]),{closeSurface:function(){throw"TODO"},deactivate:function(){c(),u.forEach((e=>e()))}}};class _v extends T{constructor(e,t,s,i){const r=e.plugin.viewer,n=r.scene;super(n);const A=e._geometry.altitude,o=e._geometry.planeCoordinates.map((t=>{const s=n.canvas.canvas.ownerDocument.body,i=new Ip(n,{},s,{fillColor:e._color});return i.worldPos=h.vec3([t[0],A,t[1]]),i.on("worldPos",(function(){t[0]=i.worldPos[0],t[1]=i.worldPos[2];try{e._rebuildMesh()}catch(t){e._zoneMesh&&(e._zoneMesh.destroy(),e._zoneMesh=null)}})),i})),a=Qp({viewer:r,handleMouseEvents:s,handleTouchEvents:i,pointerLens:t&&t.pointerLens,dots:o,ray2WorldPos:(e,t)=>pv(A,h.vec3([0,1,0]),e,t),onEnd:(t,s)=>(e._zoneMesh&&this.fire("edited"),!!e._zoneMesh)}),l=function(){a(),o.forEach((e=>e.destroy()))},c=e.on("destroyed",l);this._deactivate=function(){e.off("destroyed",c),l()}}deactivate(){this._deactivate(),super.destroy()}}class bv extends T{constructor(e,t,s,i){const r=e.plugin.viewer,n=r.scene,A=n.canvas.canvas;super(n);const o=this,a=e._geometry.altitude,l=t&&t.pointerLens,c=l?function(e){l.visible=!!e,e&&(l.canvasPos=e)}:()=>{},u=e=>{const t=h.vec3(),s=h.vec3();return h.canvasPosToWorldRay(A,n.camera.viewMatrix,n.camera.projMatrix,n.camera.projection,e,t,s),i=t,r=s,pv(a,h.vec3([0,1,0]),i,r);var i,r},d=(e,t)=>(t[0]=e.clientX,t[1]=e.clientY,Ep(A.ownerDocument.documentElement,A,t),t),p=function(e,t){const s=e=>{e.preventDefault(),t(e)};return A.addEventListener(e,s),()=>A.removeEventListener(e,s)};let f=()=>{};const g=function(t,s,i,n){const a=n(t),l=d(a,h.vec2()),g=r.scene.pick({canvasPos:l,includeEntities:[e._zoneMesh.id]});if((g&&g.entity&&g.entity.zone)===e){f(),A.style.cursor="move",r.cameraControl.active=!1;const t=function(){const t=e._geometry.planeCoordinates.map((e=>e.slice())),s=u(l),i=h.vec2([s[0],s[2]]),r=h.vec2();return function(s){const n=u(s);r[0]=n[0],r[1]=n[2],h.subVec2(i,r,r),e._geometry.planeCoordinates.forEach(((e,s)=>{h.subVec2(t[s],r,e)}));try{e._rebuildMesh()}catch(t){e._zoneMesh&&(e._zoneMesh.destroy(),e._zoneMesh=null)}}}(),a=p(s,(function(e){const s=n(e);if(s){const e=d(s,h.vec2());t(e),c(e)}})),g=p(i,(function(e){const s=n(e);if(s){const e=d(s,h.vec2());t(e),c(null),f(),o.fire("translated")}}));f=function(){f=()=>{},A.style.cursor="default",r.cameraControl.active=!0,a(),g()}}},m=[];s&&m.push(p("mousedown",(e=>{1===e.which&&g(e,"mousemove","mouseup",(e=>1===e.which&&e))}))),i&&m.push(p("touchstart",(e=>{if(1===e.touches.length){const t=e.touches[0].identifier;g(e,"touchmove","touchend",(e=>[...e.changedTouches].find((e=>e.identifier===t))))}})));const _=function(){f(),m.forEach((e=>e())),c(null)},b=e.on("destroyed",_);this._deactivate=function(){e.off("destroyed",b),_()}}deactivate(){this._deactivate(),super.destroy()}}exports.AlphaFormat=1021,exports.AmbientLight=wr,exports.AngleMeasurementEditMouseControl=class extends Wp{constructor(e,t){super(e,t,!0,!1)}},exports.AngleMeasurementEditTouchControl=class extends Wp{constructor(e,t){super(e,t,!1,!0)}},exports.AngleMeasurementsControl=Np,exports.AngleMeasurementsMouseControl=Gp,exports.AngleMeasurementsPlugin=class extends Wr{constructor(e,t={}){super("AngleMeasurements",e),this._container=t.container||document.body,this._defaultControl=null,this._measurements={},this.defaultColor=void 0!==t.defaultColor?t.defaultColor:"#00BBFF",this.defaultLabelsVisible=!1!==t.defaultLabelsVisible,this.zIndex=t.zIndex||1e4,this._onMouseOver=(e,t)=>{this.fire("mouseOver",{plugin:this,angleMeasurement:t,measurement:t,event:e})},this._onMouseLeave=(e,t)=>{this.fire("mouseLeave",{plugin:this,angleMeasurement:t,measurement:t,event:e})},this._onContextMenu=(e,t)=>{this.fire("contextMenu",{plugin:this,angleMeasurement:t,measurement:t,event:e})}}getContainerElement(){return this._container}send(e,t){}get control(){return this._defaultControl||(this._defaultControl=new Gp(this,{})),this._defaultControl}get measurements(){return this._measurements}createMeasurement(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=e.origin,s=e.corner,i=e.target,r=new Hp(this,{id:e.id,plugin:this,container:this._container,origin:{entity:t.entity,worldPos:t.worldPos},corner:{entity:s.entity,worldPos:s.worldPos},target:{entity:i.entity,worldPos:i.worldPos},visible:e.visible,originVisible:!0,originWireVisible:!0,cornerVisible:!0,targetWireVisible:!0,targetVisible:!0,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[r.id]=r,r.on("destroyed",(()=>{delete this._measurements[r.id]})),r.clickable=!0,this.fire("measurementCreated",r),r}destroyMeasurement(e){const t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("AngleMeasurement not found: "+e)}setLabelsShown(e){for(const[t,s]of Object.entries(this.measurements))s.labelShown=e}clear(){const e=Object.keys(this._measurements);for(var t=0,s=e.length;t<s;t++)this.destroyMeasurement(e[t])}destroy(){this.clear(),super.destroy()}},exports.AngleMeasurementsTouchControl=class extends Np{constructor(e,t={}){super(e.viewer.scene),this.pointerLens=t.pointerLens,this.pointerCircle=new L(e.viewer),this._active=!1;const s=document.createElement("div"),i=this.scene.canvas.canvas;i.parentNode.insertBefore(s,i),s.style.background="black",s.style.border="2px solid blue",s.style.borderRadius="10px",s.style.width="5px",s.style.height="5px",s.style.margin="-200px -200px",s.style.zIndex="100",s.style.position="absolute",s.style.pointerEvents="none",this.markerDiv=s,this._currentAngleMeasurement=null,this._longTouchTimeoutMs=300,this._snapping=!1!==t.snapping,this._touchState=0,this._attachPlugin(e,t)}_attachPlugin(e){this.angleMeasurementsPlugin=e,this.plugin=e}get active(){return this._active}set snapping(e){this._snapping=e}get snapping(){return this._snapping}activate(){if(this._active)return;const e=this.plugin,t=this.scene,s=t.canvas.canvas;e.pointerLens;const i=h.vec3(),r=20;let n=null;this._touchState=0;const A=h.vec2(),o=h.vec2(),a=h.vec2();let l=null;const c=()=>{this.plugin.viewer.cameraControl.active=!1},u=()=>{this.plugin.viewer.cameraControl.active=!0},d=()=>{n&&(clearTimeout(n),n=null),this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),u(),this._touchState=0},p=(e,t)=>(t[0]=e.clientX,t[1]=e.clientY,Ep(s.ownerDocument.documentElement,s,t),t),f=(e,t)=>(t.set(e),Ep(s,s.ownerDocument.documentElement,t),t);s.addEventListener("touchstart",this._onCanvasTouchStart=s=>{const a=s.touches.length;if(1!==a)return void(n&&(clearTimeout(n),n=null));const u=s.touches[0];switch(p(u,A),o.set(A),this._touchState){case 0:if(1!==a&&null!==n)return void d();const s=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping});if(s&&s.snapped)i.set(s.worldPos),this.pointerCircle.start(f(s.snappedCanvasPos,jp));else{const e=t.pick({canvasPos:o,pickSurface:!0});if(!e||!e.worldPos)return;i.set(e.worldPos),this.pointerCircle.start(f(e.canvasPos,jp))}n=setTimeout((()=>{1!==a||o[0]>A[0]+r||o[0]<A[0]-r||o[1]>A[1]+r||o[1]<A[1]-r||(this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=A,this.pointerLens.cursorPos=A),this.pointerLens&&(this.pointerLens.canvasPos=o,this.pointerLens.snapped=!1),this.pointerLens&&(this.pointerLens.cursorPos=s.canvasPos,this.pointerLens.snapped=!0),this._currentAngleMeasurement?this._currentAngleMeasurement.origin.worldPos=i:(this._currentAngleMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:s.worldPos,entity:s.entity},corner:{worldPos:s.worldPos,entity:s.entity},target:{worldPos:s.worldPos,entity:s.entity}}),this._currentAngleMeasurement.clickable=!1,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!1,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1),this.angleMeasurementsPlugin.fire("measurementStart",this._currentAngleMeasurement),this._touchState=2,c())}),this._longTouchTimeoutMs),this._touchState=1,l=u.identifier;break;case 3:if(1!==a&&null!==n)return clearTimeout(n),void(n=null);1===a&&(n=setTimeout((()=>{if(n=null,1!==a||o[0]>A[0]+r||o[0]<A[0]-r||o[1]>A[1]+r||o[1]<A[1]-r)return;this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=A,this.pointerLens.snapped=!1);const e=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping});if(e&&e.snapped)this.pointerLens&&(this.pointerLens.cursorPos=e.snappedCanvasPos,this.pointerLens.snapped=!0),this.pointerCircle.start(f(e.snappedCanvasPos,jp)),i.set(e.worldPos),this._currentAngleMeasurement.corner.worldPos=e.worldPos,this._currentAngleMeasurement.corner.entity=e.entity,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this.angleMeasurementsPlugin.fire("measurementStart",this._currentAngleMeasurement);else{const e=t.pick({canvasPos:o,pickSurface:!0});e&&e.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=e.canvasPos,this.pointerLens.snapped=!1),this.pointerCircle.start(f(e.canvasPos,jp)),i.set(e.worldPos),this._currentAngleMeasurement.corner.worldPos=e.worldPos,this._currentAngleMeasurement.corner.entity=e.entity,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this.angleMeasurementsPlugin.fire("measurementStart",this._currentAngleMeasurement)):this.pointerLens&&(this.pointerLens.cursorPos=null,this.pointerLens.snapped=!1)}this._touchState=5,c()}),this._longTouchTimeoutMs),this._touchState=4),l=u.identifier;break;case 6:if(1!==a&&null!==n)return clearTimeout(n),void(n=null);1===a&&(n=setTimeout((()=>{if(n=null,1!==a||o[0]>A[0]+r||o[0]<A[0]-r||o[1]>A[1]+r||o[1]<A[1]-r)return;this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=A,this.pointerLens.snapped=!1);const e=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping});if(e&&e.snapped)this.pointerLens&&(this.pointerLens.cursorPos=e.snappedCanvasPos,this.pointerLens.snapped=!0),this.pointerCircle.start(f(e.snappedCanvasPos,jp)),i.set(e.worldPos),this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.target.entity=e.entity,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this.angleMeasurementsPlugin.fire("measurementStart",this._currentAngleMeasurement);else{const e=t.pick({canvasPos:o,pickSurface:!0});e&&e.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=e.canvasPos,this.pointerLens.snapped=!1),this.pointerCircle.start(f(e.canvasPos,jp)),i.set(e.worldPos),this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.target.entity=e.entity,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this.angleMeasurementsPlugin.fire("measurementStart",this._currentAngleMeasurement)):this.pointerLens&&(this.pointerLens.cursorPos=null,this.pointerLens.snapped=!1)}this._touchState=8,c()}),this._longTouchTimeoutMs),this._touchState=7),l=u.identifier;break;default:return null!==n&&(clearTimeout(n),n=null),void(this._touchState=7)}},{passive:!0}),s.addEventListener("touchmove",(e=>{this.pointerCircle.stop();const s=e.touches.length;if(1!==s||1!==e.changedTouches.length)return void(n&&(clearTimeout(n),n=null));const r=e.touches[0];if(r.identifier!==l)return;let A,a;switch(p(r,o),this._touchState){case 2:this.pointerLens&&(this.pointerLens.canvasPos=o),A=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping}),A&&A.snapped?(this.pointerLens&&(this.pointerLens.snappedCanvasPos=A.snappedCanvasPos,this.pointerLens.snapped=!0),i.set(A.worldPos),this._currentAngleMeasurement.origin.worldPos=A.worldPos):(a=t.pick({canvasPos:o,pickSurface:!0}),a&&a.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=a.canvasPos,this.pointerLens.snapped=!1),i.set(a.worldPos),this._currentAngleMeasurement.origin.worldPos=a.worldPos):this.pointerLens&&(this.pointerLens.cursorPos=null,this.pointerLens.snapped=!1)),this._touchState=2;break;case 5:if(1!==s&&null!==n)return clearTimeout(n),n=null,this.pointerLens&&(this.pointerLens.visible=!1),void(this._touchState=7);this.pointerLens&&(this.pointerLens.canvasPos=o),A=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping}),A&&A.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=A.snappedCanvasPos,this.pointerLens.snapped=!0),this._currentAngleMeasurement.corner.worldPos=A.worldPos,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1):(a=t.pick({canvasPos:o,pickSurface:!0}),a&&a.worldPos&&(this.pointerLens&&(this.pointerLens.cursorPos=a.canvasPos,this.pointerLens.snapped=!1),this._currentAngleMeasurement.corner.worldPos=a.worldPos,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1)),this._touchState=5;break;case 8:if(1!==s&&null!==n)return clearTimeout(n),n=null,this.pointerLens&&(this.pointerLens.visible=!1),void(this._touchState=7);this.pointerLens&&(this.pointerLens.canvasPos=o),A=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping}),A&&A.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=A.snappedCanvasPos,this.pointerLens.snapped=!0),this._currentAngleMeasurement.target.worldPos=A.worldPos,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.angleVisible=!0):(a=t.pick({canvasPos:o,pickSurface:!0}),a&&a.worldPos&&(this.pointerLens&&(this.pointerLens.cursorPos=a.canvasPos,this.pointerLens.snapped=!1),this._currentAngleMeasurement.target.worldPos=a.worldPos,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.angleVisible=!0)),this._touchState=8}}),{passive:!0}),s.addEventListener("touchend",this._onCanvasTouchEnd=s=>{this.pointerCircle.stop();const i=s.changedTouches.length;if(1!==i)return;const c=s.changedTouches[0];if(c.identifier!==l)return;n&&(clearTimeout(n),n=null),p(c,a);const d=a[0],f=a[1];switch(this._touchState){case 1:{if(1!==i||d>A[0]+r||d<A[0]-r||f>A[1]+r||f<A[1]-r)return void(this._touchState=0);const s=t.pick({canvasPos:o,pickSurface:!0});s&&s.worldPos?(this._currentAngleMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:s.worldPos},corner:{worldPos:s.worldPos},target:{worldPos:s.worldPos}}),this._currentAngleMeasurement.clickable=!1,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!1,this._currentAngleMeasurement.cornerVisible=!1,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._touchState=3):(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._touchState=0)}u();break;case 2:this.pointerLens&&(this.pointerLens.visible=!1),this._currentAngleMeasurement?this._touchState=3:(this.pointerLens&&(this.pointerLens.snapped=!1,this.pointerLens.visible=!1),this._touchState=0),u();break;case 4:{if(1!==i||d>A[0]+r||d<A[0]-r||f>A[1]+r||f<A[1]-r)return void(this._touchState=3);const e=t.pick({canvasPos:o,pickSurface:!0});e&&e.worldPos?(this._currentAngleMeasurement.corner.worldPos=e.worldPos,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!1,this._currentAngleMeasurement.targetVisible=!1,this._currentAngleMeasurement.targetWireVisible=!1,this._currentAngleMeasurement.angleVisible=!1,this._touchState=6):(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._touchState=0)}u();break;case 5:this.pointerLens&&(this.pointerLens.visible=!1),this._touchState=6,u();break;case 7:{if(1!==i||d>A[0]+r||d<A[0]-r||f>A[1]+r||f<A[1]-r)return void(this._touchState=6);const e=t.pick({canvasPos:o,pickSurface:!0});e&&e.worldPos?(this._currentAngleMeasurement.target.worldPos=e.worldPos,this._currentAngleMeasurement.originVisible=!0,this._currentAngleMeasurement.originWireVisible=!0,this._currentAngleMeasurement.cornerVisible=!0,this._currentAngleMeasurement.cornerWireVisible=!0,this._currentAngleMeasurement.targetVisible=!0,this._currentAngleMeasurement.targetWireVisible=!0,this._currentAngleMeasurement.angleVisible=!0,this.angleMeasurementsPlugin.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null):this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._touchState=0}u();break;case 8:this.pointerLens&&(this.pointerLens.visible=!1),this._currentAngleMeasurement&&this._currentAngleMeasurement.targetVisible?(this._currentAngleMeasurement.clickable=!0,this.angleMeasurementsPlugin.fire("measurementEnd",this._currentAngleMeasurement),this._currentAngleMeasurement=null,this._touchState=0):(this._currentAngleMeasurement&&(this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null),this._touchState=0),u()}},{passive:!0}),this._active=!0}deactivate(){if(!this._active)return;this.plugin.pointerLens&&(this.plugin.pointerLens.visible=!1),this.reset();const e=this.plugin.viewer.scene.canvas.canvas;e.removeEventListener("touchstart",this._onCanvasTouchStart),e.removeEventListener("touchend",this._onCanvasTouchEnd),this._active=!1,this.plugin.viewer.cameraControl.active=!0}reset(){this._active&&this._currentAngleMeasurement&&(this.angleMeasurementsPlugin.fire("measurementCancel",this._currentAngleMeasurement),this._currentAngleMeasurement.destroy(),this._currentAngleMeasurement=null)}get currentMeasurement(){return this._currentAngleMeasurement}destroy(){this.deactivate(),super.destroy()}},exports.AnnotationsPlugin=class extends Wr{constructor(e,t){super("Annotations",e),this._labelHTML=t.labelHTML||"<div></div>",this._markerHTML=t.markerHTML||"<div></div>",this._container=t.container||document.body,this._values=t.values||{},this.annotations={},this.surfaceOffset=t.surfaceOffset}getContainerElement(){return this._container}send(e,t){if("clearAnnotations"===e)this.clear()}set surfaceOffset(e){null==e&&(e=.3),this._surfaceOffset=e}get surfaceOffset(){return this._surfaceOffset}createAnnotation(e){this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);var t=null;e.markerElementId&&((t=document.getElementById(e.markerElementId))||this.error("Can't find DOM element for 'markerElementId' value '"+e.markerElementId+"' - defaulting to internally-generated empty DIV"));var s=null;e.labelElementId&&((s=document.getElementById(e.labelElementId))||this.error("Can't find DOM element for 'labelElementId' value '"+e.labelElementId+"' - defaulting to internally-generated empty DIV"));const i=new Jp(this.viewer.scene,{id:e.id,plugin:this,container:this._container,markerElement:t,labelElement:s,markerHTML:e.markerHTML||this._markerHTML,labelHTML:e.labelHTML||this._labelHTML,occludable:e.occludable,values:_.apply(e.values,_.apply(this._values,{})),markerShown:e.markerShown,labelShown:e.labelShown,eye:e.eye,look:e.look,up:e.up,projection:e.projection,visible:!1!==e.visible});return e.pickResult=e.pickResult||e.pickRecord,e.pickResult?i.setFromPickResult(e.pickResult):(i.entity=e.entity,i.worldPos=e.worldPos),this.annotations[i.id]=i,i.on("destroyed",(()=>{delete this.annotations[i.id],this.fire("annotationDestroyed",i.id)})),this.fire("annotationCreated",i.id),i}destroyAnnotation(e){var t=this.annotations[e];t?t.destroy():this.log("Annotation not found: "+e)}clear(){const e=Object.keys(this.annotations);for(var t=0,s=e.length;t<s;t++)this.destroyAnnotation(e[t])}destroy(){this.clear(),super.destroy()}},exports.AxisGizmoPlugin=class extends Wr{constructor(e,t){super("AxisGizmo",e,t=t||{});const s=e.scene.camera;t.canvasId||t.canvasElement||this.error("Config expected: either 'canvasId' or 'canvasElement'");try{this._axisGizmoScene=new BA(e,{canvasId:t.canvasId,canvasElement:t.canvasElement,transparent:!0})}catch(e){return void this.error(e)}const i=this._axisGizmoScene;i.clearLights(),new wr(i,{color:[.45,.45,.5],intensity:.9}),new Cr(i,{dir:[-.5,.5,-.6],color:[.8,.8,.7],intensity:1,space:"view"}),new Cr(i,{dir:[.5,-.5,-.6],color:[.8,.8,.8],intensity:1,space:"view"});const r=i.camera;s.on("matrix",(function(){const e=s.eye,t=s.look,i=s.up,n=h.mulVec3Scalar(h.normalizeVec3(h.subVec3(e,t,[])),22);r.look=[0,0,0],r.eye=n,r.up=i}));const n=new pe(i,ye({radiusTop:.01,radiusBottom:.6,height:1.7,radialSegments:20,heightSegments:1,openEnded:!1})),A=new pe(i,ye({radiusTop:.2,radiusBottom:.2,height:4.5,radialSegments:20,heightSegments:1,openEnded:!1})),o=new bt(i,{diffuse:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),a=new bt(i,{emissive:[1,.3,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),l=new bt(i,{diffuse:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),c=new bt(i,{emissive:[.3,1,.3],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),u=new bt(i,{diffuse:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),d=new bt(i,{emissive:[.3,.3,1],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2}),p=new bt(i,{diffuse:[.5,.5,.5],ambient:[0,0,0],specular:[.6,.6,.3],shininess:80,lineWidth:2});this._meshes=[new dt(i,{geometry:new pe(i,Ce({radius:9,heightSegments:60,widthSegments:60})),material:new bt(i,{diffuse:[0,0,0],emissive:[.1,.1,.1],ambient:[.1,.1,.2],specular:[0,0,0],alpha:.4,alphaMode:"blend",frontface:"cw"}),pickable:!1,collidable:!1,visible:!1!==t.visible}),new dt(i,{geometry:new pe(i,Ce({radius:1})),material:p,pickable:!1,collidable:!1,visible:!1!==t.visible}),new dt(i,{geometry:n,material:o,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[5,0,0],rotation:[0,0,-90]}),new dt(i,{geometry:A,material:o,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[2,0,0],rotation:[0,0,90]}),new dt(i,{geometry:new pe(i,Fe({text:"X",size:1.5})),material:a,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[7,0,0],billboard:"spherical"}),new dt(i,{geometry:n,material:l,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,5,0]}),new dt(i,{geometry:A,material:l,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,2,0]}),new dt(i,{geometry:new pe(i,Fe({text:"Y",size:1.5})),material:c,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,7,0],billboard:"spherical"}),new dt(i,{geometry:n,material:u,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,5],rotation:[90,0,0]}),new dt(i,{geometry:A,material:u,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,2],rotation:[90,0,0]}),new dt(i,{geometry:new pe(i,Fe({text:"Z",size:1.5})),material:d,pickable:!1,collidable:!1,visible:!1!==t.visible,position:[0,0,7],billboard:"spherical"})]}setVisible(e){for(let t=0;t<this._meshes.length;t++)this._meshes[t].visible=e}destroy(){this._axisGizmoCanvas=null,this._axisGizmoScene.destroy(),this._axisGizmoScene=null,super.destroy()}},exports.BCFViewpointsPlugin=class extends Wr{constructor(e,t={}){super("BCFViewpoints",e,t),this.originatingSystem=t.originatingSystem||"xeokit.io",this.authoringTool=t.authoringTool||"xeokit.io"}getViewpoint(e={}){const t=this.viewer.scene,s=t.camera,i=t.realWorldOffset,r=!0===e.reverseClippingPlanes;let n={},A=h.normalizeVec3(h.subVec3(s.look,s.eye,h.vec3())),o=s.eye,a=s.up;s.yUp&&(A=rf(A),o=rf(o),a=rf(a));const l=tf(h.addVec3(o,i));"ortho"===s.projection?n.orthogonal_camera={camera_view_point:l,camera_direction:tf(A),camera_up_vector:tf(a),view_to_world_scale:s.ortho.scale}:n.perspective_camera={camera_view_point:l,camera_direction:tf(A),camera_up_vector:tf(a),field_of_view:s.perspective.fov};const c=t.sectionPlanes;for(let e in c)if(c.hasOwnProperty(e)){let t=c[e];if(!t.active)continue;let A,o=t.pos;A=r?h.negateVec3(t.dir,h.vec3()):t.dir,s.yUp&&(o=rf(o),A=rf(A)),h.addVec3(o,i),o=tf(o),A=tf(A),n.clipping_planes||(n.clipping_planes=[]),n.clipping_planes.push({location:o,direction:A})}const u=t.lineSets;for(let e in u)if(u.hasOwnProperty(e)){const t=u[e];n.lines||(n.lines=[]);const s=t.positions,i=t.indices;for(let e=0,t=i.length/2;e<t;e++){const t=i[2*e],r=i[2*e+1];n.lines.push({start_point:{x:s[3*t+0],y:s[3*t+1],z:s[3*t+2]},end_point:{x:s[3*r+0],y:s[3*r+1],z:s[3*r+2]}})}}const d=t.bitmaps;for(let e in d)if(d.hasOwnProperty(e)){let t=d[e],r=t.pos,A=t.normal,o=t.up;s.yUp&&(r=rf(r),A=rf(A),o=rf(o)),h.addVec3(r,i),n.bitmaps||(n.bitmaps=[]),n.bitmaps.push({bitmap_type:t.type,bitmap_data:t.imageData,location:tf(r),normal:tf(A),up:tf(o),height:t.height})}n.components={visibility:{view_setup_hints:{spaces_visible:!!e.spacesVisible,space_boundaries_visible:!!e.spaceBoundariesVisible,openings_visible:!!e.openingsVisible,spaces_translucent:!!e.spaces_translucent,space_boundaries_translucent:!!e.space_boundaries_translucent,openings_translucent:!!e.openings_translucent}}};const p=new Set(t.opacityObjectIds),f=new Set(t.xrayedObjectIds),g=new Set(t.colorizedObjectIds),m=Object.values(t.objects).filter((e=>p.has(e.id)||g.has(e.id)||f.has(e.id))).reduce(((e,s)=>{let i,r=function(e){let t="";return t+=Math.round(255*e[0]).toString(16).padStart(2,"0"),t+=Math.round(255*e[1]).toString(16).padStart(2,"0"),t+=Math.round(255*e[2]).toString(16).padStart(2,"0"),t}(s.colorize);s.xrayed?(i=0===t.xrayMaterial.fillAlpha&&0!==t.xrayMaterial.edgeAlpha?.1:t.xrayMaterial.fillAlpha,i=Math.round(255*i).toString(16).padStart(2,"0"),r=i+r):p.has(s.id)&&(i=Math.round(255*s.opacity).toString(16).padStart(2,"0"),r=i+r),e[r]||(e[r]=[]);const n=s.id,A=s.originalSystemId,o={ifc_guid:A,originating_system:this.originatingSystem};return A!==n&&(o.authoring_tool_id=n),e[r].push(o),e}),{}),_=Object.entries(m).map((([e,t])=>({color:e,components:t})));n.components.coloring=_;const b=t.objectIds,B=t.visibleObjects,y=t.visibleObjectIds,w=b.filter((e=>!B[e])),v=t.selectedObjectIds;return e.defaultInvisible||y.length<w.length?(n.components.visibility.exceptions=this._createBCFComponents(y),n.components.visibility.default_visibility=!1):(n.components.visibility.exceptions=this._createBCFComponents(w),n.components.visibility.default_visibility=!0),n.components.selection=this._createBCFComponents(v),n.components.translucency=this._createBCFComponents(t.xrayedObjectIds),!1!==e.snapshot&&(n.snapshot={snapshot_type:"png",snapshot_data:this.viewer.getSnapshot({format:"png"})}),n}_createBCFComponents(e){const t=this.viewer.scene,s=[];for(let i=0,r=e.length;i<r;i++){const r=e[i],n=t.objects[r];if(n){const e={ifc_guid:n.originalSystemId,originating_system:this.originatingSystem};n.originalSystemId!==r&&(e.authoring_tool_id=r),s.push(e)}}return s}setViewpoint(e,t={}){if(!e)return;const s=this.viewer,i=s.scene,r=i.camera,n=!1!==t.rayCast,A=!1!==t.immediate,o=!1!==t.reset,a=i.realWorldOffset,l=!0===t.reverseClippingPlanes;if(i.clearSectionPlanes(),e.clipping_planes&&e.clipping_planes.length>0&&e.clipping_planes.forEach((function(e){let t=sf(e.location,Yp),s=sf(e.direction,Yp);l&&h.negateVec3(s),h.subVec3(t,a),r.yUp&&(t=nf(t),s=nf(s)),new Nr(i,{pos:t,dir:s})})),i.clearLines(),e.lines&&e.lines.length>0){const t=[],s=[];let r=0;e.lines.forEach((e=>{e.start_point&&e.end_point&&(t.push(e.start_point.x),t.push(e.start_point.y),t.push(e.start_point.z),t.push(e.end_point.x),t.push(e.end_point.y),t.push(e.end_point.z),s.push(r++),s.push(r++))})),new Br(i,{positions:t,indices:s,clippable:!1,collidable:!0})}if(i.clearBitmaps(),e.bitmaps&&e.bitmaps.length>0&&e.bitmaps.forEach((function(e){const t=e.bitmap_type||"jpg",s=e.bitmap_data;let n=sf(e.location,$p),A=sf(e.normal,qp),o=sf(e.up,ef),a=e.height||1;t&&s&&n&&A&&o&&(r.yUp&&(n=nf(n),A=nf(A),o=nf(o)),new Wt(i,{src:s,type:t,pos:n,normal:A,up:o,clippable:!1,collidable:!0,height:a}))})),o&&(i.setObjectsXRayed(i.xrayedObjectIds,!1),i.setObjectsHighlighted(i.highlightedObjectIds,!1),i.setObjectsSelected(i.selectedObjectIds,!1)),e.components){if(e.components.visibility){e.components.visibility.default_visibility?(i.setObjectsVisible(i.objectIds,!0),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((e=>this._withBCFComponent(t,e,(e=>e.visible=!1))))):(i.setObjectsVisible(i.objectIds,!1),e.components.visibility.exceptions&&e.components.visibility.exceptions.forEach((e=>this._withBCFComponent(t,e,(e=>e.visible=!0)))));const r=e.components.visibility.view_setup_hints;r&&(!1===r.spaces_visible&&i.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcSpace"),!1),void 0!==r.spaces_translucent&&i.setObjectsXRayed(s.metaScene.getObjectIDsByType("IfcSpace"),!0),r.space_boundaries_visible,!1===r.openings_visible&&i.setObjectsVisible(s.metaScene.getObjectIDsByType("IfcOpening"),!0),r.space_boundaries_translucent,void 0!==r.openings_translucent&&i.setObjectsXRayed(s.metaScene.getObjectIDsByType("IfcOpening"),!0))}e.components.selection&&(i.setObjectsSelected(i.selectedObjectIds,!1),e.components.selection.forEach((e=>this._withBCFComponent(t,e,(e=>e.selected=!0))))),e.components.translucency&&(i.setObjectsXRayed(i.xrayedObjectIds,!1),e.components.translucency.forEach((e=>this._withBCFComponent(t,e,(e=>e.xrayed=!0))))),e.components.coloring&&(i.setObjectsColorized(i.colorizedObjectIds,null),e.components.coloring.forEach((e=>{let s=e.color,i=0,r=!1;8===s.length&&(i=parseInt(s.substring(0,2),16)/255,i<=1&&i>=.95&&(i=1),s=s.substring(2),r=!0);const n=[parseInt(s.substring(0,2),16)/255,parseInt(s.substring(2,4),16)/255,parseInt(s.substring(4,6),16)/255];e.components.map((e=>this._withBCFComponent(t,e,(e=>{e.colorize=n,r&&(e.opacity=i)}))))})))}if(e.perspective_camera||e.orthogonal_camera){let o,l,c,u;if(e.perspective_camera?(o=sf(e.perspective_camera.camera_view_point,Yp),l=sf(e.perspective_camera.camera_direction,Yp),c=sf(e.perspective_camera.camera_up_vector,Yp),r.perspective.fov=e.perspective_camera.field_of_view,u="perspective"):(o=sf(e.orthogonal_camera.camera_view_point,Yp),l=sf(e.orthogonal_camera.camera_direction,Yp),c=sf(e.orthogonal_camera.camera_up_vector,Yp),r.ortho.scale=e.orthogonal_camera.view_to_world_scale,u="ortho"),h.subVec3(o,a),r.yUp&&(o=nf(o),l=nf(l),c=nf(c)),n){const e=i.pick({pickSurface:!0,origin:o,direction:l});l=e?e.worldPos:h.addVec3(o,l,Yp)}else l=h.addVec3(o,l,Yp);A?(r.eye=o,r.look=l,r.up=c,r.projection=u):s.cameraFlight.flyTo({eye:o,look:l,up:c,duration:t.duration,projection:u})}}_withBCFComponent(e,t,s){const i=this.viewer,r=i.scene;if(t.authoring_tool_id&&t.originating_system===this.originatingSystem){const n=t.authoring_tool_id,A=r.objects[n];if(A)return void s(A);if(e.updateCompositeObjects){if(i.metaScene.metaObjects[n])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(n),s)}}if(t.ifc_guid){const n=t.ifc_guid,A=r.objects[n];if(A)return void s(A);if(e.updateCompositeObjects){if(i.metaScene.metaObjects[n])return void r.withObjects(i.metaScene.getObjectIDsInSubtree(n),s)}Object.keys(r.models).forEach((t=>{const A=h.globalizeObjectId(t,n),o=r.objects[A];if(o)s(o);else if(e.updateCompositeObjects){i.metaScene.metaObjects[A]&&r.withObjects(i.metaScene.getObjectIDsInSubtree(A),s)}}))}}destroy(){super.destroy()}},exports.Bitmap=Wt,exports.ByteType=1010,exports.CameraMemento=Pr,exports.CameraPath=class extends T{get type(){return"CameraPath"}constructor(e,t={}){super(e,t),this._frames=[],this._eyeCurve=new W(this),this._lookCurve=new W(this),this._upCurve=new W(this),t.frames&&(this.addFrames(t.frames),this.smoothFrameTimes(1))}get frames(){return this._frames}get eyeCurve(){return this._eyeCurve}get lookCurve(){return this._lookCurve}get upCurve(){return this._upCurve}saveFrame(e){const t=this.scene.camera;this.addFrame(e,t.eye,t.look,t.up)}addFrame(e,t,s,i){const r={t:e,eye:t.slice(0),look:s.slice(0),up:i.slice(0)};this._frames.push(r),this._eyeCurve.points.push(r.eye),this._lookCurve.points.push(r.look),this._upCurve.points.push(r.up)}addFrames(e){let t;for(let s=0,i=e.length;s<i;s++)t=e[s],this.addFrame(t.t||0,t.eye,t.look,t.up)}loadFrame(e){const t=this.scene.camera;e=(e/=this._frames[this._frames.length-1].t-this._frames[0].t)<0?0:e>1?1:e,t.eye=this._eyeCurve.getPoint(e,z),t.look=this._lookCurve.getPoint(e,z),t.up=this._upCurve.getPoint(e,z)}sampleFrame(e,t,s,i){e=e<0?0:e>1?1:e,this._eyeCurve.getPoint(e,t),this._lookCurve.getPoint(e,s),this._upCurve.getPoint(e,i)}smoothFrameTimes(e){if(0===this._frames.length)return;const t=h.vec3();var s=0;this._frames[0].t=0;const i=[];for(let e=1,n=this._frames.length;e<n;e++){var r=h.lenVec3(h.subVec3(this._frames[e].eye,this._frames[e-1].eye,t));i[e]=r,s+=r}for(let t=1,r=this._frames.length;t<r;t++){const r=i[t]/s*e;this._frames[t].t=this._frames[t-1].t+r}}clearFrames(){this._frames=[],this._eyeCurve.points=[],this._lookCurve.points=[],this._upCurve.points=[]}},exports.CameraPathAnimation=q,exports.CityJSONLoaderPlugin=class extends Wr{constructor(e,t={}){super("cityJSONLoader",e,t),this.dataSource=t.dataSource}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new nv}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new br(this.viewer.scene,_.apply(e,{isModel:!0,edges:!0}));if(!e.src&&!e.cityJSON)return this.error("load() param expected: src or cityJSON"),t;const s={};if(e.src)this._loadModel(e.src,e,s,t);else{const i=this.viewer.scene.canvas.spinner;i.processes++,this._parseModel(e.cityJSON,e,s,t),i.processes--}return t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getCityJSON(t.src,(e=>{this._parseModel(e,t,s,i),r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){if(i.destroyed)return;const r=e.transform?this._transformVertices(e.vertices,e.transform,s.rotateX):e.vertices,n=t.stats||{};n.sourceFormat=e.type||"CityJSON",n.schemaVersion=e.version||"",n.title="",n.author="",n.created="",n.numMetaObjects=0,n.numPropertySets=0,n.numObjects=0,n.numGeometries=0,n.numTriangles=0,n.numVertices=0;const A=!1!==t.loadMetadata,o=A?{id:h.createUUID(),name:"Model",type:"Model"}:null,a=A?{id:"",projectId:"",author:"",createdAt:"",schema:e.version||"",creatingApplication:"",metaObjects:[o],propertySets:[]}:null,l={data:e,vertices:r,sceneModel:i,loadMetadata:A,metadata:a,rootMetaObject:o,nextId:0,stats:n};if(this._parseCityJSON(l),i.finalize(),A){const e=i.id;this.viewer.metaScene.createMetaModel(e,l.metadata,s)}i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_transformVertices(e,t,s){const i=[],r=t.scale||h.vec3([1,1,1]),n=t.translate||h.vec3([0,0,0]);for(let t=0,A=0;t<e.length;t++,A+=3){const A=e[t][0]*r[0]+n[0],o=e[t][1]*r[1]+n[1],a=e[t][2]*r[2]+n[2];s?i.push([A,a,o]):i.push([A,o,a])}return i}_parseCityJSON(e){const t=e.data.CityObjects;for(const s in t)if(t.hasOwnProperty(s)){const i=t[s];this._parseCityObject(e,i,s)}}_parseCityObject(e,t,s){const i=e.sceneModel,r=e.data;if(e.loadMetadata){const i=s,r=t.type,n=r+" : "+s,A=t.parents?t.parents[0]:e.rootMetaObject.id;e.metadata.metaObjects.push({id:i,name:n,type:r,parent:A})}if(e.stats.numMetaObjects++,!(t.geometry&&t.geometry.length>0))return;const n=[];for(let s=0,i=t.geometry.length;s<i;s++){const i=t.geometry[s];let A,o;const a=r.appearance;if(a){const e=a.materials;if(e){const t=i.material;if(t){const i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r.value)A=e[r.value];else{const t=r.values;if(t){o=[];for(let i=0,r=t.length;i<r;i++){const i=e[t[s]];o.push(i)}}}}}}}o?this._parseGeometrySurfacesWithOwnMaterials(e,i,o,n):this._parseGeometrySurfacesWithSharedMaterial(e,i,A,n)}n.length>0&&(i.createEntity({id:s,meshIds:n,isObject:!0}),e.stats.numObjects++)}_parseGeometrySurfacesWithOwnMaterials(e,t,s,i){switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":const r=t.boundaries;this._parseSurfacesWithOwnMaterials(e,s,r,i);break;case"Solid":const n=t.boundaries;for(let t=0;t<n.length;t++){const r=n[t];this._parseSurfacesWithOwnMaterials(e,s,r,i)}break;case"MultiSolid":case"CompositeSolid":const A=t.boundaries;for(let t=0;t<A.length;t++)for(let r=0;r<A[t].length;r++){const n=A[t][r];this._parseSurfacesWithOwnMaterials(e,s,n,i)}}}_parseSurfacesWithOwnMaterials(e,t,s,i){const r=e.vertices,n=e.sceneModel;for(let A=0;A<s.length;A++){const o=s[A],a=t[A]||{diffuseColor:[.8,.8,.8],transparency:1},l=[],c=[],u=[],d={positions:[],indices:[]};for(let t=0;t<o.length;t++){l.length>0&&c.push(l.length);const s=this._extractLocalIndices(e,o[t],u,d);l.push(...s)}if(3===l.length)d.indices.push(l[0]),d.indices.push(l[1]),d.indices.push(l[2]);else if(l.length>3){const e=[];for(let t=0;t<l.length;t++)e.push({x:r[u[l[t]]][0],y:r[u[l[t]]][1],z:r[u[l[t]]][2]});const t=this._getNormalOfPositions(e,h.vec3());let s=[];for(let i=0;i<e.length;i++)this._to2D(e[i],t,Av),s.unshift(Av[0]),s.unshift(Av[1]);const i=On(s,c,2);for(let e=0;e<i.length;e+=3)d.indices.unshift(l[i[e]]),d.indices.unshift(l[i[e+1]]),d.indices.unshift(l[i[e+2]])}const p=""+e.nextId++;n.createMesh({id:p,primitive:"triangles",positions:d.positions,indices:d.indices,color:a&&a.diffuseColor?a.diffuseColor:[.8,.8,.8],opacity:a&&void 0!==a.transparency?1-a.transparency:1}),i.push(p),e.stats.numGeometries++,e.stats.numVertices+=d.positions.length/3,e.stats.numTriangles+=d.indices.length/3}}_parseGeometrySurfacesWithSharedMaterial(e,t,s,i){const r=e.sceneModel,n=[],A={positions:[],indices:[]};switch(t.type){case"MultiPoint":case"MultiLineString":break;case"MultiSurface":case"CompositeSurface":const s=t.boundaries;this._parseSurfacesWithSharedMaterial(e,s,n,A);break;case"Solid":const i=t.boundaries;for(let t=0;t<i.length;t++){const s=i[t];this._parseSurfacesWithSharedMaterial(e,s,n,A)}break;case"MultiSolid":case"CompositeSolid":const r=t.boundaries;for(let t=0;t<r.length;t++)for(let s=0;s<r[t].length;s++){const i=r[t][s];this._parseSurfacesWithSharedMaterial(e,i,n,A)}}if(A.positions.length>0&&A.indices.length>0){const t=""+e.nextId++;r.createMesh({id:t,primitive:"triangles",positions:A.positions,indices:A.indices,color:s&&s.diffuseColor?s.diffuseColor:[.8,.8,.8],opacity:1}),i.push(t),e.stats.numGeometries++,e.stats.numVertices+=A.positions.length/3,e.stats.numTriangles+=A.indices.length/3}}_parseSurfacesWithSharedMaterial(e,t,s,i){const r=e.vertices;for(let n=0;n<t.length;n++){let A=[],o=[];for(let r=0;r<t[n].length;r++){A.length>0&&o.push(A.length);const a=this._extractLocalIndices(e,t[n][r],s,i);A.push(...a)}if(3===A.length)i.indices.push(A[0]),i.indices.push(A[1]),i.indices.push(A[2]);else if(A.length>3){let e=[];for(let t=0;t<A.length;t++)e.push({x:r[s[A[t]]][0],y:r[s[A[t]]][1],z:r[s[A[t]]][2]});const t=this._getNormalOfPositions(e,h.vec3());let n=[];for(let s=0;s<e.length;s++)this._to2D(e[s],t,Av),n.unshift(Av[0]),n.unshift(Av[1]);const a=On(n,o,2);for(let e=0;e<a.length;e+=3)i.indices.unshift(A[a[e]]),i.indices.unshift(A[a[e+1]]),i.indices.unshift(A[a[e+2]])}}}_extractLocalIndices(e,t,s,i){const r=e.vertices,n=[];for(let e=0,A=t.length;e<A;e++){const A=t[e];if(s.includes(A)){const e=s.indexOf(A);n.push(e)}else i.positions.push(r[A][0]),i.positions.push(r[A][1]),i.positions.push(r[A][2]),n.push(s.length),s.push(A)}return n}_getNormalOfPositions(e,t){for(let s=0;s<e.length;s++){let i=s+1;i===e.length&&(i=0),t[0]+=(e[s].y-e[i].y)*(e[s].z+e[i].z),t[1]+=(e[s].z-e[i].z)*(e[s].x+e[i].x),t[2]+=(e[s].x-e[i].x)*(e[s].y+e[i].y)}return h.normalizeVec3(t)}_to2D(e,t,s){const i=ov,r=av,n=lv;i[0]=e.x,i[1]=e.y,i[2]=e.z,r[0]=t.x,r[1]=t.y,r[2]=t.z,n[0]=1.1,n[1]=1.1,n[2]=1.1;h.lenVec3(h.subVec3(n,r))<.01&&(n[0]+=1,n[1]+=2,n[2]+=3);const A=h.dotVec3(n,r),o=h.mulVec3Scalar(r,A,h.vec3());n[0]-=o[0],n[1]-=o[1],n[2]-=o[2],h.normalizeVec3(n);const a=h.cross3Vec3(r,n,h.vec3()),l=h.dotVec3(i,n),c=h.dotVec3(i,a);s[0]=l,s[1]=c}},exports.ClampToEdgeWrapping=1001,exports.Component=T,exports.CompressedMediaType=10003,exports.Configs=Ws,exports.ContextMenu=class{constructor(e={}){this._id=t.addItem(),this._context=null,this._enabled=!1,this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={},this._shown=!1,this._nextId=0,this._parentNode=e.parentNode||document.body,this._offsetParent=this._parentNode instanceof ShadowRoot?this._parentNode.host:this._parentNode,this._eventSubs={},!1!==e.hideOnMouseDown&&(this._parentNode.addEventListener("mousedown",(e=>{e.target.classList.contains("xeokit-context-menu-item")||this.hide()})),this._parentNode.addEventListener("touchstart",this._canvasTouchStartHandler=e=>{e.target.classList.contains("xeokit-context-menu-item")||this.hide()})),e.items&&(this.items=e.items),this._hideOnAction=!1!==e.hideOnAction,this.context=e.context,this.enabled=!1!==e.enabled,this.hide()}on(e,t){let s=this._eventSubs[e];s||(s=[],this._eventSubs[e]=s),s.push(t)}fire(e,t){const s=this._eventSubs[e];if(s)for(let e=0,i=s.length;e<i;e++)s[e](t)}set items(e){this._clear(),this._itemsCfg=e||[],this._parseItems(e),this._createUI()}get items(){return this._itemsCfg}set enabled(e){(e=!!e)!==this._enabled&&(this._enabled=e,this._enabled||this.hide())}get enabled(){return this._enabled}set context(e){this._context=e}get context(){return this._context}show(e,t){this._context?this._enabled&&(this._shown||(this._hideAllMenus(),this._updateItemsTitles(),this._updateItemsEnabledStatus(),this._showMenu(this._rootMenu.id,e,t),this._updateSubMenuInfo(),this._shown=!0,this.fire("shown",{}))):console.error("ContextMenu cannot be shown without a context - set context first")}get shown(){return this._shown}hide(){this._enabled&&this._shown&&(this._hideAllMenus(),this._shown=!1,this.fire("hidden",{}))}destroy(){this._context=null,this._clear(),null!==this._id&&(t.removeItem(this._id),this._id=null)}_clear(){for(let e=0,t=this._menuList.length;e<t;e++){this._menuList[e].menuElement.remove()}this._itemsCfg=[],this._rootMenu=null,this._menuList=[],this._menuMap={},this._itemList=[],this._itemMap={}}_parseItems(e){const t=e=>{const n=this._getNextId(),A=new s(n);for(let s=0,n=e.length;s<n;s++){const n=e[s],o=new i;A.groups.push(o);for(let e=0,s=n.length;e<s;e++){const s=n[e],i=s.items,a=i&&i.length>0,l=this._getNextId(),c=s.getTitle||(()=>s.title||""),h=s.doAction||s.callback||(()=>{}),u=s.getEnabled||(()=>!0),d=s.getShown||(()=>!0),p=new r(l,c,h,u,d);if(p.parentMenu=A,o.items.push(p),a){const e=t(i);p.subMenu=e,e.parentItem=p}this._itemList.push(p),this._itemMap[p.id]=p}}return this._menuList.push(A),this._menuMap[A.id]=A,A};this._rootMenu=t(e)}_getNextId(){return"ContextMenu_"+this._id+"_"+this._nextId++}_createUI(){const e=t=>{this._createMenuUI(t);const s=t.groups;for(let t=0,i=s.length;t<i;t++){const i=s[t].items;for(let t=0,s=i.length;t<s;t++){const s=i[t].subMenu;s&&e(s)}}};e(this._rootMenu)}_createMenuUI(e){const t=e.groups,s=[],i=document.createElement("div");if(i.classList.add("xeokit-context-menu",e.id),i.style.zIndex=3e5,i.style.position="absolute",s.push("<ul>"),t)for(let e=0,i=t.length;e<i;e++){const r=e,n=i,A=t[e].items;if(A)for(let e=0,t=A.length;e<t;e++){const i=A[e],o=i.subMenu,a=i.title||"";o?(s.push('<li id="'+i.id+'" class="xeokit-context-menu-item xeokit-context-menu-submenu">'+a+"</li>"),r===n-1||e<t-1||s.push('<li id="'+i.id+'" class="xeokit-context-menu-item-separator"></li>')):(s.push('<li id="'+i.id+'" class="xeokit-context-menu-item">'+a+"</li>"),r===n-1||e<t-1||s.push('<li id="'+i.id+'" class="xeokit-context-menu-item-separator"></li>'))}}s.push("</ul>");const r=s.join("");i.innerHTML=r,this._parentNode.appendChild(i),e.menuElement=i,i.style["border-radius"]="4px",i.style.display="none",i.style["z-index"]=3e5,i.style.background="white",i.style.border="1px solid black",i.style["box-shadow"]="0 4px 5px 0 gray",i.oncontextmenu=e=>{e.preventDefault()};const n=this;let A=null;if(t)for(let e=0,s=t.length;e<s;e++){const s=t[e].items;if(s)for(let e=0,t=s.length;e<t;e++){const t=s[e],i=t.subMenu;t.itemElement=this._parentNode.querySelector(`#${t.id}`),t.itemElement?(t.itemElement.addEventListener("mouseenter",(e=>{e.preventDefault();const s=t.subMenu;if(!s)return void(A&&(n._hideMenu(A.id),A=null));if(A&&A.id!==s.id&&(n._hideMenu(A.id),A=null),!1===t.enabled)return;const i=t.itemElement,r=s.menuElement,o=i.getBoundingClientRect();r.getBoundingClientRect();const a=n._offsetParent.getBoundingClientRect(),l=200,c=o.right+l<a.right,h=o.left-l>a.left;if(c)n._showMenu(s.id,o.right+window.scrollX-5,o.top+window.scrollY-1);else if(h)n._showMenu(s.id,o.left-l+window.scrollX,o.top+window.scrollY-1);else{const e=o.left-a.left,t=a.right-o.right;t>e?n._showMenu(s.id,o.right-5-(l-t),o.top+window.scrollY-1):n._showMenu(s.id,o.left-e,o.top+window.scrollY-1)}A=s})),i||(t.itemElement.addEventListener("click",(e=>{e.preventDefault(),n._context&&!1!==t.enabled&&(t.doAction&&t.doAction(n._context),this._hideOnAction?n.hide():(n._updateItemsTitles(),n._updateItemsEnabledStatus()))})),t.itemElement.addEventListener("mouseup",(e=>{3===e.which&&(e.preventDefault(),n._context&&!1!==t.enabled&&(t.doAction&&t.doAction(n._context),this._hideOnAction?n.hide():(n._updateItemsTitles(),n._updateItemsEnabledStatus())))})),t.itemElement.addEventListener("mouseenter",(e=>{e.preventDefault(),!1!==t.enabled&&t.doHover&&t.doHover(n._context)})))):console.error("ContextMenu item element not found: "+t.id)}}}_updateItemsTitles(){if(this._context)for(let e=0,t=this._itemList.length;e<t;e++){const t=this._itemList[e],s=t.itemElement;if(!s)continue;const i=t.getShown;if(!i||!i(this._context))continue;const r=t.getTitle(this._context);t.subMenu,s.innerText=r}}_updateItemsEnabledStatus(){if(this._context)for(let e=0,t=this._itemList.length;e<t;e++){const t=this._itemList[e],s=t.itemElement;if(!s)continue;const i=t.getEnabled;if(!i)continue;const r=t.getShown;if(!r)continue;const n=r(this._context);if(t.shown=n,!n){s.style.display="none";continue}s.style.display="";const A=i(this._context);t.enabled=A,A?s.classList.remove("disabled"):s.classList.add("disabled")}}_updateSubMenuInfo(){if(!this._context)return;let e,t,s,i,r,n;this._itemList.forEach((A=>{A.subMenu&&(e=A.itemElement,t=e.getBoundingClientRect(),s=A.subMenu.menuElement,i={visibility:s.style.visibility,display:s.style.display},s.style.display="block",s.style.visibility="hidden",n=A.subMenu.menuElement.getBoundingClientRect().width,s.style.visibility=i.visibility,s.style.display=i.display,r=t.right+n>window.innerWidth,e.setAttribute("data-submenuposition",r?"left":"right"))}))}_showMenu(e,t,s){const i=this._menuMap[e];if(!i)return void console.error("Menu not found: "+e);if(i.shown)return;const r=i.menuElement;r&&(this._showMenuElement(r,t,s),i.shown=!0)}_hideMenu(e){const t=this._menuMap[e];if(!t)return void console.error("Menu not found: "+e);if(!t.shown)return;const s=t.menuElement;s&&(this._hideMenuElement(s),t.shown=!1)}_hideAllMenus(){for(let e=0,t=this._menuList.length;e<t;e++){const t=this._menuList[e];this._hideMenu(t.id)}}_showMenuElement(e,t,s){e.style.display="block";const i=e.offsetHeight,r=e.offsetWidth,n=this._offsetParent.getBoundingClientRect(),A=this._offsetParent===window.document.body&&0===n.bottom?window.innerHeight:n.bottom+window.scrollY,o=n.right+window.scrollX;s+i>A&&(s=A-i),t+r>o&&(t=o-r),e.style.left=t-n.left-window.scrollX+"px",e.style.top=s-n.top-window.scrollY+"px"}_hideMenuElement(e){e.style.display="none"}},exports.CubicBezierCurve=class extends j{constructor(e,t={}){super(e,t),this.v0=t.v0,this.v1=t.v1,this.v2=t.v2,this.v3=t.v3,this.t=t.t}set v0(e){this._v0=e||h.vec3([0,0,0])}get v0(){return this._v0}set v1(e){this._v1=e||h.vec3([0,0,0])}get v1(){return this._v1}set v2(e){this._v2=e||h.vec3([0,0,0])}get v2(){return this._v2}set v3(e){this.fire("v3",this._v3=e||h.vec3([0,0,0]))}get v3(){return this._v3}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=h.vec3();return t[0]=h.b3(e,this._v0[0],this._v1[0],this._v2[0],this._v3[0]),t[1]=h.b3(e,this._v0[1],this._v1[1],this._v2[1],this._v3[1]),t[2]=h.b3(e,this._v0[2],this._v1[2],this._v2[2],this._v3[2]),t}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,v3:this._v3,t:this._t}}},exports.Curve=j,exports.CxConverterIFCLoaderPlugin=class extends Wr{constructor(e,t={}){super("ifcLoader",e,t),this.gltfLoader=new QB(this.viewer),this.cxConverterModule=null}setCxConverterModule(e){this.cxConverterModule=e}async load(e={}){if(!this.cxConverterModule)throw new Error("CxConverter module is not set. Use setCxConverterModule() to set it.");e.src||this.error("load() param expected: src");const t=await async function(e){try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! Status: ${t.status}`);return t.text()}catch(e){console.error("Error fetching file:",e)}}(e.src),{gltf:s,metaData:i}=await this.cxConverterModule.ifc2gltf(t,{remote:!0,progressCallback:e.progressCallback,progressTextCallback:e.progressTextCallback});return this.gltfLoader.load({id:"myModel",gltf:s,metaModelJSON:i})}},exports.DefaultLoadingManager=Qi,exports.DepthFormat=1026,exports.DepthStencilFormat=1027,exports.DirLight=Cr,exports.DistanceMeasurementEditControl=df,exports.DistanceMeasurementEditMouseControl=class extends df{constructor(e,t){super(e,t,!0,!1)}},exports.DistanceMeasurementEditTouchControl=class extends df{constructor(e,t){super(e,t,!1,!0)}},exports.DistanceMeasurementsControl=cf,exports.DistanceMeasurementsMouseControl=hf,exports.DistanceMeasurementsPlugin=class extends Wr{constructor(e,t={}){super("DistanceMeasurements",e),this._pointerLens=t.pointerLens,this._container=t.container||document.body,this._defaultControl=null,this._measurements={},this.labelMinAxisLength=t.labelMinAxisLength,this.defaultVisible=!1!==t.defaultVisible,this.defaultOriginVisible=!1!==t.defaultOriginVisible,this.defaultTargetVisible=!1!==t.defaultTargetVisible,this.defaultWireVisible=!1!==t.defaultWireVisible,this.defaultXLabelEnabled=!1!==t.defaultXLabelEnabled,this.defaultYLabelEnabled=!1!==t.defaultYLabelEnabled,this.defaultZLabelEnabled=!1!==t.defaultZLabelEnabled,this.defaultLengthLabelEnabled=!1!==t.defaultLengthLabelEnabled,this.defaultLabelsVisible=!1!==t.defaultLabelsVisible,this.defaultAxisVisible=!1!==t.defaultAxisVisible,this.defaultXAxisVisible=!1!==t.defaultXAxisVisible,this.defaultYAxisVisible=!1!==t.defaultYAxisVisible,this.defaultZAxisVisible=!1!==t.defaultZAxisVisible,this.defaultColor=void 0!==t.defaultColor?t.defaultColor:"#00BBFF",this.zIndex=t.zIndex||1e4,this.defaultLabelsOnWires=!1!==t.defaultLabelsOnWires,this.useRotationAdjustment=void 0!==t.useRotationAdjustment&&!1!==t.useRotationAdjustment,this._onMouseOver=(e,t)=>{this.fire("mouseOver",{plugin:this,distanceMeasurement:t,measurement:t,event:e})},this._onMouseLeave=(e,t)=>{this.fire("mouseLeave",{plugin:this,distanceMeasurement:t,measurement:t,event:e})},this._onContextMenu=(e,t)=>{this.fire("contextMenu",{plugin:this,distanceMeasurement:t,measurement:t,event:e})}}getContainerElement(){return this._container}send(e,t){}get pointerLens(){return this._pointerLens}get control(){return this._defaultControl||(this._defaultControl=new hf(this,{})),this._defaultControl}get measurements(){return this._measurements}set labelMinAxisLength(e){e<1&&(this.error("labelMinAxisLength must be >= 1; defaulting to 25"),e=25),this._labelMinAxisLength=e||25}get labelMinAxisLength(){return this._labelMinAxisLength}set useRotationAdjustment(e){e=void 0!==e&&Boolean(e),this._useRotationAdjustment=e}get useRotationAdjustment(){return this._useRotationAdjustment}createMeasurement(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=e.origin,s=e.target,i=new lf(this,{id:e.id,plugin:this,container:this._container,origin:{entity:t.entity,worldPos:t.worldPos},target:{entity:s.entity,worldPos:s.worldPos},visible:e.visible,wireVisible:e.wireVisible,axisVisible:!1!==e.axisVisible&&!1!==this.defaultAxisVisible,xAxisVisible:!1!==e.xAxisVisible&&!1!==this.defaultXAxisVisible,yAxisVisible:!1!==e.yAxisVisible&&!1!==this.defaultYAxisVisible,zAxisVisible:!1!==e.zAxisVisible&&!1!==this.defaultZAxisVisible,xLabelEnabled:!1!==e.xLabelEnabled&&!1!==this.defaultXLabelEnabled,yLabelEnabled:!1!==e.yLabelEnabled&&!1!==this.defaultYLabelEnabled,zLabelEnabled:!1!==e.zLabelEnabled&&!1!==this.defaultZLabelEnabled,lengthLabelEnabled:!1!==e.lengthLabelEnabled&&!1!==this.defaultLengthLabelEnabled,labelsVisible:!1!==e.labelsVisible&&!1!==this.defaultLabelsVisible,useRotationAdjustment:this.useRotationAdjustment,originVisible:e.originVisible,targetVisible:e.targetVisible,color:e.color,labelsOnWires:!1!==e.labelsOnWires&&!1!==this.defaultLabelsOnWires,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._measurements[i.id]=i,i.clickable=!0,i.on("destroyed",(()=>{delete this._measurements[i.id]})),this.fire("measurementCreated",i),i}destroyMeasurement(e){const t=this._measurements[e];t?(t.destroy(),this.fire("measurementDestroyed",t)):this.log("DistanceMeasurement not found: "+e)}setLabelsShown(e){for(const[t,s]of Object.entries(this.measurements))s.labelShown=e}setAxisVisible(e){for(const[t,s]of Object.entries(this.measurements))s.axisVisible=e;this.defaultAxisVisible=e}getAxisVisible(){return this.defaultAxisVisible}clear(){const e=Object.keys(this._measurements);for(var t=0,s=e.length;t<s;t++)this.destroyMeasurement(e[t])}destroy(){this.clear(),super.destroy()}},exports.DistanceMeasurementsTouchControl=class extends cf{constructor(e,t={}){super(e.viewer.scene),this.pointerLens=t.pointerLens,this.pointerCircle=new L(e.viewer),this._active=!1;const s=document.createElement("div"),i=this.scene.canvas.canvas;i.parentNode.insertBefore(s,i),s.style.background="black",s.style.border="2px solid blue",s.style.borderRadius="10px",s.style.width="5px",s.style.height="5px",s.style.margin="-200px -200px",s.style.zIndex="100",s.style.position="absolute",s.style.pointerEvents="none",this.markerDiv=s,this._currentDistanceMeasurement=null,this._currentDistanceMeasurementInitState={wireVisible:null,axisVisible:null,xAxisVisible:null,yaxisVisible:null,zAxisVisible:null,targetVisible:null},this._longTouchTimeoutMs=300,this._snapping=!1!==t.snapping,this._attachPlugin(e,t)}_attachPlugin(e){this.distanceMeasurementsPlugin=e,this.plugin=e}get active(){return this._active}set snapping(e){this._snapping=e}get snapping(){return this._snapping}activate(){if(this._active)return;const e=this.plugin,t=this.scene,s=t.canvas.canvas;e.pointerLens;const i=h.vec3(),r=20;let n=null;this._touchState=0;const A=h.vec2(),o=h.vec2(),a=h.vec2();let l=null;const c=()=>{this.plugin.viewer.cameraControl.active=!1},u=()=>{this.plugin.viewer.cameraControl.active=!0},d=()=>{n&&(clearTimeout(n),n=null),this._currentDistanceMeasurement&&(this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null),u(),this._touchState=0},p=(e,t)=>(t[0]=e.clientX,t[1]=e.clientY,Ep(s.ownerDocument.documentElement,s,t),t),f=(e,t)=>(t.set(e),Ep(s,s.ownerDocument.documentElement,t),t);s.addEventListener("touchstart",this._onCanvasTouchStart=s=>{const a=s.touches.length;if(1!==a)return void(n&&(clearTimeout(n),n=null));const u=s.touches[0];switch(p(u,A),o.set(A),this._touchState){case 0:if(1!==a&&null!==n)return void d();const s=t.pick({canvasPos:o,snapping:this._snapping,snapToEdge:this._snapping});if(s&&s.snapped)i.set(s.worldPos),this.pointerCircle.start(f(s.snappedCanvasPos,uf));else{const e=t.pick({canvasPos:o,pickSurface:!0});if(!e||!e.worldPos)return;i.set(e.worldPos),this.pointerCircle.start(f(e.canvasPos,uf))}n=setTimeout((()=>{1!==a||o[0]>A[0]+r||o[0]<A[0]-r||o[1]>A[1]+r||o[1]<A[1]-r||(this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=A,this.pointerLens.cursorPos=A),this.pointerLens&&(this.pointerLens.canvasPos=o,this.pointerLens.snapped=!1),this.pointerLens&&(this.pointerLens.cursorPos=s.canvasPos,this.pointerLens.snapped=!0),this._currentDistanceMeasurement?this._currentDistanceMeasurement.origin.worldPos=i:(this._currentDistanceMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:i,entity:s.entity},target:{worldPos:i,entity:s.entity}}),this._currentDistanceMeasurement.labelsVisible=!1,this._currentDistanceMeasurement.xAxisVisible=!1,this._currentDistanceMeasurement.yAxisVisible=!1,this._currentDistanceMeasurement.zAxisVisible=!1,this._currentDistanceMeasurement.wireVisible=!1,this._currentDistanceMeasurement.originVisible=!0,this._currentDistanceMeasurement.targetVisible=!1,this._currentDistanceMeasurement.clickable=!1),this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement),this._touchState=2,c())}),this._longTouchTimeoutMs),this._touchState=1,l=u.identifier;break;case 3:if(1!==a&&null!==n)return clearTimeout(n),void(n=null);1===a&&(n=setTimeout((()=>{if(n=null,1!==a||o[0]>A[0]+r||o[0]<A[0]-r||o[1]>A[1]+r||o[1]<A[1]-r)return;this.pointerLens&&(this.pointerLens.visible=!0,this.pointerLens.canvasPos=A,this.pointerLens.snapped=!1);const e=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping});if(e&&e.snapped)this.pointerLens&&(this.pointerLens.cursorPos=e.snappedCanvasPos,this.pointerLens.snapped=!0),this.pointerCircle.start(f(e.snappedCanvasPos,uf)),i.set(e.worldPos),this._currentDistanceMeasurement.target.worldPos=e.worldPos,this._currentDistanceMeasurement.target.entity=e.entity,this._currentDistanceMeasurement.targetVisible=!0,this._currentDistanceMeasurement.wireVisible=!0,this._currentDistanceMeasurement.labelsVisible=!0,this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement);else{const e=t.pick({canvasPos:o,pickSurface:!0});e&&e.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=e.canvasPos,this.pointerLens.snapped=!1),this.pointerCircle.start(f(e.canvasPos,uf)),i.set(e.worldPos),this._currentDistanceMeasurement.target.worldPos=e.worldPos,this._currentDistanceMeasurement.target.entity=e.entity,this._currentDistanceMeasurement.targetVisible=!0,this._currentDistanceMeasurement.wireVisible=!0,this._currentDistanceMeasurement.labelsVisible=!0,this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement)):this.pointerLens&&(this.pointerLens.cursorPos=null,this.pointerLens.snapped=!1)}this._touchState=5,c()}),this._longTouchTimeoutMs),this._touchState=4),l=u.identifier;break;default:return null!==n&&(clearTimeout(n),n=null),void(this._touchState=7)}},{passive:!0}),s.addEventListener("touchmove",(s=>{this.pointerCircle.stop();const r=s.touches.length;if(1!==r||1!==s.changedTouches.length)return void(n&&(clearTimeout(n),n=null));const A=s.touches[0];if(A.identifier!==l)return;let a,c;switch(p(A,o),this._touchState){case 2:this.pointerLens&&(this.pointerLens.canvasPos=o),a=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping}),a&&a.snapped?(this.pointerLens&&(this.pointerLens.snappedCanvasPos=a.snappedCanvasPos,this.pointerLens.snapped=!0),i.set(a.worldPos),this._currentDistanceMeasurement?this._currentDistanceMeasurement.origin.worldPos=a.worldPos:(this._currentDistanceMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:a.worldPos,entity:a.entity},target:{worldPos:a.worldPos,entity:a.entity}}),this._currentDistanceMeasurement.labelsVisible=!1,this._currentDistanceMeasurement.xAxisVisible=!1,this._currentDistanceMeasurement.yAxisVisible=!1,this._currentDistanceMeasurement.zAxisVisible=!1,this._currentDistanceMeasurement.wireVisible=!1,this._currentDistanceMeasurement.originVisible=!0,this._currentDistanceMeasurement.targetVisible=!1,this._currentDistanceMeasurement.clickable=!1),this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement)):(c=t.pick({canvasPos:o,pickSurface:!0}),c&&c.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=c.canvasPos,this.pointerLens.snapped=!1),i.set(c.worldPos),this._currentDistanceMeasurement?this._currentDistanceMeasurement.origin.worldPos=c.worldPos:(this._currentDistanceMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:c.worldPos,entity:c.entity},target:{worldPos:c.worldPos,entity:c.entity}}),this._currentDistanceMeasurement.labelsVisible=!1,this._currentDistanceMeasurement.xAxisVisible=!1,this._currentDistanceMeasurement.yAxisVisible=!1,this._currentDistanceMeasurement.zAxisVisible=!1,this._currentDistanceMeasurement.wireVisible=!1,this._currentDistanceMeasurement.originVisible=!0,this._currentDistanceMeasurement.targetVisible=!1,this._currentDistanceMeasurement.clickable=!1),this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement)):this.pointerLens&&(this.pointerLens.cursorPos=null,this.pointerLens.snapped=!1)),this._touchState=2;break;case 5:if(1!==r&&null!==n)return clearTimeout(n),n=null,this.pointerLens&&(this.pointerLens.visible=!1),void(this._touchState=7);this.pointerLens&&(this.pointerLens.canvasPos=o),a=t.pick({canvasPos:o,snapToVertex:this._snapping,snapToEdge:this._snapping}),a&&a.worldPos?(this.pointerLens&&(this.pointerLens.cursorPos=a.snappedCanvasPos,this.pointerLens.snapped=!0),this._currentDistanceMeasurement.target.worldPos=a.worldPos,this._currentDistanceMeasurement.target.entity=a.entity,this._currentDistanceMeasurement.targetVisible=!0,this._currentDistanceMeasurement.wireVisible=!0,this._currentDistanceMeasurement.labelsVisible=!0):(c=t.pick({canvasPos:o,pickSurface:!0}),c&&c.worldPos&&(this.pointerLens&&(this.pointerLens.cursorPos=c.canvasPos,this.pointerLens.snapped=!1),this._currentDistanceMeasurement.target.worldPos=c.worldPos,this._currentDistanceMeasurement.target.entity=c.entity,this._currentDistanceMeasurement.targetVisible=!0,this._currentDistanceMeasurement.wireVisible=!0,this._currentDistanceMeasurement.labelsVisible=!0)),this._touchState=5}}),{passive:!0}),s.addEventListener("touchend",this._onCanvasTouchEnd=s=>{this.pointerCircle.stop();const i=s.changedTouches.length;if(1!==i)return;const c=s.changedTouches[0];if(c.identifier!==l)return;n&&(clearTimeout(n),n=null),p(c,a);const d=a[0],f=a[1];switch(this._touchState){case 1:{if(1!==i||d>A[0]+r||d<A[0]-r||f>A[1]+r||f<A[1]-r)return void(this._touchState=0);const s=t.pick({canvasPos:o,pickSurface:!0});s&&s.worldPos?(this._currentDistanceMeasurement=e.createMeasurement({id:h.createUUID(),origin:{worldPos:s.worldPos,entity:s.entity},target:{worldPos:s.worldPos,entity:s.entity}}),this._currentDistanceMeasurement.labelsVisible=!1,this._currentDistanceMeasurement.xAxisVisible=!1,this._currentDistanceMeasurement.yAxisVisible=!1,this._currentDistanceMeasurement.zAxisVisible=!1,this._currentDistanceMeasurement.wireVisible=!1,this._currentDistanceMeasurement.originVisible=!0,this._currentDistanceMeasurement.targetVisible=!1,this._currentDistanceMeasurement.clickable=!1,this._touchState=3,this.distanceMeasurementsPlugin.fire("measurementStart",this._currentDistanceMeasurement)):(this._currentDistanceMeasurement&&this._currentDistanceMeasurement.destroy(),this._touchState=0)}u();break;case 2:this.pointerLens&&(this.pointerLens.visible=!1),this._currentDistanceMeasurement?this._touchState=3:(this.pointerLens&&(this.pointerLens.snapped=!1,this.pointerLens.visible=!1),this._touchState=0),u();break;case 4:{if(1!==i||d>A[0]+r||d<A[0]-r||f>A[1]+r||f<A[1]-r)return void(this._touchState=3);const e=t.pick({canvasPos:o,pickSurface:!0});e&&e.worldPos?(this._currentDistanceMeasurement.target.worldPos=e.worldPos,this._currentDistanceMeasurement.target.entity=e.entity,this._currentDistanceMeasurement.targetVisible=!0,this._currentDistanceMeasurement.wireVisible=!0,this._currentDistanceMeasurement.labelsVisible=!0,this._currentDistanceMeasurement.xAxisVisible=!0,this._currentDistanceMeasurement.yAxisVisible=!0,this._currentDistanceMeasurement.zAxisVisible=!0,this._currentDistanceMeasurement.clickable=!0,this.distanceMeasurementsPlugin.fire("measurementEnd",this._currentDistanceMeasurement),this._currentDistanceMeasurement=null):this._currentDistanceMeasurement&&(this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null),this._touchState=0}u();break;case 5:console.log("long touch"),this.pointerLens&&(this.pointerLens.visible=!1),this._currentDistanceMeasurement&&this._currentDistanceMeasurement.targetVisible?(this._currentDistanceMeasurement.clickable=!0,this.distanceMeasurementsPlugin.fire("measurementEnd",this._currentDistanceMeasurement),this._currentDistanceMeasurement=null,this._touchState=0):(this._currentDistanceMeasurement&&(this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null),this._touchState=0),u()}},{passive:!0}),this._active=!0}deactivate(){if(!this._active)return;this.plugin.pointerLens&&(this.plugin.pointerLens.visible=!1),this.reset();const e=this.plugin.viewer.scene.canvas.canvas;e.removeEventListener("touchstart",this._onCanvasTouchStart),e.removeEventListener("touchend",this._onCanvasTouchEnd),this._active=!1,this.plugin.viewer.cameraControl.active=!0}reset(){this._active&&this._currentDistanceMeasurement&&(this.distanceMeasurementsPlugin.fire("measurementCancel",this._currentDistanceMeasurement),this._currentDistanceMeasurement.destroy(),this._currentDistanceMeasurement=null)}get currentMeasurement(){return this._currentDistanceMeasurement}destroy(){this.deactivate(),super.destroy()}},exports.Dot3D=Ip,exports.DotBIMDefaultDataSource=cv,exports.DotBIMLoaderPlugin=class extends Wr{constructor(e,t={}){super("DotBIMLoader",e,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults}set dataSource(e){this._dataSource=e||new cv}get dataSource(){return this._dataSource}set objectDefaults(e){this._objectDefaults=e||kB}get objectDefaults(){return this._objectDefaults}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new br(this.viewer.scene,_.apply(e,{isModel:!0,backfaces:e.backfaces,dtxEnabled:e.dtxEnabled,rotation:e.rotation,origin:e.origin})),s=t.id;if(!e.src&&!e.dotBIM)return this.error("load() param expected: src or dotBIM"),t;const i=e.objectDefaults||this._objectDefaults||kB;let r,n;if(e.includeTypes){r={};for(let t=0,s=e.includeTypes.length;t<s;t++)r[e.includeTypes[t]]=!0}if(e.excludeTypes){n={},r||(r={});for(let t=0,s=e.excludeTypes.length;t<s;t++)r[e.excludeTypes[t]]=!0}const A=e=>{const t=e.fileData,A=e.sceneModel,o={},a=h.createUUID(),l=h.createUUID(),c=h.createUUID(),u=h.createUUID(),d={metaObjects:[{id:a,name:"Project",type:"Project",parent:null},{id:l,name:"Site",type:"Site",parent:a},{id:c,name:"Building",type:"Building",parent:l},{id:u,name:"BuildingStorey",type:"BuildingStorey",parent:c}],propertySets:[]},p=(e,s)=>{if(o[e])return;const i=t.meshes.find((e=>e.mesh_id===s.mesh_id));A.createGeometry({id:e,primitive:"triangles",positions:i.coordinates,indices:i.indices}),o[e]=!0},f=t.elements;for(let e=0,s=f.length;e<s;e++){const s=f[e],o=s.type;if(n&&n[o])continue;if(r&&!r[o])continue;const a=s.info,l=void 0!==s.guid?`${s.guid}`:void 0!==a&&void 0!==a.id?a.id:e,c=s.mesh_id,h=s.vector,g=s.rotation,m=i?i[o]||i.DEFAULT:null;let _=!0,b=!0;if(void 0===s.face_colors){p(c,s);const e=`${l}-mesh-${c}`;let t=s.color?[s.color.r/255,s.color.g/255,s.color.b/255]:[1,1,1],i=s.color?s.color.a/255:1;m&&(!1===m.visible&&(_=!1),!1===m.pickable&&(b=!1),m.colorize&&(t=m.colorize),void 0!==m.opacity&&null!==m.opacity&&(i=m.opacity)),A.createMesh({id:e,geometryId:c,color:t,opacity:i,quaternion:!g||0===g.qz&&0===g.qy&&0===g.qx&&1===g.qw?void 0:[g.qx,g.qy,g.qz,g.qw],position:h?[h.x,h.y,h.z]:void 0}),A.createEntity({id:l,meshIds:[e],visible:_,pickable:b,isObject:!0})}else{let e=s.face_colors,i={},r=0,n=t.meshes.find((e=>e.mesh_id===s.mesh_id));for(let t=0,s=e.length;t<s;t+=4){let s=[e[t],e[t+1],e[t+2],e[t+3]];void 0===i[s]&&(i[s]=[]);let A=n.indices[r],o=n.coordinates[3*A],a=n.coordinates[3*A+1],l=n.coordinates[3*A+2],c=n.indices[r+1],h=n.coordinates[3*c],u=n.coordinates[3*c+1],d=n.coordinates[3*c+2],p=n.indices[r+2],f=n.coordinates[3*p],g=n.coordinates[3*p+1],m=n.coordinates[3*p+2];i[s].push(o,a,l,h,u,d,f,g,m),r+=3}let o=[];for(const[e,t]of Object.entries(i)){A.createGeometry({id:`${c}-${e}`,primitive:"triangles",positions:t,indices:[...Array(t.length/3).keys()]});const s=`${l}-mesh-${c}-${e}`,i=e.split(",").map(Number);let r=[i[0]/255,i[1]/255,i[2]/255],n=i[3]/255;m&&(!1===m.visible&&(_=!1),!1===m.pickable&&(b=!1),m.colorize&&(r=m.colorize),void 0!==m.opacity&&null!==m.opacity&&(n=m.opacity)),A.createMesh({id:s,geometryId:`${c}-${e}`,color:r,opacity:n,quaternion:!g||0===g.qz&&0===g.qy&&0===g.qx&&1===g.qw?void 0:[g.qx,g.qy,g.qz,g.qw],position:h?[h.x,h.y,h.z]:void 0}),o.push(s)}A.createEntity({id:l,meshIds:o,visible:_,pickable:b,isObject:!0})}let B=[];for(let e in a)B.push({name:e,value:a[e]});d.propertySets.push({id:l,name:"Properties",properties:B}),d.metaObjects.push({id:l,name:a&&a.Name&&"None"!==a.Name?a.Name:`${s.type} ${l}`,type:s.type,parent:u,propertySetIds:[l]})}A.finalize(),this.viewer.metaScene.createMetaModel(s,d),A.scene.once("tick",(()=>{A.destroyed||(A.scene.fire("modelLoaded",A.id),A.fire("loaded",!0,!1))}))};if(e.src){const s=e.src;this.viewer.scene.canvas.spinner.processes++,this._dataSource.getDotBIM(s,(e=>{A({fileData:e,sceneModel:t,nextId:0,error:function(e){}}),this.viewer.scene.canvas.spinner.processes--}),(e=>{this.viewer.scene.canvas.spinner.processes--,this.error(e)}))}else if(e.dotBIM){const s={fileData:e.dotBIM,sceneModel:t,nextId:0,error:function(e){}};A(s)}return t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),t}destroy(){super.destroy()}},exports.EdgeMaterial=jt,exports.EmphasisMaterial=Nt,exports.FaceAlignedSectionPlanesPlugin=class extends Wr{constructor(e,t={}){if(super("FaceAlignedSectionPlanesPlugin",e),this._freeControls=[],this._sectionPlanes=e.scene.sectionPlanes,this._controls={},this._shownControlId=null,this._dragSensitivity=t.dragSensitivity||1,null!==t.overviewCanvasId&&void 0!==t.overviewCanvasId){const e=document.getElementById(t.overviewCanvasId);e?this._overview=new oy(this,{overviewCanvas:e,visible:t.overviewVisible,onHoverEnterPlane:e=>{this._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:e=>{this._overview.setPlaneHighlighted(e,!1)},onClickedPlane:e=>{if(this.getShownControl()===e)return void this.hideControl();this.showControl(e);const t=this.sectionPlanes[e].pos;ay.set(this.viewer.scene.aabb),h.getAABB3Center(ay,ly),ay[0]+=t[0]-ly[0],ay[1]+=t[1]-ly[1],ay[2]+=t[2]-ly[2],ay[3]+=t[0]-ly[0],ay[4]+=t[1]-ly[1],ay[5]+=t[2]-ly[2],this.viewer.cameraFlight.flyTo({aabb:ay,fitFOV:65})},onClickedNothing:()=>{this.hideControl()}}):this.warn("Can't find overview canvas: '"+t.overviewCanvasId+"' - will create plugin without overview")}null===t.controlElementId||void 0===t.controlElementId?this.error("Parameter expected: controlElementId"):(this._controlElement=document.getElementById(t.controlElementId),this._controlElement||this.warn("Can't find control element: '"+t.controlElementId+"' - will create plugin without control element")),this._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(e=>{this._sectionPlaneCreated(e)}))}setDragSensitivity(e){this._dragSensitivity=e||1}getDragSensitivity(){return this._dragSensitivity}setOverviewVisible(e){this._overview&&this._overview.setVisible(e)}getOverviewVisible(){if(this._overview)return this._overview.getVisible()}get sectionPlanes(){return this._sectionPlanes}createSectionPlane(e={}){void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);return new Nr(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0})}_sectionPlaneCreated(e){const t=this._freeControls.length>0?this._freeControls.pop():new ny(this);t._setSectionPlane(e),t.setVisible(!1),this._controls[e.id]=t,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(()=>{this._sectionPlaneDestroyed(e)}))}flipSectionPlanes(){const e=this.viewer.scene.sectionPlanes;for(let t in e){e[t].flipDir()}}showControl(e){const t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}getShownControl(){return this._shownControlId}hideControl(){for(let e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}destroySectionPlane(e){let t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}_sectionPlaneDestroyed(e){this._overview&&this._overview.removeSectionPlane(e);const t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}clear(){const e=Object.keys(this._sectionPlanes);for(let t=0,s=e.length;t<s;t++)this.destroySectionPlane(e[t])}send(e,t){switch(e){case"snapshotStarting":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!0);break;case"snapshotFinished":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}destroy(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),super.destroy()}_destroyFreeControls(){let e=this._freeControls.pop();for(;e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}},exports.FastNavPlugin=class extends Wr{constructor(e,t={}){super("FastNav",e),this._hideColorTexture=!1!==t.hideColorTexture,this._hidePBR=!1!==t.hidePBR,this._hideSAO=!1!==t.hideSAO,this._hideEdges=!1!==t.hideEdges,this._hideTransparentObjects=!!t.hideTransparentObjects,this._scaleCanvasResolution=!!t.scaleCanvasResolution,this._defaultScaleCanvasResolutionFactor=t.defaultScaleCanvasResolutionFactor,this._scaleCanvasResolutionFactor=t.scaleCanvasResolutionFactor||.6,this._delayBeforeRestore=!1!==t.delayBeforeRestore,this._delayBeforeRestoreSeconds=t.delayBeforeRestoreSeconds||.5,this._onMoved=t.onMoved,this._onStopped=null;let s=1e3*this._delayBeforeRestoreSeconds,i=!1;const r=()=>{e.scene.canvas.resolutionScale=this._defaultScaleCanvasResolutionFactor||this._originalCanvasResolutionScale||1,e.scene._renderer.setEdgesEnabled(!0),e.scene._renderer.setColorTextureEnabled(!0),e.scene._renderer.setPBREnabled(!0),e.scene._renderer.setSAOEnabled(!0),e.scene._renderer.setTransparentEnabled(!0),this._onStopped&&this._onStopped(),i=!1};this._onCameraMatrix=e.scene.camera.on("matrix",(()=>{s=1e3*this._delayBeforeRestoreSeconds,i||(e.scene._renderer.setColorTextureEnabled(!this._hideColorTexture),e.scene._renderer.setPBREnabled(!this._hidePBR),e.scene._renderer.setSAOEnabled(!this._hideSAO),e.scene._renderer.setTransparentEnabled(!this._hideTransparentObjects),e.scene._renderer.setEdgesEnabled(!this._hideEdges),this._originalCanvasResolutionScale=e.scene.canvas.resolutionScale,this._scaleCanvasResolution?e.scene.canvas.resolutionScale=this._scaleCanvasResolutionFactor:e.scene.canvas.resolutionScale=this._defaultScaleCanvasResolutionFactor,this._onMoved&&(this._onStopped=this._onMoved()),i=!0)})),this._onSceneTick=e.scene.on("tick",(e=>{i&&(s-=e.deltaTime,(!this._delayBeforeRestore||s<=0)&&r())}))}get hideColorTexture(){return this._hideColorTexture}set hideColorTexture(e){this._hideColorTexture=e}get hidePBR(){return this._hidePBR}set hidePBR(e){this._hidePBR=e}get hideSAO(){return this._hideSAO}set hideSAO(e){this._hideSAO=e}get hideEdges(){return this._hideEdges}set hideEdges(e){this._hideEdges=e}get hideTransparentObjects(){return this._hideTransparentObjects}set hideTransparentObjects(e){this._hideTransparentObjects=!1!==e}get scaleCanvasResolution(){return this._scaleCanvasResolution}set scaleCanvasResolution(e){this._scaleCanvasResolution=e}get defaultScaleCanvasResolutionFactor(){return this._defaultScaleCanvasResolutionFactor}set defaultScaleCanvasResolutionFactor(e){this._defaultScaleCanvasResolutionFactor=e}get scaleCanvasResolutionFactor(){return this._scaleCanvasResolutionFactor}set scaleCanvasResolutionFactor(e){this._scaleCanvasResolutionFactor=e||.6}get delayBeforeRestore(){return this._delayBeforeRestore}set delayBeforeRestore(e){this._delayBeforeRestore=e}get delayBeforeRestoreSeconds(){return this._delayBeforeRestoreSeconds}set delayBeforeRestoreSeconds(e){this._delayBeforeRestoreSeconds=null!=e?e:.5}send(e,t){}destroy(){this.viewer.scene.camera.off(this._onCameraMatrix),this.viewer.scene.canvas.off(this._onCanvasBoundary),this.viewer.scene.input.off(this._onSceneMouseDown),this.viewer.scene.input.off(this._onSceneMouseUp),this.viewer.scene.input.off(this._onSceneMouseMove),this.viewer.scene.off(this._onSceneTick),super.destroy()}},exports.FloatType=1015,exports.Fresnel=class extends T{get type(){return"Fresnel"}constructor(e,t={}){super(e,t),this._state=new se({edgeColor:h.vec3([0,0,0]),centerColor:h.vec3([1,1,1]),edgeBias:0,centerBias:1,power:1}),this.edgeColor=t.edgeColor,this.centerColor=t.centerColor,this.edgeBias=t.edgeBias,this.centerBias=t.centerBias,this.power=t.power}set edgeColor(e){this._state.edgeColor.set(e||[0,0,0]),this.glRedraw()}get edgeColor(){return this._state.edgeColor}set centerColor(e){this._state.centerColor.set(e||[1,1,1]),this.glRedraw()}get centerColor(){return this._state.centerColor}set edgeBias(e){this._state.edgeBias=e||0,this.glRedraw()}get edgeBias(){return this._state.edgeBias}set centerBias(e){this._state.centerBias=null!=e?e:1,this.glRedraw()}get centerBias(){return this._state.centerBias}set power(e){this._state.power=null!=e?e:1,this.glRedraw()}get power(){return this._state.power}destroy(){super.destroy(),this._state.destroy()}},exports.Frustum=Q,exports.FrustumPlane=k,exports.GIFMediaType=1e4,exports.GLTFDefaultDataSource=pf,exports.GLTFLoaderPlugin=QB,exports.HalfFloatType=1016,exports.ImagePlane=class extends T{constructor(e,t={}){super(e,t),this._src=null,this._image=null,this._pos=h.vec3(),this._origin=h.vec3(),this._rtcPos=h.vec3(),this._dir=h.vec3(),this._size=1,this._imageSize=h.vec2(),this._texture=new Ut(this),this._plane=new dt(this,{geometry:new pe(this,ve({center:[0,0,0],xSize:1,zSize:1,xSegments:10,zSegments:10})),material:new bt(this,{diffuse:[0,0,0],ambient:[0,0,0],specular:[0,0,0],diffuseMap:this._texture,emissiveMap:this._texture,backfaces:!0}),clippable:t.clippable}),this._grid=new dt(this,{geometry:new pe(this,we({size:1,divisions:10})),material:new bt(this,{diffuse:[0,0,0],ambient:[0,0,0],emissive:[.2,.8,.2]}),position:[0,.001,0],clippable:t.clippable}),this._node=new Ve(this,{rotation:[0,0,0],position:[0,0,0],scale:[1,1,1],clippable:!1,children:[this._plane,this._grid]}),this._gridVisible=!1,this.visible=!0,this.gridVisible=t.gridVisible,this.position=t.position,this.rotation=t.rotation,this.dir=t.dir,this.size=t.size,this.collidable=t.collidable,this.clippable=t.clippable,this.pickable=t.pickable,this.opacity=t.opacity,t.image?this.image=t.image:this.src=t.src}set visible(e){this._plane.visible=e,this._grid.visible=this._gridVisible&&e}get visible(){return this._plane.visible}set gridVisible(e){e=!1!==e,this._gridVisible=e,this._grid.visible=this._gridVisible&&this.visible}get gridVisible(){return this._gridVisible}set image(e){this._image=e,this._image&&(this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(e){if(this._src=e,this._src){this._image=null;const e=new Image;e.onload=()=>{this._texture.image=e,this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage()},e.src=this._src}}get src(){return this._src}set position(e){this._pos.set(e||[0,0,0]),Ne(this._pos,this._origin,this._rtcPos),this._node.origin=this._origin,this._node.position=this._rtcPos}get position(){return this._pos}set rotation(e){this._node.rotation=e}get rotation(){return this._node.rotation}set size(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set dir(e){if(this._dir.set(e||[0,0,-1]),e){const t=this.scene.center,s=[-this._dir[0],-this._dir[1],-this._dir[2]];h.subVec3(t,this.position,It);const i=-h.dotVec3(s,It);h.normalizeVec3(s),h.mulVec3Scalar(s,i,Tt),h.vec3PairToQuaternion(Pt,e,St),this._node.quaternion=St}}get dir(){return this._dir}set collidable(e){this._node.collidable=!1!==e}get collidable(){return this._node.collidable}set clippable(e){this._node.clippable=!1!==e}get clippable(){return this._node.clippable}set pickable(e){this._node.pickable=!1!==e}get pickable(){return this._node.pickable}set opacity(e){this._node.opacity=e}get opacity(){return this._node.opacity}destroy(){super.destroy()}_updatePlaneSizeFromImage(){const e=this._size,t=this._imageSize[0],s=this._imageSize[1];if(t>s){const i=s/t;this._node.scale=[e,1,e*i]}else{const i=t/s;this._node.scale=[e*i,1,e]}}},exports.IntType=1013,exports.JPEGMediaType=10001,exports.KTX2TextureTranscoder=Ni,exports.LASLoaderPlugin=class extends Wr{constructor(e,t={}){super("lasLoader",e,t),this.dataSource=t.dataSource,this.skip=t.skip,this.fp64=t.fp64,this.colorDepth=t.colorDepth,this.center=t.center,this.rotate=t.rotate,this.rotateX=t.rotateX,this.transform=t.transform}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new Vw}get skip(){return this._skip}set skip(e){this._skip=e||1}get fp64(){return this._fp64}set fp64(e){this._fp64=!!e}get colorDepth(){return this._colorDepth}set colorDepth(e){this._colorDepth=e||"auto"}get center(){return this._center}set center(e){this._center=!!e}get transform(){return this._transform}set transform(e){this._transform=e}get rotate(){return this._rotate}set rotate(e){this._rotate=e}get rotateX(){return this._rotateX}set rotateX(e){this._rotateX=e}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new br(this.viewer.scene,_.apply(e,{maxGeometryBatchSize:5e5,isModel:!0}));if(!(e.src||e.las||e.manifest||e.manifestSrc))return this.error("load() param expected: src or las"),t;const s={las:{skip:this._skip,fp64:this._fp64,colorDepth:this._colorDepth}},i=this.viewer.scene.canvas.spinner,r=()=>{t.scene.once("tick",(()=>{t.destroyed||(t.scene.fire("modelLoaded",t.id),t.fire("loaded",!0,!1))})),i.processes--},n=e=>{i.processes--,this.error(e),t.fire("error",e)};if(e.src)this._loadModel(e.src,e,s,t);else if(e.las)i.processes++,this._parseModel(e.las,e,s,t).then(r,n);else if(e.manifest||e.manifestSrc){const i=e.manifestSrc?function(e){e.indexOf("?")>-1&&(e=e.split("?")[0]);const t=e.split("/");return t.pop(),t.join("/")+"/"}(e.manifestSrc):"",A=A=>{let o=0;const a=new Array(A.length),l=()=>{if(t.destroyed)r();else{if(o>=A.length)return;a[o]=!1,this._dataSource.getLAS(`${i}${A[o]}`,(i=>{const n=_.apply(e,{isManifest:!0,index:o});this._parseModel(i,n,s,t).then((()=>{a[n.index]=!0;let e=!0;a.forEach((t=>{t||(e=!1)})),e&&r()})),o++,this.scheduleTask(l,200)}),n)}};l()},o=e=>{if(t.destroyed)return;const s=e.lasFiles||e.lazFiles;!s||s.length<=0?this.error("load(): Failed to load model manifest - manifest not valid"):A(s)};if(e.manifestSrc)this._dataSource.getManifest(e.manifestSrc,(e=>{o(e)}),(e=>{this.error(e),t.fire("error",e)}));else{const t=e.manifest;o(t)}}return t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getLAS(t.src,(e=>{this._parseModel(e,t,s,i).then((()=>{i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))})),r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){const r=e=>{const t=e.value;if(this._center){const e=h.vec3(),s=t.length;for(let s=0,i=t.length;s<i;s+=3)e[0]+=t[s+0],e[1]+=t[s+1],e[2]+=t[s+2];e[0]/=s,e[1]/=s,e[2]/=s;for(let s=0,i=t.length;s<i;s+=3)t[s+0]-=e[0],t[s+1]-=e[1],t[s+2]-=e[2]}if(this._rotateX&&t)for(let e=0,s=t.length;e<s;e+=3){const s=t[e+1];t[e+1]=t[e+2],t[e+2]=s}if(this._rotate){const e=h.identityQuaternion(),s=h.mat4();h.eulerToQuaternion(this._rotate,"XYZ",e),h.quaternionToRotationMat4(e,s);const i=h.vec3();for(let e=0,r=t.length;e<r;e+=3)i[0]=t[e+0],i[1]=t[e+1],i[2]=t[e+2],h.transformPoint3(s,i,i),t[e+0]=i[0],t[e+1]=i[1],t[e+2]=i[2]}if(this._transform){const e=h.mat4(this._transform),s=h.vec3();for(let i=0,r=t.length;i<r;i+=3)s[0]=t[i+0],s[1]=t[i+1],s[2]=t[i+2],h.transformPoint3(e,s,s),t[i+0]=s[0],t[i+1]=s[1],t[i+2]=s[2]}return t};function n(e,t){const s=e.value,i=e.size,r=t.value,n=4*r.length,A=new Uint8Array(n);for(let e=0,t=0,n=0,o=r.length;e<o;e++,n+=i,t+=4)A[t+0]=s[n+0],A[t+1]=s[n+1],A[t+2]=s[n+2],A[t+3]=Math.round(r[e]/65536*255);return A}function A(e){const t=e.value,s=4*t.length,i=new Uint8Array(s);for(let e=0,s=0,r=t.length;e<r;e++,s+=4)i[s+0]=0,i[s+1]=0,i[s+2]=0,i[s+3]=Math.round(t[e]/65536*255);return i}return new Promise(((o,a)=>{if(i.destroyed)return void a();const l=t.stats||{};l.sourceFormat="LAS",l.schemaVersion="",l.title="",l.author="",l.created="",l.numMetaObjects=0,l.numPropertySets=0,l.numObjects=0,l.numGeometries=0,l.numTriangles=0,l.numVertices=0;try{const l=tv(e);cm(e,$w,s).then((e=>{const c=e.attributes,u=e.loaderData,d=void 0!==u.pointsFormatId?u.pointsFormatId:-1;if(!c.POSITION)return i.finalize(),void a("No positions found in file");let p,f;switch(d){case 0:p=r(c.POSITION),f=A(c.intensity);break;case 1:if(!c.intensity)return i.finalize(),void a("No positions found in file");p=r(c.POSITION),f=A(c.intensity);break;case 2:case 3:if(!c.intensity)return i.finalize(),void a("No positions found in file");p=r(c.POSITION),f=n(c.COLOR_0,c.intensity)}const g=rv(p,15e5),m=rv(f,2e6),_=[];for(let e=0,s=g.length;e<s;e++){const s=`${t.isManifest?"model"+t.index:""}pointsMesh${e}`;_.push(s),i.createMesh({id:s,primitive:"points",positions:g[e],colorsCompressed:e<m.length?m[e]:null})}const b=t.entityId||h.createUUID();if(i.createEntity({id:b,meshIds:_,isObject:!0}),i.finalize(),t.metaModelJSON){const e=i.id;this.viewer.metaScene.createMetaModel(e,t.metaModelJSON,s)}else if(!1!==t.loadMetadata){const e=h.createUUID(),t={projectId:"",author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[{id:e,name:"Model",type:"Model"},{id:b,name:"PointCloud (LAS)",type:"PointCloud",parent:e,attributes:l||{}}],propertySets:[]},r=i.id;this.viewer.metaScene.createMetaModel(r,t,s)}o()}))}catch(e){i.finalize(),a(e)}}))}},exports.Label3D=Tp,exports.LambertMaterial=Dt,exports.LightMap=class extends xr{get type(){return"LightMap"}constructor(e,t={}){super(e,t),this.scene._lightMapCreated(this)}destroy(){super.destroy(),this.scene._lightMapDestroyed(this)}},exports.LineSet=Br,exports.LinearEncoding=3e3,exports.LinearFilter=1006,exports.LinearMipMapLinearFilter=1008,exports.LinearMipMapNearestFilter=1007,exports.LinearMipmapLinearFilter=1008,exports.LinearMipmapNearestFilter=1007,exports.Loader=Ri,exports.LoadingManager=ki,exports.LocaleService=H,exports.LuminanceAlphaFormat=1025,exports.LuminanceFormat=1024,exports.Map=e,exports.Marker=Tr,exports.MarqueePicker=V,exports.MarqueePickerMouseControl=class extends T{constructor(e){super(e.marqueePicker,e);const t=e.marqueePicker,s=t.viewer.scene.canvas.canvas;let i,r,n,A,o,a,l,c=!1,h=!1,u=!1;s.addEventListener("mousedown",(e=>{this.getActive()&&0===e.button&&(l=setTimeout((function(){const n=t.viewer.scene.input;n.keyDown[n.KEY_CTRL]||t.clear(),i=e.pageX,r=e.pageY,o=e.offsetX,t.setMarqueeCorner1([i,r]),c=!0,t.viewer.cameraControl.pointerEnabled=!1,t.setMarqueeVisible(!0),s.style.cursor="crosshair"}),400),h=!0)})),s.addEventListener("mouseup",(e=>{if(!this.getActive())return;if(!c&&!u)return;if(0!==e.button)return;clearTimeout(l),n=e.pageX,A=e.pageY;const s=Math.abs(n-i),o=Math.abs(A-r);c=!1,t.viewer.cameraControl.pointerEnabled=!0,u&&(u=!1),(s>3||o>3)&&t.pick()})),document.addEventListener("mouseup",(e=>{this.getActive()&&0===e.button&&(clearTimeout(l),c&&(t.setMarqueeVisible(!1),c=!1,h=!1,u=!0,t.viewer.cameraControl.pointerEnabled=!0))}),!0),s.addEventListener("mousemove",(e=>{this.getActive()&&0===e.button&&h&&(clearTimeout(l),c&&(n=e.pageX,A=e.pageY,a=e.offsetX,t.setMarqueeVisible(!0),t.setMarqueeCorner2([n,A]),t.setPickMode(o<a?V.PICK_MODE_INSIDE:V.PICK_MODE_INTERSECTS)))}))}setActive(e){this._active!==e&&(this._active=e,this.fire("active",this._active))}getActive(){return this._active}destroy(){}},exports.Mesh=dt,exports.MeshSurfaceArea=rs,exports.MeshVolume=Jt,exports.MetallicMaterial=Rt,exports.MirroredRepeatWrapping=1002,exports.ModelMemento=class{constructor(e){if(this.objectsVisible=[],this.objectsEdges=[],this.objectsXrayed=[],this.objectsHighlighted=[],this.objectsSelected=[],this.objectsClippable=[],this.objectsPickable=[],this.objectsColorize=[],this.objectsOpacity=[],this.numObjects=0,e){const t=e.metaScene.scene;this.saveObjects(t,e)}}saveObjects(e,t,s){this.numObjects=0,this._mask=s?_.apply(s,{}):null;const i=!s||s.visible,r=!s||s.edges,n=!s||s.xrayed,A=!s||s.highlighted,o=!s||s.selected,a=!s||s.clippable,l=!s||s.pickable,c=!s||s.colorize,h=!s||s.opacity,u=t.metaObjects,d=e.objects;for(let e=0,t=u.length;e<t;e++){const t=d[u[e].id];if(t){if(i&&(this.objectsVisible[e]=t.visible),r&&(this.objectsEdges[e]=t.edges),n&&(this.objectsXrayed[e]=t.xrayed),A&&(this.objectsHighlighted[e]=t.highlighted),o&&(this.objectsSelected[e]=t.selected),a&&(this.objectsClippable[e]=t.clippable),l&&(this.objectsPickable[e]=t.pickable),c){const s=t.colorize;this.objectsColorize[3*e+0]=s[0],this.objectsColorize[3*e+1]=s[1],this.objectsColorize[3*e+2]=s[2]}h&&(this.objectsOpacity[e]=t.opacity),this.numObjects++}}}restoreObjects(e,t){const s=this._mask,i=!s||s.visible,r=!s||s.edges,n=!s||s.xrayed,A=!s||s.highlighted,o=!s||s.selected,a=!s||s.clippable,l=!s||s.pickable,c=!s||s.colorize,h=!s||s.opacity,u=t.metaObjects,d=e.objects;for(let e=0,t=u.length;e<t;e++){const t=d[u[e].id];t&&(i&&(t.visible=this.objectsVisible[e]),r&&(t.edges=this.objectsEdges[e]),n&&(t.xrayed=this.objectsXrayed[e]),A&&(t.highlighted=this.objectsHighlighted[e]),o&&(t.selected=this.objectsSelected[e]),a&&(t.clippable=this.objectsClippable[e]),l&&(t.pickable=this.objectsPickable[e]),c&&(Sr[0]=this.objectsColorize[3*e+0],Sr[1]=this.objectsColorize[3*e+1],Sr[2]=this.objectsColorize[3*e+2],t.colorize=Sr),h&&(t.opacity=this.objectsOpacity[e]))}}},exports.NavCubePlugin=class extends Wr{constructor(e,t={}){super("NavCube",e,t),e.navCube=this;try{this._navCubeScene=new BA(e,{canvasId:t.canvasId,canvasElement:t.canvasElement,transparent:!0}),this._navCubeCanvas=this._navCubeScene.canvas.canvas,this._navCubeScene.input.keyboardEnabled=!1}catch(e){return void this.error(e)}const s=this._navCubeScene;s.clearLights(),new Cr(s,{dir:[.4,-.4,.8],color:[.8,1,1],intensity:1,space:"view"}),new Cr(s,{dir:[-.8,-.3,-.4],color:[.8,.8,.8],intensity:1,space:"view"}),new Cr(s,{dir:[.8,-.6,-.8],color:[1,1,1],intensity:1,space:"view"}),this._navCubeCamera=s.camera,this._navCubeCamera.ortho.scale=7,this._navCubeCamera.ortho.near=.1,this._navCubeCamera.ortho.far=2e3,s.edgeMaterial.edgeColor=[.2,.2,.2],s.edgeMaterial.edgeAlpha=.6,this._zUp=Boolean(e.camera.zUp);var i=this;this.setIsProjectNorth(t.isProjectNorth),this.setProjectNorthOffsetAngle(t.projectNorthOffsetAngle);const r=function(){const e=h.mat4();return function(t,s,r){return h.identityMat4(e),h.rotationMat4v(t*i._projectNorthOffsetAngle*h.DEGTORAD,[0,1,0],e),h.transformVec3(e,s,r)}}();this._synchCamera=function(){var t=h.rotationMat4c(-90*h.DEGTORAD,1,0,0),s=h.vec3(),n=h.vec3(),A=h.vec3();return function(){var o=e.camera.eye,a=e.camera.look,l=e.camera.up;s=h.mulVec3Scalar(h.normalizeVec3(h.subVec3(o,a,s)),5),i._isProjectNorth&&i._projectNorthOffsetAngle&&(s=r(-1,s,OB),l=r(-1,l,VB)),i._zUp?(h.transformVec3(t,s,n),h.transformVec3(t,l,A),i._navCubeCamera.look=[0,0,0],i._navCubeCamera.eye=h.transformVec3(t,s,n),i._navCubeCamera.up=h.transformPoint3(t,l,A)):(i._navCubeCamera.look=[0,0,0],i._navCubeCamera.eye=s,i._navCubeCamera.up=l)}}(),this._cubeTextureCanvas=new RB(e,s,t),this._cubeSampler=new Ut(s,{image:this._cubeTextureCanvas.getImage(),flipY:!0,wrapS:1001,wrapT:1001}),this._cubeMesh=new dt(s,{geometry:new pe(s,{primitive:"triangles",normals:[0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1],positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),material:new bt(s,{diffuse:[.4,.4,.4],specular:[.4,.4,.4],emissive:[.6,.6,.6],diffuseMap:this._cubeSampler,emissiveMap:this._cubeSampler}),visible:!0,edges:!0}),this._shadow=!1===t.shadowVisible?null:new dt(s,{geometry:new pe(s,ye({center:[0,0,0],radiusTop:.001,radiusBottom:1.4,height:.01,radialSegments:20,heightSegments:1,openEnded:!0})),material:new bt(s,{diffuse:[0,0,0],specular:[0,0,0],emissive:[0,0,0],alpha:.5}),position:[0,-1.5,0],visible:!0,pickable:!1,backfaces:!1}),this._onCameraMatrix=e.camera.on("matrix",this._synchCamera),this._onCameraWorldAxis=e.camera.on("worldAxis",(()=>{e.camera.zUp?(this._zUp=!0,this._cubeTextureCanvas.setZUp(),this._repaint(),this._synchCamera()):e.camera.yUp&&(this._zUp=!1,this._cubeTextureCanvas.setYUp(),this._repaint(),this._synchCamera())})),this._onCameraFOV=e.camera.perspective.on("fov",(e=>{this._synchProjection&&(this._navCubeCamera.perspective.fov=e)})),this._onCameraProjection=e.camera.on("projection",(e=>{this._synchProjection&&(this._navCubeCamera.projection="ortho"===e||"perspective"===e?e:"perspective")}));var n=-1;function A(t,s){var i=(t-a)*-f,r=(s-l)*-f;e.camera.orbitYaw(i),e.camera.orbitPitch(-r),a=t,l=s}function o(e){const{left:t,top:s}=i._navCubeCanvas.getBoundingClientRect();return[e.clientX-t,e.clientY-s]}var a,l,c=null,u=null,d=!1,p=!1,f=.5;i._navCubeCanvas.addEventListener("mouseenter",i._onMouseEnter=function(e){p=!0}),i._navCubeCanvas.addEventListener("mouseleave",i._onMouseLeave=function(e){p=!1}),i._navCubeCanvas.addEventListener("mousedown",i._onMouseDown=function(e){if(1===e.which){c=e.x,u=e.y,a=e.clientX,l=e.clientY;var t=o({clientX:e.clientX,clientY:e.clientY}),i=s.pick({canvasPos:t});d=!!i}}),i._navCubeCanvas.addEventListener("mouseup",i._onMouseUp=function(e){if(1===e.which&&(d=!1,null!==c)){var t=o({clientX:e.clientX,clientY:e.clientY}),A=s.pick({canvasPos:t,pickSurface:!0});if(A&&A.uv){var a=i._cubeTextureCanvas.getArea(A.uv);if(a>=0&&(i._navCubeCanvas.style.cursor="pointer",n>=0&&(i._cubeTextureCanvas.setAreaHighlighted(n,!1),i._repaint(),n=-1),a>=0)){if(i._cubeTextureCanvas.setAreaHighlighted(a,!0),n=a,i._repaint(),e.x<c-3||e.x>c+3||e.y<u-3||e.y>u+3)return;var l=i._cubeTextureCanvas.getAreaDir(a);if(l){var h=i._cubeTextureCanvas.getAreaUp(a);i._isProjectNorth&&i._projectNorthOffsetAngle&&(l=r(1,l,OB),h=r(1,h,VB)),g(l,h,(function(){n>=0&&(i._cubeTextureCanvas.setAreaHighlighted(n,!1),i._repaint(),n=-1),i._navCubeCanvas.style.cursor="pointer",n>=0&&(i._cubeTextureCanvas.setAreaHighlighted(n,!1),i._repaint(),n=-1),a>=0&&(i._cubeTextureCanvas.setAreaHighlighted(a,!1),n=-1,i._repaint())}))}}}}}),i._navCubeCanvas.addEventListener("mousemove",i._onMouseMove=function(e){if(n>=0&&(i._cubeTextureCanvas.setAreaHighlighted(n,!1),i._repaint(),n=-1),1!==e.buttons||d){if(d){var t=e.clientX,r=e.clientY;return i._navCubeCanvas.style.cursor="move",void A(t,r)}if(p){var a=o({clientX:e.clientX,clientY:e.clientY}),l=s.pick({canvasPos:a,pickSurface:!0});if(l){if(l.uv){i._navCubeCanvas.style.cursor="pointer";var c=i._cubeTextureCanvas.getArea(l.uv);if(c===n)return;n>=0&&i._cubeTextureCanvas.setAreaHighlighted(n,!1),c>=0&&(i._cubeTextureCanvas.setAreaHighlighted(c,!0),i._repaint(),n=c)}}else i._navCubeCanvas.style.cursor="default",n>=0&&(i._cubeTextureCanvas.setAreaHighlighted(n,!1),i._repaint(),n=-1)}}}),i._navCubeCanvas.addEventListener("touchstart",i._onTouchStart=function(e){if(e.touches.length>0){c=e.touches[0].clientX,u=e.touches[0].clientY,a=e.touches[0].clientX,l=e.touches[0].clientY;var t=o({clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}),i=s.pick({canvasPos:t});d=!!i}},{passive:!1}),i._navCubeCanvas.addEventListener("touchmove",i._onTouchMove=function(e){e.preventDefault();var t=e.touches[0],s=t.clientX,r=t.clientY,n=document.elementFromPoint(s,r);(p=i._navCubeCanvas===n)&&d&&A(s,r)},{passive:!1}),i._navCubeCanvas.addEventListener("touchend",i._onTouchEnd=function(e){d=!1});var g=function(){var t=h.vec3();return function(s,r,n){var A=i._fitVisible?e.scene.getAABB(e.scene.visibleObjectIds):e.scene.aabb,o=h.getAABB3Diag(A);h.getAABB3Center(A,t);var a=Math.abs(o/Math.tan(i._cameraFitFOV*h.DEGTORAD));e.cameraControl.pivotPos=t,i._cameraFly?e.cameraFlight.flyTo({look:t,eye:[t[0]-a*s[0],t[1]-a*s[1],t[2]-a*s[2]],up:r||[0,1,0],orthoScale:1.1*o,fitFOV:i._cameraFitFOV,duration:i._cameraFlyDuration},n):e.cameraFlight.jumpTo({look:t,eye:[t[0]-a*s[0],t[1]-a*s[1],t[2]-a*s[2]],up:r||[0,1,0],orthoScale:1.1*o,fitFOV:i._cameraFitFOV},n)}}();this._onUpdated=e.localeService.on("updated",(()=>{this._cubeTextureCanvas.clear(),this._repaint()})),this.setVisible(t.visible),this.setCameraFitFOV(t.cameraFitFOV),this.setCameraFly(t.cameraFly),this.setCameraFlyDuration(t.cameraFlyDuration),this.setFitVisible(t.fitVisible),this.setSynchProjection(t.synchProjection)}send(e,t){if("language"===e)this._cubeTextureCanvas.clear(),this._repaint()}_repaint(){const e=this._cubeTextureCanvas.getImage();this._cubeMesh.material.diffuseMap.image=e,this._cubeMesh.material.emissiveMap.image=e}setVisible(e=!0){this._navCubeCanvas&&(this._cubeMesh.visible=e,this._shadow&&(this._shadow.visible=e),this._navCubeCanvas.style.visibility=e?"visible":"hidden")}getVisible(){return!!this._navCubeCanvas&&this._cubeMesh.visible}setFitVisible(e=!1){this._fitVisible=e}getFitVisible(){return this._fitVisible}setCameraFly(e=!0){this._cameraFly=e}getCameraFly(){return this._cameraFly}setCameraFitFOV(e=45){this._cameraFitFOV=e}getCameraFitFOV(){return this._cameraFitFOV}setCameraFlyDuration(e=.5){this._cameraFlyDuration=e}getCameraFlyDuration(){return this._cameraFlyDuration}setSynchProjection(e=!1){this._synchProjection=e}getSynchProjection(){return this._synchProjection}setIsProjectNorth(e=!1){this._isProjectNorth=e}getIsProjectNorth(){return this._isProjectNorth}setProjectNorthOffsetAngle(e){this._projectNorthOffsetAngle=e}getProjectNorthOffsetAngle(){return this._projectNorthOffsetAngle}destroy(){this._navCubeCanvas&&(this.viewer.localeService.off(this._onUpdated),this.viewer.camera.off(this._onCameraMatrix),this.viewer.camera.off(this._onCameraWorldAxis),this.viewer.camera.perspective.off(this._onCameraFOV),this.viewer.camera.off(this._onCameraProjection),this._navCubeCanvas.removeEventListener("mouseenter",this._onMouseEnter),this._navCubeCanvas.removeEventListener("mouseleave",this._onMouseLeave),this._navCubeCanvas.removeEventListener("mousedown",this._onMouseDown),this._navCubeCanvas.removeEventListener("mousemove",this._onMouseMove),this._navCubeCanvas.removeEventListener("mouseup",this._onMouseUp),this._navCubeCanvas.removeEventListener("touchstart",this._onTouchStart),this._navCubeCanvas.removeEventListener("touchmove",this._onTouchMove),this._navCubeCanvas.removeEventListener("touchend",this._onTouchEnd),this._navCubeCanvas=null,this._cubeTextureCanvas.destroy(),this._cubeTextureCanvas=null,this._onMouseEnter=null,this._onMouseLeave=null,this._onMouseDown=null,this._onMouseMove=null,this._onMouseUp=null,this._onTouchStart=null,this._onTouchMove=null,this._onTouchEnd=null),this._navCubeScene.destroy(),this._navCubeScene=null,this._cubeMesh=null,this._shadow=null,super.destroy()}},exports.NearestFilter=1003,exports.NearestMipMapLinearFilter=1005,exports.NearestMipMapNearestFilter=1004,exports.NearestMipmapLinearFilter=1005,exports.NearestMipmapNearestFilter=1004,exports.Node=Ve,exports.OBJLoaderPlugin=class extends Wr{constructor(e,t){super("OBJLoader",e,t),this._sceneGraphLoader=new HB}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);var t=new Ve(this.viewer.scene,_.apply(e,{isModel:!0}));const s=t.id,i=e.src;if(!i)return this.error("load() param expected: src"),t;if(e.metaModelSrc){const r=e.metaModelSrc;_.loadJSON(r,(r=>{this.viewer.metaScene.createMetaModel(s,r),this._sceneGraphLoader.load(t,i,e)}),(e=>{this.error(`load(): Failed to load model modelMetadata for model '${s} from  '${r}' - ${e}`)}))}else this._sceneGraphLoader.load(t,i,e);return t.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(s)})),t}destroy(){super.destroy()}},exports.ObjectsKdTree3=class{constructor(e){if(!e)throw"Parameter expected: cfg";if(!e.viewer)throw"Parameter expected: cfg.viewer";this.viewer=e.viewer,this._maxTreeDepth=e.maxTreeDepth||15,this._root=null,this._needsRebuild=!0,this._onModelLoaded=this.viewer.scene.on("modelLoaded",(e=>{this._needsRebuild=!0})),this._onModelUnloaded=this.viewer.scene.on("modelUnloaded",(e=>{this._needsRebuild=!0}))}get root(){return this._needsRebuild&&this._rebuild(),this._root}_rebuild(){const e=this.viewer.scene;this._root={aabb:e.getAABB()};for(let t in e.objects){const s=e.objects[t];this._insertEntity(this._root,s,1)}this._needsRebuild=!1}_insertEntity(e,t,s){const i=t.aabb;if(s>=this._maxTreeDepth)return e.entities=e.entities||[],void e.entities.push(t);if(e.left&&h.containsAABB3(e.left.aabb,i))return void this._insertEntity(e.left,t,s+1);if(e.right&&h.containsAABB3(e.right.aabb,i))return void this._insertEntity(e.right,t,s+1);const r=e.aabb;u[0]=r[3]-r[0],u[1]=r[4]-r[1],u[2]=r[5]-r[2];let n=0;if(u[1]>u[n]&&(n=1),u[2]>u[n]&&(n=2),!e.left){const A=r.slice();if(A[n+3]=(r[n]+r[n+3])/2,e.left={aabb:A},h.containsAABB3(A,i))return void this._insertEntity(e.left,t,s+1)}if(!e.right){const A=r.slice();if(A[n]=(r[n]+r[n+3])/2,e.right={aabb:A},h.containsAABB3(A,i))return void this._insertEntity(e.right,t,s+1)}e.entities=e.entities||[],e.entities.push(t)}destroy(){const e=this.viewer.scene;e.off(this._onModelLoaded),e.off(this._onModelUnloaded),this._root=null,this._needsRebuild=!0}},exports.ObjectsMemento=kr,exports.PNGMediaType=10002,exports.Path=class extends j{constructor(e,t={}){super(e,t),this._cachedLengths=[],this._dirty=!0,this._curves=[],this._t=0,this._dirtySubs=[],this._destroyedSubs=[],this.curves=t.curves||[],this.t=t.t}addCurve(e){this._curves.push(e),this._dirty=!0}set curves(e){var t,s,i;for(e=e||[],s=0,i=this._curves.length;s<i;s++)(t=this._curves[s]).off(this._dirtySubs[s]),t.off(this._destroyedSubs[s]);this._curves=[],this._dirtySubs=[],this._destroyedSubs=[];var r=this;function n(){r._dirty=!0}function A(){var e=this.id;for(s=0,i=r._curves.length;s<i;s++)if(r._curves[s].id===e)return r._curves=r._curves.slice(s,s+1),r._dirtySubs=r._dirtySubs.slice(s,s+1),r._destroyedSubs=r._destroyedSubs.slice(s,s+1),void(r._dirty=!0)}for(s=0,i=e.length;s<i;s++){if(t=e[s],_.isNumeric(t)||_.isString(t)){var o=t;if(!(t=this.scene.components[o])){this.error("Component not found: "+_inQuotes(o));continue}}var a=t.type;"xeokit.SplineCurve"===a||"xeokit.Path"===a||"xeokit.CubicBezierCurve"===a||"xeokit.QuadraticBezierCurve"===a?(this._curves.push(t),this._dirtySubs.push(t.on("dirty",n)),this._destroyedSubs.push(t.once("destroyed",A))):this.error("Component "+_inQuotes(t.id)+" is not a xeokit.SplineCurve, xeokit.Path or xeokit.QuadraticBezierCurve")}this._dirty=!0}get curves(){return this._curves}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}get length(){var e=this._getCurveLengths();return e[e.length-1]}getPoint(e){for(var t,s=e*this.length,i=this._getCurveLengths(),r=0;r<i.length;){if(i[r]>=s){var n=1-(i[r]-s)/(t=this._curves[r]).length;return t.getPointAt(n)}r++}return null}_getCurveLengths(){if(!this._dirty)return this._cachedLengths;var e,t=[],s=0,i=this._curves.length;for(e=0;e<i;e++)s+=this._curves[e].length,t.push(s);return this._cachedLengths=t,this._dirty=!1,t}_getJSON(){for(var e=[],t=0,s=this._curves.length;t<s;t++)e.push(this._curves[t].id);return{curves:e,t:this._t}}destroy(){var e,t,s;for(super.destroy(),e=0,t=this._curves.length;e<t;e++)(s=this._curves[e]).off(this._dirtySubs[e]),s.off(this._destroyedSubs[e])}},exports.PerformanceModel=class extends br{constructor(e,t={}){super(e,t)}},exports.PhongMaterial=bt,exports.PickResult=Gr,exports.Plugin=Wr,exports.PointLight=class extends yr{get type(){return"PointLight"}constructor(e,t={}){super(e,t);const s=this;this._shadowRenderBuf=null,this._shadowViewMatrix=null,this._shadowProjMatrix=null,this._shadowViewMatrixDirty=!0,this._shadowProjMatrixDirty=!0;const i=this.scene.camera,r=this.scene.canvas;this._onCameraViewMatrix=i.on("viewMatrix",(()=>{this._shadowViewMatrixDirty=!0})),this._onCameraProjMatrix=i.on("projMatrix",(()=>{this._shadowProjMatrixDirty=!0})),this._onCanvasBoundary=r.on("boundary",(()=>{this._shadowProjMatrixDirty=!0})),this._state=new se({type:"point",pos:h.vec3([1,1,1]),color:h.vec3([.7,.7,.8]),intensity:1,attenuation:[0,0,0],space:t.space||"view",castsShadow:!1,getShadowViewMatrix:()=>{if(s._shadowViewMatrixDirty){s._shadowViewMatrix||(s._shadowViewMatrix=h.identityMat4());const e=s._state.pos,t=i.look,r=i.up;h.lookAtMat4v(e,t,r,s._shadowViewMatrix),s._shadowViewMatrixDirty=!1}return s._shadowViewMatrix},getShadowProjMatrix:()=>{if(s._shadowProjMatrixDirty){s._shadowProjMatrix||(s._shadowProjMatrix=h.identityMat4());const e=s.scene.canvas.canvas;h.perspectiveMat4(Math.PI/180*70,e.clientWidth/e.clientHeight,.1,500,s._shadowProjMatrix),s._shadowProjMatrixDirty=!1}return s._shadowProjMatrix},getShadowRenderBuf:()=>(s._shadowRenderBuf||(s._shadowRenderBuf=new vr(s.scene.canvas.gl),s._shadowRenderBuf.setSize([1024,1024])),s._shadowRenderBuf)}),this.pos=t.pos,this.color=t.color,this.intensity=t.intensity,this.constantAttenuation=t.constantAttenuation,this.linearAttenuation=t.linearAttenuation,this.quadraticAttenuation=t.quadraticAttenuation,this.castsShadow=t.castsShadow,this.scene._lightCreated(this)}set pos(e){this._state.pos.set(e||[1,1,1]),this._shadowViewMatrixDirty=!0,this.glRedraw()}get pos(){return this._state.pos}set color(e){this._state.color.set(e||[.7,.7,.8]),this.glRedraw()}get color(){return this._state.color}set intensity(e){e=void 0!==e?e:1,this._state.intensity=e,this.glRedraw()}get intensity(){return this._state.intensity}set constantAttenuation(e){this._state.attenuation[0]=e||0,this.glRedraw()}get constantAttenuation(){return this._state.attenuation[0]}set linearAttenuation(e){this._state.attenuation[1]=e||0,this.glRedraw()}get linearAttenuation(){return this._state.attenuation[1]}set quadraticAttenuation(e){this._state.attenuation[2]=e||0,this.glRedraw()}get quadraticAttenuation(){return this._state.attenuation[2]}set castsShadow(e){e=!!e,this._state.castsShadow!==e&&(this._state.castsShadow=e,this._shadowViewMatrixDirty=!0,this.glRedraw())}get castsShadow(){return this._state.castsShadow}destroy(){const e=this.scene.camera,t=this.scene.canvas;e.off(this._onCameraViewMatrix),e.off(this._onCameraProjMatrix),t.off(this._onCanvasBoundary),super.destroy(),this._state.destroy(),this._shadowRenderBuf&&this._shadowRenderBuf.destroy(),this.scene._lightDestroyed(this),this.glRedraw()}},exports.PointerCircle=L,exports.PointerLens=class{constructor(e,t={}){this.viewer=e,this.scene=this.viewer.scene,this._lensCursorDiv=document.createElement("div"),this._lensParams={canvasSize:300,cursorBorder:2,cursorSize:10},this._lensCursorDiv.style.borderRadius="50%",this._lensCursorDiv.style.width=this._lensParams.cursorSize+"px",this._lensCursorDiv.style.height=this._lensParams.cursorSize+"px",this._lensCursorDiv.style.zIndex="100000",this._lensCursorDiv.style.position="absolute",this._lensCursorDiv.style.pointerEvents="none",this._lensContainer=document.createElement("div"),this._lensContainerId=t.containerId||"xeokit-lens",this._lensContainer.setAttribute("id",this._lensContainerId),this._lensContainer.style.border="1px solid black",this._lensContainer.style.background="white",this._lensContainer.style.borderRadius="50%",this._lensContainer.style.width=this._lensParams.canvasSize+"px",this._lensContainer.style.height=this._lensParams.canvasSize+"px",this._lensContainer.style.zIndex="15000",this._lensContainer.style.position="absolute",this._lensContainer.style.pointerEvents="none",this._lensContainer.style.visibility="hidden",this._lensCanvas=document.createElement("canvas"),this._lensCanvas.id=`${this._lensContainerId}-canvas`,this._lensCanvas.style.borderRadius="50%",this._lensCanvas.style.width=this._lensParams.canvasSize+"px",this._lensCanvas.style.height=this._lensParams.canvasSize+"px",this._lensCanvas.style.zIndex="15000",this._lensCanvas.style.pointerEvents="none",document.body.appendChild(this._lensContainer),this._lensContainer.appendChild(this._lensCanvas),this._lensContainer.appendChild(this._lensCursorDiv),this._lensCanvasContext=this._lensCanvas.getContext("2d"),this._canvasElement=this.viewer.scene.canvas.canvas,this._canvasPos=null,this._snappedCanvasPos=null,this._lensPosToggle=t.lensPosToggle||!0,this._lensPosToggleAmount=t.lensPosToggleAmount||85,this._lensPosMarginLeft=t.lensPosMarginLeft||85,this._lensPosMarginTop=t.lensPosMarginTop||25,this._lensContainer.style.marginTop=`${this._lensPosMarginTop}px`,this._lensContainer.style.marginLeft=`${this._lensPosMarginLeft}px`,this._zoomLevel=t.zoomLevel||2,this._active=!1!==t.active,this._visible=!1,this.snapped=!1,this._onViewerRendering=this.viewer.scene.on("rendering",(()=>{this._active&&this._visible&&this.update()}))}update(){if(!this._active||!this._visible)return;if(!this._canvasPos)return;const e=this._lensContainer.getBoundingClientRect(),t=this._canvasElement.getBoundingClientRect(),s=this._canvasPos[0]<e.right&&this._canvasPos[0]>e.left&&this._canvasPos[1]<e.bottom&&this._canvasPos[1]>e.top;this._lensContainer.style.marginLeft=`${this._lensPosMarginLeft}px`,s&&(this._lensPosToggle?this._lensContainer.style.marginTop=t.bottom-t.top-this._lensCanvas.height-this._lensPosToggleAmount+"px":this._lensContainer.style.marginTop=`${this._lensPosMarginTop}px`,this._lensPosToggle=!this._lensPosToggle),this._lensCanvasContext.clearRect(0,0,this._lensCanvas.width,this._lensCanvas.height);const i=Math.max(this._lensCanvas.width,this._lensCanvas.height)/this._zoomLevel;this._lensCanvasContext.drawImage(this._canvasElement,this._canvasPos[0]-i/2,this._canvasPos[1]-i/2,i,i,0,0,this._lensCanvas.width,this._lensCanvas.height);const r=this._lensParams.canvasSize/2-this._lensParams.cursorSize/2-this._lensParams.cursorBorder,n=this._snappedCanvasPos?this._snappedCanvasPos[0]-this._canvasPos[0]:0,A=this._snappedCanvasPos?this._snappedCanvasPos[1]-this._canvasPos[1]:0;this._lensCursorDiv.style.left=`${r+n*this._zoomLevel}px`,this._lensCursorDiv.style.top=`${r+A*this._zoomLevel}px`}set zoomFactor(e){this._zoomFactor=e,this.update()}get zoomFactor(){return this._zoomFactor}set canvasPos(e){this._canvasPos=e,this.update()}get canvasPos(){return this._canvasPos}set snappedCanvasPos(e){this._snappedCanvasPos=e,this.update()}get snappedCanvasPos(){return this._snappedCanvasPos}set snapped(e){this._snapped=e;const[t,s]=e?["greenyellow","green"]:["pink","red"];this._lensCursorDiv.style.background=t,this._lensCursorDiv.style.border=this._lensParams.cursorBorder+"px solid "+s}get snapped(){return this._snapped}_updateActiveVisible(){this._lensContainer.style.visibility=this._active&&this._visible?"visible":"hidden",this.update()}set active(e){this._active=e,this._updateActiveVisible()}get active(){return this._active}set visible(e){this._visible=e,this._updateActiveVisible()}get visible(){return this._visible}destroy(){this._destroyed||(this.viewer.scene.off(this._onViewerRendering),this._lensContainer.removeChild(this._lensCanvas),document.body.removeChild(this._lensContainer),this._destroyed=!0)}},exports.QuadraticBezierCurve=class extends j{constructor(e,t={}){super(e,t),this.v0=t.v0,this.v1=t.v1,this.v2=t.v2,this.t=t.t}set v0(e){this._v0=e||h.vec3([0,0,0])}get v0(){return this._v0}set v1(e){this._v1=e||h.vec3([0,0,0])}get v1(){return this._v1}set v2(e){this._v2=e||h.vec3([0,0,0])}get v2(){return this._v2}set t(e){e=e||0,this._t=e<0?0:e>1?1:e}get t(){return this._t}get point(){return this.getPoint(this._t)}getPoint(e){var t=h.vec3();return t[0]=h.b2(e,this._v0[0],this._v1[0],this._v2[0]),t[1]=h.b2(e,this._v0[1],this._v1[1],this._v2[1]),t[2]=h.b2(e,this._v0[2],this._v1[2],this._v2[2]),t}getJSON(){return{v0:this._v0,v1:this._v1,v2:this._v2,t:this._t}}},exports.Queue=d,exports.RGBAFormat=1023,exports.RGBAIntegerFormat=1033,exports.RGBA_ASTC_10x10_Format=37819,exports.RGBA_ASTC_10x5_Format=37816,exports.RGBA_ASTC_10x6_Format=37817,exports.RGBA_ASTC_10x8_Format=37818,exports.RGBA_ASTC_12x10_Format=37820,exports.RGBA_ASTC_12x12_Format=37821,exports.RGBA_ASTC_4x4_Format=37808,exports.RGBA_ASTC_5x4_Format=37809,exports.RGBA_ASTC_5x5_Format=37810,exports.RGBA_ASTC_6x5_Format=37811,exports.RGBA_ASTC_6x6_Format=37812,exports.RGBA_ASTC_8x5_Format=37813,exports.RGBA_ASTC_8x6_Format=37814,exports.RGBA_ASTC_8x8_Format=37815,exports.RGBA_BPTC_Format=36492,exports.RGBA_ETC2_EAC_Format=37496,exports.RGBA_PVRTC_2BPPV1_Format=35843,exports.RGBA_PVRTC_4BPPV1_Format=35842,exports.RGBA_S3TC_DXT1_Format=33777,exports.RGBA_S3TC_DXT3_Format=33778,exports.RGBA_S3TC_DXT5_Format=33779,exports.RGBFormat=1022,exports.RGB_ETC1_Format=36196,exports.RGB_ETC2_Format=37492,exports.RGB_PVRTC_2BPPV1_Format=35841,exports.RGB_PVRTC_4BPPV1_Format=35840,exports.RGB_S3TC_DXT1_Format=33776,exports.RGFormat=1030,exports.RGIntegerFormat=1031,exports.ReadableGeometry=pe,exports.RedFormat=1028,exports.RedIntegerFormat=1029,exports.ReflectionMap=class extends xr{get type(){return"ReflectionMap"}constructor(e,t={}){super(e,t),this.scene._lightsState.addReflectionMap(this._state),this.scene._reflectionMapCreated(this)}destroy(){super.destroy(),this.scene._reflectionMapDestroyed(this)}},exports.RepeatWrapping=1e3,exports.STLDefaultDataSource=cy,exports.STLLoaderPlugin=class extends Wr{constructor(e,t={}){super("STLLoader",e,t),this._sceneGraphLoader=new uy,this.dataSource=t.dataSource}set dataSource(e){this._dataSource=e||new cy}get dataSource(){return this._dataSource}load(e){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Ve(this.viewer.scene,_.apply(e,{isModel:!0})),s=e.src,i=e.stl;return s||i?(s?this._sceneGraphLoader.load(this,t,s,e):this._sceneGraphLoader.parse(this,t,i,e),t):(this.error("load() param expected: either 'src' or 'stl'"),t)}},exports.SceneModel=br,exports.SceneModelMesh=ls,exports.SceneModelTransform=cr,exports.SectionPlane=Nr,exports.SectionPlanesPlugin=class extends Wr{constructor(e,t={}){if(super("SectionPlanes",e),this._freeControls=[],this._sectionPlanes=e.scene.sectionPlanes,this._controls={},this._shownControlId=null,null!==t.overviewCanvasId&&void 0!==t.overviewCanvasId){const e=document.getElementById(t.overviewCanvasId);e?this._overview=new JB(this,{overviewCanvas:e,visible:t.overviewVisible,onHoverEnterPlane:e=>{this._overview.setPlaneHighlighted(e,!0)},onHoverLeavePlane:e=>{this._overview.setPlaneHighlighted(e,!1)},onClickedPlane:e=>{if(this.getShownControl()===e)return void this.hideControl();this.showControl(e);const t=this.sectionPlanes[e].pos;YB.set(this.viewer.scene.aabb),h.getAABB3Center(YB,$B),YB[0]+=t[0]-$B[0],YB[1]+=t[1]-$B[1],YB[2]+=t[2]-$B[2],YB[3]+=t[0]-$B[0],YB[4]+=t[1]-$B[1],YB[5]+=t[2]-$B[2],this.viewer.cameraFlight.flyTo({aabb:YB,fitFOV:65})},onClickedNothing:()=>{this.hideControl()}}):this.warn("Can't find overview canvas: '"+t.overviewCanvasId+"' - will create plugin without overview")}this._onSceneSectionPlaneCreated=e.scene.on("sectionPlaneCreated",(e=>{this._sectionPlaneCreated(e)}))}setOverviewVisible(e){this._overview&&this._overview.setVisible(e)}getOverviewVisible(){if(this._overview)return this._overview.getVisible()}get sectionPlanes(){return this._sectionPlanes}createSectionPlane(e={}){void 0!==e.id&&null!==e.id&&this.viewer.scene.components[e.id]&&(this.error("Viewer component with this ID already exists: "+e.id),delete e.id);return new Nr(this.viewer.scene,{id:e.id,pos:e.pos,dir:e.dir,active:!0})}_sectionPlaneCreated(e){const t=this._freeControls.length>0?this._freeControls.pop():(()=>{const e=this.viewer.scene,t=function(){const t=new Ve(e,{isObject:!1});return t.addChild(new dt(t,{geometry:new pe(t,{primitive:"triangles",positions:[.5,.5,0,.5,-.5,0,-.5,-.5,0,-.5,.5,0,.5,.5,-0,.5,-.5,-0,-.5,-.5,-0,-.5,.5,-0],indices:[0,1,2,2,3,0]}),material:new bt(t,{emissive:[0,0,0],diffuse:[0,0,0],backfaces:!0}),opacity:.6,ghosted:!0,ghostMaterial:new Nt(t,{edges:!1,filled:!0,fillColor:[1,1,0],edgeColor:[0,0,0],fillAlpha:.1,backfaces:!0}),pickable:!1,collidable:!0,clippable:!1,visible:!1,scale:[2.4,2.4,1],isObject:!1})),t.addChild(new dt(t,{geometry:new pe(t,Me({center:[0,0,0],radius:1.7,tube:.02,radialSegments:4,tubeSegments:4,arc:2*Math.PI})),material:new bt(t,{emissive:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],shininess:0}),highlightMaterial:new Nt(t,{edges:!1,edgeColor:[0,0,0],filled:!0,fillColor:[.8,.8,.8],fillAlpha:1}),pickable:!1,collidable:!1,clippable:!1,visible:!1,scale:[1,1,.1],rotation:[0,0,45],isObject:!1})),{setPosition:function(){const e=h.vec3(),s=h.vec3();return function(i){Ne(i,e,s),t.origin=e,t.position=s}}(),setQuaternion:e=>{t.quaternion=e},setScale:e=>{t.scale=e},setVisible:e=>{t.visible=e},destroy:()=>{t.destroy()}}}();let s=()=>{};const i=new KB(this.viewer);let r=!1,n=!1,A=null;const o=()=>{const e=n&&!r;t.setVisible(e),i.setHandlers(e&&A)};return{_destroy:()=>{s(),i.destroy(),t.destroy()},setCulled:e=>{r=e,o()},setVisible:e=>{n=e,o()},_setSectionPlane:e=>{if(s(),e){let r=!1;A={onPosition:s=>{t.setPosition(s),e.pos=s},onQuaternion:s=>{t.setQuaternion(s),r=!0,e.quaternion=s},onScreenScale:e=>{t.setScale(e)}};const n=()=>{t.setPosition(e.pos),i.setPosition(e.pos)},o=()=>{t.setQuaternion(e.quaternion),i.setQuaternion(e.quaternion)};n(),o();const a=e.on("pos",n),l=e.on("dir",(()=>{r?r=!1:o()}));s=()=>{e.off(a),e.off(l),s=()=>{}}}}}})();t._setSectionPlane(e),t.setVisible(!1),this._controls[e.id]=t,this._overview&&this._overview.addSectionPlane(e),e.once("destroyed",(()=>{this._sectionPlaneDestroyed(e)}))}flipSectionPlanes(){const e=this.viewer.scene.sectionPlanes;for(let t in e){e[t].flipDir()}}showControl(e){const t=this._controls[e];t?(this.hideControl(),t.setVisible(!0),this._overview&&this._overview.setPlaneSelected(e,!0),this._shownControlId=e):this.error("Control not found: "+e)}getShownControl(){return this._shownControlId}hideControl(){for(var e in this._controls)this._controls.hasOwnProperty(e)&&(this._controls[e].setVisible(!1),this._overview&&this._overview.setPlaneSelected(e,!1));this._shownControlId=null}destroySectionPlane(e){var t=this.viewer.scene.sectionPlanes[e];t?(this._sectionPlaneDestroyed(t),t.destroy(),e===this._shownControlId&&(this._shownControlId=null)):this.error("SectionPlane not found: "+e)}_sectionPlaneDestroyed(e){this._overview&&this._overview.removeSectionPlane(e);const t=this._controls[e.id];t&&(t.setVisible(!1),t._setSectionPlane(null),delete this._controls[e.id],this._freeControls.push(t))}clear(){const e=Object.keys(this._sectionPlanes);for(var t=0,s=e.length;t<s;t++)this.destroySectionPlane(e[t])}send(e,t){switch(e){case"snapshotStarting":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!0);break;case"snapshotFinished":for(let e in this._controls)this._controls.hasOwnProperty(e)&&this._controls[e].setCulled(!1);break;case"clearSectionPlanes":this.clear()}}destroy(){this.clear(),this._overview&&this._overview.destroy(),this._destroyFreeControls(),super.destroy()}_destroyFreeControls(){for(var e=this._freeControls.pop();e;)e._destroy(),e=this._freeControls.pop();this.viewer.scene.off(this._onSceneSectionPlaneCreated)}},exports.ShortType=1011,exports.SpecularMaterial=Lt,exports.SplineCurve=W,exports.SpriteMarker=class extends Tr{constructor(e,t={}){super(e,{entity:t.entity,occludable:t.occludable,worldPos:t.worldPos}),this._occluded=!1,this._visible=!0,this._src=null,this._image=null,this._pos=h.vec3(),this._origin=h.vec3(),this._rtcPos=h.vec3(),this._dir=h.vec3(),this._size=1,this._imageSize=h.vec2(),this._texture=new Ut(this,{src:t.src}),this._geometry=new pe(this,{primitive:"triangles",positions:[3,3,0,-3,3,0,-3,-3,0,3,-3,0],normals:[-1,0,0,-1,0,0,-1,0,0,-1,0,0],uv:[1,-1,0,-1,0,0,1,0],indices:[0,1,2,0,2,3]}),this._mesh=new dt(this,{geometry:this._geometry,material:new bt(this,{ambient:[.9,.3,.9],shininess:30,diffuseMap:this._texture,backfaces:!0}),scale:[1,1,1],position:t.worldPos,rotation:[90,0,0],billboard:"spherical",occluder:!1}),this.visible=!0,this.collidable=t.collidable,this.clippable=t.clippable,this.pickable=t.pickable,this.opacity=t.opacity,this.size=t.size,t.image?this.image=t.image:this.src=t.src}_setVisible(e){this._occluded=!e,this._mesh.visible=this._visible&&!this._occluded,super._setVisible(e)}set visible(e){this._visible=null==e||e,this._mesh.visible=this._visible&&!this._occluded}get visible(){return this._visible}set image(e){this._image=e,this._image&&(this._imageSize[0]=this._image.width,this._imageSize[1]=this._image.height,this._updatePlaneSizeFromImage(),this._src=null,this._texture.image=this._image)}get image(){return this._image}set src(e){if(this._src=e,this._src){this._image=null;const e=new Image;e.onload=()=>{this._texture.image=e,this._imageSize[0]=e.width,this._imageSize[1]=e.height,this._updatePlaneSizeFromImage()},e.src=this._src}}get src(){return this._src}set size(e){this._size=null==e?1:e,this._image&&this._updatePlaneSizeFromImage()}get size(){return this._size}set collidable(e){this._mesh.collidable=!1!==e}get collidable(){return this._mesh.collidable}set clippable(e){this._mesh.clippable=!1!==e}get clippable(){return this._mesh.clippable}set pickable(e){this._mesh.pickable=!1!==e}get pickable(){return this._mesh.pickable}set opacity(e){this._mesh.opacity=e}get opacity(){return this._mesh.opacity}_updatePlaneSizeFromImage(){const e=.5*this._size,t=this._imageSize[0],s=this._imageSize[1],i=s/t;this._geometry.positions=t>s?[e,e*i,0,-e,e*i,0,-e,-e*i,0,e,-e*i,0]:[e/i,e,0,-e/i,e,0,-e/i,-e,0,e/i,-e,0]}},exports.StoreyViewsPlugin=class extends Wr{constructor(e,t={}){super("StoreyViews",e),this._objectsMemento=new kr,this._cameraMemento=new Pr,this.storeys={},this._storeysList=null,this.modelStoreys={},this._fitStoreyMaps=!!t.fitStoreyMaps,this._onModelLoaded=this.viewer.scene.on("modelLoaded",(e=>{this._registerModelStoreys(e),this.fire("storeys",this.storeys)}))}_registerModelStoreys(e){const t=this.viewer,s=t.scene,i=t.metaScene,r=i.metaModels[e],n=s.models[e];if(!r||!r.rootMetaObjects)return;const A=r.rootMetaObjects;for(let t=0,r=A.length;t<r;t++){const r=A[t].getObjectIDsInSubtreeByType(["IfcBuildingStorey"]);for(let t=0,A=r.length;t<A;t++){const A=r[t],o=i.metaObjects[A].getObjectIDsInSubtree(),a=s.getAABB(o),l=Math.random()>.5?o.length:0,c=new qB(this,n.aabb,a,e,A,l);c._onModelDestroyed=n.once("destroyed",(()=>{this._deregisterModelStoreys(e),this.fire("storeys",this.storeys)})),this.storeys[A]=c,this._storeysList=null,this.modelStoreys[e]||(this.modelStoreys[e]={}),this.modelStoreys[e][A]=c}}this._clipBoundingBoxes()}_clipBoundingBoxes(){const e=this.storeysList,t=this.viewer.metaScene,s=this.viewer.camera.worldUp,i=s[0]>s[1]&&s[0]>s[2],r=!i&&s[1]>s[0]&&s[1]>s[2];let n;!i&&!r&&s[2]>s[0]&&(s[2],s[1]),n=i?0:r?1:2;for(let s=0,i=e.length;s<i;s++){const i=t.metaObjects[e[s].storeyId].attributes.elevation;if(isNaN(i))return;const r=e[s].storeyAABB;if(r[n]=Math.max(r[1],parseFloat(i)),s>0){const i=t.metaObjects[e[s-1].storeyId].attributes.elevation;r[4]=Math.min(r[n+3],parseFloat(i))}this.storeys[e[s].storeyId].storeyAABB=r}}_deregisterModelStoreys(e){const t=this.modelStoreys[e];if(t){const s=this.viewer.scene;for(let e in t)if(t.hasOwnProperty(e)){const i=t[e],r=s.models[i.modelId];r&&r.off(i._onModelDestroyed),delete this.storeys[e],this._storeysList=null}delete this.modelStoreys[e]}}get fitStoreyMaps(){return this._fitStoreyMaps}gotoStoreyCamera(e,t={}){const s=this.storeys[e];if(!s)return this.error("IfcBuildingStorey not found with this ID: "+e),void(t.done&&t.done());const i=this.viewer,r=i.scene.camera,n=s.storeyAABB;if(n[3]<n[0]||n[4]<n[1]||n[5]<n[2])return void(t.done&&t.done());if(n[3]===n[0]&&n[4]===n[1]&&n[5]===n[2])return void(t.done&&t.done());const A=h.getAABB3Center(n),o=h.getAABB3Diag(n),a=Math.abs(o/Math.tan(45*h.DEGTORAD)),l=1.3*o,c=ty;c[0]=A[0]+r.worldUp[0]*a,c[1]=A[1]+r.worldUp[1]*a,c[2]=A[2]+r.worldUp[2]*a;const u=r.worldForward;t.done?i.cameraFlight.flyTo(_.apply(t,{eye:c,look:A,up:u,orthoScale:l}),(()=>{t.done()})):(i.cameraFlight.jumpTo(_.apply(t,{eye:c,look:A,up:u,orthoScale:l})),i.camera.ortho.scale=l)}showStoreyObjects(e,t={}){if(!this.storeys[e])return void this.error("IfcBuildingStorey not found with this ID: "+e);const s=this.viewer,i=s.scene;s.metaScene.metaObjects[e]&&(t.hideOthers&&i.setObjectsVisible(s.scene.visibleObjectIds,!1),this.withStoreyObjects(e,((e,t)=>{e&&(e.visible=!0)})))}withStoreyObjects(e,t){const s=this.viewer,i=s.scene,r=s.metaScene,n=r.metaObjects[e];if(!n)return;const A=n.getObjectIDsInSubtree();for(var o=0,a=A.length;o<a;o++){const e=A[o],s=r.metaObjects[e],n=i.objects[e];n&&t(n,s)}}createStoreyMap(e,t={}){const s=this.storeys[e];if(!s)return this.error("IfcBuildingStorey not found with this ID: "+e),"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNkYPhfDwAChwGA60e6kgAAAABJRU5ErkJggg==";const i=this.viewer,r=i.scene,n=t.format||"png",A=this._fitStoreyMaps?s.storeyAABB:s.modelAABB,o=Math.abs((A[5]-A[2])/(A[3]-A[0])),a=t.padding||0,l=!!t.captureSectionPlanes;let c,h;t.width&&t.height?(c=t.width,h=t.height):t.height?(h=t.height,c=Math.round(h/o)):t.width?(c=t.width,h=Math.round(c*o)):(c=300,h=Math.round(c*o));const u={visible:!0};this._objectsMemento.saveObjects(r,u),this._cameraMemento.saveCamera(r),this.showStoreyObjects(e,_.apply(t,{hideOthers:!0})),l&&this._toggleSectionPlanes(!1),this._arrangeStoreyMapCamera(s);const d=i.getSnapshot({width:c,height:h,format:n});return this._objectsMemento.restoreObjects(r,u),this._cameraMemento.restoreCamera(r),l&&this._toggleSectionPlanes(!0),new ey(e,d,n,c,h,a)}_toggleSectionPlanes(e){const t=this.viewer.scene.sectionPlanes;for(const s in t)t[s].active=e}_arrangeStoreyMapCamera(e){const t=this.viewer,s=t.scene.camera,i=this._fitStoreyMaps?e.storeyAABB:e.modelAABB,r=h.getAABB3Center(i),n=ty;n[0]=r[0]+.5*s.worldUp[0],n[1]=r[1]+.5*s.worldUp[1],n[2]=r[2]+.5*s.worldUp[2];const A=s.worldForward;t.cameraFlight.jumpTo({eye:n,look:r,up:A});const o=(i[3]-i[0])/2,a=(i[4]-i[1])/2,l=(i[5]-i[2])/2,c=-o,u=+o,d=-a,p=+a,f=-l,g=+l;t.camera.customProjection.matrix=h.orthoMat4c(c,u,f,g,d,p,sy),t.camera.projection="customProjection"}pickStoreyMap(e,t,s={}){const i=e.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),null;const n=1-t[0]/e.width,A=1-t[1]/e.height,o=this._fitStoreyMaps?r.storeyAABB:r.modelAABB,a=o[0],l=o[1],c=o[2],u=o[3]-a,d=o[4]-l,p=o[5]-c,f=h.vec3([a+u*n,l+.5*d,c+p*A]),g=h.vec3([0,-1,0]),m=h.addVec3(f,g,ty),_=this.viewer.camera.worldForward,b=h.lookAtMat4v(f,m,_,sy);return this.viewer.scene.pick({pickSurface:s.pickSurface,pickInvisible:!0,matrix:b})}storeyMapToWorldPos(e,t,s={}){const i=e.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),null;const n=1-t[0]/e.width,A=1-t[1]/e.height,o=this._fitStoreyMaps?r.storeyAABB:r.modelAABB,a=o[0],l=o[1],c=o[2],u=o[3]-a,d=o[4]-l,p=o[5]-c;return h.vec3([a+u*n,l+.5*d,c+p*A])}getStoreyContainingWorldPos(e,t=null){const s=t?this._filterStoreys(t):this.storeys;for(let t in s){const i=s[t];if(h.point3AABB3AbsoluteIntersect(i.storeyAABB,e))return t}return null}getStoreyInVerticalRange(e,t=null){const s=t?this._filterStoreys(t):this.storeys;for(let t in s){const i=s[t],r=[0,0,0,0,0,0],n=[0,0,0];if(r[1]=i.storeyAABB[1],r[4]=i.storeyAABB[4],n[1]=e[1],h.point3AABB3AbsoluteIntersect(r,n))return t}return null}isPositionAboveOrBelowBuilding(e,t=null){const s=t?this._filterStoreys(t):this.storeys,i=Object.keys(s);if(i.length<=0)return null;const r=[i[0],i[i.length-1]];return e[1]<s[r[0]].storeyAABB[1]?r[0]:e[1]>s[r[1]].storeyAABB[4]?r[1]:null}worldPosToStoreyMap(e,t,s){const i=e.storeyId,r=this.storeys[i];if(!r)return this.error("IfcBuildingStorey not found with this ID: "+i),!1;const n=this._fitStoreyMaps?r.storeyAABB:r.modelAABB,A=n[0],o=n[1],a=n[2],l=n[3]-A,c=n[4]-o,h=n[5]-a,u=this.viewer.camera.worldUp,d=u[0]>u[1]&&u[0]>u[2],p=!d&&u[1]>u[0]&&u[1]>u[2];!d&&!p&&u[2]>u[0]&&(u[2],u[1]);const f=e.width/l,g=p?e.height/h:e.height/c;return s[0]=Math.floor(e.width-(t[0]-A)*f),s[1]=Math.floor(e.height-(t[2]-a)*g),s[0]>=0&&s[0]<e.width&&s[1]>=0&&s[1]<=e.height}worldDirToStoreyMap(e,t,s){const i=this.viewer.camera,r=i.eye,n=i.look,A=h.subVec3(n,r,ty),o=i.worldUp,a=o[0]>o[1]&&o[0]>o[2],l=!a&&o[1]>o[0]&&o[1]>o[2];!a&&!l&&o[2]>o[0]&&(o[2],o[1]),a?(s[0]=A[1],s[1]=A[2]):l?(s[0]=A[0],s[1]=A[2]):(s[0]=A[0],s[1]=A[1]),h.normalizeVec2(s)}destroy(){this.viewer.scene.off(this._onModelLoaded),super.destroy()}get storeysList(){return this._storeysList||(this._storeysList=Object.values(this.storeys),this._storeysList.sort(this._getSpatialSortFunc())),this._storeysList}_getSpatialSortFunc(){const e=this.viewer.scene.camera;return this._spatialSortFunc||(this._spatialSortFunc=(t,s)=>{let i=0;i=e.xUp?0:e.yUp?1:2;const r=this.viewer.metaScene,n=r.metaObjects[t.storeyId],A=r.metaObjects[s.storeyId];if(n&&n.attributes&&void 0!==n.attributes.elevation&&A&&A.attributes&&void 0!==A.attributes.elevation){const e=Number.parseFloat(n.attributes.elevation),t=Number.parseFloat(A.attributes.elevation);return e>t?-1:e<t?1:0}return t.aabb[i]>s.aabb[i]?-1:t.aabb[i]<s.aabb[i]?1:0})}_filterStoreys(e){return Object.fromEntries(Object.entries(this.storeys).filter((([t,s])=>s.modelId===e)))}},exports.Texture=Ut,exports.TextureTranscoder=class{transcode(e,t,s={}){}destroy(){}},exports.TransformControl=KB,exports.TreeViewPlugin=class extends Wr{constructor(e,t={}){super("TreeViewPlugin",e),this.errors=[],this.valid=!0;const s=t.containerElement||document.getElementById(t.containerElementId);if(s instanceof HTMLElement){for(let e=0;;e++)if(!By[e]){By[e]=this,this._index=e,this._id=`tree-${e}`;break}if(this._containerElement=s,this._metaModels={},this._autoAddModels=!1!==t.autoAddModels,this._autoExpandDepth=t.autoExpandDepth||0,this._sortNodes=!1!==t.sortNodes,this._viewer=e,this._rootElement=null,this._muteSceneEvents=!1,this._muteTreeEvents=!1,this._rootNodes=[],this._objectNodes={},this._nodeNodes={},this._rootNames={},this._sortNodes=t.sortNodes,this._pruneEmptyNodes=t.pruneEmptyNodes,this._showListItemElementId=null,this._renderService=t.renderService||new by(this._containerElement),this._showIndeterminate=t.showIndeterminate??!1,this._showProjectNode=t.showProjectNode??!1,this._elevationSortFunction=t.elevationSortFunction??void 0,this._defaultSortFunction=t.defaultSortFunction??void 0,!this._renderService)throw new Error("TreeViewPlugin: no render service set");if(this._containerElement.oncontextmenu=e=>{e.preventDefault()},this._onObjectVisibility=this._viewer.scene.on("objectVisibility",(e=>{if(this._muteSceneEvents)return;const t=e.id,s=this._objectNodes[t];if(!s)return;const i=e.visible;if(!(i!==s.checked))return;this._muteTreeEvents=!0,s.checked=i,i?s.numVisibleEntities++:s.numVisibleEntities--,this._renderService.setCheckbox(s.nodeId,i);let r=s.parent;for(;r;){r.checked=i,i?r.numVisibleEntities++:r.numVisibleEntities--;const e=this._showIndeterminate&&r.numVisibleEntities>0&&r.numVisibleEntities<r.numEntities;r.checked=r.numVisibleEntities>0,this._renderService.setCheckbox(r.nodeId,r.checked,e),r=r.parent}this._muteTreeEvents=!1})),this._onObjectXrayed=this._viewer.scene.on("objectXRayed",(e=>{if(this._muteSceneEvents)return;const t=e.id,s=this._objectNodes[t];if(!s)return;this._muteTreeEvents=!0;const i=e.xrayed;i!==s.xrayed&&(s.xrayed=i,this._renderService.setXRayed(s.nodeId,i),this._muteTreeEvents=!1)})),this._switchExpandHandler=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this._expandSwitchElement(t)},this._switchCollapseHandler=e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this._collapseSwitchElement(t)},this._checkboxChangeHandler=e=>{if(this._muteTreeEvents)return;this._muteSceneEvents=!0;const t=e.target,s=this._renderService.isChecked(t),i=this._renderService.getIdFromCheckbox(t),r=this._nodeNodes[i],n=this._viewer.scene.objects;let A=0;this._withNodeTree(r,(e=>{const t=e.objectId,i=n[t],r=0===e.children.length;e.numVisibleEntities=s?e.numEntities:0,r&&s!==e.checked&&A++,e.checked=s,this._renderService.setCheckbox(e.nodeId,s),i&&(i.visible=s)}));let o=r.parent;for(;o;){s?o.numVisibleEntities+=A:o.numVisibleEntities-=A;const e=this._showIndeterminate&&o.numVisibleEntities>0&&o.numVisibleEntities<o.numEntities;o.checked=o.numVisibleEntities>0,this._renderService.setCheckbox(o.nodeId,o.checked,e),o=o.parent}this._muteSceneEvents=!1},this._hierarchy=t.hierarchy||"containment",this._autoExpandDepth=t.autoExpandDepth||0,this._autoAddModels){const e=Object.keys(this.viewer.metaScene.metaModels);for(let t=0,s=e.length;t<s;t++){const s=e[t];this.viewer.metaScene.metaModels[s].finalized&&this.addModel(s)}this.viewer.scene.on("modelLoaded",(e=>{this.viewer.metaScene.metaModels[e]&&this.addModel(e)}))}this.hierarchy=t.hierarchy}else this.error("Mandatory config expected: valid containerElementId or containerElement")}set hierarchy(e){"containment"!==(e=e||"containment")&&"storeys"!==e&&"types"!==e&&(this.error("Unsupported value for `hierarchy' - defaulting to 'containment'"),e="containment"),this._hierarchy!==e&&(this._hierarchy=e,this._createNodes())}get hierarchy(){return this._hierarchy}addModel(e,t={}){if(!this._containerElement)return;const s=this.viewer.scene.models[e];if(!s)throw"Model not found: "+e;const i=this.viewer.metaScene.metaModels[e];i?this._metaModels[e]?this.warn("Model already added: "+e):(this._metaModels[e]=i,t&&t.rootName&&(this._rootNames[e]=t.rootName),s.on("destroyed",(()=>{this.removeModel(s.id)})),this._createNodes()):this.error("MetaModel not found: "+e)}removeModel(e){if(!this._containerElement)return;this._metaModels[e]&&(this._rootNames[e]&&delete this._rootNames[e],delete this._metaModels[e],this._createNodes())}showNode(e){this.unShowNode();const t=this._objectNodes[e];if(!t)return;this.collapse();const s=t.nodeId,i=this._renderService.getSwitchElement(s);if(i)return this._expandSwitchElement(i),i.scrollIntoView(),!0;const r=[];r.unshift(t);let n=t.parent;for(;n;)r.unshift(n),n=n.parent;for(let e=0,t=r.length;e<t;e++){const t=this._renderService.getSwitchElement(r[e].nodeId);t&&this._expandSwitchElement(t)}this._renderService.setHighlighted(s,!0),this._showListItemElementId=s}unShowNode(){this._showListItemElementId&&(this._renderService.setHighlighted(this._showListItemElementId,!1),this._showListItemElementId=null)}expandToDepth(e){this.collapse();const t=(s,i)=>{if(i===e)return;const r=this._renderService.getSwitchElement(s.nodeId);if(r){this._expandSwitchElement(r);const e=s.children;for(var n=0,A=e.length;n<A;n++){const s=e[n];t(s,i+1)}}};for(let e=0,s=this._rootNodes.length;e<s;e++){const s=this._rootNodes[e];t(s,0)}}collapse(){for(let e=0,t=this._rootNodes.length;e<t;e++){const t=this._rootNodes[e].nodeId;this._collapseNode(t)}}withNodeTree(e,t){t(e);const s=e.children;if(s)for(let e=0,i=s.length;e<i;e++)this.withNodeTree(s[e],t)}destroy(){this._containerElement&&(this._metaModels={},this._rootElement&&!this._destroyed&&(this._rootElement.parentNode.removeChild(this._rootElement),this._viewer.scene.off(this._onObjectVisibility),this._destroyed=!0),delete By[this._index],super.destroy())}_createNodes(){this._rootElement&&(this._rootElement.parentNode.removeChild(this._rootElement),this._rootElement=null),this._rootNodes=[],this._objectNodes={},this._nodeNodes={},this._validate(),this.valid||"storeys"!==this._hierarchy?this._createEnabledNodes():this._createDisabledNodes()}_validate(){if(this.errors=[],"storeys"===this._hierarchy)this.valid=this._validateMetaModelForStoreysHierarchy();else this.valid=this._rootNodes.length>0;return this.valid}_validateMetaModelForStoreysHierarchy(e=0,t,s){return!0}_createEnabledNodes(){switch(this._pruneEmptyNodes&&this._findEmptyNodes(),this._hierarchy){case"storeys":this._createStoreysNodes(),0===this._rootNodes.length&&this.error("Failed to build storeys hierarchy");break;case"types":this._createTypesNodes();break;default:this._createContainmentNodes()}this._sortNodes&&this._doSortNodes(),this._synchNodesToEntities(),this._createTrees(),this.expandToDepth(this._autoExpandDepth)}_createDisabledNodes(){const e=this._renderService.createRootNode();this._rootElement=e,this._containerElement.appendChild(e);const t=this._viewer.metaScene.rootMetaObjects;for(let s in t){const i=t[s],r=i.type,n=i.name,A=n&&""!==n&&"Undefined"!==n&&"Default"!==n?n:r,o=this._renderService.createDisabledNodeElement(A);e.appendChild(o)}}_findEmptyNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._findEmptyNodes2(e[t])}_findEmptyNodes2(e,t=0){const s=this.viewer.scene,i=e.children,r=e.id,n=s.objects[r];if(e._countEntities=0,n&&e._countEntities++,i)for(let t=0,s=i.length;t<s;t++){const s=i[t];s._countEntities=this._findEmptyNodes2(s),e._countEntities+=s._countEntities}return e._countEntities}_createStoreysNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._createStoreysNodes2(e[t],null,null,null,null)}_createStoreysNodes2(e,t,s,i,r){if(this._pruneEmptyNodes&&0===e._countEntities)return;const n=e.type,A=e.name,o=e.children,a=e.id;if(this._showProjectNode&&"IfcProject"===n)t={nodeId:`${this._id}-${a}`,objectId:a,title:0===e.metaModels.length?A:this._rootNames[e.metaModels[0].id]||(A&&""!==A&&"Undefined"!==A&&"Default"!==A?A:n),type:n,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t;else if("IfcBuilding"===n)s={nodeId:`${this._id}-${a}`,objectId:a,title:0===e.metaModels.length?A:this._rootNames[e.metaModels[0].id]||(A&&""!==A&&"Undefined"!==A&&"Default"!==A?A:n),type:n,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t?t.children.push(s):this._rootNodes.push(s),this._objectNodes[s.objectId]=s,this._nodeNodes[s.nodeId]=s;else if("IfcBuildingStorey"===n){if(!s)return void this.error("Failed to build storeys hierarchy for model - model does not have an IfcBuilding object, or is not an IFC model");i={nodeId:`${this._id}-${a}`,objectId:a,title:A&&""!==A&&"Undefined"!==A&&"Default"!==A?A:n,type:n,parent:s,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},s.children.push(i),this._objectNodes[i.objectId]=i,this._nodeNodes[i.nodeId]=i,r={}}else if(i){if(this._viewer.scene.objects[a]){let e=(r=r||{})[n];e||(e={nodeId:`${this._id}-${i.objectId}-${n}`,objectId:`${i.objectId}-${n}`,title:n,type:n,parent:i,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},i.children.push(e),this._objectNodes[e.objectId]=e,this._nodeNodes[e.nodeId]=e,r[n]=e);const t={nodeId:`${this._id}-${a}`,objectId:a,title:A&&""!==A&&"Undefined"!==A&&"Default"!==A?A:n,type:n,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};e.children.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t}}if(o)for(let e=0,n=o.length;e<n;e++){const n=o[e];this._createStoreysNodes2(n,t,s,i,r)}}_createTypesNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._createTypesNodes2(e[t],null,null)}_createTypesNodes2(e,t,s){if(this._pruneEmptyNodes&&0===e._countEntities)return;const i=e.type,r=e.name,n=e.children,A=e.id;if(e.parent){if(t){if(this._viewer.scene.objects[A]){let e=s[i];e||(e={nodeId:`${this._id}-${t.objectId}-${i}`,objectId:`${t.objectId}-${i}`,title:i,type:i,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},t.children.push(e),this._objectNodes[e.objectId]=e,this._nodeNodes[e.nodeId]=e,s[i]=e);const n={nodeId:`${this._id}-${A}`,objectId:A,title:r&&""!==r&&"Default"!==r?r:i,type:i,parent:e,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};e.children.push(n),this._objectNodes[n.objectId]=n,this._nodeNodes[n.nodeId]=n}}}else t={nodeId:`${this._id}-${A}`,objectId:A,title:0===e.metaModels.length?r:this._rootNames[e.metaModels[0].id]||(r&&""!==r&&"Undefined"!==r&&"Default"!==r?r:i),type:i,parent:null,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]},this._rootNodes.push(t),this._objectNodes[t.objectId]=t,this._nodeNodes[t.nodeId]=t,s={};if(n)for(let e=0,i=n.length;e<i;e++){const i=n[e];this._createTypesNodes2(i,t,s)}}_createContainmentNodes(){const e=this._viewer.metaScene.rootMetaObjects;for(let t in e)this._createContainmentNodes2(e[t],null)}_createContainmentNodes2(e,t){if(this._pruneEmptyNodes&&0===e._countEntities)return;const s=e.type,i=e.name||s,r=e.children,n=e.id,A={nodeId:`${this._id}-${n}`,objectId:n,title:t?i&&""!==i&&"Undefined"!==i&&"Default"!==i?i:s:0===e.metaModels.length?i:this._rootNames[e.metaModels[0].id]||i,type:s,parent:t,numEntities:0,numVisibleEntities:0,checked:!1,xrayed:!1,children:[]};if(t?t.children.push(A):this._rootNodes.push(A),this._objectNodes[A.objectId]=A,this._nodeNodes[A.nodeId]=A,r)for(let e=0,t=r.length;e<t;e++){const t=r[e];this._createContainmentNodes2(t,A)}}_doSortNodes(){for(let e=0,t=this._rootNodes.length;e<t;e++){const t=this._rootNodes[e];this._sortChildren(t)}}_sortChildren(e){const t=e.children;if(!t||0===t.length)return;const s=t[0];"storeys"!==this._hierarchy&&"containment"!==this._hierarchy||"IfcBuildingStorey"!==s.type?this._defaultSortFunction?t.sort(this._defaultSortFunction):t.sort(this._alphaSortFunc):this._elevationSortFunction?t.sort(this._elevationSortFunction):t.sort(this._getSpatialSortFunc());for(let e=0,s=t.length;e<s;e++){const s=t[e];this._sortChildren(s)}}_getSpatialSortFunc(){const e=this.viewer.scene.camera;return this._spatialSortFunc||(this._spatialSortFunc=(t,s)=>{e.xUp||e.yUp;const i=this.viewer.metaScene,r=i.metaObjects[t.objectId],n=i.metaObjects[s.objectId];if(r&&r.attributes&&void 0!==r.attributes.elevation&&n&&n.attributes&&void 0!==n.attributes.elevation){const e=Number.parseFloat(r.attributes.elevation),t=Number.parseFloat(n.attributes.elevation);return e>t?-1:e<t?1:0}return 0})}_alphaSortFunc(e,t){const s=e.title.toUpperCase(),i=t.title.toUpperCase();return s<i?-1:s>i?1:0}_synchNodesToEntities(){const e=Object.keys(this.viewer.metaScene.metaObjects),t=this._viewer.metaScene.metaObjects,s=this._viewer.scene.objects;for(let i=0,r=e.length;i<r;i++){const r=e[i];if(t[r]){const e=this._objectNodes[r];if(e){const t=s[r];if(t){const s=t.visible;e.numEntities=1,e.xrayed=t.xrayed,s?(e.numVisibleEntities=1,e.checked=!0):(e.numVisibleEntities=0,e.checked=!1);let i=e.parent;for(;i;)i.numEntities++,s&&(i.numVisibleEntities++,i.checked=!0),i=i.parent}}}}}_withNodeTree(e,t){t(e);const s=e.children;if(s)for(let e=0,i=s.length;e<i;e++)this._withNodeTree(s[e],t)}_createTrees(){if(0===this._rootNodes.length)return;const e=this._rootNodes.map((e=>this._createNodeElement(e))),t=this._renderService.createRootNode();e.forEach((e=>{t.appendChild(e)})),this._containerElement.appendChild(t),this._rootElement=t}_createNodeElement(e){return this._renderService.createNodeElement(e,this._switchExpandHandler,this._checkboxChangeHandler,(t=>{this.fire("contextmenu",{event:t,viewer:this._viewer,treeViewPlugin:this,treeViewNode:e}),t.preventDefault()}),(t=>{this.fire("nodeTitleClicked",{event:t,viewer:this._viewer,treeViewPlugin:this,treeViewNode:e}),t.preventDefault()}))}_expandSwitchElement(e){if(this._renderService.isExpanded(e))return;const t=this._renderService.getId(e),s=this._nodeNodes[t].children.map((e=>this._createNodeElement(e)));this._renderService.addChildren(e,s),this._renderService.expand(e,this._switchExpandHandler,this._switchCollapseHandler)}_collapseNode(e){const t=this._renderService.getSwitchElement(e);this._collapseSwitchElement(t)}_collapseSwitchElement(e){this._renderService.collapse(e,this._switchExpandHandler,this._switchCollapseHandler)}},exports.UnsignedByteType=1009,exports.UnsignedInt248Type=1020,exports.UnsignedIntType=1014,exports.UnsignedShort4444Type=1017,exports.UnsignedShort5551Type=1018,exports.UnsignedShortType=1012,exports.VBOGeometry=me,exports.ViewCullPlugin=class extends Wr{constructor(e,t={}){super("ViewCull",e),this._objectCullStates=function(e){const t=e.id;let s=wy[t];return s||(s=new yy(e),wy[t]=s,e.on("destroyed",(()=>{delete wy[t],s._destroy()}))),s}(e.scene),this._maxTreeDepth=t.maxTreeDepth||8,this._modelInfos={},this._frustum=new Q,this._kdRoot=null,this._frustumDirty=!1,this._kdTreeDirty=!1,this._onViewMatrix=e.scene.camera.on("viewMatrix",(()=>{this._frustumDirty=!0})),this._onProjMatrix=e.scene.camera.on("projMatMatrix",(()=>{this._frustumDirty=!0})),this._onModelLoaded=e.scene.on("modelLoaded",(e=>{const t=this.viewer.scene.models[e];t&&this._addModel(t)})),this._onSceneTick=e.scene.on("tick",(()=>{this._doCull()}))}set enabled(e){this._enabled=e}get enabled(){return this._enabled}_addModel(e){const t={model:e,onDestroyed:e.on("destroyed",(()=>{this._removeModel(e)}))};this._modelInfos[e.id]=t,this._kdTreeDirty=!0}_removeModel(e){const t=this._modelInfos[e.id];t&&(t.model.off(t.onDestroyed),delete this._modelInfos[e.id],this._kdTreeDirty=!0)}_doCull(){const e=this._frustumDirty||this._kdTreeDirty;if(this._frustumDirty&&this._buildFrustum(),this._kdTreeDirty&&this._buildKDTree(),e){const e=this._kdRoot;e&&this._visitKDNode(e)}}_buildFrustum(){const e=this.viewer.scene.camera;R(this._frustum,e.viewMatrix,e.projMatrix),this._frustumDirty=!1}_buildKDTree(){const e=this.viewer.scene;this._kdRoot,this._kdRoot={aabb:e.getAABB(),intersection:Q.INTERSECT};for(let e=0,t=this._objectCullStates.numObjects;e<t;e++){const t=this._objectCullStates.objects[e];this._insertEntityIntoKDTree(this._kdRoot,t,e,1)}this._kdTreeDirty=!1}_insertEntityIntoKDTree(e,t,s,i){const r=t.aabb;if(i>=this._maxTreeDepth)return e.objects=e.objects||[],e.objects.push(s),void h.expandAABB3(e.aabb,r);if(e.left&&h.containsAABB3(e.left.aabb,r))return void this._insertEntityIntoKDTree(e.left,t,s,i+1);if(e.right&&h.containsAABB3(e.right.aabb,r))return void this._insertEntityIntoKDTree(e.right,t,s,i+1);const n=e.aabb;vy[0]=n[3]-n[0],vy[1]=n[4]-n[1],vy[2]=n[5]-n[2];let A=0;if(vy[1]>vy[A]&&(A=1),vy[2]>vy[A]&&(A=2),!e.left){const o=n.slice();if(o[A+3]=(n[A]+n[A+3])/2,e.left={aabb:o,intersection:Q.INTERSECT},h.containsAABB3(o,r))return void this._insertEntityIntoKDTree(e.left,t,s,i+1)}if(!e.right){const o=n.slice();if(o[A]=(n[A]+n[A+3])/2,e.right={aabb:o,intersection:Q.INTERSECT},h.containsAABB3(o,r))return void this._insertEntityIntoKDTree(e.right,t,s,i+1)}e.objects=e.objects||[],e.objects.push(s),h.expandAABB3(e.aabb,r)}_visitKDNode(e,t=Q.INTERSECT){if(t!==Q.INTERSECT&&e.intersects===t)return;t===Q.INTERSECT&&(t=O(this._frustum,e.aabb),e.intersects=t);const s=t===Q.OUTSIDE,i=e.objects;if(i&&i.length>0)for(let e=0,t=i.length;e<t;e++){const t=i[e];this._objectCullStates.setObjectViewCulled(t,s)}e.left&&this._visitKDNode(e.left,t),e.right&&this._visitKDNode(e.right,t)}send(e,t){}destroy(){super.destroy(),this._clear();const e=this.viewer.scene,t=e.camera;e.off(this._onModelLoaded),e.off(this._onSceneTick),t.off(this._onViewMatrix),t.off(this._onProjMatrix)}_clear(){for(let e in this._modelInfos){const t=this._modelInfos[e];t.model.off(t.onDestroyed)}this._modelInfos={},this._kdRoot=null,this._kdTreeDirty=!0}},exports.Viewer=class{constructor(e){this.language="en",this.localeService=e.localeService||new H,this.scene=new BA(this,{canvasId:e.canvasId,canvasElement:e.canvasElement,keyboardEventsElement:e.keyboardEventsElement,contextAttr:{preserveDrawingBuffer:!1!==e.preserveDrawingBuffer,premultipliedAlpha:!!e.premultipliedAlpha,antialias:!1!==e.antialias},spinnerElementId:e.spinnerElementId,transparent:!1!==e.transparent,gammaInput:!0,gammaOutput:!1,backgroundColor:e.backgroundColor,backgroundColorFromAmbientLight:e.backgroundColorFromAmbientLight,ticksPerRender:1,ticksPerOcclusionTest:20,units:e.units,scale:e.scale,origin:e.origin,saoEnabled:e.saoEnabled,alphaDepthMask:!1!==e.alphaDepthMask,entityOffsetsEnabled:!!e.entityOffsetsEnabled,readableGeometryEnabled:!!e.readableGeometryEnabled,logarithmicDepthBufferEnabled:!!e.logarithmicDepthBufferEnabled,pbrEnabled:!!e.pbrEnabled,colorTextureEnabled:!1!==e.colorTextureEnabled,dtxEnabled:!!e.dtxEnabled,markerZOffset:e.markerZOffset,numCachedSectionPlanes:e.numCachedSectionPlanes}),this.metaScene=new lo(this,this.scene),this.id=e.id||this.scene.id,this.camera=this.scene.camera,this.cameraFlight=new $(this.scene,{duration:.5}),this.cameraControl=new ro(this.scene,{doublePickFlyTo:!0}),this._plugins=[],this._eventSubs={}}get capabilities(){return this.scene.capabilities}on(e,t){let s=this._eventSubs[e];s||(s=[],this._eventSubs[e]=s),s.push(t)}fire(e,t){const s=this._eventSubs[e];if(s)for(let e=0,i=s.length;e<i;e++)s[e](t)}off(e){}log(e){console.log(`[xeokit viewer ${this.id}]: ${e}`)}error(e){console.error(`[xeokit viewer ${this.id}]: ${e}`)}addPlugin(e){this._plugins.push(e)}removePlugin(e){for(let t=0,s=this._plugins.length;t<s;t++){const s=this._plugins[t];if(s===e)return s.clear&&s.clear(),void this._plugins.splice(t,1)}}sendToPlugins(e,t){for(let s=0,i=this._plugins.length;s<i;s++){const i=this._plugins[s];i.send&&i.send(e,t)}}clear(){throw'Viewer#clear() no longer implemented - use \'#sendToPlugins("clear") instead'}resetView(){throw"Viewer#resetView() no longer implemented - use CameraMemento & ObjectsMemento classes instead"}beginSnapshot(){this._snapshotBegun||(this.scene._renderer.snapshot.beginSnapshot(),this._snapshotBegun=!0)}_renderSnapshotToCanvas(e){const t=void 0!==e.width&&void 0!==e.height,s=this.scene.canvas.canvas,i=s.clientWidth,r=s.clientHeight,n=!e.includeGizmos;t&&(s.width=e.width?Math.floor(e.width):s.width,s.height=e.height?Math.floor(e.height):s.height),this.beginSnapshot(),n&&this.sendToPlugins("snapshotStarting");const A=this.scene._renderer.snapshot.renderSnapshotToCanvas();return t&&(s.width=i,s.height=r,this.scene.glRedraw()),{canvas:A,toDataURL:()=>{n&&this.sendToPlugins("snapshotFinished"),this.endSnapshot();let t=e.format||"png";return"jpeg"!==t&&"png"!==t&&"bmp"!==t&&(console.error("Unsupported image format: '"+t+"' - supported types are 'jpeg', 'bmp' and 'png' - defaulting to 'png'"),t="png"),A.toDataURL(`image/${t}`)}}}getSnapshot(e={}){return this.scene.fire("rendering",{},!0),this._renderSnapshotToCanvas(e).toDataURL()}async getSnapshotWithPlugins(e={}){const t=this._renderSnapshotToCanvas(e),s={},i=[];for(let e=0,t=this._plugins.length;e<t;e++){const t=this._plugins[e];if(t.getContainerElement){const e=t.getContainerElement();e!==document.body&&(s[e.id]||(s[e.id]=!0,i.push(e)))}}const r=document.createElement("style");document.head.appendChild(r),r.sheet?.insertRule("body > div:last-child img { display: inline-block; }");const n=t.canvas;for(let e=0,t=i.length;e<t;e++){const t=i[e];await(A=t,o={canvas:n,backgroundColor:null,scale:n.width/t.clientWidth},void 0===o&&(o={}),Ap(A,o)),n.getContext("2d").resetTransform()}var A,o;return r.remove(),t.toDataURL()}endSnapshot(){this._snapshotBegun&&(this.scene._renderer.snapshot.endSnapshot(),this._snapshotBegun=!1)}destroy(){const e=this._plugins.slice();for(let t=0,s=e.length;t<s;t++){e[t].destroy()}this.scene.destroy()}},exports.WebIFCLoaderPlugin=class extends Wr{constructor(e,t={}){if(super("ifcLoader",e,t),this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults,this.includeTypes=t.includeTypes,this.excludeTypes=t.excludeTypes,this.excludeUnclassifiedObjects=t.excludeUnclassifiedObjects,!t.WebIFC)throw"Parameter expected: WebIFC";if(!t.IfcAPI)throw"Parameter expected: IfcAPI";this._webIFC=t.WebIFC,this._ifcAPI=t.IfcAPI}get supportedVersions(){return["2x3","4"]}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new Ow}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||kB}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}load(e={}){e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new br(this.viewer.scene,_.apply(e,{isModel:!0}));if(!e.src&&!e.ifc)return this.error("load() param expected: src or IFC"),t;const s={autoNormals:!0};if(!1!==e.loadMetadata){const t=e.includeTypes||this._includeTypes,i=e.excludeTypes||this._excludeTypes,r=e.objectDefaults||this._objectDefaults;if(t){s.includeTypesMap={};for(let e=0,i=t.length;e<i;e++)s.includeTypesMap[t[e]]=!0}if(i){s.excludeTypesMap={};for(let e=0,t=i.length;e<t;e++)s.excludeTypesMap[i[e]]=!0}r&&(s.objectDefaults=r),s.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,s.globalizeObjectIds=void 0!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds}try{e.src?this._loadModel(e.src,e,s,t):this._parseModel(e.ifc,e,s,t)}catch(e){this.error(e),t.fire("error",e)}return t}_loadModel(e,t,s,i){const r=this.viewer.scene.canvas.spinner;r.processes++,this._dataSource.getIFC(t.src,(e=>{this._parseModel(e,t,s,i),r.processes--}),(e=>{r.processes--,this.error(e),i.fire("error",e)}))}_parseModel(e,t,s,i){if(i.destroyed)return;const r=t.stats||{};if(r.sourceFormat="IFC",r.schemaVersion="",r.title="",r.author="",r.created="",r.numMetaObjects=0,r.numPropertySets=0,r.numObjects=0,r.numGeometries=0,r.numTriangles=0,r.numVertices=0,!this._ifcAPI)throw"WebIFCLoaderPlugin has no WebIFC instance configured - please inject via WebIFCLoaderPlugin constructor";const n=new Uint8Array(e),A=this._ifcAPI.OpenModel(n),o=this._ifcAPI.GetModelSchema(A),a=this._ifcAPI.GetLineIDsWithType(A,this._webIFC.IFCPROJECT).get(0),l=!1!==t.loadMetadata,c={modelID:A,modelSchema:o,sceneModel:i,loadMetadata:l,metadata:l?{id:"",projectId:""+a,author:"",createdAt:"",schema:"",creatingApplication:"",metaObjects:[],propertySets:[]}:null,metaObjects:{},options:s,log:function(e){},nextId:0,stats:r};if(l){if(s.includeTypes){c.includeTypes={};for(let e=0,t=s.includeTypes.length;e<t;e++)c.includeTypes[s.includeTypes[e]]=!0}if(s.excludeTypes){c.excludeTypes={};for(let e=0,t=s.excludeTypes.length;e<t;e++)c.excludeTypes[s.excludeTypes[e]]=!0}this._parseMetaObjects(c),this._parsePropertySets(c)}if(this._parseGeometry(c),i.finalize(),l){const e=i.id;this.viewer.metaScene.createMetaModel(e,c.metadata,s)}i.scene.once("tick",(()=>{i.destroyed||(i.scene.fire("modelLoaded",i.id),i.fire("loaded",!0,!1))}))}_parseMetaObjects(e){const t=this._ifcAPI.GetLineIDsWithType(e.modelID,this._webIFC.IFCPROJECT).get(0),s=this._ifcAPI.GetLine(e.modelID,t);this._parseSpatialChildren(e,s)}_parseSpatialChildren(e,t,s){const i=this._ifcAPI.GetNameFromTypeCode(t.type);if(e.includeTypes&&!e.includeTypes[i])return;if(e.excludeTypes&&e.excludeTypes[i])return;this._createMetaObject(e,t,s);const r=t.GlobalId.value;this._parseRelatedItemsOfType(e,t.expressID,"RelatingObject","RelatedObjects",this._webIFC.IFCRELAGGREGATES,r),this._parseRelatedItemsOfType(e,t.expressID,"RelatingStructure","RelatedElements",this._webIFC.IFCRELCONTAINEDINSPATIALSTRUCTURE,r)}_createMetaObject(e,t,s){const i=t.GlobalId.value,r=this._ifcAPI.GetNameFromTypeCode(t.type),n={id:i,name:t.Name&&""!==t.Name.value?t.Name.value:r,type:r,parent:s};e.metadata.metaObjects.push(n),e.metaObjects[i]=n,e.stats.numMetaObjects++}_parseRelatedItemsOfType(e,t,s,i,r,n){const A=this._ifcAPI.GetLineIDsWithType(e.modelID,r);for(let r=0;r<A.size();r++){const o=A.get(r),a=this._ifcAPI.GetLine(e.modelID,o),l=a[s];let c=!1;if(Array.isArray(l)){c=l.map((e=>e.value)).includes(t)}else c=l.value===t;if(c){const t=a[i];if(Array.isArray(t))t.forEach((t=>{const s=this._ifcAPI.GetLine(e.modelID,t.value);this._parseSpatialChildren(e,s,n)}));else{const s=this._ifcAPI.GetLine(e.modelID,t.value);this._parseSpatialChildren(e,s,n)}}}}_parsePropertySets(e){const t=this._ifcAPI.GetLineIDsWithType(e.modelID,this._webIFC.IFCRELDEFINESBYPROPERTIES);for(let s=0;s<t.size();s++){let i=t.get(s),r=this._ifcAPI.GetLine(e.modelID,i,!0);if(r){const t=r.RelatingPropertyDefinition;if(!t)continue;const s=t.GlobalId.value,i=t.HasProperties;if(i&&i.length>0){const n="Default",A=t.Name.value,o=[];for(let e=0,t=i.length;e<t;e++){const t=i[e],s=t.Name,r=t.NominalValue;if(s&&r){const e={name:s.value,type:r.type,value:r.value,valueType:r.valueType};t.Description?e.description=t.Description.value:r.description&&(e.description=r.description),o.push(e)}}const a={id:s,type:n,name:A,properties:o};e.metadata.propertySets.push(a),e.stats.numPropertySets++;const l=r.RelatedObjects;if(!l||0===l.length)return;for(let t=0,i=l.length;t<i;t++){const i=l[t].GlobalId.value,r=e.metaObjects[i];r&&(r.propertySetIds||(r.propertySetIds=[]),r.propertySetIds.push(s))}}}}}_parseGeometry(e){this._ifcAPI.StreamAllMeshes(e.modelID,(t=>{const s=t.expressID,i=t.geometries,r=[],n=this._ifcAPI.GetLine(e.modelID,s).GlobalId.value;if(e.loadMetadata){const t=n,s=e.metaObjects[t];if(e.includeTypes&&(!s||!e.includeTypes[s.type]))return;if(e.excludeTypes&&(!s||e.excludeTypes[s.type]))return}const A=h.mat4(),o=h.vec3();for(let t=0,s=i.size();t<s;t++){const s=i.get(t),n=this._ifcAPI.GetGeometry(e.modelID,s.geometryExpressID),a=this._ifcAPI.GetVertexArray(n.GetVertexData(),n.GetVertexDataSize()),l=this._ifcAPI.GetIndexArray(n.GetIndexData(),n.GetIndexDataSize()),c=new Float64Array(a.length/2),u=new Float32Array(a.length/2);for(let e=0,t=0,s=a.length/6;e<s;e++,t+=3)c[t+0]=a[6*e+0],c[t+1]=a[6*e+1],c[t+2]=a[6*e+2];A.set(s.flatTransformation),h.transformPositions3(A,c);const d=Ge(c,c,o);if(!e.options.autoNormals)for(let e=0,t=0,s=a.length/6;e<s;e++,t+=3)u[t+0]=a[6*e+3],u[t+1]=a[6*e+4],u[t+2]=a[6*e+5];e.stats.numGeometries++,e.stats.numVertices+=c.length/3,e.stats.numTriangles+=l.length/3;const p="mesh"+e.nextId++;e.sceneModel.createMesh({id:p,primitive:"triangles",origin:d?o:null,positions:c,normals:e.options.autoNormals?null:u,indices:l,color:[s.color.x,s.color.y,s.color.z],opacity:s.color.w}),r.push(p)}const a=e.options.globalizeObjectIds?h.globalizeObjectId(e.sceneModel.id,n):n;e.sceneModel.createEntity({id:a,meshIds:r,isObject:!0}),e.stats.numObjects++}))}},exports.Wire3D=Pp,exports.WorkerPool=Li,exports.XKTDefaultDataSource=Cy,exports.XKTLoaderPlugin=class extends Wr{constructor(e,t={}){super("XKTLoader",e,t),this._maxGeometryBatchSize=t.maxGeometryBatchSize,this.textureTranscoder=t.textureTranscoder,this.dataSource=t.dataSource,this.objectDefaults=t.objectDefaults,this.includeTypes=t.includeTypes,this.excludeTypes=t.excludeTypes,this.excludeUnclassifiedObjects=t.excludeUnclassifiedObjects,this.reuseGeometries=t.reuseGeometries}get supportedVersions(){return Object.keys(vw)}get textureTranscoder(){return this._textureTranscoder}set textureTranscoder(e){this._textureTranscoder=e}get dataSource(){return this._dataSource}set dataSource(e){this._dataSource=e||new Cy}get objectDefaults(){return this._objectDefaults}set objectDefaults(e){this._objectDefaults=e||kB}get includeTypes(){return this._includeTypes}set includeTypes(e){this._includeTypes=e}get excludeTypes(){return this._excludeTypes}set excludeTypes(e){this._excludeTypes=e}get includeIds(){return this._includeIds}set includeIds(e){this._includeIds=e}get excludeUnclassifiedObjects(){return this._excludeUnclassifiedObjects}set excludeUnclassifiedObjects(e){this._excludeUnclassifiedObjects=!!e}get globalizeObjectIds(){return this._globalizeObjectIds}set globalizeObjectIds(e){this._globalizeObjectIds=!!e}get reuseGeometries(){return this._reuseGeometries}set reuseGeometries(e){this._reuseGeometries=!1!==e}load(e={}){if(e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id),!(e.src||e.xkt||e.manifestSrc||e.manifest))throw new Error("XKTLoaderPlugin: load() param expected: src, xkt, manifestSrc or manifestData");const t={},s=e.includeTypes||this._includeTypes,i=e.excludeTypes||this._excludeTypes,r=e.includeIds||this._includeIds,n=e.objectDefaults||this._objectDefaults;if(t.reuseGeometries=null!==e.reuseGeometries&&void 0!==e.reuseGeometries?e.reuseGeometries:!1!==this._reuseGeometries,s){t.includeTypesMap={};for(let e=0,i=s.length;e<i;e++)t.includeTypesMap[s[e]]=!0}if(i){t.excludeTypesMap={};for(let e=0,s=i.length;e<s;e++)t.excludeTypesMap[i[e]]=!0}if(r){t.includeIdsMap={};for(let e=0,s=r.length;e<s;e++)t.includeIdsMap[r[e]]=!0}n&&(t.objectDefaults=n),t.excludeUnclassifiedObjects=void 0!==e.excludeUnclassifiedObjects?!!e.excludeUnclassifiedObjects:this._excludeUnclassifiedObjects,t.globalizeObjectIds=void 0!==e.globalizeObjectIds&&null!==e.globalizeObjectIds?!!e.globalizeObjectIds:this._globalizeObjectIds;const A=new br(this.viewer.scene,_.apply(e,{isModel:!0,textureTranscoder:this._textureTranscoder,maxGeometryBatchSize:this._maxGeometryBatchSize,origin:e.origin,disableVertexWelding:e.disableVertexWelding||!1,disableIndexRebucketing:e.disableIndexRebucketing||!1,dtxEnabled:e.dtxEnabled,renderOrder:e.renderOrder})),o=A.id,a=new ao({metaScene:this.viewer.metaScene,id:o});this.viewer.scene.canvas.spinner.processes++;const l=()=>{A.destroyed||(A.finalize(),a.finalize(),this.viewer.scene.canvas.spinner.processes--,A.once("destroyed",(()=>{this.viewer.metaScene.destroyMetaModel(a.id)})),this.scheduleTask((()=>{A.destroyed||(A.scene.fire("modelLoaded",A.id),A.fire("loaded",!0,!1))})))},c=e=>{this.viewer.scene.canvas.spinner.processes--,this.error(e),A.fire("error",e)};let h=0;const u={getNextId:()=>`${o}.${h++}`};if(e.metaModelSrc||e.metaModelData)if(e.metaModelSrc){const r=e.metaModelSrc;this._dataSource.getMetaModel(r,(r=>{A.destroyed||(a.loadData(r,{includeTypes:s,excludeTypes:i,globalizeObjectIds:t.globalizeObjectIds}),e.src?this._loadModel(e.src,t,A,null,u,l,c):(this._parseModel(e.xkt,t,A,null,u),l()))}),(e=>{c(`load(): Failed to load model metadata for model '${o} from  '${r}' - ${e}`)}))}else e.metaModelData&&(a.loadData(e.metaModelData,{includeTypes:s,excludeTypes:i,globalizeObjectIds:t.globalizeObjectIds}),e.src?this._loadModel(e.src,t,A,null,u,l,c):(this._parseModel(e.xkt,t,A,null,u),l()));else if(e.src)this._loadModel(e.src,t,A,a,u,l,c);else if(e.xkt)this._parseModel(e.xkt,t,A,a,u),l();else if(e.manifestSrc||e.manifest){const r=e.manifestSrc?function(e){e.indexOf("?")>-1&&(e=e.split("?")[0]);const t=e.split("/");return t.pop(),t.join("/")+"/"}(e.manifestSrc):"",n=(e,n,o)=>{let l=0;const c=()=>{A.destroyed||l>=e.length?n():this._dataSource.getMetaModel(`${r}${e[l]}`,(e=>{a.loadData(e,{includeTypes:s,excludeTypes:i,globalizeObjectIds:t.globalizeObjectIds}),l++,this.scheduleTask(c,200)}),o)};c()},o=(e,s,i)=>{let n=0;const o=()=>{A.destroyed||n>=e.length?s():this._dataSource.getXKT(`${r}${e[n]}`,(e=>{this._parseModel(e,t,A,null,u),A.preFinalize(),n++,this.scheduleTask(o,200)}),i)};o()},h=(e,s,i)=>{let n=0;const o=()=>{A.destroyed||n>=e.length?s():this._dataSource.getXKT(`${r}${e[n]}`,(e=>{this._parseModel(e,t,A,a,u),A.preFinalize(),n++,this.scheduleTask(o,200)}),i)};o()};if(e.manifest){const t=e.manifest,s=t.xktFiles;if(!s||0===s.length)return void c("load(): Failed to load model manifest - manifest not valid");const i=t.metaModelFiles;i?n(i,(()=>{o(s,l,c)}),c):h(s,l,c)}else this._dataSource.getManifest(e.manifestSrc,(e=>{if(A.destroyed)return;const t=e.xktFiles;if(!t||0===t.length)return void c("load(): Failed to load model manifest - manifest not valid");const s=e.metaModelFiles;s?n(s,(()=>{o(t,l,c)}),c):h(t,l,c)}),c)}return A}_loadModel(e,t,s,i,r,n,A){this._dataSource.getXKT(e,(e=>{this._parseModel(e,t,s,i,r),s.preFinalize(),n()}),A)}async _parseModel(e,t,s,i,r){if(s.destroyed)return;const n=new DataView(e),A=new Uint8Array(e),o=n.getUint32(0,!0),a=2147483647&o,l=a<11||a>=12&&o>>>31,c=vw[a];if(!c)return void this.error("Unsupported .XKT file version: "+a+" - this XKTLoaderPlugin supports versions "+Object.keys(vw));if(!l)return void c.parseArrayBuffer(this.viewer,t,e,s,i,r);const h=n.getUint32(4,!0),u=[];let d=4*(h+2);for(let e=0;e<h;e++){const t=n.getUint32(4*(e+2),!0);u.push(A.subarray(d,d+t)),d+=t}c.parse(this.viewer,t,u,s,i,r)}},exports.XML3DLoaderPlugin=class extends Wr{constructor(e,t={}){super("XML3DLoader",e,t),t.workerScriptsPath?(this._workerScriptsPath=t.workerScriptsPath,this._loader=new Fw(this,t),this.supportedSchemas=this._loader.supportedSchemas):this.error("Config expected: workerScriptsPath")}load(e={}){e.workerScriptsPath=this._workerScriptsPath,e.id&&this.viewer.scene.components[e.id]&&(this.error("Component with this ID already exists in viewer: "+e.id+" - will autogenerate this ID"),delete e.id);const t=new Ve(this.viewer.scene,_.apply(e,{isModel:!0})),s=e.src;return s?(this._loader.load(this,t,s,e),t):(this.error("load() param expected: src"),t)}},exports.ZoneEditControl=_v,exports.ZoneEditMouseControl=class extends _v{constructor(e,t){super(e,t,!0,!1)}},exports.ZoneEditTouchControl=class extends _v{constructor(e,t){super(e,t,!1,!0)}},exports.ZoneTranslateControl=bv,exports.ZoneTranslateMouseControl=class extends bv{constructor(e,t){super(e,t,!0,!1)}},exports.ZoneTranslateTouchControl=class extends bv{constructor(e,t){super(e,t,!1,!0)}},exports.ZonesMouseControl=class extends gv{constructor(e,t={}){super(e,t,((e,t)=>dv(e,t)))}},exports.ZonesPlugin=class extends Wr{constructor(e,t={}){super("Zones",e),this._pointerLens=t.pointerLens,this._container=t.container||document.body,this._zones=[],this.defaultColor=void 0!==t.defaultColor?t.defaultColor:"#00BBFF",this.zIndex=t.zIndex||1e4,this._onMouseOver=(e,t)=>{this.fire("mouseOver",{plugin:this,zone:t,event:e})},this._onMouseLeave=(e,t)=>{this.fire("mouseLeave",{plugin:this,zone:t,event:e})},this._onContextMenu=(e,t)=>{this.fire("contextMenu",{plugin:this,zone:t,event:e})}}createZone(e={}){this.viewer.scene.components[e.id]&&(this.error("Viewer scene component with this ID already exists: "+e.id),delete e.id);const t=new fv(this,{id:e.id,plugin:this,container:this._container,geometry:e.geometry,alpha:e.alpha,color:e.color,onMouseOver:this._onMouseOver,onMouseLeave:this._onMouseLeave,onContextMenu:this._onContextMenu});return this._zones.push(t),t.on("destroyed",(()=>{const e=this._zones.indexOf(t);e>=0&&this._zones.splice(e,1)})),this.fire("zoneCreated",t),t}get zones(){return this._zones}destroy(){super.destroy()}},exports.ZonesPolysurfaceMouseControl=class extends T{constructor(e,t={}){super(e.viewer.scene),this.zonesPlugin=e,this.pointerLens=t.pointerLens,this._action=null}get active(){return!!this._action}activate(e,t,s,i){if("object"==typeof e&&null!==e){const r=e,n=(e,t)=>{if(e in r)return r[e];if(void 0!==t)return t;throw"config missing: "+e};e=n("altitude"),t=n("height"),s=n("color","#008000"),i=n("alpha",.5)}if(this._action)return;const r=this.zonesPlugin,n=r.viewer,A=n.scene,o=this,a=dv(n,(function(t,s){return pv(e,h.vec3([0,1,0]),t,s)}));!function n(){o._action=mv(A,e,t,s,i,o.pointerLens,r,a,(e=>{let t=!0;o._action={deactivate:()=>{t=!1}},o.fire("zoneEnd",e),t&&n()}))}()}deactivate(){this._action&&(this._action.deactivate(),this._action=null)}destroy(){this.deactivate(),super.destroy()}},exports.ZonesPolysurfaceTouchControl=class extends T{constructor(e,t={}){super(e.viewer.scene),this.zonesPlugin=e,this.pointerLens=t.pointerLens,this.pointerCircle=new L(e.viewer),this._action=null}get active(){return!!this._action}activate(e,t,s,i){if("object"==typeof e&&null!==e){const r=e,n=(e,t)=>{if(e in r)return r[e];if(void 0!==t)return t;throw"config missing: "+e};e=n("altitude"),t=n("height"),s=n("color","#008000"),i=n("alpha",.5)}if(this._action)return;const r=this.zonesPlugin,n=r.viewer,A=n.scene,o=this,a=Rp(n,this.pointerCircle,(function(t,s){return pv(e,h.vec3([0,1,0]),t,s)}));!function n(){o._action=mv(A,e,t,s,i,o.pointerLens,r,a,(e=>{let t=!0;o._action={deactivate:()=>{t=!1}},o.fire("zoneEnd",e),t&&n()}))}()}deactivate(){this._action&&(this._action.deactivate(),this._action=null)}destroy(){this.deactivate(),super.destroy()}},exports.ZonesTouchControl=class extends gv{constructor(e,t={}){const s=new L(e.viewer);super(e,t,((e,t)=>Rp(e,s,t))),this.pointerCircle=s}destroy(){this.pointerCircle.destroy(),super.destroy()}},exports.activateDraggableDot=kp,exports.activateDraggableDots=Qp,exports.addMousePressListener=function(e,t){const s=(t,s)=>(s[0]=t.clientX,s[1]=t.clientY,Ep(e.ownerDocument.documentElement,e,s),s);let i=!1;const r=[],n=()=>r.forEach((e=>e())),A=(t,s)=>{e.addEventListener(t,s),r.push((()=>e.removeEventListener(t,s)))},o=h.vec2();return A("mousedown",(function(e){1===e.which&&(i=!0,t(s(e,o)))})),A("mousemove",(function(e){s(e,up),i&&h.distVec2(o,up)>4&&(i=!1),(i||1&!e.buttons)&&t(up)})),A("mouseup",(function(e){if(1===e.which&&i){const i=t(s(e,up));i&&(n(),i())}})),n},exports.addTouchPressListener=function(e,t,s,i){const r=h.vec2(),n=(t,s)=>(s[0]=t.clientX,s[1]=t.clientY,Ep(e.ownerDocument.documentElement,e,s),s);let A,o=null,a=Cp;const l=function(){clearTimeout(o),s.stop(),t.active=!0,a=Cp,A=null},c=[],u=()=>c.forEach((e=>e())),d=(t,s)=>{e.addEventListener(t,s,{passive:!0}),c.push((()=>e.removeEventListener(t,s)))};return d("touchstart",(function(e){const c=e.touches;if(1!==c.length)l(),i(null);else{const e=c[0];n(e,r),A=e.identifier,a=e=>{h.distVec2(r,e)>20&&l()},o=setTimeout((function(){s.start(r),o=setTimeout((function(){s.stop(),t.active=!1,a=i,a(r)}),300)}),250)}})),d("touchmove",(function(e){const t=[...e.changedTouches].find((e=>e.identifier===A));t&&a(n(t,up))})),d("touchend",(function(e){const t=[...e.changedTouches].find((e=>e.identifier===A));if(t){const e=i(n(t,up));l(),e?(u(),e()):i(null)}})),()=>{l(),u()}},exports.buildBoxGeometry=be,exports.buildBoxLinesGeometry=Be,exports.buildBoxLinesGeometryFromAABB=function(e={}){return Be({id:e.id,center:[(e.aabb[0]+e.aabb[3])/2,(e.aabb[1]+e.aabb[4])/2,(e.aabb[2]+e.aabb[5])/2],xSize:Math.abs(e.aabb[3]-e.aabb[0])/2,ySize:Math.abs(e.aabb[4]-e.aabb[1])/2,zSize:Math.abs(e.aabb[5]-e.aabb[2])/2})},exports.buildCylinderGeometry=ye,exports.buildGridGeometry=we,exports.buildLineGeometry=Ue,exports.buildPlaneGeometry=ve,exports.buildPolylineGeometry=xe,exports.buildPolylineGeometryFromCurve=function(e={}){let t=e.curve.getPoints(e.divisions).map((e=>[...e])).flat();return xe({id:e.id,points:t})},exports.buildSphereGeometry=Ce,exports.buildTorusGeometry=Me,exports.buildVectorTextGeometry=Fe,exports.createCombinedTexture=async function(e,t){if(!t.src||!Array.isArray(t.src)||6!==t.src.length)throw new Error("src requires path to 6 images");const[s,i,r,n,A,o]=t.src;if(!(s&&i&&r&&n&&A&&o))throw new Error("All six images must be provided");const a=document.createElement("canvas"),l=a.getContext("2d"),c=e=>new Promise(((t,s)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>t(i),i.onerror=()=>s(new Error(`Failed to load image: ${e}`)),i.src=e}));try{const[h,u,d,p,f,g]=await Promise.all([c(s),c(i),c(r),c(n),c(A),c(o)]),m=h.width;if(u.width!==m||d.width!==m||p.width!==m||f.width!==m||g.width!==m)throw new Error("All skybox textures must have the same dimensions");a.width=4*m,a.height=3*m,l.fillStyle="black",l.fillRect(0,0,a.width,a.height),l.drawImage(u,0*m,1*m,m,m),l.drawImage(h,2*m,1*m,m,m),l.drawImage(d,1*m,0*m,m,m),l.drawImage(p,1*m,2*m,m,m),l.drawImage(f,1*m,1*m,m,m),l.drawImage(g,3*m,1*m,m,m);return new Ut(e,{image:a,flipY:!0,wrapS:1001,wrapT:1001,encoding:t.encoding||3e3})}catch(e){throw console.error("Error creating combined skybox texture:",e),e}},exports.createRTCViewMat=He,exports.createSkyboxMesh=function(e,t){return new dt(e,{geometry:new pe(e,{primitive:"triangles",positions:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],uv:[.5,.6666,.25,.6666,.25,.3333,.5,.3333,.5,.6666,.5,.3333,.75,.3333,.75,.6666,.5,.6666,.5,1,.25,1,.25,.6666,.25,.6666,0,.6666,0,.3333,.25,.3333,.25,0,.5,0,.5,.3333,.25,.3333,.75,.3333,1,.3333,1,.6666,.75,.6666],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]}),background:!0,scale:[1e3,1e3,1e3],rotation:[0,-90,0],material:new bt(e,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:t,backfaces:!0}),visible:!0,pickable:!1,clippable:!1,collidable:!1})},exports.createSphereMapMesh=function(e,t){const s=new pe(e,Ce({center:[0,0,0],radius:1,heightSegments:60,widthSegments:60})),i=new bt(e,{ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],emissive:[1,1,1],emissiveMap:t,backfaces:!0});return new dt(e,{geometry:s,background:!0,rotation:[0,0,180],material:i,visible:!0,pickable:!1,clippable:!1,collidable:!1})},exports.frustumIntersectsAABB3=O,exports.getKTX2TextureTranscoder=ji,exports.isTriangleMeshSolid=zt,exports.load3DSGeometry=function(e,t={}){return new Promise((function(s,i){t.src||(console.error("load3DSGeometry: Parameter expected: src"),i());var r=e.canvas.spinner;r.processes++,_.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("load3DSGeometry: no data loaded"),r.processes--,i());var n=_e.parse.from3DS(e).edit.objects[0].mesh,A=n.vertices,o=n.uvt,a=n.indices;r.processes--,s(_.apply(t,{primitive:"triangles",positions:A,normals:null,uv:o,indices:a}))}),(function(e){console.error("load3DSGeometry: "+e),r.processes--,i()}))}))},exports.loadOBJGeometry=function(e,t={}){return new Promise((function(s,i){t.src||(console.error("loadOBJGeometry: Parameter expected: src"),i());var r=e.canvas.spinner;r.processes++,_.loadArraybuffer(t.src,(function(e){e.byteLength||(console.error("loadOBJGeometry: no data loaded"),r.processes--,i());for(var n=_e.parse.fromOBJ(e),A=_e.edit.unwrap(n.i_verts,n.c_verts,3),o=_e.edit.unwrap(n.i_norms,n.c_norms,3),a=_e.edit.unwrap(n.i_uvt,n.c_uvt,2),l=new Int32Array(n.i_verts.length),c=0;c<n.i_verts.length;c++)l[c]=c;r.processes--,s(_.apply(t,{primitive:"triangles",positions:A,normals:o.length>0?o:null,autoNormals:0===o.length,uv:a,indices:l}))}),(function(e){console.error("loadOBJGeometry: "+e),r.processes--,i()}))}))},exports.marker3D=Sp,exports.math=h,exports.meshSurfaceArea=ns,exports.meshVolume=Yt,exports.os=jr,exports.sRGBEncoding=3001,exports.setFrustum=R,exports.startPolygonCreate=function(e,t,s,i,r,n){const A=e.canvas.canvas,o=t?function(e,s){t.visible=!!e,e&&(t.canvasPos=e,t.snapped=!!s)}:()=>{},a=function(){const e=(e,t,s)=>t[0]<=Math.max(e[0],s[0])&&t[0]>=Math.min(e[0],s[0])&&t[1]<=Math.max(e[1],s[1])&&t[1]>=Math.min(e[1],s[1]),t=(e,t,s)=>{const i=(t[1]-e[1])*(s[0]-t[0])-(t[0]-e[0])*(s[1]-t[1]);return 0===i?0:i>0?1:2};return function(s,i){const r=i?1:0,n=s[(s.length-2+r)%s.length],A=s[(s.length-1+r)%s.length];for(let i=r;i<s.length-2-1+r;++i){const r=s[i],o=s[i+1],a=t(n,A,r),l=t(n,A,o),c=t(r,o,n),h=t(r,o,A);if(a!==l&&c!==h||0===a&&e(n,r,A)||0===l&&e(n,o,A)||0===c&&e(r,n,o)||0===h&&e(r,A,o))return!0}return!1}}(),l=e=>e.length>=3&&function(){const t=h.normalizeVec3(h.subVec3(e[1],e[0],h.vec3())),s=h.normalizeVec3(h.subVec3(e[2],e[0],gp)),i=h.normalizeVec3(h.cross3Vec3(t,s,h.vec3())),r=h.normalizeVec3(h.cross3Vec3(i,t,h.vec3()));return{normal:i,origin:h.vec3(e[0]),u:t,v:r}}(),c=[];let u;return function t(){const d=l(c);let p=!1;const f=s((t=>{const s=t&&(e=>{const t=i(e),s=t&&t.entity&&(!d||t.snapped)&&t.worldPos;if(d){const t=h.dotVec3(d.normal,d.origin),i=s?t-h.dotVec3(s,d.normal):window.Infinity;if(Math.abs(i)<1e-4){const e=h.vec3();return{worldPos:h.addVec3(s,h.mulVec3Scalar(d.normal,i,e),e),snapped:!0}}return{worldPos:Mp(t,d.normal,e.origin,e.direction),snapped:!1}}return{worldPos:s,snapped:t&&t.snapped}})(((t,s)=>(h.canvasPosToWorldRay(A,e.camera.viewMatrix,e.camera.projMatrix,e.camera.projection,t,s.origin,s.direction),s))(t,vp)),r=s&&s.worldPos;return g(r,t,s&&s.snapped)})),g=(s,i,A)=>{const u=s?e.camera.projectWorldPos(s):i,f=c.length>0&&function(){const t=c[0];return{canvasPos:e.camera.projectWorldPos(t),worldPos:t}}(),g=c.length>=3&&(u&&h.distVec2(u,f.canvasPos)<10||s&&h.compareVec3(s,f.worldPos));o(g?f.canvasPos:u,g||A);const m=i&&(!s||(c.length<3?c.some((e=>h.compareVec3(e,s))):h.compareVec3(c[c.length-1],s))),_=c.concat(g||!s||m?[]:[s]),b=!m&&(d||l(_)),B=b&&_.map((e=>(h.subVec3(e,b.origin,gp),h.vec2([h.dotVec3(gp,b.u),h.dotVec3(gp,b.v)])))),y=!(m||B&&a(B,g)),w=y&&B&&(g||!a(B,!0))&&function(){try{const[e,t,s]=Op(B);return{faces:t,vertices:e.map((e=>h.addVec3(b.origin,h.addVec3(h.mulVec3Scalar(b.u,e[0],gp),h.mulVec3Scalar(b.v,e[1],mp),gp),h.vec3())))}}catch(e){return console.warn("e",e),!1}}();return r(_,g,y,w),p=y&&(g?()=>{o(null),n()}:()=>{c.push(h.vec3(s)),o(null),t()})};u={closePolygon:()=>{const e=c.length>=3&&g(c[0]);return e&&(f(),e()),!!e},placeVertex:()=>(p&&(f(),p()),!!p),popVertex:()=>c.length>0&&(f(),c.pop(),t(),!0),removePressListener:f,updateOnChange:()=>g()}}(),{cancel:()=>{u.removePressListener(),o(null)},closePolygon:()=>u.closePolygon(),placeVertex:()=>u.placeVertex(),popVertex:()=>u.popVertex(),updateOnChange:()=>u.updateOnChange()}},exports.stats=p,exports.touchPointSelector=Rp,exports.transformToNode=Ep,exports.triangulateEarClipping=Op,exports.utils=_,exports.wire3D=Dp,exports.worldToRTCPos=Ne,exports.worldToRTCPositions=Ge;
