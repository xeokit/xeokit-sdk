<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>xeokit Example Distance Precision</title>
    <link href="../css/pageStyle.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/js/all.min.js"></script>
    <script src="../libs/dat.gui.min.js" type="text/javascript"></script>
    <link href="../css/dat-gui-light-style.css" rel="stylesheet" />
</head>

<body>
    <input type="checkbox" id="info-button" />
    <label for="info-button" class="info-button"><i class="far fa-3x fa-question-circle"></i></label>
    <canvas id="myCanvas"></canvas>
    <div class="slideout-sidebar">
        <img class="info-icon" src="../../assets/images/measure_distance_icon.png" />
        <h1>DistanceMeasurementPlugin</h1>
        <h2>Configuring units and scale</h2>
        <p>In this example, we're loading model with two boxes, one box is slightly bigger than the other. On the left
            670mm x 1100mm x 250mm and on the right 670.10mm x1100mm x 250.01mm</p>
        <p>DistanceMeasurement on the right have a custom labelStringFormat function that sets the precision to 4</p>
        <h3>Configure units and scale</h3>
        <div id="myDatGuiContainer"></div>
        <h3>Components Used</h3>
        <ul>
            <li>
                <a href="../../docs/class/src/viewer/Viewer.js~Viewer.html" target="_other">Viewer</a>
            </li>
            <li>
                <a href="../../docs/class/src/plugins/XKTLoaderPlugin/XKTLoaderPlugin.js~XKTLoaderPlugin.html"
                    target="_other">XKTLoaderPlugin</a>
            </li>
            <li>
                <a href="../../docs/class/src/plugins/DistanceMeasurementsPlugin/DistanceMeasurementsPlugin.js~DistanceMeasurementsPlugin.html"
                    target="_other">DistanceMeasurementsPlugin</a>
            </li>
        </ul>
        <h3>Assets</h3>
        <ul>
            <li>
                <a href="http://openifcmodel.cs.auckland.ac.nz/Model/Details/274" target="_other">Model source</a>
            </li>
        </ul>
    </div>

</body>
<script type="module">
    //------------------------------------------------------------------------------------------------------------------
    // Import the modules we need for this example
    //------------------------------------------------------------------------------------------------------------------

    import { Viewer, XKTLoaderPlugin, ContextMenu, PointerLens, DistanceMeasurementsPlugin, DistanceMeasurementsMouseControl, DistanceMeasurementEditMouseControl } from "../../dist/xeokit-sdk.es.js";

    //------------------------------------------------------------------------------------------------------------------
    // Create a Viewer and arrange the camera
    //------------------------------------------------------------------------------------------------------------------

    const viewer = new Viewer({
        canvasId: "myCanvas"
    });

    viewer.camera.eye = [0.7161777746712514, 2.0474327623912516, 2.6331376299525417];
    viewer.camera.look = [1.1546300427194216, 0.40757025416052217, -0.09460310902638014];
    viewer.camera.up = [0.08100400084201831, 0.8599261573859844, -0.5039497551254106];

    viewer.cameraControl.followPointer = true;

    viewer.scene.metrics.units = "millimeters";
    viewer.scene.metrics.scale = 1000;
    viewer.scene.metrics.origin = [100, 0, 200];

    //------------------------------------------------------------------------------------------------------------------
    // Load a model
    //------------------------------------------------------------------------------------------------------------------

    const xktLoader = new XKTLoaderPlugin(viewer);

    const sceneModel = xktLoader.load({
        id: "myModel",
        src: "../../assets/models/xkt/v12/uncompressed/cubes-measurements.xkt", // Creates a MetaObject instances in scene.metaScene.metaObjects
        edges: true
    });

    const distanceMeasurementsPlugin = new DistanceMeasurementsPlugin(viewer);

    sceneModel.on("loaded", () => {

        const myMeasurement1 = distanceMeasurementsPlugin.createMeasurement({
            id: "distanceMeasurement1",
            origin: {
                worldPos: [1.0999864181658863, 0.6699977295800295, -0.2500023564837456]
            },
            target: {
                worldPos: [2.4807907328394663e-7, -8.344650248570673e-9, -0.00000381836304666483]
            },
            visible: true,
            wireVisible: true
        });

        const myMeasurement2 = distanceMeasurementsPlugin.createMeasurement({
            id: "distanceMeasurement2",
            origin: {
                worldPos: [2.6000000119209288, 0.6700999868392945, -0.25001000679016117]
            },
            target: {
                worldPos: [1.499974061833751, -8.344650248570673e-9, 6.79016110005648e-9]
            },
            visible: true,
            wireVisible: true,
        });

        myMeasurement2.labelStringFormat = (len) => {
            const metrics = viewer.scene.metrics;
            const scale = metrics.scale;
            const unit = metrics.unitsInfo[metrics.units].abbrev;

            return parseFloat(String(len * viewer.scene.metrics.scale)).toFixed(4) + unit;
        };
    });
</script>

</html>